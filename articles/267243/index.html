<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RxJava. Fighting the challenges of harsh reality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reactive programming is a very fashionable trend in mobile development at the moment. If we talk about android development, then reactivity is represe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RxJava. Fighting the challenges of harsh reality</h1><div class="post__text post__text-html js-mediator-article">  Reactive programming is a very fashionable trend in mobile development at the moment.  If we talk about android development, then reactivity is represented mainly by the RxJava library. <br>  The network has more and more articles, training videos, presentations, recordings from conferences that tell about this topic.  But the overwhelming majority of the presented material contains theoretical aspects and rather trivial examples in which the developer cannot estimate the real profit from the use of Rx.  But one wants to see a real and complex example from life, which very clearly shows all the power, beauty and simplicity of reactive programming. <br>  Therefore, this article will be devoted to a detailed analysis of a real and rather complicated example.  And I really hope that after reading, you will truly discover the world of reactive programming. <br><a name="habracut"></a><br><br><h2>  Little about theory </h2><br>  In the beginning, I would still like to devote time to theory, since when considering an example, you should already more or less clearly understand what Observable, Subscriber, Subscription are, Rx operators and what the diagrams mean for each operator.  As I wrote above, there are enough materials now.  Therefore, I will provide a list of links to the most important and interesting ones. <br><br>  The most important resource is the <a href="https://github.com/ReactiveX/RxJava/wiki">RX wiki.</a> <br>  I would pay particular attention to <a href="https://github.com/ReactiveX/RxJava/wiki/Additional-Reading">this point.</a> <br>  It lists all the links to pretty good and high-quality articles. <br>  Personally, I like the <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">article</a> for the introduction <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">.</a> <br>  In my opinion, the author tries to convey to the listener the main idea - you need to think not with objects, but with streams (Stream, not Thread! Multithreading has nothing to do with this).  Understanding the whole process of Rx, namely how the interaction of threads, greatly facilitates further work. <br>  Also for the introduction there is a good <a href="http://slides.com/yaroslavheriatovych/frponandroid">presentation.</a> <br>  Futurice blog.  <a href="http://futurice.com/blog/top-7-tips-for-rxjava-on-android">One of the articles</a> <br>  <a href="http://blog.danlew.net/">A blog</a> containing many useful Rx articles and more. <br>  Some of the articles are <a href="http://blog.danlew.net/2014/09/15/grokking-rxjava-part-1/">Part 1</a> , <a href="http://blog.danlew.net/2014/09/22/grokking-rxjava-part-2/">Part 2</a> , <a href="http://blog.danlew.net/2014/09/30/grokking-rxjava-part-3/">Part 3</a> , <a href="http://blog.danlew.net/2014/10/08/grokking-rxjava-part-4/">Part 4</a> ; <br>  Something already exists in Russian: <br>  1. Translations of articles Grokking RxJava <a href="http://habrahabr.ru/post/265269/">Part 1</a> , <a href="http://habrahabr.ru/post/265583/">Part 2</a> , <a href="http://habrahabr.ru/post/265727/">Part 3</a> , <a href="http://habrahabr.ru/post/265997/">Part 4</a> <br>  2. Independent <a href="http://habrahabr.ru/company/2gis/blog/228125/">article</a> <br>  If you use RxJava in your project, then without RetroLambda your further existence does not make sense :) <br>  Good article on <a href="http://habrahabr.ru/post/224593/">lambda</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  And a lot of practice </h2><br>  Well, now consider the real case from our not simple development life. <br>  We needed to get a list of statements (this is a model <code>StatementRUR</code> ) for a specific period of time.  Let's say for a month. <br>  What do we have?  The request (the <code>statementRURList</code> method) with the <code>offset</code> and <code>limit</code> parameters, as well as the <code>StatementListParameters</code> parameter, in which we set the filter (from such and such date to such and such) and the sorting order.  That is, getting a list of statements for the month is already becoming a somewhat non-trivial task in implementation. <br>  Let's simplify a little and imagine that the <code>statementRURList</code> method returns immediately <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <ol><li> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> <pre> <code class="hljs cmake"><code><code class="java"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code></code> </pre> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> </li> <li> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> </li><li> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code></code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> <pre> <code class="hljs cmake"><code class="java"><span class="hljs-keyword"><span class="hljs-keyword">List</span></span>. <br>       : <br> int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = statementRURList(int i * limit, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; limit) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        <span class="hljs-string"><span class="hljs-string">",   "</span></span>  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName(<span class="hljs-string"><span class="hljs-string">"result"</span></span>) private T result; @SerializedName(<span class="hljs-string"><span class="hljs-string">"errors"</span></span>) private <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors; @SerializedName(<span class="hljs-string"><span class="hljs-string">"state"</span></span>) private Object state; public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result field */ public T getResult() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ErrorResponseApiModel&gt; getErrors() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors; } public Object getState() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code><span class="hljs-keyword"><span class="hljs-keyword">String</span></span> accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code><span class="hljs-keyword"><span class="hljs-keyword">List</span></span> ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   <span class="hljs-number"><span class="hljs-number">160</span></span> , <code>LIMIT = <span class="hljs-number"><span class="hljs-number">50</span></span></code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>    .       : <code><span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>...Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span></code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   <span class="hljs-string"><span class="hljs-string">""</span></span>  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (<span class="hljs-string"><span class="hljs-string">" "</span></span>, Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span>  <code><code>ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt;() { @Override public <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; call(ResponseApiModel&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;&gt; listResponseApiModel) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;StatementRUR&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> <span class="hljs-string"><span class="hljs-string">""</span></span> ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(<span class="hljs-number"><span class="hljs-number">0</span></span>, Integer.MAX_VALUE - <span class="hljs-number"><span class="hljs-number">1</span></span>) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; safeMerge(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt;&gt; lists) { <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = new ArrayList&lt;&gt;(); for (<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;T&gt; statementOperationRURList : lists) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.addAll(statementOperationRURList); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>; }</code> <br> ,    Rx <span class="hljs-string"><span class="hljs-string">"  "</span></span>   ,    <span class="hljs-string"><span class="hljs-string">""</span></span>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:<span class="hljs-number"><span class="hljs-number">131</span></span>) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:<span class="hljs-number"><span class="hljs-number">106</span></span>) at rx.internal.operators.OperatorScan$<span class="hljs-number"><span class="hljs-number">2</span></span>.onCompleted(OperatorScan.java:<span class="hljs-number"><span class="hljs-number">123</span></span>) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:<span class="hljs-number"><span class="hljs-number">99</span></span>) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:<span class="hljs-number"><span class="hljs-number">65</span></span>) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:<span class="hljs-number"><span class="hljs-number">171</span></span>) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </pre> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </li> <code><code class="java">List. <br>       : <br> int i = 0; List&lt;StatementRUR&gt; commonList = new ArrayList&lt;&gt;(); while (true) { List&lt;StatementRUR&gt; list = statementRURList(int i * limit, int limit, String accountId, int periodDaysCount, Date docInfoDocDate); commonList.addAll(list); if (list.size() &lt; limit) { break; } i++; }</code> <br>        . <br>       ,     UI ,        ,         ,    .       ,       .       . <br>        ",   "  .   RxJava -  ,   ! <br> <br>         ,     . <br>          RetroFit.      ,     Rx.             : <br> <code class="java">Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; statementRURList (int offset, int limit, String accountId, int periodDaysCount, Date docInfoDocDate);</code> <br> ,  <code>ResponseApiModel</code> -   ,         . <br>      : <br> <code class="java">public class ResponseApiModel&lt;T&gt; { @SerializedName("result") private T result; @SerializedName("errors") private List&lt;ErrorResponseApiModel&gt; errors; @SerializedName("state") private Object state; public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors) { this.result = result; this.errors = errors; } public ResponseApiModel(T result, List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.result = result; this.errors = errors; this.state = state; } public ResponseApiModel(List&lt;ErrorResponseApiModel&gt; errors, Object state) { this.errors = errors; this.state = state; } /** * if result == null &amp;&amp; errors != null -&gt; throw new ResponseAPIException! * @return result field */ public T getResult() { if (result == null &amp;&amp; errors != null) { throw new ResponseAPIException(errors); } return result; } public List&lt;ErrorResponseApiModel&gt; getErrors() { return errors; } public Object getState() { return state; } }</code> <br>       <code>T result</code> ,          .        <code>errors</code> ,        <code>T getResult()</code>   <code>ResponseAPIException</code> ,    <code>Subscriber.onError(Throwable e)</code> <br>  <code>String accountId, int periodDaysCount, Date docInfoDocDate</code>      <code>StatementListParameters</code> ,    . <br>         <code><code>List ( T result</code> ). <br> <br> <b>    !     Rx?</b> <br>       . <br>    :   160 , <code>LIMIT = 50</code> <br> <br> <img src="https://habrastorage.org/files/ed9/2f9/e59/ed92f9e596f24b2c9da0a892333b1169.jpg"> <br> <br>      ,         ( <code>i</code>   ). <br>      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">range</a> .      : <br> <code class="java">Observable.range(0, Integer.MAX_VALUE - 1)</code> <br>  <code>Observable</code> ""    .       : <code>0, 1, 2, 3...Integer.MAX_VALUE - 1</code> .   ,      -  <code>statementRURList</code> .             .      RetroFit (       )    . <br>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a> .    ,     <code>Observable</code> ,        <code>Observable</code> ,   ""  .    <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">concatMap</a>     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">flatMap</a>   ,   <code>Observable</code>     ,   .  ,      ,    ,  <code>Observable</code>          . <br>      :)   ,       (" ", Stream) <br> <br>    : <br> <code class="java">Observable // get All statements from current date for periodDaysCount (with offset, limit) .range(0, Integer.MAX_VALUE - 1) .concatMap(new Func1&lt;Integer, Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt;&gt;() { @Override public Observable&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;&gt; call(Integer increment) { return statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate); } } );</code> <br> -  ,  ?   lambda?   : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate));</code> <br>     :) <br>  <code>Observable</code> ""  <code><code>ResponseApiModel&lt;List&gt;.       ,   ,  T result</code>  <code>ResponseApiModel</code> .    <code>result</code>     <code>T getResult()</code> .     ,   <code>Observable</code> .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> . <br> .  . <br> <br>  : <br></code> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(new Func1&lt;ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt;, List&lt;StatementRUR&gt;&gt;() { @Override public List&lt;StatementRUR&gt; call(ResponseApiModel&lt;List&lt;StatementRUR&gt;&gt; listResponseApiModel) { return listResponseApiModel.getResult(); } } );</code> <br>   RetroLambda <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult);</code> <br></code> <br>           (   <code>offset</code> )        .       -  <s></s> . <br>    ,        <code>limit</code> ,       . <br>   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">takeUntil</a> ,       .    ,   <code>observable</code>    . <br>    ?   .  . <br> <br> : <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(new Func1&lt;List&lt;StatementRUR&gt;, Boolean&gt;() { @Override public Boolean call(List&lt;StatementRUR&gt; list) { return list.size() &lt; LIMIT; } } );</code> <br>   RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT);</code> <br> <br>                  .   <code>observable</code> "" ,      (  -      ).    .     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a> ,    ""    ,         ,   <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ,          . <br> .    . <br> <br> .     RetroLambda: <br> <code class="java">Observable .range(0, Integer.MAX_VALUE - 1) .concatMap(increment -&gt; statementRURList(LIMIT * increment, LIMIT, accountId, periodDaysCount, docInfoDocDate)) .map(ResponseApiModel::getResult) .takeUntil(list -&gt; list.size() &lt; LIMIT) .toList() .map(this::safeMerge); private &lt;T&gt; List&lt;T&gt; safeMerge(List&lt;List&lt;T&gt;&gt; lists) { List&lt;T&gt; list = new ArrayList&lt;&gt;(); for (List&lt;T&gt; statementOperationRURList : lists) { list.addAll(statementOperationRURList); } return list; }</code> <br> ,    Rx "  "   ,    ""     <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a> .      <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">toList</a>  <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">map</a> ?   , ,         (     ), <a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html">scan</a>  : <br> <code class="java">java.util.NoSuchElementException: Sequence contains no elements at rx.internal.operators.OperatorSingle$ParentSubscriber.onCompleted(OperatorSingle.java:131) at rx.internal.operators.OperatorTakeLastOne$ParentSubscriber.onCompleted(OperatorTakeLastOne.java:106) at rx.internal.operators.OperatorScan$2.onCompleted(OperatorScan.java:123) at rx.observers.SerializedObserver.onCompleted(SerializedObserver.java:99) at rx.observers.SerializedSubscriber.onCompleted(SerializedSubscriber.java:65) at rx.internal.operators.OperatorConcat$ConcatSubscriber.subscribeNext(OperatorConcat.java:171) ...</code> <br>      ,  , . <br> <br> <br> <br>      .       ,       . <br> <br>       ,   , - ,    .      ,       .          . <br>  ,  ,         .    ,   RX     . Rx   . <br> <br>    ,   !</code> </ol> </div><p>Source: <a href="https://habr.com/ru/post/267243/">https://habr.com/ru/post/267243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267233/index.html">Managing complexity in ruby ‚Äã‚Äãon rails projects. Part 2</a></li>
<li><a href="../267235/index.html">RailsClub 2015: Competition from Vexor'a and the story of the CI-service in a large project</a></li>
<li><a href="../267237/index.html">About UEFI security, part three</a></li>
<li><a href="../267239/index.html">In the wake of C ++ Siberia: a dragon in a bag</a></li>
<li><a href="../267241/index.html">Maintenance code. How to ‚Äúsell‚Äù refactoring to business</a></li>
<li><a href="../267245/index.html">RailsClub 2015: Interview with Nikolai Ryzhikov</a></li>
<li><a href="../267247/index.html">How many tweets do you need to know your character?</a></li>
<li><a href="../267253/index.html">In the Chinese AppStore, 39 infected applications were detected due to a modified version of Xcode.</a></li>
<li><a href="../267257/index.html">New PHP, Part 1: Return types</a></li>
<li><a href="../267265/index.html">The digest of interesting materials for the mobile developer # 121 (September 14-20)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>