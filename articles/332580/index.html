<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protecting your site with ZIP bombs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Old methods still work 
 [Update] Now I'm on some sort of special services list because I wrote an article about some kind of ‚Äúbomb‚Äù, right? 

 If you...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protecting your site with ZIP bombs</h1><div class="post__text post__text-html js-mediator-article"><h2>  Old methods still work </h2><br><img src="https://habrastorage.org/web/95a/6a8/a77/95a6a8a7704b41538af50d1fc012c545.png" align="left">  <font color="gray">[Update] Now I'm on some sort of special services list because I wrote an article about some kind of ‚Äúbomb‚Äù, right?</font> <br><br>  If you have ever hosted a website or administered a server, you probably know well about bad people who are trying to do various bad things with your property. <br><br>  When I, at the age of 13, first started my little Linux box with SSH access, I watched the logs and saw IP addresses every day (mostly from China and Russia) that tried to connect to my sweet little box (which In fact, it was an old ThinkPad T21 laptop with a broken display buzzing under the bed).  I reported these IPs to their providers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In fact, if you have a Linux server with open SSH, you can see for yourself how many connection attempts occur every day: <br><br><pre><code class="bash hljs">grep <span class="hljs-string"><span class="hljs-string">'authentication failures'</span></span> /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/auth.log</code></pre><a name="habracut"></a><br>
<img src="https://habrastorage.org/getpro/habr/post_images/d14/06b/d7f/d1406bd7f2342e6307744b1b694dc9d1.jpg"><br>
<font color="gray">   ,              </font> <br>
<br>
<h2>Wordpress  </h2><br>
, ,  -    Wordpress,   ,      ,        <code>wp-admin</code>   .<br>
<br>
           ,   <a href="https://wpscan.org/"></a>  <a href="https://github.com/sullo/nikto"></a>  <a href="http://rgaucher.info/beta/grabber/"></a>      -      -   <a href="https://en.wikipedia.org/wiki/Website_defacement"></a> .<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/4b6/1ba/ba8/4b61baba8a435d4c40b46ae349932e51.jpg"><br>
<font color="gray">     Nikto</font> <br>
<br>
      -     ,   .    ‚Ä¶<br>
<br>
<h2>    ?</h2><br>
      <a href="https://en.wikipedia.org/wiki/Intrusion_detection_system">IDS</a>  <a href="https://en.wikipedia.org/wiki/Fail2ban">Fail2ban</a>      ZIP-  .<br>
<br>
<h2>    ‚Äî ZIP-?</h2><br>
 ,  ZIP     ,         ,      ,    .  ,  .<br>
<br>
  <a href="http://www.unforgettable.dk/">42.zip</a>,   4,5&nbsp; (4&nbsp;500&nbsp;000&nbsp;)  42&nbsp;.       (   ),   , ,       .<br>
<br>
<h2>  ZIP-   ?</h2><br>
 , -   ZIP,     GZIP.<br>
<br>
     10-  GZIP,  .     ,    .<br>
<br>
<pre><code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero bs=1M count=10240 | gzip &gt; 10G.gzip</code></pre><br>
<img src="https://habrastorage.org/getpro/habr/post_images/5e6/30b/a89/5e630ba892d7d0b08b06831bcfa8a1cc.jpg"><br>
<font color="gray">     </font> <br>
<br>
 ,   10&nbsp;.     ,   .<br>
<br>
  PHP-,    .<br>
<br>
<pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span>
<span class="hljs-comment"><span class="hljs-comment">//prepare the client to recieve GZIP data. This will not be suspicious</span></span>
<span class="hljs-comment"><span class="hljs-comment">//since most web servers use GZIP by default</span></span>
header(<span class="hljs-string"><span class="hljs-string">"Content-Encoding: gzip"</span></span>);
header(<span class="hljs-string"><span class="hljs-string">"Content-Length: "</span></span>.filesize(<span class="hljs-string"><span class="hljs-string">'10G.gzip'</span></span>));
<span class="hljs-comment"><span class="hljs-comment">//Turn off output buffering</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ob_get_level()) ob_end_clean();
<span class="hljs-comment"><span class="hljs-comment">//send the gzipped file to the client</span></span>
readfile(<span class="hljs-string"><span class="hljs-string">'10G.gzip'</span></span>);</code></pre><br>
!<br>
<br>
        :<br>
<br>
<pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span>
$agent = filter_input(INPUT_SERVER, <span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>);

<span class="hljs-comment"><span class="hljs-comment">//check for nikto, sql map or "bad" subfolders which only exist on wordpress</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strpos($agent, <span class="hljs-string"><span class="hljs-string">'nikto'</span></span>) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> || strpos($agent, <span class="hljs-string"><span class="hljs-string">'sqlmap'</span></span>) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> || startswith($url,<span class="hljs-string"><span class="hljs-string">'wp-'</span></span>) || startswith($url,<span class="hljs-string"><span class="hljs-string">'wordpress'</span></span>) || startswith($url,<span class="hljs-string"><span class="hljs-string">'wp/'</span></span>))
{
      sendBomb();
      <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendBomb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{
        <span class="hljs-comment"><span class="hljs-comment">//prepare the client to recieve GZIP data. This will not be suspicious</span></span>
        <span class="hljs-comment"><span class="hljs-comment">//since most web servers use GZIP by default</span></span>
        header(<span class="hljs-string"><span class="hljs-string">"Content-Encoding: gzip"</span></span>);
        header(<span class="hljs-string"><span class="hljs-string">"Content-Length: "</span></span>.filesize(<span class="hljs-string"><span class="hljs-string">'10G.gzip'</span></span>));
        <span class="hljs-comment"><span class="hljs-comment">//Turn off output buffering</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ob_get_level()) ob_end_clean();
        <span class="hljs-comment"><span class="hljs-comment">//send the gzipped file to the client</span></span>
        readfile(<span class="hljs-string"><span class="hljs-string">'10G.gzip'</span></span>);
}

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startsWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span><span class="hljs-function"> </span></span>{ 
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strpos($a, $b) === <span class="hljs-number"><span class="hljs-number">0</span></span>;
}</code></pre><br>
,     ,       -,  ,     ,      user-agent.<br>
<br>
<h3>‚Ä¶  ,    ?</h3><br>
<table>
<tbody><tr>
<th></th>
<th></th>
</tr>
<tr>
<td>IE 11</td>
<td> , IE </td>
</tr>
<tr>
<td>Chrome</td>
<td> ,  </td>
</tr>
<tr>
<td>Edge</td>
<td> , ,  </td>
</tr>
<tr>
<td>Nikto</td>
<td>   ,    </td>
</tr>
<tr>
<td>SQLmap</td>
<td>  ,  </td>
</tr>
<tr>
<td>Safari</td>
<td>  ,    ,        ...</td>
</tr>
<tr>
<td>Chrome (Android)</td>
<td> ,  </td>
</tr>
</tbody></table><br>
(      //, , <a href="https://twitter.com/geek_at"> </a>,      )<br>
<br>
<img src="https://habrastorage.org/getpro/habr/post_images/b6d/12f/321/b6d12f32189e48bafad0c3d20a5a5174.jpg"><br>
<font color="gray">    Chrome</font> <br>
<br>
   , <b><a href="https://blog.haschek.at/tools/bomb.php"> </a></b>!</div><p>Source: <a href="https://habr.com/ru/post/332580/">https://habr.com/ru/post/332580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332568/index.html">The choice of algorithm for calculating quantiles for a distributed system</a></li>
<li><a href="../332570/index.html">Moya - how to stop worrying about the network part and start living</a></li>
<li><a href="../332572/index.html">Is it time to use CSS Grid Layout?</a></li>
<li><a href="../332574/index.html">AliveScript - a programming language for children 12+</a></li>
<li><a href="../332578/index.html">Vs interface</a></li>
<li><a href="../332582/index.html">Yet another tutorial: launch dotnet core docker application on Linux</a></li>
<li><a href="../332584/index.html">Making an image recognition service using TensorFlow Serving</a></li>
<li><a href="../332586/index.html">Fix bugs in 1988 style</a></li>
<li><a href="../332588/index.html">How to create your own metro</a></li>
<li><a href="../332594/index.html">Let's Encrypt will start issuing wildcard certificates in January 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>