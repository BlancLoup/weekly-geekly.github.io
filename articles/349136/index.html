<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal React + Express Applications (continued)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article , a simple draft of a universal application on React.js was considered, using only standard tools and code snippets from the o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal React + Express Applications (continued)</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/349064/">previous article</a> , a simple draft of a universal application on React.js was considered, using only standard tools and code snippets from the official React.js documentation.  But this is not enough for convenient development.  It is necessary to form the environment so that there are standard features (for example, ‚Äúhot‚Äù component overload) equally for both the server and the client part of the frontend. <br><a name="habracut"></a><br>  The project from the <a href="https://habrahabr.ru/post/349064/">previous article is</a> built on the description of routes as a simple object: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.js module.exports = [ { path: '/', exact: true, // component: Home, componentName: 'home' }, { path: '/users', exact: true, // component: UsersList, componentName: 'components/usersList', }, { path: '/users/:id', exact: true, // component: User, componentName: 'components/user', }, ];</span></span></code> </pre> <br>  This object also specifies code splitting.  This is how it is configured for the client webpack: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//to access built-in const HtmlWebpackPlugin = require('html-webpack-plugin'); //installed via npm const path = require('path'); const CommonsChunkPlugin = webpack.optimize.CommonsChunkPlugin; const nodeEnv = process.env.NODE_ENV || 'development'; const port = Number(process.env.PORT) || 3000; const isDevelopment = nodeEnv === 'development'; const routes = require('../src/react/routes'); const hotMiddlewareScript = `webpack-hot-middleware/client?path=/__webpack_hmr&amp;timeout=20000`; const entry = {}; for (let i = 0; i &lt; routes.length; i++ ) { entry[routes[i].componentName] = [ '../src/client.js', '../src/react/' + routes[i].componentName + '.js', ]; if (isDevelopment) { entry[routes[i].componentName].unshift(hotMiddlewareScript); } } module.exports = { name: 'client', target: 'web', cache: isDevelopment, devtool: isDevelopment ? 'cheap-module-source-map' : 'hidden-source-map', context: __dirname, entry, output: { path: path.resolve(__dirname, '../dist'), publicPath: isDevelopment ? '/static/' : '/static/', filename: isDevelopment ? '[name].bundle.js': '[name].[hash].bundle.js', chunkFilename: isDevelopment ? '[name].bundle.js': '[name].[hash].bundle.js', }, module: { rules: [{ test: /\.jsx?$/, exclude: /node_modules/, loader: "babel-loader", options: { cacheDirectory: isDevelopment, babelrc: false, presets: [ 'es2015', 'es2017', 'react', 'stage-0', 'stage-3' ], plugins: [ "transform-runtime", "syntax-dynamic-import", ].concat(isDevelopment ? [ ["react-transform", { "transforms": [{ "transform": "react-transform-hmr", "imports": ["react"], "locals": ["module"] }] }], ] : [ ] ), } } ] }, plugins: [ new webpack.optimize.OccurrenceOrderPlugin(), new webpack.HotModuleReplacementPlugin(), new webpack.NoEmitOnErrorsPlugin(), new webpack.NamedModulesPlugin(), //new webpack.optimize.UglifyJsPlugin(), function(compiler) { this.plugin("done", function(stats) { require("fs").writeFileSync(path.join(__dirname, "../dist", "stats.generated.js"), 'module.exports=' + JSON.stringify(stats.toJson().assetsByChunkName) + ';console.log(module.exports);\n'); }); } ].concat(isDevelopment ? [ ] : [ new CommonsChunkPlugin({ name: "common", minChunks: 2 }), ] ), };</span></span></code> </pre><br>  Each fragment of the resulting code includes the common <code>client.js</code> entry <code>client.js</code> , the main component for the corresponding route name, and for the development environment also <code>webpack-hot-middleware/client</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the working build, a module is additionally formed with a code common to all components: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommonsChunkPlugin({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"common"</span></span>, <span class="hljs-attr"><span class="hljs-attr">minChunks</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> }),</code> </pre><br>  The <code>minChunks</code> value allows <code>minChunks</code> to control the size of the fragments.  If set to 2, any section of the same code that is used in the two fragments will be moved to a file named <code>common.bundle.js</code> .  Increasing the value allows reducing the size of the <code>common.bundle.js</code> module.  And increases the size of other fragments. <br><br>  For the server frontend build, another webpack configuration file is used: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nodeExternals = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-node-externals'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> externalFolder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">`^</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${path.resolve(__dirname, </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'../src'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">/(react|redux)/.*$`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nodeEnv = process.env.NODE_ENV || <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDevelopment = nodeEnv === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'server'</span></span>, <span class="hljs-attr"><span class="hljs-attr">devtool</span></span>: isDevelopment ? <span class="hljs-string"><span class="hljs-string">'eval'</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'./src/render.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">target</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">bail</span></span>: !isDevelopment, <span class="hljs-attr"><span class="hljs-attr">externals</span></span>: [ nodeExternals(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context, request, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request == <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.entry || externalFolder.test(path.resolve(context, request))){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'commonjs2 '</span></span> + request); } ], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'../src'</span></span>), <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'render.bundle.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">libraryTarget</span></span>: <span class="hljs-string"><span class="hljs-string">'commonjs2'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: [<span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>], <span class="hljs-attr"><span class="hljs-attr">use</span></span>: <span class="hljs-string"><span class="hljs-string">"babel-loader?retainLines=true"</span></span> }] } };</code> </pre><br>  It is much easier because  we do not need to break the server code into fragments, as well as provide support for older versions of browsers (which do not support ES2017). <br><br>  The <code>devtool: 'eval'</code> option for developer mode shows in the error message the real file and the line number of the source code. <br><br>  The function defining directories not included in the build: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> externalFolder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">`^</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${path.resolve(__dirname, </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'../src'</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">/(react|redux)/.*$`</span></span>); ... function(context, request, callback) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request == <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.entry || externalFolder.test(path.resolve(context, request))){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">'commonjs2 '</span></span> + request); }</code> </pre><br>  It is assumed that all modules except react and redux will be written taking into account the node.js capabilities and will not be converted to legacy JavaScript. <br><br>  Now consider the server code, which can work in developer mode with hot reload, and in production mode: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createServer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>).createServer; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> port = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(process.env.PORT) || <span class="hljs-number"><span class="hljs-number">3000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> api = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./src/api/routes'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> serverPath = path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'./src/render.bundle.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> render = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(serverPath); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> serverCompiler <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nodeEnv = process.env.NODE_ENV || <span class="hljs-string"><span class="hljs-string">'development'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDevelopment = nodeEnv === <span class="hljs-string"><span class="hljs-string">'development'</span></span>; app.set(<span class="hljs-string"><span class="hljs-string">'env'</span></span>, nodeEnv); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDevelopment) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); serverCompiler = webpack([<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./webpack/config.server'</span></span>)]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpackClientConfig = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./webpack/config.client'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpackClientDevMiddleware = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-dev-middleware'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpackClientHotMiddleware = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-hot-middleware'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> clientCompiler = webpack(webpackClientConfig); app.use(webpackClientDevMiddleware(clientCompiler, { <span class="hljs-attr"><span class="hljs-attr">publicPath</span></span>: webpackClientConfig.output.publicPath, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span>}, <span class="hljs-attr"><span class="hljs-attr">stats</span></span>: {<span class="hljs-attr"><span class="hljs-attr">colors</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, <span class="hljs-attr"><span class="hljs-attr">historyApiFallback</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, })); app.use(webpackClientHotMiddleware(clientCompiler, { <span class="hljs-attr"><span class="hljs-attr">log</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/__webpack_hmr'</span></span>, <span class="hljs-attr"><span class="hljs-attr">heartbeat</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span> })); app.use(<span class="hljs-string"><span class="hljs-string">'/static'</span></span>, express.static(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)); app.use(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, api); app.use(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, (req, res, next) =&gt; render(req, res, next)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { app.use(<span class="hljs-string"><span class="hljs-string">'/static'</span></span>, express.static(<span class="hljs-string"><span class="hljs-string">'dist'</span></span>)); app.use(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, api); app.use(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, render); } app.listen(port, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Listening at </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${port}</span></span></span><span class="hljs-string">`</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDevelopment) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> clearCache = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cacheIds = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.cache); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> cacheIds) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id === serverPath) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.cache[id]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> watch = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> compilerOptions = { <span class="hljs-attr"><span class="hljs-attr">aggregateTimeout</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">poll</span></span>: <span class="hljs-number"><span class="hljs-number">150</span></span>, }; serverCompiler.watch(compilerOptions, onServerChange); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onServerChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, stats</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err || stats.compilation &amp;&amp; stats.compilation.errors &amp;&amp; stats.compilation.errors.length) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server bundling error:'</span></span>, err || stats.compilation.errors); } clearCache(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { render = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(serverPath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ex) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Error detecded'</span></span>, ex) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } watch(); }</code> </pre><br>  If with the listeners of the change in the client part of the frontend everything is clear and well described in the documentation, then with the server-side rendering I found the solution <a href="http://www.reactjunkie.com/universal-hot-reload/">in the article</a> and simplified it a bit.  The point is that in the developer mode, the rendering function turns into another function, which always calls the most current version of the rendering function.  In this case, after the compiler detects changes in the source files, the require cache is cleared and the compiled module is reloaded: <br><br><pre> <code class="javascript hljs"> clearCache(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { render = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(serverPath); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ex) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Error detecded'</span></span>, ex) }</code> </pre><br>  Now, when changing the source text of the components, both the server and client side of the code will be compiled, after which the component in the browser will reload.  In parallel, the server rendering code of the component will be reloaded. <br><br>  As often happens, the work done rested on an unforeseen moment.  Code splitting is good.  But how does an asynchronous loadable component behave in real life?  Alas, all the routing and rendering code of React.js is synchronous, and the preloader is displayed at the time of the first component load (it can be made custom).  But for this, did I start everything?  Yet the solution was found.  Based on the standard Link component, you can create an asynchronous AsyncLink component: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"prop-types"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> invariant <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"invariant"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Link, matchPath } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./routes'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isModifiedEvent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function"> =&gt;</span></span> !!<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event.metaKey || event.altKey || event.ctrlKey || event.shiftKey</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">class</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AsyncLink</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">extends</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Link</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">handleClick</span></span></span><span class="hljs-function"> = (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.onClick) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.onClick(event); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !event.defaultPrevented &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// onClick prevented default event.button === 0 &amp;&amp; // ignore everything but left clicks !this.props.target &amp;&amp; // let browser handle "target=_blank" etc. !isModifiedEvent(event) // ignore clicks with modifier keys ) { event.preventDefault(); const { history } = this.context.router; const { replace, to } = this.props; function locate() { if (replace) { history.replace(to); } else { history.push(to); } } if (this.context.router.history.location.pathname) { const route = routes.find((route) =&gt; matchPath(this.props.to, route) ? route : null); if (route) { import(`${String('./' + route.componentName)}`).then(function() {locate();}) } else { locate(); } } else { locate(); } } }; } export default AsyncLink;</span></span></code> </pre><br>  In general, everything is quite smooth after that began to work. <br>  <a href="https://github.com/apapacy/uni-react">https://github.com/apapacy/uni-react</a> <br><br>  apapacy@gmail.com <br>  February 14, 2018 </div><p>Source: <a href="https://habr.com/ru/post/349136/">https://habr.com/ru/post/349136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349124/index.html">Shadow ban and what it eats - part two</a></li>
<li><a href="../349126/index.html">From vague ideas to sponsored R & D: a guide to an uncertain start-up</a></li>
<li><a href="../349128/index.html">Monitor communication channels via Juniper RPM and Zabbix</a></li>
<li><a href="../349130/index.html">How we helped digitize the age-old history of weather observations in Brazil</a></li>
<li><a href="../349134/index.html">Rust: We get acquainted with the language on the example of "Guess-ki"</a></li>
<li><a href="../349138/index.html">Comparison: Docker swarm, Kubernetes, Rancher and D2C</a></li>
<li><a href="../349140/index.html">Ramda Thinking: Partial Application (Currying)</a></li>
<li><a href="../349144/index.html">TOP-10. Analysis of the best reports in the public domain. Heisenbug 2017 Moscow</a></li>
<li><a href="../349146/index.html">Configuring Zones on Solaris 11.3</a></li>
<li><a href="../349148/index.html">Answers to common questions about the render prop template</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>