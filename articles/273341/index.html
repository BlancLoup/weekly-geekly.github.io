<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to choose a programming language?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is exactly the question that the Mail.Ru Mail team asked before writing the next service. The main purpose of this choice is the high efficiency ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to choose a programming language?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/cfc/193/a51/cfc193a5171e494a9eb32230201204b2.jpg"><br><br>  This is exactly the question that the Mail.Ru Mail team asked before writing the next service.  The main purpose of this choice is the high efficiency of the development process within the framework of the chosen language / technology.  What influences this indicator? <br><ul><li>  Performance; </li><li>  Availability of debugging and profiling tools; </li><li>  A large community that allows you to quickly find answers to questions; </li><li>  The presence of stable libraries and modules necessary for the development of web applications; </li><li>  The number of developers on the market; </li><li>  The possibility of development in modern IDE; </li><li>  The threshold of entry into the language. </li></ul><br>  In addition, the developers welcomed the laconic and expressive language.  Conciseness, of course, also affects the effectiveness of the development, as the lack of kilogram weights on the probability of success of a marathon runner. <br><a name="habracut"></a><br><h1>  Initial data </h1><br><h3>  Challengers </h3><br>  Since many server microtasks are often born in the client side of the mail, the first applicant is, of course, <a href="http://nodejs.org/">Node.js</a> with its native JavaScript and <a href="https://developers.google.com/v8">V8</a> from Google. <br><br>  After discussion and on the basis of preferences within the team, the remaining participants of the competition were identified: <a href="http://www.scala-lang.org/">Scala</a> , <a href="https://golang.org/">Go</a> and <a href="https://www.rust-lang.org/">Rust</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a performance test, it was proposed to write a simple HTTP server that receives HTML from the general template service and gives it to the client.  Such a task is dictated by the current realities of the work of the mail - all template-based client-side occurs on V8 using the <a href="https://github.com/mailru/fest">fest</a> template engine. <br><br>  When testing, it turned out that all applicants work with approximately the same performance in this formulation - it was all about V8 performance.  However, the implementation of the task was not superfluous - the development in each of the languages ‚Äã‚Äãmade it possible to make up a significant part of the subjective assessments, which in one way or another could affect the final choice. <br><br>  So, we have two scenarios.  The first is just the root URL greeting: <br><pre><code class="html hljs xml">GET / HTTP/1.1 Host: service.host HTTP/1.1 200 OK Hello World!</code> </pre> <br>  The second is a customer greeting by his name, passed in the URL path: <br><pre> <code class="html hljs xml">GET /greeting/user HTTP/1.1 Host: service.host HTTP/1.1 200 OK Hello, user</code> </pre><br><h3>  Environment </h3><br>  All tests were conducted on a VirtualBox virtual machine. <br><br>  Host MacBook Pro: <br><ul><li>  2.6 GHz Intel Core i5 (dual core); </li><li>  CPU Cache L1: 32 KB, L2: 256 KB, L3: 3 MB; </li><li>  8 GB 1600 MHz DDR3. </li></ul><br>  VM: <br><ul><li>  4 GB RAM; </li><li>  VT-x / AMD-v, PAE / NX, KVM. </li></ul><br>  Software: <br><ul><li>  CentOS 6.7 64bit; </li><li>  Go 1.5.1; </li><li>  Rustc 1.4.0; </li><li>  Scala 2.11.7, sbt 0.13.9; </li><li>  Java 1.8.0_65; </li><li>  Node 5.1.1; </li><li>  Node 0.12.7; </li><li>  nginx 1.8.0; </li><li>  wrk 4.0.0. </li></ul><br>  In addition to standard modules, in examples on Rust <a href="http://hyper.rs/">hyper was</a> used, on Scala - <a href="http://spray.io/">spray</a> .  In Go and Node.js, only native packages / modules were used. <br><br><h1>  Measurement tools </h1><br>  The performance of the services was tested using the following tools: <br><ul><li>  <a href="https://github.com/wg/wrk">wrk</a> ; </li><li>  <a href="httpd.apache.org/docs/2.2/programs/ab.html">ab</a> ; </li><li>  <a href="http://jmeter.apache.org/">JMeter</a> ; </li><li>  <a href="https://github.com/rakyll/boom">boom</a> . </li></ul><br>  This article discusses the benchmarks wrk and ab. <br><br><h1>  results </h1><br><h3>  Performance </h3><br>  <b>wrk</b> <br><br>  The following is the data of the five-minute test, with 1000 connections and 50 threads: <br> <code><a href="http://service.host/"></a> wrk -d300s -c1000 -t50 --timeout 2s service.host <br></code> <br><table><tbody><tr><th>  Label </th><th>  Average Latency, ms </th><th>  Request, # / sec </th></tr><tr><td>  Go </td><td>  104.83 </td><td>  36,191.37 </td></tr><tr><td>  Rusty </td><td>  0.02906 </td><td>  32,564.13 </td></tr><tr><td>  Scala </td><td>  57.74 </td><td>  17,182.40 </td></tr><tr><td>  Node 5.1.1 </td><td>  69,37 </td><td>  14 005.12 </td></tr><tr><td>  Node 0.12.7 </td><td>  86.68 </td><td>  11,125.37 </td></tr></tbody></table><br> <code><a href="http://service.host/greeting/hello"></a> wrk -d300s -c1000 -t50 --timeout 2s service.host/greeting/hello <br></code> <br><table><tbody><tr><th>  Label </th><th>  Average Latency, ms </th><th>  Request, # / sec </th></tr><tr><td>  Go </td><td>  105.62 </td><td>  33,196.64 </td></tr><tr><td>  Rusty </td><td>  0.03207 </td><td>  29 623.02 </td></tr><tr><td>  Scala </td><td>  55,8 </td><td>  17 531.83 </td></tr><tr><td>  Node 5.1.1 </td><td>  71.29 </td><td>  13 620.48 </td></tr><tr><td>  Node 0.12.7 </td><td>  90.29 </td><td>  10,681.11 </td></tr></tbody></table><br>  So good looking, but, unfortunately, implausible figures in the results of Average Latency for Rust indicate one feature that is present in the hyper module.  The thing is that the -c parameter in wrk indicates the number of connections that wrk will open on each thread and will not close, i.e. keep-alive connections.  Hyper doesn‚Äôt work with keep-alive, <a href="https://github.com/hyperium/hyper/issues/368">one</a> or <a href="https://github.com/hyperium/hyper/issues/601">two</a> . <br><br>  Moreover, if you display the distribution of requests on threads sent by wrk through a Lua script, we will see that only one thread sends all requests. <br><br>  For those interested in Rust, it is also worth noting that these features led to <a href="https://github.com/hyperium/hyper/issues/395">this</a> . <br><br>  Therefore, in order for the test to be reliable, it was decided to conduct a similar test by placing in front of the nginx service, which will keep connections with wrk and proxy them to the required service: <br><pre> <code class="html hljs xml">upstream u_go { server 127.0.0.1:4002; keepalive 1000; } server { listen 80; server_name go; access_log off; tcp_nopush on; tcp_nodelay on; keepalive_timeout 300; keepalive_requests 10000; gzip off; gzip_vary off; location / { proxy_pass http://u_go; } }</code> </pre><br> <code><a href="http://nginx.host/service"></a> wrk -d300s -c1000 -t50 --timeout 2s nginx.host/service <br></code> <br><table><tbody><tr><th>  Label </th><th>  Average Latency, ms </th><th>  Request, # / sec </th></tr><tr><td>  Rusty </td><td>  155.36 </td><td>  9,196.32 </td></tr><tr><td>  Go </td><td>  145.24 </td><td>  7,333.06 </td></tr><tr><td>  Scala </td><td>  233.69 </td><td>  2 513.95 </td></tr><tr><td>  Node 5.1.1 </td><td>  207.82 </td><td>  2 422.44 </td></tr><tr><td>  Node 0.12.7 </td><td>  209.5 </td><td>  2,410.54 </td></tr></tbody></table><br> <code><a href="http://nginx.host/service/greeting/hello"></a> wrk -d300s -c1000 -t50 --timeout 2s nginx.host/service/greeting/hello <br></code> <br><table><tbody><tr><th>  Label </th><th>  Average Latency, ms </th><th>  Request, # / sec </th></tr><tr><td>  Rusty </td><td>  154.95 </td><td>  9 039,73 </td></tr><tr><td>  Go </td><td>  147.87 </td><td>  7,427.47 </td></tr><tr><td>  Node 5.1.1 </td><td>  199.17 </td><td>  2,470.53 </td></tr><tr><td>  Node 0.12.7 </td><td>  177.34 </td><td>  2,363.39 </td></tr><tr><td>  Scala </td><td>  262.19 </td><td>  2 218.22 </td></tr></tbody></table><br>  As can be seen from the results, overhead with nginx is significant, but in our case we are interested in the performance of services that are on equal footing, regardless of the delay in nginx. <br><br>  <b>ab</b> <br><br>  The Apache ab utility, unlike wrk, does not keep keep-alive connections, so nginx is not useful to us here.  Let's try to fulfill 50,000 requests in 10 seconds, with 256 possible parallel requests. <br> <code><a href="http://service.host/"></a> ab -n50000 -c256 -t10 service.host <br></code> <br><table><tbody><tr><th>  Label </th><th>  Completed requests, # </th><th>  Time per request, ms </th><th>  Request, # / sec </th></tr><tr><td>  Go </td><td>  50 000.00 </td><td>  22.04 </td><td>  11,616.03 </td></tr><tr><td>  Rusty </td><td>  32,730.00 </td><td>  78.22 </td><td>  3 272.98 </td></tr><tr><td>  Node 5.1.1 </td><td>  30,069.00 </td><td>  85.14 </td><td>  3,006.82 </td></tr><tr><td>  Node 0.12.7 </td><td>  27 103.00 </td><td>  94.46 </td><td>  2 710.22 </td></tr><tr><td>  Scala </td><td>  16 691.00 </td><td>  153.74 </td><td>  1 665,17 </td></tr></tbody></table><br> <code><a href="http://service.host/greeting/hello"></a> ab -n50000 -c256 -t10 service.host/greeting/hello <br></code> <br><table><tbody><tr><th>  Label </th><th>  Completed requests, # </th><th>  Time per request, ms </th><th>  Request, # / sec </th></tr><tr><td>  Go </td><td>  50 000.00 </td><td>  21.88 </td><td>  11,697.82 </td></tr><tr><td>  Rusty </td><td>  49 878.00 </td><td>  51.42 </td><td>  4,978.66 </td></tr><tr><td>  Node 5.1.1 </td><td>  30 333.00 </td><td>  84.40 </td><td>  3 033.29 </td></tr><tr><td>  Node 0.12.7 </td><td>  27 610.00 </td><td>  92.72 </td><td>  2 760,99 </td></tr><tr><td>  Scala </td><td>  27 178.00 </td><td>  94.34 </td><td>  2 713.59 </td></tr></tbody></table><br>  It should be noted that Scala-application is characterized by some ‚Äúwarm-up‚Äù due to possible JVM optimizations that occur during the operation of the application. <br><br>  As you can see, without nginx, hyper in Rust still does not do well even without keep-alive connections.  And the only one who managed to process 50,000 requests in 10 seconds was Go. <br><br><h1>  Source </h1><br><div class="spoiler">  <b class="spoiler_title">Node.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cluster = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cluster'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> numCPUs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'os'</span></span>).cpus().length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"http"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> debug = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"debug"</span></span>)(<span class="hljs-string"><span class="hljs-string">"lite"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> workers = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> server; cluster.on(<span class="hljs-string"><span class="hljs-string">'fork'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">worker</span></span></span><span class="hljs-function">) </span></span>{ workers.push(worker); worker.on(<span class="hljs-string"><span class="hljs-string">'online'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ debug(<span class="hljs-string"><span class="hljs-string">"worker %d is online!"</span></span>, worker.process.pid); }); worker.on(<span class="hljs-string"><span class="hljs-string">'exit'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code, signal</span></span></span><span class="hljs-function">) </span></span>{ debug(<span class="hljs-string"><span class="hljs-string">"worker %d died"</span></span>, worker.process.pid); }); worker.on(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ debug(<span class="hljs-string"><span class="hljs-string">"worker %d error: %s"</span></span>, worker.process.pid, err); }); worker.on(<span class="hljs-string"><span class="hljs-string">'disconnect'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ workers.splice(workers.indexOf(worker), <span class="hljs-number"><span class="hljs-number">1</span></span>); debug(<span class="hljs-string"><span class="hljs-string">"worker %d disconnected"</span></span>, worker.process.pid); }); }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cluster.isMaster) { debug(<span class="hljs-string"><span class="hljs-string">"Starting pure node.js cluster"</span></span>); [<span class="hljs-string"><span class="hljs-string">'SIGINT'</span></span>, <span class="hljs-string"><span class="hljs-string">'SIGTERM'</span></span>].forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">signal</span></span></span><span class="hljs-function">) </span></span>{ process.on(signal, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ debug(<span class="hljs-string"><span class="hljs-string">"master got signal %s"</span></span>, signal); process.exit(<span class="hljs-number"><span class="hljs-number">1</span></span>); }); }); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numCPUs; i++) { cluster.fork(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { server = http.createServer(); server.on(<span class="hljs-string"><span class="hljs-string">'listening'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ debug(<span class="hljs-string"><span class="hljs-string">"Listening %o"</span></span>, server._connectionKey); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingRe = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">"^\/greeting\/([az]+)$"</span></span>, <span class="hljs-string"><span class="hljs-string">"i"</span></span>); server.on(<span class="hljs-string"><span class="hljs-string">'request'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> match; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (req.url) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span>: { res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.statusMessage = <span class="hljs-string"><span class="hljs-string">'OK'</span></span>; res.write(<span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { match = greetingRe.exec(req.url); res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.statusMessage = <span class="hljs-string"><span class="hljs-string">'OK'</span></span>; res.write(<span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + match[<span class="hljs-number"><span class="hljs-number">1</span></span>]); } } res.end(); }); server.listen(<span class="hljs-number"><span class="hljs-number">8080</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>); }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Go</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"regexp"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { reg := regexp.MustCompile(<span class="hljs-string"><span class="hljs-string">"^/greeting/([az]+)$"</span></span>) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> r.URL.Path { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"/"</span></span>: fmt.Fprint(w, <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"Hello, %s"</span></span>, reg.FindStringSubmatch(r.URL.Path)[<span class="hljs-number"><span class="hljs-number">1</span></span>]) } })) }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Rusty</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> hyper; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> regex; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::io::Write; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> regex::{Regex, Captures}; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> hyper::Server; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> hyper::server::{Request, Response}; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> hyper::net::Fresh; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> hyper::uri::RequestUri::{AbsolutePath}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span></span>(req: Request, res: Response&lt;Fresh&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> greeting_re = Regex::new(<span class="hljs-string"><span class="hljs-string">r"^/greeting/([az]+)$"</span></span>).unwrap(); <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> req.uri { AbsolutePath(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> path) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> (&amp;req.method, &amp;path[..]) { (&amp;hyper::Get, <span class="hljs-string"><span class="hljs-string">"/"</span></span>) =&gt; { hello(&amp;req, res); }, _ =&gt; { greet(&amp;req, res, greeting_re.captures(path).unwrap()); } }, _ =&gt; { not_found(&amp;req, res); } }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span></span>(_: &amp;Request, res: Response&lt;Fresh&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> r = res.start().unwrap(); r.write_all(<span class="hljs-string"><span class="hljs-string">b"Hello World!"</span></span>).unwrap(); r.end().unwrap(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greet</span></span></span></span>(_: &amp;Request, res: Response&lt;Fresh&gt;, cap: Captures) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> r = res.start().unwrap(); r.write_all(<span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello, {}"</span></span>, cap.at(<span class="hljs-number"><span class="hljs-number">1</span></span>).unwrap()).as_bytes()).unwrap(); r.end().unwrap(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not_found</span></span></span></span>(_: &amp;Request, <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> res: Response&lt;Fresh&gt;) { *res.status_mut() = hyper::NotFound; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> r = res.start().unwrap(); r.write_all(<span class="hljs-string"><span class="hljs-string">b"Not Found\n"</span></span>).unwrap(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _ = Server::http(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8080"</span></span>).unwrap().handle(handler); }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> lite <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> akka.actor.{<span class="hljs-type"><span class="hljs-type">ActorSystem</span></span>, <span class="hljs-type"><span class="hljs-type">Props</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> akka.io.<span class="hljs-type"><span class="hljs-type">IO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spray.can.<span class="hljs-type"><span class="hljs-type">Http</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> akka.pattern.ask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> akka.util.<span class="hljs-type"><span class="hljs-type">Timeout</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.concurrent.duration._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> akka.actor.<span class="hljs-type"><span class="hljs-type">Actor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spray.routing._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> spray.http._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">MediaTypes</span></span>._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json4s.<span class="hljs-type"><span class="hljs-type">JsonAST</span></span>._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Boot</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> system = <span class="hljs-type"><span class="hljs-type">ActorSystem</span></span>(<span class="hljs-string"><span class="hljs-string">"on-spray-can"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> service = system.actorOf(<span class="hljs-type"><span class="hljs-type">Props</span></span>[<span class="hljs-type"><span class="hljs-type">LiteActor</span></span>], <span class="hljs-string"><span class="hljs-string">"demo-service"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeout = <span class="hljs-type"><span class="hljs-type">Timeout</span></span>(<span class="hljs-number"><span class="hljs-number">5.</span></span>seconds) <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-type"><span class="hljs-type">Http</span></span>) ? <span class="hljs-type"><span class="hljs-type">Http</span></span>.<span class="hljs-type"><span class="hljs-type">Bind</span></span>(service, interface = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, port = <span class="hljs-number"><span class="hljs-number">8080</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LiteActor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LiteService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actorRefFactory</span></span></span><span class="hljs-function"> </span></span>= context <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">receive</span></span></span><span class="hljs-function"> </span></span>= runRoute(route) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LiteService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> route = path(<span class="hljs-string"><span class="hljs-string">"greeting"</span></span> / <span class="hljs-type"><span class="hljs-type">Segment</span></span>) { user =&gt; get { respondWithMediaType(`text/html`) { complete(<span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + user) } } } ~ path(<span class="hljs-string"><span class="hljs-string">""</span></span>) { get { respondWithMediaType(`text/html`) { complete(<span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span>) } } } }</code> </pre></div></div><br><br><h1>  Generalization </h1><br>  We present the success criteria defined in the beginning of the article in the form of a table.  All applicants have debugging and profiling facilities, so there are no corresponding columns in the table. <br><br><table><tbody><tr><th>  Label </th><th>  Performance Rate <sup>0</sup> </th><th>  Community size <sup>1</sup> </th><th>  Packages count </th><th>  IDE Support </th><th>  Developers <sup>5</sup> </th></tr><tr><td>  Go </td><td>  100.00% </td><td>  <a href="http://stackoverflow.com/search%3Fq%3Dgo">12,759</a> </td><td>  104 383 <sup>2</sup> </td><td>  <a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins">+</a> </td><td>  <a href="http://hh.ru/search/resume%3Ftext%3Dgo%252C%2Bgolang%26logic%3Dany%26pos%3Dfull_text%26exp_period%3Dall_time%26order_by%3Drelevance%26specialization%3D1.221%26area%3D1%26clusters%3Dtrue">315</a> </td></tr><tr><td>  Rusty </td><td>  89.23% </td><td>  <a href="http://stackoverflow.com/search%3Fq%3Drust">3 391</a> </td><td>  3,582 </td><td>  <a href="https://www.rust-lang.org/ides.html">+</a> <sup>4</sup> </td><td>  <a href="http://hh.ru/search/resume%3Ftext%3Drust%26logic%3Dany%26pos%3Dfull_text%26exp_period%3Dall_time%26order_by%3Drelevance%26specialization%3D1.221%26area%3D1%26clusters%3Dtrue">21</a> </td></tr><tr><td>  Scala </td><td>  52.81% </td><td>  <a href="http://stackoverflow.com/search%3Fq%3Dscala">44,844</a> </td><td>  172 593 <sup>3</sup> </td><td>  + </td><td>  <a href="http://hh.ru/search/resume%3Ftext%3Dscala%26logic%3Dany%26pos%3Dfull_text%26exp_period%3Dall_time%26order_by%3Drelevance%26specialization%3D1.221%26area%3D1%26clusters%3Dtrue">407</a> </td></tr><tr><td>  Node 5.1.1 </td><td>  41.03% </td><td>  <a href="http://stackoverflow.com/search%3Fq%3Dnode.js">102 328</a> </td><td>  215,916 </td><td>  + </td><td>  <a href="http://hh.ru/search/resume%3Ftext%3Dnode.js%26logic%3Dany%26pos%3Dfull_text%26exp_period%3Dall_time%26order_by%3Drelevance%26specialization%3D1.221%26area%3D1%26clusters%3Dtrue">654</a> </td></tr><tr><td>  Node 0.12.7 </td><td>  32.18% </td><td>  <a href="http://stackoverflow.com/search%3Fq%3Dnode.js">102 328</a> </td><td>  215,916 </td><td>  + </td><td>  <a href="http://hh.ru/search/resume%3Ftext%3Dnode.js%26logic%3Dany%26pos%3Dfull_text%26exp_period%3Dall_time%26order_by%3Drelevance%26specialization%3D1.221%26area%3D1%26clusters%3Dtrue">654</a> </td></tr></tbody></table><br>  <sup>0</sup> Performance was calculated based on the five-minute wrk tests without nginx, using the RPS parameter. <br>  <sup>1 The</sup> size of the community was estimated on an indirect basis - the number of questions with the corresponding tag on <a href="http://stackoverflow.com/search%3Fq%3Dphp">StackOverflow</a> . <br>  <sup>2 The</sup> number of packages indexed by <a href="https://godoc.org/">godoc.org</a> . <br>  <sup>3</sup> Very roughly - search by languages ‚Äã‚ÄãJava, Scala on <a href="https://github.com/">github.com</a> . <br>  <sup>4</sup> Under many favorite Idea plug-in is still not. <br>  <sup>5</sup> According to <a href="http://hh.ru/">hh.ru.</a> <br><br>  Obviously, such graphs of the <a href="http://data.stackexchange.com/stackoverflow/query/409175/posts-with-tag-by-day">number of questions per tag per day</a> can speak about the size of the community: <br><br>  <b>Go</b> <br><br><img src="https://habrastorage.org/files/512/d40/536/512d405365c143efb9efaaaf39442227.png"><br><br>  <b>Rusty</b> <br><br><img src="https://habrastorage.org/files/e44/943/c48/e44943c4820546df8e9878f7e8d89672.png"><br><br>  <b>Scala</b> <br><br><img src="https://habrastorage.org/files/cf9/e49/bb3/cf9e49bb38a54d878d130a4ba64443dd.png"><br><br>  <b>Node.js</b> <br><br><img src="https://habrastorage.org/files/3cb/515/1d1/3cb5151d1ac34c7f81e2fe9eba15c984.png"><br><br>  <b>For comparison, PHP:</b> <br><br><img src="https://habrastorage.org/files/93f/bcc/66a/93fbcc66ab8546d8bd449782bc5db7b2.png"><br><br><h1>  findings </h1><br>  Understanding that benchmarks of performance is a rather shaky and ungrateful thing, it is difficult to draw any definite conclusions based only on such tests.  Of course, everything is dictated by the type of task that needs to be addressed, the requirements for the program indicators and other environmental nuances. <br><br>  In our case, on the basis of the criteria defined above and, in one way or another, subjective views, we chose Go. <br><br>  The content of subjective assessments was deliberately omitted in this article in order not to make another round and not to provoke holivar.  Moreover, if such estimates were not taken into account, then according to the criteria mentioned above, the result would remain the same. <br><br><img align="right" width="64" height="64" src="https://habrastorage.org/files/ccf/040/6f5/ccf0406f5cf04e49a51a50480f0b561a.png"></div><p>Source: <a href="https://habr.com/ru/post/273341/">https://habr.com/ru/post/273341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273331/index.html">Comparative analysis of C # and C ++ languages</a></li>
<li><a href="../273333/index.html">As I have been rewriting my cryptocurrency with PHP for Go for 8 months. Part 2</a></li>
<li><a href="../273335/index.html">Lectures Technopark. Master class "20 mistakes in creating an IT-company"</a></li>
<li><a href="../273337/index.html">Detection of insider trading: Algorithms for identifying and patterns of illegal transactions</a></li>
<li><a href="../273339/index.html">Windows 10 Digest. November-December 2015</a></li>
<li><a href="../273345/index.html">ScaleIO Testing Experience</a></li>
<li><a href="../273349/index.html">On the complexity of growing sakura: how I participated in Ludum Dare 34</a></li>
<li><a href="../273351/index.html">Recipe for systemd: forced restart of the service on the file flag</a></li>
<li><a href="../273353/index.html">How to draw graphs and charts in Atlassian Confluence</a></li>
<li><a href="../273357/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 25. Hostile Takeover</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>