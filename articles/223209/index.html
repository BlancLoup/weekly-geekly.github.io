<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby 2.1 in detail (Part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Refinements 
 Refinements (refinements) are no longer an experimental feature and do not display a worning, and several details have been added to the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby 2.1 in detail (Part 2)</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/ccd/b8f/bab/ccdb8fbabd2b13bae6145fa4da9c7ac2.png"><br><h5>  Refinements </h5><br>  Refinements (refinements) are no longer an experimental feature and do not display a worning, and several details have been added to their implementation that make their use more convenient. <br><br>  Now, the Module using method has been added to the #using method for activating file-level updates for activation within the module.  However, the use of refinements is still limited to the lexical scope, i.e.  they will not be active when the module is reopened. <br><a name="habracut"></a><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NumberQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class">(/\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">(0|-?[1-9][0-9]*)\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">z</span></span></span><span class="hljs-class">/) ? </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">using</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NumberQuery</span></span></span><span class="hljs-class"> "42".</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; true end module Example "42".number? #=&gt; #&lt;NoMethodError: undefined method `number?' for "42":String&gt; end</span></span></span></span></code> </pre> <br>  Refinement declarations are now inherited when using Module # include, i.e.  You can group refinements defined in different modules in one and activate them all, causing #using only for this module. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlankQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blank?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">respond_to?</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty?</span></span></span><span class="hljs-class">) ? </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty?</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blank?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strip</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">length</span></span></span><span class="hljs-class"> == 0 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NilClass</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">blank?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NumberQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class">(/\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">(0|-?[1-9][0-9]*)\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">z</span></span></span><span class="hljs-class">/) ? </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Numeric</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Support</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlankQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NumberQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">using</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Support</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... def points=(obj) raise "points can't be blank" if obj.blank? raise "points must be a number" unless obj.number? </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@points</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = obj end end</span></span></span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  String # scrub </h5><br>  The String # scrub method was added in Ruby 2.1 to assist in working with strings containing invalid bytes. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># create a string that can't be sensibly printed # 'latin 1' encoded string with accented character string = "√∂ops".encode("ISO-8859-1") # misrepresented as UTF-8 string.force_encoding("UTF-8") # and mixed with a UTF-8 character string = "¬°#{string}!"</span></span></code> </pre><br>  It is unlikely that you will create lines in this way consciously (at least I hope so), but this happens with lines that have passed through several different systems. <br><br>  If we only have the end result of such a ‚Äújourney‚Äù, we can no longer recover all the incorrectly encoded characters, but we can at least delete them: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># replace with 'replacement character' string.scrub #=&gt; "¬° ops!" # delete string.scrub("") #=&gt; "¬°ops!" # replace with chosen character string.scrub("?") #=&gt; "¬°?ops!" # yield to a block for custom replacement # (in this case the invalid bytes as hex) string.scrub {|bytes| "&lt;#{bytes.unpack("H*").join}&gt;"} #=&gt; "¬°&lt;f6&gt;ops!"</span></span></code> </pre><br>  The same result can be achieved by calling the #encoding method with the current encoding and invalid:: replace as arguments: <br><br><pre> <code class="ruby hljs">string.encode(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">invalid:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:replace</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; "¬° ops!" string.encode("UTF-8", invalid: :replace, replace: "?") #=&gt; "¬°?ops!"</span></span></code> </pre><br><br><h5>  Performance Improvements in Bignum / Rational Classes </h5><br>  The Bignum and Rational classes now use the GNU Multiple Precision Arithmetic Library (GMP) to improve performance. <br><br><h5>  Removed level 4 $ SAFE </h5><br>  Specifying $ SAFE = 4 should have put Ruby into sandbox mode and allowed the execution of untrusted code.  However, this was not particularly effective, since  it required a considerable amount of code scattered throughout the interpreter, and almost never was used, which was why it was eventually deleted. <br><br><pre> <code class="ruby hljs">$SAFE = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;ArgumentError: $SAFE=4 is obsolete&gt;</span></span></code> </pre><br><br><h5>  clock_gettime </h5><br>  Ruby accessed the clock_gettime () system function using the Process.clock_gettime method, which provides access to various date values.  As the first argument, the time id should be passed to the method: <br><br><pre> <code class="ruby hljs">Process.clock_gettime(Process::CLOCK_REALTIME) <span class="hljs-comment"><span class="hljs-comment">#=&gt; 1391705719.906066</span></span></code> </pre><br>  By passing Process :: CLOCK_REALTIME, you will get a Unix timestamp as the return value.  It will also correspond to Time.now.to_f, but without creating a Time object, so it will execute somewhat faster. <br><br>  Process.clock_gettime can also be used to access ‚Äúmonotonous‚Äù clocks that are independent of the translation of the system clock.  This can be used for critical time measurements or benchmarking. <br><br>  However, the value of the monotonous clock makes sense only when compared with another of the same mark: <br><br><pre> <code class="ruby hljs">start_time = Process.clock_gettime(Process::CLOCK_MONOTONIC) sleep <span class="hljs-number"><span class="hljs-number">1</span></span> Process.clock_gettime(Process::CLOCK_MONOTONIC) - start_time <span class="hljs-comment"><span class="hljs-comment">#=&gt; 1.0051147330086678</span></span></code> </pre><br>  Another value that can be used for benchmarking is CLOCK_PROCESS_CPUTIME_ID.  It works in the same way as a monotone clock, i.e.  constantly increasing, but the difference is that it only increases when the CPU does any work.  This mark also makes sense only in comparison with another similar mark. <br><br><pre> <code class="ruby hljs">start_time = Process.clock_gettime(Process::CLOCK_PROCESS_CPUTIME_ID) sleep <span class="hljs-number"><span class="hljs-number">1</span></span> Process.clock_gettime(Process::CLOCK_PROCESS_CPUTIME_ID) - start_time <span class="hljs-comment"><span class="hljs-comment">#=&gt; 0.005225999999999981</span></span></code> </pre><br>  These three clock values, real, monotonous and processor, are always available.  Depending on the system you are using, it is also possible to access other types of watches, to learn this, read the relevant <a href="http://ruby-doc.org/core-2.1.0/Process.html">documentation</a> . <br><br>  To check the availability of the availability of a particular type of watch, it is sufficient to verify that the corresponding constant is defined. <br><br><pre> <code class="ruby hljs">Process.const_defined?(<span class="hljs-symbol"><span class="hljs-symbol">:CLOCK_PROCESS_CPUTIME_ID</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; true Process.const_defined?(:CLOCK_THREAD_CPUTIME_ID) #=&gt; false</span></span></code> </pre><br>  Also available is the Process.clock_getres method, which allows you to see the resolution provided by a particular type of clock. <br><br><h5>  RubyGems Update </h5><br>  The built-in version of RubyGems has been updated to version 2.2.  <a href="http://globaldev.co.uk/2013/03/ruby-2-0-0-in-detail/">Support for Gemfile has</a> been added support for Gemfile.lock, as part of the work to <a href="https://github.com/jruby/jruby/issues/1146">support all the features of Bundler in RubyGems</a> . <br><br>  The option --file (or -g) for gem install now does not require the specification of a dependency file, it automatically detects the presence of a Gemfile.  gem install will also generate a gemfile.lock if it has not already been created, and consider the versions specified in it if it has already been created. <br><br><pre> <code class="bash hljs">$ ls Gemfile $ gem install -g Fetching: going_postal-0.1.4.gem (100%) Installing going_postal (0.1.4) $ ls Gemfile Gemfile.lock</code> </pre><br>  A complete list of changes can be found in the <a href="https://github.com/rubygems/rubygems/tree/master/History.txt">History</a> file. <br><br><h5>  Removed obsolete features Rake </h5><br>  Built-in Rake has been updated to version 10.1.0, in which many deprecated features have been removed.  In older versions of Rake, a warning about these features has long been displayed, so compatibility problems should not be. <br><br>  If you need more details, see the full list of changes in Rake versions <a href="http://rake.rubyforge.org/doc/release_notes/rake-10_0_3_rdoc.html">10.0.3</a> and <a href="http://rake.rubyforge.org/doc/release_notes/rake-10_1_0_rdoc.html">10.1.0</a> . <br><br><h5>  RDoc template update </h5><br>  Ruby now includes version 4.1 of RDoc, which contains a default template update with some improvements in access management.  A complete list of changes can be found in the <a href="">History</a> file. <br><br><h5>  Process name </h5><br>  A new Process.setproctitle method has been added that allows you to set a process name without accessing the $ 0 variable.  The Process.argv0 method was also added to get the initial value of $ 0. <br><br>  For example, you have the following background script: <br><br><pre> <code class="ruby hljs">data.each_with_index <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|datum, i|</span></span> Process.setproctitle(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{Process.argv</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string"> - job </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{i}</span></span></span><span class="hljs-string"> of </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{data.length}</span></span></span><span class="hljs-string">"</span></span>) process(datum) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  then when you run ps you will see something like the following: <br><br><pre> <code class="bash hljs">$ ps PID TTY TIME CMD 339 ttys000 0:00.23 -bash 7321 ttys000 0:00.06 background.rb - job 10 of 30</code> </pre><br><br><h5>  Frozen Symbol </h5><br>  Symbol objects now constitute a company of integers and real numbers as frozen objects. <br><br><pre> <code class="ruby hljs"><span class="hljs-symbol"><span class="hljs-symbol">:foo</span></span>.frozen? <span class="hljs-comment"><span class="hljs-comment">#=&gt; true :foo.instance_variable_set(:</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span><span class="hljs-comment">, "baz") #=&gt; #&lt;RuntimeError: can't modify frozen Symbol&gt;</span></span></code> </pre><br>  This change was made to improve garbage collection for such objects in future versions of Ruby. <br><br><h5>  Fixed scope leakage </h5><br>  When using the private, protected, public, or module_function keywords with no arguments in a string, executed using eval, instance_eval, or module_eval, the scope of the method ‚Äúflows‚Äù to the parent scope, i.e.  in the example below, the foo method will be closed: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eval</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  In version 2.1 this is fixed and foo will be open. <br><br><h5>  #untrusted?  now alias for #tainted? </h5><br>  Earlier in Ruby there were two sets of methods to mark objects as untrusted, the first consists of #tainted ?, #taint and #untaint methods, the second - #untrusted ?, #untrust and #trust.  They work in the same way, but they set different flags for objects. <br><br>  Now these methods are unified and set the same flag, and #tainted is more preferable?  and company, and when calling #untrusted?  and others. Will appear. <br><br><pre> <code class="ruby hljs">string = <span class="hljs-string"><span class="hljs-string">"foo"</span></span> string.untrust string.tainted? <span class="hljs-comment"><span class="hljs-comment">#=&gt; true</span></span></code> </pre><br>  will display a warning <br><br><pre> <code class="ruby hljs">example.<span class="hljs-symbol"><span class="hljs-symbol">rb:</span></span><span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-symbol"><span class="hljs-symbol">warning:</span></span> untrust is deprecated <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> its behavior is same as taint</code> </pre><br><br><h5>  return in lambdas </h5><br>  Lambdas are different from blocks and Proc objects in that return returns control from lambda, not from the caller.  However, there is an exception if lambda is passed with &amp; and called with yield.  Now it is fixed. <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call_with_yield</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yield</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call_with_yield</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;lambda {</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">return</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"hello from lambda"</span></span></span></span><span class="hljs-function"><span class="hljs-params">})</span></span></span></span> <span class="hljs-string"><span class="hljs-string">"hello from method"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> test <span class="hljs-comment"><span class="hljs-comment">#=&gt; "hello from method"</span></span></code> </pre><br>  The example above displays ‚Äúhello from lambda‚Äù in Ruby &lt;= 2.0.0. <br><br><h5>  Interface Addresses </h5><br>  Now you can get the details of network interfaces in the system using the Socket.getifaddrs method.  It returns an array of Socket :: Ifaddr objects. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"socket"</span></span> info = Socket.getifaddrs.find <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|ifaddr|</span></span> (ifaddr.flags &amp; Socket::IFF_BROADCAST).nonzero? &amp;&amp; ifaddr.addr.afamily == Socket::AF_INET <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> info.addr.ip_address <span class="hljs-comment"><span class="hljs-comment">#=&gt; "10.0.1.2"</span></span></code> </pre><br><br><h5>  Named group support in StringScanner </h5><br>  StringScanner # [] now accepts Symbol objects as arguments and returns the values ‚Äã‚Äãof the corresponding named groups. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"strscan"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_ini</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span></span> scanner = StringScanner.new(string) current_section = data = {} <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> scanner.eos? scanner.skip(<span class="hljs-regexp"><span class="hljs-regexp">/\s+/</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> scanner.scan(<span class="hljs-regexp"><span class="hljs-regexp">/;/</span></span>) scanner.skip_until(<span class="hljs-regexp"><span class="hljs-regexp">/[\r\n]+/</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> scanner.scan(<span class="hljs-regexp"><span class="hljs-regexp">/\[(?&lt;name&gt;[^\]]+)\]/</span></span>) current_section = current_section[scanner[<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>]] = {} <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> scanner.scan(<span class="hljs-regexp"><span class="hljs-regexp">/(?&lt;key&gt;[^=]+)=(?&lt;value&gt;.*)/</span></span>) current_section[scanner[<span class="hljs-symbol"><span class="hljs-symbol">:key</span></span>]] = scanner[<span class="hljs-symbol"><span class="hljs-symbol">:value</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br><h5>  YAML.safe_load </h5><br>  The safe_load method has been added to YAML (or more precisely in Psych, the underlying implementation).  By default, the following classes can be deserialized: TrueClass, FalseClass, NilClass, Numeric, String, Array, and Hash.  To deserialize other classes, if you are sure of their security, you need to pass them as an argument. <br><br>  If an object of an unresolved class is passed, the exception Psych :: DisallowedClass will be raised, which can also be received as YAML :: DisallowedClass. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"yaml"</span></span> YAML.safe_load(<span class="hljs-string"><span class="hljs-string">":foo: 1"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Psych::DisallowedClass: Tried to load unspecified class: Symbol&gt; YAML.safe_load(":foo: 1", [Symbol]) #=&gt; {:foo=&gt;1}</span></span></code> </pre><br><br><h5>  Support MDNS and LOC records in Resolv </h5><br>  The Resolv DNS library has received basic support for multicast DNS search.  It does not support continuous requests, and cannot perform service discovery, but still this is a very convenient innovation (for full support of DNS Service Discovery, try the <a href="http://rubygems.org/gems/dnssd">dnssd gem</a> ). <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"resolv"</span></span> resolver = Resolv::MDNS.new resolver.getaddress(<span class="hljs-string"><span class="hljs-string">"example.local"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Resolv::IPv4 10.0.1.2&gt;</span></span></code> </pre><br>  A bundle with the resolv-replace library makes it possible to use mDNS names with most of the online libraries in Ruby. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"resolv-replace"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> Resolv::DefaultResolver.replace_resolvers([Resolv::Hosts.new, Resolv::MDNS.new]) Net::HTTP.get_response(URI.parse(<span class="hljs-string"><span class="hljs-string">"http://example.local"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Net::HTTPOK 200 OK readbody=true&gt;</span></span></code> </pre><br>  Resolv also received the ability to request DNS <a href="http://en.wikipedia.org/wiki/LOC_record">LOC records</a> . <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"resolv"</span></span> dns = Resolv::DNS.new <span class="hljs-comment"><span class="hljs-comment"># find.me.uk has LOC records for all UK postcodes resource = dns.getresource("W1A1AA.find.me.uk", Resolv::DNS::Resource::IN::LOC) resource.latitude #=&gt; #&lt;Resolv::LOC::Coord 51 31 6.827 N&gt; resource.longitude #=&gt; #&lt;Resolv::LOC::Coord 0 8 37.585 W&gt;</span></span></code> </pre><br>  Finally, the last change in Resolv, you can now get complete DNS messages using the Resolv :: DNS # fetch_resource method. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"resolv"</span></span> dns = Resolv::DNS.new dns.fetch_resource(<span class="hljs-string"><span class="hljs-string">"example.com"</span></span>, Resolv::DNS::Resource::IN::A) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|reply, reply_name|</span></span> reply <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Resolv::DNS::Message:0x007f88192e2cc0 </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@id</span></span></span><span class="hljs-comment">=55405, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@qr</span></span></span><span class="hljs-comment">=1, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@opcode</span></span></span><span class="hljs-comment">=0, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@aa</span></span></span><span class="hljs-comment">=0, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@tc</span></span></span><span class="hljs-comment">=0, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@rd</span></span></span><span class="hljs-comment">=1, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ra</span></span></span><span class="hljs-comment">=1, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@rcode</span></span></span><span class="hljs-comment">=0, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@question</span></span></span><span class="hljs-comment">=[[#&lt;Resolv::DNS::Name: example.com.&gt;, Resolv::DNS::Resource::IN::A]], </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@answer</span></span></span><span class="hljs-comment">=[[#&lt;Resolv::DNS::Name: example.com.&gt;, 79148, #&lt;Resolv::DNS::Resource::IN::A:0x007f88192e1c80 </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@address</span></span></span><span class="hljs-comment">=#&lt;Resolv::IPv4 93.184.216.119&gt;, </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ttl</span></span></span><span class="hljs-comment">=79148&gt;]], </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@authority</span></span></span><span class="hljs-comment">=[], </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@additional</span></span></span><span class="hljs-comment">=[]&gt; reply_name #=&gt; #&lt;Resolv::DNS::Name: example.com.&gt; end</span></span></code> </pre><br><br><h5>  Socket class error messages </h5><br>  Socket addresses have been added to error messages. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"socket"</span></span> TCPSocket.new(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-number"><span class="hljs-number">8080</span></span>) <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Errno::ECONNREFUSED: Connection refused - connect(2) for "localhost" port 8080&gt;</span></span></code> </pre><br><br><h5>  Accelerated Hash # shift </h5><br>  The performance of Hash # shift was significantly increased, which, combined with the ordered insert that appeared in Ruby 1.9, makes it possible to implement the <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC%25D1%258B_%25D0%25BA%25D1%258D%25D1%2588%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">LRU cache</a> . <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LRUCache</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">size</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">size</span></span></span><span class="hljs-class">, @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">size</span></span></span><span class="hljs-class">, {} </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> [](</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">] = @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">delete</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> []=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">delete</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">] = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shift</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">size</span></span></span><span class="hljs-class"> &gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">size</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br><h5>  Improving the performance of the Queue, SizedQueue and ConditionVariable classes </h5><br>  The Queue, SizedQueue, and ConditionVariable classes were accelerated by implementing them in C (previously implemented in Ruby). <br><br><h5>  Interception of an internal exception in Timeout </h5><br>  Now it became impossible to catch the exceptions used inside the Timeout class to interrupt block execution.  This is an internal implementation detail, while the external exception Timeout :: Error remains unchanged and can be intercepted. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"timeout"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Timeout.timeout(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> sleep <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rescue</span></span> Exception <span class="hljs-comment"><span class="hljs-comment"># no longer swallows the timeout exception end end rescue StandardError =&gt; e e #=&gt; #&lt;Timeout::Error: execution expired&gt; end</span></span></code> </pre><br><br><h5>  The sets </h5><br>  #Intersect methods have been added to the Set class?  and #disjoint ?.  The #intersect method?  returns true if the object and argument have at least one common element and false otherwise, #disjoint?  it works the other way around. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"set"</span></span> a = Set[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>] b = Set[<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>] c = Set[<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>] a.intersect?(b) <span class="hljs-comment"><span class="hljs-comment">#=&gt; true b.intersect?(c) #=&gt; true a.intersect?(c) #=&gt; false a.disjoint?(b) #=&gt; false b.disjoint?(c) #=&gt; false a.disjoint?(c) #=&gt; true</span></span></code> </pre><br>  Another important change to Set is that the #to_set method will return the object itself, not the created copy. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"set"</span></span> set = Set[<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"baz"</span></span>] set.object_id <span class="hljs-comment"><span class="hljs-comment">#=&gt; 70286489985620 set.to_set.object_id #=&gt; 70286489985620</span></span></code> </pre><br><br><h5>  Simplify the processing of responses WEBrick </h5><br>  Now the HTTP response body from WEBrick can be assigned to any object with #read and #readpartial methods.  Previously, it could only be IO or String objects.  The example below implements a class that displays the received response every second for 10 seconds. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"webrick"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnumeratorIOAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">enum</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">enum</span></span></span><span class="hljs-class">, @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">buffer</span></span></span><span class="hljs-class">, @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">more</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">enum</span></span></span><span class="hljs-class">, "", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">read</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">length</span></span></span><span class="hljs-class">=</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">out_buffer</span></span></span><span class="hljs-class">="") </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unless</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">more</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">until</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">length</span></span></span><span class="hljs-class"> &amp;&amp; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">buffer</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">length</span></span></span><span class="hljs-class"> &gt;= </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">length</span></span></span><span class="hljs-class">) || !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fill_buffer</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> length part = @buffer.slice!(<span class="hljs-number"><span class="hljs-number">0</span></span>, length) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> part, @buffer = @buffer, <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> out_buffer.replace(part) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readpartial</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(length, out_buffer=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> raise EOFError <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> @buffer.empty? &amp;&amp; !fill_buffer out_buffer.replace(@buffer.slice!(<span class="hljs-number"><span class="hljs-number">0</span></span>, length)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> private <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill_buffer</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buffer</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&lt;&lt;</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enum</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rescue</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopIteration</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">more</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WEBrick</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTTPServer</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">Port:</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8080</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> server.mount_proc <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|request, response|</span></span> enum = Enumerator.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|yielder|</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>.times <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> sleep <span class="hljs-number"><span class="hljs-number">1</span></span> yielder &lt;&lt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{Time.now}</span></span></span><span class="hljs-string">\r\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> response.chunked = <span class="hljs-literal"><span class="hljs-literal">true</span></span> response.body = EnumeratorIOAdapter.new(enum) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> trap(<span class="hljs-symbol"><span class="hljs-symbol">:INT</span></span>) {server.shutdown} server.start</code> </pre><br><br><h5>  Numeric # step </h5><br>  The Numeric class #step method can now take the named by: and to: arguments instead of positional arguments.  The to: argument is optional; if it is not specified, the sequence will be infinite.  When using positional arguments, this can be achieved by specifying nil as the first argument. <br><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>.step(<span class="hljs-symbol"><span class="hljs-symbol">by:</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">to:</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|i|</span></span> puts i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  will lead <br><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>.step(<span class="hljs-symbol"><span class="hljs-symbol">by:</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|i|</span></span> puts i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.step(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|i|</span></span> puts i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  in both cases will derive <br><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> so on</code> </pre><br><br><h5>  Io </h5><br>  The IO # seek method now along with the constants IO :: SEEK_CUR, IO :: SEEK_END and IO :: SEEK_SET accepts Symbol: CUR,: END and: SET objects <br><br>  As a second argemnt, you can now pass IO :: SEEK_DATA and IO :: SEEK_HOLE (or: DATA and: HOLE).  When they are specified, the first argument is used as the minimum data size / empty space for the transition. <br><br><pre> <code class="ruby hljs">f = File.new(<span class="hljs-string"><span class="hljs-string">"example.txt"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># sets the offset to the start of the next data chunk at least 8 bytes long f.seek(8, IO::SEEK_DATA) # sets the offset to the start of the next empty space at least 32 bytes long f.seek(32, IO::SEEK_HOLE)</span></span></code> </pre><br>  This may not be supported on all platforms, which can be checked using IO.const_defined? (: SEEK_DATA) and IO.const_defined? (: SEEK_HOLE). <br><br><h5>  Using IO _nonblock Without Exciting Exceptions </h5><br>  The IO # read_nonblock and IO # write_nonblock methods can take a named exception argument :.  If it is set to false (true by default), methods will return the corresponding Symbol object on error instead of throwing exceptions. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"socket"</span></span> io = TCPSocket.new(<span class="hljs-string"><span class="hljs-string">"www.example.com"</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>) message = <span class="hljs-string"><span class="hljs-string">"GET / HTTP/1.1\r\nHost: www.example.com\r\nConnection: close\r\n\r\n"</span></span> loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> IO.select(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>, [io]) result = io.write_nonblock(message, <span class="hljs-symbol"><span class="hljs-symbol">exception:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> result == <span class="hljs-symbol"><span class="hljs-symbol">:wait_writeable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> response = <span class="hljs-string"><span class="hljs-string">""</span></span> loop <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> IO.select([io]) result = io.read_nonblock(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">exception:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result == <span class="hljs-symbol"><span class="hljs-symbol">:wait_readable</span></span> response &lt;&lt; result <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> puts response.lines.first</code> </pre><br><br><h5>  IO ignores internal encoding if external ASCII-8BIT </h5><br>  If you specify the default internal and external encodings, Ruby will convert from external encoding to internal.  An exception is the case when the external encoding is ASCII-8BIT, in this case no conversion takes place. <br><br>  The same exception should be made if encodings are passed to the IO method as an argument, but this was not the case and the conversion was done.  The bug has been fixed. <br><br><pre> <code class="ruby hljs">File.read(<span class="hljs-string"><span class="hljs-string">"example.txt"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">encoding:</span></span> <span class="hljs-string"><span class="hljs-string">"ascii-8bit:utf-8"</span></span>).encoding <span class="hljs-comment"><span class="hljs-comment">#=&gt; #&lt;Encoding:ASCII-8BIT&gt;</span></span></code> </pre><br><br><h5>  #include and #prepend are now open </h5><br>  The #include and #prepend methods are now open, this applies to the Module and Class classes. <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NumberQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class">(/\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">(0|-?[1-9][0-9]*)\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">z</span></span></span><span class="hljs-class">/) ? </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NumberQuery</span></span></span><span class="hljs-class">) "123".</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; true</span></span></span></span></code> </pre><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"bigdecimal"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FloatingPointFormat</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to_s</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">F</span></span></span><span class="hljs-class">") </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">super</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigDecimal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prepend</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FloatingPointFormat</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decimal</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigDecimal</span></span></span><span class="hljs-class">("1.23") </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decimal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to_s</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#=&gt; "1.23" # rather than "0.123E1"</span></span></span></span></code> </pre><br><br>  <i>In the third part there will be new methods in the Module and Object classes, changes in network classes and other updates in the standard library.</i> <br>  <a href="http://habrahabr.ru/post/222941/">The first part</a> <a href="http://habrahabr.ru/post/223521/">The third part</a> </div><p>Source: <a href="https://habr.com/ru/post/223209/">https://habr.com/ru/post/223209/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223197/index.html">Dribbble Meetup 2014 at the Mail.Ru Group office</a></li>
<li><a href="../223201/index.html">3D scanning in archeology. Personal experience, used equipment and other</a></li>
<li><a href="../223203/index.html">Useful materials for mobile developer # 53 (May 12-18)</a></li>
<li><a href="../223205/index.html">Linux Mint 17 ‚ÄúQiana‚Äù</a></li>
<li><a href="../223207/index.html">Accelerate JavaScript together (Attention, competition!)</a></li>
<li><a href="../223211/index.html">Plant with adzhika in chlorella broth or what to eat on the way to Mars</a></li>
<li><a href="../223213/index.html">Compressorheads in Moscow! Concert today and tomorrow!</a></li>
<li><a href="../223217/index.html">Hive vs Pig. Why do I have so many ETL?</a></li>
<li><a href="../223221/index.html">Google Play now supports PayPal payments.</a></li>
<li><a href="../223223/index.html">Noisli: an online background noise generator that helps concentrate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>