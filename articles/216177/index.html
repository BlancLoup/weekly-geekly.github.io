<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I did USB MFP wireless</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction  They say the child in school will need a color printer and scanner. Yes, and most wanted to change something for a collapsing black and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I did USB MFP wireless</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4>  They say the child in school will need a color printer and scanner.  Yes, and most wanted to change something for a collapsing black and white lazer 1996 release.  The selection criteria were: chromaticity, laser technology (the intervals between printing can reach months), the automatic document feeder for scanners and copiers, automatic duplex printing and Wi-Fi to put this box in the far corner.  According to these characteristics, some kind of huge object for 25+ kilorubles was selected, which seemed unreasonable.  And suddenly, at work, they gave out a couple of gift cards from a well-known pink store, and the feeling came that you should buy.  Unfortunately, his assortment contained only three laser MFPs with color printing, none of which met the last two requirements.  Two months later, the assortment was not replenished by anything, but on the contrary, it was reduced to two positions all over Moscow, and I decided to take what was available and not on the shop window. <br><br>  Lucky it turned out to be the <a href="">HP Laserjet Pro 100 Color MFP M175a</a> , without the automatic page <a href="">rotation</a> and with USB connection only.  By the way, he was not as big as I expected, and not as noisy as they say in the reviews. <br><br><h4>  Task </h4>  If automatic duplex printing is almost impossible to add to the printer, it is quite realistic to untie it from the computer. <br><a name="habracut"></a><br>  A simple but unsuitable way is to connect it to the router that distributes the Internet in the apartment and, possibly, has a USB port.  This method implies that, firstly, the MFP will have to stand in a three-meter range from the router, and secondly, the router will only allow printing, not scanning too (on factory firmware). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second way is to buy a box for $ 35 ... <img src="https://habrastorage.org/getpro/habr/post_images/971/1f3/28c/9711f328c97cd8d29ac2f160749b0329.jpg">  ... and hope that it will be able to do what is needed, and suddenly it will be compatible with Ubuntu on the client side.  The representative of the manufacturer willingly answers something unintelligible in wonderful Chinese English.  I did not hope for good luck. <br><br>  The third method, already valid, allows you to use a device connected via USB to one computer on another computer as if it is connected to the second, using at least a local network, even the Internet. <br><br><h4>  Soft </h4>  There are several implementations, but I immediately chose the one that is included in the Linux kernel in order to save myself from any possible licensing restrictions, payments, the inability to configure something and other dependencies in advance.  Called usbip. <br><br><h4>  Iron </h4>  It was possible to find an old D-Link in the closet, to hoist <a href="https://openwrt.org/">OpenWRT</a> on it, but that would be cumbersome and with a small share of their own hands, so it was decided to look for something small, omnipotent and inexpensive. <br><br><h6>  <a href="http://8devices.com/carambola">Carambola</a> </h6>  The size of a matchbox, has on board Wi-Fi, USB-host, 320 MHz MIPS-processor, consumes no more than 1.5W, OpenWRT OS, costs 22 euros. <br><br><h6>  <a href="http://www.raspberrypi.org/">Raspberry pi</a> </h6>  size 86x56, Wi-Fi will have to buy an external one and plug it into a USB, 700 MHz processor, a lot of what will not be used on the board consumes at least <a href="http://d4c027c89b30561298bd-484902fe60e1615dc83faa972a248000.r12.cf3.rackcdn.com/supporting_materials/Raspberry%2520Pi%2520Start%2520Guide.pdf">3.5W</a> ( <a href="http://d4c027c89b30561298bd-484902fe60e1615dc83faa972a248000.r12.cf3.rackcdn.com/supporting_materials/Raspberry%2520Pi%2520Start%2520Guide.pdf">700mA at 5V</a> ), Linux costs 35 USD to choose from. <br><br><h6>  <a href="https://www.olimex.com/Products/OLinuXino/A13/A13-OLinuXino-WIFI/open-source-hardware">A13-OLinuXino-WIFI</a> </h6>  size 120x120, 1 GHz ARM-processor, rich peripherals, Linux OS, consumes 4.2W ( <a href="http://www.mouser.com/pdfdocs/Olimex_A13OLINUXINO_user_guide.pdf">350mA at 12V</a> ), costs 55 euros. <br><br><h6>  <a href="http://cubieboard.org/">Cubieboard</a> and its Chinese counterparts </h6>  Similar to the previous version. <br><br><h6>  <a href="http://pcengines.ch/alix.htm">ALIX by PC Engines</a> </h6>  My long-time favorite, the size is 100x160 or 152x152,500 MHz. The i386 processor, without built-in Wi-Fi, almost any OS consumes 5W, costs from 64 to 78 euros. <br><br>  As a result, according to the size-energy consumption-cost criteria, taking into account the sufficiency of functions, the first option was chosen - Carambola. <br><br><h4>  Process </h4>  Since it was planned to connect only USB and power, there was no need for a development board and case, only the module itself was ordered. <br><img src="https://habrastorage.org/getpro/habr/post_images/87c/b8e/54b/87cb8e54b336383331c9b5fed5bd5371.jpg"><br>  The console is detected on the TXD2-RXD2, 115000 8N1. <br>  For USB to work in host mode, pin 21 must be connected to 5V (the module itself only works at 3.3V), and pin 40 must be connected to GND.  White wire (D +) to pin 39, green (D-) - to 38. <br>  The manufacturer reported that the data lines of the USB cable can be connected to the module directly, the Internet prompted that in this case it is better not to use the hot plug, that is, connect-disconnect USB devices with the module de-energized.  It suits me - I'm going to connect the MFP once and for all. <br>  OpenWRT was preinstalled with one of the long-standing Bleeding Edge, I immediately updated it to a stable <a href="">12.09 Attitude Adjustment</a> via the web interface. <br>  Then, the usbip package was installed in OpenWRT, which pulled the necessary kernel modules and utilities behind it.  It remains to add a couple of lines in autoload: <br><pre><code class="hljs pgsql">/usr/sbin/usbipd -D /usr/sbin/usbip bind <span class="hljs-comment"><span class="hljs-comment">--busid=1-1</span></span></code> </pre>  ‚Äú1-1‚Äù I took from the output of the list of connected USB devices in the OpenWRT console: <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">usbip</span></span> list -l</code> </pre> <br>  On the client side of Ubuntu 13.10.  Kernel modules are present in the system, to automatically boot them you need (usbip_core, vhci_hcd) to add to <code>/etc/modules</code> <br>  Userspace utilities, however, are missing.  You should not install them from repositories, there is version 0.1.7-3, there will be no work with version 1.1.1 on OpenWRT.  You can do this as follows: <pre> <code class="hljs sql">sudo apt-get <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> linux-sources tar -jxf /usr/src/linux-<span class="hljs-keyword"><span class="hljs-keyword">source</span></span><span class="hljs-number"><span class="hljs-number">-3.11</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/linux-<span class="hljs-keyword"><span class="hljs-keyword">source</span></span><span class="hljs-number"><span class="hljs-number">-3.11</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.tar.bz2 cd drivers/staging/usbip/userspace/ ./autogen.sh ./configure make sudo make <span class="hljs-keyword"><span class="hljs-keyword">install</span></span></code> </pre>  Now, to connect the MFP, I just need to run <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> usbip attach --remote=<span class="hljs-number"><span class="hljs-number">192.168.2.16</span></span> --busid=<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><h4>  disadvantages </h4>  The main disadvantage is that the connection between the usbip server and the usbip client is a one-to-one connection, that is, if one client has connected a USB device to the server, others can no longer connect it until it is disconnected first.  For such a case, you can tense up and write a usbip management page in the OpenWRT web interface, but for now it does not threaten me, the MFP will be used only from one workplace. <br>  Another disadvantage is that, theoretically, the speed of the link via Wi-Fi is less than the USB cable, but in my particular case, the scan data is slower through the cable, but this is probably my local problem. <br><br><h4>  Future plans </h4>  Now the module is powered by a 12V to 5V and 3.3V DC converter: <br><img src="https://habrastorage.org/getpro/habr/post_images/139/b4e/d43/139b4ed4325b1bf970f0d5e2b139f255.jpg"><br>  He is bulky and would take a separate matchbox himself.  It is being replaced by a DC-converter 5V to 3.3V from China, like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/e87/346/8f7/e873468f7053a655af2cda3fe3d37b50.jpg"><br>  He is quite a baby and will fit in one matchbox with Carambola (without pins).  All this will be powered by an old phone charger. <br>  The ultimate dream is to place this box inside the MFP housing, suddenly there will be a spot there, but find inside it a 5V source, or at least another place under the converter with AC 220V.  But this I decide only after the end of the warranty repair. <br><br><h4>  Development and Testing: </h4><img src="https://habrastorage.org/getpro/habr/post_images/283/109/c30/283109c30450a6eec42096a656216d59.jpg"><br>  (The colors of the power wiring are arbitrary) <br><br><h4>  Result </h4>  Two days after writing the topic, the voltage converter arrived from China more quickly than ever (in a couple of weeks instead of the usual four or five), now the project is completed: <img src="https://habrastorage.org/getpro/habr/post_images/843/189/fff/843189fff4bc6cde5a6f6ce54d3c1b05.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/62c/3ee/5e4/62c3ee5e409e9b9d13dc28239a7b421d.jpg"><br>  Add-on to the OpenWRT web interface for freeing the USB device: <a href="">disik.ru/uploads/luci-usbip.tar.gz</a> </div><p>Source: <a href="https://habr.com/ru/post/216177/">https://habr.com/ru/post/216177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216159/index.html">Cellular network in Yakutia: what happens to base stations at -60 Celsius</a></li>
<li><a href="../216163/index.html">Sculpting pixel cartoon Simpsons Coach Gag in Excel</a></li>
<li><a href="../216167/index.html">Chromebook + Haswell = Acer C720</a></li>
<li><a href="../216169/index.html">Interaction of vulnerability scanners with Metasploit. Part 2</a></li>
<li><a href="../216173/index.html">Samba4 as AD + file server</a></li>
<li><a href="../216179/index.html">Data collection methods for analyzing the effectiveness of contextual advertising in offline sales</a></li>
<li><a href="../216181/index.html">C ++ web application, or taming the FastCGI daemon</a></li>
<li><a href="../216185/index.html">Work with Korutins in Unity</a></li>
<li><a href="../216187/index.html">Kohana-form: module of management and form generation</a></li>
<li><a href="../216189/index.html">Undefined behavior in C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>