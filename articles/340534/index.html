<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ROS, ELM and Bug</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Robotic Operation System allows you to interact with your subsystems through the mechanisms of "subscription to a topic" and "service call" using ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ROS, ELM and Bug</h1><div class="post__text post__text-html js-mediator-article"><img height="50%" width="50%" src="https://habrastorage.org/getpro/habr/post_images/705/227/25a/70522725a38b46d0f6f531a2f93ae7df.png" align="left">  <a href="http://ros.org/">The Robotic Operation System</a> allows you to interact with your subsystems through the mechanisms of "subscription to a topic" and "service call" using their own special protocol.  But there is a <a href="http://wiki.ros.org/rosbridge_suite">rosbridge</a> package that allows you to communicate with ROS from the outside using a websocket.  The described <a href="">protocol</a> allows you to perform basic operations to interact with other subsystems. <br><br>  <a href="http://elm-lang.org/">ELM</a> is a very simple and elegant language that compiles to javascript and is great for developing interactive programs. <br><br>  I decided to combine business with pleasure and study ROS (which is currently taking the <a href="https://stepik.org/course/3222/">course</a> ) and ELM together. <br><a name="habracut"></a><br>  ROS has a demo module <a href="http://wiki.ros.org/turtlesim">turtlesim</a> , which emulates a robot bug.  One of the nodes provided by him draws the movement of the turtle in his own window, the other one converts pressing the arrows on the keyboard into commands for moving and turning the turtle.  You can connect to this process from a simple ELM program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ELM uses the model-updater-view pattern.  The program state is described by the Model data type, the update function takes incoming events of the Msg type and converts the old model to a new one (and, possibly, an operation that needs to be performed), and the view function builds its model in the user interface that can trigger Msg events. .  More events can come by subscriptions, which are created by a special function from the model. <br><br>  Generalized web-program on ELM looks like this: <br><br><pre><code class="hljs sql">init : ( Model, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; Html Msg subscriptions : <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; Sub Msg <span class="hljs-keyword"><span class="hljs-keyword">main</span></span> = Html.program { init = init , <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> , subscriptions = subscriptions }</code> </pre> <br>  and the programmer can only implement these four functions. <br><br>  We describe the model: <br><br><pre> <code class="hljs cmake">type alias Model = { x : Float , y : Float --   , dir : Float -- ,     , connected : Bool --    , ws : <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> -- URL websocket,   rosbridge --  ROS     --    , -- url  ws://localhost:<span class="hljs-number"><span class="hljs-number">9090</span></span>/ , topic : <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> -- ,    , --  /turtle1/cmd_vel , input : <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> -- JSON ,     --      , messages : <span class="hljs-keyword"><span class="hljs-keyword">List</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> --    rosbridge  --       --     } init : ( Model, Cmd Msg ) init = ( Model <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-string"><span class="hljs-string">"ws://192.168.56.101:9090/"</span></span> <span class="hljs-string"><span class="hljs-string">"/turtle1/cmd_vel"</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> [] , Cmd.none )</code> </pre><br>  While nothing complicated, the model is a structure with named fields. <br>  The Msg type is less common for OO programmers: <br><br><pre> <code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Msg</span></span></span></span> = <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | NewMessage <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | EnterUrl <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | EnterTopic <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | Connect | Input <span class="hljs-built_in"><span class="hljs-built_in">String</span></span></code> </pre><br>  This is the so-called algebraic type, which describes the direct (marked) sum of several alternatives.  The closest representation of this type in OOP - Msg is declared an abstract class, and each line of the alternative describes a new class inherited from Msg.  Input, Send, and so on are the constructor names of these classes, followed by the constructor parameters that turn into class fields. <br><br>  Each alternative is a request to change the model and perform any operations, which is generated by the actions of the user with the interface (view) or external events - receiving data from the websocket. <br><br><ul><li>  Send String - request to send a string to websocket </li><li>  NewMessage String - process the string taken from the websocket </li><li>  EnterUrl String - editable url for websocket </li><li>  EnterTopic String - editable topic </li><li>  Connect - finish editing the settings and contact the server </li><li>  Input String - editing a ‚Äúmanual‚Äù message in websocket </li></ul><br>  Now it‚Äôs more or less clear how to implement the update function: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> EnterTopic newInput -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | topic = newInput }, Cmd.none ) EnterUrl newInput -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ws = newInput }, Cmd.none ) <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span> -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | connected = <span class="hljs-literal"><span class="hljs-literal">True</span></span> }, WebSocket.send model.ws (subscr model.topic) ) <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> newInput -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> = newInput }, Cmd.none ) Send <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> }, WebSocket.send model.ws <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> ) NewMessage <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Decode.decodeString (decodePublish decodeTwist) <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Err _ -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | messages = <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> :: model.messages }, Cmd.none ) Ok t -&gt; let ( r, a ) = turtleMove t.msg dir = model.dir + a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | x = model.x + r * <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span> dir , y = model.y + r * <span class="hljs-keyword"><span class="hljs-keyword">cos</span></span> dir , dir = dir , messages = <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> :: model.messages } , Cmd.none )</code> </pre><br>  Here we use several functions that we will define later: <br><br><ul><li>  subscr: String -&gt; String - constructs a query string to subscribe to a topic in rosbridge </li><li>  (decodePublish decodeTwist) - decoding of the message from the topic, containing the geometry_msgs / Twist ROS data with which the turtle operates </li><li>  turtleMove: Twist -&gt; (Float, Float) - extract from the message of movement and rotation angle of the turtle </li></ul><br>  For now, define the view function: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">view</span></span> : Model -&gt; Html Msg <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> model = div [] &lt;| <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> model.connected <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> let x = toString model.x y = toString model.y dirx = toString (model.x + <span class="hljs-number"><span class="hljs-number">5</span></span> * sin model.dir) diry = toString (model.y + <span class="hljs-number"><span class="hljs-number">5</span></span> * cos model.dir) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [ svg [ viewBox "0 0 100 100", Svg.Attributes.width "300px" ] [ <span class="hljs-type"><span class="hljs-type">circle</span></span> [ cx x, cy y, r "4" ] [] , <span class="hljs-type"><span class="hljs-type">line</span></span> [ x1 x, y1 y, x2 dirx, y2 diry, stroke "red" ] [] ] , br [] [] , button [ onClick &lt;| Send &lt;| pub model.topic <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ] [ Html.text "Left" ] , button [ onClick &lt;| Send &lt;| pub model.topic <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ] [ Html.text "Forward" ] , button [ onClick &lt;| Send &lt;| pub model.topic <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ] [ Html.text "Back" ] , button [ onClick &lt;| Send &lt;| pub model.topic <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> ] [ Html.text "Rigth" ] , br [] [] , <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> [ Html.Attributes.type_ "textaria", onInput <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> ] [] , button [ onClick (Send model.<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) ] [ Html.text "Send" ] , div [] (List.map viewMessage model.messages) ] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [ Html.text "WS: " , <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> [ Html.Attributes.type_ "text" , Html.Attributes.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> model.ws , onInput EnterUrl ] [] , Html.text "Turtlr topic: " , <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> [ Html.Attributes.type_ "text" , Html.Attributes.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> model.topic , onInput EnterTopic ] [] , br [] [] , button [ onClick <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span> ] [ Html.text "Connect" ] ] viewMessage : String -&gt; Html msg viewMessage msg = div [] [ Html.text msg ]</code> </pre><br>  view creates a DOM (you can read that just html).  Each object (tag) is generated by a separate function from the library ‚Äúelm-lang / html‚Äù, which takes two parameters - a list of attributes, such as Html.Attribute and a list of nested objects / tags.  (Personally, I consider such a decision unsuccessful - I somehow put the nested element in the br tag and then could not find it on the screen for a long time, the correct library should not allow making such an error, leaving only an attribute argument with br. But maybe in this There is a deeper meaning for specialists in the frontline.) <br><br>  Separately, I want to describe the attributes.  The Html.Attribute type is a hodgepodge for completely dissimilar entities.  For example, <code>Html.Attributes.type_ : String -&gt; Html.Attribute msg</code> sets the type in tags such as imput, and <code>Html.Events.onClick : msg -&gt; Html.Attribute msg</code> sets the event that should occur when you click on this item. <br><br>  Fully write Html.Attributes.type_ in the code was due to a conflict with Svg.Attributes.type_. <br><br>  Consider a piece of code that may be difficult to understand: <br><br><pre> <code class="hljs rust">onClick &lt;| <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> &lt;| <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> model.topic <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  It is equivalent to <br><br><pre> <code class="hljs lisp">onClick (<span class="hljs-name"><span class="hljs-name">Send</span></span> (<span class="hljs-name"><span class="hljs-name">pub</span></span> model.topic <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>))</code> </pre> <br> <code>&lt;|</code>  - This is an operator of applying a function to an argument (in Haskell it is called '$'), which allows the use of fewer brackets. <br><br>  <code>onClick</code> is the creation of the attribute already considered, its parameter is the generated event. <br><br>  <code>Send</code> is one of the constructors of the Msg type, its patmeter is a string that we want to send to the websocket later. <br><br>  Constructors and types in ELM are written with a capital letter, and variables (more precisely, constants and parameters of functions), ordinary and typical, with a small one. <br><br>  <code>pub model.topic 0 1</code> - call the function of creating a request to send a message about the movement of the turtle to the topic.  The topic is taken from the model, and 0 and 1 - move and rotate. <br><br>  We describe the missing functions.  The easiest way to create messages is to send to websocket, since these are just strings: <br><br><pre> <code class="hljs tex">subscr : String -&gt; String subscr topic = "{<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>op<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>subscribe<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>,<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>topic<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>" ++ topic ++ "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>}" pub : String -&gt; Float -&gt; Float -&gt; String pub topic mr = "{<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>topic<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>" ++ topic ++ "<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>,<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>msg<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:{<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>linear<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:{<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>y<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:0.0,<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>x<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:" ++ toString m ++ ",<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>z<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>: 0.0},<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>angular<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:{<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>y<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:0.0,<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>x<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:0.0,<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>z<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:" ++ toString r ++ "}},<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>op<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>publish<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">"</span></span></span></span>}"</code> </pre><br>  Handling messages is a bit more complicated.  The type of message that turtlesim works with can be viewed using ROS: <br><br><pre> <code class="hljs go">ros:~$ rosmsg info geometry_msgs/Twist geometry_msgs/Vector3 linear <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> z geometry_msgs/Vector3 angular <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span> z</code> </pre> <br>  rosbridge turns it into json and wraps it in an event message on a topic. <br><br>  Decoding it will look like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> Vector3 = ( <span class="hljs-type"><span class="hljs-type">Float</span></span>, <span class="hljs-type"><span class="hljs-type">Float</span></span>, <span class="hljs-type"><span class="hljs-type">Float</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> Twist = { linear : Vector3, angular : Vector3 } decodV3 : Decode.Decoder Vector3 decodV3 = Decode.map3 (,,) (Decode.at [ "x" ] Decode.float) (Decode.at [ "y" ] Decode.float) (Decode.at [ "z" ] Decode.float) decodeTwist : Decode.Decoder Twist decodeTwist = Decode.map2 Twist (Decode.at [ "linear" ] decodV3) (Decode.at [ "angular" ] decodV3) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> Publish a = { msg : a, topic : String, op : String } decodePublish : Decode.Decoder a -&gt; Decode.Decoder (Publish a) decodePublish decMsg = Decode.map3 (\tmo -&gt; { msg = m, topic = t, op = o }) (Decode.at [ "topic" ] Decode.string) (Decode.at [ "msg" ] decMsg) (Decode.at [ "op" ] Decode.string)</code> </pre><br>  A decoder of a Json representation of some type is combined from other decoders. <br>  <code>Decode.map3 (,,)</code> applies three decoders passed to it in parameters and creates a tuple of three decoded elements using the <code>(,,)</code> operation. <br><br>  <code>Decode.at</code> decodes the value extracted along a given path in Json by a given decoder. <br><br>  Code <br><br><pre> <code class="hljs lisp">(\tmo -&gt; { msg = m, topic = <span class="hljs-literal"><span class="hljs-literal">t</span></span>, op = o })</code> </pre> <br>  describes a closure.  It is similar to the js code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t,m,o</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">"msg"</span></span>:m, <span class="hljs-string"><span class="hljs-string">"t"</span></span>:t, <span class="hljs-string"><span class="hljs-string">"op"</span></span>:p} }</code> </pre> <br>  The full code can be taken from <a href="https://github.com/potan/turtle">github</a> . <br><br>  If you want to try ROS will have to install yourself.  Instead of installing ELM, you can use the <a href="https://ellie-app.com/4kFLwLd2Fa1/0">service</a> . </div><p>Source: <a href="https://habr.com/ru/post/340534/">https://habr.com/ru/post/340534/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340520/index.html">Five planning observations</a></li>
<li><a href="../340522/index.html">BEM + React: flexible design system architecture</a></li>
<li><a href="../340524/index.html">How to make a Public API to be used</a></li>
<li><a href="../340528/index.html">Implementing Mars IS Service Introduction Process</a></li>
<li><a href="../340530/index.html">Modern Web-platform: how to relax and have fun? A practical guide, part 1</a></li>
<li><a href="../340536/index.html">Tired of writing PropertyDrawer in Unity? There is a better way</a></li>
<li><a href="../340538/index.html">UFADEVCONF 2017 Conference Overview</a></li>
<li><a href="../340540/index.html">Russian AI Cup 2017 - to all fans of StarCraft and C & C is dedicated</a></li>
<li><a href="../340544/index.html">A dozen Linux tricks that really save a lot of time</a></li>
<li><a href="../340550/index.html">Code review humanly (part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>