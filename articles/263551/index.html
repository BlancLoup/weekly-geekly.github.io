<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick start with PHPixie 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After two years of development, the third version of the PHPixie framework has been completed . Why so long? In fact, during this time, at least three...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick start with PHPixie 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right"><br>  After two years of development, the third version of the <a href="http://phpixie.com/">PHPixie</a> framework has been <a href="http://phpixie.com/">completed</a> .  Why so long?  In fact, during this time, at least three ORMs and template engines were written, which were deleted and copied again, because ‚Äúaah, you can do better‚Äù.  Especially a lot of time was spent on tests, without which a huge amount of improvements simply would not have been noticed.  Many times I just wanted to leave this business, stop at the second version and add modules to it.  But now, when all these iterations have been completed, I can confidently say that this is the best implementation that I know (and which I was capable of).  This is what will make you happy with PHPixie 3: <br><br><ul><li>  Compliance with PSR-2 and PSR-4 standards </li><li>  PSR-7 query support and library for convenient work with them </li><li>  Templates using simple PHP, but with support for inheritance and blocks like Twig.  Allows you to easily add your extensions and other formats, such as HAML, etc. </li><li>  ORM which is easy to use as ActiveRecord, but at the same time breaking the logic of requests, entities and repositories separately.  Supports links to MongoDB collections and optimizes queries on many entities at the same time (for example, you can link several articles with several tags in one query) </li><li>  The approach with processors instead of the usual controllers allows you to create an arbitrary architecture. </li><li>  The configuration component allows you to split the settings by depth into folders (for example, the languages.en.plural.mouse key can refer to the plural.mouse key in the <i>languages ‚Äã‚Äã/ en.php file</i> ) </li><li>  The bundle system allows you to easily use one code in several projects and shares it with other users.  Bundles are installed through the composer like any other library. </li></ul><br><br>  And now a short tutorial that will show you everything you need to know to start developing with PHPixie 3: <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Installation</b> <br><br>  First we create the project skeleton using Composer: <br><br><pre><code class="hljs sql">php composer.phar <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">project</span></span> phpixie/<span class="hljs-keyword"><span class="hljs-keyword">project</span></span> your_project_folder <span class="hljs-number"><span class="hljs-number">3.</span></span>*-dev</code> </pre> <br><br>  Set up your HTTP server in the <i>/ web</i> directory.  In the case of Nginx, you also need to add this to the config: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">try_files</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri</span></span>/ /index.php; }</code> </pre><br><br>  If you are using Windows, you will need to create a shortcut / web / bundles / app pointing to / bundles / app / web. <br>  On Linux and MacOS, the shortcut will work out of the box.  It is needed in order to open access to the web files of the default bundle (I will explain everything now). <br><br>  Now going to <a href="http://localhost/">localhost's</a> link should see a short greeting. <br><br>  <b>Bandla</b> <br><br>  PHPixie 3 supports the bundle system, such as Symfony2.  If you have not worked with them yet, imagine that the site can now be divided into logical parts, which can then be easily transferred to other projects and shared through Composer.  For example, user authentication can be created as a separate bundle with its own templates, styles and images and then used on several projects.  Bands are ‚Äúmounted‚Äù in a project, as for example in Linux, disks are mounted in a file system. <br><br>  At first, a project is created with a single 'app' bundle in '/ bundles / app'.  And although the structure of the project in the third version seems more complicated than in the second, but as long as you have only one bundle, you will rarely do something outside this directory. <br><br>  <b>Processors</b> <br><br>  The familiar concept of MVC Controllers is greatly expanded in PHPixie, it now supports infinite nesting and arbitrary architecture.  The idea is that there is only one ‚Äúcontroller‚Äù in terms of the framework.  But he can, for example, delegate his functions to ‚Äúsubcontrollers‚Äù and generally do what he wants.  The processor interface (as they are now called) consists of only one <i>process ($ request)</i> method.  This allowed us to create several base classes of processors that process requests in different ways.  Of course, one of the options is completely similar to the usual controllers, so you can do everything in the old way, which is what the standard <i>Greet</i> processor does, which showed us the greeting after installation. <br><br>  Now we will create a new <i>Quickstart</i> processor, on which we will try everything: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/HTTPProcessors/Quickstart.php namespace Project\App\HTTPProcessors; use PHPixie\HTTP\Request; //        class Quickstart extends \PHPixie\DefaultBundle\Processor\HTTP\Actions { /** * Builder    *       * @var Project\App\Builder */ protected $builder; public function __construct($builder) { $this-&gt;builder = $builder; } //   public function defaultAction(Request $request) { return "Quickstart tutorial"; } //       }</span></span></code> </pre><br><br>  Now you need to register it in the main processor of the bundle.  By default, it is configured to send a request to the processor specified in the routing parameters.  In the second version, there was no need to register controllers anywhere, since they were determined automatically by namespace and class name.  This approach is inconvenient because it makes us fit into some frameworks with class naming and folder structure.  Now for each controller, a builder method is simply added, which allows you to call the classes as you like and pass different parameters through the constructor. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/HTTPProcessors.php //... protected function buildQuickstartProcessor() { return new HTTPProcessors\Quickstart( $this-&gt;builder ); } //...</span></span></code> </pre><br><br>  Going to <a href="http://localhost/quickstart/">localhost / quickstart</a> now we will see the message "Quickstart tutorial". <br><br>  Now you can try other parts of the framework. <br><br>  <b>Routing</b> <br><br>  Often you have to create links like <i>/ quickstart / view / 4</i> including the id or the name of the page or product.  To do this, first create a simple action in our processor: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/HTTPProcessors/Quickstart.php //... public function viewAction($request) { //  'id' return $request-&gt;attributes()-&gt;get('id'); } //... }</span></span></code> </pre><br><br>  Now you also need to add a rule with this parameter to those that are already registered in the config.  But first, let's look at how it looks: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/assets/config/routeResolver return array( //     //    //  -   'type' =&gt; 'group', 'resolvers' =&gt; array( //...      //  'default' =&gt; array( 'type' =&gt; 'pattern', //     'path' =&gt; '(&lt;processor&gt;(/&lt;action&gt;))', //  //    /greet //  'action'  'default' 'defaults' =&gt; array( 'processor' =&gt; 'greet', 'action' =&gt; 'default' ) ) ) );</span></span></code> </pre><br><br>  The part we want to add looks like this: <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'view'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  id  //    'path' =&gt; 'quickstart/view/&lt;id&gt;', 'defaults' =&gt; array( 'processor' =&gt; 'quickstart', 'action' =&gt; 'view' ) )</span></span></code> </pre><br><br>  Since the routes are selected in order, it is important that the more specific rules in the config are higher than the general ones. <br><br>  Now going to <a href="http://localhost/quickstart/view/5">localhost / quickstart / view / 5</a> you will see '5' in response. <br><br>  As a quick example of what can be achieved in the settings, try setting a common prefix for several routes with their own parameters.  It's okay if it seems difficult, at the moment it does not matter to us: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//  'type' =&gt; 'prefix', //       //    'path' =&gt; 'user/&lt;userId&gt;/', 'resolver' =&gt; array( 'type' =&gt; 'group', 'resolvers' =&gt; array( // /user/5/friends to Friends::userFriends() 'friends' =&gt; array( 'path' =&gt; 'friends', 'defaults' =&gt; array( 'processor' =&gt; 'friends', 'action' =&gt; 'usersFriends' ) ), // /user/5/profile to Profile::userProfile() 'profile' =&gt; array( 'path' =&gt; 'profile', 'defaults' =&gt; array( 'processor' =&gt; 'profile', 'action' =&gt; 'userProfile' ) ) ) ) );</span></span></code> </pre><br><br>  This approach allows not only to get more flexible settings (after all, it‚Äôs enough to change the prefix in one place and it will change in all nested routes), but also to win in performance, because if the prefix did not fit, then all routes written in it are skipped. <br><br>  <b>Input and Output</b> <br><br>  As you have already noticed, each action receives a request as a parameter and returns some kind of response.  Here is how we can get different information from the request: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//$_GET['name'] $request-&gt;query()-&gt;get('name'); //$_POST['name'] $request-&gt;data()-&gt;get('name'); //  $request-&gt;attributes()-&gt;get('name');</span></span></code> </pre><br><br>  And now a little more interesting: <br><br><pre> <code class="php hljs">$data = $request-&gt;data(); <span class="hljs-comment"><span class="hljs-comment">//     $data-&gt;get('name', 'Trixie'); //   //   'name'   $data-&gt;getRequired('name'); //    // $_POST['users']['pixie']['name'] $data-&gt;get('users.pixie.name'); //   ''  //        $pixie = $data-&gt;slice('users.pixie'); $pixie-&gt;get('name'); //     $data-&gt;get(); //    $data-&gt;keys(); //     //    foreach($data as $key =&gt; $value) { } //       //    phpixie/slice //      </span></span></code> </pre><br><br><blockquote>  JSON requests are also automatically parsed in $ request-&gt; data (), which already facilitates working with AJAX requests </blockquote><br><br>  The conclusion is even simpler: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   return 'hello'; //   JSON //      return array('success' =&gt; true); //     //   HTTP $http = $this-&gt;builder-&gt;components()-&gt;http(); $httpResponses = $http-&gt;responses(); //   return $httpResponses-&gt;redirect('http://phpixie.com/'); //      return $httpResponses-&gt;stringResponse('Not found', $headers = array(), 404); //    return $httpResponses-&gt;downloadFile('pixie.jpg', 'image/png', $filePath); //     //   CSV return $httpResponses-&gt;download('report.csv', 'text/csv', $contents);</span></span></code> </pre><br><br><h6>  Templates </h6><br><br>  PHPixie template engine supports template inheritance, blocks and the ability to easily add your own extensions and even formats. <br>  By default, the standard bundle loads templates from the <i>bundles / app / assets / templates</i> folder. <br>  It already contains two files that were used by the standard <i>Greet</i> processor. <br><br>  Let's start by creating a simple template: <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- bundles/app/assets/templates/quickstart/message.php --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  $_()    HTML,   '&lt;', '&gt;'  ..   ,       XSS . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">=$_($message)</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now add another action to the processor: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/HTTPProcessors/Quickstart.php //... public function renderAction($request) { $template = $this-&gt;builder-&gt;components()-&gt;template(); return $template-&gt;render( 'app:quickstart/message', array( 'message' =&gt; 'hello' ) ); } //... }</span></span></code> </pre><br><br>  And we see the result of the link <a href="http://localhost/quickstart/render">localhost / quickstart / render</a> <br><br>  If you like to pass parameters to the template dynamically, rather than an array, then this approach is also available: <br><br><pre> <code class="php hljs">$template = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;components()-&gt;template(); $container = $template-&gt;get(<span class="hljs-string"><span class="hljs-string">'app:quickstart/message'</span></span>); $container-&gt;message = <span class="hljs-string"><span class="hljs-string">'hello'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $container-&gt;render(); <span class="hljs-comment"><span class="hljs-comment">//      //     return $container;</span></span></code> </pre><br><br><h5>  Pattern Inheritance </h5><br><br>  Add a basic parent template. <br><br><pre> <code class="php hljs">&lt;!-- bundles/app/assets/templates/quickstart/layout.php --&gt; &lt;h1&gt;Quickstart&lt;/h1&gt; &lt;div&gt; &lt;!--      --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;childContent();<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/div&gt;</code> </pre><br><br>  and use it in our message.php <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- bundles/app/assets/templates/quickstart/message.php --&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;layout(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'app:quickstart/layout'</span></span></span><span class="php">);</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">=$_($message)</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now, at <a href="http://localhost/quickstart/render">localhost / quickstart / render,</a> our template will already be wrapped in the parent.  By the way, the parent template, in turn, can also have its parents. <br><br>  Even more flexibility can be achieved by using blocks that allow you to replace and add content to different places of the parent template. <br><br><pre> <code class="php hljs">&lt;!-- bundles/app/assets/templates/quickstart/layout.php --&gt; &lt;!--   <span class="hljs-string"><span class="hljs-string">'header'</span></span> --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'header'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;Quickstart&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;endBlock(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;!--    --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;block(<span class="hljs-string"><span class="hljs-string">'header'</span></span>) <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;div&gt; &lt;!--      --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;childContent();<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/div&gt;</code> </pre><br><br>  Now add content to this block from our message.php: <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- bundles/app/assets/templates/quickstart/message.php --&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;layout(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'app:quickstart/layout'</span></span></span><span class="php">);</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;startBlock(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'header'</span></span></span><span class="php">); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Message<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;endBlock(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">=$_($message)</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  By default, the content in the block is in the order of addition.  This allows you to conveniently organize for example connecting styles and scripts depending on the page.  But we can also tell the parent template to add its content to the block only if the child has not added it himself. <br><br><pre> <code class="php hljs">&lt;!-- bundles/app/assets/templates/quickstart/layout.php --&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'header'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)): <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;Quickstart&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;endBlock(); <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;!-- ... --&gt;</code> </pre><br><br>  Or, for example, add content to the beginning of the block and not to the end: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;startBlock(<span class="hljs-string"><span class="hljs-string">'header'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br><br><h5>  Sub-patterns </h5><br><br>  The sublabel activation is also possible: <br><br><pre> <code class="html hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">include</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;resolve(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'some:template'</span></span></span><span class="php">);</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br><h5>  Link generation </h5><br><br>  To generate links in the template, there are two methods <i>httpPath</i> and <i>httpUri</i> : <br><br><pre> <code class="html hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> $url=</span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;httpPath( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'app.default'</span></span></span><span class="php">, </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'processor'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'hello'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'action'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'greet'</span></span></span><span class="php"> ) ); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"&lt;?=$_($url)?&gt;"</span></span></span><span class="hljs-tag">&gt;</span></span>Hello<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h4>  Databases and ORM </h4><br><br>  Database connections are described in global configuration, outside bundles.  For example, a connection to MySQL might look like this: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// assets/config/database.php return array( 'default' =&gt; array( 'driver' =&gt; 'pdo', 'connection' =&gt; 'mysql:host=localhost;dbname=quickstart', 'user' =&gt; 'pixie', 'password' =&gt; 'pixie' ) );</span></span></code> </pre><br><br>  PHPixie supports not only relational databases, but also ** MongoDB **. <br>  You can even describe the relationships (one-to-one, one-to-many, many-to-many) between relational tables and MongoDB collections and work with them using the same syntax.  At the moment, no other PHP ORM supports this level of integration. <br><br>  Fill the database with data.  For example, let's say we want to create a tracker for projects that consist of tasks.  The scheme could look like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`projects`</span></span>( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-string"><span class="hljs-string">`tasksTotal`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">`tasksDone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`tasks`</span></span>( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">`projectId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-string"><span class="hljs-string">`isDone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`projects`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Quickstart'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Build a website'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`tasks`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Installing'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Routing'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Templating'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'Database'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Design'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Develop'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Deploy'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><br>  And we can already use ORM to access this data.  Add the <i>orm</i> action to the processor: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/HTTPProcessors/Quickstart.php //... public function ormAction(Request $request) { $orm = $this-&gt;builder-&gt;components-&gt;orm(); $projects = $orm-&gt;query('project')-&gt;find(); //     //   . //   ,  //  ,   //   JSON return $projects-&gt;asArray(true); } //...</span></span></code> </pre><br><br>  Now going to <a href="http://localhost/quickstart/orm">localhost / quickstart / orm</a> you will see a JSON response with the project data. <br>  Before we take a deeper look at the possibilities of the new ORM, set up a one-to-many relationship <br>  between projects and their tasks. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/assets/config/orm.php </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> return array( 'relationships' =&gt; array( array( 'type' =&gt; 'oneToMany', 'owner' =&gt; 'project', 'items' =&gt; 'task', //    //     'itemsOptions' =&gt; array( 'onOwnerDelete' =&gt; 'delete' ) ) ) );</span></span></code> </pre><br><br><h5>  Entities </h5><br><br>  Creating, modifying, and deleting entities is quite intuitive: <br><br><pre> <code class="php hljs">$orm = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;components-&gt;orm(); <span class="hljs-comment"><span class="hljs-comment">//      $projectRepository = $orm-&gt;repository('project'); $project = $projectRepository-&gt;create(); //    $project = $orm-&gt;createEntity('project'); //    $project-&gt;name = 'Buy Groceries'; $project-&gt;save(); $task = $orm-&gt;createEntity('task'); $task-&gt;name = 'Milk'; $task-&gt;save(); //     $project-&gt;tasks-&gt;add($task); //   $project-&gt;delete(); //    $projects = $orm-&gt;query('project')-&gt;find(); foreach($projects as $project) { foreach($project-&gt;tasks() as $task) { //... } }</span></span></code> </pre><br><br><h5>  Requests </h5><br><br>  Here are just a part of what is now possible with ORM requests: <br><br><pre> <code class="php hljs">$orm = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;components-&gt;orm(); <span class="hljs-comment"><span class="hljs-comment">//     $orm-&gt;query('project')-&gt;where('name', 'Quickstart')-&gt;findOne(); //   id $orm-&gt;query('project')-&gt;in($id)-&gt;findOne(); //    id $orm-&gt;query('project')-&gt;in($ids)-&gt;findOne(); //    $orm-&gt;query('project') -&gt;where('tasksTotal', '&gt;', 2) -&gt;or('tasksDone', '&lt;', 5) -&gt;find(); //   //WHERE name = 'Quickstart' OR ( ... ) $orm-&gt;query('project') -&gt;where('name', 'Quickstart') -&gt;or(function($query) { $querty -&gt;where('tasksTotal', '&gt;', 2) -&gt;or('tasksDone', '&lt;', 5); }) -&gt;find(); //   $orm-&gt;query('project') -&gt;where('name', 'Quickstart') -&gt;startWhereConditionGroup('or') -&gt;where('tasksTotal', '&gt;', 2) -&gt;or('tasksDone', '&lt;', 5) -&gt;endGroup() -&gt;find(); //     ,  '*'   //     tasksTotal = tasksDone $orm-&gt;query('project') -&gt;where('tasksTotal', '=*', 'tasksDone') -&gt;find(); //        $orm-&gt;query('project') -&gt;relatedTo('task') -&gt;find(); //      $orm-&gt;query('project') -&gt;where('tasks.name', 'Routing') -&gt;findOne(); //   $orm-&gt;query('project') -&gt;orRelatedTo('task', function($query) { $query-&gt;where('name', 'Routing'); }) -&gt;findOne(); //     //    (eager loading) $orm-&gt;query('project')-&gt;find(array('task')); //      $orm-&gt;query('project')-&gt;update(array( 'tasksDone' =&gt; 0 )); //    //       . //      $query = $orm-&gt;query('project') -&gt;where('tasksTotal', '=*', 'tasksDone'); $count = $query-&gt;count(); $query -&gt;limit(5) -&gt;offset(0) -&gt;find();</span></span></code> </pre><br><br>  PHPixie ORM includes many optimizations to reduce the number of database requests. <br>  For example, you can link several tasks to the project in one request: <br><br><pre> <code class="php hljs">$orm = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;components-&gt;orm(); <span class="hljs-comment"><span class="hljs-comment">//   $projectQuery = $orm-&gt;query('project') -&gt;where('name', 'Quickstart'); //    5  $tasksQuery = $orm-&gt;query('task')-&gt;limit(5); //          //       $projectQuery-&gt;tasks-&gt;add($tasksQuery);</span></span></code> </pre><br><br>  Using queries instead of working with entities dramatically reduces the number of queries.  This is especially noticeable in the many-to-many relationship.  As with MongoDB support, no other ORM allows this. <br><br><h5>  Entity extension </h5><br><br>  Most likely you will want to expand the classes of models to add functionality.  In other implementations, this leads to a close connection of logic with the ORM itself and the database.  PHPixie, on the other hand, allows you to describe completely independent wrappers that decorate entities, and thus are completely independent of ORM.  This means that it is much easier to write tests and no fixation or test data is needed. <br><br>  Here is a simple wrapper: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/ORMWrappers/Project.php; namespace Project\App\ORMWrappers; class Project extends \PHPixie\ORM\Wrappers\Type\Database\Entity { //      //     public function isDone() { return $this-&gt;tasksDone === $this-&gt;tasksTotal; } }</span></span></code> </pre><br><br>  Now register it in the bundle: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// bundles/app/src/Project/App/ORMWrappers.php; namespace Project\App; class ORMWrappers extends \PHPixie\ORM\Wrappers\Implementation { //        protected $databaseEntities = array( 'project' ); //      public function projectEntity($entity) { return new ORMWrappers\Project($entity); } }</span></span></code> </pre><br><br>  Everything, now we can try: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//Find the first project $project = $orm-&gt;query('project')-&gt;findOne(); //Check if it is done $project-&gt;isDone();</span></span></code> </pre><br>  You can also declare wrappers for Requests and Repositories to add or change functionality.  For example, you can add to the request a method that adds several conditions at once. <br><br><h4>  Eat more! </h4><br><br>  The code for this guide is available <a href="https://github.com/phpixie/demo-quickstart">on github</a> .  You can also get acquainted with the finished <a href="https://github.com/phpixie/demo-todo">demo project</a> , which is just a task tracker. <br><br>  <b>Everything was fine with me!</b> <br><br>  If the system of bundles, the approach to processors and other changes seem superfluous to you, and I would like to work as in the second version, then do not worry, you can continue to use the same approach: <br><br><ul><li>  Forget everything outside the / bundles / app / folder </li><li>  Since you will not use the bundles, do not create a shortcut in the / web folder, but simply boldly throw your web files into it as you did in the second version.  If you later change your mind and want to work with bundles, simply transfer the files from / web to / bundles / app / web.  Until that time, do not bother. </li><li>  Having slightly expanded the standard classes, you can easily achieve the behavior of the second version: </li></ul><br><br>  We make it so that the processors are built automatically, according to the namespace, without the need to register each in the HTTPProcessor: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /bundles/app/src/Project/App/HTTPProcessor.php namespace Project\App; class HTTPProcessor extends \PHPixie\DefaultBundle\Processor\HTTP\Builder { protected $builder; protected $attribute = 'processor'; public function __construct($builder) { $this-&gt;builder = $builder; } public function processor($name) { if(!array_key_exists($name, $this-&gt;processors)) { $class = '\Project\App\HTTPProcessors\\'.ucfirst($name); if(!class_exists($class)) { return null; } $this-&gt;processors[$name] = new $class($this-&gt;builder); } return $this-&gt;processors[$name]; } }</span></span></code> </pre><br><br>  Add the before () and after () methods, as was the case in the controllers.  As an added bonus, if before () returns some result, then no longer call the action itself: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /bundles/app/src/Project/App/HTTPProcessors\Controller.php namespace Project\App\HTTPProcessors; asbtarct class Controller extends \PHPixie\DefaultBundle\Processor\HTTP\Actions { protected $builder; protected $attribute = 'processor'; public function __construct($builder) { $this-&gt;builder = $builder; } public function process($request) { $result = $this-&gt;before($request); if($result !== null) { return $result; } $result = parent::process($request); return $this-&gt;after($request, $result); } public function before($request) { } public function after($request, $result) { return $result; } }</span></span></code> </pre><br><br><h4>  the end </h4><br><br>  Now you should have everything to start working with PHPixie 3, but there is still a lot of unread documentation, both on the site and here in Habr√©.  Most components already have their own documentation on the updated website or even the Russian version here.  All components can be used without a framework, <a href="http://phpixie.com/coverage/">are covered with tests for 100%</a> , and almost all have the <a href="https://codeclimate.com/github/PHPixie/">maximum quality metric on CodeClimate</a> . <br><br>  By the way, the framework site has also been updated, with a more serious design, so now it will be easier to convince the team to write on it.  And if you have more questions, you can actually find me constantly in <a href="https://gitter.im/PHPixie/Hotline">our chat</a> . <br><br><h4>  Benchmarks </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d66/141/592/d66141592fa4ef5693cfe0e8a967e7a2.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/263551/">https://habr.com/ru/post/263551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263539/index.html">Emmett Shire: How to Twitch Talk to Users</a></li>
<li><a href="../263541/index.html">PostgreSQL: Production Techniques</a></li>
<li><a href="../263545/index.html">nxweb - HTTP server for C applications</a></li>
<li><a href="../263547/index.html">Pseudo OOP in C</a></li>
<li><a href="../263549/index.html">Multithreaded SOCKS 4 server on Qt</a></li>
<li><a href="../263555/index.html">Qucs project news: release candidate available with circuit simulation support in SPICE</a></li>
<li><a href="../263565/index.html">Magic of tensor algebra: Part 13 - SKA Maxima in problems of transforming tensor expressions. Angular velocity and acceleration in the parameters of Rodrigues-Hamilton</a></li>
<li><a href="../263569/index.html">With LINQ on "Life"</a></li>
<li><a href="../263571/index.html">SoC: we write framebuffer implementation for controller in FPGA</a></li>
<li><a href="../263575/index.html">An example of solving a typical OOP problem in the Haskell language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>