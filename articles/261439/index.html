<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby Design Patterns</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zen Ruby tells us that you can accomplish a task in several ways, so the solutions given here are just a small subset of options for how to solve the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby Design Patterns</h1><div class="post__text post__text-html js-mediator-article">  Zen Ruby tells us that you can accomplish a task in several ways, so the solutions given here are just a small subset of options for how to solve the problem more ‚Äúbeautifully‚Äù.  Almost everywhere, where I read about patterns, some artificial examples were cited, I always wanted someone to show me ‚Äúhow to‚Äù on the already written, poorly designed code. <br>  So, today we consider two design patterns: an abstract factory and a template method. <br><a name="habracut"></a><br>  <b>From far away ... About Ruby and Enum</b> <br>  Imagine that you were put on a project and you are trying to read someone else's code.  We see the line: <br><pre><code class="ruby hljs">LogRec.create(<span class="hljs-symbol"><span class="hljs-symbol">uid:</span></span> task[<span class="hljs-symbol"><span class="hljs-symbol">:tid</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">lrtype:</span></span> <span class="hljs-string"><span class="hljs-string">'tsk'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> rc_time, <span class="hljs-symbol"><span class="hljs-symbol">start:</span></span> task[<span class="hljs-symbol"><span class="hljs-symbol">:start</span></span>] )</code> </pre> <br>  Read the code further: <br><pre> <code class="ruby hljs"> LogRec.create(<span class="hljs-symbol"><span class="hljs-symbol">uid:</span></span> task[<span class="hljs-symbol"><span class="hljs-symbol">:tid</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">lrtype:</span></span> <span class="hljs-string"><span class="hljs-string">'task'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> rc_time, <span class="hljs-symbol"><span class="hljs-symbol">start:</span></span> task[<span class="hljs-symbol"><span class="hljs-symbol">:start</span></span>] )</code> </pre> <br>  Strange, there 'tks', here 'task'.  Ok, we looked at the documentation, in the migration (somewhere else), fixed it.  We read further, again a mistake ... <br>  Conclusion: Always try to make string constants somewhere, in this case it is better to use Enums.  In Ruby Enum, it looks like this: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProtocolElementTypeName</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TASK</span></span></span><span class="hljs-class"> = '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NOTE</span></span></span><span class="hljs-class"> = '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">note</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EVENT</span></span></span><span class="hljs-class"> = '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Then all of your controllers and models will use a constant (ProtocolElementTypeName :: TASK) and no typos! <br><br>  <b>Almost "Factory"</b> <br>  We read the code further and see: <br><pre> <code class="ruby hljs">log = Array.new log_recs.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|log_rec|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> log_rec.lrtype <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">'qc'</span></span> log.push({<span class="hljs-symbol"><span class="hljs-symbol">uid:</span></span> log_rec.uid, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> log_rec.lrtype, <span class="hljs-symbol"><span class="hljs-symbol">parid:</span></span> log_rec.parid, <span class="hljs-symbol"><span class="hljs-symbol">start:</span></span> log_rec.start.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">ts:</span></span> log_rec.ts.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> log_rec.rc_time.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">state:</span></span> log_rec.state, <span class="hljs-symbol"><span class="hljs-symbol">rcpt:</span></span> log_rec.recipient}) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">'tstate'</span></span>, <span class="hljs-string"><span class="hljs-string">'etsks'</span></span> log.push({<span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> log_rec.lrtype, <span class="hljs-symbol"><span class="hljs-symbol">parid:</span></span> log_rec.parid, <span class="hljs-symbol"><span class="hljs-symbol">start:</span></span> log_rec.start.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">end:</span></span> log_rec.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">ts:</span></span> log_rec.ts.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> log_rec.rc_time.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">state:</span></span> log_rec.state, <span class="hljs-symbol"><span class="hljs-symbol">rcpt:</span></span> log_rec.recipient}) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">'pcb'</span></span>, <span class="hljs-string"><span class="hljs-string">'grps'</span></span> log.push({<span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> log_rec.lrtype, <span class="hljs-symbol"><span class="hljs-symbol">ts:</span></span> log_rec.ts.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> log_rec.rc_time.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rcpt:</span></span> log_rec.recipient}) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">'egrp'</span></span>, <span class="hljs-string"><span class="hljs-string">'tgrp'</span></span> log.push({<span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> log_rec.lrtype, <span class="hljs-symbol"><span class="hljs-symbol">parid:</span></span> log_rec.parid, <span class="hljs-symbol"><span class="hljs-symbol">ts:</span></span> log_rec.ts.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> log_rec.rc_time.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">state:</span></span> log_rec.state, <span class="hljs-symbol"><span class="hljs-symbol">rcpt:</span></span> log_rec.recipient}) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-string"><span class="hljs-string">'rprefs'</span></span> log.push({<span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> log_rec.lrtype, <span class="hljs-symbol"><span class="hljs-symbol">parid:</span></span> log_rec.parid, <span class="hljs-symbol"><span class="hljs-symbol">ts:</span></span> log_rec.ts.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> log_rec.rc_time.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rcpt:</span></span> log_rec.recipient}) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> log.push({<span class="hljs-symbol"><span class="hljs-symbol">uid:</span></span> log_rec.uid, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> log_rec.lrtype, <span class="hljs-symbol"><span class="hljs-symbol">parid:</span></span> log_rec.parid, <span class="hljs-symbol"><span class="hljs-symbol">start:</span></span> log_rec.start.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">end:</span></span> log_rec.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">ts:</span></span> log_rec.ts.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">rc_time:</span></span> log_rec.rc_time.gsub(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"T"</span></span>), <span class="hljs-symbol"><span class="hljs-symbol">state:</span></span> log_rec.state, <span class="hljs-symbol"><span class="hljs-symbol">rcpt:</span></span> log_rec.recipient}) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Here every programmer who writes in OO language should become very, very sad.  If you see a large train of if-s or such a switch, you should shout: ‚ÄúHelp!  Hooligans deprived of view !!! " <br>  How to solve this problem?  Use the "Factory" template.  The meaning of this template is that it provides a convenient interface for creating an object of the desired type.  So, what we see from the code: in the table there are many fields from which objects of different types can be "completed".  The type of the object will depend on what is written in the lrtype field. <br>  To begin with, we will create a module, where we list all possible values ‚Äã‚Äãof the lrtype field: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogRecObjType</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#   obj_type   LogRec EVENT = 'event' QC = 'qv' TASK = 'task' end</span></span></span></span></code> </pre> <br>  Then, you need to create a Hash, which is necessary in order to create an object of a certain type by the value of lrtype: <br><pre> <code class="ruby hljs"> @@types_objects = { ObjectJournal::QC =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:complect_qc</span></span>, ObjectJournal::EVENT =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:complect_event</span></span>, ObjectJournal::TASK =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:complect_task</span></span> }</code> </pre> <br>  And implement the functions that are responsible for staffing the object: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">complect_qc</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obj</span></span></span><span class="hljs-function"> = { :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uid</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">id</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lrtype</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parid</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parid</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ts</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ts</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rc_time</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rc_time</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function"> =</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">state</span></span></span><span class="hljs-function">, :</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rcpt=</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">recipient</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obj</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">#   ...</span></span></span></span></code> </pre> <br>  Now we will write a function that will be responsible for creating an object of the required type by the value of lrtype. <br><pre> <code class="ruby hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">complect_object_journal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> @@</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">types_objects</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">has_key?</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">self</span></span></span></span><span class="hljs-function"><span class="hljs-params">.lrtype)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> send(@@types_objects[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.lrtype]) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> complect_another <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  In fact - everything!  Now let's rewrite that horrible switch: <br><pre> <code class="ruby hljs">log = log_recs.map { <span class="hljs-params"><span class="hljs-params">|x|</span></span> x.complect_object_journal }</code> </pre> <br><br>  <b>Template Method</b> <br>  Consider this situation: there is a certain base class Operation, which has two heirs - Goal and Task.  All three classes have some similar functionality, they can form a certain complex object: <br><pre> <code class="ruby hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return_operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> = { :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class"> =&gt; {:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gid</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class">}, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class"> =&gt; {:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_problem</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_problem</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class">,:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_id</span></span></span><span class="hljs-class">} } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span><span class="hljs-class"> &lt; Operation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return_operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> = { :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class"> =&gt; {:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gid</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">..</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">holder</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">complect_goal_content_header</span></span></span><span class="hljs-class">}, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class"> =&gt; {:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_problem</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_problem</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">state</span></span></span><span class="hljs-class">,:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_id</span></span></span><span class="hljs-class">} } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-class"> &lt; Operation </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return_operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> = { :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class"> =&gt; {:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gid</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class">}, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class"> =&gt; {:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gid</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">..</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author_id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">holder</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">complect_holder</span></span></span><span class="hljs-class">} } } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Here again we see code duplication (for example, we look at the goal key in Task and Operation).  The functionality of the return_operation method ‚Äúmutates‚Äù in each hierarchy class, but the keys (goal and task) always remain the same.  To resolve this kind of situations, the Template Method pattern is best suited.  The meaning of the template is that it makes it possible to determine the basis of the algorithm, allowing the heirs to override certain steps of the algorithm without changing its structure as a whole.  In our case, the template implementation will look something like this: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return_operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> = { :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">complect_goal</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">complect_task</span></span></span><span class="hljs-class"> } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">complect_goal</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal_obj</span></span></span><span class="hljs-class"> = { :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gid</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ts</span></span></span><span class="hljs-class">, } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">goal_obj</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">complect_task</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#task = self.task task_obj = { :is_problem =&gt;task.is_problem, :state =&gt; task.state, :author =&gt; task.author_id } return task_obj end end class Event &lt; Operation def complect_goal goal_obj = { :id =&gt; goal.gid, :title =&gt; goal.title, :ts =&gt; goal.ts, :author =&gt; goal.author_id, :holder =&gt; complect_goal_content_header } return goal_obj end end class Task &lt; Operation def complect_task task_obj = { :id =&gt; task.gid, :title =&gt; task.title, :ts =&gt; task.ts, :author =&gt; task.author_id, :holder =&gt; complect_holder } return task_obj end end</span></span></span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>I would be very happy comments and suggestions.</b>  <b>Thank !</b> </div><p>Source: <a href="https://habr.com/ru/post/261439/">https://habr.com/ru/post/261439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261421/index.html">The magic of tensor algebra: Part 1 - what is a tensor and what is it for?</a></li>
<li><a href="../261425/index.html">Combining Qt and AdMob</a></li>
<li><a href="../261431/index.html">Remote work or freelancing in the outback. Aspects of communication. Part 2. There is a connection</a></li>
<li><a href="../261433/index.html">Good design, bad design ...</a></li>
<li><a href="../261437/index.html">Heme to send SMS (Ruby)</a></li>
<li><a href="../261441/index.html">How we transport data centers (the complexity of data center migration in the middle lane)</a></li>
<li><a href="../261445/index.html">Universal platforms are evil</a></li>
<li><a href="../261447/index.html">How to create a background HTML5 video in an email message</a></li>
<li><a href="../261449/index.html">The first Soviet transistors work</a></li>
<li><a href="../261451/index.html">Throwable exception and php7 errors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>