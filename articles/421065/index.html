<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I taught AI to play Tetris for NES. Part 2: AI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first part (code analysis) is here: https://habr.com/post/420725/ . 

 Algorithm 
 Description 
 The algorithm continuously performs the following...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I taught AI to play Tetris for NES. Part 2: AI</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="image"></div><br>  The first part (code analysis) is here: <a href="https://habr.com/post/420725/">https://habr.com/post/420725/</a> . <br><br><h2>  Algorithm </h2><br><h3>  Description </h3><br>  The algorithm continuously performs the following steps: <br><br><ol><li>  Waiting until a new tetrimino is created. </li><li>  Checks the type of the newly created Tetrimino, the type of the next Tetrimino (a figure in the preview field) and the contents of the playing field. </li><li>  Investigates all possible ways to add two tetrimino to the playing field and evaluates each probability. </li><li>  Moves the newly created Tetrimino to match the location of the best detected probability. </li></ol><br>  Each of these steps is described in detail below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Lock search </h3><br>  Consider a simplified version of Tetris, in which the figures do not fall automatically.  The only way to bring the figure down is a soft descent.  By removing the timings from the game, we can fully describe the state of the active Tetrimino by its position and orientation.  The figure has a known place of initial creation, and the following operations are used to convert from one state to another: <br><br><ul><li>  Move one step down </li><li>  Move one step left </li><li>  Move one step to the right </li><li>  Turn one step counterclockwise </li><li>  Rotate one step clockwise </li></ul><a name="habracut"></a><br>  These operations are applicable only when the squares of the resulting tetrimino correspond to empty cells of the playing field.  When it is impossible to move one step down, the state is considered to be blocked.  However, since we have simplified Tetris and the blocking wait is essentially infinite, the locked state can be further transformed by other operations, performing slips and scrolling. <br><br>  A set of blocked states with a minimal sequence of operations creating them can be found using <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA_%25D0%25B2_%25D1%2588%25D0%25B8%25D1%2580%25D0%25B8%25D0%25BD%25D1%2583">a wide search</a> (breadth-first search, BFS).  As mentioned below, it uses a queue to store intermediate results. <br><br><ol><li>  Queued state at creation. </li><li>  We deduce a status from queue. </li><li>  We receive the subsequent states, applying operations of transformation. </li><li>  If there is no downward movement among them, the dequeued state is disabled. </li><li>  We bring in the next state that we have not visited yet. </li><li>  If the queue is not empty, repeat from step 2. </li></ol><br>  The program presents each state as an object with the following fields: <br><br> <code>{ x, y, rotation, visited, predecessor }</code> <br> <br>  During the preparation process, the program creates a three-dimensional array of state objects (20 rows √ó 10 columns √ó 4 turns), initializing <code>x</code> , <code>y</code> and <code>rotation</code> accordingly. <br><br>  The <code>visited</code> field is marked when the status is enqueued.  In BFS, this is permissible, because each subsequent state increases the total path length by 1. That is, by increasing the path length, it is impossible to create a subsequent state that needs to be inserted somewhere other than the end of the queue to maintain order. <br><br>  The <code>predecessor</code> field points to the state object from which the current state originates.  It is set when the status is queued.  The state of creation has no preceding states. <br><br>  The set of blocked states detected during the search is determined by the type of tetrimino and filled blocks on the playing field.  The sequence of the moves that generated them can be clarified (in the reverse order) by following the <code>predecessor</code> links to the creation state.  When the <code>PLAY_FAST</code> constant is <code>PLAY_FAST</code> to <code>PLAY_FAST</code> at the beginning of the program, it completely skips the preceding states by directly putting tetrimino on the field and blocking it. <br><br>  A three-dimensional array of state objects, a queue, and a BFS are packed into a class.  It has a search method that receives a playing field (two-dimensional array), a type of tetrimino and a listener.  Each time a blocked state is detected, the playing field is updated by adding tetrimino to the appropriate place.  Then, the modified playing field along with information about the changes is transmitted to the listener for processing.  After the listener completes a return, the playing field is restored. <br><br>  The listener is used to combine several search operations into a chain, which makes it possible to find all possible ways to add two (or more) tetrimino to the playing field.  The first search engine in the chain performs BFS only once.  However, the second search engine performs BFS every time the first search detects a blocked state.  And so on, if there are other search engines in the chain. <br><br>  The listener of the last search engine evaluates the changed playing field.  When he finds the playing field better than what was previously investigated, he writes down the used object of the locked state, which at that time uses the first search engine in the chain.  Since the first search engine performs BFS only once, the <code>predecessor</code> fields of its state objects remain valid until the entire search process is completed.  That is, the last listener essentially writes down the path that the first tetrimino should take in order to come to the best configuration of the playing field as a result. <br><br><h3>  Evaluation function </h3><br>  The estimated function assigns a value to a modified game field ‚Äî a weighted sum of the various influencing parameters.  The evaluation function used in this case is based on the function developed by <a href="http://ielashi.com/el-tetris-an-improvement-on-pierre-dellacheries-algorithm/">Islam Al-Ashi</a> .  It uses the following parameters: <br><br><ul><li>  <b>Total number of cleaned rows</b> : this is the total number of rows that will be cleared due to the addition of two tetrimino. </li><li>  <b>Total height of the block</b> : the height of the block is the height above the floor of the playing field on which the figure is blocked.  This is the vertical distance to which a blocked figure would fall, if you remove all other occupied squares of the playing field and preserve the orientation of the figure.  The total blocking height is the sum of the blocking heights of two tetriminos. </li><li>  <b>Total number of ‚Äúwell‚Äù cells</b> : a cell-well is an empty cell located above all occupied cells in a column so that its left and right neighbors are occupied cells;  in determining wells, the walls of the playing field are considered occupied cells.  The idea is that the well is a structure that is open at the top, closed at the bottom and surrounded by walls on both sides.  The likelihood of intermittent gaps in the walls of a well means that cell wells do not necessarily occur in a continuous heap within a column. </li><li>  <b>The total number of holes in the columns</b> : the hole in the column is an empty cell located directly below the occupied cell.  The floor of the playing field is not compared with the cell above it.  There are no holes in the empty columns. </li><li>  <b>Total number of transitions in columns</b> : a transition in columns is an empty cell adjacent to the occupied cell (or vice versa) within a single column.  The combination of the topmost occupied column block with the empty space above it is not considered a transition.  Similarly, the floor of the playing field is also not compared with the cell above it.  Therefore, there is no transition in a completely empty column. </li><li>  <b>Total number of transitions in the rows</b> : the transition in the rows is an empty cell adjacent to the occupied cell (or vice versa) within one row.  Empty slots near the walls of the playing field are considered transitions.  The total number is calculated for all lines of the playing field.  However, completely empty lines are not counted in the total number of transitions. </li></ul><br>  Al-Ashi suggested that useful weights can be found using the particle swarm optimization (PSO) algorithm, which iteratively improves the set of solutions by imitating the swarm behavior observed in nature.  In our case, each solution is a vector of weights, and the fitness of a variant is determined by playing Tetris;  this is the total amount of tetrimino during which he survived to the end of the game. <br><br>  These ideas are applied in the Java version described below;  it runs outside of FCEUX and can be configured for a non-graphical, memory-based game that runs at a much higher speed.  After preparing the PSO, I was surprised to see that the algorithm does not move further after the initial iteration.  After this iteration, several randomly generated solutions have already played quite well.  For several days, the size of this set decreased until there was only one option left.  Here are the values ‚Äã‚Äãfor this solution: <br><br><table><tbody><tr><th>  Parameter </th><th>  Weight </th></tr><tr><td>  Total number of cleaned rows </td><td> <code>1.000000000000000</code> </td> </tr><tr><td>  Total lock height </td><td> <code>12.885008263218383</code> </td> </tr><tr><td>  Total number of well cells </td><td> <code>15.842707182438396</code> </td> </tr><tr><td>  The total number of holes in the columns </td><td> <code>26.894496507795950</code> </td> </tr><tr><td>  Total number of transitions in columns </td><td> <code>27.616914062397015</code> </td> </tr><tr><td>  Total number of transitions in lines </td><td> <code>30.185110719279040</code> </td> </tr></tbody></table><br>  The playing field was estimated by multiplying the parameters by their respective weights and adding the results.  The lower the value, the better the solution.  Since all parameters and weights have positive values, all parameters harm the overall assessment;  each must be minimized.  It also means that the best score is 0. <br><br>  Since these weights were chosen randomly, the range of suitable values ‚Äã‚Äãcan be very wide.  This particular set of numbers and the perceived relative importance of each parameter may not be significant.  Nevertheless, it will be interesting to watch them carefully. <br><br>  The least damaging parameter is the total number of rows cleared.  The very fact that this parameter is harmful is counterintuitive.  But the main goal of AI is survival.  He does not aim for the most points.  Instead, he plays conservatively, usually clearing the rows one by one.  To get a Double, Triple or Tetris will have to grow a bunch, which goes against the long-term goal. <br><br>  Next in the list is the total height of the lock.  It can be minimized by dropping tetrimino as close to the floor as possible.  This is a simple strategy that contributes to survival in the long run and, in the short run, to quality packaging of the pieces. <br><br>  The weight assigned to the total number of well cells seems a little surprising, because experienced players usually deliberately build deep wells to collect several Tetris (combinations of four lines) in a row.  But as mentioned above, this is a risky game, contrary to the main goal - survival.  In addition, the number of wells is an indicator of "bumps" heap.  A certain level of unevenness is beneficial when placing certain shapes or combinations of shapes.  But high unevenness causes damage to the tight package. <br><br>  The total number of holes in the columns is approximately half of the total number of transitions in the columns.  These parameters can be combined and collapsed into a common related parameter, resulting in a more extensive and most harmful parameter: the total number of transitions. <br><br>  The dense packing areas have a small number of transitions in all directions.  Therefore, the basic strategy that drives artificial intelligence, can be briefly described as follows: pack the figures as close as possible to each other. <br><br><h3>  Other options </h3><br>  Here is a list of a few more parameters that I experimented with during the development of AI: <br><br><ul><li>  <b>Heap height</b> : occupied blocks can hang over empty cells, creating protrusions and holes;  however, it is impossible to fix occupied blocks above completely empty lines.  Therefore, the height of the heap is the number of rows that contain at least one occupied block. </li><li>  <b>Total number of columns occupied</b> : this is the number of columns that contain at least one occupied cell. </li><li>  <b>Total number of occupied cells</b> : the number of occupied cells on the playing field. </li><li>  <b>Total Number of Connected Areas</b> : Here, the <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B2%25D0%25BA%25D0%25B0">fill</a> algorithm is used to count the number of continuously connected areas.  In addition to finding busy "islands", he discovers holes that stretch along both axes. </li><li>  <b>Variance of column heights</b> : this is a statistical measure of the magnitude of the scatter of column heights.  It is an indicator of surface roughness. </li><li>  <b>Total Adaption Value</b> : Calculates the heap adaptation value for the next unknown figure.  It counts the total number of ways in which 7 types of pieces can be added to the playing field without the appearance of new holes.  For accurate counting, multiple BFS applications will be required.  But for an approximate count, the search tree can be very truncated. </li><li>  <b>Average score of the next figure</b> : this parameter deepens the search by analyzing all the possibilities for the next unknown figure.  It uses other parameters for a separate arrangement of each type of figures, and then returns the average for 7 estimates.  BFS is required for each shape placement. </li><li>  <b>Averaged simulated game</b> : the parameter simulates a series of games in Tetris, selecting figures using its own pseudo-random number generator and using AI to work with them.  At the end of each game, the playing field is evaluated using other parameters.  Returns the average for all batches. </li></ul><br>  All parameters can be customized by adding custom factors.  For example, instead of simply counting the cleaned rows, you can assign your own weights for Single, Double, Triple and Tetris, by simulating a points system.  If the simultaneous cleaning of several rows harms the long-term goal of survival, then a single weight can be assigned a negative weight, while others can get a positive one. <br><br>  Another useful factor is the bias value.  For example, a completely flat surface of a heap has a dispersion of the heights of columns 0. But a perfectly flat surface does not adapt to S and Z, as well as other combinations of figures.  Therefore, by subtracting a constant, the variance needs to be centered around the optimal irregularity. <br><br>  The adjusted and shifted parameters can be raised to any power so that they can be logarithmically or exponentially scaled before calculating the weighted sum.  All these probabilities can be considered as additional weights that can potentially be optimized using methods like PSO. <br><br>  Many of the parameters give an understanding of how well the heap can handle additional figures, for example, those dealing with surface roughness, but ‚ÄúTotal Adaptation‚Äù, ‚ÄúAverage score of the next figure‚Äù and ‚ÄúAverage simulated game‚Äù estimate the modified playing field insertion of figures not included in the two known.  In the study of subsequent figures due to the rapid elimination of rows, the amount of additional knowledge gained decreases with depth.  This means that the past for a long time the party is not so important, and the course of the party in the distant future is also not very important.  In fact, if the short sequence of pieces is randomly set incorrectly, the AI ‚Äã‚Äãquickly restores the course of the game, using the following few pieces to clear the affected rows.  The determination of the optimal value of the analysis of subsequent figures requires further research. <br><br>  Another aspect of parameter utility is computational overhead.  Costs are greatly increased because the evaluation function is called for each possible placement of two figures.  Since AI must be able to play Tetris in real time, costly factors providing valuable information can be exchanged for more approximate techniques that run faster. <br><br><h3>  AI training </h3><br>  There are pathological sequences that can lead to Game Over, regardless of strategy.  The simplest example is an infinite sequence of T and S S and Z, which, as shown in the animation, quickly causes the AI ‚Äã‚Äãto lose. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb2/66a/2ba/cb266a2ba3575a43876e33f6a2948737.gif"></div><br>  Since it takes days to run the AI ‚Äã‚Äãvariant until several batches are completed and the average is calculated, it is completely impractical to use the average batch duration as the PSO control metric.  Instead, it is possible with controlled speed to increase the difficulty of the game, increasing the frequency of S and Z, which will eventually lead to the alternate creation of only this pair of figures. <br><br>  I tried using this teaching method, but found that teaching AI to work with frequent S and Z actually harms the ability to cope with evenly distributed random figures. <br><br>  In an alternative method, which I was inspired by the B-Type game, the PSO control metric is the frequency of cleaning rows.  The game field is a scheme of 10 lines of random garbage blocks, and each time a line is cleaned, a new line of garbage appears at the bottom, restoring the height of the heap.  Since the playing field is 10 columns wide, and each tetrimino consists of 4 squares, on average, the AI ‚Äã‚Äãshould clear a row every 2.5 tetrimino.  And to get rid of garbage, he must do it even faster. <br><br>  Unfortunately, this technique also did not improve performance.  One of the probable reasons is that random holes in the garbage do not exactly correspond to the lines that the AI ‚Äã‚Äãdeals with in this gameplay.  In addition, row cleaning is a short-term goal;  greedy cleaning of the ranks will not necessarily improve long-term survival.  From time to time, rows should not be touched to handle certain combinations of subsequent figures. <br><br>  On his web page, <a href="http://www.colinfahey.com/tetris/tetris.html">Colin Fay</a> suggested a different approach.  He created a histogram showing the percentage of pieces blocked in each row during trial lots.  Interestingly, all histograms look almost identical regardless of the number of created figures.  Based on this, he suggested that it is possible to use an approximate image of a function for any trial game when evaluating the statistical waiting for a blockage in the creation line, thus obtaining the time during which the AI ‚Äã‚Äãwill play until the end of the game.  I decided to explore this opportunity. <br><br>  The following is a heat map of the set of test lots, in the amount containing 2,039,900,000 tetrimino.  Each cell is colored based on the percentage of figures blocked in it.  To enhance the visual contrast is selected non-linear palette.  The map was created by normalizing the cell values ‚Äã‚Äãby dividing by the maximum percentage of cells, and then by announcing to a degree of 0.19 (see <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B0-%25D0%25BA%25D0%25BE%25D1%2580%25D1%2580%25D0%25B5%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F">‚Äúgamma correction‚Äù</a> ). <br><br><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d13/bcd/196/d13bcd1968b1f71c3311f7007c6f573e.png"></div></td><td><table><tbody><tr><th>  Colour </th><th>  Percent </th></tr><tr><td>  <font color="#000000">‚ñ†</font> </td><td> <code>0.00000000</code> </td> </tr><tr><td>  <font color="#0066FF">‚ñ†</font> </td><td> <code>0.00000315</code> </td> </tr><tr><td>  <font color="#00CCFF">‚ñ†</font> </td><td> <code>0.00024227</code> </td> </tr><tr><td>  <font color="#00FFCC">‚ñ†</font> </td><td> <code>0.00307038</code> </td> </tr><tr><td>  <font color="#00FF66">‚ñ†</font> </td><td> <code>0.01860818</code> </td> </tr><tr><td>  <font color="#00FF00">‚ñ†</font> </td><td> <code>0.07527774</code> </td> </tr><tr><td>  <font color="#66FF00">‚ñ†</font> </td><td> <code>0.23582574</code> </td> </tr><tr><td>  <font color="#CCFF00">‚ñ†</font> </td><td> <code>0.61928352</code> </td> </tr><tr><td>  <font color="#FFCC00">‚ñ†</font> </td><td> <code>1.42923040</code> </td> </tr><tr><td>  <font color="#FF6600">‚ñ†</font> </td><td> <code>2.98867416</code> </td> </tr><tr><td>  <font color="#FF0000">‚ñ†</font> </td><td> <code>5.78182519</code> </td> </tr></tbody></table></td></tr></tbody></table><br>  The dark orange and red bars in lines 17 and 18 mean that the vast majority of the figures end up there.  The pale green tint below is a consequence of the geometry of the figures: only 4 of the 7 types of tetrimino can appear on the bottom line.  The bottom corners are black because it‚Äôs impossible to be there. <br><br>  The color along each line is almost uniform, and this suggests that horizontally the figures are distributed evenly.  Minor gaps can be explained by looking at the histograms of certain types of shapes: <br><br><table><tbody><tr><td>  <b>T</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/fb3/c14/82cfb3c1456fce7726985859554021d8.png"></div></td><td>  <b>J</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/f38/1a2/ebdf381a25323b9c73eaed6c467064b5.png"></div></td><td>  <b>Z</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/381/986/389/38198638921c4dcbc3a8f1978e665b89.png"></div></td><td>  <b>O</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/669/be1/5e4/669be15e4ba1b9becffb4ee97e398cbb.png"></div></td><td>  <b>S</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/79c/2a5/dc879c2a52f1020a69f76e9554fca978.png"></div></td><td>  <b>L</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbf/204/acb/fbf204acb6d376818fc6e98f8f517e4e.png"></div></td><td>  <b>I</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bb/e41/92b/7bbe4192bbb2204d4b677a9a36354da2.png"></div></td></tr></tbody></table><br>  T turns out to be the most universal type: its histogram is more uniform than that of all others.  Anomalies in the histogram J - the result of the influence of the walls;  only <code>Jr</code> and <code>Jl</code> can be in the side columns, which causes the AI ‚Äã‚Äãto use columns 1 and 9 more often to compensate. The same applies to L. The histograms Z and S look about the same, which underlines the imbalance due to the fact that <code>Zv</code> and <code>Sv</code> not perfect mirror images of each other.  Type O is limited to the 19 √ó 9 playing field, and it seems that the AI ‚Äã‚Äãtends to use O more often on the sides than in the center.  Tetrimino I is shifted to the right, because its starting point is located there;  therefore, blocking in column 1 rarely happens. <br><br>  The table shows the percentage of figures blocked in each row. <br><br><table><tbody><tr><th>  Line </th><th>  Percent </th></tr><tr><td>  0 </td><td>  0.0000000000 </td></tr><tr><td>  one </td><td>  0.0000000000 </td></tr><tr><td>  2 </td><td>  0.0000004902 </td></tr><tr><td>  3 </td><td>  0.0000026472 </td></tr><tr><td>  four </td><td>  0.0000066180 </td></tr><tr><td>  five </td><td>  0.0000172557 </td></tr><tr><td>  6 </td><td>  0.0000512280 </td></tr><tr><td>  7 </td><td>  0.0001759400 </td></tr><tr><td>  eight </td><td>  0.0006681210 </td></tr><tr><td>  9 </td><td>  0.0023187901 </td></tr><tr><td>  ten </td><td>  0.0077928820 </td></tr><tr><td>  eleven </td><td>  0.0259672043 </td></tr><tr><td>  12 </td><td>  0.0866187068 </td></tr><tr><td>  13 </td><td>  0.2901315751 </td></tr><tr><td>  14 </td><td>  0.9771663807 </td></tr><tr><td>  15 </td><td>  3.3000408353 </td></tr><tr><td>  sixteen </td><td>  10.6989059268 </td></tr><tr><td>  17 </td><td>  28.5687976371 </td></tr><tr><td>  18 </td><td>  50.0335706162 </td></tr><tr><td>  nineteen </td><td>  6.0077671454 </td></tr></tbody></table><br>  Here is a graph of values: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a6/943/9d8/8a69439d8d818e46921cc5c9b75bd345.png"></div><br>  If you do not take into account line 19, the graph shows exponential growth. <br><br>          . <br><br><table><tbody><tr><th>  <sub>A</sub> / <sub>B</sub> </th><th>  (%) </th></tr><tr><td>  1/2 </td><td> 0.00 </td></tr><tr><td>  2/3 </td><td> 18.52 </td></tr><tr><td>  3/4 </td><td> 40.00 </td></tr><tr><td>  4/5 </td><td> 38.35 </td></tr><tr><td>  5/6 </td><td> 33.68 </td></tr><tr><td>  6/7 </td><td> 29.12 </td></tr><tr><td> 7/8 </td><td> 26.33 </td></tr><tr><td> 8/9 </td><td> 28.81 </td></tr><tr><td>  9/10 </td><td> 29.76 </td></tr><tr><td> 10/11 </td><td>  30.01 </td></tr><tr><td> 11/12 </td><td> 29.98 </td></tr><tr><td> 12/13 </td><td> 29.85 </td></tr><tr><td> 13/14 </td><td> 29.69 </td></tr><tr><td> 14/15 </td><td> 29.61 </td></tr><tr><td> 15/16 </td><td> 30.84 </td></tr><tr><td> 16/17 </td><td> 37.45 </td></tr><tr><td> 17/18 </td><td> 57.10 </td></tr><tr><td> 18/19 </td><td> 832.81 </td></tr></tbody></table><br>   <code>16‚Äì19</code>  ,     ,    .   <code>0‚Äì5</code>    ,   .  ,  6/7‚Äì14/15,  ;     29.24%.  ,   ,             .   ,    Tetris         . <br><br>    log <sub>10</sub>     6‚Äì15. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd6/7ec/745/fd67ec745b6509ae7c165ae0ebabedcc.png"></div><br>          1 <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D1%258D%25D1%2584%25D1%2584%25D0%25B8%25D1%2586%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582_%25D0%25B4%25D0%25B5%25D1%2582%25D0%25B5%25D1%2580%25D0%25BC%25D0%25B8%25D0%25BD%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8"> </a> . ,     <a href="http://en.wikipedia.org/wiki/Simple_linear_regression"> </a> ,      Y, ,      0   10 <sup>‚àí7.459</sup> %. ,   ,      2 877 688 349   1 151 075 340    . <br><br>    ,  log <sub>10</sub>           0.        ,      ,    .  ,     0    game over;   ,       . <br><br>                  .       5 . ,   ,           O.   ,      4 ,     ‚Äî 10 ,           5 (  <i>4√ó5n = 2√ó10n</i> ). <br><br>             1181 ‚Äî   .      ,          ,       game over.       <code>SZ</code> ,         . <br><br>      ( ) ,           . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7f/665/112/f7f66511246ef114d27d325a21c9b785.png"></div><br>          , ,  .   ,  0,4%   1  253 ,     ,      5 . <br><br>   ,   ,           ,  R <sup>2</sup>   1,      PSO.  ,    ,      ,       .              PSO,   ,          ,        . <br><br><h3>   Java </h3><br><h4>  About the program </h4><br>  ,   Lua,    <a href="">zip-  </a>    Java.      <a href="http://lua-users.org/wiki/ObjectOrientationTutorial"> Lua   </a> . <br><br><h4>  Packages </h4><br>     : <br><br><ul><li> <code>tetris.ai</code>     . </li><li> <code>tetris.gui</code>     . </li></ul><br><h4>     </h4><br>     <code>Tetriminos</code>  .    <code>enum</code>       : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NONE = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> T = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> J = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Z = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> O = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> S = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> L = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> I = <span class="hljs-number"><span class="hljs-number">6</span></span>;</code> </pre> <br> <code>NONE</code>   .       . <br><br>   <code>Tetriminos</code>     . <code>PATTERNS</code> ‚Äî  4-  integer ( √ó  √ó  √ó ),    ;   ,         . <code>ORIENTATIONS</code> ‚Äî   , 2-  ( √ó )  <code>Orientation</code> .  <code>Orientation</code>       <code>Point</code> .     ,       . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Orientation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point[] squares = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> minX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxY; ... }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Point</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; ... }</code> </pre> <br>   (     )    <code>State</code> ,   BFS. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visited; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State predecessor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State next; ... }</code> </pre> <br> <code>x</code> , <code>y</code>  <code>rotation</code>      .           ,    . <br><br>  <code>Searcher</code> ,     BFS,        <code>State</code>  : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ states = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State[AI.PLAYFIELD_HEIGHT][AI.PLAYFIELD_WIDTH][<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; AI.PLAYFIELD_HEIGHT; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; AI.PLAYFIELD_WIDTH; x++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation = <span class="hljs-number"><span class="hljs-number">0</span></span>; rotation &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; rotation++) { states[y][x][rotation] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(x, y, rotation); } } } }</code> </pre> <br>   Java   Collections API, <code>Searcher</code>    .  <code>Queue</code>  <code>State.next</code>    <code>State</code>   .    <code>State</code>  ,   <code>State</code>         ,      ,       -,     . <br><br> ¬´¬ª BFS     <code>search</code> . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxRotation = Tetriminos.ORIENTATIONS[tetriminoType].length - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mark = globalMark++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(queue.isNotEmpty()) { State state = queue.dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">0</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == <span class="hljs-number"><span class="hljs-number">0</span></span> ? maxRotation : state.rotation - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">1</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == maxRotation ? <span class="hljs-number"><span class="hljs-number">0</span></span> : state.rotation + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } addChild(playfield, tetriminoType, mark, state, state.x - <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); addChild(playfield, tetriminoType, mark, state, state.x + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, state, state.x, state.y + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.rotation)) { lockTetrimino(playfield, tetriminoType, id, state); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br>       ,           ,     ,      . <br><br>   <code>search</code>   ,      ,      .    BFS       . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISearchListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span></span>; }</code> </pre> <br>     ,     .        .    <code>State</code> ,    .     <code>State.predecessor</code> ,       <code>State</code>  . <br><br> <code>State.visited</code>     <code>boolean</code> ;           <code>State</code>   <code>visited</code>  <code>false</code> .     <code>visited</code>  <code>int</code> ,   ,    . <br><br>  <code>addChild</code>      .            4    .  ,      <code>State</code> .   , <code>addChild</code>  <code>true</code> ,         ,     . <br><br>  <code>search</code>   <code>addChild</code>    ,    .    ,         ;    <code>false</code> . <br><br>  <code>addChild</code>           .    ,          <code>lockTetrimino</code> .  <code>lockTetrimino</code>   ,  ,     . <br><br>    <code>playfield</code>  1  ,        .     <code>lockTetrimino</code> ,      . <br><br>      ,   <code>PlayfieldUtil.clearRows</code>    ;   ,       .       ,   Java       ;       . <code>PlayfieldUtil</code>   ;    ,       .           .       . <br><br>    <code>PlayfieldUtil.restoreRows</code>   ,    .     .      .            .             . ,   ,       ‚Äî      . <br><br>  <code>PlayfieldUtil</code>    <code>evaluatePlayfield</code> ,     4      -. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayfieldEvaluation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> holes; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wells; }</code> </pre> <br>     <code>AI</code> .     <code>Searcher</code> ,     . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == <span class="hljs-number"><span class="hljs-number">0</span></span>) { result0 = state; } Orientation orientation = Tetriminos.ORIENTATIONS[tetriminoType][state.rotation]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = playfieldUtil.clearRows(playfield, state.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalRows = totalRows; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalDropHeight = totalDropHeight; totalRows += rows; totalDropHeight += orientation.maxY - state.y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextID = id + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextID == tetriminoIndices.length) { playfieldUtil.evaluatePlayfield(playfield, e); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fitness = computeFitness(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fitness &lt; bestFitness) { bestFitness = fitness; bestResult = result0; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { searchers[nextID].search(playfield, tetriminoIndices[nextID], nextID); } totalDropHeight = originalTotalDropHeight; totalRows = originalTotalRows; playfieldUtil.restoreRows(playfield, rows); }</code> </pre> <br>  <code>AI</code>      <code>Searcher</code> ,  Nintendo Tetris     .  <code>Searcher</code>   ,          .  ,    <code>Searcher.search</code> ,      ,     .         <code>Searcher</code>  .     ,    .           ,    <code>State</code>   <code>Searcher</code>  . <br><br> <code>AI</code>   <code>search</code> ,     ,      .   <code>State</code> ,    ,      .       ;        .       <code>Searcher</code>     ,  <code>AI.search</code>  <code>null</code> . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] tetriminoIndices)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tetriminoIndices = tetriminoIndices; bestResult = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; bestFitness = Double.MAX_VALUE; searchers[<span class="hljs-number"><span class="hljs-number">0</span></span>].search(playfield, tetriminoIndices[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bestResult; }</code> </pre> <br><h4>   </h4><br>    Java    FCEUX,       .  ,     - ,      . <br><br> -,   <code>AI</code> ,  <code>PlayfieldUtil</code>        .  ,   <code>PlayfieldUtil.createPlayfield</code>   ;       ,    . ,      . <br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random();</code> </pre> <br>    ,      <code>Tetriminos.NONE</code> .     ,      <code>playfield[rowIndex][AI.PLAYFIELD_WIDTH]</code>      . <br><br>           ,      . <br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br>          <code>AI.search</code> .   <code>State</code> ,      .    <code>null</code> ,   game over. <br><br><pre> <code class="java hljs">State state = ai.search(playfield, tetriminos);</code> </pre> <br>         ,   <code>State</code>  <code>AI.buildStateList</code> . <br><br><pre> <code class="java hljs">State[] states = ai.buildStatesList(state);</code> </pre> <br>       <code>PlayfieldUtil.lockTetrimino</code>       <code>State</code> .      . <br><br><pre> <code class="java hljs">playfieldUtil.lockTetrimino(playfield, tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>], state);</code> </pre> <br>    <code>AI.search</code>      . <br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>]; tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br>      : <br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// ... print playfield ... State state = ai.search(playfield, tetriminos); if (state == null) { break; // game over } playfieldUtil.lockTetrimino(playfield, tetriminos[0], state); tetriminos[0] = tetriminos[1]; tetriminos[1] = random.nextInt(7); }</span></span></code> </pre> <br>              ‚Ä¶ <br><br><h4>    </h4><br>  <code>TetrisFrame</code>   Nintendo Tetris,     ,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d58/dac/a4c/d58daca4c668408a42efa51ad7508d75.png"></div><br>     ,  <code>tetris.gui.Main</code> .        Lua,           . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> PLAY_FAST = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br> <code>TetrisFrame</code>  4    .  <code>displayTetrimino</code>      .    ,         . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">displayTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay)</span></span></span></span></code> </pre> <br>  <code>lockTetrimino</code>    .     , ,    ,         .   <code>animate</code>  <code>true</code>          Tetris.     . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lockTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br> <code>updateStatisticsAndNext</code>             . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStatisticsAndNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> activeTetrimino, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nextTetrimino)</span></span></span></span></code> </pre> <br>  <code>dropTetrimino</code>         ¬´¬ª,       . <code>Main</code>      ,  <code>AI.search</code>  <code>null</code> .   <code>animate</code>   <code>true</code> ,         .        ,      .   <code>true</code>  ,        . <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dropTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br>  4     ,   <code>TetrisFrame</code>    Event Dispatch Thread.  ,   , .  <code>Main</code> . <br><br>   <code>Main</code>   <code>Randomizer</code> ,       Nintendo Tetris. <br><br>  <code>tetris.gui.images</code>     . <code>tiles.png</code> ‚Äî   ,    . <code>background.dat</code>   ,    ;    <code>$BF3F</code> .  <code>colors.dat</code>  ,    ,    138. <br><br> <code>ImageLoader</code>    NES,   <code>ImagePane</code>      . <br><br><h4>  Other projects </h4><br>         .        ,  ,        .   ,         seed   ,      .      .      ,          .    (     49   ),         seed   ,     .      ,     ,   .  ,       ,     . <br><br>          ¬´  ¬ª.   ¬´¬ª             ,   .           ,         B-Type. ,   ,   ,        .       ,    .      ,      <code>IChildFilter</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IChildFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation)</span></span></span></span>; }</code> </pre> <br> <code>AI</code>   ,   <code>IChildFilter</code> .   <code>IChildFilter.validate</code>         ;    <code>false</code> ,       . <br><br> <code>WellFilter</code> ‚Äî   <code>IChildFilter</code> ,      (Tetris).   ,          ,    .    ,    ,       .      -  ,    .   4    ,   ¬´¬ª      Tetris.  ,   ;     ,  <code>WellFilter</code>    . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82b/c27/710/82bc27710c0e5200d599be07bf549206.png"></div><br>     ,   <code>Main</code>  : <br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WellFilter());</code> </pre> <br> <code>WellFilter</code> ,    .    ,    .   Tetris ,     ,  ,      PSO. <br><br>  ,        .    ,    <code>PatternFilter</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/569/e21/15f/569e2115f8936fc3391d1bb330017d8a.png"></div><br> <code>PatternFilter</code>     ,  ,   <code>WellFilter</code> ;       <code>PatternFilter</code>    ,   . <br><br>  <code>PatternFilter</code>        <code>tetris.gui.patterns</code> ,     .     20√ó10     ,    . <br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PatternFilter(<span class="hljs-string"><span class="hljs-string">"tetriminos"</span></span>));</code> </pre> <br>         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb3/0c8/d79/cb30c8d795e12e41d3831a0735637a55.png"></div><br>       T,   . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf0/f95/14c/cf0f9514c3a08b88c4f67117614ade91.png"></div><br>  One more example.  ,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/712/284/a267122840a2373e7bb5fb6fa6282018.png"></div><br>   <code>WellFilter</code> , <code>PatternFilter</code>   ,  proof of concept.         - ,       game over.   ,   ,   . <br><br><h3>    </h3><br>   Lua    Java  ;      ,              ,      .  -     Tetris,     .   <a href="">zip-  </a>     Lua,        ,      ,    . <br><br>      ,        .        ,        .  Here are the most important ones: <br><br><ul><li>       : ,   . </li><li>   ¬´¬ª   . </li><li>   ¬´¬ª  ¬´¬ª    . </li><li>         . </li><li>          . </li><li>          . </li><li>          . </li><li>   ,        . </li><li>   A  B           . </li><li>  ¬´¬ª  ¬´¬ª       6      16 .     ¬´¬ª  ¬´¬ª   ,     . </li><li>  ¬´¬ª            3 . </li><li>       96 .    ,    ‚Äî . </li></ul><br>     ,       .   ,                .    ,     <code>x</code> , <code>y</code>        .  ,    ,       .        . <br><br>    <code>State</code>   : <br><br><pre> <code class="java hljs">{ x, y, rotation, Left, Right, Down, A, B, fallTimer, visited, predecessor }</code> </pre> <br>             . ,     ,   ,      .    ,        A  B.   <code>Left</code> , <code>Right</code> , <code>A</code>  <code>B</code>    ,     : <br><br><pre> <code class="java hljs">{ RELEASED, PRESSED }</code> </pre> <br>   ,           ¬´¬ª,    4 : <br><br><pre> <code class="java hljs">{ RELEASED, PRESSED_FOR_1_FRAME, PRESSED_FOR_2_FRAMES, PRESSED_FOR_3_FRAMES }</code> </pre> <br> <code>Down</code>     <code>RELEASED</code>  <code>PRESSED_FOR_3_FRAMES</code> ,     .       <code>RELEASED</code>    <code>PRESSED_FOR_2_FRAMES</code> ,         .     <code>RELEASED</code>  <code>PRESSED_FOR_1_FRAME</code>   <code>PRESSED_FOR_2_FRAMES</code> . <br><br>       Lua   ,    . <br><br>  <code>visited</code>  <code>predecessor</code> , <code>fallTimer</code>   ,       ;  <code>fallTimer</code>       . ,  <code>fallTimer</code> ,   , ,       ,        <code>fallTimer</code>   0. <br><br>  <code>Searcher</code>   <code>8-</code> ,     ( <code>20  √ó 10  √ó 4  √ó 2  √ó 2  √ó 4  √ó 2 A √ó 2 B</code> ),  BFS   ,   <code></code> .     ,         . <br><br><pre> <code class="cpp hljs">Slide = (Left == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (Right == PRESSED) Rotate = (A == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (B == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Down == PRESSED_FOR_3_FRAMES then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED then nextDown = PRESSED_FOR_1_FRAME <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_2_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Slide then addChild() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED) addChild(B = PRESSED) end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> addChild(Left = PRESSED) addChild(Right = PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(Left = PRESSED, A = PRESSED) addChild(Left = PRESSED, B = PRESSED) addChild(Right = PRESSED, A = PRESSED) addChild(Right = PRESSED, B = PRESSED) end end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_1_FRAME then nextDown = PRESSED_FOR_2_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_3_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end end</code> </pre> <br>      ,  <code>addChild</code>   ,     (, ,   ). <br><br><pre> <code class="cpp hljs">nextFallTimer = fallTimer + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Left == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x - <span class="hljs-number"><span class="hljs-number">1</span></span> elseif Right == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x + <span class="hljs-number"><span class="hljs-number">1</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> A == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextClockwiseRotation) then rotation = nextClockwiseRotation elseif B == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextCounterclockwiseRotation) then rotation = nextCounterclockwiseRotation end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_3_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> nextFallTimer &gt;= dropSpeed then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> testPosition(x, y + <span class="hljs-number"><span class="hljs-number">1</span></span>, rotation) then y = y + <span class="hljs-number"><span class="hljs-number">1</span></span> nextFallTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> lockTetrimino() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> end end childState = states[y][x][rotation][Left][Right][Down][A][B] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> childState.visited then childState.visited = mark childState.predecessor = state childState.fallTimer = nextFallTimer <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.enqueue(childState) end</code> </pre> <br>     , <code>AI.search</code>    <code>State</code> .      <code>State</code>   ,      .  <code>x</code> , <code>y</code>  <code>rotation</code>     ,         . <br><br>         ,       1‚Äì3 .   ,        .  ,    ;       .   ,      ,    ,    . <br><br>   ,  <code>lua/NintendoTetrisAIGamepadVersion.lua</code> ,   <a href="">zip-  </a> . <br><br>            ,    ,      .    ,       ,          ; ,     ‚Äî     ,    .       ,     ,      ,    .      ,         .   ,  ¬´¬ª,     ,  . <br><br><h2>  Addition </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="TETRIS"></div><br>    ,     ¬´¬ª.      : <br><br><ol><li>   ,     ,        Nintendo Tetris.      ,          .      ,  .   ,   . </li><li>   .    ‚Äî  ,      .     Double, Triple  Tetris,         ‚Äî  ,    .         90.    ,   ,       29   -     . </li><li>          .      .       .     ,  Tetris      . </li></ol><br>        ,   Nintendo Tetris   .      ,            . <br><br><hr><br><h1>  Video </h1><br>   ,       Nintendo Tetris,    19     . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/l2YOt_GdfA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zsd3eAYMlN0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/efh-_zeQH4Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><hr><h1>  </h1><br> <a href="">TetrisAI_2018-01-28.zip</a> <br><br>   <code>.zip</code> : <br><br><ul><li> <code>src</code> ‚Äî   . </li><li> <code>TetrisAI.jar</code> ‚Äî   . </li><li> <code>lgpl-2.1.txt</code> ‚Äî   . </li></ul><br><hr><br><h1>  </h1><br><h2>  Prerequisites </h2><br><ul><li> <a href="http://nintaco.com/">Nintaco</a> ‚Äî  NES / Famicom. </li><li> <code>Tetris (U) [!].nes</code> ‚Äî ROM- Nintendo Tetris. </li></ul><br><h2>   </h2><br><ol><li>  Nintaco   <code>Tetris (U) [!].nes</code> . </li><li>  <code>TetrisAI.jar</code>   <code>.zip</code> . </li><li>   Run Program,  Tools | Run Program... </li><li>        JAR        Find JAR‚Ä¶ . </li><li>  Load JAR,   . </li><li>  Run. </li><li>        ,       <code>GAME TYPE</code>  <code>MUSIC TYPE</code> .   <code>D-pad</code> (     )  <code>A-TYPE</code>   .   Start (Enter),      . </li><li>    <code>A-TYPE</code>  <code>D-pad</code> (  )   <code>LEVEL 9</code> . ,    <code>A</code>    Start (   <code>X</code>   Enter),     19,    . </li></ol><br>  ,       19  .         . <br><br><h2>   </h2><br>    ,  Machine | Speed |  Max. <br><br><hr><br><h1>  Details </h1><br><h2>  </h2><br>   10       ,   .    10     ,         .      .        ,    .           : 10‚Äì12, 13‚Äì15, 16‚Äì18, 19‚Äì28  29+  5, 4, 3, 2  1   . <br><br>       19‚Äì28.        ¬´¬ª, ¬´¬ª, A, B  .         ,    . ,      ,   ;        . <br><br>    ,    ,       (Delayed Auto Shift, DAS),     ¬´¬ª,     .     <a href="http://mentalfloss.com/article/12380/whos-best-tetris-player-world">     </a> .        ,  . <br><br>   40, 100, 300  1200   Single, Double, Triple  Tetris.         1.  ,           Tetris,       . <br><br>  19  ,      ,        19‚Äì28.        ,       ,     20   140 ,   200.        10 .    230        .         Tetris   230 . <br><br><h2>   </h2><br>       .             .    ,      ,    .               .        ,        . <br><br>        .   ,      ,  ¬´¬ª    .                . <br><br><h2>   </h2><br>            .   ‚Äî  ,        ,     .            ,   .           BSF. <br><br>       : 4    ,     ,   .                  ,   .     <code>SearchChain</code> . <br><br>        ,     .           .        .             ,   . <br><br><h2>   </h2><br>   ‚Äî     : <br><br><ul><li> <strong>   </strong> ‚Äì  ,     . </li><li> <strong>  </strong> ‚Äì      ,   .     ‚Äî   ,        ,       . </li><li> <strong>  -</strong> ‚Äì    . </li><li> <strong>   </strong> ‚Äì  ,     -. </li><li> <strong>    </strong> ‚Äì   ,      .         .     . </li><li> <strong>     </strong> ‚Äì      .       ,   1.   ,         ,           . </li><li> <strong>     </strong> ‚Äì         ,    .  ‚Äî        ,    ‚Äî          . </li><li> <strong>    </strong> ‚Äì     .   ,         (20). </li><li> <strong>    </strong> ‚Äì     .   ,      0. </li><li> <strong>    </strong> ‚Äì   ,     ( )    . </li><li> <strong>    </strong> :    ‚Äî   ,     ( )    .         .        .          . </li><li> <strong>   </strong> ‚Äì           . ,   1  ,   1,     ‚Äî  0. </li><li> <strong> </strong> ‚Äì   . </li><li> <strong>  </strong> ‚Äì         . </li><li> <strong>   </strong> ‚Äì      . </li><li> <strong>    </strong> ‚Äì     .     . </li><li> <strong>  </strong> ‚Äì        . </li></ul><br><h2>  Machine learning </h2><br>           (Particle Swarm Optimization, PSO),    [1].           .          . <br><br>       ,      .  ,    (     ), PSO        ,       . <br><br>        100     19‚Äì28.     230 ,     .   ,        33  100 .       .          ,     .         ,   ¬´¬ª. <br><br>    100      PSO,          .       ,  ,         .       PRNG Nintendo Tetris,          .   PRNG     (.  ¬´ ¬ª   ):     . <br><br>    ,   .     19‚Äì28,      . ,  ,        .      ¬´¬ª     : <br><br><ol><li>    :        Tetris,   .      ¬´¬ª          .          .     ;     230 .  ,      Tetris   .        Single, Double  Triple.          ;        . </li><li>          .      ,   ,      7 .         . </li><li>  ,          ,           .        ,       7 . </li><li>          ,      ,      .       ,       .         ,      . </li></ol><br>      ¬´¬ª ,  PSO   : <br><br><table><tbody><tr><th>  Parameter </th><th>  Weight </th></tr><tr><td>     </td><td> 0.286127095297893900 </td></tr><tr><td>    </td><td> 1.701233676909959200 </td></tr><tr><td>   - </td><td> 0.711304230768307700 </td></tr><tr><td>     </td><td> 0.910665415998680400 </td></tr><tr><td>      </td><td> 1.879338064244357000 </td></tr><tr><td>       </td><td> 2.168463848297177000 </td></tr><tr><td>       </td><td> ‚àí0.265587111961757270 </td></tr><tr><td>      </td><td> 0.289886584949610500 </td></tr><tr><td>      </td><td> 0.362361055261181730 </td></tr><tr><td>      </td><td> ‚àí0.028668795795469625 </td></tr><tr><td>      </td><td> 0.874179981113233100 </td></tr><tr><td>     </td><td> ‚àí0.507409683144361900 </td></tr><tr><td>   </td><td> ‚àí2.148676202831281000 </td></tr><tr><td>    </td><td> ‚àí1.187558540281141700 </td></tr><tr><td>     </td><td> ‚àí2.645656132241128000 </td></tr><tr><td>      </td><td> 0.242043416268706620 </td></tr><tr><td>    </td><td> 0.287838126164431440 </td></tr></tbody></table><br>     ,   , ,   ,   ,   ‚Äî .        ;   ,    . <br><br><h2>   </h2><br>        1,7   ( )     19‚Äì28.       29  ,    ,    .     ,   -  .       PRNG Nintendo Tetris. <br><br>       1 313 600.  ‚Äî 0. <br><br>    816 379,  ,   .    ,  ,          ‚Äî 989 200 . <br><br>   , PSO          .         1 108 860.       75%  1 000 000. <br><br>     47%      29.     61%  900 000    29.           29. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/082/43a/5a808243a35de546e886bcf6cc8663aa.png" alt="probability density"></div><br> ,       900 000 .       . <br><br>             .       . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b4/cf4/a7c/7b4cf4a7cfc06203bedef3b81243d20b.png" alt="histogram"></div><br>   ,    900 000  ,           1 050 000 .   . ,       ,  20 000 . ,         Tetris. <br><br><h2>     </h2><br>     ,           <a href="http://nintaco.com/api.html">Nintaco API</a> .         Nintaco,     <a href="https://datacrystal.romhacking.net/wiki/Tetris_(NES)">Data Crystal ROMhacking.net wiki</a> .          <code>Addresses</code> . <br><br><hr><br><h1>   </h1><br><ol><li> van den Bergh, F.; Engelbrecht, AP (2006) <br> A study of particle swarm optimization particle trajectories <br> In: <i>Information Sciences 176 (2006)</i> (pp. 937‚Äì971) <br> Retrieved from <a href="http://researchspace.csir.co.za/dspace/bitstream/handle/10204/1155/van%2520den%2520bergh_2006_D.pdf">http://researchspace.csir.co.za/dspace/bitstream/handle/10204/1155/van%20den%20bergh_2006_D.pdf</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/421065/">https://habr.com/ru/post/421065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421055/index.html">Custom web development: how to scale on an ever-growing project</a></li>
<li><a href="../421057/index.html">How to collect cars for passenger trains</a></li>
<li><a href="../421059/index.html">Accelerating sites with the help of "early tips"</a></li>
<li><a href="../421061/index.html">PostgreSQL: how and why swells wal</a></li>
<li><a href="../421063/index.html">New books on children's programming on Scratch</a></li>
<li><a href="../421067/index.html">How we developed the AR-application for the review of historical places</a></li>
<li><a href="../421069/index.html">Backpack Bobby Urban: the inner world under lock and key</a></li>
<li><a href="../421071/index.html">Mod and remainder are not the same</a></li>
<li><a href="../421073/index.html">Episode 1. Cost Hack'a</a></li>
<li><a href="../421075/index.html">Digital Dictionary from A to Z</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>