<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nalivator-9000: robot barman on Raspberry Pi and Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of years ago, I came across a Kickstarter project on Bartendro . I liked the idea, and I decided that the ideal application for my newly acqu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nalivator-9000: robot barman on Raspberry Pi and Go</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6ad/a1c/203/6ada1c20301741c7b9cdbf87758ce157.jpg"><br><br>  A couple of years ago, I came across a Kickstarter project on <a href="https://www.kickstarter.com/projects/partyrobotics/bartendro-a-cocktail-dispensing-robot">Bartendro</a> .  I liked the idea, and I decided that the ideal application for my newly acquired Raspberry Pi was found.  I figured out what details would be needed, and proceeded to the DIY implementation of the robot barman.  Briefly tell what came out of it. <br><a name="habracut"></a><br><h2>  Hardware </h2><br>  The main element of the whole structure, of course - the pumps.  In the original Bartendro project, proprietary peristaltic pumps are used (by the way, the entire project is available in <a href="https://github.com/partyrobotics/bartendro">github</a> ). <br><br>  A peristaltic pump is a pump that pushes its contents through the tube, as if a tube of paste were squeezing out.  Accordingly, one end is dropped into the bottle, and the other into the glass.  Gifka with Wikipedia with the principle of action: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://upload.wikimedia.org/wikipedia/commons/9/95/Peristaltic_pump.gif" alt="image"></div><br>  Similar to the original Bartendro pumps available on <a href="https://ru.aliexpress.com/item/DC-12V-Peristaltic-Pump-with-1100ml-min-Flow-Rate-and-30psi-output-pressure/1096126424.html">Aliexpress</a> .  Practice has shown that they are good in operation, because  they remove the front panel with a tube - it is very convenient to wash after a feast. <br><br>  The Raspberry Pi has GPIO connectors on the board.  By means of them, signals ‚Äú1‚Äù or ‚Äú0‚Äù, 3.3V and 0V are sent or received, respectively.  The specification for the pump indicates that its operating voltage is 12V, and the ‚Äúcrimson‚Äù 3.3V will not be enough here.  Therefore, to work you will need another power supply, and you can control it using a transistor switch.  The final scheme looks like this: <br><div style="text-align:center;"><img src="https://4te.me/img/scheme.png" width="360" height="378"></div><br>  To select a transistor, it is necessary that the collector-emitter voltage and the maximum collector current be at least 1.5‚Äì2 times higher than necessary.  I chose the <a href="http://www.farnell.com/datasheets/56743.pdf">BDX33B</a> , its collector-emitter voltage is 80V, and the maximum collector current is 10A, which is enough for a pump with a starting current of 2A and a voltage of 12V.  In order to open the transistor, on the base you need to get no more than 2.5V.  We consider the divider in some online calculator - we get R1 = 150 Ohm, R2 = 300 Ohm. <br><br>  As a whistle player, I added three LEDs connected to three other GPIO pins, which will designate a running motor, as well as will be needed when visualizing a speech synthesizer.  At the GPIO outputs, you can hang a maximum load of 15 mA per pin, or 50 mA in total.  Therefore, I connect the LEDs through the resistors of 300 Ohms, the current in this case will be ~ 4 mA per pin. <br><br>  Now you can go to the nearest radio parts store and try to collect. <br><br><h2>  Software </h2><br>  Raspberry Pi is generally a rather slow thing - for example, Django, on which I originally wanted to make a web application, runs a few minutes.  Therefore, I decided to abandon it in favor of something lightweight, namely Go.  It compiles quickly, cross-compiling under linux-arm on my PC takes about 20 seconds.  At the output we get a small size binary, which is statically assembled and carries all dependencies inside.  It can be immediately rsync-ohm copied to a raspberry pi and checked.  Very convenient for such small applications.  Cross-compilation options for linux-arm look like this: <br><br><pre><code class="bash hljs">GOOS=linux GOARCH=arm GOARM=6 go build</code> </pre> <br>  Different versions of Raspberry Pi have different versions of ARM.  You can find out your version in <i>/ proc / cpuinfo</i> <br><br>  Since the pumps do not have any volume sensors poured in, but the throughput is known, the volume can be monitored through the running time of the pump.  Empirically, I found out - to pour 100 milliliters, you need to keep the pump on for 30 seconds.  It turns out you need to write an application that, on command, turns on the pumps for a certain time in turn.  In this implementation, it is implied that Plymvator is able to make only one cocktail, that is, he has only one button - ‚ÄúPour‚Äù. <br><br>  I made a config that describes the connected pumps and the cocktail that needs to be poured. <br><br><div class="spoiler">  <b class="spoiler_title">The format is</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"cname"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pumps"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tequila"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pump_pin"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-attr"><span class="hljs-attr">"led_pin"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-attr"><span class="hljs-attr">"duration"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Juice"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pump_pin"</span></span>: <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-attr"><span class="hljs-attr">"led_pin"</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-attr"><span class="hljs-attr">"duration"</span></span>: <span class="hljs-number"><span class="hljs-number">49</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Grenadine"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pump_pin"</span></span>: <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-attr"><span class="hljs-attr">"led_pin"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-attr"><span class="hljs-attr">"duration"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> } ] }</code> </pre><br></div></div><br>  This config reads the Livator at startup, and understands which pin needs to be turned on for how long.  To work with GPIO, I used the <a href="https://github.com/nathan-osman/go-rpigpio">go-rpigpio library</a> : <br><br><div class="spoiler">  <b class="spoiler_title">The code is very simple</b> <div class="spoiler_text"><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, v := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> CurrentPumps.Pumps { log.Printf(<span class="hljs-string"><span class="hljs-string">"Nalivaem %s ;duration = %v; GPIO = %v"</span></span>, v.Name, v.Duration, v.Pump_pin) <span class="hljs-comment"><span class="hljs-comment">//pump pin open p, err := rpi.OpenPin(v.Pump_pin, rpi.OUT) if err != nil { panic(err) } defer p.Close() //led pin open l, l_err := rpi.OpenPin(v.Led_pin, rpi.OUT) if l_err != nil { log.Printf("LED - Can't set LED pin to output") } defer l.Close() // pump on p.Write(rpi.HIGH) //led on l.Write(rpi.HIGH) time.Sleep(time.Second * time.Duration(v.Duration)) // pump off p.Write(rpi.LOW) //led off l.Write(rpi.LOW) } }</span></span></code> </pre> <br></div></div><br>  All code in github - <a href="https://github.com/fote/nalivator9000">github.com/fote/nalivator9000</a> <br><br>  It remains to add a web interface and you're done.  As for the case, I did not bother and placed everything in the Ikeev box.  At this point, I realized that the designer will not leave me.  In general, over the appearance is still worth the work. <br><br>  When the time came for testing, I invited friends to do load testing, but before they arrived, I realized that the web interface is not very convenient - it is not accessible from the Internet, and to connect to a password protected wi-fi network, enter the IP address in the browser ... too complicated.  Then I added a telegram-bot, which waits for him to write the name of the cocktail and pours it.  I will not describe how to create a bot, because  There are already a lot of good articles on this topic, including for Golang. <br><br>  I also decided to add speech synthesis using <a href="https://tech.yandex.ru/speechkit/cloud/doc/guide/concepts/tts-overview-technology-docpage/">Yandex SpeechKit</a> .  The API of this service is very simple, and the license agreement allows you to use it for free for non-commercial purposes.  Before sending a message from a telegram bot, I run the phrase through SpeechKit, in response I receive a .wav file and play it through a speaker connected via a 3.5mm-jack. <br><br><h2>  Conclusion </h2><br>  The testing of the Innovator was successful - the testers were satisfied and left many features. <br><br>  Finally, the video work: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8zgrqq7ezRE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  For your health! </div><p>Source: <a href="https://habr.com/ru/post/327220/">https://habr.com/ru/post/327220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327210/index.html">Does your webcam work in new Firefox 53?</a></li>
<li><a href="../327212/index.html">Live Typing vs. Evernote: how we lay on an elephant</a></li>
<li><a href="../327214/index.html">Broadcast RTMP video stream from Live Encoder to WebRTC</a></li>
<li><a href="../327216/index.html">Publication of Vkontakte posts through Trello</a></li>
<li><a href="../327218/index.html">Understanding Bitcoin Replace-By-Fee Transactions</a></li>
<li><a href="../327222/index.html">3D modeling and high performance computing (HPC) in the development of new products</a></li>
<li><a href="../327224/index.html">From engineers to managers: maintaining technical skills</a></li>
<li><a href="../327226/index.html">Open source databases on large machines: disk speed and innodb_io_capacity. Part 2</a></li>
<li><a href="../327228/index.html">The book "React.js. Fast start"</a></li>
<li><a href="../327232/index.html">How to use a token to make a Windows domain safer? Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>