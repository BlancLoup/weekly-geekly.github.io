<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculation of the calendar of periodic events taking into account holidays</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is unlikely that PR will pull, but except in ‚ÄúI am promoting‚Äù I did not think of where to place it. 

 It all started with the fact that friends in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculation of the calendar of periodic events taking into account holidays</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://getcalendar.ru/"><img src="https://habrastorage.org/storage/habraeffect/b4/7a/b47a0f0d3152b79b0a019d455c5b161b.gif" alt="image"></a> <br><br>  It is unlikely that PR will pull, but except in ‚ÄúI am promoting‚Äù I did not think of where to place it. <br><br>  It all started with the fact that friends in the bank from the reporting department turned to me asking if I didn‚Äôt know a resource where you can automatically calculate the reporting dates.  At that time, a large A3 sheet was used, which hung on the wall and contained a list of reporting forms and a deadline in accordance with the regulatory requirements of the Bank of Russia. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The whole point is that the terms of the Central Bank usually set, for example, as "7 working day of the month following the reporting".  At that time, the forms can be both monthly and quarterly, annual, ten-day, five-week days.  And the fact that for each calendar year in Russia the Government establishes a production calendar where holidays are fixed and all the necessary postponements only aggravates the situation, since it is necessary to adapt to all these changes. <br><br><a name="habracut"></a><br>  Actually, on that sheet there were approximate days of delivery, somehow: for the 7th working day, the report was displayed for delivery in the column ‚Äú7th day of the month‚Äù, which was obviously ahead of time.  And it turned out, you always need to keep this in mind and do not forget to submit this or that report.  All this was not very convenient.  And the main task was to control the deadlines, since the corresponding measures are relied on for violation by the Central Bank.  And if we allow a delay of more than 15 days, then the license may be revoked by law. <br><br>  In general, having poked Outlook and a number of calendar managers, I realized that periodic events, which are calculated in working days, cannot be configured.  I thought about making a crutch, since the reporting calendar can be calculated a year in advance and forget about it for a while. <br><br>  The simplest idea that came to mind is to get CSV in the right format, which can be uploaded to Outlook.  In order to generate CSV, the first thing I thought about was SQL, the benefit some time ago I was dealing with Oracle and the SQL standard was expanded there with a lot of useful functionality. <br><br>  To do this, I got a list of events in Excel, and at the output I got a list of inserts for insertion into the setup table. <br><br>  And it took 3 base tables: <br><ul><li>  holiday tables to add (add_red_days) </li><li>  tables of days that are Saturday or Sunday, but become working (remove_red_days) due to the transfer </li><li>  Actually, the list of reporting forms themselves with the necessary parameters (cb_reports_settings) </li></ul><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">SQL</font> &gt; <font color="#0000ff">desc</font> remove_red_days <br> Name Type Nullable <font color="#0000ff">Default</font> Comments <br> -- <font color="#008000">-- ---- -------- ------- --------</font> <br> DT <font color="#0000ff">DATE</font> Y <br> <br> <font color="#0000ff">SQL</font> &gt; <font color="#0000ff">select</font> * <font color="#0000ff">from</font> remove_red_days <br> 2 / <br> <br> DT <br> --------- <font color="#008000">--</font> <br> 27.02.2010 <br> 13.11.2010 <br> <br> <font color="#0000ff">SQL</font> &gt; <font color="#0000ff">desc</font> add_red_days <br> Name Type Nullable <font color="#0000ff">Default</font> Comments <br> -- <font color="#008000">-- ---- -------- ------- --------</font> <br> DT <font color="#0000ff">DATE</font> Y <br> <br> <font color="#0000ff">SQL</font> &gt; <font color="#0000ff">select</font> * <font color="#0000ff">from</font> add_red_days <br> 2 / <br> <br> DT <br> --------- <font color="#008000">--</font> <br> 01.01.2010 <br> 04.01.2010 <br> 05.01.2010 <br> 06.01.2010 <br> 07.01.2010 <br> 08.01.2010 <br> 22.02.2010 <br> 23.02.2010 <br> 08.03.2010 <br> 03.05.2010 <br> 10.05.2010 <br> 14.06.2010 <br> 04.11.2010 <br> 05.11.2010 <br> <br> 14 <font color="#0000ff">rows</font> selected <br> <br> <font color="#0000ff">SQL</font> &gt; <font color="#0000ff">desc</font> cb_reports_settings <br> Name            Type         Nullable <font color="#0000ff">Default</font> Comments <br> ------------- <font color="#008000">-- ------------- -------- ------- --------</font> <br> FORM_NAME      VARCHAR2(100) Y <br> CALENDAR_DAY    NUMBER(2)     Y <br> WORKING_DAY     NUMBER(2)     Y <br> TIME_TO_BE_SENT NUMBER(2)     Y <br> IS_QUARTERLY    NUMBER(1)     Y <br> <br> <font color="#0000ff">SQL</font> &gt; <font color="#0000ff">select</font> * <font color="#0000ff">from</font> cb_reports_settings <br> 2 / <br> <br> FORM_NAME             CALENDAR_DAY WORKING_DAY TIME_TO_BE_SENT IS_QUARTERLY <br> ------------------- <font color="#008000">-- ------------ ----------- --------------- ------------</font> <br> 350                             1          2                            0 <br> 301                             1          2             13            0 <br> 634_                      1          4                            0 <br> 101                             1          4                            0 <br> 134                             1          4                            0 <br> 135                             1          6                            0 <br> 153                             1          6                            0 <br> 711                             1          5                            0 <br> 301                             5          2             13            0 <br> 115                             1          7                            0 <br> 116                             1          7                            0 <br> 117                             1          7                            0 <br> 118                             1          7                            0 <br> 155                             1          7                            0 <br> 125                             1          8                            0 <br> 157                             1          8                            0 <br> 501                             1          8                            0 <br> 603                             1          8                            0 <br> 102                             1          8                            1 <br> 110                             1          8                            0 <br> 128                             1          7                            0 <br> 129                             1          7                            0 <br> 302                             1         10                            0 <br> 316                             1         10                            0 <br> 251                             1         10                            1 <br> 401                             1         10                            0 <br> 301                             10          2             13            0 <br> 350                             11          2                            0 <br> 634_                     11          4                            0 <br> 345                             1         11                            1 <br> 405                             1         17                            0 <br> 301                             15          2             13            0 <br> 301                             20          2             13            0 <br> 350                             21          2                            0 <br> 634_                     21          4                            0 <br> 301                             25          2             13            0 <br> 342- ()                     1         10                            0 <br> <br> 37 <font color="#0000ff">rows</font> selected</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Generating CSV for download in MS Outlook made such a request: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">/*   */ <br> <font color="#0000ff">with</font> t1 <font color="#0000ff">as</font> ( <font color="#0000ff">select</font> trunc(sysdate, <font color="#A31515">'y'</font> )+rownum-1 dt <font color="#0000ff">from</font> dual <font color="#0000ff">connect</font> <font color="#0000ff">by</font> <font color="#0000ff">level</font> &lt;=365), <br> <font color="#008000">--</font> <br> /*          */ <br> t2 <font color="#0000ff">as</font> ( <font color="#0000ff">select</font> dt, row_number() <font color="#0000ff">over</font> (partition <font color="#0000ff">by</font> trunc(dt, <font color="#A31515">'mm'</font> ) <font color="#0000ff">order</font> <font color="#0000ff">by</font> dt) working_day, <br> row_number() <font color="#0000ff">over</font> ( <font color="#0000ff">order</font> <font color="#0000ff">by</font> dt) wd2 <font color="#0000ff">from</font> t1 <br> <font color="#0000ff">where</font> (mod(to_char(dt, <font color="#A31515">'j'</font> ),7) +1 <font color="#0000ff">not</font> <font color="#0000ff">in</font> (6,7)--  <br> <font color="#0000ff">or</font> dt <font color="#0000ff">in</font> ( <font color="#0000ff">select</font> dt <font color="#0000ff">from</font> remove_red_days)) -- ,    <br> <font color="#0000ff">and</font> dt <font color="#0000ff">not</font> <font color="#0000ff">in</font> ( <font color="#0000ff">select</font> dt <font color="#0000ff">from</font> add_red_days)), --    <br> <font color="#008000">--</font> <br> /*              */ <br> t3 <font color="#0000ff">as</font> ( <font color="#0000ff">select</font> t1.dt, to_number(to_char(t1.dt, <font color="#A31515">'dd'</font> )) calendar_day, working_day, wd2 <font color="#0000ff">from</font> t1, t2 <br> <font color="#0000ff">where</font> t1.dt = t2.dt(+) <br> <font color="#0000ff">order</font> <font color="#0000ff">by</font> t1.dt), <br> <font color="#008000">--</font> <br> /*         ,   ,   */ <br> t4 <font color="#0000ff">as</font> ( <br> <font color="#0000ff">select</font> t3.*, <br> first_value(decode(working_day, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> , t3.wd2) <font color="#0000ff">ignore</font> nulls) <font color="#0000ff">over</font> ( <font color="#0000ff">order</font> <font color="#0000ff">by</font> t3.dt <font color="#0000ff">rows</font> <font color="#0000ff">between</font> <font color="#0000ff">current</font> <font color="#0000ff">row</font> <font color="#0000ff">and</font> unbounded following) wd3, <br> first_value(decode(working_day, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> , t3.dt) <font color="#0000ff">ignore</font> nulls) <font color="#0000ff">over</font> ( <font color="#0000ff">order</font> <font color="#0000ff">by</font> t3.dt <font color="#0000ff">rows</font> <font color="#0000ff">between</font> <font color="#0000ff">current</font> <font color="#0000ff">row</font> <font color="#0000ff">and</font> unbounded following) dt2, <br> nvl2(working_day, dt, <font color="#0000ff">null</font> ) dt3 <br> <font color="#0000ff">from</font> t3 <br> ) /* <font color="#0000ff">select</font> * <font color="#0000ff">from</font> t4*/, <br> <font color="#008000">--</font> <br> t5 <font color="#0000ff">as</font> ( <font color="#0000ff">select</font> ( <font color="#0000ff">select</font> dt <br> <font color="#0000ff">from</font> t4 t4_inner <br> <font color="#0000ff">where</font> t4_inner.wd3 - t4_outer.wd3 + 1 = cbrs.working_day <br> <font color="#0000ff">and</font> t4_inner.wd2 <font color="#0000ff">is</font> <font color="#0000ff">not</font> <font color="#0000ff">null</font> <br> <font color="#0000ff">and</font> rownum = 1) needed_date, <br> t4_outer.*, <br> cbrs.* <br> <font color="#0000ff">from</font> t4 t4_outer, <br> cb_reports_settings cbrs <br> <font color="#0000ff">where</font> t4_outer.calendar_day = cbrs.calendar_day <br> <font color="#0000ff">and</font> (cbrs.is_quarterly = 0 <font color="#0000ff">or</font> cbrs.is_quarterly = 1 <font color="#0000ff">and</font> trunc(t4_outer.dt, <font color="#A31515">'mm'</font> ) = trunc(t4_outer.dt, <font color="#A31515">'Q'</font> )) <br> <font color="#0000ff">order</font> <font color="#0000ff">by</font> 1) <br> <font color="#008000">--</font> <br> <font color="#0000ff">select</font> <font color="#A31515">'"'</font> ||form_name|| <font color="#A31515">'","'</font> ||to_char(needed_date, <font color="#A31515">'dd.mm.yyyy'</font> )|| <font color="#A31515">'","'</font> ||nvl(time_to_be_sent, <font color="#A31515">'17'</font> )|| <font color="#A31515">':00:00","'</font> ||to_char(needed_date, <font color="#A31515">'dd.mm.yyyy'</font> )|| <font color="#A31515">'","'</font> ||nvl(time_to_be_sent, <font color="#A31515">'17'</font> )|| <font color="#A31515">':00:00","","","'</font> ||to_char(needed_date, <font color="#A31515">'dd.mm.yyyy'</font> )|| <font color="#A31515">'","09:00:00",""'</font> col <br> <font color="#0000ff">from</font> t5 <br> <font color="#0000ff">order</font> <font color="#0000ff">by</font> form_name, needed_date</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  At the output we get: <br> <code>COL <br> -------- <br> "101","14.01.2010","17:00:00","14.01.2010","17:00:00","","","14.01.2010","09:00:00","" <br> "101","04.02.2010","17:00:00","04.02.2010","17:00:00","","","04.02.2010","09:00:00","" <br> "101","04.03.2010","17:00:00","04.03.2010","17:00:00","","","04.03.2010","09:00:00","" <br> "101","06.04.2010","17:00:00","06.04.2010","17:00:00","","","06.04.2010","09:00:00","" <br> "101","07.05.2010","17:00:00","07.05.2010","17:00:00","","","07.05.2010","09:00:00","" <br> "101","04.06.2010","17:00:00","04.06.2010","17:00:00","","","04.06.2010","09:00:00","" <br> "101","06.07.2010","17:00:00","06.07.2010","17:00:00","","","06.07.2010","09:00:00","" <br> "101","05.08.2010","17:00:00","05.08.2010","17:00:00","","","05.08.2010","09:00:00","" <br> "101","06.09.2010","17:00:00","06.09.2010","17:00:00","","","06.09.2010","09:00:00","" <br> "101","06.10.2010","17:00:00","06.10.2010","17:00:00","","","06.10.2010","09:00:00","" <br> ... <br></code> <br><br>  All this is successfully imported into Outlook. <br><br>  And everything seems to be nothing, only since Oracle was absent at work, I had to do all the unloading at home.  Not quite comfortable. <br><br>  The new year has come, the delivery dates and the list of reporting forms have been updated in connection with the new indication of the Central Bank, a new production calendar has been installed.  It was necessary to collect data on the new list of reports at work, at home to update the data in the tables, to regenerate CSV. <br><br>  I didn‚Äôt like it and I decided to create a small web service that would be useful first of all to myself, as well as to other people who are faced with a similar task. <br><br>  The process is divided into 3 steps: <br><br>  1. It should be noted which dates are festive for the next year.  This can be done after they accept the official production calendar.  You can also change the sign of the day off to work, in case the transfer is carried out. <br><br><img src="https://habrastorage.org/storage/habraeffect/c3/1f/c31f506341aaba1dd4851dccdfa4dbaa.png" alt="image"><br><br>  2. Creating an event calendar and adding individual events with parameters. <br><br>  Options: <br>  - frequency: month, quarter or year <br>  - shift in months <br>  - shift in calendar days <br>  - shift in working days <br><br><img src="https://habrastorage.org/storage/habraeffect/20/a0/20a0c17b7ed37ffb38789fe86fb66ed7.png" alt="image"><br><br>  The last three parameters are needed to set the shift deadline reporting.  For example, if the periodicity ‚Äúmonth‚Äù is selected in the upload, there will be 12 events for each month.  By default, the event date is 01 day of each month.  It is from her that we consider the shift. <br><br>  - exclude the first <br>  This option allows you to set specific dates for the first event of the year. <br><br>  3. When we set up a calendar and a list of events, then we need to upload the file to upload it to your event manager. <br><br><img src="https://habrastorage.org/storage/habraeffect/5d/52/5d529202627046b4e4b84f444d1def82.png" alt="image"><br><br>  Standard * .iCal and * .csv for MS Outlook are now supported. <br><br>  Actually, the address <a href="http://getcalendar.ru/">getcalendar.ru</a> .  Since, most likely, the service will be very rarely useful (once a year), I did not do any local registration, and did authorization only through OpenID. <br><br>  At work, in addition to the Central Bank otchetniki, began to use and tax, and personnel officers.  On the desired day, a reminder pops up automatically in the morning in the morning, if you need to submit a report or make a payment. <br><br>  I hope someone will come in handy. </div><p>Source: <a href="https://habr.com/ru/post/96496/">https://habr.com/ru/post/96496/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96487/index.html">Duplication of information</a></li>
<li><a href="../96489/index.html">Fable 3 - exact release date and new video</a></li>
<li><a href="../96490/index.html">Is your phone still ringing? Then we go to you</a></li>
<li><a href="../96491/index.html">How poker bot works</a></li>
<li><a href="../96495/index.html">The case of the terminal QIWI</a></li>
<li><a href="../96497/index.html">JAF Smartphone Firmware Manual</a></li>
<li><a href="../96499/index.html">Yahoo has taken over the Flicker.com domain</a></li>
<li><a href="../96500/index.html">Tt eSPORTS Challenger Pro or who put me on toys?</a></li>
<li><a href="../96502/index.html">HTML5 is already here (it's just not for desktop computers yet)</a></li>
<li><a href="../96503/index.html">Why visitors do not become buyers or 17 steps to the perfect online store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>