<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When the program falls only on Wednesdays</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lean back and relax - it's time to talk about one of my favorite bugs. 

 This was my very first work in the field of IT - a summer practice in a comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When the program falls only on Wednesdays</h1><div class="post__text post__text-html js-mediator-article"> Lean back and relax - it's time to talk about one of my favorite bugs. <br><br><img src="https://habrastorage.org/files/9c6/05d/d7c/9c605dd7cbc344c592e6a3738a1f0527.jpg" align="right">  This was my very first work in the field of IT - a summer practice in a company that develops very serious medical equipment, in particular <a href="http://www.dremed.com/catalog/product_info.php/cPath/753_731/products_id/2203">, anesthesia delivery systems</a> and <a href="http://www.dremed.com/catalog/product_info.php/cPath/753_731/products_id/1944">monitors for hospital patients</a> .  A patient monitor is such a squealing box next to a bed patient that measures pulse, pressure, respiration rate, etc., and also alerts the nurses in case of trouble.  The office was full of two-meter cylinders of laughing gas, luxurious beard guru-experts on embedded systems strolled around it, and there were entire storage rooms specifically for the documentation needed to certify various equipment.  The people are still whispering about a bug that testers missed a dozen years ago, because of which the anesthesia delivery system restarted in the middle of the operation.  Needless to say that a green student jugger like me wouldn't be allowed to enter combat systems a mile away? <br><br>  Instead, I was assigned a prototype project to try out the hottest technological innovations of 1997 ‚Äî a C ++ server that listened to monitors on a serial port, merged interesting data into a database on SQL Server and sent them to a Java applet through CORBA, so that Doctors and relatives could monitor the patient's condition through the Internet.  Beauty is the same!  Especially considering the fact that I didn‚Äôt have practical experience with any of these systems and technologies! <br><a name="habracut"></a><br>  After a few weeks of hellish crushing, mostly spent on smoking the <a href="https://en.wikipedia.org/wiki/Visibroker">Visibroker ORB</a> manuals and tedious catching of type-conversion errors, my Simpson system was more or less ready.  The server ‚ÄúHomer‚Äù saved and gave out the data, and the client ‚ÄúBart‚Äù displayed them for the user.  During this time, I learned that CORBA is hopelessly overly wise, AWT is tin ( <code>GridBagLayout</code> , brrr!), Applets work at a snail's pace ‚Äî but otherwise, Java seems to be a good language.  I was worried about only one minor bug - from time to time the server in C ++ crashed, and I decided to find out the reason. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since in the next room we had a test stand with a real monitor, during development and testing, I used an extremely convenient ‚Äúdemo mode‚Äù that happily reproduces a heart attack imitation in a circle.  In this mode, my server never crashed - it did it <i>sometimes</i> during the manual control of the monitor, especially during the shows, but at least you are bursting, I could not achieve stable failure playback.  I added logging to all events, ran back and forth between the monitor and my workplace, slowly and thoughtfully reproducing the necessary steps ("set the filter in <i>X</i> , turn the control knob exactly three divisions clockwise, click here ..."), but the drop is not reproduced.  Whatever this ‚Äúevil event‚Äù, as I called it, it avoided any logging!  Maybe the problem was in I / O or at the level of iron?  Maybe cosmic rays dumped bits in the memory of my computer? <br><br>  Several weeks of fruitless experiments led me to complete despair.  I went so far as to add <code>printf</code> output after every damn line of code between retrieving data from the serial port and writing it to the database ... and in the process, after reviewing each of these lines many times, it suddenly struck me. <br><br>  When I described the database schema, in an inexplicable attempt to save space, I foolishly and underage used the <code>timestamp</code> event as the primary key.  If two events come in the same millisecond, the base will throw an exception about the violation of uniqueness.  I found it quite early, but I thought that this could happen only in some very strange cases when someone was digging into the internal settings of the monitor, and with a clear conscience wrapped this code in <code>try/catch</code> with error logging. <br><br>  But!  The logging code was written in the old school style, and the error text was written to the string buffer 80 characters long.  The message about the violation of the uniqueness of the key has always been the same, but the date was set before it in an extended format in English, such as this: <br><br> <code>Monday, July 17, 1997, 10:38:47.123 <br></code> <br><br>  The names of the days in English have a funny property: <br><table width="400"><tbody><tr><th>  Title </th><th>  Length in characters </th></tr><tr><td>  Sunday </td><td>  6 </td></tr><tr><td>  Monday </td><td>  6 </td></tr><tr><td>  Friday </td><td>  6 </td></tr><tr><td>  Tuesday </td><td>  7 </td></tr><tr><td>  Thursday </td><td>  eight </td></tr><tr><td>  Saturday </td><td>  eight </td></tr><tr><td>  Wednesday </td><td>  9 </td></tr></tbody></table>  Already guessed? <br><br>  On Wednesday, <i>and only on Wednesday</i> , if someone changed certain monitor settings in a certain way, two events could occur simultaneously and cause a failure in the database.  And the error message was exactly 81 bytes long (including the zero character), overflowed the buffer and caused the entire system to fall! <br><br>  Since then, I have learned three things.  First, always use the auto-increment primary key in any table I need.  Second, log the date in ISO format - <code>YYYY-MM-DD</code> , without the days of the week.  But the most important thing is that even the most random and unpredictable bug has a logical explanation, and you can find it if you dig deep enough. </div><p>Source: <a href="https://habr.com/ru/post/263871/">https://habr.com/ru/post/263871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263859/index.html">Automating the ip-network using the tools at hand (Python)</a></li>
<li><a href="../263861/index.html">Alarm, ahtung, attention, whistle all the server</a></li>
<li><a href="../263863/index.html">How to find a place on earth and not get to the Yandex counter</a></li>
<li><a href="../263865/index.html">5G radio interface</a></li>
<li><a href="../263869/index.html">Twisted architecture</a></li>
<li><a href="../263873/index.html">Five ways to optimize code for Android 5.0 Lollipop</a></li>
<li><a href="../263875/index.html">How I gathered the skeleton of the bot to order a taxi in Telegram</a></li>
<li><a href="../263877/index.html">Zip-quest about space admin Vasily Romanov</a></li>
<li><a href="../263879/index.html">HP ProLiant Gen9 Server Line</a></li>
<li><a href="../263881/index.html">github attracted $ 250M investment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>