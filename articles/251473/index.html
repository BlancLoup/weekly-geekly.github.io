<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The site from scratch on a full stack of BEM technologies. Yandex Methodology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week, the BBC said that for the new version of the main page, it used the BEM methodology created in Yandex. On this occasion, we decided to rais...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The site from scratch on a full stack of BEM technologies. Yandex Methodology</h1><div class="post__text post__text-html js-mediator-article">  Last week, the <a href="http://www.bbc.co.uk/blogs/internet/entries/47a96d23-ae04-444e-808f-678e6809765d">BBC said</a> that for the new version of the main page, it used the BEM methodology created in Yandex.  On this occasion, we decided to raise the materials of the master class ‚Äú <a href="https://ru.bem.info/talks/bemup-moscow-2014/">Developing a website from scratch on a full stack of BEM technologies</a> ‚Äù and tell you how to start using a full stack of BEM technologies in our projects. <br><br>  BEM simplifies the development of sites that need to be quickly created and maintained for a long time.  This technology is used in the frontend of almost all Yandex services, and it has already managed to acquire many libraries and tools that we want to share with you. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/251473/"><img src="https://habrastorage.org/getpro/habr/post_images/c8a/537/df7/c8a537df75592ef5c09a65187fd27c88.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the article, we will tell you what the advantage of layout is by independent blocks and what are the levels of redefinition, we will get acquainted with ready-made block libraries and tools for automation of assembly.  We show how different tools - for example, <a href="https://github.com/postcss/autoprefixer">autoprefixer</a> , <a href="http://learnboost.github.io/stylus/">Stylus</a> css-preprocessor or <a href="https://ru.bem.info/tools/bem/modules/">YModules</a> modular system - simplify the life of a developer and create a truly convenient platform if you integrate them into the BEM development process. <br><br>  With a live example, we will explain what is the use of a declarative approach, when the same ideas can be used for both CSS and JavaScript.  <a href="https://ru.bem.info/technology/bemhtml/">Let us</a> focus separately on the declarative templates <a href="https://ru.bem.info/technology/bemhtml/">BEMHTML</a> and <a href="https://ru.bem.info/technology/bemtree/">BEMTREE</a> , which allow you to convert data into a BEM tree, described in <a href="https://ru.bem.info/technology/bemjson/">BEMJSON</a> format <a href="https://ru.bem.info/technology/bemjson/">,</a> and then into HTML.  Let us consider in detail how to write the server part of the application according to the BEM methodology. <br><a name="habracut"></a><br>  We will use the Twitter API to create our project.  As a result, we will get a working site on the full stack of BEM technologies and a step-by-step article guide on how all this can be reproduced. <br><br>  Especially for the master class, we wrote a mini-service that deals with search on various social networks and displays the result in an orderly manner.  We posted it on github in the <a href="https://github.com/bem/sssr/">github.com/bem/sssr</a> repository - <a href="https://sssr.bem.yandex.net/">look</a> , get acquainted. <br>  And we go in order. <br><br><h3>  Theory </h3><br>  What is <strong>BEM</strong> ? <br>  BEM (abbreviation for words - Lock, Element, and <strong>M</strong> identifier) ‚Äã‚Äãis a methodology for developing programs and interfaces, a way of describing entities that are not tied to specific implementation technologies. <br><ul><li>  <em>A block</em> is a separate component of an application.  It is independent of other blocks and may contain other blocks and elements. </li><li>  <em>An element</em> is a part of a block that is responsible for a separate function.  It does not make sense in isolation from the block. </li><li>  <em>A modifier</em> is a property of a block or element that is responsible for its appearance or behavior.  Modifiers describe the state of a block or element. </li></ul><br>  BEM provides an abstraction over the DOM tree.  The blocks are independent of each other and encapsulate all the functionality and elements.  No matter what HTML tags a block <code>div</code> or <code>form</code> will be implemented in, you can always change this or add additional wrappers.  Any changes should not affect the remaining blocks.  We describe the application as interface components, not HTML tags. <br><br>  Each block lies in its own folder in the file system, in which all technologies describing the block, its elements and modifiers are added. <br><br><pre> <code class="hljs pgsql">desktop.blocks/ <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>/ __box/ #  __clear/ #  __control/ #  _focused/ #  _type/ #  <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.css # css   <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.js # js   <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.ru.md # markdown  ‚Ä¶</code> </pre><br>  If you are interested in details on how and why BEM appeared, read Vitaly Kharisov‚Äôs article ‚Äú <a href="https://ru.bem.info/method/history/">The History of BEM</a> ‚Äù and watch the <a href="https://events.yandex.ru/lib/talks/95/">video of the</a> report. <br>  A detailed description of the BEM methodology can be found on <a href="https://ru.bem.info/method/">our website</a> . <br><br><h3>  Creating a project blank </h3><br>  Install everything you need to work. <br>  First we need a terminal and a <code>git</code> version control system.  You can install it from <a href="http://git-scm.com/download/">git-scm.com</a> . <br>  Almost all of our tools are written in JavaScript, so you need <a href="https://nodejs.org/download/">node.js</a> or <a href="https://iojs.org/ru/">io.js.</a> <br>  To create a draft of our project, use the generator <a href="https://ru.bem.info/tools/bem/bem-stub/">generator-bem-stub</a> . <br><pre> <code class="hljs markdown"><span class="hljs-quote"><span class="hljs-quote">&gt; npm install -g generator-bem-stub</span></span></code> </pre> <br>  Then run the generator itself: <br><pre> <code class="hljs markdown"><span class="hljs-quote"><span class="hljs-quote">&gt; yo bem-stub</span></span></code> </pre> <br>  Answering questions regarding the technologies used, we will get the pre-assembled and configured for assembly. <br>  Let's go through the questions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b09/f30/7ff/b09f307ffe96d650c214ea3e5753ee76.png"><br><br>  The screenshot shows the results of the answers to the questions.  The first three questions are obvious, after the interesting begins: <br><ul><li>  <code>Choose a toolkit to build the project</code> : (which builder to use) - we use the <a href="https://ru.bem.info/tools/bem/enb-bem-techs/">ENB</a> tool.  This is a utility that will build our project - glue styles, scripts, templates, compile and optimize in accordance with the page declaration, block dependencies and configuration files. </li><li>  <code>Specify additional libraries if needed</code> : (whether we want to use additional libraries) - in our project we will use the library of blocks <a href="https://ru.bem.info/libs/bem-components/">bem-components</a> .  It has optional style themes. </li></ul><br>  It's time to consider what <code> </code> . <br><br><h4>  Override Level </h4><br>  This is a set of block implementations.  A project can have several levels, on each of which the implementation of blocks is added or changed.  The final implementation of the block is collected from all levels sequentially in a given order. <br>  We can add and redefine styles, templates, JavaScript-implementation of blocks at the level of redefining our project.  At the same time, we do not change anything in the source files of the library, allowing us to save our changes if it is updated. <br><br>  Let's give an example of how it looks in the file system: <br><br><pre> <code class="hljs pgsql">‚Ä¶ libs/ bem-components/ desktop.blocks/ <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>/ <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.css desktop.blocks/ <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>/ <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.css ‚Ä¶</code> </pre><br>  By creating a block at the <code>desktop.blocks</code> level of our project, we can add or override the technologies we need. <br>  In the example above, we can edit the styles of the <code>input</code> block, adding its implementation to <code>CSS</code> technology. <br><br>  So, our project preparation is ready.  Go to the project directory: <br><pre> <code class="hljs markdown"><span class="hljs-quote"><span class="hljs-quote">&gt; cd sssr-tutorial</span></span></code> </pre> <br><h3>  Layout </h3><br>  To begin with, let's create a static prototype of our page.  To describe its structure, we will use the <a href="https://ru.bem.info/technology/bemjson/">BEMJSON</a> technology. <br><br>  BEMJSON describes a BEM tree: the order and nesting of blocks, the names and states of BEM entities, additional arbitrary fields. <br><br>  Let's collect the generated project and see what happened.  For convenient work with a locally installed <code>ENB</code> package, you need to run the following command: <br><br><pre> <code class="hljs pgsql">&gt; export <span class="hljs-type"><span class="hljs-type">PATH</span></span>=./node_modules/.bin:$<span class="hljs-type"><span class="hljs-type">PATH</span></span></code> </pre> <br>  Or manually run the <code>enb</code> command from the <code>./node_modules/.bin/</code> subdirectory <br>  To build, we will use the <code>enb server</code> command: <br><br><pre> <code class="hljs pgsql">&gt; enb <span class="hljs-keyword"><span class="hljs-keyword">server</span></span></code> </pre> <br>  Now the page can be opened at the address: <a href="http://localhost:8080/desktop.bundles/index/index.html">http: // localhost: 8080 / desktop.bundles / index / index.html.</a> Our builder will collect all the necessary dependencies, and by them will collect the files of the necessary blocks and technologies. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df5/c8c/6db/df5c8c6db6781c63a8a908e666a02d0d.png"><br><br>  Open the inspector in the browser and look at the DOM tree.  Although we have not yet written a single line of code, there is already generated HTML on this page.  This is because templates from our libraries are used.  For example, the <code>page</code> block template from the <code>bem-core</code> library generates a page <code>doctype</code> ( <code>doctype</code> , <code>html</code> , <code>head</code> , <code>body</code> , etc.). <br><br>  Our project contains the file <code>index.bemjson.js</code> in the folder <code>./desktop.bundles/index/</code> : <br><br><pre> <code class="hljs css">({ <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'page'</span></span>, title: <span class="hljs-string"><span class="hljs-string">'Hello, World!'</span></span>, styles: [ { elem: <span class="hljs-string"><span class="hljs-string">'css'</span></span>, url: <span class="hljs-string"><span class="hljs-string">'index.min.css'</span></span> } ], <span class="hljs-selector-tag"><span class="hljs-selector-tag">scripts</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ { elem: 'js', url: 'index.min.js' } ]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">content</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ 'Hello, World!' ]</span></span> })</code> </pre><br>  This file is a description of the page in BEM terms.  The root block in our BEM tree is <code>page</code> .  It has an API ‚Äî additional keywords ‚Äî <code>title</code> , <code>favicon</code> , etc.  The templates of this block are in the <a href="https://ru.bem.info/libs/bem-core/v2.5.1/desktop/page/">bem-core</a> library. <br><br>  Our application consists of two main parts - caps and content.  Add the <code>sssr</code> block to the page content, in which parts of the interface will be described as elements.  To do this, edit <code>./desktop.bundles/index/index.bemjson.js</code> : <br><br><pre> <code class="hljs css">({ <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'page'</span></span>, //‚Ä¶ content: [ { block: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'header'</span></span> }, { <span class="hljs-attribute"><span class="hljs-attribute">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'content'</span></span> } ] } ] });</code> </pre><br>  In the header, in turn, will be located the search form and the name of the site with the logo: <br><br><pre> <code class="hljs css">{ <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'header'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'logo'</span></span>, content: <span class="hljs-string"><span class="hljs-string">'Social Services Search Robot:'</span></span> }, { <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'form'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'search'</span></span> }, { <span class="hljs-attribute"><span class="hljs-attribute">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'filter'</span></span>, content: <span class="hljs-string"><span class="hljs-string">'[x] twitter'</span></span> } ] } ] }, { <span class="hljs-attribute"><span class="hljs-attribute">elem</span></span>: <span class="hljs-string"><span class="hljs-string">'content'</span></span> } ] }</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/685/c3a/00b/685c3a00b22afe8d337e287b8a4a94c8.png"><br><br>  Use the <code>input</code> , <code>button</code> , <code>spin</code> and <code>checkbox</code> blocks from the <code>bem-components</code> library.  In our project, this library is in the folder <code>./libs/bem-components</code> .  Each of these blocks has its own API, which can be viewed <a href="https://ru.bem.info/libs/bem-components/v2.0.0/desktop/input/">in the documentation</a> . <br><br>  Add the necessary blocks to BEMJSON: <br><br><pre> <code class="hljs pgsql">{ block: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'header'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'logo'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'icon'</span></span>, mods: { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span> } }, <span class="hljs-string"><span class="hljs-string">'Social Services Search Robot:'</span></span> ] }, { block: <span class="hljs-string"><span class="hljs-string">'form'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'search'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'input'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size: <span class="hljs-string"><span class="hljs-string">'m'</span></span>, <span class="hljs-string"><span class="hljs-string">'has-clear'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'query'</span></span>, val: <span class="hljs-string"><span class="hljs-string">'#b_'</span></span>, placeholder: <span class="hljs-string"><span class="hljs-string">'try me, baby!'</span></span> }, { block: <span class="hljs-string"><span class="hljs-string">'button'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size: <span class="hljs-string"><span class="hljs-string">'m'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'submit'</span></span> }, <span class="hljs-type"><span class="hljs-type">text</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }, { block: <span class="hljs-string"><span class="hljs-string">'spin'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size : <span class="hljs-string"><span class="hljs-string">'s'</span></span> } } ] }, { elem: <span class="hljs-string"><span class="hljs-string">'filter'</span></span>, content: <span class="hljs-string"><span class="hljs-string">'[] twitter [] instagram'</span></span> } ] } ] } ] }</code> </pre><br>  In this fragment of BEMJSON there is a field <code>mods</code> .  It indicates the modifiers used and their values.  The <code>mods</code> field contains the <code>: </code> - <code>mods: { type: 'sssr' }</code> . <br><br>  In BEMJSON, you can use arbitrary JavaScript expressions.  Add a <code>map</code> construction for duplicate <code>checkbox</code> blocks in the <code>content</code> element of the <code>filter</code> element: <br><br><pre> <code class="hljs pgsql">//‚Ä¶ { elem: <span class="hljs-string"><span class="hljs-string">'filter'</span></span>, content: [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>, <span class="hljs-string"><span class="hljs-string">'instagram'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(service) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { block: <span class="hljs-string"><span class="hljs-string">'checkbox'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size: <span class="hljs-string"><span class="hljs-string">'l'</span></span>, checked: service === <span class="hljs-string"><span class="hljs-string">'twitter'</span></span> }, <span class="hljs-type"><span class="hljs-type">name</span></span>: service, <span class="hljs-type"><span class="hljs-type">text</span></span>: service }; }) } //‚Ä¶</code> </pre><br>  Full <code>index.bemjson.js</code> file: <br><br><pre> <code class="hljs pgsql">({ block: <span class="hljs-string"><span class="hljs-string">'page'</span></span>, title: <span class="hljs-string"><span class="hljs-string">'Social Services Search Robot'</span></span>, favicon: <span class="hljs-string"><span class="hljs-string">'/favicon.ico'</span></span>, head: [ { elem: <span class="hljs-string"><span class="hljs-string">'meta'</span></span>, attrs: { <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'description'</span></span>, content: <span class="hljs-string"><span class="hljs-string">'find them all'</span></span> }}, { elem: <span class="hljs-string"><span class="hljs-string">'css'</span></span>, url: <span class="hljs-string"><span class="hljs-string">'_index.css'</span></span> } ], scripts: [{ elem: <span class="hljs-string"><span class="hljs-string">'js'</span></span>, url: <span class="hljs-string"><span class="hljs-string">'_index.js'</span></span> }], content: { block: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'header'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'logo'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'icon'</span></span>, mods: { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span> } }, <span class="hljs-string"><span class="hljs-string">'Social Services Search Robot:'</span></span> ] }, { block: <span class="hljs-string"><span class="hljs-string">'form'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'search'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'input'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size: <span class="hljs-string"><span class="hljs-string">'m'</span></span>, <span class="hljs-string"><span class="hljs-string">'has-clear'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'query'</span></span>, val: <span class="hljs-string"><span class="hljs-string">'#b_'</span></span>, placeholder: <span class="hljs-string"><span class="hljs-string">'try me, baby!'</span></span> }, { block: <span class="hljs-string"><span class="hljs-string">'button'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size: <span class="hljs-string"><span class="hljs-string">'m'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-string"><span class="hljs-string">'submit'</span></span> }, <span class="hljs-type"><span class="hljs-type">text</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }, { block: <span class="hljs-string"><span class="hljs-string">'spin'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size : <span class="hljs-string"><span class="hljs-string">'s'</span></span> } } ] }, { elem: <span class="hljs-string"><span class="hljs-string">'filter'</span></span>, content: [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>, <span class="hljs-string"><span class="hljs-string">'instagram'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(service) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { block: <span class="hljs-string"><span class="hljs-string">'checkbox'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span>, size: <span class="hljs-string"><span class="hljs-string">'l'</span></span>, checked: service === <span class="hljs-string"><span class="hljs-string">'twitter'</span></span> }, <span class="hljs-type"><span class="hljs-type">name</span></span>: service, <span class="hljs-type"><span class="hljs-type">text</span></span>: service }; }) } ] } ] }, { elem: <span class="hljs-string"><span class="hljs-string">'content'</span></span> } ] } })</code> </pre><br>  After we describe the interface structure, we need to write and add styles for our blocks.  All main styles come to us with the library <code>bem-components</code> .  So we need to add quite a bit. <br><br>  For writing styles, we use <a href="https://github.com/LearnBoost/stylus/">Stylus</a> CSS preprocessor.  All files with the <code>*.styl</code> will be processed by the preprocessor and glued to the final CSS file.  You can also use the <code>*.css</code> extension for styles that do not need to be processed by the preprocessor. <br>  We write styles for the <code>form</code> block in the file <code>./desktop.blocks/form/form.styl</code> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.form</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: flex; &amp;__search { <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: auto; } <span class="hljs-selector-class"><span class="hljs-selector-class">.input</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">400px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.checkbox</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">user-select</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: top; } }</code> </pre><br>  For the <code>page</code> block in the <code>./desktop.blocks/page/page.css</code> file: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.page</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: Tahoma, sans-serif; <span class="hljs-attribute"><span class="hljs-attribute">min-height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">100px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#000</span></span>; }</code> </pre><br>  For the <code>sssr</code> block in the <code>sssr</code> file: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.sssr</span></span> { &amp;__header { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: fixed; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span> <span class="hljs-number"><span class="hljs-number">10%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#f6f6f6</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0,0,0,.1), <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10px</span></span> <span class="hljs-number"><span class="hljs-number">20px</span></span> -<span class="hljs-number"><span class="hljs-number">5px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0,0,0,.4); .button { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; } } &amp;__<span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">18px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10px</span></span>; } &amp;__<span class="hljs-selector-tag"><span class="hljs-selector-tag">content</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span> <span class="hljs-number"><span class="hljs-number">10%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">column-count</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">column-gap</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">transition</span></span>: opacity .<span class="hljs-number"><span class="hljs-number">20s</span></span> linear; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[rel='nofollow']</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[xhref]</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[name]</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[server]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#038543</span></span>; } }</code> </pre><br>  And for the <code>user</code> block, <code>desktop.blocks/user/user.styl</code> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.user</span></span> { &amp;__name { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">margin-right</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#000</span></span>; &amp;:hover { <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: underline; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#038543</span></span>; } } &amp;__<span class="hljs-selector-tag"><span class="hljs-selector-tag">post-time</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">14px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#8899a6</span></span>; } &amp;__<span class="hljs-selector-tag"><span class="hljs-selector-tag">icon</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">right</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">bottom</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">30px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">30px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">3px</span></span>; } }</code> </pre><br>  We will not dwell on the issues of CSS-layout in great detail, let's go further. <br><br>  It remains for us to add blocks with found messages.  We describe them in <code>index.bemjson.js</code> and use the JavaScript features for prototyping. <br><br><pre> <code class="hljs pgsql">{ elem: <span class="hljs-string"><span class="hljs-string">'content'</span></span>, content: (<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'BEM is extermly cool'</span></span>.split(<span class="hljs-string"><span class="hljs-string">''</span></span>).map(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { var service = [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>, <span class="hljs-string"><span class="hljs-string">'instagram'</span></span>][Math.floor(Math.random()*<span class="hljs-number"><span class="hljs-number">2</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { service: service, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>: [{ <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>: <span class="hljs-string"><span class="hljs-string">'tadatuta'</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Vladimir'</span></span>, avatar: <span class="hljs-string"><span class="hljs-string">'https://raw.githubusercontent.com/bem/bem-identity/master/sign/_theme/sign_theme_batman.png'</span></span> }, { <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>: <span class="hljs-string"><span class="hljs-string">'dmtry'</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Dmitry'</span></span>, avatar: <span class="hljs-string"><span class="hljs-string">'https://raw.githubusercontent.com/bem/bem-identity/master/sign/_theme/sign_theme_captain-america.png'</span></span> }, { <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>: <span class="hljs-string"><span class="hljs-string">'sipayrt'</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Jack Konstantinov'</span></span>, avatar: <span class="hljs-string"><span class="hljs-string">'https://raw.githubusercontent.com/bem/bem-identity/master/sign/_theme/sign_theme_ironman.png'</span></span> }, { <span class="hljs-keyword"><span class="hljs-keyword">login</span></span>: <span class="hljs-string"><span class="hljs-string">'einstein'</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Slava'</span></span>, avatar: <span class="hljs-string"><span class="hljs-string">'https://raw.githubusercontent.com/bem/bem-identity/master/sign/_theme/sign_theme_robin.png'</span></span> }][Math.floor(Math.random()*<span class="hljs-number"><span class="hljs-number">4</span></span>)], <span class="hljs-type"><span class="hljs-type">time</span></span>: Math.floor((Math.random()*<span class="hljs-number"><span class="hljs-number">12</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">'h'</span></span>, img: service === <span class="hljs-string"><span class="hljs-string">'instagram'</span></span> ? <span class="hljs-string"><span class="hljs-string">'http://bla.jpg'</span></span> : undefined, <span class="hljs-type"><span class="hljs-type">text</span></span>: [ <span class="hljs-string"><span class="hljs-string">' ‚Äî    .       (  ).'</span></span>, <span class="hljs-string"><span class="hljs-string">' ‚Äî    .'</span></span>, <span class="hljs-string"><span class="hljs-string">'        .'</span></span>][Math.floor(Math.random()*<span class="hljs-number"><span class="hljs-number">3</span></span>)] }; }).map(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(dataItem) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { block: <span class="hljs-string"><span class="hljs-string">'island'</span></span>, content: [ { elem: <span class="hljs-string"><span class="hljs-string">'header'</span></span>, content: { block: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'link'</span></span>, mix: { block: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, elem: <span class="hljs-string"><span class="hljs-string">'name'</span></span> }, url: <span class="hljs-string"><span class="hljs-string">'https://www.yandex.ru'</span></span>, target: <span class="hljs-string"><span class="hljs-string">'_blank'</span></span>, content: dataItem.<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.name }, { elem: <span class="hljs-string"><span class="hljs-string">'post-time'</span></span>, content: dataItem.time }, { block: <span class="hljs-string"><span class="hljs-string">'image'</span></span>, mix: { block: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, elem: <span class="hljs-string"><span class="hljs-string">'icon'</span></span> }, url: dataItem.<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.avatar, alt: dataItem.<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.name } ] } }, { elem: <span class="hljs-string"><span class="hljs-string">'text'</span></span>, content: dataItem.text }, { elem: <span class="hljs-string"><span class="hljs-string">'footer'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'service'</span></span>, mods: { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: dataItem.service } } ] } ] }; }); })() }</code> </pre><br>  and add styles for the <code>island</code> block to the <code>./desktop.blocks/island/island.styl</code> file: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.island</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">18px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">140%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: relative; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; <span class="hljs-attribute"><span class="hljs-attribute">box-sizing</span></span>: border-box; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span> <span class="hljs-number"><span class="hljs-number">5px</span></span> <span class="hljs-number"><span class="hljs-number">5px</span></span> <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">3px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#fff</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: inset <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .4); &amp;__footer { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; } &amp;__<span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: block; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">3px</span></span>; } }</code> </pre><br>  Let's look at the result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/591/767/10b/59176710b21d21a77d0aff362aea93fb.png"><br><br><h3>  BEMHTML Template Engine </h3><br><h4>  Declarative template making </h4><br>  Yandex is very fond of declarativeness - not only in CSS, but in templates and in JavaScript. <br>  What CSS declarative looks like: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.menu__item</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: inline-block; }</code> </pre><br>  <code>item</code> style will be applied to all items in the <code>menu</code> block <code>display: inline-block;</code>  i.e.  we declare how to be processed <br>  Our DOM nodes are selected by condition: <br><br><pre> <code class="hljs"> {  }</code> </pre> <br>  We select all the nodes of the DOM tree that match the condition, and apply the template body to them. <br><br>  For declarative templating in Yandex, they wrote their own template engine BEMHTML.  More information about its architecture can be found in the article <a href="https://ru.bem.info/technology/bemhtml/current/templating/">Templating data in bem-core</a> . <br>  An example of a declarative template in BEMHTML: <br><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">block</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'menu</span></span>').elem(<span class="hljs-symbol"><span class="hljs-symbol">'item</span></span>').tag()(<span class="hljs-symbol"><span class="hljs-symbol">'span</span></span>');</code> </pre><br>  All blocks of the BEM tree corresponding to our conditions are selected, then the template body is applied to them: <br><br><pre> <code class="hljs lisp">()( )</code> </pre> <br>  BEMHTML is written in JavaScript.  Its syntax is pure javascript.  You can use JavaScript functions in subpredicates and the body of the template.  For production mode, templates will be compiled into optimized JavaScript. <br>  BEMHTML is responsible for how the BEM tree is converted to an HTML string.  The input data is a BEM tree or its fragment, described in the BEMJSON technology.  A BEMHTML template is superimposed on this BEMJSON.  And the output is an HTML string. <br><br>  In general, the pattern is as follows: <br><br><pre> <code class="hljs lisp">match(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)()<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  Subpredicates are conditions under which a pattern is applied.  For example: <br><br><pre> <code class="hljs lisp">match(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)()<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  This template checks if the current block is a <code>link</code> block, if there is a <code>url</code> variable in the context of <code>this.ctx</code> , and if the current mode is a fashion <code>tag</code> .  If all these conditions are met, the a tag will be applied to the block. <br><br><h4>  Fashion </h4><br>  Fashion is the step of generating output HTML.  Each mod is responsible for its piece of the resulting HTML-code.  The <code>default</code> mode describes the set and order of passing the other modes.  This diagram shows what each mod is responsible for: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a0/3d5/b61/5a03d5b61ad099f1ca449d1a44533e30.png" alt="Mod scheme when generating HTML"><br><br>  We recommend that you carefully read the BEMHTML documentation described in the <a href="https://ru.bem.info/technology/bemhtml/current/reference/">BEMHTML Template Reference Guide</a> . <br><br>  Let's return to our project.  We need a <code>form</code> block.  It should appear as a <code>&lt;form&gt;</code> and have a <code>JavaScript</code> implementation. <br>  If we add another such block to the page, we will have to edit these parameters directly in the BEMJSON file.  This is similar to using inline styles in HTML.  Let's do everything right and put the parameters of the block in its template: <br>  <code>./desktop.blocks/form/form.bemhtml</code> : <br><br><pre> <code class="hljs lisp">block('form')( <span class="hljs-name"><span class="hljs-name">tag</span></span>()('form'), js()(<span class="hljs-name"><span class="hljs-name">true</span></span>) )<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br>  Now we can edit the block template in one place, transfer and reuse this block with ease. <br><br>  Let's take a look at the DOM tree in the inspector - our <code>form</code> block is now displayed as a <code>&lt;form&gt;</code> with the <code>i-bem</code> class.  This class says that the block has a javascript implementation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62b/11b/bce/62b11bbce713e7327afc6d7b5a17d32e.png"><br><br>  We described how our BEM blocks should be converted to HTML.  Now let's look at how twitter data will be received and processed. <br><br><h3>  Application architecture </h3><br><h4>  Two-stage templating </h4><br>  Our application will work as follows: <br><ul><li>  At the first stage, we collect data from services and build a BEM tree based on this data; </li><li>  On the second, we convert the BEM tree (view-oriented data) into a DOM tree and give HTML to the client side. </li></ul><br><h3>  BEMTREE </h3><br>  We talked about how to convert a BEM tree to HTML.  This is the task of the frontend server.  The BEMTREE template engine deals with the task of building a BEM tree and saturating it with data.  It has the same syntax as BEMHTML.  The main difference is the number of standard modes available.  BEMTREE has only <code>default</code> and <code>content</code> . <br>  The input data for BEMTREE is the raw data with which the block templates are saturated.  At the output we get a ready-made fragment of the BEM-tree, which we will transmit further to the BEMHTML template. <br><br>  Immediately into battle.  Write the BEMTREE template for the <code>{ type: 'twitter' }</code> modifier, <code>island</code> block: <br> <code>desktop.blocks/island/_type/island_type_twitter.bemtree</code> <br> <br><pre> <code class="hljs kotlin">block(<span class="hljs-string"><span class="hljs-string">'island'</span></span>).mod(<span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'twitter'</span></span>).content()(function() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = { postLink: <span class="hljs-string"><span class="hljs-string">'#'</span></span>, userName: <span class="hljs-string"><span class="hljs-string">'user@name'</span></span>, userNick: <span class="hljs-string"><span class="hljs-string">'user@nick'</span></span>, createdAt: <span class="hljs-string"><span class="hljs-string">'19 of July'</span></span>, avatar: <span class="hljs-string"><span class="hljs-string">'#avatar'</span></span>, text: <span class="hljs-string"><span class="hljs-string">'message going here'</span></span>, type: <span class="hljs-string"><span class="hljs-string">'twitter'</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ { elem: <span class="hljs-string"><span class="hljs-string">'header'</span></span>, content: { block: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'link'</span></span>, mods: { theme: <span class="hljs-string"><span class="hljs-string">'islands'</span></span> }, mix: { block: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, elem: <span class="hljs-string"><span class="hljs-string">'name'</span></span> }, url: <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.postLink, content: [<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.userName, <span class="hljs-string"><span class="hljs-string">' @'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.userNick] }, { elem: <span class="hljs-string"><span class="hljs-string">'post-time'</span></span>, content: <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.createdAt.toString() }, { block: <span class="hljs-string"><span class="hljs-string">'image'</span></span>, mix: { block: <span class="hljs-string"><span class="hljs-string">'user'</span></span>, elem: <span class="hljs-string"><span class="hljs-string">'icon'</span></span> }, url: <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.avatar, alt: <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.userName } ] } }, { elem: <span class="hljs-string"><span class="hljs-string">'text'</span></span>, content: <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.text }, { elem: <span class="hljs-string"><span class="hljs-string">'footer'</span></span>, content: [ { block: <span class="hljs-string"><span class="hljs-string">'service'</span></span>, mods: { type: <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.type } } ] } ]; });</code> </pre><br>  We transfer the <code>image</code> block with the required parameters to the contents of this block and mix the <code>image</code> element of the <code>island</code> block. <br>  In the following, we will replace the static object with the data transmitted for templating.  But first, let's see how the server code will be organized and how this data will be transmitted. <br><br><h3>  On server </h3><br>  Our application will work on the <a href="http://expressjs.com/">express</a> framework - to give HTML in response to a search query. <br><br>  Let's write the blocks responsible for collecting data from services.  We will write the server code into files with the extension <code>*.node.js</code> , which will be merged into one file during assembly.  We will launch it with the help of <code>node.js</code> <br><h4>  Block <code>service_type_twitter</code> </h4><br>  For ease of working with twitter, we use the <a href="https://github.com/ttezel/twit">twit</a> module.  Install it using <code>npm</code> : <br><br><pre> <code class="hljs pgsql">&gt; npm i twit <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre> <br>  We submitted the authorization data necessary for working with twitter in a <a href="">separate file</a> .  Copy its contents into the file of the same name. <br><br>  <code>./desktop.blocks/service/_type/service_type_twitter.node.js</code> : <br><br><pre> <code class="hljs lua">var twitter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'twit'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./service_type_twitter.config'</span></span>), twit = new twitter(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>); var query = <span class="hljs-string"><span class="hljs-string">'#b_'</span></span>, results = []; twit.get(<span class="hljs-string"><span class="hljs-string">'search/tweets'</span></span>, { q: query, count: <span class="hljs-number"><span class="hljs-number">20</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err, res)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { console.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>(err); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []; } results = res.statuses.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status)</span></span></span></span> { var user = <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.user; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { avatar: user.profile_image_url, userName: user.name, userNick: user.screen_name, postLink: <span class="hljs-string"><span class="hljs-string">'https://twitter.com/'</span></span> + user.screen_name, createdAt: <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.created_at, text: <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.text, <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'twitter'</span></span> }; }); console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(results); });</code> </pre><br>  This application searches for the keyword <code>#b_</code> and outputs the result to the console. <br>  Rebuild our project and run it with <code>node.js</code> <br><br><pre> <code class="hljs pgsql">&gt; enb make &gt; node ./desktop.bundles/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.node.js</code> </pre><br>  The result of the execution should be a list of tweets in the console. <br><br>  Now we need to somehow transfer the results of execution for further work - template making and transfer to the client. <br>  For asynchronous work using promises, we use the <a href="https://github.com/dfilatov/vow">vow</a> library. <br>  For organization of server and client JS-code - the modular system <a href="https://ru.bem.info/tools/bem/modules/">YModules</a> . <br><br><h3>  Modular system </h3><br>  The <code>bem-core</code> library uses the modular system <a href="https://ru.bem.info/tools/bem/modules/">ymodules</a> . <br>  It allows you to wrap the code of our block in a wrapper module and call it, if necessary, from other modules. <br><br>  Edit the <code>service_type_twitter.node.js</code> file in accordance with these additions: <br><br><pre> <code class="hljs lua">modules.define(<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide)</span></span></span></span> { var vow = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vow'</span></span>), moment = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'moment'</span></span>), twitter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'twit'</span></span>), twitterText = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'twitter-text'</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./service_type_twitter.config'</span></span>), twit = new twitter(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>); provide({ get: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(query)</span></span></span></span> { var dfd = vow.defer(); twit.get(<span class="hljs-string"><span class="hljs-string">'search/tweets'</span></span>, { q: query, count: <span class="hljs-number"><span class="hljs-number">20</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err, res)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err || !res.statuses) { console.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>(err); dfd.resolve([]); } dfd.resolve(res.statuses.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { avatar: <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.user.profile_image_url, userName: <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.user.name, userNick: <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.user.screen_name, postLink: <span class="hljs-string"><span class="hljs-string">'https://twitter.com/'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.user.screen_name, createdAt: moment(<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.created_at), text: twitterText.autoLink(twitterText.htmlEscape(<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>.text)), <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">'twitter'</span></span> }; })); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dfd.promise(); } }); });</code> </pre><br>  As you can see, we wrapped all the code in the <code>modules.define</code> construction.  This is the declaration of the <code>twitter</code> module, which will later be available in our application through the <code>modules</code> namespace. <br>  For asynchronous transfer of the result, we return a promise to which, depending on the results of the query, we transfer either an empty array if there was an error, or an array with the search results. <br>  To work with dates, add the module <code>moment.js</code> . <br>  Twitter returns plain text to us in messages, so we use the <code>twitter-text</code> library to highlight hash tags and links. <br>  In addition, as mentioned above, we need <code>express</code> . <br>  Let's install these modules: <br><br><pre> <code class="hljs pgsql">&gt; npm i vow moment twitter-<span class="hljs-type"><span class="hljs-type">text</span></span> express <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre><br><h4>  <code>server</code> block </h4><br>  The server block will be responsible for the server part of our application.  Add the folder <code>./desktop.blocks/server/</code> and create the file <code>server.node.js</code> in it. <br><br>  This will be an <code>express</code> application that listens to the URL <code>/search</code> and sends the data according to the request. <br><br><pre> <code class="hljs javascript">modules.require([<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">twitter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), PATH = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>), express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>), app = express(), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), querystring = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'querystring'</span></span>), Vow = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vow'</span></span>); app.get(<span class="hljs-string"><span class="hljs-string">'/search'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataEntries = [], searchObj = url.parse(req.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).query, queryString = querystring.escape(searchObj.query), servicesEnabled = []; searchObj.twitter &amp;&amp; servicesEnabled.push(twitter.get(queryString)); Vow.all(servicesEnabled) .then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">results</span></span></span><span class="hljs-function">) </span></span>{ res.end(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(results, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); }) .fail(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); }); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> server = app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Listening on port %d'</span></span>, server.address().port); }); });</code> </pre><br>  Create a <code>./desktop.blocks/sssr/sssr.deps.js</code> file with the following content: <br><br><pre> <code class="hljs css">({ <span class="hljs-attribute"><span class="hljs-attribute">shouldDeps</span></span>: [ { block: <span class="hljs-string"><span class="hljs-string">'server'</span></span> }, { <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'island'</span></span>, mods: { type: [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>] }} ] })</code> </pre><br>  It says here that the <code>sssr</code> block needs <code>server</code> and <code>island</code> blocks with the <code>type: 'twitter'</code> modifier <code>type: 'twitter'</code> . <br><br>  Also add the <code>service_type_twitter</code> modifier depending on the <code>server</code> block.  To do this, create a file <code>./desktop.blocks/server/server.deps.js</code> : <br><br><pre> <code class="hljs css">({ <span class="hljs-attribute"><span class="hljs-attribute">shouldDeps</span></span>: [ { block: <span class="hljs-string"><span class="hljs-string">'service'</span></span>, mods: { type: [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>] } }, { <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, } ] })</code> </pre><br>  Now all the blocks we need will fall into the assembly.  Rebuild the project and start the server: <br><br><pre> <code class="hljs pgsql">&gt; enb make &amp;&amp; node ./desktop.bundles/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.node.js</code> </pre><br><br>  At <a href="http://localhost:3000/search%3Fquery%3D%2523b_%26amp%3Btwitter%3Don">http: // localhost: 3000 / search? Query =% 23b_ &amp; twitter = on</a> , a page will open with a JSON data object, which is delivered by the <code>service_type_twitter</code> block. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/17e/804/093/17e8040937c969f741dadbc76a4f5826.png"><br><br>  Now add the conversion of this data to BEMJSON using BEMTREE.  Edit <code>server.node.js</code> : <br><br><pre> <code class="hljs lua">modules.<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>([<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(twitter)</span></span></span></span> { var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), PATH = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>), VM = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vm'</span></span>), express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>), app = express(), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), querystring = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'querystring'</span></span>), moment = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'moment'</span></span>), Vow = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vow'</span></span>), pathToBundle = PATH.join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'desktop.bundles'</span></span>, <span class="hljs-string"><span class="hljs-string">'index'</span></span>); app.use(express.static(pathToBundle)); var bemtreeTemplate = fs.readFileSync(PATH.join(pathToBundle, <span class="hljs-string"><span class="hljs-string">'index.bemtree.js'</span></span>), <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>); var context = VM.createContext({ console: console, Vow: Vow }); VM.runInContext(bemtreeTemplate, context); var BEMTREE = context.BEMTREE; app.get(<span class="hljs-string"><span class="hljs-string">'/search'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(req, res)</span></span></span></span> { var dataEntries = [], searchObj = url.parse(req.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).query, queryString = querystring.escape(searchObj.query), servicesEnabled = []; searchObj.twitter &amp;&amp; servicesEnabled.push(twitter.get(queryString)); Vow.all(servicesEnabled) .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(results)</span></span></span></span> { //      , //     Object.keys(results).map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx)</span></span></span></span> { dataEntries = dataEntries.<span class="hljs-built_in"><span class="hljs-built_in">concat</span></span>(results[idx]); }); //     dataEntries.<span class="hljs-built_in"><span class="hljs-built_in">sort</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b.createdAt.valueOf() - a.createdAt.valueOf(); }); //  BEMJSON     BEMTREE  BEMTREE.apply(dataEntries.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dataEntry)</span></span></span></span> { dataEntry.createdAt = moment(dataEntry.createdAt).fromNow(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { block: <span class="hljs-string"><span class="hljs-string">'island'</span></span>, data: dataEntry, mods: { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: dataEntry.<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> } }; })) .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bemjson)</span></span></span></span> { //   JSON res.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(JSON.stringify(bemjson, null, <span class="hljs-number"><span class="hljs-number">4</span></span>)); }); }) .fail(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { console.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>(arguments); }); }); var server = app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(<span class="hljs-string"><span class="hljs-string">'Listening on port %d'</span></span>, server.address().port); }); });</code> </pre><br>  BEMTREE-     ,    <code>vow</code> ,    . <br><br>  ,    ,          . <br><br>   <code>BEMTREE.apply()</code>   ,        ,  -  ,        BEMTREE-. <br><br>   <code>./desktop.blocks/island/_type/island_type_twitter.bemtree</code> : <br><br><pre> <code class="hljs kotlin">block(<span class="hljs-string"><span class="hljs-string">'island'</span></span>).mod(<span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'twitter'</span></span>).content()(function() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-comment"><span class="hljs-comment">//     ]; });</span></span></code> </pre><br>  <code>this.ctx.data</code>  ,     <code>BEMTREE.apply()</code> . <br><br>       <a href="http://localhost:3000/search%3Fquery%3D%2523b_%26amp%3Btwitter%3Don">http://localhost:3000/search?query=%23b_&amp;twitter=on</a> .     BEMJSON,    BEMTREE. <br><br>   BEMJSON  HTML   <code>BEMHTML.apply()</code> .     server.node.js  : <br><br><pre> <code class="hljs pgsql">var BEMHTML = require(<span class="hljs-type"><span class="hljs-type">PATH</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(<span class="hljs-string"><span class="hljs-string">'../../'</span></span> + pathToBundle, <span class="hljs-string"><span class="hljs-string">'index.bemhtml.js'</span></span>)).BEMHTML; //‚Ä¶ BEMTREE.apply(dataEntries.map(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(dataEntry) { dataEntry.createdAt = moment(dataEntry.createdAt).fromNow(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { block: <span class="hljs-string"><span class="hljs-string">'island'</span></span>, data: dataEntry, mods: { <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: dataEntry.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> } }; })) .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(bemjson) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchObj.json) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(<span class="hljs-type"><span class="hljs-type">JSON</span></span>.stringify(bemjson, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); } res.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(BEMHTML.apply(bemjson)); }); //‚Ä¶</code> </pre><br>      ,   HTML,         ‚Äî    AJAX. <br><br>    <code>json=on</code> ‚Äî   BEMJSON- ‚Äî <a href="http://localhost:3000/search%3Fquery%3D%2523b_%26amp%3Btwitter%3Don%26amp%3Bjson%3Don">http://localhost:3000/search?query=%23b_&amp;twitter=on&amp;json=on</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/32a/cd1/280/32acd1280fd474b9d2125a0f260750db.png"><br><br><h3>  JavaScript  <code>i-bem.js</code> </h3><br>     JavaScript     JavaScript-  -   - ‚Äì <code>i-bem.js</code> .    <code>bem-core</code> . <code>i-bem.js</code> ‚Äî    <code>i-bem</code>   <code>js</code> .        <code>jQuery</code>   API . <br><br>  ,   i-bem.js         <a href="https://ru.bem.info/technology/i-bem/"> </a> . <br><br>       : <br><ul><li>       ; </li><li> ; </li><li>   . </li></ul><br><h4>   js- </h4><br>     js-,    .  ,  ,    js-,  BEMHTML   <code>js</code> ,   BEMJSON ‚Äî  <code>js</code> : <br><br><pre> <code class="hljs vhdl">// bemhtml <span class="hljs-keyword"><span class="hljs-keyword">block</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'form</span></span>').js()(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br><pre> <code class="hljs pgsql">// bemjson { block: <span class="hljs-string"><span class="hljs-string">'form'</span></span>, js: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }</code> </pre><br><pre> <code class="hljs sql">// bemjson <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> js params { <span class="hljs-keyword"><span class="hljs-keyword">block</span></span>: <span class="hljs-string"><span class="hljs-string">'form'</span></span>, js: { p1: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>, p2: <span class="hljs-string"><span class="hljs-string">'v2'</span></span> } }</code> </pre><br>  <code>js</code>     ,    ,       js- .       HTML: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form i-bem"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bem</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{form: {p1: 'v1', p2 : 'v2'}}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <code>i-bem</code>   ,     DOM-    js-.   - <code>data-bem</code> <br>  ,       js-,   ‚Äî ,   . <br><br><h3>   <code>js</code> </h3><br><h4>  <code>form</code> </h4><br>   <code>./desktop.blocks/form/form.js</code>    : <br><br><pre> <code class="hljs actionscript">modules.define(<span class="hljs-string"><span class="hljs-string">'form'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, BEMDOM)</span></span></span><span class="hljs-function"> </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindTo(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSubmit); } } }, _onSubmit: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function"> </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.emit(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>); }, getVal: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domElem.serialize(); } })); });</code> </pre><br>  <code>bem-core</code>     . <code>i-bem</code> ‚Äî   . <code>i-bem__dom</code> ‚Äî  ,     DOM .    <code>form</code> ,      <code>i-bem__dom</code> ,     DOM-.         <code>BEMDOM</code> .       <code>form</code> .        ,      <code>js</code>   <code>inited</code> ‚Äî      <code>i-bem.js</code> .  ,       <code>_onSubmit</code> ,      ,    <code>getVal</code> ,     . <br><br>   <code>_onSubmit()</code>   <code>e.preventDefault()</code> ,         - <code>submit</code> ,         .        API  <code>form</code> .       -. <br><br><h4>  <code>sssr</code> </h4><br>   ,          . <br> <code>./desktop.blocks/sssr/sssr.js</code> : <br><br><pre> <code class="hljs javascript">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, BEMDOM, $</span></span></span><span class="hljs-function">) </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { <span class="hljs-attr"><span class="hljs-attr">onSetMod</span></span>: { <span class="hljs-attr"><span class="hljs-attr">js</span></span>: { <span class="hljs-attr"><span class="hljs-attr">inited</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } }, <span class="hljs-attr"><span class="hljs-attr">_sendRequest</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/search/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).getVal(), <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSuccess.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }); }, <span class="hljs-attr"><span class="hljs-attr">_onSuccess</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">) </span></span>{ BEMDOM.update(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem(<span class="hljs-string"><span class="hljs-string">'content'</span></span>), html); } })); });</code> </pre><br>    .      <code>sssr</code>    <code>i-bem__dom</code> ,    DOM-,  <code>jquery</code>    AJAX. <br>         <code>submit</code>  <code>form</code> .        <code>_sendRequest</code> ,  AJAX-.      ,   <code>_onSuccess</code> ,     <code>sssr__content</code>  . <br><br>   ,   <code>i-bem.js</code> ,    <code>sssr</code>  js-: <br><br><pre> <code class="hljs vhdl">// desktop.blocks/sssr/sssr.bemhtml <span class="hljs-keyword"><span class="hljs-keyword">block</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">'sssr</span></span>').js()(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br> ,   ,        .              <code>index.node.js</code>   : <br><br><pre> <code class="hljs pgsql">$ enb make &amp;&amp; node ./desktop.bundles/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.node.js</code> </pre><br>      .      <a href="http://localhost:3000/">localhost:3000</a> ,  -   ,       .    ,          . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1cf/6ea/430/1cf6ea43005c3cc5e9b437980061cfcf.png"><br><br>        ,        .          <code>borschik</code> .      <code>.borschik</code>    : <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"freeze_paths"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"libs/**"</span></span>: <span class="hljs-string"><span class="hljs-string">":base64:"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"libs/**"</span></span>: <span class="hljs-string"><span class="hljs-string">":encodeURIComponent:"</span></span> } }</code> </pre><br>      <code>production</code> : <br><br><pre> <code class="hljs pgsql">&gt; YENV=production enb make &amp;&amp; node desktop.bundles/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.node.js</code> </pre><br>            . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/330/b51/9b7/330b519b7c17f54b87200d86dba68e18.png"><br><br><h3>  .  <code>spin</code> </h3><br>          - ,   .  ,   ¬´¬ª.       <code>spin</code> ,       .      BEMJSON-.       <code>bem-components</code>    API.      : <br><br><pre> <code class="hljs lua">modules.<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>([<span class="hljs-string"><span class="hljs-string">'jquery'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($)</span></span></span></span> { $(<span class="hljs-string"><span class="hljs-string">'.spin'</span></span>).bem(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>).setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>); });</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/30a/3c1/abc/30a3c1abc41b8aaf348191f65296fb35.png"><br><br>     <code>spin_visible</code>   <code>true</code>         . <br><br>     ,     <code>js</code> -   . <br><br>        <code>./desktop.blocks/sssr/sssr.styl</code> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.sssr</span></span> { .spin { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">1em</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: middle; } }</code> </pre><br>  ,     .  <code>./desktop.blocks/sssr/sssr.js</code> : <br><br><pre> <code class="hljs lua">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, BEMDOM, $)</span></span></span></span> { provide(BEMDOM.decl(this.name, { onSetMod: { js: { inited: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { this.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, this._doRequest, this); } }, loading: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(modName, modVal)</span></span></span></span> { console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(<span class="hljs-string"><span class="hljs-string">'visible: '</span></span>, modVal); this.findBlockInside(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>).setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>, modVal); } }, // ‚Ä¶ _doRequest: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { this.setMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); this._sendRequest(); }, _onSuccess: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { this.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); BEMDOM.update(this.elem(<span class="hljs-string"><span class="hljs-string">'content'</span></span>), html); } })) })</code> </pre><br>          JS-,   CSS-  .   ,    ,   .    <code>./desktop.bundles/sssr/sssr.styl</code> : <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.sssr</span></span> { .spin { <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">1em</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">vertical-align</span></span>: middle; } &amp;_<span class="hljs-selector-tag"><span class="hljs-selector-tag">loading</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.content</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">opacity</span></span>: <span class="hljs-number"><span class="hljs-number">0.5</span></span>; } }</code> </pre><br>   : <a href="http://localhost:3000/">localhost:3000</a> .        <br>    <code>spin</code> ,    ‚Äî . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/120/63b/ed0/12063bed02698724bc62afffd22e9530.png"><br><br><h4>    </h4><br> ,         ,    .        <code>isEmpty()</code> : <br> <code>./desktop.blocks/form/form.js</code> : <br><br><pre> <code class="hljs actionscript">isEmpty: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'input'</span></span>).getVal().trim() || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlocksInside(<span class="hljs-string"><span class="hljs-string">'checkbox'</span></span>).every(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(checkbox)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !checkbox.hasMod(<span class="hljs-string"><span class="hljs-string">'checked'</span></span>); }); }</code> </pre><br>     <code>input</code>   <code>checkbox_checked</code>    . <br>    ,     ,   <code>sssr</code>   : <br> <code>./desktop.blocks/sssr/sssr.js</code> : <br><br><pre> <code class="hljs actionscript">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, BEMDOM, $)</span></span></span><span class="hljs-function"> </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._doRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }, loading: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(modName, modVal)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>).setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>, modVal); } }, _doRequest: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest(); }, _sendRequest: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ })</span></span></code> </pre><br>    <code>_doRequest()</code>       . <br><br>  ,     ,    .     <code>_sendRequest()</code>    <code>clear()</code>  <code>_updateContent()</code> . <br><br> <code>./desktop.blocks/sssr/sssr.js</code> : <br><br><pre> <code class="hljs javascript">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, BEMDOM, $</span></span></span><span class="hljs-function">) </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { <span class="hljs-attr"><span class="hljs-attr">onSetMod</span></span>: { <span class="hljs-attr"><span class="hljs-attr">js</span></span>: { <span class="hljs-attr"><span class="hljs-attr">inited</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._doRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modName, modVal</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>).setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>, modVal); } }, <span class="hljs-attr"><span class="hljs-attr">_doRequest</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest(); }, <span class="hljs-attr"><span class="hljs-attr">clear</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr.abort(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">_sendRequest</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr.abort(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr = $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/search/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).getVal(), <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSuccess.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }); }, <span class="hljs-attr"><span class="hljs-attr">_onSuccess</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(result); }, <span class="hljs-attr"><span class="hljs-attr">_updateContent</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">) </span></span>{ BEMDOM.update(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem(<span class="hljs-string"><span class="hljs-string">'content'</span></span>), html); } })); })</code> </pre><br><h4>      </h4><br>   ,       ,       <br>  .     <code>form</code>     <code>change</code>   <code>input</code> : <br><br><pre> <code class="hljs actionscript">modules.define(<span class="hljs-string"><span class="hljs-string">'form'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, BEMDOM)</span></span></span><span class="hljs-function"> </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindTo(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSubmit); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'input'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onChange, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } }, _onChange: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.emit(<span class="hljs-string"><span class="hljs-string">'change'</span></span>); }, <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ })</span></span></code> </pre><br>   <code>change</code>      <code>sssr</code> ,     <code>./desktop.blocks/sssr.js</code> : <br><br><pre> <code class="hljs actionscript">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, BEMDOM, $)</span></span></span><span class="hljs-function"> </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'submit change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._doRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }, <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ })); })</span></span></code> </pre><br>      ,     <code>./desktop.blocks/form.js</code> : <br><br><pre> <code class="hljs kotlin">modules.define(<span class="hljs-string"><span class="hljs-string">'form'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>], function(provide, BEMDOM) { provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindTo(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSubmit); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'input'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onChange, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); BEMDOM.blocks.checkbox.on(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.domElem, <span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onChange, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } }, <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ })</span></span></code> </pre><br>           : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/075/484/148/0754841482fe8b1661a9d08111cea162.png"><br><br>               .      .     <code>debounce</code>   <code>bem-core</code> .       <code>sssr</code>   <code>sssr.deps.js</code> : <br><br><pre> <code class="hljs css">({ <span class="hljs-attribute"><span class="hljs-attribute">shouldDeps</span></span>: [ { block: <span class="hljs-string"><span class="hljs-string">'server'</span></span> }, { <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'island'</span></span>, mods: { type: [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>] }}, { <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'functions'</span></span>, elem: <span class="hljs-string"><span class="hljs-string">'debounce'</span></span> } ] })</code> </pre><br>   -    .  ,    <code>functions__debounce</code>          <code>debounce</code> : <br><br><pre> <code class="hljs kotlin">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-string"><span class="hljs-string">'functions__debounce'</span></span>], function(provide, BEMDOM, $, debounce) { provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).on(<span class="hljs-string"><span class="hljs-string">'submit change'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._doRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._debounceRequest = debounce(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }, loading: function(modName, modVal) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>).setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>, modVal); } }, _doRequest: function(e) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._clear(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } e.type === <span class="hljs-string"><span class="hljs-string">'change'</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._debounceRequest(): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest(); }, _clear: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr.abort(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); }, _sendRequest: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr.abort(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr = $.ajax({ type: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, dataType: <span class="hljs-string"><span class="hljs-string">'html'</span></span>, cache: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, url: <span class="hljs-string"><span class="hljs-string">'/search/'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).getVal(), success: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSuccess.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }); }, _onSuccess: function(result) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(result); }, _updateContent: function(html) { BEMDOM.update(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem(<span class="hljs-string"><span class="hljs-string">'content'</span></span>), html); } })); });</code> </pre><br>        ,     .   ‚Äî         . <br><br><h3>  Auto update </h3><br>          .        <code>sssr</code>      <code>params</code> . <br><br> <code>index.bemjson.js</code> : <br><br><pre> <code class="hljs cs">{ block: <span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, mods: { autorefresh: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, js: { url: <span class="hljs-string"><span class="hljs-string">'/search/'</span></span>, refreshInterval: <span class="hljs-number"><span class="hljs-number">10000</span></span> }, <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>      : <code>./desktop.blocks/sssr/_autorefresh/sssr_autorefresh.js</code> : <br><br><pre> <code class="hljs lua">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'tick'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, tick, Sssr)</span></span></span></span> { provide(Sssr.decl({ modName: <span class="hljs-string"><span class="hljs-string">'autorefresh'</span></span> }, { onSetMod: { loading: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(modName, modVal)</span></span></span></span> { //    this.__base.apply(this, arguments); //    ‚Äî , //    ‚Äî   modVal ? this._clearTimer(): this._setTimer(); } }, _setTimer: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { this._counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; tick.on(<span class="hljs-string"><span class="hljs-string">'tick'</span></span>, this._onTick, this); }, _onTick: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //       (++this._counter * <span class="hljs-number"><span class="hljs-number">50</span></span>) % this.params.refreshInterval || this._sendRequest(); }, _clearTimer: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { tick.un(<span class="hljs-string"><span class="hljs-string">'tick'</span></span>, this._onTick, this); }, getDefaultParams: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { refreshInterval: <span class="hljs-number"><span class="hljs-number">10000</span></span> }; } })); });</code> </pre><br>   <code>this.__base</code>    <code>sssr_loading</code> .  <code>tick</code>        .   <code>tick</code>  50 .    <code>sssr_loading</code> ,    ,   . <br><br>  <code>refreshInterval</code>     <code>sssr</code> ,   .         <code>getDefaultParams</code> .           ,   . <br><br>       <code>sssr</code> .  <code>desktop.blocks/sssr/sssr.deps.js</code> : <br><br><pre> <code class="hljs css">({ <span class="hljs-attribute"><span class="hljs-attribute">shouldDeps</span></span>: [ <span class="hljs-string"><span class="hljs-string">'server'</span></span>, { block: <span class="hljs-string"><span class="hljs-string">'functions'</span></span>, elem: <span class="hljs-string"><span class="hljs-string">'debounce'</span></span> }, { <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'island'</span></span>, mods: { type: [<span class="hljs-string"><span class="hljs-string">'twitter'</span></span>] } } ] })</code> </pre><br>    .     10 . <br><br><h3>    </h3><br><h3>    </h3><br>         ,      ,      <br>   . <br>    <code>this.findBlockInside('form')</code>     <code>this._form</code>    .        <code>spin</code> . <br>           <code>sssr</code>       ,       . <br><br><pre> <code class="hljs kotlin">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-string"><span class="hljs-string">'functions__debounce'</span></span>], function(provide, BEMDOM, $, debounce) { provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { onSetMod: { js: { inited: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._spin = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._form = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>) .on(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._doRequest, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._debounceRequest = debounce(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }, loading: function(modName, modVal) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._spin.setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>, modVal); } }, _doRequest: function(e) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._form.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._clear(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } e.type === <span class="hljs-string"><span class="hljs-string">'change'</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._debounceRequest(): <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest(); }, _clear: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._abortRequest(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); }, _abortRequest: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr.abort(); }, _sendRequest: function() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._abortRequest(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr = $.ajax({ type: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, dataType: <span class="hljs-string"><span class="hljs-string">'html'</span></span>, cache: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, url: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.params.url, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._form.getVal(), success: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSuccess.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }); }, _onSuccess: function(result) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(result); }, _updateContent: function(result) { BEMDOM.update(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem(<span class="hljs-string"><span class="hljs-string">'content'</span></span>), result); } })); });</code> </pre><br>  ,    ,   ,    <code>_abortRequest()</code> . <br><br><h4>  Delayed initialization </h4><br>      ,            ,   . <br>         .    <code></code>  <code>live</code> -.      <a href="https://ru.bem.info/libs/bem-core/current/i-bem-js/i-bem-js/">  i-bem.js</a> . <br><br>        <code>sssr</code>  <code>form</code> ,      .     : <br> <code>./desktop.blocks/sssr/sssr.js</code> : <br><br><pre> <code class="hljs javascript">modules.define(<span class="hljs-string"><span class="hljs-string">'sssr'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>, <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, <span class="hljs-string"><span class="hljs-string">'functions__debounce'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, BEMDOM, $, debounce</span></span></span><span class="hljs-function">) </span></span>{ provide(BEMDOM.decl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, { <span class="hljs-attr"><span class="hljs-attr">onSetMod</span></span>: { <span class="hljs-attr"><span class="hljs-attr">js</span></span>: { <span class="hljs-attr"><span class="hljs-attr">inited</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._form = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'form'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._spin = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.findBlockInside(<span class="hljs-string"><span class="hljs-string">'spin'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._debounceRequest = debounce(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }, <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modName, modVal</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._spin.setMod(<span class="hljs-string"><span class="hljs-string">'visible'</span></span>, modVal); } }, <span class="hljs-attr"><span class="hljs-attr">_clear</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._abortRequest(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">_doRequest</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">needDebounce</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._form.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._clear(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); needDebounce? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._debounceRequest() : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._sendRequest(); }, <span class="hljs-attr"><span class="hljs-attr">_sendRequest</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._abortRequest(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr = $.ajax({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.params.url, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._form.getVal(), <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onSuccess.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }); }, <span class="hljs-attr"><span class="hljs-attr">_abortRequest</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._xhr.abort(); }, <span class="hljs-attr"><span class="hljs-attr">_onSuccess</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._updateContent(result); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.delMod(<span class="hljs-string"><span class="hljs-string">'loading'</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">_updateContent</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">) </span></span>{ BEMDOM.update(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elem(<span class="hljs-string"><span class="hljs-string">'content'</span></span>), html); } }, { <span class="hljs-attr"><span class="hljs-attr">live</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.liveInitOnBlockInsideEvent(<span class="hljs-string"><span class="hljs-string">'submit change'</span></span>, <span class="hljs-string"><span class="hljs-string">'form'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._doRequest(e.type === <span class="hljs-string"><span class="hljs-string">'change'</span></span>); }); } })); });</code> </pre><br>  <code>live</code> -   <code>form</code> : <br> <code>./desktop.blocks/form/form.js</code> : <br><br><pre> <code class="hljs lua">modules.define(<span class="hljs-string"><span class="hljs-string">'form'</span></span>, [<span class="hljs-string"><span class="hljs-string">'i-bem__dom'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(provide, BEMDOM)</span></span></span></span> { provide(BEMDOM.decl(this.name, { onSetMod: { js: { inited: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { this._input = this.findBlockInside(<span class="hljs-string"><span class="hljs-string">'input'</span></span>); this._checkboxes = this.findBlocksInside(<span class="hljs-string"><span class="hljs-string">'checkbox'</span></span>); } } }, // ‚Ä¶ isEmpty: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !this._input.getVal().trim() || this._checkboxes.every(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(checkbox)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !checkbox.hasMod(<span class="hljs-string"><span class="hljs-string">'checked'</span></span>); }); } }, { live: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var ptp = this.prototype; this .liveBindTo(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>, ptp._onSubmit) .liveInitOnBlockInsideEvent(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-string"><span class="hljs-string">'input'</span></span>, ptp._onChange) .liveInitOnBlockInsideEvent(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-string"><span class="hljs-string">'checkbox'</span></span>, ptp._onChange); } })); });</code> </pre><br>     <br> <code>input</code>  <code>checkbox</code> ,   ,     <code>findBlockInside</code> . <br><br><h3>   </h3><br>       ,    -.              <code>i-bem.js</code> ,    BEMTREE   -  BEMHTML   -  HTML.   <a href="https://github.com/bem/sssr/tree/master/desktop.blocks/service/_type">sssr</a>     <code>service__type__*</code>   API Instagram  .. ,                .       ,              . <br><br>             ,      .        <a href="">info@bem.info</a> . </div><p>Source: <a href="https://habr.com/ru/post/251473/">https://habr.com/ru/post/251473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251463/index.html">The geolocation saga and how to make a geo-web service on NGINX without a database engine and without programming</a></li>
<li><a href="../251465/index.html">Interfaces in the real world (more examples)</a></li>
<li><a href="../251467/index.html">React v0.13 RC</a></li>
<li><a href="../251469/index.html">How Internet giants have turned the network hardware business upside down</a></li>
<li><a href="../251471/index.html">Big Data Training: Spark MLlib</a></li>
<li><a href="../251477/index.html">Honest private properties in the prototype</a></li>
<li><a href="../251479/index.html">We write a bot for MMORPG with assembler and draenei. Part 4</a></li>
<li><a href="../251487/index.html">Draining data 180 thousand users FL.ru</a></li>
<li><a href="../251489/index.html">A router from the operator? - No thanks!</a></li>
<li><a href="../251491/index.html">MS Dynamics CRM and PostSharp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>