<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Layers + Unity Container</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I want to give an example of layers-architecture and the role of the Unity container in it. Otherwise, the people write about the container its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Layers + Unity Container</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I want to give an example of layers-architecture and the role of the Unity container in it.  Otherwise, the people write about the container itself, but they cannot write how to use it properly.  Let me try. <br><br><a name="habracut"></a><br>  I'll start very far away, sorry right away.  Simply, in order to explain something useful, you need to come up with something really useful. <br><br><h3>  (Not very) life example </h3><br>  Suppose you are a cool developer and you have two programmer friends: Kolyan and Tolyan.  Kolyan and Tolyan are all good, but experience is not enough, the quality of their code, as a result, suffers, but you are friends with them and sometimes even do a project together. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now - suddenly, out of nowhere does the customer from IBBC call you and loudly shout: <br>  - Volodya!  We urgently need to get an application that will display items on the screen!  Deadline week.  Money - a million! <br>  And hangs up. <br><br>  Since any design begins with the design, we will design. <br><br><h3>  Layers and black boxes </h3><br>  We will build the system on layers. <br><br>  The definition of the software layer from the Microsoft Architecture Application Guide is as follows (in a somewhat loose translation of me, sorry): <br><br>  <em>A layer is a logical grouping of software components that make up an application or service.</em> <br><br>  In other words, in the ‚Äúlayered architecture‚Äù, that same heap of software components that make up an application is divided into several logically related subsets.  Everyone knows the classics of the genre - the UI layer, the business logic layer, the data layer. <br><br>  Judging by the customer, we need to show something in the user interface and take data from some source.  Therefore, the system will consist of two layers - a UI-layer, a Data-layer, as well as a driver (which connects the layers + main ()). <br><br>  Agreed that the UI will be written by Kolyan, and the data layer will be written by Tolyan.  You will carry out coordinating activities and write the program driver plus cross-cutting code. <br><br><h3>  Black boxes </h3><br>  A layer is a software module (an assembly or assemblies with one main in .net).  This module can be implemented as a black or white box. <br><ul><li>  The black box means that you know the interface component of the layer and can only operate on the functionality of the box through it. </li><li>  A white box means that all control entities of a program component are visible by other components that are aware of the existence of the box. </li></ul><br>  In other words, you do not know what is in the black box, but you have a control panel (interfaces) to it. <br>  In the white box you are the master - what you want, you are doing with its filling.  It is transparent and all the insides are visible. <br><br>  In our case, designing the layers using the black box method is kosher, which is why: <br><ol><li>  You achieve conceptual integrity and encapsulation.  Having developed a single mechanism for accessing a layer through its interface, you will acquire semantic completeness (that is, a limb), which allows you to operate only with box entities. </li><li>  Encapsulation and (very importantly) ignorance of how the concrete entities of the layer are constructed allow you to focus on a more general problem, removing the care of unnecessary subtleties from your head. </li><li>  In the end, the best minds from programming tell us about these postulates, so let's hear the clever uncles :) </li></ol><br><br><h3>  Container and its role </h3><br>  From all of the above, it turns out that you need to organize a software module in such a way that it: <br><ol><li>  Implemented his assigned contracts </li><li>  Hid the entire implementation of specific entities. </li></ol><br>  Since we encapsulate all the implementations in the box, we cannot directly access them and work with them in the usual way.  We need to somehow link the contract of the box and its implementation, save it somewhere, so that later other participants in the process can use them.  For this you need a container.  In the degenerate case itself, it is the usual ‚Äúinterface-specific type‚Äù dictionary.  In a more complicated case, like, for example, with Unity, it‚Äôs also a dependency injector and other blackjack sluts. <br><br>  At the time of launching the application, you need to dip the container into the layer and allow the layer to register its implementations for the contracts it is bound to.  After all the implementations are assembled, you can already write the control code, not worrying who we have xy. <br><br>  All this you planned out in your head (what a fine fellow), now we proceed to the development stage. <br><br><h3>  Code </h3><br><br>  Need a contract assembly.  They can be made several - on each layer.  But I will make one common, for simplicity. <br>  Tolyan makes us access to data.  Let its layer implement this: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> IDataService <br> { <br> <font color="#0000ff">object</font> GetData(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  And Kolyan, respectively, got UI: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> IDataView <br> { <br> <font color="#0000ff">void</font> ShowData(); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IViewFactory <br> { <br> IDataView Create(Type viewType); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  A software module must contain a single public class so that we can put our hands in the container with it and scoop up a handful of implementations: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> IModule <br> { <br> <font color="#0000ff">void</font> Configure(IUnityContainer container); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  All contracts are defined.  Now we need to put everything together in the control application: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> ShellApplication <br> { <br> <font color="#0000ff">public</font> ShellApplication() <br> { <br> _container = <font color="#0000ff">new</font> UnityContainer(); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Run() <br> { <br> Application.EnableVisualStyles(); <br> Application.SetCompatibleTextRenderingDefault( <font color="#0000ff">false</font> ); <br> <br> _container.RegisterInstance&lt;IUnityContainer&gt;(_container); <br> _container.Resolve&lt;Layers.Data.Module&gt;().Configure(_container); <br> _container.Resolve&lt;Layers.UI.Module&gt;().Configure(_container); <br> <br> MainForm form = (MainForm)_container.Resolve( <font color="#0000ff">typeof</font> (MainForm)); <br> <br> Application.Run(form); <br> } <br> <br> <font color="#0000ff">private</font> IUnityContainer _container; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">partial</font> <font color="#0000ff">class</font> MainForm : Form <br> { <br> <font color="#0000ff">public</font> MainForm(IViewFactory factory) <br> { <br> InitializeComponent(); <br> _factory = factory; <br> } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> OnLoad( <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#0000ff">base</font> .OnLoad(e); <br> <br> IDataView view = _factory.Create( <font color="#0000ff">typeof</font> (IDataView)); <br> Controls.Add((Control)view); <br> view.ShowData(); <br> } <br> <br> <font color="#0000ff">private</font> IViewFactory _factory; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  With your part all. <br><br>  Now we need to force Kolyan and Tolyan to write the necessary code.  With proper skill, you can write all the parts together in parallel.  Thus, the charm of development is in its chic scalability.  If you plan everything correctly, the development of layers of modules starts quickly and quickly, without being distracted by other parts. <br><br>  Iteration is also supported - you can write in a descending manner.  First you need to write the control code, hanging on it "fake layers" and changing the contracts under the requirements in the iterations.  After the control code is debugged and fixed, it remains to sweep the corners - to realize the boxes. <br><br>  Kolyan, Tolyan and I got this: <br><img src="https://habrastorage.org/getpro/habr/post_images/3ec/a22/498/3eca224987b74f3e80c822eb7a5ba25d.png"><br>  See all around the envelopes.  Layers stuck out only their tail - the class of the module. <br><br>  And to the peasant from IBBC we made his application and grabbed a lot of money.  Tolyan and Kolyan bought dozens, and I - prior. <br><br>  Stand still.  I almost forgot.  You can tell me ‚ÄúHa-ha-ha-ha !!!  Sucker!  Sucker! ‚Äù, About the same as Henry Rollins did at the end of the fourth minute of his very good <a href="http://www.youtube.com/watch%3Fv%3D_vgQalXaIxs">song</a> .  How did I hide all the implementations, and unit testing?!?! <br><br>  Well, I do this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[assembly: System.Runtime.CompilerServices.InternalsVisibleTo( <font color="#A31515">"Services.Tests, PublicKey=00240000048000009[skipped]1fbcb51f56dfcc8db5320774f354553ad"</font> )]</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  No need to explain? :) <br><br><h3>  Features, conclusions, notes, bonuses and drawbacks </h3><br><br>  Sory that I do an example on Windows Forms.  I would like to tell you how to arrange the architecture of an ASP.NET MVC application in this way, but Comrade <a href="https://habrahabr.ru/users/xaoccps/" class="user_link">XaocCPS</a> will beat me for it.  I would love to fight, but he is faster and faster than me.  Leave this topic to him. <br><br>  1) The control assembly should have references to all layers and assembly contracts.  Otherwise, it will not be possible to collect implementations. <br><br>  2) Kolyan had to use the Tolyan data service (according to the paradigm, the UI layer depends on the data layer): <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">partial</font> <font color="#0000ff">class</font> DataView : UserControl, IDataView <br> { <br> <font color="#0000ff">public</font> DataView(IDataService data) <br> { <br> InitializeComponent(); <br> _dataService = data; <br> listBox1.DataSource = _source; <br> } <br> <br> <font color="#0000ff">#region</font> IDataView Members <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> ShowData() <br> { <br> _source.DataSource = _dataService.GetData(); <br> } <br> <br> <font color="#0000ff">#endregion</font> <br> <br> <font color="#0000ff">private</font> IDataService _dataService; <br> <font color="#0000ff">private</font> BindingSource _source = <font color="#0000ff">new</font> BindingSource(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  But due to the fact that we resolve the data layer dependencies earlier than the UI layer plus the unusual, street magic of the Unity container, we do not have any problems with the dependency. <br><br>  And this is how Tolyan implemented the IModule in his layer: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Module : IModule <br> { <br> <font color="#0000ff">#region</font> IModule Members <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Configure(Microsoft.Practices.Unity.IUnityContainer container) <br> { <br> container.RegisterType( <font color="#0000ff">typeof</font> (IDataService), <font color="#0000ff">typeof</font> (DataService)); <br> } <br> <br> <font color="#0000ff">#endregion</font> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  3) Perhaps the main advantage of this approach is encapsulation.  We operate with interfaces.  We do not need to know what is behind them.  With the slightest inadequacy of Tolyan or Kolyan, we simply throw away everything that he wrote, and write ours, staying (legitimately) in full confidence for the safety of other code.  You just need to implement the contracts of the replaced box: D <br><br>  4) Someone <a href="https://habrahabr.ru/users/sse/" class="user_link">sse</a> asked a completely wonderful question in the <a href="http://habrahabr.ru/blogs/net/63280/">article</a> about the unit: <br><br><blockquote>  Because for such simple examples <br><br> <code>var svc = new MyService(10);</code> <br> <br>  looks much better than <br><br> <code>var uc = new UnityContainer(); <br> uc.RegisterType&lt;IService, MyService&gt;(); <br> uc.RegisterType(new InjectionConstructor(10)); <br> var svc = uc.Resolve();</code> <br> </blockquote><br>  I think I explained his misunderstanding. <br><br>  5) Generally speaking, the Unity container is intended for dependency injectors and the factory of objects of the new framework from MS - Unity Application Block.  And it seems as if he tells us that it is better not to use it outside the framework walls, but the possibilities of its use are really very wide. <br><br>  6) The forms and user controls specified in the code need to be refined through the MVP pattern.  But this is an amateur :) <br><br>  Thanks for attention:) <br><br></div><p>Source: <a href="https://habr.com/ru/post/63698/">https://habr.com/ru/post/63698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../63687/index.html">Mobile devices: device idea</a></li>
<li><a href="../63691/index.html">Investor Day at iCamp Russia - $ 10 million for investments</a></li>
<li><a href="../63692/index.html">Cute robots</a></li>
<li><a href="../63696/index.html">"Runner" visiting PA AdLabs</a></li>
<li><a href="../63697/index.html">The story of two threads</a></li>
<li><a href="../63699/index.html">Philco Radio - home media center in retrostyle</a></li>
<li><a href="../63700/index.html">GadgetBlog.ru - another blog about gadgets?</a></li>
<li><a href="../63701/index.html">Simple geocoder</a></li>
<li><a href="../63702/index.html">OpenSource games and simple Linux games</a></li>
<li><a href="../63703/index.html">Stephen Hawking calls for DNA upgrade</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>