<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Download music and video from VC using Chrome browser using its extension</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear Habrazhiteli. Today I want to share with you codes on Javascript for the possibility of pumping music and video from VK with my p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Download music and video from VC using Chrome browser using its extension</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear Habrazhiteli.  Today I want to share with you codes on Javascript for the possibility of pumping music and video from VK with my pens on my personal computer.  After all, it is not difficult to imagine how I recorded a cool clip and music, then uploaded them there, but on your computer all this stuff has gone somewhere ... Well, it does not matter!  We will download what we downloaded back.  The main thing is that we are our browser, but the site allows, it remains to think about brains. <br><br>  First we need to parse the audio files ... So, let's take the class <b>‚Äúarea clear_fix‚Äù</b> and we will shove what belongs to the class <b>‚Äúplay_new‚Äù</b> into an array.  First, we assign styles in the array in order to catch the position of elements on the page (later for displaying buttons next to each other).  Then we get the links from the <b>input</b> and the name of the future file from the <b>b</b> tag.  Then it will be necessary to assign new links, which we will create the <b>download</b> attribute. <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">audio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> main_div=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">"area clear_fix"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;main_div.length;i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(main_div[i].parentNode.firstChild.href){ main_div[i].parentNode.firstChild.style.top=main_div[i].getElementsByClassName(<span class="hljs-string"><span class="hljs-string">'play_new'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].offsetTop+<span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _mp3_=main_div[i].getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"input"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].value.split(<span class="hljs-string"><span class="hljs-string">","</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _b_=main_div[i].getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"b"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _top_=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(main_div[<span class="hljs-number"><span class="hljs-number">0</span></span>].parentNode.id.replace(<span class="hljs-string"><span class="hljs-string">'audio'</span></span>,<span class="hljs-string"><span class="hljs-string">'play'</span></span>)).offsetTop+<span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _t_=main_div[i].getElementsByClassName(<span class="hljs-string"><span class="hljs-string">'play_new'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].offsetTop+<span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> span=main_div[i].getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ispan=span.innerHTML; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(span.children[<span class="hljs-number"><span class="hljs-number">0</span></span>]){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ispan=span.children[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerHTML; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _a_=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//_a_.href=""+_mp3_+"&amp;name="+_b_.children[0].innerHTML+"-"+ispan; _a_.href = _mp3_.substring(0, _mp3_.indexOf('.mp3') + 4); _a_.download=trim(_b_.children[0].innerHTML+"-"+ispan)+".mp3"; _a_.title=' '+_b_.children[0].innerHTML+"-"+ispan; _a_.draggable="true"; _a_.innerHTML='&lt;span style="cursor:copy;padding:6px;width:16px;height:16px;background-color:#5F7D9D;color:#fff;border-radius:2px;"&gt;&lt;img src="http://st0.vk.me/images/icons/darr.gif" /&gt;&lt;/span&gt;'; _a_.style.zIndex="10"; _a_.style.left="30px"; _a_.style.top=_t_; _a_.style.position="absolute"; main_div[i].parentNode.insertBefore(_a_,main_div[i].parentNode.firstChild); _b_.style.paddingLeft="27px"; } }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here, as it should be, everything should be ... well, but to cut off any rubbish after the file extension, we applied: <br>  <i>_a_.href = _mp3_.substring (0, _mp3_.indexOf ('. mp3') + 4);</i> <br><br>  In general, it is already possible to start this way in an interval, of course, if we are on the same site: <br><br><pre> <code class="javascript hljs">setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href.indexOf(<span class="hljs-string"><span class="hljs-string">'vk.com'</span></span>)&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">"area clear_fix"</span></span>).length!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ audio(); } } },<span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br><br>  Good.  One function is ready.  It's time to tell about how to download video files ... <br><br><a name="habracut"></a><br><br>  And again we firmly grab the class <b>‚Äúvideo_box_wrap‚Äù</b> and if this element does not contain the id attribute with <b>downloadvideo</b> , and if there is no IFRAME that we can slip into some YouTube, rutub, then we parse it. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">videovk</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">"video_box_wrap"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; !<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'downloadvideo'</span></span>) &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'video_player'</span></span>).tagName!=<span class="hljs-string"><span class="hljs-string">'IFRAME'</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> invideo=<span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fl=<span class="hljs-built_in"><span class="hljs-built_in">encodeURI</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">unescape</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">"video_box_wrap"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerHTML.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">8</span></span>].split(<span class="hljs-string"><span class="hljs-string">'"'</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].replace(<span class="hljs-regexp"><span class="hljs-regexp">/amp;/g</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flvars=fl.split(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c=<span class="hljs-number"><span class="hljs-number">0</span></span>;c&lt;=flvars.length<span class="hljs-number"><span class="hljs-number">-1</span></span>;c++){ name[c]=flvars[c].split(<span class="hljs-string"><span class="hljs-string">"="</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; content[c]=flvars[c].split(<span class="hljs-string"><span class="hljs-string">"="</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c2=<span class="hljs-number"><span class="hljs-number">0</span></span>;c2&lt;=name.length;c2++){ obj[name[c2]]=content[c2]; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> countvid=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.url240){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> invideo=invideo+vv(obj.url240,<span class="hljs-string"><span class="hljs-string">'240'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.url360){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> invideo=invideo+vv(obj.url360,<span class="hljs-string"><span class="hljs-string">'360'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.url480){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> invideo=invideo+vv(obj.url480,<span class="hljs-string"><span class="hljs-string">'480'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.url720){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> invideo=invideo+vv(obj.url720,<span class="hljs-string"><span class="hljs-string">'720'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.cache240){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; invideo=invideo+vv(obj.cache240,<span class="hljs-string"><span class="hljs-string">'240'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.cache360){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; invideo=invideo+vv(obj.cache360,<span class="hljs-string"><span class="hljs-string">'360'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.cache480){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; invideo=invideo+vv(obj.cache480,<span class="hljs-string"><span class="hljs-string">'480'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj.cache720){ countvid+=<span class="hljs-number"><span class="hljs-number">1</span></span>; invideo=invideo+vv(obj.cache720,<span class="hljs-string"><span class="hljs-string">'720'</span></span>,countvid,obj.md_title); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> videodownloader=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"div"</span></span>); videodownloader.style.height=<span class="hljs-string"><span class="hljs-string">"auto"</span></span>;videodownloader.style.width=<span class="hljs-string"><span class="hljs-string">"auto"</span></span>; videodownloader.id=<span class="hljs-string"><span class="hljs-string">"downloadvideo"</span></span>;videodownloader.style.paddingBottom=<span class="hljs-string"><span class="hljs-string">"5px"</span></span>; videodownloader.innerHTML=invideo; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"mv_narrow"</span></span>).insertBefore(videodownloader, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"mv_narrow"</span></span>).firstChild); } }</code> </pre><br><br>  ... from the code it is clear that we form links to video options of different formats and add self-generated references with the <b>id = "downloadvideo"</b> <b>download</b> attribute immediately to the identifier <b>mv_narrow</b> . <br><br>  And then we need the function <b>vv</b> to create links on the page.  To recognize the Russian letters, we need the <b>utf8_decode</b> function, and to trim spaces around the edges, the <b>trim</b> function. <br><br>  Decoding function: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">utf8_decode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">utftext</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> string = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = c1 = c2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( i &lt; utftext.length ) { c = utftext.charCodeAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-number"><span class="hljs-number">128</span></span>) { string += <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(c); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((c &gt; <span class="hljs-number"><span class="hljs-number">191</span></span>) &amp;&amp; (c &lt; <span class="hljs-number"><span class="hljs-number">224</span></span>)) { c2 = utftext.charCodeAt(i+<span class="hljs-number"><span class="hljs-number">1</span></span>); string += <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(((c &amp; <span class="hljs-number"><span class="hljs-number">31</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c2 &amp; <span class="hljs-number"><span class="hljs-number">63</span></span>)); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { c2 = utftext.charCodeAt(i+<span class="hljs-number"><span class="hljs-number">1</span></span>); c3 = utftext.charCodeAt(i+<span class="hljs-number"><span class="hljs-number">2</span></span>); string += <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(((c &amp; <span class="hljs-number"><span class="hljs-number">15</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((c2 &amp; <span class="hljs-number"><span class="hljs-number">63</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c3 &amp; <span class="hljs-number"><span class="hljs-number">63</span></span>)); i += <span class="hljs-number"><span class="hljs-number">3</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> string; }</code> </pre><br><br>  Trim function: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trim</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^[\s]+/</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-regexp"><span class="hljs-regexp">/[\s]+$/</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre><br><br>  Reference feature: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vv</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a,b,c,d</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c%<span class="hljs-number"><span class="hljs-number">2</span></span>!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p1=<span class="hljs-string"><span class="hljs-string">"&lt;p&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p2=<span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(c%<span class="hljs-number"><span class="hljs-number">2</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p1=<span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p2=<span class="hljs-string"><span class="hljs-string">"&lt;/p&gt;"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p1+<span class="hljs-string"><span class="hljs-string">"&lt;a style='color:white;background-color:#2F5879;padding:5px 5px 2px 5px; border:#395A7C;' "</span></span> + <span class="hljs-string"><span class="hljs-string">" draggable='true' title=': "</span></span>+utf8_decode(trim(<span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(d)))+<span class="hljs-string"><span class="hljs-string">"' download='"</span></span>+utf8_decode(trim(<span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(d)))+<span class="hljs-string"><span class="hljs-string">"."</span></span>+a.substr(<span class="hljs-number"><span class="hljs-number">-3</span></span>)+<span class="hljs-string"><span class="hljs-string">"' href='"</span></span>+a+<span class="hljs-string"><span class="hljs-string">"'&gt;"</span></span>+b+<span class="hljs-string"><span class="hljs-string">" ("</span></span>+a.substr(<span class="hljs-number"><span class="hljs-number">-3</span></span>)+<span class="hljs-string"><span class="hljs-string">")&lt;/a&gt; "</span></span>+p2; }</code> </pre><br><br>  The main part of the code is ready, it remains to correct the interval: <br><br><pre> <code class="javascript hljs">setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href.indexOf(<span class="hljs-string"><span class="hljs-string">'vk.com'</span></span>)&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'video_player'</span></span>) &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"mv_narrow"</span></span>)){ videovk(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">"area clear_fix"</span></span>).length!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ audio(); } } },<span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre><br><br>  Everything.  when the code is ready, and now we need a manifest, here it is: <br><br><pre> <code class="html hljs xml">{ "manifest_version":2, "name":"Downloader", "version":"1.0", "description":"Downloader of mp3 files from vk.com and mail.ru.", "permissions": [ "http://vk.com/*", "tabs" ], "content_scripts": [ { "js": [ "main.js" ], "matches": [ "http://vk.com/*", "http://*.vk.com/*", "https://vk.com/*", "https://*.vk.com/*" ], "run_at": "document_end" } ], "content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self'", "browser_action": { "default_title":"Downloader Extension" } }</code> </pre><br><br>  In the content_scripts we write that our code with functions will be stored in the main.js file, which will be loaded after the page loads, that is, <i>‚Äúrun_at‚Äù: ‚Äúdocument_end‚Äù</i> . <br><br>  I think this code will be useful to many people as a training / use.  In fact, all the <b>js</b> code will look like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">audio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> main_div=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">"area clear_fix"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;main_div.length;i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(main_div[i].parentNode.firstChild.href){ main_div[i].parentNode.firstChild.style.top=main_div[i].getElementsByClassName(<span class="hljs-string"><span class="hljs-string">'play_new'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].offsetTop+<span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _mp3_=main_div[i].getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"input"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].value.split(<span class="hljs-string"><span class="hljs-string">","</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _b_=main_div[i].getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"b"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _top_=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(main_div[<span class="hljs-number"><span class="hljs-number">0</span></span>].parentNode.id.replace(<span class="hljs-string"><span class="hljs-string">'audio'</span></span>,<span class="hljs-string"><span class="hljs-string">'play'</span></span>)).offsetTop+<span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _t_=main_div[i].getElementsByClassName(<span class="hljs-string"><span class="hljs-string">'play_new'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].offsetTop+<span class="hljs-string"><span class="hljs-string">"px"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> span=main_div[i].getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ispan=span.innerHTML; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(span.children[<span class="hljs-number"><span class="hljs-number">0</span></span>]){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ispan=span.children[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerHTML; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _a_=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//_a_.href=""+_mp3_+"&amp;name="+_b_.children[0].innerHTML+"-"+ispan; _a_.href = _mp3_.substring(0, _mp3_.indexOf('.mp3') + 4); _a_.download=trim(_b_.children[0].innerHTML+"-"+ispan)+".mp3"; _a_.title=' '+_b_.children[0].innerHTML+"-"+ispan; _a_.draggable="true"; _a_.innerHTML='&lt;span style="cursor:copy;padding:6px;width:16px;height:16px;background-color:#5F7D9D;color:#fff;border-radius:2px;"&gt;&lt;img src="http://st0.vk.me/images/icons/darr.gif" /&gt;&lt;/span&gt;'; _a_.style.zIndex="10"; _a_.style.left="30px"; _a_.style.top=_t_; _a_.style.position="absolute"; main_div[i].parentNode.insertBefore(_a_,main_div[i].parentNode.firstChild); _b_.style.paddingLeft="27px"; } } function videovk(){ if(document.getElementsByClassName("video_box_wrap")[0] &amp;&amp; !document.getElementById('downloadvideo') &amp;&amp; document.getElementById('video_player').tagName!='IFRAME'){ var invideo=""; var obj = new Object(); var name=new Array(); var content=new Array(); var fl=encodeURI(unescape(document.getElementsByClassName("video_box_wrap")[0].innerHTML.split(" ")[8].split('"')[1].replace(/amp;/g,""))); var flvars=fl.split("&amp;"); for(var c=0;c&lt;=flvars.length-1;c++){ name[c]=flvars[c].split("=")[0]; content[c]=flvars[c].split("=")[1]; } for(var c2=0;c2&lt;=name.length;c2++){ obj[name[c2]]=content[c2]; } var countvid=0; if(obj.url240){ countvid+=1; var invideo=invideo+vv(obj.url240,'240',countvid,obj.md_title); } if(obj.url360){ countvid+=1; var invideo=invideo+vv(obj.url360,'360',countvid,obj.md_title); } if(obj.url480){ countvid+=1; var invideo=invideo+vv(obj.url480,'480',countvid,obj.md_title); } if(obj.url720){ countvid+=1; var invideo=invideo+vv(obj.url720,'720',countvid,obj.md_title); } if(obj.cache240){ countvid+=1; invideo=invideo+vv(obj.cache240,'240',countvid,obj.md_title); } if(obj.cache360){ countvid+=1; invideo=invideo+vv(obj.cache360,'360',countvid,obj.md_title); } if(obj.cache480){ countvid+=1; invideo=invideo+vv(obj.cache480,'480',countvid,obj.md_title); } if(obj.cache720){ countvid+=1; invideo=invideo+vv(obj.cache720,'720',countvid,obj.md_title); } var videodownloader=document.createElement("div"); videodownloader.style.height="auto";videodownloader.style.width="auto"; videodownloader.id="downloadvideo";videodownloader.style.paddingBottom="5px"; videodownloader.innerHTML=invideo; document.getElementById("mv_narrow").insertBefore(videodownloader, document.getElementById("mv_narrow").firstChild); } } function utf8_decode(utftext) { var string = ""; var i = 0; var c = c1 = c2 = 0; while ( i &lt; utftext.length ) { c = utftext.charCodeAt(i); if (c &lt; 128) { string += String.fromCharCode(c); i++; } else if((c &gt; 191) &amp;&amp; (c &lt; 224)) { c2 = utftext.charCodeAt(i+1); string += String.fromCharCode(((c &amp; 31) &lt;&lt; 6) | (c2 &amp; 63)); i += 2; } else { c2 = utftext.charCodeAt(i+1); c3 = utftext.charCodeAt(i+2); string += String.fromCharCode(((c &amp; 15) &lt;&lt; 12) | ((c2 &amp; 63) &lt;&lt; 6) | (c3 &amp; 63)); i += 3; } } return string; } function trim(str) { return str.replace(/^[\s]+/,"").replace(/[\s]+$/,""); } function vv(a,b,c,d){ if(c%2!=0){ var p1="&lt;p&gt;"; var p2=""; } if(c%2==0 ){ var p1=""; var p2="&lt;/p&gt;"; } return p1+"&lt;a style='color:white;background-color:#2F5879;padding:5px 5px 2px 5px; border:#395A7C;' " + " draggable='true' title=': "+utf8_decode(trim(decodeURIComponent(d)))+"' download='"+utf8_decode(trim(decodeURIComponent(d)))+"."+a.substr(-3)+"' href='"+a+"'&gt;"+b+" ("+a.substr(-3)+")&lt;/a&gt; "+p2; } setInterval(function(){ if(window.location.href.indexOf('vk.com')&gt;1) { if(document.getElementById('video_player') &amp;&amp; document.getElementById("mv_narrow")){ videovk(); } if(document.getElementsByClassName("area clear_fix").length!=0){ audio(); } } },1000);</span></span></code> </pre><br><br>  Good luck to all! </div><p>Source: <a href="https://habr.com/ru/post/215635/">https://habr.com/ru/post/215635/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215613/index.html">On the role of Albanian in testing</a></li>
<li><a href="../215619/index.html">Some problems Nokia Lumia 1520 in one post</a></li>
<li><a href="../215625/index.html">Epson: habradebut</a></li>
<li><a href="../215627/index.html">Soviet operation to save the dead space station</a></li>
<li><a href="../215629/index.html">Labor market research web developers</a></li>
<li><a href="../215637/index.html">What happens if you decide to assemble a 3D printer with your own hands</a></li>
<li><a href="../215641/index.html">We are on friendly terms with IPS Appliance and Multi-Layer Switch (Cisco IPS and Catalyst 6500)</a></li>
<li><a href="../215645/index.html">Clever image cropping using point of focus</a></li>
<li><a href="../215647/index.html">Android SDK vs NDK - comparing the performance of similar types of code</a></li>
<li><a href="../215651/index.html">Application on Express.js + Sass / Compass + CoffeeScript + Haml</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>