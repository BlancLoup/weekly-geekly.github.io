<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Task management in project organization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Required the chief engineer to automate the task management process. He gives a lot of orders to his subordinates, but it is simply unrealistic to man...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Task management in project organization</h1><div class="post__text post__text-html js-mediator-article">  Required the chief engineer to automate the task management process.  He gives a lot of orders to his subordinates, but it is simply unrealistic to manually control the process of their execution.  It is all the more impossible to remember all orders.  Therefore, immediately insisted on the use of suitable automation. <br><img src="https://habrastorage.org/files/079/320/553/079320553ba84d3fa3faf4868514cb9d.png"><br>  Non-trivial tasks required a non-trivial approach.  Detailed description with pictures and source code under the cut. <br><a name="habracut"></a><br>  Project organization, numbering about 200 people.  In the top management there are 4 people, in direct submission of the chief engineer 4 main project engineers (CIP) and as many of their assistants, plus all the department heads. <br><br>  The chief engineer per day can assign from 5 to 15 tasks to his direct subordinates, who, in turn, can delegate tasks to several department heads, and those to their subordinates.  Classical hierarchical scheme.  Thus, the number of active tasks per unit of time can reach 600-800!  To keep them all in your head is simply unrealistic, and in the conditions of a lame performing discipline the issue of control becomes vital. <br><br>  In the organization, at that moment, MS Project was used for several years, however, for project management in general, and not for short-term assignments.  The idea of ‚Äã‚Äãusing it to manage short-term orders is shallow after a brief discussion. <br>  Given the experience of using the easla.com system for managing correspondence, we decided to try using it for task management.  Moreover, the tasks involved close integration with correspondence. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Task </h4><br>  I mean, not a task, but a statement of the problem.  Initially, all the same, it was planned to make the tasks simple: the topic, description, author, performer, planned and actual dates.  Therefore, the requirements were simple: <br><ul><li>  Register a task in the system </li><li>  Automatically identify the author and allow you to select any artist </li><li>  Automatically calculate scheduled dates </li><li>  When changing statuses, fix actual dates. </li></ul><br>  A little later, already during the trial operation, it was necessary to expand the functionality and the requirements became more: <br><ul><li>  Assign one task to multiple performers </li><li>  Create nested tasks (subtasks) </li><li>  Separately fix the link to the contract (draft) </li><li>  Allow to specify the basis for opening a task (incoming or outgoing email) </li><li>  Allow, and sometimes require, the reason for closing the task </li><li>  The importance of the task on which the planned deadline for its closure will depend </li><li>  Ability to specify labor costs. </li></ul><br>  In general, the tasks were not as simple as it seemed at first glance. <br><br><h4>  Decision </h4><br>  First of all, the questions caused tasks to several performers.  If you create one task for all, i.e.  not personalized, the probability of its execution will decrease to almost zero.  Each performer will hope for another.  I do not know, like the others, but we have exactly that.  Therefore, all tasks should be individualized, so that we had to implement the task cloning mechanism for each executor. <br>  Then it was necessary to determine the importance of the task.  Three types of importance were introduced and each was assigned a maximum due date: <br><ul><li>  High (8 working hours, i.e. working day) </li><li>  Normal (40 business hours, i.e., work week) </li><li>  Low (80 working hours). </li></ul><br>  Labor is also an interesting topic.  Some employees find it difficult to specify the time spent.  I do not even know how to explain this, but they are either afraid to put too little, or they are afraid to indicate too much, therefore they have entered an approximate scale with sufficient accuracy for analysis: <br><ul><li>  Not at all </li><li>  Seconds </li><li>  A couple of minutes </li><li>  15 minutes </li><li>  Half an hour </li><li>  45 minutes </li><li>  Whole hour </li><li>  More than an hour, etc. </li></ul><br>  Having decided on the tool and principles of the process, I started the implementation. <br><br><h4>  Implementation </h4><br>  In easla.com created a new process "Tasks".  In it created the object "Task".  The object has the following attributes. <br><br><h4>  Attributes </h4><br><h5>  room </h5><br>  Normal counter for sequential numbering. <br><br><h5>  Designation </h5><br>  String attribute  The value is calculated after the creation of the task and cannot be changed by the user.  In the read-only mode, the attribute is translated in the ‚ÄúAt Initialization‚Äù script: <br><pre><code class="php hljs">cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;readonly = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br><br><h5>  Author </h5><br>  User, i.e.  employee of the organization.  The author can be any employee of the organization.  A complete list of employees is formed in the "At Initialization" script: <br><pre> <code class="php hljs">$src_users = corganization()-&gt;users(); $end_users = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) $end_users += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($u-&gt;id =&gt; $u-&gt;description); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;values = $end_users; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value = cuser()-&gt;id; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;readonly = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre><br>  The attribute is assigned the value of the active user and the ‚Äúread only‚Äù mode so that it is not possible to create a task from another employee. <br><br><h5>  Executor </h5><br>  Employee of the organization entrusted with the task.  Multiple attribute, since  The same task can be performed by different specialists, and, say, the ISU will bring everything together into one solution.  The list of employees is formed in the "At initialization" script: <br><pre> <code class="php hljs">$src_users = corganization()-&gt;group(<span class="hljs-string"><span class="hljs-string">'group_all'</span></span>)-&gt;users(); $end_users = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($u[<span class="hljs-string"><span class="hljs-string">'islocked'</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>) $end_users += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($u-&gt;id =&gt; $u-&gt;description); asort($end_users); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;values = $end_users; cattributeref()-&gt;size = <span class="hljs-number"><span class="hljs-number">6</span></span>;</code> </pre><br><br><h5>  Contract </h5><br>  Link to the object "Contract".  The attribute is initialized in the ‚ÄúTask‚Äù object script. <br><br><h5>  Theme </h5><br>  Normal string attribute.  At first, the contract number was entered into it, but they quickly abandoned this practice and entered a separate attribute for the contract number. <br><br><h5>  Description </h5><br>  Multiline string attribute for a detailed description of the task.  The description can be changed only by the author of the task, therefore in the ‚ÄúOn Initialization‚Äù and ‚ÄúOn Change‚Äù scripts it is written: <br><pre> <code class="php hljs">cattributeref()-&gt;readonly = cuser()-&gt;id != cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value;</code> </pre><br><br><h5>  Notify about execution </h5><br>  An integer attribute, which is actually a flag, which defines the possibility of notifying the author of the task of its completion.  The list of valid values ‚Äã‚Äãand the initial value is defined in the "At Initialization" script: <br><pre> <code class="php hljs">cattributeref()-&gt;values = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cattributeref()-&gt;value)) cattributeref()-&gt;value = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br><br><a name="tsk_task_category"></a><h5>  Task Category </h5><br>  Classifier that defines the category of the task.  Now there are only three: <br><ul><li>  Preparation of the response to the letter </li><li>  The decision of the planning meeting </li><li>  Other </li></ul><br>  The list of valid values ‚Äã‚Äãis formed in the "At Initialization" script: <br><pre> <code class="php hljs">$src_classificators = classificatorChilds(<span class="hljs-string"><span class="hljs-string">'task_category'</span></span>); $end_classificators = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_classificators <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) $end_classificators += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]=&gt;$c[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($end_classificators) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;values = $end_classificators; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value = key($end_classificators); }</code> </pre><br>  When you change the category, the ‚Äúnecessity‚Äù of the ‚Äú <a href="https://habr.com/ru/company/easla/blog/301944/">Reason for closing</a> ‚Äù attribute changes. <br><pre> <code class="php hljs">$src_classificators = classificatorChilds(<span class="hljs-string"><span class="hljs-string">'task_category'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_classificators <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] == cattributeref()-&gt;value) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($c)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($c[<span class="hljs-string"><span class="hljs-string">'code'</span></span>] == <span class="hljs-string"><span class="hljs-string">'task_category_answer'</span></span>) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;isRequired = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><br><h5>  Importance </h5><br>  Classifier  The list of valid values ‚Äã‚Äãand the initial value are also defined in the ‚ÄúAt Initialization‚Äù script: <br><pre> <code class="php hljs">$src_classificators = classificatorChilds(<span class="hljs-string"><span class="hljs-string">'tsk_importance'</span></span>); $end_classificators = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_classificators <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) $end_classificators += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]=&gt;$c[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($end_classificators) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_importance'</span></span>)-&gt;values=$end_classificators; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_importance'</span></span>)-&gt;value = array_flip($end_classificators)[<span class="hljs-string"><span class="hljs-string">''</span></span>]; }</code> </pre><br>  ‚ÄúWhen changing‚Äù, the planned closing date of the task is recalculated: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cattributeref()-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; cobjectref()-&gt;calcPlanEndDate(cattributeref()-&gt;value);</code> </pre><br>  The <i>calcPlanEndDate</i> function <i>is</i> described in the <a href="https://habr.com/ru/company/easla/blog/301944/">object</a> itself. <br><br><h5>  Basis for opening </h5><br>  A reference to an object, in particular, an <a href="https://habrahabr.ru/company/easla/blog/281839/">incoming</a> or <a href="https://habrahabr.ru/company/easla/blog/281999/">outgoing</a> document, which became the basis for the appearance of the task.  The list of incoming and outgoing documents is formed in the ‚ÄúAt Initialization‚Äù script: <br><pre> <code class="php hljs">cattributeref()-&gt;readonly = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_description'</span></span>)-&gt;readonly; $base = cobjectref()-&gt;prepareIncomings(); $base += cobjectref()-&gt;prepareOutgoings(); $base = array_reverse($base, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); cattributeref()-&gt;values = $base;</code> </pre><br><br><h5>  Applications </h5><br>  File attribute  It is rarely used, but it is needed if the accompanying documents must be attached to the task. <br><br><a name="tsk_task_plan_startdate"></a><h5>  Start date (plan) </h5><br>  The planned date and time of the start of the task.  We agreed that it will be assigned with an offset of +1 hour to the current time, which is written in the ‚ÄúAt Initialization‚Äù script: <br><pre> <code class="php hljs">cattributeref()-&gt;readonly = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_description'</span></span>)-&gt;readonly; cattributeref()-&gt;value = calendarDateAdd(currentDateTime(), <span class="hljs-number"><span class="hljs-number">3600</span></span>);</code> </pre><br>  Only the author can change.  Separate attention to the calendarDateAdd function; it calculates the planned start date in accordance with the <a href="https://habrahabr.ru/company/easla/blog/283178/">production calendar</a> ! <br><br><a name="tsk_task_plan_enddate"></a><h5>  End Date (Plan) </h5><br>  The planned date and time of the end of the task.  Depends on the importance and the planned start date.  The initial value is calculated "During initialization": <br><pre> <code class="php hljs">cattributeref()-&gt;readonly = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_description'</span></span>)-&gt;readonly; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cattributeref()-&gt;value) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;tsk_task_importance)) { cobjectref()-&gt;calcPlanEndDate(cobjectref()-&gt;tsk_task_importance); }</code> </pre><br><br><h5>  Start date (fact) and End date (fact) </h5><br>  The actual start and end dates that are entered only when the status of the task changes. <br><br><a name="tsk_task_base_close"></a><h5>  Reason for closing </h5><br>  A reference to the object, namely, the outgoing document, which became the basis for closing the task.  Moreover, if the <a href="https://habr.com/ru/company/easla/blog/301944/">category of the task</a> ‚ÄúPreparing an Incoming Response‚Äù is assigned to the task, the task cannot be closed until the reason for closing is filled.  The list of available outgoing documents is formed in the "At Initialization" script: <br><pre> <code class="php hljs">$base = cobjectref()-&gt;prepareIncomings(); $base += cobjectref()-&gt;prepareOutgoings(); $base = array_reverse($base, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); cattributeref()-&gt;values = $base;</code> </pre><br><br><h5>  Labor costs </h5><br>  An integer attribute containing the number of seconds the executor spent on the task.  Since the tasks are assumed to be short-term, the list of acceptable values ‚Äã‚Äãis plentiful.  It is formed during attribute initialization: <br><pre> <code class="php hljs">cattributeref()-&gt;values = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'15 '</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'45 '</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'2 '</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'2  30 '</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'3 '</span></span>, <span class="hljs-number"><span class="hljs-number">240</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">480</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">960</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'2 '</span></span>, <span class="hljs-number"><span class="hljs-number">1440</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'3 '</span></span>, <span class="hljs-number"><span class="hljs-number">1920</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'4 '</span></span>, <span class="hljs-number"><span class="hljs-number">2400</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">4800</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">7200</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">9600</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">19200</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">19200</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-number"><span class="hljs-number">28800</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>, ); cattributeref()-&gt;value = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br><br><h5>  Comments </h5><br>  Multi-line text attribute for commenting the task.  The attribute saves history, so you can track who wrote what and when. <br>  That's all the attributes! <br><br><a name="tsk_task"></a><h4>  An object </h4><br>  The ‚ÄúTask‚Äù object has uneasy behavior and validation, which are described in its scripts.  Helper functions for initializing attributes and calculating dates and times are described in the script: <br><div class="spoiler">  <b class="spoiler_title">Before initialization of the object</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcTskCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($num)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'-'</span></span>.sprintf(<span class="hljs-string"><span class="hljs-string">'%06d'</span></span>, $num); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareContracts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $src_contracts = selectAll( <span class="hljs-string"><span class="hljs-string">'agr_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'agr_management_contract'</span></span> ); $end_contracts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_contracts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $s) $end_contracts += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($s[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; $s[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); asort($end_contracts); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $end_contracts; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareIncomings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $src_documents = selectAll( <span class="hljs-string"><span class="hljs-string">'crs_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'crs_management_incoming'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>) ); $end_documents = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_documents <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $d) $end_documents += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($d[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; $d[<span class="hljs-string"><span class="hljs-string">'description'</span></span>].<span class="hljs-string"><span class="hljs-string">' ['</span></span>.$d[<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>].<span class="hljs-string"><span class="hljs-string">']'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//asort($end_documents); return $end_documents; } function prepareOutgoings() { $src_documents = selectAll( 'crs_management', 'crs_management_outgoing' ); $end_documents = array(); foreach ($src_documents as $d) $end_documents += array($d['id'] =&gt; $d['description']); //asort($end_documents); return $end_documents; } function calcPlanEndDate($importance) { if (empty($importance)) return; $c = classificator($importance); if (empty($c)) return; $delta = 0; switch ($c['code']) { case 'tsk_importance_01': $delta = 28800; break; case 'tsk_importance_02': $delta = 144000; break; case 'tsk_importance_03': $delta = 288000; break; } cobjectref()-&gt;attributeref('tsk_task_plan_enddate')-&gt;value = calendarDateAdd(currentDateTime(), $delta); } if (cobjectref()-&gt;hasAttributeref('tsk_task_contract')) cobjectref()-&gt;attributeref('tsk_task_contract')-&gt;values = prepareContracts(); cobjectref()-&gt;childTabs = array('tsk_task_sub'); cobjectref()-&gt;childAll = false;</span></span></code> </pre><br></div></div><br>  I will separately pay attention to the <i>calcPlanEndDate</i> function, which uses the <i>calendarDateAdd</i> function to calculate a planned date and time.  With its help, it is possible to calculate the time in working hours, taking into account the organization‚Äôs <a href="https://habrahabr.ru/post/283178/">production calendar</a> . <br><br>  Additional initialization of attributes and the calculation of the state of the planned start and end dates is carried out in the script: <br><div class="spoiler">  <b class="spoiler_title">After initializing the object</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;parentrefId)) { $parent = select(cobjectref()-&gt;parentrefId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($parent)) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value = $parent-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value; } cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value = calcTskCode(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_num'</span></span>)-&gt;value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cobjectref()-&gt;inFinalStatus()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;tsk_task_plan_startdate) &amp;&amp; (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span> || cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;tsk_task_plan_startdate <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> DateTime) $dts_plan = date_timestamp_get(cobjectref()-&gt;tsk_task_plan_startdate); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $dts_plan = date_timestamp_get(date_create(cobjectref()-&gt;tsk_task_plan_startdate)); $dts_now = date_timestamp_get(date_create()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($dts_plan &lt; $dts_now) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($dts_plan - $dts_now &lt; <span class="hljs-number"><span class="hljs-number">3600</span></span>) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($dts_plan - $dts_now &lt; <span class="hljs-number"><span class="hljs-number">28800</span></span>) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;tsk_task_plan_enddate) &amp;&amp; (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span> || cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span> || cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;tsk_task_plan_enddate <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> DateTime) $dts_plan = date_timestamp_get(cobjectref()-&gt;tsk_task_plan_enddate); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $dts_plan = date_timestamp_get(date_create(cobjectref()-&gt;tsk_task_plan_enddate)); $dts_now = date_timestamp_get(date_create()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($dts_plan &lt; $dts_now) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($dts_plan - $dts_now &lt; <span class="hljs-number"><span class="hljs-number">3600</span></span>) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($dts_plan - $dts_now &lt; <span class="hljs-number"><span class="hljs-number">28800</span></span>) cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;state = <span class="hljs-number"><span class="hljs-number">4</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;tsk_task_author)) { $pgroup = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'group_pdg'</span></span>); $agroups = corganization()-&gt;user(cobjectref()-&gt;tsk_task_author)-&gt;groups(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($agroups <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $ag) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($ag[<span class="hljs-string"><span class="hljs-string">'code'</span></span>], $pgroup)) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;readonly = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_notice_of_execute'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_notice_of_execute'</span></span>)-&gt;value)) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_notice_of_execute'</span></span>)-&gt;value = <span class="hljs-number"><span class="hljs-number">0</span></span>; } cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_notice_of_execute'</span></span>)-&gt;readonly = $cuser_id != cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value)) { $values = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;values; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value = key($values); } $category_id = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value; $category_classificator = classificator($category_id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($category_classificator-&gt;code == <span class="hljs-string"><span class="hljs-string">'task_category_plan'</span></span>) { $ro = cuser()-&gt;id != cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;readonly = $ro; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;readonly = $ro; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;readonly = $ro; } } cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;readonly = $cuser_id != cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value;</code> </pre><br></div></div><br>  The states of the attributes <a href="https://habr.com/ru/company/easla/blog/301944/">Start date (plan)</a> and <a href="https://habr.com/ru/company/easla/blog/301944/">End date (plan)</a> are calculated based on the current time.  As soon as the date is missed, the attribute is painted in red, but before that, first in orange and yellow, in such a simple way reminding the performer of the importance of completing the task on time. <br><br>  Before saving an object, it is important to validate all entered values ‚Äã‚Äãand refuse to save it if something is wrong. <br>  In addition to identifying errors, there is a check for the existence of a similar task on three grounds: the topic, the basis for the discovery and the performer.  If exactly the same task is found, then the assignment of a new one is denied.  Very, very useful feature! <br>  In addition, as mentioned above, the task should be assigned to only one performer, and all the others in the list should receive copies of it, so the task is saved with only one performer, and the rest are stored in the object's arguments. <br>  By the way, the list of performers is analyzed for the presence of a GUI in it.  And if it is found, then the task of the GUI becomes the main one, and all the rest are created as subtasks to it.  This sorting of tasks is very convenient for the GUI. <br><div class="spoiler">  <b class="spoiler_title">Before saving the object</b> <div class="spoiler_text"><pre> <code class="php hljs">$executors = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($executors) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { $gips = corganization()-&gt;group(<span class="hljs-string"><span class="hljs-string">'group_gip_only'</span></span>)-&gt;users(); $fgip = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($gips <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $gip) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($gip[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $executors)) { $fgip = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } $hgips = corganization()-&gt;group(<span class="hljs-string"><span class="hljs-string">'group_gip_helper_only'</span></span>)-&gt;users(); $fhgip = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($hgips <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $hgip) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($hgip[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $executors)) { $fhgip = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($fgip) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value = $gip-&gt;id; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executor'</span></span>] = array_diff($executors, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($gip-&gt;id)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executorIsChild'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($fhgip) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value = $hgip-&gt;id; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executor'</span></span>] = array_diff($executors, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($hgip-&gt;id)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executorIsChild'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value = $executors[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executor'</span></span>] = array_slice($executors, <span class="hljs-number"><span class="hljs-number">1</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($executors) &amp;&amp; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;existValue != cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value) { $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;cobjectref()-&gt;tsk_task_subj, <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;cobjectref()-&gt;tsk_task_base_open, <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;$executors[<span class="hljs-number"><span class="hljs-number">0</span></span>], ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cobjectref()-&gt;isNewRecord) $conditions[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] = <span class="hljs-string"><span class="hljs-string">'&lt;&gt;'</span></span>.cobjectref()-&gt;id; $exist = selectAll(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), $conditions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($exist) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $exs_task_links = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $executor = corganization()-&gt;user($executors[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($exist <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $x) { $exs_task = select($x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]); $exs_task_links[] = $exs_task-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'  '</span></span>.$executor-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">' : '</span></span>.$exs_task-&gt;status-&gt;viewLink(); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'  , ..   :'</span></span>.implode(<span class="hljs-string"><span class="hljs-string">''</span></span>,$exs_task_links)); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>) { cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>; cobjectref()-&gt;flags = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (!cobjectref()-&gt;isNewRecord &amp;&amp; (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span> || cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>)) { $src_user_id = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;existValue; $trg_user_id = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value; $src_user_id = $src_user_id[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $trg_user_id = $trg_user_id[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($src_user_id != $trg_user_id) { $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;cobjectref()-&gt;tsk_task_subj, <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;cobjectref()-&gt;tsk_task_base_open, <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;$trg_user_id, ); $exist = selectAll(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), $conditions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($exist) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $exs_task_links = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($exist <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $x) { $exs_task = select($x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]); $exs_task_links[] = $exs_task-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'  '</span></span>.corganization()-&gt;user($trg_user_id)-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">' : '</span></span>.$exs_task-&gt;status-&gt;viewLink(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'  , ..      :'</span></span>.implode(<span class="hljs-string"><span class="hljs-string">''</span></span>,$exs_task_links); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;corganization()-&gt;user($trg_user_id), <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'    '</span></span>.corganization()-&gt;user($src_user_id)-&gt;description.<span class="hljs-string"><span class="hljs-string">'!'</span></span>, <span class="hljs-string"><span class="hljs-string">'objects'</span></span>=&gt;cobjectref(), <span class="hljs-string"><span class="hljs-string">'roles'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'tsk_executor'</span></span>, <span class="hljs-string"><span class="hljs-string">'files'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> cobjectref()-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'    '</span></span>.corganization()-&gt;user($trg_user_id)-&gt;viewLink(); } } cobjectref()-&gt;flags = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cobjectref()-&gt;flags = <span class="hljs-number"><span class="hljs-number">0</span></span>; cobjectref()-&gt;description = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value;</code> </pre><br></div></div><br>  The temporary refuge for the list of performers who will be assigned copies of the tasks is: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executor'</span></span>]</code> </pre><br>  You can create as many ‚Äúarguments‚Äù in the object.  In my case, one was enough. <br><br>  After the object is saved, clones of tasks are created, if necessary, and sending notifications. <br><div class="spoiler">  <b class="spoiler_title">After saving the object</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value)) { $base = select(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($base) &amp;&amp; ($base-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_handed'</span></span> || $base-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_created'</span></span>)) { $base-&gt;status = <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_exec'</span></span>; $base-&gt;save(); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>) &amp;&amp; (cobjectref()-&gt;flags == <span class="hljs-number"><span class="hljs-number">1</span></span>)) { $to = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value; $to = corganization()-&gt;user(is_array($to) ? $to[<span class="hljs-number"><span class="hljs-number">0</span></span>] : $to); sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;$to, <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'   !'</span></span>, <span class="hljs-string"><span class="hljs-string">'objects'</span></span>=&gt;cobjectref(), <span class="hljs-string"><span class="hljs-string">'roles'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'tsk_executor'</span></span>, <span class="hljs-string"><span class="hljs-string">'files'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> cobjectref()-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'    '</span></span>.$to-&gt;description; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value)) { $base = select(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_null($base)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'        '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($base-&gt;code == <span class="hljs-string"><span class="hljs-string">'crs_management_incoming'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($base-&gt;status-&gt;code != <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_ok'</span></span>) { $base-&gt;status = <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_ok'</span></span>; $base-&gt;save(); } } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executor'</span></span>])) { $executors = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executor'</span></span>]; $ischild = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executorIsChild'</span></span>]) ? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;arguments[<span class="hljs-string"><span class="hljs-string">'executorIsChild'</span></span>] : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($executors) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $new_task_links = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $exs_task_links = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($executors <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $e) { $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;cobjectref()-&gt;tsk_task_subj, <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;cobjectref()-&gt;tsk_task_base_open, <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;$e, ); $exist = selectAll(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), $conditions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($exist) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($exist <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $x) { $exs_task = select($x[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]); $exs_task_links[] = $exs_task-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'  '</span></span>.corganization()-&gt;user($e)-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">' : '</span></span>.$exs_task-&gt;status-&gt;viewLink(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $new_task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Objectref(); $new_task-&gt;prepare(objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>)); $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_author; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_contract; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_subj; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_description'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_description; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_category; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_importance'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_importance; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_plan_startdate; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_plan_enddate; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value = $e; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_comment'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_comment; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value = cobjectref()-&gt;tsk_task_base_open; $new_task-&gt;save(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($ischild === <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) cobjectref()-&gt;childAdd($new_task); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $parents = cobjectref()-&gt;parents(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($parents)) { $p = select($parents[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]); $p-&gt;childAdd($new_task); } } $new_task_links[] = $new_task-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'  '</span></span>.corganization()-&gt;user($e)-&gt;viewLink(); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($exs_task_links) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'.   , ..  :'</span></span>.implode(<span class="hljs-string"><span class="hljs-string">''</span></span>,$exs_task_links); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_notice_of_execute'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_notice_of_execute'</span></span>)-&gt;value == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_ok'</span></span>) sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;corganization()-&gt;user(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'   !'</span></span>, <span class="hljs-string"><span class="hljs-string">'objects'</span></span>=&gt;cobjectref(), <span class="hljs-string"><span class="hljs-string">'roles'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'tsk_executor'</span></span>, )); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'tsk_task_failed'</span></span>) sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;corganization()-&gt;user(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'   !'</span></span>, <span class="hljs-string"><span class="hljs-string">'objects'</span></span>=&gt;cobjectref(), <span class="hljs-string"><span class="hljs-string">'roles'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'tsk_executor'</span></span>, ));</code> </pre><br></div></div><br>  Ultimately, the shape of the object began to look something like this: <br><img src="https://habrastorage.org/files/708/c14/958/708c14958d294192945fff3af6db7a48.png"><br><br><h4>  Statuses </h4><br>  Wise with statuses did not: Created, Accepted, Implemented, Rejected.  Accepted is the task with which the employee has reviewed and accepted for execution.  The remaining statuses are clear from the title. <br><img src="https://habrastorage.org/files/c16/638/c84/c16638c843af49d6b3c73541c251a5d2.png"><br><br><h4>  Actions </h4><br>  A small number of statuses leads to a better understanding of the process and a decrease in the number of actions.  Action and straight turned a little. <br><br><h5>  To accept </h5><br>  The appointment, in fact, follows from the title.  Translates the task into ‚ÄúAccepted‚Äù status and sets the actual date of commencement of work <br><pre> <code class="php hljs">cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_startdate'</span></span>)-&gt;value = currentDateTime();</code> </pre><br><br><h5>  Run </h5><br>  Successfully closes the task fixing the actual end date of work on it.  Be sure to require a comment.  This was one of the requirements of the chief engineer.  On the ‚Äúfirst couple‚Äù he was very indignant when subordinates closed tasks without comment.  It was completely incomprehensible what was done and on what basis the task was closed. <br>  In addition, the action checks whether the task is nested, and if so, it checks whether all tasks adjacent to it are completed.  With a positive result, checks the status of the higher-level task and, if necessary, sends it to the contractor by mail with a notification stating that the task can certainly be closed, since  All nested tasks are completed. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_efforts'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_efforts'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">"    !"</span></span>); } $src_classificators = classificatorChilds(<span class="hljs-string"><span class="hljs-string">'task_category'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_classificators <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] == cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($c)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">"   !"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($c[<span class="hljs-string"><span class="hljs-string">'code'</span></span>] == <span class="hljs-string"><span class="hljs-string">'task_category_answer'</span></span>) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;isRequired = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_comment'</span></span>)-&gt;value) || <span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_close'</span></span>)-&gt;value)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>.$c-&gt;useLink().<span class="hljs-string"><span class="hljs-string">'       !'</span></span>; caction()-&gt;redirect = cobjectref()-&gt;updateUrl(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_comment'</span></span>)-&gt;value)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'     !'</span></span>; caction()-&gt;redirect = cobjectref()-&gt;updateUrl(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_startdate'</span></span>)-&gt;value)) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_startdate'</span></span>)-&gt;value = currentDateTime(); } cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_enddate'</span></span>)-&gt;value = currentDateTime(); cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_ok'</span></span>; $parents = cobjectref()-&gt;parents(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($parents)) { $parentId = $parents[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; $childTasks = selectAll(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(),<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'parents'</span></span>=&gt;$parentId, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>) )); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($childTasks)) { $parentTask = select($parentId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($parentTask-&gt;status-&gt;code, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>))) { sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;corganization()-&gt;user($parentTask-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>)-&gt;value[<span class="hljs-number"><span class="hljs-number">0</span></span>]), <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;$parentTask-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">'   ?'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">',  '</span></span>.$parentTask-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">'   , ..      !'</span></span>, )); } } }</code> </pre><br><br><h5>  Reject </h5><br>  It is obvious from the title that the action rejects the task.  One condition: the comment must indicate the reason for the rejection. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_comment'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'     .'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_failed'</span></span>; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_enddate'</span></span>)-&gt;value = currentDateTime(); }</code> </pre><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Return </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The action is available only to the process manager. </font><font style="vertical-align: inherit;">Allows you to return a task from the final status to the "Accepted" status. </font><font style="vertical-align: inherit;">Required if the task was closed by mistake. </font><font style="vertical-align: inherit;">Required rarely, but still needed.</font></font><br><pre> <code class="php hljs">cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_enddate'</span></span>)-&gt;value = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; &lt;h5&gt; &lt;/h5&gt;       .      . $task = cobjectref(); $new_task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Objectref(); $new_task-&gt;prepare(objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>)); $new_task-&gt;parentrefId = $task-&gt;id; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_description'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_description'</span></span>)-&gt;value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($task-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>)) $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>)-&gt;value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($task-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>)) $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>)-&gt;value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($task-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)) $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($task-&gt;hasAttributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)) $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>)-&gt;value; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;value = $task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>)-&gt;value; $new_task-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>; caction()-&gt;redirect = urlNewObjectref($new_task);</code> </pre><br><br><h4>  Teams </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first process in which it was necessary to create teams. </font><font style="vertical-align: inherit;">Commands differ from actions in that they are performed in the context of a process, not an object. </font><font style="vertical-align: inherit;">Thus, they allow processing objects ‚Äúbatch‚Äù: all at once or selected by the user.</font></font><br><br>   ,     ¬´¬ª  ¬´¬ª      ,          ,  ,               . ‚Ä¶  , ,             .   , .. ,   ,       ,   ¬´ ¬ª,   ,       . ,     ,      ,     ,    ,      . <br><br>               ,  ¬´  ¬ª ( ,           ).     ,      ¬´ ¬ª.     ¬´ ¬ª. <br><br><h5>   </h5><br>          10  .    ,    -    .  , ,      ,         . <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="php hljs">$readyTasks = selectAll( <span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,cuser()-&gt;id), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_close'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'not like'</span></span>,<span class="hljs-string"><span class="hljs-string">'is not null'</span></span>), <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'and'</span></span>,<span class="hljs-string"><span class="hljs-string">'&lt;&gt;tsk_task_ok'</span></span>,<span class="hljs-string"><span class="hljs-string">'&lt;&gt;tsk_task_failed'</span></span>) ) ); <span class="hljs-comment"><span class="hljs-comment">// debugMode(true); // debug($readyTasks); $success = array(); $failed = array(); $max = 10; $q = 1; foreach ($readyTasks as $task) { $obj = select($task['id']); progress($q/$max * 100, $task['description']); if (!empty($obj)) { $obj-&gt;attributeref('tsk_task_efforts')-&gt;value = 1; $obj-&gt;attributeref('tsk_task_enddate')-&gt;value = currentDateTime(); $obj-&gt;status = 'tsk_task_ok'; try { $obj-&gt;save(); $success[] = $obj-&gt;viewLink(); } catch (Exception $e) { $failed[] = $obj-&gt;viewLink(); } } else { $failed[] = $task['description']; } $q++; if ($q &gt; $max) break; } if (count($success) &gt; 0) { echo("   :".implode(", ",$success).": ".count($success)); } if (count($failed) &gt; 0) { warning("  :".implode(", ",$failed).": ".count($failed)); }</span></span></code> </pre><br></div></div><br>      (.  ). <br><br><h5>   </h5><br>    ,      . <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="php hljs">$objectrefIds = ccommand()-&gt;objectrefIds; $success = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $failed = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $cnt = count($objectrefIds); $q = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($cnt == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($objectrefIds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $objectrefId) { $obj = select($objectrefId); progress($q/$cnt * <span class="hljs-number"><span class="hljs-number">100</span></span>, $obj[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($obj)) { $obj-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_enddate'</span></span>)-&gt;value = currentDateTime(); $obj-&gt;status = <span class="hljs-string"><span class="hljs-string">'tsk_task_ok'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $obj-&gt;save(); $success[] = $obj-&gt;viewLink(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { $failed[] = $obj-&gt;viewLink(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $failed[] = $objectrefId; } $q++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($q &gt; $cnt) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($success) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span>(<span class="hljs-string"><span class="hljs-string">"   : "</span></span>.implode(<span class="hljs-string"><span class="hljs-string">", "</span></span>,$success).<span class="hljs-string"><span class="hljs-string">": "</span></span>.count($success)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($failed) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { warning(<span class="hljs-string"><span class="hljs-string">"  : "</span></span>.implode(<span class="hljs-string"><span class="hljs-string">", "</span></span>,$failed).<span class="hljs-string"><span class="hljs-string">": "</span></span>.count($failed)); }</code> </pre><br></div></div><br><br><h4>  Kinds </h4><br>  (),     .           . <br><br><h5>   </h5><br> ¬´¬ª , .. ,        .   ,     ,  :     .  ,        ,       . <br> ,        ,  ,  ,  ,    .        ,     . <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="php hljs">$groups = cuser()-&gt;groups(); $isgip = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $ishead = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($groups <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $group) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strncmp($group[<span class="hljs-string"><span class="hljs-string">'data_one'</span></span>],<span class="hljs-string"><span class="hljs-string">'09.'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { $isgip = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (strcmp($group[<span class="hljs-string"><span class="hljs-string">'code'</span></span>],<span class="hljs-string"><span class="hljs-string">'group_head_and_deputy'</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { $ishead = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } $attributes = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isgip) { $categories = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($group-&gt;name, cuser()-&gt;description); $us = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($group-&gt;users() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) $us[] = $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; cviewpub()-&gt;categories = $categories; cviewpub()-&gt;category = is_null(cviewpub()-&gt;category) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : cviewpub()-&gt;category; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(cviewpub()-&gt;category) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: $attributes += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'inplaceEdit'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 30%;'</span></span>))); $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;$us); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,cuser()-&gt;id)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($ishead) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($groups <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $group) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_numeric($group[<span class="hljs-string"><span class="hljs-string">'data_one'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; $us = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($group-&gt;users() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) $us[] = $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; $categories = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($group-&gt;name, cuser()-&gt;description); cviewpub()-&gt;categories = $categories; cviewpub()-&gt;category = is_null(cviewpub()-&gt;category) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : cviewpub()-&gt;category; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(cviewpub()-&gt;category) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: $attributes += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'inplaceEdit'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 30%;'</span></span>))); $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;$us); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,cuser()-&gt;id)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $categories = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(cuser()-&gt;description); $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,cuser()-&gt;id)); } $attributes += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_base_close'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_comment'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'actions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(),<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 100px;'</span></span>)) ); $conditions[<span class="hljs-string"><span class="hljs-string">'status'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>); cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;$attributes, <span class="hljs-string"><span class="hljs-string">'sort'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'asc'</span></span>, <span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ), <span class="hljs-string"><span class="hljs-string">'conditions'</span></span>=&gt;$conditions, <span class="hljs-string"><span class="hljs-string">'sorting'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'pagination'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'pagesize'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'showcreate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ));</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/2c6/460/24a/2c646024a61b4fd7a642b5f00be2a840.png"><br><br><h5>   </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is clear from the name that the view displays a list of tasks authored by an active user. </font><font style="vertical-align: inherit;">It is also "intellectual", because </font><font style="vertical-align: inherit;">analyzes the active user, and if he is a GUI, adds two categories: the GUI group and the GUI name. </font><font style="vertical-align: inherit;">Categories are needed so that the GUI can see both his personal tasks separately and the tasks assigned to his assistant. </font><font style="vertical-align: inherit;">The GUI and his assistant are working on one task pool.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appointed by me</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs">$groups = cuser()-&gt;groups(); $isgip = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($groups <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $group) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strncmp($group[<span class="hljs-string"><span class="hljs-string">'data_one'</span></span>],<span class="hljs-string"><span class="hljs-string">'09.'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { $isgip = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isgip) { $categories = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($group-&gt;name, cuser()-&gt;description); $us = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($group-&gt;users() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) $us[] = $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; cviewpub()-&gt;categories = $categories; cviewpub()-&gt;category = is_null(cviewpub()-&gt;category) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : cviewpub()-&gt;category; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(cviewpub()-&gt;category) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>=&gt;$us); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>=&gt;cuser()-&gt;id); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $categories = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(cuser()-&gt;description); $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_author'</span></span>=&gt;cuser()-&gt;id); } $conditions[<span class="hljs-string"><span class="hljs-string">'status'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>); cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>,<span class="hljs-string"><span class="hljs-string">'inplaceEdit'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-comment"><span class="hljs-comment">//'tsk_task_description'=&gt;array('limit'=&gt;160), 'tsk_task_executor'=&gt;array('link'=&gt;'value','options'=&gt;array('style'=&gt;'width: 10%;')), 'tsk_task_plan_startdate', 'tsk_task_plan_enddate', 'status'=&gt;array('link'=&gt;'value', 'actions'=&gt;array(),'options'=&gt;array('style'=&gt;'width: 100px;')) ), 'sort'=&gt;array( 'tsk_task_code'=&gt;array('enable'=&gt;true), 'tsk_task_base_open'=&gt;array('enable'=&gt;true), 'tsk_task_subj'=&gt;array('enable'=&gt;true), 'tsk_task_executor'=&gt;array('enable'=&gt;true), 'tsk_task_plan_startdate'=&gt;array('enable'=&gt;true), 'tsk_task_plan_enddate'=&gt;array('default'=&gt;'asc', 'enable'=&gt;true) ), 'conditions'=&gt;$conditions, 'sorting'=&gt;true, 'pagination'=&gt;array('pagesize'=&gt;10), 'showcreate'=&gt;true, ));</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/files/1e4/ffd/a55/1e4ffda557464692be495dcf909433b7.png"><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> My completed </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simple view. </font><font style="vertical-align: inherit;">Displays a list of completed tasks executed by an active user.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">My completed</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs">cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_enddate'</span></span> ), <span class="hljs-string"><span class="hljs-string">'sort'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'desc'</span></span>, <span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ), <span class="hljs-string"><span class="hljs-string">'conditions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;cuser()-&gt;id, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'tsk_task_ok'</span></span> ), <span class="hljs-string"><span class="hljs-string">'sorting'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'pagination'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'pagesize'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>) ));</code> </pre><br></div></div><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All tasks </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Displays a complete list of all active tasks. </font><font style="vertical-align: inherit;">It is used, as a rule, to search for other people's tasks.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All tasks</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs">cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'actions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(),<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 100px;'</span></span>)) ), <span class="hljs-string"><span class="hljs-string">'sort'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'asc'</span></span>, <span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ), <span class="hljs-string"><span class="hljs-string">'conditions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>) ), <span class="hljs-string"><span class="hljs-string">'sorting'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'pagination'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'pagesize'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'showcreate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ));</code> </pre><br></div></div><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All decisions </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A very important list of tasks, because </font><font style="vertical-align: inherit;">contains only tasks assigned by the scheduling decision and under control. </font><font style="vertical-align: inherit;">When executing the script, the view analyzes the list of all tasks, selects all executors from it, groups it into departments, and generates a list of categories of the type with the names of the departments. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, each employee, and as a rule, these are the heads and chief specialists of the departments, can easily filter only their own from the entire list of tasks assigned.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All decisions</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs">$src_executors = selectColumnAll(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'task_category_plan'</span></span>) ) ); $end_executors = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_executors <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) { $end_executors[] = $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; } $users = corganization()-&gt;users($end_executors); $departments = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($u-&gt;departments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $d) { $departments[$d[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = $d[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; } } cviewpub()-&gt;categories = $departments; cviewpub()-&gt;category = is_null(cviewpub()-&gt;category) ? <span class="hljs-number"><span class="hljs-number">0</span></span> : cviewpub()-&gt;category; $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tsk_task_initiated'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_created'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task_processed'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'task_category_plan'</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cviewpub()-&gt;category != <span class="hljs-string"><span class="hljs-string">'0'</span></span>) { $department = corganization()-&gt;department(cviewpub()-&gt;category); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($department)) { $users = $department-&gt;users(); $c = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) $c[] = $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; $conditions[<span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>] = $c; } } cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'actions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(),<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 100px;'</span></span>)) ), <span class="hljs-string"><span class="hljs-string">'sort'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'asc'</span></span>, <span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ), <span class="hljs-string"><span class="hljs-string">'conditions'</span></span>=&gt;$conditions, <span class="hljs-string"><span class="hljs-string">'sorting'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'pagination'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'pagesize'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'showcreate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ));</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/2c2/709/b0f/2c2709b0f1ab4c2e868d39eecbf2f195.png"><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Author's supervision </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A very important and challenging type, which GUIs use to prepare author's supervision estimates. </font><font style="vertical-align: inherit;">The complexity of the form lies in the fact that it actually displays information not only about the tasks, but also about their grounds for opening and closing, i.e. </font><font style="vertical-align: inherit;">about letters. </font><font style="vertical-align: inherit;">Thus, the form displays information about the three objects at once! </font><font style="vertical-align: inherit;">This possibility is provided by easla.com when using attributes of the ‚ÄúObject‚Äù type and specifying the type of attributes of nested objects through a point in the description.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Author's supervision</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs">cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract.agr_management_contract_title'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'header'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'30'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract.agr_management_contract_contragent'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'header'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_contract.agr_management_contract_project_manager'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'header'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor.email'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'export'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open.crs_management_incoming_receive_date'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'header'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'  '</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_close'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'export'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_regnum'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_close.crs_management_outgoing_sentdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_efforts'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'actions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(),<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 100px;'</span></span>)) ), <span class="hljs-string"><span class="hljs-string">'sort'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'asc'</span></span>, <span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ), <span class="hljs-string"><span class="hljs-string">'conditions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_base_close'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_content'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">684</span></span>) ), <span class="hljs-string"><span class="hljs-string">'sorting'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'pagination'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'pagesize'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-string"><span class="hljs-string">'showcreate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ));</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, I'll pay attention to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">export</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option </font><font style="vertical-align: inherit;">used in the view settings. If you adjust the view so that it displays all the required number of columns, it will be so big in width that it does not fit even on a widescreen screen. But when exporting a view to Excel, you need a lot of columns. Solved using the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">export</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> option </font><font style="vertical-align: inherit;">. It indicates which columns to export, instead of being displayed as.</font></font> Cool! <br><img src="https://habrastorage.org/files/fb4/fde/e2d/fb4fdee2d09d4c6a9d1c874e08d8d965.png"><br><br>           .   ,   easla.com ‚Äì   .                .  ,   ,       , ,           . <br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="php hljs">cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>), <span class="hljs-comment"><span class="hljs-comment">//'tsk_task_description'=&gt;array('limit'=&gt;160), 'tsk_task_executor'=&gt;array('link'=&gt;'value','options'=&gt;array('style'=&gt;'width: 10%;')), 'tsk_task_plan_startdate', 'tsk_task_plan_enddate', 'status'=&gt;array('link'=&gt;'value', 'actions'=&gt;array(),'options'=&gt;array('style'=&gt;'width: 100px;')) ), 'sort'=&gt;array( 'tsk_task_plan_enddate'=&gt;array('default'=&gt;'asc', 'enable'=&gt;true) ), 'sorting'=&gt;true, 'pagination'=&gt;array('pagesize'=&gt;10), ));</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/files/e5c/fe7/59a/e5cfe759a9874fa28f111e9360709e80.gif"><br><br>  ,     ,     -,     . <br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"><pre> <code class="php hljs">$attributes = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'object'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'limit'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">160</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_executor'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>,<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 10%;'</span></span>)), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'link'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'value'</span></span>, <span class="hljs-string"><span class="hljs-string">'actions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(),<span class="hljs-string"><span class="hljs-string">'options'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'style'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'width: 100px;'</span></span>)) ); cviewpub()-&gt;exec(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'object'</span></span>=&gt;objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>), <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>=&gt;$attributes, <span class="hljs-string"><span class="hljs-string">'sort'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'tsk_task_code'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_startdate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), <span class="hljs-string"><span class="hljs-string">'tsk_task_plan_enddate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'default'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'asc'</span></span>, <span class="hljs-string"><span class="hljs-string">'enable'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) ), <span class="hljs-string"><span class="hljs-string">'sorting'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'pagination'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'pagesize'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-string"><span class="hljs-string">'showcreate'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, ));</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/ef2/b20/47e/ef2b2047e6924482bfa0fe6a67956fe8.png"><br><br><h4>  Roles </h4><br>   : , , . , ,  .      .     . <br><img src="https://habrastorage.org/files/f3e/b5f/523/f3eb5f5230484c6fbf6a3d268ebf74b4.png"><br> ,            . ,               ,    ,               ¬´  ¬ª.       ¬´¬ª .  ,  -  -   ,     ,  ,  ,   . <br><br><h4>  Results </h4><br>                   ¬´¬ª,     . <br>     ¬´¬ª     .       ,      . ,        .   . <br>       ¬´ ¬ª,          Microsoft Excel. ,       . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, besides the ‚ÄúTask‚Äù object, the ‚ÄúAcquaintance‚Äù object was implemented within the framework of the described process, which allows sending any documents for familiarization with the execution control. </font><font style="vertical-align: inherit;">But more about that separately.</font></font></div><p>Source: <a href="https://habr.com/ru/post/301944/">https://habr.com/ru/post/301944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301930/index.html">Bidmanedzherami and killing rate - is the loss of almost half of the profits</a></li>
<li><a href="../301932/index.html">Security Week 21: rejection of passwords, life of ancient vulnerabilities, virus in network equipment</a></li>
<li><a href="../301936/index.html">Parsing resume</a></li>
<li><a href="../301940/index.html">Official Russian cryptocurrency. What kind of animal will it be?</a></li>
<li><a href="../301942/index.html">Editing of landing pages: how to write convincingly and without "water"</a></li>
<li><a href="../301946/index.html">As we went out in the TOP-3 of the Ukrainian App Store</a></li>
<li><a href="../301948/index.html">The harsh reality: As antique dealers, retirees and system administrators create trading strategies on the exchange (and what comes of it)</a></li>
<li><a href="../301950/index.html">The preliminary program of PyCon Russia is ready. Speakers from the USA, England, France, Czech Republic, Ukraine and Russia</a></li>
<li><a href="../301952/index.html">Bath, children's laptop and duck. How games are really made. Part 1. Artist</a></li>
<li><a href="../301954/index.html">10 free applications that every entrepreneur should have</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>