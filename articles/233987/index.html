<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Full cost of the loan (loan) - an example / calculation algorithm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, Federal Law No. 353 came into force, obliging financial institutions to disclose information about the so-called ‚ÄúTotal Cost of a Cre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Full cost of the loan (loan) - an example / calculation algorithm</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, Federal Law No. 353 came into force, obliging financial institutions to disclose information about the so-called ‚ÄúTotal Cost of a Credit (Loan)‚Äù (hereinafter referred to as PSC). <br>  In this article (in principle, relating only to workers in the financial sphere), I would like to give an example of the calculation of the CPM.  Perhaps someone will come in handy. <br><br>  <b>Important!</b>  Not so long ago, lawmakers make changes to the formula, which comes into force only from September 1, 2014. Everything described below is suitable only for a new formula.  The article describes only the technical implementation of the calculation of the CPM in accordance with the norms of the law. <br><a name="habracut"></a><br>  <b>More importantly!</b>  All the information below is relevant for the case when the loan is issued by ONE payment, i.e.  the borrower receives money once, and returns are made according to a predetermined payment schedule.  This option covers 99% of loans issued (credit cards are not counted). <br><br><div class="spoiler">  <b class="spoiler_title">Actually, here is the beast itself:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f40/7d5/3ac/f407d53acea74437beb69a453394698e.gif"></div></div><br><h4>  <b>We understand the meaning of terms.</b> </h4>  UCS is defined as the product of 3 quantities - i, ChBP and the number 100. Let us examine the terms and notation used: <br><ol><li><h5>  What is BP (base period) </h5>  BP under a consumer credit (loan) contract is a standard time interval that occurs with the highest frequency in the payment schedule for a consumer credit (loan) contract.  If there are no time intervals between payments of less than one year or equal to one year in the payment schedule for a consumer credit (loan) agreement, the BP is one year. <br>  In fact, BP is the most common time interval between payments.  If there are no recurring time intervals in the payment schedule and another order is not established by the Bank of Russia, the base period is a time interval that is arithmetic average for all periods, rounded to the standard time interval.  The standard time interval is day, month, year, and also a certain number of days or months, not exceeding the duration of one year.  So you can define your BP.  If monthly payments, then BP = 365/12 ~ = 30 <br></li><li><h5>  What is PSB (number of base periods in a calendar year) </h5>  The definition in the law is very vague, but as I understand it - this is the number of base periods that ‚Äúfit‚Äù in one calendar year, ie: <br><ul><li>  For a standard payment schedule with monthly payments: ChBP = 12 </li><li>  Quarterly payments: ChBP = 4 </li><li>  Payments once a year or less: BSB = 1 </li><li>  If the payment schedule is tricky: for example, there are 2 payments once a quarter, and then 6 payments once a month, then 3 payments once a day, then the base period is 1 month.  And ChBP = 12 (12 BP for a calendar year). </li></ul><br></li><li><h5>  What is i (interest rate base period, expressed in decimal form) </h5>  It is impossible to understand (at least to me).  Perhaps there is some meaning in determining the number i, but it is not intuitively possible to grasp this meaning.  How to count i - we will analyze in the next section. <br></li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>How to count i</b> </h4>  Let us leave for later attempts to understand the ‚Äúphysical‚Äù meaning of the number i, and give it the following definition: <br>  The number i is calculated by solving the following equation: <br><img src="https://habrastorage.org/files/5b9/36e/bc5/5b936ebc5b6b4c49a0d211d44096d823.jpg">  Where: <br><ul><li>  m - the number of cash flows, which is equal to the number of payments in the payment schedule plus one (another payment arises from the first payment - the issuance of the loan). </li><li>  DP <sub>to</sub> - the size of the k-th cash flow (issuance of a loan with a minus sign, returns with a plus sign). </li><li>  Q <sub></sub> - the number of full base periods from the moment of issuance of the loan to the k-th cash flow.  Q <sub>to</sub> can be calculated by the formula: <br>  <i>Q <sub>to</sub> = floor [(DP <sub>to</sub> -DF <sub>1</sub> ) / BP], where</i> <i><br></i> <ul><li>  DP <sub>to</sub> - the date of the k-th cash flow, </li><li>  DP <sub>1</sub> - the date of the first cash flow (i.e. the date of issue), </li><li>  BP - the period of the base period, </li><li>  floor [] - round down to the whole. </li></ul></li><li>  E <sub>to</sub> - here we will immediately write a formula so that your brain does not explode from the wording in the law: <br>  <i>E <sub>k</sub> = mod [(DP <sub>to</sub> -DF <sub>1</sub> ) / BP] / BP, where mod is the remainder of division</i> </li></ul><br><br><h4>  <b>PSC calculation algorithm</b> </h4>  Input: two arrays.  The key is the cash flow number, the values ‚Äã‚Äãare the payment dates and the payment amount. <br>  Outgoing data: UCS value (number). <br><h5>  Calculation procedure: </h5><ol><li>  Calculate ChBP (the number of base periods).  The number of base periods - how many such periods will fit in 365 days, i.e.  BSB = floor [365 / BP]. </li><li>  For each k-th payment, consider the DP <sub>k</sub> , Q <sub>k</sub> , E <sub>k</sub> . </li><li>  We consider i as the methods of approximate calculation up to two decimal places. </li><li>  Multiply ChBP * i * 100. </li></ol><br><h4>  <strong>Code!</strong> </h4>  There is a ready-made solution for javascript, as well as for VBA (there will even be an excel file for calculations). <br><div class="spoiler">  <b class="spoiler_title">Why VBA and Excel?</b> <div class="spoiler_text">  If suddenly you have a fire and nothing will work on September 1, 2014, then the most reasonable thing is to send out an excel-plate to the places of conclusion of contracts so that the PSC can be calculated at least that way at first. </div></div><br>  In the examples, a schedule was taken for a loan of 100,000 rubles for 3 months at a rate of 12% per annum.  Date of issue - September 1, 2014: <table><tbody><tr><td>  <b>Key</b> </td><td>  <b>Cash flow date</b> </td><td>  <b>Cash flow amount</b> </td></tr><tr><td>  0 </td><td>  09/01/2014 </td><td>  -100 000 </td></tr><tr><td>  one </td><td>  10/01/2014 </td><td>  34 002.21 </td></tr><tr><td>  2 </td><td>  11/01/2014 </td><td>  34 002.21 </td></tr><tr><td>  3 </td><td>  12/01/2014 </td><td>  34 002.21 </td></tr></tbody></table><h5>  <b>Javascript solution</b> </h5><div class="spoiler">  <b class="spoiler_title">code</b> <div class="spoiler_text"><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">psk</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  -   var dates = [ new Date(2014, 8, 01), new Date(2014, 9, 01), new Date(2014, 10, 01), new Date(2014, 11, 01)]; //  -   var sum = [-100000, 34002.21, 34002.21, 34002.21 ]; var m = dates.length; //   //   bp bp=30; //     : var cbp = Math.round(365 / bp); //          -  var days = []; for (k = 0; k &lt; m; k++) { days[k] = (dates[k] - dates[0]) / (24 * 60 * 60 * 1000); } //   Q    var e = []; var q = []; for (k = 0; k &lt; m; k++) { e[k] = (days[k] % bp) / bp; q[k] = Math.floor(days[k] / bp); } //     0  i      s var i = 0; var x = 1; var x_m = 0; var s = 0.000001; while (x &gt; 0) { x_m = x; x = 0; for (k = 0; k &lt; m; k++) { x = x + sum[k] / ((1 + e[k] * i) * Math.pow(1 + i, q[k])); } i = i + s; } if (x &gt; x_m) { i = i - s; } //  var psk = Math.floor(i * cbp * 100 * 1000) / 1000; //  alert(" = " + psk + " %"); }</span></span></code> </pre> <br></div></div>  Jsfiddle demo: <a href="http://jsfiddle.net/exmmo/m5kbb0up/7/">jsfiddle.net/exmmo/m5kbb0up/7</a> <br><br><h5>  <b>VBA + excel solution</b> </h5><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text">  In column A, starting from the 2nd row are the dates of cash flows. <br>  In column B, starting from the 2nd row are the cash flow amounts. <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> psk() <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> dates() Columns(<span class="hljs-string"><span class="hljs-string">"A:A"</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> dates() = Application.Transpose(Range(ActiveCell, Cells(Rows.count, ActiveCell.Column).<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>(xlUp))) <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> summa() Columns(<span class="hljs-string"><span class="hljs-string">"B:B"</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> summa = Application.Transpose(Range(ActiveCell, Cells(Rows.count, ActiveCell.Column).<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>(xlUp))) <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> m As Integer m = <span class="hljs-built_in"><span class="hljs-built_in">UBound</span></span>(dates) bp = <span class="hljs-number"><span class="hljs-number">30</span></span> cbp = <span class="hljs-built_in"><span class="hljs-built_in">Round</span></span>(<span class="hljs-number"><span class="hljs-number">365</span></span> / bp) <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> Days(m) <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> m Days(k) = dates(k) - dates(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> e(m) <span class="hljs-keyword"><span class="hljs-keyword">ReDim</span></span> q(m) <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> m q(k) = Days(k) \ bp e(k) = (Days(k) Mod bp) / bp <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span> x_m = <span class="hljs-number"><span class="hljs-number">0</span></span> s = <span class="hljs-number"><span class="hljs-number">0.000001</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> x_m = x x = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> k = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> m x = x + summa(k) / ((<span class="hljs-number"><span class="hljs-number">1</span></span> + e(k) * i) * ((<span class="hljs-number"><span class="hljs-number">1</span></span> + i) ^ q(k))) <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> i = i + s <span class="hljs-keyword"><span class="hljs-keyword">Loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> x &gt; x_m <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> i = i - s <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> psk = <span class="hljs-built_in"><span class="hljs-built_in">Round</span></span>(i * cbp, <span class="hljs-number"><span class="hljs-number">5</span></span>) Cells(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>).Value = psk <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span></code> </pre><br></div></div>  Excel + VBA Demo: <a href="https://yadi.sk/i/oRTa8Id-a6UfV">yadi.sk/i/oRTa8Id-a6UfV</a> <br><br><h4>  <b>Conclusion</b> </h4>  The code is far from perfect, you can even say that it is poor.  For example, an approximate calculation is performed by the most stupid way known to mankind.  Please understand and forgive, in the current situation there is definitely not enough time to write something presentable.  I'm sorry, I'll fix it. <br><br>  If you have any comments or you have found a mistake - please report, I will be grateful.  The most dangerous thing that can be - initially incorrect interpretation of the text of the law. <br><br>  <b>UPD</b> <a href="http://abutaliev.ru/psk">UCS online calculator</a> with <s>user-friendly</s> sane interface </div><p>Source: <a href="https://habr.com/ru/post/233987/">https://habr.com/ru/post/233987/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233977/index.html">On the question of the legality of parallel imports in Russia</a></li>
<li><a href="../233979/index.html">Master's degree in Norway</a></li>
<li><a href="../233981/index.html">New Cisco Security Courses</a></li>
<li><a href="../233983/index.html">Habra, karma, ad hominem, leveling and heavy legacy of developed socialism</a></li>
<li><a href="../233985/index.html">Tickle will teach children and teens to create their own games and applications for iOS</a></li>
<li><a href="../233991/index.html">Mojolicious Perl Style</a></li>
<li><a href="../233993/index.html">Career IT project manager. How to get a job in a leading technology company</a></li>
<li><a href="../233995/index.html">Steve Ballmer finally left Microsoft</a></li>
<li><a href="../233997/index.html">What to expect from the new Samsung Galaxy Note 4</a></li>
<li><a href="../233999/index.html">How we protected the administration of the Kaluga region from spam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>