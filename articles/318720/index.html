<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microservice at Golang</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Find simplicity amid the confusion; find harmony among discord; in difficulty find an opportunity ... 
 (C) Albert Einstein 

 Articles about microser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microservice at Golang</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/235/6a2/6fe/2356a26fe73b9c513e54e43e300d0be7.png" alt="image">  <i>Find simplicity amid the confusion;</i>  <i>find harmony among discord;</i>  <i>in difficulty find an opportunity ...</i> <br>  (C) Albert Einstein <br><br>  Articles about microservices, their strengths and weaknesses have been written a lot lately.  However, somehow rarely anyone writes about the implementation of microservice architecture, and above all, about microservice, as if it were a brick, from which the building of such an application is built later.  I tried to fill this gap, and share my experience in the development of http-microservice, which ultimately resulted in a small library under the name of no-doubt Microservice.  The code is written in perfect for microservices, a simple and convenient programming language Golang. <br><a name="habracut"></a><br>  Recently, I happened to work on the creation of microservices in the Golang language.  It was an interesting experience.  However, in many respects it turns out (at least for me) that every time a new microservice is created anew and from scratch.  Of course, you can use the previous developments, but in this approach there is no certain kind of consistency, and I wanted to make a tool that would streamline such work (I sincerely hope so).  No doubt, this is not the only idea in the development of microservices, but if you are interested in them, you may be interested in reading this article. <br><br>  What is microservice, I think, in order to avoid holivar, there is no need to say.  Also about the advantages and disadvantages of silent.  I will only note that they exist, and it is precisely because of the presence of these that microservice architecture is in demand. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The architecture of microservice (here and below is about http microservice) in my library includes a handler, a tuner (configurator), a demo middleware.  Everything works very simply: the application loads the configuration, taking into account the configuration file, the environment and the command line.  Under the necessary routes it is formed from <i>middleware</i> and handler handler.  Next, the server starts and, upon request, the application processes the necessary queues.  In fact, it is suitable and can be used as a prototype of a typical http application, but perhaps for such an application I would use a slightly different architecture. <br><br><h2>  Tuner </h2><br>  An important point for microservice is loading the configuration.  I tried to make this functionality as flexible as possible.  By default, the configuration is loaded from the specified file (`config.toml`).  The configuration file address can be changed from the command line, for example: <i>yourservice -confile config.toml</i> Thus, you can create several different configuration files and run microservice from one of the configurations of your choice. <br><br>  Since the configuration of microservice involves not only the file, but also environment variables and command line parameters, I will clarify the order and priority of configuration.  The lowest priority is given to the configuration from the file.  If the environment is configured in the operating system, they have a higher priority than the variables from the configuration file.  Command line parameters have the most important priority.  To change a parameter in the command line, you need to specify its name in the form of the section name and the parameter name (with a capital letter!).  Here is an example of changing the port - your <i>service</i> - <i>Main / Port 85</i> <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/5dc/753/b79/5dc753b79800f1b1df184ee5cab36b26.jpg">  A little more about configuration: in addition to the option of throwing the configuration into a pre-prepared structure, it would be quite possible to use the option of importing data into a regular <i>map</i> , and then calmly use the values ‚Äã‚Äãby key.  This method has an undoubted advantage - it is not necessary to add data to the configuration file to duplicate it in the configuration structure.  Those.  easier and faster.  The downside is that errors of incorrect key indication are transferred from the compilation stage to the execution stage, and besides, the <i>IDE will</i> no longer give us hints, which, by the way, is very good in terms of protection against typos and, as a result, errors. <br><br><h2>  Middleware </h2><br>  In order not to clutter up the handlers' space, microservice provides for the use of service functionality in the style of <i>middleware</i> (but not quite in the classic understanding of gopher middleware).  Each such service has minimum requirements: it must take as an argument a function that accepts <i>http.ResponseWriter, * http.Request</i> and return the same function.  The distribution demonstrates an example with connecting a metric to fix the request processing time ( <i>duration</i> ). <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/a63/1b4/844/a631b4844e64adcfec36adb94d4b5d5d.png">  Depending on what tasks are solved by microservice and in what environment it does, you will almost certainly need other services, such as validation.  Consider them connecting to the handler as <i>middleware</i> .  And note that the demo metric is placed in a separate subdirectory to emphasize the distance between microservice and the <i>middleware</i> used in it. <br><br><h2>  Handler </h2><br>  In the distribution kit <i>handler</i> contains very little code.  However, it is his methods that are those handlers that will process the incoming request, everything else is essentially a microservice kit.  If this is so, then why not just make a bunch of autonomous functions that the router will call?  There is a reason for this: thanks to the union through the structure, handlers can now have access (if required) to the fields of the structure (the general context of the application).  In fact, it is very convenient for each public method (read handler) to create a separate file, for example, <i>handle_hello_word.go</i> , which, incidentally, does not interfere with organizing anything in any other way. <br><br><h4>  Creating a new handler </h4><br>  To do this, you simply need to create a new public method in the <i>handler</i> , which accepts <i>http.ResponseWriter, * http.Request as input</i> .  See the <i>HelloWorld</i> method created for the demonstration. <br><br><h2>  Perfomance </h2><br><img align="left" width="180" src="https://habrastorage.org/getpro/habr/post_images/16a/312/c99/16a312c9964285aec2b465a322a428a8.png">  For the general understanding that the speed of the microservice using the proposed architecture will be quite high, I will give the benchmark results that I received on my computer: <br><br><ul><li>  BenchmarkMain-2 10,000,000 195 ns / op </li><li>  BenchmarkMainParallel-2 10000000 107 ns / op </li></ul><br><br><h2>  Dependencies </h2><br><ul><li>  Logger <a href="https://github.com/Sirupsen/logrus">github.com/Sirupsen/logrus</a> </li><li>  Router <a href="https://github.com/claygod/Bxog">github.com/claygod/Bxog</a> </li><li>  Config <a href="https://github.com/BurntSushi/toml">github.com/BurntSushi/toml</a> </li></ul><br>  Any of the listed libraries can be replaced or supplemented, in this case, they are rather intended to show in which direction to develop your microservice.  It may also be useful for you to connect the logstesh and the influx. <br><br><h2>  Conclusion </h2><br>  The <i>Microservice</i> library does not claim the laurels of the only right decision, but on occasion, I hope, it will be able to help you build the architecture of your own http-microservice, becoming the prototype of the future application. <br><br><h2>  Links </h2><br><ul><li>  Library <a href="https://github.com/claygod/microservice">github.com/claygod/microservice</a> </li><li>  Documentation <a href="https://godoc.org/github.com/claygod/temp/microservice-doc">godoc.org/github.com/claygod/temp/microservice-doc</a> </li><li>  Report <a href="https://goreportcard.com/report/github.com/claygod/microservice">goreportcard.com/report/github.com/claygod/microservice</a> </li></ul><br><br><h2>  UPD </h2><br>  Taking comments into account, I changed the library a bit, removing the repository and correcting the organization method of the middleware (without queues), which, by the way, even slightly accelerated the application in the bench. </div><p>Source: <a href="https://habr.com/ru/post/318720/">https://habr.com/ru/post/318720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318710/index.html">Virtual office for real work</a></li>
<li><a href="../318712/index.html">Gigabyte history</a></li>
<li><a href="../318714/index.html">Legal risks of investing in startups of companies in the USA and Israel</a></li>
<li><a href="../318716/index.html">Animated Lines in iOS</a></li>
<li><a href="../318718/index.html">Coordinated work of macro and micro base stations in the creation of heterogeneous networks as the key to the development of mobile broadband</a></li>
<li><a href="../318722/index.html">Routing orthogonal connections in chart editors</a></li>
<li><a href="../318724/index.html">Platform to quickly create a RESTful API</a></li>
<li><a href="../318726/index.html">FPGA Debug Board - Frankenstein. Christmas tree controller</a></li>
<li><a href="../318728/index.html">Results of the year: The great pre-New Year digest of ITMO University</a></li>
<li><a href="../318732/index.html">As we star rating crushed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>