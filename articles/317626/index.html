<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex used a neural network and learned how to predict precipitation to the nearest minute.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I would like to talk to you again about the weather. Again, because almost a year ago we were talking about it: I told about our Meteum forecast...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex used a neural network and learned how to predict precipitation to the nearest minute.</h1><div class="post__text post__text-html js-mediator-article">  Today I would like to talk to you again about the weather.  Again, because almost a year ago we were <a href="https://habrahabr.ru/company/yandex/blog/271725/">talking</a> about it: I told about our Meteum forecasting technology based on meteo-modeling and machine learning.  Now I want to talk not about the weather that will be tomorrow, next week or on New Year's Eve - but about the one that has already been established outside the window, and about the one that will come in the next few hours. <br><br><img src="https://habrastorage.org/files/191/df6/ff2/191df6ff296b4fbb94951ad4f06654f7.png"><br><br>  Under the cut, I will talk about what naukisting and how we worked on it. <br><a name="habracut"></a>  Current weather affects a huge amount of our daily decisions.  If there is heavy snow outside the window, we reflect on how we can go to work - by car or by public transport.  Looking out the window, we decide whether to take an umbrella with us and whether we need a waterproof jacket.  Even standing at the exit of the subway in the pouring rain, we wonder when it will end.  If in five minutes you can wait and come to the meeting in a dry suit, and if in half an hour you will have to get wet or be late.  For all these small but important decisions, we need the most accurate information about what the weather is now and how it will change in the near future.  You must have come across a situation when the sun is shining in one area of ‚Äã‚Äãthe city, and in the other it is pouring torrential rain with a thunderstorm. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  As it was done before </h3><br>  Since the current weather is important to our users, it is about this parameter of the service that people most often write in reviews, including negative ones.  It would seem that you just need to look out the window and show the correct weather on the service.  But to describe the situation outside the window anywhere in the country or the world is not an easy task. <br><br>  Firstly, the meteorological stations are located far from each other and measure the parameters in strictly defined periods of time.  Kazan, for example, is a huge city, and there are only two meteorological stations: in the center and at the airport.  Temperature and other indicators in these points and in neighboring areas may differ drastically. <br><br>  Secondly, due to errors in the initial conditions, forecast models also cannot serve as a reliable source of information about the actual situation on the street. <br><br><img src="https://habrastorage.org/files/7cd/287/593/7cd28759376b4f498ddeef7a759d168f.png"><br><br>  Yes, and the requirements for short-term forecast are much higher: you can always look out the door and check whether meteorologists are right. <br><br>  Let me remind you once again that Yandex.Podog uses Meteum technology based on meteorological models and machine learning.  Built on the basis of Matrixnet and trained on large data arrays, our formula optimally combines the input factors.  As a result, the forecast turns out to be much more accurate. <br><br>  And in order to show the current weather on the service, we (in addition to predictions from mathematical models) mix in the formula measurements recently obtained at the nearest weather stations.  This approach is significantly better than other solutions to the problem.  The accuracy of determining the weather in the coming hours greatly increases, and this is not surprising, since we take into account the most timely and accurate information.  Our metrics have increased significantly in comparison with our own forecasts, which were built before we started mixing up fresh data from weather stations.  In May of this year, immediately after their addition, we expanded the zone of Meteum to the whole of Russia, and in November-December - to Ukraine, Belarus and Kazakhstan. <br><br>  But even a combined approach from models and data glued together with Matrixnet does not provide the desired accuracy.  This is especially true of precipitation - one of the most important parameters for the user.  The main reason for this imperfection is lack of data.  Weather stations, as already mentioned, are located far from each other.  Using the data taken from the stations, you cannot tell the user that he should wait 10 minutes in the underpass and the torrential rain on the street will be replaced by variable cloudiness.  Where can I get more data on the state of the atmosphere? <br><br><h3>  Need more data </h3><br>  The most recent achievement of science and technology in monitoring precipitation is meteorological radar.  About once every 10 minutes, he builds a three-dimensional snapshot of the atmosphere within a radius of 200 kilometers from his location horizontally and up to 10 kilometers vertically.  According to the principle of operation, the radar is very similar to aviation radar, only in the picture are visible not airplanes, but areas of the atmosphere where there are water droplets larger than 50 micrometers.  If such drops really exist, then, most likely, precipitation falls out of the cloud in which they are located.  Here is the radar itself and the results of its work: <br><br><img src="https://habrastorage.org/files/d2a/8ea/5bd/d2a8ea5bd4ea408dbb14a3cdc704c569.png"><br><br><img src="https://habrastorage.org/files/ec4/cb4/55e/ec4cb455e5d44638a562798235385f4a.jpg"><br><br>  In Russia, there is already a network of meteorological radars of sufficiently high quality.  They are installed in the most populated and meteorologically interesting regions.  The radar coverage area is shown on the map: <br><br><img src="https://habrastorage.org/files/da7/38c/94c/da738c94ccf2419fb7342dbf58a2bb4b.png"><br><br>  By the way, more than 40 percent of the population of Russia lives in an open area.  The radar data has a spatial resolution of 2 km by 2 kilometers per pixel, which makes it possible to describe the current weather with an accuracy of a small microdistrict. <br><br>  This year, Yandex has received official access to measurements that are conducted on the Roshydromet radar network.  Since then, we have worked hard to add this data to our products. <br><br>  Today, we are ready to present the technology of naughting - a short-term hyper-local precipitation forecast.  Nauk is the word that came to us from the English language, composed of two words: now and forecasting, that is, literally "forecast for now."  But in fact, through the products of Yandex you can now find out about the distribution of precipitation in the time interval from two hours ago to two hours in advance. <br><br>  Our new product is based on convolutional neural networks.  From the point of view of mathematics, the problem is formulated as follows: it is necessary to predict future precipitation maps with a time resolution of 10 minutes, 2 hours ahead, from a sequence of radar images and relevant meteorological information. <br><br>  To solve this problem, we chose a convolution network of a certain architecture.  Each convolutional network layer is a sequential set of filters that automatically extract features from the data set supplied to the input.  The combination of such layers allows you to select a large number of signs, which can be judged on what will happen to precipitation in a selected area.  Will they begin or, on the contrary, will they end?  Or will their intensity simply increase?  All this can be determined. <br><br>  To configure the filters of the convolutional network and the weights between them, we form a training sample of a sufficiently large volume - now it consists of more than 800,000 frames from each radar that have undergone preliminary processing.  Learning neural network occurs on a cluster of GPU. <br><br>  This is what this network looks like: <br><br><img src="https://habrastorage.org/files/0f4/45c/34f/0f445c34f5e649d5a31eb1d03735031b.png"><br><br><h3>  Network architecture </h3><br>  In general, the movement of precipitation can be divided into two components: the transfer of the area with precipitation in the direction of the wind and the change in the shape of the area.  Separate branches of the neural network are responsible for each of the components, which allows flexible selection of optimization parameters. <br><br>  As for the data flow, this is how the author, <a href="https://habrahabr.ru/users/nes8bit/" class="user_link">nes8bit</a> , <a href="https://habrahabr.ru/users/nes8bit/" class="user_link">simplifies it</a> : <br><blockquote>  Radar and science data, which are transmitted to the weather backend, are first interpolated from the azimuthal projection, the center of which is the radar, to a regular latitudinal-longitude.  Then, contours are constructed on the resulting grid, which describe the areas of precipitation depending on the intensity and type.  Contours are stored as polygons in PostgreSQL.  Part of the data, for example, with a description of clouds, is stored in a raster form in the same PostgreSQL: this allows you to quickly respond to the values ‚Äã‚Äãof certain variables in a particular coordinate, while maintaining consistency with the vectorized representation in the form of polygons. </blockquote><br><h3>  Metrics </h3><br>  We estimate the accuracy of the product and configure our neural network weather forecast using several types of metrics. <br><br>  First, it is important to us how correctly we predicted each next frame of our forecast.  We use the f-score frame-by-frame metric, which can be defined as the ‚Äúcurrent picture prediction accuracy‚Äù. <br><br>  Secondly, we are interested in metrics for those points in space where in the near future there will be a change in weather conditions.  Through them, we learn the most important thing: how precisely the time of the beginning or end of the rain is determined and, accordingly, how well the scenario works, in which the user waits for the end of precipitation.  We find the necessary points and fix the correspondences and discrepancies between the forecast and the reality at each moment of time. <br><br>  Here is the f-measure for the first metric depending on the horizon: <br><br><img src="https://habrastorage.org/files/1b6/62a/5b5/1b662a5b5d70417bb97d1a740d6e7e0d.png"><br><br>  I must say that if you calculate the same strict metrics for a regular forecast of any provider, the values ‚Äã‚Äãwill be no more than 0.1, and more often they will be very close to zero.  This is due both to differences in the method of forecasting itself and to the lack of a large and important source of data. <br><br>  We chose the types of metrics, focusing on how the new data will be presented in the product.  On the main page of Yandex. Weather now there is a message about precipitation in the next two hours.  From this block you can find out that the precipitation will run out from minute to minute or will begin within half an hour.  By clicking on the message, you will see how areas with precipitation are distributed in your area.  All other areas in the radar zones are also marked on the same map. <br><br><img src="https://habrastorage.org/files/4f0/b9c/f9b/4f0b9cf9b82346c9b835140ea9dbed81.png"><br><br><h3>  Instead of an afterword </h3><br>  I will say a few words about what I said at the very beginning.  The technology that we have presented today has been designed specifically to make our users' lives a little more comfortable.  Hyper-local short-term precipitation forecast will help people make decisions based on information from a fundamentally new source - a network of meteorological radars.  Data on heavy snowfall with details to areas of your city will help to know about the amount of snow on the roads, and a warning of heavy rain will help you not catch a cold in spring. <br><br>  Now it may seem incredible, but summer will soon come and we will all ride bikes, roller skates, walk in parks, relax in nature.  And from today you can make plans for the near future, looking not at the low or high flight of the swallows, but at the <a href="https://yandex.ru/pogoda">Yandex.Pogoda</a> page and applications.  One familiar character to you all already does. <br><br><img src="https://habrastorage.org/files/e2a/57f/209/e2a57f20990e490fa29916d162625d5a.gif"></div><p>Source: <a href="https://habr.com/ru/post/317626/">https://habr.com/ru/post/317626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317612/index.html">Exporting tabular data from applications written under .NET in C #</a></li>
<li><a href="../317618/index.html">These companies are luring digital professionals from all the rest.</a></li>
<li><a href="../317620/index.html">DotNext - Moscow 2016. How it was</a></li>
<li><a href="../317622/index.html">Create your own ‚ÄúNeural Patterns‚Äù with the help of Deep Learning.</a></li>
<li><a href="../317624/index.html">OpenCV: setting a timeout to wait for a frame in the VideoCapture class</a></li>
<li><a href="../317628/index.html">Java hardcore in Novosibirsk: a review and video of the best reports JBreak 2016. And the announcement of the JBreak 2017</a></li>
<li><a href="../317630/index.html">I gave up PGP</a></li>
<li><a href="../317632/index.html">A few tips to automate data center monitoring. Part 1</a></li>
<li><a href="../317634/index.html">Current strength: how mobile communications changed our attitude to energy</a></li>
<li><a href="../317636/index.html">Docker, GitLab, free SSL certificates and other modern web development buns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>