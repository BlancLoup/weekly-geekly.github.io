<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Amazon Route 53 and the smooth running of the site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past 3 weeks, I have had several times to encounter interruptions in my hosting, since I am running a project with a lot of traffic, even a s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Amazon Route 53 and the smooth running of the site</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="http://i23.fastpic.ru/big/2011/0609/9c/106e51ff134fd41abe9200909fcc5e9c.gif" alt="Amazon"><br>  Over the past 3 weeks, I have had several times to encounter interruptions in my hosting, since I am running a project with a lot of traffic, even a short-term idle time affects the number of calls from the site. <br>  At the same time, everything could be much better, if instead of the standard ‚ÄúServer not found‚Äù page, hang up a splash screen in the style of the site with the text ‚ÄúThe site is temporarily unavailable, call or request.‚Äù <br>  It was decided to use the DNS service from Amazon to quickly change the A-record. <br><br><a name="habracut"></a><br><br><h5>  <a href="http://aws.amazon.com/route53/">Amazon Route 53</a> Description </h5><br>  This is a reliable DNS service, with a fairly convenient API for editing, adding and deleting records. <br>  The cost of the service is $ 1 per month + 0.50 $ for the first million requests and $ 0.25 for each next million requests. <br>  A serious inconvenience in some cases is the payment method - you can pay for the service only by a plastic card, but there is a way out, for example, you can use the virtual Visa card from <a href="http://qiwi.ru/about/what/visa/">qiwi</a> . <br>  After registering and paying for the service, we get a pair of IDs and a key, which are subsequently used for authorization in the API. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  We are preparing a domain </h5><br>  To connect the domain and configure all the necessary records to use the API is not very convenient. <br>  I suggest using the service <a href="https://www.interstate53.com/">Interstate53</a> . <br>  The service is an interface for managing an account on Route 53 and provides a full range of its functions. <br><img src="http://i23.fastpic.ru/big/2011/0609/1f/6f185e0aa2d87c1b6aba305f4395b61f.png" alt="Interstate53"><br>  We fill all records as before - A-records go to the IP address of the main hosting. <br><br><h5>  Choosing a hosting </h5><br>  In my case, the backup server should be as cheap as possible and have the following set of functions: <br><ul><li>  PHP - to work with the Route 53 API </li><li>  cron - to periodically check the main hosting for availability </li><li>  static html for screen saver </li></ul><br>  The choice fell on <a href="http://jino.ru/">Gino</a> , this is the only hosting that I found, where you can refuse to support databases without giving up PHP.  The price is 75 rubles per month. <br>  The main hosting is <a href="http://www.clodo.ru/">clodo</a> , although it does not matter. <br><br><h5>  We configure the main hosting </h5><br>  We are interested in the performance of the site in any conditions, which means that if the base hangs or apache, you must also change the A-record.  For testing, we will create a small PHP script available at the server‚Äôs IP address. <br><blockquote><ol><li></li><li> <code><font color="black"><font color="#000088">$link</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#0000ff">'localhost'</font> <font color="#339933">,</font> <font color="#0000ff">'root'</font> <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#009900">)</font> or <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#0000ff">'SELECT VERSION();'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$result</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">mysql_close</font> <font color="#009900">(</font> <font color="#000088">$link</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">'OK!'</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><font color="#000088">$link</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#0000ff">'localhost'</font> <font color="#339933">,</font> <font color="#0000ff">'root'</font> <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#009900">)</font> or <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#0000ff">'SELECT VERSION();'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$result</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">mysql_close</font> <font color="#009900">(</font> <font color="#000088">$link</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">'OK!'</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><font color="#000088">$link</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#0000ff">'localhost'</font> <font color="#339933">,</font> <font color="#0000ff">'root'</font> <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#009900">)</font> or <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#0000ff">'SELECT VERSION();'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$result</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">mysql_close</font> <font color="#009900">(</font> <font color="#000088">$link</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">'OK!'</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><font color="#000088">$link</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#0000ff">'localhost'</font> <font color="#339933">,</font> <font color="#0000ff">'root'</font> <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#009900">)</font> or <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#0000ff">'SELECT VERSION();'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$result</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">mysql_close</font> <font color="#009900">(</font> <font color="#000088">$link</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">'OK!'</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><font color="#000088">$link</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#0000ff">'localhost'</font> <font color="#339933">,</font> <font color="#0000ff">'root'</font> <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#009900">)</font> or <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#0000ff">'SELECT VERSION();'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$result</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">mysql_close</font> <font color="#009900">(</font> <font color="#000088">$link</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">'OK!'</font> <font color="#339933">;</font></font></code> </li> <li> <code><font color="black"><font color="#000088">$link</font> <font color="#339933">=</font> <font color="#990000">mysql_connect</font> <font color="#009900">(</font> <font color="#0000ff">'localhost'</font> <font color="#339933">,</font> <font color="#0000ff">'root'</font> <font color="#339933">,</font> <font color="#0000ff">'password'</font> <font color="#009900">)</font> or <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$result</font> <font color="#339933">=</font> <font color="#990000">mysql_query</font> <font color="#009900">(</font> <font color="#0000ff">'SELECT VERSION();'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#000088">$result</font> <font color="#009900">)</font> <font color="#990000">die</font> <font color="#009900">(</font> <font color="#0000ff">'0'</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">mysql_close</font> <font color="#009900">(</font> <font color="#000088">$link</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#990000">echo</font> <font color="#0000ff">'OK!'</font> <font color="#339933">;</font></font></code> </li> <li></li></ol></blockquote><br>  In case of problems with the database, the script will issue 0, if the server is not working or apache freezes, the script will not issue anything, if successful, the ‚ÄúOK!‚Äù Message will be transmitted. <br>  This completes the configuration of the main server. <br><br><h5>  Configuring backup hosting </h5><br>  To work with the Route 53 API, I used the ready-made PHP class <a href="http://sourceforge.net/projects/php-r53/">Route53</a> . <br><blockquote><ol><li></li><li>  <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'MASTER_HOST'</font> <font color="#339933">,</font> <font color="#0000ff">'xxx.xxx.xxx.xxx'</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// IP address of the main server</i></font> </li><li>  <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'SLAVE_HOST'</font> <font color="#339933">,</font> <font color="#0000ff">'xxx.xxx.xxx.xxx'</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// IP address of the secondary server</i></font> </li><li>  <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'ACCESS_KEY'</font> <font color="#339933">,</font> <font color="#0000ff">'my_key'</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// API Access Key</i></font> </li><li>  <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'SECRET_KEY'</font> <font color="#339933">,</font> <font color="#0000ff">'my_pass'</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// Password for access to API</i></font> </li><li>  <font color="#990000">define</font> <font color="#009900">(</font> <font color="#0000ff">'ZONE_ID'</font> <font color="#339933">,</font> <font color="#0000ff">'/ hostedzone / my_zone_id'</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// ID of the zone (can be seen after adding the domain to interstate53.com)</i></font> </li><li></li><li>  <font color="#b1b100">include</font> <font color="#0000ff">'r53.php'</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ route</font> <font color="#339933">=</font> <font color="#3A00FF"><b>new</b></font> Route53 <font color="#009900">(</font> ACCESS_KEY <font color="#339933">,</font> SECRET_KEY <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ ns</font> <font color="#339933">=</font> <font color="#000088">$ route</font> <font color="#339933">-&gt;</font> <font color="#004000">listResourceRecordSets</font> <font color="#009900">(</font> ZONE_ID <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// Immediately get the values ‚Äã‚Äãof ns records for the domain</i></font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> test <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  try <font color="#009900">{</font> </li><li>  <font color="#000088">$ answer</font> <font color="#339933">=</font> <font color="#990000">file_get_contents</font> <font color="#009900">(</font> <font color="#0000ff">'http: //'</font> <font color="#339933">.</font> MASTER_HOST <font color="#339933">.</font> <font color="#0000ff">'/'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ answer</font> <font color="#339933">==</font> <font color="#0000ff">'OK!'</font> <font color="#009900">)</font> <font color="#666666"><i>// Check the response from the main server</i></font> </li><li>  <font color="#b1b100">return</font> <font color="#3A00FF"><b>true</b></font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">else</font> </li><li>  <font color="#b1b100">return</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> catch <font color="#009900">(</font> Exception <font color="#000088">$ e</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">return</font> <font color="#3A00FF"><b>false</b></font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> update <font color="#009900">(</font> <font color="#000088">$ arr</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#990000">GLOBAL</font> <font color="#000088">$ route</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">count</font> <font color="#009900">(</font> <font color="#000088">$ arr</font> <font color="#009900">)</font> <font color="#339933">&gt;</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#000088">$ route</font> <font color="#339933">-&gt;</font> <font color="#004000">changeResourceRecordSets</font> <font color="#009900">(</font> ZONE_ID <font color="#339933">,</font> <font color="#000088">$ arr</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#666666"><i>// Update ns records</i></font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#3A00FF"><b>function</b></font> changeIP <font color="#009900">(</font> <font color="#000088">$ name</font> <font color="#339933">,</font> <font color="#000088">$ ttl</font> <font color="#339933">,</font> <font color="#000088">$ from_ip</font> <font color="#339933">,</font> <font color="#000088">$ to_ip</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#666666"><i>// The function generates an array in which one record deletes the old one, and the second adds a new one</i></font> </li><li>  <font color="#b1b100">return</font> <font color="#990000">array</font> <font color="#009900">(</font> </li><li>  <font color="#0000ff">"</font> </li><li>  <font color="#0000ff">&lt;Change&gt;</font> </li><li>  <font color="#0000ff">&lt;Action&gt; DELETE &lt;/ Action&gt;</font> </li><li>  <font color="#0000ff">&lt;ResourceRecordSet&gt;</font> </li><li>  <font color="#0000ff">&lt;Name&gt; <font color="#006699"><b>$ name</b></font> &lt;/ name&gt;</font> </li><li>  <font color="#0000ff">&lt;Type&gt; A &lt;/ Type&gt;</font> </li><li>  <font color="#0000ff">&lt;TTL&gt; <font color="#006699"><b>$ ttl</b></font> &lt;/ TTL&gt;</font> </li><li>  <font color="#0000ff">&lt;ResourceRecords&gt;</font> </li><li>  <font color="#0000ff">&lt;ResourceRecord&gt;</font> </li><li>  <font color="#0000ff">&lt;Value&gt; <font color="#006699"><b>$ from_ip</b></font> &lt;/ Value&gt;</font> </li><li>  <font color="#0000ff">&lt;/ ResourceRecord&gt;</font> </li><li>  <font color="#0000ff">&lt;/ ResourceRecords&gt;</font> </li><li>  <font color="#0000ff">&lt;/ ResourceRecordSet&gt;</font> </li><li>  <font color="#0000ff">&lt;/ Change&gt;</font> </li><li>  <font color="#0000ff">"</font> <font color="#339933">,</font> </li><li>  <font color="#0000ff">"</font> </li><li>  <font color="#0000ff">&lt;Change&gt;</font> </li><li>  <font color="#0000ff">&lt;Action&gt; CREATE &lt;/ Action&gt;</font> </li><li>  <font color="#0000ff">&lt;ResourceRecordSet&gt;</font> </li><li>  <font color="#0000ff">&lt;Name&gt; <font color="#006699"><b>$ name</b></font> &lt;/ name&gt;</font> </li><li>  <font color="#0000ff">&lt;Type&gt; A &lt;/ Type&gt;</font> </li><li>  <font color="#0000ff">&lt;TTL&gt; <font color="#006699"><b>$ ttl</b></font> &lt;/ TTL&gt;</font> </li><li>  <font color="#0000ff">&lt;ResourceRecords&gt;</font> </li><li>  <font color="#0000ff">&lt;ResourceRecord&gt;</font> </li><li>  <font color="#0000ff">&lt;Value&gt; <font color="#006699"><b>$ to_ip</b></font> &lt;/ Value&gt;</font> </li><li>  <font color="#0000ff">&lt;/ ResourceRecord&gt;</font> </li><li>  <font color="#0000ff">&lt;/ ResourceRecords&gt;</font> </li><li>  <font color="#0000ff">&lt;/ ResourceRecordSet&gt;</font> </li><li>  <font color="#0000ff">&lt;/ Change&gt;</font> </li><li>  <font color="#0000ff">"</font> </li><li>  <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#000088">$ changes</font> <font color="#339933">=</font> <font color="#990000">Array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> test <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> test <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#666666"><i>// do a test 2 times for reliability</i></font> </li><li>  <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$ ns</font> <font color="#009900">[</font> <font color="#0000ff">'ResourceRecordSets'</font> <font color="#009900">]</font> <font color="#b1b100">as</font> <font color="#000088">$ record</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'Type'</font> <font color="#009900">]</font> <font color="#339933">==</font> <font color="#0000ff">'A'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'ResourceRecords'</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#0000ff">'0'</font> <font color="#009900">]</font> <font color="#339933">==</font> MASTER_HOST <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ changes</font> <font color="#339933">=</font> <font color="#990000">array_merge</font> <font color="#009900">(</font> <font color="#000088">$ changes</font> <font color="#339933">,</font> changeIP <font color="#009900">(</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'Name'</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'TTL'</font> <font color="#009900">]</font> <font color="#339933">,</font> MASTER_HOST <font color="#339933">,</font> SLAVE_HOST <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  update <font color="#009900">(</font> <font color="#000088">$ changes</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#990000">exit</font> <font color="#009900">(</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$ ns</font> <font color="#009900">[</font> <font color="#0000ff">'ResourceRecordSets'</font> <font color="#009900">]</font> <font color="#b1b100">as</font> <font color="#000088">$ record</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'Type'</font> <font color="#009900">]</font> <font color="#339933">==</font> <font color="#0000ff">'A'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'ResourceRecords'</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#0000ff">'0'</font> <font color="#009900">]</font> <font color="#339933">==</font> SLAVE_HOST <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ changes</font> <font color="#339933">=</font> <font color="#990000">array_merge</font> <font color="#009900">(</font> <font color="#000088">$ changes</font> <font color="#339933">,</font> changeIP <font color="#009900">(</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'Name'</font> <font color="#009900">]</font> <font color="#339933">,</font> <font color="#000088">$ record</font> <font color="#009900">[</font> <font color="#0000ff">'TTL'</font> <font color="#009900">]</font> <font color="#339933">,</font> SLAVE_HOST <font color="#339933">,</font> MASTER_HOST <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  update <font color="#009900">(</font> <font color="#000088">$ changes</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#990000">exit</font> <font color="#009900">(</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li></ol></blockquote><br><br>  I briefly summarize the code in order: we check the server for the answer ‚ÄúOK!‚Äù 2 times for reliability, if the answer is not correct, change the records, if the answer is correct, return the records to the place. <br><br><h5>  It remains to configure cron </h5><br>  In Gino, this is done quite simply, we throw the resulting script into the mydomain.jino.ru test domain folder, in the ‚ÄúScheduled Tasks‚Äù click ‚ÄúNew Task‚Äù, then fill in the fields: <br>  Task: curl -s <a href="http://mydomain.jino.ru/route53/core.php">mydomain.jino.ru/route53/core.php</a> &gt; / dev / null <br>  Comment: <br>  Minutes, Hours, Days, Months, Days of the Week: * <br>  Our script will be executed every minute.  This means that the maximum site downtime will be 2 minutes 29 seconds in the worst scenario and 30 seconds (depending on the TTL of the A record) at the best. <br><br><h5>  Total </h5><br>  Ideally, of course, you should keep a copy of the site on additional hosting - a screensaver with contacts and the words ‚Äúserver does not work‚Äù may scare away some people.  But this method also has the right to exist. </div><p>Source: <a href="https://habr.com/ru/post/122238/">https://habr.com/ru/post/122238/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122229/index.html">Join the broadcast Sharepoint Conference 2011 Russia</a></li>
<li><a href="../122234/index.html">VMWare Virtualization Platform Monitoring</a></li>
<li><a href="../122235/index.html">Console network services: a historical overview</a></li>
<li><a href="../122236/index.html">From 2012 it will be possible to create domain names</a></li>
<li><a href="../122237/index.html">Corporate trolling - 3, or delivery of work without unnecessary worries</a></li>
<li><a href="../122240/index.html">The list of new gTLDs was ready even before approval of the registration rules.</a></li>
<li><a href="../122241/index.html">Not only ICQ in ICQ clients</a></li>
<li><a href="../122242/index.html">Napartner.ru: the first $ 600,000 for startups</a></li>
<li><a href="../122243/index.html">Competition for programmers ‚Ññ4</a></li>
<li><a href="../122245/index.html">Water droplet grid</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>