<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to use the GamePad in the browser and in Windows applications on HTML and JavaScript?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are developing HTML and JavaScript games, then this article is for you. We have already written a lot about the fact that under Windows 8.x you...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to use the GamePad in the browser and in Windows applications on HTML and JavaScript?</h1><div class="post__text post__text-html js-mediator-article">  If you are developing HTML and JavaScript games, then this article is for you.  We have already written a lot about the fact that under Windows 8.x you can develop applications on HTML / JS, and, as a rule, you can easily just take and use your current engine that works in modern browsers. <br><br><img src="https://habrastorage.org/files/f1f/295/5c4/f1f2955c40d145babc2198e225a75ef6.jpg" width="500"><br><br><blockquote>  Just as an example: if you make a platformer, then you can use such an engine as <a href="http://phaser.io/">Phaser</a> (by the way, it supports TypeScript development!), Or our <a href="http://platformstarterkit.azurewebsites.net/">Platformer Game StarterKit for Windows 8</a> .  By the way, if you want to make a toy in the genre of Tower Defense, then we have <a href="http://towergamekit.azurewebsites.net/">another Starter Kit</a> .  And if you want to create something three-dimensional <a href="http://habrahabr.ru/company/microsoft/blog/203550/">using WebGL</a> , then our all for you is <a href="http://www.babylonjs.com/">Babylon.js</a> . </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Gamepad </h4><br>  But in this article I will not tell you how to create the game itself.  We will ask another question: how to connect to the game for Windows 8.x or in the browser gamepad?  For example, a game controller from Xbox 360 or Xbox One: <br><br><img src="https://habrastorage.org/files/fea/635/716/fea6357166624a29a31972f2adc442b3.jpg" width="300"><br><br>  We assume that you have already connected the gamepad itself to your PC ( <a href="http://support.xbox.com/ru-RU/xbox-on-other-devices/windows/xbox-controller-for-windows-setup">instructions for Xbox 360</a> , <a href="http://support.xbox.com/ru-RU/xbox-one/accessories/controller-pc-compatibility">instructions for Xbox One</a> ).  Now let's see what you need to do to add his support in your game. <br><br>  As an example, I will use <a href="http://platformstarterkit.azurewebsites.net/">the RubbaRabbit platformer</a> from the above start-whale.  We will consider two options: a game for Windows 8.x and a game in the browser. <br><a name="habracut"></a><br><br><h2>  Game for Windows 8.x on HTML and JavaScript </h2><br>  To add gamepad support to the JavaScript game under Windows 8.x, you will need to learn how to work with <a href="http://msdn.microsoft.com/library/windows/apps/ee417001">XInput</a> interfaces.  This may sound scary, because for this you need to dive into C ++ code, but we have already done almost everything that you need in order not to intersect with them directly. <br><br>  To work, you need to download the sample <a href="https://code.msdn.microsoft.com/windowsapps/XInput-and-JavaScript-c72fe535">XInput and JavaScript controller sketch</a> .  Inside it, you can easily find a daddy with C ++ code in which there is a binding library project on XInput, with which you, in turn, can work in your game on JavaScript. <br><br><img src="https://habrastorage.org/files/53e/845/25a/53e84525aed74e7aa5b2c6948a99457f.png" width="500"><br><br>  This project you need to add to your solution with the game and add a link to it inside the project for Windows 8.x: <br><br><img src="https://habrastorage.org/files/ee6/5b0/4e5/ee65b04e50634c56b19d81d50b865690.png" width="500"><br><br>  If you wish, you can get inside the files in C ++ and find out that they actually put out a very simple interface for accessing the controller: the designer to get the link to the gamepad and the <b>getState</b> function to get its current state with the projection on the Xbox gamepad buttons. <br><br>  Now you need to add support for the gamepad in the game itself.  For this, usually, you need to make quite small changes in the processing of input by the player. <br><br><h4>  Game cycle </h4><br>  As a rule, inside the game code you have a regular cycle, within which each next frame of the game is formed.  In order to understand how the game situation has changed, you in particular check whether the user has pressed certain buttons. <br><br>  In my case, the game loop is set inside the <b>update</b> function: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * game simulation loop step - called every frame during play */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... }</code> </pre> <br><br>  Somewhere inside this function, there is a button click processing that looks something like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (touchleft || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"left"</span></span>) || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)) { player.vx = -move_speed; player.flipped = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (touchright || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"right"</span></span>) || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"d"</span></span>)) { player.vx = +move_speed; player.flipped = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!player.attacking &amp;&amp; (touchjump || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"up"</span></span>) || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"w"</span></span>) || jaws.pressed(<span class="hljs-string"><span class="hljs-string">"space"</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!player.jumping &amp;&amp; player.can_jump) { sfxjump(); player.vy = jump_strength; player.jumping = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; player.can_jump = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { player.can_jump = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><br>  As you can see, the developers of the engine have already taken care of that the user can transmit commands not only from different buttons from the keyboard, but also, for example, from virtual buttons on a touch device ( <b>touchleft</b> , <b>touchright</b> , etc.). <br><br>  In general, most likely, in your code there should be some variables that correspond to different ‚Äúgame actions‚Äù and accumulate various input methods for their activation.  It is to work with such variables that the addition of support for the gamepad will be tied. <br><br><h4>  Gamepad support </h4><br>  To add support for the gamepad, there are quite a few left: you need to initialize the work with the controller when the toy starts and then regularly receive its status. <br><br>  To initialize the controller, we create the <b>Controller</b> object through the constructor, accessible to us from the previously connected C ++ library: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//Add Xbox Contoller support function initXboxpad() { var controller = new GameController.Controller(0); if (controller != null) { updateState(); } ... }</span></span></code> </pre> <br><br>  Next, we need to update the state of the controller with a certain periodicity. To do this, we will describe the <b>updateState</b> function, which will request to call itself for each animation frame: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//Add Xbox Contoller support function initXboxpad() { var controller = new GameController.Controller(0); // render loop if (controller != null) { updateState(); } function updateState() { var state = controller.getState(); if (state.connected) { var x = state.leftThumbX / 32767; touchleft = (x &lt; -0.9); touchright = (x &gt; 0.9); touchjump = state.a; touchattack = state.x; touchpause = state.start; } window.requestAnimationFrame(updateState); } }</span></span></code> </pre> <br><br>  This is all (!) Code that you need to add to the toy so that it learns how to interact with the Xbox 360 gamepad. Do not forget to call the <b>initXboxpad</b> function itself at the start. <br><br><img src="https://habrastorage.org/files/77b/56a/8c9/77b56a8c9daf4e958fd549df0468758a.jpg" width="500"><br><br>  Please note that in this case we ‚Äúexploit‚Äù the existing variables, accumulating commands from a possible touch interface, and update them depending on the current state of the controls on the gamepad.  For example, if a player has pressed the ‚ÄúA‚Äù button, then the corresponding <b>state is.</b>  a will be <b>true</b> and we project it on the ‚Äújump‚Äù in the game. <br><br>  By the way, through the gamepad's <b>setState</b> function, you can make it vibrate. <br><br><h2>  Browser game </h2><br>  Now let's see what we can do in the browser.  For browsers, the W3C develops a special standard <a href="http://www.w3.org/TR/gamepad/">Gamepad API</a> that will allow you to work consistently with different types of gamepads. <br><br>  The standard assumes that there is some ‚Äúcommon model‚Äù to which various game controllers can be reduced: <br><img src="https://habrastorage.org/files/671/b6d/ed0/671b6ded08a3401bab835402d9508031.png"><br><br>  If you want to bind the notation to a specific type of device (for example, an Xbox gamepad), you will need to do it yourself by writing the appropriate mapping in your code. <br><br>  I will not dive into the standard itself in this article, since there are already a sufficient number of review articles on the Internet.  For example, here is the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/Gamepad">documentation from Mozilla</a> .  The only thing I want to mention here is that it is outdated regarding the assumption that the Gamepad API does not support Internet Explorer.  <a href="https://status.modern.ie/gamepadapi">In fact</a> , in the <a href="http://habrahabr.ru/company/microsoft/blog/243215/">fresh builds of</a> Internet Explorer 11, the <a href="http://msdn.microsoft.com/en-us/library/ie/dn743630(v%3Dvs.85).aspx">Gamepad API is</a> already <a href="http://internetexplorer.github.io/Gamepad-Sample/">supported</a> . <br><br>  In the context of this article about the standard, you need to know only one thing: it provides access to raw data, broken down along axes and numbered buttons.  To understand the real match, you will need to do certain mental operations in your code. <br><br><h4>  Game cycle and game code </h4><br><img src="https://habrastorage.org/files/aaa/d81/097/aaad810970ef4f358018f714136051f8.jpg" width="500"><br><br>  For the demonstration, I continue to use the same example from the starter whale, only this time I create an empty web project and copy the original source files into it.  Since they do not really have any strings on the Windows platform, the game simply works in the browser: <br><br><img src="https://habrastorage.org/files/d2e/e12/a3c/d2ee12a3cd7f405098134f60fde1ae80.png" width="300"><br><br>  Everything else remains unchanged, and the same assumptions about the game cycle that we made for the project under Windows 8 are true. <br><br><h4>  Gamepad support </h4><br>  To simplify my work with the gamepad, I will use the ready-made code from the Babylon.js library - <a href="">babylon.gamepads.ts</a> (GitHub).  You can simply copy the library yourself or fork it. <br><br>  The library does several important things: <br><ul><li>  is able to simulate an event model over the Gamepad API (if you suddenly need it); </li><li>  simplifies access to individual elements of the controller (for example, it combines the axes of the joystick into one object); </li><li>  distinguishes between the Xbox controller, making it necessary for me to display generalized buttons on specific ones. </li></ul><br>  Please note that the library is written in TypeScript.  Nearby you can also find a compiled version for javascript.  In my case, I just add the library inside the project, Visual Studio includes TypeScript support and automatically generates js-files when saving. <br><br>  Do not forget to connect the library to the page with the game: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/babylon.gamepads.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Further, the connection scheme of the gamepad is very similar to what we did in the case of Windows 8.x: <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//Add Xbox Contoller support function initGamePad() { var xboxpad; function updateState() { if (xboxpad != null &amp;&amp; xboxpad.browserGamepad.connected) { xboxpad.update(); touchleft = (xboxpad.leftStick.x &lt; -0.9); touchright = (xboxpad.leftStick.x &gt; 0.9); touchjump = (xboxpad.buttonA == 1); touchattack = (xboxpad.buttonX == 1); touchpause = (xboxpad.buttonStart == 1); } window.requestAnimationFrame(updateState); } var gamepadConnected = function (gamepad) { if (gamepad instanceof BABYLON.Xbox360Pad) { xboxpad = gamepad; updateState(); } }; var gamepads = new BABYLON.Gamepads(gamepadConnected); }</span></span></code> </pre> <br><br>  Inside the BABYLON.Gamepads function, an event handler for connecting a gamepad to the computer is passed.  As you can see, adding a gamepad support to the project is about 20 lines of code! <br><br>  Option code with event model: <br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//Add Xbox Contoller support function initGamePad() { var xboxpad; var gamepadConnected = function (gamepad) { if (gamepad instanceof BABYLON.Xbox360Pad) { xboxpad = gamepad; xboxpad.onleftstickchanged(function (values) { var x = values.x; touchleft = (x &lt; -0.9); touchright = (x &gt; 0.9); }); xboxpad.onbuttondown(function (button) { switch (button) { case BABYLON.Xbox360Button.A: touchjump = true; break; case BABYLON.Xbox360Button.X: touchattack = true; break; case BABYLON.Xbox360Button.Start: touchpause = true; break; } }); xboxpad.onbuttonup(function (button) { switch (button) { case BABYLON.Xbox360Button.A: touchjump = false; break; case BABYLON.Xbox360Button.X: touchattack = false; break; case BABYLON.Xbox360Button.Start: touchpause = false; break; } }); } }; var gamepads = new BABYLON.Gamepads(gamepadConnected); }</span></span></code> </pre> <br><br>  As a result, we can easily control the actions of the hero in the game directly from the connected gamepad: <br><img src="https://habrastorage.org/files/9b8/355/be9/9b8355be94cf495795d89bd859b401a3.jpg" width="500"><br><br><h4>  useful links </h4><br><ul><li>  JS Starter <a href="http://platformstarterkit.azurewebsites.net/">Kits</a> for Windows 8: <a href="http://platformstarterkit.azurewebsites.net/">Platfromer</a> , <a href="http://towergamekit.azurewebsites.net/">Tower Defense</a> </li><li>  <a href="https://code.msdn.microsoft.com/windowsapps/XInput-and-JavaScript-c72fe535">XInput + JavaScript</a> - example for Windows 8 </li><li>  <a href="http://www.w3.org/TR/gamepad/">W3C GamePad API</a> - draft standard for browsers </li><li>  <a href="">babylon.gamepads.ts</a> - wrapper over GamePad API </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/developing-universal-windows-apps-with-html-and-javascript-jump-start">Course on the development of universal applications for HTML / JS (En)</a> </li><li>  <a href="http://l.techdays.ru/go/getvs">Download</a> free or trial Visual Studio </li><li>  <a href="http://l.techdays.ru/go/winstart">Become a</a> universal Windows application <a href="http://l.techdays.ru/go/winstart">developer</a> </li><li>  <a href="https://insider.windows.com/">Windows Insider program</a> - access to Windows 10 preview </li></ul></div><p>Source: <a href="https://habr.com/ru/post/245405/">https://habr.com/ru/post/245405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245391/index.html">Gaming Industry News Digest: November</a></li>
<li><a href="../245393/index.html">Yandex opens a new direction of its activity - Yandex Data Factory</a></li>
<li><a href="../245397/index.html">Bank statements and PHP is just</a></li>
<li><a href="../245401/index.html">How we tried to implement Yandex.Kassa</a></li>
<li><a href="../245403/index.html">Hacker's guide to neural networks. Schemes of real values. Schemes with several logical elements</a></li>
<li><a href="../245407/index.html">HackDay for Superheroes, tha last call</a></li>
<li><a href="../245411/index.html">How to make online logging from scratch</a></li>
<li><a href="../245415/index.html">6 ways: how to add security for Rest service in Java</a></li>
<li><a href="../245419/index.html">From the experience of translating style guides</a></li>
<li><a href="../245421/index.html">Experience creating a home Wi-Fi router. general review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>