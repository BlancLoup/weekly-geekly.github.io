<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lightning bolts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You fly your ship through a cave, dodging enemy fire. However, pretty soon you realize that there are too many enemies and it looks like this is the e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lightning bolts</h1><div class="post__text post__text-html js-mediator-article"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/5UMOXGPdWe4%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhh--ab5KHW2L1quZSNd8v_CShV0lw" frameborder="0" allowfullscreen=""></iframe><br><br>  You fly your ship through a cave, dodging enemy fire.  However, pretty soon you realize that there are too many enemies and it looks like this is the end.  In a desperate attempt to survive, you press the button.  Yes, that button.  On the one that you have prepared for a special occasion.  Your ship is charging and releases deadly lightning at enemies, one after another, destroying the entire enemy fleet. <br><br>  At least that is the plan. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But how exactly do you, as a game developer, <b>render</b> this effect? <br><a name="habracut"></a><br><h4>  We generate lightning </h4><br>  As it turned out, generating lightning between two points can be a surprisingly simple task.  It can be generated as an <a href="http://habrahabr.ru/post/69989/">L-System</a> (with a small random number during generation).  Below is an example of a simple pseudo-code (this code, like everything else in this article, refers to 2d lightning. This is usually all you need. In 3d, just generate a lightning so that its displacements relate to the camera plane. Or you can generate a complete lightning in all three dimensions - the choice is yours) <br><br><pre><code class="hljs pgsql">segmentList.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Segment(startPoint, endPoint)); offsetAmount = maximumOffset; //     <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> iteration // (  ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> segment <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> segmentList //    ,       segmentList.Remove(segment); //      midPoint = Average(startpoint, endPoint); //  midPoint       midPoint += Perpendicular(Normalize(endPoint-startPoint))*RandomFloat(-offsetAmount,offsetAmount); //    ,      //    ()  segmentList.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Segment(startPoint, midPoint)); segmentList.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Segment(midPoint, endPoint)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> offsetAmount /= <span class="hljs-number"><span class="hljs-number">2</span></span>; //               <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span></code> </pre> <br><br>  In fact, each iteration of each segment is divided in half, with a slight shift of the center point.  Each iteration of this shift is halved.  So, for five iterations the following will turn out: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/87f/46f/524/87f46f5242010b669ac726e6874eb59c.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/265/25c/865/26525c8651c47e02a9833f3ae912635c.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/b43/dc3/aa2/b43dc3aa25c16b96c28565296e20de73.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/1b6/fd5/9e7/1b6fd59e739379399450605c3b2f9a59.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/96b/914/dff/96b914dff16b7fb11589dabdf5cfce1a.png" alt="image"><br><br>  Not bad.  Already looks at least like a zipper.  However, lightning often has branches running in different directions. <br><br>  To create them, sometimes when you divide a lightning segment, instead of adding two segments, you need to add three.  The third segment is just a continuation of the lightning in the direction of the first (with a small random deviation). <br><br><pre> <code class="hljs pgsql">direction = midPoint - startPoint; splitEnd = Rotate(direction, randomSmallAngle)*lengthScale + midPoint; // lengthScale   &lt; <span class="hljs-number"><span class="hljs-number">1.</span></span>  <span class="hljs-number"><span class="hljs-number">0.7</span></span>  . segmentList.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Segment(midPoint, splitEnd));</code> </pre><br><br>  Then, at the following iterations, these segments are also divided.  It would also be nice to reduce the brightness of the branch.  Only the main lightning should have full brightness, since only it is connected to the target. <br><br>  Now it looks like this: <br><br><img src="http://pastexen.com/i/MmkVXgI15e.png" alt="image"><br><img src="http://pastexen.com/i/Rco1N5i4pG.png" alt="image"><br><img src="http://pastexen.com/i/2OFppAu7gz.png" alt="image"><br><br>  Now it looks more like a zipper!  Well ... at least the form.  But what about the rest? <br><br><h4>  Add light </h4><br>  Originally, the system developed for the game used rounded rays.  Each lightning segment was rendered using three quadrilaterals, for each of which a light texture was used (to make it look like a rounded line).  The rounded edges intersect, forming joints.  It looked pretty good: <br><br><img src="http://drilian.com/wp-content/uploads/2009/02/lightningtest-463x270.jpg" alt="image"><br><br>  ... but, as you can see, it turned out pretty bright.  And, as the lightning decreases, the brightness only increased (as the intersections became closer).  When trying to reduce brightness, another problem arose - the transitions became <b>very</b> noticeable, like small dots throughout the lightning. <br>  If you have the ability to render a lightning bolt on the voice-over buffer, you can render it by applying the maximum mix (D3DBLENDOP_MAX) to the voice-over buffer, and then simply add the result to the main screen.  This will avoid the problem described above.  If you do not have such an opportunity, you can create a vertex cut from a lightning by creating two vertices for each point of the lightning and moving each of them in the direction of the 2D normal (normal is perpendicular to the middle direction between two segments going to this vertex). <br><br>  You should get something like this: <br><br><img src="http://pastexen.com/i/8FhI1bsFTH.png" alt="image"><br><br><h4>  Animating </h4><br>  And this is the most interesting.  How do we animate this thing? <br><br>  Having a little experimenting, I found the following useful: <br><br>  Each zipper is actually <b>two</b> zippers at a time.  In this case, every 1/3 of a second, one of the lightning ends, and the cycle of each lightning is 1/6 of a second.  With 60 FPS it will turn out like this: <br><ul><li>  Frame 0: Lightning1 generated with full brightness </li><li>  Frame 10: Lightning1 is generated with partial brightness, lightning2 is generated with full brightness </li><li>  Frame 20: New lightning1 is generated with full brightness, lightning2 is generated with partial brightness </li><li>  Frame 30: New lightning2 is generated with full brightness, lightning1 is generated with partial brightness </li><li>  Frame 40: New lightning1 is generated with full brightness, lightning2 is generated with partial brightness </li><li>  Etc. </li></ul><br><br>  That is, they alternate.  Of course, a simple static attenuation does not look very good, so each frame makes sense to shift a little each point (it looks especially cool to move end points more strongly - this makes it all the more dynamic).  The result is: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/NE8Zq4whs_A%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhimOPyKFnfeieTo1DZlYGjsHkEdQg" frameborder="0" allowfullscreen=""></iframe><br><br>  And, of course, you can move the end points ... say, if you are aiming at moving targets: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/5UMOXGPdWe4%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhh--ab5KHW2L1quZSNd8v_CShV0lw" frameborder="0" allowfullscreen=""></iframe><br><br>  And it's all!  As you can see, making a cool-looking zipper is not that difficult. </div><p>Source: <a href="https://habr.com/ru/post/230483/">https://habr.com/ru/post/230483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230471/index.html">IPTV from MGTS: channel search</a></li>
<li><a href="../230473/index.html">Marlight: lamps for programmers</a></li>
<li><a href="../230477/index.html">WebCamp 2014 Live Webcast</a></li>
<li><a href="../230479/index.html">3 worst things you can do with Linq to Database</a></li>
<li><a href="../230481/index.html">The digest of interesting news and materials from the world of PHP No. 44 (July 1 - 20, 2014)</a></li>
<li><a href="../230487/index.html">Macros in Vim are just</a></li>
<li><a href="../230489/index.html">Some methods for finding fuzzy duplicate video</a></li>
<li><a href="../230491/index.html">Rosetta - the nucleus of the comet is close</a></li>
<li><a href="../230493/index.html">Python-digest # 33. News, interesting projects, articles and interviews [July 13, 2014 - July 20, 2014]</a></li>
<li><a href="../230495/index.html">How to discuss money at the interview, if you hire someone and a little about working with people</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>