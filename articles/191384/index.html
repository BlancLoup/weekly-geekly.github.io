<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Find and neutralize. How to reveal the location of a mobile subscriber</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In mobile networks it is possible to implement quite specific attacks. One of them - the disclosure of the location of the subscriber in real time up ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Find and neutralize. How to reveal the location of a mobile subscriber</h1><div class="post__text post__text-html js-mediator-article">  In mobile networks it is possible to implement quite specific attacks.  One of them - the disclosure of the location of the subscriber in real time up to the definition of the cell - will be discussed in this article.  I do not indicate accuracy in more familiar units, since the size of a cell is not a constant value.  In dense urban buildings, a cell can provide coverage of the order of hundreds of meters, and in the conditions of <s>forests, fields and rivers of an</s> intercity route - several kilometers. <a name="habracut"></a><br><br><h4>  System elements </h4><br><br> <a href=""><img src="https://habrastorage.org/storage2/02f/3dd/a63/02f3dda637e204dd5794a2868aeaaa6e.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Figure 1 (click to open in full size) <br><br>  To begin with, I will conduct a small introduction to the structure of the cellular network using the example of the GSM standard.  A simplified scheme of the standard is shown in Figure 1. <br><br>  Coverage is provided by base stations (Base Station, BS), each of which, as a rule, has several antennas directed in different directions.  The antenna provides cell radio coverage, each cell has its own identifier (Cell Identity, CI).  Base stations are grouped into geographic areas (Location Area, LA).  Grouping occurs most often on a territorial basis.  The ID of such a group is called LAC (Location Area Code).  In Figure 1, each base station provides coverage for three sectors. <br><br>  Base stations are connected to a base station controller (Base Station Controller, BSC).  In its simplest form, one LAC corresponds to one BSC.  This is precisely the purpose of the LAC shown in the example (Figure 1).  For clarity, LAC highlighted in different colors. <br><br>  The territory covered by one LAC depends on the population density.  In Moscow, within the Moscow Ring Road, there may be several dozens of LACs, and in a small region of central Russia, the division into LACs may be as follows: one LAC covers the regional center, the second LAC covers the rest of the territory of the region. <br><br>  All BSC controllers are connected to the switch (Mobile Switching Center, MSC).  In essence, the MSC is a conventional voice telephone call switch with a hardware and software extension to provide subscriber mobility features.  In the era of widespread IP, it should be recalled that MSC operates with circuit switching (Circuit Switched) according to the static routing tables established in it based on the usual telephone numbering. <br><br>  The Visitor Location Register (VLR) is a functionally considered a separate network element, but in fact is always integrated with the MSC.  The VLR database contains information about subscribers who are currently within range of their MSC.  And since the topic of the subscriber's location is the topic, it is worth mentioning that for each subscriber the VLR database stores information about the current LAC identifier and the identifier of the cell (CI) that was the last radio contact of the mobile phone with the network.  That is, if a subscriber moves within the coverage area of ‚Äã‚Äãone LAC without making or receiving calls, its location information in the VLR database does not change.  In general, there may be several MSC / VLR nodes on a network.  The example in Figure 1 shows two such nodes. <br><br>  Two more functional nodes, the Home Location Register (HLR) and the Authentication Center (AuC), are located physically in a single module.  HLR / AuC stores subscriber profiles of its network.  The profile contains the following information: subscriber phone number, unique identifier of the SIM card (International Mobile Subscriber Identity, IMSI), keys for security, subscriber category (prepaid settlement system / postpaid settlement system), list of allowed and prohibited services, billing address center (for prepaid subscribers), the address of the MSC / VLR in which the subscriber is currently located.  The same profile with some changes is copied to the VLR when the subscriber is registered in its area of ‚Äã‚Äãoperation. <br><br>  Gateway switch (Gateway MSC, GMSC) is the receiving point for incoming calls.  Based on information received from the HLR, it routes the call to the switch that the called subscriber is in range of. <br><br>  In the process of establishing a call, sending SMS and other transactions, communication centers exchange signal messages with each other.  The stack of protocols, a set of messages and their parameters in telephone networks (not only mobile) communication is called the Signaling System No. 7 (Signaling System 7, SS7).  All SS7 protocols are open and available for review and study on the websites of international organizations such as ITU-T, 3GPP, GSMA.  The attack described below relies on SS7 messages. <br><br><h4>  Attack </h4><br>  Of course, this attack will not be able to make any person from the street.  To attack, stars must be placed in the correct order in the sky.  Namely: <br><br><ul><li>  Must have access to SS7 signaling network. </li><li>  It is possible to generate any SS7 signaling messages (the attack will require the MAP protocol). </li><li>  There are no means of filtering incorrect or suspicious SS7 messages on the victim's network (about 90% of operators around the world do not think about such filtering). </li></ul><br>  In order that the description of the attack is not bogged down under the boring definitions and terms, we will adhere to the following legend.  A couple of our employees went on a business trip to Kiev: there they are scheduled to negotiate with potential customers.  Judging by the time, the colleagues should already return with the result, but they report that there are difficulties in the negotiation process and they will have to stay.  Now we will be looking for one of our colleagues and suggest that you track the entire process using the arrows in Figure 2. <br><br> <a href=""><img src="https://habrastorage.org/storage2/522/8c7/bed/5228c7bed8b389e4fece4658c1488506.png"></a> <br><br>  Figure 2 (click to open in full size) <br><br>  1. A mobile phone is registered in the network of one of the Ukrainian mobile operators.  At some point, the subscriber enters the LAC 41800 coverage area from the side of the CI 22C0 sector and continues to move up to the CI 22CF sector.  What happens at this time in the network operator?  When the phone is in the coverage area of ‚Äã‚Äãthe LAC 41800, the Location Update procedure is initiated, updating the LAC and CI values ‚Äã‚Äãin the VLR database.  As our colleague moves to the CI 22CF sector, no more changes occur in the VLR database. <br><br>  2. We want to find out if our employees are really having difficult negotiations.  And at some point we form an SMS with the Type-0 attribute and send it to the number of one of our colleagues.  I remind you that according to legend, he is at this time in the sector CI 22CF. <br><br>  3. SMS Type-0 has another name - SMS-ping.  This message is not displayed on the mobile phone screen and is not saved in the list of received SMS.  In addition, it performs actions that the subscriber did not plan, namely, updates location attributes in the VLR database.  The current value of the sector in which the subscriber arrives, that is, the CI 22CF, is now stored in the VLR. <br><br>  4. We have already begun our activity, but have not yet received a single byte of the result.  Information about the location of the subscriber, though updated, but it is in the depths of the operator‚Äôs equipment, and in order to extract the data, we continue our research.  In the next step, we form the sendRoutingInfoForSM signaling message, where our employee‚Äôs mobile number is specified as a parameter, and send this message to the operator's HLR. <br><br>  5. In the world of telecoms, it is customary to trust each other, especially requests that come through SS7 networks, and the operator's HLR is not an exception to this rule.  Figure 3 shows an excerpt from tracing.  HLR finds in its databases the subscriber IMSI identifier (1) and the address of the MSC / VLR (2), in the area where the subscriber with the specified number is located, and without suspecting a trick, informs his ‚Äúinterlocutor‚Äù this data.  Here you can pay attention to the values ‚Äã‚Äãof some numbers.  The first three digits of the IMSI identifier indicate the country code of the subscriber (Mobile Country Code, MCC).  Code 250 is assigned to Russia (1).  The switch address is provided in the more usual telephone numbering, where 380 is the international dialing code of Ukraine (2). <br><br><img src="https://habrastorage.org/storage2/fef/793/634/fef793634b5bec6ca5d8a40872e78227.png"><br><br>  Figure 3 <br><br>  At this step, you can make a short pause.  The fact is that there are services in the network that stop there and provide their users with information about the location of any mobile subscriber with the accuracy of a mobile switch. <br><br><img src="https://habrastorage.org/storage2/143/d1b/99a/143d1b99a19894b293dea89e7ea06813.png"><br><br>  Figure 4 <br><br>  Figure 4 shows a snippet of a screenshot of the search results from the same person.  Here we see the number of the subscriber (1).  In addition, the service discloses the IMSI identifier (2), which is generally confidential information and must be kept by the operator with seven seals.  Next we are shown the number of the service center where the subscriber is located (3).  In fact, this is a shortened address of the mobile switch.  In Russia, by the number of the service center, you can determine the region where the subscriber is located, since the addressing of the switches coincides with the regional telephone numbering.  Unfortunately, for the Ukrainian mobile operators I could not find such a match. <br><br>  6. Our search continues.  Now we form the message provideSubscriberInfo, where as a parameter we set the identifier IMSI, and send this message to the address of the mobile switch.  We obtained all the necessary parameters (IMSI and MSC / VLR address) in the previous step. <br><br>  7. And again we will play on the general trust.  The switch perceives the message as completely legal and gladly responds with the MCC / MNC network identifiers, the LAC value and the recently updated CI sector value. <br><br>  Now look at the trace (figure 5).  All values ‚Äã‚Äãwe need for direction finding are obtained: <br><br><ul><li>  MCC - country code; </li><li>  MNC (Mobile Network Code) - mobile operator code; </li><li>  LAC (for further use you need to bring this value in hexadecimal form: 41800 = A348h); </li><li>  CGI (Cell Global Identity) - cell code, the value is immediately shown in hexadecimal. </li></ul><br><img src="https://habrastorage.org/storage2/0a6/713/1b7/0a67131b76586da65c249f93df16a969.png"><br><br>  Figure 5 <br><br>  So far this is only a set of numbers from which we can find out the country by the MCC - code 255 is assigned to Ukraine.  As long as everything converges.  For the final shot, we open the service to determine the coordinates of the base station, of which a lot can be found in the network (Figure 6).  And what do we see?  This is not Kiev, but Feodosia, and the sector serves not the city limits, but the seashore with beaches!  Now it‚Äôs clear what our colleagues have been on a business trip for so long :) <br><br><img src="https://habrastorage.org/storage2/e0c/a5f/8d2/e0ca5f8d22291299e8f33801c00c529b.png"><br><br>  Figure 6 <br><br><h4>  Conclusion </h4><br>  As users of the ‚Äúservice‚Äù described in the article, one can imagine criminal elements, industrial spies, private detectives ... But the question remains: who and how can realize such an attack? <br><br>  First of all, this is a possibility for technical specialists of telecom operators, and the operator himself may be located in any country of the world. <br><br>  Secondly, for the implementation of the service, a company can be specially created to obtain the necessary licenses, purchase equipment and connect to SS7 with the ability to operate the MAP protocol.  Cash costs for the implementation of this option in Russia will be calculated in round sums and are unlikely to be able to pay off. <br><br>  The third option is hacking the operator‚Äôs control network and introducing the bug into its existing infrastructure. <br><br>  And law enforcement agencies have their own means of operational search activities (SORM), including the location search function. <br><br>  <b>Author</b> : Sergey Puzankov, Research Center Positive Research. <br><br>  PS I want to express my gratitude to the department for analyzing the security of the network devices of Positive Technologies and Vera Kraskova, who rested in the Crimea during our research and acted as the subscriber being referred to :) </div><p>Source: <a href="https://habr.com/ru/post/191384/">https://habr.com/ru/post/191384/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191364/index.html">Tenders from the customer - part two, positive</a></li>
<li><a href="../191366/index.html">New IP-DECT handset from Yealink W52P</a></li>
<li><a href="../191372/index.html">Surfingbird for iOS 2.0 beta</a></li>
<li><a href="../191374/index.html">Linux Kernel is 22 years old</a></li>
<li><a href="../191378/index.html">Load testing in Skyforge, or Bots - server orderlies. Part 1</a></li>
<li><a href="../191386/index.html">Tor offer to embed Firefox into browser as standard</a></li>
<li><a href="../191392/index.html">Mail.ru launched its cloud, the first users - up to 100 GB for free</a></li>
<li><a href="../191398/index.html">One day left for the special offer to register in the Windows Phone Store</a></li>
<li><a href="../191404/index.html">EU Framework Program "Horizon 2020"</a></li>
<li><a href="../191406/index.html">Developers in the struggle for the effectiveness of the programmer, team, teams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>