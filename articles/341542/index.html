<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends with UIKit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! My name is Bogdan, in Badoo I work in a mobile team of an iOS developer. We rarely say anything about our mobile development, although artic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends with UIKit</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/xx/uw/uc/xxuwuclrzgkk7mvepoanyyou13w.jpeg"></p><br><p>  Hi, Habr!  My name is Bogdan, in Badoo I work in a mobile team of an iOS developer.  We rarely say anything about our mobile development, although articles are one of the best ways to document good practices.  This article will tell you about several useful approaches that we use in our work. </p><br><p>  For several years now, the iOS community has been fighting UIKit.  Someone comes up with complex ways of ‚Äúburying‚Äù the insides of UIKit under layers of abstractions in their fictional architectures, other teams rewrite it, amusing their ego, but leaving behind a wild amount of code that needs to be maintained. </p><a name="habracut"></a><br><h3 id="zastavte-uikit-rabotat-na-sebya">  Make UIKit work for you </h3><br><p>  I'm lazy, so I try to write only the code that is needed.  I want to write code that meets the requirements of the product and the quality standards adopted by the team, but I minimize the amount of code to support the infrastructure and standard pieces of architectural patterns.  Therefore, I believe that instead of fighting UIKit, we should take it and use it as widely as possible. </p><br><h3 id="vybor-arhitektury-podhodyaschey-dlya-uikit">  Choosing an architecture suitable for UIKit </h3><br><p>  Any problem can be solved by adding another level of abstraction.  Therefore, many people choose VIPER - there are many levels / entities in it that can be used in work.  Writing an application in VIPER is not difficult - it is much more difficult to write an MVC application with the same advantages with the support of a smaller amount of generic code. </p><br><p>  If you start a project from scratch, you can choose an architectural template and do everything ‚Äúright‚Äù from the very beginning.  But in most cases, this luxury is not available to us - we have to work with the existing code base. </p><br><p>  Let's conduct a mental experiment. </p><br><p>  You are joining a team that has developed a large code base.  What approach do you hope to see in it?  Pure MVC?  Any MVVM / MVP with flow controllers?  Maybe a VIPER approach or a Redux-based approach in some FRP framework?  Personally, I expect to see the simplest and working approach.  Moreover, I want to leave behind such a code that anyone can read and correct. </p><br><p>  In short, let's see how you can do something on the basis of view controllers, rather than trying to replace or hide them. </p><br><p>  Suppose you have a set of screens, each of which is represented by one controller.  These view controllers extract some data from the Internet and display it on the screen.  From the point of view of the product, everything works perfectly, but you have no idea how to test the code for the controllers, and attempts to reuse end with copy-and-paste, which is why the view controllers increase in size. </p><br><p><img src="https://habrastorage.org/webt/3v/hb/b4/3vhbb4curui6wnoulp3ch3n12_y.png"></p><br><p>  Obviously, you need to start sharing code.  But how to do it without unnecessary trouble?  If you pull the code that retrieves the data into a separate object, the controller will only display information on the screen.  So do: </p><br><p><img src="https://habrastorage.org/webt/ot/pd/7v/otpd7vqme4x6sa_ykdi2yq5hfg0.png"></p><br><p>  Now everything looks very similar to MVVM, so we will use its terminology.  So, we have a view and a view model.  We can easily test this model.  Let's move the repetitive tasks to the services like working with the network and storing data. </p><br><p><img src="https://habrastorage.org/webt/_v/l_/ci/_vl_ci4nibkv1-o_oi3s-qijtny.png"></p><br><p>  As a result: </p><br><ol><li>  You can reuse your code. </li><li>  Get the source of truth, not tied to the level of the user interface. </li></ol><br><p>  What does all this have to do with UIKit?  Let me explain. </p><br><p>  The view model is stored by the view controller, and is not at all interested in whether the controller exists.  So if we remove the controller from the memory, then the corresponding model will also be deleted. </p><br><p> On the other hand, if the controller is stored by another object (for example, a presenter) in the MVP, then if for some reason the controller is unloaded, the connection between it and the presenter is broken.  And if you think that it is difficult to accidentally unload the wrong controller, then carefully read the description of <code>UIViewController.dismiss(animated:completion:)</code> . </p><br><p><img src="https://habrastorage.org/webt/mp/it/ra/mpitrav2dfzaa-4vxyv0gijtbas.png"></p><br><p>  So I think that the safest thing would be to recognize the view controller as the king, and, therefore, non-UI objects are divided into two categories: </p><br><ol><li>  Objects with a life cycle equal to the cycle of UI elements (for example, the view model). </li><li>  Objects with a life cycle equal to the application cycle (for example, a service). </li></ol><br><h3 id="ispolzovanie-zhiznennogo-cikla-kontrollera-predstavleniya">  Using the view controller life cycle </h3><br><p>  Why is it so tempting to shove all the code into the view controller?  Yes, because in the controller we have access to all the data and the current state of the view.  If you need to have access to the presentation life cycle in a model or presenter, you will have to pass it manually, and this is normal, but you will have to write more code. </p><br><p>  But there is another solution.  Since view controllers are capable of working with each other, Sorush Hanlow suggested using this to <a href="http://khanlou.com/2016/02/many-controllers/">distribute work among small view controllers</a> . </p><br><p>  You can go even further and apply a universal way of connecting to the lifecycle of the view controller - <code>ViewControllerLifecycleBehaviour</code> . </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewControllerLifecycleBehaviour</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeAppearing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterAppearing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeDisappearing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterDisappearing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeLayingOutSubviews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterLayingOutSubviews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> }</code> </pre> <br><p>  I will explain with an example.  Suppose we need to define screenshots in the chat view controller, but only when it is displayed on the screen.  If to carry out this task in VCLBehaviour, then everything becomes simpler simple: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> screenshotDetector = <span class="hljs-type"><span class="hljs-type">ScreenshotDetector</span></span>(notificationCenter: <span class="hljs-type"><span class="hljs-type">NotificationCenter</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Screenshot was detected } self.add(behaviours: [screenshotDetector])}</span></span></code> </pre> <br><p>  In the implementation of the behavior is also nothing complicated: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScreenshotDetector</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewControllerLifecycleBehaviour</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(notificationCenter: <span class="hljs-type"><span class="hljs-type">NotificationCenter</span></span>, didDetectScreenshot: @escaping () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.didDetectScreenshot = didDetectScreenshot <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.notificationCenter = notificationCenter } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.notificationCenter.removeObserver(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterAppearing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.notificationCenter.addObserver(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, selector: #selector(userDidTakeScreenshot), name: .<span class="hljs-type"><span class="hljs-type">UIApplicationUserDidTakeScreenshot</span></span>, object: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterDisappearing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewController: UIViewController)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.notificationCenter.removeObserver(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } <span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userDidTakeScreenshot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.didDetectScreenshot() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> didDetectScreenshot: () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> notificationCenter: <span class="hljs-type"><span class="hljs-type">NotificationCenter</span></span> }</code> </pre> <br><p>  Behavior can also be tested in isolation, since it is closed by our <code>ViewControllerLifecycleBehaviour</code> protocol. </p><br><p>  Implementation details: <a href="https://gist.github.com/BohdanOrlov/e4be8299454469b201d10b0594f03964">here</a> . </p><br><p>  Behavior can be used in tasks that depend on the VCL, for example, in analytics. </p><br><h3 id="ispolzovanie-cepochki-otvetchikov">  Using Responder Chains </h3><br><p>  Suppose you have a button deep in the hierarchy of views, and you only need to make a presentation of the new controller.  Usually, the view controller from which the presentation is made is implemented for this.  This is the right approach.  But sometimes because of this, there is a transitional relationship used by those who are not in the middle, but in the depths of the hierarchy. </p><br><p><img src="https://habrastorage.org/webt/gg/yf/ke/ggyfkejbehb7rtxk3bulljrqk9y.png"></p><br><p>  As you have probably guessed, there is another solution.  You can use a chain of responders to find a controller capable of presenting another view controller. </p><br><p>  For example: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewControllerForPresentation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIViewController?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.next <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nextResponder = next { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewController = next <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>, viewController.presentedViewController == <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, !viewController.isDetached { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> viewController } next = nextResponder.next } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isDetached: <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewIfLoaded?.window?.rootViewController == <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.parent == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.presentingViewController == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre> <br><h3 id="ispolzovanie-ierarhii-predstavleniy">  Using the view hierarchy </h3><br><p>  The <a href="https://en.wikipedia.org/wiki/Entity%25E2%2580%2593component%25E2%2580%2593system">Entity ‚Äì component ‚Äì ‚Äã‚Äãsystem</a> template (entity ‚Äì component ‚Äì ‚Äã‚Äãsystem) is a great way to integrate analytics into an application.  My colleague implemented such a system and it turned out to be very convenient. </p><br><p>  Here, the ‚Äúentity‚Äù is UIView, the ‚Äúcomponent‚Äù is part of the tracking data, the ‚Äúsystem‚Äù is the analytics tracking service. </p><br><p>  The idea is to supplement UI views with appropriate tracking data.  The analytics tracking service then scans the visible portion of the view hierarchy N times / seconds and records the tracking data that has not yet been recorded. </p><br><p><img src="https://habrastorage.org/webt/ku/nt/0l/kunt0lyl7ew4c9y7a_aoeaownjm.png"></p><br><p>  When using such a system, the developer only needs to add tracking data like screen names and elements: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EditProfileViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.trackingScreen = <span class="hljs-type"><span class="hljs-type">TrackingScreen</span></span>(screenName:.screenNameMyProfile) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SparkUIButton</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIButton</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awakeFromNib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.trackingElement = <span class="hljs-type"><span class="hljs-type">TrackingElement</span></span>(elementType: .elementSparkButton) } }</code> </pre> <br><p>  View hierarchy traversal is BFS, which ignores views that are not visible: </p><br><pre> <code class="hljs pgsql">let visibleElements = <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>.visibleElements(inView: <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> visibleElements { guard let trackingElement = <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.trackingElement <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } self.trackViewElement(<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>) }</code> </pre> <br><p>  Obviously, this system has performance limitations that cannot be ignored.  There are several ways to avoid overloading the main execution thread: </p><br><ol><li>  Not too often to scan the hierarchy of views. </li><li>  Do not scan the view hierarchy while scrolling (use a more suitable run loop mode). </li><li>  Scan the hierarchy only when a notification is published to <code>NSNotificationQueue</code> using <code>NSPostWhenIdle</code> . </li></ol><br><h3 id="p-s">  PS </h3><br><p>  I hope I managed to show how you can get along with UIKit, and you have found something useful for your daily work.  Or at least got food for thought. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/341542/">https://habr.com/ru/post/341542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341530/index.html">SOC for beginners. SOC tasks: security control</a></li>
<li><a href="../341532/index.html">uSpeech - the story of a startup</a></li>
<li><a href="../341536/index.html">ITMO University Digest: our developments in 2017. Part 2</a></li>
<li><a href="../341538/index.html">Crossbrowser layout</a></li>
<li><a href="../341540/index.html">Create your own physical 2D engine: parts 2-4</a></li>
<li><a href="../341544/index.html">Fiztekh launches online courses in higher mathematics to prepare for admission to the magistracy</a></li>
<li><a href="../341546/index.html">How to start young mobile game developers from Russia [Part 4]</a></li>
<li><a href="../341548/index.html">Google MAPs API in android or how to work with maps faster</a></li>
<li><a href="../341550/index.html">Autumn Postgres at Raiffeisenbank</a></li>
<li><a href="../341552/index.html">Problems and risks of cryptocurrency</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>