<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL Language Tutorial (DDL, DML) on the example of MS SQL Server dialect. Part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is this tutorial about? 
 This textbook is something like ‚Äúmy memory stamp‚Äù in the SQL language (DDL, DML), i.e. This is information that has acc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL Language Tutorial (DDL, DML) on the example of MS SQL Server dialect. Part one</h1><div class="post__text post__text-html js-mediator-article"><h2>  What is this tutorial about? </h2><br>  This textbook is something like ‚Äúmy memory stamp‚Äù in the SQL language (DDL, DML), i.e.  This is information that has accumulated in the course of professional activities and is constantly stored in my head.  This is for me a sufficient minimum, which is used when working with databases most often.  If there is a need to use more complete SQL constructs, then I usually ask for help in the MSDN library located on the Internet.  In my opinion, to keep everything in my head is very difficult, and there is no special need for this.  But knowing the basic design is very useful, because  they are applicable in almost the same form in many relational databases, such as Oracle, MySQL, Firebird.  The differences are mainly in data types, which may differ in details.  There are not so many basic constructs of the SQL language, and with constant practice they are quickly remembered.  For example, to create objects (tables, constraints, indexes, etc.), it is enough to have an IDE text editor at hand to work with the database, and there is no need to study the visual tools sharpened to work with a specific type of database (MS SQL , Oracle, MySQL, Firebird, ...).  This is convenient because all the text is in front of your eyes, and you don‚Äôt need to run through numerous tabs in order to create, for example, an index or a constraint.  With constant work with the database, to create, modify, and especially recreate the object using scripts is obtained several times faster than if it is done in visual mode.  Also in the script mode (respectively, with due care), it is easier to set and control the rules for naming objects (my subjective opinion).  In addition, it is convenient to use scripts in the case when changes made in one database (for example, test ones) need to be transferred in the same form to another database (productive). <br><a name="habracut"></a><br>  The SQL language is divided into several parts, here I will consider the two most important parts of it: <br><ul><li>  DDL - Data Definition Language </li><li>  DML is a Data Manipulation Language, which contains the following constructs: <br><ul><li>  SELECT - data selection </li><li>  INSERT - insert new data </li><li>  UPDATE - update data </li><li>  DELETE - delete data </li><li>  MERGE - data fusion </li></ul><br></li></ul><br>  Since  I am a practitioner, as such theory in this textbook will be small, and all constructions will be explained with practical examples.  In addition, I believe that a programming language, and especially SQL, can be mastered only in practice, by feeling it yourself and understanding what happens when you execute a particular construction. <br><br>  This textbook is created on the principle of Step by Step, i.e.  it is necessary to read it consistently and preferably immediately following the examples.  But if you have the need to find out about a team in more detail, use a specific Internet search, for example, in the MSDN library. <br><br>  When writing this tutorial, the database used was MS SQL Server version 2014, and I used MS SQL Server Management Studio (SSMS) to execute scripts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Briefly about MS SQL Server Management Studio (SSMS) </h2><br><blockquote>  SQL Server Management Studio (SSMS) is a utility for Microsoft SQL Server for configuring, managing, and administering database components.  This utility contains a script editor (which we will mainly use) and a graphical program that works with server objects and settings.  The main tool in SQL Server Management Studio is Object Explorer, which allows the user to view, retrieve and manage server objects.  <b>This text is partially borrowed from Wikipedia.</b> </blockquote><br><br>  To create a new script editor, use the ‚ÄúNew Query / New Query‚Äù button: <br><br><img src="https://habrastorage.org/files/5d0/170/ad0/5d0170ad0847451f904a122af34e0000.png"><br><br>  To change the current database, you can use the drop-down list: <br><br><img src="https://habrastorage.org/files/618/bc7/1d4/618bc71d4fe44b41a36a71c61436fbb4.png"><br><br>  To execute a specific command (or group of commands), highlight it and press the ‚ÄúExecute / Execute‚Äù button or the F5 key.  If there is only one command currently in the editor, or you need to execute all the commands, then you do not need to select anything. <br><br><img src="https://habrastorage.org/files/a3d/0fb/394/a3d0fb394baf4f7dbe2952954584f888.png"><br><br>  After executing scripts, in particular creating objects (tables, columns, indexes), to see the changes, use the update from the context menu, selecting the corresponding group (for example, Tables), the table itself or the Columns group in it. <br><br><img src="https://habrastorage.org/files/d59/959/9b0/d599599b0c534d1095a8051a595ff795.png"><br><br>  Actually, this is all that we will need to know in order to carry out the examples cited here.  The rest of the SSMS utility is easy to learn on your own. <br><br><h2>  Some theory </h2><br>  A relational database (DBD, or further in the context of simply DB) is a set of tables related to each other.  Roughly speaking, a DB is a file in which data is stored in a structured form. <br><br>  DBMS - Management System for these Databases, i.e.  This is a set of tools for working with a specific type of database (MS SQL, Oracle, MySQL, Firebird, ...). <br><br><blockquote>  <b>Note</b> <br>  Since  in life, colloquially, we mostly say: ‚ÄúOracle DB‚Äù, or even just ‚ÄúOracle‚Äù, actually meaning ‚ÄúOracle DBMS‚Äù, then the term DB will sometimes be used in the context of this textbook.  From the context, I think it will be clear what exactly we are talking about. </blockquote><br><br>  A table is a collection of columns.  Columns can also be called fields or columns, all these words will be used as synonyms expressing the same thing. <br><br>  The table is the main object of the DDB, all DDB data is stored line by line in columns of the table.  Lines, records are also synonyms. <br><br>  For each table, as well as its columns, the names are set, which are subsequently referred to. <br>  The name of an object (table name, column name, index name, etc.) in MS SQL can have a maximum length of 128 characters. <br><br><blockquote>  <b>For reference</b> , in the ORACLE database, object names can have a maximum length of 30 characters.  Therefore, for a specific database, you need to develop your own rules for naming objects in order to meet the limit on the number of characters. </blockquote><br><br>  SQL is a language that allows queries in the database through the DBMS.  In a specific DBMS, the SQL language can have a specific implementation (its own dialect). <br><br>  DDL and DML is a subset of the SQL language: <br><ul><li>  The DDL language serves to create and modify the database structure, i.e.  to create / modify / delete tables and links. </li><li>  DML allows you to manipulate table data, i.e.  with its strings.  It allows you to make a selection of data from the tables, add new data to the table, as well as update and delete existing data. </li></ul><br><br>  In the SQL language, you can use 2 types of comments (single-line and multi-line): <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  </span></span></code> </pre> <br>  and <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span></code> </pre><br><br>  Actually, everything for the theory of this will be enough. <br><br><h2>  DDL - Data Definition Language </h2><br>  For example, consider a table with data about employees, in the usual form for a person who is not a programmer: <br><table><tbody><tr><th>  Personnel Number </th><th>  Full name </th><th>  Date of Birth </th><th>  E-mail </th><th>  Position </th><th>  Department </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  02/19/1955 </td><td>  i.ivanov@test.tt </td><td>  Director </td><td>  Administration </td></tr><tr><td>  1001 </td><td>  Petrov P.P. </td><td>  12/03/1983 </td><td>  p.petrov@test.tt </td><td>  Programmer </td><td>  IT </td></tr><tr><td>  1002 </td><td>  Sidorov S.S. </td><td>  06/07/1976 </td><td>  s.sidorov@test.tt </td><td>  Accountant </td><td>  Accounting </td></tr><tr><td>  1003 </td><td>  Andreev A.A. </td><td>  04/17/1982 </td><td>  a.andreev@test.tt </td><td>  Senior programmer </td><td>  IT </td></tr></tbody></table><br>  In this case, the columns of the table have the following names: Personnel number, full name, Date of birth, E-mail, Position, Department. <br><br>  Each of these columns can be characterized by the type of data it contains: <br><ul><li>  Personnel number - integer </li><li>  Name - string </li><li>  Date of birth - date </li><li>  E-mail - string </li><li>  Position - string </li><li>  Division - string </li></ul><br>  Column type is a characteristic that says what kind of data a given column can store. <br><br>  For a start, it will be enough to remember only the following basic data types used in MS SQL: <br><table><tbody><tr><th width="150">  Value </th><th width="120">  Designation in MS SQL </th><th>  Description </th></tr><tr><td>  Variable length string </td><td>  varchar (N) <br>  and <br>  nvarchar (n) <br></td><td>  Using the number N, we can specify the maximum possible row length for the corresponding column.  For example, if we want to say that the value of the column "full name" can contain a maximum of 30 characters, then it is necessary to specify the type nvarchar (30). <br>  The difference between varchar and nvarchar is that varchar allows you to store strings in ASCII format, where one character takes 1 byte, and nvarchar stores strings in Unicode format, where each character takes 2 bytes. <br>  The varchar type should only be used if you are 100% sure that this field does not need to store Unicode characters.  For example, varchar can be used to store email addresses, because  they usually contain only ASCII characters. <br></td></tr><tr><td>  Fixed length string </td><td>  char (N) <br>  and <br>  nchar (N) <br></td><td>  This type differs from a string of variable length in that if the length of the string is less than N characters, then it is always padded to the right to the length by N spaces and stored in the database in this form, that is  in the database, it takes exactly N characters (where one character takes 1 byte for char and 2 bytes for type nchar).  In my practice, this type is very rarely used, and if used, it is used mainly in the char (1) format, i.e.  when a field is defined by a single character. </td></tr><tr><td>  Integer </td><td>  int </td><td>  This type allows us to use only integers in the column, both positive and negative.  For reference (now it is not so important for us) - the range of numbers that allows the int type from -2 147 483 648 to 2 147 483 647. Usually this is the main type that is used to set identifiers. </td></tr><tr><td>  Real or real number </td><td>  float </td><td>  In simple terms, these are numbers in which a decimal point (comma) may be present. </td></tr><tr><td>  date </td><td>  date </td><td>  If you need to store in the column only the Date, which consists of three components: Number, Month and Year.  For example, February 15, 2014 (February 15, 2014).  This type can be used for the column ‚ÄúDate of admission‚Äù, ‚ÄúDate of birth‚Äù, etc., i.e.  when it is important for us to fix only the date, or when the time component is not important to us and it can be dropped or if it is not known. </td></tr><tr><td>  Time </td><td>  time </td><td>  This type can be used if it is necessary to store only time data in the column, i.e.  Hours, Minutes, Seconds and Milliseconds.  For example, 17: 38: 31.3231603 <br>  For example, the daily flight departure time. <br></td></tr><tr><td>  date and time </td><td>  datetime </td><td>  This type allows you to simultaneously save the date and time.  For example, 02.15.2014 17: 38: 31.323 <br>  For example, this can be the date and time of an event. <br></td></tr><tr><td>  Flag </td><td>  bit </td><td>  It is convenient to use this type for storing values ‚Äã‚Äãof the form ‚ÄúYes‚Äù / ‚ÄúNo‚Äù, where ‚ÄúYes‚Äù will be stored as 1, and ‚ÄúNo‚Äù will be stored as 0. </td></tr></tbody></table><br>  Also, the value of the field, in the event that this is not prohibited, may not be indicated, the keyword NULL is used for this purpose. <br><br>  To execute the examples we will create a test database called Test. <br><br>  A simple database (without additional parameters) can be created by running the following command: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span></code> </pre><br>  You can delete a database with a command (you should be very careful with this command): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span></code> </pre><br>  In order to switch to our database, you can run the command: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span></code> </pre><br>  Or select the Test database in the drop-down list in the SSMS menu area.  When I work, I often use this method of switching between databases. <br><br>  Now in our database we can create a table using descriptions as they are, using spaces and Cyrillic characters: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> []( [ ] <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, [] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), [ ] <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, [E-mail] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), [] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), [] <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) )</code> </pre><br>  In this case, we will have to enclose the names in square brackets [...]. <br><br>  But in the database for greater convenience, all the names of the objects are better set in the Latin alphabet and not use spaces in the names.  In MS SQL, usually in this case, each word begins with an uppercase letter, for example, for the field ‚ÄúPersonnel number‚Äù, we could set the name PersonnelNumber.  You can also use numbers in the name, for example, PhoneNumber1. <br><br><blockquote>  <b>On a note</b> <br>  In some DBMS, the following format of the names ‚ÄúPHONE_NUMBER‚Äù may be more preferable, for example, such a format is often used in the ORACLE database.  Naturally, when specifying the field name, it is desirable that it does not coincide with the keywords used in the DBMS. </blockquote><br><br>  For this reason, you can forget about the syntax with square brackets and delete the table [Employees]: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> []</code> </pre><br>  For example, a table with employees can be called ‚ÄúEmployees‚Äù, and its fields can be given the following names: <br><ul><li>  ID - Personnel number (Employee Identifier) </li><li>  Name - Full Name </li><li>  Birthday - Date of birth </li><li>  Email - E-mail </li><li>  Position - Position </li><li>  Department - Department </li></ul><br>  Very often the word ID is used to name the identifier field. <br><br>  Now create our table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Position</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Department <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) )</code> </pre><br>  You can use the NOT NULL option to specify required columns. <br><br>  For an existing table, fields can be overridden using the following commands: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   ID ALTER TABLE Employees ALTER COLUMN ID int NOT NULL --   Name ALTER TABLE Employees ALTER COLUMN Name nvarchar(30) NOT NULL</span></span></code> </pre><br><br><blockquote>  <b>On a note</b> <br>  The general concept of the SQL language for most DBMS remains the same (at least, I can judge this by the DBMS with which I happened to work).  The difference in DDL in different DBMSs mainly lies in the data types (here not only their names can differ, but also the details of their implementation), the very specifics of the implementation of the SQL language can also differ slightly (i.e. the commands are the same, but there may be slight differences in the dialect, alas, but there is no one standard).  Owning the basics of SQL, you can easily switch from one DBMS to another, because  in this case, you only need to understand the implementation details of the commands in the new DBMS, i.e.  in most cases it will be enough just to draw an analogy. <br><br>  Not to be unfounded, I will give several examples of the same commands for the ORACLE DBMS: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   CREATE TABLE Employees( ID int, --  ORACLE  int -  ()  number(38) Name nvarchar2(30), -- nvarchar2  ORACLE  nvarchar  MS SQL Birthday date, Email nvarchar2(30), Position nvarchar2(30), Department nvarchar2(30) ); --   ID  Name (  ALTER COLUMN  MODIFY(‚Ä¶)) ALTER TABLE Employees MODIFY(ID int NOT NULL,Name nvarchar2(30) NOT NULL); --  PK (        MS SQL,    ) ALTER TABLE Employees ADD CONSTRAINT PK_Employees PRIMARY KEY(ID);</span></span></code> </pre><br>  For ORACLE there are differences in terms of implementation of the varchar2 type, its encoding depends on the database settings and the text can be saved, for example, in the UTF-8 encoding.  In addition, the length of the field in ORACLE can be specified both in bytes and in characters; for this, additional options BYTE and CHAR are used, which are specified after the field length, for example: <br><br><pre> <code class="sql hljs">NAME varchar2(30 BYTE) <span class="hljs-comment"><span class="hljs-comment">--     30  NAME varchar2(30 CHAR) --     30 </span></span></code> </pre><br>  Which option will be used by default BYTE or CHAR, in the case of a simple indication in ORACLE of type varchar2 (30), depends on the database settings, as it can sometimes be specified in the IDE settings.  In general, sometimes you can easily get confused, so in the case of ORACLE, if the varchar2 type is used (and this is sometimes justified, for example, when using the UTF-8 encoding), I prefer to explicitly prescribe CHAR (because usually the string length is more convenient to read in characters ). <br></blockquote><br><br>  But in this case, if there is already any data in the table, then for the successful execution of commands it is necessary that the ID and Name fields in all rows of the table are necessarily filled.  Let us demonstrate this with an example, insert data into the table in the ID, Position and Department fields, this can be done with the following script: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Position</span></span>,Department) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' '</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>)</code> </pre><br>  In this case, the INSERT command will also generate an error, since  when inserting, we did not specify the values ‚Äã‚Äãof the required Name field. <br>  If we already had this data in the original table, then the ‚ÄúALTER TABLE Employees ALTER COLUMN ID int NOT NULL‚Äù command would succeed, and the ‚ÄúALTER TABLE Employees ALTER COLUMN Name int NOT NULL‚Äù command would generate an error message, that the Name field contains NULL (not specified) values. <br><br>  Add values ‚Äã‚Äãfor the Name field and fill the data again: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Position</span></span>,Department,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' '</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>)</code> </pre><br>  Also, the NOT NULL option can be used directly when creating a new table, i.e.  in the context of the CREATE TABLE command. <br><br>  First, delete the table with the command: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees</code> </pre><br>  Now create a table with the required ID and Name columns: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Position</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Department <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) )</code> </pre><br>  You can also write NULL after the column name, which will mean that NULL values ‚Äã‚Äã(not specified) will be allowed in it, but this is not necessary, since this characteristic is implied by default. <br><br>  If, on the contrary, it is necessary to make the existing column optional, then use the following command syntax: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre><br>  Or simply: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>)</code> </pre><br>  Also with this command we can change the field type to another compatible type, or change its length.  For example, let's expand the Name field to 50 characters: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>)</code> </pre><br><h2>  Primary key </h2><br>  When creating a table, it is desirable that it have a unique column or a set of columns that is unique for each of its rows ‚Äî you can uniquely identify a record by this unique value.  This value is called the primary key of the table.  For our Employees table, such a unique value can be an ID column (which contains the ‚ÄúEmployee employee number‚Äù - let in our case this value is unique for each employee and cannot be repeated). <br><br>  To create a primary key to an existing table, use the command: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>)</code> </pre><br>  Where ‚ÄúPK_Employees‚Äù is the name of the constraint responsible for the primary key.  Usually for the name of the primary key is used the prefix "PK_" followed by the name of the table. <br><br>  If the primary key consists of several fields, then these fields must be listed in brackets, separated by commas: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> _ PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,‚Ä¶)</code> </pre><br>  It should be noted that in MS SQL all fields that are included in the primary key must have the NOT NULL characteristic. <br><br>  Also, the primary key can be determined directly when creating the table, i.e.  in the context of the CREATE TABLE command.  Delete the table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees</code> </pre><br>  And then create it using the following syntax: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Position</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Department <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-comment"><span class="hljs-comment">--  PK   ,   )</span></span></code> </pre><br>  After creating, fill in the data in the table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Position</span></span>,Department,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' '</span></span>,N<span class="hljs-string"><span class="hljs-string">''</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>)</code> </pre><br>  If the primary key in the table consists only of the values ‚Äã‚Äãof one column, then the following syntax can be used: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-comment"><span class="hljs-comment">--     Name nvarchar(30) NOT NULL, Birthday date, Email nvarchar(30), Position nvarchar(30), Department nvarchar(30) )</span></span></code> </pre><br>  In fact, the name of the restriction can be omitted, in which case it will be assigned a system name (like ‚ÄúPK__Employee__3214EC278DA42077‚Äù): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Position</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Department <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) )</code> </pre><br>  Or: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Position</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Department <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) )</code> </pre><br>  But I would recommend for permanent tables to always explicitly specify the name of the constraint, since  by an explicitly given and understandable name, it will later be easier to manipulate it, for example, you can delete it: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees</code> </pre><br>  But such a short syntax, without specifying constraint names, is convenient to use when creating temporary database tables (the name of the temporary table starts with # or ##), which will be deleted after use. <br><br><h2>  Summarize </h2><br>  At the moment we have considered the following commands: <br><ul><li>  <b>CREATE TABLE</b> table_name (enumeration of fields and their types, restrictions) - serves to create a new table in the current database; </li><li>  <b>DROP TABLE</b> table_name - serves to delete a table from the current database; </li><li>  <b>ALTER TABLE</b> tbl_name <b>ALTER COLUMN</b> col_name_name ... - used to update the column type or change its settings (for example, to set the NULL or NOT NULL characteristic); </li><li>  <b>ALTER TABLE</b> <b>tbl_name ADD CONSTRAINT</b> constraint_name <b>PRIMARY KEY</b> (field1, field2, ...) - add a primary key to an existing table; </li><li>  <b>ALTER TABLE</b> <b>tbl_name DROP CONSTRAINT</b> constraint-name - remove a constraint from a table. </li></ul><br><h2>  It is a little about temporary tables </h2><br><blockquote>  <b>Cut from MSDN.</b>  In MS SQL Server, there are two types of temporary tables: local (#) and global (##).  Local temporary tables are visible only to their creators until the end of the session to connect to the instance of SQL Server, as soon as they are first created.  Local temporary tables are automatically deleted after the user is disconnected from the instance of SQL Server.  Global temporary tables are visible to all users during any connection sessions after creating these tables and are deleted when all users referring to these tables are disconnected from the instance of SQL Server. </blockquote><br>  Temporary tables are created in the tempdb system database, i.e.  creating them, we do not litter the main database, otherwise the temporary tables are completely identical to regular tables, they can also be deleted using the DROP TABLE command.  Local (#) temporary tables are most commonly used. <br><br>  To create a temporary table, you can use the CREATE TABLE command: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-comment"><span class="hljs-comment">#Temp( ID int, Name nvarchar(30) )</span></span></code> </pre><br>  Since the temporary table in MS SQL is similar to a regular table, it can also be deleted by the DROP TABLE command itself: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-comment"><span class="hljs-comment">#Temp</span></span></code> </pre><br><br>  You can also create a temporary table (like a regular table itself) and immediately fill it with data returned by the query using the SELECT ... INTO syntax: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#Temp FROM Employees</span></span></code> </pre><br><blockquote>  <b>On a note</b> <br>  In different DBMS, the implementation of temporary tables may differ.  For example, in ORACLE and Firebird DBMS, the structure of temporary tables should be defined in advance by the CREATE GLOBAL TEMPORARY TABLE command specifying the specifics of data storage in it, then the user can see it among the main tables and work with it as with a regular table. <br></blockquote><br><br><h2>  Normalization of a DB - crushing on subtables (reference books) and definition of communications </h2><br>  Our current Employees table has the disadvantage that the user can enter any text in the Position and Department fields, which is fraught with errors first of all, since one employee can simply specify ‚ÄúIT‚Äù as a department, and the second employee, for example , enter the "IT department", the third "IT".  As a result, it will be unclear what the user meant, i.e.  Are these employees employees of the same department, or is the user described and these are 3 different departments?  And even more so, in this case, we will not be able to correctly group the data for a report, where, it may be necessary to show the number of employees in the context of each department. <br><br>  The second drawback is the storage volume of this information and its duplication, i.e.  For each employee, the full name of the department is indicated, which requires a place in the database to store each character from the department name. <br><br>  The third drawback is the difficulty of updating these fields, if the name of a post changes, for example, if you need to rename the post ‚ÄúProgrammer‚Äù to ‚ÄúJunior Programmer‚Äù.  In this case, we will have to make changes to every line of the table for which the Position is equal to "Programmer". <br><br>  To avoid these shortcomings, the so-called database normalization is applied - splitting it into subtables, tables of reference books.  It is not necessary to climb into the wilds of the theory and study what normal forms are, it is enough to understand the essence of normalization. <br><br>  Let's create 2 tables of references ‚ÄúPosts‚Äù and ‚ÄúDepartments‚Äù, the first one will be called Positions, and the second one, respectively, Departments: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Positions( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Positions PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Departments( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Departments PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> )</code> </pre><br>  Note that here we used the new IDENTITY option, which says that the data in the ID column will be numbered automatically, starting with 1, with step 1, i.e.  when new records are added, they will be sequentially assigned the values ‚Äã‚Äã1, 2, 3, etc.  Such fields are usually called auto-increment.  Only one field with the IDENTITY property can be defined in a table and usually, but not necessarily, such a field is the primary key for this table. <br><br><blockquote>  <b>On a note</b> <br>  In different DBMS, the implementation of fields with a counter can be done in its own way.  In MySQL, for example, such a field is defined using the AUTO_INCREMENT option.  In ORACLE and Firebird, this functionality could previously be emulated using sequence (SEQUENCE).  But as far as I know in ORACLE now added option GENERATED AS IDENTITY. <br></blockquote><br><br>  Let's fill these tables automatically, based on the current data recorded in the Position and Department fields of the Employees table: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   Name  Positions,     Position  Employees INSERT Positions(Name) SELECT DISTINCT Position FROM Employees WHERE Position IS NOT NULL --       </span></span></code> </pre><br>  Do the same for the Departments table: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Departments(<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> Department <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Department <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre><br>  If we now open the Positions and Departments tables, we see a numbered set of values ‚Äã‚Äãacross the ID field: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Positions</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th></tr><tr><td>  one </td><td>  Accountant </td></tr><tr><td>  2 </td><td>  Director </td></tr><tr><td>  3 </td><td>  Programmer </td></tr><tr><td>  four </td><td>  Senior programmer </td></tr></tbody></table><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th></tr><tr><td>  one </td><td>  Administration </td></tr><tr><td>  2 </td><td>  Accounting </td></tr><tr><td>  3 </td><td>  IT </td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These tables now will play the role of reference books for the assignment of posts and departments. </font><font style="vertical-align: inherit;">Now we will refer to the identifiers of posts and departments. </font><font style="vertical-align: inherit;">First of all, create new fields in the Employees table for storing identifier data:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--    ID  ALTER TABLE Employees ADD PositionID int --    ID  ALTER TABLE Employees ADD DepartmentID int</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The type of the reference fields must be what, as in the reference books, in this case it is an int. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can also add several fields to the table at once with one command, listing the fields separated by commas:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> PositionID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, DepartmentID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we will write the links (reference constraints - FOREIGN KEY) for these fields, so that the user does not have the opportunity to write in these fields, values ‚Äã‚Äãthat are missing among the ID values ‚Äã‚Äãin the reference books. </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_PositionID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(PositionID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Positions(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And we will do the same for the second field: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_DepartmentID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(DepartmentID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Departments(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now the user can enter only the ID values ‚Äã‚Äãfrom the corresponding directory in these fields. Accordingly, in order to use a new department or position, it must first add a new entry to the appropriate directory.</font></font> Since<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posts and departments are now stored in reference books in one single copy, then in order to change the name, it is enough to change it only in the reference book. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The name of the reference constraint is usually composite, it consists of the ‚ÄúFK_‚Äù prefix, then the name of the table and, after the underscore, the name of the field that refers to the identifier of the reference table. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The identifier (ID) is usually an internal value that is used only for links and what value is stored there, in most cases absolutely indifferent, so you should not try to get rid of holes in the sequence of numbers that occur during the work with the table, for example, after deleting records from the directory. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, in some cases, the link can be organized in several fields:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,‚Ä¶) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> _(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,‚Ä¶)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, in the table "reference_ table", the primary key is represented by a combination of several fields (field1, field2, ...). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Actually, we now update the PositionID and DepartmentID fields with ID values ‚Äã‚Äãfrom reference books. </font><font style="vertical-align: inherit;">For this purpose, we use the DML UPDATE command:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> PositionID=(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Positions <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=e.Position), DepartmentID=(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Departments <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>=e.Department) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let's see what happened by running the query: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  Birthday </th><th>  Email </th><th>  Position </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Department </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PositionID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DepartmentID </font></font></th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  Null </td><td>  Null </td><td>  Director </td><td>  Administration </td><td>  2 </td><td>  one </td></tr><tr><td>  1001 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Petrov P.P. </font></font></td><td>  Null </td><td>  Null </td><td>  Programmer </td><td>  IT </td><td>  3 </td><td>  3 </td></tr><tr><td>  1002 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sidorov S.S. </font></font></td><td>  Null </td><td>  Null </td><td>  Accountant </td><td>  Accounting </td><td>  one </td><td>  2 </td></tr><tr><td>  1003 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Andreev A.A. </font></font></td><td>  Null </td><td>  Null </td><td>  Senior programmer </td><td>  IT </td><td>  four </td><td>  3 </td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Everything, the PositionID and DepartmentID fields are filled with the corresponding positions and departments with identifiers of need for the Position and Department fields in the Employees table now no, you can delete these fields: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Position</span></span>,Department</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now the table has acquired the following form: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  Birthday </th><th>  Email </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PositionID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DepartmentID </font></font></th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  Null </td><td>  Null </td><td>  2 </td><td>  one </td></tr><tr><td>  1001 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Petrov P.P. </font></font></td><td>  Null </td><td>  Null </td><td>  3 </td><td>  3 </td></tr><tr><td>  1002 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sidorov S.S. </font></font></td><td>  Null </td><td>  Null </td><td>  one </td><td>  2 </td></tr><tr><td>  1003 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Andreev A.A. </font></font></td><td>  Null </td><td>  Null </td><td>  four </td><td>  3 </td></tr></tbody></table><br>  Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we eventually got rid of storing redundant information. </font><font style="vertical-align: inherit;">Now, by the position and department numbers we can uniquely identify their names using the values ‚Äã‚Äãin the reference tables:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> e.ID,e.Name,p.Name PositionName,d.Name DepartmentName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees e <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Departments d <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.ID=e.DepartmentID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Positions p <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.ID=e.PositionID</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PositionName </font></font></th><th> DepartmentName </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td>  Director </td><td>  Administration </td></tr><tr><td>  1001 </td><td>  .. </td><td>  Programmer </td><td>  IT </td></tr><tr><td>  1002 </td><td>  .. </td><td>  Accountant </td><td>  Accounting </td></tr><tr><td>  1003 </td><td>  .. </td><td>  Senior programmer </td><td>  IT </td></tr></tbody></table><br>        ,     .          ‚Äì ,    . <br><br><img src="https://habrastorage.org/files/6fe/ebe/e7b/6feebee7bc02433084215f8d540cfe17.png"><br><br>    ,       , ..    .            ManagerID,     ,    .  : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ManagerID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span></code> </pre><br>      NULL,   , , ,    . <br><br>   FOREIGN KEY   Employees: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_ManagerID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ManagerID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's now create a diagram and see how the links between our tables look on it: </font></font><br><br><img src="https://habrastorage.org/files/399/78e/548/39978e5482154bb1b12650f70d8a8ece.png"><br><br><img src="https://habrastorage.org/files/5a7/50a/249/5a750a2498af4ed78f9c82dccb307962.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, we should see the following picture (the Employees table is associated with the Positions and Depertments tables, and also refers to itself): </font></font><br><br><img src="https://habrastorage.org/files/9a4/194/de9/9a4194de991f469ea7f217fd288047e1.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, we should say that reference keys may include additional options ON DELETE CASCADE and ON UPDATE CASCADE, which talk about how to behave when deleting or updating a record referenced in the reference table. If these options are not specified, then we cannot change the ID in the table of the reference book of the entry referenced from another table, nor can we delete such entry from the reference book until we delete all the rows referring to this entry or we will update in these lines links to another value.</font></font><br><br>        ON DELETE CASCADE  FK_Employees_DepartmentID: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), PositionID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, DepartmentID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, ManagerID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_DepartmentID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(DepartmentID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Departments(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_PositionID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(PositionID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Positions(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_ManagerID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ManagerID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,Birthday,PositionID,DepartmentID,ManagerID)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19550219'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19831203'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1003</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19760607'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19820417'</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>)</code> </pre><br>     3   Departments: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> Departments <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br>     Employees: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  Birthday </th><th>  Email </th><th> PositionID </th><th> DepartmentID </th><th> ManagerID </th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td> 1955-02-19 </td><td>  Null </td><td>  2 </td><td>  one </td><td>  Null </td></tr><tr><td>  1002 </td><td>  .. </td><td> 1976-06-07 </td><td>  Null </td><td>  one </td><td>  2 </td><td>  1000 </td></tr></tbody></table><br>  ,    3   Employees   . <br><br>  ON UPDATE CASCADE   ,       ID  . ,    ID    ,        DepartmentID   Employees    ID     .         , ..   ID   Departments   IDENTITY,        (   3  30): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> Departments <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main thing to understand the essence of these 2 options ON DELETE CASCADE and ON UPDATE CASCADE. </font><font style="vertical-align: inherit;">I use these options very rarely and I recommend that you think carefully before specifying them in the reference constraint, since </font><font style="vertical-align: inherit;">in case of unintentional deletion of a record from the reference table, this can lead to big problems and create a chain reaction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restore section 3:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--    / IDENTITY  SET IDENTITY_INSERT Departments ON INSERT Departments(ID,Name) VALUES(3,N'') --  / IDENTITY  SET IDENTITY_INSERT Departments OFF</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Completely clear the Employees table using the TRUNCATE TABLE command: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">TRUNCATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Again, let's reload the data into it using the previous INSERT command: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,Birthday,PositionID,DepartmentID,ManagerID)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19550219'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19831203'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1003</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19760607'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19820417'</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>)</code> </pre><br><br><h2>  Summarize </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> At this point, a few more DDL commands have been added to our knowledge: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adding the IDENTITY property to the field - allows you to make this field automatically populated (by a counter field) for the table; </font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tbl_name </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ADD</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> list_fields_characteristics - allows you to add new fields to the table;</font></font></li><li> <b>ALTER TABLE</b> _ <b>DROP COLUMN</b> _ ‚Äì     ; </li><li> <b>ALTER TABLE</b> _ <b>ADD CONSTRAINT</b> _ <b>FOREIGN KEY</b> () <b>REFERENCES</b> _() ‚Äì        . </li></ul><br><h2>   ‚Äì UNIQUE, DEFAULT, CHECK </h2><br>    UNIQUE                 .    Employees,        Email.    Email ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> Email=<span class="hljs-string"><span class="hljs-string">'i.ivanov@test.tt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> Email=<span class="hljs-string"><span class="hljs-string">'p.petrov@test.tt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">1001</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> Email=<span class="hljs-string"><span class="hljs-string">'s.sidorov@test.tt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">1002</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> Email=<span class="hljs-string"><span class="hljs-string">'a.andreev@test.tt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>=<span class="hljs-number"><span class="hljs-number">1003</span></span></code> </pre><br>        -: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> UQ_Employees_Email <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span>(Email)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now the user will not be able to enter the same E-Mail with several employees. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The uniqueness restriction is usually referred to as follows - first comes the prefix ‚ÄúUQ_‚Äù, then the name of the table and after the underscore sign the name of the field on which this restriction is imposed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accordingly, if the combination of fields should be unique in the context of table rows, we list them separated by commas:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,‚Ä¶)</code> </pre><br>       DEFAULT      ,     ,               INSERT.        . <br><br>     Employees   ¬´ ¬ª    HireDate            : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> HireDate <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> SYSDATETIME()</code> </pre><br>    HireDate  ,     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> SYSDATETIME() <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> HireDate</code> </pre><br>      , ..   DEFAULT    ,     .    -, , ,        .  This is done as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> DF_Employees_HireDate <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> SYSDATETIME() <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> HireDate</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since this column was not there before, then when it is added to each record, the current date value will be inserted in the HireDate field. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When adding a new record, the current date will also be inserted automatically, of course, unless we explicitly specify it, i.e. </font><font style="vertical-align: inherit;">do not specify in the list of columns. </font><font style="vertical-align: inherit;">Let us show this with an example, without specifying the HireDate field in the list of added values:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,Email)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">1004</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'s.sergeev@test.tt'</span></span>)</code> </pre><br>  Let's see what happened: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  Birthday </th><th>  Email </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PositionID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DepartmentID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ManagerID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hiredate </font></font></th></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1955-02-19 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> i.ivanov@test.tt </font></font></td><td>  2 </td><td>  one </td><td>  Null </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1001 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Petrov P.P. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1983-12-03 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> p.petrov@test.tt </font></font></td><td>  3 </td><td>  four </td><td>  1003 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1002 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sidorov S.S. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1976-06-07 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s.sidorov@test.tt </font></font></td><td>  one </td><td>  2 </td><td>  1000 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1003 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Andreev A.A. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1982-04-17 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a.andreev@test.tt </font></font></td><td>  four </td><td>  3 </td><td>  1000 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1004 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sergeev S.S. </font></font></td><td>  Null </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s.sergeev@test.tt </font></font></td><td>  Null </td><td>  Null </td><td>  Null </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The check constraint CHECK is used when it is necessary to check the values ‚Äã‚Äãinserted in the field. </font><font style="vertical-align: inherit;">For example, we impose this restriction on the field of personnel number, which we have is an employee identifier (ID). </font><font style="vertical-align: inherit;">Using this restriction, we say that personnel numbers should have a value from 1000 to 1999:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> CK_Employees_ID <span class="hljs-keyword"><span class="hljs-keyword">CHECK</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1999</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The constraint is usually named the same, first comes the prefix ‚ÄúCK_‚Äù, then the name of the table and the name of the field on which this restriction is imposed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's try inserting an invalid entry to verify that the constraint is working (we should get the corresponding error):</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,Email) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">2000</span></span>,<span class="hljs-string"><span class="hljs-string">'test@test.tt'</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And now we change the inserted value to 1500 and make sure that the record is inserted: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,Email) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-number"><span class="hljs-number">1500</span></span>,<span class="hljs-string"><span class="hljs-string">'test@test.tt'</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You can also create UNIQUE and CHECK constraints without specifying a name: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span>(Email) <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHECK</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1999</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But this is not very good practice and it is better to set the name of the constraint explicitly, since </font><font style="vertical-align: inherit;">in order to understand later what will be more difficult, it will be necessary to open the object and look at what it is responsible for. </font></font><br><br><img src="https://habrastorage.org/files/068/287/b40/068287b40ebb4cf6a8872374f57b1193.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With a good name a lot of information about the restriction can be found directly by its name. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And, accordingly, all these restrictions can be created immediately when creating a table, if it does not already exist. </font><font style="vertical-align: inherit;">Delete the table:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And we will recreate it with all created restrictions with a single CREATE TABLE command: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), PositionID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, DepartmentID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, HireDate <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> SYSDATETIME(), <span class="hljs-comment"><span class="hljs-comment">--  DEFAULT    CONSTRAINT PK_Employees PRIMARY KEY (ID), CONSTRAINT FK_Employees_DepartmentID FOREIGN KEY(DepartmentID) REFERENCES Departments(ID), CONSTRAINT FK_Employees_PositionID FOREIGN KEY(PositionID) REFERENCES Positions(ID), CONSTRAINT UQ_Employees_Email UNIQUE (Email), CONSTRAINT CK_Employees_ID CHECK (ID BETWEEN 1000 AND 1999) )</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Finally, insert our employees into the table: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,Birthday,Email,PositionID,DepartmentID)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19550219'</span></span>,<span class="hljs-string"><span class="hljs-string">'i.ivanov@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19831203'</span></span>,<span class="hljs-string"><span class="hljs-string">'p.petrov@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19760607'</span></span>,<span class="hljs-string"><span class="hljs-string">'s.sidorov@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19820417'</span></span>,<span class="hljs-string"><span class="hljs-string">'a.andreev@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is a little about the indexes created at creation of restrictions PRIMARY KEY and UNIQUE </font></font></h2><br>      ,    PRIMARY KEY  UNIQUE        (PK_Employees  UQ_Employees_Email).         CLUSTERED,       NONCLUSTERED.  ,         .       (CLUSTERED) . CLUSTERED ‚Äì ,        ,    ,          .      .    ,   ,   .   ‚Äì    ,      ,    .    ,        ,    ,          NONCLUSTERED: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> _ PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> NONCLUSTERED(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,‚Ä¶)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, let's make the restriction index PK_Employees noncluster, and the restriction index UQ_Employees_Email cluster. </font><font style="vertical-align: inherit;">First, remove these restrictions:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> UQ_Employees_Email</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now create them with the CLUSTERED and NONCLUSTERED options: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> NONCLUSTERED (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> UQ_Employees_Email <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> CLUSTERED (Email)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now, selecting the Employees table, we see that the records were sorted by the cluster index UQ_Employees_Email: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Employees</code> </pre><br><table><tbody><tr><th>  ID </th><th>  Name </th><th>  Birthday </th><th>  Email </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PositionID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DepartmentID </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hiredate </font></font></th></tr><tr><td>  1003 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Andreev A.A. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1982-04-17 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a.andreev@test.tt </font></font></td><td>  four </td><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1000 </td><td>  Ivanov I.I. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1955-02-19 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> i.ivanov@test.tt </font></font></td><td>  2 </td><td>  one </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1001 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Petrov P.P. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1983-12-03 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> p.petrov@test.tt </font></font></td><td>  3 </td><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr><tr><td>  1002 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sidorov S.S. </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1976-06-07 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s.sidorov@test.tt </font></font></td><td>  one </td><td>  2 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2015-04-08 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prior to this, when the cluster index was the PK_Employees index, the default entries were sorted by the ID field. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But in this case, this is just an example that shows the essence of the cluster index, since Most likely, queries on the ID field will be made to the Employees table and in some cases, it will probably act as a directory itself. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For directories, it is usually advisable that the cluster index be built on the primary key, since in queries, we often refer to a directory identifier for obtaining, for example, a name (Position, Department). Here we recall what I wrote above that the cluster index has direct access to the rows of the table, and it follows that we can get the value of any column without additional overhead.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster index is advantageous to apply to the fields in which the sample is most often. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sometimes, in tables, a key is created for a surrogate field, in this case it is useful to save the CLUSTERED index option for a more suitable index and specify the NONCLUSTERED option when creating a surrogate primary key.</font></font><br><br><h2>  Summarize </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> At this stage, we got acquainted with all kinds of restrictions, in their simplest form, which are created by a command like "ALTER TABLE tablename ADD CONSTRAINT name_ restrictions ...": </font></font><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PRIMARY KEY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - primary key;</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FOREIGN KEY</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - setting up links and monitoring referential integrity of data;</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIQUE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - allows you to create uniqueness;</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHECK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - allows the correctness of the entered data;</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFAULT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - allows you to set a default value;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is also worth noting that all restrictions can be removed using the command ¬´ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the ALTER TABLE statement</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> table_name </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP CONSTRAINT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> constraint_name".</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We also partially covered the topic of indexes and dismantled the concept of cluster ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLUSTERED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and non-cluster ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NONCLUSTERED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) index.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creation of independent indexes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Independence here refers to indices that are not created to restrict PRIMARY KEY or UNIQUE. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indexes by field or fields can be created with the following command:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> IDX_Employees_Name <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here you can also specify the CLUSTERED, NONCLUSTERED, UNIQUE options, as well as the sort direction for each individual ASC field (default) or DESC: </font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> NONCLUSTERED <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> UQ_Employees_EmailDesc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Employees(Email <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>)</code> </pre><br>      NONCLUSTERED  , ..    ,    ,     CLUSTERED  NONCLUSTERED  . <br><br>     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> IDX_Employees_Name <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Employees</code> </pre><br>    ,   ,      CREATE TABLE. <br><br>     : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees</code> </pre><br>            CREATE TABLE: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> Employees( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), Birthday <span class="hljs-built_in"><span class="hljs-built_in">date</span></span>, Email <span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>), PositionID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, DepartmentID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, HireDate <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> DF_Employees_HireDate <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> SYSDATETIME(), ManagerID <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_Employees PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_DepartmentID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(DepartmentID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Departments(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_PositionID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>(PositionID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Positions(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> FK_Employees_ManagerID <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (ManagerID) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> Employees(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> UQ_Employees_Email <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span>(Email), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> CK_Employees_ID <span class="hljs-keyword"><span class="hljs-keyword">CHECK</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1999</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> IDX_Employees_Name(<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>) )</code> </pre><br>      : <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> Employees (<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>,Birthday,Email,PositionID,DepartmentID,ManagerID)<span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1000</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19550219'</span></span>,<span class="hljs-string"><span class="hljs-string">'i.ivanov@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>), (<span class="hljs-number"><span class="hljs-number">1001</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19831203'</span></span>,<span class="hljs-string"><span class="hljs-string">'p.petrov@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1003</span></span>), (<span class="hljs-number"><span class="hljs-number">1002</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19760607'</span></span>,<span class="hljs-string"><span class="hljs-string">'s.sidorov@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>), (<span class="hljs-number"><span class="hljs-number">1003</span></span>,N<span class="hljs-string"><span class="hljs-string">' ..'</span></span>,<span class="hljs-string"><span class="hljs-string">'19820417'</span></span>,<span class="hljs-string"><span class="hljs-string">'a.andreev@test.tt'</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>)</code> </pre><br>   ,             INCLUDE.  Those.    INCLUDE- -    ,       ,      . ,          (SELECT),       ,        .      , ..      . <br><br><blockquote> <b>  MSDN.</b>       <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> ] [ CLUSTERED | NONCLUSTERED ] <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> index_name <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ] [ ,...n ] ) [ <span class="hljs-keyword"><span class="hljs-keyword">INCLUDE</span></span> ( column_name [ ,...n ] ) ]</code> </pre><br></blockquote><br><br><h2>  Summarize </h2><br>       (SELECT),       , ..            . <br><br>       ,  ,    ,        .            , ,      . <br><br><h2>   DDL </h2><br>   ,  DDL   ,      .         ,    . <br><br>  ‚Äî  ,    . <br><br>          SQL. <br><br>  Part Two - <a href="http://habrahabr.ru/post/255523/">habrahabr.ru/post/255523</a> </div><p>Source: <a href="https://habr.com/ru/post/255361/">https://habr.com/ru/post/255361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255349/index.html">Chronicles of the laboratory: a rat in a polymer helmet, spectral analysis of a can of chips and blue electrical tape</a></li>
<li><a href="../255351/index.html">One-page client-server MVC JavaScript application on technologies of 1996 for Windows</a></li>
<li><a href="../255355/index.html">How we implemented the machine interface for issuing loans</a></li>
<li><a href="../255357/index.html">DataSync API from Yandex.Disk: a cloud for applications and structured data</a></li>
<li><a href="../255359/index.html">Multifunctional temperature / humidity sensor on the ESP8266 or one more step to the ‚ÄúInternet of things‚Äù</a></li>
<li><a href="../255363/index.html">SDN: alternative or addition to traditional networks?</a></li>
<li><a href="../255365/index.html">10 commandments of programming without ego</a></li>
<li><a href="../255371/index.html">Electronics for 3D scanner</a></li>
<li><a href="../255373/index.html">Making screenshots correctly: practical tips</a></li>
<li><a href="../255379/index.html">PVS-Studio: new trial mode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>