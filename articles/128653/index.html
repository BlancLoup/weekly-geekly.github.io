<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Spring in the OSGi Container</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is hardly a Java developer who does not know what the Spring Framework is. One of the basic technologies of this framework is the IoC container ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Spring in the OSGi Container</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage1/0247a49a/11c5bc8a/f1558897/76258705.png"></div><br>  There is hardly a Java developer who does not know what the Spring Framework is.  One of the basic technologies of this framework is the IoC container and AOP support.  These technologies allow you to successfully break the application architecture into separate layers, both at the class level and at the object layout level at run time.  It would seem that the application is perfectly structured into elements / layers, but in essence it remains monolithic.  Capless at runtime!  Only within the framework of this framework, there are no universal solutions to this problem.  Slightly fewer Java developers have heard of OSGi.  This is the specification of modular systems for the Java platform.  Using a specific implementation of this specification as the basis of an application allows you to make it modular, both at runtime and at the physical (file) level.  About the synergy of these technologies and will be discussed in this article. <a name="habracut"></a><br><br><h4>  Spring framework </h4><br>  I expect that the reader is familiar with this framework at least at the level of reading the first ten chapters from the official manual.  It is not possible to describe all this in one article.  Therefore, I refer all those who need it to the official leadership.  Below is just a brief help on the main components of the Spring Framework. <br><ul><li>  The IoC container with the implementation of the DI pattern is a mechanism that controls the creation, configuration, and binding of objects at run time, the basic integral part of the framework. </li><li>  AOP - support for aspect-based programming.  The basic mechanism that many subsystems use. </li><li>  Integration with data sources, ORM support and transaction support - mechanisms for interacting with various data sources from XML to DBMS, integration with third-party frameworks in these areas, support for local and global transactions, translation of specific access hierarchies to access data sources in their own hierarchy, etc. . </li><li>  Web components - provide various mechanisms from the native implementation of the MVC pattern to integration with various Web-related frameworks (JSF, Struts, WS, etc.). </li></ul><br>  Many different subprojects from the SpringSource portfolio. <br><br><h4>  Modularity </h4><br>  Ideally, a truly modular program should consist of elements that have the following pronounced features: weak connectivity (interaction through a well-defined interface, easy replaceability, repeated use), encapsulation (the module is viewed from the outside as a black box with a specific interaction interface), dynamism ( ability to change multiple modules at run time).  Java allows for weak connectivity and encapsulation, both at the class level and at the package level.  Of course, there are ways to break encapsulation at the level of access modifiers (private, protected) using reflection (Reflection API) and thereby link your code with the internal mechanisms of third-party code, or use the mechanisms for changing the code of classes (javassist, cglib, changing the code of classes manually and .d.), but it is rather khaki.  But what about the dynamism, that is, the ability to replace modules at run time.  In this area things are worse.  You can of course implement dynamic support by redefining class loaders (ClassLoader) with your implementations, but this is a very large amount of work that implementers of OSGi have already done for us.  Any OSGi container already supports modularity at the core architecture and API level. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  OSGi </h4><br>  Open Services Gateway initiative is a specification with many implementations.  The main open source implementations are Apache Felix, Equinox and Knopflerfish.  This specification describes a modular system that can dynamically bundle various modules (bundles).  The composition of the modules may change at run time.  The interaction between the modules is carried out using services that are registered in the Service Register.  Modules have a life cycle that consists of several states (INSTALLED, RESOLVED, STARTING, ACTIVE, STOPPING, UNINSTALLED).  The life cycle of the module is managed by the OSGi container. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/81cd11de/3dc491c0/53179443/274e308b.png"></div><br>  Module state diagram <br><br>  The OSGi-module (bundle) must have additional metadata in the META-INF / MANIFEST.MF file.  Some of the main ones are presented below: <br><ul><li>  Bundle-Name - readable module name; </li><li>  Bundle-Version is the version of the module in the format number [.number [.number [.line]]], the default version is 0.0.0; <br>  Bundle-SymbolicName - the symbolic name of the module, together with the version serve as unique identifiers of the module; </li><li>  Export-Package - a list of exported Java-packages of the module with possible additional directives; </li><li>  Import-Package - a list of imported Java packages used in the module with possible additional directives. </li></ul><br><br><h4>  How did you get the opportunity to use Spring with OSGi </h4><br>  OSGi implementations allow you to create truly modular Java programs.  The Spring Framework makes it possible to get rid of manual support for connections between objects through the use of an IoC container, extend the functionality of existing classes using AOP, and use any related technologies from the SpringSource portfolio.  Combining these technologies should bring considerable benefits in software development.  Not surprisingly, this thought came to mind of several people from Interface21 (later SpringSource) in 2006 and they were able to connect people from OSGi Alliance, BEA, Oracle, IBM to the development.  As a result of joint efforts, the Spring dm product appeared under the SpringSource wing, later this product gave life to the Blueprint specification in the OSGi Service Platform Service Compendium.  Its codebase was taken over by the Eclipse Foundation and was named Gemini Blueprint.  SpringSource also released dm Server, now its codebase has become a project of Virgo in the Eclipse Foundation. <br><br><h4>  Gemini Blueprint Architecture (Spring DM) </h4><br>  So how does Gemini Blueprint allow you to use the Spring Framework in an OSGi container?  To answer this question, you need to consider the main points of the Gemini Blueprint architecture. <br><br>  The basic element of the architecture is extender (implementation of the OSGi pattern extender).  The Extender monitors the launch events for new modules (bundle) in the OSGi service platform and checks whether this module supports the blueprint specification.  If the module supports this specification, extender creates the Spring context of the module and initializes it.  Thus, each Spring module has its own Spring context.  In addition, the extender calls the code that is responsible for publishing Spring-beans as OSGi services and getting links to OSGi services, and so on. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/f78a9e14/29f2d6a7/67933268/c2f6a4f9.png"></div><br>  Extender function diagram <br><br>  All information on the basis of which the extender creates the context is taken from the configuration as xml files.  Here it is necessary to emphasize the existence of two possible configuration options spring and blueprint.  Both options are very similar, but if the first corresponds to the native Spring configuration with additional named spaces for configuring services, the second is clearly defined by the Blueprint OSGi specification of the Service Platform Service Compendium.  In fact, there is a third option, backward compatible with Spring dm. <br>  For a more detailed study of the architecture, see the links at the end of the article. <br><br><h4>  Gemini Blueprint and OSGi usage example </h4><br><br>  As an example of use, we will write a GUI application with two implementations of services and one client.  This example will demonstrate how the use of Gemini Blueprint makes it easier to develop OSGi programs.  First, we do not need to use the OSGi API.  Secondly, the issue of dynamic services is solved independently by Gemini Blueprint, we only need to take care of the application logic.  Third, we will use the Spring Framework to build the application. <br><br>  The application is built using maven 3. The file structure of the project is as follows: <br><br><pre> blueprint example consumer‚îÄ‚îÄ consumer ‚îÇ ‚îú‚îÄ‚îÄ pom.xml ‚îÇ ‚îî‚îÄ‚îÄ src ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ main ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ java ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ blueprint ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ ConsumerFrame.java Consumer.java resh ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Consumer.java RefreshListener.java spring ‚îÇ resources‚îÄ‚îÄresource MET ‚îÇ ‚îÇ resources‚îÄ‚îÄ‚îÄResa Spring ‚îÇ MET Os‚îÄ‚îÄ osgi-context.xml spring ‚îÇ ‚îî‚îÄ‚îÄ spring-context.xml test ‚îî‚îÄ‚îÄ test ‚îÇ ‚îú‚îÄ‚îÄ java ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ ‚îú date-producer ‚îÇ ‚îú‚îÄ‚îÄ pom.xml ‚îÇ ‚îî‚îÄ‚îÄ src main ‚îú‚îÄ‚îÄ main ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ java blue ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ blueprint example ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄexample example ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ dateproducer MET‚îÄ‚îÄ META-INF spring ‚îÇ ‚îî‚îÄ‚îÄ spring ‚îÇ ‚îÇ ‚îú‚îÄ osgi-context.xml ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ spring-context.  xml test ‚îî‚îÄ‚îÄ test ‚îÇ ‚îú‚îÄ‚îÄ java ‚îÇ ‚îî‚îÄ‚îÄ resources ‚îú‚îÄ‚îÄ int-producer ‚îÇ ‚îú‚îÄ‚îÄ pom.xml ‚îÇ ‚îî‚îÄ‚îÄ src main ‚îú‚îÄ‚îÄ‚îÄ main ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ java ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ ‚îÄ blueprint ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ example int ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ intproducer resources ‚îÇ ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ ProducerImpl.java ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ resources ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ- osgi-context.xml spring ‚îÇ ‚îî‚îÄ‚îÄ spring-context.xml test ‚îî‚îÄ‚îÄ test ‚îÇ ‚îú‚îÄ‚îÄ java ‚îÇ ‚îî‚îÄ‚îÄ resources ‚îú‚îÄ‚îÄ pom.xml producer‚îÄ‚îÄ producer-api ‚îú‚îÄ‚îÄ pom.xml ‚îî‚îÄ Src main‚îÄ‚îÄ main ‚îÇ ‚îú‚îÄ‚îÄ java blue ‚îÇ ‚îî‚îÄ‚îÄblueprint producer ‚îÇ ‚îî‚îÄ‚îÄ example ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ producer ‚îÇ ‚îî‚îÄ‚îÄ api ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ Producer.java ‚îî‚îÄ‚îÄ resources ‚îÇ ‚îî ‚îÄ‚îÄ META-INF ‚îî‚îÄ‚îÄ test ‚îú‚îÄ‚îÄ java ‚îÄ‚îÄ resources </pre><br><br>  In the consumer, producer-api, date-producer and int-producer directories, the client projects, the service API, the implementation of services based on date and integer are respectively located.  Sounds confusing?  Do not worry, now we will sort everything out in order. <br><br>  Each of the listed projects is a separate module (bundle) for the OSGi-container.  The project producer-api contains only one file with the Producer interface.  This is a typical example of allocating an OSGi application API to a separate module that all modules that need it will import.  This module is not a blueprint module, because its purpose is only to provide the necessary classes. <br><br>  To build all the modules used maven-bundle-plugin.  This is a plug-in from the Apache Felix developers, which uses the <a href="http://www.aqute.biz/Bnd/Bnd">Bnd</a> utility (famous in OSGi circles).  This plugin is configured as follows: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.felix<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-bundle-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.3.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">instructions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span> ${name} ${version} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span> ${groupId}.${artifactId} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span> blueprint.example.producer.api <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import-Package</span></span></span><span class="hljs-tag">&gt;</span></span>*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import-Package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">instructions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The attentive reader should note that the names of the entries in the instructions section match the names of the specific headers for the OSGi-module metadata in META-INF / MANIFEST.MF.  This is what they are, not only in their natural form, but in the form of bnd instructions.  This utility is quite intelligent and can calculate dependencies by code and substitute them into the Import-Package section, as well as add various metadata.  Based on its configuration and calculations, it generates a MANIFEST.MF.  In this case, we define only the main headers. <br><br>  In order for the extender to recognize the module as a blueprint module, by default, the following rule is used: the module must have xml configuration files in the META-INF / spring directory, or the Spring-Context header indicating the location of the configuration must be present.  The projects listed above use two configuration files in the META-INF / spring directory.  The first with the prefix "osgi-" contains a blueprint-specific configuration.  The second one with the prefix "spring-" contains the usual configuration for the spring-application. <br>  Consider the implementation of services based on date and on the basis of an arbitrary integer: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProducerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Producer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">produceString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date().toString(); } } <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProducerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Producer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date().getTime()); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">produceString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.valueOf(random.nextInt()); } }</code> </pre><br>  The service in our training example is just a class with one method String produceString (), which returns an arbitrary string.  In the first case, the localized date, in the second line with an arbitrary integer.  In the spring configuration of these modules, the process of scanning annotated classes is specified.  The osgi configuration registers the service. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context:annotation-config</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context:component-scan</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base-package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blueprint.example"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.eclipse.org/gemini/blueprint/schema/blueprint"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:beans</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.eclipse.org/gemini/blueprint/schema/blueprint http://www.eclipse.org/gemini/blueprint/schema/blueprint/gemini-blueprint.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"producerService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"producerImpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blueprint.example.producer.api.Producer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here is the promised example of simplifying the life of a developer.  There is no need to use the OSGi API to register the service, you just need to fill in the xml configuration. <br><br>  It is time to consider the last module.  The client of our services displays a GUI form with a text display field and a value update button.  Let's take a look at the client code. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Consumer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ConsumerFrame consumerFrame; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Producer producer; <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ consumerFrame.setRefreshListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RefreshListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> producer.produceString(); } }); SwingUtilities.invokeLater( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ consumerFrame.setVisible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } } ); } }</code> </pre><br>  Consumer class is very simple.  It contains two attributes that are injected by the container.  This is a form object and a link to our service.  Further, in the method that is called after the construction of the object, a listener of the update event is registered with the service access code and the form display code on the screen.  The spring configuration of this project looks identical to the one presented above, and the osgi configuration looks like this: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.eclipse.org/gemini/blueprint/schema/blueprint"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:beans</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.eclipse.org/gemini/blueprint/schema/blueprint http://www.eclipse.org/gemini/blueprint/schema/blueprint/gemini-blueprint.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"producer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blueprint.example.producer.api.Producer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans:beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In this configuration, a link to the service is registered.  By default, this service is mandatory, and all calls to it, in its absence, will be blocked for a certain interval, after which an exception will occur.  This behavior is completely configurable. <br><br>  Programmers familiar with the Spring Framework probably had a question.  How does the link to the service ensure the dynamism of this service?  After all, all objects are configured at the download stage (eager), or at the appeal stage (lazy).  What will happen if the producer link is no longer relevant due to the disappearance of the service.  Answer: blueprint takes care of this.  In fact, a proxy object is injected into the service as a reference to the service, which serves the dynamism.  This object provides call blocking behavior as well as generating an exception. <br><br>  In the archive with the source code, in addition to it there is a directory with a configured equinox container and all the necessary libraries (equinox-for-example).  I think this will facilitate a quick start.  To start the container, you need to go to the directory with it and execute the command: <br><br><pre> java -jar org.eclipse.osgi_3.6.2.R36x_v20110210.jar -console
</pre><br>  After it, messages from initializing modules will appear on the screen.  And finally, the equinox command line prompt.  After entering the ss command, the output should be identical to the one shown below: <br><br><pre> osgi&gt; ss

 Framework is launched.

 id state bundle
 0 ACTIVE org.eclipse.osgi_3.6.2.R36x_v20110210
 1 ACTIVE com.springsource.net.sf.cglib_2.2.0
 2 ACTIVE com.springsource.org.aopalliance_1.0.0
 3 ACTIVE com.springsource.org.apache.log4j_1.2.16
 4 ACTIVE com.springsource.slf4j.api_1.6.1
                     Fragments = 5
 5 RESOLVED com.springsource.slf4j.log4j_1.6.1
                     Master = 4
 6 ACTIVE com.springsource.slf4j.org.apache.commons.logging_1.6.1
 7 ACTIVE org.eclipse.gemini.blueprint.core_1.0.0.RELEASE
 8 ACTIVE org.eclipse.gemini.blueprint.extender_1.0.0.RELEASE
 9 ACTIVE org.eclipse.gemini.blueprint.io_1.0.0.RELEASE
 10 ACTIVE org.springframework.aop_3.0.6.RELEASE
 11 ACTIVE org.springframework.asm_3.0.6.RELEASE
 12 ACTIVE org.springframework.aspects_3.0.6.RELEASE
 13 ACTIVE org.springframework.beans_3.0.6.RELEASE
 14 ACTIVE org.springframework.context_3.0.6.RELEASE
 15 ACTIVE org.springframework.context.support_3.0.6.RELEASE
 16 ACTIVE org.springframework.core_3.0.6.RELEASE
 17 ACTIVE org.springframework.expression_3.0.6.RELEASE
</pre><br>  This is a list of all the modules currently installed.  Now you need to install a test application.  To do this, call the install file command: /// path_to_jar_module_file for each of the 4 modules (you can assemble the modules with the maven-package command).  After that, run the start id command on the modules with the API, one of the services and the client.  The test application window should appear on the screen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/72202c92/aa9cb56a/54f05572/bcb4149d.png"></div><br>  Using date-producer <br><br>  Then stop the service module with the stop id command and start another service.  Refresh the window text field by clicking the refresh button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/2aa3ef8b/1e784583/acc22e72/862bb4c0.png"></div><br>  Using int-producer <br><br>  This completes the test case description.  I want to emphasize that this is only a small part of the capabilities of Gemini Blueprint. <br><br><h4>  Application area </h4><br><br>  OSGi has long been something more than a standard for modular systems for embedded technology.  In confirmation of the above, it is enough to give an example of such widespread OSGi-based projects like Eclipse and Glassfish.  The Spring Framework has a strong position in the corporate market.  What can the synergy of these technologies be used for?  The main area of ‚Äã‚Äãapplication of this bundle, according to the creators, was to be the area of ‚Äã‚Äãcorporate applications.  Actually this is a successful attempt to bring OSGi into the corporate world.  And now we have the opportunity to use OSGi in any corporate and application applications with the Spring Framework. <br><br><h4>  disadvantages </h4><br><br>  Despite the great advantages that a dynamic modular architecture offers, the bundle of Spring and OSGi has its drawbacks.  I think the most significant drawback is the relatively low prevalence of this ligament.  Of course, separately, these technologies do not cause doubts in their survivability, but the number of users using them together is not so great.  Subjectively, the process of transferring projects from SpringSource under the wing of the Eclipse Foundation has slowed their development.  The second drawback is the additional complexity that the use of this bundle adds to the project.  And this is not so much the complexity of using these technologies, as the complexity added by compatibility problems with third-party libraries, or rather the problems of using them in an OSGi container. <br><br><h4>  Projects associated with the use of Spring in the OSGi container </h4><br><ul><li>  Spring DM - a project designed to facilitate the use of Spring-applications in the OSGi-container.  Currently not developing (see Eclipse Gemini). </li><li>  Spring DM Server is a fully modular Java application server designed for running enterprise applications and Spring applications.  It has a high degree of flexibility and reliability.  Currently not developing (see Eclipse Virgo). </li><li>  Gemini Blueprint - heir to Spring DM.  The project allows you to run Spring-applications in the OSGi-container. </li><li>  Gemini Web is based on the reference implementation of the Web Applications specification from the OSGi Alliance.  A project for running Spring Web modules in an OSGi container. </li><li>  Gemini JPA is a modular implementation of the Java Persistence API for an OSGi container.  At the moment, it provides integration with JPA provider EclipseLink. </li><li>  Gemini DBAccess - provides distribution of JDBC drivers suitable for running in an OSGi container and mechanisms for using them. </li><li>  Gemini Management is a project for remote control of a modular system using JMX tools. </li><li>  Gemini Naming - JNDI support in OSGi-container. </li><li>  Eclipse Virgo - OSGi application server, inherited from Spring DM Server.  Supports the following types of deployment formats (deployment formats): OSGi modules (bundle), Java EE WAR, Web modules (Web bundles), PAR (similar to EAR for Java EE, contains component archives), Plan (configuration of several modules into a common application ), Configuration (mechanism for dynamic updating of the application configuration).  It contains a mechanism for hot deployment of applications, administration panel, additional libraries.  It can be delivered with two Tomcat and Jetty servlet-containers.  And also a lot of additional functionality. </li></ul><br><h4>  Conclusion </h4><br><br>  I conceived the article as an introductory acquaintance with the technology of sharing Spring and OSGi.  In order to fully describe all the information on the introductory part, I would need a much larger volume, so I suggest that the interested reader independently explore additional sources.  In addition, I will be happy to answer questions on this wonderful technology (within the limits of my competence). <br><br><h4>  Additional sources </h4><br><br>  <a href="">Archive with an example</a> <br>  <a href="http://eclipse.org/gemini/">Eclipse gemini</a> <br>  <a href="http://www.aqute.biz/Bnd/Bnd">Bnd</a> <br>  <a href="http://www.osgi.org/Specifications/HomePage">OSGi Specifications</a> <br>  <a href="http://www.springsource.org/about">Spring framework</a> <br>  <a href="http://www.springsource.org/osgi">Spring dynamic modules</a> <br>  <a href="http://blog.springsource.com/category/osgi/">OSGi SpringSource Blog</a> <br>  <a href="http://www.amazon.com/Spring-Dynamic-Modules-Action-Cogoluegnes/dp/1935182307/ref%3Dsr_1_1%3Fs%3Dbooks%26ie%3DUTF8%26qid%3D1316275180%26sr%3D1-1">Spring Dynamic Modules in Action</a> <br>  <a href="http://www.eclipse.org/virgo/">Eclipse virgo</a> <br></div><p>Source: <a href="https://habr.com/ru/post/128653/">https://habr.com/ru/post/128653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128645/index.html">Slim Template Designer - Haml Alternative</a></li>
<li><a href="../128646/index.html">WhoisMafia Annual Report</a></li>
<li><a href="../128649/index.html">Do you think a professional web designer should:</a></li>
<li><a href="../128650/index.html">ACID3 updated: IE9 + 100/100, Firefox 100/100</a></li>
<li><a href="../128652/index.html">PfSense 2.0 fork of FreeBSD for creating firewalls</a></li>
<li><a href="../128655/index.html">New CSS Editor Features in Visual Studio 11 Developer Preview</a></li>
<li><a href="../128656/index.html">Russian smart home</a></li>
<li><a href="../128657/index.html">Upgrade Wi-Fi chipsets will save up to 44% of battery charge</a></li>
<li><a href="../128658/index.html">For the help in eliminating vulnerabilities Chrome 14 corporation Google paid about 14 thousand dollars</a></li>
<li><a href="../128660/index.html">Hundreds of websites hosted by Go Daddy have been compromised.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>