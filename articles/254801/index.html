<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Volley custom Loader</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article outlines the approach of implementing Loader for loading different objects in one Activity. Volley is used as a network boot library. The ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Volley custom Loader</h1><div class="post__text post__text-html js-mediator-article">  The article outlines the approach of implementing Loader for loading different objects in one Activity.  Volley is used as a network boot library.  The method is suitable when there are several simultaneously used fragments in one Activity. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionBarActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoaderManager</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoaderCallbacks</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolder</span></span></span><span class="hljs-class">&gt;</span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoadFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Loader&lt;DataHolder&gt; loader, DataHolder data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( loader.getId() == DataLoader.LOADER_ICONS_ID ){ doIcons( data.getIcons() ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( loader.getId() == DataLoader.LOADER_STYLES_ID ){ doStyles( data.getStyles() ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( loader.getId() == DataLoader.LOADER_ICONSETS_ID ){ doIconSets( data.getIconSets() ); }</code> </pre> <br><br><a name="habracut"></a><br>  The main problem with using Fragment is that they ‚Äúlive their lives‚Äù (correct me if this is not the case).  Especially at the time of turning the screen.  Hence the constructor without parameters and static newInstance (..) <br><div class="spoiler">  <b class="spoiler_title">newInstance</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Returns a new instance of this fragment * */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IconsGridFragment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Icons icons)</span></span></span><span class="hljs-function"> </span></span>{ IconsGridFragment fragment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IconsGridFragment(); Bundle args = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); args.putParcelable(ARG_ICONS, icons); fragment.setArguments(args); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fragment; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IconsGridFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre><br></div></div><br>  <i>All subclasses of Fragment must include a public no-argument constructor.</i>  <i>It is often necessary to establish the framework.</i>  <i>If a no-argument constructor is not available, a runtime exception will occur during the state restore.</i> <i><br></i> <br>  Therefore, using asynchronous loading with the help of Retrofit or Volley cannot be one hundred percent sure when returning from a callback in what state of Activity and Fragment.  There are internal states for the FragmentManager that can be checked, but this is a bad approach.  For example: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Resolved After Loader implementation if( !fragmentManager.isDestroyed() ) { // Check problem after rotation screen</span></span></code> </pre><br><br>  Therefore, it was decided to write your own Loader.  Feed for the test was chosen <a href="http://iconfinder.com/">Iconfinder</a> .  I will say that feed is not always given on request without errors. <br>  <i>E / Volley Ôπï [979] BasicNetwork.performRequest: Unexpected response code 429 for https ...</i> <br>  For example, you can make about 100 requests, and then an error will return.  There was an attempt to write to the support service, but there was no answer.  After ~ 5 seconds, the error disappears and normal requests are resumed. <br><br>  Answered from Iconfinder: <i>The 429 status code means you're making too many requests: <a href="https://developer.iconfinder.com/api/2.0/overview.html">developer.iconfinder.com/api/2.0/overview.html#rate-limiting</a></i> <br>  You could have guessed it yourself.  On this occasion, made a pop-up window with animation, all the same through the fragment.  Close the window and reset the boot flag after 5 seconds.  A postponement message to close is called immediately after committing ft.commit ().  According to the correct, it would be necessary to call up a fragment joining event.  Callback from onAttach for example. <br><div class="spoiler">  <b class="spoiler_title">OverlayMessageFragment using</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeOverlayDelay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Handler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(); handler.postDelayed(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ closeOverlayFragment(); <span class="hljs-comment"><span class="hljs-comment">// Reset flag fo continue load after error gone Fragment fragment = getSupportFragmentManager(). findFragmentByTag(IconsGridFragment.class.getSimpleName()); if (fragment != null) ((IconsGridFragment)fragment).resetLoadingFlag(); } }, 5000); } @Override public void onLoadFinished(final Loader&lt;DataHolder&gt; loader, final DataHolder data) { VolleyError volleyError = data.getError(); if (volleyError != null) { if (DEBUG) Log.e(TAG, "volleyError message: " + volleyError.getMessage()); NetworkResponse networkResponse = volleyError.networkResponse; if (networkResponse != null &amp;&amp; networkResponse.statusCode == 429) { // HTTP Status Code: 429 if (DEBUG) Log.e(TAG, "volleyError statusCode: " + networkResponse.statusCode); new Handler(Looper.getMainLooper()).post(new Runnable() { @Override public void run() { Fragment fragment = getSupportFragmentManager(). findFragmentByTag(OverlayMessageFragment.class.getSimpleName()); if(fragment == null) { Fragment overlayMessageFragment = OverlayMessageFragment.newInstance("Server Error 429. Too many requests. Try later"); FragmentTransaction ft = getSupportFragmentManager().beginTransaction(); ft.setCustomAnimations(R.anim.enter, R.anim.exit, R.anim.pop_enter, R.anim.pop_exit); ft.add(R.id.container, overlayMessageFragment, OverlayMessageFragment.class.getSimpleName()); ft.commit(); closeOverlayDelay(); } } }); return; } return; } ...</span></span></code> </pre><br></div></div><br><br>  The project itself is available on github <a href="https://github.com/app-z/Iconfinder">Android Iconfinder demo</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/875/100/d5d/875100d5d646ef1024f63c81fc99c420.png" alt="App-z.net"><br><br>  Loader looks like this: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Loader</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ARGS_URL = <span class="hljs-string"><span class="hljs-string">"url"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String urlFeed; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RequestQueue requestQueue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DataHolder dataHolder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataHolder(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LOADER_ICONS_ID = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LOADER_STYLES_ID = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LOADER_ICONSETS_ID = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataLoader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); urlFeed = bundle.getString(ARGS_URL); requestQueue = Volley.newRequestQueue(context); <span class="hljs-comment"><span class="hljs-comment">// run only once onContentChanged(); } @Override protected void onStartLoading() { if (takeContentChanged()) forceLoad(); } @Override protected void onStopLoading() { requestQueue.cancelAll(this); super.onStopLoading(); } @Override protected void onReset() { requestQueue.cancelAll(this); super.onReset(); } @Override public void onForceLoad() { super.onForceLoad(); if( getId() == LOADER_STYLES_ID ) doStylesRequest(); else if ( getId() == LOADER_ICONS_ID ) doIconsRequest(); else if ( getId() == LOADER_ICONSETS_ID ) doIconsetsRequest(); } private void doIconsetsRequest() { final GsonRequest gsonRequest = new GsonRequest(urlFeed, Iconsets.class, null, new Response.Listener&lt;Iconsets&gt;() { @Override public void onResponse(Iconsets iconsets) { dataHolder.setIconsets(iconsets); deliverResult(dataHolder); } ... } void doStylesRequest(){ ... } void doIconsRequest(){ ... } }</span></span></code> </pre><br><br>  There is a moment.  Returning data immediately from Volley‚Äôs callback will not work or, better to say, create a DataHolder for deliverResult on the fly, so you need a member of the DataHolder class in which the object references <br>  Do not forget about requestQueue.cancelAll (this);  when loader interrupts <br>  Also for Volley made a small wrapper GsonRequest <br><br>  But that's not all.  After calling onLoadFinished, Fragment will not immediately start.  Additional implementation via Handler will be required.  On stackoverflow, they write about a bug and offer exactly this solution: <br><div class="spoiler">  <b class="spoiler_title">Handler</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ICONS_HANDLER = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> STILES_HANDLER = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ICONSETS_HANDLER = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLoadFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Loader&lt;DataHolder&gt; loader, DataHolder data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">// In Loader happened error AppUtils.showDialog(MainActivity.this, "Error", "Server request error. Try again later", false); return; } Message msg = mHandler.obtainMessage(); Bundle b = new Bundle(); if(loader.getId() == DataLoader.LOADER_ICONS_ID){ offset += count; // Prepare for next lazy load b.putParcelable("Icons", data.getIcons()); msg.what = ICONS_HANDLER; } else if(loader.getId() == DataLoader.LOADER_STYLES_ID){ b.putParcelable("Styles", data.getStyles()); msg.what = STILES_HANDLER; } else if(loader.getId() == DataLoader.LOADER_ICONSETS_ID){ b.putParcelable("IconSets", data.getIconSets()); msg.what = ICONSETS_HANDLER; } msg.setData(b); mHandler.sendMessage(msg); } final Handler mHandler = new Handler(){ public void handleMessage(Message msg) { Bundle b; b=msg.getData(); if(msg.what == ICONS_HANDLER){ Icons icons = b.getParcelable("Icons"); fillIcons(icons); } else if(msg.what == STILES_HANDLER){ Styles styles = b.getParcelable("Styles"); fillStyles(styles); } else if(msg.what == ICONSETS_HANDLER){ Iconsets iconSets = b.getParcelable("IconSets"); fillIconSets(iconSets); } super.handleMessage(msg); } };</span></span></code> </pre><br></div></div><br>  It remains to add himself Fragment in BackStack.  Moreover, we first check whether it has already been created, and if it has been created, simply add icons to the Adapter.  Thus, a semblance of pagination is implemented, or as I called LazyLoadMore.  Loading icons and feed in the background <br><div class="spoiler">  <b class="spoiler_title">addToBackStack</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillIcons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Icons icons)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Resolved After Loader implementation //if(!fragmentManager.isDestroyed()) { // Check problem after rotation screen FragmentManager fragmentManager = getSupportFragmentManager(); Fragment iconsGridFragment = fragmentManager.findFragmentByTag(IconsGridFragment.class.getSimpleName()); if (iconsGridFragment != null) { ((IconsGridFragment) iconsGridFragment).addIcons(icons); } else { iconsGridFragment = IconsGridFragment.newInstance(icons); // Add the fragment to the activity, pushing this transaction on to the back stack. FragmentTransaction ft = fragmentManager.beginTransaction(); ft.replace(R.id.container, iconsGridFragment, IconsGridFragment.class.getSimpleName()); ft.setTransition(FragmentTransaction.TRANSIT_FRAGMENT_OPEN); ft.addToBackStack(null); ft.commit(); } }</span></span></code> </pre><br></div></div><br>  In MainActivity.onStop () we interrupt all downloads: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroyLoaders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ mHandler.removeCallbacksAndMessages(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Because using Fix ! LoaderManager loaderManager = getSupportLoaderManager(); loaderManager.destroyLoader(DataLoader.LOADER_ICONS_ID); loaderManager.destroyLoader(DataLoader.LOADER_ICONSETS_ID); loaderManager.destroyLoader(DataLoader.LOADER_STYLES_ID); } @Override protected void onStop () { super.onStop(); destroyLoaders(); ...</span></span></code> </pre><br><br>  All methods for loading the same type.  The next step is to implement a generic generic query method using <pre> <code class="java hljs">Class&lt;T&gt; clazz;</code> </pre> <br>  It looks like this: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onForceLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onForceLoad(); doRequest(DataHolder.getClazz(getId())); }</code> </pre><br>  Classes in a DataHolder must be implements DataHolderItem <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Icons</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parcelable</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolder</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolderItem</span></span></span></span>{</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Dataloader</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Created by App-z.net on 02.04.15. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Loader</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> DEBUG = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"DataLoader&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ARGS_URL = <span class="hljs-string"><span class="hljs-string">"url"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String urlFeed; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RequestQueue requestQueue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DataHolder dataHolder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataHolder(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataLoader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); urlFeed = bundle.getString(ARGS_URL); requestQueue = Volley.newRequestQueue(context); <span class="hljs-comment"><span class="hljs-comment">// run only once onContentChanged(); } @Override protected void onStartLoading() { if (takeContentChanged()) forceLoad(); } @Override protected void onStopLoading() { if ( DEBUG ) Log.i(TAG, "Loader onStopLoading()"); requestQueue.cancelAll(this); super.onStopLoading(); } @Override protected void onReset() { if ( DEBUG ) Log.i(TAG, "Loader onReset()"); requestQueue.cancelAll(this); super.onReset(); } @Override public void onForceLoad() { super.onForceLoad(); if ( DEBUG ) Log.d(TAG, "Loader onForceLoad() : feedUrl = " + urlFeed); doRequest(DataHolder.getClazz(getId())); } /** * * Get Data */ private void doRequest(Class&lt;?&gt; clazz) { final GsonRequest gsonRequest = new GsonRequest(urlFeed, clazz, null, new Response.Listener&lt;DataHolder.DataHolderItem&gt;() { @Override public void onResponse(DataHolder.DataHolderItem data) { dataHolder.setData(getId(), data); deliverResult(dataHolder); } }, new Response.ErrorListener() { @Override public void onErrorResponse(VolleyError volleyError) { if (volleyError != null) if (DEBUG) Log.e(TAG, "volleyError: " + volleyError.getMessage()); deliverResult(null); } }); requestQueue.add(gsonRequest); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">DataHolder</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Created by App-z.net on 02.04.15. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LOADER_ICONS_ID = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LOADER_STYLES_ID = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LOADER_ICONSETS_ID = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Styles styles; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Icons icons; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Iconsets iconsets; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Styles </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStyles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> styles; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStyles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Styles styles)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.styles = styles; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Iconsets </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIconsets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> iconsets; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIconsets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iconsets iconsets)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.iconsets = iconsets; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Icons </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIcons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> icons; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setIcons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Icons icons)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.icons = icons; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataId, DataHolderItem item)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (dataId){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_ICONS_ID: setIcons((Icons)item); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_STYLES_ID: setStyles((Styles)item); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_ICONSETS_ID: setIconsets((Iconsets)item); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> : <span class="hljs-string"><span class="hljs-string">"Error LOADER ID"</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DataHolderItem </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dataId)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (dataId){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_ICONS_ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getIcons(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_STYLES_ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getStyles(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_ICONSETS_ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getIconsets(); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> : <span class="hljs-string"><span class="hljs-string">"Error LOADER ID"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Class&lt;?&gt; getClazz(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dataId){ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (dataId){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_ICONS_ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Icons.class; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_STYLES_ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Styles.class; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LOADER_ICONSETS_ID: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Iconsets.class; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> : <span class="hljs-string"><span class="hljs-string">"Error LOADER ID"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataHolderItem</span></span></span></span>{ } }</code> </pre><br></div></div><br>  Again, the full implementation of the project is available on github <a href="https://github.com/app-z/Iconfinder">Android Iconfinder demo</a> .  Api iconfinder <a href="https://developer.iconfinder.com/api/2.0/index.html">Api 2.0</a> <br><br>  Thus, an application with one Activity and a ‚Äúsandwich‚Äù from Fragments with the correct screen rotation turned out <br><br>  Bibliography: <br>  <a href="http://developer.android.com/reference/android/content/Loader.html">Loader</a> <br>  <a href="http://developer.android.com/reference/android/app/Fragment.html">Fragment</a> <br>  <a href="http://www.androiddesignpatterns.com/2012/08/implementing-loaders.html">Implementing Loaders</a> </div><p>Source: <a href="https://habr.com/ru/post/254801/">https://habr.com/ru/post/254801/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254791/index.html">Aspect-oriented programming. The basics</a></li>
<li><a href="../254793/index.html">Two worlds of virtual machines</a></li>
<li><a href="../254795/index.html">Worst API ever created</a></li>
<li><a href="../254797/index.html">The taste and color or coloring for Android</a></li>
<li><a href="../254799/index.html">Development of MMO RPG - a practical guide. Episode 1</a></li>
<li><a href="../254803/index.html">About interfaces</a></li>
<li><a href="../254805/index.html">Import data from YouTube and Vimeo to Google.Docs</a></li>
<li><a href="../254811/index.html">Updated Windows VPS from Infobox with triple data replication and Enterprise SSD caching. We test disk performance</a></li>
<li><a href="../254813/index.html">Getting the path to the SD Card on Android</a></li>
<li><a href="../254823/index.html">When robots "soar in the clouds": The five components of cloud robotics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>