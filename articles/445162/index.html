<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Terraform provider selectel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We launched the official Terraform-provider to work with Selectel. This product allows users to fully implement resource management through the Infras...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Terraform provider selectel</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/yf/si/pf/yfsipfz7j0lfweuvzxwwqzqr94a.png"><br><br>  We launched the official Terraform-provider to work with Selectel.  This product allows users to fully implement resource management through the Infrastructure-as-code methodology (infrastructure as code). <br><a name="habracut"></a><br>  Currently, the provider supports the management of <a href="https://selectel.ru/services/cloud/vpc/%3Futm_source%3Dhabr.com%26utm_medium%3Dreferral%26utm_campaign%3DVPC_Terraform_NewFeature_200319" rel="noopener noreferrer">Virtual Private Cloud</a> service resources (hereinafter referred to as VPC).  In the future, we plan to add to it the management of the resources of other services provided by Selectel. <br><br>  As you already know, the VPC service is based on OpenStack.  However, due to the fact that OpenStack does not provide native tools for maintaining the public cloud, we have implemented the missing functionality in a set of additional APIs that simplify the management of complex composite objects and make the operation more convenient.  Some of the functionality available in OpenStack is not directly usable, but is available through <a href="https://kb.selectel.ru/24381209.html" rel="noopener noreferrer">our API</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Terraform-provider Selectel now has the ability to manage the following VPC resources: <br><br><ul><li>  projects and their quotas; </li><li>  users, their roles and tokens; </li><li>  public subnetworks, including cross-regional and VRRP; </li><li>  software licenses. </li></ul><br>  The provider uses our public Go library to work with the VPC API.  Both the library and the provider itself are open-source, they are being developed on Github: <br><br><ul><li>  <a href="https://github.com/selectel/go-selvpcclient/" rel="noopener noreferrer">Go-selvpcclient</a> library repository </li><li>  provider repository <a href="https://github.com/terraform-providers/terraform-provider-selectel" rel="noopener noreferrer">Terraform-provider Selectel</a> . </li></ul><br>  You can use Terraform-provider OpenStack to manage other cloud resources, such as virtual machines, disks, Kubernetes clusters.  Official documentation for both providers is available at the following links: <br><br><ul><li>  documentation of Selectel resources: <a href="https://www.terraform.io/docs/providers/selectel/" rel="noopener noreferrer">Terraform-provider Selectel</a> , </li><li>  OpenStack resource documentation: <a href="https://www.terraform.io/docs/providers/openstack" rel="nofollow noopener noreferrer">Terraform-provider OpenStack</a> . </li></ul><br><h2>  Beginning of work </h2><br>  To get started, you must install Terraform (instructions and links to installation packages can be viewed on the <a href="https://www.terraform.io/downloads.html" rel="nofollow noopener noreferrer">official website</a> ). <br><br>  To work, the provider requires the Selectel API key that is created in <a href="https://my.selectel.ru/profile/apikeys" rel="noopener noreferrer">the control panel for the account</a> . <br><br>  Manifestos for working with Selectel are created using Terraform or using a set of ready-made examples that are available in our Github repository: <a href="https://github.com/selectel/terraform-examples" rel="noopener noreferrer">terraform-examples</a> . <br><br>  The repository with examples is divided into two directories: <br><br><ul><li>  <strong>modules</strong> , containing small reusable modules that take as input a set of parameters and manage a small set of resources; </li><li>  <strong>examples</strong> , containing examples of a complete set of interconnected modules. </li></ul><br>  After installing Terraform, creating the Selectel API key, and familiarizing yourself with the examples, proceed to the practical examples. <br><br><h2>  An example of creating a server with a local disk </h2><br>  Consider an example of creating a project, a user with a role and a virtual machine with a local disk: <a href="https://github.com/selectel/terraform-examples/tree/master/examples/vpc/server_local_root_disk" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> . <br><br>  The <strong>vars.tf</strong> file describes all the parameters that will be used when calling modules.  Some of them have default values, for example, a server will be created in the <strong>ru-3a</strong> zone with the following configuration: <br><br><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"server_vcpus"</span></span> { default = 4 } variable <span class="hljs-string"><span class="hljs-string">"server_ram_mb"</span></span> { default = 8192 } variable <span class="hljs-string"><span class="hljs-string">"server_root_disk_gb"</span></span> { default = 8 } variable <span class="hljs-string"><span class="hljs-string">"server_image_name"</span></span> { default = <span class="hljs-string"><span class="hljs-string">"Ubuntu 18.04 LTS 64-bit"</span></span> }</code> </pre> <br>  The <b>main.tf</b> file initializes the Selectel provider: <br><br><pre> <code class="bash hljs">provider <span class="hljs-string"><span class="hljs-string">"selectel"</span></span> { token = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.sel_token}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Also in this file is the default value for the SSH key that will be installed on the server: <br><br><pre> <code class="bash hljs">module <span class="hljs-string"><span class="hljs-string">"server_local_root_disk"</span></span> { ... server_ssh_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file("~/.ssh/id_rsa.pub")}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  If necessary, you can specify a different public key.  The key does not have to be specified in the form of a file path, you can also add a value as a string. <br><br>  Next, in this file, the <strong>project_with_user</strong> and <strong>server_local_root_disk</strong> modules are run, which manage the necessary resources. <br><br>  Let us consider these modules in more detail. <br><br><h3>  Creating a project and a user with a role </h3><br>  The first module creates a project and a user with a role in this project: <a href="https://github.com/selectel/terraform-examples/tree/master/modules/vpc/project_with_user" rel="noopener noreferrer">terraform-examples / modules / vpc / project_with_user</a> . <br><br>  The created user will be able to log in to OpenStack and manage its resources.  The module is simple and manages all three entities: <br><br><ul><li>  selectel_vpc_project_v2, </li><li>  selectel_vpc_user_v2, </li><li>  selectel_vpc_role_v2. </li></ul><br><h3>  Creating a virtual server with a local disk </h3><br>  The second module deals with the management of OpenStack objects, which are necessary to create a server with a local disk. <br><br>  Attention should be paid to some of the arguments that are specified in this module for the <strong>openstack_compute_instance_v2</strong> resource: <br><br><pre> <code class="bash hljs">resource <span class="hljs-string"><span class="hljs-string">"openstack_compute_instance_v2"</span></span> <span class="hljs-string"><span class="hljs-string">"instance_1"</span></span> { ... lifecycle { ignore_changes = [<span class="hljs-string"><span class="hljs-string">"image_id"</span></span>] } vendor_options { ignore_resize_confirmation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  The <strong>ignore_changes</strong> argument ignores the change in the <strong>id</strong> attribute for the image used to create the virtual machine.  In the VPC service, most public images are updated automatically once a week, and their <strong>id</strong> also changes.  This is due to the peculiarities of the OpenStack - Glance component, in which the images are considered to be immutable entities. <br><br>  If an existing server or disk is created or modified and the public image <strong>id is</strong> used as the <strong>image_id</strong> argument, then after this image is updated, the Terraform manifest rerun will restart the server or disk.  Using the <strong>ignore_changes</strong> argument avoids this situation. <br><br>  <em>Note: the</em> <strong><em>ignore_changes</em></strong> <em>argument</em> <em>appeared in Terraform a long time ago:</em> <a href="https://github.com/hashicorp/terraform/pull/2525" rel="noopener noreferrer">pull # 2525</a> <em>.</em> <br><br>  The <strong>ignore_resize_confirmation</strong> argument <strong>is</strong> needed to successfully resize the local disk, cores, or server memory.  Such changes are made through the OpenStack Nova component using the <b>resize</b> request.  By default, Nova, after a <b>resize</b> request, <b>places the</b> server in the <b>verify_resize</b> status and waits for the user to confirm.  However, this behavior can be changed so that Nova does not wait for additional actions from the user. <br><br>  The specified argument allows Terraform not to wait for the <b>verify_resize</b> status for the server and to be ready for the server to be in active status after changing its parameters.  The argument is available from version 1.10.0 of the Terraform provider OpenStack: <a href="https://github.com/terraform-providers/terraform-provider-openstack/pull/422" rel="noopener noreferrer">pull # 422</a> . <br><br><h3>  Resource creation </h3><br>  Before launching the manifests, it should be noted that in our example two different providers are launched, and the OpenStack provider depends on the resources of the Selectel provider, because without creating a user in a project it is impossible to manage objects belonging to him.  Unfortunately, for the same reason, we cannot just run the <strong>terraform apply command</strong> inside our example.  We need to first <strong>apply</strong> for the <strong>project_with_user</strong> module and after that for everything else. <br><br>  <em>Note: this problem has not yet been resolved in Terraform, you can follow its discussion on Github in <a href="https://github.com/hashicorp/terraform/issues/2430" rel="noopener noreferrer">issue # 2430</a> and <a href="https://github.com/hashicorp/terraform/issues/4149%2520target%3D" rel="noopener noreferrer">issue # 4149</a> .</em> <br><br>  To create resources, go to the directory <a href="https://github.com/selectel/terraform-examples/tree/master/examples/vpc/server_local_root_disk" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> , its contents should be like this: <br><br><pre> <code class="bash hljs">$ ls README.md main.tf vars.tf</code> </pre><br>  We initialize the modules with the command: <br><br><pre> <code class="bash hljs">$ terraform init</code> </pre><br>  The output shows that Terraform downloads the latest versions of the providers used and checks all the modules described in the example. <br><br>  First, we apply the <strong>project_with_user</strong> module.  In this case, it is required to manually transfer the values ‚Äã‚Äãfor variables that have not been set: <br><br><ul><li>  <strong>sel_account</strong> with your Selectel account number; </li><li>  <strong>sel_token</strong> with your key for the Selectel API; </li><li>  <strong>user_password</strong> with a password for an OpenStack user. </li></ul><br>  The values ‚Äã‚Äãfor the first two variables should be taken from <a href="https://my.selectel.ru/profile/apikeys/%3Futm_source%3Dblog_selectel_ru%26amp%3Butm_medium%3Dinner_referral" rel="noopener noreferrer">the control panel</a> . <br><br>  For the last variable, you can think of any password. <br><br>  To use the module, you must replace the values <strong>SEL_ACCOUNT</strong> , <strong>SEL_TOKEN</strong> and <strong>USER_PASSWORD by</strong> running the command: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user</code> </pre><br>  After launching the command, Terraform will show you what resources it wants to create and will require confirmation: <br><br><pre> <code class="bash hljs">Plan: 3 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to approve. Enter a value: yes</code> </pre><br>  Once the project, user and role are created, you can start creating the remaining resources: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  When creating resources, pay attention to the Terraform output with an external IP address where the created server will be available: <br><br><pre> <code class="bash hljs">module.server_local_root_disk.openstack_networking_floatingip_associate_v2.association_1: Creating... floating_ip: <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span></code> </pre><br>  You can work with the created virtual machine via SSH using the specified IP. <br><br><h3>  Editing Resources </h3><br>  In addition to creating resources through Terraform, they can also be modified. <br><br>  For example, let's increase the number of cores and memory for our server by changing the values ‚Äã‚Äãfor the <strong>server_vcpus</strong> and <strong>server_ram_mb parameters</strong> in the file <strong>examples / vpc / server_local_root_disk / main.tf</strong> : <br><br><pre> <code class="bash hljs">- server_vcpus = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_vcpus}</span></span></span><span class="hljs-string">"</span></span> - server_ram_mb = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_ram_mb}</span></span></span><span class="hljs-string">"</span></span> + server_vcpus = 8 + server_ram_mb = 10240</code> </pre><br>  After this, we check how it will lead to changes with the help of the following command: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform plan</code> </pre><br>  As a result, Terraform made a change to the <strong>openstack_compute_instance_v2</strong> and <strong>openstack_compute_flavor_v2 resources</strong> . <br><br>  <em>Please note that this will result in a reboot of the created virtual machine.</em> <br><br>  To apply the new virtual machine configuration, use the <strong>terraform apply command</strong> , which we already launched earlier. <br><br>  All created objects will be displayed in <a href="https://my.selectel.ru/vpc/projects/" rel="noopener noreferrer">the VPC control panel</a> : <br><br><img src="https://habrastorage.org/webt/eq/e5/3a/eqe53anrxqpnpd6qn7hlcrnuxec.png"><br><br>  In our <a href="https://github.com/selectel/terraform-examples" rel="noopener noreferrer">examples repository,</a> you can also see the manifests for creating virtual machines with network drives. <br><br><h2>  Kubernetes cluster creation example </h2><br>  Before proceeding to the next example, we will clear the previously created resources.  To do this, in the root of the <a href="https://github.com/selectel/terraform-examples/tree/master/examples/vpc/server_local_root_disk" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk project,</a> run the command to delete OpenStack objects: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.server_local_root_disk</code> </pre><br>  Then run the command to clean the objects Selectel VPC API: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.project_with_user</code> </pre><br>  In both cases, you will need to confirm the deletion of all objects: <br><br><pre> <code class="bash hljs">Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to confirm. Enter a value: yes</code> </pre><br>  The following example is in the directory <a href="https://github.com/selectel/terraform-examples/tree/master/examples/vpc/kubernetes_cluster" rel="noopener noreferrer">terraform-examples / examples / vpc / kubernetes_cluster</a> . <br><br>  This example creates a project, a user with a role in the project, and raises one cluster Kubernetes.  In the <strong>vars.tf</strong> file, <strong>you</strong> can see the default values, such as the number of nodes, their characteristics, the version of Kubernetes, and so on. <br><br>  To create resources similar to the first example, first of all we will start initializing the modules and creating resources for the <strong>project_with_user</strong> module, and then creating the rest: <br><br><pre> <code class="bash hljs">$ terraform init $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Let's transfer creation and management of Kubernetes clusters through the OpenStack Magnum component.  You can learn more about how to work with a cluster in one of our <a href="https://blog.selectel.ru/klastery-kubernetes-v-vpc/" rel="noopener noreferrer">previous articles</a> , as well as in <a href="https://kb.selectel.ru/42078178.html" rel="noopener noreferrer">the knowledge base</a> . <br><br>  When preparing the cluster, disks, virtual machines will be created and all necessary components will be installed.  Preparation takes about 4 minutes, at this time Terraform will display messages like this: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Still creating... (3m0s elapsed)</code> </pre><br>  After the installation is complete, Terraform will notify you that the cluster is ready and display its identifier: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Creation complete after 4m20s (ID: 3c8...) Apply complete! Resources: 6 added, 0 changed, 0 destroyed.</code> </pre><br>  To manage the Kubernetes cluster created through the kubectl utility, <strong>you</strong> must obtain a cluster access file.  To do this, go to the project created through Terraform in the list of projects of your account: <br><br><img src="https://habrastorage.org/webt/pp/7y/rt/pp7yrtw_q-79pkx1j6mr5ebbsyi.png"><br><br>  Next, go to the link like <a href="https://xxxxxx.selvpc.ru/">xxxxxx.selvpc.ru</a> , which is displayed below the project name: <br><br><img src="https://habrastorage.org/webt/yr/in/wk/yrinwkfne83cenropq9t3szxt6c.png"><br><br>  For login information, use the username and password of the user that was created through the Terraform.  If you have not changed <strong>vars.tf</strong> or <strong>main.tf</strong> for our example, the user will have the name <strong>tf_user</strong> .  As a password, you need to use the value of the variable <strong>TF_VAR_user_password</strong> , which was specified when you run <strong>terraform apply</strong> earlier. <br><br>  Inside the project, you need to go to the <strong>Kubernetes</strong> tab: <br><br><img src="https://habrastorage.org/webt/ft/bp/dj/ftbpdjhjrgxkgzomuxegaujj3wu.png"><br><br>  Here is a cluster created through Terraform.  Download file for <strong>kubectl</strong> can be on the tab "Access": <br><br><img src="https://habrastorage.org/webt/y_/pe/ov/y_peovkv0kjznzx95c_vw4wc-4e.png"><br><br>  On the same tab is the installation instructions for <strong>kubectl</strong> and the use of the downloaded <strong>config.yaml</strong> . <br><br>  After running <strong>kubectl</strong> and setting the <strong>KUBECONFIG</strong> environment <strong>variable,</strong> you can use Kubernetes: <br><br><pre> <code class="bash hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-9578f5c87-g6bjf 1/1 Running 0 8m kube-system coredns-9578f5c87-rvkgd 1/1 Running 0 6m kube-system heapster-866fcbc879-b6998 1/1 Running 0 8m kube-system kube-dns-autoscaler-689688988f-8cxhf 1/1 Running 0 8m kube-system kubernetes-dashboard-7bdb5d4cd7-jcjq9 1/1 Running 0 8m kube-system monitoring-grafana-84c97bb64d-tc64b 1/1 Running 0 8m kube-system monitoring-influxdb-7c8ccc75c6-dzk5f 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-0 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-1 1/1 Running 0 8m kube-system openstack-cloud-controller-manager-8vrmp 1/1 Running 3 8m prometeus-monitoring grafana-76bcb7ffb8-4tm7t 1/1 Running 0 8m prometeus-monitoring prometheus-75cdd77c5c-w29gb 1/1 Running 0 8m</code> </pre><br>  The number of nodes in the cluster is easily changed through Terraform. <br>  The <strong>main</strong> value in the <strong>main.tf</strong> file is: <br><br><pre> <code class="bash hljs">cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><p>  This value is substituted from <strong>vars.tf</strong> : </p><br><br><pre> <code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"cluster_node_count"</span></span> { default = 2 }</code> </pre><br>  You can change either the default value in <strong>vars.tf</strong> , or specify the required value directly in <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">- cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span> + cluster_node_count = 3</code> </pre><br>  To apply changes, as in the case of the first example, use the <strong>terraform apply command</strong> : <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  When the number of nodes changes, the cluster will remain available.  After adding a node through Terraform, you can use it without additional configuration: <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS ROLES AGE VERSION tf-cluster-rz6nggvs4va7-master-0 Ready,SchedulingDisabled master 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-0 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-1 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-2 Ready &lt;none&gt; 3m v1.12.4</code> </pre><br><h2>  Conclusion </h2><br>  In this article, we learned about the main ways to work with <a href="https://selectel.ru/services/cloud/vpc/%3Futm_source%3Dhabr.com%26utm_medium%3Dreferral%26utm_campaign%3DVPC_Terraform_NewFeature_2003199" rel="noopener noreferrer">the Virtual Private Cloud</a> through Terraform.  We will be glad if you use the official Terraform-provider Selectel and provide feedback. <br><br>  All bugs found by Terraform provider Selectel can be reported via <a href="https://github.com/terraform-providers/terraform-provider-selectel/issues" rel="noopener noreferrer">Github Issues</a> . </div><p>Source: <a href="https://habr.com/ru/post/445162/">https://habr.com/ru/post/445162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445152/index.html">What else can be done in the search? Yandex report</a></li>
<li><a href="../445154/index.html">Digital events in Moscow from March 25 to March 31</a></li>
<li><a href="../445156/index.html">Compact nebulizer Glenmark: useful thing in everyday life</a></li>
<li><a href="../445158/index.html">Optimum part orientation and support configuration in a 3D printer</a></li>
<li><a href="../445160/index.html">We develop pedal firmware for learning to play the balalaika</a></li>
<li><a href="../445164/index.html">Balanced site indicators. Part 5: Usability</a></li>
<li><a href="../445166/index.html">Everything you need to know about automatic hyping in CSS</a></li>
<li><a href="../445168/index.html">Perfect resume to be welcomed by a recruiter and an employer</a></li>
<li><a href="../445170/index.html">Three Big Lies about JavaScript</a></li>
<li><a href="../445172/index.html">Edge Browser with Chromium appeared on file hosting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>