<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asterisk on Mikrotik</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wondered about the idea to raise a voip on mikrotik. Who remembers, in older versions of the routeros there was a module for voip, then it was cut o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asterisk on Mikrotik</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/8f7/8f5/486/8f78f548649ac5457f62e414c60ebe0f.png" alt="image"><br><br>  I wondered about the idea to raise a voip on mikrotik.  Who remembers, in older versions of the routeros there was a module for voip, then it was cut out, which is a pity.  It is no longer possible to raise an asterisk on the routeros, however there is an opportunity to raise a virtual router with openwrt in the metarouter mode, from here we will proceed. <br><br>  Long searches led me to the <a href="http://openwrt.wk.cz/">openwrt.wk.cz</a> website (available only via ipv6), from where the openwrt image for mt-mips was downloaded.  All experiments conducted on the 2011UAS-2HnD.  Since not everyone has ipv6, I made a mirror for installing packages from it ( <a href="http://ms1.nserver.us/openwrt.wk.cz/">ms1.nserver.us/openwrt.wk.cz</a> .), Where the necessary packages lie.  By the way, during the search, it was not possible to find a full-fledged article on this topic, not only in Russian, but also in any other. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  So, download the image for mips ( <a href="">openwrt-mr-mips-rootfs.tar.gz</a> ) or for ppc ( <a href="">openwrt-mr-ppc-rootfs.tar.gz</a> ).  Fill the image in our mikrotik, in Files, go to MetaROUTER and do the import of the image.  I allocated 48 meters of memory and 24 meters of hdd, yes ... yes ... do not be surprised ... an asterisk will work on such hardware, tested, created trunks and made calls without problems. <br><br><img src="https://habrastorage.org/storage2/1c5/c30/30e/1c5c3030e32eec7b301d7aea8e1ea9e6.png"><br><br>  We add the interface to the virtual router, the easiest way is to create a dynamic one and add it to your local bridge.  It looks like this to me: <br><br><img src="https://habrastorage.org/storage2/a6a/cc1/acc/a6acc1acc35ae5fcbe2c4b8b846bf072.png"><br><br>  in the preinstalled image, the network interface is configured to receive network settings via dhcp, and if you have everything in order with the localhost, the virtual router will get the network address, if not, edit the / etc / config / network file and restart the network.  Next, go to the console: <br><br><img src="https://habrastorage.org/storage2/1a5/0c8/0ce/1a50c80ce82401a50da90c2b4cd65610.png"><br><br>  change the password to root, and see what address is received.  All subsequent actions are best done by connecting via ssh. <br><br>  Having connected via ssh, first edit /etc/opkg.conf, bringing it to the following form for mips: <br><img src="https://habrastorage.org/storage2/086/213/83d/08621383d768c8bb35203d3a0c05e049.png"><br><br>  Further: <br><br><blockquote><code>opkg update</code> <br> <code>opkg install asterisk18 asterisk18-codec-alaw asterisk18-chan-iax2 asterisk-gui</code> <br> <code>/etc/init.d/asterisk enable</code> </blockquote> <br><br>  edit /etc/asterisk/manager.conf, change the admin password to the panel and start the asterisk <br><br><blockquote> <code>/etc/init.d/asterisk start</code> </blockquote> <br><br>  that's all, now you can go to <a href="http://xn--_-7sbbargbb4dwaqfcgsdq/">metarouter_address</a> : 8088 / and set up an asterisk through the GUI.  Present codecs alaw, ulaw, gsm.  If you need to add codecs, look at the list of existing packages and install the necessary one via opkg.  Ready packages under 1.8 asterisk a decent amount, up to chan_dahdi.  For home use quite tolerably can work. <br><br><img src="https://habrastorage.org/storage2/f75/ca2/3ed/f75ca23ed097e35ee2636aa4fa1681ee.png"><br><br>  Everything was done as an experiment, although in principle, it could work for the house, and you can not install the GUI for an asterisk. <br><br>  PS: I understand perfectly well that this is a perversion, but I wanted to share such an experiment. <br><br>  <b>UPD</b> : I know about the wiki on the mikrotik site, that you can assemble the image yourself and compile the packages, I started to implement it with it, but this is hardcore (IMHO) if there is a ready-made solution with ready-made packages.  And yes, with a ready-made image downloaded from the link from the native wiki, the asterisk did not start up normally, and a lot of voip packages are missing there.  I also tried ready-made images from other sources, I stopped at the aforementioned, for the simple reason that everything started without a tambourine, ‚Äúout of the box‚Äù, so to speak. </div><p>Source: <a href="https://habr.com/ru/post/180889/">https://habr.com/ru/post/180889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180875/index.html">And go to study at Harvard?</a></li>
<li><a href="../180877/index.html">VNC via GIF</a></li>
<li><a href="../180881/index.html">Proxmox 3.0 Virtualization Management System Released</a></li>
<li><a href="../180883/index.html">Chrome 28 Beta for Android came out with integrated Google Translate</a></li>
<li><a href="../180887/index.html">The digest of interesting news and materials from the world of ayti for the last week No. 58 (May 19 - 24, 2013)</a></li>
<li><a href="../180893/index.html">‚ÄúTile Hunt‚Äù - tiling texture in 5 minutes based on a photo (cycle: Working with textures and images)</a></li>
<li><a href="../180897/index.html">77 terabytes per month on home anlim</a></li>
<li><a href="../180899/index.html">As the tail wags the dog. ABC Propaganda</a></li>
<li><a href="../180901/index.html">Songs about IT</a></li>
<li><a href="../180907/index.html">Printed on a 3D printer trachea extender saved the life of a child</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>