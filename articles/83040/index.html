<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The basics of creating a game engine: timer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Published at the request of my friend, if you like the article, you can send him an invite. 
 Soap I will tell in PM or I can write here. :) 

 In thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The basics of creating a game engine: timer</h1><div class="post__text post__text-html js-mediator-article">  <i>Published at the request of my friend, if you like the article, you can send him an invite.</i> <i><br></i>  <i>Soap I will tell in PM or I can write here.</i>  <i>:)</i> <br><br>  In this article I want to tell you how I started writing the game engine, I ran into the problem of writing the exact timer and how I solved it.  I am sure that almost everyone sooner or later faces such a problem, so my article will be useful to those who are in the process of creating a timer or only think about it.  I do not claim either for the purity of the code, nor for the ideality of the decisions taken under these conditions.  And now we will finish with personal pronouns and move on to the actual problem. <br><br>  The goal: to write an exact timer for use in the game engine (and this means that in addition to measuring time intervals, we need to ensure the operation of events that occur after a specified time). <br><a name="habracut"></a><br>  First you need to decide what to use to measure time segments in general.  The most logical solution for the accuracy of time measurement is the use of QueryPerformanceCounter / QueryPerformanceFrequency functions.  The meaning of time measurement is to memorize the beginning of the time interval, then check the current time and return the result - the difference between the two measurements.  But we need to make a "long" time, i.e., we will need to know in advance when it will pass, for example, exactly 3 seconds from the current point in time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To ensure this way of working the timer, you can do the following: store ‚Äúevents‚Äù along with the amount of time before they start in the event manager class and, constantly measuring time periods (beginning of the next = end of the current), add time segments to the variable initially equal to 0, and as soon as in any of the events the value of the variable becomes greater than or equal to the amount of time before the start of the event, execute the event. <br><br>  The amount of time before an event begins is called its duration, since an event does not always logically mean the execution of an action after the lapse of time before its start, and sometimes the execution of actions or the preservation of a status while ‚Äúwaiting for it to begin‚Äù.  For example, in my engine, events are used to ensure the exact number of shots per second (after each shot, shooting is prohibited and allowed after a specified time, so it turns out that the event serves to save the "prohibited shooting" status). <br><br>  It remains to think only about how to actually check-memorize these time periods so that it is consistent and continuous.  The logical solution here would be to use a frame rate and measure the length of time in each frame.  Since the QueryPerformanceCounter / QueryPerformanceFrequency functions heavily load the processor, it makes sense to limit the frame rate by performing Sleep after each of them.  The coarseness of the Sleep function does not matter here, since the time will be measured continuously, that is, there will be no intervals between the measured segments. <br><br>  Now a bit of code to demonstrate the above: <br><br>  Full timer class: <br>  de_timer.h: <br><blockquote><code><a href="http://s-c.me/5234/s"></a> <a href="http://s-c.me/5234/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#cc6633">#ifndef</font> __DE_TIMER_H&lt;br/&gt; <font color="#cc6633">#define</font> __DE_TIMER_H&lt;br/&gt; &lt;br/&gt; <font color="#cc6633">#include</font> &lt;windows. <font color="#2b91af">h</font> &gt;&lt;br/&gt; &lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#2b91af">deTimer</font> &lt;br/&gt;{&lt;br/&gt;  LARGE_INTEGER start; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">double</font> frequency; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">double</font> tickLength; <font color="#008000">//   </font> &lt;br/&gt; <font color="#0000ff">double</font> currentCheckTime; <font color="#008000">//  </font> &lt;br/&gt; <font color="#0000ff">double</font> lastCheckTime; <font color="#008000">//  </font> &lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">void</font> init();&lt;br/&gt; <font color="#008000">//  </font> &lt;br/&gt; <font color="#0000ff">double</font> getFrequency();&lt;br/&gt; <font color="#008000">//  (  )</font> &lt;br/&gt; <font color="#0000ff">double</font> readTimer();&lt;br/&gt; <font color="#0000ff">public</font> :&lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">void</font> startTimer();&lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">void</font> updateTimer();&lt;br/&gt; <font color="#008000">//       </font> &lt;br/&gt; <font color="#008000">// :    ,</font> &lt;br/&gt; <font color="#008000">//      </font> &lt;br/&gt; <font color="#0000ff">double</font> getTimeInterval() { <font color="#0000ff">return</font> currentCheckTime - lastCheckTime;}&lt;br/&gt;};&lt;br/&gt; &lt;br/&gt; <font color="#cc6633">#endif</font> &lt;br/&gt; &lt;br/&gt;</font></code> </blockquote> <br><br>  de_timer.cpp: <br><blockquote> <code><a href="http://s-c.me/5232/s"></a> <a href="http://s-c.me/5232/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#cc6633">#include</font> <font color="#A31515">"de_timer.h"</font> &lt;br/&gt; &lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">void</font> deTimer::init()&lt;br/&gt;{&lt;br/&gt; <font color="#008000">//     </font> &lt;br/&gt;  frequency = getFrequency();&lt;br/&gt;  tickLength = <font color="#A31515">1</font> . <font color="#A31515">0</font> / frequency;&lt;br/&gt;}&lt;br/&gt; &lt;br/&gt; <font color="#008000">//  </font> &lt;br/&gt; <font color="#0000ff">double</font> deTimer::getFrequency()&lt;br/&gt;{&lt;br/&gt;  LARGE_INTEGER freq;&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">if</font> (!QueryPerformanceFrequency(&amp;freq))&lt;br/&gt; <font color="#0000ff">return</font> <font color="#A31515">0</font> ;&lt;br/&gt; <font color="#0000ff">return</font> ( <font color="#0000ff">double</font> )freq.QuadPart;&lt;br/&gt;}&lt;br/&gt; &lt;br/&gt; <font color="#008000">//  (  )</font> &lt;br/&gt; <font color="#0000ff">double</font> deTimer::readTimer()&lt;br/&gt;{&lt;br/&gt; <font color="#008000">//    </font> &lt;br/&gt;  DWORD_PTR oldMask = SetThreadAffinityMask(GetCurrentThread(), <font color="#A31515">0</font> );&lt;br/&gt; <font color="#008000">//  </font> &lt;br/&gt;  LARGE_INTEGER currentTime;&lt;br/&gt;  QueryPerformanceCounter(&amp;currentTime);&lt;br/&gt; <font color="#008000">//    </font> &lt;br/&gt;  SetThreadAffinityMask(GetCurrentThread(), oldMask);&lt;br/&gt; <font color="#008000">//  </font> &lt;br/&gt; <font color="#0000ff">return</font> (currentTime.QuadPart - start.QuadPart) * tickLength;&lt;br/&gt;}&lt;br/&gt; &lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">void</font> deTimer::startTimer()&lt;br/&gt;{&lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt;  init();&lt;br/&gt; <font color="#008000">//    </font> &lt;br/&gt;  DWORD_PTR oldMask = SetThreadAffinityMask(GetCurrentThread(), <font color="#A31515">0</font> );&lt;br/&gt; <font color="#008000">//  </font> &lt;br/&gt;  QueryPerformanceCounter(&amp;start);&lt;br/&gt; <font color="#008000">//    </font> &lt;br/&gt;  SetThreadAffinityMask(GetCurrentThread(), oldMask);&lt;br/&gt; <font color="#008000">//     </font> &lt;br/&gt;  lastCheckTime = currentCheckTime = readTimer();&lt;br/&gt; <font color="#008000">//  (     )</font> &lt;br/&gt;  srand(( <font color="#0000ff">int</font> )start.QuadPart);&lt;br/&gt;}&lt;br/&gt; &lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt; <font color="#0000ff">void</font> deTimer::updateTimer()&lt;br/&gt;{&lt;br/&gt; <font color="#008000">//   </font> &lt;br/&gt;  lastCheckTime = currentCheckTime;&lt;br/&gt; <font color="#008000">// </font> &lt;br/&gt;  currentCheckTime = readTimer();&lt;br/&gt;}&lt;br/&gt; &lt;br/&gt;</font></code> </blockquote> <br><br>  You can look at the rest of the engine code in its current state on <a href="http://sourceforge.net/projects/dustengine/">sourceforge.net/projects/dustengine</a> <br>  The code for the timer and event manager is in the files: <br>  de_timer.h, de_timer.cpp, de_event.h, de_event_manager.h, de_event_manager.cpp <br>  Version of the engine at the time of writing: 0.1 <br><br>  At once I will make a reservation that the code was written by me, despite the comments in English (I make a habit of using English in projects). <br><br>  <b>UPD.</b>  The executable on sf.net is only for win7 (!) (It will probably also work on whist), on winXP it works when installing compatibility with win98 (strange, but true).  All this was compiled on win7 and under win7. </div><p>Source: <a href="https://habr.com/ru/post/83040/">https://habr.com/ru/post/83040/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83031/index.html">Internet nominated for the Nobel Peace Prize</a></li>
<li><a href="../83035/index.html">Future testing</a></li>
<li><a href="../83037/index.html">The number of GLONASS satellites used for its intended purpose has reached nineteen</a></li>
<li><a href="../83038/index.html">OpenGL video tutorials</a></li>
<li><a href="../83039/index.html">Rest in BarCamp format</a></li>
<li><a href="../83041/index.html">Nokia collects Rubik's cube</a></li>
<li><a href="../83044/index.html">Do you think it is more correct to visualize the year on a circle? (example in the comments)</a></li>
<li><a href="../83045/index.html">Glossy or matte screen?</a></li>
<li><a href="../83047/index.html">36 stages of the routing process</a></li>
<li><a href="../83048/index.html">Never send a human to do a machine's job</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>