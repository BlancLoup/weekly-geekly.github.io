<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My own game. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer 
 Here is an article about how my friends and I wrote the game. We finished it and sell it, but it does not bring us money. However, it was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My own game. Part 2</h1><div class="post__text post__text-html js-mediator-article"><h3>  Disclaimer </h3><br>  Here is an article about how my friends and I wrote the game.  We finished it and sell it, but it does not bring us money.  However, it was very interesting and fun for us to do it, and I decided to share my memories.  The article will have a minimum of technical details, I will not lay out the code, since it makes no sense to learn from it.  This is the code of amateurs, not professionals, there is an error on a mistake  None of us has IT education and no one has ever been professionally engaged in programming.  I will sometimes lay out the technical details, as without it, nowhere.  I ask readers also not to post comments about what we are fuckers, as it is a shame to read.  Though true. <br><a name="habracut"></a><br>  <b>Other parts of the article</b> <br>  <a href="https://geektimes.ru/post/297715/">Part 1</a> <br>  <a href="https://geektimes.ru/post/297859/">Part 3</a> <br><br><h3>  Chapter 3. Jurassic Period </h3><br>  Before solving the memory problem, I thought of it quickly.  True.  The number of unique models at the level just limited to 5yu for enemies and 6 for our freaks.  There could be a lot of ‚Äúclones‚Äù, but they took a penny of memory, since the heaviest ‚Äî the model and the texture ‚Äî were stored in a single copy for all the ‚Äúclones‚Äù.  Of course, it was impossible to clone the freaks, since the player could decide to send completely different models on the mission, so I just limited the squad to 6 soldiers.  In principle, a squad of 6 well-armed freaks should defeat any enemy, I thought, and there will be many enemies of one kind, many more - a second, a little third, a little - a fourth, and a boss of the fifth.  I also reduced most of the textures to 128x128 or 256x256 (well, Dimon and Fyodor Mikhalych reduced, I was in charge here), and began to store many vertex components as short or char, instead of float.  That was enough for the ‚Äúgame‚Äù to run on the device.  It was fun to drive freaks on the screen with your finger, and besides, they could walk through walls.  They could not avoid obstacles.  Worse, I had no idea how to do this.  Little by little, models of the game environment began to appear, and Fyodor Mikhalych hinted more and more strongly to me that it was time to write down the level editor. <br><br>  Somewhere in 2 weeks I did a TEXT level editor.  He worked from the command line.  At start I asked the dimension of the field.  Then I deduced the choice of the type: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="dos hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>.    <span class="hljs-number"><span class="hljs-number">2</span></span>.   <span class="hljs-number"><span class="hljs-number">3</span></span>.   <span class="hljs-number"><span class="hljs-number">4</span></span>.      ?<span class="hljs-number"><span class="hljs-number">2</span></span>    (<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">15</span></span>):<span class="hljs-number"><span class="hljs-number">3</span></span>   :<span class="hljs-number"><span class="hljs-number">5</span></span>   Z:<span class="hljs-number"><span class="hljs-number">5</span></span>  .   ? <span class="hljs-number"><span class="hljs-number">1</span></span>.    <span class="hljs-number"><span class="hljs-number">2</span></span>.   <span class="hljs-number"><span class="hljs-number">3</span></span>.   <span class="hljs-number"><span class="hljs-number">4</span></span>.      ?</code> </pre> <br>  And further in this style. <br><br>  ‚ÄúTerribly convenient,‚Äù I thought: ‚ÄúFull control over the development, only the console, only hardcore.‚Äù <br><br>  Fedor Mikhalych did not think so.  That's when I needed my old code from our MMORPG under Windows.  On its basis, I created a new editor.  Yes, our new level editor used to render OpenGL.  But creating a graphic editor took quite a lot of time. <br><br><img src="https://habrastorage.org/webt/sx/ko/ie/sxkoierrxcp5_ifpklb9m8ao5pk.png"><br>  <i>This is the latest version of the editor, where there is everything.</i>  <i>So he was not immediately.</i> <br><br>  The originally conceived 6 months are long gone, and we only had a level editor, floor textures, 1 freak model and a few models of the situation in the game.  There were no enemies.  The weapon was soldered to the freaks (yes, it later goes around comes around!), And, since we only had one model, there was only one weapon too.  Worse, it was impossible to move the map on the screen, since the coordinates where the user tapped were transferred from the screen to the world according to the ‚Äúcorrespondence table‚Äù.  The table was a picture of the playing field in the same game perspective, only the red channel in it contained the world X coordinate of the cell that it displayed, and the blue one - the world Z coordinate.  Thus, when tap happened, a pixel with tap coordinates in this map was checked, and the blue and red components of this pixel returned the world coordinate. <br><br>  I considered this system of recognition of tapas the height of perfection.  Fedor Mikhalych did not think so.  He said that the whole map would not fit on the screen - everything would be too small.  The map must be moved. <br><br>  ‚ÄúNot a problem,‚Äù I said, and allowed the user to move the map around the screen in ‚Äújumps.‚Äù  So that after moving the map jumped onto the grid with color coordinates with an offset corresponding to moving the map across the screen, but aligned with the grid squares.  Thus, it was possible to move the map by a whole number of game cells along any of the 2 world axes (there was no height in the game). <br><br>  Fedor Mikhalych, reluctantly agreed to leave it this way for now, but grumbled that the map could not be rotated.  And I told him that if he wants to rotate, it is necessary to rewrite the engine, and then we return to the beginning, and already 6 months have passed, and the game is still, though not very, very far away.  Fedor Mikhalych was unsatisfied and was silent and made levels.  It seems to me, in the end, the levels are the best that is in this game.  True. <br><br>  But the levels were getting harder, there were more and more objects on them, and it all began to be terribly slow.  Moreover, the profiler showed that there was no single bottleneck in the code, everything slowed down.  From the pros, I screwed A *, and now the freaks could walk normally, only it was unclear how the engine could understand whether it was possible to pass through an object (a doorway, for example) or not (a wall, for example).  And Fyodor Mikhalych ignored my enthusiasm for A *, but complained more and more about the speed of the engine. <br><br>  - The speed fell below 10 frames per second on the newest iPhone 5, - he said, although his iPhone 5 has long ceased to be the newest.  - And on the second ipad just a slide show. <br><br>  Then I decided to introduce visibility maps.  It worked as follows.  The matrix was created in dimension with the playing field.  Every time one of the monsters moved, the matrix was recalculated so that all the cells within a radius of 15 cells from each of the monsters were filled with units, the rest was filled with zeros.  Then, only those cells of the map and objects that had coordinates marked with units in the matrix were entered into the rendering list.  The rest was not drawn.  Fog of war!  It helped, but not drastically.  That is, cardinally, the speed increased to 20 frames, but if there were many objects outside the fog, all the same, everything was sad. <br><br>  Separately, I want to write about how the fog map was generated.  The entire map was marked as being in the fog, then 360 rays were traced from each of the monsters, forming a complete circle around the monster, with a radius of "monster" in length.  Naturally, before the first crossing with an obstacle.  Each cell along which the beam passed was labeled as visible.  That is, in fact, a primitive model of raytracing from Wolf. <br><br>  But the 360 ‚Äã‚Äãrays were clearly not enough. <br><br>  ‚ÄúYou got some kind of crap,‚Äù Fyodor Mikhalych told me, showing that the walls along the player‚Äôs gaze, but a little to the side, were partially invisible, partially visible, and partly ‚Äúlooking‚Äù through them. <br>  ‚ÄúLight is a wave,‚Äù I replied.  - Do you know diffraction? <br><br>  But the number of rays to 720, I then increased. <br><br><img src="https://habrastorage.org/webt/78/cw/cb/78cwcbxeqzbsmw_aumkpoa3fjzc.png"><br>  <i>Dark gray squares with a gray worm are the fog of war.</i>  <i>Not to be confused with the same, but lighter, this is concrete!</i> <br><br>  It was then that Fyodor Mikhalych caught the eye of the <a href="http://fabiensanglard.net/dEngineSourceCodeRelease/index.php">dEngine</a> engine <a href="http://fabiensanglard.net/dEngineSourceCodeRelease/index.php">project</a> , which I decided to study in order to increase my knowledge. <br><br>  It was code from another planet. <br><br>  The first thing that threw me into shock: under iOS, you can write in C.  How glad I was.  I already almost fell in love with the idiotic syntax of Objective C, but the realization that there are people who write humanly did not allow me to eat calmly.  And because of this, I drank a lot.  And here it is. <br><br>  I told Fyodor Mikhalych that I needed a month and did not disturb me.  I will create.  And sat down to rewrite the C code.  From scratch. <br><br>  This helped a lot, because bicycles and crutches in the old code for more than six months have accumulated order.  I did not drag them to the new one.  Among others, I got rid of the crutch in the form of maps of transforming tapa coordinates through texture, and went deep into studying the issue in detail.  Wrote the function of the inverse coordinate transformation.  The map could now be rotated, scaled, moved as it pleases, and still the clicks were recognized correctly. <br>  I was happy.  Fedor Mikhalych was pleased. <br><br>  To facilitate the rendering of the level, I decided to make the floor level consisting of a single rectangle, and not from square cells, as before.  Since earlier each cell had its own model with its own texture, this innovation greatly increased the performance of the game (yes, there were several hundred texture switchings per frame only for floor rendering, and several hundred draw functions for it), but now for everyone The level needed its own floor texture, completely finished and containing all the cells together.  I added functionality to create such a texture in the editor.  The fog of war had to be left, but now I did it, passing the "visibility map" of the monsters in the form of a texture to the shader.  Plus came the filtering.  Now the fog of war did not advance abruptly, but had a gradient.  It was nice.  We still didn‚Äôt draw anything in the fog of war. <br><br><img src="https://habrastorage.org/webt/go/sm/he/gosmhedb883mjbrc4se4gdtuzuy.png"><br>  <i>New fog of war.</i>  <i>And the texture of the floor is new.</i> <br><br>  We reviewed and the structure of the files that store information about the levels.  Now each level contained maps of travel and visibility.  Cells through which it was impossible to pass were marked in the mileage map.  In the visibility map - through which it was impossible to see, they served to calculate the fog of war.  We agreed that if one cannot see through a cell, one cannot even shoot through it.  And if you can see, but you can't get through, then you can shoot through it, but the accuracy of the hits decreases.  Yes, we counted hits by a probabilistic model.  Each weapon had an accuracy that determined the likelihood of a shot hitting the target, and the number of shots in the line.  In addition, the probability increased with the growth of the title of a freak, or with the help of a sniper skill training. <br><br>  At the same time, I added a system of clones for objects of the situation level, in order not to load duplicates, just as I had previously done for enemies.  This did not bring significant memory savings, but the rendering speed increased due to the smaller number of texture switches, since all objects of the same type were always drawn in a row. <br><br>  But it took a little more time than I planned.  About a year from the start of writing the game, we returned to the place where we were six months ago, but now the code worked quickly, steadily resisting 60 FPS, iPhone limit, and gave a much better picture.  And I had a child outlined.  And everyone with whom I talked about the game, they said that it was necessary to have time to complete it before the child appeared, otherwise everything. <br><br><h3>  Chapter 4. Stone Age </h3><br>  I did not fear much for the project‚Äôs progress in connection with the appearance of the child.  Yes, I understood that there would be much less time, but by that time Fyodor Mikhalych already had a small child, and, nevertheless, he coped.  I thought I could handle it.  In general, something like this happened, although progress still went slower.  Fyodor Mikhalych did the levels and ordered models for them to Dimon, Dimon worked with freelancers and tried to calculate the balance of forces in the game mathematically.  Fedor did everything empirically.  I did almost nothing. <br><br>  It seemed to me then that I was very tired of the game.  Approximately 2 years have passed since the start of development.  I had a newborn baby in my arms and a fully functional half-game.  Yes, we were already close to the final "bohivki".  We called it "akshnheim."  This is where a player fights terrorists with a squad of freaks.  But there was also the second part of the game, which we called ‚Äútactics game‚Äù, this time at the base, between missions.  They need to manage intelligence in order to find the bases of terrorists, manage the detachment, treat wounded soldiers, train healthy ones, build, buy and sell weapons.  That all was not.  There was no system of points, there was no system of experience, there was no progress of freaks. <br><br>  - Stupidly stamping levels becomes too stupid.  We must take on tacticheim, Fyodor Mikhalych told me. <br><br>  I rested.  I'm tired.  Then Fyodor Mikhalych told me that he would be engaged in polishing the akshnheim and ideas for tactics, Dimon would do art for tactics, and I can take some time off.  So decided. <br><br>  Meanwhile, a remake of the X-com for the company has long been released, and we even played enough of it, and the release for ayos loomed on the horizon.  Fyodor Mikhalych said that no one will ever pay attention to our game after the release of X-coma for ayos.  And I sat down for tactics game. <br><br>  I sketched the structure of tactics quickly.  In my vision, which the others agreed, the player‚Äôs alter ego should have stood in the middle of a small room.  There were doors leading to other rooms in front of him, behind him, and to his right.  The view was supposed to be ‚Äúout of sight‚Äù, as in 3D shooters.  With a swipe, the player had to ‚Äúspin‚Äù, ‚Äúswitching attention‚Äù from one room to another, and tap to go into the room he was looking at.  In these 4 rooms he could, respectively, control reconnaissance, detachment, armament and send the detachment to the missions. <br><br>  They gave the freelancers the task to create a model of the base, and so far I have painted the backdrops in the paint and used them instead of real models. <br><br><img src="https://habrastorage.org/webt/_8/ur/eu/_8ureuzscp-vbdkr0jfk51rsk0o.png"><br>  <i><i>One of the "rooms" on the base, made entirely by me.</i></i> <br><br>  Progress was relatively fun, and freelancers coped with the base relatively quickly, and soon the functionality was ready.  Everything looked rather clumsy, especially, models of freak-soldiers and freak-workers of the base.  The models of freak-soldiers, however, were in themselves nothing at all for akshnheim, where they were painted small.  But when they were drawn on the whole screen, and even on the iPad, there was a complete failure. <br><br>  In addition, they ate a lot of memory. <br><br>  We had 3 basic freak models, each with 3 different head textures.  There were also 3 different variants of camouflage textures (2 camouflage and 1 armor variant).  Also, there were 4 weapon options.  I said earlier that, in order to simplify the animation, we decided to ‚Äúfry‚Äù the weapon into the freak model.  That is, for the same freak existed 4 different models, one for each weapon.  So, to display the unit on the base, 12 models and 36 textures should be stored in the memory. <br><br>  In the memory of the 4th (and 4S) iPhones, this did not fit in any way.  Especially with the base model.  There was a great desire to drop support for the Quartet.  But it was difficult to do this, because, despite the imminent release of 6s (yes, there was also a problem with a real resolution of 6 plus! OpenGL operated in real with a real screen resolution, 1920x1080, and the touchscreen gave out virtual coordinates from the 2208x1242 grid. One thing It was possible to convert to another in order to correctly recognize the coordinates of the wheelbarrow, having previously determined that we are working in this configuration), 4S could work quite well with the latest iOS, and I could not imagine how in the appstore to forbid users of fours to buy our game. <br><br>  Fyodor Mikhalych suggested using their pre-rendered pictures instead of models based on the base.  It almost helped.  Finally, it also helped to downsize all the base textures.  Now everything fit in memory 4ki.  And even looked relatively good on the small screen of the 4th iPhone.  But on the iPad, or even on the iPhone 6 Plus, it was a disaster. <br><br>  The final decision was to determine the amount of device memory when loading and executing the corresponding code branch with loading textures of appropriate quality. <br><br>  Understand when I call our soldiers' models freaks, I‚Äôm not joking, because the md2 format operates with 8 bits per coordinate, which gives a resolution of 256x256x256 pixels, and the resolution of the texture bindings is important not so much the spatial resolution of the model itself.  The model was drawn on the screen with a height of 1.5 thousand pixels, and even if it occupied half the height of the screen, it was 500 pixels in height.  Misses in the texture here were even very visible. <br><br>  I will not say that the pictures of the monsters were much worse than the models of the monsters themselves, but the models of the monsters themselves were animated, which partially smoothed out the negative experience. <br><br>  However, the game worked.  Yes, she looked unassuming, yes, there were elusive bugs, and the balance was very wry.  And yes, there were few levels and at that time they were all very different, some were heavy and heavy, such that the fight could easily last an hour, while others were instantaneous.  But the game worked. <br><br>  By the way, a few words about the levels.  In the game, as in the X-coma clone that respects itself, there were two types of missions.  Those that influenced the progress we called the plot.  These missions to the player fell out when his intelligence found the base of terrorists.  After passing the last such mission, the game was supposed to end.  The second type of missions fell to the player from time to time, by chance.  Such missions we called "random".  These were the attacks to which the player had to react: rescue hostages or neutralize bombs in order to earn money and experience. <br><br>  So, with the story missions everything was more or less clear, after all we had a scenario in which the player gradually went through the terrorists to Greenward (no, not Greenpeace, but Greenward) and to penguins, and in the end - to the mutant penguin , super boss game.  But with random was not clear.  They needed a lot, because I didn‚Äôt really want to force the player to replay the same random levels again and again.  In addition, in the room from which the player started the mission, as in any self-respecting X-com clone, the missions were visible on the map (yes, not on the globe, but on the map, this was our know-how, a very striking difference from of the original!), and it was necessary to make some sort of linking of the contents of the level with the map, so that when you click on the mission at the north pole, the level with the desert does not load.  It was a simple matter, but a dreary blessing, Fyodor Mikhalych was mainly engaged in everything, sometimes demanding from Dimon new models for levels, and from me to add them to the editor and the game itself (I still answered for the ‚Äúmaster build‚Äù).  And I was free, because, according to the general opinion, the levels made by me were distinguished by special slop.  Although 1 or 2 ended up in the game.  Perhaps that is why she did not bring money. <br><br>  Having nothing to do, I started tuning the code.  Lighting in our game was not.  More precisely, it was flat.  I decided to fix it.  In the models, of course, there were no normals.  It does not matter, I read Lamothe.  I screwed the directional lighting, but static, it was calculated when the modelka was loaded.  Got better.  The ‚Äúsmoothing‚Äù of the model came as a bonus, since the normals for each vertex were considered as the average value of the normals of all triangles to which this vertex belonged, and the shader already made a smooth change in the illumination of the triangle from one vertex to another ( <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D1%2582%25D0%25BE%25D0%25BD%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F_%25D0%2593%25D1%2583%25D1%2580%25D0%25BE">Guro toning</a> ). <br><br>  Then I decided to screw the shadows.  It did not work for a very long time on the device.  The fact is that in the simulator everything worked great, but in the device the shadows appeared, then disappeared, they were striped.  As a result, I spat on the shadows on the walls, and only drew them on the floor, making a shader for it with a shadow, and for all other objects I just ignored the shadow map.  Shadows turned out a bit neutered, but they were.  True, I did not succeed in adapting the size of the zone in which the shadows were calculated to the size of the visible area, so the shadow map was always calculated for the entire playing field.  As a result, despite the huge size of the map at 2048x2048 pixels (16 MB in memory!), At the maximum approximation, the shadows looked very pixelated (but looked!), And in the version for the 4th iPhone, the shadows had to be turned off altogether, since not enough memory. <br><br><img src="https://habrastorage.org/webt/xl/no/xb/xlnoxbfofb_ldkh0fqcyoqoftfw.png"><br>  <i>It looked like a game on new devices</i> <i><br><br></i>  <i>And so, on iPhone 4, 4S and iPad 2 and mini:</i> <br><img src="https://habrastorage.org/webt/3c/rx/ma/3crxmaj9y2agsbvndfzd7wgt-vi.png"><br><br>  At about the same time, after seeing that the difference between the picture drawn by the game on devices with 512 MB of memory (and besides iPhone 4, 4S it is also iPad 2 and iPad mini) and more modern devices was quite noticeable, we decided to display fours for users and Old iPads alert that the device they have, to put it mildly, sucks, and we are not guilty of anything. <br><br><img src="https://habrastorage.org/webt/d5/cl/nm/d5clnmjjtocrz0nkwjwlwnwsv9w.png"></div><p>Source: <a href="https://habr.com/ru/post/371217/">https://habr.com/ru/post/371217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../371205/index.html">Scientists have proposed to produce food for astronauts from human waste</a></li>
<li><a href="../371207/index.html">Car, Internet of Things and other technologies</a></li>
<li><a href="../371211/index.html">All Use of Spent Nuclear Fuel</a></li>
<li><a href="../371213/index.html">XYZprinting 3D Color Printers Overview with Formnext 2017</a></li>
<li><a href="../371215/index.html">Profession - trumpeter. Tool</a></li>
<li><a href="../371219/index.html">Facebook has banned any advertising related to cryptocurrencies</a></li>
<li><a href="../371221/index.html">How the old Theory of Everything gets a new life</a></li>
<li><a href="../371223/index.html">In Crimea, will test the system of returning astronauts from the moon</a></li>
<li><a href="../371227/index.html">Russia and the United States will work out requirements for protection against cosmic radiation at the near-moon station</a></li>
<li><a href="../371229/index.html">Lidars helped discover the thousands of Mayan buildings in the jungles of Guatemala</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>