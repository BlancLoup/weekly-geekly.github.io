<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visualization of simple geometry in WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is model geometry? 
 To work with 3D models, we use special processing pipelines - OpenGL and DirectX . When conveyors build a picture, they use ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visualization of simple geometry in WPF</h1><div class="post__text post__text-html js-mediator-article"><h2>  What is model geometry? </h2><br>  To work with 3D models, we use special processing pipelines - <a href="https://ru.wikipedia.org/wiki/OpenGL">OpenGL</a> and <a href="https://ru.wikipedia.org/wiki/DirectX">DirectX</a> .  When conveyors build a picture, they use information: <br><br><ul><li>  about the model - its material, geometry and textures, </li><li>  about the scene - lighting and camera settings. </li></ul><br>  Any model starts with geometry.  Model geometry is a set of points in three-dimensional space and a set of triangles from these points.  The triangle is complanar - it lies in the plane, unlike figures with a large number of points, which in general do not lie in the plane. <br><br>  If you set the direction of the border around the triangle, it will become an oriented triangle.  For an oriented triangle in three-dimensional space, one can distinguish the inner and outer sides.  In the direction of bypassing the border, we also determine the only in the direction of the normal vector for each triangle.  Thus, in addition to points and triangles, the geometry of the model includes a set of normals for each of the triangles.  When the model is displayed, the points of the model correspond to the points, the triangles of the model correspond to the faces. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the example we will focus on the geometry of the model, the rest will be used as necessary.  As an example, the model is quite suitable Dolphin below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/920/0bb/5dd/9200bb5dd8d2d158ce22db25dbc3cf34.png" alt="image"><br><a name="habracut"></a><br>  Thanks to <a href="https://ru.wikipedia.org/wiki/Windows_Presentation_Foundation">WPF</a> technology, we create interactive application interfaces and work with 3D graphics.  In the example, we use the standard features of the <a href="https://ru.wikipedia.org/wiki/Windows_Presentation_Foundation">WPF</a> architecture: we will tie in the data and on the basis of them we will separate the data model and data presentation ( <a href="https://ru.wikipedia.org/wiki/Model-View-ViewModel">MVVM</a> ). <br><br>  The main element for displaying 3D content in the <a href="https://ru.wikipedia.org/wiki/Windows_Presentation_Foundation">WPF</a> library is <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.controls.viewport3d(v%3Dvs.110).aspx">Viewport3D</a> .  For example, the <b>Camera</b> property sets the camera, and we see the scene.  The second necessary property of <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.controls.viewport3d(v%3Dvs.110).aspx">Viewport3D</a> is <b>Children</b> , a collection of elements of the abstract <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.visual3d(v%3Dvs.110).aspx">Visual3D</a> type.  The concrete implementation of this class is the <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.modelvisual3d(v%3Dvs.110).aspx">ModelVisual3D</a> class: to use it, you must specify the <b>Content</b> property of the abstract <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.model3d(v%3Dvs.110).aspx">Model3D</a> type. <br><br>  The main classes for setting the <b>Content</b> property are: <br><br><ul><li>  <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.geometrymodel3d(v%3Dvs.110).aspx">GeometryModel3D</a> - displays one model, </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.light(v%3Dvs.110).aspx">Light</a> - model of the light source, </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.model3dgroup(v%3Dvs.110).aspx">Model3DGroup</a> - helps to create models with different materials. </li></ul><br>  Necessary properties will be set by binding. <br><br><h2>  MVVM data model </h2><br>  In a broad sense, any application solves a specific task.  The model should fully reflect the data in the problem solved by the application.  We simplify the example and eliminate the normals - they will be defined by default.  Normals are important for displaying textures or fills when calculating luminance. <br><br>  We select the main interfaces that define the essence of the MVVM data model and their connections: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IModel3DSet</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } ICollection&lt;IModel3D&gt; Models { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IModel3D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } ICollection&lt;IPoint3D&gt; Points { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } ICollection&lt;ITriangle3D&gt; Triangles { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPoint3D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> X { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Y { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Z { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Coordinates { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-function">IVector3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DistanceTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IPoint3D endPoint</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITriangle3D</span></span> { IModel3D Model3D { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IPoint3D Point1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IPoint3D Point2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IPoint3D Point3 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IVector3D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> X { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Y { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Z { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Norm { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-function">IVector3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVector3D vector</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IVector3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subtract</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVector3D vector</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IVector3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Multiply</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> factor</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IVector3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CrossProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVector3D vector</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DotProduct</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVector3D vector</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  The concrete implementation is straightforward.  To warn about changing properties, use the familiar <a href="https://msdn.microsoft.com/ru-ru/library/system.componentmodel.inotifypropertychanged(v%3Dvs.110).aspx">INotifyPropertyChanged</a> . <br><br><h2>  Viewmodel </h2><br>  As a base class for the ViewModel, we use: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BaseVm</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TModel</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">Notifier</span></span> { TModel _model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TModel Model { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _model; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _model = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; NotifyWithCallerPropName(); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BaseVm</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TModel</span></span>, <span class="hljs-title"><span class="hljs-title">TParentVM</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">BaseVm</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseVm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TModel model = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">default</span></span></span></span><span class="hljs-function"><span class="hljs-params">(TModel</span></span></span><span class="hljs-function">), TParentVM parentVM</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TParentVM)) { Model = model; Parent = parentVM; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TParentVM Parent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre><br>  This structure is convenient in that it allows you to move along the ViewModel hierarchy in the bindings.  The classes <b>Vector3D</b> , <b>Triangle3D</b> , <b>Point3D</b> are simple, so creating ViewModel for them is not necessary.  So we need only two ViewModel classes - <b>Model3DSetVm</b> and <b>Model3DVm</b> . <br><br><h2>  Representation </h2><br>  To build views, we use WPF substitution using the <b>DataType = "{x: Type local: Type}"</b> attribute when declaring a <b>DataTemplate</b> in resource dictionaries.  The rest of the implementation is standard.  The application for the demonstration looks like this: <br><br><img src="https://habrastorage.org/files/0ca/7f3/2fc/0ca7f32fce744eb085bda852d7a64e04.png"><br><br><h2>  What else do you need to know </h2><br><ol><li>  In WPF, the <b>TriangleIndices</b> property is optional.  If it is not specified, by default, triangles will be created for each of the three points.  For this reason, even with an empty set of triangles, faces are displayed. <br><br></li><li>  To create a binding for a collection of models, you can use the binding from our example, but <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.model3dgroup(v%3Dvs.110).aspx">substitute an</a> instance of <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.model3dgroup(v%3Dvs.110).aspx">Model3DGroup</a> instead of <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.media.media3d.geometrymodel3d(v%3Dvs.110).aspx">GeometryModel3D</a> .  Use for this binding to the <b>Children</b> <a href="https://msdn.microsoft.com/ru-ru/library/system.windows.controls.viewport3d(v%3Dvs.110).aspx">Viewport3D</a> property does not work. <br><br></li><li>  If we change the geometry or rotation axis, the model will be rebuilt, the image will twitch - the animation will start anew.  So that the process is not interrupted, save the intermediate values ‚Äã‚Äãof the model and apply animation to them. </li></ol><br>  <a href="https://github.com/klauth86/MS-Visual-Studio/tree/master/Simple3DModelEditor">An example project can be found here ...</a> <br><br>  I would be glad if the article will help you in some way ... </div><p>Source: <a href="https://habr.com/ru/post/326406/">https://habr.com/ru/post/326406/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326396/index.html">Besides science: what else are our students interested in?</a></li>
<li><a href="../326398/index.html">How we build lean manufacturing (Lean) in our company</a></li>
<li><a href="../326400/index.html">Failover Cluster for Load Balancing</a></li>
<li><a href="../326402/index.html">Five principles for creating a secure "connected" car</a></li>
<li><a href="../326404/index.html">Why do some startups win</a></li>
<li><a href="../326408/index.html">Ubuntu 17.04: what's new</a></li>
<li><a href="../326410/index.html">Courier client interaction and scaling service</a></li>
<li><a href="../326412/index.html">20 interesting observations that I brought from the States and the Valley</a></li>
<li><a href="../326414/index.html">Operators for Kubernetes: how to run stateful applications</a></li>
<li><a href="../326416/index.html">Replacing sim-cards. Chapter III. Fighting with bureaucracy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>