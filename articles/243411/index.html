<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Connect FB, VK, G + to Android. Light version</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I got a task in front of me - to make posting links from Android to a couple of social networks. Moreover, the most simple and easy - so as not to pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Connect FB, VK, G + to Android. Light version</h1><div class="post__text post__text-html js-mediator-article">  I got a task in front of me - to make posting links from Android to a couple of social networks.  Moreover, the most simple and easy - so as not to produce entities and bother as little as possible with tokens, sessions and so on.  The task, indeed, is the minimum - only placing the link in the user's own account.  If you can easily add descriptions or pictures to the link, you can do it, but do not rest. <br><br>  For various reasons, Facebook, Vkontakte and Google+ were chosen.  She planned to add Twitter, but by that time his Fabric had not yet been released, and we did not want to use a third-party library (see paragraph 2 below).  I will add later. <br><br>  As a result, the task for these three social networks turned out to be the following: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  The simplest software posting links interface. </li><li>  Use only native SDKs (for those reasons that this knowledge will come in handy later). </li><li>  Minimum code - only the most necessary for work. </li><li>  Everything should work regardless of whether the user has an installed social network client.  But if it is - use the client dialog boxes. </li><li>  The user should receive a message about the success or no posting. </li><li>  It should be possible to programmatically respond to the successful placement of the record. </li></ol><br><a name="habracut"></a><br><h2>  Solution Architecture </h2><br>  The variant with a separate library eventually turned out to be too cumbersome - the final code was about 250 lines, along with comments and empty lines.  Moreover, everything was encapsulated in one class, which is quite simple to use. <br><br>  Since a number of objects from the SDK still had to be built into the life cycle, a kind of container was needed - either Activity or Fragment.  I chose a solution with an abstract Activity, because  I needed to hang the posting commands on the ActionBar button.  Moreover, do it for several Activities with different fragments inside. <br><br>  In abstract Activity, I stitched up all the posting control code, and put out 3 methods outside, one for each grid.  From this abstract activity itself, then inherited the rest of the Activity applications in which social networks were needed.  In them, access to the necessary code was reduced to a method call from the parent class. <br><br>  Everything described here can certainly be done with a fragment.  Although somewhere I came across a message that embedding in the life cycle still needs to be done for the parent Activity.  I do not know, I have not tried it. <br><br>  So‚Ä¶ <br><br>  In order for the code described below to work, you need to connect your SDK to the project for each social network and register the application in the developers section.  Everything is described here: <br><ul><li>  <a href="https://developers.google.com/%2B/mobile/android/">developers.google.com/+/mobile/android</a> </li><li>  <a href="https://vk.com/dev/android_sdk">vk.com/dev/android_sdk</a> </li><li>  <a href="https://developers.facebook.com/docs/android/getting-started/">developers.facebook.com/docs/android/getting-started</a> </li></ul><br>  When developing, SDK descriptions were used on their social networking sites, articles on Habr√© and SO, ASNE library code (thanks to the author!) <br><br><h2>  Google+ </h2><br>  The simplest code was logical solution for G +.  All work with authentication and sessions is already built into the system.  The desired dialog box (native from the client or the web if there is no client) is selected by itself, and it also reports the successful posting.  Here, in the latter, the only ambush lay - the implementation of clause 6 of the requirements.  To track the success of the publication, we had to add one constant and one conditional operator in onActivityResult: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GOOGLEPLUS_REQUEST_CODE = <span class="hljs-number"><span class="hljs-number">1001</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultCode, Intent data)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((requestCode == GOOGLEPLUS_REQUEST_CODE) &amp;&amp; (resultCode == -<span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">//Do something if success } }</span></span></code> </pre> <br>  The posting procedure itself: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Publish link in Google+ * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> text - message about link (may be changed or deleted by user) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> link - http:// etc */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">googleplusPublish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text, String link)</span></span></span><span class="hljs-function"> </span></span>{ Intent shareIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlusShare.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .setType(<span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>) .setText(text) .setContentUrl(Uri.parse(link)) .getIntent(); startActivityForResult(shareIntent, GOOGLEPLUS_REQUEST_CODE); }</code> </pre><br><h2>  Facebook </h2><br>  C Facebook had to tinker a little longer, and not all the requirements could be implemented. <br><br>  Happened: <br><ul><li>  do without tokens, sessions, etc .; </li><li>  add a bunch of descriptions to the link and a picture - in G + and VK there is no such functional or it is implemented nontrivially; </li><li>  use the native client if it is installed, but checking and invoking the necessary dialog, unlike G + and VK, had to be written with pens. </li></ul><br>  Did not work out: <br><ul><li>  track the user's closing of the dialog box (Cancel) if the client is installed (everything works for the web dialog) - in this case the listener (see the code below) happily reported about the successful publication of the record.  The search for the solution was crowned with dubious success - if authentication is not implemented from the application itself, then in principle it is impossible to track the closing of the window without publishing the record.  Impossible from the word "absolutely."  Only for the sake of this, the processing of authorization and sessions was not wanted, so I had to get out the text of the message to the user. </li></ul><br>  What's in the code ... <br><br>  First of all, you need to add an application ID in string.xml and enter metadata in the manifest (do not forget to allow access to the Internet - this is necessary for all networks!): <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.facebook.sdk.ApplicationId"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/facebook_app_id"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  For work, you will need an auxiliary object that quite tightly ‚Äúsits down‚Äù on the methods of the life cycle.  It is needed for posting by the native client, if it is installed.  It would be possible, of course, to do only the web, but without sessions, it requires entering a password every time, which is very annoying.  And annoying the user once again is not good ... <br><br>  Tracking the success of the publication also had to write with pens.  This is where the bjaka with the client got out: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UiLifecycleHelper fbUIHelper; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ ... fbUIHelper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UiLifecycleHelper(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); fbUIHelper.onCreate(savedInstanceState); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultCode, Intent data)</span></span></span><span class="hljs-function"> </span></span>{ ... fbUIHelper.onActivityResult(requestCode, resultCode, data, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FacebookDialog.Callback() { <span class="hljs-comment"><span class="hljs-comment">//Listener for Facebook-client if installed @Override public void onError(FacebookDialog.PendingCall pendingCall, Exception error, Bundle data) { toastMessage("  "); } @Override public void onComplete(FacebookDialog.PendingCall pendingCall, Bundle data) { toastMessage("     ,   "); } }); protected void onResume() { ... fbUIHelper.onResume(); } protected void onSaveInstanceState(Bundle outState) { ... fbUIHelper.onSaveInstanceState(outState); } protected void onPause() { ... fbUIHelper.onPause(); } protected void onDestroy() { ... fbUIHelper.onDestroy(); }</span></span></code> </pre><br>  The very code of the method that will be used by the child classes is as follows: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Publish link in FaceBook * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> name - title of block * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> caption - text on bottom of block * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> description - description of link (between title and caption) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> link - http:// etc * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> pictureLink - http:// etc - link on image in web */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">facebookPublish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String caption, String description, String link, String pictureLink)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FacebookDialog.canPresentShareDialog(getApplicationContext(), FacebookDialog.ShareDialogFeature.SHARE_DIALOG)) { <span class="hljs-comment"><span class="hljs-comment">//Facebook-client is installed FacebookDialog shareDialog = new FacebookDialog.ShareDialogBuilder(this) .setName(name) .setCaption(caption) .setDescription(description) .setLink(link) .setPicture(pictureLink) .build(); fbUIHelper.trackPendingDialogCall(shareDialog.present()); } else { //Facebook-client is not installed ‚Äì use web-dialog Bundle params = new Bundle(); params.putString("name", name); params.putString("caption", caption); params.putString("description", description); params.putString("link", link); params.putString("picture", pictureLink); WebDialog feedDialog = new WebDialog.FeedDialogBuilder(this, Utility.getMetadataApplicationId(this), params) .setOnCompleteListener(new OnCompleteListener() { //Listener for web-dialog @Override public void onComplete(Bundle values, FacebookException error) { if ((values != null) &amp;&amp; (values.getString("post_id") != null) &amp;&amp; (error == null)) { toastMessage(" "); } else { toastMessage("  "); }; }; }) .build(); feedDialog.show(); } }</span></span></code> </pre><br><h2>  In contact with </h2><br>  Perhaps the most terrible documentation.  Had pretty sweat.  Moreover, it was not possible to completely get rid of the use of tokens - without them in any way.  But in order ... <br><br>  Here, too, will have to get into the manifest for the sake of one line of code: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.vk.sdk.VKOpenAuthActivity"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  The docks say softly that ‚Äú <i><u>it is worth</u> adding, otherwise there <u>may be</u> problems with the launch of the authorization activity</i> ‚Äù, but if the user does not have a VK client, the application will crash with an ActivityNotFoundException error. <br><br>  In the very class at the very beginning, you need to add a code to store the ID, access rights and authorization management: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String appId = <span class="hljs-string"><span class="hljs-string">"1234567"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Need to change to real app_id private static String vkTokenKey = "VK_ACCESS_TOKEN"; private static String[] vkScope = new String[]{VKScope.WALL}; private final VKSdkListener vkSdkListener = new VKSdkListener() { @Override public void onCaptchaError(VKError captchaError) { new VKCaptchaDialog(captchaError).show(); } @Override public void onTokenExpired(VKAccessToken expiredToken) { VKSdk.authorize(vkScope, true, false); } @Override public void onAccessDenied(VKError authorizationError) { new AlertDialog.Builder(SocialNetworkActivity.this) .setMessage(authorizationError.errorMessage) .show(); } @Override public void onReceiveNewToken(VKAccessToken newToken) { newToken.saveTokenToSharedPreferences(getApplicationContext(), vkTokenKey); } };</span></span></code> </pre><br>  Into the methods of the life cycle of Activity, this infection also penetrates deeply, although not as much as FB: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ ... VKUIHelper.onCreate(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); VKSdk.initialize(vkSdkListener, appId, VKAccessToken.tokenFromSharedPreferences(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, vkTokenKey)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resultCode, Intent data)</span></span></span><span class="hljs-function"> </span></span>{ ... VKUIHelper.onActivityResult(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, requestCode, resultCode, data); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... VKUIHelper.onResume(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... VKUIHelper.onDestroy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre><br>  However, when publishing a link, you will have to force the user to first log in and then re-press the publish button.  This is bad in terms of usability, but I haven‚Äôt found another option.  A token issued once seemed to last for about an hour.  It is hemorrhoid, but no worse than registration at every posting, as in the web dialog of FB. <br><br>  Another ambush hid where I did not expect the bases.  When debugging from Eclipse on a real device, everything worked like a clock.  But as soon as I installed the same application from Google Pleya, the VK client began to curse when posting a link: <br><br>  <i>{"Error": "invalid_request", "error_description": "sdk_fingerprint is incorrect"}</i> <br><br>  In this case, the authorization is successful, and the same application without VK client through the web works fine.  Those.  fingerprint correct.  I suspect a client glitch.  Or not a glitch, but an intentionally closed possibility, which is quite likely looking at <a href="https://github.com/VKCOM/vk-android-sdk/issues/38">this link here</a> (towards the end).  I will understand further, but if someone in the know and can help - I will be grateful. <br><br>  Another unresolved question is why the link title, visible in the preview window, is lost when it is published.  The answer did not find, alas.  Also I would be grateful for the tips. <br><br>  Posting code itself: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Publish link in Vkontakte * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> message - message about link (may be changed or deleted by user) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> link - http:// etc * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> linkName - title of link - not published (don't know why...) */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vkontaktePublish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String message, String link, String linkName)</span></span></span><span class="hljs-function"> </span></span>{ VKAccessToken token = VKAccessToken.tokenFromSharedPreferences(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, vkTokenKey); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((token == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) || token.isExpired()) { VKSdk.authorize(vkScope, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); toastMessage(<span class="hljs-string"><span class="hljs-string">" .     "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VKShareDialog() .setText(message) .setAttachmentLink(linkName, link) .setShareDialogListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VKShareDialog.VKShareDialogListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onVkShareComplete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> postId)</span></span></span><span class="hljs-function"> </span></span>{ toastMessage(<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onVkShareCancel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ toastMessage(<span class="hljs-string"><span class="hljs-string">"  "</span></span>); } }).show(getSupportFragmentManager(), <span class="hljs-string"><span class="hljs-string">"VK_SHARE_DIALOG"</span></span>); } }</code> </pre><br>  I wrote the application under the Support Library, so the code uses getSupportFragmentManager.  For versions 3.0+, you need to replace it with a call to the native method. <br><br><h2>  Code usage </h2><br>  Well, in short, that's all.  Now we inherit the desired Activity from this one and where it is required we use the xxxxPublish () calls.  You can hang the buttons, but you can on the popup menu in ActionBar (although in this case the call will not be very beautiful, but the menu itself is working): <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOptionsItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MenuItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (item.getItemId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.action_share: View view = findViewById(R.id.action_share); showPopupMenu(view, <span class="hljs-string"><span class="hljs-string">"https://play.google.com/store/apps/details?id=ru.fantaversum.taleidoscope"</span></span>, <span class="hljs-string"><span class="hljs-string">" -   "</span></span>, <span class="hljs-string"><span class="hljs-string">"  Google Play"</span></span>, <span class="hljs-string"><span class="hljs-string">"      -     .   .  ."</span></span>, <span class="hljs-string"><span class="hljs-string">"http://www.taleidoscope.ru/images/fb_logo.png"</span></span>, <span class="hljs-string"><span class="hljs-string">":  -  .       -     .   .  ."</span></span>, <span class="hljs-string"><span class="hljs-string">"  Google Play"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onOptionsItemSelected(item); }</code> </pre><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopupMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String link, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String fb_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String fb_caption, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String fb_description, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String fb_pictureLink, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String message, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String linkName)</span></span></span><span class="hljs-function"> </span></span>{ PopupMenu popup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PopupMenu(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, view); popup.getMenuInflater().inflate(R.menu.popup, popup.getMenu()); popup.setOnMenuItemClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PopupMenu.OnMenuItemClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMenuItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MenuItem menuItem)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (menuItem.getItemId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.menu_facebook: facebookPublish(fb_name, fb_caption, fb_description, link, fb_pictureLink); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.menu_vkontakte: vkontaktePublish(message, link, linkName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.menu_googleplus: googleplusPublish(message, link); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }); popup.show(); }</code> </pre><br>  The source code of the whole Activity can be downloaded <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/243411/">https://habr.com/ru/post/243411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243401/index.html">Customize viewing of individual Issue in Atlassian Jira</a></li>
<li><a href="../243403/index.html">A brief synopsis of javascript</a></li>
<li><a href="../243405/index.html">Game hackathon, December 6-7, Moscow</a></li>
<li><a href="../243407/index.html">Odroid-W + W Docking Board LCD</a></li>
<li><a href="../243409/index.html">Secrets of setting goals for entrepreneurs</a></li>
<li><a href="../243413/index.html">Configuring Virtual Infrastructure: VDI Cluster Optimization</a></li>
<li><a href="../243417/index.html">Ethernet Weather Station 2 - Continued ...</a></li>
<li><a href="../243419/index.html">Turing test based on real search queries in Yandex</a></li>
<li><a href="../243421/index.html">Print from Google Apps Script</a></li>
<li><a href="../243423/index.html">New IBM Global Entrepreneurship Program Accelerates Cloud Development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>