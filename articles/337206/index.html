<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DPM: Why does he look like a bow?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article we talked about the history of the development of Microsoft Data Protection Manager. Today we offer to go further. You will learn ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DPM: Why does he look like a bow?</h1><div class="post__text post__text-html js-mediator-article">  In the last article we talked about the history of the development of Microsoft Data Protection Manager.  Today we offer to go further.  You will learn how it works technically, with a peek at the scary beast of the VSS. <br><br><img src="https://habrastorage.org/web/b25/b3b/973/b25b3b973d4846d390f350f9a581e307.jpg"><br><a name="habracut"></a><br>  I give the floor to the author of the article, <a href="https://habrahabr.ru/users/khabarovdaniil/" class="user_link">khabarovdaniil</a> (Daniel Khabarov). <br><blockquote>  The outline of the whole story is: <br>  In the <b><a href="https://habrahabr.ru/company/microsoft/blog/332622/">first</a></b> part we will talk about the historical context of <b>Microsoft Data Protection Manager</b> , and why it is so. <br>  In the <b>second</b> - how he works technically, with a peek at the terrible beast VSS. <br>  But in the <b>third</b> - the current state of affairs that he knows how and how we can use it, including with Microsoft Azure Backup. </blockquote>  Hello, community, this is me again, and today, as promised, we will talk about how DPM works inside. <br><br>  I was always pleased with the way DPM can work with disks, and even more pleased with answering the questions of the format: ‚ÄúWhy does he create so many disks‚Äù, ‚ÄúHow can you deal with their number‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Microsoft Data Protection Manager and bow </h2><br>  So, in order to understand why and how DPM works, you need to understand the basic things associated with the wonderful VSS technology.  As the <a href="https://technet.microsoft.com/en-us/library/ee923636.aspx">Technet</a> website tells us.  We will be interested in the following things here: <br><br>  VSS is a framework that allows you to perform backup operations while the application continues to run and write to the volume.  At its core, it consists of three large elements: <br><br><ul><li>  VSS writer </li><li>  VSS provider </li><li>  Vss requestor </li></ul><br>  And in the picture it looks like this: <br><br><img src="https://habrastorage.org/web/2f6/6d2/99c/2f66d299cafc48f5b4d840def029f3c2.png"><br><br>  It makes sense to talk more about them when describing how the application‚Äôs backup mechanism works, and now we need to understand how this relates to the organization of storing backup copies on disks. <br><br>  So, if you try and give analogies, the VSS is very much like a bow.  Yes, yes, that same bow from the Shrek cartoon, and precisely because it is multi-layered.  Each layer of VSS onions is the so-called DiffArea, which, being added together, turn from scattered elements into a whole onion. <br><br>  To create a backup and burn it to disk, DPM, as you know, creates 2 volumes.  On one volume is stored, the so-called initial backup, the same one that is created during the initial synchronization.  In the usual terminology, this will be Full Backup.  In order to make a backup copy up-to-date, DPM performs regular synchronization, which you specify when you create a Protection Group. <br><br><h2>  We turn to magic </h2><br>  But then the magic of that very ‚ÄúShrekovsky‚Äù bow begins.  On the second volume, which is empty at the time of creating the original copy, the so-called DiffArea begins to be created.  Contrary to your expectation, historical data is stored on DiffArea, not changes.  That is, it looks like this: <br><br>  1. Initial synchronization has occurred, we have data: <br><img src="https://habrastorage.org/web/46b/a84/47a/46ba8447aac8446eb755f59ec9b8a256.png"><br>  2. At time 1, the first DiffArea1 was created, which stores the initial state of the disk: <br><img src="https://habrastorage.org/web/9b0/e87/a00/9b0e87a00162454982fe9d4a8a5b59c6.png"><br>  3. Similar to the previous figure: <br><img src="https://habrastorage.org/web/082/a96/6c7/082a966c77704255a7b989ae9c9eaa48.png"><br>  4. Similar to the previous figure: <br><img src="https://habrastorage.org/web/730/fbd/c84/730fbdc840a64dd4a6911150bcebddde.png"><br>  5. Final state of the disk: <br><img src="https://habrastorage.org/web/7d3/c16/a8f/7d3c16a8f1154164bc119041031c924f.png"><br><br>  Each new DiffArea stores historical data about the previous state.  Thus, we get approximately such a comic as shown above.  To get the initial state of the data <b>AAAAAAA</b> we need to lay down all the layers sequentially (visually following the illustrations). <br><br>  Each of you who reads these lines, of course, is interested in where this data is stored.  And here we will return to the data allocation options provided by VSS.  In general, it allows very flexible and convenient to place data.  In case we consider the work of VSS inside DPM, then the scheme looks like this: <br><br><img src="https://habrastorage.org/web/463/330/463/4633304638134ba39ca14aacdf9766a6.png"><br><br>  This illustration shows that we have data on one server, as well as shadow copies.  They can be split using different VSS contexts across different volumes, or stored on the same one.  Anyone who, in one way or another, used the backup service even at the level of the home operating system, watched it work.  Shadow copies are saved to disk, but not visible when viewed by conventional means, and do not even take up space, according to Disk Manager. <br><br>  Using the VSS context, you can also set other parameters, such as: whether you can mount a shadow copy, whether this is a backup copy of the application, and much more.  The bottom line is that using the context you set the basic rules by which you can continue to work with these backups.  This is set at the application level, and DPM in our case. <br><br>  For reverent readers who want to know in detail how VSS works, we can continue the cycle of stories in the future. <br><br><div class="spoiler">  <b class="spoiler_title">But for those who want to see the whole picture at once, I‚Äôm happy to cite reference material, which quite fully describes the principle of VSS operation.</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/71d/1a4/ad4/71d1a4ad4db34337a5dda48a067b1c38.png"><br></div></div><br>  And completing the topic of VSS, I would like to add that it provides a huge number of opportunities that are often unknown, or not interesting to the average person, but nevertheless, working with external Hardware Providers, with different LUNs, various picture contexts, and the mechanism creating a bitmap always made me happy for technological progress and backup capabilities. <br><br><h2>  Total </h2><br>  If we apply all of the above to the practical meaning of DPM, then we get the following: <br><ol><li>  The number of DPM disks is determined solely by the system and cannot be directly corrected by the user.  In this regard, many administrators have in addition to many questions, and many problems: <br>  a.  Logical Disk Manager under certain circumstances, can prevent the creation of backup copies.  The bottom line is that LDM has limitations because it cannot support more than 2,950 disks.  This applies to all drives, including physical.  To avoid this, good protection group planning is needed. <br>  b.  The number of shadow copies is limited.  As many know, the maximum number of shadow copies is 64. This means that if you want to make a large number of copies on a disk, you need to look for alternatives. </li><li>  DPM uses only standard backup mechanisms, which are provided by the OS, and therefore there are all the above limitations.  The advantage of this solution is in the unconditional backup support from the point of view of all MS technologies.  It is because of this that we have a full opportunity to use DPM for AD backup, which is one of the biggest advantages of using it in a corporate environment. </li></ol><br>  At the end of my story, I want to note that next time we will talk about DPM 2016, its new features, and if the esteemed audience shows interest in our series, we will be able to talk about possible solutions to the above mentioned problems, as well as some poorly documented opportunities. <br><br>  I really hope that I could explain in comics how it works and why it is so. <br><br>  Thank you all for your attention, and see you soon! </div><p>Source: <a href="https://habr.com/ru/post/337206/">https://habr.com/ru/post/337206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337194/index.html">Climbing an Unbowed Mountain: The Difficulties of Creating a Game Alone</a></li>
<li><a href="../337196/index.html">Another git tutorial</a></li>
<li><a href="../337200/index.html">Step by Step Plan for Upwork # 2</a></li>
<li><a href="../337202/index.html">The ideal OS: rethinking the operating systems for the desktop</a></li>
<li><a href="../337204/index.html">35 Gbps - as Megafon and Huawei set a 5G speed record</a></li>
<li><a href="../337210/index.html">My experience of shooting a 360¬∫ panorama on film</a></li>
<li><a href="../337212/index.html">Why JavaScript security analysis cannot be truly automated?</a></li>
<li><a href="../337214/index.html">The orientation of the mobile robot, the choice of method of registration of special points of images</a></li>
<li><a href="../337216/index.html">"Rock is hard" or ya. Music as a graph</a></li>
<li><a href="../337218/index.html">Business game Kanban-pizza in the office Tutu.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>