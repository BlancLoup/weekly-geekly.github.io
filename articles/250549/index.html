<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The boot server - as a bootable USB flash drive, only the server and the network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A bootable USB flash drive with a set of necessary software is a great tool for the system administrator. It would seem, what could be better? A bette...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The boot server - as a bootable USB flash drive, only the server and the network</h1><div class="post__text post__text-html js-mediator-article">  A bootable USB flash drive with a set of necessary software is a great tool for the system administrator.  It would seem, what could be better?  A better may be the boot server! <br><br>  Imagine you have chosen to boot the network in the BIOS and can install the OS / disinfect the computer from viruses / reanimate disks / test the RAM / etc from the PXE Boot server, because this is much more convenient than running with a USB flash drive from the machine to the machine. <br>  And in the case of a large computer park, such a tool is indispensable. <br><br>  This is the menu that meets <a href="https://serverclub.ru/">our</a> engineering <a href="https://serverclub.ru/">team</a> when booting from PXE. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/fd1/6e4/934/fd16e49345754c8cb23ca89fe279d2c0.png" height="480" width="640"><br><br>  Under the cut you will find a description of all the settings, as well as a small surprise. <br><a name="habracut"></a><br><h2>  Start </h2><br>  Let's take as a basis that a freshly installed Debian Wheezy already winks cheerfully at us with the console. <br>  Prepare the base for further manipulations.  Install and configure we need: <br><br><ol><li>  TFTP server </li><li>  Samba </li><li>  Syslinux </li><li>  DHCP server </li><li>  HTTP server </li><li>  NFS server </li></ol><br><br>  <b>1. TFTP</b> <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install tftpd-hpa</span></span></code> </pre> <br>  we will give config <code>/etc/default/tftpd-hpa</code> to the form <br><pre> <code class="bash hljs">TFTP_USERNAME=<span class="hljs-string"><span class="hljs-string">"tftp"</span></span> TFTP_DIRECTORY=<span class="hljs-string"><span class="hljs-string">"/srv/tftp"</span></span> <span class="hljs-comment"><span class="hljs-comment">#   tftp TFTP_ADDRESS="0.0.0.0:69" TFTP_OPTIONS="--secure -l -v -m /etc/tftpd.remap" #       windows style  linux style</span></span></code> </pre><br>  and put in <code>/etc/tftpd.remap</code> just such a line <br><pre> <code class="bash hljs">rg \\ /</code> </pre> <br>  <b>UPD, supplement from reader Aleksey Shipilev</b> <br><blockquote>  I pulled my hair while tftp otdebezhil. <br>  What on the ThinkPad X201i, that in VirtualBox the download fell off with: <br>  PXE-E32: TFTP Open timeout <br><br>  Apparently, the PXE agents managed to be incompletely compatible, treated by adding "-r blksize": <br>  TFTP_OPTIONS = "- secure -l -v -r blksize" <br></blockquote><br><br>  <b>2. Samba</b> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install samba</span></span></code> </pre> <br>  At the end of the <code>/etc/samba/smb.conf</code> file we will add information about the folder where the Windows installation files will be located. <br><pre> <code class="bash hljs">[images] comment = images path = /srv/tftp/images create mask = 0660 directory mask = 0771 writable = yes guest ok=yes</code> </pre><br>  Create a folder, give rights and restart samba <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /srv/tftp/images # chmod 777 /srv/tftp/images # service samba restart</span></span></code> </pre><br><br>  <b>3. Syslinux</b> <br>  Download and upload everything you need to the root of the TFTP server. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /tmp # wget https://www.kernel.org/pub/linux/utils/boot/syslinux/4.xx/syslinux-4.02.tar.gz #       ESXi # tar -xf syslinux-4.02.tar.gz # cd syslinux-4.02/ # find ./ -name "memdisk" -type f|xargs -I {} cp '{}' /srv/tftp/ # find ./ -name "pxelinux.0"|xargs -I {} cp '{}' /srv/tftp/ # find ./ -name "*.c32"|xargs -I {} cp '{}' /srv/tftp/</span></span></code> </pre><br>  Go to the setting <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /srv/tftp/ # mkdir pxelinux.cfg # cd pxelinux.cfg</span></span></code> </pre><br>  Create a config of the main menu and enter the initial settings <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat &gt; default ui vesamenu.c32 PROMPT 0 menu background background.jpg menu title ServerClub PXE boot menu LABEL bootlocal menu label Boot from first HDD kernel chain.c32 append hd0 0 timeout 120 TEXT HELP The system will boot after the time is up ENDTEXT</span></span></code> </pre><br><br>  <b>4. DHCP</b> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install isc-dhcp-server</span></span></code> </pre><br>  move the default config, create your own instead and restart the DHCP daemon <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mv /etc/dhcp/dhcpd.conf{,_orig} # cat &gt; /etc/dhcp/dhcpd.conf option domain-name-servers 8.8.8.8, 8.8.4.4; option ip-forwarding on; default-lease-time 60; min-lease-time 120; max-lease-time 300; authoritative; ddns-update-style interim; log-facility local7; shared-network PXE-Netwotk { subnet 10.0.10.0 netmask 255.255.255.0 { range 10.0.10.10 10.0.10.254; option routers 10.0.10.1; option subnet-mask 255.255.255.0; option domain-name-servers 8.8.8.8, 8.8.4.4; filename "pxelinux.0"; next-server 10.0.10.1; option root-path "10.0.10.1:/srv/tftp/"; } } # service isc-dhcp-server restart</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Spoiler for those who have MikroTik as the DHCP server</b> <div class="spoiler_text"> <code>address=10.0.10.0/24 gateway=10.0.10.1 dns-server=8.8.8.8, 8.8.4.4 wins-server="" ntp-server=212.20.50.208 caps-manager="" domain="domain.local" next-server=10.0.10.1 boot-file-name="pxelinux.0" dhcp-option="" <br></code> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Spoiler for those who have DHCP on Cisco</b> <div class="spoiler_text"><pre> <code class="bash hljs">network &lt;ip &gt; &lt;&gt; ip dhcp pool &lt; &gt; bootfile pxelinux.0 next-server &lt;IP  tftp&gt; default-router &lt;&gt; option 66 ascii ¬´ ¬ª dns-server &lt;DNS &gt; option 150 &lt;IP  tftp&gt; domain-name &lt; &gt;</code> </pre><br></div></div><br>  It is also worth noting that in this installation, the north has two network cards and it is also the gateway to the Internet. <br><div class="spoiler">  <b class="spoiler_title">Therefore, a number of simple manipulations are needed.</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sed -i 's/\#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g' /etc/sysctl.conf # sysctl -p # iptables -t nat -I POSTROUTING -s 10.0.10.0/24 -o eth0 -j MASQUERADE # sed -i 's/INTERFACES=\"\"/INTERFACES=\"eth1\"/g' /etc/default/isc-dhcp-server # service isc-dhcp-server restart</span></span></code> </pre><br></div></div><br><br>  <b>5. HTTP</b> <br>  For now, just install, and why we need it will be understood further in the text. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install apache2</span></span></code> </pre><br><br>  <b>6. NFS</b> <br>  Exactly the same as the previous paragraph. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># aptitude install nfs-kernel-server</span></span></code> </pre><br>  If everything is done correctly, then when booting any machine from this DHCP / PXE / TFTP server, we will see the following: <br><br><img src="https://habrastorage.org/files/9c6/35c/3aa/9c635c3aae554dabb0c568d32a3af571.png" height="480" width="640"><br><br>  The base is ready! <br><br>  Moving on. <br><br><br><h2>  Let's teach the server to install various OS </h2><br>  For installation we will be available: <br><br><ol><li>  Windows 2008R2 / 20012R2 </li><li>  Debian 6/7 </li><li>  Centos 6/7 </li><li>  Ubuntu 12.04 / 12.10 / 14.04 / 14.10 </li><li>  FreeBSD 9.2 / 10.1 </li><li>  VMware ESXi 5.0 / 5.5 </li></ol><br><br>  The menu structure, and therefore the <code>/srv/tftp/pxelinux.cfg/default</code> file, <code>/srv/tftp/pxelinux.cfg/default</code> suffered changes. <br><div class="spoiler">  <b class="spoiler_title">Now the PXE server main menu config now looks like this</b> <div class="spoiler_text"><pre> <code class="bash hljs">ui vesamenu.c32 PROMPT 0 menu background background.jpg menu title ServerClub PXE boot menu LABEL bootlocal menu label Boot from first HDD kernel chain.c32 append hd0 0 timeout 120 TEXT HELP The system will boot after time is up. ENDTEXT LABEL Windows -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/windows LABEL Linux -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/linux LABEL FreeBSD -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/bsd LABEL VMvare -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/vmware</code> </pre><br></div></div><br>  Listing directory <code>/srv/tftp/pxelinux.cfg/</code> <br><pre> <code class="bash hljs">root@pxe:/srv/tftp/pxelinux.cfg<span class="hljs-comment"><span class="hljs-comment"># ls -l total 32 -rw-r--r-- 1 tftp tftp 475  17 18:04 bsd -rw-r--r-- 1 tftp tftp 881  17 18:00 default -rw-r--r-- 1 tftp tftp 1316  17 18:01 linux -rw-r--r-- 1 tftp tftp 363  17 18:03 vmware -rw-r--r-- 1 tftp tftp 312  18 00:01 windows</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Under the spoiler, the contents of the config of each of the sub-items of the menu above</b> <div class="spoiler_text">  <b>windows</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE Windows LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL W2K8_x64_R2 &amp; W2K12_x64_R2 (menu inside) kernel Boot/pxeboot.0 LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</code> </pre><br>  <b>linux</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE Linux LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL Debian-7-x64 kernel debian/7/linux append initrd=debian/7/initrd.gz LABEL Debian-6.0.6-x64 kernel debian/6/linux append initrd=debian/6/initrd.gz LABEL CentOS-7-x64 kernel centos/7/vmlinuz append initrd=centos/7/initrd.img method=http://mirror.mirohost.net/centos/7/os/x86_64/ devfs=nomount ksdevice=link ramdisk_size=100000 LABEL CentOS-6-x64 kernel centos/6/vmlinuz append initrd=centos/6/initrd.img method=http://mirror.mirohost.net/centos/6/os/x86_64/ devfs=nomount ksdevice=link ramdisk_size=100000 LABEL Ubuntu-14.10-x64 kernel ubuntu/14.10/linux append initrd=ubuntu/14.10/initrd.gz expert dmraid=<span class="hljs-literal"><span class="hljs-literal">true</span></span> LABEL Ubuntu-14.04-x64 kernel ubuntu/14.04/linux append initrd=ubuntu/14.04/initrd.gz expert dmraid=<span class="hljs-literal"><span class="hljs-literal">true</span></span> LABEL Ubuntu-12.10-x64 kernel ubuntu/12.10/linux append initrd=ubuntu/12.10/initrd.gz expert dmraid=<span class="hljs-literal"><span class="hljs-literal">true</span></span> LABEL Ubuntu-12.04_4-x64 kernel ubuntu/12.04_4/linux append initrd=ubuntu/12.04_4/initrd.gz expert dmraid=<span class="hljs-literal"><span class="hljs-literal">true</span></span> LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</code> </pre><br>  <b>bsd</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE BSD LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL FreeBSD-10.1-x64 kernel memdisk initrd freebsd/10/mfsbsd-se-10.1-RELEASE-amd64.iso append iso raw LABEL FreeBSD-9.2-x64 kernel memdisk initrd freebsd/9/fbsd92.iso append iso raw LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</code> </pre><br>  <b>vmware</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE VMware LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL VMware-5.5 kernel vmw/5.5/mboot.c32 append -c /vmw/5.5/boot.cfg ks=http://10.0.10.1/vmw5.5/ks.cfg +++ LABEL VMware-5.0 kernel vmw/5.0/mboot.c32 append -c /vmw/5.0/boot.cfg ks=http://10.0.10.1/vmw5.0/ks.cfg +++ LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</code> </pre><br></div></div><br>  The paths to the folders where the installation files for each OS are located are described relative to the root of the TFTP server, i.e.  <code>/srv/tftp</code> . <br>  For example, for FreeBSD, <br><pre> <code class="bash hljs">LABEL FreeBSD-10.1-x64 kernel memdisk initrd freebsd/10/mfsbsd-se-10.1-RELEASE-amd64.iso append iso raw</code> </pre><br>  therefore, you need to create <code>freebsd/10/</code> folders in the root of TFTP, while paying attention to the rights <br><pre> <code class="bash hljs">ls -l /srv/tftp/freebsd/10/ total 193780 -rw-r--r-- 1 tftp tftp 198430720  17 18:17 mfsbsd-se-10.1-RELEASE-amd64.iso</code> </pre><br>  Everyone should have the right to read - this rule applies to all files sent via TFTP. <br>  And a couple of words about installing FreeBSD. <br>  Login / password to enter the downloadable iso: root / mfsroot (or root without a password). <br>  Plus a couple of examples of FreeBSD install scripts on ZFS: <br>  1. <a href="http://blog.serverclub.ru/page/ustanovka-freebsd-93-na-zfs-s-programnym-raid6-iz-4-h-diskov">RAID6 of 4 disks</a> . <br>  2. <a href="http://blog.serverclub.ru/page/ustanovka-freebsd-10-na-zfs-zerkalo-iz-dvuh-diskov">RAID1 from 2 disks</a> . <br><br>  About how to prepare Windows for installation with PXE, we <a href="http://habrahabr.ru/company/serverclub/blog/213007/">wrote</a> earlier. <br>  The difference with this installation is only that here we can install both Windows 2008R2 and Windows 2012R2 (however, Windows 7/8 too, you just need to prepare the distribution files and winpe accordingly).  After downloading winpe, we mount the <code>/srv/tftp/images/</code> folder, which contains the files for installing the Microsoft OS: <br><pre> <code class="bash hljs">ls -l /srv/tftp/images/ total 8 drwxr-xr-x 6 root root 4096  17 22:19 w2k12r2 drwxr-xr-x 7 tftp tftp 4096  17 19:05 w2k8r2</code> </pre><br>  and run the desired installer. <br>  To automate, via startnet.cmd, I sketched this menu: <br><br><img src="https://habrastorage.org/files/95e/d57/d43/95ed57d4363f4227a74c57cdbec63d61.png" height="480" width="640"><br><br>  Now it remains to deal with VMware. <br>  As you noticed, the config for installing hypervisors is somewhat different from the rest - this is where we need the HTTP server. <br>  In <code>/var/www</code> we will create folders vmw5.5, vmw5.0, and in folders we will make symlinks on config <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /var/www # mkdir vmw5.5 # cd vmw5.5/ # ln -s /srv/tftp/vmw/5.5/ks.cfg # mkdir ../vmw5.0 # cd ../vmw5.0/ # ln -s /srv/tftp/vmw/5.0/ks.cfg</span></span></code> </pre><br>  How to prepare, for example, Debian for installation with PXE is written <a href="https://wiki.debian.org/PXEBootInstall">here</a> , but I will not dwell on this. <br><br><br><h2>  Add the ability to load various disk utilities and memory test </h2><br>  This section will contain: <br><ol><li>  Memtest86 + </li><li>  Clonezilla-live </li><li>  SystemRescueCD </li><li>  Mhdd </li></ol><br><div class="spoiler">  <b class="spoiler_title">Configs are located here.</b> <div class="spoiler_text">  <b>default</b> <br><pre> <code class="bash hljs">ui vesamenu.c32 PROMPT 0 menu background background.jpg menu title ServerClub PXE boot menu LABEL bootlocal menu label Boot from first HDD kernel chain.c32 append hd0 0 timeout 120000 TEXT HELP The system will boot after time is up. ENDTEXT LABEL Windows -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/windows LABEL Linux -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/linux LABEL FreeBSD -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/bsd LABEL VMvare -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/vmware LABEL HDD and RAM utils -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/du</code> </pre><br>  <b>du</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE HDD and RAM utils LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL Memtest86+ kernel memtest/memtest label Clonezilla-live MENU LABEL Clonezilla Live KERNEL clonezilla/vmlinuz APPEND initrd=clonezilla/initrd.img boot=live config noswap nolocales edd=on nomodeset ocs_live_run=<span class="hljs-string"><span class="hljs-string">"ocs-live-general"</span></span> ocs_live_extra_param=<span class="hljs-string"><span class="hljs-string">""</span></span> keyboard-layouts=<span class="hljs-string"><span class="hljs-string">""</span></span> ocs_live_batch=<span class="hljs-string"><span class="hljs-string">"no"</span></span> locales=<span class="hljs-string"><span class="hljs-string">""</span></span> vga=788 nosplash noprompt fetch=tftp://10.0.10.1/clonezilla/filesystem.squashfs label SystemRescueCD kernel SystemRescueCD/isolinux/rescue64 append initrd=SystemRescueCD/isolinux/initram.igz dodhcp nfsboot=10.0.10.1:/srv/tftp/SystemRescueCD LABEL MHDD kernel memdisk initrd mhdd/mhdd32ver4.6.iso append iso raw LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</code> </pre><br></div></div><br>  And I will tell you why we also installed the NFS server. <br>  As can be seen from the SystemRescueCD download config, it pulls the files that this LiveCD needs by mounting the directory using the NFS protocol.  The server is already installed, it remains only to edit / etc / exports and restart the server daemon. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat &gt;&gt; /etc/exports /srv/tftp/SystemRescueCD/ 10.0.10.1/255.255.255.0(ro,no_subtree_check,all_squash,insecure,anonuid=1000,anongid=1000) # service nfs-kernel-server restart</span></span></code> </pre><br>  I guess you have a reasonable question - ‚ÄúWhat is the LiveCD doing here, if there is a separate item for them?‚Äù <br>  SystemRescueCD contains a lot of useful programs for working with the disk (for example, such as GParted and testdisk) and therefore it is available here and in the LiveCD. <br><br><br><h2>  Livecd </h2><br>  Our LiveCD set will include: <br><ol><li>  Debian 7 LiveCD </li><li>  HirensBootCD </li><li>  Trinity Rescue Kit CD </li><li>  SystemRescueCD </li><li>  Plop Live </li></ol><br><div class="spoiler">  <b class="spoiler_title">Configs</b> <div class="spoiler_text">  at the end of the <b>default was</b> added <br><pre> <code class="bash hljs">LABEL LiveCDs -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/livecds</code> </pre><br>  <b>livecds</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE LiveCDs LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL Debian LiveCD KERNEL Debian7live/vmlinuz APPEND initrd=Debian7live/initrd boot=live fetch=tftp://10.0.10.1/Debian7live/filesystem.squashfs root=/dev/ram0 rw LABEL HirensBootCD MENU LABEL Hiren<span class="hljs-string"><span class="hljs-string">'s Boot CD KERNEL memdisk APPEND iso initrd=hirens/hirens.iso LABEL Trinity Rescue Kit CD kernel trk/kernel.trk append initrd=trk/initrd.trk ramdisk_size=65536 root=/dev/ram0 vga=788 splash=verbose pci=conf1 trkmenu timeout 100 trknfs=10.0.10.1:/srv/tftp/trk ip=dhcp LABEL SystemRescueCD kernel SystemRescueCD/isolinux/rescue64 append initrd=SystemRescueCD/isolinux/initram.igz dodhcp nfsboot=10.0.10.1:/srv/tftp/SystemRescueCD LABEL Plop Live KERNEL plop/bzImage APPEND initrd=plop/initramfs.gz vga=normal nfsmount=10.0.10.1:/srv/tftp/plop LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</span></span></code> </pre><br><br>  To boot the Trinity Rescue Kit CD and Plop Live into <code>/etc/exports</code> you need to add the lines: <br><pre> <code class="bash hljs">/srv/tftp/trk/ 10.0.10.1/255.255.255.0(ro,no_subtree_check,all_squash,insecure,anonuid=1000,anongid=1000) /srv/tftp/plop/ 10.0.10.1/255.255.255.0(ro,no_subtree_check,all_squash,insecure,anonuid=1000,anongid=1000)</code> </pre><br>  and send the NFS restart command to the daemon. <br></div></div><br>  A few words about the selected LiveCD. <br>  <i>Debian 7 LiveCD</i> <br>  This CD is an assembly of one of our engineers, including the following: <br><br><img src="https://habrastorage.org/files/c2b/4f4/6f5/c2b4f46f580d407ba36f62bbf56f05ca.png" height="480" width="640"><br><br>  Login / Password: root / ServerClub <br><br>  <i>HirensBootCD</i> <br>  Hardly needs a presentation, contains many useful utilities. <br>  More details can be found <a href="http://www.hirensbootcd.org/about/">here</a> . <br>  Loads for a long time, MiniXP and Linux are not working.  The remaining utilities are available for use. <br><br>  <i>Trinity Rescue Kit CD</i> <br>  According to the developers, created to restore Windows. <br>  It contains utilities for resetting passwords, antiviruses, a program for cloning a ‚Äúcomputer‚Äù over the network (and to several computers at the same time), and much more. <br>  Read more <a href="http://trinityhome.org/Home/index.php%3Fcontent%3DTRINITY_RESCUE_KIT____CPR_FOR_YOUR_COMPUTER%26front_id%3D12%26lang%3Den%26locale%3Den">here</a> . <br><br>  <i>SystemRescueCD</i> <br>  Based on Gentoo, designed to restore Linux systems. <br>  Includes a large number of various programs for administration, with a list can be found on the <a href="http://www.sysresccd.org/Detailed-packages-list">link</a> . <br><br>  <i>Plop Live</i> <br>  LiveCD with three full-fledged DE to choose from, as well as the necessary admin <a href="http://www.plop.at/en/ploplinux/live/features.html">software</a> . <br><br><br><br><h2>  Antivirus </h2><br><ol><li>  Kaspersky Rescue Disk 10 <br><img src="https://habrastorage.org/files/078/ca9/f3e/078ca9f3e3b8485d8be5b39195c81e34.png" height="480" width="640"><br><br></li><li>  AVG Rescue CD <br><img src="https://habrastorage.org/files/839/deb/d4c/839debd4c6994fafbd01fcf7bf257a29.png" height="480" width="640"><br></li></ol><br>  In a separate presentation, both antivirus do not need. <br>  You can read more about Kaspersky Rescue disk <a href="http://support.kaspersky.com/viruses/rescuedisk">here</a> . <br>  The description of the AVG Recsue CD will be introduced to you by <a href="http://www.avg.com/ru-ru/avg-rescue-cd">this url</a> . <br><br><div class="spoiler">  <b class="spoiler_title">The final configuration file of the main menu, as well as the antivirus menu file</b> <div class="spoiler_text">  <b>default</b> <br><pre> <code class="bash hljs">ui vesamenu.c32 PROMPT 0 menu background background.jpg menu title ServerClub PXE boot menu LABEL bootlocal menu label Boot from first HDD kernel chain.c32 append hd0 0 timeout 120000 TEXT HELP The system will boot after time is up. ENDTEXT LABEL Windows -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/windows LABEL Linux -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/linux LABEL FreeBSD -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/bsd LABEL VMvare -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/vmware LABEL HDD and RAM utils -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/du LABEL LiveCDs -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/livecds LABEL Antiviruses -&gt; KERNEL vesamenu.c32 APPEND pxelinux.cfg/av</code> </pre><br>  <b>av</b> <br><pre> <code class="bash hljs">PROMPT 0 UI vesamenu.c32 MENU BACKGROUND background.jpg MENU TITLE Antivirues LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default LABEL Kaspersky Antivirus KERNEL kav/rescue APPEND initrd=kav/rescue.igz root=live rootfstype=auto vga=791 init=/init kav_lang=ru udev liveimg doscsi nomodeset LABEL Kaspersky Antivirus (text mode) KERNEL kav/rescue APPEND initrd=kav/rescue.igz root=live rootfstype=auto vga=791 init=/init kav_lang=ru udev liveimg nox kavshell noresume doscsi nomodeset label AVG menu label AVG Rescue CD kernel avg/vmlinuz append max_loop=255 vga=791 initrd=avg/initrd.lzm init=linuxrc reboot=bios label AVG nofb menu label AVG Rescue CD with Disabled Framebuffer kernel avg/vmlinuz append max_loop=255 video=vesafb:off initrd=avg/initrd.lzm init=linuxrc reboot=bios label AVG vgask menu label AVG Rescue CD with Resolution Selection kernel avg/vmlinuz append max_loop=255 initrd=avg/initrd.lzm init=linuxrc vga=ask reboot=bios LABEL &lt;- Main Menu KERNEL vesamenu.c32 APPEND pxelinux.cfg/default</code> </pre><br></div></div><br><br><br><h2>  Conclusion, it is also a surprise </h2><br>  Throughout the article, I deliberately gave no explanation where to get and how to prepare the content, because these actions are very trivial and would only overload the text. <br><br>  As a surprise, I offer you two versions of our assembly, available on the links below: <br><ol><li>  Archive with all content / srv / tftp ( <a href="https://yadi.sk/d/eNc6IEB2qikrc">link to torrent file</a> , <a href="">direct link</a> ) </li><li>  Archive of the entire OS ( <a href="https://yadi.sk/d/E4Zvwr9Zqikrk">link to torrent file</a> , <a href="">direct link</a> ) </li></ol><br>  In the first case, you must prepare the server yourself (this will help the ‚ÄúBeginning‚Äù chapter of this epic), unzip the contents of the archive and make adjustments according to the realities of your environment. <br><br>  The second case involves installing on bare metal or a virtual machine. <br>  In brief, the steps for deploying an assembly from the full OS archive are as follows: <br>  1. Boot from the Linux LiveCD. <br>  2. Mark the disk and format the partitions. <br>  3. Mount the "/" section. <br>  4. Unpack the archive. <br>  5. Install the bootloader. <br>  6. Reboot. <br>  7. Configure the OS to fit your network and start using. <br>  Login / password: root / ServerClub. <br>  IMPORTANT: If your network has a working dhcp server, then before starting our build, disable dhcp autostart in it. <br><br><h2>  useful links </h2><br>  <a href="http://www.richud.com/wiki/Kaspersky_Rescue_Disk_10_PXE_Boot">How to prepare Kaspersky Rescue disk 10 for PXE boot</a> <br>  <a href="http://www.syslinux.org/wiki/index.php/SYSLINUX">Wiki syslinux</a> <br>  <a href="https://pubs.vmware.com/vsphere-50/index.jsp%3Ftopic%3D%252Fcom.vmware.vsphere.install.doc_50%252FGUID-B5B94727-3B79-45C0-90DB-5EB6FC4905C3.html">How to prepare ESXi for installation with PXE</a> <br>  <a href="http://www.routereflector.com/2014/01/unattended-vmware-esxi-installation-via-pxe-boot-and-kickstart/">ESXi Insight is not loaded with PXE.</a>  <a href="http://www.routereflector.com/2014/01/unattended-vmware-esxi-installation-via-pxe-boot-and-kickstart/">Decision</a> <br>  <a href="http://www.cyclelicio.us/2015/vsphere-5-network-pxe-install/">What does the ESXi insight not load from PXE?</a>  <a href="http://www.cyclelicio.us/2015/vsphere-5-network-pxe-install/">Decision</a> <br><br><h3>  For this I finish, thank you for your attention! </h3><br>  For those who do not have an account on Habr√©. <br>  If you have any questions / comments, please email me at er [dog] serverclub.com. </div><p>Source: <a href="https://habr.com/ru/post/250549/">https://habr.com/ru/post/250549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250535/index.html">Annual Review: What's new for eBay?</a></li>
<li><a href="../250537/index.html">PIC16F1503. Wheelbarrow for pumping - 3. Power</a></li>
<li><a href="../250539/index.html">Making an online cinema for the blind (WCAG 2.0 AAA)</a></li>
<li><a href="../250541/index.html">Wiring diagrams with LaTeX and TikZ</a></li>
<li><a href="../250545/index.html">Intel¬Æ Graphics Technology. Part II: ‚Äúunload‚Äù calculations on graphics</a></li>
<li><a href="../250551/index.html">Overview of the site for testing web vulnerabilities OWASP Top-10 for example bWAPP</a></li>
<li><a href="../250553/index.html">February 14 - the day of the programmer</a></li>
<li><a href="../250555/index.html">Putting the glove to determine the position of the hands themselves</a></li>
<li><a href="../250557/index.html">Practical programming of artificial intelligence</a></li>
<li><a href="../250561/index.html">Change postal codes for three-word addresses using reverse geocoding</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>