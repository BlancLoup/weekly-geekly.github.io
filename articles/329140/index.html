<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exception hierarchy in modern PHP application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task of publication: it is possible to describe the way of organizing the hierarchy of exceptions and their processing in the application. Without...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exception hierarchy in modern PHP application</h1><div class="post__text post__text-html js-mediator-article"><p>  The task of publication: it is possible to describe the way of organizing the hierarchy of exceptions and their processing in the application.  Without reference to frameworks and specific architecture.  The described method is the de facto standard in the community: it is used in many serious libraries and frameworks.  Including Zend, symfony.  Despite its consistency and universality, I did not find a formal description of the proposed approach in Russian.  After repeated oral presentation of the concept to colleagues, the idea was born to issue it in the form of a publication on Habrahabr. </p><br><p> In PHP, starting with the 5th version, an exception mechanism is available.  In the current, 7th version, this mechanism has been improved and revised to uniformly handle various errors using the <code>try{} catch...</code> construct </p><br><p>  In the standard library (SPL) PHP provides a ready-made set of base classes and interfaces for exceptions.  In the 7th version of this set was expanded interface <code>Throwable</code> .  Here is a diagram of all types available in version 7 (image - link): </p><br><p> <a href=""><img src="https://habrastorage.org/web/b8e/00e/4f8/b8e00e4f8d1240e1bed53e63ab6cf023.png" alt="PHP7 exception type diagram"></a> </p><a name="habracut"></a><br><p>  For junior developers, it may be useful to first understand all the subtleties of syntax, the logic of exceptions, and error handling in general.  I can recommend the following articles in Russian: </p><br><ul><li>  Evgeny Pyastolov: <a href="http://langtoday.com/%3Fp%3D354">Standard exceptions in PHP.</a>  <a href="http://langtoday.com/%3Fp%3D354">When what to apply.</a> </li><li>  Anton Shevchuk (old-timer Habr aka <a href="https://habrahabr.ru/users/antonshevchuk/" class="user_link">AntonShevchuk</a> ) (translation <a href="https://devzone.zend.com/268/exceptional-code_part-1/">Exceptional Code - PART 1</a> ): <a href="http://anton.shevchuk.name/php/exceptional-code-part-1/">‚ÄúExceptional‚Äù code - Part 1</a> </li><li>  @kotiara: <br><ul><li>  <a href="https://habrahabr.ru/post/99431/">Correct PHP Error Handling</a> </li><li>  <a href="https://habrahabr.ru/post/100137/">Correct work with exceptions in PHP</a> </li></ul></li><li>  @expolit: <a href="https://habrahabr.ru/post/58702/">Exceptions.</a>  <a href="https://habrahabr.ru/post/58702/">Where do i use them</a> </li></ul><br><h2 id="osnovnye-aspekty-ierarhii-isklyucheniy-vashego-prilozheniya">  Highlights of your application's exception hierarchy. </h2><br><h3 id="obschiy-interfeys">  Common interface </h3><br><p>  Use a common interface (marker) for all exceptions defined in your application.  The same rule applies to individual components, modules, packages, i.e.  subspaces of your code names.  For example, <code>\YourVendor\YourApp\Exception\ExceptionInterface</code> , or <code>\YourVendor\YourApp\SomeComponent\Exception\ExceptionInterface</code> , in accordance with PSR-4. </p><br><p>  <a href="https://github.com/zendframework/zend-authentication/blob/master/src/Exception/ExceptionInterface.php">An example</a> can be viewed in any component of symfony, Zend, etc. </p><br><h3 id="dlya-kazhdoy-situacii--svoy-tip">  For each situation - its own type </h3><br><p>  Each new exception should result in the creation of a new type (class) of an exception.  The class name should semantically describe this situation.  Thus, the code calling the exception constructor, and its cast, will be: read, self-documented, transparent. </p><br><p>  Symmetrically and the code with catching the exception will be explicit.  The code inside the <code>catch</code> should not attempt to determine the situation by the message or other indirect signs. </p><br><h3 id="rasshiryayte-bazovye-tipy">  Extend base types </h3><br><p>  Base types serve to inherit from your own types of exceptions from your application.  This is directly stated in the <a href="http://php.net/manual/en/class.exception.php">documentation</a> . </p><br><p>  <a href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/Asset/Exception/InvalidArgumentException.php">An example</a> can be viewed in any component of symfony, or Zend. </p><br><h3 id="probros-i-preobrazovanie-v-sootvetstvii-s-urovnem-abstrakcii">  Forwarding and transformation in accordance with the level of abstraction </h3><br><p>  Since exceptions pop up throughout the call stack, there may be several places in the application where they are caught, skipped, or converted.  As a simple example: a standard PDOException is logical to catch in the DAL layer, or in the ORM, and forward your own <code>DataBaseException</code> instead, which in turn is caught in the layer above, for example, the controller, where to convert to HttpException.  The latter can be intercepted in the dispatcher code, at the topmost level. </p><br><p>  Thus, the controller does not know about the existence of PDO - it works with an abstract repository. </p><br><p>  The decision of what should be forwarded, what is transformed, and what is processed, in each case lies with the programmer. </p><br><h3 id="ispolzuete-vozmozhnosti-standartnogo-konstruktora">  Use the features of the standard designer </h3><br><p>  You should not override the standard <code>Exception</code> constructor - it is ideally designed for its tasks.  Just do not forget to use it for its intended purpose and call the parent with all the arguments, if overload is required.  Summing up this point with the previous one, the code might look like this: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Samizdam</span></span>\<span class="hljs-title"><span class="hljs-title">HabrahabrExceptionsTutorial</span></span>\<span class="hljs-title"><span class="hljs-title">DAL</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Model $model)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ..... try { $this-&gt;connection-&gt;query($data); } catch (\PDOException $e) { throw new DataBaseException(\i18n('Error on sql query execution: ' . $e-&gt;getMessage(), $e-&gt;getCode()), $e); } } } // ..... namespace Samizdam\HabrahabrExceptionsTutorial\SomeModule\Controller; use Samizdam\HabrahabrExceptionsTutorial\Http\Exception; class SomeController { public function saveAction() { // ..... try { $this-&gt;repository-&gt;save($model); } catch (DataBaseException $e) { throw new HttpException(\i18n('Database error. '), HttpException::INTERNAL_SERVER_ERROR, $e); } } } // ..... namespace Samizdam\HabrahabrExceptionsTutorial\Http; class Dispatcher { public function processRequest() { // ..... try { $controller-&gt;{$action}(); } catch (HttpException $e) { //    http_response_code($e-&gt;getCode()); echo $e-&gt;getMessage(); } } }</span></span></code> </pre> <br><h2 id="rezyume">  Summary </h2><br><p>  Why build a whole hierarchy involving interfaces, types, subtypes, and all this polymorphism for the sake of error handling?  What is the meaning of this abstraction and how is its price justified? </p><br><p>  When designing an application, abstraction is what adds flexibility, and allows you to postpone specific solutions and detailed implementation, until all the nuances are known, and the requirements for the code are not yet known, or they may change.  This is an investment that pays off over time. </p><br><p>  When your exceptions simultaneously have a marker interface, a super type SPL (like RuntimeException), a specific type that corresponds to the situation, you can fully control their processing and flexibly change its strategy in the future.  By laying these abstractions at an early stage of development, in the future, as the requirements for handling errors appear and become more stringent, you will have at your disposal a tool that will help to fulfill these requirements. </p><br><p>  At the prototype stage, it is enough to show the inscription "Opanki", for this it is enough to catch any Throwable in index.php. </p><br><p>  In the alpha version will not be superfluous to distinguish situations 401, 404 and 500. </p><br><p>  In beta testing, you will probably want to output the traces of all previous exceptions to form bug reports. </p><br><p>  By the beginning of the operation, you will need a single point for logging exceptions. </p><br><p>  And all the time the application is developing, you will only, as needed, add code with processing logic, <strong>without the need to make changes to the main code</strong> , where exceptions are generated. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/329140/">https://habr.com/ru/post/329140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329130/index.html">The digest of interesting materials for Mobile Developer # 204 (May 15-21)</a></li>
<li><a href="../329132/index.html">Big data for big science. Lecture in Yandex</a></li>
<li><a href="../329134/index.html">Palmistry UX</a></li>
<li><a href="../329136/index.html">What is the essence of the Moby project and why the main Docker repository suddenly became moby / moby?</a></li>
<li><a href="../329138/index.html">ENTRYPOINT vs CMD: Back to Basics</a></li>
<li><a href="../329142/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ263 (May 15 - 21, 2017)</a></li>
<li><a href="../329146/index.html">Unity3d We play with the mesh. Part 3 - Collision Based Mesh Warp</a></li>
<li><a href="../329148/index.html">[Saint Petersburg] Andrei Ershov - CRDT. Conflict-free data synchronization</a></li>
<li><a href="../329150/index.html">How to write a chat bot in PHP for the VKontakte community</a></li>
<li><a href="../329152/index.html">Javascript style elements</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>