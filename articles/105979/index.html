<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DirectAccess in Windows 7. Part1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my previous post I mentioned two, from my point of view, the most interesting innovations of Windows 7 - BranchCache and DirectAccess. BranchCache ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DirectAccess in Windows 7. Part1</h1><div class="post__text post__text-html js-mediator-article">  In my <a href="http://habrahabr.ru/company/microsoft/blog/99422/">previous post</a> I mentioned two, from my point of view, the most interesting innovations of Windows 7 - BranchCache and DirectAccess.  BranchCache technology was reviewed last time.  It is the turn of DirectAccess.  However, along the way, it became clear that the material goes beyond one post.  So for starters, I will focus on the features of DirectAccess and some of the issues of using IPv6. <br><br>  <b>What is DirectAccess?</b> <br><br>  DirectAccess is a technology for remote access to corporate network resources.  From a consumer point of view, the essence of the technology can be expressed as follows: "As soon as my computer connected to the Internet, I immediately got access to both the Internet resources and the entire corporate network."  In technical terms, when connected to the Internet, a user computer configured as a DirectAccess client (DA client) automatically establishes a tunnel to the DirectAccess server (DA server) and through it gains access to the entire corporate network.  Does it differ in any way from traditional VPN solutions?  Let's look at the features of DirectAccess and the technological basis of this solution, after which, I think, everyone will be able to answer this question for himself. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>DirectAccess Features</b> <br><br>  The first very important feature is that no additional actions are required from the user.  The tunnel between the client and the DirectAccess server is established automatically, and, as will be shown later, two tunnels are actually created: one to authenticate the computer, the second to authenticate the user.  And this process is completely transparent to the user.  No need to run any VPN connections, no need to enter credentials - username and password, pin code for smart card, etc. Moreover, if the connection to the Internet is lost for some time, and the tunnel is naturally broken. , and then restored (for example, an unstable WiFi signal), then again, automatically and without a user‚Äôs participation, the tunnel to the corporate network is also restored. <br><br>  The second feature follows from the first, although perhaps this is not very obvious.  As long as there is connection to the Internet, and there is a tunnel, a client computer is available for management by the company's IT services.  In other words, thanks to DirectAccess, not only the user can constantly work with corporate resources, would be communication with the outside world, but other employees, primarily IT specialists, have access to the user's computer.  The user is always ‚Äúunder the hood‚Äù at the IT services, which, probably, does not suit him very much, but the IT staff are very satisfied.  :) From a practical point of view, this fact makes it possible to monitor the client machine ‚Äî the scan of the anti-virus database, the latest updates, the included firewall, etc. ‚Äî even if it is located outside the corporate network.  On the other hand, manually breaking a DA-tunnel is not as easy as in the case of a VPN connection, which, as a rule, is visually displayed in network connections.  That is certainly possible, but you need to know how. <br><br>  Finally, by default, DirectAccess provides different routes to local, external, and corporate resources (see Figure 1).  In many implementations, when a VPN connection is established, the default gateway address changes, and all traffic is chased to the VPN server, and from there to the Internet or corporate network.  On the one hand, this slows down the speed of work with Internet resources, on the other hand, it can create certain problems with routing in a local network.  DirectAccess is quite flexible in configuration, so you can both configure the split tunnel mode (the default) and wrap all traffic to the DA server. <br><img src="https://habrastorage.org/storage/habraeffect/84/59/84598d2dcb60b37b78731ce11eec1c5f.jpg" alt="image"><br>  Fig.  one <br><br>  <b>Technological foundation</b> <br><br>  Let's now look at the technological solutions underlying DirectAccess.  In fact, there are three: <br>  1. IPv6 protocol for connecting a DA client with a DA server and Intranet computers. <br>  2. IPSec over IPv6 for secure data transmission over the Internet / Intranet network. <br>  3. Name Resolution Policy Table (NRPT) for correct resolution of internal (corporate) and external names. <br>  The latter, by the way, allows the user, while on the Internet, to access internal resources by short names, for example: \\ corp-srv1 \ docs.  We will discuss successively all three listed components. <br><br>  <b>IPv6</b> <br><br>  DirectAccess requires a configured IP version 6 protocol, at least on DA clients and DA servers.  Do not rush to immediately finish reading, this does not mean that DirectAccess is not applicable under the current conditions of the almost undivided reign of IPv4 in our open spaces, and not only of our Internet. <br><br>  Why at all was bet on IPv6?  This protocol has many advantages, the most important of which is the lack of good old IPv4 flaws.  :) Seriously, in relation to our topic, I would point out the following features of IPv6. <br><br>  The first is a huge address space.  What does it really give?  Now all or almost all companies use one or more public IPv4 addresses in the perimeter network, while the computers on the internal network are set to any of the private address ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0 /sixteen).  It is likely that when connecting to the Internet via NAT, the remote computer will receive an address from the same range, which will make using split tunnel mode very difficult.  A similar problem may arise when VPNs bind two remote offices using the same private IP subnet.  The IPv6 address space allows you to assign a unique IPv6 address to any company host, and a unique one, not only within the corporate network, but throughout the Internet.  As a consequence, there is no need for address translation, and you can stop using NAT altogether - it will only be about packet routing. <br><br>  How safe is it to work without NAT?  I understand that the question is more than debatable.  But still.  Let's remember that, first of all, NAT is intended to solve the problem of a shortage of public IPv4 addresses.  This problem is not in IPv6.  The second consequence of using NAT is hiding internal IP addressing.  Hosts on the Internet ‚Äúsee‚Äù only IP addresses on the external interface of a NAT device.  In case of rejection of NAT, the company will ‚Äúspotlight‚Äù the real IPv6 addresses of the corporate network.  Is this a security threat?  In general, yes.  The less an attacker knows about my network, the less potential troubles he may have.  However, on the other hand, we are talking about remote client access to corporate resources.  Firewalls have not been canceled, they still allow only certain traffic and are probably equipped with intrusion detection systems, prevention of port scanning, etc. In addition, hardly anyone will set up a tunnel for remote access without encryption.  And here we need to remember about IPSec over IPv6.  The DA server only accepts IPSec traffic.  Default.  You can always migrate.  And when an IPSec connection is established, the server and the client mutually authenticate, first at the computer account level using digital certificates, then at the user account level using the corporate policy (password, smart card, fingerprints, etc.).  Accordingly, knowledge of the specific IP address of the internal server will hardly greatly facilitate the task of penetration into the internal network. <br><br>  Conversely, the rejection of NAT leads to another useful feature of the use of IPv6 - the possibility of secure point-to-point connections.  Indeed, the standard solution in the case of NAT is a scheme (see Figure 2), in which an encrypted tunnel is established from, in this case, a DA client to a DA server.  On the internal network, traffic is already transmitted in open form (red arrows), or it is again encrypted, but not by the client, but by the DA server. <br><img src="https://habrastorage.org/storage/habraeffect/5d/38/5d381b7bf88bb3f3d2a8ca33c55a82fb.jpg" alt="image"><br>  Pic2 <br><br>  In the case of global IPv6 routing, an encrypted channel can be established between the DA client and the destination server, and the DirectAccess server only passes (routes) such traffic through itself (see Figure 3).  This allows you to configure access rights to servers and at the computer level, and at the user level, in addition, "tightening the screws" security.  The difficulty in implementing such a scheme when using address translation is that each IPSec packet has a digital signature that is broken when the NAT device tries to modify the packet.  Although there is a solution to this problem, not every NAT device supports it. <br><img src="https://habrastorage.org/storage/habraeffect/0f/29/0f2920b7bc2720b803fb83322aa2e485.jpg" alt="image"><br>  Fig.  3 <br><br>  Well, another important point associated with NAT.  Applications.  You can easily encounter programs that do not work or work crookedly through NAT.  Including, by virtue of incorrect resolution of internal and external names.  The lack of NAT allows developers to forget about address translation issues and focus on the business logic of the application, and administrators to get rid of additional settings and applications and firewalls. <br>  Thus, the ‚Äúopenness‚Äù of the IP addressing of your network and the advantages of the ‚Äúworld without NAT‚Äù that I tried to identify are on the scale.  The choice, as always, is yours. <br><br>  In the next post, I'll finish reviewing the technology foundation of DirectAccess.  It will be about the use of IPv6 in an IPv4 environment, IPSec over IPv6 application options, features of the implementation of NRPT. </div><p>Source: <a href="https://habr.com/ru/post/105979/">https://habr.com/ru/post/105979/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../105971/index.html">Business planning</a></li>
<li><a href="../105973/index.html">MarkUp. Mark what you need and send!</a></li>
<li><a href="../105976/index.html">Canonical vs. Microsoft? Cool story bro</a></li>
<li><a href="../105977/index.html">CDNvideo content delivery network - project news</a></li>
<li><a href="../105978/index.html">Why does superman hate Facebook?</a></li>
<li><a href="../105980/index.html">Announced a single subscription for Xbox Live and Windows Phone stores and a new App Hub resource</a></li>
<li><a href="../105981/index.html">Data discrepancies between Metric and Google Analytics: the casket just opens</a></li>
<li><a href="../105983/index.html">HTC Tattoo Orange UK and simlock</a></li>
<li><a href="../105984/index.html">Problems of 64-bit code in real programs: what about Linux?</a></li>
<li><a href="../105986/index.html">Robokassa - violators of the law on the protection of competition and the Puritans of the XXI century?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>