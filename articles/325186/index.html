<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integrating XML data is another way.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes ‚Äúunconventional‚Äù, but rather powerful XML processing technology that allows you to import any XML data and transform its struct...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integrating XML data is another way.</h1><div class="post__text post__text-html js-mediator-article">  This article describes ‚Äúunconventional‚Äù, but rather powerful XML processing technology that allows you to import any XML data and transform its structure efficiently and simply, while the same processing process allows you to transform the source data of any structure without any change in the program code . <br><a name="habracut"></a><br>  XML as an intermediate data exchange format ‚Äúovergrown‚Äù with an ecosystem of technologies and tools for working with it - specialized editors, DOM parsers, XQUERY / XPATH, XSLT, special ETL modules, etc. All this diversity and sophistication of tools ideologically lead to that we now have the technology to work not just with data, but with special XML data.  It is like a separate "science of chemistry" and a separate "science of chemistry for substances that are stored in blue boxes." <br><br>  The processing principles described below allowed us to slightly rewind the conditional progress of technologies and to transfer almost all work with XML data to the level of a ‚Äúpure‚Äù DBMS, without specific XML tools.  This approach made it possible to organize a unified storage of any XML-data and provide fast random access to the necessary parts of the information.  In addition, it became possible to implement the ETL functionality in a universal, non-cost (practically without coding) method. <br><br>  The described approach has shown itself to be particularly good at large data sources and complex structures, with frequent changes in the data schema.  If you have to deal with a small amount of information, and / or the structure is simple, you may not need this technology yet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A good demo case for this technology can be public procurement server zakupki.gov.ru, available on the appropriate FTP: the volume of daily updates - tens and hundreds of thousands of XML files in gigabytes or tens of gigabytes, on average, a new version comes out every few weeks data schemas. <br><br>  The data structure follows the requirements of the legislation, therefore, for example, information on notifications on public procurement is provided by more than a dozen types of documents fcsNotification * depending on the type of purchase (electronic auction fcsNotificationEF, request for quotes fcsNotificationZK, purchase from a single supplier fcsNotificationEP, etc.) <br>  All these documents are based on the same basic type of notification but differ in details, therefore, for the purposes of analysis, all this diversity must be ‚Äúcollapsed‚Äù at some point during import and lead to a ‚Äúcommon denominator‚Äù. <br><br>  The described approach has been successfully applied and works effectively on these public procurements. <br><br>  <b>Briefly stages / elements of the described technology:</b> <br><br>  <b>(1)</b> <b>Import all XML data into a</b> unified structure <b>table</b> .  We are not talking about saving into the document database as a whole, we are importing data elementwise as pairs ‚Äúelement name‚Äù - ‚Äúvalue‚Äù or ‚Äúattribute name‚Äù - ‚Äúvalue‚Äù.  As a result of this stage, we get rid of XML as a storage format and get quick unified access to the data of all imported XML documents of any structure (and we no longer need XQUERY / XPATH). <br><br>  <b>(2) The</b> second element of the technology is the <b>creation of specifications</b> for ‚Äúpulling out‚Äù the data we need - identifying the resulting tables, into which we will pour the data, and mapping the source and result fields.  This stage can be carried out both on the basis of XSD-schemes of documents, and without the use of schemes, through the analysis of sample documents uploaded at the first stage.  This stage does not require any programming and special skills, the main tool here is a spreadsheet. <br><br>  <b>(3)</b> The final steps are selection of the necessary information from the primary import storage (1) using specifications (2), conversion to a ‚Äúcolumnar‚Äù view (‚Äúpivoting‚Äù) and automated <b>transformation to the final ‚Äúanalytical‚Äù format</b> ‚Äî in terms of analytical data repositories this fact tables of the asterisk structure (star) with links to measurement guides (dimensions) and numerical measures (measures). <br><br><h4>  1. Primary import. </h4><br>  We consider an XML document as a tree, the vertices of which are the pairs ‚Äúname‚Äù - ‚Äúvalue‚Äù.  Thus, the described approach is quite universal and can be applied to any tree-like data representation. <br><br>  <b>Table structure for loading data from XML:</b> <br><br><ul><li>  <b>Record_ID</b> : an identifier of an element of a special hierarchical view that allows you to associate different levels of the document </li><li>  <b>File_ID</b> : since you will need to load the contents of multiple XML files into a table, you must also store the file ID </li><li>  <b>Path</b> : the full path to this element from the root of the document (in fact, this is the XPATH path to this element) </li><li>  <b>Element_Name</b> : the name of the element or attribute </li><li>  <b>Element _Value</b> : the value of the element or attribute (as a string - just as it is stored in XML) </li><li>  <b>Type</b> : record type (element or attribute) - save just in case, then suddenly it will be necessary to restore XML from the table </li></ul><br>  The idea of ‚Äã‚Äãloading a tree into a table is fairly obvious.  In MS SQL (I will not say about other DBMS, did not look) there is such a built-in capability ‚ÄìXML without specifying a schema is imported into a so-called EDGE table.  This is not exactly what we need, since the element name and its value (that is, the name is the parent record for the value) are stored in separate format in EDGE format ‚Äî this format is simply inconvenient to be used for further manipulations.  In addition, in the EDGE table, the links in the tree are registered by specifying the ParentID. <br><br>  In short, you can make the desired data representation from the EDGE table, but you have to sweat a little to ‚Äúglue‚Äù the names and values ‚Äã‚Äãof the elements, recreate the XPATH before each element and create a hierarchical identifier (how we build it - just below).  With a large amount of data, the solution of these problems can be quite resource-intensive, but you can get by with a single tool / language. <br><br>  A better way is to get the document tree using the XML parser (there is some kind of implementation in almost every language and development environment) and fill in the necessary information with one pass through the document. <br><br>  Let's look at a specific example.  We have demo XML files deliveries.xml and returns.xml.  The <b>deliveries.xml</b> file contains the root element Deliveries, at the top level the dates of the beginning and end of the period for which the data is unloaded, then there are products with an indication of the name and supplier, for each product the details of deliveries are given - date, quantity, price. <br><br><div class="spoiler">  <b class="spoiler_title">deliveries.xml</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Deliveries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodBegin</span></span></span><span class="hljs-tag">&gt;</span></span>2017-01-01<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodBegin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodEnd</span></span></span><span class="hljs-tag">&gt;</span></span>2017-01-31<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodEnd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Products</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span>Zaanse Snoepfabriek<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span>Chocolade<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeliveryDate</span></span></span><span class="hljs-tag">&gt;</span></span>2017-01-03<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeliveryDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span>10.2000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span>70<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span>Mayumi's<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span>Tofu<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeliveryDate</span></span></span><span class="hljs-tag">&gt;</span></span>2017-01-09<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeliveryDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span>18.6000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span>12<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeliveryDate</span></span></span><span class="hljs-tag">&gt;</span></span>2017-01-13<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DeliveryDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span>18.7000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span>20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Products</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Deliveries</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  The <b>returns.xml</b> file <b>(returns) is</b> absolutely the same, only the root element is called Returns and in detail the date element is called differently. <br><br><div class="spoiler">  <b class="spoiler_title">returns.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Returns</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodBegin</span></span></span><span class="hljs-tag">&gt;</span></span>2017-02-01<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodBegin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodEnd</span></span></span><span class="hljs-tag">&gt;</span></span>2017-02-28<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PeriodEnd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Products</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span>Pavlova, Ltd.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span>Pavlova<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReturnDate</span></span></span><span class="hljs-tag">&gt;</span></span>2017-02-21<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReturnDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span>13.9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span>Formaggi Fortini srl<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Supplier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span>Mozzarella di Giovanni<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReturnDate</span></span></span><span class="hljs-tag">&gt;</span></span>2017-02-27<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ReturnDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span>27.8000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UnitPrice</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span>4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Quantity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Detail</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Details</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Product</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Products</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Returns</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  The names of the uploaded files are stored in a separate table, the codes of our files there are 2006 (deliveries) and 2007 (returns). <br><br>  In our receiving table, the image of our demo documents will look like this: <br><br><div class="spoiler">  <b class="spoiler_title">(It's not all, just the beginning of the table)</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Record_ID</strong> </td><td>  <strong>File_ID</strong> </td><td>  <strong>Path</strong> </td><td>  <strong>Element_Name</strong> </td><td>  <strong>Element_Value</strong> </td><td>  <strong>Type</strong> </td></tr><tr><td>  001 </td><td>  2006 </td><td></td><td>  Deliveries </td><td></td><td>  E </td></tr><tr><td>  001 \ 001 </td><td>  2006 </td><td>  Deliveries \ </td><td>  PeriodBegin </td><td>  2017-01-01 </td><td>  E </td></tr><tr><td>  001 \ 002 </td><td>  2006 </td><td>  Deliveries \ </td><td>  PeriodEnd </td><td>  2017-01-31 </td><td>  E </td></tr><tr><td>  001 \ 003 </td><td>  2006 </td><td>  Deliveries \ </td><td>  Products </td><td></td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 </td><td>  2006 </td><td>  Deliveries \ Products \ </td><td>  Product </td><td></td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 001 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ </td><td>  Supplier </td><td>  Zaanse snoepfabriek </td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 002 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ </td><td>  ProductName </td><td>  Chocolade </td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 003 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ </td><td>  Details </td><td></td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ <br>  001 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ Details \ </td><td>  Detail </td><td></td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ <br>  001 \ 001 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ Details \ Detail \ </td><td>  DeliveryDate </td><td>  2017-01-03 </td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ <br>  001 \ 002 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ Details \ Detail \ </td><td>  UnitPrice </td><td>  10.2000 </td><td>  E </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ <br>  001 \ 003 </td><td>  2006 </td><td>  Deliveries \ Products \ <br>  Product \ Details \ Detail \ </td><td>  Quantity </td><td>  70 </td><td>  E </td></tr></tbody></table><br></div></div><br>  Regarding the hierarchical identifier <b>Record_ID</b> : its goal is to uniquely number the nodes of the document tree while preserving information about the links with all ancestors. <br><br><div class="spoiler">  <b class="spoiler_title">Note:</b> <div class="spoiler_text">  In the same SQL Server there is a special data type (object extension) called hierarchyid, which serves for this purpose. <br></div></div><br>  In the example above, we use a simple platform-independent implementation with a sequential concatenation of element counters at each level of the tree.  We ‚Äúfinish‚Äù the counter of each level with zeros to a given fixed depth in order to get an easy and fast allocation of ancestor identifiers of any level through the allocation of substrings of fixed length. <br><br>  That's all at this stage.  Now we can use simple SQL queries to isolate subsets of product data, delivery details or returns, and link them together through file and item identifiers. <br><br>  In many cases, this approach will be quite enough for efficient data storage and access to them, the ‚Äúadvanced‚Äù techniques described below may not be necessary. <br><br>  Indeed, we have already loaded all our data into a single repository, not paying attention to the possible difference in the structure of documents, got a fairly effective way to isolate the necessary information from the whole array with simple SQL queries, we can link the ‚Äúsubtracted‚Äù data subsets together. <br><br>  The performance of such a solution as an XML source storage system for one-time queries, even without optimizing indexes and other tweaks, will clearly be much higher than if you stored XML in files or even wrote it in special database fields.  In our case, it is not necessary to run the XPATH search procedure (which implies a new parsing) for each document, we did it once and then calmly use the saved result through fairly simple queries. <br><br><div class="spoiler">  <b class="spoiler_title">But:</b> <div class="spoiler_text">  At this stage, we have not yet done so that <b>DeliveryDate</b> , <b>Quantity</b> and <b>UnitPrice</b> become fields of the same table, this is described as the process of ‚Äúpivotirovaniya‚Äù in the third section. <br></div></div><br>  In the next steps, we will look at the transformation of these XML documents into a single data structure containing 3 tables: <b>MovementReports</b> (movement type ‚Äî delivery or return, start and end dates from the document root), <b>Products</b> (name and supplier), and <b>MovementDetails</b> (price, quantity, date - the date field as a result will be the same for both source documents, despite the fact that the fields in the source files are called differently) <br><br><h4>  2. Creation of transformation specifications in the resulting tables. </h4><br>  Consider the process of creating specifications for mapping the source data and the resulting tables.  To create such specifications, we need something else. <br><br><h5>  2.1.  Getting a label with the structure of documents. </h5><br>  For further processing, you need to have a detailed structure of all of our XML documents in order to decide on the basis of it into which structure of tables we will transform all this. <br>  One particular sample XML document for this task is not enough for us; there may not be any optional elements in a specific document that suddenly appear in other documents. <br><br>  If we do not have an XSD schema or we don‚Äôt want to communicate with it, then it may be enough for us to load into our table some representative sample of samples of XML documents and build the required list using the <b>Path</b> and <b>Element_Name</b> fields. <br><br>  However, do not forget that as a result we want to load information into some target ‚Äúfinal‚Äù tables, so we need to know where <b>one-to-many</b> relationships are stored in XML.  That is, it is necessary to understand which elements form the ‚Äúchild‚Äù table where reproduction occurs. <br><br>  Sometimes, if the scheme of the document is not very complicated, it is immediately clear to us empirically, "eyes."  Also, when grouping the data of our ‚Äúrepresentative sample‚Äù, we can count the number of elements and see from this statistics where they begin to ‚Äúmultiply‚Äù.  But in general, if we have a normal XSD scheme, it is better to use it - we will ‚Äúcatch‚Äù one-to-many data multiplication, revealing the XSD construction <b>maxoccurs = unbounded</b> . <br><br>  As you can see, the task is a bit more complicated: I want to get not only a simple table containing a list of XPATH paths for all elements of our documents, but also indicating where the reproduction of data begins.  (And when analyzing a well-written XSD scheme with a pleasant bonus, you might be able to pull out the descriptions of the elements and their types.) <br><br>  It would be very good to use the functionality of some XML editor to get such a label, but it was not possible to find such a tool that would give us the structure of documents we needed using the XSD scheme (we searched and tried for a long time). <br><br>  In all these Oxygen, Altova, Liquid and less sophisticated, the necessary information inside is undoubtedly used - however, none of them are able to give it in the right form.  As a rule, an advanced editor has the ability to generate Sample XML based on a schema, but in XSD there may be a <b>choice</b> design, when there may be something to choose from several different elements in the document ‚Äî then real ‚Äúcombat‚Äù document samples are better to analyze.  And yet - according to the sample or samples of documents, we also will not catch the moment of one-to-many reproduction of information in an explicit form. <br><br>  As a result, I had to reinvent the wheel and write the generator of such a plate (in fact, a special kind of XSD parser) on my own.  The benefit of XSD is also XML, you can also upload it to our repository and pull out the desired view with relational operations.  If the scheme is simple, without references to complex types of elements and without inheritance from basic types, then it is quite simple.  In the case when all this type inheritance is available (as in public procurement, for example), the task is more complicated. <br><br><div class="spoiler">  <b class="spoiler_title">For our example, we will get something like this table of the structure of documents:</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Path</strong> </td><td>  <strong>Element_Name</strong> </td><td>  <strong>maxoccurs</strong> </td></tr><tr><td>  Deliveries \ </td><td>  PeriodBegin </td><td></td></tr><tr><td>  Deliveries \ </td><td>  PeriodEnd </td><td></td></tr><tr><td>  Deliveries \ Products \ Product \ </td><td>  ProductName </td><td>  Products \ Product </td></tr><tr><td>  Deliveries \ Products \ Product \ </td><td>  Supplier </td><td>  Products \ Product </td></tr><tr><td>  Deliveries \ Products \ Product \ Details \ Detail \ </td><td>  DeliveryDate </td><td>  Products \ Product \ Details \ Detail </td></tr><tr><td>  Deliveries \ Products \ Product \ Details \ Detail \ </td><td>  Quantity </td><td>  Products \ Product \ Details \ Detail </td></tr><tr><td>  Deliveries \ Products \ Product \ Details \ Detail \ </td><td>  UnitPrice </td><td>  Products \ Product \ Details \ Detail </td></tr><tr><td>  Returns \ </td><td>  PeriodBegin </td><td></td></tr><tr><td>  Returns \ </td><td>  PeriodEnd </td><td></td></tr><tr><td>  Returns \ Products \ Product \ </td><td>  ProductName </td><td>  Products \ Product </td></tr><tr><td>  Returns \ Products \ Product \ </td><td>  Supplier </td><td>  Products \ Product </td></tr><tr><td>  Returns \ Products \ Product \ Details \ Detail \ </td><td>  Quantity </td><td>  Products \ Product \ Details \ Detail </td></tr><tr><td>  Returns \ Products \ Product \ Details \ Detail \ </td><td>  ReturnDate </td><td>  Products \ Product \ Details \ Detail </td></tr><tr><td>  Returns \ Products \ Product \ Details \ Detail \ </td><td>  UnitPrice </td><td>  Products \ Product \ Details \ Detail </td></tr></tbody></table><br></div></div><br><h5>  2.2.  Transformation Description </h5><br>  Having obtained the initial data in the form of a table specification of documents, we proceed to the design of data transformation.  As a result of this transformation, we will transform the data of our original primary XML repository into new tables with new field names and unique codes of target table entries.  We do not need any special software tools, just add a few new columns to this label: <br><br><div class="spoiler">  <b class="spoiler_title">In the example above, some fields are abbreviated to improve readability.</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Path</strong> </td><td>  <strong>Element_</strong> <strong><br></strong>  <strong>Name</strong> </td><td>  <strong>maxoccurs</strong> </td><td>  <strong>Target</strong> <strong><br></strong>  <strong>Table</strong> </td><td>  <strong>Target</strong> <strong><br></strong>  <strong>Field</strong> </td><td>  <strong>Element</strong> <strong><br></strong>  <strong>Depth</strong> </td><td>  <strong>Additional</strong> <strong><br></strong>  <strong>Info</strong> </td></tr><tr><td>  Deliveries \ </td><td>  PeriodBegin </td><td></td><td>  MovementReports </td><td>  PeriodBegin_Date </td><td>  one </td><td>  Deliveries </td></tr><tr><td>  Deliveries \ </td><td>  PeriodEnd </td><td></td><td>  MovementReports </td><td>  PeriodEnd_Date </td><td>  one </td><td>  Deliveries </td></tr><tr><td>  Deliveries \ ... \ Product \ </td><td>  ProductName </td><td>  ... \ Product </td><td>  Products </td><td>  ProductName_Dim </td><td>  3 </td><td></td></tr><tr><td>  Deliveries \ ... \ Product \ </td><td>  Supplier </td><td>  ... \ Product </td><td>  Products </td><td>  Supplier_Dim </td><td>  3 </td><td></td></tr><tr><td>  Deliveries \ ... \ ... \ ... \ Detail \ </td><td>  DeliveryDate </td><td>  ... \ Detail </td><td>  MovementDetails </td><td>  MovementDate_Date </td><td>  five </td><td></td></tr><tr><td>  Deliveries \ ... \ ... \ ... \ Detail \ </td><td>  Quantity </td><td>  ... \ Detail </td><td>  MovementDetails </td><td>  Quantity_Val </td><td>  five </td><td></td></tr><tr><td>  Deliveries \ ... \ ... \ ... \ Detail \ </td><td>  UnitPrice </td><td>  ... \ Detail </td><td>  MovementDetails </td><td>  UnitPrice_Val </td><td>  five </td><td></td></tr><tr><td>  Returns \ </td><td>  PeriodBegin </td><td></td><td>  MovementReports </td><td>  PeriodBegin_Date </td><td>  one </td><td>  Returns </td></tr><tr><td>  Returns \ </td><td>  PeriodEnd </td><td></td><td>  MovementReports </td><td>  PeriodEnd_Date </td><td>  one </td><td>  Returns </td></tr><tr><td>  Returns \ ... \ Product \ </td><td>  ProductName </td><td>  ... \ Product </td><td>  Products </td><td>  ProductName_Dim </td><td>  3 </td><td></td></tr><tr><td>  Returns \ ... \ Product \ </td><td>  Supplier </td><td>  ... \ Product </td><td>  Products </td><td>  Supplier_Dim </td><td>  3 </td><td></td></tr><tr><td>  Returns \ ... \ ... \ ... \ Detail \ </td><td>  Quantity </td><td>  ... \ Detail </td><td>  MovementDetails </td><td>  MovementDate_Date </td><td>  five </td><td></td></tr><tr><td>  Returns \ ... \ ... \ ... \ Detail \ </td><td>  ReturnDate </td><td>  ... \ Detail </td><td>  MovementDetails </td><td>  Quantity_Val </td><td>  five </td><td></td></tr><tr><td>  Returns \ ... \ ... \ ... \ Detail \ </td><td>  UnitPrice </td><td>  ... \ Detail </td><td>  MovementDetails </td><td>  UnitPrice_Val </td><td>  five </td><td></td></tr></tbody></table><br></div></div><br>  Here are the fields we added: <br><br><ul><li>  The name of the target table is <b>TargetTable</b> .  Please note that we take into account one-to-many reproduction information (maxoccurs column) to determine which table which data to fill in. <br><br></li><li>  The field name of the target table is <b>TargetField</b> .  We will further use the onvention over configuration approach and will assign the <b>_Dim</b> suffix for the fields that will become dimensions (dimensions), the <b>_Date</b> suffix for the date fields, and the <b>_Val</b> suffix for the number fields (measures).  At the next stages of the process, the corresponding utilities for the suffix will understand what to do with this field - build and update the necessary reference book or convert the value to the appropriate format. <br><br></li><li>  The effective nesting depth of the <b>ElementDepth</b> elements.  For the subsequent transformations, we will need to retain a single code for the entry of the target table based on the contents of the <b>Record_ID</b> and <b>File_ID fields</b> .  In XML, the depth of elements may be different, but they will have to fall into one target table, so we indicate what part of the hierarchical code <b>Record_ID</b> we need to keep, discarding the remainder we don't need.  Due to the fixed length of each segment of the hierarchical code, this will be a rather ‚Äúcheap‚Äù operation of extracting substrings of length <b>[Number of characters per code segment]</b> * <b>ElementDepth</b> . <br><br></li><li>  Additional Information <b>AdditionalInfo</b> .  As a result of our transformation, we will overload the source data broken down by target tables into a similar structure with new field names, but in some places we will need to save important information about which XPATH path we took the source data from. </li></ul><br>  This technique opens up several interesting data transformation manipulation capabilities.  Without going into details, just list what we can do: <br><br><ul><li>  If we have several initial XML data coding schemes (for example, the ‚Äúold‚Äù government procurement scheme for 95 FZ and the ‚Äúnew‚Äù for 44 FZ), we can bring them to a single data structure through the unification of the field names by the transformation description stage. <br><br></li><li>  As mentioned earlier, we can ‚Äúcollapse‚Äù different sections within one or several document schemas into a single, more compact storage structure, as we do in our example. <br><br></li><li>  You can also ‚Äúcollapse‚Äù data of different depths into a uniform view.  For example, if we take the scheme of notices on public procurement, then in different schemes information about the lots of purchases may be ‚Äúat‚Äù <b>\ lot</b> for single <b>lot</b> purchases (the only element) and <b>\ lots \ lot</b> for multi <b>lot</b> purchases (reproduction).  With this approach, you can quite simply zamappit this whole zoo into a single table of information about lots. </li></ul><br>  After our transformation specification label is ready, we load it into the database and join our primary repository for the <b>Path</b> and <b>Element_Name</b> fields. <br><br>  <b>By</b> concatenating the <b>File_ID</b> , ‚Äútrimmed‚Äù in accordance with the <b>ElementDepth</b> values ‚Äã‚Äãof the <b>Record_ID</b> field and the <b>AdditionalInfo</b> values, we form the composite key of our target table. <br><br>  The result of the join is poured for each target table into a separate ‚Äútemporary‚Äù table (depending on the amount of data you can try using the query result ‚Äúon the fly‚Äù), in the next step the final utilities of our ‚Äúpipeline‚Äù will work with these tables. <br><br><div class="spoiler">  <b class="spoiler_title">A little more about the composite key, maybe a little repeating - but this is an important and subtle point:</b> <div class="spoiler_text"><ul><li>  Before pouring we have a data set at the level of individual fields (elements).  In order to connect the fields in the record of the resulting table, we need to have some kind of key that will uniquely identify the record of the target table, into which the corresponding fields will fall. <br></li><li>  The hierarchical identifier <b>Record_ID</b> can be of different lengths, depending on the ‚Äúdepth‚Äù of individual elements in the document outline.  However, if the level deepening is not accompanied by one-to-many elements multiplication, we cut our <b>Record_ID</b> to the minimum sufficient depth defined by the <b>ElementDepth</b> parameter, which will ensure that the identifier is the same for all fields of our target table.  In our demo documents there is no such situation, but imagine, for example, that our <b>UnitPrice would</b> ‚Äú <b>split</b> ‚Äù into 2 values ‚Äã‚Äã- the wholesale and retail prices of <b>UnitPrice \ Retail</b> and <b>UnitPrice \ Wholesale</b> . <br></li><li>  Since the contents of many files are in our base repository, we <b>can</b> not do without the value of <b>File_ID</b> in our key. </li><li>  The following stages of data transformation work only with the ‚Äútransformed‚Äù tables obtained at this step, we don‚Äôt have any end-to-end system of settings.  The type of the field (dimension / measure) we pass through the suffixes of the names, but sometimes we need to pass ‚Äúalong the chain‚Äù also the information about which section of the document we took the information (remember that we can transform into different form the documents encoded by different schemes).  To transfer this information to the next stage, we use the optional parameter of our <b>AdditionalInfo</b> transformation, ‚Äúhooking‚Äù it to our composite key so that the identification of target records that we need is not violated. </li></ul><br></div></div><br>  Let's see what happened on the output in our example: <br><br><div class="spoiler">  <b class="spoiler_title">The result of the transformation:</b> <div class="spoiler_text">  <i><b>Movement Reports:</b></i> <br><table><tbody><tr><td>  <strong>KEY</strong> </td><td>  <strong>TargetField</strong> </td><td>  <strong>Element_Value</strong> </td></tr><tr><td>  001; 2006 @ Deliveries </td><td>  PeriodBegin_Date </td><td>  2017-01-01 </td></tr><tr><td>  001; 2006 @ Deliveries </td><td>  PeriodEnd_Date </td><td>  2017-01-31 </td></tr><tr><td>  001; 2007 @ Returns </td><td>  PeriodBegin_Date </td><td>  2017-02-01 </td></tr><tr><td>  001; 2007 @ Returns </td><td>  PeriodEnd_Date </td><td>  2017-02-28 </td></tr></tbody></table><br>  <i><b>Products:</b></i> <br><table><tbody><tr><td>  <strong>KEY</strong> </td><td>  <strong>TargetField</strong> </td><td>  <strong>Element_Value</strong> </td></tr><tr><td>  001 \ 003 \ 001; 2006 </td><td>  Supplier_Dim </td><td>  Zaanse snoepfabriek </td></tr><tr><td>  001 \ 003 \ 001; 2006 </td><td>  ProductName_Dim </td><td>  Chocolade </td></tr><tr><td>  001 \ 003 \ 002; 2006 </td><td>  Supplier_Dim </td><td>  Mayumis </td></tr><tr><td>  001 \ 003 \ 002; 2006 </td><td>  ProductName_Dim </td><td>  Tofu </td></tr><tr><td>  001 \ 003 \ 001; 2007 </td><td>  Supplier_Dim </td><td>  Pavlova, Ltd. </td></tr><tr><td>  001 \ 003 \ 001; 2007 </td><td>  ProductName_Dim </td><td>  Pavlova </td></tr><tr><td>  001 \ 003 \ 002; 2007 </td><td>  Supplier_Dim </td><td>  Formaggi Fortini srl </td></tr><tr><td>  001 \ 003 \ 002; 2007 </td><td>  ProductName_Dim </td><td>  Mozzarella di giovanni </td></tr></tbody></table><br>  <i><b>MovementDetails:</b></i> <br><table><tbody><tr><td>  <strong>KEY</strong> </td><td>  <strong>TargetField</strong> </td><td>  <strong>Element_Value</strong> </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001; 2006 </td><td>  MovementDate_Date </td><td>  2017-01-03 </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001; 2006 </td><td>  UnitPrice_Val </td><td>  10.2000 </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001; 2006 </td><td>  Quantity_Val </td><td>  70 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001; 2006 </td><td>  MovementDate_Date </td><td>  2017-01-09 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001; 2006 </td><td>  UnitPrice_Val </td><td>  18.6000 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001; 2006 </td><td>  Quantity_Val </td><td>  12 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 002; 2006 </td><td>  MovementDate_Date </td><td>  2017-01-13 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 002; 2006 </td><td>  UnitPrice_Val </td><td>  18.7000 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 002; 2006 </td><td>  Quantity_Val </td><td>  20 </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001; 2007 </td><td>  MovementDate_Date </td><td>  2017-02-21 </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001; 2007 </td><td>  UnitPrice_Val </td><td>  13.9000 </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001; 2007 </td><td>  Quantity_Val </td><td>  2 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001; 2007 </td><td>  MovementDate_Date </td><td>  2017-02-27 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001; 2007 </td><td>  UnitPrice_Val </td><td>  27.8000 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001; 2007 </td><td>  Quantity_Val </td><td>  four </td></tr></tbody></table><br></div></div><br>  Please note - the obtained key is the same for all fields that will be included in the corresponding records of our target tables. <br><br><h4>  3. Final processing. </h4><br><h5>  3.1.  Pivotting </h5><br>  Having obtained the ‚Äúblank‚Äù target table with the previous transformation with source data divided into triples <b>&lt;key&gt; - &lt;field name&gt; - &lt;value&gt;</b> , we need to translate it into a more familiar look of a table with many fields.  The algorithm of this transformation is obvious - first, by grouping the values ‚Äã‚Äãof our composite key, we get the ‚Äúskeleton‚Äù of the table, then we perform the joins of this ‚Äúskeleton‚Äù with the table-result of transformation according to the value of the composite key.  (‚ÄúIncreasing Meat,‚Äù so to speak.) <br><br>  That is, there will be N ‚Äúskeleton‚Äù connections with subsets of the table ‚Äî the result of the transformation, identified by the field names, where N is the number of field names in the target table ‚Äî the result of the transformation. <br><br>  We safely ‚Äúbrought‚Äù the <b>AdditionalInfo</b> field to this stage by encoding it inside the composite key.  Now we need to free our key from this ‚Äúburden‚Äù and cut the AdditionalInfo part into the <b>AdditionalInfo_Dim</b> new field. <br><br>  We combined the file code and record identifier to transfer the key to the pivot stage with one field.  For ‚Äúfinal‚Äù storage, it is better to divide the file code and hierarchical identifier back into two fields, so it will be easier to associate the resulting tables with each other. <br><br>  The result will be such <br><br><div class="spoiler">  <b class="spoiler_title">pivot tags:</b> <div class="spoiler_text">  <i><b>Movement Reports:</b></i> <br><table><tbody><tr><td>  <strong>Record_ID</strong> </td><td>  <strong>File_ID</strong> </td><td>  <strong>AdditionalInfo_Dim</strong> </td><td>  <strong>PeriodBegin_Date</strong> </td><td>  <strong>PeriodEnd_Date</strong> </td></tr><tr><td>  001 </td><td>  2006 </td><td>  Deliveries </td><td>  2017-01-01 </td><td>  2017-01-31 </td></tr><tr><td>  001 </td><td>  2007 </td><td>  Returns </td><td>  2017-02-01 </td><td>  2017-02-28 </td></tr></tbody></table><br>  <i><b>Products:</b></i> <br><table><tbody><tr><td>  <strong>Record_ID</strong> </td><td>  <strong>File_ID</strong> </td><td>  <strong>Supplier_Dim</strong> </td><td>  <strong>ProductName_Dim</strong> </td></tr><tr><td>  001 \ 003 \ 001 </td><td>  2006 </td><td>  Zaanse snoepfabriek </td><td>  Chocolade </td></tr><tr><td>  001 \ 003 \ 002 </td><td>  2006 </td><td>  Mayumis </td><td>  Tofu </td></tr><tr><td>  001 \ 003 \ 001 </td><td>  2007 </td><td>  Pavlova, Ltd. </td><td>  Pavlova </td></tr><tr><td>  001 \ 003 \ 002 </td><td>  2007 </td><td>  Formaggi Fortini srl </td><td>  Mozzarella di giovanni </td></tr></tbody></table><br>  <i><b>MovementDetails:</b></i> <br><table><tbody><tr><td>  <strong>Record_ID</strong> </td><td>  <strong>File_ID</strong> </td><td>  <strong>MovementDate_Date</strong> </td><td>  <strong>UnitPrice_Val</strong> </td><td>  <strong>Quantity_Val</strong> </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001 </td><td>  2006 </td><td>  2017-01-03 </td><td>  10.2000 </td><td>  70 </td></tr><tr><td>  001 \ 003 \ 001 \ 003 \ 001 </td><td>  2007 </td><td>  2017-02-21 </td><td>  13.9000 </td><td>  2 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001 </td><td>  2006 </td><td>  2017-01-09 </td><td>  18.6000 </td><td>  12 </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 001 </td><td>  2007 </td><td>  2017-02-27 </td><td>  27.8000 </td><td>  four </td></tr><tr><td>  001 \ 003 \ 002 \ 003 \ 002 </td><td>  2006 </td><td>  2017-01-13 </td><td>  18.7000 </td><td>  20 </td></tr></tbody></table><br></div></div><br><h5>  3.2.  Normalization </h5><br>  The next stage can be conventionally called normalization, we will replace all fields with the <b>_Dim</b> suffix <b>with</b> links to the corresponding directories, <b>we</b> <b>will</b> convert the fields with the <b>_Date</b> and <b>_Val</b> suffixes into dates and numbers, respectively.  It is possible, if necessary, to use other data type suffixes, it is not a dogma. <br><br>  For each <b>_Dim</b> field <b>,</b> we check the availability of the corresponding directory (if there is no directory, we will create it) and add new values ‚Äã‚Äãfrom the field of the brewed table. <br><br>  At the end of the process, we transfer the data to the final storage structure by linking the brewed table with the updated reference books for the field values. <br><br>  As a result, we get our target tables, which will contain the file code, hierarchical identifier, references to the values ‚Äã‚Äãof reference books and the remaining fields converted to the necessary types. <br><br><h4>  In conclusion of the process description </h4><br>  A hierarchical identifier in each target table gives us the opportunity to link these tables with each other (and in any order, if necessary, intermediate links can be omitted).  As noted above, the fixed size of the elements of a hierarchical identifier allows us to fairly easily build expressions to link our target tables. <br><br>  Of course, if you wish, you can supplement the structure of the table with links through the values ‚Äã‚Äãof the usual auto-increment keys. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note the sufficient tolerance of the described approach to the errors and omissions of the developer (more precisely, the person configuring the mapping). </font><font style="vertical-align: inherit;">If in the process of preparing the transformation you missed the required field, or if there were changes in the file scheme, such as adding or renaming fields that were not tracked on time, that's fine, even if a large amount of information was already processed without taking this error into account. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All the information we have saved and available in our ‚Äúprimary‚Äù table storage, so the source code will not have to be re-parsed.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is possible to register mapping of fields for ‚Äúsmall‚Äù data transformation - only for the missing fragment we need. </font><font style="vertical-align: inherit;">After we ‚Äúpull out‚Äù the missing piece of data, we will be able to ‚Äúpick up‚Äù it quite easily to the main processed array through a bundle using a hierarchical identifier.</font></font><br><br><h4>  findings </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we see, from the very beginning we put all the original information, regardless of the document schemes, in a uniform form, which allows you to quickly ‚Äúpull out‚Äù the necessary data in ad-hoc mode. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the course of further processing, </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no animals suffered,</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> there was no need to create or modify any scripts or objects of the type ETL task, specific to the structure of the source XML files. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, the software environment of our ‚Äúframework‚Äù (download infrastructure and data overflow) needed to be created once, but then the data integration of any XML structures is reduced to editing the mapping table of the source and target views.</font></font></div><p>Source: <a href="https://habr.com/ru/post/325186/">https://habr.com/ru/post/325186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325170/index.html">Splunk + Check Point, an example of analyzing your firewall logs</a></li>
<li><a href="../325174/index.html">How I struggle with procrastination - and usually win</a></li>
<li><a href="../325176/index.html">We host a site in the interplanetary IPFS file system under Windows</a></li>
<li><a href="../325178/index.html">Memory optimization: difficult, but sometimes necessary</a></li>
<li><a href="../325184/index.html">DevOps in the service of man</a></li>
<li><a href="../325188/index.html">Fake promises, aggressive ads, trojan downloaders and other Google Play surprises</a></li>
<li><a href="../325190/index.html">I write as I want, or All for a meeting with ruHaskell in Kaspersky Lab</a></li>
<li><a href="../325192/index.html">Video review service HostTracker</a></li>
<li><a href="../325194/index.html">Passing configuration parameters to Autofac modules in ASP.NET Core</a></li>
<li><a href="../325196/index.html">CAPWAP State Machine in the Cisco Unified Wireless Implementation: Discovery State</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>