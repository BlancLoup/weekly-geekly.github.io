<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is dinghy or how to speed up docker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I looked at Habr to see how developers use dinghy (dinghy) and generally speed up the work of a docker on a poppy. To my surprise, at the request...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is dinghy or how to speed up docker</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/3ee/ecf/687/3eeecf6870f64fba994191100816fc7e.png"><br><br>  Once I looked at Habr to see how developers use dinghy (dinghy) and generally speed up the work of a docker on a poppy.  To my surprise, at the request of the dings, I found exactly zero articles.  It would be dishonest not to mention that the same query produced 4 comments.  On the other hand, this fact did not change the picture as a whole. <br><br>  So it turned out that the dings very well fit into my technological stack, and also helped me solve some problems, the most important of which are: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Osx docker performance </li><li>  Running multiple containers that run on port 80 </li></ul><br>  Under the cat a more detailed description of the above problems, as well as ways to solve them. <br><a name="habracut"></a><br><h2>  Problem 1: low docker performance on poppy </h2><br>  Since the docker is written on top of the Linux kernel, it is necessary to use virtual machines for other OSes.  This, in turn, adversely affects the productivity of your work environment.  Indeed, now, in order for your changes to fall into the container, you need to take additional steps. <br><br><h3>  Docker toolbox </h3><br><img src="https://habrastorage.org/web/f37/094/b83/f37094b830aa4d57a7cf90d063886cdf.png"><br>  If you have a small project, then you might be satisfied with the <a href="https://www.docker.com/products/docker-toolbox">docker toolbox</a> .  Included with it is <a href="http://boot2docker.io/">boot docker</a> as a virtual machine.  In this case, you also need to have a virtual box, where this virtual machine will be running. <br><br>  In my case, the toolbox was quite slow.  This tool is well suited for running ‚Äústatic‚Äù containers.  When it is necessary to intensively develop an application, you need to create mounted volumes (I‚Äôve been trying to find the Russian equivalent for a long time, have ideas?) Of your working directory, that is, the directory with the code of your application.  And here the problems begin.  Finding out that the toolbox does not use either NFS or rsync, I began to look for other solutions. <br><br>  <i>Benefits:</i> <br>  - easy to install and configure <br>  <i>Disadvantages:</i> <br>  - slow when developing large projects <br><br><h3>  Docker for mac </h3><br><img src="https://habrastorage.org/web/f0f/700/041/f0f700041fb44e56aeb7d01a269d0b89.png"><br><br>  Unlike the toolbox, the docker for poppy does not use virtual boxing.  As a layer of virtualization, he uses HyperKit.  Feature - you can use only one virtual machine.  However, if necessary, you can run the docker for the poppy in parallel with the toolbox. <br><br>  Unfortunately, the docker for poppy was even slower.  I did not find any obvious (and non-obvious) way how to speed up this application. <br><br>  <i>Benefits:</i> <br>  - even easier to install and configure <br>  <i>Disadvantages:</i> <br>  - terribly slow <br><br><h3>  docker-osx-dev </h3><br>  A good solution for speeding up work on local machines when working with toolbox.  <a href="https://github.com/brikis98/docker-osx-dev">Docker-osx-dev</a> uses rsync, which significantly speeds up sending changes to the container.  The disadvantage of this solution is the ‚Äúbloated‚Äù size of the container, since the files themselves are copied into the container. <br><br>  Therefore, using this approach, you need to take care of a virtual machine with an increased amount of memory.  Caches, builds, logs - everything will increase the amount of memory. <br>  Another drawback I would call the process hanging in the terminal.  Background mode is not supported by default. <br><br>  <i>Benefits:</i> <br>  - significantly speeds up the transfer of files to the container <br>  <i>Disadvantages:</i> <br>  - hanging process <br>  - inflates container size <br><br><h3>  Dinghy </h3><br>  <a href="https://github.com/codekitchen/dinghy">Dinghy</a> is a add-on to the docker-machine (docker-machine), which includes NFS and proxy (which we will talk about later, now we are interested in the performance problem).  And as far as I know, nothing faster than NFS (in this context) has yet been invented. <br><br>  Now, instead of creating and using the default or boot docker of the virtual machine, we create the dinge machine.  By default, it will already have NFS enabled.  If you do not want to use a proxy, then you can disable it in the dinga settings by setting the corresponding flag to true: <br><br><pre><code class="bash hljs">cat ~/.dinghy/preferences.yml :preferences: :proxy_disabled: <span class="hljs-literal"><span class="hljs-literal">false</span></span> :fsevents_disabled: <span class="hljs-literal"><span class="hljs-literal">false</span></span> :create: provider: virtualbox disk: 30000</code> </pre> <br>  Disadvantage: since you explicitly import environment variables (for example <code>export DOCKER_MACHINE_NAME=dinghy</code> , etc.), using conventional docker machines in parallel with dings can be a lot of trouble. <br><br>  <i>Benefits:</i> <br>  - work speed <br>  - no additional processes <br>  <i>Disadvantages:</i> <br>  - may need additional configs (docker-compose.yml) <br>  - DOCKER_MACHINE_NAME conflict with a regular docker machine <br><br><h2>  Problem 2: applications on port 80 </h2><br>  After we have accelerated the work of our working environment, another problem may arise: the need to have 2 or more containers running on port 80.  ‚ÄúWhat a problem, just take and port another port,‚Äù a careful reader might say.  Indeed, often this solution is enough.  But sometimes, the configuration of projects is quite complicated and confusing.  In these cases, it is necessary to have exactly 80 ports. <br><br>  Well, good news, because a proxy is included in the dinghy by default.  Along with the launch of the Dingi virtual machine, you can notice the always running container: <br><br><pre> <code class="bash hljs">169b86af85da codekitchen/dinghy-http-proxy:2.5 <span class="hljs-string"><span class="hljs-string">"/app/docker-entry..."</span></span> 4 hours ago Up 4 hours 0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 19322/tcp, 0.0.0.0:19322-&gt;19322/udp dinghy_http_proxy</code> </pre><br>  This container listens on port 80 and accepts all requests for themselves.  Inside this container there is a nginx server that automatically creates virtual servers based on your docker-compose file.  All you need to do is specify the <code>hostname</code> in this file.  Further, when accessing this host, the ding will find the desired entry and redirect it to the desired container.  Profit <br><br><h2>  Conclusion </h2><br>  Initially, I planned to give more technical details, examples of configurations and scripts, but in the course of writing this article, I realized that I had gone a little differently.  In addition, it would have turned out too long, probably.  At the same time, I answered the questions posed and very much hope that this article turned out to be useful and / or interesting for you. <br><br>  If you have an interest in technical details, leave comments, I will try to answer everything. <br><br>  Thanks for attention. <br><br>  <i>Update from 18.09:</i> <br>  after discussion in the comments with <a href="https://habrahabr.ru/users/umputun/" class="user_link">umputun,</a> removed from the flaws of the docker for the poppy: <br>  - only one virtual machine, customizable by the application itself </div><p>Source: <a href="https://habr.com/ru/post/338198/">https://habr.com/ru/post/338198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338188/index.html">Control of dangerous cash operations: integration of video surveillance with 1C</a></li>
<li><a href="../338190/index.html">Generating a family tree based on Wikipedia data</a></li>
<li><a href="../338192/index.html">Experiment: Is everyone really good at design?</a></li>
<li><a href="../338194/index.html">I do not want to learn, I want ...</a></li>
<li><a href="../338196/index.html">The results of the poll "How would you like to see Toster.ru?"</a></li>
<li><a href="../338200/index.html">GeekUniversity opens a set of game development faculty</a></li>
<li><a href="../338202/index.html">Playing with a quantum coin</a></li>
<li><a href="../338204/index.html">New test: Crucial BX300 SSD</a></li>
<li><a href="../338206/index.html">Overview of foreign and Russian domain name registrars. Comparing marketing tricks with us and with them</a></li>
<li><a href="../338208/index.html">RailsClub 2017. Interview with Nikita Shilnikov, Dry-rb and Rom-rb core developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>