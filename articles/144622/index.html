<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity3D 3.x Introduction to Surface Shaders</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sooner or later, the capabilities of standard shaders will be missed, and then Surface Shaders will come to your aid. In fact, this is an add-on for o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity3D 3.x Introduction to Surface Shaders</h1><div class="post__text post__text-html js-mediator-article">  Sooner or later, the capabilities of standard shaders will be missed, and then Surface Shaders will come to your aid.  In fact, this is an add-on for ordinary shaders, which allows you to write more understandable and compact code. <br>  In the Surface Shader, you can control the lighting, shadows, rendering paths using the same Cg / HLSL code. <br><a name="habracut"></a><br><h4>  Creating a shader from scratch </h4><br>  <a href="http://pastebin.com/9RrzMSMV">Here is the full version of the shader, where I will take the pieces for consideration</a> <br><br>  The first line is the shader path. <br><pre><code class="cpp hljs">Shader <span class="hljs-string"><span class="hljs-string">"AgasperShaders/TestShader"</span></span> {</code> </pre> <br>  In this way it will be available in the inspector. <br><br><h5>  Properties </h5><br>  Next come the <i>Properties</i> , these are the parameters that you can set in the inspector.  Each parameter has a variable name, description, type and default value. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs">Properties { _Color (<span class="hljs-string"><span class="hljs-string">"Main Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _SpecColor (<span class="hljs-string"><span class="hljs-string">"Specular Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) _Shininess (<span class="hljs-string"><span class="hljs-string">"Shininess"</span></span>, Range (<span class="hljs-number"><span class="hljs-number">0.03</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.078125</span></span> _MainTex (<span class="hljs-string"><span class="hljs-string">"Base (RGB) Gloss (A)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _BumpMap (<span class="hljs-string"><span class="hljs-string">"Normalmap"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"bump"</span></span> {} _Amount (<span class="hljs-string"><span class="hljs-string">"Extrusion Amount"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> }</code> </pre><br>  Data types: <br><br>  <b>name ("display name", Range (min, max)) = number</b> <br>  <i>The range of values ‚Äã‚Äãof type float from min to max, in the inspector will be displayed as a slider</i> <br><br>  <b>name ("display name", Color) = (number, number, number, number)</b> <br>  <i>The value of the color type, the default value should be an RGBA float from 0 to 1. In the inspector it will be displayed as a color picker</i> <br><br>  <b>name ("display name", 2D) = "def_col" {options}</b> <br>  <i>Describes the texture.</i>  <i>In the inspector will be as a texture</i> <br><br>  <b>name ("display name", Rect) = "def_col" {options}</b> <br>  <i>Describes a texture with a size not 2 <sup>n</sup> .</i>  <i>In the inspector will be as a texture</i> <br><br>  <b>name ("display name", Cube) = "def_col" {options}</b> <br>  <i>Describes the cubemap texture.</i>  <i>In the inspector will be as a texture</i> <br><br>  <b>name ("display name", Float) = number</b> <br>  <i>Just float, in the inspector will be as an input field with a number</i> <br><br>  <b>name ("display name", Vector) = (number, number, number, number)</b> <br>  <i>Describes a vector</i> <br><br>  The default value (def_col) for the Rect, 2D and Cubemap types can be empty, or: ‚Äúwhite‚Äù, ‚Äúblack‚Äù, ‚Äúgray‚Äù, ‚Äúbump‚Äù.  It indicates what color the pixels will be by default inside the texture. <br><br>  Here is what we will see as a result in the inspector: <br><br><img src="https://habrastorage.org/storage2/063/614/450/063614450812db30126201b0b5b4d6b3.png"><br><br><h5>  Subshaders </h5><br>  Next is SubShader.  When a unit tries to draw an object, it searches for the first suitable SubShader in the list, this is a shader.  If no SubShader is found, an error will occur.  For example, this may be necessary in a situation when you want to realize the capabilities of Shader Model 3.0, but leave the opportunity to play to people with the old video card. <br>  Inside the Surface SubShader are the SubShader tags and the code itself. <br>  The <b>RenderType = "Opaque" tag</b> means that we are going to render an opaque object.  Read more about tags <a href="http://unity3d.com/support/documentation/Components/SL-SubshaderTags">here</a> and <a href="http://unity3d.com/support/documentation/Components/SL-ShaderReplacement.html">here.</a> <br><br><pre> <code class="cpp hljs">SubShader { Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span> = <span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> } <span class="hljs-comment"><span class="hljs-comment">//code }</span></span></code> </pre><br><h5>  Actually the code itself </h5><br>  In the SurfaceShader code, you can describe three functions (in principle, more is possible, but rarely needed): <br><ul><li>  The function of calculating the vertices </li><li>  Surface drawing function </li><li>  Lighting calculation function </li></ul><br>  For example, let's write a Diffuse Bumped Specular shader with morphing.  I will not describe the lighting calculation function in this article; we will assemble the standard BlinnPhong. <br><br><pre> <code class="cpp hljs">CGPROGRAM <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf BlinnPhong vertex:vert</span></span></code> </pre><br>  <b>CGPROGRAM</b> is a directive that declares what we write in the <a href="http://en.wikipedia.org/wiki/Cg_(programming_language)">Cg</a> language (terminated by the <b>ENDCG</b> directive). <br><br>  The second line we declare that: <br><ul><li>  the surface drawing procedure is called <b>surf</b> </li><li>  <b>BlinnPhong</b> light will be used in the shader (it is also Lambert, Unlit, or its own procedure) </li><li>  the procedure for changing vertices is called <b>vert</b> </li></ul><br>  Now we declare the variables that will be used in the code: <br><br><pre> <code class="cpp hljs">sampler2D _MainTex; sampler2D _BumpMap; fixed4 _Color; half _Shininess; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _Amount;</code> </pre><br>  Unity will take care that the data from the shader parameters declared above are in these variables.  <u>It is important to name them as well as in the shader parameters.</u> <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_full v)</span></span></span><span class="hljs-function"> </span></span>{ v.vertex.xyz += v.normal * v.vertex.xyz * _Amount ; }</code> </pre><br>  And here is the procedure for the vertex part of our shader.  For example, take the coordinates of the current vertex and add to them the normal multiplied by the current coordinates and the coefficient of the shader parameters.  Of course, some kind of crap will turn out, but for example it is quite enough.  Slider <b>Amount</b> you can adjust the degree of distortion of the object. <br>  Example: <br><img src="https://habrastorage.org/storage2/dc4/a81/9f5/dc4a819f571a960f4c47a4f0b9a5864d.png"><br><br>  The official documentation has <a href="http://unity3d.com/support/documentation/Components/SL-SurfaceShaderExamples.html">an example of a swollen soldier</a> .  They just picked up all the vertices along the normal: <br><br><pre> <code class="cpp hljs">v.vertex.xyz += v.normal * _Amount ;</code> </pre><br><br><img src="http://unity3d.com/support/documentation/Images/manual/SL-SurfaceShaderExamples-9.jpg" alt="image"><br><br>  What else is inside: <br><ul><li>  <b>float4 vertex</b> - coordinates of the current vertex </li><li>  <b>float3 normal</b> - <a href="http://ru.wikipedia.org/wiki/%25D0%259D%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C">normal</a> to the surface at the current point </li><li>  <b>float4 texcoord</b> - UV coordinates of the first texture </li><li>  <b>float4 texcoord1</b> - UV coordinates of the second texture </li><li>  <b>float4 tangent</b> - tangent vector </li><li>  <b>float4 color</b> - vertex color </li></ul><br>  <a href="http://unity3d.com/support/documentation/Components/SL-VertexProgramInputs">Here</a> you can read the full article on vertex shaders. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> {</span></span> float2 uv_MainTex; float2 uv_BumpMap; };</code> </pre><br>  In the <b>Input</b> structure, you can ask the shader for additional variables that you will need for calculations in the surface procedure.  We asked for the UV coordinates of both textures.  The variable should be called uv_ Texture <i>Name</i> for the first UV coordinates and uv2_ Texture <i>Name</i> for the second, respectively. <br>  A complete list of what you can specify <a href="http://unity3d.com/support/documentation/Components/SL-SurfaceShaders">there is here</a> . <br><br>  Here is the procedure for drawing the surface: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutput o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     UV . fixed4 tex = tex2D(_MainTex, IN.uv_MainTex); //     o.Albedo = tex.rgb * _Color.rgb; //       o.Gloss = tex.rgb; //      o.Specular = _Shininess; //     o.Normal = UnpackNormal(tex2D(_BumpMap, IN.uv_BumpMap)); }</span></span></code> </pre><br>  The <b>Input</b> structure is passed to it, and inside it is necessary to fill the <b>SurfaceOutput</b> structure, which has the following form: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SurfaceOutput</span></span></span><span class="hljs-class"> {</span></span> half3 Albedo; <span class="hljs-comment"><span class="hljs-comment">//  () half3 Normal; //  half3 Emission; // (   ) half Specular; //""     (    (dot(viewDir, Normal)) half Gloss; //     half Alpha; //    (    "RenderType" = "Opaque") };</span></span></code> </pre><br><br>  We finish the shader with a string <br><pre> <code class="cpp hljs">FallBack <span class="hljs-string"><span class="hljs-string">"Specular"</span></span></code> </pre><br>  This means that if for some reason the shader does not work on the client machine, then you need to roll back to the Specular shader. <br><br>  <a href="http://pastebin.com/9RrzMSMV">The full version of the shader from the example</a> <br><br>  Materials used to write the article: <br>  <a href="http://unity3d.com/support/documentation/Components/SL-SurfaceShaders">http://unity3d.com/support/documentation/Components/SL-SurfaceShaders</a> <br>  <a href="http://unity3d.com/support/documentation/Components/SL-SurfaceShaderExamples.html">http://unity3d.com/support/documentation/Components/SL-SurfaceShaderExamples.html</a> <br>  <a href="http://unity3d.com/support/documentation/Components/SL-SubShader">http://unity3d.com/support/documentation/Components/SL-SubShader</a> <br>  <a href="http://unity3d.com/support/documentation/Components/SL-SubshaderTags">http://unity3d.com/support/documentation/Components/SL-SubshaderTags</a> <br>  <a href="http://unity3d.com/support/documentation/Components/SL-ShaderReplacement.html">http://unity3d.com/support/documentation/Components/SL-ShaderReplacement.html</a> </div><p>Source: <a href="https://habr.com/ru/post/144622/">https://habr.com/ru/post/144622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144616/index.html">PT-3 phonograph: review, characteristics and demonstration of work. Year of release - 1935</a></li>
<li><a href="../144617/index.html">Creating a Simple Java Application</a></li>
<li><a href="../144618/index.html">Astrology and Data Mining</a></li>
<li><a href="../144620/index.html">Using the Arduino UNO as a programmer</a></li>
<li><a href="../144621/index.html">IT Quest 4</a></li>
<li><a href="../144623/index.html">Deepest Site</a></li>
<li><a href="../144624/index.html">Weather Forecast Thermometer</a></li>
<li><a href="../144625/index.html">TDS and MLS methods of impulse response estimates</a></li>
<li><a href="../144626/index.html">Moving project from SVN to Git</a></li>
<li><a href="../144628/index.html">List functions in CouchDB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>