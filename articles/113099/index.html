<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the Brainfuck interpreter on Mercury</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing the week Brainfuck on Habr√© and his experiments with Mercury , wrote his version of the interpreter. I apologize in advance for not having ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the Brainfuck interpreter on Mercury</h1><div class="post__text post__text-html js-mediator-article">  Continuing the <a href="http://habrahabr.ru/search/%3Fq%3Dbrainfuck">week Brainfuck on Habr√©</a> and his <a href="http://habrahabr.ru/blogs/programming/112030/">experiments</a> with <a href="http://progopedia.ru/language/mercury/">Mercury</a> , wrote his version of the interpreter.  I apologize in advance for not having yet submitted the introductory article on Mercury.  In fact, it is in the process of writing. <br>  In the meantime, I will provide a solution code that will illustrate at the same time several possibilities of the Mercury language. <br><a name="habracut"></a><br><pre><code class="php hljs">:- module bf. :- <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class">. :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">import_module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">. :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pred</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">di</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uo</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">det</span></span></span><span class="hljs-class">. :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class">. :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">import_module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">char</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">solutions</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">require</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">. :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_cmd</span></span></span><span class="hljs-class"> ---&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plus</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">minus</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">step</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">back</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cycle</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_cmd</span></span></span><span class="hljs-class">)). :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class"> ---&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">left</span></span></span><span class="hljs-class"> :: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cell</span></span></span><span class="hljs-class"> :: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class"> :: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">) ). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hello_world</span></span></span><span class="hljs-class"> = "++++++++++[&gt;+++++++&gt;++++++++++&gt;+++&gt;+&lt;&lt;&lt;&lt;-]&gt;++\ .&gt;+.+++++++..+++.&gt;++.&lt;&lt;+++++++++++++++.&gt;.+++.\ ------.--------.&gt;+.&gt;.". </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">squares_1_to_1000</span></span></span><span class="hljs-class"> = "++++[&gt;+++++&lt;-]&gt;[&lt;+++++&gt;-]+&lt;+[\ &gt;[&gt;+&gt;+&lt;&lt;-]++&gt;&gt;[&lt;&lt;+&gt;&gt;-]&gt;&gt;&gt;[-]++&gt;[-]+\ &gt;&gt;&gt;+[[-]++++++&gt;&gt;&gt;]&lt;&lt;&lt;[[&lt;++++++++&lt;++&gt;&gt;-]+&lt;.&lt;[&gt;----&lt;-]&lt;]\ &lt;&lt;[&gt;&gt;&gt;&gt;&gt;[&gt;&gt;&gt;[-]+++++++++&lt;[&gt;-&lt;-]+++++++++&gt;[-[&lt;-&gt;-]+[&lt;&lt;&lt;]]&lt;[&gt;+&lt;-]&gt;]&lt;&lt;-]&lt;&lt;-\ ]". </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fib_1_to_100</span></span></span><span class="hljs-class"> = "+++++++++++\ &gt;+&gt;&gt;&gt;&gt;++++++++++++++++++++++++++++++++++++++++++++\ &gt;++++++++++++++++++++++++++++++++&lt;&lt;&lt;&lt;&lt;&lt;[&gt;[&gt;&gt;&gt;&gt;&gt;&gt;+&gt;\ +&lt;&lt;&lt;&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;&gt;&gt;&gt;[&lt;&lt;&lt;&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;&gt;&gt;&gt;-]&lt;[&gt;++++++++++[-\ &lt;-[&gt;&gt;+&gt;+&lt;&lt;&lt;-]&gt;&gt;&gt;[&lt;&lt;&lt;+&gt;&gt;&gt;-]+&lt;[&gt;[-]&lt;[-]]&gt;[&lt;&lt;[&gt;&gt;&gt;+&lt;&lt;&lt;\ -]&gt;&gt;[-]]&lt;&lt;]&gt;&gt;&gt;[&gt;&gt;+&gt;+&lt;&lt;&lt;-]&gt;&gt;&gt;[&lt;&lt;&lt;+&gt;&gt;&gt;-]+&lt;[&gt;[-]&lt;[-]]\ &gt;[&lt;&lt;+&gt;&gt;[-]]&lt;&lt;&lt;&lt;&lt;&lt;&lt;]&gt;&gt;&gt;&gt;&gt;[+++++++++++++++++++++++++\ +++++++++++++++++++++++.[-]]++++++++++&lt;[-&gt;-&lt;]&gt;++++\ ++++++++++++++++++++++++++++++++++++++++++++.[-]&lt;&lt;\ &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;[&gt;&gt;&gt;+&gt;+&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;[&lt;&lt;&lt;&lt;+&gt;&gt;&gt;&gt;-]&lt;-[&gt;&gt;.&gt;.&lt;&lt;&lt;\ [-]]&lt;&lt;[&gt;&gt;+&gt;+&lt;&lt;&lt;-]&gt;&gt;&gt;[&lt;&lt;&lt;+&gt;&gt;&gt;-]&lt;&lt;[&lt;+&gt;-]&gt;[&lt;+&gt;-]&lt;&lt;&lt;-]". </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prog_to_ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Prog</span></span></span><span class="hljs-class">) = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ast</span></span></span><span class="hljs-class"> :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to_char_list</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Prog</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Chars</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">solutions</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pred</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ast_</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">out</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nondet</span></span></span><span class="hljs-class"> :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ast_</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Chars</span></span></span><span class="hljs-class">, []:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">char</span></span></span><span class="hljs-class">)), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Asts</span></span></span><span class="hljs-class">), ( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Asts</span></span></span><span class="hljs-class"> = [], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Program</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invalid</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parse</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">)!") ; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Asts</span></span></span><span class="hljs-class"> = [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ast</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_</span></span></span><span class="hljs-class">] ). :- </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">out</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">out</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">multi</span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plus</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">]) --&gt; ['+'], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">minus</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">]) --&gt; ['-'], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">step</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">]) --&gt; ['&gt;'], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">back</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">]) --&gt; ['&lt;'], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">]) --&gt; ['.'], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cycle</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cycle</span></span></span><span class="hljs-class">)|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">]) --&gt; ['['], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cycle</span></span></span><span class="hljs-class">), [']'], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ast</span></span></span><span class="hljs-class">([]) --&gt; []. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_ast</span></span></span><span class="hljs-class">([], !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class">) --&gt; []. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_ast</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmd</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">], !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class">) --&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_cmd</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmd</span></span></span><span class="hljs-class">, !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_ast</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cmds</span></span></span><span class="hljs-class">, !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class">). </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_cmd</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">plus</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">+1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">)) --&gt; []. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_cmd</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">minus</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">-1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">)) --&gt; []. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute_cmd</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">step</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bf_state</span></span></span><span class="hljs-class">([</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class">|</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">L</span></span></span><span class="hljs-class">], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">H</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">)) --&gt; </span></span>{R = [], H=<span class="hljs-number"><span class="hljs-number">0</span></span>, T=[]; R = [H|T]}. execute_cmd(back, bf_state(L,C,R), bf_state(T, H, [C|R])) --&gt; {L = [], H=<span class="hljs-number"><span class="hljs-number">0</span></span>, T=[]; L = [H|T]}. execute_cmd(<span class="hljs-keyword"><span class="hljs-keyword">print</span></span>, S @ bf_state(_,C,_), S) --&gt; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(char.det_from_int( C ):char). execute_cmd(Cmd @ cycle(Cmds), !.S @ bf_state(_,C,_), !:S) --&gt; ( {C \= <span class="hljs-number"><span class="hljs-number">0</span></span>} -&gt; execute_ast(Cmds, !S), execute_cmd(Cmd, !S) ; [] ). execute_str(Prog) --&gt; {Ast = prog_to_ast(Prog)}, execute_ast(Ast, bf_state([], <span class="hljs-number"><span class="hljs-number">0</span></span>, []), _). main --&gt; execute_str(hello_world), nl, execute_str(squares_1_to_1000), nl, execute_str(fib_1_to_100).</code> </pre> <br><br>  And immediately the output of this program: <br><br><pre> <code class="hljs tex">D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stuff</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">test</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mercury</span></span></span></span>&gt;bf.exe Hello World! 0 1 4 9 16 25 36 49 64 81 100 121 ... &lt; &gt; 9025 9216 9409 9604 9801 10000 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A little about my decision.  It consists of 2 steps. <br><ol><li>  text conversion brainfuck program in <a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree">AST (abstract syntax tree)</a> </li><li>  execution tree AST </li></ol><br>  At the first stage, from the piece of BF code, for example, '+++ &gt;&gt; [+ -] &lt;', the structure of AST is obtained as a list [plus, plus, plus, step, step, cycle ([plus, minus]), back].  The <i>nondeterministic</i> predicate ast is responsible for this.  For those who are not quite clear about this concept, I‚Äôll simplify that this is such a predicate that can return more than one solution, and these solutions will be moved using backtracking, while the whole expression consisting of this and the predicates surrounding it will not be true.  This principle is based on the convenience of writing a parser that parses the text of a program using the depth-first search method (although there are many shortcomings in this approach, this topic is well covered in <a href="http://habrahabr.ru/blogs/programming/99466/">this charteratopic</a> ).  It should be noted that this stage, along with parsing, automatically checks syntactic correctness (namely, the correctness of the bracket structure).  If it is incorrect, the target ast (Ast_, Chars, []: list (char)) will fail, and we will get the error ‚ÄúProgram invalid (parse error)!‚Äù.  The second remark: the ast predicate is written in <a href="http://ru.wikipedia.org/wiki/DC-%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0">DCG</a> notation, which is supported by the mercury language as well as by many traditional prologues. <br><br>  At the second stage (for which the predicates execute_ * are responsible), the ‚Äúcomputation‚Äù of the obtained syntax tree occurs.  Each execute_ * predicate takes the initial state of the cell tape as an input, changes it according to the AST brainfuck program, and returns the resultant, which should be after applying this predicate (as we know, functional languages ‚Äã‚Äãcannot tolerate variable data structures). <br><br>  Here it should be noted the structure of the task state of the tape.  As you know, the (correctly) selected data structure determines the (optimal) implementation algorithm and its complexity.  In this case, the structure of the tape was determined by two lists and a number: bf_state (LeftCells, Cell, RightCells).  With this approach, increasing and decreasing the cell is changing the Cell by + -1, and shifting left (right) is moving the head of the list from Left (Right) Cells to the Cell and Cell itself to the head Right (Left) Cells (well, and a special case Cell assignment = 0 in the case of an empty list of Left (Right) Cells). <br><br>  The advantage of this view: <br><ul><li>  no need to prefill a fixed-length list (memory saving) </li><li>  unlimited tape length (except for limitations imposed by computer resources) </li></ul><br>  Another explanation.  An incomprehensible! S entry in mercury is called a state variable and is a pair of variables! .S,!: S with in and out modes.  This is convenient for chaining predicates with passing parameters from the previous output to the next input, i.e.  a record <br><br> <code>some_pred(In, Out) :- pred1(In, In1), pred2(In1, In2), pred3(In2, Out). <br></code> <br>  equivalent to: <br><br> <code>some_pred(!.S, !:S) :- pred1(!.S, !:S), pred2(!.S, !:S), pred3(!.S, !:S). %     <br></code> <br>  which in turn is equivalent to: <br><br> <code>some_pred(!S) :- pred1(!S), pred2(!S), pred3(!S). <br></code> <br>  or in the form of DCG notation: <br><br> <code>some_pred --&gt; pred1, pred2, pred3. <br></code> <br>  But more about this and other features of mercury in another article =) </div><p>Source: <a href="https://habr.com/ru/post/113099/">https://habr.com/ru/post/113099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113089/index.html">Completion and main functionality of Nokia E7</a></li>
<li><a href="../113094/index.html">Toy for geeks - wireless domino</a></li>
<li><a href="../113095/index.html">Manage tasks and affairs with 42tasks</a></li>
<li><a href="../113097/index.html">Chemical Editor Chem4Word released under Open Source</a></li>
<li><a href="../113098/index.html">Propaganda viewing of pornography through a reliable browser on a trusted site?</a></li>
<li><a href="../113100/index.html">Wired UK with personalized covers</a></li>
<li><a href="../113101/index.html">Installation and configuration: Nginx + php5-fpm</a></li>
<li><a href="../113102/index.html">We direct corporate order in Outlook: signatures, names, Plain Text</a></li>
<li><a href="../113104/index.html">Convenient rescue DIY</a></li>
<li><a href="../113106/index.html">Time Lapse Photo Motion on Samsung NX100</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>