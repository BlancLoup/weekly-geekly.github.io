<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kidhak Prehistorik 2: unlocked levels</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lovers of this wonderful game is dedicated to ... 
  
 ... if there are any. However, I am sure that not everything is so bad and Crysis has not swall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kidhak Prehistorik 2: unlocked levels</h1><div class="post__text post__text-html js-mediator-article"><h4>  Lovers of this wonderful game is dedicated to ... </h4><br> <a href="http://plewick.deviantart.com/art/Prehistorik-2-282430653"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/b1c/736/f58/b1c736f58d3546028bf2dc22d224d5f0.jpg" alt="image"></a> <br>  ... if there are any.  However, I am sure that not everything is so bad and Crysis has not swallowed the brain of mankind entirely and completely. <br>  So, the aforementioned lovers of the old games and in particular one great game of 92 years can remember that the system of saving in the game is made in a somewhat platformer spirit: the levels are scattered (sometimes in rather unexpected and hard-to-reach places) codes that in times of MS-DOS recorded on paper and stored as a treasure.  The code entered in the main menu allows you to start the appropriate level from the starting position. <br>  <i>Soshite</i> , in our time, appeared, in some way, a problem for those who would like to play Prehistorik 2. Namely - the need to emulate the game in Dosbox: not everyone has the opportunity to find at a dump or, much less often, pull out mezzanine carefully kept there 486th. <br>  The fact is that when generating codes, the game uses BIOS environment variables.  I didn‚Äôt understand how it is emulated in Dosbox, I know for sure that with each new emulator launch the codes in the game are different.  Accordingly, the piece of paper with the codes becomes useless, and the possibility of a pleasant and non-stressing passing of the game is reduced almost to nothing: completely the game can be completed only in one sitting.  Perhaps this is solved by setting Dosbox in detail.  But ... this is so trivial, so trivial, that it scares even more than a little digging into the executable file of the game. <br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/f07/cba/08e/f07cba08e00051a405a35123b82fc7f1.jpg" alt="image" align="right"><br>  Implement a small hack, as a result of which an oldheimer <s>like me</s> could, instead of the code, enter just the number of the desired level.  <a href="https://habr.com/ru/post/220167/">Go directly to the results.</a> <br><br><br><br>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><br><br><br><h4>  Decision </h4><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/ffc/daa/dbc/ffcdaadbc04d31b772a5f0a4f3e505c4.jpg" alt="image"><br><br><br><br><br><br><br><br><br><br>  Most of the time I took away unpacking the game file.  The intro of the team that once cracked the copy protection was added to the originally packed game code, and then it was all packed with another algorithm.  For help in unpacking, I turned to the article of Mr. Grechnikov: <a href="http://habrahabr.ru/post/187072/">habrahabr.ru/post/187072</a> , in which I was interested in the section under the heading "Unpacking", and specifically the following paragraph: <br><blockquote>  That is, the rest of the loc_19960 procedure is not called if the / ni parameter is passed on the command line.  We try, we see that with this parameter the game skips the reminder of the gallant team Hybrid and immediately goes to the actual game.  We conclude that the entire seg002 is a screen saver unnecessary for the game, hung on the worker exe's.  Rewrite cs: ip in the header with 0000: 0003, ss: sp at 1681: 0080, cut the last 5E90h bytes, adjusting the size and additional memory fields in the header accordingly. </blockquote><br><br>  <i>(It was not interesting further, because a ready-made solution is not what I wanted.)</i> <br>  After I followed this advice, I found an egg in a duck, previously extracted from a hare ... or how did it usually happen in ancient Russian fairy tales?  It is easier to compare it with the doll: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/efc/b79/a6f/efcb79a6fde390a4661cf18d414d4783.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/06f/168/114/06f168114492afa965abd5c83d2fe7ac.jpg" alt="image"><br><br>  After unpacking the diet program has grown to 90 Kb and nothing has prevented the launch of dirty paws into it.  What I did was to open Hiew and immediately find the line of interest to me: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b81/1b2/61d/b811b261d97539975be5f64d97e36b88.jpg" alt="image"><br><br>  I‚Äôll clarify for those who gain experience (although it‚Äôs always worth learning) that searching for a string in Hiew is right after launching F4 - Hex, F7 - ASCII -&gt; ‚ÄúLine of interest to us‚Äù. <br>  The address of the line is <b>15401</b> .  Now I need to find out where the program is accessing this line.  Naturally, such treatment with a high degree of probability will be close to the part that I set out to break. <br>  How can you find out?  Ways, in fact, many.  You can open the file in Ida Pro and examine cross-references.  True, first setting up Ida so that she was friends with the type of strings used.  But since Id I could not make friends with Dosbox at such a level that it was possible to debug 16-bit files calmly and without annoying factors (Dosbox constantly forgot that it was a debugger and tried to live its life, despite the patch and plug-in) then I decided not to use such heavy artillery at all, where necessary, most likely, just to fix a few bytes. <br>  Therefore, we proceed easier.  To find out where the offset to this line is used in the program, you must first find out the offset itself.  For this you need to know the database of the data segment.  Hiew is more than simple.  Click F8 and look at the file header. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/070/605/ec7/070605ec708f0ea6f5f553cc4efb82bf.jpg" alt="image"><br><br>  So, first open the calculator, switch to the hexadecimal system and enter the Paragraphs in header: 86 value into it, then multiply by 10. Copy this value to the buffer and return to Hiew, where the header window is still not closed.  Without exiting, press F5 to go to the entry point.  And here we will go into decode mode (F4 - decode).  Before us is such a listing: <br><br>  listing 1. <br><pre><code class="hljs vbscript"><span class="hljs-number"><span class="hljs-number">00000468</span></span>: FA cli <span class="hljs-number"><span class="hljs-number">00000469</span></span>: FC cld <span class="hljs-number"><span class="hljs-number">0000046</span></span>A: BAFFFF mov dx,<span class="hljs-number"><span class="hljs-number">0</span></span>FFFF ;<span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-number"><span class="hljs-number">0000046</span></span>D: BE8000 mov si,<span class="hljs-number"><span class="hljs-number">00080</span></span> ;<span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-number"><span class="hljs-number">00000470</span></span>: AC lodsb <span class="hljs-number"><span class="hljs-number">00000471</span></span>: <span class="hljs-number"><span class="hljs-number">98</span></span> cbw <span class="hljs-number"><span class="hljs-number">00000472</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span>BC8 mov cx,ax <span class="hljs-number"><span class="hljs-number">00000474</span></span>: E35E jcxz <span class="hljs-number"><span class="hljs-number">0000004</span></span>D4 ---‚Üì (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">00000476</span></span>: AC lodsb <span class="hljs-number"><span class="hljs-number">00000477</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>C2F cmp al,<span class="hljs-number"><span class="hljs-number">02</span></span>F ;<span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-number"><span class="hljs-number">00000479</span></span>: <span class="hljs-number"><span class="hljs-number">7404</span></span> je <span class="hljs-number"><span class="hljs-number">00000047</span></span>F ---‚Üì (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">0000047</span></span>B: E2F9 <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-number"><span class="hljs-number">000000476</span></span> ---‚Üë (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">0000047</span></span>D: EB55 jmps <span class="hljs-number"><span class="hljs-number">0000004</span></span>D4 ---‚Üì (<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">0000047</span></span>F: AC lodsb <span class="hljs-number"><span class="hljs-number">00000480</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span>DF <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> al,<span class="hljs-number"><span class="hljs-number">0</span></span>DF ;<span class="hljs-string"><span class="hljs-string">"‚ñÄ"</span></span> <span class="hljs-number"><span class="hljs-number">00000482</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>C46 cmp al,<span class="hljs-number"><span class="hljs-number">046</span></span> ;<span class="hljs-string"><span class="hljs-string">"F"</span></span> <span class="hljs-number"><span class="hljs-number">00000484</span></span>: <span class="hljs-number"><span class="hljs-number">7506</span></span> jne <span class="hljs-number"><span class="hljs-number">00000048</span></span>C ---‚Üì (<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">00000486</span></span>: <span class="hljs-number"><span class="hljs-number">2E83260300</span></span>FE <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> w,cs:[<span class="hljs-number"><span class="hljs-number">0003</span></span>],<span class="hljs-number"><span class="hljs-number">0</span></span>FFFE ;<span class="hljs-string"><span class="hljs-string">"‚ñ†"</span></span> <span class="hljs-number"><span class="hljs-number">0000048</span></span>C: <span class="hljs-number"><span class="hljs-number">3</span></span>C4D cmp al,<span class="hljs-number"><span class="hljs-number">04</span></span>D ;<span class="hljs-string"><span class="hljs-string">"M"</span></span></code> </pre> <br><br>  All this is of no interest to us.  We are interested in assigning a value to the ds register.  Even without resorting to searching, we scroll the screen quite a bit down and find what we are looking for: <br><br>  listing 2. <br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">000004</span></span>D4: B8030A mov ax,<span class="hljs-number"><span class="hljs-number">00</span></span>A03 ;<span class="hljs-string"><span class="hljs-string">"‚óô"</span></span> <span class="hljs-number"><span class="hljs-number">000004</span></span>D7: <span class="hljs-number"><span class="hljs-number">8</span></span>ED8 mov ds,ax</code> </pre><br><br>  We take out 00A03 and stuff it into the calculator, where we also multiply by 10 and add it to the value stored earlier in the buffer.  We <b>get A290</b> .  And now let's subtract A290 from 15401: <b>171</b> .  This is the offset of the string that will be used inside the program.  Now we go to the hex-mapping (F4 - Hex) and press F7, where we enter 71 B1 in the line named by the bashurman word ‚ÄúNeh‚Äù (bytes go in the reverse order, remember?).  We leave on the following listing: <br><br>  listing 3. <br><pre> <code class="hljs vbscript"><span class="hljs-number"><span class="hljs-number">00009E23</span></span>: E85801 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-number"><span class="hljs-number">000009</span></span>F7E ---‚Üì (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">00009E26</span></span>: C606A7B103 mov b,[<span class="hljs-number"><span class="hljs-number">0</span></span>B1A7],<span class="hljs-number"><span class="hljs-number">003</span></span> ;<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-number"><span class="hljs-number">00009E2</span></span>B: BB71B1 mov bx,<span class="hljs-number"><span class="hljs-number">0</span></span>B171 ;<span class="hljs-string"><span class="hljs-string">"‚ñíq"</span></span> <span class="hljs-number"><span class="hljs-number">00009E2</span></span>E: C706A2B1F20A mov w,[<span class="hljs-number"><span class="hljs-number">0</span></span>B1A2],<span class="hljs-number"><span class="hljs-number">00</span></span>AF2 ;<span class="hljs-string"><span class="hljs-string">"‚óô–Ñ"</span></span> <span class="hljs-number"><span class="hljs-number">00009E34</span></span>: E8EDFE <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-number"><span class="hljs-number">000009</span></span>D24 ---‚Üë (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">00009E37</span></span>: C606A7B104 mov b,[<span class="hljs-number"><span class="hljs-number">0</span></span>B1A7],<span class="hljs-number"><span class="hljs-number">004</span></span> ;<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-number"><span class="hljs-number">00009E3</span></span>C: BB6CB1 mov bx,<span class="hljs-number"><span class="hljs-number">0</span></span>B16C ;<span class="hljs-string"><span class="hljs-string">"‚ñíl"</span></span> <span class="hljs-number"><span class="hljs-number">00009E3</span></span>F: C706A2B1C912 mov w,[<span class="hljs-number"><span class="hljs-number">0</span></span>B1A2],<span class="hljs-number"><span class="hljs-number">012</span></span>C9 ;<span class="hljs-string"><span class="hljs-string">"‚ïî"</span></span> <span class="hljs-number"><span class="hljs-number">00009E45</span></span>: E8DCFE <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-number"><span class="hljs-number">000009</span></span>D24 ---‚Üë (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">00009E48</span></span>: <span class="hljs-number"><span class="hljs-number">803</span></span>EA6B101 cmp b,[<span class="hljs-number"><span class="hljs-number">0</span></span>B1A6],<span class="hljs-number"><span class="hljs-number">001</span></span> ;<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-number"><span class="hljs-number">00009E4</span></span>D: <span class="hljs-number"><span class="hljs-number">7503</span></span> jne <span class="hljs-number"><span class="hljs-number">000009E52</span></span> ---‚Üì (<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">00009E4</span></span>F: E90001 jmp <span class="hljs-number"><span class="hljs-number">000009</span></span>F52 ---‚Üì (<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">00009E52</span></span>: <span class="hljs-number"><span class="hljs-number">803</span></span>EA6B102 cmp b,[<span class="hljs-number"><span class="hljs-number">0</span></span>B1A6],<span class="hljs-number"><span class="hljs-number">002</span></span> ;<span class="hljs-string"><span class="hljs-string">"‚òª"</span></span> <span class="hljs-number"><span class="hljs-number">00009E57</span></span>: <span class="hljs-number"><span class="hljs-number">7503</span></span> jne <span class="hljs-number"><span class="hljs-number">000009E5</span></span>C ---‚Üì (<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">00009E59</span></span>: E90601 jmp <span class="hljs-number"><span class="hljs-number">000009</span></span>F62 ---‚Üì (<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">00009E5</span></span>C: <span class="hljs-number"><span class="hljs-number">8</span></span>A1E7028 mov bl,[<span class="hljs-number"><span class="hljs-number">2870</span></span>] <span class="hljs-number"><span class="hljs-number">00009E60</span></span>: F6C380 test bl,<span class="hljs-number"><span class="hljs-number">-080</span></span> ;<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-number"><span class="hljs-number">00009E63</span></span>: <span class="hljs-number"><span class="hljs-number">7403</span></span> je <span class="hljs-number"><span class="hljs-number">000009E68</span></span> ---‚Üì (<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-number"><span class="hljs-number">00009E65</span></span>: E91501 jmp <span class="hljs-number"><span class="hljs-number">000009</span></span>F7D ---‚Üì (<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-number"><span class="hljs-number">00009E68</span></span>: A02928 mov al,[<span class="hljs-number"><span class="hljs-number">2829</span></span>] <span class="hljs-number"><span class="hljs-number">00009E6</span></span>B: <span class="hljs-number"><span class="hljs-number">0</span></span>A060C28 <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> al,[<span class="hljs-number"><span class="hljs-number">280</span></span>C]</code> </pre><br><br>  At the beginning of this listing, actions occur with the line of interest, and then the same actions occur with the adjacent string "[[[[".  Perhaps static observation will not get along.  It is necessary to resort to the help of a debugger.  In order not to disturb the atmosphere of the console, I will resort to the special edition Dosbox 0.74, containing a debugger.  In addition, this option is much more stable than the crutch of the Ida + Dosbox plugin. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ce/a8f/8e2/9cea8f8e2412d6f56dd11360f12daba9.jpg" alt="image"><br><br>  So, I open Dosbox-74-debug (after configuring the conf-file, where the commands for mounting the game directory and its launch directive with the debug prefix are simply indicated).  Without further ado, we start the game in trace mode and soon find out what's in this place: <br><br>  listing 4. <br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">014</span></span>C <span class="hljs-number"><span class="hljs-number">7</span></span>B00 jpo <span class="hljs-number"><span class="hljs-number">0000014</span></span>E ($+<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">014</span></span>E C606A46C00 mov byte [<span class="hljs-number"><span class="hljs-number">6</span></span>CA4],<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">0153</span></span> B80300 mov ax,<span class="hljs-number"><span class="hljs-number">0003</span></span> <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">0156</span></span> E86701 call <span class="hljs-number"><span class="hljs-number">000002</span></span>C0 ($+<span class="hljs-number"><span class="hljs-number">167</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">0159</span></span> E8138D call FFFF8E6F ($-<span class="hljs-number"><span class="hljs-number">72</span></span>ed) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">015</span></span>C <span class="hljs-number"><span class="hljs-number">803E862</span></span>D08 cmp byte [<span class="hljs-number"><span class="hljs-number">2</span></span>D86],<span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">0161</span></span> <span class="hljs-number"><span class="hljs-number">7234</span></span> jc <span class="hljs-number"><span class="hljs-number">00000197</span></span> ($+<span class="hljs-number"><span class="hljs-number">34</span></span>)</code> </pre><br><br>  After calling the second subfunction, the main menu is started, which ‚Äúrotates‚Äù inside this subfunction.  We set the breakpoint at the entrance to the first subfunction and start the game again, sending it first to free flight. <br>  It soon turns out that ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/105/8e3/426/1058e3426b43616eed1c9552f3cb065c.jpg" alt="image"><br><br>  ... drawing the main menu ends on this command.  And immediately followed by this listing: <br><br>  listing 5. <br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>E99 <span class="hljs-number"><span class="hljs-number">8</span></span>ED8 mov ds,ax <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>E9B <span class="hljs-number"><span class="hljs-number">33</span></span>C<span class="hljs-number"><span class="hljs-number">0</span></span> xor ax,ax <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>E9D A3EC27 mov [<span class="hljs-number"><span class="hljs-number">27</span></span>EC],ax <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EA<span class="hljs-number"><span class="hljs-number">0</span></span> A3EE27 mov [<span class="hljs-number"><span class="hljs-number">27</span></span>EE],ax <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EA3 <span class="hljs-number"><span class="hljs-number">32</span></span>C<span class="hljs-number"><span class="hljs-number">0</span></span> xor al,al <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EA5 <span class="hljs-number"><span class="hljs-number">3806</span></span>F227 cmp [<span class="hljs-number"><span class="hljs-number">27</span></span>F2],al <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EA9 <span class="hljs-number"><span class="hljs-number">7548</span></span> jne <span class="hljs-number"><span class="hljs-number">0000</span></span>8EF3 ($+<span class="hljs-number"><span class="hljs-number">48</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EAB <span class="hljs-number"><span class="hljs-number">3806</span></span>F327 cmp [<span class="hljs-number"><span class="hljs-number">27</span></span>F3],al <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EAF <span class="hljs-number"><span class="hljs-number">7557</span></span> jne <span class="hljs-number"><span class="hljs-number">0000</span></span>8F08 ($+<span class="hljs-number"><span class="hljs-number">57</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EB1 A02928 mov al,[<span class="hljs-number"><span class="hljs-number">2829</span></span>] <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EB4 0A060C28 <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> al,[<span class="hljs-number"><span class="hljs-number">280</span></span>C] <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EB8 <span class="hljs-number"><span class="hljs-number">7539</span></span> jne <span class="hljs-number"><span class="hljs-number">0000</span></span>8EF3 ($+<span class="hljs-number"><span class="hljs-number">39</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EBA <span class="hljs-number"><span class="hljs-number">813</span></span>EEC270E01 cmp word [<span class="hljs-number"><span class="hljs-number">27</span></span>EC],<span class="hljs-number"><span class="hljs-number">010</span></span>E <span class="hljs-number"><span class="hljs-number">022</span></span><span class="hljs-symbol"><span class="hljs-symbol">E:</span></span><span class="hljs-number"><span class="hljs-number">8</span></span>EC<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span>E3 jc <span class="hljs-number"><span class="hljs-number">0000</span></span>8EA5 ($-<span class="hljs-number"><span class="hljs-number">1</span></span>d)</code> </pre><br><br>  The main menu, I remind you, offers to click either 1 or 2. In the listing there are two transitions.  At this point the game loops between 022E: 8EA5 and 022E: 8EC0.  Everything is obvious.  Set breakpoints for both options: <b>BP 022E: 8EF3</b> and <b>BP 022E: 8F08</b> , ‚Äúrelease‚Äù the game in free mode by pressing F5 and press 2 - the menu item that prompts you to enter password. <br><br>  After some time, the traces arrive at Listing 3. The string "[[[[", drawn together with "ENTER CODE" - can be either the string "_ _ _", which is displayed in this way due to the tricky font, or reserved space code.  Assume that the latter is true and set a breakpoint on memory access based on suspicious 4 byte offsets: BPM 0C11: B16C, BPM 0C11: B16D, BPM 0C11: B16E and BPM 0C11: B16F (the current base of the data segment is visible in the debugger).  We start the game again, press the key in the code entry menu, enter the symbol of the intended code, and the program stops in the listing: <br><br>  listing 6. <br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A57 FF06A4B1 inc word [B1A4] <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A5B FEC3 inc bl <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A5D <span class="hljs-number"><span class="hljs-number">80</span></span>FB04 cmp bl,<span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A60 <span class="hljs-number"><span class="hljs-number">7303</span></span> jnc <span class="hljs-number"><span class="hljs-number">00009</span></span>A65 ($+<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A62 E9B800 jmp <span class="hljs-number"><span class="hljs-number">00009</span></span>B1D ($+b8)</code> </pre><br><blockquote>  DEBUG: Memory breakpoint: 0C11: B16C - 5B -&gt; 38 </blockquote><br><br>  Some variable is incremented, then the register increment occurs and the check, apparently, for an excess of 0004, is logically associated with the need to enter 4 characters.  According to the results of the check, the transition to either ret or some additional sequence of commands occurs.  Including such: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/427/6c3/7d4/4276c37d49c6d6d2c9dd9850a564f5d8.jpg" alt="image"><br><br>  The variable 0C11: B1B5 stores the code ‚Äú4789‚Äù I just entered as a number.  Then follows an interesting site: <br><br>  listing 7. <br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>AAC <span class="hljs-number"><span class="hljs-number">33</span></span>D2 xor dx,dx <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>AAE <span class="hljs-number"><span class="hljs-number">8</span></span>BC2 mov ax,dx <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>AB0 E8A6F8 call <span class="hljs-number"><span class="hljs-number">00009359</span></span> ($-<span class="hljs-number"><span class="hljs-number">75</span></span>a) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>AB3 <span class="hljs-number"><span class="hljs-number">3906</span></span>B5B1 cmp [B1B5],ax <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>AB7 <span class="hljs-number"><span class="hljs-number">7420</span></span> je <span class="hljs-number"><span class="hljs-number">00009</span></span>AD9 ($+<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>AB9 <span class="hljs-number"><span class="hljs-number">42</span></span> inc dx <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>ABA <span class="hljs-number"><span class="hljs-number">83</span></span>FA14 cmp dx,<span class="hljs-number"><span class="hljs-number">0014</span></span> <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>ABD <span class="hljs-number"><span class="hljs-number">76</span></span>EF jbe <span class="hljs-number"><span class="hljs-number">00009</span></span>AAE ($-<span class="hljs-number"><span class="hljs-number">11</span></span>)</code> </pre><br><br>  Reset dx and ax;  subfunction is called, after which the recently cleared register ah is compared with the entered code (in numerical form).  If they are identical, then the transition somewhere far away, otherwise dx is increased by one, and if it does not exceed 14, then the operations are repeated. <br>  It is logical to assume that fourteen correct passwords are enumerated and compared with the entered ones (the first 9 levels are for Beginner difficulty, the rest are for Expert, although there are only 2 exclusive levels for this difficulty: Lock and Minotaur, I don‚Äôt know what other levels differ from. For example, at number 10 is loaded Ice).  All the facts confirm that we are on the right track. <br><br>  Actually ... everything.  There is nowhere to go;  it is enough to change the conditional transition to unconditional.  In principle, it would be nice to also change the number of characters entered, since if you leave it unchanged, you will have to enter the seventh level number as 0007 - after all, it will be more convenient to enter it as 07. To do this, we change Listing 6 to the following: <br><br>  Listing 6_1. <br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A57 FF06A4B1 inc word [B1A4] <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A5B FEC3 inc bl <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A5D <span class="hljs-number"><span class="hljs-number">80</span></span>FB02 cmp bl,<span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A60 <span class="hljs-number"><span class="hljs-number">7303</span></span> jnc <span class="hljs-number"><span class="hljs-number">00009</span></span>A65 ($+<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">022</span></span>E:<span class="hljs-number"><span class="hljs-number">9</span></span>A62 E9B800 jmp <span class="hljs-number"><span class="hljs-number">00009</span></span>B1D ($+b8)</code> </pre><br>  It was already too lazy to look for where and how a line of four dashes is drawn to replace them with two.  Given that Zmiro used the symbol <b>&lt;</b> to draw an exclamation mark from the font resource, and the comma - <b>&gt;</b> , the search for ‚Äúthat, I don‚Äôt know what‚Äù could be very laborious.  Having spent some more time on step-by-step execution in the debugger, it was possible to localize this place, but I am not so perfectionist. <br><a name="results"></a><br><h4>  Findings.  What is done </h4><br>  <a href="">New executable file of the game prel.exe.</a>  <a href="">Do not forget to check for viruses.</a>  <a href="">;)</a> <br>  Abolished the need to collect passwords in levels.  It is possible to select a level from the main menu by entering its two-digit ordinal number instead of four of the password.  As unnecessary, letters of the Latin alphabet (AF) are removed from the mask of the characters entered, only numbers are left possible;  Added check of the range of input level numbers (01-14).  In fact, why should players mistakenly or out of excessive curiosity observe a crash in " <i>Insert disk with levelFF.sqz</i> " instead of loading a level.  The invitation label in the password entry mode from ‚ÄúENTER CODE‚Äù is changed to ‚ÄúSELECT LVL‚Äù.  At the very beginning of the game cut intro Hybrids.  Changed the first intro developer ("Yeaaa ... My game is still working in ..."), - supplemented with information about Hybrids and this modification.  Changed the lines of the names of the difficulties. <br>  Pictures are clickable, especially the last. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/466/fb9/0e0/466fb90e00f5be665b4f19115e4679cf.jpg" alt="image"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dda/d53/fd1/ddad53fd147d91514c53ed2a5de8cb90.jpg" alt="image"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a0d/f39/254/a0df39254fba6538cb7b094b7bd14dfd.jpg" alt="image"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e6b/7c0/9a1/e6b7c09a183a28625508f5587ccb60a4.jpg" alt="image"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/31d/192/776/31d1927768ab278e8caa6d36855b5ee3.jpg" alt="image"></a> </div><p>Source: <a href="https://habr.com/ru/post/220167/">https://habr.com/ru/post/220167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220157/index.html">Mail.Ru Group announces the launch of a vulnerability scanner</a></li>
<li><a href="../220159/index.html">2500 Bunsen burners and sound wave imaging</a></li>
<li><a href="../220161/index.html">We treat problems with dialing a GPON router from MGTS</a></li>
<li><a href="../220163/index.html">Introduction to Marionette.js Behaviors</a></li>
<li><a href="../220165/index.html">Personal experience Web development in Mac OS X</a></li>
<li><a href="../220169/index.html">Integrating the OneNote Services API into mobile apps</a></li>
<li><a href="../220171/index.html">Big code theory - May 28-29 at DevCon 2014 conference</a></li>
<li><a href="../220173/index.html">Blogger Template Designer</a></li>
<li><a href="../220177/index.html">Cyclical and temporary shutdown of event receivers in SharePoint</a></li>
<li><a href="../220179/index.html">PRT Transport Management System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>