<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up email alerts for various system events</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article lists a few simple ways to learn in advance about various problems on the server, without littering your mailbox or setting up complex mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up email alerts for various system events</h1><div class="post__text post__text-html js-mediator-article"> This article lists a few simple ways to learn in advance about various problems on the server, without littering your mailbox or setting up complex monitoring systems.  From the category "if you are too lazy to check and tune something, then set up and check at least that." <br><a name="habracut"></a><br>  Some of the utilities listed below can send email notifications on their own, simple shell wrappers are offered for the rest. <br><br>  As a recipient, an additional local admins mailing is used, which includes the local root and external admin@example.ru.  Why is local root not overridden instead? <br><br>  First, by default, root can receive a lot of newsletters that help __ understand the reason for a problem that has already been discovered.  They are important, but if you send all these letters to the outside, you either need to set up their filtering, or you are more likely to skip letters in their stream, allowing you to __to discover another _ unknown problem. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Secondly, because  admins is not a standard account or group in popular Linux / Unix systems, then " <code>grep -r admins /etc /usr/local/etc</code> allows you to quickly determine which utilities have been configured for. <br><br><h2>  Mail Server Setup </h2><br><br>  Determining the server to use: <br><ol><li>  <code>dpkg-query -S /usr/sbin/sendmail</code> (Debian-based) </li><li>  <code>rpm -qf /usr/sbin/sendmail</code> (RPM-based) </li><li> <code>sudo netstat -ntlp | grep :25</code>  <code>sudo netstat -ntlp | grep :25</code> (all Linux) </li><li> <code>sockstat -4l | grep :25</code>  <code>sockstat -4l | grep :25</code> (FreeBSD) </li></ol><br>  Possible options in Debian and Ubuntu: <a href="http://packages.debian.org/file:/usr/sbin/sendmail">http://packages.debian.org/file:/usr/sbin/sendmail</a> <br><br>  Further, all the paths and command keys are based on Debian, except for the utilities for FreeBSD that are missing from Linux. <br><br><h4>  Exim </h4><br>  / etc / aliases: <br> <code>admins: root, admin@example.ru</code> <br> <br><h4>  Postfix </h4><br><ol><li>  /etc/postfix/main.cf: <code>virtual_alias_maps = hash:/etc/postfix/virtual</code> </li><li>  / etc / postfix / virtual: <code>admins root admin@example.ru</code> </li><li>  cd / etc / postfix &amp;&amp; postmap virtual &amp;&amp; cd / etc &amp;&amp; postalias aliases &amp;&amp; /etc/init.d/postfix restart </li></ol><br>  Full minimum main.cf: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#relayhost = mx.example.ru mynetworks_style = host inet_interfaces = loopback-only #inet_protocols = ipv4 virtual_alias_maps = hash:/etc/postfix/virtual</span></span></code> </pre><br><br><h4>  SSMTP, MSMTP, ESMTP </h4><br>  Formal advantages compared with a full MTA: <br><ol><li>  do not occupy space in ram, </li><li>  easier to set up </li><li>  less vulnerable because  work with the rights of the calling user and do not accept network connections. </li></ol><br>  Actual deficiencies: <br><ol><li>  if at the moment of sending the letter for some reason there is no connection with the external SMTP server, or the SMTP server refused to accept it, the letter will disappear, </li><li>  Recipient addresses are sometimes formed according to such strange rules that the SMTP server is unable to correctly determine to whom and where it should be delivered, </li><li>  see above root @ redirection considerations </li></ol><br>  Thus, the only place where imho makes sense to use them is lightweight virtual containers, for forwarding to an SMTP server running on Host OS. <br><br><h2>  Setting up monitoring services </h2><br><br><h4>  Turn on server </h4><br>  Even some such administrators will learn about such an important event as unplanned reboots by accidentally checking uptime or last.  The following line above ‚Äúexit‚Äù in <b>/etc/rc.local</b> will help you to be immediately informed about the events: <br><pre> <code class="bash hljs">M=<span class="hljs-string"><span class="hljs-string">"Booting complete on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(hostname)</span></span></span><span class="hljs-string">."</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$M</span></span> | mail -s <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$M</span></span></span><span class="hljs-string">"</span></span> admins</code> </pre><br><br><h4>  Linux SoftRAID (mdraid) </h4><br><ol><li>  /etc/mdadm/mdadm.conf: <code>MAILADDR admins</code> </li><li>  /etc/init.d/mdadm restart </li></ol><br><br><h4>  SMART </h4><br><ol><li>  /etc/smartd.conf: <code>DEVICESCAN ... -m admins ...</code> </li><li>  /etc/init.d/smartmontools restart </li></ol><br>  Full minimum smartd.conf: <br> <code>DEVICESCAN -d removable -n standby -m root -M exec /usr/share/smartmontools/smartd-runner</code> <br> <br><h4>  lm_sensors </h4><br><ol><li>  Run from rc.local: <code>/usr/local/sbin/healthd.sh &amp;</code> </li><li>  Healthd.sh code: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh test -z "$(which sensors)" &amp;&amp; { echo "No sensors binary, exit."; exit 1; } while : ; do sensors | grep -q ALARM || { sleep 15; continue; } sensors | grep -q ALARM | logger -s -t "sensors" -p local0.crit sensors | mail -s "Hardware Health Warning" "admins" sleep 600 done</span></span></code> </pre></li></ol><br>  Other options: <br><ol><li>  healthd.sh - <a href="">lm-sensors.org/browser/lm-sensors/trunk/prog/daemon/healthd.sh</a> </li><li>  sensormon - <a href="http://www.lm-sensors.org/attachment/ticket/2133/sensormon">www.lm-sensors.org/attachment/ticket/2133/sensormon</a> </li><li>  lm-monitor - <a href="http://sourceforge.net/projects/lm-monitor/">sourceforge.net/projects/lm-monitor</a> </li></ol><br><br><h4>  Adaptec RAID </h4><br><ul><li>  Uses <b>arcconf</b> utility ( <a href="http://hwraid.le-vert.net/wiki/DebianPackages">repository with package for Debian</a> , <a href="http://www.freshports.org/sysutils/arcconf/">port for FreeBSD</a> ) </li><li>  Source text: <a href="http://sources.homelink.ru/hardmon/aacraid-check.txt">/ usr / local / sbin / aacraid-check</a> (make sure that $ PROG inside contains the correct path to <b>arcconf</b> ) </li><li>  Daily Linux Call via /etc/cron.daily/aacraid-check: <br><pre> <code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/sbin/aacraid-check | mail -e -s <span class="hljs-string"><span class="hljs-string">"Adaptec RAID Alert on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(hostname)</span></span></span><span class="hljs-string">"</span></span> admins</code> </pre> </li><li>  Daily call under FreeBSD via / usr / local / etc / periodic / daily / aacraid-check: <br><pre> <code class="bash hljs">/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/sbin/aacraid-check | mail -E -s <span class="hljs-string"><span class="hljs-string">"Adaptec RAID Alert on </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(hostname)</span></span></span><span class="hljs-string">"</span></span> admins</code> </pre> </li></ul><br>  Other options: <br><ol><li>  quad3datwork - <a href="http://www.sysadmintalk.net/forums/thread-1062.html">www.sysadmintalk.net/forums/thread-1062.html</a> </li><li>  aacraid-status - <a href="http://hwraid.le-vert.net/wiki/Adaptec">hwraid.le-vert.net/wiki/Adaptec#a3.3.aacraid-status</a> </li></ol><br><br><h4>  Intel MatrixRAID under FreeBSD </h4><br><ol><li>  Run: / usr / local / etc / periodic / daily / raidcheck </li><li>  Code: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cd /dev for n in ar?; do test "$n" = 'ar?' &amp;&amp; exit # ..no ATA RAID #echo "Check $n..." atacontrol status $n | egrep -qv '(READY|ONLINE|subdisks:)' || continue atacontrol status $n | mail -s 'ATA RAID Warning' admins atacontrol status $n | logger -p local4.crit -t RAIDCheck -s done</span></span></code> </pre></li></ol><br><br><h4>  Openvz </h4><br>  Daily check of quota overflow in containers - <a href="http://sources.homelink.ru/openvz/">sources.homelink.ru/openvz</a> <br><br><br><h4>  PS </h4><br>  90% of the note is a copy-paste from the local wiki.  If someone comes in handy - well.  Not useful - nothing terrible ;-)) </div><p>Source: <a href="https://habr.com/ru/post/147698/">https://habr.com/ru/post/147698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147693/index.html">Convenience or paranoia is more important? The history of one application</a></li>
<li><a href="../147694/index.html">Rovio has released a new game Amazing Alex for iOS and Android</a></li>
<li><a href="../147695/index.html">trrtrr.net: Open IP Telephony Seminars</a></li>
<li><a href="../147696/index.html">"Dialogue 2012": competition in analyzing the tonality of texts and the competition of syntactic analyzers</a></li>
<li><a href="../147697/index.html">Windows Store Economics and Developer Opportunities</a></li>
<li><a href="../147699/index.html">Single page wordpress plugin</a></li>
<li><a href="../147701/index.html">Next-generation Xbox can probably be upgraded</a></li>
<li><a href="../147704/index.html">Aftershock: how we will live after the notorious bill. Tips experienced</a></li>
<li><a href="../147705/index.html">On Google+, you can now combine normal and work profiles.</a></li>
<li><a href="../147706/index.html">Digg site bought for $ 500 thousand</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>