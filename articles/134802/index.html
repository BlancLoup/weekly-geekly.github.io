<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with models and delegates on the example of creating a list for FireFox</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More than once, comparisons of the complexity of constructing interfaces on Qt skipped over. In this article I will give an example of how you can mak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with models and delegates on the example of creating a list for FireFox</h1><div class="post__text post__text-html js-mediator-article">  More than once, comparisons of the complexity of constructing interfaces on Qt skipped over.  In this article I will give an example of how you can make a list in the style of the list of FireFox modules. <br><br><img src="https://habrastorage.org/storage1/e561a83d/8d979c09/c62ce877/5913c73d.jpg"><br><br>  To do this, we use the MVC approach, <a href="http://developer.qt.nokia.com/doc/qt-4.8/model-view-programming.htm">which is implemented in Qt</a> .  At the output, we get something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage1/89a7d99b/eb1a8e3e/3c311797/01ff9a0c.png"><br>  The whole process is divided into 3 parts: <ol><li>  model creation </li><li>  delegate creation </li><li>  creating a view </li></ol><br><br><a name="habracut"></a><br><br><h4>  Creating a model </h4><br>  The general principles of working with models in Qt can be found in the documentation, everything is described in great detail. <br>  So let's get started.  First we decide on the base model.  Since the list may contain sections, we need a simple tree model.  In the basic configuration this is not available, so we implement it ourselves. <br>  To do this, we inherit from <i>QAbstractItemModel</i> and implement all abstract methods (this is the required minimum that is needed to build a model). <br><br><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">columnCount</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; parent = QModelIndex() )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QVariant </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> role = Qt::DisplayRole )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QModelIndex </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> row, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> column, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; parent = QModelIndex() )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QModelIndex </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parent</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; index )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rowCount</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; parent = QModelIndex() )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; Qt::<span class="hljs-function"><span class="hljs-function">ItemFlags </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flags</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; index )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>;</code> </pre> <br><br>  Also, to change the model, override and method: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp; index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QVariant &amp; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> role = Qt::EditRole </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br><br>  <i>I will not paint the model in detail, the full implementation can be viewed in the attached source code.</i> <br><br><h4>  Creating a delegate </h4><br>  The most interesting and important part is here, because  This class is responsible for how our data will look and interact with the user. <br><blockquote>  <i>For this implementation, I was pushed by the way the work with CheckBox was implemented by the QItemDelegate delegate.</i>  <i>Therefore, in addition to reading the documentation, it is also useful to look into the source code, there are many useful solutions there.</i> </blockquote><br>  And so, the work of the delegate will consist in displaying an element on the view and in processing clicks on it (we want all sorts of buttons, like Firefox, etc.). <br><h5>  Drawing </h5><br>  The entry point for this is in the paint method: <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> QvObjectDelegate::paint( QPainter * painter, const QStyleOptionViewItem &amp; <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>, const QModelIndex &amp; <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> ) const { painter-&gt;save(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.parent().isValid()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(needRestart(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>)) { drawItemBackground(painter, <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>); paintObjectHeader(painter, <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>); } paintObject(painter, <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { paintHeader(painter, <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>); } painter-&gt;restore(); painter-&gt;save(); painter-&gt;setPen(QColor(<span class="hljs-number"><span class="hljs-number">0xD7</span></span>, <span class="hljs-number"><span class="hljs-number">0xD7</span></span>, <span class="hljs-number"><span class="hljs-number">0xD7</span></span>)); painter-&gt;drawLine(<span class="hljs-keyword"><span class="hljs-keyword">option</span></span>.rect.bottomLeft(), <span class="hljs-keyword"><span class="hljs-keyword">option</span></span>.rect.bottomRight()); painter-&gt;restore(); }</code> </pre><br>  Depending on whether the displayed element is a header or not, we call the appropriate methods.  If everything is stacked in one, then you get a terrible unreadable footcloth, and the smaller / simpler the methods, the easier it is to navigate them. <br><br><h6>  Section title drawing </h6><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">void</span></span> <span class="hljs-type"><span class="hljs-type">QvObjectDelegate</span></span>::paintHeader( <span class="hljs-type"><span class="hljs-type">QPainter</span></span> * painter, const <span class="hljs-type"><span class="hljs-type">QStyleOptionViewItem</span></span> &amp; option, const <span class="hljs-type"><span class="hljs-type">QModelIndex</span></span> &amp; index ) const { <span class="hljs-type"><span class="hljs-type">QPainter</span></span> &amp;p = *painter; p.save(); p.setClipRect(option.rect); p.setPen(<span class="hljs-type"><span class="hljs-type">QColor</span></span>(<span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span>)); //   <span class="hljs-type"><span class="hljs-type">QRect</span></span> tr; <span class="hljs-type"><span class="hljs-type">QString</span></span> name = index.<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DisplayRole</span></span></span><span class="hljs-class">).toString(), desc = index.</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvObjectModel</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DetailRole</span></span></span><span class="hljs-class">).toString(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFont</span></span></span><span class="hljs-class"> f = option.font; f.setPointSize(12); f.setWeight(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFont</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Bold</span></span></span><span class="hljs-class">); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFontMetrics</span></span></span><span class="hljs-class"> fm(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">); tr = fm.boundingRect(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">); p.setFont(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">); p.drawText(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AlignVCenter</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AlignLeft</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">); f = option.font; f.setWeight(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFont</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DemiBold</span></span></span><span class="hljs-class">); p.setFont(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">); p.drawText(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AlignVCenter</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AlignRight</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">desc</span></span></span><span class="hljs-class">); p.restore(); }</span></span></code> </pre><br>  It's all very simple.  We receive the text preparation, we deduce it with alignment on height and the left edge.  Description, containing the number of elements and other information is aligned to the right. <br><br><h6>  Body element drawing </h6><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">void</span></span> <span class="hljs-type"><span class="hljs-type">QvObjectDelegate</span></span>::paintObject(<span class="hljs-type"><span class="hljs-type">QPainter</span></span> * painter, const <span class="hljs-type"><span class="hljs-type">QStyleOptionViewItem</span></span> &amp; option, const <span class="hljs-type"><span class="hljs-type">QModelIndex</span></span> &amp; index ) const { <span class="hljs-type"><span class="hljs-type">QRect</span></span> tr; <span class="hljs-type"><span class="hljs-type">QString</span></span> name = index.<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DisplayRole</span></span></span><span class="hljs-class">).toString(), description = index.</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvObjectModel</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DescriptionRole</span></span></span><span class="hljs-class">).toString(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QPainter</span></span></span><span class="hljs-class"> &amp;p = *painter; p.setClipRect(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">); p.setPen(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QColor</span></span></span><span class="hljs-class">(210, 210, 210)); p.setBrush(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QColor</span></span></span><span class="hljs-class">(240, 240, 240)); p.setPen(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QColor</span></span></span><span class="hljs-class">(77, 77, 77)); p.translate(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">topLeft</span></span></span><span class="hljs-class">()); p.translate(0, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sizeHint</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">).height() - </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ITEM_HEIGHT</span></span></span><span class="hljs-class">); p.translate(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OFFSET_H</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OFFSET_H</span></span></span><span class="hljs-class">); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QImage</span></span></span><span class="hljs-class"> img = index.</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DecorationRole</span></span></span><span class="hljs-class">).value&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QImage</span></span></span><span class="hljs-class">&gt;(); if(!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">isNull</span></span></span><span class="hljs-class">()) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drawImage</span></span></span><span class="hljs-class">(0,0, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class">); } else { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drawImage</span></span></span><span class="hljs-class">(0,0, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">defaultIcon_</span></span></span><span class="hljs-class">); } p.translate(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ICON_SIZE</span></span></span><span class="hljs-class"> + </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OFFSET_H</span></span></span><span class="hljs-class">, 0); //     10px //   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFont</span></span></span><span class="hljs-class"> f = option.font; f.setPointSize(10); f.setWeight(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFont</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Bold</span></span></span><span class="hljs-class">); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFontMetrics</span></span></span><span class="hljs-class"> fm(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">); tr = fm.boundingRect(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">); p.setFont(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">); p.drawText(0, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tr</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">()-5, name); //   p.setFont(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">font</span></span></span><span class="hljs-class">); fm = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QFontMetrics</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">font</span></span></span><span class="hljs-class">); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QDate</span></span></span><span class="hljs-class"> date_ = index.</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvObjectModel</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateRole</span></span></span><span class="hljs-class">).toDate(); int version_ = index.</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvObjectModel</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VersionRole</span></span></span><span class="hljs-class">).toInt(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QString</span></span></span><span class="hljs-class"> versionStr_; if(!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date_</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">isNull</span></span></span><span class="hljs-class">()) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">versionStr_</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date_</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toString</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dd</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MMMM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yyyy</span></span></span><span class="hljs-class">"); } else if(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">version_</span></span></span><span class="hljs-class"> &gt; 1000000000){ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> = 0; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">version_</span></span></span><span class="hljs-class"> / 1000000000; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">version_</span></span></span><span class="hljs-class"> % 1000000000; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">major</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> / 10000000; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> % 10000000; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">minor</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> / 100000; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class"> % 100000; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">versionStr_</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QCoreApplication</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">translate</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">", "%1.%2.%3.%4", "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Version</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">") .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arg</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arg</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">major</span></span></span><span class="hljs-class">, 2, 10, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QLatin1Char</span></span></span><span class="hljs-class">('0') ) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arg</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">minor</span></span></span><span class="hljs-class">, 2, 10, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QLatin1Char</span></span></span><span class="hljs-class">('0')).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arg</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ver_min</span></span></span><span class="hljs-class">); } if(!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">versionStr_</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">isEmpty</span></span></span><span class="hljs-class">()) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tr</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fm</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">boundingRect</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">versionStr_</span></span></span><span class="hljs-class">); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tr</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">moveTo</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class">() - </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ICON_SIZE</span></span></span><span class="hljs-class"> - 2*</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OFFSET_H</span></span></span><span class="hljs-class"> - </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tr</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class">() - </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OFFSET_BUTTON</span></span></span><span class="hljs-class">, 0 ); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">painter</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drawText</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tr</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TextSingleLine</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">versionStr_</span></span></span><span class="hljs-class">); } int maxWidth(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rect</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class">() - widthButtonGroup(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">) - </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ICON_SIZE</span></span></span><span class="hljs-class"> - </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OFFSET_H</span></span></span><span class="hljs-class"> - </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DETAIL_OFFSET</span></span></span><span class="hljs-class"> ); if(!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvObjectModel</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DetailRole</span></span></span><span class="hljs-class">).toString().isEmpty()) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">maxWidth</span></span></span><span class="hljs-class"> -= </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fm</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">boundingRect</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QCoreApplication</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">translate</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">", "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Detail</span></span></span><span class="hljs-class">")).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class">(); } description = fm.elidedText(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">description</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ElideRight</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">maxWidth</span></span></span><span class="hljs-class">); p.translate(0, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ICON_SIZE</span></span></span><span class="hljs-class"> / 2); tr = fm.boundingRect(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">description</span></span></span><span class="hljs-class">); p.drawText(0, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tr</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">(), description); if(!</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvObjectModel</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DetailRole</span></span></span><span class="hljs-class">).toString().isEmpty()) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paintDetail</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">painter</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">); } if(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">flags</span></span></span><span class="hljs-class">().testFlag(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Qt</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ItemFlag</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QvAbstractListItem</span></span></span><span class="hljs-class">::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Downloading</span></span></span><span class="hljs-class">))) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paintObjectProgress</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">painter</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">); } paintObjectBtn(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">painter</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">); }</span></span></code> </pre><br>  To begin with, we will limit the drawing area and set clipping in order not to climb on the neighbors by chance. <br>  The second step is to shift the point relative to which we will display the contents: <br><pre> <code class="cpp hljs"> p.translate(option.rect.topLeft()); p.translate(<span class="hljs-number"><span class="hljs-number">0</span></span>, sizeHint(option, index).height() - ITEM_HEIGHT); p.translate(OFFSET_H, OFFSET_H);</code> </pre><br>  The second line is necessary to take into account the height of the information message, it will be lower.  Next, display the icon, title, description and version.  When displaying the schedule, we also take into account the fact that the text should not climb under the buttons and other elements.  Therefore, we calculate the maximum allowable width and trim it to make it look more pleasant. <br><br><h6>  Drawing buttons and loading bars </h6><br>  Since we want the controls to look the same as on the system, for drawing we will use the style set in the application and the primitives provided. <br>  Let's start with the download indicator: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QvObjectDelegate::paintObjectProgress( QPainter * painter, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStyleOptionViewItem &amp; option, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QModelIndex &amp; index ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { QStyleOptionProgressBarV2 opt; initStyleProgressOption(&amp;opt, index); QStyle *style = QApplication::style(); opt.rect.setLeft(option.rect.width() - (CHECK_WIDTH + OFFSET_H) * <span class="hljs-number"><span class="hljs-number">2</span></span> - ICON_SIZE - OFFSET_BUTTON - buttonRect.width() - OFFSET_BUTTON ); opt.rect.setTop( <span class="hljs-number"><span class="hljs-number">4</span></span> ); opt.rect.setWidth(CHECK_WIDTH * <span class="hljs-number"><span class="hljs-number">2</span></span>); opt.rect.setHeight(PROGRESS_HEIGHT); painter-&gt;setPen(QColor(<span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span>)); style-&gt;drawControl(QStyle::CE_ProgressBar, &amp;opt, painter); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QvObjectDelegate::initStyleProgressOption( QStyleOptionProgressBar *option, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QModelIndex &amp; index ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = index.data(QvObjectModel::ProgressRole).toInt(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!option) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; option-&gt;rect = QRect(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>); option-&gt;state |= QStyle::State_Active; option-&gt;state |= QStyle::State_Enabled; option-&gt;state |= QStyle::State_Horizontal; option-&gt;minimum = <span class="hljs-number"><span class="hljs-number">0</span></span>; option-&gt;maximum = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-comment"><span class="hljs-comment">//maximum?maximum:100; option-&gt;progress = value; option-&gt;textAlignment = Qt::AlignCenter; option-&gt;textVisible = true; option-&gt;text = QString("%1%").arg(value); if (QStyleOptionProgressBarV2 *optionV2 = qstyleoption_cast&lt;QStyleOptionProgressBarV2 *&gt;(option)) { optionV2-&gt;orientation = Qt::Horizontal ; // ### Qt 5: use State_Horizontal instead optionV2-&gt;invertedAppearance = false; optionV2-&gt;bottomToTop = true; } }</span></span></code> </pre><br>  The basis of this fragment was again taken from the sources, namely QProgressBar.  For output, fill in the non-required values ‚Äã‚Äãin the QStyleOptionProgressBarV2 structure (see the documentation for the full description).  Set the initial, maximum and current values, as well as the text of the label that will be displayed on top of the indicator.  After that, all this is sent to the processing style: <br><pre> <code class="cpp hljs"> style-&gt;drawControl(QStyle::CE_ProgressBar, &amp;opt, painter);</code> </pre><br>  After the indicator, proceed to the buttons. <br>  Each element of the list may be in a different state, depending on which it may provide different valid operations.  To begin with we will make the list of those actions which we can perform: <br><pre> <code class="cpp hljs"> QVector&lt;QvObjectDelegate::ButtonAction&gt; QvObjectDelegate::getButtons( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QModelIndex &amp;index ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { QVector&lt;ButtonAction&gt; tags_; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(needRestart(index) ) { tags_ &lt;&lt; baRestart &lt;&lt; baCancel; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( index.flags() &amp; Qt::ItemFlag(QvAbstractListItem::Downloading) ) { tags_ &lt;&lt; baCancel; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> installed = index.data(QvObjectModel::InstalledRole).toBool(), enabled = index.data(QvObjectModel::EnabledRole).toBool(), buildin = index.data(QvObjectModel::BuildInRole).toBool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (installed &amp;&amp; (index.flags() &amp; Qt::ItemFlag(QvAbstractListItem::hasUpdate))) { tags_ &lt;&lt; baUpdate;} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (installed &amp;&amp; index.flags() &amp; Qt::ItemFlag(QvAbstractListItem::canBeToggled)) { tags_ &lt;&lt; (enabled ? baDisable : baEnable);} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (installed &amp;&amp; !buildin) { tags_ &lt;&lt; baRemove;} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!installed) { tags_ &lt;&lt; baInstall; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tags_; }</code> </pre><br>  Fill in the QStyleOptionButton structure and for each element from the actions list, we will draw the button: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QvObjectDelegate::drawButton( QStyleOptionButton &amp;o, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QPoint &amp;p, QPainter * painter ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(o.rect.contains(p)) o.state |= QStyle::State_Sunken; QStyle * style = QApplication::style(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(style) style-&gt;drawControl(QStyle::CE_PushButton, &amp;o, painter ); o.state &amp;= ~QStyle::State_Sunken; o.rect.translate(buttonRect.width() + OFFSET_BUTTON, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre><br>  And at the end, if necessary, we will display an informational message. <br><br><img src="http://habrastorage.org/storage1/050f4dab/495501ac/65830c76/8fef16c9.png"><br><br><img src="http://habrastorage.org/storage1/c58a0fc9/6c40e2b1/be5c97b0/7248c981.png"><br><br>  This conclusion is made, but the sense of it, if not taught our drawn buttons to press.  Therefore, we move on to the next part, handling mouse clicks. <br><br><h5>  Click processing </h5><br>  All events about clicking on the elements of our view come to the method: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editorEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( QEvent *event, QAbstractItemModel *model, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QStyleOptionViewItem &amp;option, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QModelIndex &amp;index )</span></span></span></span>;</code> </pre><br>  We will redefine it: <br><pre> <code class="cpp hljs"> Q_ASSERT(event); Q_ASSERT(model); <span class="hljs-comment"><span class="hljs-comment">// make sure that we have the right event type if ((event-&gt;type() == QEvent::MouseButtonRelease) || (event-&gt;type() == QEvent::MouseMove) || (event-&gt;type() == QEvent::MouseButtonPress)) { return validateLabel(index, option, event) || validateButton(index, option, event); } else if (event-&gt;type() == QEvent::KeyPress) { if (static_cast&lt;QKeyEvent*&gt;(event)-&gt;key() != Qt::Key_Space &amp;&amp; static_cast&lt;QKeyEvent*&gt;(event)-&gt;key() != Qt::Key_Select) return false; } else { return false; } return false;</span></span></code> </pre><br><br>  Our buttons should respond to pressing, releasing and pointing the cursor on them. <br>  When checking the button press, we again get the list of available operations, since the order in the output is the same as what was received at this moment, then it is easy to establish a correspondence by running through the array and determining which button hit the square of the button.  After emit the corresponding signal with the index of the element on which it was pressed.  We do the same for the <i>Detail</i> link. <br><br><h4>  Creating a view </h4><br>  To view our tree structure, we use QTreeView.  So as we do not need indents, set the appropriate parameters in the constructor.  Basic operations will occur when the model is installed, where we establish connections between the delegate signals and model slots. <br><br>  As a result, having built a model, a delegate, and setting up all the links, we‚Äôll get a list of items for Firefox. <br><br>  In the link below you can download the source code of the demonstration project, which shows the work list and the various state of the elements.  Since I use it in my project to display a list of available updates and modules, I also included in the example the ability to download files from the network ( <b>in the example, the FreeBSD 8.2 image is downloaded</b> ). <br><br>  Constructive criticism and comments are welcome. <br>  Sources: <a href="">ajieks.ru/download/file_list.zip</a> <br><br>  <b>DISCLAIMER</b> <br>  The given example does not claim to be a finished component, is presented for informational purposes and requires adaptation to be used.  Taken from the working draft, where it fully performs the tasks assigned to it. </div><p>Source: <a href="https://habr.com/ru/post/134802/">https://habr.com/ru/post/134802/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134794/index.html">Let it snow!</a></li>
<li><a href="../134797/index.html">IPv6 gateway for LAN</a></li>
<li><a href="../134798/index.html">Iterative approach to solving engineering problems</a></li>
<li><a href="../134800/index.html">Subtle - tiling window manager in ruby</a></li>
<li><a href="../134801/index.html">100 000 000 000 rubles will be required for each winner of the competition.</a></li>
<li><a href="../134804/index.html">Free SMS. To each!</a></li>
<li><a href="../134805/index.html">GLONASS supports all mobile devices on Snapdragon S2 and Snapdragon S3 platforms.</a></li>
<li><a href="../134807/index.html">Meridian - Metro style music player for Vkontakte</a></li>
<li><a href="../134808/index.html">KLM Royal Dutch Airlines allows you to choose your neighbor on Facebook</a></li>
<li><a href="../134809/index.html">Amazon sells a million Kindle every week.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>