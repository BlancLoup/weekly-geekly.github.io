<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tyunim keyboard correctly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, friends, I want to immediately speak: this article by my friend, who wanted to publish it, but by mistake sent it to the sandbox that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tyunim keyboard correctly</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/0c9/d46/7e3/0c9d467e3eaf9ec3d397c5119a27f13f.jpg"><br>  <i>Good afternoon, friends, I want to immediately speak: this article by my friend, who wanted to publish it, but by mistake sent it to the sandbox that was not completed, and could no longer lay out the normal version, asked me to do it.</i>  <i>For me personally, the article is very useful, so all this work is exclusively <a href="https://habrahabr.ru/users/blide/" class="user_link">blide</a> !</i> <br><br>  While playing Team Fortess 2 while listening to music, I was very indignant because of the impossibility of adjusting the volume of the Clementine player separately from the overall volume.  But I don‚Äôt have extra keys on the keyboard, they are all used. <br><br>  A nontrivial task should have a nontrivial solution, so I decided to emulate keystrokes through my android device using http.  Ignorance of Java and Python didn‚Äôt prevent anything, it‚Äôs not for nothing that I have an ext3 partition on my hard drive. <br><a name="habracut"></a><br>  First you needed to know the list of supported and free keys.  In Ubuntu, you can use the xmodmap utility and the /usr/library/X11/*keysum.h files for me: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> XF86XK_Launch0 0x1008FF40 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Launch Application */</span></span></span><span class="hljs-meta"> ‚Ä¶ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> XF86XK_LaunchF 0x1008FF4F </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Launch Application */</span></span></span></span></code> </pre> <br>  We need these key codes (I chose only 2);  for example, you can find out the key code with the designation "XF86XK_Launch1" using the command "xmodmap -pk | preg 'Launch1' <br>  "We will get the code" 156 "(I have chosen 156 and 157). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Server </h5><br>  Using the best possible logic, I realized that I would write a tcp server in Python 3 that I did not know using the http module.  This stage did not cause any difficulties, because the module has a fairly good and clear basis for writing a tcp server, namely the classes ‚ÄúBaseHTTPRequestHandler‚Äù and ‚ÄúSimpleHTTPRequestHandler‚Äù.  To emulate keystrokes, ‚Äúpyatspi.registry‚Äù was used, well, there‚Äôs actually nothing to comment on. <br><br>  In the process of debugging, it seemed to me that it would be very useful to know the response time, but then something interesting happened;  In the emulator, this feature worked as it should, but the response time obtained when working with a physical device made me rethink ideas about the structure of the world.  Gradually, I began to feel that I was a programming guru and a master of time.  Otherwise, how would I manage to reduce the response time to negative values?  I am ready to listen to your theory on this precedent. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyatspi, time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> http.server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socketserver <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpKeyboard</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(http.server.BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> server_version = <span class="hljs-string"><span class="hljs-string">"SimpleHTTP/0.1"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Serve a GET request."""</span></span> reg = pyatspi.Registry.generateKeyboardEvent path = self.path.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(path) == <span class="hljs-number"><span class="hljs-number">3</span></span>: ms = int(round(time.time() * <span class="hljs-number"><span class="hljs-number">1000</span></span>)) - int(path[<span class="hljs-number"><span class="hljs-number">2</span></span>]) reg(int(path[<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, pyatspi.KEY_PRESSRELEASE) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"key %s - %s ms"</span></span> % (path[<span class="hljs-number"><span class="hljs-number">1</span></span>], ms)) f = self.send_head() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_head</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/html; charset=utf-8"</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">"Content-Length"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.end_headers() httpd = socketserver.TCPServer((<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-number"><span class="hljs-number">8000</span></span>), HttpKeyboard) print(<span class="hljs-string"><span class="hljs-string">"serving at port"</span></span>, <span class="hljs-number"><span class="hljs-number">8000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: httpd.serve_forever()</code> </pre><br>  There is an example of a request handler in this library ‚Äî the <a href="http/server.py">SimpleHTTPRequestHandler</a> class, which can help a <a href="http/server.py">lot</a> when working with it. <br><br>  By the way, if you run the script in the console, then after processing the requests it will output: <br> <code>key 156 - 527 ms <br> //    (   ) <br></code> <br> <code>192.168.0.101 - - [07/Jan/2013 19:57:09] "GET /156/1357574229198 HTTP/1.1" 200</code> <br>  In this case: <br>  156 - key code <br>  1357574229198 - time to press a button on the dual extra keyboard <br><br>  I decided to add http-headers so that the result of the request could be processed on the device with ready-made tools. <br><br><h5>  Android application </h5><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/756/c09/008/756c09008c4d2f936adc46aac3e89d97.png"></div><br>  For asynchronous requests, I chose the Android Asynchronous Http Client.  The devices are in the same wifi-grid, so the internal ip was used, nothing more interesting at this stage I found except the hostile System.currentTimeMillis ().  I will throw off the complete sorts at the end, and here I will leave the function of the request itself. <br><div class="spoiler">  <b class="spoiler_title">Java</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KeyHttp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String key)</span></span></span><span class="hljs-function"> </span></span>{ AsyncHttpClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncHttpClient(); EditText edit = (EditText) findViewById(R.id.editText1); client.get(<span class="hljs-string"><span class="hljs-string">"http://"</span></span>+edit.getText()+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+key+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+System.currentTimeMillis(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncHttpResponseHandler() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String response)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.log(<span class="hljs-string"><span class="hljs-string">"success result"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.log(<span class="hljs-string"><span class="hljs-string">"starting"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable error)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.log(<span class="hljs-string"><span class="hljs-string">"failure result"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text)</span></span></span><span class="hljs-function"> </span></span>{ TextView view = (TextView) findViewById(R.id.textView1); view.setText(text); } }); }</code> </pre></div></div><br><h5>  Total </h5><br>  Run the server and install the application on the device. <br>  Well, now everything is ready for a comfortable increase in playing time on a linux-machine in Team Fortress 2 under the rebellious rhythms of The Offspring. <br><br>  Keys can be used any and in any quantity.  I often see with friends TV and PCs connected via hdmi, but being in different rooms, such an IT-life-hack, I think, they would have liked.  In fact, the scope of this tool is quite wide: from home media centers to non-home media centers. <br>  Thank you for your interest in the material. <br><br><h5>  References: </h5><br>  Android Asynchronous Http Client ( <a href="http/">http://loopj.com/android-async-http/</a> ) <br>  http.server ( <a href="http.server.html">http://docs.python.org/3.2/library/http.server.html</a> ) <br>  We write our first application on Android ( <a href="http://habrahabr.ru/post/109944/">http://habrahabr.ru/post/109944/</a> ) <br>  man xmodmap <br>  <sup>* I did not use the blue electrical tape specially, I would like to use the phone separately from the keyboard</sup> </div><p>Source: <a href="https://habr.com/ru/post/165639/">https://habr.com/ru/post/165639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165627/index.html">Speed ‚Äã‚Äãup Ruby on Rails launch using the RVM railsexpress patch set</a></li>
<li><a href="../165629/index.html">OOP-builder "massive" parameters</a></li>
<li><a href="../165631/index.html">AI, Pathfind, Pathfollow for characters in the three-dimensional dynamic world (Part 1)</a></li>
<li><a href="../165635/index.html">Why the new album of Bob Dylan came out with a circulation of 100 copies</a></li>
<li><a href="../165637/index.html">MIT has developed a synthetic "muscle" that works on water</a></li>
<li><a href="../165641/index.html">Programming on Android for a web developer or a quick start for the little ones. Part 3</a></li>
<li><a href="../165643/index.html">What's inside the cable station headend</a></li>
<li><a href="../165645/index.html">Progressive JPEG: new best practice</a></li>
<li><a href="../165647/index.html">Sharing service of screenshots and code</a></li>
<li><a href="../165649/index.html">Javascript: from beginning to end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>