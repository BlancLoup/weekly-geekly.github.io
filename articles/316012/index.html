<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a simple screenshot capture program.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are many different programs for capturing images from the screen, editing them "right on the screen" and uploading to various services. It's all...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a simple screenshot capture program.</h1><div class="post__text post__text-html js-mediator-article">  There are many different programs for capturing images from the screen, editing them "right on the screen" and uploading to various services.  It's all good, but most programs are tied to certain services and do not give the ability to download somewhere else.  In my head the thought has long been spinning to create my own simple service for downloading images to fit your needs.  And I want to share the history of the development of this program. <br><br>  Without hesitation and having at hand Visual Studio 2015, of course, created a new C # project since  it is very convenient and I have already done earlier small C # programs. <br><a name="habracut"></a><br><h3>  First task </h3><br>  Global interception of pressing the buttons PrintScreen and Alt + PrintScreen.  In order not to reinvent the wheel, a couple of minutes of googling and almost immediately a <a href="https://social.msdn.microsoft.com/Forums/en-US/94b1598f-79ce-4c70-8851-86aff6d9b12f/capturing-the-print-screen-key%3Fforum%3DVsexpressvcs">solution was found</a> .  The bottom line is to use the LowLevelKeyboardProc callback function and the SetWindowsHookEx function with WH_KEYBOARD_LL from user32.dll.  With a small modification for intercepting two combinations, the code earned and successfully captures keystrokes. <br><br><div class="spoiler">  <b class="spoiler_title">Keystroke Capture Code</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ScreenShot_Grab</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MainForm WinForm; <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">     . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> [STAThread] static void Main() { Application.EnableVisualStyles(); Application.SetCompatibleTextRenderingDefault(false); _hookID = SetHook(_proc); Application.Run(new MainForm()); UnhookWindowsHookEx(_hookID); } private const int WH_KEYBOARD_LL = 13; //private const int WH_KEYBOARD_LL = 13; private const int VK_F1 = 0x70; private static LowLevelKeyboardProc _proc = HookCallback; private static IntPtr _hookID = IntPtr.Zero; private static IntPtr SetHook(LowLevelKeyboardProc proc) { using (Process curProcess = Process.GetCurrentProcess()) using (ProcessModule curModule = curProcess.MainModule) { return SetWindowsHookEx(WH_KEYBOARD_LL, proc, GetModuleHandle(curModule.ModuleName), 0); } } private delegate IntPtr LowLevelKeyboardProc(int nCode, IntPtr wParam, IntPtr lParam); private static IntPtr HookCallback(int nCode, IntPtr wParam, IntPtr lParam) { if (nCode &gt;= 0) { Keys number = (Keys)Marshal.ReadInt32(lParam); //MessageBox.Show(number.ToString()); if (number == Keys.PrintScreen) { if (wParam == (IntPtr)261 &amp;&amp; Keys.Alt == Control.ModifierKeys &amp;&amp; number == Keys.PrintScreen) { // Alt+PrintScreen } else if (wParam == (IntPtr)257 &amp;&amp; number == Keys.PrintScreen) { // PrintScreen } } } return CallNextHookEx(IntPtr.Zero, nCode, wParam, lParam); } [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)] private static extern IntPtr SetWindowsHookEx(int idHook, LowLevelKeyboardProc lpfn, IntPtr hMod, uint dwThreadId); [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)] [return: MarshalAs(UnmanagedType.Bool)] private static extern bool UnhookWindowsHookEx(IntPtr hhk); [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)] private static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode, IntPtr wParam, IntPtr lParam); [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)] private static extern IntPtr GetModuleHandle(string lpModuleName); } }</span></span></code> </pre> <br></div></div><br><h3>  Task Two </h3><br>  Actually capture the screenshot when you press the keys.  Again google and the <a href="http://stackoverflow.com/a/9087955">solution is found</a> .  In this case, the GetForegroundWindow and GetWindowRect functions are all from the same user32.dll, as well as the regular .NET Graphics.CopyFromScreen function.  A couple of checks and the code works, but with one problem - it also captures the borders of the window.  To address this issue will come back later. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Screenshot capture code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ScreenCapturer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CaptureMode { Screen, Window } [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetForegroundWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWindowRect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hWnd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Rect rect</span></span></span><span class="hljs-function">)</span></span>; [StructLayout(LayoutKind.Sequential)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Rect { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Left; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Top; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Right; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Bottom; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Capture</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CaptureMode screenCaptureMode = CaptureMode.Window</span></span></span><span class="hljs-function">)</span></span> { Rectangle bounds; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (screenCaptureMode == CaptureMode.Screen) { bounds = Screen.GetBounds(Point.Empty); CursorPosition = Cursor.Position; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handle = GetForegroundWindow(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(); GetWindowRect(handle, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> rect); bounds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(rect.Left, rect.Top, rect.Right, rect.Bottom); <span class="hljs-comment"><span class="hljs-comment">//CursorPosition = new Point(Cursor.Position.X - rect.Left, Cursor.Position.Y - rect.Top); } var result = new Bitmap(bounds.Width, bounds.Height); using (var g = Graphics.FromImage(result)) { g.CopyFromScreen(new Point(bounds.Left, bounds.Top), Point.Empty, bounds.Size); } return result; } public Point CursorPosition { get; protected set; } }</span></span></code> </pre><br></div></div><br><h3>  Third task </h3><br>  Saving the screenshot on the computer, everything is very simple enough to use the Bitmap.Save function. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastres == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//     base36 Int32 unixTimestamp = (Int32)(DateTime.UtcNow.Subtract(new DateTime(1970, 1, 1))).TotalSeconds; var FileName = base_convert(unixTimestamp.ToString(), 10, 36); lastres.Save(spath + FileName); }</span></span></code> </pre><br><h3>  Task Four </h3><br>  Uploading a screenshot to the server, it seems that everything is simple, but it is not quite so.  After a little reflection, a rather simple idea came up - loading a screenshot using WebClient in binary format using the ‚Äúapplication / octet-stream‚Äù header and the WebClient.UploadData function, and taking data on the server side using file_get_contents (‚Äúphp: // input‚Äù ).  Actually, I did, wrote a very simple php script in a couple of lines and tied the whole thing to the program.  The result - the screenshots saves and loads.  At the same time, it was necessary to find a simple algorithm for generating short links; in total, it was a very <a href="http://stackoverflow.com/a/960364">simple and elegant way</a> to use Base36, taking int unix time in seconds (linux epoch). <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  bitmap  byte[] private Byte[] BitmapToArray(Bitmap bitmap) { if (bitmap == null) return null; using (MemoryStream stream = new MemoryStream()) { bitmap.Save(stream, ImgFormat[Properties.Settings.Default.format]); return stream.ToArray(); } } private void upload_Click(object sender, EventArgs e) { using (var client = new WebClient()) { client.Headers.Add("Content-Type", "application/octet-stream"); try { var response = client.UploadData(svurl, BitmapToArray(lastres); var result = Encoding.UTF8.GetString(response); if (result.StartsWith("http")) { System.Diagnostics.Process.Start(result); } } catch { } } }</span></span></code> </pre><br><h3>  Accept PHP script </h3><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $file = file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>); $id = base_convert(time(), <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>); file_put_contents(<span class="hljs-string"><span class="hljs-string">"img/"</span></span>.$id.<span class="hljs-string"><span class="hljs-string">".png"</span></span>,$file); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"http://"</span></span>.$_SERVER[<span class="hljs-string"><span class="hljs-string">'SERVER_NAME'</span></span>].<span class="hljs-string"><span class="hljs-string">"/img/"</span></span>.$id.<span class="hljs-string"><span class="hljs-string">".png"</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><h3>  Screenshot Editing </h3><br>  Then I also wanted to somehow quickly edit the screenshots and upload them to the server.  Instead of inventing another image editor, a very simple idea was born - to make an ‚Äúedit‚Äù button that opened paint with a captured screenshot (the last one it saved to disk), and after editing, you could safely upload this file to the server. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edit_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastres == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastfile == <span class="hljs-string"><span class="hljs-string">""</span></span>) save_Click(sender, e); Process.Start(<span class="hljs-string"><span class="hljs-string">"mspaint.exe"</span></span>, <span class="hljs-string"><span class="hljs-string">"\""</span></span> + lastfile + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); }</code> </pre><br><h3>  Settings </h3><br>  Also, it was necessary to specify somewhere the url of the site and the default folder where to save the screenshots, eventually created a simple form of settings where it could be specified.  Well, in addition, I made the ‚Äúopen folder‚Äù button to make everything even easier and faster using the System.Diagnostics.Process.Start function.  In addition, he quickly taught the program to fold to tray. <br><br>  So after all this, the <b>first working prototype</b> was ready, and it looked like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/97a/d83/c4b/97ad83c4b6c24e97b2d578bebbc3ee5c.png"></div><br><h3>  Preview </h3><br>  Everything seems to be good, but it became clear what is missing.  But the preview button was missing!  It was somewhat inconvenient to open a folder or click edit to just see what was captured from the screen before sending.  As a result, I quickly sketched out the preview form, there was a slight problem with displaying a full-screen screenshot in the form (it‚Äôs with frames), I didn‚Äôt want to delete the frame (I don‚Äôt even know why), eventually scrolled into the form and I was completely satisfied. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PreviewForm_Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (form1.lastfile!=<span class="hljs-string"><span class="hljs-string">""</span></span>) { img.Image = Image.FromFile(form1.lastfile); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { img.Image = form1.lastres; } ClientSize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Size(img.Image.Width + <span class="hljs-number"><span class="hljs-number">10</span></span>, img.Image.Height + <span class="hljs-number"><span class="hljs-number">10</span></span>); img.Width = img.Image.Width+<span class="hljs-number"><span class="hljs-number">10</span></span>; img.Height = img.Image.Height+<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (img.Image.Width &gt;= Screen.PrimaryScreen.Bounds.Width || img.Image.Height &gt;= Screen.PrimaryScreen.Bounds.Height) { WindowState = FormWindowState.Maximized; } CenterToScreen(); }</code> </pre><br><h3>  Image format </h3><br>  In addition, there was also the need to save screenshots in different formats (and not just PNG as the default), since all this is easily solved with the help of the same Bitmap.Save function, though that‚Äôs not the quality of jpg images I was satisfied with.  The ability to specify the quality of jpg was not so obvious, fast googling <a href="https://msdn.microsoft.com/en-us/library/bb882583(v%3Dvs.110).aspx">is a solution</a> .  It is implemented using the EncoderParameter additional parameter to Bitmap.Save. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//     private ImageCodecInfo GetEncoder(ImageFormat format) { ImageCodecInfo[] codecs = ImageCodecInfo.GetImageDecoders(); foreach (ImageCodecInfo codec in codecs) { if (codec.FormatID == format.Guid) { return codec; } } return null; } internal void SaveFile(string FilePath, ImageFormat format) { var curimg = lastres; if (format == ImageFormat.Jpeg) { System.Drawing.Imaging.Encoder myEncoder = System.Drawing.Imaging.Encoder.Quality; ImageCodecInfo Encoder = GetEncoder(format); EncoderParameters myEncoderParameters = new EncoderParameters(1); myEncoderParameters.Param[0] = new EncoderParameter(myEncoder, Properties.Settings.Default.quality); curimg.Save(stream, Encoder, myEncoderParameters); } else { curimg.Save(FilePath, format); } }</span></span></code> </pre><br>  Also, the idea was born of automatically opening the folder after saving the screenshot, as well as auto opening the link after downloading.  Quickly implemented it and added checkboxes to settings.  Also added the function of copying links to the clipboard. <br><br>  After adding the preview button, the program somehow began to look ‚Äúnot so‚Äù, the layout of the buttons was scattered, I thought a little, and I rearranged the buttons, so the following happened: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6f1/ebb/e30/6f1ebbe309874f2082bb0b231f098749.jpg"></div><br><h3>  Minor improvements </h3><br>  Having rested a little and thought, I understood what is still missing - information about the latest screenshot download.  Made the appropriate field, when clicked, you could click on the link.  In addition, made the save / edit buttons inaccessible until you take a screenshot.  Well, one more stroke - I added the ‚Äúabout the program‚Äù button with a brief description, version and build date (by the way, to get the date, I again <a href="http://stackoverflow.com/a/1600990">google the solution</a> , getting the date from the title of the application itself). <br><br>  Total after these actions came the following: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/be2/ec8/b00/be2ec8b00ccf4d4e8db994c31977cfb8.png"></div><br>  A little later, I realized that I also lacked the display of the last saved file, which I quickly added, and also made these fields more functional by screwing a context menu (by right-clicking) where you could copy the link / path to the clipboard using Clipboard.SetText. <br><br><h3>  Program availability, localization </h3><br>  Well, it seems that the basic functionality was ready, everything worked, and I thought - could I share the program with the people?  If you do this, then you need to at least make the possibility of localization and add English.  The benefit of the studio makes it easy to implement all this with standard means, I began to translate the whole thing.  Total happened: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e1c/6f8/c90/e1c6f8c90a8e4c3c9927d577337b61cf.png"></div><br>  To translate some messages, it was necessary to create new resource files and then take strings from it as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> ResourceManager LocM = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResourceManager(<span class="hljs-string"><span class="hljs-string">"ScreenShot_Grab.Resources.WinFormStrings"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MainForm).Assembly); LocM.GetString(<span class="hljs-string"><span class="hljs-string">"key_name"</span></span>);</code> </pre><br>  The file with the Russian language I have WinFormStrings.resx, for English WinFormStrings.en.resx, which I put in the Resources folder. <br><br>  But in order to change the language, it was necessary to restart the application, of course I wanted to be able to do without it, fortunately there is a <a href="http://stackoverflow.com/a/21068497">solution to</a> this issue, which I quickly applied.  In addition, it was also necessary to get a list of supported languages ‚Äã‚Äãby the application (for the future, if suddenly there are more localizations), so <a href="http://stackoverflow.com/a/32963564">this decision was</a> nuggled, and all this combined resulted in <a href="http://stackoverflow.com/a/32963564">the</a> following construction: <br><br><div class="spoiler">  <b class="spoiler_title">Real-time language change code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"> private <span class="hljs-type"><span class="hljs-type">void</span></span> ChangeLanguage(string lang) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Form frm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Application.OpenForms) { localizeForm(frm); } } private <span class="hljs-type"><span class="hljs-type">void</span></span> localizeForm(Form frm) { var manager = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ComponentResourceManager(frm.GetType()); manager.ApplyResources(frm, "$this"); applyResources(manager, frm.Controls); } private <span class="hljs-type"><span class="hljs-type">void</span></span> applyResources(ComponentResourceManager manager, Control.ControlCollection ctls) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Control ctl <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ctls) { manager.ApplyResources(ctl, ctl.Name); <span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>.WriteLine(ctl.Name); applyResources(manager, ctl.Controls); } } private <span class="hljs-type"><span class="hljs-type">void</span></span> language_SelectedIndexChanged(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, EventArgs e) { var lang = ((ComboboxItem)<span class="hljs-keyword"><span class="hljs-keyword">language</span></span>.SelectedItem).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Properties.Settings.<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">language</span></span> == lang) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; UpdateLang(lang); } private <span class="hljs-type"><span class="hljs-type">void</span></span> UpdateLang(string lang) { Thread.CurrentThread.CurrentUICulture = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CultureInfo(lang); ChangeLanguage(lang); Properties.Settings.<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">language</span></span> = lang; Properties.Settings.<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>.Save(); form1.OnLangChange(); } private <span class="hljs-type"><span class="hljs-type">void</span></span> Form2_Load(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> sender, EventArgs e) { <span class="hljs-keyword"><span class="hljs-keyword">language</span></span>.Items.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (CultureInfo item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> GetSupportedCulture()) { var lc = item.TwoLetterISOLanguageName; var citem = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ComboboxItem(item.NativeName, lc); //<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>.WriteLine(item.NativeName); //           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.Name == CultureInfo.InvariantCulture.Name) { lc = "ru"; citem = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ComboboxItem("", lc); } <span class="hljs-keyword"><span class="hljs-keyword">language</span></span>.Items.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(citem); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Properties.Settings.<span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">language</span></span> == lc) { <span class="hljs-keyword"><span class="hljs-keyword">language</span></span>.SelectedItem = citem; } } } private IList&lt;CultureInfo&gt; GetSupportedCulture() { //<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> culture CultureInfo[] culture = CultureInfo.GetCultures(CultureTypes.AllCultures); //Find the <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> application installed. string exeLocation = <span class="hljs-type"><span class="hljs-type">Path</span></span>.GetDirectoryName(Uri.UnescapeDataString(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> UriBuilder(Assembly.GetExecutingAssembly().CodeBase).Path)); //<span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> culture <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> which satellite folder <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> culture code. IList&lt;CultureInfo&gt; cultures = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;CultureInfo&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(var cultureInfo <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> culture) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Directory.<span class="hljs-keyword"><span class="hljs-keyword">Exists</span></span>(<span class="hljs-type"><span class="hljs-type">Path</span></span>.Combine(exeLocation, cultureInfo.Name))) { cultures.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(cultureInfo); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cultures; }</code> </pre><br></div></div><br><h3>  The problem of capturing the boundaries of the window </h3><br>  And now I will return to the problem of capturing the borders of the window, this issue was first solved using the automatic window trimming function (which I added to the settings), specifying the values ‚Äã‚Äãfor windows 10, but it was more a crutch than a solution.  To make it clearer what it is, here is a screenshot of what I mean: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f8b/933/383/f8b93338381b43028f66bfffe5008aa6.png"></div><br>  <i>(screenshot from a newer version)</i> <br><br>  As can be seen in the screenshot - except for the window, it captured its boundaries and what was below them.  Googled for quite a long time how to solve this problem, but then came across <a href="http://www.code4copy.com/csharp/getting-window-rect-using-handle-on-windows-8-and-other/">this article</a> , which actually described the solution to the issue, the point is that windows vista and newer need to use dwmapi to get the correct window borders taking into account aero and so on.  With a small modification of my code, I successfully tied it to dwmapi and the problem was finally completely resolved.  But since  window trim functionality has already been written, I decided to leave it, maybe someone will be useful. <br><br><pre> <code class="hljs cs"> [<span class="hljs-meta"><span class="hljs-meta">DllImport(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"dwmapi.dll"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DwmGetWindowAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hwnd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwAttribute, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Rect pvAttribute, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cbAttribute</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Capture</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CaptureMode screenCaptureMode = CaptureMode.Window, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cutborder = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handle = GetForegroundWindow(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(); <span class="hljs-comment"><span class="hljs-comment">//  Win XP       if (Environment.OSVersion.Version.Major &lt; 6) { GetWindowRect(handle, ref rect); } else { var res = -1; try { res = DwmGetWindowAttribute(handle, 9, out rect, Marshal.SizeOf(typeof(Rect))); } catch { } if (res&lt;0) GetWindowRect(handle, ref rect); } ...</span></span></code> </pre><br><h3>  Imgur support </h3><br>  Then, after another thought, since I am going to publish a program for everyone, then probably it would be nice, in addition to downloading to your server, to download a service, because then the program will be more useful, and you don‚Äôt need to have your own server to use it, t. to.  I have been using <a href="http://imgur.com/">imgur.com for a</a> long time and it has a simple <a href="http://api.imgur.com/">api</a> , then I decided to bind to it.  After sitting, having studied his api, first implemented an anonymous download, and a little later, the ability to link an account.  In addition, it implemented the ability to delete the last downloaded image in the program (for their service only). <br><br>  I will not fully describe the implementation code for their api, I‚Äôll just say that I used HttpClient and MultipartFormDataContent from the .NET Framework 4.5 to upload images to imgur and I redid the image upload code to my server, instead of binary sending I used a full download using a form to unify code.  Along the way, as a means of identification, I used the user-agent and the $ _GET [key] key for my script, and I didn‚Äôt want to bother with full authorization (although this is not difficult in theory). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uploadfile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitmap = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] data; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bitmap &amp;&amp; !imgedit) { data = BitmapToArray(lastres); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!File.Exists(lastfile)) { MessageBox.Show(LocM.GetString(<span class="hljs-string"><span class="hljs-string">"file_nf"</span></span>), LocM.GetString(<span class="hljs-string"><span class="hljs-string">"error"</span></span>), MessageBoxButtons.OK, MessageBoxIcon.Error); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } data = File.ReadAllBytes(lastfile); } HttpContent bytesContent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayContent(data); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient()) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultipartFormDataContent()) { ... formData.Add(bytesContent, <span class="hljs-string"><span class="hljs-string">"image"</span></span>, <span class="hljs-string"><span class="hljs-string">"image"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = client.PostAsync(url, formData).Result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!response.IsSuccessStatusCode) { MessageBox.Show(response.ReasonPhrase, LocM.GetString(<span class="hljs-string"><span class="hljs-string">"error"</span></span>), MessageBoxButtons.OK, MessageBoxIcon.Exclamation); lastlabel.Text = LocM.GetString(<span class="hljs-string"><span class="hljs-string">"error"</span></span>); lastlabel.Enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ... }</code> </pre><br>  Total it turned out quite workable and functional program, which already could do a lot more things than I planned to do initially. <br><br>  The list of settings at the time looked like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/95a/065/bba/95a065bba713494685924dc5f766237b.png"></div><br><h3>  Compatible with Win XP </h3><br>  After I began to think about compatibility with Windows XP, it turned out that it only supports the .NET Framework 4.0, and MultipartFormDataContent is available only in v4.5, but it can still be connected in v4.0 by installing the System.Net.Http package.  At first, I did.  And everything seems to be fine, except that on Windows Vista / 7 you need to install .NET Framework 4.0 in order for the program to work.  I switched the project to 3.5, rewrote the upload of images to WebClient, and instead of downloading the file I used the usual field with the encoded image in base64 format, since imgur's api allows you to upload images, and rewrite your php script was not difficult for this option.  And then I also decided to switch the project to version 2.0, and as a result I received a fully working .NET Framework 2.0 project as a result of the banal editing of a couple of lines. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pdata = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NameValueCollection(); ... pdata.Add(<span class="hljs-string"><span class="hljs-string">"image"</span></span>, Convert.ToBase64String(data)); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = client.UploadValues(url, <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, pdata); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = Encoding.UTF8.GetString(response); ...</code> </pre><br><pre> <code class="php hljs">$file = base64_decode($_POST[<span class="hljs-string"><span class="hljs-string">"image"</span></span>]);</code> </pre><br>  All this allowed to run the program on old frameworks, and on Windows Vista / 7 to run without installing anything, since  According to <a href="https://blogs.msdn.microsoft.com/astebner/2007/03/14/mailbag-what-version-of-the-net-framework-is-included-in-what-version-of-the-os/">this article,</a> Windows Vista contains v2.0, and Windows 7 contains v3.5 by default.  But the problems did not end there.  On Windows 8 and newer, I started asking for the installation of the .NET Framework v3.5, which is certainly bad, but the question was quickly resolved thanks to <a href="https://msdn.microsoft.com/en-us/library/jj152935(v%3Dvs.110).aspx">this information</a> , by correcting the supportedRuntime options in the config, allowing you to run the application on a new or old version without any problems.  In addition, I made it possible to use the TLS 1.2 protocol if it is available (ie, on systems with the .NET Framework 4.5). <br><br>  <b>app.config</b> <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v4.0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">supportedRuntime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v2.0.50727"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">startup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>TLS 1.2 support</b> <br><br><pre> <code class="cs hljs">System.Net.ServicePointManager.SecurityProtocol |= SecurityProtocolType.Tls; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { System.Net.ServicePointManager.SecurityProtocol |= (SecurityProtocolType)<span class="hljs-number"><span class="hljs-number">3072</span></span>; <span class="hljs-comment"><span class="hljs-comment">//SecurityProtocolType.Tls12; } catch { }</span></span></code> </pre><br><h3>  History of events </h3><br>  By and large, I thought that everything was enough for this, you can release it, but still something was missing - the history of actions with the log.  Began to develop the appropriate window with some functions, like deleting a file from the PC and imgur, opening a file / link, copying the path / link using the context menu.  I also made it possible to save events to the log file both from the list and automatically set in the settings. <br><br>  Quite an informative window appeared: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bff/c6f/7d2/bffc6f7d274548c1ab4ca6630161c2f7.png"></div><br><h3>  Problem with HookCallback on Win XP </h3><br>  But one problem got out - on Windows XP, when capturing srkinshots, the record was added twice.  In the course of the tests, I found out that HookCallback is called twice when the key is released, the reason for this behavior was not clear to me, but I solved the question quite easily - I made an additional test of the keystroke saving it into a variable, and when I released the key, changing the variable to false, eventually I needed The code began to be processed only 1 time when the key is released. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> pressed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HookCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nCode, IntPtr wParam, IntPtr lParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nCode &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { Keys number = (Keys)Marshal.ReadInt32(lParam); <span class="hljs-comment"><span class="hljs-comment">//MessageBox.Show(number.ToString()); if (number == Keys.PrintScreen) { if (pressed &amp;&amp; wParam == (IntPtr)261 &amp;&amp; Keys.Alt == Control.ModifierKeys &amp;&amp; number == Keys.PrintScreen) { var res = Scr.Capture(ScreenCapturer.CaptureMode.Window, Properties.Settings.Default.cutborder); WinForm.OnGrabScreen(res, false, true); pressed = false; } else if (pressed &amp;&amp; wParam == (IntPtr)257 &amp;&amp; number == Keys.PrintScreen) { var res = Scr.Capture(ScreenCapturer.CaptureMode.Screen); WinForm.OnGrabScreen(res); pressed = false; } else if (wParam == (IntPtr)256 || wParam == (IntPtr)260) { pressed = true; // fix for win xp double press } } } return CallNextHookEx(IntPtr.Zero, nCode, wParam, lParam); }</span></span></code> </pre><br><h3>  The problem of capturing screenshots from games </h3><br>  A little later, during testing, I encountered the problem of capturing screenshots from full-screen applications (for example, games), noticed that in windows 10 regular printscreen captures this case without problems, eventually added a function to insert images from the clipboard, and also added a tick "use the clipboard instead of capture "in the settings, thus" solved the issue "for myself, but as it turned out in win 7 and below it does not work, I began to study the question, and I realized that this is quite a difficult task, with the need to use directx injections, in the end I simply scored on this  the problem is, after all, the main goal is not to capture screenshots from games, for this there are many other programs and tools. <br><br>  Along the way, adding settings remade the settings menu, made it more compact to fit on a screen with a resolution of 640 * 480 pixels, and it began to look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fb4/538/13c/fb453813c8964edbad1ce91ecd7d7c7c.png"></div><br>  I also made the tray icon more functional by adding all the important functions there when I right-click it: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/48f/17b/623/48f17b623a4049fbbc5b6cabbc0d3074.png"></div><br><h3>  Check for Win98 and Win2000 </h3><br>  Well, purely for the sake of experiment, I deployed windows 2000 SP4 and 98 SE on a virtual machine, installed the .NET Framework 2.0 there.  It was not so easy to do, because  Some patches were required to install and upgrade Windows Installer.  But still everything turned out and I tried to run the application. <br><br>  As it turned out on Windows 2000 SP4, the application turned out to be fully working, but on Windows 98 SE, the key capture did not work, pasting from the buffer also does not work, but loading the screenshot from the file works without problems.  Actually, these problems could not be solved, there is very little information, everything that I could find out - the ‚ÄúWH_KEYBOARD_LL‚Äù parameter was added only in Windows 2000. And I didn‚Äôt find any information about the reason for not working the image from the buffer.  Total min requirements - Windows 2000. <br><br>  So after some checks, debugs and minor fixes, the program was finally ready, and the final version looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/90b/049/87a/90b04987a01a4dc59b27f10b613b56fb.png"></div><br>  All that remains is to create a github repository, download the source code, compile the application, write readme and make a release.  This is where the story ends.  You can download the finished program and view the source code on <a href="https://github.com/AlexALX/ScreenshotGrab">GitHub</a> .  I hope the article was helpful. </div><p>Source: <a href="https://habr.com/ru/post/316012/">https://habr.com/ru/post/316012/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316000/index.html">Native applications are doomed (part 1)</a></li>
<li><a href="../316004/index.html">OvS, DPDK, and Intel HT: 12x Virtual Switch Acceleration</a></li>
<li><a href="../316006/index.html">PMEM emulation on Intel servers</a></li>
<li><a href="../316008/index.html">Google gets rid of private clients in Russia</a></li>
<li><a href="../316010/index.html">Why do board games cost so much - or do it yourself</a></li>
<li><a href="../316014/index.html">The traveling salesman task by the Little method in C ++</a></li>
<li><a href="../316016/index.html">Swift String Validating or simple validation of strings to meet criteria.</a></li>
<li><a href="../316020/index.html">Promotion of mobile games in the Asian market. Interview with Ilya Salamatov, 101XP</a></li>
<li><a href="../316022/index.html">Autumn in indie game markets</a></li>
<li><a href="../316024/index.html">Beginner's Guide to VR Developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>