<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moving to MySQL 5.6, is it worth it?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the release of the new version of MySQL at the beginning of this year, many are thinking about whether it is worth switching to it from older ve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moving to MySQL 5.6, is it worth it?</h1><div class="post__text post__text-html js-mediator-article">  After the release of the new version of MySQL at the beginning of this year, many are thinking about whether it is worth switching to it from older versions.  To answer this question for yourself, you first need to understand what exactly this transition will give.  In this article I will try to highlight the new, important for me, features that were included in the distribution of the new version, analysis of their performance and performance of the new version, as well as the need to change something in the code due to the rewritten optimizer.  Since the volume of changes is really very large, for each item I will give a link to the original article on performance testing and exclude water from the description. <br><a name="habracut"></a><br><h4>  Let's start with the most interesting - optimizer extensions </h4><br>  <a href="http://dev.mysql.com/doc/refman/5.6/en/index-condition-pushdown-optimization.html">Index Condition Pushdown (ICP)</a> - this optimization is performed if we access data in a table using a composite index.  If the condition on the first part of the key can be applied explicitly, and the condition on the remaining part of the key cannot be explicitly applied, for example: <br><ul><li> <code>keypart1 = 1</code> - access predicate, <code>keypart2 like '%value%'</code> - filtering predicate, </li><li>  or impose on both parts of the range key condition <code>keypart1 between a and b</code> - access predicate, <code>keypart2 between c and d</code> filtering predicate (full use of the index for this type of query as an access predicate in <code>MySQL</code> has not yet been implemented) </li></ul><br>  previously, the <code>MySQL</code> server, after applying the access predicate, would switch to the storage engine and, reading the table row, would apply the second condition.  Using this option, this switch will not, of course, if the storage engine itself supports <code>ICP</code> , at the moment it is <code>MyISAM</code> and <code>InnoDB</code> , and the filtering predicate will be applied solely on the basis of index data.  The plan will be <code>Using index condition</code> . <br>  According to <a href="http://www.mysqlperformanceblog.com/2012/03/12/index-condition-pushdown-in-mysql-5-6-and-mariadb-5-5-and-its-performance-impact/">testing, the</a> performance when requesting data from the cache will be about 30-50 percent, while working with the I / O subsystem it is possible to accelerate up to 100 times. <br>  <a href="http://dev.mysql.com/doc/refman/5.6/en/mrr-optimization.html">Multi Range Read (MRR)</a> - when conducting a <code>Range Scan</code> using secondary keys, to reduce the number of arbitrary disk readings, first we read all the necessary data from the index, then we sort by <code>ROWID</code> , and only after that we read the data by the primary key.  In the plan, which is undoubtedly wonderful, will be <code>Using MRR</code> .  This operation is a bulk.  Those.  applying access predicates by the secondary key - we fill the available buffer, and only after that we sort and read the data.  At this point either lucky and the data is close to each other or not.  For distributed tables, the situation is even better, but this is beyond the scope of this article.  In its pure form, this algorithm can be applied when executing a query on a single table.  In combination with <a href="http://dev.mysql.com/doc/refman/5.6/en/bnl-bka-optimization.html">Batch Key Access (BKA),</a> it also significantly speeds up join operations.  By default, the <code>BKA</code> flag is turned off, its value, as well as any value of the optimizer flags, can be viewed by running the <code>SELECT @@optimizer_switch</code> query.  When BKA is enabled, it is necessary to check your requests for different values ‚Äã‚Äãof the <code>join_buffer_size</code> parameter <code>join_buffer_size</code> since this parameter will be used to calculate the maximum buffer size.  When applying this remarkable algorithm in the query plan, we will see the <code>Using join buffer (Batched Key Access)</code> .  More detailed coverage of the topic <a href="https://kb.askmonty.org/en/multi-range-read-optimization/">here</a> .  According to the <a href="http://www.mysqlperformanceblog.com/2012/03/21/multi-range-read-mrr-in-mysql-5-6-and-mariadb-5-5/">results of testing,</a> this optimization can give significant accelerations only under the condition of inputting output and working with the disk.  In this case, you can get 10-fold acceleration only with <code>MRR</code> .  In a number of other synthetic tests, accelerations of up to 280 times were obtained when <code>MRR</code> and <code>BKA</code> used together.  When working exclusively with memory, you will not get acceleration, which is quite logical, since this operation is designed to optimize only input and output. <br>  <a href="http://dev.mysql.com/doc/refman/5.6/en/limit-optimization.html">File Sort Optimization</a> - sorting by non-indexed column has become significantly more productive, subject to certain conditions.  Previously, when performing this sort of sorting, the only possible option was merge sorting.  Roughly speaking, the data received as a result of the query was stored in a temporary table.  After that, this table was sorted and records returned satisfying the <code>LIMIT</code> condition.  As you can see, this algorithm is not very productive, especially if you have a lot of queries that return a small number of rows.  In order to optimize the input-output algorithm has been changed to the following.  If the number of records received as a result of the query is fully placed in the <code>sort_buffer_size</code> , a queue is created when scanning the table.  This queue is ordered, and is filled immediately at the moment of receiving the next line of the query result.  Queue size <code>N</code> (or <code>M + N</code> if <code>LIMIT M, N</code> ).  When the queue is full, extra data is discarded from the end.  Thus, the end of sorting is performed simultaneously with the end of the query result, and there are no calls to the temporary table at all.  The optimizer chooses a strategy for sorting.  The queue will be used when you need to load the processor more, merge sorting when the input / output system is available. <br>  When conducting <a href="http://didrikdidrik.blogspot.co.uk/2011/04/optimizing-mysql-filesort-with-small.html">synthetic tests</a> , an acceleration of 4 times was obtained.  But it is also necessary to understand that this optimization allows to reduce the load on the input-output subsystem, which will positively affect the work of the entire instance. <br>  <a href="http://dev.mysql.com/doc/refman/5.6/en/subquery-optimization.html">Subqueries optimization</a> <br>  <code>postpone materialization</code> - basically it concerns the speeding up of building a query plan.  Previously, when executing the <code>EXPLAIN</code> command, the subqueries used in the <code>FROM</code> section were materialized to obtain statistical data on them.  Those.  in fact, these queries were executed on the database.  Now this operation is not performed, and it became possible to receive the query plan without loading the DB instance.  However, the query execution time can also be accelerated, for example, if there are 2 materializable representations in the <code>FROM</code> section and the first has not returned any records, the 2nd one will not be executed.  Also during the execution of a query, MySQL can independently index the resulting materialized table, if it deems it necessary. <br>  <code>semi-join transformation</code> - a <code>semi-join transformation</code> can be used to obtain data from only one table, based on data from another table, in all databases the classic example is the <code>EXISTS</code> construction.  The use of this optimization has become possible for the <code>IN</code> construct which used to work very badly.  In order for the application of this optimization to become possible, the subquery satisfies the following conditions: the absence of <code>UNION</code> , the absence of <code>GROUP BY</code> and <code>HAVING</code> , the absence of <code>ORDER BY</code> with the <code>LIMIT</code> constraint (these constructions can be used separately).  It is also necessary that the number of subqueries does not exceed the maximum number of tables allowed for <code>JOIN</code> , otherwise <code>MySQL</code> will not be able to rewrite this query.  Optimization is achieved by rewriting the query in <code>SEMI JOIN</code> or by presenting the subquery as a <code>VIEW</code> in the <code>FROM</code> construct and using the optimizations for the <code>postpone materialization</code> described above.  Duplicate entries from the final result are removed in the following ways: <br><ul><li>  by placing the unique results of the final query in a temporary table ( <code>Start temporary</code> and <code>End temporary</code> in the <code>Extra</code> plan column) </li><li>  using the ‚Äúfirst found‚Äù criterion at the stage of scanning a table from a subquery ( <code>FirstMatch(tbl_name)</code> in the <code>Extra</code> plan column) </li><li>  by applying the optimization <a href="http://dev.mysql.com/doc/refman/5.6/en/loose-index-scan.html">Loose Index Scan</a> ( <code>LooseScan(m..n)</code> where m and n are parts of the key used for this optimization) </li></ul><br>  When materializing and subsequently indexing a subquery in the <code>select_type</code> column of the query plan will be <code>MATERIALIZED</code> .  To understand how exactly the query was rewritten, you can use the standard <code>EXPLAIN EXTENDED</code> command.  This way you will always understand exactly how your query was rewritten, and whether optimization was applied. <br>  As you understand, <a href="https://kb.askmonty.org/en/table-pullout-optimization/">rewriting crookedly written requests</a> (I would have torn my hands for such requests, now it has become forgivable) can simply give a huge performance boost, so it‚Äôs almost meaningless to run tests on <code>table pullout</code> (removal of the subquery from the <code>WHERE</code> condition to the <code>FROM</code> condition) for a 1000-fold increase in performance will not be the limit, but if all your queries are written correctly, then you can not wait for something extraordinary from this type of optimization. <br>  <a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-performance.html">Static statistics for <code>InnoDB</code></a> <br>  Finally it happened.  I don‚Äôt know where, from <code>Google</code> , <code>Percona</code> or from <code>Oracle</code> itself, but <code>MySQL</code> has the opportunity to exclude dynamic sampling from the construction of the query plan.  Now statistics on tables and indexes are stored in persistent tables.  This statistics collection method is enabled by default.  When updating more than 10% of the data in the table, the statistics on it is automatically rebuilt (of course, this can be changed).  Also, statistics collection can be started by the command <code>ANALYSE</code> .  To force a reset of statistics when the optimizer is unprecedentedly blunt, you can call the command <code>FLUSH TABLE</code> .  What exactly is going to can clearly see in the new tables <code>mysql.innodb_index_stats</code> , <code>mysql.innodb_table_stats</code> .  These are certainly not advanced histograms, but progress on the face.  Now plans have become more stable on the one hand, and on the other hand, DB administrators have new entertainment: come when the statistics in the table have become irrelevant, find idle time, guess the sampling volume and recalculate it, especially as it follows from the developers blog, the statistics can be changed with pens by direct updates.  I would also like to note that during the tests, the statistics collector, apparently working in the background thread, did not have time to process the data.  Statistics remained empty for a long time, until I started analyzing it manually.  Analysis of statistics for a specific partition cannot be started. Therefore, it was necessary to analyze the entire partitioned table, which of course is not very convenient.  The same situation arises if you hold the active DML and put the base.  The data will be - no statistics.  But I think these are exceptional situations and they will not interfere with the normal operation of the database. <br>  As an <a href="http://www.percona.com/files/presentations/percona-live/PLMCE2012/PLMCE2012-MySQL-5.6-vs-MariaDB-5.5-Optimizer-Standoff.pdf">output</a> from the optimizer, I think it is useful to note that the Maria DB 5.5 optimizer is more sophisticated, experts say, but in MySQL version 5.6 a number of similar optimizations allow for higher performance. <br><br><h4>  More good and different mutexes </h4><br>  As everyone well knows, MySQL does not scale well enough to a large number of processors with a large number of simultaneously executed transactions.  The reason for this is internal locks, in particular, <code>kernel mutex</code> , as well as fundamental problems when working with memory in a multi-core architecture.  <code>Kernel mutex</code> , held while copying the list of active transactions, was divided into several mutexes, for non-blocking and blocking transactions, locks, waiting locks, etc.  Also, the problem of <code>false sharing</code> 'was solved, when one core loaded the unchangeable data it needed, and the other needed it changed in one <code>cacheline</code> , and as a result, the data for the first core was all the time washed out of the cache.  Now <a href="http://mikaelronstrom.blogspot.ru/2012/04/mysql-team-increases-scalability-by-50.html">alignment</a> of 64 bytes is <a href="http://mikaelronstrom.blogspot.ru/2012/04/mysql-team-increases-scalability-by-50.html">introduced</a> for a number of critical objects. <br>  According to the developer blogs, <code>MySQL</code> began to scale up to 50% better for <code>read only</code> transactions.  And the performance gain with an increase in the number of active sessions was up to 600% compared with the previous version.  When conducting independent load tests, up to 16 simultaneous sessions - the operation speed has not changed, higher - up to 100% for mixed read-write transactions and up to 300% for read-only transactions. <br><br><h4>  UNDO Reset Optimization </h4><br>  It is now possible to reset UNDO in parallel.  For this, it is necessary to set the <code>innodb_purge_threads</code> parameter to a value greater than 1. It will be reasonable to experiment with this parameter on the industrial database only for those who simultaneously delete a lot of data from partitioned tables.  Performance improvements for those who do not use partitioning or use partitions for reasons other than parallel DML, such as archiving, in which DML operations are performed with only one partition, will not, because when you reset data, you will hang on the <code>dict_index_t::lock</code> .  For them, it is recommended, as before, to simply allocate a data reset to one, separate from the main, stream. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Optimization of dirty block reset </h4><br>  As you know, dumping dirty blocks from memory is one of the most problematic places for any versioned database.  The necessary part of the blocks can be reset to the disk either by the main <code>InnoDB Master Thread</code> , and then everyone will wait, or, as the background thread basically happens, a specific session will give a reset command, and then this session will hang indefinitely, and the rest Sessions will not be blocked.  To avoid problems both in the first and in the second case, a separate thread called <code>page_cleaner</code> was created.  Detailed information on what this stream is busy can be found <a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-metrics-table.html">here.</a> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> information_schema.innodb_metrics <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'buffer_flush_%'</span></span>;</code> </pre><br>  Now the reset of blocks really began to be performed asynchronously.  If you decide to play with the block reset parameters, I also recommend that you pay attention to the new <code>LRU flush</code> optimization parameters, since these parameters, according to <a href="http://itnewscast.com/database/configuring-innodb-mysql-56-innodbiocapacity-innodblruscandepth">the</a> <code>MySQL</code> developers, can indirectly influence each other. <br>  Reset blocks have been adapted for SSD drives.  This hazy phrase means the following.  As we know, block caching is done by pages.  64 pages form an extent.  It is common for neighbors to call these most consistent pages within one extent.  Previously, <code>InnoDB</code> when changing pages, tried to accumulate a whole extent to flush data to disk to optimize I / O, since for a HDD one megabyte is the optimal size, which allows you to perform the operation in one disk access.  For SSD, a reset size of only 4 kilobytes is possible, so typing something is meaningless.  In addition, dropping unchanged pages is also meaningless.  So the owners of modern iron can play with the <a href="http://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html">parameter</a> . <br>  As an output, it would not be superfluous to notice the results of <a href="http://mysqlha.blogspot.ru/2013/05/mysql-56-flushing-potential.html">this test</a> . <br><img src="https://habrastorage.org/storage2/c65/661/26a/c6566126aa4fe09c6a86251a5e48adb8.png"><img src="https://habrastorage.org/storage2/e32/f5b/e9e/e32f5be9e827575b40dc1a8d41d86bfa.png"><br>  As can be seen from the graphs when working with the cache, a new version with an optimized reset, <code>MySQL 4.0.30</code> (I don‚Äôt know the reasons for choosing the old version) with a small number of sessions, but it shows an order of magnitude better result when scaling. <br><img src="https://habrastorage.org/storage2/20f/c61/aec/20fc61aecd271de47ce10b22466d7f49.png"><img src="https://habrastorage.org/storage2/f79/ddc/c6b/f79ddcc6b0f69fb02885487743669f99.png"><br>  When working with the file system, the results are not so impressive and both versions go nostril to nostril and MySQL 5.6 even loses in some places.  However, according to the author, upon exiting <code>5.6.12</code> , this drawback will be eliminated, and the performance will jump 3 times.  Those.  for those who have problems with a large input output and an active reset of buffers to disks, it is worth waiting for the next version, you will be happy. <br><br><h4>  InnoDB: ALTER TABLE ... ONLINE </h4><br>  All the praises of this technology can be safely described in two words - <b>banal advertising</b> .  According to the developers, this team <a href="https://blogs.oracle.com/mysqlinnodb/entry/online_alter_table_in_mysql">was rewritten a little more than completely,</a> but the <code>InnoDB-engine</code> team didn‚Äôt get any significant advantages from it.  In <code>online</code> are only a limited number of extremely rare operations, and even with restrictions.  To understand that the operation went <code>online</code> very easy.  As a result of the request, you will receive <br><pre> <code class="sql hljs">Query OK, 0 rows affected</code> </pre><br>  And so what can: <br><ul><li>  <code>CREATE INDEX, DROP INDEX</code> - we are all used to the fact that the execution of these commands does not perform a full copy of the table, however it blocks the updating of data in it.  This is due to the fact that the index was previously built directly on the table and had, at the time of sorting and merging, a complete set of data, which allows you to create the most balanced index tree.  Now, at the time of creating the index, a read-only lock is hung on the table.  New data coming in or disappearing from the table is placed in a special log file created by analogy with the <code>change buffer</code> structure, the file size is governed by the variable <code>innodb-online-alter-log-max-size</code> .  After the sorting and merging (the size of the sorting buffer is controlled by the variable <code>innodb-sort-buffer-size</code> ), the data for the new index is flushed to the <code>REDO</code> logs, after which the logged changes are made.  Voila and the index is available for use.  On the one hand, this does not block the table, on the other hand, the structure of the created index will not be as perfect as in the first case, and even creating it in the case of an active <code>DML</code> table can take a lot of time, but this is of course trivial. </li><li>  Changing the <code>auto-increment</code> value for a table is undoubtedly useful for those users who use a self-written sharding that splits data into instances based on the value of the primary key. </li><li>  <code>DROP FOREIGN KEY</code> - only deleting, adding the constraint has not yet been mastered, but as a bonus they allowed to delete the constraint and the index associated with it with one command. <pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>;</code> </pre> <br>  A fair remark from the MySQL support staff member of the <a href="https://habrahabr.ru/users/svetasmirnova/" class="user_link">svetasmirnova</a> : ‚ÄúYou can also add it only when <code>foreign_key_checks</code> off‚Äù, in this case the table will not be copied </li><li>  Renaming a column <code>online</code> is possible only if the data type is not changed.  Only the dictionary data is changed.  Again, as a bonus, they were allowed to rename the pegs that are part of the foreign key. </li></ul><br>  Well, that's all.  As you can see from the description, the <b>opportunities provided to us are extremely scarce</b> , let's hope that the situation will improve in the future and changes to large tables can be performed without dances with a tambourine, which are associated with full table copying when performing any (with <code>MySQL 5.6</code> we read any except for 5 ) <code>DDL</code> commands. <br><br><h4>  Partitioning </h4><br>  The partition engine was substantially reworked.  Now the selection of partitions for processing is performed earlier than opening tables and setting locks.  Here is an analysis of the input output in a trivial request for a partition key. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> part_table <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> partition_key = <span class="hljs-number"><span class="hljs-number">190110</span></span>; +<span class="hljs-comment"><span class="hljs-comment">----------+ | count(1) | +----------+ | 500 | +----------+ 1 row in set (0.50 sec)</span></span></code> </pre><br>  Input output and buffer pool <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">distinct</span></span> file_name) file_name_count, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(sum_number_of_bytes_read) sum_number_of_bytes_read, <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(substring_index(file_name, <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>)) min_file_name, <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(substring_index(file_name, <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>)) max_file_name <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> performance_schema.file_summary_by_instance <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> file_name <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%part_table%.ibd'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> count_read + count_write &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- Server version: 5.5 +-----------------+--------------------------+------------------------------------+------------------------------------+ | file_name_count | sum_number_of_bytes_read | min_file_name | max_file_name | +-----------------+--------------------------+------------------------------------+------------------------------------+ | 1024 | 107692032 | part_table#P#part_table_184609.ibd | part_table#P#part_table_190110.ibd | +-----------------+--------------------------+------------------------------------+------------------------------------+ -- Server version: 5.6 +-----------------+--------------------------+------------------------------------+------------------------------------+ | 1 | 98304 | part_table#P#part_table_190110.ibd | part_table#P#part_table_190110.ibd | +-----------------+--------------------------+------------------------------------+------------------------------------+ select min(table_name) min_table_name, max(table_name) max_table_name, count(distinct table_name) file_name_count, sum(data_size) pool_size from information_schema.innodb_buffer_page where table_name like '%part_table%'; -- Server version: 5.5 +--------------------------------------+--------------------------------------+-----------------+-----------+ | min_table_name | max_table_name | file_name_count | pool_size | +--------------------------------------+--------------------------------------+-----------------+-----------+ | test/part_table#P#part_table_184609 | test/part_table#P#part_table_190110 | 1024 | 26567424 | +--------------------------------------+--------------------------------------+-----------------+-----------+ -- Server version: 5.6 +--------------------------------------+--------------------------------------+-----------------+-----------+ | Partition `part_table_190110` | Partition `part_table_190110` | 1 | 32048 | +--------------------------------------+--------------------------------------+-----------------+-----------+</span></span></code> </pre><br>       5.5        ,       .        . <br>      ,            ,      ,    <code>wait/synch/mutex/mysys/THR_LOCK::mutex</code>         , ..                   ,   ,    .           .        <a href="http://habrahabr.ru/post/130999/"></a>   (   ,    ,    <code>mysql.innodb_table_stats</code> ,        ,    ).                .     ,   ,   ,   ,      ,  <code>hint parallel(n)</code>   . <br><br><h4>    </h4><br>            InnoDB: <br> <code>EXCHANGE PARTITION</code> <br> <pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> part_table <span class="hljs-keyword"><span class="hljs-keyword">EXCHANGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> p1 <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> non_part_table;</code> </pre><br>  :      ,    <code>storage engine</code> ,              . <br> <code>Transportable Tablespaces</code> <br>       <code>.ibd</code>         ‚Äî  .    : <code>REDO</code> ,  ,  ,        .       : <br>    <br> ‚Äî <code>FLUSH TABLES table_one, table_two FOR EXPORT;</code> <br> ‚Äî  <code>.ibd</code>        <br>    <br> ‚Äî      <br> ‚Äî <code>ALTER TABLE table_one DISCARD TABLESPACE;</code> <br> ‚Äî  <code>.ibd</code>        <br> ‚Äî <code>ALTER TABLE table_one IMPORT TABLESPACE;</code> <br>      ,    . <br><br><h4> Performance Schema </h4><br>      .         , ..         10%   3.5%,       .        17   ,  52.      ,        ,     ,   ,     . <br><ul><li>      <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span> <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%statements%'</span></span>; +<span class="hljs-comment"><span class="hljs-comment">----------------------------------------------------+ | Tables_in_performance_schema (%statements%) | +----------------------------------------------------+ | events_statements_current | | events_statements_history | | events_statements_history_long | | events_statements_summary_by_account_by_event_name | | events_statements_summary_by_digest | | events_statements_summary_by_host_by_event_name | | events_statements_summary_by_thread_by_event_name | | events_statements_summary_by_user_by_event_name | | events_statements_summary_global_by_event_name | +----------------------------------------------------+ 9 rows in set (0.01 sec)</span></span></code> </pre></li><li>              (       <code>object_type= 'TEMPORARY TABLE'</code>   ,  -   ,     ) <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> digest_text, sum_rows_affected, sum_rows_sent, sum_rows_examined <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> events_statements_summary_by_digest; +<span class="hljs-comment"><span class="hljs-comment">---------------------------------------+-------------------+---------------+-------------------+ | digest_text | sum_rows_affected | sum_rows_sent | sum_rows_examined | +---------------------------------------+-------------------+---------------+-------------------+ | SHOW VARIABLES | 0 | 4410 | 4410 | ... | SET NAMES utf8 | 0 | 0 | 0 | +---------------------------------------+-------------------+---------------+-------------------+ 48 rows in set (0.00 sec)</span></span></code> </pre></li><li>        <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span> <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%by_thread%'</span></span>; +<span class="hljs-comment"><span class="hljs-comment">---------------------------------------------------+ | Tables_in_performance_schema (%by_thread%) | +---------------------------------------------------+ | events_stages_summary_by_thread_by_event_name | | events_statements_summary_by_thread_by_event_name | | events_waits_summary_by_thread_by_event_name | +---------------------------------------------------+ 3 rows in set (0.00 sec)</span></span></code> </pre></li><li>    ,        ,    ,              <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> digest_text, sum_created_tmp_disk_tables, sum_created_tmp_tables <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> events_statements_summary_by_digest; +<span class="hljs-comment"><span class="hljs-comment">--------------------------------------------------------+-----------------------------+------------------------+ | digest_text | sum_created_tmp_disk_tables | sum_created_tmp_tables | +--------------------------------------------------------+-----------------------------+------------------------+ | SHOW VARIABLES | 0 | 10 | ... | SELECT `routine_schema` , `specific_name` FROM INF... | 2 | 2 | ... | SHOW TABLE STATUS FROM `performance_schema` LIKE | 0 | 52 | +--------------------------------------------------------+-----------------------------+------------------------+ 49 rows in set (0.00 sec)</span></span></code> </pre></li><li>  ,     ,      <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span> <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'table%waits%sum%'</span></span>; +<span class="hljs-comment"><span class="hljs-comment">-------------------------------------------------+ | Tables_in_performance_schema (table%waits%sum%) | +-------------------------------------------------+ | table_io_waits_summary_by_index_usage | | table_io_waits_summary_by_table | | table_lock_waits_summary_by_table | +-------------------------------------------------+ 3 rows in set (0.01 sec)</span></span></code> </pre></li></ul><br>     <a href="http://www.percona.com/webinars/using-mysql-56-performance-schema-troubleshoot-typical-workload-bottlenecks"> </a> ,       ,          5.5,     .     , ,           .       5.5 <code>events_waits_history_long</code>  100 ,             ,       . <br><br><h4>  Conclusion </h4><br>            <a href="http://www.mysqlperformanceblog.com/2013/02/18/is-mysql-5-6-slower-than-mysql-5-5/">  </a> .     <code>MySQL 5.6</code>    <code>MySQL 5.5</code>  7.5-11         11-26     64 ,      <a href="http://dev.mysql.com/tech-resources/articles/mysql-5.6.html"> </a> .  Those.   ,      .     ,   ,         .         .       ,      <a href="https://habrahabr.ru/users/esinev/" class="user_link">esinev</a> , <a href="https://code.google.com/p/jdbc-proc/">jbdc-proc</a> .     . <br><img src="https://habrastorage.org/storage2/750/ba5/e55/750ba5e55dd5c4cff2bd1ead2ccfafd2.png"><br>          ,       20%, ,   ,      ,       .     ,  MySQL    ,    ,    ,    . </div><p>Source: <a href="https://habr.com/ru/post/179481/">https://habr.com/ru/post/179481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179467/index.html">Author Hydra, Amap and SuSEFirewall to Speak at PHDays</a></li>
<li><a href="../179469/index.html">Megatrade: presentation on NetApp FAS storage</a></li>
<li><a href="../179471/index.html">How we did the right production</a></li>
<li><a href="../179473/index.html">Forms in Angularjs. How I found love</a></li>
<li><a href="../179475/index.html">Privileged Account Management</a></li>
<li><a href="../179483/index.html">Laser weapons destroy a rocket at a distance of 1.5 km (video)</a></li>
<li><a href="../179487/index.html">Protection of Android applications from hacking</a></li>
<li><a href="../179489/index.html">On the other side of a like: our Facebook people</a></li>
<li><a href="../179493/index.html">Money received using the Diablo 3 bug will go to charity</a></li>
<li><a href="../179495/index.html">Three professional deformation IT specialists</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>