<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Piggy bank knowledge for PHPixie - Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our chat, there are often questions, answers to which could be useful to others. In addition, in PHPixie there are a lot of interesting chips that ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Piggy bank knowledge for PHPixie - Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right"><br><p>  In our chat, there are often questions, answers to which could be useful to others.  In addition, in <a href="http://phpixie.com/">PHPixie</a> there are a lot of interesting chips that are not included in the documentation because they are too specific.  So that all this information is not lost, I begin a cycle of articles in the style of "tips and tricks" intended primarily for those who already use the framework.  So, let's begin. </p><a name="habracut"></a><br><p>  <strong>Wrapping arbitrary query in ORM</strong> </p><br><p>  Sometimes you need to turn a standard SQL query into an ORM entity, this is quite simple: </p><br><pre><code class="php hljs">$result = $database-&gt;get()-&gt;execute(<span class="hljs-string"><span class="hljs-string">'SELECT ....'</span></span>); $loader = $orm-&gt;builder()-&gt;loaders()-&gt;dataIterator( $orm-&gt;repository(<span class="hljs-string"><span class="hljs-string">'modelName'</span></span>), $result ); <span class="hljs-comment"><span class="hljs-comment">//    foreach($loader as $entity) { //.... } //   $entities = $loader-&gt;asArray();</span></span></code> </pre> <br><p>  In fact, this way you can get entities not only from a SQL query but also from any iterator and even from an array: </p><br><pre> <code class="php hljs">$result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayIterator([ [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Pixie'</span></span>], [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Trixie'</span></span>] ]);</code> </pre> <br><p>  <strong>SQL query logging</strong> </p><br><p>  The Database component supports any PSR-3 logger, just pass it to the constructor: </p><br><pre> <code class="php hljs">$database = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \PHPixie\Database($config, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeLogger());</code> </pre> <br><p>  If you are using a framework, then the logger can be set in the <code>Project\Framework\Builder</code> class: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildLogger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeLogger(); }</code> </pre> <br><p>  Requests will be logged at the DEBUG level. </p><br><p>  <strong>Podgruzka many-to-many conditional connections</strong> </p><br><p>  During the prelode of manyToMany (and soon oneToMany) connections, not all entities can be loaded, but only those that meet the condition: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//           active = 1 $fairies = $orm-&gt;repository('post')-&gt;query()-&gt;find([ 'author', 'tags' =&gt; [ 'queryCallback' =&gt; function($query) { $query-&gt;where('active', 1); } ] ]);</span></span></code> </pre> <br><p>  <strong>Shortcut to generate the URL in the controller</strong> </p><br><pre> <code class="php hljs">$frameworkBuilder = $builder-&gt;frameworkBuilder(); $uri = $frameworkBuilder-&gt;http()-&gt;generateUri(<span class="hljs-string"><span class="hljs-string">'app.some'</span></span>, [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>]);</code> </pre> <br><p>  <strong>Unofficial Firebird Support</strong> </p><br><p>  Thanks <a href="https://github.com/Linfuby">Linfuby</a> now the PHPixie Database and ORM also work with Firebird.  While she is at the stage of "secret feature" and needs to be thoroughly checked, but you can already try and help find bugs.  To connect, it is enough to specify the config: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'interbase'</span></span>, <span class="hljs-string"><span class="hljs-string">'database'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'database'</span></span>, <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'password'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'firebird'</span></span> ] ];</code> </pre> <br><p>  For production just early, but it can be useful if you need to make a couple of requests or dump the base. </p><br><p>  <strong>Getting an associative array of entities across the field</strong> </p><br><pre> <code class="php hljs">$items = $orm-&gt;query(<span class="hljs-string"><span class="hljs-string">'post'</span></span>)-&gt;find()-&gt;asArray(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">'someField'</span></span>);</code> </pre> <br><p>  <strong>New providers for Social</strong> </p><br><p>  PHPixie Social now supports even more providers: Dropbox, Facebook, Github, Google, Instagram, Twitter, Vkontakte (thanks to <a href="https://github.com/REZ1DENT3">REZ1DENT3</a> ) </p><br><p>  <strong>Finally, new benchmarks from Techempower</strong> </p><br><p>  PHPixie continues to lead in performance, with an even larger margin, yielding only Phalcon i to micro frameworks without ORM. </p><br><p><img src="http://i.imgur.com/nuWGciZ.png" alt="image"><br>  <a href="https://www.techempower.com/benchmarks/">A source</a> </p><br><p>  In the Plaintext test, it even overtakes the microframes: </p><br><p><img src="http://i.imgur.com/dC4IzJl.png" alt="image"></p><br><p>  Today, this is all, in the future, if you like it, wait for another article in this style.  And if you are interested in the framework itself or its components, go to chat with us in the chat. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/317498/">https://habr.com/ru/post/317498/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317484/index.html">How to teach a web application to speak 100 languages: localization features</a></li>
<li><a href="../317488/index.html">We start Gulp with votcher on a usual hosting through adminpanel</a></li>
<li><a href="../317490/index.html">Expansion of functionality of the mobile version and other changes on Habr√© and Giktatimes</a></li>
<li><a href="../317494/index.html">What is HTML5 streaming (and why mp4 streaming does not exist)</a></li>
<li><a href="../317496/index.html">Comparing tracking systems Affise, HasOffers and FuseClick</a></li>
<li><a href="../317500/index.html">Memo for seed investors</a></li>
<li><a href="../317504/index.html">Another article about Docker for a beginner [nginx + php-fpm + postgresql + mongodb]</a></li>
<li><a href="../317506/index.html">Small Business Stories - Shop in Voronezh</a></li>
<li><a href="../317508/index.html">VIDEO: Atlassian User Group is visiting 1C</a></li>
<li><a href="../317510/index.html">Intel Software Guard Extensions tutorial. Part 2, app device</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>