<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make an elephant out of a fly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many people know such an old kind game with words, to make an elephant out of a fly. Its essence is that you need to make the final one from the initi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make an elephant out of a fly</h1><div class="post__text post__text-html js-mediator-article">  Many people know such an old kind game with words, to make an elephant out of a fly.  Its essence is that you need to make the final one from the initial word, changing only one letter at each step, and at the same time getting a meaningful noun at each step. <br><br>  The well-known author of books on entertaining mathematics E. Ya. Gik in his book ‚Äú <a href="http://mathemlib.ru/books/item/f00/s00/z0000020/">Entertaining math games</a> ‚Äù published a 16-way solution, how to make an elephant from a fly: a fly-mura-tour-tara-kara-kare-cafe-kafr-kayur- Kayuk-hook-apricot-lesson-term-stock-moan-elephant. <br><br><img src="https://habrastorage.org/files/318/23d/27b/31823d27b8b6404386b1fb2811933e2d.gif" alt="fly and elephant">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so, one day I happened to take up the solution of this problem in software. <br><a name="habracut"></a><br><h2>  From an elephant fly, the first version </h2><br>  Honestly, an elephant from a fly came out pretty quickly. <br><br>  The general idea of ‚Äã‚Äãthe solution: <br>  - take a dictionary of nouns <br>  - iterative algorithm to go from the source word to the end, if it is possible to achieve the last <br>  - give the resultant chain, and it is desirable that it strives for the minimum length <br><br>  So‚Ä¶ <br><br><h3>  1) Dictionary of nouns </h3><br>  It turned out that even with the first item there are problems - finding a worthwhile dictionary of nouns turned out to be a separate subtask.  I do not remember where exactly, but I found a tolerable ready-made dictionary.  One word per line format, utf8, delimiters \ r \ n - and left it in the future. <br><br><h3>  2) Algorithm </h3><br>  Naturally, casually inquired whether the problem was solved by flies and elephants, and how.  A good solution was found here <a href="http://planetcalc.ru/544/">planetcalc.ru/544</a> .  For only 4 alphabetic words, under javascript (that in fact the idea is correct for this application - it makes no sense to drive server capacity, when client hardware in the browser can do the search).  However, the source did not look, but looked at the sound reasoning below in the article. <br><br>  Indeed, if one uses the construction of a tree with all variants as an algorithm, until the required word is found when laying the next level, then there will not be enough resources. <br><br>  For example, the word KORA has 19 transitions only from common words that have come to mind, from "mountain" to "court." <br><br>  Even if we give a very optimistic estimate for the average number of modifications in 5 (total!), Then if a minimum path to a word is 10 steps, then a tree of 5 <sup>10</sup> ~ = 10 million nodes should fit in the memory.  Considering the overhead of maintaining the tree structure (at least 2 pointers to descendants from the ancestor each are 4/8 bytes) and to the actual storage of node data (language / structure variable wrapper + data itself: characters in utf8 are even more than 10 bytes) we get The RAM requirement for such conditions is at least 200-300 MB.  And conditions can be much worse. <br><br>  <b>Genetic algorithm</b> selected. <br>  Moreover, he simply begs here - changing a letter in a word is essentially a mutation.  The condition of the survival of the descendant during the "birth" is the existence in the dictionary.  The condition of successful competition, fitness - the degree of similarity with the desired word. <br><br><div class="spoiler">  <b class="spoiler_title">Genetic search function word chain</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *          * *            * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $wordFrom -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $wordTo -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array       * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> WordWizardException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindMutationChain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($wordFrom, $wordTo, $maxSteps = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $maxPopulation = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">100</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $resultKeysChain = []; $resultChain = []; <span class="hljs-comment"><span class="hljs-comment">//        $wordFrom = mb_convert_case($wordFrom, MB_CASE_LOWER); $wordTo = mb_convert_case($wordTo, MB_CASE_LOWER); $fromLen = mb_strlen($wordFrom); $toLen = mb_strlen($wordTo); //      if ($fromLen != $toLen) { throw new WordWizardException("    ."); } //          $wordFromKey = binary_search($this-&gt;_dictionary, $wordFrom); //    ,  ,    $wordToKey = binary_search($this-&gt;_dictionary, $wordTo); if ($wordToKey &lt; 0) { throw new WordWizardException("  \"$wordTo\"    ."); } //    $mutationChains = [ [ 'keys' =&gt; [$wordFromKey], 'mutatedPositions' =&gt; [-1] ] ]; $population = 1; //      for ($step = 0; $step &lt; $maxSteps; $step++) { //      ? foreach ($mutationChains as $mutationChain) { if (end($mutationChain['keys']) == $wordToKey) { //     (  )  $resultKeysChain = $mutationChain['keys']; break 2; } } //    $newMutationChains = []; foreach ($mutationChains as $mutationChain) { $lastKey = end($mutationChain['keys']); $lastMutatedPos = end($mutationChain['mutatedPositions']); $lastWord = $this-&gt;_dictionary[$lastKey]; $nextMutations = $this-&gt;FindMutationVariants($lastWord, $wordTo, $fromLen, $lastMutatedPos, $mutationChain['keys']); foreach ($nextMutations as $mutation) { list($nextKey, $nextMutatedPos) = $mutation; $nextWord = $this-&gt;_dictionary[$nextKey]; $score = $this-&gt;GetWordScore($nextWord, $wordTo); //   $newMutationChain = $mutationChain; $newMutationChain['keys'][] = $nextKey; $newMutationChain['mutatedPositions'][] = $nextMutatedPos; $newMutationChain['score'] = $score; $newMutationChains[] = $newMutationChain; } } //      $mutationChains = $newMutationChains; //     .. if (empty($mutationChains)) { throw new WordWizardException("  $step (  $maxSteps)  .    ."); } //     " " (     ) usort($mutationChains, function($a, $b) { return $b['score'] - $a['score']; }); //   -    array_splice($mutationChains, $maxPopulation); } //   ? if ($step == $maxSteps) { throw new WordWizardException("     ($maxSteps),     ."); } //      if ($resultKeysChain) { foreach ($resultKeysChain as $key) { $resultChain[] = $this-&gt;_dictionary[$key]; } } return $resultChain; }</span></span></code> </pre> <br></div></div><br>  Fairly I took the <b>weight function</b> from the description on the same <a href="http://planetcalc.ru/544/">planetcalc.ru/544</a> .  I thought about why it is, for myself understood this: <br>  - the identity of the letters in the correct positions 3 points: No comment, the maximum score here is logical <br>  - vowel, albeit different, in the right position 2 points: The vowel in the right place is much harder to drag, but then it is using mutations of consonants, and there are more such options, it is easier to embarrass already in the right vowel.  In addition, the vowel ‚Äúsets the tone‚Äù - consonants spin around it more easily, including those necessary for the word being searched for. <br>  - the presence of a vowel in general 1 point: Similar reasoning with the above, the vowel is much more difficult to mutate than the consonants. <br><br>  Separately, I note that at all stages of the search the reference word, which should be obtained and with which there is a constant comparison, is one and the same.  For example, the same <i>elephant</i> .  Therefore, it is logical in such an anatomical form that it is ‚Äúlogical to disassemble an elephant that has been taken apart into pieces for comparing an elephant‚Äù (a poor animal). <br><br>  For simplicity and without thinking twice, I built the simplest cache right in the evaluation function. <br><br><div class="spoiler">  <b class="spoiler_title">The function of assessing the similarity of a pair of words</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $word -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $comparationWord -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWordScore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($word, $comparationWord)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    -       , -   static $cachedComparationWord = ''; static $wordLen = 0; static $cwLetters = []; if ($cachedComparationWord != $comparationWord) { $cachedComparationWord = $comparationWord; $wordLen = mb_strlen($comparationWord); $cwLetters = []; for ($i = 0; $i &lt; $wordLen; $i++) { $letter = mb_substr($comparationWord, $i, 1); $cwLetters[$i] = [ 'letter' =&gt; $letter, 'isVovel' =&gt; false === mb_strpos($this-&gt;_vovels, $letter) ? false : true, ]; } } $score = 0; for ($i = 0; $i &lt; $wordLen; $i++) { $letter = mb_substr($word, $i, 1); //      = 3 if ($letter == $cwLetters[$i]['letter']) { $score += 3; continue; } $isVovel = (false === mb_strpos($this-&gt;_vovels, $letter) ? false : true); if ($isVovel) { if ($cwLetters[$i]['isVovel']) { //     = 2 $score += 2; } else { //    = 1 $score += 1; } } } return $score; }</span></span></code> </pre><br></div></div><br>  The search for <b>new variants of mutations</b> goes according to the dictionary and sub-vocabulary, starting from a given word.  At the same time there are several additional logical limitations. <br><br>  The first limitation is the valid letter positions for the mutation.  In fact, if at the last step we, for example, changed the 3rd letter, making the move ‚ÄúmuHa‚Äù - ‚Äúmuza‚Äù, then at the next step the mutation ‚Äúmuza‚Äù - ‚Äúmura‚Äù is meaningless.  After all, we are interested in the shortest possible chain.  And in this way, we obviously make an extra step, because you could immediately make the move of MuHa - MuRa.  Therefore, one of the parameters of the function is the position of the past mutation. <br><br>  The second limitation is the uniqueness of the words in the chain.  Explained too simply.  Suppose there is a chain "fly" - " <i>flour</i> " - "beech" - "borax" - "mura" - " <i>flour</i> " - "hand".  It is obvious that a piece of " <i>flour</i> " - "beech" - "borax" - "mura" was superfluous in the chain.  And even if it reaches the final desired "elephant", it is exactly the same, but the chain of unique words with ejected repetitions will be shorter.  It means better.  So such cycles because of repetitions, we do not need.  Therefore, one more of the parameters of the function of searching for variants of mutations is making an array of words (in this case, word id), which have already been used in the chain. <br><br>  The word length parameter is me on matches mb_strlen saved.  This is how the method was conceived as private, but for tests and tests it was published.  Do not let such things in production :) In any case, without covering checks. <br><br>  And the final word ... maybe some kind of human reflection, and maybe intuition, left the possibility of using it for later.  Yet it is logical to expect from the function of receiving a set of descendants of some kind depending on whom they should be similar to.  Nothing prevents you from doing the primary screening right here.  But for now - not used. <br><br><div class="spoiler">  <b class="spoiler_title">The function of obtaining possible mutations</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *    {id ,   }     * *          * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $wordFrom -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $wordTo -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $wordLen -    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $disabledMutationPos -    ,     (    ) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $excludedWordKeys -    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindMutationVariants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($wordFrom, $wordTo, $wordLen, $disabledMutationPos, $excludedWordKeys)</span></span></span><span class="hljs-function"> </span></span>{ $variants = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($mutPos = <span class="hljs-number"><span class="hljs-number">0</span></span>; $mutPos &lt; $wordLen; $mutPos++) { <span class="hljs-comment"><span class="hljs-comment">//    (    ,   . ) if ($mutPos == $disabledMutationPos) continue; //     $mutPos-  $wordBeginning = mb_substr($wordFrom, 0, $mutPos); $wordEnding = mb_substr($wordFrom, $mutPos + 1); //    if ($mutPos &lt; self::SUB_DICTIONARIES_MAX) { // ,       $subDictionary = $this-&gt;_subDictionaries[$mutPos + 1]; $pseudoWord = $wordBeginning . $wordEnding; $pseudoWordKey = binary_search($subDictionary, $pseudoWord, 0, NULL, [$this, 'SubDictionaryWordsCmp']); if ($pseudoWordKey &gt;= 0) { //  PHP          , //          $row = $subDictionary[$pseudoWordKey]; foreach ($row[self::_SDW_WORDS_KEYS] as $key) { //   -     if (in_array($key, $excludedWordKeys)) continue; $variants[$key] = [$key, $mutPos]; } } } else { //    -  ,        if ($mutPos == 0) { //     ,    //   ,     -     // (         ) $key = 0; } else { //         $key = binary_search($this-&gt;_dictionary, $wordBeginning); if ($key &lt; 0) { $key = -$key; } } //  for ($key; isset($this-&gt;_dictionary[$key]); $key++) { $word = $this-&gt;_dictionary[$key]; //  ,       if (mb_substr($word, 0, $mutPos) != $wordBeginning) { break; } //      (   ) if (mb_strlen($word) != $wordLen) { continue; } // ,     if (mb_substr($word, $mutPos + 1) != $wordEnding) { continue; } //   -     if (in_array($key, $excludedWordKeys)) continue; //  ,    $variants[$key] = [$key, $mutPos]; } } } return $variants; }</span></span></code> </pre><br></div></div><br><h3>  3) Work with a dictionary </h3><br>  The algorithm is good, but we have a source of data (words) in the form of a file, with which it is necessary to work effectively and a lot from the search algorithm. <br>  Yes, this dictionary file is sorted alphabetically in ascending order.  And it is not so gigantic, only about 1 MB, so that we can safely download it to work in the entire RAM. <br><br>  In this case, of course, it should be understood that in the "loaded and decomposed" into the data structure in the form of an array, depending on the language, the dictionary will occupy more memory.  For PHP 5.4 it turned out that the dictionary in the loaded form weighs about 6 MB. <div class="spoiler">  <b class="spoiler_title">Here too.</b> <div class="spoiler_text">  Looking ahead, the underclothes weigh even more. </div></div><br><br>  [Here is the first thought about the logical use of the database.  But I decided to try it first without her.] <br><br>  But: <br>  - in PHP array_search, stupid selector, tell him ‚Äúhey, the array is sorted, search binary‚Äù is not possible, there are no other suitable functions out of the box, you could not play with a crutch flip-keyexists and it was difficult to apply <br>  - even if there was a quick binary search function in a sorted array, there is a mask search problem with an embossed character. <br><br><h4>  3.1) Quick search in a sorted array of the first of non-unique values </h4><br>  The first is solved by the binary search bike for PHP.  I borrowed a ride from a friend, <a href="https://terenceyim.wordpress.com/2011/02/01/all-purpose-binary-search-in-php/">terenceyim.wordpress.com/2011/02/01/all-purpose-binary-search-in-php</a> . <br><br>  It should be noted that this version of binary search is the most common, arithmetic, suitable for working in a sorted array with sequential integer numbering (keys from 0 to N-1 for example). <br><br>  I used the truth not as it is, but modified the search.  In the case of an array of non-unique elements, the posik stopped at the first equal item to be found.  And I needed him to give the position of the very first key from the identical elements of the array.  The point is to simplify the subsequent algorithm, and when sorting out a set of equals, just follow the found key down the array. <br><br>  Example: we are looking for the MUA, there is an array (see below) [... 99-MS (t) ITEL, 100-MU (c) A, 101-MU (k) A, 102-MU (p) A, 103-MU ( r) A, 104-MU (x) A, 105-MU (p) AVEY, 106-MU (p) AVEYNIK ...] Ordinary binary search falls into the next iteration, say, into the key 102. The value of the element (MUA, is obtained from the word MURA ) is equal to the required (MUA, we are looking for descendants for MUHA) and this key would have come to us.  And then clutter the logic over and up and down.  The modified algorithm finds the very first one, the key 100, and then you can go successively down the array until the element == is searched for. <br><br><div class="spoiler">  <b class="spoiler_title">Modified binary search</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *      * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $a -   ( ) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $needle - ,   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $first -      () * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $last -      ( ) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $compare -  .     usort * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int *      . *   -(insert_index + 1). * insert_index     , *     ,   sizeof($a)   *    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binary_search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $a, $needle, $first = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $last = NULL, $compare = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'default_cmp'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($last === <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) { $last = count($a); } $lo = $first; $hi = $last - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($lo &lt;= $hi) { $mid = (int)(($hi - $lo) / <span class="hljs-number"><span class="hljs-number">2</span></span>) + $lo; $cmp = call_user_func($compare, $a[$mid], $needle); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($cmp &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $lo = $mid + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ($cmp &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $hi = $mid - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $hi = $mid - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//             $mid //       ,        . //return $mid; } } $cmp = call_user_func($compare, $a[$lo], $needle); return $cmp == 0 ? $lo : -($lo + 1); } /** *    * * @param mixed $a -   * @param mixed $b -   * @return int  : -1 , 0 , 1  */ function default_cmp($a, $b) { return ($a &lt; $b) ? -1 : (($a &gt; $b) ? 1 : 0); }</span></span></code> </pre><br></div></div><br><h4>  3.2) Auxiliary pseudowords dictionaries </h4><br>  Secondly, I figured that the ‚ÄúRAM would fully survive‚Äù and decided to do it through sub-dictionary.  Where the i-th sub-dictionary is built from the main dictionary with cutting out the i-th letter from a word.  Type MACHINE =&gt; (i = 2) MRYNA.  For such dictionaries, you can use the same binary search for cases of embossed letters in positions for which there are dictionaries. <br><br>  In the case when the embossed letter is too far from the beginning of the word, and there is no sub-dictionary for such a position, we proceed as follows: <br>  - in the main dictionary we are looking for ‚Äúnon-beat beginning‚Äù <br>  - from the position found, we simply go down through the array, until the element (word) begins as we search, has the required length and collects all of these words into variants, which end as it should. <br><br>  Since the search proceeds along a limited part of the dictionary, where the first position is determined by binary search at the start, even with three dictionaries, the search for a 4th letter and older is no longer a fatal bottleneck. <br><br>  An acceptable compromise on memory / speed was the use of 3-4 subloviers. <br><br>  <abbr title="Averaged passage 3 times on identical gland without the influence of external factors">The numbers</abbr> for the transformation "fly" - "elephant": <br><table><tbody><tr><th>  Configuration </th><th>  T download dictionaries </th><th>  T search </th><th>  T total </th><th>  Consumption of ram </th></tr><tr><td>  Main dictionary only </td><td>  0.02 sec </td><td>  137 sec </td><td>  137 sec </td><td>  6 MB </td></tr><tr><td>  1 subdiction </td><td>  0.61 sec </td><td>  16.40 seconds </td><td>  17.01 seconds </td><td>  25 MB </td></tr><tr><td>  2 subbooks </td><td>  1.20 seconds </td><td>  4.73 seconds </td><td>  5.93 seconds </td><td>  44 MB </td></tr><tr><td>  3 subbooks </td><td>  1.85 seconds </td><td>  2.72 seconds </td><td>  4.57 seconds </td><td>  62 MB </td></tr><tr><td>  4 subbooks </td><td>  2.42 seconds </td><td>  0.82 sec </td><td>  3.24 seconds </td><td>  79 MB </td></tr><tr><td>  5 sublovie </td><td>  2.98 seconds </td><td>  0.77 seconds </td><td>  3.75 seconds </td><td>  97 MB </td></tr></tbody></table><br>  Chain: "fly" - "Mura" - "wagon" - "handicap" - "bark" - "root" - "koan" - "clan" - "clone" - "elephant" (9 transitions) <br><br>  Of course, it is absolutely logical that the 5th sub-dictionary (where the 5th letter was removed from the words and turned out to be re-sorted) is not needed for the transformation of a 4-letter fly and an elephant, and is only a burden.  But let's look at another example: <br><br>  For comparison, the transformation from "pine" to "protein": <br>  - for 4 subloviers: download 2.41 seconds, search 1.07 seconds, total 3.48 seconds <br>  - for 5 sublovie: download 3.01 seconds, search 0.36 seconds, total 3.37 seconds <br><br>  Those.  The 5th sub-dictionary can be added except after optimizing the storage of dictionaries, caching, and algorithm.  And now it‚Äôs just extra consumption of RAM. <br><br>  But ... But "just somehow tolerably working option on the knee" did not suit me.  And I continued to improve the conversion of flies into elephants. <br><br>  <a href="https://yadi.sk/d/GBv5b3zckGADx">1st version</a> (PHP 5.4) <br><br><blockquote>  * <br>  * It would be nice to pause here to rest your eyes, a cup of coffee, and in that spirit <br>  * </blockquote><br><hr><br><br><img src="https://habrastorage.org/files/4ce/2fe/1a0/4ce2fe1a03444d56884377fe3f51e60e.jpg" alt="elephant fly"><br><br><blockquote>  Elephant lipstick painted ear <br>  The second, trunk, tail and now <br>  A pink fly flies in the bedroom, <br>  Humming and beating his head against the door. <br>  <a href="http://www.hohmodrom.ru/project.php%3Fprid%3D123337">kekc @ hohmodrom.ru</a> <br></blockquote><br><h2>  Version two </h2><br>  I combed a lot. <br>  Added checks. <br>  Added throwing exceptions instead of silently incomprehensible dying. <br>  Selected a config. <br>  I am ready to switch to the database - I rendered the data logic into a separate mapper. <br>  Etc.  on architecture. <br><br>  But this is not interesting.  The most interesting changes here are a parser, a randomness factor and an evaluation function based on the frequency characteristics of the letters. <br><br><h3>  1) Parser </h3><br>  I noticed that the source dictionary, though quite large, but for some reason there are not even some commonly used words.  And attention))) there <i>was no elephant</i> !  <i>There was an elephant</i> , an <i>elephant</i> was, and an elephant was oops.  Discrimination. <br><br>  Yes, for the fulfillment of the goal (to make an elephant out of a fly) for the first version, we had to google typical chain answers, make sure, surprisingly, that many words, again, are not in the dictionary, and add several pieces manually to the appropriate positions. <br><br>  [And yes, in this dictionary I stumbled for the first time (from the subsequent php sort cones, despite the correct locale for setlocale and mb_string) that the words in E were suddenly at the end of the dictionary.] <br><br>  I decided to correct this point by taking additional words, albeit not from a dictionary ready for technical use, but at least from where. <br>  A lot of links led to <a href="http://chyjik.narod.ru/index.htm">chyjik.narod.ru/index.htm</a> , but he suddenly found himself already some year into oblivion by the evil Yandex, who bought Narod.ru at one time and broke it in pursuit of ferting. <br><br>  But then the great <a href="http://chyjik.narod.ru/poisk.htm">web archive</a> helped, for which he thanks. <br><br>  He pumped out all that was, the whole preserved ‚Äúcrossword writer‚Äôs dictionary‚Äù, saved it in data / psrc /, wrote parse.php on a regular schedule (which he then corrected several times, because the site was with a person, it seems, MS Word was written, and were not completely identical in layout), - expanded the dictionary of percent by 50%. <br><br><h3>  2) Factor of chance </h3><br>  The chain was always the same, which is, in general, obvious.  To be able to "play" and "suddenly find better," he introduced the randomness factor on mt_rand into the evaluation function.  It became more interesting.  Sometimes new, shorter chains, which I had never guessed before, were really visible. <br><br>  Of course, there is a downside: for uncomfortable pairs, there is a search and does not find a chain.  Or is a little longer than usual.  But still the main case is quite stable. <br><br>  More specifically, the randomness is introduced ‚Äúvery slightly‚Äù - to the comparison function when organizing according to the fitness of the new generation - words having the same assessment of fitness began to be placed in a random order. <br><br><div class="spoiler">  <b class="spoiler_title">Random Items</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">//     " " (     ) usort($mutationChains, function($a, $b) { $diff = $b['score'] - $a['score']; return $diff ? $diff : mt_rand(-1, 1); });</span></span></code> </pre><br></div></div><br><h3>  3) Evaluation function </h3><br>  From MOON, ELEPHANT was quite lively and pretty, within 10 transitions. <br>  But (!) <br>  from the FLY the word SLOGH turned out ... obstinately transitions to 60-70 (!). <br>  But it is obvious that it should be only 1 longer than in the ELEPHANT.  Man is obvious.  No car, it is according to the algorithm.  Algorithm error.  Error evaluation function. <br><br>  I didn‚Äôt hide it a lot. <br><br>  It turned out well by 5 positions to shorten the chain with dubious changes in the alignment.  But this is not the result that is needed. <br>  Obviously, the problem was not solved with the summer of adjustment, I thought.  What's the matter.  What is the difference.  The difference in the last letter, yes, a fact.  There is a dream, and here is a word.  What these letters are so different that everything is so bad ... <br><br>  Right.  Frequency of use!  And according to the number of related mutations.  That is, ‚Äúa full hit on G = G‚Äù may be worse, or at least not much better for assessing ‚Äúfitness‚Äù than ‚Äúnot hit H, M, K, ...! = G‚Äù.  But, of course, it is much better than ‚Äúnot hits Y, b, y, ...! = G‚Äù. <br><br>  I took a table of frequencies of use of letters from the wiki.  <i>(In fact, this is not entirely correct, it is necessary to count the frequency according to the existing dictionary of nouns, but there would hardly be any cardinal differences).</i>  I drove as it is in the code.  It‚Äôs not very beautiful, yes, but it‚Äôs for now.  He cut the frequencies of letters into normalized arrays according to vowels and consonants, with normalization by the most commonly used vowel / consonant.  Rewrote the evaluation function.  THERE IS!  ELEPHANT + 1! <br><br>  Yes, and the ELEPHANT began to get another step or two faster. <br><br><div class="spoiler">  <b class="spoiler_title">Work with letter frequencies</b> <div class="spoiler_text">  At initialization: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//$this-&gt;_mprDictionary = null; $this-&gt;_mprDictionary = new DictionaryFileMapper(); $this-&gt;_vovels = ""; $this-&gt;LoadLetterFrequencies(); } private function LoadLetterFrequencies() { $this-&gt;_lettersFrequences = [ '' =&gt; 0.10983, '' =&gt; 0.08483, '' =&gt; 0.07998, '' =&gt; 0.07367, '' =&gt; 0.06700, '' =&gt; 0.06318, '' =&gt; 0.05473, '' =&gt; 0.04746, '' =&gt; 0.04533, '' =&gt; 0.04343, '' =&gt; 0.03486, '' =&gt; 0.03203, '' =&gt; 0.02977, '' =&gt; 0.02804, '' =&gt; 0.02615, '' =&gt; 0.02001, '' =&gt; 0.01898, '' =&gt; 0.01735, '' =&gt; 0.01687, '' =&gt; 0.01641, '' =&gt; 0.01592, '' =&gt; 0.01450, '' =&gt; 0.01208, '' =&gt; 0.00966, '' =&gt; 0.00940, '' =&gt; 0.00718, '' =&gt; 0.00639, '' =&gt; 0.00486, '' =&gt; 0.00361, '' =&gt; 0.00331, '' =&gt; 0.00267, '' =&gt; 0.00037, '' =&gt; 0.00013, ]; //         $this-&gt;_lettersFrequencesVovel = []; $this-&gt;_lettersFrequencesConsonant = []; foreach ($this-&gt;_lettersFrequences as $letter =&gt; $frequency) { if ($this-&gt;IsVovel($letter)) { $this-&gt;_lettersFrequencesVovel[$letter] = $frequency; } else { $this-&gt;_lettersFrequencesConsonant[$letter] = $frequency; } } // . //   ,     $maxFrequency = reset($this-&gt;_lettersFrequencesVovel); foreach ($this-&gt;_lettersFrequencesVovel as $letter =&gt; &amp;$frequency) { $frequency /= $maxFrequency; } $maxFrequency = reset($this-&gt;_lettersFrequencesConsonant); foreach ($this-&gt;_lettersFrequencesConsonant as $letter =&gt; &amp;$frequency) { $frequency /= $maxFrequency; } } /** *     * * @param string $letter -  * @return bool */ public function IsVovel($letter) { return false === mb_strpos($this-&gt;_vovels, $letter) ? false : true; }</span></span></code> </pre><br>  Evaluation function: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $word -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $comparationWord -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWordScore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($word, $comparationWord)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    -       , -   static $cachedComparationWord = ''; static $wordLen = 0; static $cwLetters = []; if ($cachedComparationWord != $comparationWord) { $cachedComparationWord = $comparationWord; $wordLen = mb_strlen($comparationWord); $cwLetters = []; for ($i = 0; $i &lt; $wordLen; $i++) { $letter = mb_substr($comparationWord, $i, 1); $cwLetters[$i] = [ 'letter' =&gt; $letter, 'isVovel' =&gt; false === mb_strpos($this-&gt;_vovels, $letter) ? false : true, ]; } } $score = 0; for ($i = 0; $i &lt; $wordLen; $i++) { $letter = mb_substr($word, $i, 1); $isVovel = $this-&gt;IsVovel($letter); //      = 3 if ($letter == $cwLetters[$i]['letter']) { $score += 1; if ($isVovel) { $score += 2 + 1 * $this-&gt;_lettersFrequencesVovel[$letter]; } else { $score += 0 + 3 * $this-&gt;_lettersFrequencesConsonant[$letter]; } continue; } if ($isVovel) { if ($cwLetters[$i]['isVovel']) { //     = 2 $score += 2 + 2 * $this-&gt;_lettersFrequencesVovel[$letter]; } else { //    = 1 $score += 2 * $this-&gt;_lettersFrequencesVovel[$letter]; } } else { if (isset($this-&gt;_lettersFrequencesConsonant[$letter])) { $score += 3 * $this-&gt;_lettersFrequencesConsonant[$letter]; } } } return round($score); }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> New numbers for the transformation "fly" - "elephant": </font></font><br><table><tbody><tr><th>  Configuration </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T download dictionaries </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T search </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T total </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Consumption of ram </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Main dictionary only </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.04 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 210 sec </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 210 sec </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9 MB </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 subdiction </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.98 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 26.16 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 27.14 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 42 MB </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2 subbooks </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.97 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9.97 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11.94 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 72 MB </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3 subbooks </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.98 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.72 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.70 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 102 MB </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 subbooks </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.97 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.37 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5.34 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 130 MB </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5 sublovie </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.96 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.30 seconds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.26 sec </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 158 MB </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chain: "fly" - "muna" - "mine" - "lina" - "lynn" - "lyon" - "zion" - "elephant" (7 transitions). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, the dictionary (from 0.68 MB to 1.03 MB, + 51%), and with it the dictionaries and the final zhor of the RAM. Combinatorics improved, and even though at each step mutations began to crumble more, which means they began to walk more slowly - the final goal, with reachability, began to be obtained faster, in a smaller number of steps. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, in terms of time, the search turned out not at all faster, even for 4 subloviers. One factor did not compensate for the other. Nevertheless, in essence, expanding the dictionary is an absolutely correct and necessary move to get closer to real combat conditions. And there are many other crossword dictionaries and dictionaries, including online ones, with which you can work to expand our vocabulary.</font></font><br><br> <a href="https://yadi.sk/d/45Z75QASkGLcf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2nd version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (same PHP 5.4).</font></font><br><br><blockquote>  * <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Generally, this task seems endless. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* And in this long road to perfection, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Perhaps, on this patch it is worth taking another smoke break.</font></font><br>  * </blockquote><br><hr><br><br><img src="https://habrastorage.org/files/94f/1b9/401/94f1b9401e1f4dcfb65e0fefc1c63b2c.jpg"><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A certain science activist </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOED ELEPHANT from the FLY: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inflated, inflated, The </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">people called </font><font style="vertical-align: inherit;">out to see </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">He wanted to surprise everyone ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, the elephant flew away!</font></font><br></blockquote><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Version three </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honestly, I expected more from the version. </font><font style="vertical-align: inherit;">Still, the base (it was MySQL 5.5 at hand) should, well, it should have provided a takeoff at least several times, if not by orders of magnitude.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1) Base and speed? </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apparently, in the version with files, I actually achieved the memcache effect ‚Äî a bunch of dictionaries in memory, and the algorithm, in general, is the same for both file and mysql versions. </font><font style="vertical-align: inherit;">In the construction of the base I think I think, all the necessary indices for the work have been affixed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The files themselves slowed me down only at the stage of loading them into the RAM - about 4 seconds. </font><font style="vertical-align: inherit;">And the search from a molehill was about 0.8 seconds. </font><font style="vertical-align: inherit;">So overall, the MySQL version wins, with a ‚Äúload‚Äù of about 0.002 seconds and a search of about 0.95 seconds. </font><font style="vertical-align: inherit;">It‚Äôs clear that she doesn‚Äôt need to download anything, after one or two past script downloads, the cache is warm and everything is already loaded and waiting.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base structure</font></font></b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- --  : `metagram` -- -- -------------------------------------------------------- -- --   `dictionary` -- CREATE TABLE IF NOT EXISTS `dictionary` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(255) NOT NULL, `lang` varchar(30) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `name` (`name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ; -- -------------------------------------------------------- -- --   `word` -- CREATE TABLE IF NOT EXISTS `word` ( `id` int(11) NOT NULL AUTO_INCREMENT, `value` varchar(50) NOT NULL, `description` varchar(255) DEFAULT NULL, `dictionary_id` int(11) NOT NULL, `length` smallint(6) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `value` (`value`), KEY `dictionary_id` (`dictionary_id`), KEY `lenght` (`length`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ; -- -------------------------------------------------------- -- --   `word_pseudo` -- CREATE TABLE IF NOT EXISTS `word_pseudo` ( `id` int(11) NOT NULL AUTO_INCREMENT, `value` varchar(50) NOT NULL, `word_id` int(11) NOT NULL, `deleted_symbol_pos` smallint(6) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `value_word_id` (`deleted_symbol_pos`,`value`,`word_id`), KEY `word_id` (`word_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT= 1 ;</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anyway, the answer in 1 second is better than in 5 seconds. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2) Caching an obvious bottleneck </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initially, however, it was under 2 seconds, because of the plentiful SELECT queries, the word software id. </font><font style="vertical-align: inherit;">Aggressive caching in the MySQL mapper eliminated this problem. </font><font style="vertical-align: inherit;">Also, of course, not in an optimal way, but this is still not a highload production, but an experiment. </font><font style="vertical-align: inherit;">It is quite tolerant at this stage.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somewhere in the DictionaryMysqlMapper class</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"> ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_cachedWords; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_cachedWordKeys; ... <span class="hljs-comment"><span class="hljs-comment">/** *        * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key  ()  * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string|false|null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_cachedWords[$key])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_cachedWords[$key]; } $wordRow = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;FetchOne(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM `word` WHERE `id` = "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;QuoteValue($key)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_cachedWords[$key] = $wordRow[<span class="hljs-string"><span class="hljs-string">'value'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $wordRow[<span class="hljs-string"><span class="hljs-string">'value'</span></span>]; }</code> </pre><br></div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3) Tuning population size </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And by the way, as a result of the excellently shown evaluation function taking into account the frequencies of the letters, it was possible to reduce the population number in the generation from 100 to 50 without affecting the result. </font><font style="vertical-align: inherit;">By the way, even the population of 20 showed itself not much worse, but left 50. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This made it possible to significantly reduce the search time. </font><font style="vertical-align: inherit;">For example, the same flies and elephants from about 1 second to 0.5-0.6 seconds.</font></font><br><br>  So, <br><br> <a href="https://yadi.sk/d/LW_gPhHKkGLdJ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3rd version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Again PHP 5.4, but already with MySQL 5.5)</font></font><br><br><blockquote>  * <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Here, the article itself, according to the raised problem and scope, has become ‚Äúout of a fly an elephant‚Äù) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* It's time to sum up.</font></font><br>  * </blockquote><br><hr><br><br><img src="https://habrastorage.org/files/7fe/906/692/7fe90669246d4c19bf5054aa13f4cd8e.jpg" alt="Polite Elephant, R. Mucha"><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An elephant came out on a forest path, </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Came on an ant on a leg </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And politely </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Very </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Told an ant: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- You can </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step on mine! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) </font></font><a href="http://www.labirint.ru/books/434340/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rinat Mucha, "Polite Elephant"</font></font></a> <br></blockquote><br><br><h2>  Results </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the third step, we have a solution for PHP 5.4 + MySQL 5.5, which requires about 0.5 seconds. </font><font style="vertical-align: inherit;">to turn a fly into an elephant in 9 iterations:</font></font><br><br><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">'from'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'to'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'runMode'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"MySQL"</span></span> <span class="hljs-string"><span class="hljs-string">'list'</span></span> ... <span class="hljs-string"><span class="hljs-string">'0'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'3'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'4'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'5'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'7'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'8'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">'timeLoad'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">",  : 0,008000 ."</span></span> <span class="hljs-string"><span class="hljs-string">'time'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"   : 0,551032 ."</span></span> <span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"."</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The script does not consume as much horse operation as in the version with pure PHP and dictionary files (under 100 MB), the consumption is the most usual. </font><font style="vertical-align: inherit;">The same data stored in the DBMS, behave more decently for memory appetites.</font></font><br><br><h2>  What's next? </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, the solution is not perfect, I know. </font><font style="vertical-align: inherit;">Much more can be done:</font></font><br><br><ul><li>        ,       :         ,             .     ,         2-4 . ,    ,            . </li><li>    ?       .      .          , ‚Äî .   .     , ,   . </li><li> Redis? Memcached? </li><li>        N   ,        </li><li>   ?     ,     .           . </li><li> CP1251? Utf-8   .        ,       ,       ,     .  1        ,   2     .   . </li><li> JavaScript ?     ,  ,    ‚Äî     ,      ,  . </li><li>    C++? </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And certainly other moves that have not yet occurred to the head. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The theme is addictive ... Maybe the story will have a sequel. </font><font style="vertical-align: inherit;">In any case, I was hooked strongly, no less than </font></font><a href="http://habrahabr.ru/post/111538/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diamond-Square</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  <b>PS:</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, in this article it is impossible not to leave a link to </font></font><a href="http://habrahabr.ru/post/88327/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how artists make an elephant out of a fly</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comments and comments are welcome! </font><font style="vertical-align: inherit;">Maybe missed some simple and important things. </font><font style="vertical-align: inherit;">Thank you for attention.</font></font></div><p>Source: <a href="https://habr.com/ru/post/270845/">https://habr.com/ru/post/270845/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270829/index.html">Development and debugging of applications for Android Wear</a></li>
<li><a href="../270837/index.html">Embedding Addictions in Angular 2</a></li>
<li><a href="../270839/index.html">Class Requests at InterSystems Cach√©</a></li>
<li><a href="../270841/index.html">Cisco ipsec tunnel without using crypto map</a></li>
<li><a href="../270843/index.html">Digest of the game industry: October</a></li>
<li><a href="../270847/index.html">JS Programming Contest: Email Filters</a></li>
<li><a href="../270849/index.html">An example of solving a typical OOP problem in the Go language</a></li>
<li><a href="../270851/index.html">Moscow Python Meetup ‚Ññ30</a></li>
<li><a href="../270855/index.html">Development of 2D games on Windows, Mac OS, Linux and Android without programming. Part 2</a></li>
<li><a href="../270857/index.html">Semantic technologies are simple and accessible by the example of pedigrees.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>