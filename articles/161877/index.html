<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a link resolution plugin for PhpStorm (IntelliJ IDEA)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work as a web programmer, write in PHP and use the Kohana framework. For development I use the amazing, in my opinion, PhpStorm environment. 

 When...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a link resolution plugin for PhpStorm (IntelliJ IDEA)</h1><div class="post__text post__text-html js-mediator-article">  I work as a web programmer, write in PHP and use the Kohana framework.  For development I use the amazing, in my opinion, PhpStorm environment. <br><br>  When working with large and not very projects, I was always depressed that I spent a lot of time navigating the project, searching for a particular file (controller or template) in the project tree.  Ctrl + Shift + N, unfortunately, is not always convenient. <br><br>  To begin with, I wanted to make it so that you could go from the controller file by pressing Ctrl + B (or Ctrl + Click) above the name of the template passed to the Cohanov View :: factory () directly into the template file: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/9eb/613/396/9eb6133969216f3034eccc13ae20e89b.png"><br><br>  So I decided to write a small plugin for PhpStorm that would facilitate my work and free me from some part of the routine. <br><br><a name="habracut"></a><br><br><h4>  Environment preparation </h4><br>  We will need: <br>  - <a href="http://www.jetbrains.com/idea/download/">IntelliJ IDEA</a> Community Edition or Ultimate. <br>  - <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7u9-downloads-1859576.html">JDK</a> (you need to download the version from which PhpStorm is built, otherwise the plugin will not start, in my case it was Java 1.6); <br><br>  Since the <a href="http://confluence.jetbrains.net/display/IDEADEV/PluginDevelopment">documentation for creating</a> IDEA <a href="http://confluence.jetbrains.net/display/IDEADEV/PluginDevelopment">plug-ins is</a> very scarce, it is also recommended to get a copy <a href="http://www.jetbrains.org/display/IJOS/Download">of Intellij IDEA source codes</a> , and use it as visual documentation :) <br><br><h5>  Tool setting: </h5><br><br>  You must configure the Java SDK and IntelliJ IDEA Plugin SDK: <br>  - we start IntelliJ IDEA <br>  - open the menu item File |  Project Structure <br>  - select the SDKs tab, click on the plus sign and choose the path to the JDK <br><br>  - select the Project tab <br>  - click on new, then IntelliJ IDEA Plugin SDK and in the menu that opens - choose the path to PhpStorm (you can go to IntelliJ IDEA, but then we will not be able to debug the plugin in PhpStorm) <br><br><img src="https://habrastorage.org/storage2/af0/a9f/b3e/af0a9fb3e12ae5f5145bf6c1e44b248c.png"><br>  You also need to create a Run / Debug Configuration so that you can debug the plugin in PhpStorm. <br><br><h5>  Create a project </h5><br>  File |  new project: Select "Create from scratch", Enter the name, select the type of Plugin Module, select the SDK that we configured earlier, create the project. <br><br>  Add pathetic copyrights to the plugin.xml file (without this in any way!) <br><br><pre><code class="java hljs">&lt;name&gt;KohanaStorm&lt;/name&gt; &lt;description&gt;KohanaStorm framework integration <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> PhpStorm&lt;br/&gt; Authors: zenden2k<span class="hljs-meta"><span class="hljs-meta">@gmail</span></span>.com &lt;/description&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">0.1</span></span>&lt;/version&gt; &lt;vendor url=<span class="hljs-string"><span class="hljs-string">"http://zenden.ws/"</span></span> email=<span class="hljs-string"><span class="hljs-string">"zenden2k@gmail.com"</span></span>&gt;zenden.ws&lt;/vendor&gt; &lt;idea-version since-build=<span class="hljs-string"><span class="hljs-string">"8000"</span></span>/&gt;</code> </pre> <br><br>  In order for our plugin to be launched not only under IDEA, but also in PhpStorm, we add the following dependency in plugin.xml: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>com.intellij.modules.platform<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  The basics </h4><br>  For each file, IntelliJ IDEA builds a PSI tree. <br><br>  PSI (Program Structure Interface) is a structure that represents the contents of a file as a hierarchy of elements of a particular programming language.  PsiFile is a common parent class for all PSI files, and specific programming languages ‚Äã‚Äãare represented as classes inherited from PsiFile.  For example, the PsiJavaFile class represents a java file, the XmlFile class represents an XML file.  The PSI tree can be viewed using the PSI Viewer tool (Tools -&gt; View PSI Structure): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c1a/9b6/73e/c1a9b673e5024fe5796f5be2811e0df7.png" alt="image"><br><br><h4>  Plugin development </h4><br>  So, I wanted to be able to go from the controller file by Ctrl + B (or Ctrl + Click) via View :: factory ('template_name') directly to the template file. <br><br><img src="https://habrastorage.org/storage2/9eb/613/396/9eb6133969216f3034eccc13ae20e89b.png"><br><br><h4>  How to implement your plans? </h4><br><br>  To resolve links, we need to create 3 classes inherited from: <br><br>  <b>PsiReference</b> - an object that implements this interface is a link.  It contains data on the location in the parent element (position in the text) and data (link text), allowing further "to allow the link."  The link should be able to resolve itself, i.e.  her resolve () method must be able to find the element to which it points. <br><br>  <b>PsiReferenceProvider</b> is a class that finds links inside a single PSI element of a tree.  It returns an array of PsiReference objects. <br><br>  <b>PsiReferenceContributor</b> is the class that will register our PsiReferenceProvider as a PSI item handler. <br><br><h6>  1. Create a reference class MyReference that implements the PsiReference interface, and override the following methods in it </h6><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyReference</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PsiReference</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TextRange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRangeInElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textRange; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleElementRename</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String newElementName)</span></span></span><span class="hljs-function"> } </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindToElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IncorrectOperationException </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isReferenceTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resolve() == element; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[] getVariants() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSoft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCanonicalText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br><br>  In this class, the most important is the resolve () method.  In it we have to return those elements to which our link points.  In our case, we return a link to the php file, but in general it can be any element of the psi- tree or language model above it, for example, class, method, variable, etc. <br><br><h6>  2. Create a class inherited from <b>PsiReferenceProvider</b> and override the <b>getReferencesByElement</b> method: </h6><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyPsiReferenceProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PsiReferenceProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PsiReference[] getReferencesByElement(<span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> PsiElement element, <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ProcessingContext context) { } }</code> </pre><br><br>  The <b>getReferencesByElement</b> method should return a list of references ( <b>PsiReference</b> ) that are contained in the <b>PsiElement</b> element <b>passed to it</b> .  In our case, only one link is returned, but in general there may be several, and each link will have to contain a corresponding textRange (starting index and ending index for finding the link within the text of the psi element) <br><br>  The main problem with the development of this method was that JetBrains did not open access to the language API (in our case, PHP).  But here came the help of Reflection.  What do we know about the element object?  That it must be an instance of the StringLiteralExpressionImpl class. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PsiReference[] getReferencesByElement(<span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> PsiElement element, <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ProcessingContext context) { Project project = element.getProject(); PropertiesComponent properties = PropertiesComponent.getInstance(project); String kohanaAppDir = properties.getValue(<span class="hljs-string"><span class="hljs-string">"kohanaAppPath"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/"</span></span>); VirtualFile appDir = project.getBaseDir().findFileByRelativePath(kohanaAppDir); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (appDir == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PsiReference.EMPTY_ARRAY; } String className = element.getClass().getName(); Class elementClass = element.getClass(); <span class="hljs-comment"><span class="hljs-comment">// ,     StringLiteralExpressionImpl if (className.endsWith("StringLiteralExpressionImpl")) { try { //   getValueRange,    ,      Method method = elementClass.getMethod("getValueRange"); Object obj = method.invoke(element); TextRange textRange = (TextRange) obj; Class _PhpPsiElement = elementClass.getSuperclass().getSuperclass().getSuperclass(); //   getText,    PHP- Method phpPsiElementGetText = _PhpPsiElement.getMethod("getText"); Object obj2 = phpPsiElementGetText.invoke(element); String str = obj2.toString(); String uri = str.substring(textRange.getStartOffset(), textRange.getEndOffset()); int start = textRange.getStartOffset(); int len = textRange.getLength(); // ,     PHP- (  )   if (uri.endsWith(".tpl") || uri.startsWith("smarty:") || isViewFactoryCall(element)) { PsiReference ref = new MyReference(uri, element, new TextRange(start, start + len), project, appDir); return new PsiReference[]{ref}; } } catch (Exception e) { } } return PsiReference.EMPTY_ARRAY; }</span></span></code> </pre><br><br>  To determine that we did not just catch the PHP literal, but the string passed exactly in View :: factory (), we again use reflection magic: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isViewFactoryCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ PsiElement prevEl = element.getParent(); String elClassName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { elClassName = prevEl.getClass().getName(); } prevEl = prevEl.getParent(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { elClassName = prevEl.getClass().getName(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elClassName.endsWith(<span class="hljs-string"><span class="hljs-string">"MethodReferenceImpl"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Method phpPsiElementGetName = prevEl.getClass().getMethod(<span class="hljs-string"><span class="hljs-string">"getName"</span></span>); String name = (String) phpPsiElementGetName.invoke(prevEl); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.toLowerCase().equals(<span class="hljs-string"><span class="hljs-string">"factory"</span></span>)) { Method getClassReference = prevEl.getClass().getMethod(<span class="hljs-string"><span class="hljs-string">"getClassReference"</span></span>); Object classRef = getClassReference.invoke(prevEl); PrintElementClassDescription(classRef); String phpClassName = (String) phpPsiElementGetName.invoke(classRef); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phpClassName.toLowerCase().equals(<span class="hljs-string"><span class="hljs-string">"view"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br><br>  To make it clearer what we are dealing with, the picture: <br><img src="https://habrastorage.org/storage2/26a/d85/ed2/26ad85ed2bc6ce6a855b4dc9e9221f14.png"><br>  This code determines that our element is really nested in the method call (MethodReference), which is called ‚Äúfactory‚Äù and is in the ‚Äúview‚Äù class. <br><br><h6>  3. Create a class inherited from <b>PsiReferenceContributor</b> and override the following method: </h6><br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerReferenceProviders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiReferenceRegistrar registrar)</span></span></span><span class="hljs-function"> </span></span>{ registrar.registerReferenceProvider(StandardPatterns.instanceOf(PsiElement.class), provider); }</code> </pre><br><br>  All that our class does is register our PsiReferenceProvider in a certain registry, and set a template, to which type (subclass) of PsiElement it should be applied.  If the element of the document we need was, say, the value of an XML attribute, everything would be simpler: <br><br><pre> <code class="java hljs"> registrar.registerReferenceProvider(StandardPatterns.instanceOf(XmlAttributeValue.class), provider);</code> </pre><br><br>  But since JetBrains did not open access to the language API (in our case, PHP), we have to subscribe to absolutely all elements of PsiElement in order to then dynamically determine whether this element is needed or not. <br><br><h6>  4. Register the Contributor in the plugin.xml file: </h6><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultExtensionNs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.intellij"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">psi.referenceContributor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">implementation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyPsiReferenceContributor"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h4>  Create a settings page </h4><br><br><img src="https://habrastorage.org/storage2/88f/ffd/fb7/88fffdfb71f440796f9338130a8a1978.png"><br><br>  In phpstorm settings are of two types - related to the project and global.  To create a settings page for our plugin, create a class KohanaStormSettingsPage that implements the Configurable interface.  The getDisplayName method should return the name of the tab that will appear in the list of PhpStorm settings.  The createComponent method should return our form.  In the apply method, we must save all the settings. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KohanaStormSettingsPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configurable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JTextField appPathTextField; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JCheckBox enableKohanaStorm; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JTextField secretKeyTextField; Project project; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KohanaStormSettingsPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Project project)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.project = project; } <span class="hljs-meta"><span class="hljs-meta">@Nls</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDisplayName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"KohanaStorm"</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> JComponent </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ JPanel panel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JPanel(); panel.setLayout(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BoxLayout (panel, BoxLayout.Y_AXIS)); JPanel panel1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JPanel(); panel1.setLayout(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BoxLayout(panel1, BoxLayout.X_AXIS)); enableKohanaStorm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JCheckBox(<span class="hljs-string"><span class="hljs-string">"Enable Kohana Storm for this project"</span></span>); ... PropertiesComponent properties = PropertiesComponent.getInstance(project); appPathTextField.setText(properties.getValue(<span class="hljs-string"><span class="hljs-string">"kohanaAppPath"</span></span>, DefaultSettings.kohanaAppPath)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> panel; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ConfigurationException </span></span>{ PropertiesComponent properties = PropertiesComponent.getInstance(project); properties.setValue(<span class="hljs-string"><span class="hljs-string">"kohanaAppPath"</span></span>, appPathTextField.getText()); properties.setValue(<span class="hljs-string"><span class="hljs-string">"enableKohanaStorm"</span></span>, String.valueOf(enableKohanaStorm.isSelected()) ); properties.setValue(<span class="hljs-string"><span class="hljs-string">"kohanaStormSecretKey"</span></span>, secretKeyTextField.getText()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isModified</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHelpTopic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disposeUIResources</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br><br>  Register our settings page in the plugin.xml file: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defaultExtensionNs</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.intellij"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">psi.referenceContributor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">implementation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyPsiReferenceContributor"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">projectConfigurable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">implementation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"KohanaStormSettingsPage"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">projectConfigurable</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  (if we had a global settings page, we would use applicationConfigurable) <br><br><h5>  Storage settings </h5><br>  The least confusing way to store settings for a plugin is to use the PropertiesComponent class and the setValue and getValue methods.  <a href="http://confluence.jetbrains.net/display/IDEADEV/Persisting%2BState%2Bof%2BComponents">A more complicated way is</a> described in the documentation. <br><br><h5>  Plug-in installation </h5><br>  After the plugin development is complete, you must complete <br>  Build -&gt; Prepare plugin for deployment.  After that, a file with the name jar will appear in the project folder, which can be distributed. <br>  You can install it in phpstorm by running (File-&gt; Settings-&gt; Plugins-&gt; Install From Disk) <br><br>  <a href="">Download plugin and source codes</a> </div><p>Source: <a href="https://habr.com/ru/post/161877/">https://habr.com/ru/post/161877/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161861/index.html">Evolution of Zeus. Part II</a></li>
<li><a href="../161863/index.html">STM32 + linux</a></li>
<li><a href="../161865/index.html">Windows Store opened in Ukraine</a></li>
<li><a href="../161867/index.html">‚ÄúQuote‚Äù button for iOs</a></li>
<li><a href="../161875/index.html">Simple technique Parallax Scrolling</a></li>
<li><a href="../161879/index.html">Video: Mom first tests Windows 8, Ubuntu 12.10, Windows 1.0, Windows 3.1, Linux Mint Cinnamon 14, OSX 10.2, Elementary OS Luna, Kubuntu, Zorin OS 6.1, MS-DOS 6.22 and Microsoft Bob!</a></li>
<li><a href="../161881/index.html">Stallman called Ubuntu "spyware"</a></li>
<li><a href="../161883/index.html">Superparol concept - as additional protection for web-based email accounts</a></li>
<li><a href="../161885/index.html">Unofficial guide to the brain of Rich Hickey</a></li>
<li><a href="../161887/index.html">3D chess on HTML / CSS3 / JS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>