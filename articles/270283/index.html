<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internal Adobe Flash Player Update Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 The authorities have set the task: you need to keep the Flash Player up to date. Scales: ~ 15,000 computers, half of which need FP. 

 It...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internal Adobe Flash Player Update Server</h1><div class="post__text post__text-html js-mediator-article"><h3>  Prehistory </h3><br>  The authorities have set the task: you need to keep the Flash Player up to date.  Scales: ~ 15,000 computers, half of which need FP. <br><br>  It would seem, what the problem is - we make the domain policy, we push the MSI package and we are happy ... But it was not there!  The structure of the company is highly distributed, i.e.  to remote points with a channel of ~ 1 Mbps for 20 computers, the politicians even push through 15mb already a problem - in the morning the employees turn on the computer and wait half an hour for the download, until everything is downloaded and installed (or just fall off by timeout).  Not to mention the fact that computers in such offices have the unpleasant property of periodically falling out of the domain. <br><br>  It was necessary to have another solution that would work regardless of the politician, not to strain the user, to use the channel as little as possible (at least so that not everyone downloaded simultaneously).  <a href="http://habrahabr.ru/post/188116/">Options for scripts</a> for obvious reasons, too, did not fit. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Gained, as usual, Google: it turned out that you can raise the internal update server and configure the built-in FP update tool on it.  In this case, clients will only need to distribute the settings file.  Details under the cut. <br><a name="habracut"></a><br><h3>  Configuring the update server </h3><br>  1. <b>Get the license agreement</b> <br><br>  Adobe requires a license agreement to distribute its software.  We will not violate the terms of use and get a license (good, it's not difficult at all): <a href="https://distribute.adobe.com/mmform/index.cfm%3Fname%3Ddistribution_form%26pv%3Dfp">FlashPlayer: Adobe Runtimes / Reader Distribution License Agreement</a> .  The license will be valid for a year.  Upon expiration, you can send the request again. <br><br>  2. <b>Raise the web server</b> <br><br>  The platform does not play a role, in my case it spins the N-th site on IIS under Win2012.  It practically does not eat resources even though ~ 3000 computers are already configured on this server. <br><br>  Server Settings: <br><br><ul><li>  Access by ports 80, 443 (http, https respectively). <br>  The first one is needed, in fact, for downloading, the second FP will go for the XML version of the current version. </li><li>  Valid certificate https. <br>  I wrote out a certificate based on the root corporate, which by default is on all machines. </li><li>  Directory listing. <br>  I did not check the work without it - they ask in the documentation, I decided to do it as written. </li></ul><br>  I will not dwell on setting up the server. <br><br>  For clarity, let's call the server <code>FlashPlayerUpdate.domain.local</code> . <br><br>  3. <b>Download resources and upload to server.</b> <br><br>  At the root of the web server we create a directory tree: <code>/pub/flashplayer/update/current/sau/</code> . <br><br>  Directory tree on my server: <br><br><img src="https://habrastorage.org/files/a07/7f7/984/a077f79843ef45188a9a90fb75990240.png"><br><br>  If you have requested a license in the first step, then the reply should receive a letter with a link from where to download FlashPlayer - we follow this link.  If it didn‚Äôt come, or didn‚Äôt request it, then go here: <a href="https://www.adobe.com/products/flashplayer/distribution3.html">https://www.adobe.com/products/flashplayer/distribution3.html</a> and download the archive using the link ‚Äú <b>Download Background Update Resources</b> ‚Äù: <br><br><img src="https://habrastorage.org/files/8f6/aae/ace/8f6aaeacea814764924193afecb9c084.png"><br><br><div class="spoiler">  <b class="spoiler_title">Extended Support Release or Public Release</b> <div class="spoiler_text">  Here you need to make a remark.  On the page 2 options for downloads: standard (Public) and Extended Support Release.  In my case, stability is important and no new features are needed, so the ESR option was chosen.  At the same time, I added a certain amount of hemorrhoids to myself: the public version can be directly downloaded by the script from the Macromedia website.  How to pump out ESR, I didn‚Äôt google it, so in my case the content update on the internal server is done manually. <br><br>  At the end of the article I attached 2 PowerShell scripts: for automatic updating (only for the standard version; easily ported to bash), for checking updates and notifying by e-mail (for any version, including ESR). <br></div></div><br>  Unzip the downloaded archive to the <code>/pub/flashplayer/update/current/sau/</code> folder on the server. <br><br>  4. <b>Distribute the configuration file to customers</b> <br><br>  Depending on the capacity of the system: <br><br><ul><li>  32-bit: C: \ Windows \ <b>System32</b> \ Macromed \ Flash \ mms.cfg </li><li>  64-bit: C: \ Windows \ <b>SysWOW64</b> \ Macromed \ Flash \ mms.cfg </li></ul><br>  You can distribute it by any means.  I used a combination of domain policy and antivirus administration server (for computers that flew out of the domain). <br><br>  We include silent autoupdate in the file, set the update interval (in days), the path to our server, and just in case logging, so that it is easier to diagnose problems if they arise: <br><br><pre> <code class="bash hljs">AutoUpdateDisable=0 SilentAutoUpdateEnable=1 AutoUpdateInterval=2 SilentAutoUpdateServerDomain=FlashPlayerUpdate.domain.local SilentAutoUpdateVerboseLogging=1</code> </pre><br>  If everything was done correctly, then Flash Player on client machines should start updating according to the schedule (according to the above file above - once every 2 days).  Typically, the Adobe update service runs once an hour to check the update conditions ‚Äî at this time, Updater should see the configuration file, reconfigure updates according to the settings specified, and go to the new server to check the version. <br><br>  That is, about an hour after the distribution of the configuration file, you can watch the logs on the server for version checking requests. <br><br><h3>  Automation </h3><br>  As a classic representative of the IT fraternity, I can not stand the routine manual work and just could not help automate the process of checking and pumping out a new version.  However, as noted above, until I found a way to download the ESR versions from the Macromedia site, the script only checks for updates.  Suggestions are welcome. <br><br><h5>  Script to automatically download updates </h5><br>  <b>Only for the public version!</b> <br><br>  The logic of work: the script downloads the update files directly from Macromedia for versions 11,15,16,17,18,19 (if some version has already been removed from the site - the script just swears that it could not download and skip) and puts it from by replacing the update server.  No version checks.  At the testing stage, I used this script: I started it through the server on the server at night. <br><br>  If you wish, you can cross this script and the next one and get full automation with version checking, alerts and downloading only with updates. <br><br>  Script Parameters: <br><br><ul><li>  * <b>FPRoot</b> - path to the root folder of the update server.  Local, or network.  Naturally, the user from whom the script will be launched must have write access to this folder. </li><li>  <b>FPDownloadRoot</b> - the path to the Macromedia site.  It is set by default, but can be changed if necessary. </li><li>  <b>DownloadProxy</b> - proxy server, if used in the company.  Fully write: <b>http: //</b> proxy.domain.local. </li><li>  <b>ProxyCreds</b> - username for proxy authorization. </li><li>  <b>UserAgent</b> - to change the user agent with whom PowerShell will download.  For example, we have a restriction on UserAgents on a proxy, I go with an Internet Explorer agent. </li><li>  <b>Force</b> ‚Äî disable Invoke-Webrequest cmdlet certificate verification (more precisely, make all certificates trust). </li></ul><br>  * - required parameter <br><br>  Usage example: <br><br><pre> <code class="dos hljs">powershell.exe -command "&amp; '.\FPUpdater.ps1' -FPRoot '\\FlashPlayerUpdate\pub\flashplayer\update\current\sau' -DownloadProxy 'http://proxy.domain.local' -ProxyCreds 'DOMAIN\UserName' -UserAgent 'Mozilla/<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> (Windows NT <span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>; WOW64; Trident/<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>; rv:<span class="hljs-number"><span class="hljs-number">11</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) like Gecko'"</code> </pre><br>  All parameters can be hard-coded into the script if long startup lines are frightened. <br><br><div class="spoiler">  <b class="spoiler_title">Script code</b> <div class="spoiler_text">  <a href="">github.com/0-d/FPUpdate/blob/master/Get-FPUpdates.ps1</a> <br></div></div><br><br><h5>  Script to check for updates and e-mail alerts </h5><br>  Updates are checked for the standard version, but since they are updated at the same time (no one has canceled the security fixes), it will also be available for ESR.  For the script to work, you need to create the <code>CurrentPublic</code> file in the root of the web server (next to the <code>pub</code> folder), in which you <code>CurrentPublic</code> enter the current public version <u>for ActiveX</u> (the <u>ActiveX</u> version is <u>used</u> for testing). <br><br>  Work logic: the script compares the version obtained from the <code>CurrentPublic</code> file from your server with the version on the Macromedia server.  The version on the server is based on the auto-update logic: first, it looks in XML for the current major build, goes to the major folder, and it looks for the full build. <br><br>  Script Parameters: <br><br><ul><li>  * <b>FPIntServerRoot</b> - The address of our server.  For example: <code>FlashPlayerUpdate.domain.local</code> </li><li>  <b>FPDownloadRoot</b> - the path on the macromedia site.  It is set by default, but can be changed if necessary. </li><li>  <b>ESR</b> - check the ESR version (without this flag, it will check the public one). </li><li>  <b>DownloadProxy</b> - proxy server, if used in the company.  Fully write: <b>http: //</b> proxy.domain.local. </li><li>  <b>ProxyCreds</b> - username for proxy authorization. </li><li>  <b>UserAgent</b> - to change the user agent with whom PowerShell will download.  For example, we have a restriction on UserAgents on a proxy, I go with an Internet Explorer agent. </li><li>  <b>Force</b> ‚Äî disable Invoke-Webrequest cmdlet certificate verification (more precisely, make all certificates trust). </li><li>  * <b>MailTo</b> - e-mail addresses to which notifications will be sent. </li><li>  * <b>MailFrom</b> - from whom notifications will come.  For example: <code>FPUpdater@company.com</code> </li><li>  <b>SmtpServer</b> - smtp-server through which the message will be sent. </li></ul><br>  * - required parameter <br><br>  Usage example: <br><br><pre> <code class="dos hljs">.\FPCheckUpdate.ps1 -FPIntServerRoot 'fp-update.domain.local' -ESR -Proxy 'http://proxy.domain.local' -UserAgent InternetExplorer -Force -MailTo 'admin@company.com','support@company.com' -MailFrom 'FP@company.com' -SmtpServer 'smtp.company.com'</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Script code</b> <div class="spoiler_text">  <a href="">github.com/0-d/FPUpdate/blob/master/Check-FPUpdates.ps1</a> <br></div></div><br><h3>  Resources used </h3><br><ul><li>  <a href="http://www.cloudportal.org/2012/04/21/adobe-flash-11-2-background-updates-from-an-internal-server/">Adobe Flash 11.2 Background Updates from an Internal Server</a> </li><li>  <a href="http://www.adobe.com/devnet/flashplayer/articles/flash_player_admin_guide.html">Adobe Flash Player Administration Guide</a> </li></ul><br><br><br><h3>  UPD </h3><br>  Slightly late update from 06/17/16. <br><br>  Since writing this article, Adobe managed to change the order of access to the FlashPlayer download page 2 times.  As a result, now to get access to the page for download, you must first log in to your Adobe ID.  Those.  the option of parsing the page for the ESR version no longer rolls. <br><br>  Fooling around with authorization, getting-sending a cookie via PowerShell has not yet become.  As a result, I redid the script to check the ESR on the <a href="https://www.adobe.com/ru/products/flashplayer/distribution3.html">distribution3</a> page, which can disappear at any time.  While so, then we will see. <br><br>  At the beginning of the year I <a href="https://forums.adobe.com/message/8416802">asked a question on the Adobe forum</a> on the subject of checking for ESR version updates.  They promise to come up with something, but for now, it's still there. <br><br><h3>  UPD2 </h3><br>  The other day on the Flash Player distribution page (the link to which you received after receiving a license to distribute) the following information appeared: <br><blockquote><h4>  ATTENTION!  Important changes from Extended Support Release </h4><br><br>  Initially, the Extended Support Release was created with the goal of minimizing the time that IT administrators spend on certifying each new release. Flash Player: Extended Support Release limited the changes to the release to security changes and fixes for critical functional issues.  At that time, there were far more functional changes in each release of Flash Player than changes in the security system.  However, now the situation has changed: the number of proactive and security response measures far exceeds functional changes.  In practice, Extended Support Release no longer protects IT organizations from the huge number of changes made to the standard Flash Player releases, but only reduces functional risks.  <b>In this regard, it was decided to discontinue the Extended Support Release and concentrate on developing only standard releases.</b>  Focusing only on standard editions will allow us to be more flexible in adopting security response measures and continue to work on testing and new technical solutions in the field of security. <br><br>  To give organizations enough time for testing and certification, Extended Support Release will continue to be supported until <b>October 11, 2016</b> .  Organizations will then need to upgrade to the standard release. <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/270283/">https://habr.com/ru/post/270283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270265/index.html">How WiFi breaks loose, or Without wires and leads</a></li>
<li><a href="../270267/index.html">Sunrise developeromics</a></li>
<li><a href="../270269/index.html">Highly loaded java application</a></li>
<li><a href="../270273/index.html">Let's Encrypt: getting the certificate step by step</a></li>
<li><a href="../270281/index.html">Captain Awesome is broadcasting: BrowserSync Angular Template</a></li>
<li><a href="../270287/index.html">GDG DevFest Nizhny Novgorod 2015</a></li>
<li><a href="../270289/index.html">Java Gauss Method</a></li>
<li><a href="../270291/index.html">About Swift, and why my big projects will be on Objective-C for some (maybe long) time</a></li>
<li><a href="../270293/index.html">We create an interactive vector scheme of the Moscow metro</a></li>
<li><a href="../270295/index.html">Security Week 45: escape from the sandbox, bypassing EMET through WOW64, breaking into 000webhost</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>