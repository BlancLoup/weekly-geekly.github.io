<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Measuring Apache Ignite Cache Performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the previous articles in this series of reviews of the distributed Apache Ignite Java framework, we took the first steps , got acquainted with t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Measuring Apache Ignite Cache Performance</h1><div class="post__text post__text-html js-mediator-article">  After the previous articles in this series of reviews of the distributed <a href="https://ignite.apache.org/">Apache Ignite</a> Java framework, we took the <a href="https://habrahabr.ru/post/310334/">first steps</a> , got acquainted with the basic principles of <a href="https://habrahabr.ru/post/310464/">building topology,</a> and even <a href="https://habrahabr.ru/post/310672/">made a starter for Spring Boot</a> , inevitably raises the question of caching, which is one of the main functions of Ignite.  First of all, I would like to understand whether it is necessary when libraries for caching in Java and so full.  The fact that the implementation of the JCache standard (JSR 107) is provided and the possibility of distributed caching is difficult to surprise in our time.  Therefore, before (or instead of) considering the functionality of the Apache Ignite cache, I would like to see how fast it is. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/f21/2f0/301/f212f0301afe40d19ac43378944d260c.jpg"></div><br>  For the study used benchmark <a href="https://github.com/cache2k/cache2k-benchmark">cache2k-benchmark</a> , designed to prove that the <a href="http://cache2k.org/">cache2k</a> cache library is the fastest.  Here at the same time and check.  This article does not pursue the goal of comprehensive performance testing, or at least scientifically reliable, let the Apache Ignite developers do it.  We just look at the order of magnitude, the main features and the relative position in the ranking, which will also include cache2k and the native cache on ConcurrentHashMap. <br><a name="habracut"></a><br><h2>  Testing method </h2><br>  As part of the testing methodology, I did not reinvent the wheel, and took the one <a href="http://cruftex.net/2016/03/16/Java-Caching-Benchmarks-2016-Part-1.html">described for cache2k</a> .  It consists in comparing the performance of a number of standard operations using a <a href="http://openjdk.java.net/projects/code-tools/jmh/">JMH-</a> based library: <br><br><ul><li>  Filling cache in multiple threads </li><li>  Read-only performance </li></ul><br>  As a reference, the method considers the values ‚Äã‚Äãobtained for implementing a cache based on ConcurrentHashMap, since it is assumed that there is no place to be faster.  Accordingly, in all nominations the struggle goes for second place.  The cache2k-benchmark (hereinafter referred to as <b>CB</b> ) implements scripts for cache2k and several other providers: Caffeine, EhCache, Guava, Infinispan, TCache, as well as a native implementation based on ConcurrentHashMap.  <b>CB has</b> implemented other benchmarks, but we will limit ourselves to these two. <br><br>  The measurements were performed under the following conditions: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  JDK 1.8.0_45 </li><li>  JMH 1.11.3 </li><li>  Intel i7-6700 3.40Ghz 16Gb RAM </li><li>  Windows 7 x64 </li><li>  JVM flags: -server -Xmx2G </li><li>  Apache Ignite 1.7.0 </li></ul><br>  The work of the Apache Ignite cache was investigated in several modes, differing in topology (it is recommended <a href="https://habrahabr.ru/post/310464/">to recall the basic concepts of the Apache Ignite topology</a> ) and load distribution: <br><br><ul><li>  Local cache (cacheMode = LOCAL) on the server node; </li><li>  Distributed cache on 1 machine (cacheMode = PARTITIONED, FULL_ASYNC), server-to-server; </li></ul><br>  According to the <b>CB</b> requirements, the IgniteCacheFactory class was implemented (the <a href="https://github.com/kvmorozov/cache2k-benchmark">code is available in GitHub</a> , based on the <b>CB</b> fork).  The server and client are created with the following settings: <br><br><div class="spoiler">  <b class="spoiler_title">Server configuration</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ignite.cfg-server"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.ignite.configuration.IgniteConfiguration"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"gridName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"testGrid"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clientMode"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"peerClassLoadingEnabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cacheConfiguration"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.ignite.configuration.CacheConfiguration"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"testCache"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cacheMode"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LOCAL"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"statisticsEnabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"writeSynchronizationMode"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FULL_ASYNC"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"discoverySpi"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ipFinder"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.ignite.spi.discovery.tcp.ipfinder.multicast.TcpDiscoveryMulticastIpFinder"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addresses"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span>127.0.0.1:47520..47529<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">list</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localAddress"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localhost"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"communicationSpi"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.ignite.spi.communication.tcp.TcpCommunicationSpi"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localAddress"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"localhost"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  It is important that the cache settings for the client and server are the same. <br><br>  The server will be created from the command line outside the test using the same JVM with the options -Xms1g -Xmx14g -server -XX: + AggressiveOpts -XX: MaxMetaspaceSize = 256m, that is, I give it almost all memory.  Let's start the server and connect to it with a visor (refer to the <a href="https://habrahabr.ru/post/310464/">second article of the series</a> for details).  Using the <b>cache</b> command, we make sure that the cache exists and is pristine clean: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1b3/3f5/240/1b33f52403424a6987f0bd345b7d4367.JPG"></div><br>  With <b>CB</b> connect using class <br><br><div class="spoiler">  <b class="spoiler_title">Cache factory for benchmark</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgniteCacheFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BenchmarkCacheFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CACHE_NAME = <span class="hljs-string"><span class="hljs-string">"testCache"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IgniteCache cache; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Ignite ignite; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> IgniteCache </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIgniteCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ignite == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) ignite = Ignition.ignite(<span class="hljs-string"><span class="hljs-string">"testGrid"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) cache = ignite.getOrCreateCache(CACHE_NAME); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BenchmarkCache&lt;Integer, Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _maxElements)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyBenchmarkCache(getIgniteCache()); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBenchmarkCache</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BenchmarkCache</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class">&gt; </span></span>{ IgniteCache&lt;Integer, Integer&gt; cache; MyBenchmarkCache(IgniteCache&lt;Integer, Integer&gt; cache) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cache = cache; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIfPresent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Integer key)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache.get(key); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer key, Integer value)</span></span></span><span class="hljs-function"> </span></span>{ cache.put(key, value); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ cache.destroy(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCacheSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache.localSize(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStatistics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cache.toString() + <span class="hljs-string"><span class="hljs-string">": size="</span></span> + cache.size(); } } }</code> </pre><br></div></div><br>  Here we connect in client mode to our server and take the cache from it.  It is important to stop the client at the end of the test, otherwise the JMH swears that at the end of the test, there are still running threads - Ignite creates many of them for its operation.  Also please note that there is a time spent on deleting the cache after each iteration.  We will consider this as the cost of the research method, that is, we are not only looking at the performance of the cache itself, but also at the cost of administering it. <br><br><div class="spoiler">  <b class="spoiler_title">Benchmark class</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Benchmark) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IgnitePopulateParallelOnceBenchmark</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PopulateParallelOnceBenchmark</span></span></span><span class="hljs-class"> </span></span>{ Ignite ignite; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ignite == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) ignite = Ignition.start(<span class="hljs-string"><span class="hljs-string">"ignite/ignite-cache.xml"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@TearDown</span></span>(Level.Trial) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ignite != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ignite.close(); ignite = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } }</code> </pre><br></div></div><br><h2>  results </h2><br>  After building the project through mvn clean install, you can run tests, for example with the command <br>  java -jar &lt;BENCHMARK_HOME&gt; \ benchmarks.jar PopulateParallelOnceBenchmark -jvmArgs "-server -Xmx14G -XX: + UseG1GC -XX: + UseBiasedLocking -XX: + UseCompressedOops" -gc true -f 2 -wi -30 -xX: + UseCompressedOops "-gc true -f 2 r 30s -t 2 -p cacheFactory = org.cache2k.benchmark.thirdparty.IgniteCacheFactory -rf json -rff e: \ tmp \ 1.json.  JMH settings are taken from the original benchmark, we will not discuss them here.  The "-t 1" parameter indicates the number of threads we are working with the cache.  In memory, I pointed out 14Gb, just in case.  "-f 2" means that two forks of the JVM will rise for test execution, this contributes to a sharp decrease in the confidence interval (the error column in the JMH output). <br><br><h3>  Filling cache in multiple threads </h3><br>  First, run the test for Apache Ignite with cacheMode = LOCAL.  Since in this case there is no point in interacting with the server, we will raise the node for testing in server mode and will not connect to anyone.  The time it took to cache the numbers from 1 to 1 million, 2 million, 4 million, 8 million is measured.  For the number of threads 1, 4 and 8 (I have an 8-core processor), the results will be as follows: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/05f/98f/48c/05f98f48ca5a4223a40ab0427379ad26.JPG"></td><td><img src="https://habrastorage.org/files/869/afb/a2c/869afba2c7ef453bbad98bae7e7438a1.JPG"></td><td><img src="https://habrastorage.org/files/dcb/7ab/322/dcb7ab32265c4b25ab7caf5392836c79.JPG"></td></tr></tbody></table><br>  We see that if 4 streams are about 1 times faster than 1, then adding 4 more streams gives a gain of about 20%.  That is, non-linear scaling.  For comparison, let's see what ConcurrentHashMap and cache2k will show. <br><br>  ConcurrentHashMap: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/ba8/d51/f1c/ba8d51f1c2ae401da4253ee223cfaf54.JPG"></td><td><img src="https://habrastorage.org/files/78e/835/c0a/78e835c0a0894735a1a5ed9e34aaae72.JPG"></td><td><img src="https://habrastorage.org/files/5c9/c9f/3df/5c9c9f3dff3d43b7b25bffd0225a81b0.JPG"></td></tr></tbody></table><br>  cache2k: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/387/4f5/b4f/3874f5b4fbe64bd2aefa324e9467e448.JPG"></td><td><img src="https://habrastorage.org/files/c94/4a6/568/c944a6568b794c8d9e95413fdccfb1b7.JPG"></td><td><img src="https://habrastorage.org/files/2ae/d09/a5a/2aed09a5a21e45c89a1b8cf3df75da91.JPG"></td></tr></tbody></table><br>  Thus, in local mode, when inserting, the Ignite cache is about 10 times slower than ConcurrentHashMap and 4-5 times slower than cache2k.  Next, we will try to evaluate what kind of overhead cache partitioning between two server nodes on the same machine (that is, the cache will be divided in half) ‚ÄîIgnite developers took steps to make it not gigantic.  For example, they use their own serialization, which they say is 20 times faster than native.  During the execution of the test, you can see the visor, now it makes sense, we have a topology: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7ca/176/b16/7ca176b16ef545f0a3a7f6dba0dc3372.JPG"></div><br>  At the end we see these heart-rending numbers: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/69d/816/15d/69d81615d77844e1a021f9be19bd9a98.JPG"></div><br>  That is, cache partitioning was not very cheap, every 10 times it got worse.  The REPLICATED cache mode has not been investigated, data would be stored in it at both nodes. <br><br><h3>  Only reading </h3><br>  In order not to complicate the picture with a variety of parameters, we will conduct this test in 4 threads, run Ignite only locally.  Here we use <a href="">ReadOnlyBenchmark</a> .  The cache is filled with 100k entries and various randomly selected values ‚Äã‚Äãfrom it, with a different hit rate.  Measure the number of operations per second. <br><br>  Here is the Cache2k / ConcurrentHashMap / Ignite data: <br><table><tbody><tr><td><img src="https://habrastorage.org/files/079/4d0/773/0794d07736af4ca1b3e79d5816c76461.JPG"></td><td><img src="https://habrastorage.org/files/314/0f0/dbf/3140f0dbff7a4f558cea8e61acce4fdb.JPG"></td><td><img src="https://habrastorage.org/files/121/6fa/fb4/1216fafb4cb749efad705f03d3859cb2.JPG"></td></tr></tbody></table><br>  That is, Cache2k is 1.5-2.5 times worse than ConcurrentHashMap, and Ignite is 2-3 times worse. <br><br><h2>  findings </h2><br>  Thus, Ignite, to put it mildly, does not shake the speed of its caching.  I will try to answer in advance possible accusations: <br><br><ul><li>  <b>I just do not know how to cook it</b> , and if Ignite ottyunit, it will be better.  Well, everything, if ottyunit, will be better.  The work was investigated in the default configuration, in 90% of cases it will be the same in production; <br><br></li><li>  <b>Apples and bananas</b> , products of different classes, nails, microscope etc.  Although it was possible to compare it with something more sophisticated like the Inifinispan type, no one demanded the impossible from Ignite in this study; <br><br></li><li>  <b>Eliminate overhead</b> , <b>factor</b> out expensive operations to raise a node and create / delete a cache, reduce the hearthbeat frequency, etc.  But we are not measuring a horse in a vacuum ?; <br><br></li><li>  <b>This product is not intended for local use</b> , you need enterprise-equipment.  Perhaps, but this will only smear the whole overhead in topology, and here we saw it all at once.  During testing, %% CPU and memory never reached 100%; <br><br></li><li>  <b>This is the specific product.</b>  You can look at the results as very decent, given the incredible power of Ignite.  It is necessary to take into account that caching is carried out in another stream, through sockets, etc.  On the other hand, Ignite is different and does not have it. </li></ul><br>  Well, and so on.  In general, in my experience, Ignite should be used as an architectural framework for distributed applications, and not as a source of performance gain.  Although, perhaps, he is able to accelerate something else more inhibited.  IMHO, of course. <br><br>  I invite you to share your observations on the performance of Ignite. <br><br><h2>  Links </h2><br><ul><li>  <a href="http://cruftex.net/2016/03/16/Java-Caching-Benchmarks-2016-Part-1.html">Original testing methodology</a> </li><li>  <a href="https://github.com/kvmorozov/cache2k-benchmark">GitHub testing framework</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/311140/">https://habr.com/ru/post/311140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311128/index.html">.Net Core, exchange with 1C over TCP / IP between different devices</a></li>
<li><a href="../311130/index.html">UWP beginner: Responsive Design (VB.NET + C #)</a></li>
<li><a href="../311134/index.html">Locks aren't that slow.</a></li>
<li><a href="../311136/index.html">The Incredible Adventures of Aliens in Y Combinator</a></li>
<li><a href="../311138/index.html">Creating Babylon.js and WebGL based shaders: theory and examples</a></li>
<li><a href="../311142/index.html">Grouping Fancy Bear uses malware for OS X in cyber attacks</a></li>
<li><a href="../311144/index.html">We integrate messengers (using Slack as an example): GitHub, RSS (in particular, Java), jobs for your request</a></li>
<li><a href="../311146/index.html">Welcome to Spark ... on Java: Interview with Evgeny Borisov</a></li>
<li><a href="../311150/index.html">Analysis of the use of data redundancy as the required additional memory when sorting by the merge algorithm</a></li>
<li><a href="../311152/index.html">Truth born in the dispute about the ratings of popular programming languages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>