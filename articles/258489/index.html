<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenEMS modeling basics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last part it was described how to install and configure open-source electromagnetic simulator openEMS . Now you can go to the simulation. How t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenEMS modeling basics</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/post/255317/">last part</a> it was described how to install and configure open-source electromagnetic simulator <a href="http://openems.de/">openEMS</a> .  Now you can go to the simulation.  How to produce EMW modeling using openEMS and Octave will be discussed in this article. <br><br>  We will simulate the process of electromagnetic wave propagation (EMW) between two parallel metal plates. <br><br>  The configuration of the object is shown in the figure.  A rectangular source of EMW is assumed, from which EMW spreads in both directions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/4eb/1dc/dc5/4eb1dcdc5cf04bdf8ddbfdca4effe96b.png"><br><br>  Under the cut line-by-line analysis of the script for modeling such an object. <br><a name="habracut"></a><br>  As mentioned in the previous section, all openEMS simulations are Octave / Matlab scripts.  Run Octave / Matlab and enter the following commands.  First, we initialize the space.  We create a special FDTD object that describes the finite difference space in the time domain: <br><pre><code class="hljs lisp">FDTD = InitFDTD('NrTS',<span class="hljs-number"><span class="hljs-number">100</span></span>,'EndCriteria',<span class="hljs-number"><span class="hljs-number">0</span></span>,'OverSampling',<span class="hljs-number"><span class="hljs-number">50</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><br>  The function parameters are 100 time calculation points from zero.  The time calculation step is selected automatically based on the Nyquist frequency and the frequency of the source of the EMW.  Try to set a different number of points, for example 1000. <br><br>  Now we set the source of the EMW frequency of 10 MHz.  Here the function parameters are clear from the name. <br><br><pre> <code class="hljs lisp">FDTD = SetSinusExcite(<span class="hljs-name"><span class="hljs-name">FDTD</span></span>,<span class="hljs-number"><span class="hljs-number">10e6</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  For any simulation of EMW, boundary conditions are needed.  The boundary conditions describe the properties of the material, which is limited to spaces in the direction of each of the three axes of coordinates X, Y, Z.  The order of the boundary conditions in the parameters of the function is the following X +, X-, Y +, Y-, Z +, Z- We have a space along the Y axis in the positive direction limited by an ideal conducting surface (PEC - Perfect Electric Conductor), in a negative direction along the Y - also conductive surface.  PMC is perfect <br>  magnetic conductor.  MUR is an absolutely absorbing dielectric.  It approximately corresponds to the material of the walls of the anechoic chamber. <br><br><pre> <code class="hljs lisp">FDTD = SetBoundaryCond(<span class="hljs-name"><span class="hljs-name">FDTD</span></span>,{'PMC' 'PMC' 'PEC' 'PEC' 'MUR' 'MUR'})<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  A special multilayer material (PML_x) is also available for boundary conditions.  It can have from 6 to 20 layers (for example PML_8, PML_10).  This material also acts as an absorbing dielectric. <br><br>  After the boundary conditions are specified, we initialize the CSX space in which the geometry of our system will be specified. <br><pre> <code class="hljs lisp">CSX = InitCSX()<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  Now you need to create a grid.  Calculation of propagation of EMW will be performed inside the space bounded by the grid.  First, we set the grid dimension by coordinates (X * Y * Z = 20x20 * 40 meters). <br><pre> <code class="hljs">mesh.x = -10:10; mesh.y = -10:10; mesh.z = -10:30;</code> </pre><br><br>  Now we create the actual grid in rectangular coordinates using the function <br>  DefineRectGrid () and apply it to the geometry (the grid step is 1 meter): <br><br><pre> <code class="hljs lisp">CSX = DefineRectGrid(<span class="hljs-name"><span class="hljs-name">CSX</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,mesh)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  Next, create a source of EMW.  We set the amplitude of the electromagnetic wave and the direction of the vector of the electromagnetic wave.  To do this, use the AddExcitation function. <br><br><pre> <code class="hljs lisp">CSX = AddExcitation(<span class="hljs-name"><span class="hljs-name">CSX</span></span>,'excitation',<span class="hljs-number"><span class="hljs-number">0</span></span>,[<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>])<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  The first and second parameters of the function are the name of the CSX-space and the name of the source of EMW, respectively.  The third parameter of the function is the field type.  The following types are available: <br><ul><li>  0 - electric field (E), hard excitation </li><li>  1 - electric field (E), hard excitation </li><li>  2 - magnetic field (H), mild excitation </li><li>  3 - magnetic field (P), hard excitation </li><li>  10 - flat EMW </li></ul><br>  The difference between hard and soft excitation is that with hard excitation, the amplitude of the electromagnetic wave at a given point in space is set to a forced value, and with soft excitation, the superposition of the fields is calculated, that is, the electromagnetic wave is superimposed on the fields present at that point. <br><br>  The fourth parameter is a vector whose components set the amplitude of the electromagnetic wave in three directions X, Y, Z. <br><br>  Thus, we set the excitation by an electric field with an amplitude of 1 V / m in the direction of the Y axis. <br><br>  Now we create a platform (AddBox) with which the EMW will be distributed.  This site is actually the source of EMW. <br><pre> <code class="hljs lisp">CSX = AddBox(<span class="hljs-name"><span class="hljs-name">CSX</span></span>,'excitation',<span class="hljs-number"><span class="hljs-number">0</span></span>,[<span class="hljs-number"><span class="hljs-number">-10</span></span> <span class="hljs-number"><span class="hljs-number">-10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>],[<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>])<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  This completes the description of the geometry.  After we have described the geometry, we need to create a section in which we will observe the propagation of EMW.  This is done using the AddDump () and AddBox () functions. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">CSX</span></span> = AddDump(CSX,<span class="hljs-string"><span class="hljs-string">'Et'</span></span>); <span class="hljs-attribute"><span class="hljs-attribute">CSX</span></span> = AddBox(CSX,<span class="hljs-string"><span class="hljs-string">'Et'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,[-<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> -<span class="hljs-number"><span class="hljs-number">10</span></span>],[<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>]);</code> </pre><br><br>  Now we prepare a temporary directory for storing the results of calculations and view the geometry with the help of CSXCAD. <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">mkdir</span></span>(<span class="hljs-string"><span class="hljs-string">'tmp'</span></span>); WriteOpenEMS(<span class="hljs-string"><span class="hljs-string">'/tmp/tmp.xml'</span></span>,FDTD,CSX); CSXGeomPlot(<span class="hljs-string"><span class="hljs-string">'/tmp/tmp.xml'</span></span>); invoking AppCSXCAD, <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> to <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> script... QCSXCAD - disabling editing</code> </pre><br><br>  Everything, model of our structure is ready.  You can run the simulator.  If everything is normal, then we will see the following report: <br><pre> <code class="hljs kotlin">RunOpenEMS(<span class="hljs-string"><span class="hljs-string">'tmp'</span></span>,<span class="hljs-string"><span class="hljs-string">'/tmp/tmp.xml'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); ---------------------------------------------------------------------- | openEMS <span class="hljs-number"><span class="hljs-number">64</span></span>bit -- version v0.0.32-<span class="hljs-number"><span class="hljs-number">14</span></span>-g63adb58 | (C) <span class="hljs-number"><span class="hljs-number">2010</span></span>-<span class="hljs-number"><span class="hljs-number">2013</span></span> Thorsten Liebig &lt;thorsten.<span class="hljs-symbol"><span class="hljs-symbol">liebig@</span></span>gmx.de&gt; GPL license ---------------------------------------------------------------------- Used <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> libraries: CSXCAD -- Version: v0.5.2-<span class="hljs-number"><span class="hljs-number">15</span></span>-gcb5b3cf hdf5 -- Version: <span class="hljs-number"><span class="hljs-number">1.8</span></span>.13 compiled against: HDF5 library version: <span class="hljs-number"><span class="hljs-number">1.8</span></span>.13 tinyxml -- compiled against: <span class="hljs-number"><span class="hljs-number">2.6</span></span>.2 fparser boost -- compiled against: <span class="hljs-number"><span class="hljs-number">1_54</span></span> vtk -- Version: <span class="hljs-number"><span class="hljs-number">5.10</span></span>.1 compiled against: <span class="hljs-number"><span class="hljs-number">5.10</span></span>.1 Create FDTD <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> (compressed SSE + multi-threading) FDTD simulation size: <span class="hljs-number"><span class="hljs-number">21</span></span>x21x41 --&gt; <span class="hljs-number"><span class="hljs-number">18081</span></span> FDTD cells FDTD timestep <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>: <span class="hljs-number"><span class="hljs-number">1.92583e-09</span></span> s; Nyquist rate: <span class="hljs-number"><span class="hljs-number">25</span></span> timesteps @<span class="hljs-number"><span class="hljs-number">1.03851e+07</span></span> Hz Excitation signal length <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> timesteps (<span class="hljs-number"><span class="hljs-number">1.92583e-07</span></span>s) Max. number of timesteps: <span class="hljs-number"><span class="hljs-number">100</span></span> ( --&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> * Excitation signal length) Create FDTD engine (compressed SSE + multi-threading) Running FDTD engine... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> may take a <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>... grab a cup of coffee?!? Time <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> iterations with <span class="hljs-number"><span class="hljs-number">18081</span></span> cells : <span class="hljs-number"><span class="hljs-number">0.1624</span></span> sec Speed: <span class="hljs-number"><span class="hljs-number">11.1336</span></span> MCells/s</code> </pre><br><br>  The simulation is complete and you can see the result.  Run Paraview.  Then select File-&gt; Open and go to the temporary directory where the simulation results are stored.  They open the file Et_.vtr.  This file contains information about the result of the calculation of the propagation of EMW in time.  This is what you need to open, the path to the file you will have is different: <br><br><img src="https://habrastorage.org/files/87c/cee/337/87ccee3377744e638e9f61abd75aeb82.png"><br><br>  Now we see in the Paraview window a plane, which is a section in which we look at the amplitude of the EMW. <br><br><img src="https://habrastorage.org/files/f39/ba3/c35/f39ba3c35c1d44309f2fcc4b160b3edf.png"><br><br>  To visualize the amplitude of EMW, select the E-field from the Coloring drop-down list (the default is SolidColor) and then display the color legend (click Show).  Now we see the amplitude of the electromagnetic wave at time t = 0.  At the initial moment of time, the amplitude of the EMW is also zero in the whole space, so the entire plane will be painted in one color.  To see the distribution of EMW, you need to set the time different from zero and press the Rescale button.  Now on the plane the amplitude distribution of EMW is displayed. <br><br><img src="https://habrastorage.org/files/811/2fa/4a6/8112fa4a6df14cba8dbe4f00afcf2ef9.png"><br><br>  You can also start the animation and view the process of propagation of EMW in time.  As expected, the EME extends in both directions from the source plane. <br><br>  As a result, we modeled in the time domain the process of propagation of EME in a certain region of space.  In conclusion, the entire Octave / Matlab script: <br><br><pre> <code class="hljs perl">FDTD = InitFDTD(<span class="hljs-string"><span class="hljs-string">'NrTS'</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-string"><span class="hljs-string">'EndCriteria'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">'OverSampling'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); FDTD = SetSinusExcite(FDTD,<span class="hljs-number"><span class="hljs-number">10</span></span>e6); FDTD = SetBoundaryCond(FDTD,{<span class="hljs-string"><span class="hljs-string">'PMC'</span></span> <span class="hljs-string"><span class="hljs-string">'PMC'</span></span> <span class="hljs-string"><span class="hljs-string">'PEC'</span></span> <span class="hljs-string"><span class="hljs-string">'PEC'</span></span> <span class="hljs-string"><span class="hljs-string">'MUR'</span></span> <span class="hljs-string"><span class="hljs-string">'MUR'</span></span>}); CSX = InitCSX(); mesh.x = -<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>; mesh.y = -<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>; mesh.z = -<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>; CSX = DefineRectGrid(CSX,<span class="hljs-number"><span class="hljs-number">1</span></span>,mesh); CSX = AddExcitation(CSX,<span class="hljs-string"><span class="hljs-string">'excitation'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,[<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>]); CSX = AddBox(CSX,<span class="hljs-string"><span class="hljs-string">'excitation'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,[-<span class="hljs-number"><span class="hljs-number">10</span></span> -<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>],[<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>]); CSX = AddDump(CSX,<span class="hljs-string"><span class="hljs-string">'Et'</span></span>); CSX = AddBox(CSX,<span class="hljs-string"><span class="hljs-string">'Et'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,[-<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> -<span class="hljs-number"><span class="hljs-number">10</span></span>],[<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">mkdir</span></span>(<span class="hljs-string"><span class="hljs-string">'tmp'</span></span>); WriteOpenEMS(<span class="hljs-string"><span class="hljs-string">'/tmp/tmp.xml'</span></span>,FDTD,CSX); CSXGeomPlot(<span class="hljs-string"><span class="hljs-string">'/tmp/tmp.xml'</span></span>); RunOpenEMS(<span class="hljs-string"><span class="hljs-string">'tmp'</span></span>,<span class="hljs-string"><span class="hljs-string">'/tmp/tmp.xml'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br><br>  Link to the previous openEMS article: <a href="http://habrahabr.ru/post/255317/">habrahabr.ru/post/255317</a> <br><br>  OpenEMS project website: <a href="http://openems.de/">openems.de</a> </div><p>Source: <a href="https://habr.com/ru/post/258489/">https://habr.com/ru/post/258489/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258475/index.html">Big Data: current reality</a></li>
<li><a href="../258477/index.html">Accessibility. How we make Yandex accessible to people with disabilities and why we consider it important.</a></li>
<li><a href="../258479/index.html">New features for application developers in Search Console</a></li>
<li><a href="../258483/index.html">Muller's recurrent relation: problems with rounding floating-point numbers</a></li>
<li><a href="../258485/index.html">Registration for the conference on computational linguistics "Dialogue" is open</a></li>
<li><a href="../258491/index.html">64-bit code in 2015: what's new in diagnosing possible problems?</a></li>
<li><a href="../258495/index.html">About data transmission via audio jack</a></li>
<li><a href="../258499/index.html">OWASP TOP-10: A Practical View of Web Application Security</a></li>
<li><a href="../258501/index.html">Free functional test webinar from TestCafe</a></li>
<li><a href="../258503/index.html">Useful Wordpress plugins. OptionTree - site settings page</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>