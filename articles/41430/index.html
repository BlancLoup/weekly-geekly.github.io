<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cheap and angry block 85% of spam: greysmtpd</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Until I became a freelancer, I did not know what spam is. I had enough sense not to shine my email anywhere, but to use temporary emails for registrat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cheap and angry block 85% of spam: greysmtpd</h1><div class="post__text post__text-html js-mediator-article">  Until I became a freelancer, I did not know what spam is.  I had enough sense not to shine my email anywhere, but to use temporary emails for registrations on sites.  And I <u>got used</u> to the fact that all my mail runs very fast, the letters never get lost, and no one complains that my server refused to accept his letter.  Becoming a freelancer, I was forced to publish my email, and on many sites - because new customers should be able to easily contact me.  And spam poured out ... at first in a small stream, but lately it already resembles a full-flowing river rather than a stream. <br><br>  Using traditional spam filters (RBL, GMail, SpamAssassin, etc.) did not suit me: they all make mistakes from time to time, and they take normal letters for spam.  And it doesn't matter if they crush them, return them to the sender, or store them in a separate folder so that I periodically look at them - in any case there is a <u>non-zero chance of</u> losing an important letter. <br><a name="habracut"></a><br>  For several years, the problem was solved with the help of the <a href="http://powerman.name/soft/deliver.html">deliver</a> utility, which I wrote for the convenience of filtering mail.  Perl programmers using qmail should like it: in fact, filtering is done using Perl regular expressions that are conveniently applied to the desired parts of the letter (the filter is a Perl script :)).  I analyzed the received spam with my eyes, and carefully wrote regular expressions for it, which would not be 100% consistent with normal letters. <br><br>  But lately, spam has been adapting to my interests, and disguised as an IT theme.  And well, the dog is disguised - so well that I can no longer confidently write a regexp, which even by chance does not coincide with a normal letter.  (Note that <b>I cannot</b> <u>clearly</u> distinguish a particular spam with manual regexp, in fact, even with a specialized Perl script, is no longer able, how can companions do SpamAssassin?) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I had to look for an alternative approach to this problem ... and it was found, it is <a href="http://en.wikipedia.org/wiki/Greylisting">greylisting</a> !  Unfortunately, finding the greylisting implementation for qmail was not easy.  In principle, there are several of them, but they either require qmail patch, are written on the knee, or are heavily overloaded with additional functionality.  And I don‚Äôt like it much, I prefer simple, reliable and secure software - for example, the one that <a href="http://cr.yp.to/">DJ Bernstein</a> writes. <br><br>  As a result, I first put <a href="http://www.datenklause.de/en/software/qgreylistrbl.html">qgreylistrbl</a> - to <a href="http://www.datenklause.de/en/software/qgreylistrbl.html">test the</a> effectiveness of greylisting.  And then, delighted with the result of the work (but not the implementation) of qgreylistrbl, wrote <a href="http://powerman.name/soft/greysmtpd.html">greysmtpd</a> . <br><br>  It is very easy to install greysmtpd - it‚Äôs one of those ‚Äústuck and forgotten‚Äù that doesn't even need to be configured.  A big plus of this approach is that spam will instantly become about 85% less, and at the same time you are guaranteed not to lose a normal letter.  And if (when) spammers adapt to greylisting, then its effectiveness will fall, but there will still be no harm from it.  In general, this thing from the category must have! <br><br>  It should be noted that greysmtpd is optimized to minimize delays in the delivery of normal mail - in most cases, normal mail will be delivered without any delay, as if greysmtpd is not used at all.  This is achieved using RBL and the built-in determinant of dynamic hosts (DSL, dial-up, etc.): if the sender's IP is not blocked in RBL and the sender's domain (PTR) does not look like a dynamic host, mail is skipped immediately without using greylisting.  <i>(Yes, I use RBL, but not to block mail, but only to force greylisting. For all of us, from time to time, we get into RBL.)</i> In general, it turns out a kind of ‚Äúsoft greylisting‚Äù - a minimum of interference with normal operation with an excellent percentage blocked spam. <br><br>  I tried to make the script myself reliable, simple and effective.  For example, if any error occurs in the script, it simply skips the current letter, as if greysmtpd was not installed at all.  The SMTP implementation is lapped one-to-one with the djb's rblsmtpd utility.  And for efficiency, DNS queries are performed asynchronously.  Well, plus all the possible optimizations that allow to avoid RBL requests altogether, since  RBL stuff braked.  Script size - 200 lines, 5.5KB. <br><br>  The license, as usual, is the public domain. <br><br>  Download: <a href="http://powerman.name/soft/greysmtpd.html">greysmtpd</a> , <a href="http://powerman.name/soft/deliver.html">deliver</a> . <br><br>  Criticism and code review are welcome.  :) </div><p>Source: <a href="https://habr.com/ru/post/41430/">https://habr.com/ru/post/41430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../41422/index.html">New Radiohead "Reckoner" video: Outcrowding results</a></li>
<li><a href="../41425/index.html">As usual, "new things" do not know, "gurus" are silent</a></li>
<li><a href="../41426/index.html">Hello? Bear!</a></li>
<li><a href="../41428/index.html">Voting for the best LiveStreet design</a></li>
<li><a href="../41429/index.html">Comment Spam - Technical Counteraction Techniques</a></li>
<li><a href="../41431/index.html">The body of the SLR with your hands</a></li>
<li><a href="../41432/index.html">Kaspersky Security Network</a></li>
<li><a href="../41435/index.html">Insure your iPhone</a></li>
<li><a href="../41436/index.html">Announced by Nintendo DSi</a></li>
<li><a href="../41437/index.html">Changes to sape: the system requires a contract and payment of taxes.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>