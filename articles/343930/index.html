<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tcl / Tk. Thematic TTK widgets and designer TKproE-2.20</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Looking through my notes on GUI design using Tk widgets, I felt some sort of dissatisfaction. And the thing turned out to be that I actually missed th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tcl / Tk. Thematic TTK widgets and designer TKproE-2.20</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/gf/rb/pk/gfrbpkyntedc5r5z9iwcfhotnek.png" alt="image" align="left">  Looking through my <a href="https://habrahabr.ru/post/333742/">notes</a> on GUI design using Tk widgets, I felt some sort of dissatisfaction.  And the thing turned out to be that I actually missed the work with thematic widgets ttk (themed tk).  They were casually involved when reviewing the Tkinter package for Python and using the <a href="https://habrahabr.ru/post/335712/">Page</a> designer.  It was about the TNotebook widget (notepad, notebook) from the ttk package. <br><a name="habracut"></a><br>  The TNotebook widget is one of the new widgets, along with TCombobox, TProgressbar, TSeparator and TSizegrip, which appeared in ttk.  Converting applications from classic tk to ttk may require minimal effort.  Sometimes it is enough instead of, for example, button to write ttk :: buton.  Separately, I want to say about the combobox.  If you used a spinbox widget in your applications written in tk and now replace it with ttk :: combobox, then the <a href="http://soft.lissi.ru/ls_product/utils/p11utils/">application</a> will display this widget that you missed so much: <br><br><img src="https://habrastorage.org/webt/we/0b/mg/we0bmgg5jwn9xoktca5kjys8558.png" alt="image"><br><br>  But nevertheless the main thing in ttk, it is not new widgets, but their design (ited).  Customizing themes styles deserves a separate discussion.  And here I would send the developers to the wonderful <a href="http://www.tcltk.info/einfuehrung_in_tcl_tk_buch.pdf">tutorial</a> published just a few days ago (11.11.2017): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/7s/we/cp/7swecpsz_b_r8abc1_5h6ofpzm0.png" alt="image"><br><br>  Despite the fact that it is written in German, but I do not even know English, I read it with great pleasure.  As they say, written for the "fool." <br><br>  We are interested in whether there is an integrated development environment / designers for ttk widgets.  If we talk about Python and Tkinter, then this is <a href="https://habrahabr.ru/post/335712/">the Page package</a> .  This package supports both classic widgets and theme widgets.  True, for some reason, there is no support for TSeparator separators.  The design environment is the Tcl scripting language.  It is for this reason that we will return to this package.  Note the undoubted advantage of Page is the presence of an easel on which you can easily and conveniently place widgets. <br><br>  But this is for Python, and we are interested in the final product on Tcl.  It turned out that exactly one year ago (November 27, 2016), Tcl / Tk designer <a href="https://groups.google.com/forum/">TKproE 2.20 was announced</a> : <br><br><img src="https://habrastorage.org/webt/gi/xx/7x/gixx7xg1bwetopldfkjbhczronw.png" alt="image"><br><br>  And there are TSeparator separators in it.  A unique feature of this designer is that it accepts almost any tcl / tk script. <br>  To demonstrate the capabilities of both ttk widgets and TKproE-2.20 designer, a GUI interface was developed for the pp ‚Äúelegant print‚Äù utility from the <a href="http://soft.lissi.ru/development/lirssl_ls_nss/">NSS</a> package with eliminated <a href="https://geektimes.ru/users/saipr/posts/">jambs</a> and support for Russian pki (public key infrastructure) oid.  Moreover, such a utility for viewing certificates, including qualified <a href="http://ca.soft.lissi.ru/">certificates</a> , viewing the electronic signature of a document, is in demand.  And it was for her that the graphical interface was designed and implemented using TKproE: <br><br><img src="https://habrastorage.org/webt/xf/fu/cn/xffucntll-bw_nliyum5wbj2-y8.png" alt="image"><br><br>  Utility and graphic binding to it can be <a href="http://soft.lissi.ru/ls_product/utils/certview_util/">downloaded here</a> .  Another very pleasant surprise, unlike other designers, was waiting when working with image (image) and icons.  If earlier it was necessary to ‚Äútransfer‚Äù the image to PEM-encoding and insert the code into the script itself, now it is enough to specify the image file and TKproE will take it and convert it: <br><br><img src="https://habrastorage.org/webt/oq/cw/9e/oqcw9ek_31h4cch2a9vhtafmsea.png" alt="image"><br><br>  The only inconvenience here is the need to enter the file name.  But it turned out to be easy to fix.  It is enough in the <i>tkproe.tc</i> l script in lines 7474 and 7516 code (procedure <b>proc ShowWindow.tpimages</b> ) <br><br><pre><code class="plaintext hljs">label .tpimages.propbitmap.frame14.label12 -activebackground {#dcdcdc} \ -anchor {w} - background {#dcdcdc} -borderwidth {2} -font {Helvetica 10} \ -highlightbackground {#dcdcdc} -text {File:} -width {10}</code> </pre> <br>  replace with code: <br><br><pre> <code class="plaintext hljs">button .tpimages.propbitmap.frame14.label12 -activebackground {#dcdcdc} \ -anchor {w} -background {#dcdcdc} -borderwidth {2} -font {Helvetica 10} \ -highlightbackground {#dcdcdc} -text {File:} -width {10} \ -command { global userDir; set fileTypes {{"File image" *}}; \ set file [tk_getOpenFile -title "Find Image" -filetypes $fileTypes \ -initialdir "$userDir"]; \ .tpimages.propphoto.frame14.entry13 delete 0 end; \ .tpimages.propphoto.frame14.entry13 insert end $file; }</code> </pre> <br>  To make the file selection start from the home directory after line 5, add the following code to the tkproe.tcl script: <br><br><pre> <code class="plaintext hljs">global userDir set userDir $env(HOME)</code> </pre> <br>  Now, to select a file with an image, simply click the ‚ÄúFile:‚Äù button: <br><br><img src="https://habrastorage.org/webt/q1/ie/ry/q1ieryohx9cilp2gr2xc95d0epq.png" alt="image"><br><br>  Those interested can improve this code, for example, fill in the ‚ÄúFormat‚Äù field by the selected file, or vice versa, organize the file search by format, considering the format as a file extension (‚ÄúFile type‚Äù in the screenshot). <br><br>  Another inconvenience that I had to face was getting the user's home directory, for example, mHOME set $ env (HOME).  And the home directory, as a rule, is needed to provide a platform independent script.  It turned out through TKproE insert it nowhere.  Global variables in TKproE are defined through the TPinitVars procedure.  Naturally, if you define the mHOME variable through the field of global variables: <br><br><img src="https://habrastorage.org/webt/yk/tp/bk/yktpbkefxrx7jutghjmpn39koxg.png" alt="image"><br><br>  then the mHome variable will have the value "$ env (HOME)".  It would seem, take and insert the calculation of the current directory handles in the main body of the script.  You can, if only you no longer edit the script in TKproE.  Otherwise, TKproE will take care of the optimization and instead of the set nHOME code $ env (HOME) will insert the code with the home directory of the computer on which the script was created / corrected into the procedure of global variables initialization.  It's horrible. <br><br>  It had to climb into the code TKproE for the second time.  We found a way out of this situation in the definition of the global variable myHOME and the inclusion of additional code in the generated script.  And so, in the proc TP_Clone_app procedure immediately following the line (13th): <br><br><pre> <code class="plaintext hljs">set outstr "# Generated by TKproE $TPinfo(revision) - [clock format [clock seconds]]\n\n"</code> </pre> <br>  add row <br><br><pre> <code class="plaintext hljs">append outstr "#Add me\nencoding system utf-8\nglobal myHOME\nset myHOME \$env(HOME)\n\n"</code> </pre> <br>  and in the proc TP_Clone_variables procedure after the line (10th) <br><br><pre> <code class="plaintext hljs"> foreach varname $varlist {</code> </pre> <br>  insert code <br><br><pre> <code class="plaintext hljs">if { $varname == "myHOME" } { continue }</code> </pre> <br>  which disables the resetting of the myHOME global variable. <br><br>  And after these improvements, we managed to create a graphical shell for the PP utility: <br><br><img src="https://habrastorage.org/webt/be/ok/sq/beoksqxedu9kvv5u1wt8tj_mv2k.png" alt="image"><br><br>  If you select the file with the document and click the "Show in window" button, we will see the following: <br><br><img src="https://habrastorage.org/webt/_y/tk/yu/_ytkyugfox2oxqkth_tuugthz1o.png" alt="image"><br><br>  A certificate printout, like any other document, can be saved in a file (the ‚ÄúSave to file‚Äù button on the ‚ÄúCertificates, etc.‚Äù tab). <br>  The GUIPP script source code, which is also the TKproE project, can be downloaded <a href="http://soft.lissi.ru/ls_product/utils/certview_util/">here</a> . <br><br>  Above, we talked about going back to the Page designer.  In the Page designer it is very convenient to design a GUI with free placement of widgets (place).  As already mentioned, the GUI Project Page designer stores as a Tcl / Tk script, and it would be tempting to use a ready-made script from Page in TKproE or to add it manually.  In its pure form, the project from Page cannot be executed or loaded into TKproE-2.20.  To eliminate this ‚Äúinjustice‚Äù, a tcl script was developed, which leads projects from Page to tcl / tk scripts to be executed: <br><br><pre> <code class="bash hljs">sh-4.3$ ./fromPageToTcl.tcl Usage: ./fromPageToTcl.tcl &lt;file tcl from Page&gt; sh-4.3$</code> </pre> <br>  Here is the code for the tcl script fromPageToTcl.tcl: <br><br><div class="spoiler">  <b class="spoiler_title">Tcl script code fromPageToTcl.tcl</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#!/usr/bin/tclsh # 1 -- source file #   return # if {[winfo exists $base]} { #### wm deiconify $base; return # } #   ## vTcl:FireEvent $base &lt;&lt;Ready&gt;&gt; #LISSI-Soft namespace eval vTcl::widgets::ttk::sizegrip { proc CreateCmd {target args} { grid [ttk::sizegrip $target] -column 999 -row 999 -sticky se } } proc vTcl:font:add_GUI_font {font_name font_descr} { # This is called when we load an existing GUI-tcl file. It get rid # of actual fonts and replaces them with the definitions from the # GUI-tcl file. #set font_descr [font configure $font_name] if {[catch { font delete $font_name set newfont [font create $font_name {*}$font_descr ] } result]} { # Create failed set newfont "TkDefaultFont" } #set newkey NEEDS WORK #set ::vTcl(fonts,$newfont,type) $font_type #set ::vTcl(fonts,$newfont,key) $newkey set ::vTcl(fonts,$newfont,font_descr) $font_descr set ::vTcl(fonts,$font_descr,object) $newfont ;# Rozen 8/24/13 #set ::vTcl(fonts,$newkey,object) $newfont } proc {vTcl:font:add_font} {font_descr font_type {newkey {}} {check_fonts {1}}} { global vTcl ## This procedure may be used free of restrictions. ## Exception added by Christian Gavin on 08/08/02. ## Other packages and widget toolkits have different licensing requirements. ## Please read their license agreements for details. # With tk you are not allowed to specify the the font name when # creating a fomt. So if you want to assign a name to a font then # specify then the variable ::vTcl(fonts,$newkey,object) will hold # the correspondance between the actual name of the created name # and the name you wish to use. Rozen set defined_fonts [font names] if {$newkey != ""} { if {[info exists ::vTcl(fonts,$font_descr,object)]} { set test_font $::vTcl(fonts,$font_descr,object) if {[lsearch $defined_fonts $newkey] == -1} { set ::vTcl(fonts,$newkey,object) $test_font return $test_font } } } if {$check_fonts} { if {[info exists ::vTcl(fonts,$font_descr,object)]} { # It already exists return $::vTcl(fonts,$font_descr,object) } if {[lsearch $defined_fonts $font_descr] &gt; -1} { # It's a font already defined.. return $font_descr } } incr ::vTcl(fonts,counter) set newfont [eval font create $font_descr] lappend ::vTcl(fonts,objects) $newfont ## each font has its unique key so that when a project is ## reloaded, the key is used to find the font descriptio if {$newkey == ""} { set newkey vTcl:font$::vTcl(fonts,counter) ## let's find an unused font key while {[vTcl:font:get_font $newkey] != ""} { incr ::vTcl(fonts,counter) set newkey vTcl:font$::vTcl(fonts,counter) } } set ::vTcl(fonts,$newfont,type) $font_type set ::vTcl(fonts,$newfont,key) $newkey set ::vTcl(fonts,$newfont,font_descr) $font_descr set ::vTcl(fonts,$font_descr,object) $newfont set ::vTcl(fonts,$newkey,object) $newfont lappend ::vTcl(fonts,$font_type) $newfont ## in case caller needs it return $newfont } proc vTcl:DefineAlias {abcde} { # puts \"$a.$b\" # puts \"$c.$d.$e\" return } proc Window {type w} { if {$w == "."} { return } toplevel $w set base $w vTclWindow$w $base } #END LISSI-Soft set largv [llength $argv] if {$largv != 1} { puts "Usage: [info script] &lt;file tcl from Page&gt;\n" exit } set fconf [file exists "$argv"] if { $fconf == "0" } { puts "File=\"$argv\" don't exist\n" puts "Usage: [info script] &lt;file tcl from Page&gt;\n" exit } set srcMy [info script] set fp [open $srcMy r] while {![eof $fp]} { gets $fp res puts $res if { $res == "#END LISSI-Soft"} { break } } close $fp #   Page set fp [open $argv r] while {![eof $fp]} { gets $fp res if { [string first "wm deiconify \$base; return" $res] != -1 } { puts "#LISSI-Soft" puts "\t\twm deiconify \$base;" continue } if { [string first "vTcl:FireEvent \$base &lt;&lt;Ready&gt;&gt;" $res] != -1 } { puts "#LISSI-Soft" puts "#\tvTcl:FireEvent \$base &lt;&lt;Ready&gt;&gt;" continue } &lt;/spoiler&gt; if { [string first "vTcl:toplevel \$top -class Toplevel \\" $res] != -1 } { puts "#LISSI-Soft" puts "#vTcl:toplevel \$top -class Toplevel \\" puts "\$top configure \\" continue } if { [string first "vTcl::widgets::core::toplevel::createCmd \$top -class Toplevel \\" $res] != -1 } { puts "#LISSI-Soft" puts "#vTcl::widgets::core::toplevel::createCmd \$top -class Toplevel \\" puts "\$top configure \\" continue } puts $res } close $fp exit</code> </pre> <br></div></div><br>  And so, take an example from the ~ / page / examples / complex folder and get the executable tcl script via the fromPageToTcl.tcl script: <br><br><pre> <code class="bash hljs">sh-4.3<span class="hljs-variable"><span class="hljs-variable">$cd</span></span> ~/page/examples/complex sh-4.3$ ./fromPageToTcl.tcl complex.tcl &gt; complex_new.tcl sh-4.3$</code> </pre> <br>  Now, to get a really good code, open the complex_new.tcl script in the TKproE-2.20 designer and remove all the unnecessary procedures from the project now, and this is the Window procedure and all procedures with the vTcl prefix, and resave it: <br><br><img src="https://habrastorage.org/webt/yg/uk/wm/ygukwmmtssxqebolfsdstbqyki4.png" alt="image"><br><br>  Note that Page supports more ‚ÄúScrolled widgets‚Äù, we naturally do not support them. <br><br>  In general, the designer TKproE left a very good impression and it‚Äôs nice to work with him on GUI development.  The Page x TKproE x fromPageToTcl.tcl trio, consisting of Page designers, TKproE designers and the fromPageToTcl.tcl script, is simply a great trio. </div><p>Source: <a href="https://habr.com/ru/post/343930/">https://habr.com/ru/post/343930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343918/index.html">ASO Monthly # 17: September 2017</a></li>
<li><a href="../343922/index.html">Performance as Perception: Managing Perception</a></li>
<li><a href="../343924/index.html">As we schedule public transport in 2GIS added</a></li>
<li><a href="../343926/index.html">Announcement of the conference Mobius 2018 Piter</a></li>
<li><a href="../343928/index.html">Metrics storage: how we switched from Graphite + Whisper to Graphite + ClickHouse</a></li>
<li><a href="../343932/index.html">Name Assignment: Programmer's Guide</a></li>
<li><a href="../343934/index.html">Why repository in pom.xml is a bad idea</a></li>
<li><a href="../343936/index.html">RubyMine 2017.3. Faster IDE, WSL, Embedded Puppet, and more</a></li>
<li><a href="../343938/index.html">Pass the NS0-507 exam - NetApp Certified Implementation Engineer ‚Äî SAN Specialist</a></li>
<li><a href="../343940/index.html">Discussion about static code analysis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>