<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Run OpenVPN in Docker in 2 seconds</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, habrovchane! Have you ever faced a situation where you would really like to be virtually transferred to another city, country or another continent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Run OpenVPN in Docker in 2 seconds</h1><div class="post__text post__text-html js-mediator-article">  Hi, habrovchane!  Have you ever faced a situation where you would really like to be virtually transferred to another city, country or another continent?  I have such a need often enough, so the opportunity to have my own VPN server, which can be run anywhere, in a couple of seconds, was quite acute. an image that would allow to quickly raise the OpenVPN server, with a minimum of settings and an acceptable level of security. <p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/118/940/919/11894091908f95b1d8f42980f553fa10.png"></div><br><a name="habracut"></a><h3>  Prehistory </h3>  The ability to run the service on any machine: be it a physical server, or a virtual private server, or even a container space inside another container management system - was crucial.  My gaze immediately fell on Docker.  Firstly, this service is gaining popularity, and therefore, more and more providers provide ready-made solutions with its pre-installation;  secondly - there is a centralized image repository, where you can download and start the service with the help of one command in the terminal.  The idea that such a project should already exist, visited me and I persistently searched.  But most of the projects that I found were either too cumbersome (it was necessary to create a container for permanent storage of data and run the container several times with the application with different parameters), or without any sane documentation, or completely abandoned. Without finding anything acceptable, I started work on your project.  Ahead were sleepless nights studying documentation, writing code and debugging, but eventually my service saw the light and played with all the colors of the monochrome LED panel of the router.  So, I beg to love and favor - <a href="https://github.com/alekslitvinenk/docker-openvpn">Docker-OpenVPN</a> .  I even came up with the logo (above, before the cut), but do not judge it strictly, because I am not a designer (already). When I implemented this project, I put the deployment speed, the minimum of settings and an acceptable security level at the forefront.  Through trial and error, I found the optimal balance of these criteria, although in some places I had to sacrifice deployment speed for the sake of security, and for a minimum of settings I had to pay portability: in the current configuration, a container once created on one server cannot be transferred and run on another.  For example, all client and server certificates are generated when starting the service and it takes about 2 seconds.  However, the generation of the Defi Hellman file had to be rendered into build-time: it is created during the build of the docker image and can last up to 10 minutes.  I would very much like to receive a security audit of such a decision from a respected community. <h3>  Launch </h3>  To start the service we need a few things: <ol><li>  Server: physical or virtual.  Theoretically, you can run in docker-in-docker mode, but I did not conduct extensive testing of this option; </li><li>  Actually Docker.  Many hosting providers provide turnkey solutions with Docker on board; </li><li>  Public IP address. </li></ol>  If all the details are in place, then it remains for us to run the following command in the console of your server: <pre><code class="bash hljs">docker run --privileged -it --rm --name dovpn -p 1194:1194/udp -p 8080:8080/tcp -e HOST_ADDR=$(curl -s https://api.ipify.org) alekslitvinenk/openvpn</code> </pre>  The attentive reader might have noticed that the server‚Äôs IP address is automatically determined using <i>ipify.org</i> .  If for some reason this does not work, then you can specify the address manually. If all the previous steps have been performed correctly, then we should see something similar in the console: <pre> <code class="bash hljs">Sun Jun 9 08:56:11 2019 Initialization Sequence Completed Sun Jun 9 08:56:12 2019 Client.ovpn file has been generated Sun Jun 9 08:56:12 2019 Config server started, download your client.ovpn config at http://example.com:8080/ Sun Jun 9 08:56:12 2019 NOTE: After you download you client config, http server will be shut down!</code> </pre>  We are close to the goal: now we need to copy <i><a href="http://example.com/">example.com</a> : 8080 /</i> (in your case there will be the address of your server) and paste it into the address bar of the browser.  After you press Enter, the client.ovpn file will be downloaded, and the http server itself will go into oblivion.  If this solution is in doubt, you can use the following trick: run the previous command and add the <i>zp</i> flags and password.  Now, if you paste the generated link into the browser window, you will receive a zip archive with a password. When you have a file with a client configuration, you can use any suitable client.  I use Tunnelblick for Mac. <h3>  Video tutorial </h3>  This video tutorial contains detailed instructions for deploying the service to DigitalOcean.  So far in English, but I plan to make a version in Russian soon. <p> <a href="https://youtu.be/y5Dwakc6hMs"><img src="https://habrastorage.org/getpro/habr/post_images/f09/c0e/c5f/f09c0ec5f2599e4e936acbd6ac3d392d.png"></a> </p><br>  <b>PS</b> If you find this project useful, please put an asterisk on the GitHub, fork it and tell your friends.  Contributors and security audits are also widely welcome.  <b>PPS</b> If this article goes to Habr, then I plan to write the following about how I ran docker-in-docker and docker-in-docker-in-docker, why I did it and what came of it. <br>  <b>EDIT1:</b> <ol><li>  Fixed errors in the publication, </li><li>  Responding to comments, I decided to bring this information here: the --privileged flag is needed to work with iptables </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/458606/">https://habr.com/ru/post/458606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458590/index.html">Architectural approaches in iOS applications</a></li>
<li><a href="../458594/index.html">Do not forget to increase the chance of response to the client, using a second request in L7 balancing</a></li>
<li><a href="../4586/index.html">"Soup" explains its policy</a></li>
<li><a href="../45860/index.html">Website creation in Veliky Novgorod and other provincial cities</a></li>
<li><a href="../458604/index.html">Why the two largest electronics manufacturers joined forces in a new GPU project</a></li>
<li><a href="../458614/index.html">Creating a React-Hook usePosition () to get and track browser coordinates</a></li>
<li><a href="../45863/index.html">Mini photo studio at home</a></li>
<li><a href="../45864/index.html">Do I need articles / translations on Windows Workflow Foundation?</a></li>
<li><a href="../45865/index.html">We recognize the operator and the region of the mobile phone</a></li>
<li><a href="../45867/index.html">Communicator Qigi i6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>