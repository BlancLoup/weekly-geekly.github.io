<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features settings Palo Alto Networks: SSL VPN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite all the advantages of the Palo Alto Networks firewalls, in RuNet there are not so many materials on how to configure these devices, as well as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features settings Palo Alto Networks: SSL VPN</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/68c/d7c/a2c68cd7c6cbac21b84a65f55eb7dd33.png" alt="image"><br><br>  Despite all the advantages of the Palo Alto Networks firewalls, in RuNet there are not so many materials on how to configure these devices, as well as texts describing the experience of their implementation.  We decided to summarize the materials we have accumulated during our work with the equipment of this vendor and talk about the features that we encountered during the implementation of various projects. <br><br>  In order to familiarize yourself with Palo Alto Networks, this article will look at the settings required for one of the most common firewalling tasks, SSL VPN for remote access.  We will also talk about support functions for general firewall configuration, user, application, and security policy identification.  If the topic is of interest to readers, in the future we will release materials with Site-to-Site VPN parsing, dynamic routing and centralized management using Panorama. <br><a name="habracut"></a><br>  Firewalls Palo Alto Networks use a number of innovative technologies, including App-ID, User-ID, Content-ID.  The use of this functionality allows for a high level of security.  For example, using the App-ID, it is possible to identify application traffic based on signatures, decoding, and heuristics, regardless of the port and protocol used, including inside the SSL tunnel.  User-ID allows you to identify network users through integration with LDAP.  Content-ID allows you to scan traffic and identify the transmitted files and their contents.  Other functions of firewalls include intrusion protection, protection against vulnerabilities and DoS attacks, built-in anti-spyware, URL filtering, clustering, and centralized management. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the demonstration, we will use an isolated stand, with a configuration identical to the real one, with the exception of device names, AD domain name and IP addresses.  In reality, everything is more complicated - there may be a lot of branches.  On the borders of the central sites, in this case, instead of one firewall, a cluster will be installed, dynamic routing may also be required. <br><br>  The stand uses <b>PAN-OS 7.1.9</b> .  As a typical configuration, consider a network with a Palo Alto Networks firewall at the border.  Firewall provides remote SSL VPN access to the head office.  The Active Directory domain will be used as the user database (Figure 1). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1cb/dd5/1bf/1cbdd51bf48e437919725b3cc9a12818.png" alt="image"></div><br>  <i>Figure 1 - Network block diagram</i> <br><br>  Setup steps: <br><br><ol><li>  Presetting device.  Set name, management IP address, static routes, administrator accounts, management profiles </li><li>  Installing licenses, configuring and installing updates </li><li>  Configure security zones, network interfaces, traffic policies, address translation </li><li>  Configure LDAP Authentication Profile and User Identification Features </li><li>  Configure SSL VPN </li></ol><br><h4>  1. Pre-tuning </h4><br>  The main tool for setting up the Palo Alto Networks firewall is a web interface, and control via the CLI is also possible.  By default, the management interface has the IP address 192.168.1.1/24, login: admin, password: admin. <br><br>  You can change the address either by connecting to the web interface from the same network, or using the command <b>set deviceconfig system ip-address &lt;&gt; netmask &lt;&gt;</b> .  It runs in configuration mode.  To switch to configuration mode, use the <b>configure</b> command.  All changes on the firewall occur only after the <b>commit is</b> confirmed by the <b>commit</b> command, both in the command line mode and in the web interface. <br><br>  To change the settings in the web interface, use the section <b>Device -&gt; General Settings and Device -&gt; Management Interface Settings.</b>  Name, banners, time zone and other settings can be set in the General Settings section (Fig. 2). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e9/626/6ae/1e96266ae0f96fe06ba922ff07882aab.png" alt="image"><br>  <i>Figure 2 - Management Interface Parameters</i> <br><br>  If a virtual firewall is used in an ESXi environment, in the General Settings section you need to enable the use of the MAC address assigned by the hypervisor, or configure the MAC addresses set on the firewall interfaces on the hypervisor, or change the settings of the virtual switches to allow MAC changes addresses.  Otherwise, the traffic will not pass. <br><br>  The management interface is configured separately and is not displayed in the list of network interfaces.  The <b>Management Interface Settings</b> section specifies the default gateway for the management interface.  Other static routes are configured in the virtual routers section; this will be described later. <br><br>  To allow access to the device through other interfaces, you must create a <b>Management Profile</b> in the <b>Network -&gt; Network Profiles -&gt; Interface Mgmt section</b> and assign it to the appropriate interface. <br><br>  Next, you need to configure DNS and NTP in the <b>Device -&gt; Services</b> section in order to receive updates and correctly display the time (Fig. 3).  By default, all traffic created by the firewall uses the management interface's IP address as the source IP address.  You can assign a different interface for each specific service in the <b>Service Route Configuration</b> section. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/967/4e6/3bf/9674e63bf6c5bd8ad774f9c8baec26b0.png" alt="image"><br>  <i>Figure 3 - Parameters of DNS, NTP and system routes services</i> <br><br><h4>  2. Installing licenses, configuring and installing updates </h4><br>  For full operation of all functions of the firewall, you must install a license.  You can use a trial license by requesting it from Palo Alto Networks partners.  Its validity period is 30 days.  The license is activated either through a file or using Auth-Code.  Licenses are configured in the <b>Device -&gt; Licenses</b> section (Fig. 4). <br>  After installing the license, you must configure the installation of updates in the section <b>Device -&gt; Dynamic Updates</b> . <br>  In the <b>Device -&gt; Software</b> section, you can download and install new versions of PAN-OS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc3/cde/73b/dc3cde73b373d2f7ba45d9d6c3ff38c2.png" alt="image"><br>  <i>Figure 4 - License control panel</i> <br><br><h4>  3. Configure security zones, network interfaces, traffic policy, address translation </h4><br>  Palo Alto Networks firewalls apply zone logic when setting up network rules.  Network interfaces are assigned to a specific zone, and it is used in traffic rules.  This approach allows in the future, when changing interface settings, not to change the traffic rules, but instead reassign the necessary interfaces to the corresponding zones.  By default, traffic inside the zone is allowed, traffic between zones is prohibited, the preset rules <b>intrazone-default</b> and <b>interzone-default</b> are responsible for this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a2/069/4c9/6a20694c950846b28490a475fc9d0317.png" alt="image"><br>  <i>Figure 5 - Security Zones</i> <br><br>  In this example, the interface on the internal network is assigned to the <b>internal</b> zone, and the interface directed to the Internet is assigned to the <b>external</b> zone.  For SSL VPN, a tunnel interface has been created, assigned to the <b>vpn</b> zone (Fig. 5). <br><br>  The network interfaces of the Palo Alto Networks firewall can operate in five different modes: <br><br><ul><li>  <b>Tap</b> - used to collect traffic for monitoring and analysis </li><li>  <b>HA</b> - used for cluster operation. </li><li>  <b>Virtual Wire</b> - in this mode, Palo Alto Networks combines two interfaces and transparently allows traffic between them without changing the MAC and IP addresses </li><li>  <b>Layer2</b> - switch mode </li><li>  <b>Layer3</b> - router mode </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/3a4/f48/f56/3a4f48f56ac8689c1d092d2276b4e554.png" alt="image"><br>  <i>Figure 6 - Setting the interface operation mode</i> <br><br>  In this example, the Layer3 mode will be used (Fig. 6).  The parameters of the network interface indicate the IP address, mode of operation and the corresponding security zone.  In addition to the interface operation mode, you must assign it to the Virtual Router virtual router, this is an analog of the VRF instance in Palo Alto Networks.  Virtual routers are isolated from each other and have their own routing tables and network protocol settings. <br><br>  In the virtual router settings, static routes and routing protocol settings are specified.  In this example, only the default route was created for access to external networks (Fig. 7). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82f/973/fe2/82f973fe2068210602f74477f1e57a0b.png" alt="image"><br>  <i>Figure 7 - Configuring a Virtual Router</i> <br><br>  The next configuration step is traffic policies, the <b>Policies -&gt; Security</b> section.  An example of the setting is shown in Figure 8. The logic of the rules is the same as for all firewalls.  Rules are checked from top to bottom, before the first match.  Brief description of the rules: <br><br>  1. SSL VPN Access to Web Portal.  Allows access to the web portal for authenticating remote connections <br>  2. VPN traffic - allowing traffic between remote connections and the head office <br>  3. Basic Internet - permission of dns, ping, traceroute, ntp applications.  The firewall allows signature-based, decoding, and heuristic-based applications, not port and protocol numbers, so application-default is indicated in the Service section.  The default port / protocol for this application <br>  4. Web Access - allowing access to the Internet via HTTP and HTTPS without application control <br>  5.6.  Default rules for other traffic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/63c/5a4/6c763c5a46d7227bdd32cf38a1240491.png" alt="image"><br>  <i>Figure 8 - An example of setting up network rules</i> <br><br>  To configure the NAT, use the <b>Policies -&gt; NAT</b> section.  An example of the NAT setup is shown in Figure 9. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b54/c2d/f80/b54c2df80a3d9764c59f2f77220dc841.png" alt="image"><br>  <i>Figure 9 - Example of NAT Setup</i> <br><br>  For any traffic from internal to external, you can change the source address to the external IP address of the firewall and use the dynamic port address (PAT). <br><br>  <b>4. Configure LDAP Authentication Profile and User Identification Functions</b> <br>  Before connecting users via SSL-VPN, you need to configure the authentication mechanism.  In this example, authentication will take place on an Active Directory domain controller through the Palo Alto Networks web interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be6/5ae/27c/be65ae27c1a968b40e87bd1fe3fd711a.png" alt="image"><br>  <i>Figure 10 - LDAP Profile</i> <br><br>  In order for authentication to work, you need to configure the <b>LDAP Profile</b> and <b>Authentication Profile</b> .  In the <b>Device -&gt; Server Profiles -&gt; LDAP</b> section (Figure 10), you need to specify the IP address and port of the domain controller, the type of LDAP and the user account of the <b>Server Operators</b> , <b>Event Log Readers</b> , <b>Distributed COM Users</b> groups.  Then, in the <b>Device -&gt; Authentication Profile</b> section, create an authentication profile (Fig. 11), mark the previously created <b>LDAP Profile,</b> and in the Advanced tab, specify the group of users (Fig. 12) that are allowed remote access.  It is important to mark the <b>User Domain</b> parameter in the profile, otherwise group-based authorization will not work.  The field must contain the NetBIOS domain name. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/838/f7d/059/838f7d059e7926a9488b28b9c8ee018a.png" alt="image"><br>  <i>Figure 11 - Authentication Profile</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/34b/c1d/d8d/34bc1dd8d5856838750b12636421804c.png" alt="image"><br>  <i>Figure 12 - Select AD group</i> <br><br>  The next step is to configure <b>Device -&gt; User Identification</b> .  Here you need to specify the IP address of the domain controller, the credentials for the connection, as well as configure the parameters <b>Enable Security Log</b> , <b>Enable Session</b> , <b>Enable Probing</b> (Fig. 13).  In the <b>Group Mapping</b> section (Fig. 14), you need to note the identification parameters of objects in LDAP and the list of groups that will be used for authorization.  As in the Authentication Profile, here you need to set the User Domain parameter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f8d/e97/905/f8de97905b7e4f20b8512956811bad33.png" alt="image"><br>  <i>Figure 13 - User Mapping options</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/079/5b8/b68/0795b8b683ee7c219cfebd082533edc6.png" alt="image"><br>  <i>Figure 14 - Group Mapping Parameters</i> <br><br>  The last step at this stage will be the creation of a VPN zone and an interface for this zone.  On the interface, you must enable the <b>Enable User Identification</b> parameter (Fig. 15). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f39/3e4/77e/f393e477e09c2134fafad296bad88d30.png" alt="image"><br>  <i>Figure 15 - Configure the VPN zone</i> <br><br><h4>  5. Configure SSL VPN </h4><br>  Before connecting to an SSL VPN, a remote user must log into the web portal, authenticate and download the Global Protect client.  Next, this client will request credentials and connect to the corporate network.  The web portal works in https mode and, accordingly, it is necessary to install a certificate for it.  Use a public certificate if available.  Then the user will not be issued a warning about the invalidity of the certificate on the site.  If it is not possible to use a public certificate, then you need to release your own, which will be used on the web page for https.  It can be self-signed or issued through a local certificate authority.  The remote computer must have a root or self-signed certificate in the list of trusted root centers so that the user is not given an error when connecting to the web portal.  In this example, a certificate issued through an Active Directory Certificate Services certificate will be used. <br><br>  To issue a certificate, you need to create a certificate request in the section <b>Device -&gt; Certificate Management -&gt; Certificates -&gt; Generate</b> .  In the request, we indicate the name of the certificate and the IP address or FQDN of the web portal (Fig. 16).  After generating the request, download the <b>.csr</b> file and copy its contents into the certificate request field into the AD CS Web Enrollment web form.  Depending on the configuration of the certificate authority, the certificate request must be approved and downloaded in <b>Base64 Encoded Certificate</b> format.  Additionally, you need to download the certificate authority's root certificate.  Then you need to import both certificates to the firewall.  When importing a certificate for a web portal, you must select the request in the pending status and click import.  The certificate name must match the name specified earlier in the request.  The name of the root certificate can be specified arbitrarily.  After importing the certificate, you need to create an <b>SSL / TLS Service Profile</b> in the <b>Device -&gt; Certificate Management</b> section.  In the profile, specify the previously imported certificate. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73a/844/9f5/73a8449f5dd7dca11c8d97aa8615a50f.png" alt="image"><br>  <i>Figure 16 - Certificate Request</i> <br><br>  The next step is to configure the <b>Global Protect Gateway</b> and <b>Global Protect Portal</b> objects in the <b>Network -&gt; Global Protect</b> section.  In the settings of <b>Glbal Protect Gateway, we</b> specify the external IP address of the firewall, as well as the previously created <b>SSL Profile</b> , <b>Authentication Profile</b> , tunnel interface and client IP settings.  You need to specify a pool of IP addresses from which the client‚Äôs address will be assigned, and the Access Route is the subnets to which the client‚Äôs route will be.  If the task is to wrap all user traffic through the firewall, then you need to specify the subnet 0.0.0.0/0 (Fig. 17). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a1/14f/78c/4a114f78c91e517cc8840d11f4b343e6.png" alt="image"><br>  <i>Figure 17 - Setting up a pool of IP addresses and routes</i> <br><br>  Then you need to configure the <b>Global Protect Portal</b> .  Specify the IP address of the firewall, the <b>SSL Profile</b> and <b>Authentication Profile</b> and the list of external IP addresses of the firewalls to which the client will connect.  If there are several firewalls, you can set a priority for each according to which users will choose a firewall to connect. <br><br>  In the <b>Device -&gt; GlobalProtect Client section,</b> you need to download the VPN client distribution kit from the Palo Alto Networks servers and activate it.  To connect, the user must go to the portal web page, where he will be offered to download the <b>GlobalProtect Client</b> .  After downloading and installation, you will be able to enter your credentials and connect to the corporate network via SSL VPN. <br><br><h4>  Conclusion </h4><br>  This completes the part of the Palo Alto Networks setup.  We hope the information was useful, and the reader got an idea about the technologies used in Palo Alto Networks.  If you have questions about customization and suggestions on topics for future articles - write them in the comments, we will be happy to answer. </div><p>Source: <a href="https://habr.com/ru/post/443726/">https://habr.com/ru/post/443726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443708/index.html">Mission "Chang'e-4" - the third lunar day. Rover "Yuytu-2" in search of ... stones</a></li>
<li><a href="../443710/index.html">Java Challengers # 4: Comparing objects with equals () and hashCode ()</a></li>
<li><a href="../443712/index.html">Yandex and some media sites suffered from a DNS attack from Roskomnadzor</a></li>
<li><a href="../443718/index.html">Fantasy game with 300 thousand races</a></li>
<li><a href="../443722/index.html">Design and naming of queues</a></li>
<li><a href="../443728/index.html">Google Plus stops working. So what?</a></li>
<li><a href="../443730/index.html">Ctrl-Alt-Del: scheduled obsolescence of programmers</a></li>
<li><a href="../443734/index.html">Neural networks have a surprisingly simple image classification strategy.</a></li>
<li><a href="../443736/index.html">Setting up from scratch the Network UPS Tools UPS Management Service (NUT) to manage a locally connected UPS</a></li>
<li><a href="../443740/index.html">The first release of an open source product test testing tool.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>