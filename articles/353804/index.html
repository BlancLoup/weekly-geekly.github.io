<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flask Mega-Tutorial, Part XX: The Magic of JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(edition 2018) 
 Miguel grinberg 



 There 


 This is the twentieth edition of the Flask Mega-tutorial series, in which I'm going to add a pop-up wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flask Mega-Tutorial, Part XX: The Magic of JavaScript</h1><div class="post__text post__text-html js-mediator-article"><h2 id="izdanie-2018">  (edition 2018) </h2><br><h3 id="miguel-grinberg">  <em>Miguel grinberg</em> </h3><br><hr><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habrahabr.ru/post/353234/">There</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  This is the twentieth edition of the Flask Mega-tutorial series, in which I'm going to add a pop-up window that appears when you hover the mouse over a username. </p><a name="habracut"></a><br><p>  Under the spoiler is a list of all articles in the 2018 series. </p><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/346306/"><strong>Chapter 1: Hello world!</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346340/"><strong>Chapter 2: Templates</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346342/"><strong>Chapter 3: Web Forms</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346344/"><strong>Chapter 4: Database</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346346/"><strong>Chapter 5: User Logins</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346348/"><strong>Chapter 6: Profile Page and Avatars</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346880/"><strong>Chapter 7: Error Handling</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347450/"><strong>Chapter 8: Subscribers, Contacts, and Friends</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347926/"><strong>Chapter 9: Pagination</strong></a> </li><li>  <a href="https://habrahabr.ru/post/348566/"><strong>Chapter 10: Email Support</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349060/"><strong>Chapter 11: Reconstruction</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349604/"><strong>Chapter 12: Date and Time</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350148/"><strong>Chapter 13: I18n and L10n</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350626/"><strong>Chapter 14: Ajax</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351218/"><strong>Chapter 15: Improving Application Structure</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351900/"><strong>Chapter 16: Full Text Search</strong></a> </li><li>  <a href="https://habrahabr.ru/post/352266/"><strong>Chapter 17: Deploying to Linux</strong></a> </li><li>  <a href="https://habrahabr.ru/post/352830/"><strong>Chapter 18: Deploying to Heroku</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353234/"><strong>Chapter 19: Deploying to Docker Containers</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353804/"><strong>Chapter 20: JavaScript Magic</strong></a> (This article) </li><li>  <a href="https://habr.com/post/354322/"><strong>Chapter 21: User Notifications</strong></a> </li><li>  Chapter 22: Reference Tasks (Available May 1, 2018) </li><li>  Chapter 23: Application Programming Interfaces (APIs) (Available May 8, 2018) </li></ul></div></div><br><p>  <em>Note 1: If you are looking for old versions of this course, this is <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world-legacy" title="here">here</a> .</em> </p><br><p>  <em>Note 2: If suddenly you would like to speak in support of my (Miguel) work, or simply do not have the patience to wait for the article for a week, I (Miguel Greenberg) offer the full version of this manual (in English) in the form of an electronic book or video.</em>  <em>For more information, visit <a href="http://learn.miguelgrinberg.com/" title="learn.miguelgrinberg.com">learn.miguelgrinberg.com</a> .</em> </p><br><p>  Currently, it is not possible to create a web application that would not use at least a little JavaScript.  I'm sure you know that JavaScript is the only language that was originally designed to work in web browsers.  In <a href="https://habrahabr.ru/post/350626/">Chapter 14,</a> you saw the use of unpretentious JavaScript linking in a flask template to provide real-time language translations of blog posts.  In this chapter, I'm going to delve into the topic and show you another useful JavaScript trick to make the application more interesting and attractive to users. </p><br><p>  A common feature of the user interface for social networking sites, in which users can interact with each other, is the display of a brief user summary in a pop-up panel when you hover the mouse over a user name anywhere on the page.  If you have never paid attention to it, go to Twitter, Facebook, LinkedIn or any other major social network, and when you see the username, just leave the mouse pointer on top of it for a couple of seconds to see a pop-up window.  This chapter will be devoted to the creation of this function for Microblog, an example of which you can see in the screenshot below: </p><br><p><img src="https://habrastorage.org/webt/xk/sj/hg/xksjhgohxs-ez9rwhhnoqkqp7oa.png"></p><br><p>  <em>GitHub links for this chapter:</em> <a href="">Browse</a> , <a href="">Zip</a> , <a href="">Diff</a> . </p><br><h2 id="podderzhka-na-storone-servera">  Server side support </h2><br><p>  Before we dive into the client side, let's work a little with the server to understand what is needed to support these custom pop-ups.  The contents of the user pop-up window will be returned by the new route, which will be a simplified version of the existing profile profile route.  Here is the function, view: </p><br><blockquote>  <em>app / main / routes.py</em> : User popup function. </blockquote><br><pre><code class="hljs ruby">@bp.route(<span class="hljs-string"><span class="hljs-string">'/user/&lt;username&gt;/popup'</span></span>) @login_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">user_popup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(username)</span></span></span></span>: user = User.query.filter_by(username=username).first_or_404() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'user_popup.html'</span></span>, user=user)</code> </pre> <br><p>  This route will be attached to the URL <em>/ user / <code>&lt;username&gt;</code> / popup</em> and simply load the requested user, and then display a template with its data, which is a shortened version of the user profile page: </p><br><blockquote>  <em>app / templates / user_popup.html</em> : User popup template. </blockquote><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"table"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"64"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"border: 0px;"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.avatar(64) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"border: 0px;"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('main.user', username=user.username) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.username }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">small</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> user.about_me %}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.about_me }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> user.last_seen %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Last seen on') }}</span></span><span class="xml"><span class="xml">: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ moment(user.last_seen).format('lll') }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('%(count)d followers', count=user.followers.count()) }}</span></span><span class="xml"><span class="xml">, </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('%(count)d following', count=user.followed.count()) }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> user != current_user %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> not current_user.is_following(user) %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('main.follow', username=user.username) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Follow') }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">else</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('main.unfollow', username=user.username) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Unfollow') }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">small</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  The JavaScript code that I write in the following sections will refer to this route when the user hovers over the username.  In response, the server returns the HTML content for the pop-up window, which then displays the client part.  When the user moves the mouse, the popup will be removed.  Sounds easy, right? </p><br><p>  If you want to see what the pop-up window will look like, you can launch the application, go to any user's profile page, and then add <em>/ popup</em> to the URL in the address bar to view the full-screen version of the pop-up content. </p><br><h2 id="vvedenie-v-bootstrap-popover-component">  Introduction to Bootstrap Popover Component </h2><br><p>  In <a href="https://habrahabr.ru/post/349060/">chapter 11,</a> I introduced you to the Bootstrap framework as a convenient way to create beautifully formatted web pages.  So far, I have used only the minimum part of this framework.  Bootstrap comes bundled with many common user interface elements, all of which have demos and examples in the Bootstrap documentation at <em><a href="https://getbootstrap.com/">https://getbootstrap.com</a></em> .  One of these components is <a href="https://getbootstrap.com/docs/3.3/javascript/">Popover</a> , which is described in the documentation as "small invoice content, for posting additional information."  Exactly what I need! </p><br><p>  Most bootstrap components are defined using HTML markup, which refers to CSS Bootstrap definitions that add a formatting style.  Some of the most advanced also require javascript.  The standard way that an application includes these components on a web page is to add HTML in the right place, and then for components that need scripting support, invoke a JavaScript function that initializes or activates it.  The popover component requires javascript support. </p><br><p>  The HTML part for creating a popover is very simple, you just need to define the element that will cause the popover to appear.  In my case, it will be a clickable username that appears in each blog post.  In the <em>app / templates / _post.html</em> sub-template, the username is already defined: </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('main.user', username=post.author.username) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.author.username }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  Now, in accordance with the popover documentation, I need to call the popover () JavaScript function for each link like the one above on the page, and this will cause the popup to be initialized.  The initialization call accepts several parameters that set up a pop-up window, including parameters that send content to be displayed in a pop-up window, which method to use to cause a pop-up window to appear or disappear (click, hang over an item, etc.) if the content is is a simple text or HTML, and a few more parameters that you can see on the documentation page.  Unfortunately, after reading this information, I had more questions than answers, because it seems that this component is not designed to work as I need it.  Below is a list of problems that I need to solve in order to implement this function: </p><br><ul><li>  The page will have many links to the username, one for each blog post.  I need a way to find all these links from javascript after displaying the page so that I can initialize them as pop-up windows. </li><li>  The popover examples in the Bootstrap documentation provide the contents of the popover as the <code>data-content</code> attribute added to the target HTML element, so when the hover event fires, all Bootstrap needs is a pop-up window.  This is terribly inconvenient for me, because I want to create an Ajax call to the server in order to receive content, and only when the server response is received should a pop-up window appear. </li><li>  When using hover mode, the pop-up window will remain visible as long as you hold the mouse pointer in the target element.  When you move the mouse, the pop-up window will disappear.  This is not a pleasant side effect: if the user wants to move the mouse pointer into the popup window itself, the popup window will disappear.  I will need to somehow expand the behavior of the pop-up window when hovering, so that the user can go into it and, for example, click the link there. </li></ul><br><p>  In fact, this is not so rare when working with browser-based applications that quickly become more complex.  You need to think deeply enough about the dependencies of the interaction of DOM elements with each other and make them behave in such a way that the user is left with only pleasant impressions. </p><br><h2 id="vypolnenie-funkcii-pri-zagruzke-stranicy">  Execution of function when loading page </h2><br><p>  It is clear that I will need to run the JavaScript code immediately after loading each page.  The function I'm about to launch will search for all references to usernames on the page and configure those that have the popover component from Bootstrap. </p><br><p>  The jQuery javascript library is loaded as a dependency on Bootstrap, so I'm going to use it.  When using jQuery, you can register a function that will be launched when the page is loaded by wrapping it in <code>$(...)</code> .  Perhaps this should be added to the <em>app / templates / base.html template so</em> that it <em>runs</em> on each page of the application: </p><br><blockquote>  <em>app / templates / base.html</em> : Run the function after the page loads. </blockquote><br><pre> <code class="hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">// ... $(function() { // write start up code here }); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  As you can see, I added the start up function to the <code>&lt;script&gt;</code> element, in which I defined the <code>translate()</code> function in <a href="https://habrahabr.ru/post/350626/">Chapter 14</a> . </p><br><h2 id="poisk-dom-elementov-s-pomoschyu-selektorov">  Finding DOM elements with selectors </h2><br><p>  My first task is to create a JavaScript function that will find all the links on the page.  This function will be triggered when the page has finished loading, and when it is completed, it will configure the hang and popup behavior for all of them.  Now I will focus on finding links. </p><br><p>  If we recall from <a href="https://habrahabr.ru/post/350626/">Chapter 14</a> , the HTML elements that were involved in live translations had unique identifiers.  For example, the attribute <code>id="post123"</code> was added to the entry with ID = 123.  Then, using jQuery, the expression <code>$('#post123')</code> was used in JavaScript to find this element in the DOM.  The <code>$()</code> function is extremely powerful and has a fairly complex query language for finding DOM elements based on <a href="https://api.jquery.com/category/selectors/">CSS Selectors</a> . </p><br><p>  The selector that I used for the translation function was designed to find one particular element that had a unique identifier set as the <code>id</code> attribute.  Another way to identify elements is through the <code>class</code> attribute, which can be assigned to several elements on the page.  For example, I could mark all user references with <code>class="user_popup"</code> , and then get a list of links from JavaScript using <code>$('.user_popup')</code> (in CSS selectors, the prefix <code>#</code> searches by ID, while <code>.</code> Search for prefixes by class ).  The return value in this case will be a collection of all elements that have a class. </p><br><h2 id="popovers-i-dom">  Popovers and DOM </h2><br><p>  After playing with examples of popover in the Bootstrap documentation and checking the DOM in the browser debugger, I determined that Bootstrap creates the popover component as a child element of the target element in the DOM.  As I mentioned above, this affects the behavior of the hover event, which will display a ‚Äúmouse‚Äù as soon as the user moves the mouse pointer from the <code>&lt;a&gt;</code> link and into the popup window itself. </p><br><p>  The trick that I can use to extend the hover event to enable popover is to make the popover a child of the target element and then hover guidance is inherited.  Looking through the popover options in the documentation, I found that this can be done by passing the parent element to the <code>container</code> option. </p><br><p>  Creating a popover child element from hover will work well for buttons or common <code>&lt;div&gt;</code> or <code>&lt;span&gt;</code> elements, but in my case, the target for popover is an <code>&lt;a&gt;</code> element that displays a link to the username.  The problem with creating a popover <code>&lt;a&gt;</code> child element is that the popover will then get the behavior of the parent <code>&lt;a&gt;</code> reference.  The end result will be something like this: </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user_popup"</span></span></span><span class="hljs-tag">&gt;</span></span> username <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ... popover elements here ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  To avoid popover inside the <code>&lt;a&gt;</code> element, we‚Äôll use another trick.  I'm going to wrap the <code>&lt;a&gt;</code> element inside the <code>&lt;span&gt;</code> element, and then bind the hover and popover event to <code>&lt;span&gt;</code> .  The resulting structure will be as follows: </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user_popup"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag">&gt;</span></span> username <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ... popover elements here ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The <code>&lt;div&gt;</code> and <code>&lt;span&gt;</code> elements are invisible, so they are excellent elements to help you organize and structure the DOM.  The <code>&lt;div&gt;</code> <em>element</em> is a <em>block element</em> , similar to a paragraph in an HTML document, while the <code>&lt;span&gt;</code> element is a <em>string element</em> that is comparable to a word.  For this case, I decided to use the <code>&lt;span&gt;</code> element, since the <code>&lt;a&gt;</code> element that I wrap is also a string element. </p><br><p>  Now we need to reorganize my <em>app / templates / _post.html subpattern</em> to include the <code>&lt;span&gt;</code> element: </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">... </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">set</span></span></span><span class="hljs-template-tag"> user_link %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"user_popup"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"url_for('main.user', username=post.author.username)"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.author.username }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endset</span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> ...</span></span></code> </pre> <br><p>  If you're wondering where the HTML popover elements are, then the good news is that I don‚Äôt need to worry about it.  When I get a call to the <code>popover()</code> initialization function in the <code>&lt;span&gt;</code> elements I just created, the Bootstrap environment will dynamically insert a popup component. </p><br><h2 id="sobytiya-hover-navedeniya">  Hover Events </h2><br><p>  As I mentioned above, the hover behavior used by the popover component of Bootstrap is not flexible enough to meet my needs, but if you look at the documentation for the <code>trigger</code> option, ‚Äúhover‚Äù is just one of the possible values.  My view was attracted to the ‚Äúmanual‚Äù mode, in which the popover can be displayed or removed manually by invoking JavaScript.  This mode will give me the freedom to implement the hang logic, so I'm going to use this parameter and implement my own hover event handlers, which work the way I need them. </p><br><p>  So my next step is to attach the ‚Äúhover‚Äù event to all links on the page.  Using jQuery, the hover event can be bound to any HTML element by calling <code>element.hover (handlerIn, handlerOut)</code> .  If this function is called in a set of elements, jQuery conveniently attaches an event to all of them.  Two arguments are two functions that are called when the user moves the mouse to and from the target element, respectively. </p><br><blockquote>  <em>app / templates / base.html</em> : Hover event. </blockquote><br><pre> <code class="hljs lua">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { $(<span class="hljs-string"><span class="hljs-string">'.user_popup'</span></span>).hover( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { // mouse <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> event handler var elem = event.currentTarget; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { // mouse out event handler var elem = event.currentTarget; } ) });</code> </pre> <br><p>  The <code>event</code> argument is an <code>event</code> object that contains useful information.  In this case, I retrieve the item that was the target of the event using <code>event.currentTarget</code> . </p><br><p>  The browser sends a hover event immediately after the mouse enters the area of ‚Äã‚Äãthe influencing element.  In the case of a pop-up window, I would like the event to be activated only after waiting a short period of time when the mouse is delayed on the element, so that when the mouse pointer briefly passes over the element, but there are no instant pop-up blinking windows on it.  Since the event does not come with delay support, this is another thing that I am going to implement myself.  Probably you need to add a second timer to the "mouse in" event handler: </p><br><blockquote>  <em>app / templates / base.html</em> : <em>Hover</em> delay. </blockquote><br><pre> <code class="hljs lua">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var timer = null; $(<span class="hljs-string"><span class="hljs-string">'.user_popup'</span></span>).hover( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { //   mouse <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var elem = event.currentTarget; timer = setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { timer = null; //  Popup    }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { //  mouse out var elem = event.currentTarget; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer) { clearTimeout(timer); timer = null; } } ) });</code> </pre> <br><p>  The <code>setTimeout()</code> function is available in the browser environment.  It takes two arguments: a function and a time in milliseconds.  The effect of <code>setTimeout()</code> is that the function is called after a specified delay.  So I added a function that is still empty, which will be called a second after sending the hover event.  Thanks to the closures in the JavaScript language, this function can access variables defined in the external scope, such as <code>elem</code> . </p><br><p>  I store the timer object in the timer variable, which I defined outside of the <code>hover()</code> call to make the timer object also accessible to the mouse out handler.  The reason why I need it is, once again, to leave a pleasant impression to the user.  If the user moves the mouse pointer to one of these user links and remains on it, but say, half a second before it triggers, the mouse pointer moves, in this case I do not want the Timer to read my delay and call the function that will display the pop-up window.  Therefore, my mouse out event handler checks if there is an active timer object, and if so, cancels it. </p><br><h2 id="zapros-ajax">  AJAX Request </h2><br><p>  Ajax requests are not a new topic, as I already mentioned in <a href="https://habrahabr.ru/post/350626/">Chapter 14</a> , as part of a living translation language.  When using jQuery, the <code>$.ajax()</code> function will send an asynchronous request to the server. </p><br><p>  The request that I am going to send to the server will have the URL <em>/ user / <code>&lt;username&gt;</code> / popup</em> , which I added to the application at the beginning of this chapter.  The response from this request will contain the HTML that I need to insert into the popup. </p><br><p>  My immediate problem regarding this request is to know what the <code>username</code> value I need to include in the URL.  The mouse in event handler function is universal, it will work for all user links that are on the page, so the function must determine the user name from its context. </p><br><p>  The variable <code>elem</code> contains the target element from the hover event, which is a <code>&lt;span&gt;</code> element that wraps the <code>&lt;a&gt;</code> element.  To retrieve the username, I can navigate the DOM, starting at <code>&lt;span&gt;</code> , going to the first child element, which is the <code>&lt;a&gt;</code> element, and then extracting the text, which is the username, that I need to use in my URL.  With jQuery DOM bypass functions, this is not difficult: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">elem</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.first</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.trim</span></span>()</code> </pre> <br><p>  The <code>first()</code> function applied to the DOM node returns its first child element.  The <code>text()</code> function returns the text content of the node.  This function does not trim the text, so, for example, if <code>&lt;a&gt;</code> is on one line, text is on the next line and <code>&lt;/a&gt;</code> on another line, the <code>text()</code> function will return all spaces that surround the text.  To remove all spaces and leave only text, I use the JavaScript <code>trim()</code> function. </p><br><p>  And this is all the information that I need to be able to issue a request to the server: </p><br><blockquote>  <em>app / templates / base.html</em> : XHR request. </blockquote><br><pre> <code class="hljs pgsql">$(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { var timer = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; var xhr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; $(<span class="hljs-string"><span class="hljs-string">'.user_popup'</span></span>).hover( <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) { //   mouse <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var elem = $(event.currentTarget); timer = setTimeout(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { timer = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; xhr = $.ajax( <span class="hljs-string"><span class="hljs-string">'/user/'</span></span> + elem.first().text().trim() + <span class="hljs-string"><span class="hljs-string">'/popup'</span></span>).done( <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(data) { xhr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> //       } ); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) { //   mouse <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> var elem = $(event.currentTarget); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer) { clearTimeout(timer); timer = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr) { xhr.<span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>(); xhr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //     } } ) });</code> </pre> <br><p>  Here I have defined a new variable in the external scope, <code>xhr</code> .  This variable will contain an asynchronous request object, which I initialize from the <code>$.ajax()</code> call.  Unfortunately, when building a URL directly on the JavaScript side, I cannot use <code>url_for()</code> from Flask, so in this case I must explicitly combine parts of the URL. </p><br><p>  Calling <code>$.ajax()</code> returns a promise (commitment), which is a special JavaScript object representing an asynchronous operation.  I can attach a completion callback by adding <code>.done (function)</code> , so my callback function will be called after the request is completed.  The callback function will receive a response as an argument, which I called <code>data</code> and you can see it in the code above.  This will be the HTML content that I'm going to put in the popover. </p><br><p>  But before we get to the popover, there is another detail related to providing the user with a convenient interface and good mood, which you need to take care of.  Recall that I added logic to the "mouse out" event handler function to cancel a one-second timeout if the user moved the mouse pointer out of a <code>&lt;span&gt;</code> .  The same idea should be applied to an asynchronous request, so I added a second condition to interrupt my <code>xhr</code> request object, if it exists. </p><br><h2 id="sozdanie-i-razrushenie-popover">  Creation and Destruction Popover </h2><br><p>  It is a significant moment. </p><br><p>  I can create a popover component, </p><br><p>  Using only the <code>data</code> argument </p><br><p>  From the Ajax callback function returned to me: </p><br><blockquote>  <em>app / templates / base.html</em> : Displays a popup window. </blockquote><br><pre> <code class="hljs actionscript"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function"> </span></span>{ xhr = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; elem.popover({ trigger: <span class="hljs-string"><span class="hljs-string">'manual'</span></span>, html: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, animation: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, container: elem, content: data }).popover(<span class="hljs-string"><span class="hljs-string">'show'</span></span>); flask_moment_render_all(); }</code> </pre> <br><p>  The actual creation of a popup window is not so difficult, the <code>popover()</code> function from Bootstrap will do all the work necessary to set it up.  Parameters for popover are given as an argument.  I set up this popover with a "manual" trigger mode, HTML content, without fading animation (so it appears and disappears faster), and I set the parent element as the <code>&lt;span&gt;</code> element itself, so the hover behavior extends to the popover by inheritance .  Finally, I pass the <code>data</code> argument to the Ajax callback as the <code>content</code> argument. </p><br><p>  Returning a <code>popover()</code> call is a newly added popover component that, for a strange reason, had another method, also called <code>popover()</code> , which is used to display it.  So I had to add a second <code>popover('show')</code> call for a pop-up window to appear on the page. </p><br><p>        "last seen" ( ),     Flask-Moment,    <a href="https://habrahabr.ru/post/349604/"> 12</a> .    <a href="https://github.com/miguelgrinberg/Flask-Moment"></a>      Flask-Moment  Ajax,  <code>flask_moment_render_all()</code>        . </p><br><p>          mouse out.          popover,    ,      .        ,  ,       ,     ,      <code>popover('destroy')</code>           . </p><br><blockquote> <em>app/templates/base.html</em> :  popover. </blockquote><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) { // mouse <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> var elem = $(event.currentTarget); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer) { clearTimeout(timer); timer = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr) { xhr.<span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>(); xhr = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { elem.popover(<span class="hljs-string"><span class="hljs-string">'destroy'</span></span>); } }</code> </pre> <br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://habrahabr.ru/post/353234/">There</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/353804/">https://habr.com/ru/post/353804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353790/index.html">Go: Good, bad, angry</a></li>
<li><a href="../353792/index.html">Final of the International Student Programming Olympiad Live</a></li>
<li><a href="../353798/index.html">Package Registry on Ethereum</a></li>
<li><a href="../353800/index.html">Microsoft Office Security: VBA Macros</a></li>
<li><a href="../353802/index.html">Using Multifactor Authentication in Citrix Based on Aladdin RD Solutions - Webinar</a></li>
<li><a href="../353806/index.html">My experience using Google AdWords Express</a></li>
<li><a href="../353808/index.html">OPA and SPIFFE - two new projects at CNCF for cloud application security</a></li>
<li><a href="../353810/index.html">Technical debt on the project or get out of the black hole</a></li>
<li><a href="../353812/index.html">Experiment "Free knowledge"</a></li>
<li><a href="../353814/index.html">46 skills and characteristics that make up the portrait of an ideal product manager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>