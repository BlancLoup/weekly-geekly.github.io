<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How does ReactJS work? React package</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most of the people working in the frontend in one way or another came across a reactor. This JavaScript library, which helps to create cool interfaces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How does ReactJS work? React package</h1><div class="post__text post__text-html js-mediator-article"><p>  Most of the people working in the frontend in one way or another came across a reactor.  This JavaScript library, which helps to create cool interfaces, has gained great popularity in recent years.  At the same time, not many people know how it works inside. </p><br><p> In this series of articles, we read the code and try to figure out what the packages that lie near the reactor under the hood are responsible for, what they are used for and how they work.  The most basic ones that we use in the browser are <code>react</code> , <code>react-dom</code> , <code>events</code> and <code>react-reconciler</code> . </p><br><p>  We will move in order and today we have an article about the <code>react</code> package.  Who cares what is in this package - go under the cat. </p><a name="habracut"></a><br><p>  First of all, we will make a small example on the basis of which we will consider this package.  Our gadget will look like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [text, changeText] = React.useState(<span class="hljs-string"><span class="hljs-string">'Initial'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"app"</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; &lt;span&gt;{text}&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/span&gt; &lt;input type="text" value={text} onInput={(e) =&gt; changeText(e.target.value)} /</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); } ReactDOM.render( &lt;App /</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">document</span></span></span></span><span class="hljs-function"><span class="hljs-params">.getElementById(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'root'</span></span></span></span></span><span class="hljs-function">) ) ;</span></span></code> </pre> <br><p>  Let's take a quick look at this piece of code.  Here we see a call to the hook via <code>React.useState('Initial')</code> , a bit of JSX and a call to the render method so that it all gets to the page. <br>  In fact, as many know, this is not the final code that the browser handles.  Before he gets into execution, he will get caught, for example, by Babel.  In this case, what the function returns will turn into the following: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.createElement( <span class="hljs-string"><span class="hljs-string">"div"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">"app"</span></span> }, React.createElement(<span class="hljs-string"><span class="hljs-string">"span"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, text), React.createElement(<span class="hljs-string"><span class="hljs-string">"input"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: text, <span class="hljs-attr"><span class="hljs-attr">onInput</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> changeText(e.target.value); } }) );</code> </pre> <br><p>  Who cares to experiment and see what your <a href="https://babeljs.io/repl">babel</a> code turns into - <a href="https://babeljs.io/repl">babel repl</a> . </p><br><h3 id="reactcreateelement">  React.createElement </h3><br><p>  So we got a lot of calls to <code>React.createElement()</code> and time to see what this function does.  We describe in words (or you can look at the file - <a href="">ReactElement.js</a> ). </p><br><p>  First of all, it checks if we have props (in the code, the object with the props that we passed is called <code>config</code> ). </p><br><p>  Next, we check if we have <code>key</code> and <code>ref</code> props which are not <code>undefined</code> , and save them, if any. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasValidKey(config)) { key = <span class="hljs-string"><span class="hljs-string">''</span></span> + config.key; }</code> </pre> <br><p>  An interesting point is that <code>config.key</code> is <code>config.key</code> to a string, which means that you can transfer any data type as a key, as <code>config.key</code> as it implements the <code>.toString()</code> or <code>.valueOf()</code> method and returns a unique value for a particular set. </p><br><p>  Next are the following steps: </p><br><ul><li>  copy the props that are passed to the element; </li><li>  we add the <code>children</code> field there, if we passed them not by a PSM, but as a nested element; </li><li>  set default values ‚Äã‚Äãfrom <code>defaultProps</code> for those properties that we have not previously defined. </li></ul><br><p>  When we have prepared all the data, we call an internal function that creates an object that describes our component.  This object looks like this: </p><br><pre> <code class="plaintext hljs">{ // This tag allows us to uniquely identify this as a React Element $$typeof: REACT_ELEMENT_TYPE, // Symbol // Built-in properties that belong on the element type: type, key: key, ref: ref, props: props, // Record the component responsible for creating this element. _owner: owner, }</code> </pre> <br><p>  Here we have the <code>$$typeof</code> property, which is a symbol, so we will not be able to slip what object we have. </p><br><p>  The <code>type</code> property stores the type of the element being created.  In the case of our example, this will be the <code>App()</code> function and the strings <code>'div'</code> , <code>'span'</code> and <code>'input'</code> . </p><br><p>  The <code>key</code> property will contain the same key that causes the warnings to fly to the console. <br>  Props will contain what we passed, <code>children</code> and what was specified in <code>defaultProps</code> .  The <code>_owner</code> property <code>_owner</code> necessary for correct work with <code>ref</code> . </p><br><p>  If we translate into our example, the result of <code>React.createElement(App, null)</code> look like this: </p><br><pre> <code class="plaintext hljs">{ $$typeof: REACT_ELEMENT_TYPE, type: App, key: null, ref: null, props: {}, _owner: null, }</code> </pre> <br><p>  In addition, in dev mode, we will have an additional field that will be used to display a beautiful stack with the file name and line: </p><br><pre> <code class="javascript hljs">_source: { <span class="hljs-attr"><span class="hljs-attr">fileName</span></span>: <span class="hljs-string"><span class="hljs-string">"/Users/appleseed/react-example/src/index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">lineNumber</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> }</code> </pre> <br><p><img src="https://habrastorage.org/webt/l6/gm/fz/l6gmfzluaizdzwt-ywbhhpy8cui.png" alt="stack error react"></p><br><p>  Let's summarize a little of what we saw above.  The <code>react</code> package acts as a translator between us and the rest of the packages that work further on our application, translating our calls into words that are understandable, for example, to a reconsiler. </p><br><h3 id="reactusestate">  React.useState </h3><br><p>  In the version of the reactor 16.8 appeared hooks.  What is it and how to use it you can read the <a href="https://reactjs.org/docs/hooks-intro.html">link</a> , and now we will take a look at what lies in the <code>react</code> package. </p><br><p>  In fact, there is not much to say here.  In essence, a package is a facade through which our calls go to internal entities. </p><br><p>  So, <code>useState</code> is nothing more than two lines of code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useState</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">S</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">initialState: ((</span></span></span><span class="hljs-function">) =&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">S</span></span></span><span class="hljs-function">) | </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">S</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatcher = resolveDispatcher(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dispatcher.useState(initialState); }</code> </pre> <br><p>  The rest of the hooks look almost identical.  Here we get the current dispatcher, which is an object and contains fields, for example, <code>useState</code> .  This dispatcher changes depending on whether our first render is now or we just want to update the component. </p><br><p>  The actual implementation of the hooks is stored in the <code>react-reconciler</code> package, which we will discuss in one of the following articles. </p><br><h3 id="chto-dalshe">  What's next </h3><br><p>  One more thing.  After reading this article, you can understand why we always import the package reak, even if we do not directly use it.  This is necessary so that after Babel digests our jsx, we have the <code>React</code> variable. </p><br><p>  The guys from the team reacted to this (and not only this) and are now working on replacing <code>createElement</code> . </p><br><p>  Trying to explain in two words: there is a desire to replace the current method of creating elements with two - <code>jsx</code> and <code>jsxs</code> .  This is necessary for several reasons: </p><br><ul><li>  we discussed above how <code>createElement</code> works.  He constantly copies props and adds a <code>children</code> field to the object, into which he saves children, which we passed as function arguments (3 arguments and more).  Now it is proposed to do this at the stage of converting <code>jsx</code> to <code>javascript</code> calls, because creating an element is a frequently called function and performing the modification of the props at runtime every time is not free; </li><li>  you can get rid of importing the <code>React</code> object and import only specific functions ( <code>import { jsx } from 'react'</code> , for example) and, accordingly, have the opportunity not to add to the assembly what we do not use.  In addition, it is not necessary to rezolvit the <code>createElement</code> field of the <code>React</code> object every time, because this is also not free; </li><li>  we discussed above that we have a special case when we take out the <code>key</code> from the props and forward it further.  Now it is proposed at the transpiling stage to take the <code>key</code> from <code>jsx</code> and pass it by the third parameter to the function of creating the element. </li></ul><br><p>  You can read more <a href="">here</a> .  The <code>react</code> package now has methods <code>jsx</code> and <code>jsxs</code> .  If you want to play around with it, you can clone the reactor repository, set the <code>enableJSXTransformAPI</code> flag to <code>true</code> in the <code>ReactFeatureFlags.js</code> <code>shared</code> package file <code>ReactFeatureFlags.js</code> set your version of the reactor ( <code>yarn build</code> ) with the new API enabled. </p><br><h3 id="final">  The final </h3><br><p>  At this <code>react</code> I‚Äôll finish today's story about the <code>react</code> package and next time we will talk about how the <code>react-dom</code> package uses what it creates <code>react</code> and which methods and how it implements. </p><br><p>  Thank you for reading to the end! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/448122/">https://habr.com/ru/post/448122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448110/index.html">Information Security of USB over IP Hardware Solutions</a></li>
<li><a href="../448114/index.html">8. Check Point Getting Started R80.20. NAT</a></li>
<li><a href="../448116/index.html">Intel Optane Memory H10 Hybrid Drive - Specifications</a></li>
<li><a href="../448118/index.html">SEO and contextual advertising - leads for 175 thousand rubles a day in Izhevsk</a></li>
<li><a href="../448120/index.html">About the proximity of the peaks</a></li>
<li><a href="../448124/index.html">Mikrotik. SMS control using WEB server</a></li>
<li><a href="../448126/index.html">API secrets of Android devices. Yandex report</a></li>
<li><a href="../448128/index.html">9 tips on using the Cats library in Scala</a></li>
<li><a href="../448130/index.html">De-design in video games</a></li>
<li><a href="../448136/index.html">Instruction: how to test ansible roles and learn about problems before production</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>