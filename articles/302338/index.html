<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intel Internet of Things Gateways: sending messages to a MQTT broker using Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we set up a gateway for the Internet of Things to send messages to the MQTT broker (server) using a Python script. Messages will be received by ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intel Internet of Things Gateways: sending messages to a MQTT broker using Python</h1><div class="post__text post__text-html js-mediator-article">  Today we set up a gateway for the Internet of Things to send messages to the MQTT broker (server) using a Python script.  Messages will be received by the computer, signed on the relevant topic on the broker.  After subscribing, messages posted with this topic will be sent to the computer.  In the process of studying this material you follow these steps: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/6f0/2e6/ae9/6f02e6ae993143edaab4ca297cf9200f.png"></div><br><ul><li>  Installing an MQTT client in Python on a computer. </li><li>  Configure MQTT broker. </li><li>  Installing an MQTT client on an Intel Core, Atom or Quark based gateway. </li><li>  Creating and running a script that sends MQTT messages from the gateway to the broker, which, ultimately, will go to the computer. </li></ul><a name="habracut"></a><br>  Here is the gateway, MQTT broker and computer interaction diagram. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe6/9dc/054/fe69dc05475d097f8d6b5fb406e71fc5.png"><br>  <i><font color="#999999">Gateway, MQTT broker and computer interaction</font></i> <br><br><h2>  <font color="#0071c5">MQTT</font> </h2><br>  MQTT is a messaging protocol that can be used to transfer data from a gateway to a local or cloud server.  The server redirects data to remote clients who have subscribed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here's what you can find out about MQTT from <a href="https://en.wikipedia.org/wiki/MQTT">Wikipedia</a> : ‚ÄúMQTT (formerly known as MQ Telemetry Transport) is a simplified network protocol that runs on top of TCP / IP.  It is used for messaging between devices on a ‚Äúpublisher-subscriber‚Äù basis.  The protocol is designed to communicate with remote devices, in cases where it is important that the code takes up as little space as possible, as well as to work in networks with low bandwidth.  The publisher-subscriber interaction scheme requires a broker, an intermediary between the sender and the receiver.  The broker is responsible for delivering messages to customers who are interested in these messages, based on the topics of messages and subscriptions issued by customers. ‚Äù <br><br>  There are several software packages for creating MQTT brokers.  They differ in their capabilities, in some of them, on top of the standard MQTT protocol, additional functions are implemented.  <a href="https://github.com/mqtt/mqtt.github.io/wiki/server-support">Here is a</a> comparison of several brokers. <br><br><h2>  <font color="#0071c5">Mosquitto</font> </h2><br>  <a href="http://mosquitto.org/">Mosquitto</a> is an open source MQTT broker (BSD license) that implements the MQTT version 3.1 protocol.  and 3.1.1.  In this tutorial we will look at using Mosquitto to deploy an MQTT broker on a local network. <br><br><h2>  <font color="#0071c5">Python and MQTT</font> </h2><br>  The <a href="https://www.python.org/">Python</a> programming <a href="https://www.python.org/">language</a> can be used to create MQTT messages.  The choice can fall exactly in Python if, for example, code written in this language is easily embedded in the application, or if the developer is familiar with Python.  Sometimes this language is convenient to use due to the fact that programs written on it do not need to be compiled.  They are interpreted on the gateway at run time. <br>  The Python interpreter is included in the standard set of pre-installed software on Intel Gateways for the Internet of Things running Wind River Linux.  Thus, Python scripts can be executed on gateways without additional configuration of the working environment.  So, the Python 2.7.2 interpreter is included in Wind River Linux 5 and in Intelligent Device Platform XT 2. In Wind River Linux 7 and in Intelligent Device Platform XT 3.1, there is Python 2.7.3 and 3.3.3. <br><br><h2>  <font color="#0071c5">Paho</font> </h2><br>  <a href="http://www.eclipse.org/paho/clients/python/">Paho's</a> Python client provides a client class that supports MQTT v3.1 and v3.1.1 on Python 2.7 and 3.1.1.  In addition, it contains some helper functions that greatly simplify the publication of MQTT messages. <br><br><h2>  <font color="#0071c5">Computer settings</font> </h2><br>  Consider setting up a computer that you plan to use to subscribe to messages with some kind of test subject on an MQTT broker on the Internet.  After the computer subscribes to the topic, messages published with this topic will be delivered to it. <br><br>  In order to set up a computer, you will need, first, to install Paho and related software, and second, to test the system by connecting to a broker. <br><br><h3>  <font color="#0071c5">Prerequisites</font> </h3><br><ul><li>  Ubuntu Linux 12.04 or higher must be installed on the computer. </li><li>  The computer is connected to the Internet. </li><li>  The computer must have a connection with the MQTT broker. </li><li>  Broker can be located either in the local network or on the Internet. </li><li>  The firewall, if used, should not block the two-way exchange of information using the ports 1883, 8883, 8884, and 8885 that are open on the computer. </li></ul><br><h3>  <font color="#0071c5">Paho installation</font> </h3><br>  <b>1.</b> Download the <code>tar.gz</code> archive with the latest version of Paho from <a href="http://git.eclipse.org/c/paho/org.eclipse.paho.mqtt.python.git/">eclipse.org</a> .  In our case, it was the <code>org.eclipse.paho.mqtt.python-1.1.tar.gz</code> . <br><br>  <b>2.</b> Place this file in the selected directory. <br><br>  <b>3.</b> Unzip the archive.  For example, with the following command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tar</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-xf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.eclipse</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.paho</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mqtt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.python-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.tar</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.gz</span></span></code> </pre> <br>  <b>4. The</b> contents of the archive will be in a folder whose name matches its name.  Navigate to this folder, and rename it if necessary. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">cd</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.eclipse</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.paho</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mqtt</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.python-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre> <br>  <b>5.</b> Run the following python commands: <br><br><pre> <code class="hljs sql">python setup.py <span class="hljs-keyword"><span class="hljs-keyword">install</span></span></code> </pre> <br>  Paho is now installed on the computer. <br><br><h3>  <font color="#0071c5">Paho Testing</font> </h3><br>  Test the Python script using Paho, and at the same time connect to the MQTT broker by subscribing to the active topic.  For example, if you are interested in a broker located on the Internet, you can use the broker <code>test.mosquitto.org</code> for testing.  This will allow you to check both the network connection and the operation of the software. <br><br>  <b>1.</b> Go to the directory with examples for Paho: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> org.eclipse.paho.mqtt.python/examples</code> </pre> <br>  <b>2.</b> Modify the <code>sub.py</code> script by editing the <code>mqttc.connect</code> and <code>mqttc.subscribe</code> : <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">mqttc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.connect</span></span>("<span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mosquitto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.org</span></span>", 1883, 60) <span class="hljs-selector-tag"><span class="hljs-selector-tag">mqttc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.subscribe</span></span>("#", 0)</code> </pre> <br>  Consider these commands: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Mqttc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.connect</span></span> ‚Äî <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.mosquitto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.org</span></span>:  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MQTT-</span></span>,     . ‚Äî 1883: ,    <span class="hljs-selector-tag"><span class="hljs-selector-tag">MQTT-</span></span>. ‚Äî 60: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span>  </code> </pre> <br><pre> <code class="hljs erlang">Mqttc.subscribe ‚Äî #:  ,    ,       . ‚Äî <span class="hljs-number"><span class="hljs-number">0</span></span>:     (Quality <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Service, QoS).</code> </pre> <br>  <b>3.</b> Run the script: <br><br><pre> <code class="hljs perl">python <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">py</span></span></span></span></code> </pre> <br>  If the network connection and the program are working properly, <code>test.mosquitto.org</code> will be received from the MQTT broker <code>test.mosquitto.org</code> .  Their content does not interest us now.  If nothing comes, check the connection to the Internet and the edited lines of the <code>sub.py</code> script. <br><br>  <b>4.</b> To stop the script, use the keyboard <code> Ctrl-C</code> . <br><br><h2>  <font color="#0071c5">Set up MQTT broker and subscription</font> </h2><br>  In the previous section, we installed Paho on a computer and tested it.  Now consider the features of MQTT brokers.  Our goal is a working broker who can receive messages from publishers and send them to subscribers.  There are several options for organizing interaction with the broker, they are all suitable for, in order to reproduce what we describe below. <br><br><ul><li>  Already configured broker located in the local network or on the Internet (in the cloud).  This approach will allow the use of an existing broker.  This broker should be ready to receive and send messages.  In this case, you should be able to create on it the necessary topics, if they have not yet been created. <br><br></li><li>  New broker in the local network, created using Paho.  This broker will work on the computer.  At the same time, whether it will be the same computer that receives messages from the gateway, or another, does not play a special role.  To create a broker, you can use the appropriate Paho libraries for Python. <br><br></li><li>  New broker in the local network, created using Mosquitto.  Such a broker will also work on a computer, but to create it you will need to use Mosquitto. <br></li></ul><br><h3>  <font color="#0071c5">Using an existing broker connected to a local network</font> </h3><br>  Best of all, if you already have an MQTT broker, ready to work with the application.  It must be located on the selected network, must be ready to send and receive messages for the application, you must be able to configure it.  If you already have a ready-to-work broker, you can skip straight to the section on setting up the gateway. <br><br>  If you have not yet set up a broker, there are several ways to get a simple MQTT broker to test the application.  Now we will consider them.  Please note that here we are not concerned with the configuration of servers or networks.  In addition, among the options listed below for working with existing brokers or ways of setting up new ones, you will need only one.  Therefore, by selecting it and configuring the system, you can also proceed to the section on configuring the gateway. <br><br><h3>  <font color="#0071c5">Paho: working with an existing broker, accessible via the Internet</font> </h3><br>  On the Internet, you can find several MQTT brokers that are suitable for testing.  Here we will use a broker available at <a href="http://test.mosquitto.org/">http://test.mosquitto.org/</a> .  We have already talked about it, testing the correctness of the system, not paying attention to any topics or messages.  Now we use it for more meaningful work and with that, and with another. <br><br>  The procedure for interacting with this broker is already familiar to you, under the Paho Testing section.  However, here we, instead of subscribing to all topics with the <code>mqttc.subscribe("#", 0)</code> command, <code>mqttc.subscribe("mytopic", 0)</code> to a specific topic with the <code>mqttc.subscribe("mytopic", 0)</code> command.  Here <code>mytopic</code> is the name of the MQTT theme.  The broker will automatically create such a topic if it does not already exist. <br><br>  Now, if the gateway (or any other computer) sends a message to the broker with the <code>mytopic</code> theme, the broker will send this message to the terminal window in which the <code>sub.py</code> script <code>sub.py</code> . <br><br><h3>  <font color="#0071c5">Installing an MQTT broker on a local network using Paho</font> </h3><br>  Use this method if you want your computer to play the role of an MQTT broker located on a local network.  Here, we will need the previously installed Paho Python libraries.  The setup procedure is generally similar to the one already discussed.  However, you need to pay attention to the fact that the computer and the gateway must be on the same local network, and that the beginning of interaction with the broker (in the <code>sub.py</code> script) looks like this: <br><br><pre> <code class="hljs pgsql">mqttc.<span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>("localhost", <span class="hljs-number"><span class="hljs-number">1883</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>) mqttc.subscribe("mytopic", <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  That is, we are connecting not to the server on the Internet, but to the local host, to the network interface of the "internal loop" of the computer.  Usually localhost is used as an alias for the IP address 127.0.0.1. <br><br>  If you subscribe to the topic <code>mytopic</code> , referring to the local host, a local MQTT broker will be automatically launched and such a topic will be created on it.  If the gateway now publishes a message with the <code>mytopic</code> theme, contacting the computer at its IP address, this message will be sent to the Linux terminal, in which the <code>sub.py</code> script that subscribed to this topic is executed. <br><br><h3>  <font color="#0071c5">Installing an MQTT broker on a local network using Mosquitto</font> </h3><br>  This method, again, involves using the developer‚Äôs computer as a broker located on the local network.  But this time we will use Mosquitto. <br><br>  Details about Mosquitto can be found <a href="http://mosquitto.org/">here</a> .  In addition, the construction of the form <code>&lt;mosquitto_command&gt; --help</code> allows you to get help on the commands of this package.  In order to start the process of the MQTT broker on the computer, follow these steps. <br><br>  <b>1.</b> Open a new Linux terminal window. <br>  The broker will be executed in this window, while on the same computer you can receive MQTT messages, only they will arrive in another terminal window. <br><br>  <b>2.</b> Install Mosquitto, if you have not already done so. <br><br><pre> <code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install mosquitto</code> </pre> <br>  <b>3.</b> Create a theme and subscribe to it using the <code>mosquitto_sub</code> . <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mosquitto_sub</span></span> -d -h localhost -t mytopic</code> </pre> <br>  Consider this command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span>:    . <span class="hljs-selector-tag"><span class="hljs-selector-tag">-h</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span>:  ‚Äì   <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP-</span></span> 127<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">-t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mytopic</span></span>:  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MQTT-</span></span>.    ,    .</code> </pre> <br>  <b>4.</b> Check if the computer is connected to the same local network that the gateway is connected to. <br>  The local MQTT broker will start automatically after subscribing to a certain topic.  The gateway, by contacting the broker at the IP address of the computer, will be able to publish messages with this topic, which will go to the Linux terminal, where <code>mosquitto_sub</code> is <code>mosquitto_sub</code> . <br><br><h2>  <font color="#0071c5">Gateway Setup</font> </h2><br>  Let's do the configuration of the gateway.  It involves two basic steps: <br><br><ul><li>  Installing an MQTT client written in Python on the gateway. <br><br></li><li>  Connecting the gateway to the test MQTT broker to check for a network connection and correct script operation. </li></ul><br><h3>  <font color="#0071c5">Prerequisites</font> </h3><br><ul><li>  This example uses a gateway that runs Wind River Linux 7 with Wind River Intelligent Device Platform XT 3.1.  If your gateway uses a different OS, its configuration process may differ from the one shown here. <br><br></li><li>  The gateway's operating system must be compiled using the - <code>withtemplate=feature/mqtt</code> in the settings.  See here for more details. <br><br></li><li>  The gateway must be connected to the same network as the MQTT broker, provided that the broker is located on the local network. <br><br></li><li>  If you use an MQTT broker that is hosted on the Internet and use a firewall, it should not block ports 1883, 8883, 8884, and 8885. <br></li></ul><br><h3>  <font color="#0071c5">Installing Paho on the gateway</font> </h3><br>  Installing Paho on the gateway is the same as installing on a computer.  You need to download the archive with the latest version of Paho, unpack it and execute the <code>python setup.py install</code> command. <br><br><h3>  <font color="#0071c5">Checking work with MQTT-broker, posted on the Internet</font> </h3><br>  The procedure for checking the operability of the software installed on the gateway and the network connection repeats the procedure for checking the computer. <br><br><h3>  <font color="#0071c5">Sending and receiving MQTT messages</font> </h3><br>  Now that we have a ready-to-work MQTT broker, a computer and a gateway are set up, everything is ready to create a Python script that will publish messages. <br><br>  Here we will use the code samples from the Paho distribution to create a simple script that can be modified later to fit the needs of a specific project.  The script can be created both directly on the gateway and on the computer.  If the script is created on the computer, it will need to be copied to the gateway and run there. <br><br><h3>  <font color="#0071c5">Security</font> </h3><br>  Consider the following considerations when creating and running Python scripts. <br><br><ul><li>  If you use the built-in Python interpreter, IMA-security does not hurt, allowing the interpreter to execute new scripts. <br><br></li><li>  If you do not use the built-in Python interpreter, and, at the same time, IMA-security is enabled, each script must be signed before starting. <br><br></li><li>  If McAffee Embedded Control is enabled on the gateway, the script must be added to the whitelist. </li></ul><br>  In the example below, we assume that neither IMA nor the white lists on the gateway are included. <br><br><h3>  <font color="#0071c5">Creating and running a Python script to publish MQTT messages</font> </h3><br>  <b>1.</b> Go to the <code>examples</code> folder, which contains code samples for Paho: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> org.eclipse.paho.mqtt.python-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>/examples</code> </pre> <br>  <b>2.</b> Copy and rename the <code>pub-single.py</code> script: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">cp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pub-single</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">my-pub</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span></code> </pre> <br>  <b>3.</b> Edit the <code>my-pub.py</code> file, changing its last line so that the message is sent to the existing MQTT broker and when sending it, the theme that was set when we set up the computer to receive MQTT messages was used (we called the "Mytopic"): <br><br><pre> <code class="hljs objectivec">publish.single(<span class="hljs-string"><span class="hljs-string">"mytopic"</span></span>,<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, hostname=<span class="hljs-string"><span class="hljs-string">"&lt;broker_location&gt;"</span></span>)</code> </pre> <br>  Consider the device of this command: <br><br><pre> <code class="hljs erlang">‚Äî <span class="hljs-string"><span class="hljs-string">"mytopic"</span></span>:  ,   . ‚Äî <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>:   ‚Äî <span class="hljs-string"><span class="hljs-string">"&lt;broker_location&gt;"</span></span>:  MQTT-.</code> </pre> <br>  If a computer is used as a broker, you need to substitute its IP address in the local network here.  For example, something like 192.168.1.5.  If the broker is on the Internet, then there must be either its IP address or the domain name of the server.  For example, <code>test.mosquitto.org</code> . <br><br>  <b>4.</b> If you were preparing the <code>my-pub.py</code> script on a computer, copy it to the gateway. <br><br>  <b>5.</b> Run <code>my-pub.py</code> on the gateway to send a message from it to the specified MQTT broker with the <code>mytopic</code> theme: <br><br><pre> <code class="hljs perl">python <span class="hljs-keyword"><span class="hljs-keyword">my</span></span>-pub.py</code> </pre> <br><h2>  <font color="#0071c5">Receive MQTT messages on a computer</font> </h2><br>  After the gateway publishes a message with a topic, and the broker receives the message, it will send a message to all MQTT clients that are subscribed to the topic. <br><br>  To publish, given the settings of our script, just run the <code>python my-pub.py</code> command <code>python my-pub.py</code> on the gateway.  When it is executed, the ‚ÄúHello‚Äù message will be sent to the broker, and the computer will be sent from it.  On the same computer, given that it has a terminal window open, waiting for messages from an MQTT broker, a message with the following content will be received: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mytopic</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Hello</code> </pre> <br>  Consider its structure: <br><br><pre> <code class="hljs">mytopic:  . 0:   Hello: </code> </pre> <br><h2>  <font color="#0071c5">Results and ideas</font> </h2><br>  You have just, using the Python programming language, sent an MQTT message ‚ÄúHello‚Äù with the subject line ‚Äúmytopic‚Äù to an MQTT broker located on the local network, and then received this message on a computer that is subscribed to this topic.  What's next?  Here are some ideas that relate to the development of an example from this material.  We hope they will allow you to expand the use of the MQTT message exchange system in your projects. <br><br><ul><li>  If there are sensors in the system, the gateway can read their readings and publish them as MQTT messages. <br><br></li><li>  MQTT messages are well suited for transmitting some information intended for storage in a cloud or local database.  If this scenario corresponds to the system you are working on, consider it. <br><br></li><li>  Increase the payload carried by messages, perhaps by using a more complex structure of messages and topics. <br><br></li><li>  Experiment with Paho features that allow you to send multiple messages with one command. <br><br></li><li>  Increase the security of the MQTT messaging system by encrypting, authenticating clients, using whitelists or other means. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/302338/">https://habr.com/ru/post/302338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302326/index.html">Straight Talk with an Algorithmic Trader</a></li>
<li><a href="../302328/index.html">XSS vulnerability still persists for wordpress</a></li>
<li><a href="../302332/index.html">Configuring D-link DFL-260E / 860E / 1660/2560 / 2560G Firewalls to work with 3CX Phone System</a></li>
<li><a href="../302334/index.html">GoTo hell. Summer Schools on Programming, Data Analysis and Robotics for the most stupid high school students</a></li>
<li><a href="../302336/index.html">How to unload a logically consistent data set from several tables in the database under OLTP load</a></li>
<li><a href="../302340/index.html">How to communicate with customers and negotiate project work</a></li>
<li><a href="../302342/index.html">HP 3PAR Storage Lineup</a></li>
<li><a href="../302344/index.html">Failover cluster of Windows Server in Microsoft Azure. Network</a></li>
<li><a href="../302348/index.html">Sudden advertising in your video on Youtube: why it appears and how to remove it</a></li>
<li><a href="../302350/index.html">Linux for a novice developer or how to forget about Windows forever</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>