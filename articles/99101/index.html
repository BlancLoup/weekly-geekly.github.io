<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Technical report launch eventr.com numbers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the request of habraludey lay out a short technical report. 
 Let me remind you, Eventr is a web-service where you can conveniently read RSS feeds,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Technical report launch eventr.com numbers</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://eventr.com/"><img src="https://habrastorage.org/storage/habraeffect/d3/35/d335575c68d2e577860d8cd61d29fbbf.jpg" alt="image" align="left"></a>  At the request of habraludey lay out a short technical report. <br>  Let me remind you, Eventr is a web-service where you can conveniently read RSS feeds, share in two clicks, share interesting posts with others, run your blog. <br><br>  We <a href="http://habrahabr.ru/blogs/startup/98797/">started the</a> day on Sunday, July 11th, an hour later we <a href="http://twitter.com/Ru_Eventr/status/18284843221">went under the habra effect</a> .  Actually, our magic spells and numbers under the cut. <br><br>  <b>What will be said:</b> <br><ol><li>  Some technical difficulties </li><li>  RSS / Atom reader, numbers </li><li>  Habraeffect, numbers </li><li>  Rake </li><li>  Mongodb, nodejs, redis </li></ol><a name="habracut"></a><h4>  At the time of Wednesday - 3 days from the start </h4><br>  <b>3,050</b> users <br>  <b>~ 200</b> users online who read an average of 5 records per second <br>  <b>22,340</b> streams (of which 18,546 are external rss / atom feeds) <br>  <b>~ 25</b> feeds per second updated by background servers <br>  <b>811,614</b> news (including user generated) <br>  <b>727</b> imports totaling 47,032 feeds (not counting repetitions) <br>  <b>207</b> user feedbacks processed 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Launch </h4><br>  I described the main technical aspects earlier in <a href="http://habrahabr.ru/blogs/webdev/95526/">another article</a> .  Since then, something has changed, redis and capistrano have been added to the ‚Äúzoo‚Äù. <br><br>  The main difficulty is an empty database.  It was necessary to withstand an indefinite number of OPML imports with an indefinite number of feeds, and most importantly, for a limited period of time.  Predicting the load turned out to be an impossible task, so we simply locked our teeth and watched <a href="http://en.wikipedia.org/wiki/Load_(computing)">LA</a> grow and the size of the queues on our servers. <br><br>  At the moment, the most difficult thing for the system is to keep more than 18 thousand external sources up to date.  And also keep individual records of read entries for each user.  Everything else is the little things in life. <br><br><h4>  Habraeffect, numbers </h4><br>  Registration Schedule / OPML Import / Total Number of Feeds <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/6f/72/6f7242c90b9001ddcfc39a48bc20ac2d.jpg"></a> <br><br>  This graph shows the number of imports, in 10-minute increments.  Near the growth of users and the total number of feeds in the system.  Most of the time we pulled on the first day. <br>  Subsequent imports used existing feeds. <br><br><h4>  Other numbers </h4><br>  <b>Mongodb:</b> <br>  Total objects: 1,028,554 <br>  Total size: 3.17 GB (of which 2.76 GB content from feeds) <br>  Index size: 465 MB <br>  Eats CPU: ~ 2% <br>  Eats RAM: 3.2 GB <br>  Mongo time for a comprehensive delivery of the average page (without caching): 0.3 sec <br>  Locks are almost not felt. <br><br>  <b>Nodejs:</b> <br>  Eats memory: ~ 20 MB <br>  CPU does not eat at all. <br><br><h4>  Rake </h4><br>  <b>Weak servers.</b>  Initially, we started with two physical servers and 12 openvz virtualoks.  The idea is simple: the load is growing - we are buying new hardware, we are migrating ready-made images - very convenient. <br>  The first error is a web instance (nginx, php-fpm) on a weaker server.  Almost immediately - LA 40, after which, he simply stopped responding to ssh.  Transferring it to a more powerful server took half an hour. <br><br>  <b>Mongodb replication under load.</b>  The Mongol slave, which was on a weaker server, did not have time to read the oplog (for synchronization), which led to the loss of the version of the static (which was stored at that time in Mongo).  In the aftermath, some users saw a very beautiful eventr without styles and pictures.  Transferred the version of a statics to redis. <br><br>  <b>System and user queues on the same server.</b>  The more feeds in the system, the more resources need to be permanently updated (to maintain relevance).  After half an hour of the service, the queue was completely clogged with background updates and forced out user requests in the form of imports or a separate addition of external feeds.  At that time, the queue was on average from 5 to 15 thousand tasks. <br>  In the hottest time, while we were carrying new servers, we connected our laptops to the queue - it helped :) In the meantime, users with imports were indignant. <br>  At the moment, we have four background servers.  Three of them are for background updates, one is for custom queues.  Now processing more than 18 thousand feeds does not affect the speed of the interface and user actions like import. <br>  After installing the new servers, we had to strain them very seriously in order to quickly unload the accumulated queue.  At that time, the speed reached <b>100</b> threads / second.  Now to maintain the entire base is enough 25 per second. <br><br>  <b>Zend_Date.</b>  It turned out that his calls occupied 70% of the total time for rendering templates.  Himself in shock.  Also, Zend_View partial and placeholder - they were completely abandoned. <br><br><h4>  Pleasant moments </h4><br>  <b>Mongodb</b> <br>  Showed very nice numbers.  Indices work like a clock.  Convenient administration, scaling, and, most importantly, migration. <br><br>  <b>nodejs</b> <br>  Very sharp.  Convenient and fast development.  Perfect garbage collection and fault tolerance.  Considering that the whole background works on it (read more in the <a href="http://habrahabr.ru/blogs/webdev/95526/">previous article</a> ), I can call nodejs the most enjoyable thing I have ever met.  The only thing is not a very convenient interface to work with mongodb.  With redis it is convenient. <br><br>  <b>redis</b> <br>  On it: cache, queues, locks.  Super fast and very comfortable.  Also, for communication between servers, its PubSub is used.  Ideal for rialtime items.  We use <a href="http://rediska.geometria-lab.net/">radish</a> in php, special thanks to <a href="http://habrahabr.ru/users/shumkov/" class="user_link">Shumkov</a> for support. <br><br>  <b>capistrano</b> <br>  I highly recommend it to everyone.  The 10 instance instl of hand-made routine turns into a pleasant contemplation of a multi-colored console that does everything for you. <br><br>  <b>zabbix</b> <br>  In comparison with nagios, for me it turned out to be more convenient.  It is very easy to add specific triggers and get beautiful Rialtime graphics on them. <br><br><h4>  Generally </h4><br>  For ourselves, we once again understood that decisive actions can lead to mistakes, but it is errors that make it possible to draw conclusions.  And, having drawn conclusions, to avoid not only past but also many new potential errors, and therefore move forward and develop.  Understood that in the first place, it is the users, and not advisers, analysts can help the service become really useful and necessary for people. <br><br>  We are grateful to all those who sent feedback, as well as all users of the first beta eventr.com. <br>  We continue to work on improving the reliability and convenience of service. <br><br>  Thank. </div><p>Source: <a href="https://habr.com/ru/post/99101/">https://habr.com/ru/post/99101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99093/index.html">Swiftpoint mouse available for pre-order</a></li>
<li><a href="../99094/index.html">Your qTrack mail</a></li>
<li><a href="../99095/index.html">Create your own theme for the symfony CRUD generator</a></li>
<li><a href="../99096/index.html">KC finally violated the rules of priority registration</a></li>
<li><a href="../99100/index.html">Bitcoin (‡∏ø): peer cryptocurrency</a></li>
<li><a href="../99104/index.html">Vulnerability Windows Help and Support Center (CVE-2010-1885) in numbers</a></li>
<li><a href="../99105/index.html">The long-awaited release of ActiveMesa R2P Lite</a></li>
<li><a href="../99107/index.html">NerdDinner. Step 3: Build a Model</a></li>
<li><a href="../99108/index.html">Image resizing at 180 per second</a></li>
<li><a href="../99111/index.html">Scrum requirements assessment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>