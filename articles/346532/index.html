<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of lossy audio coding. Testing Opus 1.3 Beta</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. About the author 
 Hello everyone, my name is Maxim Logvinov and I am a student of Kharkov National University of Radio Electronics. 

 I was alway...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of lossy audio coding. Testing Opus 1.3 Beta</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/955/197/60f/95519760fdb3fdc36437dff5e136c750.png" alt="image"><br><br><h1>  <font color="#292e5b">0. About the author</font> </h1><br>  Hello everyone, my name is Maxim Logvinov and I am a student of Kharkov National University of Radio Electronics. <br><br>  I was always interested in sound and music.  I myself liked <a href="http://promodj.com/devliner">to write</a> electronic dance music and I was always interested as a person who is not well versed in the high matters of mathematics, to find out what happens to sound in a computer: how it is written, compressed, what technologies exist for this, and so on.  After all, from school and physics, I understood that sound is ‚Äúanalog‚Äù: it is not enough to convert it to digital (which requires devices such as ADCs), but it must somehow be preserved.  Better yet, this music takes up less disk space so that you can put more music into the mean folder.  And that sounded good, without any audible compression artifacts.  Musician after all.  A trained ear that is not devoid of a musical ear is difficult to deceive using methods that are used to compress sound with losses, at least at fairly low bit rates.  Oh, how fastidious. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And let's see what sound is, how it is encoded, and what tools are used for this encoding itself.  Moreover, let's experiment with the bitrates of one of the most advanced codecs to date - Opus and evaluate what you can encode with which digits to eat the fish, and ... Actually, just why not?  Why not try to describe in simple language not only how computer audio is stored and encoded, but also to test one of the best codecs today?  Especially, if we are talking about ultra-low bitrates, where almost all existing codecs are starting to create incredible things with sound in an attempt to meet the small file size.  If you want to escape from the routine and find out what conclusions were obtained when testing the new codec - welcome under the cat. <br><a name="habracut"></a><br><h1>  <font color="#292e5b">1. Audio encoding</font> </h1><br>  The sound has a physical nature.  Any sound is a vibration in space (in this case, in the air), which is captured by our ear.  Oscillations are continuous, which can be described by mathematical models.  Of course, we will not do this, but we will ask ourselves the question: how are vibrations of a continuous nature recorded in a machine that operates only with zeros and ones? <br><br><h4>  <font color="#4650a9">1.1.</font>  <font color="#4650a9">No compression, no loss</font> </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/f8f/8a4/cc9/f8f8a4cc9055a4e3da52baddf0111d1c.png" alt="image"><br>  <i>Fig.</i>  <i>1.1 - Graphic description of pulse code modulation</i> <br><br><blockquote>  The <a href="https://ru.wikipedia.org/wiki/WAV">WAV (WAVE)</a> format saves the audio track in its true quality, without performing any manipulations with the audio file itself. </blockquote><br>  In order to record the sound, we need to convert it to a set of zeros and ones.  In the case of the WAV format, this is done in the most stupid way: the incoming audio stream is divided into the smallest segments (quanta, hence the terms "quantization frequency", "sampling frequency" or " <i>sampling frequency</i> ") and the current value of the analog signal is written in binary to each such time interval form.  WAV files can be recorded at a sampling rate, for example, from 8 kHz to 192 kHz, but, de facto, the sampling rate of 44.1 kHz is considered the standard. <br><br>  It should be noted that WAV, as a container, supports other ways of storing audio information: for example, <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B4%25D0%25B0%25D0%25BF%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B4%25D0%25B8%25D1%2584%25D1%2584%25D0%25B5%25D1%2580%25D0%25B5%25D0%25BD%25D1%2586%25D0%25B8%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BC%25D0%25BF%25D1%2583%25D0%25BB%25D1%258C%25D1%2581%25D0%25BD%25D0%25BE-%25D0%25BA%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">ADPCM</a> , which is capable, depending on bandwidth, to encode audio data with a variable sampling rate. <br><br><blockquote>  The frequency of 44.1 kHz did not happen by chance.  If you allow inaccuracies in the description, this figure occurred as a statement of <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B0_%25D0%259A%25D0%25BE%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25B0">Kotelnikov</a> 's theorem: to maintain the most correct waveform at frequencies up to 20 kHz (theoretical limit of hearing of the human ear), the sampling rate is twice as high - 40 kHz.  Actually, the frequency of 44.1 kHz is due to technical aspects, the details of which can be found <a href="https://audiophilesoft.ru/publ/theory/why_44100/6-1-0-281">here</a> . </blockquote><br>  In each such segment, the actual voltage of the analog signal is encoded in binary form: the highest level can be represented as ‚Äú1111‚Äù, the lowest - as ‚Äú0000‚Äù.  And here comes the second parameter - the depth of sound, which determines how accurately the wave value will be digitized in the interval of time.  Often, WAV format files are written with a resolution of 16 bits or 32 bits.  Higher digit capacity - more precisely record. <br><br><blockquote>  Speaking of PCM.  What is the record on an ordinary CD that was so popular after audio cassettes?  That is - a stream of uncompressed zeros and ones in PCM format.  The bit width is 16 bits, the sampling rate is 44.1 kHz.  What then will the bitrate of such a record? </blockquote><br><ul><li>  44,100 times a second is written a 16-bit number.  44100 * 16 = 705600 bps for one channel; </li><li>  for stereo recording, this value is multiplied by 2 - 1411200 bps or ours ~ 1411 kbps; </li><li>  for 32-bit recording, this value will be twice as large - ~ 2822 kbps. </li></ul><br>  Conclusion: hence the gluttony of these files to the free space on the hard disk, but as a win there is a complete lack of loss when recording and listening to the audio file. <br><br><h4>  <font color="#4650a9">1.2.</font>  <font color="#4650a9">Lossless compression</font> </h4><br>  On lossless compression, I will not write much.  This term can be found <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B6%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B5_%25D0%25B7%25D0%25B2%25D1%2583%25D0%25BA%25D0%25B0_%25D0%25B1%25D0%25B5%25D0%25B7_%25D0%25BF%25D0%25BE%25D1%2582%25D0%25B5%25D1%2580%25D1%258C">here</a> .  In fact, this method is, to put it bluntly, the archiving of audio recordings by algorithms embedded in the codec, but the data are not lost and the possibility to restore audio recording with bit-to-bit accuracy is preserved.  When decoding such formats, we get, in fact, the same WAVE format, only it takes up less disk space;  Compression is approximately twofold and depends on the nature of the coded composition.  When listening to a recording, the codec "unarchives" the composition and sends a stream of uncompressed zeros and ones to the sound card processing. <br><br>  There are quite a lot of such codecs: these are <a href="https://ru.wikipedia.org/wiki/FLAC">FLAC</a> (Free Lossless Audio Codec), developed by <a href="https://www.xiph.org/">Xiph</a> (it also developed Opus), <a href="https://ru.wikipedia.org/wiki/Apple_Lossless">ALAC</a> (Apple Lossless) from the company of the same name, <a href="https://ru.wikipedia.org/wiki/Monkey%25E2%2580%2599s_Audio">APE</a> (Monkey's audio), <a href="https://ru.wikipedia.org/wiki/WavPack">WV</a> (WavPack) and other, less well-known lossless audio compression formats. <br><br><h4>  <font color="#4650a9">1.3.</font>  <font color="#4650a9">Compression with losses - deceive your ears</font> </h4><br>  Scientists' minds began to think that, in principle, it often does not make sense to keep complete information about the recording, since our ear is imperfect.  It may not hear low sounds after loud sounds, it may not hear too high or too low frequencies, and so on.  These phenomena are called the disguise effect. <br><br>  As a result, they understood: you can throw it away <i>here</i> , prune <i>there</i> , and the listener will notice almost nothing - an imperfect ear will simply enable the listener to deceive himself.  Therefore, it is possible to get rid of psychoacoustic redundancy in the file. <br><br>  Actually, <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2581%25D0%25B8%25D1%2585%25D0%25BE%25D0%25B0%25D0%25BA%25D1%2583%25D1%2581%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0">psychoacoustics</a> exists as a discipline and studies the psychological and physiological characteristics of human perception of sounds.  Actually, these psychoacoustic models were the basis for the work of lossy compression programs and MPEG 1 Layer III or just <a href="https://ru.wikipedia.org/wiki/MP3">MP3 was</a> one of the first such formats.  I also make a reservation that marketing, which operates with facts almost without exaggeration, did its job: the audio file takes up ten times less space (with the proviso: this is when encoding with a bitrate of 128 kbps, which allows to get ‚Äúacceptable quality for a typical listener ‚Äú- we remember 1411 kbps for WAVE), and, therefore, on the CD or on the hard disk will fit an order of magnitude more audio recordings.  Furor!  The popularity of the format has blown up the digital recording industry.  During periods of not the fastest connections to the Internet, it became very convenient to transfer such files.  Convenient to transfer, convenient to store, convenient to throw a pack of songs on your player.  Created many hardware decoders format MP3, in connection with which the file was played almost on the <s>fridge of</s> each piece of iron. <br><br>  At the time of this writing, patent restrictions have expired and licensing fees have been terminated. <br><br>  As for lossy compression, and how is it possible to compress an audio file by an <i>order of magnitude</i> without significant loss for the listener of quality?  In short, from one codec to another, the following sequence is slightly different.  The description of this process is simplified to disgrace, but its flow is approximately as follows: <br><br><ol><li>  the incoming stream of uncompressed data is divided into equal segments - into frames (frames); </li><li>  in order to create a continuous part of the spectrum, for analysis, in addition to the already selected frame, the previous and next frame is taken; </li><li>  Compression # 1: The region passes through <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2584%25D0%25B8%25D1%2586%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BA%25D0%25BE%25D1%2581%25D0%25B8%25D0%25BD%25D1%2583%25D1%2581-%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">MDCT</a> (Modified Discrete Cosine Transform).  Roughly speaking, this transformation carries out a spectral analysis of the sound signal - it gives you the opportunity to get information about how great the sound energy is in each segment of the spectrum.  <s>In the case of Layer III, the second MDCT transform is performed, which improves the coding efficiency of the high frequencies at lower bitrates - this turned out to be a silver bullet for blasting the popularity of this codec.</s>  Thanks to the user <a href="https://habrahabr.ru/users/interrupt/" class="user_link">interrupt</a> for the <a href="https://habrahabr.ru/post/346532/">correction</a> : MPEG 1 Layer III uses a hybrid approach to convert audio data: first, the spectrum of the encoded audio file is divided into multiple spectral bands, as happens in SBC (Sub-band coding, <a href="https://en.wikipedia.org/wiki/Sub-band_coding">Eng.</a> );  Each of these bands is converted by the MDCT to a frequency mode, which, in fact, already gives specific information about which frequencies and with what energy are present in the frame. </li><li>  The result of the MDCT analysis is transmitted to the psychoacoustic model, which is something like a ‚Äúvirtual ear‚Äù.  At this stage, answers are given to the questions of what to leave and what can be thrown out of the audio signal without significant damage to perception. </li><li>  Compression # 2: a frame that went through such a transformation can be compressed using Huffman codes;  in fact, if you talk rudely again, each frame is additionally archived, eliminating redundancy.  It looks like something like wrapping long chains of zeros and ones in a shorter format; </li><li>  frames are glued together;  In each such frame, the necessary information for the codec is added: <br><br><ul><li>  frame number / size; </li><li>  format version (MPEG1 / 2 / 2.5); </li><li>  layer version (Layer I / II / III); </li><li>  sampling frequency; </li><li>  Stereo-base mode (mono, stereo, combined stereo). </li></ul><br></li></ol><blockquote>  It should be noted the fact that the MP3 format is not without significant flaws, while the format itself does not allow to properly expand its capabilities.  Take, for example, the phenomenon of <a href="https://en.wikipedia.org/wiki/Pre-echo">pre-echo</a> .  The phenomenon of this compression artifact is briefly and fairly well described <a href="https://audiocoding.ru/terms/pre-echo/">here</a> , but its essence lies in the distortion of sharply increasing sounds, such as Hi Hat, for silence.  When coding such a tool in silence, due to the peculiarities of the MDCT, a sharp transition will be created with a lot of vibrations.  In the original recording, these oscillations do not exist, but if they exist in the resulting recording, they are quite clearly captured by the ear.  Modern codecs such as AAC and OGG are also not without this drawback, but they try to deal with them using more accurate and sophisticated algorithms.  But MusePack (about it below), for example, is deprived of this disadvantage, since it <s>does not use the second MDCT-conversion to increase efficiency</s> using SBC along with a very high-quality psychoacoustic model, which explains its high-quality coding only starting from bitrates of 160 kbit / with.  Rarely, but aptly: with such a bit rate, the codec encodes audio better than MP3 with the same bit rate. <br><br>  It should be noted that the developers of the free <a href="http://lame.sourceforge.net/">Lame</a> codec are still trying to improve their offspring, improving psychoacoustic models and coding algorithms with variable bitrate;  Release version 3.100 is presented in December 2017. </blockquote><br>  Detailed information on how the MP3 is arranged in terms of frame format can be found <a href="https://habrahabr.ru/post/103635/">here</a> . <br><br>  But an amazing article (and, more precisely, its translation) on how MP3 audio codec compression works can be found <a href="https://audiophilesoft.ru/publ/my/understanding_mp3_compression/11-1-0-107">here</a> .  Recommend! <br><br><h4>  <font color="#4650a9">1.4.</font>  <font color="#4650a9">Loss coding improved: a brief description of the AAC format</font> </h4><br>  At the time of this writing, the MP3 codec is more than 23 years old.  In order not to repeat with the <a href="https://habrahabr.ru/post/118454/">article</a> ( <a href="https://audiophilesoft.ru/publ/my/encoding_recommendations/11-1-0-83">its newer version</a> ), where <a href="https://ru.wikipedia.org/wiki/Vorbis">OGG Vorbis</a> codecs are described (and hello again to the Xiph organization is also its development), <a href="https://ru.wikipedia.org/wiki/Musepack">MPC</a> (Musepack), <a href="https://ru.wikipedia.org/wiki/Windows_Media_Audio">WMA</a> (Windows Media Audio) and AAC, I will describe here briefly the format AAC in terms of technologies that were until recently advanced in the field of lossy coding. <br><br>  In my humble opinion, <a href="https://ru.wikipedia.org/wiki/Advanced_Audio_Coding">AAC</a> (Advanced Audio Codec) is one of the most advanced formats in the field of data coding.  I will describe the main features of this format, starting with the popular profiles that can be represented as a doll (see figure below): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcb/e66/413/dcbe66413e67a851a9366e9d1b75d9e4.png" alt="image"><br>  <i>Fig.</i>  <i>1.2 - Hierarchy of AAC profiles, source - Wikipedia</i> <br><br>  <b>- Low Complexity Advanced Audio Coding (LC-AAC)</b> <br><br>  Low decoding complexity is great for implementing a hardware codec;  hardware requirements for the CPU and RAM are also low, which has gained great popularity for this profile.  Enough effectively encodes a signal with 96 kbps. <br><br>  <b>- High-Efficiency Advanced Audio Coding (HE-AAC).</b> <br><br>  The <a href="https://ru.wikipedia.org/wiki/High-Efficiency_Advanced_Audio_Coding">HE-AAC</a> profile is an extension of LC-AAC and is supplemented with the patented <a href="https://audiophilesoft.ru/publ/audiocoding/mp3pro_sbr/9-1-0-287">SBR</a> technology (Spectral Band Replication, coarse. - ‚Äúspectral repetition‚Äù, <a href="https://en.wikipedia.org/wiki/Spectral_band_replication">an article in English</a> ).  It is the technology of spectral repetition that allows you to "save" high frequencies when encoding with low bitrates. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0bd/8c0/8e1/0bd8c08e1b1c5913a9f7a882a3346d40.png" alt="image"><br>  <i>Fig.</i>  <i>1.3 - Graphic representation of the principle of high frequency recovery</i> <br><br><blockquote>  Why "save" - ‚Äã‚Äãin quotes?  Because the king is not real: the codec allocates space for additional information, which is used by the codec synthesizer to restore high frequencies, but since these frequencies are synthesized, that is, they are recreated by the codec, they are, in fact, an approximate copy of the high frequencies that existed in the source file .  In practice, a signal encoded at 48 kbps will sound, for example, in the same way as mp3 @ 98 kbps if supported by the decoder;  otherwise, such a file will be played simply without the restoration of high frequencies and its bitrate will correspond to its quality, similar to mp3. </blockquote><br>  <b>- High-Efficiency Advanced Audio Coding Version 2 (HE-AACv2)</b> <br><br>  This profile is relatively young (described in 2006), it was created to more efficiently encode audio in low bandwidth conditions. <br>  The second version of the profile is an extension of the first profile, the changes consist in the addition of the <a href="https://en.wikipedia.org/wiki/Parametric_Stereo">PS</a> technology (Parametric Stereo).  The principle is somewhat similar to SBR technology: the codec also allocates space for information to restore the stereo base, sacrificing accuracy. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ad5/430/9d2/ad54309d20135d52779e8983b31514ce.png" alt="image"><br>  <i>Fig.</i>  <i>1.4 - Graphic image coding parametric stereo</i> <br><br><blockquote>  The operating conditions for this profile are the same as for the HE-AAC described above;  the lack of support for the profile by the decoder will cause the recording to sound in mono. </blockquote><br>  <b>- AAC-LD (Advanced Audio Coding - Low Delay)</b> <br><br>  The <a href="https://en.wikipedia.org/wiki/AAC-LD">AAC-LD</a> profile has advanced coding algorithms for reducing delays (up to 20 ms); <br><br>  <b>- AAC-ELD (Advanced Audio Coding - Enhanced Low Delay)</b> <br><br>  This profile, which inherits all the capabilities of HE-AACv2 (uses analogues of SBR and PS technologies, but designed for low latency); <br><br>  <b>- AAC Main Profile</b> <br><br>  This profile was presented as MPEG-2 AAC or HC-AAC (High Complexity Advanced Audio Coding).  Not compatible with LC-AAC; <br><br>  <b>- AAC-LTP (Advanced Audio Coding - Long Term Prediction)</b> <br><br>  This profile is more complex and resource-intensive (but better) than all the others.  Also not compatible with LC-AAC. <br><br>  That's all I wanted to write about this codec.  I focused on the technologies that are used in various AAC profiles (which, by the way, generate a lot of abbreviations: AAC, LC-AAC, eAAC +, aacPlus, HE-AAC, etc.), as I will compare them with those in Opus, but the codec does its job: it is widely used in Internet radio, as well as in digital radio broadcasting technologies: DRM (Digital Radio Mondiale) and DAB (Digital Audio Broadcasting) (you can familiarize yourself with these technologies <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D1%2584%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B5_%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B8%25D0%25BE">here</a> ), YouTube, as audio track to a variety of videos in mp4 containers, mkv, etc. <br><br><h1>  <font color="#292e5b">2. Introduction to Opus: format description</font> </h1><br><br><img src="https://habrastorage.org/getpro/habr/post_images/788/28e/f58/78828ef5830ef2626a9c7184592f0820.png" alt="image"><br>  <i>Fig.</i>  <i>2.1 - Opus Logo</i> <br><br>  On December 21, 2017, Xiph introduced the beta version of the Opus audio codec version 1.3.  I will not go into high matters when describing this codec, since such information is freely available (for example, <a href="https://www.opennet.ru/opennews/art.shtml%3Fnum%3D46734">here</a> , <a href="https://ru.wikipedia.org/wiki/Opus_(%25D0%25BA%25D0%25BE%25D0%25B4%25D0%25B5%25D0%25BA)">here</a> , and for those who know English - <a href="http://opus-codec.org/">here</a> and <a href="https://wiki.xiph.org/OpusFAQ">here</a> .)).  Information on the release of this beta version can be found <a href="http://opus-codec.org/release/dev/2017/12/21/libopus-1_3_beta.html">here</a> .  Here I note that this codec is a great candidate for replacing the rest of the codecs.  He has many advantages: <br><br><ul><li>  bit rate from 6 to 510 Kbit / s; </li><li>  sampling frequency from 8 to 48KHz; </li><li>  support for constant (CBR) and variable (VBR) bit rates; </li><li>  support narrowband and wideband sound; </li><li>  voice and music support; </li><li>  stereo and mono support; </li><li>  support for variable bit rate (VBR); </li><li>  the ability to restore the audio stream in case of frame loss (PLC); </li><li>  support up to 255 channels; </li><li>  availability of implementations using floating-point and fixed-point arithmetic. </li></ul><br>  The codec is distributed under the BSD license and is completely free from all patent prosecutions, and also approved as an Internet standard.  Opus can be used in any of its projects, including commercial ones, without the need to open source.  At the moment, the codec is used in the <a href="https://telegram.org/blog/calls">Telegram messenger</a> for <a href="https://ru.wikipedia.org/wiki/IP-%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2584%25D0%25BE%25D0%25BD%25D0%25B8%25D1%258F">VoIP</a> implementation, in the <a href="https://ru.wikipedia.org/wiki/WebRTC">WebRTC</a> project, for encoding the audio track in YouTube videos, etc.  The prospects of this codec should not be underestimated. <br><br>  A reasonable question may arise: what is so special about the theses described above?  All this is in almost any more or less modern codec.  The answers will follow later in the article. <br><br>  One of the key features of this codec is extremely low coding delays: from 2.5 ms.  (!) up to 60 ms, which is simply necessary, like air, for applications that allow users to communicate with voice over the Internet.  Such low latency also allows you to build interactive applications, for example, a digital sound studio for writing music together or something like that.  It is worth noting that in this parameter the codec competes with the relatively new AAC-ELD profile described above;  however, the minimum latency of the coding algorithms is approx.  20 ms, which is hardly a problem for the free, open and free codec Opus. <br><br>  I will not consider all the subtleties associated with encoding audio by this codec, but I will describe below the modes that vary by codec depending on the bitrate change. <br><br><h4>  <font color="#4650a9">2.1.</font>  <font color="#4650a9">Opus: coding modes</font> </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/aed/9ac/7ca/aed9ac7cad4d5eb8d9a75332c720ed1c.png" alt="image"><br>  <i>Fig.</i>  <i>2.2 - Comparison of coding quality by different codecs - the official schedule from the site opus-codec.org</i> <i><br></i> <br><br>  After the release of this beta version, I wondered how the encoding modes changed depending on the bitrate, so I decided to conduct experiments, starting with the lowest bitrates, but only with them.  I don‚Äôt see any point in conducting experiments with higher bitrates - it is perfectly described in articles (for example, <a href="https://audiophilesoft.ru/publ/my/encoding_recommendations/11-1-0-83">here</a> ). <br><br>  Now we will list those modes with which the codec operates: <br><br><ol><li>  Signal coding mode - LP, hybrid, MDCT: <br><ul><li>  LPC or LP (coding with linear prediction, <a href="https://en.wikipedia.org/wiki/Linear_predictive_coding">an article in English</a> ) is used in voice compression codecs and allows you to encode a voice with sufficient quality for perception, using very low bit rates.  Used in <a href="https://ru.wikipedia.org/wiki/GSM">GSM</a> , <a href="https://ru.wikipedia.org/wiki/AMR_(%25D1%2581%25D0%25B6%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B5_%25D0%25B7%25D0%25B2%25D1%2583%25D0%25BA%25D0%25B0)">AMR</a> , <a href="https://ru.wikipedia.org/wiki/SILK">SILK</a> codecs (also used in Skype), <a href="https://ru.wikipedia.org/wiki/Speex">Speex</a> (and hello again Xiph; however, she declared the codec as ‚Äúdeprecated‚Äù and recommends using Opus).  The Opus codec uses a modified SILK codec to encode voice at low bit rates, which is not backward compatible with Skype; </li><li>  <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2584%25D0%25B8%25D1%2586%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BA%25D0%25BE%25D1%2581%25D0%25B8%25D0%25BD%25D1%2583%25D1%2581-%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">MDCT</a> (Modified Discrete Cosine Transformation) is a kind of Fourier transform (you can read about it <a href="https://habrahabr.ru/post/196374/">here</a> ), it is used in almost all codecs to compress lossy compression music: MP3, AAC, OGG Vorbis, etc.  The Opus codec uses the CELT codec ( <a href="https://en.wikipedia.org/wiki/CELT">English article</a> ); </li><li>  Hybrid mode (hybrid coding mode) is developed by Xiph and consists of using LP for coding the lower part of the signal spectrum (up to 8 kHz) and MDCT for the upper part (from 8 kHz and above) and a compromise quality at the output sound while maintaining a fairly low bitrate. </li></ul><br></li><li>  Stereo base: <br><ul><li>  mono encoding; </li><li>  stereo encoding; </li><li>  coding in the mode of combined stereo ( <a href="https://en.wikipedia.org/wiki/Joint_(audio_engineering)">Joint Stereo</a> ). </li></ul><br></li><li>  Based on the above - changing the width of the spectrum depending on the bitrate: <br><ul><li>  Narrowband (narrowband coding) - coding of a signal with a spectrum width of up to 6 kHz, corresponds to the coding quality by GSM and AMR-NB codecs; </li><li>  Wideband (wideband coding) - coding of a signal with a bandwidth from 6 kHz to 14 kHz, corresponds to the coding quality of the AMR-WB codec (or the so-called ‚Äú <a href="https://ru.wikipedia.org/wiki/HD_Voice">HD Voice</a> ‚Äù operators), which is now used in third-generation networks ( <a href="https://ru.wikipedia.org/wiki/3G">3G</a> ); </li><li>  Fullband (full band coding) - preservation of the entire audible human ear band (from 20 Hz to 20 kHz), mono signal; </li><li>  Fullband stereo - see above, but stereo. </li></ul></li></ol><br><br><h4>  <font color="#4650a9">2.2.</font>  <font color="#4650a9">Low bit rates - high frequencies.</font>  <font color="#4650a9">How are such results achieved?</font> </h4><br>  At the beginning of this article, I knowingly considered the AAC codec and its heaped profiles, which, in fact, build a stereo base and restore high frequencies, which is called ‚Äúout of thin air‚Äù.  I exaggerate, of course, but the expression is not far from the truth.  But the trouble is that the codec is covered by patents and is a proprietary development of the alliance from <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B8_%25D0%2591%25D0%25B5%25D0%25BB%25D0%25BB%25D0%25B0">Bell Labs</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2581%25D1%2582%25D0%25B8%25D1%2582%25D1%2583%25D1%2582_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D1%2585_%25D1%2581%25D1%2585%25D0%25B5%25D0%25BC_%25D0%25BE%25D0%25B1%25D1%2589%25D0%25B5%25D1%2581%25D1%2582%25D0%25B2%25D0%25B0_%25D0%25A4%25D1%2580%25D0%25B0%25D1%2583%25D0%25BD%25D0%25B3%25D0%25BE%25D1%2584%25D0%25B5%25D1%2580%25D0%25B0">the Fraunhofer Institute for Integrated Circuits</a> (which, by the way, is the key creator of MP3), <a href="https://ru.wikipedia.org/wiki/Dolby_Laboratories">Dolby Laboratories</a> , etc.  Therefore, the use of these technologies will require license fees, which is unacceptable for a fully open and free codec.  Therefore, the developers of Opus went a different way: they implemented their own high-frequency reproduction algorithms - Band Folding (Spectral Folding, Hybrid Folding).  About this approach of coding of high frequencies can be found, respectively, <a href="https://people.xiph.org/~xiphmont/demo/celt/demo.html">here</a> (there are even interactive pictures there), <a href="https://arxiv.org/pdf/1602.04845.pdf">here (see 4.4.1)</a> and <a href="https://tools.ietf.org/html/draft-ietf-codec-opus-update-04">here</a> .  The codec does not synthesize high frequencies from the additional data, as HE-AACv2 does, it takes as a basis the signal itself, based on the energy in the high-frequency region encoded in the original signal.  Blind testing by enthusiasts shows that this method is very effective, not to mention that such a method of reproducing high frequencies, according to the developers, is simpler to perform than SBR or its equivalent and can be implemented with lower algorithmic delays. <br><br>  By the way: the results of blind testing can be viewed on the graphs at the <a href="http://opus-codec.org/comparison/">following link</a> . <br><br>  Let us experience this last word in the field of lossy compression of sound. <br><br><h4>  <font color="#4650a9">2.3.</font>  <font color="#4650a9">Opus: coding and testing tools</font> </h4><br>  This test was conducted on a short excerpt from the Vadim Zelanda audiobook - Transurfing of reality.  The book was voiced by the Russian actor and radio host <a href="https://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B5%25D1%2580%25D0%25BD%25D1%258F%25D0%25BA,_%25D0%259C%25D0%25B8%25D1%2585%25D0%25B0%25D0%25B8%25D0%25BB_%25D0%2593%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D0%25B4%25D1%258C%25D0%25B5%25D0%25B2%25D0%25B8%25D1%2587">Mikhail Chernyak</a> , who has a pleasant timbre of his voice. <br><br>  How was the passage obtained? <br><br><ol><li>  The youtube-dl utility downloaded a fragment of a <a href="https://ru.wikipedia.org/wiki/WebM">WebM</a> format file ‚Äî a container in which only the audio track is present: <br><pre><code class="bash hljs">youtube-dl <span class="hljs-string"><span class="hljs-string">"https://www.youtube.com/watch?v=_-OUXW3a0Yw"</span></span> -f 250</code> </pre> <br></li><li>  The fragment was recoded into WAV format for feeding to the <i>opusenc</i> codec (the source file was renamed for convenience): <pre> <code class="bash hljs">ffmpeg -i tr1_original.webm -acodec pcm_s16le tr1.wav</code> </pre> </li><li>  In order not to bother with encoding a set of files with different bitrates, I used a simple one-line program in the Bash language and got a lot of files I needed: <pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> `seq 8 21`; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> opusenc --bitrate <span class="hljs-variable"><span class="hljs-variable">$i</span></span> tr1.wav tr-enc-<span class="hljs-variable"><span class="hljs-variable">${i}</span></span>.opus ; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> </li><li>  All these files were imported into <a href="https://www.audacityteam.org/download/">Audacity</a> and into the <a href="http://qmmp.ylsoftware.com/">Qmmp</a> player in order to evaluate the sound quality by ear and to visually evaluate the corresponding track. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/b8d/b6d/f7e/b8db6df7e74d29833b646b3b9867d67f.png" alt="image"><br>  <i>Fig.</i>  <i>2.3 - Script execution result - Dolphin screenshot</i> <br><br>  Next will be a description of almost each of them - with the application of screenshots and a subjective description of the sound, followed by small conclusions. <br><br><h1>  <font color="#292e5b">3. Evaluation of the sound of coded tracks</font> </h1><br>  In a good way, the evaluation of the sound should be objective and be carried out, for example, using the blind ABX-testing method ( <a href="https://en.wikipedia.org/wiki/ABX_test">English article</a> ).  Testing is carried out in order to eliminate the <a href="https://audiophilesoft.ru/publ/theory/placebo_effect/6-1-0-33">effect of the pacifier (placebo)</a> . <br><br>  In short, the essence of the method is to listen with the help of auxiliary software (Foobar or similar web application, see note in Fig. 3.1) of two samples: reference and compressed - buttons A and B, respectively.  The listener does not know in advance which of them is compressed and which of them is reference. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb9/030/413/eb903041358b3b203a03c31329446483.png" alt="image"><br>  <i>Fig.</i>  <i>3.1 - An example of the appearance of one of the programs of blind ABX-testing</i> <br><br>  Next, the listener listens to the audio recording, substituted by the program under the X button and tries to determine: which of the two samples (A or B) is the sample on the X button. After the listener chooses the answer, the cycle is repeated a certain number of times, after which the program displays the result, where shown, what probability did the listener press the buttons randomly. <br><br><blockquote>  It is worth making a reservation that there are people who do not perceive the effects of psychoacoustic compression and, in fact, cannot distinguish, for example, the recording of mp3 @ 128 kbps from FLAC - for them both files sound ‚Äúwonderful‚Äù.  There are a lot of such people and for them 128 kbps is a completely transparent sound, as they do not think about what kind of artifacts are there and how they sound.  Is there music?  Tools are heard?  Fine.  This is another reason for the high popularity of the MP3 format. </blockquote><br>  In principle, I did not conduct blind ABX testing, but I wanted to describe the subjective perception of sound with the screenshots of the spectrogram screen of each sample in the hope that it would be interesting for the readers of this article. <br>  Go. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85b/4b0/cf1/85b4b0cf1999b0828b34386998abf95a.png" alt="image"><br>  <i>Fig.</i>  <i>3.2 - Spectrogram of the recording, encoded with a bitrate of 8 kbps</i> <br>  <a href="">opus-enc-8.opus</a> <br><br>  1. In fig.  3.2 shows a spectrogram for encoding with practically the lowest bitrate.  The audio file is encoded by the LP method, the codec assigns a frequency spectrum of 6 kHz;  Anything higher is clipped.  As a result, the file size is extremely small, the sound quality corresponds to that with the AMR-NB (Narrowband) codec.  The classic of the genre in cellular networks of the second generation (GSM).  The behavior of the Opus codec corresponds to the above in the range of bit rates from 6 to 9 kbps. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecb/12c/05d/ecb12c05dd73b12f5bc1f03ff075baad.png" alt="image"><br>  <i>Fig.</i>  <i>3.3 - Spectrogram of the recording, encoded with a bit rate of 10 kbps</i> <br>  <a href="">opus-enc-10.opus</a> <br><br>  2. In fig.  3.3 shows a spectrogram for encoding with a bit rate of 10 kbps.  The same situation: coding method LP, but the frequency spectrum is already wider - up to 8 kHz.  The sound is average between AMR-NB and AMR-WB. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d4/62c/19a/7d462c19ae3dbfd119c87ec82502645f.png" alt="image"><br>  <i>Fig.</i>  <i>3.4 - Spectrogram of recordings encoded with bitrates of 12 and 13 kbps</i> <br>  <a href="">opus-enc-12.opus</a> <br>  <a href="">opus-enc-13.opus</a> <br><br>  3. In fig.  3.4 shows two spectrograms: for bit rates of 12 and 13 kbit / s, respectively.  Here the situation is more interesting: at 12 kbps, the same LP is used, but the width of the spectrum is expanded even more: to 10 kHz and the sound is almost identical to that in AMR-WB. <br><br>  Starting with a bit rate of 13 kbps, the codec switches to the hybrid mode and starts using three methods at once: LP, MDCT and Band Folding.  All that lies in the range from 0 to 8 kHz, LP is encoded, from 8 to 10 kHz - MDCT;  it is this segment of the 2 kHz spectrum that is used as the initial information for using Band Folding - from here we get the actually restored high frequencies, up to 20 kHz. <br><br>  Clearly visible ‚Äústrokes‚Äù along the record, starting with 10 kHz;  visible attempt codec to keep maximum information about high frequencies.  Interestingly, even at 13 kbps.  the codec in the hybrid mode, using Hybrid Folding, tries to work in Fullband mode, restoring the spectrum up to 20 kHz. <br><br>  What about the sound?  The sound of the voice is simply Fantastic ‚Äî with a capital F. It‚Äôs even that HE-AAC with its SBR isn‚Äôt capable of such a result ‚Äî it‚Äôs not even close.  High frequencies, in the region of which there are sizzling, whistling, clicking (S, S, S, C) sounds are reproduced amazingly, it is pleasant to listen to human speech.  We don‚Äôt forget about the ‚Äú13 kbps‚Äù figure, but GSM codecs (AMR-NB) used to work with such a bit rate, where you really don‚Äôt know where  is, and where  is ¬ª... <br><br>  However, one should not forget that such a mode is still poorly suited for encoding music: due to the LP coding, there are significant distortions in the LP region, especially in the transition region, where there is no voice, but the corresponding area FX effect of ‚Äúatmospheric rusty squeak‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c1/aa8/3ee/7c1aa83eece2f511867b28da8df376dd.png" alt="image"><br>  <i>Fig.</i>  <i>3.5 - Spectrogram of recordings encoded with bitrates of 14 and 15 kbps</i> <br>  <a href="">opus-enc-14.opus</a> <br>  <a href="">opus-enc-15.opus</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/037/b8a/a05/037b8aa05a65bdf36d472ab74514b279.png" alt="image"><br>  <i>Fig.</i>  <i>3.6 - Pay attention to the selected area of ‚Äã‚Äãthe FX effect</i> <br><br>  4. In Figure 3.5, you can see how the coding method of the signal changes from a transition to a higher bit rate - from 14 to 15 kbit / s.  As long as the recording spectrogram for a bit rate of 14 kbps is similar to the one described above with 13 kbps, then starting with a bitrate of 15 kbps, the use of the hybrid mode stops and the codec relies entirely on MDCT and Band Folding. <br><br>  Why did I decide that?  Because when listening to recordings in the FX effects area, all the distortions that are inherent in LP disappear.  And if you look at the spectrogram of both records (see also Fig. 3.6), then you can see that the accuracy of the reproduction of the spectrum is increased.  However, the characteristic ‚Äúsmear‚Äù, dividing the spectrum in half, in the region of 10 kHz, can be seen in both cases. <br><br>  This is exactly the case when the quality here is comparable to that of mp3 @ 80 kbps, if not higher.  Again, I do not have the right to make my judgments the ultimate truth, since I did not conduct blind ABX testing. <br><br>  5. Starting with a bit rate of 18 kbps ( <a href="">opus-enc-18.opus</a> ), the latter becomes enough to switch to Fullband Stereo mode, which means that at this bitrate you can get ‚Äúacceptable‚Äù recording quality under very low bandwidth network.  No, this is not a fiasco, bro, this is a victory! <br><br>  Further, everything is quite simple: proportionally, with an increase in bitrate, the codec is using Band Folding less and less often, since the actual bitrate becomes sufficient to encode higher frequencies without the need for artificially restoring them.  The higher the bitrate, the wider the spectrum will be encoded without the use of Band Folding. <br><br><h1>  <font color="#292e5b">4. Instead of conclusion</font> </h1><br>  As for me, that ‚Äúthreshold of transparency‚Äù (or ‚ÄúTransparency‚Äù, as the English speakers call it), which is expressed in my inability to distinguish the original from the compressed analogue - approx.  170 kbps  For mp3, this parameter is within 224-256 kbps, depending on the nature of the music. <br><br>  What can I say.  Technology is developing rapidly.  And not only audio data compression technologies - I‚Äôm not afraid to summarize all the technologies.  It is especially pleasant that such high-quality technologies, which allow to deceive the human ear so qualitatively and allow it to be so universal, also develop and remain free and open.  Thanks to the developers and those amazing people who are creating and moving progress.  And also thank you all for your attention and everyone who has mastered the article to the end. <br><br>  PS: The article will be edited upon detection of significant inaccuracies;  syntax and semantic errors will be corrected. <br><br>  PPS: <a href="http://telegra.ph/Kratkij-obzor-audiokodeka-Opus-13-01-08">Link to my own article written using the telegra.ph service</a> .  It was not published anywhere, is my author's work (the author can be checked) and is an older version of the current article. </div><p>Source: <a href="https://habr.com/ru/post/346532/">https://habr.com/ru/post/346532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346518/index.html">How much slower will your system after patches for Specter-Meltdown?</a></li>
<li><a href="../346520/index.html">Python, PHP, Golang, and DevOps knowledge tests: AvitoQuiz quiz analysis on Highload</a></li>
<li><a href="../346524/index.html">Meltdown and Specter for the cloud: our risk assessment and how we patched</a></li>
<li><a href="../346526/index.html">One is not a warrior in the field: advantages from working in a company on a remote</a></li>
<li><a href="../346530/index.html">Linux and newspaper layout (not for professionals)</a></li>
<li><a href="../346534/index.html">10 years have passed, and no one has figured out how to use the blockchain</a></li>
<li><a href="../346536/index.html">Mobile devices from the inside. The image structure of partitions containing the file system. Part 2</a></li>
<li><a href="../346538/index.html">Animation in mobile applications. We test Kite compositor</a></li>
<li><a href="../346540/index.html">On the problems of determining the location of the subscriber when he calls 112</a></li>
<li><a href="../346542/index.html">The decentralized data warehouse Ethereum Swarm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>