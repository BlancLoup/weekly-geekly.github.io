<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VK Friendly Link Analysis with Wolfram Mathematica</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, the Wolfram Research Era of Wolfram Technologies was held in Moscow, where they told a lot of interesting things about one of the mos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VK Friendly Link Analysis with Wolfram Mathematica</h1><div class="post__text post__text-html js-mediator-article"><img align="left" width="200" src="https://habrastorage.org/getpro/habr/post_images/3da/03f/33c/3da03f33c3fcbb8bf3435817f495c5a8.jpg">  Not so long ago, the Wolfram Research <a href="http://seminars.softline.ru/event/8052/detail">Era of Wolfram Technologies</a> was held in Moscow, where they told a lot of interesting things about one of the most powerful and definitely the most convenient computer research system Wolfram <i>Mathematica</i> .  In particular, the results of the study of data from the social network facebook by the Constructive Cybernetics research group were presented.  A little earlier, I came across a new feature of Wolfram | Alpha for a comprehensive <a href="http://www.wolframalpha.com/facebook/">analysis of the facebook page</a> .  And after all this, I have a crazy idea stuck in my head: <i>"I want to see the graph of friendly relations of the social network in which I live (namely, VKontakte)</i> . <i>"</i>  And I still found the time to implement it.  Welcome under cat. <br><a name="habracut"></a><br><br>  The interaction with the VK API begins with the creation of a Standalone application at <a href="https://vk.com/dev">https://vk.com/dev</a> (in the same place, you can edit an already created application).  After a few clicks and much thought over the name, the system issues the <i>application ID</i> that will be used to get <i>Access Token</i> . <br>  To get <i>Access Token</i> , you need to follow the link below, replacing the grid with the <i>application ID</i> .  How the line is formed, you can read <a href="https://vk.com/dev/auth_mobile">here</a> . <br><br> <code>https://oauth.vk.com/authorize?client_id=######&amp;scope=friends&amp;redirect_uri=https://oauth.vk.com/blank.html&amp;display=page&amp;v=5.16&amp;response_type=token</code> <br> <br>  After that, a lot of useful information will appear in the address bar, in particular, <b>access_token</b> and <b>user_id</b> .  These two values ‚Äã‚Äãneed to be saved.  I called the variables <b>myID</b> (Integer || String) and <b>token</b> (String). <br>  The next step is to write a basic function that interacts with the API.  The standard response format from VK API is <i>JSON</i> , which can be easily parsed into lists and rules by internal means of <i>Mathematica</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/508/ba2/835/508ba2835f56a3c2cf36db96d1dec6e9.png"><br><br>  <a href="https://vk.com/dev/methods">The list of methods</a> that are now available is limited only by the value of the <b>scope</b> parameter, which was passed during the formation of <i>Access Token</i> .  To check the performance of the system, you can find out your name <br><br><img src="https://habrastorage.org/getpro/habr/post_images/023/4e4/b38/0234e4b385406759f8ae47007d947047.png"><br><br>  The VK API output contains a lot of excess, therefore, in order to extract only useful data, you must first cut off the excess <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e58/e70/0b3/e58e700b361f41cd657ebd0caca3111c.png"><br><br>  And, then, apply replacement rules (and this is a list of replacement rules) to those parameters that are interesting.  The remaining rules are automatically ignored. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cc/e75/0ce/4cce750ce76fbf52f84d3c7e320c313f.png"><br><br>  Thus, you can write a module that receives the user name and (optionally) his photo <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a7/1e8/ef5/3a71e8ef5b746f8d6e738854cd1aa4e3.png"><br><br>  Note that the parameter for the API is called <b>user_ids</b> , not <b>user_id</b> .  This will allow you to get information about the whole list of users for a single request (IDs must be separated by commas and must be less than 1000). <br><br>  Now you need to find users who are interested in finding out something.  Get a list of friends.  In general, the whole function is as follows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d4/00e/dec/1d400edecb4c17b50558e55c4b0e4c88.png"><br><br>  But due to my desire for idealism and the desire to at least a little closer in thought to the built-in functions of <i>Mathematica</i> , my <b>VKFriends</b> grew up here <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc4/868/25d/dc486825d153e1800c9b5eb2c4f17136.png"><br><br>  However, the ‚Äú <code>Clean</code> ‚Äù version will be used to build the graph.  The following is interesting here: if the <b>fields</b> parameter is removed, then the response from the API will be a list of IDs and nothing more.  And if <b>fields</b> at least something is equal, the user name is automatically included in the response.  Therefore, for the version without avatars, the value <b>fields = sex</b> is applied simply because sex is a beautiful word.  In practice, the replacement rule for the floor in the final version is not implemented.  Although you can always add fields that you are interested in exploring with your friends and building beautiful histograms of them, but then the code will grow many times and its structure will need to be changed (if, of course, striving for mass character). <br><br>  The last function that is needed from the data collection API is mutual friends.  With their help, it will be possible to explore communications only within your social circle, without receiving and processing megabytes of extra information about who your friends from those whom you <b>do not</b> know know.  To bring the syntax and capabilities in line with <b>VKFriends</b> , we had to sweat a little.  The fact is that <b>friends.getMutual</b> can only return a clean list of IDs, which is not obvious (if suddenly someone needs clarity) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf7/6aa/b55/cf76aab558d82e88ae67bb7ee1f6b265.png"><br><br>  Everything!  On this integration with VK API for this task is over (and so much more than you have done).  It's time to take the <s>bull by the horns</s> lists by the tails.  Go! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd7/2ac/aaf/dd72acaaf05dd313a8694fb586dedee6.png"><br><br>  We receive the list of friends, we describe communications.  All of them are related only to you.  The speed of performance - blink of an eye. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd5/5f1/870/fd55f18704ea7fae843166c6973d5012.png"><br><br>  But do not worry, the time to go for tea and even you will have to drink it.  <b>Friends.getMutual</b> itself <b>is</b> not particularly fast, so it must also be carried out for each of your friends.  On my 333 friends, it took 119 seconds.  This is the longest operation for the entire study.  While this function works, you can put the kettle on and choose tea.  <b>DeleteCases</b> appeared in the process of debugging, when the depth of the resulting array was suddenly equal to 7. And all because there are users in friends for whom, for some reason, mutual friends are not available.  And the error message is presented in the form of rules.  Therefore, removing all the rules, the depth of the array will become normal, and the data type will become Integer (represented as a String). <br>  As a result of the code execution, the <b>friendsOfFriends</b> variable will have a two-dimensional list, the size of Length [myFriends].  And each element of <b>myFriends</b> (friend) will correspond to a list of your mutual friends with this friend.  Now you need to connect each friend from <b>myFriends</b> with all his friends from <b>friendsOfFriends</b> .  Fuh.  It seems to explain it with words, but if you use an embedded Map for this, it will turn out to be completely unreadable.  Therefore, we cheat a little in a procedural style (kindly requested not to repeat on our own. This is a very bad style for Mathematica. The assembler was based on goto and in procedural programming it became a bad style, and the <i>Wolfram Language</i> allows you to solve everything analytically, and here the explicit style is explicit cycles [ purely formally this makes it the language of a new generation]) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/932/671/dbe/932671dbe74a14988879b984900027c0.png"><br><br>  Next, you can try to build this graph, but nothing will come of it.  Non-oriented graphs with the degree of vertices greater than one are added only in the not yet released <i>Mathematica</i> 10. The degree of all the vertices of a non-digraph is two, for each user who is in friends with another user is also in friends with the first.  Simply put, we found a common friend B with user A, and when we looked at page B, user A also finds himself in mutual friends.  And after examining the entire network, all users began to connect with two edges.  To see this, replace <b>UndirectedEdge</b> with <b>DirectedEdge</b> for all entries.  But the digraph is redundant exactly 2 times, so it is necessary to get rid of repeated edges and build an undirected graph. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/69a/9dd/9b8/69a9dd9b8656d0508a3e0f760349a4c1.png"><br><br>  I had to write my own checking function, because I don‚Äôt have one.  And, for one thing, combine the graphs together.  Strangely enough, it works for quite a long time ... As a result, the number of links should decrease slightly less than twice, because the links from <b>gMyFriends are</b> not duplicated. <br>  All right, you can build!  Only nothing will be clear.  So we continue to code until it becomes clear. <br><br>  In order to become clear, it is necessary to change the type of graph vertices.  This can be done with the <b>VertexShape</b> option of the <b>Graph</b> function.  <b>VertexShape</b> accepts a list of rules for replacing names with any objects.  The names of the vertices in this case are a list of <b>gMyFriends</b> , extended with just one element - the user <b>myID</b> .  Thus, it is necessary to obtain information for all the elements of the list <b>[[myFriends, myID]]</b> and make this rule out of it.  Remember the boiled teapot?  It's about time.  You have a couple of minutes to drink tea. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d8/cf4/9ee/2d8cf49ee719347754c47bd6fe9ca0d0.png"><br><br>  What is cool is that all the infa is requested immediately in one request.  Only it is necessary to remove parentheses and spaces from <code>ToString@Append[myFriends, myID]</code> . <br>  Now we have an array of what needs to be replaced and an array of what needs to be replaced.  But no, not yet.  You need everything to be beautiful. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/71c/422/f15/71c422f15541c563013df2d3cf93c72e.png"><br><br>  First, rectangular frames with the name and avatar are constructed, then they are placed in a three-level list next to the corresponding IDs, and then in each list item from the lists, the function header is replaced from List to Rule.  As a result, we get a list of rules from the list of lists.  (Well, isn't <i>Wolfram Language</i> beautiful?) <br><br>  Now everything is exactly! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/779/391/ac8/779391ac8dd93fdc2cb23945c88697f6.png"><br><br>  You can enjoy the result.  Personally, I managed to export this beauty only to PDF, however, the Cyrillic alphabet disappears, so if your page is Russian, add to the VK function " <code>&amp;lang=en</code> " after " <code>&amp;v=5.16</code> ".  My result looks something like this <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb3/9d4/e70/eb39d4e70ebad2172d47c1cb953b1582.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/edb/43b/92f/edb43b92fc79aade605f4f5f314a9cfe.jpg"><br><br>  Impressive.  Globally.  Especially when contact is the primary means of communication. <br><br>  <a href="http://1drv.ms/1eG02p7">Download notepad here</a> .  More than 300 people in one request no longer pass; it is necessary to share more on this later. <br><hr><br>  (A week has passed) <br><br>  Today they proved to me that it is useless to draw myself on a graph, because in any case you are connected with each of your friends with one connection.  Therefore, this connection is redundant.  I rebuilt my graphs and they have changed.  Also, I added a mechanism to automatically split the list of friends into parts and collect the result.  Now it even shows the progress of the execution - after each request it prints a line and when the lines printed are as many as the parts in the divided list of friends, this is 100%. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c2/1d2/3cb/7c21d23cba0403771255d2887904e15f.png"><br><br>  It was experimentally determined that if there are more than 200 people in one request, problems begin.  The optimal amount is 100. In general, the smaller, the more reliable.  I have 50 because 300 friends in total. <br><br>  And yet, I had to throw out from friends all who have no common.  They are carefully displayed on the screen and are excluded from further calculations. <br><br>  All this is available <a href="https://1drv.ms/u/s!AiTlk9IOjN7Vj2I3SHtN0pYpnBeU">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/216831/">https://habr.com/ru/post/216831/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216815/index.html">In the LA Times earthquake news wrote a robot</a></li>
<li><a href="../216817/index.html">Payment from the account of a corporate or personal phone as from a bank account</a></li>
<li><a href="../216825/index.html">The logic of thinking. Part 16. Batch presentation of information</a></li>
<li><a href="../216827/index.html">CPU Load: when to start worrying?</a></li>
<li><a href="../216829/index.html">10 slideshows with AgileDays 2014</a></li>
<li><a href="../216833/index.html">Where "soap" in WPF comes from and how to deal with it</a></li>
<li><a href="../216837/index.html">Devise: login and registration in modal windows</a></li>
<li><a href="../216839/index.html">The colors and the difference between them in LESS / Sass</a></li>
<li><a href="../216843/index.html">We start to study Cortex-M on the example of STM32</a></li>
<li><a href="../216845/index.html">Search for solutions for games with words. Boron application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>