<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>API Jellyfish: write full text RSS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Like many others who use RSS, I get strained by feeds that return the news not entirely, but only a short version. In this case, it is not possible to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>API Jellyfish: write full text RSS</h1><div class="post__text post__text-html js-mediator-article">  Like many others who use RSS, I get strained by feeds that return the news not entirely, but only a short version.  In this case, it is not possible to read the feed offline. <br><br>  <a href="http://meduza.io/">Meduza.io</a> is not an exception: the text comes cut down, each time you have to go from the reader to the browser to read one news item.  This looked especially awful when there was no normal mobile version on Medusa, the web version on the phone was very slow. <br><br>  There are various services for parsing html in rss, but when I came across a <a href="https://meduza.io/shapito/2015/06/02/vyshel-neofitsialnyy-terminalnyy-klient-meduzy">console client for Medusa</a> , I immediately had a question, what API is used there and can I use it to write my application? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/20a/2d9/61a/20a2d961a2acff591d4fa62550535a5b.png" alt="image"><br><a name="habracut"></a><br><h1>  API </h1><br>  I did not have to go far, the console code <a href="https://github.com/ozio/meduza">is laid out on the githaba</a> and is js-ku, which refers to the desired API. <br><br><h2>  Getting a list of news </h2><br>  <b><a href="https://meduza.io/api/v3/search%3Fchrono%3Dnews%26page%3D0%26per_page%3D10%26locale%3Dru">https://meduza.io/api/v3/search?chrono=news&amp;page=0&amp;per_page=10&amp;locale=en</a></b> <br>  <b>chrono</b> - takes the values ‚Äã‚Äãof <i>news, cards, articles, shapito</i> or <i>polygon</i> , depending on the rubric that we want to receive; <br>  <b>page</b> - <b>page</b> number; <br>  <b>per_page</b> - the number of entries on the page; <br>  <b>locale</b> - <i>ru</i> or <i>en</i> locale; <br><br><h2>  Receive a separate news </h2><br>  <b><a href="https://meduza.io/api/v3/shapito/2015/06/02/vyshel-neofitsialnyy-terminalnyy-klient-meduzy">https://meduza.io/api/v3/shapito/2015/06/02/vyshel-neofitsialnyy-terminalnyy-klient-meduzy</a></b> <br>  It simply replaces the url obtained from the last item. <br><br><h1>  Idea </h1><br>  Take the original rss feed at <a href="https://meduza.io/rss/all">https://meduza.io/rss/all</a> , but instead of the trimmed news substitute the text of the news received through the API. <br><br><h1>  Example of implementation (prototype) </h1><br>  I picked up Ruby and wrote some code to parse the source rss feed: <br><br><pre><code class="ruby hljs">Nokogiri::XML(open(<span class="hljs-string"><span class="hljs-string">'https://meduza.io/rss/all'</span></span>))</code> </pre> <br>  And also the code that parses the json of a single news item: <br><br><pre> <code class="ruby hljs">JSON::parse(open(<span class="hljs-string"><span class="hljs-string">'https://meduza.io/api/v3/'</span></span> + post_url).read)[<span class="hljs-string"><span class="hljs-string">'root'</span></span>][<span class="hljs-string"><span class="hljs-string">'content'</span></span>][<span class="hljs-string"><span class="hljs-string">'body'</span></span>]</code> </pre> <br><br>  We substitute one into the other and we get something as follows: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'open-uri'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'json'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'nokogiri'</span></span> $meduza = <span class="hljs-string"><span class="hljs-string">'https://meduza.io'</span></span> $meduza_rss = $meduza + <span class="hljs-string"><span class="hljs-string">'/rss/%s'</span></span> $meduza_api = $meduza + <span class="hljs-string"><span class="hljs-string">'/api/v3/%s'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meduza</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meduza</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">generate</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">feed</span></span></span><span class="hljs-class"> = '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all</span></span></span><span class="hljs-class">') </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doc</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nokogiri::XML</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">open</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">meduza_rss</span></span></span><span class="hljs-class"> % </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">feed</span></span></span><span class="hljs-class">)) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doc</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xpath</span></span></span><span class="hljs-class">('/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rss</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">channel</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">item</span></span></span><span class="hljs-class">').</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">item</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post_id</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">item</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xpath</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">').</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inner_text</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gsub</span></span></span><span class="hljs-class">(/^</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{$meduza}\//, '') json = JSON::parse(open($meduza_api % post_id).read) item.search('description').each do |description| description.content = json['root']['content']['body'].gsub('src="/image/', 'src="//meduza.io/image/') end end doc.to_xml end end puts Meduza.generate</span></span></span></span></code> </pre> <br>  Along the way, we change the relative url of pictures to absolute ones using the <i>gsub</i> method. <br><br><h1>  Using </h1><br>  Written minimalist application on <a href="http://www.sinatrarb.com/">sinatra</a> , which can be deployed, for example, on the hosting <a href="https://www.heroku.com/">heroku</a> and enjoy the health (and also completely free).  Getting rid of ‚Äúfalling asleep‚Äù applications on heroku will help a service like <a href="https://uptimerobot.com/">this</a> . <br><br>  The source code of the application <a href="https://github.com/sirekanyan/meduza-rss">is posted on github</a> , thank you for your attention! <br><br>  PS Link to the running application <a href="http://meduza.herokuapp.com/rss">meduza.herokuapp.com/rss</a> (as long as the free heroku account can handle the load). </div><p>Source: <a href="https://habr.com/ru/post/259471/">https://habr.com/ru/post/259471/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259459/index.html">Understanding x64 support in WPE Pro</a></li>
<li><a href="../259463/index.html">We calculate gamemasters characters in World of Warcraft using Python</a></li>
<li><a href="../259465/index.html">Modeling objects for animation on Canvas</a></li>
<li><a href="../259467/index.html">How to write your NIF in Elixir</a></li>
<li><a href="../259469/index.html">Manage Windows computers from the Linux console</a></li>
<li><a href="../259473/index.html">Compass with PWM on the stm32f3discovery debug board</a></li>
<li><a href="../259475/index.html">Another language recognizer 4</a></li>
<li><a href="../259477/index.html">That the new versions of the UEFI standards are prepared for us, part two, ACPI 6.0</a></li>
<li><a href="../259479/index.html">Configure OpenSWAN IPsec PSK using NAT Traversal (NAT-T)</a></li>
<li><a href="../259483/index.html">Exploring the format of the level map of the Jackal NES game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>