<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Synchronous clones or simple distributed transactions (PHP)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a long time I tried to put into words why I needed all this, but then I refused the idea. Who is interested - I will answer in the comments. So th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Synchronous clones or simple distributed transactions (PHP)</h1><div class="post__text post__text-html js-mediator-article"> For a long time I tried to put into words why I needed all this, but then I refused the idea.  Who is interested - I will answer in the comments.  So the essence: <br><br>  There are several websites with a similar database, with similar functionality (for example, stores selling the same goods (one owner). <br><br>  Need: add a new product to all stores at the same time.  Or add nowhere in case of an error on at least one.  If it is quite simple, then the ID of records in certain tables should be the same on all sites.  For example, product_id.  Again, I will say - I simplified the task, in fact, everything is much more complicated. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Suppose there is a Product class and a corresponding method on each site. <br><br> <code>class Product <br> { <br> ... <br> public static function createNewProduct($productName) <br> { <br> if ( self::exists($productName) ) { <br> throw new Exception('product exists in database'); <br> //    <br> //   ,    ¬´ -    ¬ª <br> } <br> <br> $db-&gt;execute( <br> 'INSERT INTO products <br> SET name={$productName}'); <br> $newId = $db-&gt;lastInsertId; <br> <br> return new self($newId); <br> } <br> ... <br> } <br></code> <br><br>  That is, on each site a new entry is created as follows: <br><br> <code>&lt;?php <br> $product = Product::createNewProduct('new product name'); <br></code> <br><br>  and we need to execute this code on all clone sites, given that an exception is possible on one of them, in which case the entry should not be added to any of the sites. <br><br>  For example: <br><br> <code>beginTransaction(); <br> <br> try { <br> $product = Product::crateateNewProduct('new product name); <br> commitTransaction(); <br> } catch (Exception $e) { <br> rollbackTransaction(); <br> <br> throw new Exception('clone-wide code execution failure'); <br> } <br></code> <br><br>  This is how it should look!  The problem is that: <br><br><ol><li>  exactly the same code needs to be executed simultaneously on all clone sites; </li><li>  The commitTransaction () function should not make a ‚Äúreal‚Äù commit until all clone sites ‚Äúgive the go-ahead‚Äù </li><li>  when a rollbackTransaction () function is hit on at least one of the clones, an exception should be thrown on all clones so that all sites ‚Äúroll back‚Äù even if they have no errors. </li></ol><br><br>  For this: <br><br><ol><li>  let's make it so that the functions for supporting ‚Äúdistributed transactions‚Äù report on the status of the transaction.  For example, a file with the string BEGIN / READY / COMMITED / ROLLBACK is accessible from outside, for example, <a href="http://example1.com/transaction/status.txt">example1.com/transaction/status.txt</a> </li><li>  let's do so that the commitTransaction () function, before confirming the MySQL transaction, ‚Äúruns‚Äù through all known clone sites and checks whether ‚Äúeverything is in order‚Äù and only in this case executed the COMMIT.  Otherwise, it would throw an exception; </li><li>  let's make the rollbackTransaction () function also save the status to the status.txt file so that other clone sites can learn about it and ‚Äúroll back‚Äù </li></ol><br><br>  The picture illustrates this: <br><br><img src="http://7workers.com/files/public/clones.png" alt="image"><br><br>  Similarly, you can execute any code, such as changing the product status or editing the card.  You just need to find a way to pass the 4code, which you need to perform "synchronously on all clones" and call eval ($ code). <br><br>  There is still a small problem - how to make the code run [more or less] simultaneously on all sites.  I decided this with nohup, but I think there are other ways. <br><br>  I would like to discuss all this with habrachelovekami. </div><p>Source: <a href="https://habr.com/ru/post/54414/">https://habr.com/ru/post/54414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../54407/index.html">Commenting and authoring with Google Friend Connect</a></li>
<li><a href="../5441/index.html">Steep learning curve</a></li>
<li><a href="../54410/index.html">Using Yahoo! widgets in business</a></li>
<li><a href="../54411/index.html">WebResearch vs Mozilla Firefox</a></li>
<li><a href="../54412/index.html">What should be the mouse pad, while it has not yet sunk into oblivion</a></li>
<li><a href="../54417/index.html">What is more important - human life or ‚Äúintellectual property‚Äù? "Intellectual property", of course.</a></li>
<li><a href="../54418/index.html">Alternative fame</a></li>
<li><a href="../54419/index.html">Something about Opera</a></li>
<li><a href="../5442/index.html">Where are we going</a></li>
<li><a href="../54421/index.html">Books with and without anchors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>