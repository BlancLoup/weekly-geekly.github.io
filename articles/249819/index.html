<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Proper handling of XAML resources</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 

 About a week ago I read the article ‚ÄúHow to get convenient access to XAML-resources from Code-Behind‚Äù and was not surprised. I apologize ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Proper handling of XAML resources</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr. <br><br>  About a week ago I read the article <a href="http://habrahabr.ru/post/249105/">‚ÄúHow to get convenient access to XAML-resources from Code-Behind‚Äù</a> and was not surprised.  I apologize in <a href="https://habrahabr.ru/users/ebceu4/" class="user_link">advance to EBCEu4</a> , the author of the aforementioned article, because I am going to criticize his approach a little. <br><br>  I would like to note that the article contains only recommendations on the proper use of resources and does not pretend to be complete.  My article will consist of three points.  In the first, I will give an example of the situation when the above approach is justified, in the second - to try to explain why it is wrong to pull resources from the XAML markup in the code-behind, in the third - I will try to give an example of code that helps to avoid such actions. <br><a name="habracut"></a><br><h3>  Item 1. Lawyer </h3><br>  Let's take a closer look at the article I have indicated, and see what the matter is. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This material ended with a call to download the script and use it in their projects, but the author did not give himself the trouble to give an example of a situation when such an approach is justified (as was rightly noted in comments).  In favor of this approach I can give only one example.  Suppose for a moment that you are creating an application, one of the pages of which includes a list of users.  You made a beautiful template for displaying the user, for example, like this: user photo (with the required size and scaling), name / nickname, Skype / phone number, and, of course, status - offline or online. <br><br>  We will not see any problems on the computer - there is enough resources.  But consider the situation when the list includes several thousand users, and you have a low-end device running WinPhone8 / 8.1 in your hands.  Here, obviously, will begin problems with performance.  ListView will be stupid when scrolling, artifacts will arise, and virtualization will not save.  And if in the Universal App you can try to optimize performance using ContainerContentChanging, then in a Silverlight application this will not work (there is simply no such thing). <br><br>  It is in such situations that such an approach is justified: you can refuse binding, spoiling the whole raspberry, and directly ‚Äúfeed‚Äù colors and other resources to controls / items in the sheet, etc.  Looking ahead, when using MVVM and / or Dependency Injections, the game may not be worth the candle, which means we get bad-practice in our project, which can lead to a complication of validation of the final product in the store. <br><br><h3>  Item 2. The Prosecutor </h3><br>  And now - <s>to the wall</s> closer to the point. <br><br>  First, the approach itself surprised me.  Why, <s>for the sake of all saints,</s> except in the case given in the first paragraph, pull resources from the ‚Äúnative‚Äù environment for them (XAML markup) in the code-behind and get an extra chance to get confused in them?  I personally find this practice just criminal and perverted.  And I am going to ‚Äúpoke a little‚Äù with my finger in places of this approach that are weak in my opinion. <br><br>  So: <br><br>  If there is a sudden need to pull resources into the code-behind, it is, gentlemen and ladies, a crutch, which is a sign of either poor architecture, or poorly written controls / resources, or both. <br><br>  Imagine a situation (even for a moment), that your project shot <s>you in the leg</s> and you get income.  But a year goes by and the guys from Microsoft at the <a href="http://www.buildwindows.com/">annual event</a> promise the introduction of a new ecosystem or at least a change in the existing one.  What do we get?  That's right, a high probability of crash as a result of an attempt to draw a renamed, for example, system color or a margin property (or at least anything, in principle).  Accordingly, it is necessary to climb again into the forgotten code and <s>pick up a file to</s> redo a whole bunch.  Not a good prospect, is it? <br><br>  The problem with the development.  If you work hard on something resembling Enterprise, then most likely you use the MVVM pattern and Dependency Injections.  In this case, it is still more fun, because with MVVM you will have to first pull the resource into your VM, and only then forget it to control the view: there is no profit in the performance, and the crutch is here, my dear!  With DI, porridge is brewed even cooler.  Suppose you, in no case, have made your service from the XAML parser, and pull it on an unlimited number of VMs.  Here the parser itself will put a pig on you, for xpath is not the fastest thing, unfortunately.  And if you have a lot of calls to this service, you'd better not write it at all.  From myself I will say that if I tried to use a similar approach on the current project (except for the situation from the example), I would get it. <br><br>  The problem with testing.  In the Enterprise case mentioned, 100% of the tests will be written or, even better, you will use TDD during development.  How do you want to cover such a parser with tests? <br><br><h3>  Point 3. And what to do? </h3><br>  Well, who criticizes - is obliged to provide an alternative solution.  I offer you my own way, which allows you to fully control the presentation of your product without extra crutches and bicycles.  Yes, the code will be more, but the headache is less.  Meet: <br><br><h4>  Converters </h4><br>  For example, depending on the status of the user (offline / online) received from the server, you need to change the corresponding text in the list item. <br><br>  Code: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserStateToStringConverter</span></span> : <span class="hljs-title"><span class="hljs-title">IValueConverter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Convert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Type targetType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parameter, CultureInfo culture</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> UserState) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ((UserState)<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> UserState.Online: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StringResources.Online; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> UserState.Offline: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StringResources.Offline; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertBack</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Type targetType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parameter, CultureInfo culture</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.NotImplementedException(); } }</code> </pre> <br><br>  ConvertBack is not implemented simply as superfluous. <br>  UserState is our enum for 2 values ‚Äã‚Äã(Online / Offline), and StringResources.Online/Offline - the corresponding localized resources (strings). <br><br>  The use of such a converter: <br><br>  Register the namespace with converters: <br><br><pre> <code class="xml hljs">xmlns:converters="clr-namespace:MyApp.Converters"</code> </pre> <br>  We register our converter for user state: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">converters:UserStateToStringConverter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserStateToStringConverter"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Create a template for the user list item. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AudioIconTemplate"</span></span></span><span class="hljs-tag">&gt;</span></span> ...    Header="{Binding UserState, Converter={StaticResource UserStateToStringConverter}}" ...  - ,    . <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Here you are.  Now we see the state in which this or that user is in our list.  Just like a string, the converter can return a property of type Visibility or something else, up to a DataTemplate (although there is another treat for templates).  Go ahead to the XAML resources themselves. <br><br>  Control states - Control States. <br>  With the help of states, you can do everything you want with control with just a few lines of code!  Suppose that while the user is active, the item in the list has a light background, and when it is inactive it becomes darker.  To achieve this, the list element should be control - here the DataTemplate will be replaced with ControlTemplate - and all its (control) states should be described in the ControlTemplate. <br><br>  For example: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ControlTemplate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TargetType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"controls:UserControl"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{TemplateBinding Background}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualStateManager.VisualStateGroups</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualStateGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserStates"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualState</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OfflineState"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Storyboard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColorAnimationUsingKeyFrames</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"(Shape.Stroke).(SolidColorBrush.Color)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserStateTextBlock"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EasingColorKeyFrame</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">KeyTime</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding DoneBadColor, RelativeSource={RelativeSource TemplatedParent}}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColorAnimationUsingKeyFrames</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Storyboard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualState</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualState</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OnlineState"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Storyboard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColorAnimationUsingKeyFrames</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"(Shape.Stroke).(SolidColorBrush.Color)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserStateTextBlock"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EasingColorKeyFrame</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">KeyTime</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding DoneAverageColor, RelativeSource={RelativeSource TemplatedParent}}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColorAnimationUsingKeyFrames</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Storyboard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualState</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">VisualStateManager.VisualStateGroups</span></span></span><span class="hljs-tag">&gt;</span></span> ......  ,    .</code> </pre> <br><br>  Total, the layout is ready.  Now let's see depending on what and how we will change our states.  We have to make a property for our control, to which we will bind the state of the user, obtained from the server in our VM, and from which we push off further: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty UserStateProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"IndentAngle"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(UserState), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(UserControl), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(OnUserStatePropertyChanged));</code> </pre> <br><br>  As you can see, we want the change of the UserStateProperty property to call the OnUserStatePropertyChanged method.  It might look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnProgressControlPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DependencyObject d, DependencyPropertyChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { UserControl sender = d <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> UserControl; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sender != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { sender.ChangeVisualState((UserState)e.NewValue); } }</code> </pre> <br><br>  The ChangeVisualState method will look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeVisualState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UserState newState</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (newState) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> UserState.Offline: VisualStateManager.GoToState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"OfflineState"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> UserState.Online: VisualStateManager.GoToState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"OnlineState"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><br>  Now our control will calmly change its color depending on the value obtained. <br><br>  Sweet - for dessert. <br><br>  In addition to such trivial things as converters and states, there is also such a thing as ContentControl.  And so it allows you to do a lot.  Although, in principle, the approach is brazenly pulled at the converter, but it has been significantly expanded by the nature of ContentControl itself.  Take a look: <br><br>  The base class for DataTemplateSelector (after all, there can be many concrete implementations, isn't it?): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataTemplateSelector</span></span> : <span class="hljs-title"><span class="hljs-title">ContentControl</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> DataTemplate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTemplate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> item, DependencyObject container</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnContentChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newValue</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnContentChanged(oldValue, newValue); ContentTemplate = GetTemplate(newValue, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre><br><br>  And a specific example for our user: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserStateTemplateControl</span></span> : <span class="hljs-title"><span class="hljs-title">DataTemplateSelector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DataTemplate UserOnlineTemplate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DataTemplate UserOfflineTemplate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> DataTemplate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTemplate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> item, DependencyObject container</span></span></span><span class="hljs-function">)</span></span> { UserState state = UserState.Offline; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> UserState) { state = (UserState)item; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CategoryProgressStatus.Offline: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UserOnlineTemplate; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CategoryProgressStatus.Online: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UserOfflineTemplate; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><br>  Ta-a-ak, the class is ready for their needs.  Now let's play with XAML. <br><br>  Let's declare the namespace with our control - selector. <br><br><pre> <code class="xml hljs">xmlns:controls="clr-namespace:MyApp.Controls;assembly=MyApp.Controls"</code> </pre> <br>  Let's write our additional templates that will respond to different states of the control: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserOfflineStateTemplate"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Offline"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource StatusOnlineBrush}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserOnlineStateTemplate"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Online"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource StatusOfflineBrush}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Where StatusOfflineBrush and StatusOnlineBrush are abstract brushes that we, if necessary, initialized bi higher in the XAML markup. <br><br>  And we will slightly change the DataTemplate for the user from step number 1: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserTemplate"</span></span></span><span class="hljs-tag">&gt;</span></span> ...    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controls:StatProgressTemplateControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding UserState}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OfflineTemplate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource NotStartedIconTemplate}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OnlineTemplate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{StaticResource UserOnlineStateTemplate}"</span></span></span><span class="hljs-tag">/&gt;</span></span> ...    . <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Well, waiting for the <s>thunder and lightning</s> constructive criticism on his head. <br><br>  Thank you all in advance. </div><p>Source: <a href="https://habr.com/ru/post/249819/">https://habr.com/ru/post/249819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249803/index.html">Mines in Haskell and Gloss: Rapid Prototyping Interactive Graphics</a></li>
<li><a href="../249805/index.html">How to create a game without programming skills</a></li>
<li><a href="../249809/index.html">Zero-day XSS vulnerability in Internet Explorer allows you to attack any sites</a></li>
<li><a href="../249811/index.html">Arduino Pro Mini + current sensor GY-712 monitor the burnout of lamps</a></li>
<li><a href="../249817/index.html">A terrible bug in the Portland Group C ++ compiler</a></li>
<li><a href="../249825/index.html">Jammer: we suppress GSM, 3G, 4G, WiMAX, Yota</a></li>
<li><a href="../249831/index.html">Bookmark syncing is already in Opera 28 beta</a></li>
<li><a href="../249837/index.html">Manage Remote IIS</a></li>
<li><a href="../249839/index.html">Programming Philosophy 4 - Chapito Technology</a></li>
<li><a href="../249843/index.html">Anonymous Santa Claus 2014 - Post boasting Christmas gifts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>