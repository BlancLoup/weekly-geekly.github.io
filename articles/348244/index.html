<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why the logistic regression results in SAS and R do not match</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps this topic will not be a discovery for experienced statisticians. However, I am sure that less experienced statistics and R-programmers will b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why the logistic regression results in SAS and R do not match</h1><div class="post__text post__text-html js-mediator-article">  Perhaps this topic will not be a discovery for experienced statisticians.  However, I am sure that less experienced statistics and R-programmers will be able to discover new aspects of logistic regression, since I could find details about the reasons for the discrepancy between the results of statistical packages only in the SAS documentation. <br><a name="habracut"></a><br><h3>  Introduction </h3><br>  For more than four years I have been doing biostatistics, and all this time I use the R. language in my work. RStudio makes it incredibly simple, convenient and at the same time a powerful analysis tool.  However, for almost a year now I have been working in a contract research organization (CRO).  <a href="https://en.wikipedia.org/wiki/Pharmaceutical_industry">Business</a> dictates its work standards, and calculations for the vast majority of serious clinical research are performed on the <a href="https://en.wikipedia.org/wiki/SAS_(software)">SAS</a> platform. <br><br>  SAS as a language is not bad and even good at something, although it is built on the basis of a number of strange concepts from the distant 1976, the description of which could be the reason for a separate large article.  The presence of these concepts in SAS today is quite understandable: leading its history from punch card work, the company now has to maintain backward compatibility with previous versions of its products, since in clinical studies the concept of reproducible research is of great importance.  This makes it impossible to make radical changes to the syntax of the language, as happened between versions of Python 2.7.x and 3.x.  What is really sad is the current IDE status for SAS, none of which (three in the delivery set) are even half as good as RStudio. <br><br>  There is an opinion that the transition from SAS to R is much easier, but my story is the opposite.  My way to learn the features of SAS is to compare the results obtained in it with R. This practice became particularly relevant after the case when, during dual programming, both SAS programmers misunderstood the manual on SAS Help and made the same error in the implementation of the method.  In addition, since even the <a href="https://ru.wikipedia.org/wiki/Food_and_Drug_Administration">FDA</a> <a href="https://www.r-bloggers.com/how-r-is-used-by-the-fda-for-regulatory-compliance/amp/">uses</a> R, it is very important that a potential validator be able to get results identical to our calculations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Essence of the question </h3><br>  In one study, we needed to build models based on logistic regression in order to analyze the possible relationship between a number of baseline characteristics of patients with hepatitis C and treatment success. <br><br>  The task is rather trivial (but if you are not familiar with it, I suggest examples for <a href="https://stats.idre.ucla.edu/sas/dae/logit-regression/">SAS</a> and for <a href="https://stats.idre.ucla.edu/r/dae/logit-regression/">R</a> with a good description of <a href="https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faq-how-do-i-interpret-odds-ratios-in-logistic-regression/">interpretation</a> ).  Questions arose when the results of the usual <i>univariate logistic regression</i> in several cases did not coincide between the two packages.  Most often, of course, the results are the same.  Sometimes it is only rounding (for example, 0.1737 and 0.1738 for <em>p-value</em> ).  But in some cases, the difference in the values ‚Äã‚Äãof <em>Œ≤-</em> coefficients and probabilities ( <em>p-value</em> ) is obvious. <br><br>  Consider an example with the categorical predictor ‚ÄúMethod of infection‚Äù in which the value ‚ÄúBlood transfusion‚Äù is chosen as the base level of the factor. <br><br><div class="spoiler">  <b class="spoiler_title">The code and the results of R (the response is represented by the values ‚Äã‚Äã0 and 1):</b> <div class="spoiler_text"><pre><code class="hljs erlang"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">library</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(haven)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">library</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(car)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setwd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"C:/test"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adis</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_sas</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"adis.sas7bdat"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adis</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">recode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(adis, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"''= NA"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adis</span></span></span><span class="hljs-function">$MODEHCV = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">factor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(adis$MODEHCV, levels = c(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Blood transfusions"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Dental procedures"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Other"</span></span></span></span><span class="hljs-function"><span class="hljs-params">), ordered = FALSE)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mylogit</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">glm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SVR12FL ~ MODEHCV, data = adis, family = binomial(link = 'logit'))</span></span></span></span></code> </pre> <br><img src="https://habrastorage.org/webt/nz/nl/ql/nznlqliyr44pcibeu7p93xelhbc.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">SAS code and results (response represented by N and Y values):</b> <div class="spoiler_text"><pre> <code class="go hljs">%let dir=C:\test; LIBNAME source <span class="hljs-string"><span class="hljs-string">"&amp;dir\DataIN"</span></span> access=readonly; DATA adis; set source.adis; RUN; PROC LOGISTIC data = adis; class MODEHCV (reference = <span class="hljs-string"><span class="hljs-string">'Blood transfusions'</span></span>); model SVR12FL (event = <span class="hljs-string"><span class="hljs-string">'Y'</span></span>) = MODEHCV / expb; RUN;</code> </pre><br><img src="https://habrastorage.org/webt/b2/lt/uq/b2ltuqoinh-wqor45d5ny7nl_yy.png"><br></div></div><br>  As can be seen from the example, despite the fact that the estimates of the odds ratios coincide, the values ‚Äã‚Äãof Œ≤-coefficients in the models are different.  At the same time, the values ‚Äã‚Äãof exp (b) in SAS do not coincide with the <i>odds ratio</i> (OR).  What is most critical for us is that the probability values ‚Äã‚Äã( <i>p-value</i> ) corresponding to the Œ≤-coefficients do not at all coincide with the results of R. <br><br><h3>  Decision </h3><br>  In search of the cause and the way to solve the issue, I unexpectedly discovered that the communities of users of R and SAS overlap very weakly, and in the end only the almighty Google was able to help me.  Many thanks to <a href="http://www.thejuliagroup.com/blog/%3Fpage_id%3D2">Anne-Maria de Mars</a> , who, with a similar comparison of the SAS results with SPSS, contacted the SAS representative and presented the <a href="http://www.thejuliagroup.com/blog/%3Fp%3D1531">solution</a> in her blog, which allowed me to spin the chain. <br><br>  The reason for the differences lies in the coding of the factor levels that are used by default statistical packets.  R and SPSS use a base-level coding approach when building a model ( <i>reference cell parameterization</i> , you can also find <i>reference coding</i> or <i>dummy coding</i> variants) and calculate OR based on the exponentiation of Œ≤-coefficient values, while SAS uses a <a href="https://support.sas.com/kb/23/087.html">different</a> approach - coding the effect ( <i>effect parameterization</i> or <i>effect coding</i> ), which uses a more complex algorithm.  Detailed examples of building models for these coding schemes are presented <a href="https://support.sas.com/documentation/cdl/en/statug/63347/HTML/default/viewer.htm">here</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Change the default scheme in SAS to reference parameterization</b> <div class="spoiler_text"><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">PROC</span></span> <span class="hljs-type"><span class="hljs-type">LOGISTIC</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = adis; class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MODEHCV</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reference</span></span></span><span class="hljs-class"> = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Blood</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">transfusions'</span></span></span><span class="hljs-class">) / param = ref; model </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SVR12FL</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">event</span></span></span><span class="hljs-class"> = '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Y</span></span></span><span class="hljs-class">') = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MODEHCV</span></span></span><span class="hljs-class"> / expb; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RUN</span></span></span><span class="hljs-class">;</span></span></code> </pre><br><img src="https://habrastorage.org/webt/bu/rm/1e/burm1enb9fs8tidgeotatbrucss.png"><br></div></div><br>  Now the OR estimates in SAS coincided completely with the exponents of the corresponding Œ≤-coefficients, and the <i>p-value is</i> completely identical to the results of R. <br><br><h3>  PS </h3><br>  Judging by <a href="https://support.sas.com/documentation/cdl/en/statug/63347/HTML/default/viewer.htm">this</a> material, SAS offers a very wide range of possible coding options for factor levels when building models.  Unfortunately, I failed to find something similar in the documentation for R.  I would be grateful if habrazhiteli can prompt such materials in the comments. </div><p>Source: <a href="https://habr.com/ru/post/348244/">https://habr.com/ru/post/348244/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348232/index.html">3CX v15.5 SP3 Beta: updated conferences, improved hosting and new pricing policy</a></li>
<li><a href="../348234/index.html">Telegram bots. Downloading files larger than 50mb</a></li>
<li><a href="../348236/index.html">Programmer career</a></li>
<li><a href="../348238/index.html">Reverse takeover: VMware can buy Dell</a></li>
<li><a href="../348240/index.html">Native validation as a framework. Lecture in Yandex</a></li>
<li><a href="../348246/index.html">The digest of interesting materials for the mobile developer # 239 (January 29 - February 4)</a></li>
<li><a href="../348248/index.html">Project management software development. Problems and solutions</a></li>
<li><a href="../348250/index.html">As I accelerated the work of the sales department more than 20 times</a></li>
<li><a href="../348252/index.html">Castle or City</a></li>
<li><a href="../348254/index.html">Dart Summit 2018: basic thoughts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>