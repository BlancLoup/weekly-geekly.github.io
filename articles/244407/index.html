<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build robotboks with Wifi control, camera, gun, blackjack, etc.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. I still had an overwhelming desire to share my achievement with the world. The achievement is a tank that rulitsya via WiFi from a gamepad, tra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build robotboks with Wifi control, camera, gun, blackjack, etc.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a3a/a1f/b87/a3aa1fb871f14c6cb866f1c81f5949e9.jpg" alt="image"><br><br>  Hello.  I still had an overwhelming desire to share my achievement with the world.  The achievement is a tank that rulitsya via WiFi from a gamepad, transmits live video to the console, transmits sound from the console and the console, and also has a gun with a laser sight from which you can shoot at someone. <br><br>  This post will be the first test, in order to understand whether it is interesting to someone other than me.  In it I will describe the general structure, the technologies and devices used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPD:</b> added video. <br><br><a name="habracut"></a><br>  For a start, a small video to attract attention.  The sound comes from the tank column. <br><iframe width="560" height="315" src="https://www.youtube.com/embed/u7gimY3YL7s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h1>  How it all began </h1><br>  Long ago, I had a dream to make a tracked robot that could be remotely controlled.  The main problem was the lack of directly tracked chassis.  In the end, I had already decided to buy a radio-controlled tank for disassembly, but I was lucky; among the junk there was a Snow Leopard (Pershing) tank - USA M26 with burned-out electronics, but with a fully serviceable mechanical part.  It was exactly what you need. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b92/ae9/788/b92ae9788864466e8064d6b3cc7b7619.jpg" alt="image"><br><br>  In pursuit of the chassis, two voltage regulators for collector motors, a tripod for a two-servo camera, a webcam with hardware support for mjpeg, and an external WiFi TP-LINK TL-WN7200ND card were purchased.  A little later, a portable speaker, a Creative SoundBlaster Play USB sound and a simple microphone, as well as a pair of USB hubs were added to the device list to connect all this to the control module, which was Raspberry Pi.  The turret from the tank was dismantled, it was very inconvenient to steer it, since all the regular mechanics were built on conventional engines without feedback. <br><br>  Immediately make a reservation that the pictures were taken when the tank was almost ready, and not in the manufacturing process. <br><br><h1>  Power and wiring </h1><br><img src="https://habrastorage.org/files/22f/6e0/3d6/22f6e03d621a4eab99265d7afc403433.jpg" alt="image"><br><br>  In the battery compartment, I crammed the largest Li-Po battery, which got in there.  It turned out to be a two-canned 3300 mAh battery in a solid case, which is usually used in model cars.  I was too lazy to solder, so for the whole switching a standard prototyping board with a step of 2.54 was used.  Later, the second appeared on the top cover and a train that connected them.  For each of the two engines, I had my own voltage regulator, which in the form of a bonus gives a stabilized power of about 5.6 volts.  The Raspberry and the WiFi card were powered from one regulator, power from the second went to servo drives and a USB hub with peripherals. <br><br><h1>  We must make it move </h1><br>  We had to somehow start it.  Raspberry was not chosen by chance.  Firstly, it allows you to put a normal full linux, and secondly it has a bunch of GPIO legs, which, among other things, can generate a pulse signal for servo drives and stroke controllers.  You can generate such a signal using the <a href="https://github.com/richardghirst/PiBits/tree/master/ServoBlaster">ServoBlaster</a> utility.  After launch, it creates the file / dev / servoblaster, into which you can write something like 0 = 150, where 0 is the channel number and 150 is the pulse length in tens of microseconds, that is, 150 is 1.5 milliseconds (for most servos, the range of values 700-2300 ms). <br>  So, we connect regulators for 7 and 11 GPIO pins and start servoblaster with the command: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># servod --min=70 --max=230 --p1pins=7,11</span></span></code> </pre> <br>  Now, if you write the lines 0 = 230 and 1 = 230 in / dev / servoblaster, the tank will jerk forward. <br><br><h1>  We connect the camera </h1><br>  Riding back and forth was great, but I wanted to do it at least in the next room, and ideally through the Internet, so I had to adjust the video in real time.  On the Internet there was a simple project <a href="https://code.google.com/p/tinycamd/">called tinycamd</a> .  The project is a service that is controlled by http, can take screenshots and change camera settings.  Not a lot, but I didn‚Äôt find anything better, so I had to remember C and add what the author didn‚Äôt realize, namely, broadcast the MJPEG stream over HTTP (by the way, how to share the modified source with the world?).  It is crucial here that the JPEG comes from the camera itself, the Raspberry processor is not enough for this.  In the end, I connected to the tank via ssh, opened the video stream through the browser, drove around the house and was happy until the channel sank.  It was very funny to first look at the frozen frame, and then get everything that was stuck in an accelerated mode.  Streaming realtime video over TCP is evil. <br><br><h1>  Upgrades, upgrades, etc. </h1><br>  Then there was a long process of writing the server and client parts in Python using the <a href="http://www.pygame.org/">pygame</a> library to receive events from the gamepad, finishing tinycamd to send a video stream via UDP and installing the camera on a tripod from the servos, so that it would be possible to look around.  After that, the tank went on the first trip around the office beyond the line of sight.  And at that moment it came to be understood that I wanted not only to watch the video, but also to have a two-way audio channel, for example, to ask colleagues to open the door or call the elevator. <br><br><h1>  Sound </h1><br>  To play the sound was used a cheap pocket USB column, bought in the supermarket for the promotion.  It was connected with a simple microphone via USB zvukovuhu.  The <a href="http://sourceforge.net/projects/pyalsaaudio/">pyalsaaudio</a> library was useful for working with sound.  After finishing the server and client, it became possible to talk and listen while splitting up on a tank. <br><br><h1>  Shine </h1><br>  The next feature was the headlight.  At some point, it became clear that the sensitivity of the camera can easily be missed and there is a chance to drive into the dark and not go.  The first idea was infrared light.  A line of infrared LEDs was assembled, but, as practice has shown, zero sense from them.  The light is very bad and not enough.  And ready-made infrared illuminators require 12v power (and I have only 2 banks, that is, 8v maximum), they eat a lot of current, they are cumbersome and expensive.  As a result, it was decided to go into the visible range, two powerful white SMD LEDs and lenses for them were bought.  To power the headlights, the work colleagues created a driver with current regulation, which was switched on via the field-effect transistor by supplying a unit to the Raspberry's GPIO leg.  From now on, dark rooms have ceased to be an obstacle. <br><br><h1>  Battery, more precisely its charge level </h1><br>  At all stages it remained unclear how much more you can ride without killing the battery (Li-Po cannot be discharged lower than 3.3v per can).  I did not find a way to measure the voltage using the Raspberry feet GPIO, so I put the Arduino Nano as a meter, which I immediately connected to the future an LCD screen with an I2C adapter.  The battery is connected through a half divider to the analog leg of the Arduino, after which it remains only to calibrate the readings.  Arduino traditionally communicates with the main module through the COM port, which is also displayed on the GPIO legs of the Raspberry. <br><br><h1>  What is a tank without a gun </h1><br>  One of the last parts of the tank was the gun.  The gun was bought in the same place, in the shop of radio-controlled models in the form of spare parts.  True, it was intended for another model of the tank, but the essence of it has not changed.  The gun is pneumatic, it has an engine that cocks the piston spring, and a contact that closes when fired.  From the horizontal rotation of the gun, I have so far refused, so as not to demolish the whole kit, which is attached to the top cover, and for the vertical I used a powerful servo drive.  To make it easier to steer, I made a turn of the gun in sync with the turn of the camera.  That is, where we look (vertically), go there and shoot.  For aiming at the gun barrel a laser LED was attached to the pointer.  So that once again not to waste the battery and not to shine with a laser where it is not necessary, it was necessary to make the gun detachable.  The process of the shot is also not entirely simple.  It is necessary to turn on the power of the engine and wait for the contact to close, and then turn off the engine.  As a result, the control of the shot and the power of the serva and the laser was hung on the arduin, and the signal for the servo is generated by the Raspberry.  For the engine, the gun also had to carry out a separate power wire and turn it on gradually, using PWM, since otherwise the interference on power supply arrives and the Arduino goes into reboot.  For the filing of shells, that is, balls, a box of TicTac dragees with a hole in the bottom was used. <br><br>  Probably enough for the first time.  If you like the article, I will slowly write the details in the following posts.  And a few more photos in the end, as well as a fresh video.  True, the quality was not very good, so I apologize to the aesthetes in advance.  <a href="https://github.com/zabbius/prototypes/tree/master/Tank">github link</a> <br><br><img src="https://habrastorage.org/files/f27/f44/1a6/f27f441a63da4862abbd5f006fa52c70.jpg" alt="image"><img src="https://habrastorage.org/files/448/910/dfb/448910dfbdc943e2bfc34e78824575b4.jpg" alt="image"><img src="https://habrastorage.org/files/677/366/346/677366346c3a4d86a7f7bc1215fe0ce3.jpg" alt="image"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xStc3KJoYhc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/CJrAcPq166w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bNnN4PSIEiw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/7gDKNxgxGrU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9tQ7ZWzSzJk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/244407/">https://habr.com/ru/post/244407/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244389/index.html">Flash Drive OneDrive - portable version for OneDrive</a></li>
<li><a href="../244391/index.html">Prepare a sleigh in the summer: Check your readiness for holiday sales (before customers do this)</a></li>
<li><a href="../244395/index.html">Samsung EYECAN + - mouse for people with disabilities</a></li>
<li><a href="../244397/index.html">Monetization of Oculus Rift and Leap motion in quests in reality</a></li>
<li><a href="../244405/index.html">Expressive JavaScript: Project: Platformer game</a></li>
<li><a href="../244413/index.html">Update the app and get a comprehensive promotion package.</a></li>
<li><a href="../244415/index.html">Project Miranda NG receives the ‚ÄúWild Signs‚Äù award (part two)</a></li>
<li><a href="../244417/index.html">Development of the game in 115 kb - hacks, bugs and annoyance</a></li>
<li><a href="../244419/index.html">Productivity without slaps</a></li>
<li><a href="../244421/index.html">PHPStamp - fair generation of DOCX documents from a template</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>