<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IPTables and remote access to the network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, the network is set up, the packets go, the Internet works, the rights are cut - in general the moment when you can take a breath and tackle the se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IPTables and remote access to the network</h1><div class="post__text post__text-html js-mediator-article"> So, the network is set up, the packets go, the Internet works, the rights are cut - in general the moment when you can take a breath and tackle the server for the convenience of not the user, but the administrator.  And what do you want the right system administrator?  Of course!  So that his work duties take away as little free time as possible.  And what serves this best of all is naturally remote access. <br><br>  Today, this is no surprise to anyone - almost everyone has unlimited Internet, so you can get access to your favorite server from anywhere. <br><br>  And what to do, if behind one IP-address a vast network with several servers is hidden, each of which may need access? <br><a name="habracut"></a>  Naturally, there is an option to install something like Radmin on each of them, and use one as a ‚Äútransshipment base‚Äù.  However, Radmin can not always help - you need a full-fledged "native" terminal.  What to do in this case?  You just need to enter the difference to which port to call. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will describe a bit the structure of the network, which will be discussed.  External IP is one.  The gateway server running Linux is connected to the ADSL modem, the second server interface is connected to the network.  The Internet is distributed on several subnets, each of which has a server that can be accessed via RDP. <br><br>  For 192.168.100.1, we assume the address of the external interface of the gateway server.  eth0 - "internal" interface, eth1 - "external".  192.168.1.1 - the address of the first server, 192.168.2.1 - the second one, etc. <br><br>  I think it is not necessary to describe in detail the process of editing rules IPTABLES.  Therefore, we will focus on how to give access from the outside to several servers. <br>  First you need to forward ports from an ADSL modem to the server.  We determine how much we need them.  For example, six - we configure ports from 3384 to 3389 for forwarding. <br><br>  Next, we just need to process the packet that the modem accepts and send it to the server we need: <br><br> <code>iptables -t nat -A PREROUTING -p tcp -d 192.168.100.1 --dport 3385 -j DNAT to-destination 192.168.2.1:3389 <br> iptables -t nat -A PREROUTING -p tcp -d 192.168.100.1 --dport 3386 -j DNAT to-destination 192.168.3.1:3389 <br> iptables -t nat -A PREROUTING -p tcp -d 192.168.100.1 --dport 3389 -j DNAT to-destination 192.168.1.1:3389</code> <br> <br> <code>iptables -A FORWARD -i eth1 -o eth0 -d 192.168.1.1 -p tcp --dport 3389 -j ACCEPT <br> iptables -A FORWARD -i eth1 -o eth0 -d 192.168.2.1 -p tcp --dport 3389 -j ACCEPT <br> iptables -A FORWARD -i eth1 -o eth0 -d 192.168.3.1 -p tcp --dport 3389 -j ACCEPT</code> <br> <br>  What do we get?  If we launch the RDP client to the external address of the modem, the gateway will forward it to the required server within the network, focusing on the ports.  If we specify the connection address without specifying the port, we will connect to the server 192.168.1.1. <br><br>  The method is not perfect, but quite working.  And the main thing is simple and does not require any effort to implement. <br>  Thank you for attention.  I would be glad if it is useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/82559/">https://habr.com/ru/post/82559/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../82552/index.html">PXE Boot in 15 minutes</a></li>
<li><a href="../82553/index.html">Mysql vs. Sql Server - who wins?</a></li>
<li><a href="../82556/index.html">Find a bug and get $ 1337</a></li>
<li><a href="../82557/index.html">Firefox from Sukhoi</a></li>
<li><a href="../82558/index.html">A simple way to protect against shell uploads and their scripts in the uploads folder</a></li>
<li><a href="../82560/index.html">Google refuses to support IE 6</a></li>
<li><a href="../82561/index.html">Google said no to IE 6</a></li>
<li><a href="../82564/index.html">HTC Hero: shopping experience</a></li>
<li><a href="../82566/index.html">New service on Youtube: Youtube Disco</a></li>
<li><a href="../82567/index.html">Conference started PyCamp Kiev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>