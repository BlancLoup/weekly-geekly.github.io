<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends Siri and Xiaomi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article presents a guide to setting up Xiaomi luminaires working over Wi-Fi and Bluetooth with Siri using Homebridge. And also described the rake...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends Siri and Xiaomi</h1><div class="post__text post__text-html js-mediator-article"><p>  This article presents a guide to setting up Xiaomi luminaires working over Wi-Fi and Bluetooth with Siri using Homebridge.  And also described the rake, which I managed to step on. </p><br><p><img src="https://habrastorage.org/webt/b7/fb/61/b7fb61gjfjgtmfailg_ah590oxi.png"></p><a name="habracut"></a><br><p>  Winter.  Cold.  Darkness.  Getting up in the morning is hard. </p><br><p>  They said that dawn lighting can help wake up. </p><br><p>  So what?  I took a nightlight from Xiaomi, or rather <strong>Yeelight</strong> .  It was played a little, was upset from crookedly working software.  But bright and colorful lighting added positive, the workplace has changed, it became more comfortable. </p><br><p>  Looked through the catalog, found the LED strip with the ability to connect via Wi-Fi.  Compared with analogues, turned out to be brighter and cheaper.  I take! </p><br><p>  And again problems with software.  The device falls off, you have to reconnect at the entrance to the program.  Grouping also did not always work correctly, and reaching out to the phone for setting and turning on is not a very gratifying exercise.  Search and buy additional hubs did not, postponed everything until better times. </p><cut text="    "></cut><br><p>  For their birthday, colleagues presented a ‚Äúraspberry‚Äù, in common parlor - Raspberry Pi 3 Model B. It is important that the device has both Wi-Fi and Bluetooth module.  Since I already wrote and studied software for working with HomeKit devices, I remembered that it is possible to include unsupported devices in this infrastructure via a <a href="https://github.com/nfarina/homebridge"><strong>homebridge</strong></a> server written in NodeJS, which emulates the HomeKit API. </p><br><h4 id="shag-1-ustanovka-os">  Step 1. Install the OS </h4><br><p>  We start with the installation of the OS.  I chose Raspbian as the distribution. </p><br><ul><li>  We take a memory card of 8 GB or more (I got 16 GB from% # &amp; @). </li><li>  Format and copy the installer </li></ul><br><p>  At this stage, the first problems arose.  Files for some reason were not copied to the card correctly, although the formatting with the help of the proprietary utility <a href="https://www.sdcard.org/downloads/formatter_4/">SD Memory Card Formatter</a> was successful.  I was going to take the card to the store and take another one, but decided to try an external card reader before that.  And, lo and behold - it all worked! </p><br><p>  It turned out that the problem was in Mac mini, which did not support SDHC format cards. </p><br><ul><li>  We insert the card into the ‚Äúraspberry‚Äù, connect the keyboard, mouse and monitor via HDMI and turn on the power. </li></ul><br><p>  The installer is very simple, and the download is quite fast.  If you have any problems, check out the <a href="https://www.raspberrypi.org/documentation/installation/installing-images/">official documentation</a> . </p><br><h4 id="shag-2-nachalnaya-nastroyka-os">  Step 2. Initial OS Setup </h4><br><ul><li>  We change passwords and set up accounts. </li></ul><br><p>  For remote work with Rasperry Pi </p><br><ul><li>  We include access on <a href="">SSH and VNC</a> .  It is possible through a graphical interface. </li></ul><br><p><img src="https://habrastorage.org/webt/lj/aj/35/ljaj35v8dnth-fq5dyxdvf7bisu.png"></p><br><p>  Initially, the ‚ÄúMalinka‚Äù was powered from a USB port, but at the same time, an indication on the screen that the power was definitely not enough.  Charger from iPhone + micro USB-cord solved this problem. </p><br><p>  All manipulations were carried out in the office due to the lack of a monitor for the initial setup of the house. </p><br><p>  By the weekend, the ‚Äúraspberry‚Äù got to the apartment, and her hands were already itching to quickly connect smart lights. </p><br><p>  Launched Raspberry ... </p><br><p>  Attempting to connect via VNC ... <em>Black screen</em> . </p><br><p>  Attempting to connect via SSH ... <em>No reaction</em> . </p><br><p>  Waiting for Monday and returning to work.  I connect the keyboard, mouse and monitor. <br>  The system does not age.  The problem may have arisen due to damage to the SD card or divine intervention. </p><br><p>  Reinstalled the system.  I remembered the old quote: <em>‚ÄúPeople are divided into two categories:</em> <em><br></em>  <em>those who still do not make backups, and those who already make them, ‚Äù</em> and made a willful decision. </p><br><h3 id="shag-0-delaem-bekap">  Step 0. Make a backup </h3><br><p>  There are many ways.  I chose the most, in my opinion, simple.  Full <a href="https://computers.tutsplus.com/articles/how-to-clone-raspberry-pi-sd-cards-using-the-command-line-in-os-x--mac-59911">copy of the SD card image</a> to a USB flash drive. </p><br><h4 id="sozdaem-obraz">  Create an image </h4><br><ul><li>  Find the SD card in the list: <br><pre><code class="bash hljs">diskutil list</code> </pre> </li></ul><br><p><img src="https://habrastorage.org/webt/ja/mv/ks/jamvksgogwvxrzp9-rx5xrnqnvw.png"></p><br><ul><li>  Save the image to disk: <br><pre> <code class="bash hljs">sudo dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/disk2 of=~/Desktop/raspberrypi.dmg</code> </pre> </li></ul><br><h4 id="vosstanavlivaem-obraz">  Restore the image </h4><br><ul><li><p>  Find the SD card in the list: </p><br><pre> <code class="bash hljs">diskutil list</code> </pre> <br></li><li><p>  Unmount the SD card: </p><br><pre> <code class="python hljs">diskutil unmountDisk /dev/disk2</code> </pre> <br></li><li><p>  Format the card.  It is possible through the utility, it is possible through the Terminal: </p><br><pre> <code class="bash hljs">sudo newfs_msdos -F 16 /dev/disk2</code> </pre> <br></li><li>  Restore the previously saved image: <br><pre> <code class="bash hljs">sudo dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=~/Desktop/raspberrypi.dmg of=/dev/disk2</code> </pre> </li></ul><br><p>  The disadvantage is a long time to restore the image.  It depends on the size of the card, its speed and card reader characteristics.  My process took about 4 hours. <br>  The advantage is simplicity and reliability. </p><br><p>  By the way, you can try to speed up this process.  Detailed instructions on <br>  <a href="https://askubuntu.com/questions/523037/how-would-i-speed-up-a-full-disk-dd">StackExchange</a> . </p><br><p>  After a couple of days, I had to restore from backup again.  When performing any operation, the error "segmentation fault" occurred.  Most likely, the problem was due to a faulty memory card.  I got a new one, this time from Transcend, so far the flight is normal. </p><br><h4 id="shag-3-ustanovka-komponentov">  Step 3. Installing the components </h4><br><p>  We start with the components that <a href="https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi">will be needed to start the</a> server: </p><br><p>  As always, we start by updating the system: </p><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get upgrade</code> </pre> <br><p>  After the update, check version g ++: </p><br><pre> <code class="bash hljs">g++ -v</code> </pre> <br><p>  I had <em>gcc version 6.3.0</em> , to install homebridge I need version 4.9+. </p><br><p>  Next, install NodeJS.  I put version 9: </p><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_9.x | sudo -E bash - sudo apt-get install -y nodejs</code> </pre> <br><p>  The next step is to install Avahi, the library for working with Apple Bonjour services: </p><br><pre> <code class="bash hljs">sudo apt-get install libavahi-compat-libdnssd-dev</code> </pre> <br><p>  At this stage of preliminary preparation is completed. </p><br><h4 id="shag-4-ustanovka-homebridge">  Step 4. Install homebridge </h4><br><p>  Now you can follow the main instructions in <a href="https://github.com/nfarina/homebridge">the project repository</a> . <br>  With the help of the command <em>npm install -g homebridge, the</em> installation was not possible, therefore we follow the instructions of the author of the project and run the installer with <em>sudo</em> and the <em>-g</em> flag <em>--unsafe-perm homebridge</em> : </p><br><pre> <code class="bash hljs">sudo npm install -g --unsafe-perm homebridge</code> </pre> <br><p>  Homebridge is installed.  If you have any problems, you can read <br>  <a href="https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi">wiki</a> </p><br><p>  We proceed to setting up and connecting devices: </p><br><ul><li>  Xiaomi Yeelight Smart Light Strip </li><li>  Xiaomi Yeelight Bedside Lamp </li></ul><br><h4 id="shag-5-yeelight-smart-light-strip">  Step 5. Yeelight Smart Light Strip </h4><br><p><img src="https://habrastorage.org/webt/6r/_q/ml/6r_qml_geah7-krr0vscxxq6hwa.png"></p><br><p>  Light Strip connects via WiFi, its setup is easier.  Start by <a href="https://github.com/Zzm317/homebridge-re-yeelight">installing the plugin</a> : </p><br><pre> <code class="bash hljs">sudo npm install -g homebridge-re-yeelight sudo npm install -g miio@0.14.1</code> </pre> <br><p>  We limit the version of miio to 0.14.1, with a newer plugin it will not work at the moment. </p><br><p>  Now we are searching for devices on the local network.  Before this, of course, you need to connect <em>Yeelight Smart Light Strip</em> over WiFi: </p><br><pre> <code class="bash hljs">miio --discover</code> </pre> <br><p>  We get about the following output to the console: </p><br><pre> <code class="bash hljs">INFO Discovering devices. Press Ctrl+C to stop. Device ID: xxxxxxxx Model info: yeelink.light.strip1 Address: 192.168.1.xxx Token: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx via auto-token Support: At least basic</code> </pre> <br><p>  Write on a piece of paper and proceed to the configuration file configuration. </p><br><h4 id="shag-6-sozdanie-configjson">  Step 6. Creating config.json </h4><br><p>  Create a configuration file.  Go to the <em>~ / .homebridge directory</em> : </p><br><pre> <code class="bash hljs">touch config.json nano config.json</code> </pre> <br><p>  Add the hub and devices we want to manage to the configuration file.  Usually configurations for specific devices are listed on the page with the plugin project, in the <em>config.json</em> file. </p><br><p>  In the config, we add the following information about homebridge and the device that we received in the previous step. </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"bridge"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Yeebridge"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"18:00:27:40:BC:1B"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">51825</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pin"</span></span>: <span class="hljs-string"><span class="hljs-string">"031-45-154"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"platforms"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReYeelightPlatform"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceCfgs"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ColorLEDStrip"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>: <span class="hljs-string"><span class="hljs-string">"192.168.1.253"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"5d0b94f872b4372164b6e61d472d424b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED Strip"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"updatetimer"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"interval"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> }] } ] }</code> </pre> <br><ul><li>  name - the name under which the hub is displayed in the Home application. </li><li>  pin - pin code, you will need to connect homebridge to the Home application. <br>  Next is a description of the connected platforms and accessories. <br>  As a platform for WiFi devices from Yeelight, we use ReYeelightPlatform. </li></ul><br><p>  Device configuration for this platform: </p><br><ul><li>  type - usually on the project page, types are indicated for each supported device. </li><li>  ip and token - received in the previous step. </li><li>  name - the name to display in the Home application. </li></ul><br><h4 id="shag-7-podklyuchenie-xiaomi-yeelight-bedside-lamp">  Step 7. Connecting Xiaomi Yeelight Bedside Lamp </h4><br><p><img src="https://habrastorage.org/webt/za/-m/wi/za-mwidknske2ofvp727x5etu7s.jpeg"></p><br><p>  The device is connected via BLE.  That is, you need an installed Bluetooth module with BLE support.  To work with such devices, another platform is <a href="https://www.npmjs.com/package/homebridge-re-yeelight-ble">needed</a> - <a href="https://www.npmjs.com/package/homebridge-re-yeelight-ble">ReYeelightBLEPlatform</a> </p><br><p>  Install libraries to work with the Bluetooth stack: </p><br><pre> <code class="bash hljs">sudo apt-get install libbluetooth-dev libudev-dev</code> </pre> <br><p>  Find the folder with the installed node modules: </p><br><pre> <code class="bash hljs">npm -g root</code> </pre> <br><p>  I found it at <em>/ usr / lib / node_modules</em> .  Install the necessary rights and perform the installation. </p><br><p>  If you do not install the permissions, but perform the installation under sudo, problems may arise in the future: </p><br><pre> <code class="bash hljs">sudo chown -R $(whoami) /usr/lib/node_modules/ npm install noble sudo apt-get install libcap2-bin sudo <span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> cap_net_raw+eip $(<span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> readlink -f `<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> node`) sudo hciconfig hci0 up</code> </pre> <br><p>  Now install the HomeBridge plugin to support <a href="https://github.com/Zzm317/homebridge-re-yeelight-ble">Xiaomi Yeelight Bedside Lamp</a> : </p><br><pre> <code class="bash hljs">sudo npm install -g homebridge-re-yeelight-ble</code> </pre> <br><p>  <strong>Be careful</strong> when installing other modules that control devices via Bluetooth, compatibility issues may occur.  For example, for a long time I could not figure out why my lamp was constantly turning off.  It turned out that the problem is in the established <a href="https://github.com/vvpossible/homebridge_yeelight">homebridge-yeelight</a> .  After its removal, normal operation was restored.  You may also need this command: </p><br><pre> <code class="bash hljs">sudo npm uninstall -g homebridge-yeelight</code> </pre> <br><p>  We are looking for the device address using: </p><br><pre> <code class="bash hljs">sudo hcitool -i hci0 lescan</code> </pre> <br><p>  The output might look something like this: </p><br><pre> <code class="bash hljs">LE Scan ... 8C:26:A6:3D:67:40 (unknown) 8C:26:A6:3D:67:40 (unknown) FF:B6:36:78:96:A6 RK-M171S F6:24:41:E8:6B:14 XMCTD_ F6:24:41:E8:6B:14 XMCTD_ 76:79:01:46:86:5A (unknown) 76:79:01:46:86:5A (unknown) D6:64:11:49:E6:8D RK-G200S F6:BC:36:68:96:A3 (unknown) D6:66:11:49:E6:8D (unknown)</code> </pre> <br><p>  The desired device is marked as <strong>XMCTD_</strong> . </p><br><p>  In my case, <strong>F6: 24: 41: E8: 6B: 14 XMCTD_</strong> <br>  Add a new <em>ReYeelightBLEPlatform</em> platform and the required device with the specified address to <em>config.json</em> . </p><br><p>  The final <em>config.json</em> will look something like this: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"bridge"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Yeebridge"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"18:00:27:40:BC:1B"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">51825</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pin"</span></span>: <span class="hljs-string"><span class="hljs-string">"031-45-154"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"platforms"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReYeelightBLEPlatform"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"F6:24:41:E8:6B:14"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bedside Lamp"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReYeelightPlatform"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceCfgs"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ColorLEDStrip"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>: <span class="hljs-string"><span class="hljs-string">"192.168.1.253"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"560696f676b4672164b6e61d472d424b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"LED Strip"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"updatetimer"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"interval"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> }] } ] }</code> </pre> <br><h4 id="shag-8-zapusk-homebridge">  Step 8. Start homebridge </h4><br><p>  Run Homebridge for verification using the <em>homebridge command</em> in the console. </p><br><p>  A QR code appears on the screen to add the hub to the Home application.  And just below - the PIN code from the <em>config.json</em> file, it is used for manual connection. </p><br><p><img src="https://habrastorage.org/webt/yc/le/dh/ycledh7wl9ahd7ll-cl1pdjcbsm.png"></p><br><p>  If you see the treasured string <em>[ReYeelight] [BLE] Timer Started</em> , then most likely you have configured the BLE device correctly. </p><br><p>  Your Xiaomi Yeelight Bedside Lamp will flash, the connection is established.  You must confirm it by pressing the MODE button on the lamp. </p><br><p>  At this stage, we have a configured hub and 2 devices connected to it. </p><br><ul><li>  Run the application Home. </li><li>  Click add accessory. </li><li>  We scan the QR code and agree to connect a non-certified device. <br>  home <br>  For each of the connected devices, you can choose the name by which it can be accessed via Siri, and the room in which the device is located. </li></ul><br><p><img src="https://habrastorage.org/webt/m_/_x/2h/m__x2hddn1dnufs1yervjddiqcc.png" width="250"><img src="https://habrastorage.org/webt/tw/5g/id/tw5gidrkmwucy2mcg4ihm4ln_ck.png" width="250"><img src="https://habrastorage.org/webt/0a/qy/yc/0aqyycsblcjep9qkfi4e1o7zz2s.png" width="250"></p><br><p>  When configuring / reconfiguring devices, there may be a problem with the re-addition of <em>homebridge</em> to the Home application.  For its elimination we <a href="https://github.com/nfarina/homebridge/issues/1231">perform the following operations</a> in the folder with homebridge settings. </p><br><ul><li>  Stop working <em>homebridge</em> . </li><li>  Delete the <em>accessories</em> and <em>persist</em> catalogs: </li></ul><br><pre> <code class="bash hljs">rm -r accessories rm -r persist</code> </pre> <br><p>  Start homebridge and add the hub to the Home application again. </p><br><p>  Read more about customizing accessories, rooms, and scripts on the <a href="https://support.apple.com/ru-ru/HT204893">Apple</a> website. </p><br><h4 id="shag-9-zapuskaem-homebridge-pri-zagruzke-raspberry-pi">  Step 9. Start Homebridge when booting the Raspberry Pi </h4><br><p>  After the device reboots, you must automatically resume Homebridge.  To do this, <a href="https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi">run</a> as a <a href="https://timleland.com/setup-homebridge-to-start-on-bootup/">service</a> . </p><br><p>  We load two files, homebridge and homebridge.service by <a href="https://gist.github.com/johannrichard/0ad0de1feb6adb9eb61a/">reference</a> .  The <em>homebridge</em> file is placed in <em>/ etc / default</em> .  The <em>homebridge.service</em> file <em>is</em> placed in <em>/ etc / systemd / system</em> . </p><br><p>  <em>We</em> make changes to the <em>homebridge.service</em> file.  <em>ExecStart = / usr / local / bin / homebridge path $ HOMEBRIDGE_OPTS</em> change to <em>ExecStart = / usr / bin / homebridge $ HOMEBRIDGE_OPTS</em> . </p><br><p>  Add a user under which the service will run: </p><br><pre> <code class="bash hljs">sudo useradd --system homebridge</code> </pre> <br><p>  Create a folder to store the homebridge configuration, copy configs and set permissions: </p><br><pre> <code class="bash hljs">sudo mkdir /var/homebridge sudo cp ~/.homebridge/config.json /var/homebridge/ sudo cp -r ~/.homebridge/persist /var/homebridge sudo cp -r ~/.homebridge/accessories /var/homebridge</code> </pre> <br><p>  We start the service: </p><br><pre> <code class="bash hljs">sudo systemctl daemon-reload sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> homebridge sudo systemctl start homebridge</code> </pre> <br><p>  Checking its status: </p><br><pre> <code class="bash hljs">systemctl status homebridge</code> </pre> <br><h4 id="shag-10-siri-trudnosti-perevoda">  Step 10. Siri.  Translation difficulties </h4><br><p>  Siri is not the easiest girl to talk to. <br>  For example, LED strip should not be called "Table lighting."  Siri is trying to perform "Under the light was," while responding that she can not close the program. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h2/xc/bm/h2xcbmpoxzpks0c-rgrzhfkz3ty.png" width="250"></div><br><p>  Also, do not call the fixture "table lamp".  If you say ‚ÄúTurn on the desk lamp,‚Äù all the lights in the room turn on.  When executing the ‚ÄúTurn off desk lamp‚Äù command, only the desk lamp is turned off.  Most likely, this is the name for the group, but the absence of sane Siri documentation doesn‚Äôt help in understanding this. </p><br><p>  Changing the color of the lighting is also not a trivial task.  For example, in English the team sounds and is pronounced very simply: ‚ÄúChange light color to green‚Äù.  In Russian we get: "Set the color of light to green." <br>  <strong>Change</strong> or <strong>change</strong> , instead <strong>install</strong> does not work.  Instead of ‚Äúcolor of light‚Äù, Siri constantly recognizes a command as ‚Äúlight of light‚Äù or ‚Äúcolor of color‚Äù.  It's time for a speech therapist.  It‚Äôs easier to change the words in this phrase, then Siri will have fewer errors.  As a result, the "stop phrase" sounds like "Set the Light Color to Blue."  Yes, <strong>Light</strong> in the request will be with a capital letter! </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/im/wh/2a/imwh2autsjvyjxkmloia4y3tm2a.png" width="250"></div><br><p>  Small Siri <a href="http://voiceapp.ru/articles/siri-commands">Cheat</a> Sheet: </p><br><pre> <code class="bash hljs">, Siri,  . , Siri,  . , Siri,       50%. , Siri,     .</code> </pre> <br><p>  A small demo for last. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/g7eq0fSF2wg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4 id="zaklyuchenie">  Conclusion </h4><br><p>  For 2 weeks the server has been working steadily and is pleased with the ability to simply manage devices through the Home application.  It is a bit frustrating that work on plug-ins is being abandoned by developers, but the source code is on github, and Homebridge has documentation that describes the process of creating your own plug-in.  In the future, I plan to add new devices and sensors to Home, as well as automate the process of starting devices at the entrance to the apartment.  If you have any questions or suggestions, please write in the comments, I will be glad to help and answer your questions. </p><br><p>  All good and warm spring!  ^ _ ^ </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350312/">https://habr.com/ru/post/350312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350300/index.html">Issue # 13: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../350304/index.html">BizBreeze # 2. CRM Myths and Business Process Problems</a></li>
<li><a href="../350306/index.html">FastTrack Training. "Network Basics". "Area of ‚Äã‚Äãuse of network switches, the value of Cisco switches". Eddie Martin</a></li>
<li><a href="../350308/index.html">Graphs of the message of the President of the Russian Federation 2018</a></li>
<li><a href="../350310/index.html">Web application caching and performance</a></li>
<li><a href="../350314/index.html">The PVS-Studio 6.22 static code analyzer is adapted for ARM compilers (Keil, IAR)</a></li>
<li><a href="../350316/index.html">Creating a game on Lua and L√ñVE - 4</a></li>
<li><a href="../350318/index.html">There is a job for chatbot: virtual assistant help desk</a></li>
<li><a href="../350320/index.html">Rocket straight in the AppStore</a></li>
<li><a href="../350322/index.html">Gentleman's set in the field of marketing and sales of the company-developer of custom software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>