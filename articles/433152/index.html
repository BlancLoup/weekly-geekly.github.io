<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transferring Zimbra from a single server to a multi-server infrastructure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article, we talked about how to install Zimbra on a multiserver infrastructure. In addition to increased resiliency, this infrastructure s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transferring Zimbra from a single server to a multi-server infrastructure</h1><div class="post__text post__text-html js-mediator-article">  In the last article, we talked about how to install Zimbra on a multiserver infrastructure.  In addition to increased resiliency, this infrastructure scales easily and is ideal for both SaaS providers selling access to e-mail and collaboration tools to both the service and large enterprises.  But what to do if Zimbra was initially installed on a single server in your enterprise, but as the company grew and developed, its speed and availability began to decline significantly?  The obvious solution would be to transfer the Zimbra Collaboration Suite to a multiserver infrastructure, but is it possible to do this without long downtime and without losing valuable data? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="image"><a name="habracut"></a><br><br>  It turns out that this is possible.  When using the solution from the company Zextras, the migration process to the new infrastructure will take place in several steps: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Net installation of Zimbra on the desired multiserver infrastructure </li><li>  Installing a Zextras Backup zimlet on the source server </li><li>  Installing Zextras Backup on the target server with Mailbox Storage </li><li>  Creating a backup with the contents of the source server </li><li>  Deploy Zimbra Backup to Target Infrastructure </li><li>  Commissioning multi-server infrastructure with Zimbra </li></ol><br>  The process of multiserver installation Zimbra Open-Source Edition is <a href="https://habr.com/company/zimbra/blog/432782/">described in detail in a previous article</a> .  After the Zimbra elements installed on different servers start working as a whole, you can start the process of ‚Äúmoving‚Äù from the old server to the new infrastructure.  The zemlet Zextras Backup, developed by the Italian IT company <a href="https://www.zextras.com/ru/">Zextras</a> and included in the package of modular extensions Zextras Suite, will perfectly cope with this task. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ce/305/a72/4ce305a729cdd5fcb15d41d94eb79c95.png" alt="image"><br><br>  After installing the zimlet on the source server, run the Export Backup function.  Zextras Backup will scan your server and create a backup, which will contain the contents of mailboxes, user settings and parameters, calendar data, shared files, as well as information about user groups and domains.  After the backup is created, it will not be superfluous to save it somewhere else for reliability.  For these purposes, suitable as an external hard drive, and cloud storage. <br><br>  Note that due to the trial period of 30 days, you can use Zextras Backup to deploy a backup copy of the original Zimbra server on the new infrastructure for free and at the same time evaluate the simplicity and ease of use of Zextras Suite. <br><br>  Zextras Suite should be installed on one or several Mailbox servers of the target infrastructure.  After the installation is complete, you will be able to use the ‚ÄúImport Backup‚Äù feature provided by the Zextras Backup simulator to restore from a backup.  In the dialog box that appears, you can choose which of the reserved elements should be restored on this server.  Thanks to this, the infrastructure administrator of Zimbra can spread various domains or even accounts across different Mailbox servers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bae/289/a75/bae289a75eefd7cba509e44c9b3f2226.png" alt="image"><br><br>  After the restoration of the backup source server on the target infrastructure is completed, you can put into operation the Zimbra multiserver infrastructure. <br><br>  The attentive reader, however, will pay attention to the fact that such a method still implies a break in the operation of the original Zimbra server at the time of taking the backup and deploying it on the target infrastructure.  Depending on the amount of data, such a break can vary from a few minutes to completely unacceptable values.  In the event that the duration of the server outage does not suit you, you can use the ‚ÄúIncremental Migration‚Äù - a method that allows you to migrate without stopping the servers, regardless of the amount of transferred data. <br><br>  In order to perform incremental migration, the user will have to install Zextras Backup on the source server, as well as on one or more Mailbox servers of the target infrastructure.  In order to reduce the load on a working server, it is recommended to connect an external hard disk to it and mount it to the <b>/ opt / zimbra / backup / zextras / folder</b> .  Also, before starting the migration, it is recommended to set the TTL value to 300 in the MX records of the DNS server to speed up the data transfer process as much as possible. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fd/36d/2a6/6fd36d2a6ed3941cef8e81b76136d0ef.png" alt="image"><br><br>  Let's start the migration by disabling all Real Time Scanner servers on all servers using the <b>zxsuite backup setProperty ZxBackup_RealTimeScanner false command</b> .  Then, on the source server, run SmartScan using the <b>zxsuite backup doSmartScan command</b> .  Thanks to this, all our data is exported to the <b>/ opt / zimbra / backup / zextras / folder</b> , and if you have previously mounted an external hard disk, you will also receive backup media.  Note that if you intend to scatter domains from the source server across different Mailbox servers on the target infrastructure, you can also do this using a command like <b>zxsuite backup doExport / path / to / export / folder / domains domain1.com, domain2.com</b> and eventually get backup copies of various domains. <br><br>  After that, you can proceed to the deployment of a backup on the target infrastructure.  To do this, we recommend using the parameter <b>Provisioning Only</b> , which will allow you to import only data from domains, user groups and accounts, ignoring the contents of mailboxes.  To use this parameter, enter <b>zxsuite backup doExternalRestore / path / for / the / data / provisioning_only TRUE</b> on the target server.  Repeat this procedure with each server and backup of the relevant domains if you want to distribute them across different Mailbox servers. <br><br>  As a result, you will get a workable copy of the old north without the contents of the mailboxes.  After that, you can immediately switch the flow of letters to the target infrastructure and then start transferring the contents of mailboxes from the old server using the <b>zxsuite backup doExternalRestore / path / for / the / data /</b> command.  The obvious disadvantage of this approach is that for some time Zimbra users will not have access to the emails sent and received earlier, although they will continue to receive and send email normally.  In addition, during the direct recovery of the contents of the mailbox, server performance drops.  After the restoration of mailbox contents is complete, you can talk about the successful completion of the migration without any downtime. </div><p>Source: <a href="https://habr.com/ru/post/433152/">https://habr.com/ru/post/433152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433138/index.html">Five principles of product design in Booking</a></li>
<li><a href="../433140/index.html">Ready client module Google Pay</a></li>
<li><a href="../433142/index.html">Timeless classics, or review of new attack vectors through Microsoft Office</a></li>
<li><a href="../433144/index.html">Released .NET Core 2.2. What's new? (1 of 3)</a></li>
<li><a href="../433146/index.html">[Competition] Top 25 game consoles (shake old)</a></li>
<li><a href="../433154/index.html">User experience in 5G NR networks expected in real conditions</a></li>
<li><a href="../433156/index.html">Dell goes to the exchange and heading for a hybrid cloud</a></li>
<li><a href="../433158/index.html">Musical parodies from SUSE about Kubernetes, Linus Torvalds and others</a></li>
<li><a href="../433164/index.html">Fast & Furious: Forza Horizon 4 acceleration due to window shaders</a></li>
<li><a href="../433166/index.html">Predicting the time to solve a ticket using machine learning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>