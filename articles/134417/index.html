<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Binary Search to Optimize Data Retrieval Request</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 It is very popular now with optimizing work with various DBMS. At numerous forums, discussions are held about ‚Äúthe best DBMS in the wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Binary Search to Optimize Data Retrieval Request</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  It is very popular now with optimizing work with various DBMS.  At numerous forums, discussions are held about ‚Äúthe best DBMS in the world‚Äù, but often all this flows into unreasonable cries that ‚ÄúI have learned the meaning of life and realized that the best data repository is X‚Äù. <br><br>  Yes, of course, now we can observe the active development of NoSQL solutions that allow us to do a lot.  But this article is not about them.  So it turned out that I changed the job and in the load I got one very interesting project on a bunch of php + MySQL.  There are many good decisions in it, but it was written without calculation for a large audience.  Over several years of existence, the number of active users began to approach numbers with 7 zeros.  Since the project is a kind of social network with game elements, the table with users was not the most ‚Äúheavy‚Äù of all.  I inherited tables with tens of millions of user items, personal messages, billing records, etc. The project began to be refactored, split into several servers and achieved significant results.  Now everything is stable. <br><br>  But recently a new task was sent to my email.  The bottom line was to collect statistics.  After analyzing the requirements, I realized that to execute, it suffices to write a single query that performs 3 INNER JOINs on tables whose dimensions were impressive.  Each table contained an average of 40 million records.  It turns out that the temporary table would consist of 4 * 4 * 4 * 10 ^ 21 = 64 * 10 ^ 21 records.  This is a colossal figure.  And to load a DBMS with such a request for collecting statistics is an unaffordable luxury. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Further, in fact, I want to present a solution to this abstract problem, which came to my mind when I remembered computer science classes in the first year of university. <br><br><a name="habracut"></a><br><br>  (the project uses the MySQL DBMS, but the algorithm does not have any specific features) <br><br><h4>  What is binary search </h4><br><br>  I think that many of you have written labs dedicated to finding an element in an array using a binary algorithm.  I will try to summarize its essence. <br><br>  Suppose we have a sorted array of <b>n</b> elements: <br><br>  <i>First array element = 1</i> <i><br></i>  <i>Last array element = n</i> <br><br>  We need to find the index of the element with the value <b>f</b> . <br><br>  Each step is that we calculate the middle of the array: <br><br>  <i>Mid-array = round (First element + Last element) / 2</i> <br><br>  Then we calculate the value of this element and check more or less the obtained value in comparison with the desired <b>f</b> .  Search range is reduced by 2 times: <br><br>  <i>If &lt;middle value&gt;&gt; f, then</i> <i><br></i>  <i>Last array element = mid value</i> <i><br></i>  <i>Otherwise</i> <i><br></i>  <i>First array element = mid value</i> <br><br>  These steps are repeated until one of the conditions: <br><br><ul><li>  The modulus of the difference between the mean and <b>f is</b> less than some <b>epsilon</b> (where epsilon, some error) </li><li>  The number of iterations exceeded the value of <b>log2 (the number of elements in the array)</b> </li></ul><br><br>  I think the point is clear.  Thus, we significantly speed up the search for the right element by reducing the search ranges, but sacrifice some accuracy of calculations (for statistics, this is not critical if a couple of elements from millions are not taken into account. Otherwise, you need to make the epsilon zero and complete the search only after reaching the last level tree). <br><br><h4>  Go to practice </h4><br><br>  So, suppose we need to make an INNER JOIN on 3 tables, and then set the condition ‚Äúcolumn <b>x</b> in the range between 10 and 20‚Äù.  And the column <b>x</b> has no index.  It will be very long executed.  Here it comes to the aid of this simple way. <br><br>  We take a table with this same column and use a binary search on it to search for a range of primary keys that satisfy the condition 10 &lt;= <b>x</b> &lt;= 20.  Given that for such a sample, we will only use indices, very soon we will get the desired pair of values. <br><br>  It is worth saying that a binary search is used to find one element, not a range, but nobody prevents us from finding the first element with a value of 10 and the last element with a value of 20. Their primary keys will be range constraints. <br><br>  With this range, we go back to our query, but now instead of the condition <b>WHERE x&gt; = 10 AND x &lt;= 20</b> we write <b>WHERE id_x BETWEEN min_id_x AND max_id_x</b> , where <b>min_id_x</b> and <b>max_id_x</b> is the value of the lower and upper edges of the range that satisfies the condition. <br><br>  What we get: now we do a sample not for a certain column <b>x</b> , but for the primary key.  Time spent on traversing a single table saved.  A similar procedure can be carried out with other conditions in the request. <br><br>  I don‚Äôt see the point here to give the <a href="http://ru.wikipedia.org/wiki/%25C4%25E2%25EE%25E8%25F7%25ED%25FB%25E9_%25EF%25EE%25E8%25F1%25EA">code, since the binary search code</a> can be found on Wikipedia, and the query itself is nothing supernatural. <br><br><h4>  findings </h4><br><br>  This algorithm allows you to transfer conditions from fields without indices to primary keys, which significantly speeds up the work of the query.  But the method can not be considered a panacea. <br><br>  <b>First</b> , it is difficult to prepare a universal solution for all requests.  In any case, it will be necessary to take into account the details of the implementation of a particular table and, as a result, to spend time each time optimizing. <br><br>  <b>Secondly</b> , this method is not suitable for all solutions, since the rows in the table must be sorted in a certain order. </div><p>Source: <a href="https://habr.com/ru/post/134417/">https://habr.com/ru/post/134417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134412/index.html">Android application development on the example of Calculator ++. From idea to implementation</a></li>
<li><a href="../134413/index.html">"Validity" extensions for Firefox and a couple of little things</a></li>
<li><a href="../134414/index.html">Beautiful and effective email marketing</a></li>
<li><a href="../134415/index.html">Google+-like navigation</a></li>
<li><a href="../134416/index.html">Pocket router Sapido RB-1632</a></li>
<li><a href="../134418/index.html">Inside the perverted mind of a security professional</a></li>
<li><a href="../134419/index.html">Droider Show # 19. Durov corner</a></li>
<li><a href="../134420/index.html">We launched a new startup: Pinme.ru</a></li>
<li><a href="../134421/index.html">Inheritance of templates in PHP without using third-party libraries</a></li>
<li><a href="../134422/index.html">S2 site engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>