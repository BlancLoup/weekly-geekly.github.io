<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sending files to the Xamarin.Forms application. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="File transfer between applications is a rather specific feature for the OS. And this is something that is better not to try to do in Xamarin.Forms, is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sending files to the Xamarin.Forms application. Part 1</h1><div class="post__text post__text-html js-mediator-article">  File transfer between applications is a rather specific feature for the OS.  And this is something that is better not to try to do in Xamarin.Forms, is not it?  In fact, this is quite simple, and this post will demonstrate how to get this feature and run it in iOS (in the next post, the case with Android and, if necessary, with UWP will be considered). <br><br><img src="https://habrastorage.org/files/0ca/325/7c9/0ca3257c9aaf4eb680d997fc680717dd.jpg"><br><a name="habracut"></a><br>  This is a common practice of using mobile applications: opening a file in one application and the need to use another for further processing of this file.  For example, you opened a PDF file, and there was a need to make some changes to this file in another application.  When you tap on this PDF file, the ‚ÄúOpen in‚Äù menu appears on the screen, allowing you to import this file into your preferred application. <br><br>  It is worth noting that in this post we are not going to create an application extension to an iOS fragment of the Forms solution so that the application appears when the user taps the Share button (a small rectangle with an arrow going out of it).  In this case, the file transfer to the Forms application will be considered, and not the exchange of content between applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Scenario </h2><br>  The example given in this post is an Xamarin.Forms application registered for the ability to open PDF files and then display them in WebView.  Here will be considered the basics of registration for iOS, and therefore for Xamarin.Forms (This also applies to Android). <br><br><h2>  iOS registration </h2><br>  When I say that the Forms application will be registered, it means that it will work like these screenshots.  Safari has a page with a PDF file. <br><img src="https://habrastorage.org/files/2c0/bec/990/2c0bec9900854051a03016dba17325bc.jpg"><br>  The application is called ‚ÄúOpenForms‚Äù, and in the first screenshot, iOS provides the ability to directly open a file using the quick command ‚ÄúOpen In OpenForms‚Äù. <br><br>  In the second screenshot with a tap on the ‚ÄúMore‚Äù menu, a window with a list of actions will appear below.  Here is the shortcut of the desired application. <br><br><h2>  Info.plist </h2><br>  In order for iOS to understand that this application can process PDF files, you need to correct the Info.plist file.  You need to add a new top-level key.  You can do this with the built-in editor in Xamarin Studio or edit it directly. <br><br>  To use Xamarin Studio, double-click on Info.Plist, and then the built-in editor will open.  Select the ‚ÄúAdvanced‚Äù tab at the bottom of the screen.  In the ‚ÄúDocument Types‚Äù section at the very top, click the ‚ÄúAdd Document Type‚Äù button.  This will add a section like the screenshot below. <br><br><img src="https://habrastorage.org/files/ecc/620/a7a/ecc620a7ad864778bda30c52526f29be.png"><br><br>  So you need to fill it. <br><blockquote>  <b>Name</b> : Any name.  It will be needed for reference later. <br>  <b>Types</b> : This turns into an array of specific strings.  More on this below. <br>  <b>Icons</b> : The location of the shortcuts that will be displayed in the ‚ÄúMore‚Äù menu, instead of the main application shortcut.  Again, this can turn into an array of strings if there is more than one shortcut. </blockquote><br>  Filling in this way will change Info.plist and allow you to register the application to open other file types.  But here it is necessary to understand in more detail to understand what is changing in Info.plist.  It turns out that additional keys can be added to this file, which is not always possible in the IDE. <br><br>  Here is the entire dictionary that was used to register the opening of files of the desired type. <br><br><pre><code class="javascript hljs">&lt;key&gt;CFBundleDocumentTypes&lt;<span class="hljs-regexp"><span class="hljs-regexp">/key&gt; &lt;array&gt; &lt;dict&gt; &lt;key&gt;CFBundleTypeName&lt;/</span></span>key&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">string</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">PDF</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">string</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;key&gt;CFBundleTypeRole&lt;<span class="hljs-regexp"><span class="hljs-regexp">/key&gt; &lt;string&gt;Viewer&lt;/</span></span>string&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">key</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">LSHandlerRank</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">key</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;string&gt;Alternate&lt;<span class="hljs-regexp"><span class="hljs-regexp">/string&gt; &lt;key&gt;LSItemContentTypes&lt;/</span></span>key&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">array</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">string</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">com.adobe.pdf</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">string</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">array</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/dict&gt; &lt;/</span></span>array&gt;</code> </pre> <br>  <code>CFBundleDocumentTypes</code> is the key of the top-level dictionary, which in turn contains an array of other dictionary objects: <br><br><ul><li>  <code>CFBundleTypeName</code> .  This key contains the document type name for the type reference. </li><li>  <code>CFBundleTypeRole</code> .  This key allows the OS to determine the application that will process the file of this type.  In a particular case, this is the Viewer. </li><li>  <code>LSHandlerRank</code> .  Specifies the level of significance of an application for file types.  Microsoft Word is the default for Word files.  Our application is set to Alternate. </li><li>  <code>LSItemContentTypes</code> .  Array of strings  This defines the file types of files that an application can open. </li></ul><br>  It's pretty simple, except for <code>LSItemContentTypes</code> .  Where to get these values?  For this purpose there is a Uniform Type Identifier.  This is the string that identifies the file type.  A list of publicly registered strings can be found on <a href="https://aka.ms/habr_324138_2">this</a> Apple documentation <a href="https://aka.ms/habr_324138_2">page</a> . <br><br>  Now you need to understand how iOS lets the application know that there is a file waiting to open. <br><br><h2>  Response to open iOS events </h2><br>  When someone selects this application to open a PDF file, the following function is called: <br><br><pre> <code class="javascript hljs">public override bool OpenUrl(UIApplication app, NSUrl url, NSDictionary options)</code> </pre> <br>  iOS copies the file to be opened by this application into the repository to which the application has access and which is specified using the <code>NSUrl url</code> parameter.  Next, you need to process this file in Xamarin.Forms. <br><br>  Then AppDelegate will look like this: <br><br><pre> <code class="javascript hljs">App mainForms; public override bool FinishedLaunching(UIApplication app, NSDictionary options) { <span class="hljs-attr"><span class="hljs-attr">global</span></span>::Xamarin.Forms.Forms.Init(); mainForms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App(); LoadApplication(mainForms); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base.FinishedLaunching(app, options); } public override bool OpenUrl(UIApplication app, NSUrl url, NSDictionary options) { mainForms.DisplayThePDF(url.Path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  There are a couple of unusual moments here.  First, the local variable Xamarin.Forms <code>mainForms</code> of the <code>App</code> class in AppDelegate is saved.  You will need it later as an entry point to display the PDF. <br><br>  Also, the <code>DisplayPDF()</code> function in the <code>OpenUrl</code> was called in the <code>OpenUrl</code> function.  This will display the PDF in Xamarin.Forms.  Ideally, you would need to copy the PDF and delete the source specified by the url parameter in order to clear the place.  But not in this case. <br><br><h2>  Xamarin.Forms! </h2><br>  I spent a lot of time talking about iOS setup.  However, when work begins in a real project, the iOS part is nothing more than a formality.  The real work starts from the Xamarin.Forms side: how to process the incoming file.  For this, I left a comment on the display of the PDF to the article I found <a href="https://aka.ms/habr_324138_1">on the Xamarin website</a> .  Here we talk about setting up the renderer. <br><br>  Further, I would like to focus on the entry point to the Forms solution. <br><br>  In the <code>App.xaml.cs</code> file or the <code>App</code> class (the class to which AppDelegate has access) there is a function that defines the interaction between iOS and Forms projects: <br><br><pre> <code class="javascript hljs">public <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DisplayThePDF(string url) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> openFilePage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenFilesPage(url);; _navigationRoot.Navigation.PushModalAsync(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NavigationPage(openFilePage)); }</code> </pre> <br>  This function creates a new Xamarin.Forms page, passes it the location of the file and displays this page modally (In the <code>App</code> class constructor, everything is nested in the <code>NavigationPage</code> and stored in the <code>_navigationRoot</code> variable). <br><br>  Being displayed modally, it will appear on top of everything else that happens in the application, and will not affect the navigation stack in any way (except what appears on top).  Of course, the orientation will be to view the PDF file.  In a real application, you need to check the status of the application itself - what is being displayed at the moment (so that there is no stack of modal windows).  The application workflow may require you to close the entire stack and start over or, if tabs are used, switch to a new one. <br><br>  <code>OpenFilesPage</code> has a subclass of <code>WebView</code> with a custom renderer for each platform.  In this class there is a property the location of the file to be displayed.  Then the custom renderer displays it. <br>  Displaying the file with a custom renderer will help to avoid moving to a specific location of the file in iOS.  But again, this is only in this specific scenario execution.  An important point is the need of the App class at the entry point to access the iOS project. <br><br><h2>  Total </h2><br>  In general, opening a file from an application in the Xamarin.Forms application is not that difficult.  There are some formalities, one of which is to modify the Info.plist file in order to register the application as capable of handling files of a certain type.  And the need to rewrite the <code>OpenUrl</code> function for an iOS application. <br><br>  After that, it all depends on Xamarin.Forms.  You must create an entry point in the <code>App</code> class so that the AppDelegate in iOS can refer to the ‚Äúcommon‚Äù part of the code.  Here you need to act depending on what needs to be done with the file.  You may need to write a custom renderer to display.  Or you can do everything in a general project, if you do not need additional platform functionality. <br><br><h2>  Thank you for the translation. </h2><br><img src="https://habrastorage.org/files/cd5/d4d/eba/cd5d4deba4fb4819a5383ecd863cde63.jpg" align="left" width="120">  <b><a href="https://aka.ms/habr_324138_3">Alexander Alekseev</a></b> - Xamarin-developer, freelancer.  Works with the .NET platform since 2012.  Participated in the development of a procurement automation system at Digamma.  C 2015 went into freelancing and switched to mobile development using Xamarin.  Currently working at StecPoint on an iOS application. <br><br>  It <a href="https://aka.ms/habr_324138_3">manages the XamDev.ru</a> resource and the Xamarin Developers community in social networks: <a href="https://aka.ms/vk_xamarin_developers">VK</a> , <a href="https://aka.ms/fb_xamdev">Facebook</a> , <a href="https://aka.ms/telegram_xamarin_russia">Telegram</a> . </div><p>Source: <a href="https://habr.com/ru/post/324138/">https://habr.com/ru/post/324138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324126/index.html">Logo is clothing</a></li>
<li><a href="../324128/index.html">Configure SSL VPN on the Cisco Router</a></li>
<li><a href="../324130/index.html">Criminal Code of the developer</a></li>
<li><a href="../324132/index.html">What to do if you are locked in rbash</a></li>
<li><a href="../324136/index.html">Splunk. Introduction to machine data analysis - part 1. Examples of SPL queries and log visualization</a></li>
<li><a href="../324140/index.html">How to find vulnerabilities and protect your WordPress site</a></li>
<li><a href="../324142/index.html">Setting up automatic deployment of independent development environments on one machine (Docker, Ansible, TeamCity)</a></li>
<li><a href="../324144/index.html">Java memory leak diagnostics</a></li>
<li><a href="../324146/index.html">Top 3 NPS Survey Services (Consumer Loyalty Index)</a></li>
<li><a href="../324148/index.html">What is a ‚Äúmaster data management system‚Äù and why is it needed?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>