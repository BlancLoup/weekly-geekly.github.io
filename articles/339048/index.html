<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Swift Generics: Styles for UIView and more. # 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This publication is a continuation of the issue , where the theme of decorating objects was touched. Familiarization with the first publication will h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Swift Generics: Styles for UIView and more. # 2</h1><div class="post__text post__text-html js-mediator-article"><p>  This publication is a continuation of the <a href="https://habrahabr.ru/post/327662/"><u>issue</u></a> , where the theme of decorating objects was touched.  Familiarization with the first publication will help to better understand the current context, because  previously mentioned terms and solutions will be described with simplifications. </p><br><p>  The approach was very successful and was repeatedly tested on real projects.  In addition, there were additions to the approach and its usability has increased significantly. </p><br><p>  Let me remind you that the main element of the presented style setting method is the generalized closure: </p><br><pre><code class="hljs coffeescript">typealias Decoration&lt;T&gt; = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T)</span></span></span><span class="hljs-function"> -&gt;</span></span> Void</code> </pre> <br><p>  You can use this closure to impart <u><code>UIView</code></u> properties as follows: </p><a name="habracut"></a><br><pre> <code class="hljs pgsql">let decoration: Decoration&lt;UIView&gt; = { (<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>: UIView) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.backgroundColor = .white } let <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = UIView() decoration(<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>)</code> </pre> <br><h4 id="kompoziciya-dekoraciy">  The composition of the scenery </h4><br><p>  Using the operator of addition and observing the order of application of the scenery, you can get the mechanism of composition of the scenery: </p><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> +&lt;T&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lhs: @escaping Decoration&lt;T&gt;, rhs: @escaping Decoration&lt;T&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Decoration</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { (value: <span class="hljs-type"><span class="hljs-type">T</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lhs(value) rhs(value) } }</code> </pre> <br><p>  You can add not only closures that accept objects of the same class.  However, it should be noted that the class of the object passed to one of the closures must be a subclass of the object passed to the other closure: </p><br><pre> <code class="hljs objectivec">Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UISwitch</span></span>&gt; + Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UISwitch</span></span>&gt; = Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UISwitch</span></span>&gt; Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UISwitch</span></span>&gt; + Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span>&gt; = Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UISwitch</span></span>&gt; Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UISwitch</span></span>&gt; + Decoration&lt;<span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span>&gt; = </code> </pre> <br><h4 id="sozdanie-dekoraciy">  Creation of scenery </h4><br><p>  The main inconvenience in creating the scenery was writing the code for the decoration design itself.  I had to write the type of decoration, the closure, the type of class inside the closure ... Most often it ended CTRL + C, CTRL + V. </p><br><p>  To get out of the situation and generate a closure through autocomplete, a universal function was written that accepted the type of object: </p><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decor</span></span></span><span class="hljs-function">&lt;T&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type: T.</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, closure: @escaping Decoration&lt;T&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Decoration</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> closure }</code> </pre> <br><p>  Used this as follows: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> decoration = decor(<span class="hljs-type"><span class="hljs-type">UIView</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { (view) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> view.backgroundColor = .white }</code> </pre> <br><p>  But <u><code>self</code></u> not autocomplete and the function could not be called <u><code>decoration</code></u> , since  most often create a closure with the name of <u><code>decoration</code></u> and an error occurred: </p><br><blockquote>  error: variable used within its own initial value <br>  let decoration = decoration (UIView.self) {(view) in </blockquote><p>  A more successful solution was the creation of a universal <u><code>static</code></u> function: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decoration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(closure: @escaping Decoration&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Self</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Decoration</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Self</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> closure } }</code> </pre> <br><p>  To create a decorative closure in the end can be as follows: </p><br><pre> <code class="hljs pgsql">let decoration = UIView.decoration { (<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.backgroundColor = .white }</code> </pre> <br><h4 id="sostoyanie">  condition </h4><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyView</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isDisabled: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isFavorite: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isSelected: <span class="hljs-type"><span class="hljs-type">Bool</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><p>  Most often, the combination of such variables is used only to change the style of a particular <u><code>UIView</code></u> . </p><br><p>  If you try to describe the state of the <u><code>UIView</code></u> style of a single variable, then you can use enums.  However, <u><code>OptionSet</code></u> , which allows for combinations, is even better. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyViewState</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OptionSet</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rawValue: <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(rawValue: <span class="hljs-type"><span class="hljs-type">Int</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.rawValue = rawValue } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> normal = <span class="hljs-type"><span class="hljs-type">MyViewState</span></span>(rawValue: <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> disabled = <span class="hljs-type"><span class="hljs-type">MyViewState</span></span>(rawValue: <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> favorite = <span class="hljs-type"><span class="hljs-type">MyViewState</span></span>(rawValue: <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> selected = <span class="hljs-type"><span class="hljs-type">MyViewState</span></span>(rawValue: <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hashValue: <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rawValue } }</code> </pre> <br><p>  You can apply as follows: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyView</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: <span class="hljs-type"><span class="hljs-type">MyViewState</span></span> = .normal } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> view = <span class="hljs-type"><span class="hljs-type">MyView</span></span>() view.state = [.disabled, .favorite] view.state = .selected</code> </pre> <br><p>  In the <a href="https://habrahabr.ru/post/327662/">last publication</a> a generalized structure was introduced, having a pointer to an instance of the class to which the decorations will be applied. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object: <span class="hljs-type"><span class="hljs-type">T</span></span> }</code> </pre> <br><p>  In the generalized <u><code>Decorator</code></u> structure, we introduce an additional variable that will be responsible for the state of the style. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: <span class="hljs-type"><span class="hljs-type">AnyHashable?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-comment"><span class="hljs-comment">// } set { // } } }</span></span></code> </pre> <br><p>  Preserving the state of an object through a generalized structure was made possible using <u>runtime</u> functions of the association of objects.  We introduce a class that will be associated with the decoration object and will contain the necessary variables. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Holder</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = <span class="hljs-type"><span class="hljs-type">Optional</span></span>&lt;<span class="hljs-type"><span class="hljs-type">AnyHashable</span></span>&gt;.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-type"><span class="hljs-type">KEY</span></span>: <span class="hljs-type"><span class="hljs-type">UInt8</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> holder: <span class="hljs-type"><span class="hljs-type">Holder</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Self</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> holder = objc_getAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-type"><span class="hljs-type">KEY</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Holder</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Self</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holder } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> holder = <span class="hljs-type"><span class="hljs-type">Holder</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Self</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> policy = objc_AssociationPolicy.<span class="hljs-type"><span class="hljs-type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span></span> objc_setAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-type"><span class="hljs-type">KEY</span></span>, holder, policy) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> holder } } } }</code> </pre> <br><p>  Now the generalized <u><code>Decorator</code></u> structure can save state through the class associated with the <u><code>Holder</code></u> object. </p><br><pre> <code class="hljs cs">extension Decorator <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: Decorable { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: AnyHashable? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>.holder.state } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>.holder.state = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> } } }</code> </pre> <br><h4 id="hranenie-dekoraciy">  Storing scenery </h4><br><p>  If you can store the state of the style, then you can also store decorations for different states.  This is achieved by creating the <u><code>[AnyHashable: Decoration&lt;T&gt;]</code></u> decoration dictionary in the associated with the decoration object instance of the <u><code>Holder</code></u> class. </p><br><pre> <code class="hljs markdown">class Holder<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">T:Decorable</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> { var state = Optional<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AnyHashable</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>.none var states = [<span class="hljs-string"><span class="hljs-string">AnyHashable: Decoration&lt;T&gt;</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>) }</code> </pre> <br><p>  To add decorations to the dictionary, we introduce the function: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state: AnyHashable, decoration: @escaping Decoration&lt;T&gt;)</span></span></span></span> { object.holder.states[state] = decoration } }</code> </pre> <br><p>  You can use as follows: </p><br><pre> <code class="hljs pgsql">let <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = MyView() <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.decorator.<span class="hljs-keyword"><span class="hljs-keyword">prepare</span></span>(state: MyViewState.disabled) { (<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.backgroundColor = .gray } <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.decorator.<span class="hljs-keyword"><span class="hljs-keyword">prepare</span></span>(state: MyViewState.favorite) { (<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.backgroundColor = .yellow }</code> </pre> <br><h4 id="primenenie-dekoraciy">  The use of scenery </h4><br><p>  After filling the vocabulary of the scenery, when the state of the style changes, the appropriate scenery from the dictionary should be applied.  This can be achieved by changing the implementation of the style state setter: </p><br><pre> <code class="hljs cs">extension Decorator <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: Decorable { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: AnyHashable? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>.holder.state } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> holder = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>.holder <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> decoration = holder.states[key] { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>.decorator.apply(decoration) } holder.state = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> } } }</code> </pre> <br><p>  The decoration will be applied as follows: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> view = <span class="hljs-type"><span class="hljs-type">MyView</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   view.decorator.state = .selected</span></span></code> </pre> <br><p>  It is also worth mentioning the case when the object was set to a state of style before the corresponding decoration got into the scenery dictionary.  For such a situation, it is worth refining the function of preparing the scenery for the state: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorator</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decorable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(state: AnyHashable, decoration: @escaping Decoration&lt;T&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> holder = object.holder holder.states[state] = decoration <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> state == holder.state { object.decorator.apply(decoration) } } }</code> </pre> <br><h4 id="animacii">  Animations? </h4><br><p>  If there is something inside the applied decoration that can be animated, ... </p><br><blockquote>  It will be with <br>  rounded corners.  Also effects the mask generated by the <br>  'masksToBounds' property.  Defaults to zero.  Animatable. <br><br>  open var cornerRadius: CGFloat </blockquote><p>  ... then changing the style of the object inside the animation block will lead to the corresponding animations: </p><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.5</span></span>) { view.decorator.state = .selected }</code> </pre> <br><h4 id="zaklyuchenie">  Conclusion </h4><br><p>  A convenient tool for creating, storing, applying, re-using and composition of decorations has been obtained.  The full tool code can be <a href="https://github.com/iwheelbuy/Style/blob/master/Style/Classes/Style.swift"><u>found at the link</u></a> .  As usual, it is possible to install and test through <a href="https://cocoapods.org/"><u>CocoaPods</u></a> : </p><br><blockquote>  pod 'Style' </blockquote></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339048/">https://habr.com/ru/post/339048/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339034/index.html">DevOps coming to our home? Home Minecraft server in Azure using modern DevOps practices</a></li>
<li><a href="../339036/index.html">[CppCon 2017] Bjorn Stroustrup: Learning and teaching modern C ++</a></li>
<li><a href="../339038/index.html">How to debug small programs</a></li>
<li><a href="../339044/index.html">How to bring the first project to the end. Part 2. Myths, mistakes and failures</a></li>
<li><a href="../339046/index.html">Work with resources, or how I pushed through @Cleanup</a></li>
<li><a href="../339050/index.html">Habr advise: how to win the NTI olympiad for schoolchildren in the Big Data profile</a></li>
<li><a href="../339052/index.html">The history of the clock synchronizer DCF77</a></li>
<li><a href="../339054/index.html">How the MobX library helps to manage the state of web applications. Lecture in Yandex</a></li>
<li><a href="../339060/index.html">About interval indices</a></li>
<li><a href="../339064/index.html">MUK becomes an Oracle distributor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>