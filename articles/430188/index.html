<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTTP / 2 configuration using the example of Apache 2.4, PHP 7 and Ubuntu 18.04 LTS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I understand that, perhaps, Apache is not currently the preferred choice for launching new projects on it, nevertheless, it exists, and projects are w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTTP / 2 configuration using the example of Apache 2.4, PHP 7 and Ubuntu 18.04 LTS</h1><div class="post__text post__text-html js-mediator-article">  I understand that, perhaps, Apache is not currently the preferred choice for launching new projects on it, nevertheless, it exists, and projects are working on it.  The choice may fall on it for some personal preference, for compatibility requirements, or for some other reasons ... not the essence.  In this article I want to describe in points how to configure the HTTP / 2 protocol support on the Apache web server, because I use it myself and <s>need</s> such an article I <s>need</s> , and I hope that it will also come in handy for someone in practice. <br><a name="habracut"></a><br>  What is HTTP / 2?  As the name implies, this is the second version of the HTTP protocol.  You can read more about the benefits at least on <a href="https://ru.wikipedia.org/wiki/HTTP/2">Wikipedia</a> .  From myself I can only say that if you are hosted not on shared hosting, then you should support this protocol, like, for example, HTTPS.  Yes, in order for HTTP / 2 to work for you, you will need full access to the machine console (albeit virtual) via ssh or in some other way, as well as the already configured HTTPS (TLS / SSL).  Well, let's get down to business. <br><br><h4>  Step one.  Apache update </h4><br>  The HTTP / 2 protocol is supported by the Apache server since version 2.4.24, so if you have an older version installed, it's time to update it.  But first check: <br><br><pre><code class="bash hljs">apache -v</code> </pre> <br>  This command will give something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="plaintext hljs">Server version: Apache/2.4.37 (Ubuntu) Server built: 2018-10-28T15:27:08</code> </pre> <br>  The first line contains the server version.  If it is greater than or equal to 2.4.24, then we can safely move on to the second step.  Otherwise, you need to update Apache, the current versions of which you can find in the PPA of the famous (if you already had to install something fresh on Debian / Ubuntu) developer - Ond≈ôej Sur√Ω.  PPAs are personal packages that are not included in the official distribution repositories.  Therefore, in order to use them, you first need to teach the system what to get from and where: <br><br><pre> <code class="bash hljs">sudo add-apt-repository ppa:ondrej/apache2</code> </pre> <br>  The guy does a good job, and do not mind getting a small donate, which is quite clearly stated when you connect to his turnips ... <br><br>  Then, in fact, we update the packages: <br><br><pre> <code class="bash hljs">sudo apt update sudo apt upgrade</code> </pre> <br>  And again, check the version of Apache.  If everything went well, Apache will be installed on your server, where you can configure HTTP / 2.  If everything went bad - I'm afraid this is not the topic of this article.  Now go to the second step. <br><br><h4>  Step two.  Using FastCGI </h4><br>  What is FastCGI is better to read, as I said, at least in <a href="https://ru.wikipedia.org/wiki/FastCGI">Wikipedia</a> , because you can not tell it shortly.  You need to switch to PHP running in FastCGI mode (php-fpm).  How it works - a good answer is given on the <a href="https://toster.ru/q/122009">Toaster</a> .  Here I will not go into such nuances, but proceed directly to the installation: <br><br><pre> <code class="bash hljs">sudo apt install php-fpm</code> </pre> <br>  After installation, we will literally be told the following: to enable PHP 7.2 FPM in Apache2, do: <br><br><pre> <code class="bash hljs">sudo a2enmod proxy_fcgi setenvif sudo a2enconf php7.2-fpm</code> </pre> <br>  We do.  After that, you need to disable mod_php, because instead of it you now have php-fpm. <br><br><pre> <code class="bash hljs">sudo a2dismod php7.2</code> </pre> <br>  Generally speaking, the PHP version before you could have been different.  Look for the modules you have installed in the system can be in the directory <b>/ etc / apache2 / mods-available /</b> , and which are active in <b>/ etc / apache2 / mods-enabled</b> <br><br>  Next, restart Apache. <br><br><pre> <code class="bash hljs">sudo service apache2 restart</code> </pre> <br>  and move on to the third step. <br><br><h4>  Step three.  Switch from Prefork to Event </h4><br>  What is MPM and what is the difference between prefork, event, worker - you can read here in <a href="https://rtfm.co.ua/apache-mpm-worker-prefork-ili-event/">this</a> wonderful article ... but now it is really important to know only one thing: the ‚Äústandard‚Äù prefork is <i>not very</i> compatible with HTTP / 2, therefore you need to use more suitable .  Turn off one, turn on the other, restart Apache. <br><br><pre> <code class="bash hljs">sudo a2dismod mpm_prefork sudo a2enmod mpm_event service apache2 restart</code> </pre> <br><h4>  Step Four.  Turn on HTTP / 2 </h4><br>  Either in the configuration file of the host, which can be found in the <b>/ etc / apache2 / sites-enabled /</b> directory, or in the config of the server <b>/etc/apache2/apache2.conf</b> itself, <b>we</b> say that we need support for the new protocol: <br> <code>Protocols h2 h2c http/1.1</code> <br> <br>  What really matters is <b>h2</b> .  Two other points - at your discretion.  <b>h2c</b> is HTTP / 2 support over TCP (and not TLS).  <b>http / 1.1</b> - support for the old version of HTTP. <br><br>  We enable the http2 module and reboot the server: <br><br><pre> <code class="bash hljs">sudo a2enmod http2 service apache2 restart</code> </pre> <br><h4>  Arrived </h4><br>  From now on everything.  Your resource should start working under the HTTP / 2 protocol.  If you use Chrome, go to the resource, you will see how the lightning icon in the upper right corner of the browser has turned blue.  Hovering the cursor over it will give you an HTTP / 2-enabled (h2) hint.  In Firefox, go to the developer panel and on the Network tab, enable the Protocol column ‚Äî for the resources from your site should be HTTP / 2.0.  You can also check if your resource supports this protocol on <a href="http2-test">one</a> of the many sites on the web.  But do not relax, because <a href="https://habr.com/company/globalsign/blog/429820/">HTTP / 3 is</a> coming on the heels :) </div><p>Source: <a href="https://habr.com/ru/post/430188/">https://habr.com/ru/post/430188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430172/index.html">Serverless static site using IPFS</a></li>
<li><a href="../430178/index.html">Chinese artificial sun ...</a></li>
<li><a href="../430180/index.html">Conversations with the "Higher Mind". Contact with a different mind</a></li>
<li><a href="../430182/index.html">CodeOne 2018, like JavaOne, but only in mask</a></li>
<li><a href="../430186/index.html">Lazy computing in everyday life</a></li>
<li><a href="../430190/index.html">Likelihood, P-values ‚Äã‚Äãand reproducibility crisis</a></li>
<li><a href="../430194/index.html">Hyde: creating serverless applications</a></li>
<li><a href="../430196/index.html">Go lintpack: composable linters manager</a></li>
<li><a href="../430198/index.html">From the Geiger counter, matches and arduins. Part One - Theory</a></li>
<li><a href="../430200/index.html">Nvidia stock price fell amid a collapse of the cryptocurrency market and declining interest in mining</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>