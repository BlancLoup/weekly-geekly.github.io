<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Emoji ?! No, I have not heard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Emoji has long entered our lives. And in social networks, and in all sorts of instant messengers, we use them without thinking, expressing our emotion...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Emoji ?! No, I have not heard</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/941/ab3/f10/941ab3f1053b43e19f5c7fd04af5b51a.png" alt="image" align="right">  Emoji has long entered our lives.  And in social networks, and in all sorts of instant messengers, we use them without thinking, expressing our emotions with just one symbol.  But for a cross-platform application, sending and displaying Emoji is not an easy task.  The problem is that sent emoji from mobile apps do not always display correctly on websites. <br><br>  The latest versions of iOS and Android have support for more than 1,200 Emoji characters, but the ‚Äúdesktop‚Äù market cannot boast such success.  We in Badoo want and do everything so that users can comfortably communicate on all platforms, without any restrictions in correspondence. <br>  Next, I will tell you how we achieved 100% Emoji support for the web. <br><a name="habracut"></a><br><br>  This is how a Windows user would see a message in a browser without emoji: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b71/2ee/b1e/b712eeb1e72a42bfadc0eab8c47f871e.png" alt="image"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The basic idea is that we take any Emoji character, define its Unicode code and replace it with an html element that will be displayed correctly in the browser. <br><br><h4>  Theory </h4><br>  Will consider <img src="https://habrastorage.org/files/d17/13a/861/d1713a8612f34d3a9c98d0c2c2eb4d93.png" alt="image">  (smiling face).  It has the code <b>U + 1F600</b> .  How to get its code using javascript: <br><br>  ' <img src="https://habrastorage.org/files/d17/13a/861/d1713a8612f34d3a9c98d0c2c2eb4d93.png" alt="image">  '.length // 2 <br>  ' <img src="https://habrastorage.org/files/d17/13a/861/d1713a8612f34d3a9c98d0c2c2eb4d93.png" alt="image">  '.charCodeAt (0) .toString (16) // D83D <br>  ' <img src="https://habrastorage.org/files/d17/13a/861/d1713a8612f34d3a9c98d0c2c2eb4d93.png" alt="image">  '.charCodeAt (1) .toString (16) // DE00 <br><br>  As a result, we received a surrogate pair: <b>U + D83D</b> <b>U + DE00</b> . <br><br>  UTF-16 encodes characters as a sequence of 16-bit words, it allows you to write Unicode characters in the ranges from U + 0000 to U + D7FF and from U + E000 to U + 10FFFF (a total of 1,112,064).  If it is required to represent in UTF-16 a symbol with a code greater than U + FFFF, then two words are used: the first part of the surrogate pair (in the range from 0xD800 to 0xDBFF) and the second (from 0xDC00 to 0xDFFF). <br><br>  To get the Emoji code that is in the range greater than U + FFFF, we use the formula: <br><br><pre><code class="javascript hljs">(<span class="hljs-number"><span class="hljs-number">0xD83D</span></span> - <span class="hljs-number"><span class="hljs-number">0xD800</span></span>) * <span class="hljs-number"><span class="hljs-number">0x400</span></span> + <span class="hljs-number"><span class="hljs-number">0xDE00</span></span> - <span class="hljs-number"><span class="hljs-number">0xDC00</span></span> + <span class="hljs-number"><span class="hljs-number">0x10000</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>f600</code> </pre> <br>  Now let's translate back: <br><br><pre> <code class="javascript hljs">D83D = ((<span class="hljs-number"><span class="hljs-number">0x1f600</span></span> - <span class="hljs-number"><span class="hljs-number">0x10000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) + <span class="hljs-number"><span class="hljs-number">0xD800</span></span>; DE00 = ((<span class="hljs-number"><span class="hljs-number">0x1f600</span></span> - <span class="hljs-number"><span class="hljs-number">0x10000</span></span>) % <span class="hljs-number"><span class="hljs-number">0x400</span></span>) + <span class="hljs-number"><span class="hljs-number">0xDC00</span></span>;</code> </pre><br><br>  This is quite difficult and inconvenient, consider what we can offer <b>ES 2015</b> . <br><br>  With the new JavaScript standard, you can forget about surrogate pairs and make your life easier: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.prototype.codePointAt <span class="hljs-comment"><span class="hljs-comment">//    , String.fromCodePoint //    .</span></span></code> </pre><br>  Both methods work correctly with surrogate pairs. <br><br>  The ability to insert eight-digit codes in the string: <br>  <b>\ u {1F466}</b> instead of <b>\ uD83D \ uDC66</b> <br><br>  <b>RegExp.prototype.unicode</b> : the <b>u</b> flag in regular expressions gives the best support when running Unicode: <br><br><pre> <code class="javascript hljs">/\u{<span class="hljs-number"><span class="hljs-number">1</span></span>F466}/u</code> </pre><br><br>  At the moment, the Unicode 8.0 standard contains 1281 Emoji characters, and that is not counting skin color modifiers and groups (Emoji family).  There are various implementations from well-known companies: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/d0e/000/8d4/d0e0008d435a47c3b32d74a1c6caf2d8.png" alt="image"></div><br><br>  Emoji can be divided into several groups: <br><br><ul><li>  simple: in the range to 0xD7FF - <img src="https://habrastorage.org/files/81b/627/6c1/81b6276c16ce4f5a9ee133465cc6fc33.png" alt="image">  ; </li><li>  surrogate pairs: from 0xD800 to 0xDFFF - <img src="https://habrastorage.org/files/d17/13a/861/d1713a8612f34d3a9c98d0c2c2eb4d93.png" alt="image">  ; </li><li>  numbers: from 0x0023 to 0x0039 + 0x20E3 - <img src="https://habrastorage.org/files/e4b/1b9/568/e4b1b95685054743867981093b514f6e.png" alt="image">  ; </li><li>  state flags: 2 characters from 0xDDE6 to 0xDDFF, as a result - <img src="https://habrastorage.org/files/5fd/cbf/4b2/5fdcbf4b2bb948ea9cd2e04196c16d1e.png" alt="image">  ; </li><li>  skin color modifiers: <img src="https://habrastorage.org/files/bed/a39/348/beda3934839144a99d8e8a4eb7f9ef26.png" alt="image">  + from 0xDFFB to 0xDFFF - <img src="https://habrastorage.org/files/bcf/1b9/afc/bcf1b9afc13c4dfabdac4217054a43af.png" alt="image">  ; </li><li>  family: a sequence of <img src="https://habrastorage.org/files/bed/a39/348/beda3934839144a99d8e8a4eb7f9ef26.png" alt="image"><img src="https://habrastorage.org/files/bed/a39/348/beda3934839144a99d8e8a4eb7f9ef26.png" alt="image"><img src="https://habrastorage.org/files/700/0c7/959/7000c7959f9d4d1ebf259cdc8435e57c.png" alt="image">  connected 0x200D or 0x200C - <img src="https://habrastorage.org/files/cd4/913/6b1/cd49136b1db04727b90d0f577380a952.png" alt="image"></li></ul><br><br><h4>  Decision: </h4><br><ol><li>  we receive the source text with the symbol, we look for in it with the help of the regular expression all sets of emoji; </li><li>  determine the character code using the codePointAt function; </li><li>  create an img element (it is important that this is the img tag) with a url, which consists of the code of this symbol; </li><li>  replace the character with img in the source text. </li></ol><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">emojiToHtml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">) </span></span>{ str = str.replace(<span class="hljs-regexp"><span class="hljs-regexp">/\uFE0F/g</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str.replace(emojiRegex, buildImgFromEmoji); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tpl = <span class="hljs-string"><span class="hljs-string">'&lt;img class="emoji emoji--{code} js-smile-insert" src="{src}" srcset="{src} 1x, {src_x2} 2x" unselectable="on"&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://badoocdn.com/big/chat/emoji/{code}.png'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url2 = <span class="hljs-string"><span class="hljs-string">'https://badoocdn.com/big/chat/emoji@x2/{code}.png'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildImgFromEmoji</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emoji</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> codePoint = extractEmojiToCodePoint(emoji); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $tpl(tpl, { <span class="hljs-attr"><span class="hljs-attr">code</span></span>: codePoint, <span class="hljs-attr"><span class="hljs-attr">src</span></span>: $tpl(url, { <span class="hljs-attr"><span class="hljs-attr">code</span></span>: codePoint }), <span class="hljs-attr"><span class="hljs-attr">src_x2</span></span>: $tpl(url2, { <span class="hljs-attr"><span class="hljs-attr">code</span></span>: codePoint }) }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extractEmojiToCodePoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emoji</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emoji .split(<span class="hljs-string"><span class="hljs-string">''</span></span>) .map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">symbol, index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emoji.codePointAt(index).toString(<span class="hljs-number"><span class="hljs-number">16</span></span>); }) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">codePoint</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !isSurrogatePair(codePoint); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .join(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSurrogatePair</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">codePoint</span></span></span><span class="hljs-function">) </span></span>{ codePoint = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(codePoint, <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> codePoint &gt;= <span class="hljs-number"><span class="hljs-number">0xD800</span></span> &amp;&amp; codePoint &lt;= <span class="hljs-number"><span class="hljs-number">0xDFFF</span></span>; }</code> </pre><br><br>  The basic idea in a regular expression that finds emoji characters: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emojiRanges = [ <span class="hljs-string"><span class="hljs-string">'(?:\uD83C[\uDDE6-\uDDFF]){2}'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  '[\u0023-\u0039]\u20E3', //  '(?:[\uD83D\uD83C\uD83E][\uDC00-\uDFFF]|[\u270A-\u270D\u261D\u26F9])\uD83C[\uDFFB-\uDFFF]', //   '\uD83D[\uDC68\uDC69][\u200D\u200C].+?\uD83D[\uDC66-\uDC69](?![\u200D\u200C])', //  '[\uD83D\uD83C\uD83E][\uDC00-\uDFFF]', //   '[\u3297\u3299\u303D\u2B50\u2B55\u2B1B\u27BF\u27A1\u24C2\u25B6\u25C0\u2600\u2705\u21AA\u21A9]', //  '[\u203C\u2049\u2122\u2328\u2601\u260E\u261d\u2620\u2626\u262A\u2638\u2639\u263a\u267B\u267F\u2702\u2708]', '[\u2194-\u2199]', '[\u2B05-\u2B07]', '[\u2934-\u2935]', '[\u2795-\u2797]', '[\u2709-\u2764]', '[\u2622-\u2623]', '[\u262E-\u262F]', '[\u231A-\u231B]', '[\u23E9-\u23EF]', '[\u23F0-\u23F4]', '[\u23F8-\u23FA]', '[\u25AA-\u25AB]', '[\u25FB-\u25FE]', '[\u2602-\u2618]', '[\u2648-\u2653]', '[\u2660-\u2668]', '[\u26A0-\u26FA]', '[\u2692-\u269C]' ]; var emojiRegex = new RegExp(emojiRanges.join('|'), 'g');</span></span></code> </pre><br><br><h4>  Chat </h4><br>  Next, we consider how to build a chat prototype with Emoji support. <br><br>  The input field is a div: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"t"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contenteditable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  When entering a message or pasting from the clipboard, we will clear its contents from possible html tags: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tagRegex = <span class="hljs-regexp"><span class="hljs-regexp">/&lt;[^&gt;]+&gt;/gim</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> styleTagRegex = <span class="hljs-regexp"><span class="hljs-regexp">/&lt;style\b[^&gt;]*&gt;([\s\S]*?)&lt;\/style&gt;/gim</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> validTagsRegex = <span class="hljs-regexp"><span class="hljs-regexp">/&lt;br[\s/]*&gt;|&lt;img\s+class="emoji\semoji[-\w\s]+"\s+((src|srcset|unselectable)="[^"]*"\s*)+&gt;/i</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cleanUp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text .replace(styleTagRegex, <span class="hljs-string"><span class="hljs-string">''</span></span>) .replace(tagRegex, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tag</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tag.match(validTagsRegex) ? tag : <span class="hljs-string"><span class="hljs-string">''</span></span>; }) .replace(<span class="hljs-regexp"><span class="hljs-regexp">/\n/g</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); }</code> </pre><br><br>  To process the line inserted from the clipboard, use the paste event: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPaste</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clp = e.clipboardData; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clp !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clipboardData !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clp !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { text = clp.getData(<span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) || clp.getData(<span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { text = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clipboardData.getData(<span class="hljs-string"><span class="hljs-string">'text'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text) { text = cleanUp(text); text = emojiToHtml(text); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> el = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>); el.innerHTML = text; el.innerHTML = el.innerHTML.replace(<span class="hljs-regexp"><span class="hljs-regexp">/\n/g</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); t.appendChild(el); restore(); } } }</code> </pre><br><br>  Then we replace all the emoji found with the img html tag, as shown above.  It is on img, since contenteditable works best with it.  With other elements there may be bugs when editing. <br><br>  After inserting the img in the input field, you need to restore the position of the caret so that the user can continue typing the message.  To do this, use the JavaScript <b>Selection</b> and <b>Range</b> objects: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">restore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> range = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createRange(); range.selectNodeContents(t); range.collapse(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sel = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.getSelection(); sel.removeAllRanges(); sel.addRange(range); }</code> </pre><br><br>  After the message set is completed, the reverse procedure is required.  Namely, turn img into a symbol for sending to the server using the <b>fromCodePoint</b> function: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> htmlToEmojiRegex = <span class="hljs-regexp"><span class="hljs-regexp">/&lt;img.*?class="emoji\semoji--(.+?)\sjs-smile-insert".*?&gt;/gi</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">htmlToEmoji</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> html.replace(htmlToEmojiRegex, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">imgTag, codesStr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> codesInt = codesStr.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>).map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">codePoint</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(codePoint, <span class="hljs-number"><span class="hljs-number">16</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emoji = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCodePoint.apply(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, codesInt); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> emoji.match(emojiRegex) ? emoji : <span class="hljs-string"><span class="hljs-string">''</span></span>; }); }</code> </pre><br><br>  You can see an example of the chat here: <a href="https://jsfiddle.net/q9484hcc/1/">https://jsfiddle.net/q9484hcc/</a> <br><br>  So we developed Emoji support so that our users can fully express emotions and communicate with each other without restrictions.  If you have ideas for improving our methods or changing them - write in the comments, we will be happy to discuss them! <br><br>  Useful links: <br>  <a href="http://emojipedia.org/">http://emojipedia.org/</a> <br>  <a href="http://getemoji.com/">http://getemoji.com/</a> <br>  <a href="https://github.com/mathiasbynens/String.fromCodePoint">Polyphyl String.fromCodePoint</a> <br>  <a href="https://github.com/mathiasbynens/String.prototype.codePointAt">Polyphyl String.prototype.codePointAt</a> <br><br>  Artem Kunets <br>  Badoo frontend developer </div><p>Source: <a href="https://habr.com/ru/post/282113/">https://habr.com/ru/post/282113/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282099/index.html">Django development for Windows using Docker-machine</a></li>
<li><a href="../282103/index.html">Rake, emulator, animator (upd@21.06)</a></li>
<li><a href="../282105/index.html">Rudolf Svoren - a man of legend (the author of the book "Electronics step by step"). Part 2</a></li>
<li><a href="../282107/index.html">As I looked all ...</a></li>
<li><a href="../282111/index.html">ONLYOFFICE 8.8.0: mail and calendar integration, the right to review and other updates</a></li>
<li><a href="../282115/index.html">Essay tool: from idea to monetization</a></li>
<li><a href="../282117/index.html">Free Practical Courses on Basic JavaScript Programming</a></li>
<li><a href="../282119/index.html">We write a simple file parser (for beginners)</a></li>
<li><a href="../282121/index.html">The new cryptographer CryptoBit is distributed through exploit kits that affect the browser.</a></li>
<li><a href="../282123/index.html">Manage database structure without pain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>