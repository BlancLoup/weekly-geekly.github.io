<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Online monitoring of transport with their own hands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Always liked the idea of ‚Äã‚Äãonline monitoring of anything on the map. And now the opportunity to do something similar. 
 I want to share the process an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Online monitoring of transport with their own hands</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://smotra.ru/gps/" title="View in work"><img src="https://habrastorage.org/storage/habraeffect/88/8a/888a787c46b42fe52205e44664c9c7ed.png"></a> <br>  Always liked the idea of ‚Äã‚Äãonline monitoring of anything on the map.  And now the opportunity to do something similar. <br>  I want to share the process and the result of the development with the community. <br><a name="habracut"></a><br><h5>  A little background </h5>  The fact is that the guys from our project gathered in a motor rally around major cities in Russia, and in this connection, an idea came to my mind: it would be great if the site could always see the current location of the expedition. <br>  Began the search for this topic, the analysis of existing solutions. <br>  I came to the following scheme: you need a device that after a certain period of time will send information about the current location via GPRS to the Internet somewhere, and later on our website will show a line (track) from all points on the map. <br><br><h5>  Device selection </h5>  The search for suitable devices has begun.  The range is quite wide: starting with small personal trackers and ending with devices that are installed directly inside the car.  Basically, all the devices are Chinese, but sometimes they even met domestic ones :) <br>  Ultimately, he focused on the <b>Astron GT-102</b> : compact, cheapest, and has all the necessary functions. <br><img src="https://habrastorage.org/storage/habraeffect/bc/6e/bc6eb57e4198819007be8481ef6279b9.jpg" alt="image"><img src="https://habrastorage.org/storage/habraeffect/93/56/9356304fbae1d8775f5eb2b3b6edae13.jpg" alt="image"><br>  I will say a few words about the purchase.  I found the site where this model was sold for 3999 rubles, immediately called and tried to order. <br>  However, there was a nuisance waiting for me: the seller said that they were not in stock, and the current lot was waiting for customs clearance at the border. <br>  As a result, I waited a whole week, calling every day, waiting for this very customs clearance. <br><br>  In the meantime, I found the same model on the well-known <a href="http://www.dealextreme.com/details.dx/sku.33331">DealExtreme</a> site, and at the price of $ 79.96 (~ 2400 rubles).  I wanted to order, but did not want to risk, because  deadlines were pressed, and the parcel could go for a week, or maybe a month and a half (there was an experience of ordering at this store). <br>  Completion and packaging of goods in the Chinese online store and from our <s>baryg</s> entrepreneurs completely coincided :) <br>  By the way, a little about the configuration.  She was surprised by pleasant snacks: a second battery, an additional back cover (with magnets, for attachment to the body), a protective case.  The only thing missing was car charger. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, the device is on the table, a new SIM card with a special ‚ÄúInternet‚Äù tariff plan has been purchased. <br><br><h5>  Tracker setup </h5> It included a small booklet with instructions (even in Russian).  The tracker, despite the presence of USB, is configured via SMS. <br>  The algorithm is simple: we send a message with a command and password from the phone and get the result of the execution in response.  And in response, you can only get a message like <code>&lt;&gt; ok</code> , <code>&lt;&gt; error</code> or not get anything at all (which does not mean that the command has not been applied). <br>  The tracker has two modes of information: either sends information via SMS to trusted numbers, or sends via GPRS.  And initially the tracker sends data on a call to the SIM card that is inserted into it, but there is also the possibility of automatically sending data after a specified period of time. <br>  As a result, the settings for accessing the Internet via GPRS (apn, user, pass), the address and port of our server were hammered. <br>  But how to understand what this mysterious device sends and in what format? <br><br><h4>  Receiving the information </h4>  When I started this idea, I spent a long time looking for any servers for these devices that receive signals from trackers and somehow display them. <br>  Nothing was found.  No, of course there is one service that provides a free vehicle web monitoring system, and you can add your own tracker to it by pre-setting it on their server, but this option did not suit me. <br>  Of course, in the extreme case, it would be possible to write some parser for the pages of this service, which would save all the information in our database ... But still I wanted to try to raise my server. <br><br>  I opened the port that I specified in the settings on the server and started listening.  After a long setup of the tracker, we managed to force him to send packages to our server. <br>  As I suspected, the tracker sent information in plain text form. <br>  An example of a package-ping (sent by the tracker every 20 seconds): <br> <code>##,imei:572776984948029,A;</code> <br>  In general, IMEI is contained in each packet from the tracker, so it is very convenient to filter connections: no IMEI - disconnect. <br><br>  By calling the tracker, I provoked sending the following information: <br> <code>imei:572776984948029,tracker,1007180132,+7926*******,F,173215.000,A,5453.2762,N,05850.6135,E,51.16,;</code> <br>  An interesting line, is not it?  But what is written in it and in what form? <br>  The device sent information to the server, which has already pleased :) <br><br>  Then the process of understanding what went on this line and in what format went on. <br>  Naturally in the attached instructions there was not a word about it. <br>  There was some kind of instruction for the Chinese TK-102 (our device has many synonyms :), in which there was information of interest to me. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/7f/22/7f2242df7c98cfc0a5c173ff1cffcb26.png"></div><br>  Apparently, some kind of abbreviation GPRMC is involved here.  Google helped me find information, <a href="http://www.codepedia.com/wiki/printer.aspx%3FWikiID%3D1%26p%3DThe%2BGPRMC%2BSentence">what is it</a> . <br>  As a result, there appeared a function of parsing the string, which pulls out the coordinates, time and speed (by the way, I did not immediately understand that it is indicated in the nodes). <br>  An example of a parsed string: <br> <code>raw: imei:572776984948029,tracker,1007180132,+7926*******,F,173215.000,A,5453.2762,N,05850.6135,E,51.16,; <br> gps date raw: 17:32:15.0 <br> gps unix date: 17.07.2010 17:32 <br> degree: 54¬∞53.2762'N 058¬∞50.6135'E <br> decimal: 54.887937 58.843558 <br> speed: 94.74832</code> <br> <br>  The server was overloaded with connection filtering (by IMEI), logging messages from the tracker, discarding extra points and something else, but the main thing was to achieve the goal: the tracker sent coordinates every 20 seconds and they were saved to our server. <br><br><h5>  Information display </h5>  The most difficult part is passed, it remains to show the route to users. <br>  Displaying points and connecting them in a line was entrusted to Yandex.Maps.  Their API is well documented, so I will not provide any code or comments, I‚Äôd better show a screenshot (clickable). <br><div style="text-align:center;"> <a href="http://smotra.ru/gps/" title="View in work"><img src="https://habrastorage.org/storage/habraeffect/88/8a/888a787c46b42fe52205e44664c9c7ed.png"></a> </div><br>  The last 50 points on the map are highlighted with triangles, which show the direction of movement, and on click information about the speed at this point and time of fixation. <br><div style="text-align:center;"> <a href="http://smotra.ru/gps/" title="View in work"><img src="https://habrastorage.org/storage/habraeffect/d6/de/d6de8f8593cb753fe10795aeb8d33d87.png"></a> </div><br><br><h5>  disadvantages </h5>  The resulting system still has flaws, in my opinion exclusively hardware: the tracker after a reboot (battery change) ‚Äúforgets‚Äù that it needs to send information to the server every N seconds, sometimes it hangs strangely (it‚Äôs impossible to turn off without removing the batteries). <br>  Probably affects the fact that this is the cheapest tracker of those that I found on sale in Moscow. <br><br><h5>  What forgot to mention </h5>  - this tracker still has a monitoring function: you can call it and hear what is happening around the device; <br>  - one battery lasts about 20 hours; <br>  - consumes very little traffic during use; <br>  - in the process of searching for examples of the implementation of displaying tracks on a map, I found almost a single <a href="http://gis-lab.info/qa/google-web-points.html">article</a> in which the problem is considered in some detail using the example of Google Maps; <br>  - the system came out quite budget: 4,000 rubles for a device + 300-400 for a new SIM card with the required tariff; </div><p>Source: <a href="https://habr.com/ru/post/99508/">https://habr.com/ru/post/99508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../99500/index.html">Testing with the help of aitraker to perform tasks on the website alget.ru</a></li>
<li><a href="../99501/index.html">How Microsoft DevDiv uses TFS - part 1</a></li>
<li><a href="../99502/index.html">Agiledays in St. Petersburg, September 17, 2010</a></li>
<li><a href="../99505/index.html">We make links in the flash-banner, not having the source</a></li>
<li><a href="../99506/index.html">New 0-day or feature from Microsoft?</a></li>
<li><a href="../99510/index.html">Sony Vaio Z - almost a year together</a></li>
<li><a href="../99513/index.html">NetCraft's July report on http server popularity</a></li>
<li><a href="../99514/index.html">Curious Reef - site for online students</a></li>
<li><a href="../99515/index.html">Parallel technology</a></li>
<li><a href="../99519/index.html">The evolution of Web 2.0. What's next?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>