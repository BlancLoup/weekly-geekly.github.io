<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>T-commerce: how online sales work with Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Telegram released a new payment-enabled API last summer. Since then, the messenger has become a sales channel, which allows companies not only to comm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>T-commerce: how online sales work with Telegram</h1><div class="post__text post__text-html js-mediator-article"><p>  Telegram released a new payment-enabled API last summer.  Since then, the messenger has become a sales channel, which allows companies not only to communicate with the client, but also to accept payment for their goods and services directly in the dialog box.  Yandex.Cassa was the first among Russian payment services to support this feature.  <strong>Individual entrepreneurs and small organizations immediately began to accept payments to Telegram through the Cashier: florists, tea and coffee shops, coaches, organizers of training courses, charitable foundations and many others</strong> ( <a href="https://vc.ru/34791-populyarnost-telegram-budet-rasti-a-znachit-budet-rasti-i-kolichestvo-platelshchikov-cherez-botov">here</a> you can read reviews and examples).  But for larger companies with a stream of orders was one stopper. </p><br><p>  The fact is that until recently, Telegram-sales had one feature that did not take into account purely Russian specifics of electronic commerce ‚Äî the mandatory sending of online checks (the 54- requirement, known as the <a href="https://kassa.yandex.ru/blog/54fz%3F_openstat%3Dpromo%3Bpr%3Bhabr%3B54fz%3B">law on online cash registers</a> ).  Yandex.Cash immediately appeared a special protocol that supported the work with the new cash equipment and automated transfer of checks.  But in Telegram such automation was not technically supported, and sellers had to set up the transfer of checks themselves (consider dancing with a tambourine).  And recently, the messenger went to meet the Russian e-commerce market and implemented a joint project with Yandex.Money, adding an important element to its protocol - a special field appeared for additional information to the payment provider.  Now selling via Telegram has become convenient from the point of view of not only the client service, but also the automation of the transfer of online checks (that is, compliance with 54-FZ).  Under the cut, I'll tell you what to do to launch sales in a Telegram, accepting payments through Yandex.Cass. <a name="habracut"></a></p><br><h1 id="kak-vyglyadit-process-oplaty-v-telegram">  How does the telegram payment process look like? </h1><br><p>  If you have not had to buy anything via the messenger, the sales scenario may not be obvious.  In some cases, the sale begins on the site, and ends in the Telegram.  In others, all customer service goes through Telegram-bot.  Here is how it will look step by step: </p><br><ol><li>  The buyer puts the product on the store site into the basket, and at the payment stage selects a payment via Telegram (the second option is when the customer initially selects a product or service using a Telegram bot; this is the scenario that we consider in the figure below). </li><li>  Bot store bills the buyer. </li><li>  Telegram exchanges information about the invoice with the Yandex.Cashy payment bot. </li><li>  The payer enters payment information without leaving the Telegram application. </li><li>  Bot J.Kassi makes the payment and reports the successful payment to the backend of the store and to the Telegram. </li><li>  Telegram notifies the payer and the bot store. </li></ol><br><p>  Needless to say that the speed of implementation of paragraphs.  1-2 depends on the client (product selection, payment information input), and the processes from paragraphs.  3-6 occur almost instantly? </p><br><p>  <em>An example of using a payment bot in the Russian language service ‚ÄúYou can do it!‚Äù (@UchenyjBot)</em> </p><br><p><img src="https://habrastorage.org/webt/bi/xk/26/bixk26l5xebpqmdsn7xrtuzghrg.png"></p><br><p><img src="https://habrastorage.org/webt/xa/vi/xv/xavixv7ttxz630ovqdon6racyqc.png"></p><br><div class="spoiler">  <b class="spoiler_title">The size of the average check when paying by Telegram</b> <div class="spoiler_text"><p>  The average check when paying in the messenger through Yandex.Cash is 700 rubles - comparable to the average check when paying on the site.  Each business has its own absolute indicator.  For example, the average check in a music school that accepts payment through a cashier in a Telegram is 4,000 rubles.  A subscription to the consultation service on the Russian language, the payment process of which is shown above, costs 149 rubles. </p></div></div><br><h1 id="kak-nastroit-prodazhi-cherez-telegram">  How to set up sales via Telegram </h1><br><p>  When Telegram just released an API with payment support, it seemed that this sales channel would be in demand among medium and large merchants, who could write their own bot, which takes into account all the scenarios of the store‚Äôs communication with the user.  But in fact, a large retail did not go on sale in Telegram, but small service companies and small shops came. </p><br><p>  To set up sales in Telegram via Yandex.Cash, you need to do three main things: </p><br><ol><li>  <a href="https://money.yandex.ru/joinups%3F_openstat%3Dpromo%3Bpr%3Bhabr%3Bjoinups%26amp%3Butm_source%3Dyasmm%26amp%3Butm_content%3Dblog%26amp%3Butm_content%3Dtelegram54fz">Register</a> with Yandex.Money: sign the contract and get the store identifier (shopId). </li><li>  Create Telegram-bot, which will communicate with customers.  All bots are created via <a href="https://telegram.me/botfather">@Botfather</a> , but their behavior can be programmed independently or through constructors.  Ready bot must be activated via chat with @BotFather. </li><li>  <a href="https://kassa.yandex.ru/manuals/telegram%3F_openstat%3Dpromo%3Bpr%3Bhabr%3Btelegram%26amp%3Butm_source%3Dyasmm%26amp%3Butm_content%3Dblog%26amp%3Butm_content%3Dtelegram54fz">Connect your bot</a> to the Yandex.Cashy payment bot.  To do this, in the ‚ÄúPayments‚Äù tab in the menu of your bot, in the dialogue with BotFather, select Yandex.Cash as a payment provider.  Then start the dialogue with the new bot via / start, specify the shopId from your Yandex.Cash account (it is assigned when the merchant is connected, each has its own) and implement the sendinvoice method from <a href="https://core.telegram.org/bots/apiajsdfkadjsfkadjsfkjadsl">the Telegram payment API</a> .  As soon as the bot is set up, payment acceptance will turn on automatically. </li></ol><br><p>  In response to a request, your bot will send an invoice to the client.  The invoice must contain the cost, the name, the description of the goods, the payload parameter and the provider_token parameter - this is the same token that issued @BotFather. </p><br><p>  If you need to get a shipping address from the buyer, implement the Shipping Query method.  When the user specifies an address, this request must be answered using the answerShippingQuery method and the delivery methods as well as their prices must be passed through it. </p><br><p>  So, almost everything is ready, except for sending a check. </p><br><h1 id="prodazhi-cherez-telegram-po-54-fz">  Sales via Telegram at 54-FZ </h1><br><div class="spoiler">  <b class="spoiler_title">What is the essence of the law on online cash</b> <div class="spoiler_text"><p>  In July 2017, Law 54-FZ came into force, the essence of which is the need for an online tax report for each sale through the Internet.  That is, any online store working with individuals must use a new generation of cash registers that can send electronic checks to the tax office after each payment (such cash registers (CCP) can be bought or rented).  Checks are transferred to the tax and the buyer via the Internet through the operator of fiscal data - OFD (therefore, the cash must always be online).  The receipt must contain the name of the product, price, quantity, VAT rate, information about the seller and the cash register itself. </p></div></div><br><p>  Until recently, merchants had to monitor sales through the bot and conduct fiscalization on their own.  What does this mean in practice?  It‚Äôs all the same as if the sales went offline: the bot gave the seller a notice of sale, the seller manually entered all the goods sold into his cash desk and passed the check on the contacts that the buyer left before paying. </p><br><p>  Beyond the Telegram, Yandex.Kassa as a service already knew how to automatically transfer data about online payments to <a href="https://kassa.yandex.ru/blog/business-ru">more than 70 KKM models of</a> all popular suppliers.  But in the Cashier‚Äôs payment bot, there was no such function due to limitations on the size of the data that our bot could receive from the merchant bot.  <strong>Everything worked out in February, when Telegram finalized its protocol for payment bots</strong> : a field appeared for additional information to the payment provider - Provider data, and we realized this opportunity.  This field is required for the transfer of data on the composition of the check.  Y. Kassa knows how to parse this field, so the merchant can only set up his bot correctly, adding data on the composition of the check. </p><br><p>  Below is <strong>the request code without an attached check, that is, as it was until February</strong> : </p><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"chat_id"</span></span>:<span class="hljs-number"><span class="hljs-number">147426403</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span>:{}, <span class="hljs-string"><span class="hljs-string">"provider_token"</span></span>:<span class="hljs-string"><span class="hljs-string">"390540012:LIVE:1514"</span></span>, <span class="hljs-string"><span class="hljs-string">"currency"</span></span>: <span class="hljs-string"><span class="hljs-string">"RUB"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_parameter"</span></span>:<span class="hljs-string"><span class="hljs-string">"mybot"</span></span>, <span class="hljs-string"><span class="hljs-string">"prices"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"label"</span></span>:<span class="hljs-string"><span class="hljs-string">"-"</span></span>,<span class="hljs-string"><span class="hljs-string">"amount"</span></span>: <span class="hljs-number"><span class="hljs-number">6100</span></span>}] }</code> </pre> <br><p>  If you add information about the composition of the check for further processing and fiscalization, the request to Telegram to send an invoice with additional information for the Yandex.Cashy payment bot will look like this ( <strong>attention to the Receipt field is the data of the composition of the check</strong> ): </p><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"chat_id"</span></span>:<span class="hljs-number"><span class="hljs-number">147426403</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test"</span></span>, <span class="hljs-string"><span class="hljs-string">"payload"</span></span>:{}, <span class="hljs-string"><span class="hljs-string">"provider_token"</span></span>:<span class="hljs-string"><span class="hljs-string">"390540012:LIVE:1514"</span></span>, <span class="hljs-string"><span class="hljs-string">"currency"</span></span>: <span class="hljs-string"><span class="hljs-string">"RUB"</span></span>, <span class="hljs-string"><span class="hljs-string">"start_parameter"</span></span>:<span class="hljs-string"><span class="hljs-string">"mybot"</span></span>, <span class="hljs-string"><span class="hljs-string">"prices"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"label"</span></span>:<span class="hljs-string"><span class="hljs-string">"-"</span></span>,<span class="hljs-string"><span class="hljs-string">"amount"</span></span>: <span class="hljs-number"><span class="hljs-number">6100</span></span>}], <span class="hljs-string"><span class="hljs-string">"provider_data"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"receipt"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"example@example.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"items"</span></span>:[ { <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">" A"</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.00"</span></span>, <span class="hljs-string"><span class="hljs-string">"amount"</span></span>: { <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"100.00"</span></span>, <span class="hljs-string"><span class="hljs-string">"currency"</span></span>: <span class="hljs-string"><span class="hljs-string">"RUB"</span></span> }, <span class="hljs-string"><span class="hljs-string">"vat_code"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ] } } }</code> </pre><br><p>  From the required data in the request: </p><br><ul><li>  <strong>need_phone_number or need_email</strong> - they tell Telegram that after clicking on the account you need to request a phone number (need_phone_number) and / or email (need_email); </li><li>  <strong>send_email_to_provider</strong> (if you requested email from a customer) or send_phone_number_to_provider (if requested a phone number) - indicate the need to send the entered values ‚Äã‚Äãto a payment provider; </li><li>  <strong>provider_data with the object of receipt</strong> - as part of the check should be a list of commodity items or services, their quantity and prices.  All as in the usual check. </li></ul><br><p>  So that after payment in Telegram, J. Kassa automatically ‚Äúsignaled‚Äù to your cash register that the buyer needs to send a check (he sends the check to the CRF serving your cash register), do the following: </p><br><ol><li>  In the personal account of Ya.Kassy, ‚Äã‚Äãspecify the settings of your cash register compatible with Yandex.Cash (now the Cashier supports several dozen varieties of CCV - for example, Atol and Atol Online, Orange Data, UMKA, StarRus, Evotor, Drikkas, Spark, Strich-M, Scoringmash, Incotex and others). </li><li>  If you do not have a Telegram bot, <a href="https://texterra.ru/blog/prodazhi-cherez-telegram-kak-samostoyatelno-sozdat-bot-internet-magazina-bez-kodinga.html">create it</a> and connect it to the Yandex.Cashi bot <a href="https://kassa.yandex.ru/manuals/telegram%3F_openstat%3Dpromo%3Bpr%3Btelegram%26amp%3Butm_source%3Dyasmm%26amp%3Butm_content%3Dblog%26amp%3Butm_content%3Dtelegram54fz">using this instruction</a> . </li></ol><br><p>  If you have experience in creating a payment bot or have questions about how to set up payment, welcome to comments. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/351766/">https://habr.com/ru/post/351766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351756/index.html">Types of software testing (in pictures)</a></li>
<li><a href="../351758/index.html">Marvin Minsky "The Emotion Machine": Chapter 1. Love</a></li>
<li><a href="../351760/index.html">Marvin Minsky "The Emotion Machine": Chapter 2 "Playing With the Mud"</a></li>
<li><a href="../351762/index.html">Conference DEFCON 21. "As my Botnet earned millions of dollars in car sales and defeated Russian hackers"</a></li>
<li><a href="../351764/index.html">Data center with interesting physical protection</a></li>
<li><a href="../351768/index.html">How we changed paid Slack to open-source Rocket.Chat</a></li>
<li><a href="../351770/index.html">Gartner released a new quadrant of monitoring solutions for 2018 (and at the same time missed 2017)</a></li>
<li><a href="../351772/index.html">Minifikation programming language</a></li>
<li><a href="../351774/index.html">Operating systems from scratch; level 1 (upper half)</a></li>
<li><a href="../351782/index.html">Ping-Pong algorithm or criticism of the Reverse Polish Notation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>