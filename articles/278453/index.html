<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adding a proxy to any application on IIS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a corporate environment, there is often a need for a web application on asp.net to realize the ability to log out through a proxy server (even with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adding a proxy to any application on IIS</h1><div class="post__text post__text-html js-mediator-article">  In a corporate environment, there is often a need for a web application on asp.net to realize the ability to <b>log out through a proxy server</b> (even with authorization) to download this or that information. <br><br>  For example: <br><br><ul><li>  Implemented software requires downloading some information from a web resource at the application server level. </li><li>  When hosting any CMS, the ability to connect the application to the repository of developers for downloading themes, plug-ins, etc. is required.  (some CMS are not installed at all without prior authorization on the server side of the developers) </li><li>  In <b>SharePoint,</b> there are many services that require a direct connection to Microsoft sites (for example, connecting to office.com to install external applications) </li></ul><a name="habracut"></a><br><h3>  Consider 2 situations, focusing on the <a href="https://msdn.microsoft.com/en-us/library/kd3cf2ex(v%3Dvs.110).aspx">MSDN</a> article: </h3><br><h4>  1) Corporate proxy does not require authorization </h4><br>  In the web.config we add the section defaultProxy with the indication of the proxy server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">More + code</b> <div class="spoiler_text">  <i>Make sure that you add this section to the configuration section and also after the subsection configSections, if present.</i>  <i>For the proxyaddress parameter, specify the correct address of your proxy.</i> <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.net</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defaultProxy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useDefaultCredentials</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">proxy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">proxyaddress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://proxyserver:80"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bypassonlocal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defaultProxy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.net</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><h4>  2) Corporate proxy requires authorization </h4><br>  2.1) We authorize the server (the cardinal approach is not always convenient and less secure).  This option uses the same settings in web.config as in 1), but it is also necessary for proxy administrators to provide access to the server by its ip address for certain web links or the entire Internet.  <i>Note that it is often very difficult to determine which links the CMS or the SharePoint server is trying to access.</i> <br><br><h5>  2.2) Authorization module for web application </h5><br>  If you pay close attention to the same article in <a href="https://msdn.microsoft.com/en-us/library/6w93fssz(v%3Dvs.110).aspx">MSDN,</a> then for <b>the defaultProxy section</b> you can specify <b>an additional subsection module</b> . <br><br>  This is a very important section that allows you to create your ( <i>easily embedded</i> ) access code to the proxy server.  There is no need to edit the code of the application itself. <br><br><div class="spoiler">  <b class="spoiler_title">More + code + pictures</b> <div class="spoiler_text"><ul><li>  In visual studio, create a new library <i>MyCorpAssembly.dll net 2.0 (to run in old sites)</i> : <br><br><img src="https://habrastorage.org/files/863/674/544/863674544cc14fc1b981bf8bc7f83f7a.PNG"><br><br></li><li>  Rename the class to <i>MyCorpProxy</i> : <br><br><img src="https://habrastorage.org/files/aa7/978/522/aa79785224a84acca46dd180d57fcefd.PNG"><br><br></li><li>  <b>Add the following code:</b> <i>Do not forget to specify your own lines for "user", "password", "domain" and " <a href="http://my.proxy/">my.proxy</a> : 8080".</i>  <i>In this example, the password is stored in clear text, but you can receive and store it in any secret way.</i> <i><br><br></i>  <i>It is also better to create a service, domain record for authorization.</i> <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyCorpAssembly</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyCorpProxy</span></span> : <span class="hljs-title"><span class="hljs-title">IWebProxy</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICredentials Credentials { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetworkCredential(<span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>,<span class="hljs-string"><span class="hljs-string">"domain"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Uri </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProxy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Uri destination</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"http://my.proxy:8080"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsBypassed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Uri host</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre><br></li><li>  Sign the library with your key: <br><br><img src="https://habrastorage.org/files/4b2/4cd/f81/4b24cdf819c2491993fa3efd0feab14c.PNG"><br><br></li><li>  Compile and put the resulting MyCorpAssembly.dll into the bin folder of the site <br></li><li>  Add a new section of defaultProxy to the site‚Äôs web.config: <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.net</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defaultProxy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">useDefaultCredentials</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyCorpAssembly.MyCorpProxy, MyCorpAssembly"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defaultProxy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.net</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></li><li>  You can restart the IIS application and check the availability of external resources. <br><br>  I think the same functionality can work for applications written on .net, but I did not check. <br><br>  Just in the folder next to the application, you need to create the AppName.exe.Config file and add the section defaultProxy </li></ul><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/278453/">https://habr.com/ru/post/278453/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278443/index.html">Physical web concept. Bluetooth beacons. Comparison of iBeacon, AltBeacon and Eddystone standards</a></li>
<li><a href="../278445/index.html">Pomp - metaframe for parsing sites</a></li>
<li><a href="../278447/index.html">Ralph Baer: "Video Games, I'm your father!"</a></li>
<li><a href="../278449/index.html">Meet at CodeFest</a></li>
<li><a href="../278451/index.html">Dream job or a small history of mobile development</a></li>
<li><a href="../278459/index.html">Cool sharing pages on social networks using Open Graph</a></li>
<li><a href="../278463/index.html">What you need to know when configuring the power of the ePMP 1000 transmitter from Cambium Networks</a></li>
<li><a href="../278465/index.html">Protection at all stages of cyber attack</a></li>
<li><a href="../278467/index.html">What is bad to be a full stack developer</a></li>
<li><a href="../278469/index.html">IoC: Another Scala implementation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>