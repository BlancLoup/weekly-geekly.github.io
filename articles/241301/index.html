<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MindStream. How do we write software under FireMonkey. Part 3. DUnit + FireMonkey</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1 . 
 Part 2 . 

 Hello. 

 In this article I want to introduce readers to the process of transferring VCL code to FireMonkey. In the standard De...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MindStream. How do we write software under FireMonkey. Part 3. DUnit + FireMonkey</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/232955/">Part 1</a> . <br>  <a href="http://habrahabr.ru/post/234801/">Part 2</a> . <br><br>  Hello. <br><br>  In this article I want to introduce readers to the process of transferring VCL code to FireMonkey.  In the standard Delphi package, starting in my opinion from version 2009, the <a href="http://dunit.sourceforge.net/">DUnit</a> project comes out of the box. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, it was written in the distant past VCL.  And although it allows testing the code written for FireMonkey (thanks to the console output), it doesn‚Äôt have the ‚Äúnagging‚Äù GUIRunner that many of us are used to, because it‚Äôs very quick and easy to remove those tests that we don‚Äôt want run "right now." <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81a/dae/b19/81adaeb19974a47284158ccf08d70454.gif" alt="image"></div><br><br><a name="habracut"></a><br><br>  For those who are completely or little acquainted with DUnit.  In normal mode out of the box, the documentation suggests making File-&gt; New-&gt; Other-&gt; Unit Test-&gt; TestProject.  Next, you need to choose a GUI or console option.  Thanks to these not so difficult manipulations, you have a new project that should look something like this (at least ‚Äúmy‚Äù XE7, this is the code that was generated) for the GUI: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> Project1Tests; <span class="hljs-comment"><span class="hljs-comment">{ Delphi DUnit Test Project ------------------------- This project contains the DUnit test framework and the GUI/Console test runners. Add "CONSOLE_TESTRUNNER" to the conditional defines entry in the project options to use the console test runner. Otherwise the GUI test runner will be used by default. }</span></span> <span class="hljs-meta"><span class="hljs-meta">{$IFDEF CONSOLE_TESTRUNNER}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$APPTYPE CONSOLE}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> DUnitTestRunner, TestUnit1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'TestUnit1.pas'</span></span>, Unit1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'..\DUnit.VCL\Unit1.pas'</span></span>; <span class="hljs-meta"><span class="hljs-meta">{$R *.RES}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> DUnitTestRunner.RunRegisteredTests; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br>  Next we add TestCase, this is also done (File-&gt; New-&gt; Other-&gt; Unit Test-&gt; TestCase), as a result there should be something similar: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> TestUnit1; <span class="hljs-comment"><span class="hljs-comment">{ Delphi DUnit Test Case ---------------------- This unit contains a skeleton test case class generated by the Test Case Wizard. Modify the generated code to correctly setup and call the methods from the unit being tested. }</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> TestFramework, System.SysUtils, Vcl.Graphics, Winapi.Windows, System.Variants, System.Classes, Vcl.Dialogs, Vcl.Controls, Vcl.Forms, Winapi.Messages, Unit1; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">// Test methods for class TForm1 TestTForm1 = class(TTestCase) strict private FForm1: TForm1; public procedure SetUp; override; procedure TearDown; override; published procedure TestDoIt; end; implementation procedure TestTForm1.SetUp; begin FForm1 := TForm1.Create; end; procedure TestTForm1.TearDown; begin FForm1.Free; FForm1 := nil; end; procedure TestTForm1.TestDoIt; var ReturnValue: Integer; begin ReturnValue := FForm1.DoIt; // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Validate method results end; initialization // Register any test cases with the test runner RegisterTest(TestTForm1.Suite); end.</span></span></code> </pre><br>  In general, my example shows how easy it is to add testing, even for Delphi7.  All we need is to call DUnitTestRunner.RunRegisteredTests ;.  And add new files with TestCase to the project.  In more detail the question of testing using DUnit is considered <a href="http://programmingmindstream.blogspot.ru/2014/06/blog-post_10.html">here</a> . <br><br>  To implement, I decided that you just need to repeat the guys who did DUnit. <br>  The first problem (The fact that TTreeNode, and TTreeViewItem ‚Äúare not brothers at all‚Äù will not even speak, the documentation will save everyone) that I encountered was here: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TfmGUITestRunner</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) ... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> FSuite: ITest; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSuite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Value: ITest)</span></span></span><span class="hljs-function">;</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Suite: ITest <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FSuite <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> SetSuite; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunTestModeless</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_GUI: TfmGUITestRunner; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Application.CreateForm(TfmGUITestRunner, l_GUI); l_GUI.Suite := aTest; l_GUI.Show; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSuite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Value: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FSuite := Value; <span class="hljs-comment"><span class="hljs-comment">// AV  if FSuite &lt;&gt; nil then InitTree; end;</span></span></code> </pre><br>  The problem, as always, is ‚Äúrecognized‚Äù in the debug, well, or in the documentation :).  In FireMonkey, Application.CreateForm () ;, does not create a form.  Yes, strangely enough.  <a href="http://docwiki.embarcadero.com/Libraries/XE6/en/FMX.Forms.TApplication.CreateForm">TApplication.CreateForm</a> <br><br><div class="spoiler">  <b class="spoiler_title">My comment to the commit when I figured out :)</b> <div class="spoiler_text">  FSuite; It has not yet been created, because Application.CreateForm is in fact, if it is not kicked explicitly, ‚Äúit does not create a bitch of normal forms, but only references to future classes.  What accordingly affects class members who are not at all nil, as they should be? ‚Äù <br><br>  AV will come out in System._IntfCopy (var Dest: IInterface; const Source: IInterface); <br>  And it will come out because in Dest we will have garbage, not interface or nil.  And this will manifest when we at the previous interface (if it is not // nil) will subtract 1. <br><br>  Even if we prescribe such a line, <br>  FSuite: = nil; <br></div></div><br><br>  Here is another <a href="http://www.deltics.co.nz/blog/posts/795">link</a> on this issue -.  It doesn‚Äôt say what it does!  To be honest, I, too, was a bit shocked that the method called Make a Form does not make it. <br>  We solve the problem by creating forms explicitly (l_GUI: = TfmGUITestRunner.create (nil);) and go on. <br><br>  Now we need to build a test tree based on the TestCase'of added for testing.  If you noticed, the form building process begins with the RunRegisteredTestsModeless method: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunRegisteredTestsModeless</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> RunTestModeless(registeredTests) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  I decided not to put this method into a separate module, as the creators of DUnit, so to connect fmGUITestRunner, you need to specify the module in the project code, well, actually call the desired method.  In my case, the project code looks like this: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> FMX.DUnit; <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> FMX.Forms, <span class="hljs-comment"><span class="hljs-comment">//   u_fmGUITestRunner in 'u_fmGUITestRunner.pas' {fmGUITestRunner}, //  u_FirstTest in 'u_FirstTest.pas', u_TCounter in 'u_TCounter.pas', u_SecondTest in 'u_SecondTest.pas'; {$R *.res} begin Application.Initialize; //      u_fmGUITestRunner.RunRegisteredTestsModeless; Application.Run; end.</span></span></code> </pre><br>  The attentive reader will notice that we have not added any registeredTests, and have never indicated at all what tests we will have added.  RegisteredTests is the ‚Äúglobal‚Äù TestFrameWork method, which is connected to our form, it returns a global variable - __TestRegistry: ITestSuite; <br><br>  The way TestCases ‚Äúfall‚Äù into this variable will be left outside the scope of this article, especially since the creators of DUnit have done the work.  However, if readers express an interest in this topic, I will answer in comments.  So back to the tree.  Method to initialize the tree: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitTree</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FTests.Clear; FillTestTree(Suite); TestTree.ExpandAll; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  FTests is a list of interface objects that will store the list of our tests.  In turn, the FillTestTree method is overloaded, this is done because we do not know, we are working with the root element of the tree, or with a regular node: <br><br><pre> <code class="delphi hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillTestTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">overload</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillTestTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aRootNode: TTreeViewItem; aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">overload</span></span>; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillTestTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aRootNode: TTreeViewItem; aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_TestTests: IInterfaceList; l_Index: Integer; l_TreeViewItem: TTreeViewItem; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> aTest = <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; l_TreeViewItem := TTreeViewItem.Create(self); l_TreeViewItem.IsChecked := True; <span class="hljs-comment"><span class="hljs-comment">//    ,    Tag   .        :) l_TreeViewItem.Tag := FTests.Add(aTest); l_TreeViewItem.Text := aTest.Name; //   ,   if aRootNode = nil then TestTree.AddObject(l_TreeViewItem) else aRootNode.AddObject(l_TreeViewItem); // ITest,   Tests,   (IInterfaceList) ""  //      l_TestTests := aTest.Tests; for l_Index := 0 to l_TestTests.Count - 1 do FillTestTree(l_TreeViewItem, l_TestTests[l_Index] as ITest); end;</span></span></code> </pre><br>  As we see, in the method we not only filled the tree, but also gave information to each node which of the tests corresponds to it.  In order to get a test by node, write the NodeToTest method: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NodeToTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aNode: TTreeViewItem)</span></span></span><span class="hljs-function">:</span></span> ITest; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_Index: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> assert(aNode.Tag &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>); l_Index := aNode.Tag; Result := FTests[l_Index] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ITest; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Now add the "knowledge" of the tests.  Each test has a GUIObject variable, of type TObject.  SetupGUINodes we will call on FormShow. <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetupGUINodes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aNode: TTreeViewItem)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_Test: ITest; l_Index: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> l_Index := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Pred(aNode.Count) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//   l_Test := NodeToTest(aNode.Items[l_Index]); assert(assigned(l_Test)); //      l_Test.GUIObject := aNode.Items[l_Index]; SetupGUINodes(aNode.Items[l_Index]); end; end;</span></span></code> </pre><br>  In order to get a node from the test, we write the method: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestToNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test: ITest)</span></span></span><span class="hljs-function">:</span></span> TTreeViewItem; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> assert(assigned(test)); Result := test.GUIObject <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TTreeViewItem; assert(assigned(Result)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  The way I ‚Äúconnected‚Äù the tests with the tree, I, and the older colleague did not like it.  Why did the DUnit developers go this way, I guess.  DUnit was written a long time ago, and there were no Generics at that time.  In the future, of course, we will redo it.  At the end of the article I will write about our next revisions and "Wishlist". <br><br>  So - our tree is being built, tests are in FTests.  Tests and wood are related.  It's time to run the tests, and process the results.  In order for the form to do this, we add the implementation of the ITestListener interface described in TestFrameWork: <br><br><pre> <code class="delphi hljs"> <span class="hljs-comment"><span class="hljs-comment">{ ITestListeners get notified of testing events. See TTestResult.AddListener() }</span></span> ITestListener = <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>(IStatusListener) [<span class="hljs-string"><span class="hljs-string">'{114185BC-B36B-4C68-BDAB-273DBD450F72}'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestingStarts</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error: TTestFailure)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Failure: TTestFailure)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestingEnds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(testResult :TTestResult)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShouldRunTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test :ITest)</span></span></span><span class="hljs-function">:</span></span>Boolean; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Add these methods to the class description, and implement them: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestingStarts</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FTotalTime := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_Node: TTreeViewItem; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> assert(assigned(TestResult)); assert(assigned(aTest)); l_Node := TestToNode(aTest); assert(assigned(l_Node)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> assert(assigned(aTest)); SetTreeNodeFont(TestToNode(aTest), c_ColorOk) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aFailure: TTestFailure)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_ListViewItem: TListViewItem; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetTreeNodeFont(TestToNode(aFailure.failedTest), c_ColorError); l_ListViewItem := AddFailureNode(aFailure); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aFailure: TTestFailure)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_ListViewItem: TListViewItem; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetTreeNodeFont(TestToNode(aFailure.failedTest), c_ColorFailure); l_ListViewItem := AddFailureNode(aFailure); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">// ,          // .     . //    ,     ,    //  ,  TODO // assert(False); end; procedure TfmGUITestRunner.TestingEnds(aTestResult: TTestResult); begin FTotalTime := aTestResult.TotalTime; end; function TfmGUITestRunner.ShouldRunTest(aTest: ITest): Boolean; var l_Test: ITest; begin //  ,    .    ""  ""   l_Test := aTest; Result := l_Test.Enabled end;</span></span></code> </pre><br>  There is nothing special to explain here.  Although if you have questions, I will answer in detail.  In the original DUnitRunner, when ‚Äúreceiving‚Äù the test result, I changed the picture at the corresponding tree node.  I decided not to fool around with pictures, because now I don‚Äôt have them out of the box, and adding a picture to a node is somehow confused through styles.  Therefore, I decided to limit myself to changing FontColor and FontStyle for each node. <br><br>  Like a business for 1 minute, and spent a couple of hours digging through all the documentation: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetTreeNodeFont</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aNode: TTreeViewItem; aColor: TAlphaColor)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//          ,     aNode.StyledSettings := aNode.StyledSettings - [TStyledSetting.ssFontColor, TStyledSetting.ssStyle]; aNode.Font.Style := [TFontStyle.fsBold]; aNode.FontColor := aColor; end;</span></span></code> </pre><br>  To display the results we will use ListView.  The features of TListView in FireMonkey are such that the list is completely sharpened for mobile applications.  And lost the wonderful property of the Columns.  To add errors, add the AddFailureNode method: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFailureNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aFailure: TTestFailure)</span></span></span><span class="hljs-function">:</span></span> TListViewItem; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_Item: TListViewItem; l_Node: TTreeViewItem; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> assert(assigned(aFailure)); l_Item := lvFailureListView.Items.Add; l_Item.Text := aFailure.failedTest.<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> + <span class="hljs-string"><span class="hljs-string">'; '</span></span> + aFailure.thrownExceptionName + <span class="hljs-string"><span class="hljs-string">'; '</span></span> + aFailure.thrownExceptionMessage + <span class="hljs-string"><span class="hljs-string">'; '</span></span> + aFailure.LocationInfo + <span class="hljs-string"><span class="hljs-string">'; '</span></span> + aFailure.AddressInfo + <span class="hljs-string"><span class="hljs-string">'; '</span></span> + aFailure.StackTrace; l_Node := TestToNode(aFailure.failedTest); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> l_Node &lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> l_Node.Expand; l_Node := l_Node.ParentItem; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Result := l_Item; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  It's time to run our tests, for which we will add a button and a launch method: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btRunAllTestClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Suite = <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; ClearResult; RunTheTest(Suite); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunTheTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aTest: ITest)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> TestResult := TTestResult.Create; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> TestResult.addListener(self); aTest.run(TestResult); <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> FreeAndNil(FTestResult); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  We launch our Runner, press the test launch button, as a result we see: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c56/993/88c/c5699388c8bf43bda48087b542ddb638.png" alt="image"></div><br><br>  The last thing left for us to do is to process the user's actions during the change of the node state: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestTreeChangeCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetNodeEnabled(Sender <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TTreeViewItem, (Sender <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TTreeViewItem).IsChecked); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmGUITestRunner</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetNodeEnabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aNode: TTreeViewItem; aValue: Boolean)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l_Test: ITest; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> l_Test := NodeToTest(aNode); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_Test &lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> l_Test.Enabled := aValue; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Change the state of the checkboxes of some nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/488/26b/0d9/48826b0d95f84338b78a1ce5b9b8742d.png" alt="image"></div><br><br>  The test code on which I actually tested: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> u_SecondTest; <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> TestFrameWork; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TSecondTest</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TTestCase) <span class="hljs-keyword"><span class="hljs-keyword">published</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoIt</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OtherDoIt</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ErrorTest</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SecondErrorTest</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">// TFirstTest implementation procedure TSecondTest.DoIt; begin Check(true); end; procedure TSecondTest.ErrorTest; begin raise ExceptionClass.Create('Error Message'); end; procedure TSecondTest.OtherDoIt; begin Check(true); end; procedure TSecondTest.SecondErrorTest; begin Check(False); end; initialization TestFrameWork.RegisterTest(TSecondTest.Suite); end.</span></span></code> </pre><br>  To summarize - at this stage, we got quite a working application for testing FireMonkey code using the familiar GUIRunner.  The project is open, so everyone can use it. <br><br>  Future plans: <br>  Write a tree traversal method that will receive <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25BE%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2584%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F">lambda</a> .  The tree has to be bypassed constantly, but the actions with each branch are different, so lambda seems appropriate to me. <br><br>  Comments and suggestions from my <a href="http://18delphi.blogspot.ru/">older colleague</a> : <br>  Reconnect Test Site Node at TDictionary &lt;TTreeViewItem, ITest&gt; <a href="http://docwiki.embarcadero.com/Libraries/XE7/en/System.Generics.Collections.TDictionary">docwiki.embarcadero.com/Libraries/XE7/en/System.Generics.Collections.TDictionary</a> <br>  Add a graphical indicator ‚Äúpass tests‚Äù.  Buttons - select all, remove all, etc.  as well as the output of test results (run time, the number of successful and failures, etc.). <br>  Add a pattern <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BA%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">Decorator</a> to get rid of the ‚Äúcrutch‚Äù GUIObject. <br><br>  In the near future, we will begin to test our main project, MindStream, as well as by bringing Runner to our minds a little bit.  Thanks to everyone who read to the end.  Comments and criticisms, as always welcome in the comments. <br><br>  <a href="https://bitbucket.org/ingword/mindstream">Link to the repository.</a> <br><br>  ps The project is located in the repository MindStream \ FMX.DUnit <br><br>  Links that I found, and which came in handy to me in the process: <br>  <a href="http://sourceforge.net/p/radstudiodemos/code/HEAD/tree/branches/RadStudio_XE5_Update/FireMonkey/Delphi/">sourceforge.net/p/radstudiodemos/code/HEAD/tree/branches/RadStudio_XE5_Update/FireMonkey/Delphi</a> <br>  <a href="http://fire-monkey.ru/">fire-monkey.ru</a> <br>  <a href="http://18delphi.blogspot.ru/">18delphi.blogspot.ru</a> <br>  <a href="http://www.gunsmoker.ru/">www.gunsmoker.ru</a> <br>  <a href="http://18delphi.blogspot.ru/2013/11/gui_9423.html">GUI testing "in Russian".</a>  <a href="http://18delphi.blogspot.ru/2013/11/gui_9423.html">Test Level Note</a> <br>  <a href="http://programmingmindstream.blogspot.ru/2014/01/blog-post_27.html">Once again about the "testing levels"</a> <br>  and of course <br>  <a href="http://docwiki.embarcadero.com/RADStudio/XE7/en/Main_Page">docwiki.embarcadero.com/RADStudio/XE7/en/Main_Page</a> <br><br>  <a href="http://habrahabr.ru/post/241377/">Part 3.1</a> </div><p>Source: <a href="https://habr.com/ru/post/241301/">https://habr.com/ru/post/241301/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241289/index.html">VisionMobile Eighth Developer Economics Survey</a></li>
<li><a href="../241293/index.html">SSL3 protocol check in 20 bank clients</a></li>
<li><a href="../241295/index.html">How to quickly configure Kaspersky Anti-Virus on Juniper SRX gateway</a></li>
<li><a href="../241297/index.html">Do you use the mouse while working?</a></li>
<li><a href="../241299/index.html">Resurrect FTDI in pictures</a></li>
<li><a href="../241303/index.html">We use closures in Swift in full</a></li>
<li><a href="../241305/index.html">As we voiced the stadium "Spartak"</a></li>
<li><a href="../241307/index.html">Microsoft DocumentDB: second article, resources and concepts</a></li>
<li><a href="../241309/index.html">Passive fingerprinting to detect synthetic traffic</a></li>
<li><a href="../241311/index.html">A. Kibkalo - Windows Server "10": what's new in virtualization (practice)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>