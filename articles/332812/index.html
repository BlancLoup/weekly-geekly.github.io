<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stupidly Simple DDoS Protocol (SSDP) generates 100 Gbps DDoS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In May, we shared statistics on the most popular attacks with reflection . Then the average size of the SSDP attack was around 12 Gbps, and the larges...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stupidly Simple DDoS Protocol (SSDP) generates 100 Gbps DDoS</h1><div class="post__text post__text-html js-mediator-article">  In May, we <a href="https://blog.cloudflare.com/reflections-on-reflections/">shared statistics on the most popular attacks with reflection</a> .  Then the average size of the SSDP attack was around 12 Gbps, and the largest attack of the SSDP with a reflection was: <br><br><ul><li>  30 MP / s (million packets per second) </li><li>  80 Gbit / s (billion bits per second) </li><li>  940 thousand IP addresses to reflect </li></ul><br>  Everything changed a couple of days ago, when we noticed an unusually large multiplication of SSDP packets.  This is worthy of a more thorough investigation, since the attack overcame the symbolic 100 Gbit / s line. <br><br>  Packet Schedule Per Second: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/90d/8fb/d2a/90d8fbd2a37859fcd6db8488d2239120.png"><br><a name="habracut"></a><br>  Band usage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6cc/76b/d37/6cc76bd378cb07d6d5d3a3dd25d7c80d.png"><br><br>  Batch flood lasted 38 minutes.  Judging by the data flow sample, 930 thousand reflecting servers were used.  According to our estimates, each reflector sent 120 thousand packages to Cloudflare. <br><br>  Reflective servers located around the world, most of all in Argentina, Russia and China.  Here are the unique IP addresses by country: <br><br> <code>$ cat ips-nf-ct.txt|uniq|cut -f 2|sort|uniq -c|sort -nr|head <br> 439126 CN <br> 135783 RU <br> 74825 AR <br> 51222 US <br> 41353 TW <br> 32850 CA <br> 19558 MY <br> 18962 CO <br> 14234 BR <br> 10824 KR <br> 10334 UA <br> 9103 IT <br> ...</code> <br> <br>  The distribution of IP addresses by ASN is quite typical.  It largely correlates with the world's largest home Internet service providers: <br><br> <code>$ cat ips-nf-asn.txt |uniq|cut -f 2|sort|uniq -c|sort -nr|head <br> 318405 4837 # CN China Unicom <br> 84781 4134 # CN China Telecom <br> 72301 22927 # AR Telefonica de Argentina <br> 23823 3462 # TW Chunghwa Telecom <br> 19518 6327 # CA Shaw Communications Inc. <br> 19464 4788 # MY TM Net <br> 18809 3816 # CO Colombia Telecomunicaciones <br> 11328 28573 # BR Claro SA <br> 7070 10796 # US Time Warner Cable Internet <br> 6840 8402 # RU OJSC "Vimpelcom" <br> 6604 3269 # IT Telecom Italia <br> 6377 12768 # RU JSC "ER-Telecom Holding" <br> ...</code> <br> <br><h2>  However, what is SSDP? </h2><br>  This attack consists of UDP packets from port 1900. This port is used by the <a href="https://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol">SSDP</a> and UPnP protocols.  UPnP is one of the <a href="https://en.wikipedia.org/wiki/Zero-configuration_networking">Zeroconf</a> (Zero Configuration Networking) protocols that create an IP network without configuration or special servers.  Most likely, your home devices support it to make it easier to find them from a computer or phone.  When a new device joins (like your laptop), it can interrogate the local network for specific devices, such as Internet gateways, audio systems, TVs, or printers.  For details, see the <a href="http://www.zeroconf.org/zeroconfandupnp.html">comparison between UPnP and Bonjour</a> . <br><br>  UPnP is poorly standardized, but here is an excerpt from the <a href="http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v2.0.pdf">specifications</a> for the <code>M-SEARCH</code> frame ‚Äî the basic detection method: <br><br><blockquote>  <i>When a control point is added to the network, the UPnP discovery protocol allows this control point to search for devices of interest on the network.</i>  <i>It does this by multicasting a search message to a reserved address and port (239.255.255.250:1900) with a pattern, or a target, corresponding to the type of identifier for a device or service.</i> </blockquote><br>  Answers to the frame <code>M-SEARCH</code> : <br><br><blockquote>  <i>To be found by a search query, the device must send a unicast UDP response to the source IP address and port that sent the message using multicast.</i>  <i>The answer is required if the ST header field in the <code>M-SEARCH</code> request is ‚Äússdp: all‚Äù, ‚Äúupnp: rootdevice‚Äù, ‚Äúuuid:‚Äù, and then follows a UUID that exactly matches the UUID of the device, or if the <code>M-SEARCH</code> request matches device type or service type supported by the device.</i> </blockquote><br>  So it works in practice.  For example, my Chrome browser regularly polls Smart TV, as I understand it: <br><br> <code>$ sudo tcpdump -ni eth0 udp and port 1900 -A <br> IP 192.168.1.124.53044 &gt; 239.255.255.250.1900: UDP, length 175 <br> M-SEARCH * HTTP/1.1 <br> HOST: 239.255.255.250:1900 <br> MAN: "ssdp:discover" <br> MX: 1 <br> ST: urn:dial-multiscreen-org:service:dial:1 <br> USER-AGENT: Google Chrome/58.0.3029.110 Windows</code> <br> <br>  This frame is sent to the multicast IP address.  Other devices that listen to this address and support a specific multi-screen type <code>ST</code> (search-target) must respond. <br><br>  In addition to requests for specific device types, there are two ‚Äúcommon‚Äù types of <code>ST</code> requests: <br><br><ul><li>  <code>upnp:rootdevice</code> : root search </li><li>  <code>ssdp:all</code> : search for all UPnP devices and services </li></ul><br>  To simulate these requests, you can run such a Python script (based on <a href="https://www.electricmonk.nl/log/2016/07/05/exploring-upnp-with-python/">this work)</a> : <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python2 import socket import sys dst = "239.255.255.250" if len(sys.argv) &gt; 1: dst = sys.argv[1] st = "upnp:rootdevice" if len(sys.argv) &gt; 2: st = sys.argv[2] msg = [ 'M-SEARCH * HTTP/1.1', 'Host:239.255.255.250:1900', 'ST:%s' % (st,), 'Man:"ssdp:discover"', 'MX:1', ''] s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP) s.settimeout(10) s.sendto('\r\n'.join(msg), (dst, 1900) ) while True: try: data, addr = s.recvfrom(32*1024) except socket.timeout: break print "[+] %s\n%s" % (addr, data)</span></span></code> </pre> <br>  Two devices respond to my home network: <br><br><pre> <code class="python hljs">$ python ssdp-query.py [+] (<span class="hljs-string"><span class="hljs-string">'192.168.1.71'</span></span>, <span class="hljs-number"><span class="hljs-number">1026</span></span>) HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK CACHE-CONTROL: max-age = <span class="hljs-number"><span class="hljs-number">60</span></span> EXT: LOCATION: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.71</span></span>:<span class="hljs-number"><span class="hljs-number">5200</span></span>/Printer.xml SERVER: Network Printer Server UPnP/<span class="hljs-number"><span class="hljs-number">1.0</span></span> OS <span class="hljs-number"><span class="hljs-number">1.29</span></span><span class="hljs-number"><span class="hljs-number">.00</span></span><span class="hljs-number"><span class="hljs-number">.44</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span><span class="hljs-number"><span class="hljs-number">-2009</span></span> ST: upnp:rootdevice USN: uuid:Samsung-Printer<span class="hljs-number"><span class="hljs-number">-1</span></span>_0-mrgutenberg::upnp:rootdevice [+] (<span class="hljs-string"><span class="hljs-string">'192.168.1.70'</span></span>, <span class="hljs-number"><span class="hljs-number">36319</span></span>) HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK Location: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.70</span></span>:<span class="hljs-number"><span class="hljs-number">49154</span></span>/MediaRenderer/desc.xml Cache-Control: max-age=<span class="hljs-number"><span class="hljs-number">1800</span></span> Content-Length: <span class="hljs-number"><span class="hljs-number">0</span></span> Server: Linux/<span class="hljs-number"><span class="hljs-number">3.2</span></span> UPnP/<span class="hljs-number"><span class="hljs-number">1.0</span></span> Network_Module/<span class="hljs-number"><span class="hljs-number">1.0</span></span> (RX-S601D) EXT: ST: upnp:rootdevice USN: uuid:<span class="hljs-number"><span class="hljs-number">9</span></span>ab0c000-f668<span class="hljs-number"><span class="hljs-number">-11</span></span>de<span class="hljs-number"><span class="hljs-number">-9976</span></span><span class="hljs-number"><span class="hljs-number">-000</span></span>adedd7411::upnp:rootdevice</code> </pre> <br><h2>  Firewall </h2><br>  Now that we understand the basics of SSDP, it will be easy to understand the essence of the attack with reflection.  There are actually two ways to deliver an <code>M-SEARCH</code> frame: <br><br><ul><li>  which we showed through the address for multicast </li><li>  directly to the UPnP / SSDP host at the regular address (unicast) </li></ul><br>  The second method also works.  We can specifically specify the IP address of my printer: <br><br><pre> <code class="python hljs">$ python ssdp-query.py <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.71</span></span> [+] (<span class="hljs-string"><span class="hljs-string">'192.168.1.71'</span></span>, <span class="hljs-number"><span class="hljs-number">1026</span></span>) HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK CACHE-CONTROL: max-age = <span class="hljs-number"><span class="hljs-number">60</span></span> EXT: LOCATION: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.71</span></span>:<span class="hljs-number"><span class="hljs-number">5200</span></span>/Printer.xml SERVER: Network Printer Server UPnP/<span class="hljs-number"><span class="hljs-number">1.0</span></span> OS <span class="hljs-number"><span class="hljs-number">1.29</span></span><span class="hljs-number"><span class="hljs-number">.00</span></span><span class="hljs-number"><span class="hljs-number">.44</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span><span class="hljs-number"><span class="hljs-number">-17</span></span><span class="hljs-number"><span class="hljs-number">-2009</span></span> ST: upnp:rootdevice USN: uuid:Samsung-Printer<span class="hljs-number"><span class="hljs-number">-1</span></span>_0-mrgutenberg::upnp:rootdevice</code> </pre> <br>  Now the problem is easily understood: SSDP does not check if the sender of the message is on the same network as the device.  It will gladly respond to the request <code>M-SEARCH</code> , which came from the Internet.  Only a slightly incorrect configuration of the firewall is required when port 1900 is open to the outside world - and this is the ideal target for multiplying the flood of UDP. <br><br>  If you give our script such a target with the wrong firewall configuration, then it will work fine via the Internet: <br><br><pre> <code class="python hljs">$ python ssdp-query.py <span class="hljs-number"><span class="hljs-number">100.42</span></span>.xx [+] (<span class="hljs-string"><span class="hljs-string">'100.42.x.x'</span></span>, <span class="hljs-number"><span class="hljs-number">1900</span></span>) HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK CACHE-CONTROL: max-age=<span class="hljs-number"><span class="hljs-number">120</span></span> ST: upnp:rootdevice USN: uuid:<span class="hljs-number"><span class="hljs-number">3e55</span></span>ade9-c344<span class="hljs-number"><span class="hljs-number">-4</span></span>baa<span class="hljs-number"><span class="hljs-number">-841</span></span>b<span class="hljs-number"><span class="hljs-number">-826</span></span>bda77dcb2::upnp:rootdevice EXT: SERVER: TBS/R2 UPnP/<span class="hljs-number"><span class="hljs-number">1.0</span></span> MiniUPnPd/<span class="hljs-number"><span class="hljs-number">1.2</span></span> LOCATION: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">40464</span></span>/rootDesc.xml</code> </pre> <br><h2>  Multiplication packages </h2><br>  However, the most real harm is caused by the type <code>ssdp:all</code> <code>ST</code> .  His answers are <i>much</i> larger in size: <br><br><pre> <code class="python hljs">$ python ssdp-query.py <span class="hljs-number"><span class="hljs-number">100.42</span></span>.xx ssdp:all [+] (<span class="hljs-string"><span class="hljs-string">'100.42.x.x'</span></span>, <span class="hljs-number"><span class="hljs-number">1900</span></span>) HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK CACHE-CONTROL: max-age=<span class="hljs-number"><span class="hljs-number">120</span></span> ST: upnp:rootdevice USN: uuid:<span class="hljs-number"><span class="hljs-number">3e55</span></span>ade9-c344<span class="hljs-number"><span class="hljs-number">-4</span></span>baa<span class="hljs-number"><span class="hljs-number">-841</span></span>b<span class="hljs-number"><span class="hljs-number">-826</span></span>bda77dcb2::upnp:rootdevice EXT: SERVER: TBS/R2 UPnP/<span class="hljs-number"><span class="hljs-number">1.0</span></span> MiniUPnPd/<span class="hljs-number"><span class="hljs-number">1.2</span></span> LOCATION: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">40464</span></span>/rootDesc.xml [+] (<span class="hljs-string"><span class="hljs-string">'100.42.x.x'</span></span>, <span class="hljs-number"><span class="hljs-number">1900</span></span>) HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-number"><span class="hljs-number">200</span></span> OK CACHE-CONTROL: max-age=<span class="hljs-number"><span class="hljs-number">120</span></span> ST: urn:schemas-upnp-org:device:InternetGatewayDevice:<span class="hljs-number"><span class="hljs-number">1</span></span> USN: uuid:<span class="hljs-number"><span class="hljs-number">3e55</span></span>ade9-c344<span class="hljs-number"><span class="hljs-number">-4</span></span>baa<span class="hljs-number"><span class="hljs-number">-841</span></span>b<span class="hljs-number"><span class="hljs-number">-826</span></span>bda77dcb2::urn:schemas-upnp-org:device:InternetGatewayDevice:<span class="hljs-number"><span class="hljs-number">1</span></span> EXT: SERVER: TBS/R2 UPnP/<span class="hljs-number"><span class="hljs-number">1.0</span></span> MiniUPnPd/<span class="hljs-number"><span class="hljs-number">1.2</span></span> LOCATION: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">40464</span></span>/rootDesc.xml ...   <span class="hljs-number"><span class="hljs-number">6</span></span>  ....</code> </pre> <br>  In this particular case, a single SSDP <code>M-SEARCH</code> packet caused 8 packets in response.  View in tcpdump: <br><br> <code>$ sudo tcpdump -ni en7 host 100.42.xx -ttttt <br> 00:00:00.000000 IP 192.168.1.200.61794 &gt; 100.42.xx1900: UDP, length 88 <br> 00:00:00.197481 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 227 <br> 00:00:00.199634 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 299 <br> 00:00:00.202938 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 295 <br> 00:00:00.208425 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 275 <br> 00:00:00.209496 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 307 <br> 00:00:00.212795 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 289 <br> 00:00:00.215522 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 291 <br> 00:00:00.219190 IP 100.42.xx1900 &gt; 192.168.1.200.61794: UDP, length 291</code> <br> <br>  The target made eight-fold multiplication of packets and 26-fold multiplication of traffic.  Unfortunately, this is a typical case of SSDP. <br><br><h2>  IP spoofing </h2><br>  The final step required for an attack is to convince vulnerable servers to send response packets to the victim‚Äôs address, not the attacker‚Äôs.  To do this, the attacker needs to <a href="https://en.wikipedia.org/wiki/IP_address_spoofing">fake the sender's IP address</a> in his requests. <br><br>  We surveyed the IP addresses of the reflectors that were used in the above 100 Gbps attack.  It turned out that out of 920,000 addresses, only 350,000 (35%) still respond to test SSDP requests. <br><br>  We sent, on average, 7 packets to responding to trial requests: <br><br> <code>$ cat results-first-run.txt|cut -f 1|sort|uniq -c|sed -s 's#^ \+##g'|cut -d " " -f 1| ~/mmhistogram -t "Response packets per IP" -p <br> Response packets per IP min:1.00 avg:6.99 med=8.00 max:186.00 dev:4.44 count:350337 <br> Response packets per IP: <br> value |-------------------------------------------------- count <br> 0 | ****************************** 23.29% <br> 1 | **** 3.30% <br> 2 | ** 2.29% <br> 4 |************************************************** 38.73% <br> 8 | ************************************** 29.51% <br> 16 | *** 2.88% <br> 32 | 0.01% <br> 64 | 0.00% <br> 128 | 0.00%</code> <br> <br>  Request packets were 110 bytes in size.  Response packets ‚Äî on average, 321 bytes (¬± 29 bytes). <br><br>  According to our measurements, using the <code>ssdp:all</code> <code>M-SEARCH</code> , an attacker can get: <br><br><ul><li>  <b>7x</b> multiplication of packets </li><li>  <b>20x</b> traffic multiplication </li></ul><br>  It can be calculated that the attack on 43 million packets per second and 112 Gbit / s was initiated using: <br><br><ul><li>  6.1 million packets per second </li><li>  channel 5.6 Gbit / s </li></ul><br>  In other words, one well-connected 10 Gbps server capable of IP spoofing can generate a significant SSDP attack. <br><br><h2>  More about SSDP servers </h2><br>  As we polled vulnerable SSDP servers, we can show the most popular <code>Server</code> header values: <br><br> <code>104833 Linux/2.4.22-1.2115.nptl UPnP/1.0 miniupnpd/1.0 <br> 77329 System/1.0 UPnP/1.0 IGD/1.0 <br> 66639 TBS/R2 UPnP/1.0 MiniUPnPd/1.2 <br> 12863 Ubuntu/7.10 UPnP/1.0 miniupnpd/1.0 <br> 11544 ASUSTeK UPnP/1.0 MiniUPnPd/1.4 <br> 10827 miniupnpd/1.0 UPnP/1.0 <br> 8070 Linux UPnP/1.0 Huawei-ATP-IGD <br> 7941 TBS/R2 UPnP/1.0 MiniUPnPd/1.4 <br> 7546 Net-OS 5.xx UPnP/1.0 <br> 6043 LINUX-2.6 UPnP/1.0 MiniUPnPd/1.5 <br> 5482 Ubuntu/lucid UPnP/1.0 MiniUPnPd/1.4 <br> 4720 AirTies/ASP 1.0 UPnP/1.0 miniupnpd/1.0 <br> 4667 Linux/2.6.30.9, UPnP/1.0, Portable SDK for UPnP devices/1.6.6 <br> 3334 Fedora/10 UPnP/1.0 MiniUPnPd/1.4 <br> 2814 1.0 <br> 2044 miniupnpd/1.5 UPnP/1.0 <br> 1330 1 <br> 1325 Linux/2.6.21.5, UPnP/1.0, Portable SDK for UPnP devices/1.6.6 <br> 843 Allegro-Software-RomUpnp/4.07 UPnP/1.0 IGD/1.00 <br> 776 Upnp/1.0 UPnP/1.0 IGD/1.00 <br> 675 Unspecified, UPnP/1.0, Unspecified <br> 648 WNR2000v5 UPnP/1.0 miniupnpd/1.0 <br> 562 MIPS LINUX/2.4 UPnP/1.0 miniupnpd/1.0 <br> 518 Fedora/8 UPnP/1.0 miniupnpd/1.0 <br> 372 Tenda UPnP/1.0 miniupnpd/1.0 <br> 346 Ubuntu/10.10 UPnP/1.0 miniupnpd/1.0 <br> 330 MF60/1.0 UPnP/1.0 miniupnpd/1.0 <br> ...</code> <br> <br>  The most popular <code>ST</code> header values ‚Äã‚Äãare: <br><br> <code>298497 upnp:rootdevice <br> 158442 urn:schemas-upnp-org:device:InternetGatewayDevice:1 <br> 151642 urn:schemas-upnp-org:device:WANDevice:1 <br> 148593 urn:schemas-upnp-org:device:WANConnectionDevice:1 <br> 147461 urn:schemas-upnp-org:service:WANCommonInterfaceConfig:1 <br> 146970 urn:schemas-upnp-org:service:WANIPConnection:1 <br> 145602 urn:schemas-upnp-org:service:Layer3Forwarding:1 <br> 113453 urn:schemas-upnp-org:service:WANPPPConnection:1 <br> 100961 urn:schemas-upnp-org:device:InternetGatewayDevice: <br> 100180 urn:schemas-upnp-org:device:WANDevice: <br> 99017 urn:schemas-upnp-org:service:WANCommonInterfaceConfig: <br> 98112 urn:schemas-upnp-org:device:WANConnectionDevice: <br> 97246 urn:schemas-upnp-org:service:WANPPPConnection: <br> 96259 urn:schemas-upnp-org:service:WANIPConnection: <br> 93987 urn:schemas-upnp-org:service:Layer3Forwarding: <br> 91108 urn:schemas-wifialliance-org:device:WFADevice: <br> 90818 urn:schemas-wifialliance-org:service:WFAWLANConfig: <br> 35511 uuid:IGD{8c80f73f-4ba0-45fa-835d-042505d052be}000000000000 <br> 9822 urn:schemas-upnp-org:service:WANEthernetLinkConfig:1 <br> 7737 uuid:WAN{84807575-251b-4c02-954b-e8e2ba7216a9}000000000000 <br> 6063 urn:schemas-microsoft-com:service:OSInfo:1 <br> ...</code> <br> <br>  Vulnerable IP addresses seem to belong mainly to home routers. <br><br><h2>  Open SSDP is a vulnerability </h2><br>  It goes without saying that it‚Äôs not a good idea to allow incoming 1900 / UDP traffic from the Internet to your home printer or other device.  This problem has been known since at least January 2013: <br><br><ul><li>  " <a href="https://community.rapid7.com/community/infosec/blog/2013/01/29/security-flaws-in-universal-plug-and-play-unplug-dont-play">UPnP security vulnerabilities</a> " </li></ul><br>  The authors of SSDP did not explicitly think about the potential of UDP as a packet multiplier.  There are some obvious recommendations for using SSDP in the future: <br><br><ul><li>  The authors of SSDP must answer if there is at least some possibility of using unicast <code>M-SEARCH</code> requests in the real world.  As far as I understand, <code>M-SEARCH</code> makes practical sense only as a multicast request on a local network. </li><li>  Support for unicast requests <code>M-SEARCH</code> must either be canceled or limited in speed, as the <a href="http://www.redbarn.org/dns/ratelimits">DNS Response Rate Limit</a> applies. </li><li>  <code>M-SEARCH</code> should be sent only to recipients on the local network.  Answers outside the local network make little sense and open up the possibility of using the described vulnerability. </li></ul><br>  At the same time, we recommend: <br><br><ul><li>  Network administrators must ensure that incoming port 1900 / UDP is blocked on the firewall. </li><li>  Internet providers <b>should never allow IP spoofing</b> on their network.  IP spoofing is the true root cause of the problem.  See the notorious <a href="http://www.bcp38.info/index.php/Main_Page">BCP38</a> . </li><li>  Internet service providers must allow their users to use the <b>BGP flowspec</b> to limit incoming traffic to 1900 / UDP in order to disperse traffic congestion during major SSDP attacks. </li><li>  ISPs must collect <b>netflow</b> samples.  This is necessary to determine the true source of the attack.  With netflow, it will be easy to answer questions like: ‚ÄúWhich of my clients sent 6.4 million packets per second to port 1900?‚Äù To maintain confidentiality, we recommend collecting traffic samples with a maximum sample interval: 1 out of 64,000 packets.  This is sufficient to detect DDoS attacks, and at the same time, sufficient confidentiality of individual user sessions is maintained. </li><li>  Developers should not roll out their own UDP protocols without taking into account the problem of packet multiplication.  UPnP needs to be standardized and examined normally. </li><li>  End users are advised to run a script to scan their networks for devices with UPnP function and consider whether to allow them access to the Internet. </li></ul><br>  Moreover, we made a website for online verification.  Check it out if you want to find out if your public IP address contains vulnerable SSDP services: <br><br><ul><li>  <a href="https://badupnp.benjojo.co.uk/">https://badupnp.benjojo.co.uk/</a> </li></ul><br>  Unfortunately, most of the unprotected routers that were used in this attack are located in China, Russia and Argentina ‚Äî places that have not historically been known for the promptness of Internet providers. <br><br><h2>  Total </h2><br>  Cloudflare clients are fully protected from SSDP attacks and other multiply L3 attacks.  These attacks are well reflected by <a href="https://blog.cloudflare.com/how-cloudflares-architecture-allows-us-to-scale-to-stop-the-largest-attacks/">Cloudflare infrastructure</a> and do not require additional actions.  However, increasing the size of SSDP can be a serious problem for other Internet users.  We need to urge our ISPs to prohibit IP spoofing on their networks, enable BGP flowspec support, and configure network flow collection (netflow). <br><br>  <i>The article was prepared jointly by Marek Majkowski and Ben Cartwright-Cox.</i> </div><p>Source: <a href="https://habr.com/ru/post/332812/">https://habr.com/ru/post/332812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332800/index.html">Anonymous workaholic: how to motivate yourself</a></li>
<li><a href="../332802/index.html">Pathfinder: how we make the interface for CRPG</a></li>
<li><a href="../332804/index.html">Simple form validation without JS</a></li>
<li><a href="../332806/index.html">Oculus Rift integration into desktop Direct3D application on the example of Renga</a></li>
<li><a href="../332808/index.html">How I revived VCSA 6.0</a></li>
<li><a href="../332814/index.html">Translation of the Appium Essentials book. Chapter 5</a></li>
<li><a href="../332816/index.html">24-core CPU, and I can not move the cursor</a></li>
<li><a href="../332818/index.html">Translation of excerpts from Robert Heinlein‚Äôs book, Take Your Government Back - part 26</a></li>
<li><a href="../332820/index.html">How to grow better support in 15 years</a></li>
<li><a href="../332822/index.html">How to confuse analytics - 5. Conceptual apparatus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>