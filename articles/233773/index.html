<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing gesture sequences in Unity 3D using the TouchScript library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For many gaming applications, especially those working on small screens of mobile devices, it is very important to reduce the area occupied by the con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing gesture sequences in Unity 3D using the TouchScript library</h1><div class="post__text post__text-html js-mediator-article">  For many gaming applications, especially those working on small screens of mobile devices, it is very important to reduce the area occupied by the controls in order to maximize the part of the screen intended for displaying the main content.  To do this, you can configure touch targets (touch targets) so that they handle various combinations of gestures.  Thus, the number of touch targets on the screen will be reduced to a minimum.  For example, two interface elements, one of which causes the gun to fire, and the second to rotate, can be replaced by one, allowing you to perform both actions with one continuous touch. <br>  In this article, I will discuss how to set up a scene for controlling the controller from the first person using touch targets.  First of all, you need to adjust the touch targets for the base position of the controller and rotation, and then expand their set of functions.  The latter can be achieved by existing interface elements, without adding new objects.  The scene that we will have will demonstrate the wide capabilities of Unity 3D in Windows * 8 as a platform for processing various sequences of gestures. <br><a name="habracut"></a><br><h4>  Setting up the scene in Unity * 3D </h4>  First you need to adjust the scene.  To do this, import into Unity * 3D a landscape resource in .fbx format with mountains and trees, exported from Autodesk 3D Studio Max *.  Place the controller in the center of the landscape. <br>  Set the depth of the main camera (it is part of the controller) to level -1.  Let's create a separate element of the camera interface with support for an orthogonal projection, with a width of 1 and a height of 0.5, as well as the flags of Don't Clear.  Then create a GUIWidget layer and make it a mask of the camera interface. <br>  Place the main interface elements that control the controller on the stage in the field of view of the orthogonal camera.  Add a sphere for each finger of your left hand.  The little finger sphere makes the controller move to the left, the ring finger sphere - forward, the middle finger - to the right, and the index finger - back.  The sphere of the thumb allows you to jump and launch spherical shells at an angle of 30 degrees clockwise. <br>  For the right-hand interface element, create a cube (square in orthogonal projection).  Set up a shift gesture for this cube and bind it to the MouseLook.cs script.  This interface element provides the same features as the touchpad of an Ultrabook device. <br>  We place these interface elements out of the field of view of the main camera, and set the GUIWidget as a layer.  In fig.  1 you can see how the interface elements allow you to launch projectiles and control the position of the controller on the stage. <br><br><img src="https://habrastorage.org/files/f82/0ad/e0d/f820ade0ddd3482181d7b62d9c4a26ca.jpg"><br>  <i>Figure 1. First-person controller scene with landscape and spherical projectiles fired.</i> <br><br>  In this scene, shells launched from the controller fly through the trees.  To fix this, you need to add a grid or collider to each tree.  Another problem on this stage - low forward speed - occurs when you try to look down using the touch pad at the same time as moving forward using the sphere of the ring finger.  To solve this problem, you can limit the viewing angle when looking down while holding the forward button. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Multiple touches </h4>  On the base scene there is a controller from the first person, which launches the shells at a certain angle from the center (see Figure 1).  The default angle is set to 30 degrees clockwise. <br>  Adjust the scene to support multiple touches performed more often than the set period, change the launch angle of the projectiles and try to launch the projectile.  In this case, you can adjust the angle to increase exponentially depending on the number of tangencies using float variables in the script for the sphere of the thumb on the left.  These variables control the angle and time since the launch of the last projectile: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeSinceFire = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> firingAngle = <span class="hljs-number"><span class="hljs-number">30.0f</span></span>;</code> </pre> <br>  Next, we configure the Update cycle in the script for the sphere of the thumb so that the projectile launch angle decreases if the touch of the sphere of the thumb is performed more often than once every half second.  In the event that touches follow less often than once every half second, or the projectile launch angle decreases to 0 degrees, the projectile launch angle will return to 30 degrees.  The result is the following code: <br><pre> <code class="cpp hljs"> timeSinceFire += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(timeSinceFire &lt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { firingAngle += -l<span class="hljs-number"><span class="hljs-number">.0f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { firingAngle = <span class="hljs-number"><span class="hljs-number">30.0f</span></span>; } timeSinceFire = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(firingAngle &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { firingAngle = <span class="hljs-number"><span class="hljs-number">30</span></span>; } projectileSpawnRotation = Quaternion.AngleAxis(firingAngle,CH.transform.up);</code> </pre><br>  Such a code will produce a shelling effect, in which continuous touches will launch projectiles at a constantly decreasing angle (see Fig. 2).  This effect can be allowed to customize users or make available under certain conditions in the game or simulation mode. <br><br><img src="https://software.intel.com/sites/default/files/managed/25/8e/Implementing_Gesture_Sequences_f2.png" alt="image"><br>  <i>Figure 2. Continuous touches lead to a change in the launch direction of the shells.</i> <br><br><h4>  Scrolling scaling </h4>  We set up a square in the bottom right of the screen in Figure.  1 to work in a mode similar to the touch panel on the keyboard.  With the gesture of shift, the square does not move, but turns the main camera of the scene up, down, left and right with the help of the script of the MouseLook controller.  Similarly, the zoom gesture (similar to stretching / compressing on other platforms) does not scale the square, but changes the field of view of the main camera, thanks to which the user can zoom in or out on the main camera (see Figure 3).  Adjust the controller so that the shift gesture immediately after scaling returns the field of view of the camera to the default value of 60 degrees. <br>  To do this, you need to program a logical variable (panned) and a variable of type float, so that they mark the time elapsed from the last scaling gesture: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeSinceScale; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeSincePan; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> panned;</code> </pre><br>  Set the timeSinceScale variable to 0.0f when executing the scaling gesture, and set the panned variable to True when executing the shift gesture.  The field of view of the main camera of the scene is configured in the Update cycle, as can be seen in the script for the rectangle-touch panel: <br><pre> <code class="cpp hljs"> timeSinceScale += Time.deltaTime; timeSincePan += Time.deltaTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(panned &amp;&amp; timeSinceScale &gt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span> &amp;&amp; timeSincePan &gt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { fieldOfView += <span class="hljs-number"><span class="hljs-number">5.0f</span></span>; panned = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(panned &amp;&amp; timeSinceScale &lt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { fieldOfView = <span class="hljs-number"><span class="hljs-number">60.0f</span></span>; panned = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } Camera.main.fieldOfView = fieldOfView;</code> </pre><br>  Consider the functions onScale and onPan.  Please note that the float timeSincePan variable does not allow the field of view to constantly increase when the touch panel is used to control the camera: <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPanStateChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object sender, GestureStateChangeEventArgs e)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (e.State) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Gesture.GestureState.Began: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Gesture.GestureState.Changed: var target = sender as PanGesture; Debug.DrawRay(transform.position, target.WorldTransformPlane.normal); Debug.DrawRay(transform.position, target.WorldDeltaPosition.normalized); var local = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(transform.InverseTransformDirection(target.WorldDeltaPosition).x, transform.InverseTransformDirection(target.WorldDeltaPosition).y, <span class="hljs-number"><span class="hljs-number">0</span></span>); targetPan += transform.InverseTransformDirection(transform.TransformDirection(local)); <span class="hljs-comment"><span class="hljs-comment">//if (transform.InverseTransformDirection(transform.parent.TransformDirection(targetPan -startPos)).y &lt; 0) targetPan = startPos; timeSincePan = 0.0f; panned = true; break; } } private void onScaleStateChanged(object sender, GestureStateChangeEventArgs e) { switch (e.State) { case Gesture.GestureState.Began: case Gesture.GestureState.Changed: var gesture = (ScaleGesture)sender; if (Math.Abs(gesture.LocalDeltaScale) &gt; 0.01 ) { fieldOfView *= gesture.LocalDeltaScale; if(fieldOfView &gt;= 170){fieldOfView = 170;} if(fieldOfView &lt;= 1){fieldOfView = 1;} timeSinceScale = O.Of; } break; } }</span></span></code> </pre><br><br><img src="https://software.intel.com/sites/default/files/managed/af/86/Implementing_Gesture_Sequences_f3.jpg" alt="image"><br>  <i>Figure 3. The main camera of the scene with the image approximated by the rectangle of the touch panel on the right.</i> <br><br><h4>  Push, release with a click </h4>  If you press and release the sphere of the little finger, and then hold it for half a second, you can increase the horizontal speed of the controller. <br>  To support this function, let's add a float variable and a boolean variable that will allow us to mark the time from the gestures of releasing the sphere of the little finger and the gesture of clicking on it: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> timeSinceRelease; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flicked;</code> </pre><br>  When setting up the scene for the first time, I gave the little pink sphere script access to the InputController controller script so that the little pink sphere on the left could cause the controller to move left.  The variable that controls the horizontal speed of the controller is not in the InputController script, but in the CharacterMotor script.  You can transfer the script of the sphere of the left little finger to the CharacterMotor script in the same way: <br><pre> <code class="cpp hljs"> CH = GameObject.Find(<span class="hljs-string"><span class="hljs-string">"First Person Controller"</span></span>); CHFPSInputController = (FPSInputController)CH.GetComponent(<span class="hljs-string"><span class="hljs-string">"FPSInputController"</span></span>); CHCharacterMotor = (CharacterMotor)CH.GetComponent (<span class="hljs-string"><span class="hljs-string">"CharacterMotor"</span></span>);</code> </pre><br>  The onFlick function in our script only allows you to set the flicked logical variable to a value equal to True. <br>  The Update function in the script is called once per frame and changes the controller movement horizontally as follows: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(flicked &amp;&amp; timeSinceRelease &lt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { CHCharacterMotor.movement.maxSidewaysSpeed += <span class="hljs-number"><span class="hljs-number">2.0f</span></span>; flicked = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } timeSinceRelease += Time.deltaTime; }</code> </pre><br>  Thanks to this code, you can increase the speed of movement horizontally.  To do this, press and release the sphere of the little finger, and then hold on it for half a second.  You can adjust the slow motion horizontally in various ways.  For example, you can use it to press and release the sphere of the index finger, and then click on it.  Notice that the CHCharacterMotor.movement method contains not only the maxSidewaysSpeed ‚Äã‚Äãparameter, but also gravity, maxForwardsSpeed, maxBackwardsSpeed, and others.  The use of various gestures of the TouchScript library and objects that process gestures, in combination with these parameters, provides ample opportunities and various strategies for developing touch interfaces in Unity 3D scenes.  When creating touch interfaces for such applications, you can try various options and choose the most efficient and ergonomic. <br><br><h4>  Problems with gesture sequences </h4>  The sequences of gestures that we used in this article depend significantly on the Time.deltaTime function.  I use this function in combination with various gestures before and after the function defines the action.  The two main problems I encountered when setting up these cases are the magnitude of the time interval and the nature of the gestures. <br><br><h5>  Time interval </h5>  When writing this article, I used a half second interval.  If I selected an interval of one tenth of a second, the device could not recognize the sequence of gestures.  Although it seemed to me that the touch rate was quite high, it did not lead to the necessary actions on the screen.  Perhaps this is due to delays in the operation of the device and software, so I recommend that when developing sequences of gestures take into account the performance of the target platform. <br><br><h5>  Gestures </h5>  When working on this example, I was originally going to use the zoom and pan gestures, and then touch and click gestures.  Scaling and shifting worked correctly, but stopped as soon as I added a touch gesture.  Although I managed to set up sequences of scaling and shifting gestures, it is not very user friendly.  A better option would be to configure another touch target in the interface element to handle touch gestures and hold after scaling and shifting. <br>  In this example, I use a half second time interval to determine whether an action is performed or not.  You can also configure multiple time intervals, although this will complicate the interface.  For example, a sequence of pressing and releasing gestures and following for half a second behind them can increase the speed of movement horizontally, and a similar sequence with an interval from half a second to a second can reduce the speed.  Using time intervals in this way, you can not only customize the user interface more flexibly, but also add hidden secrets to the scene. <br><br><h4>  Conclusion </h4>  In this article, I set up a scene with different sequences of gestures in Unity * 3D using the TouchScript library on an Ultrabook device with Windows 8. The purpose of the implementation of these sequences is to reduce the area of ‚Äã‚Äãthe screen through which the user controls the application.  In this case, you can select a large screen area to display attractive content. <br>  In cases where the sequence of gestures did not work correctly, we managed to find a suitable alternative solution.  One of the tuning tasks was to get the workflow to work properly using the Time.deltaTime function on the existing device.  Thus, the scene we created in Unity 3D for this article confirms the viability of Windows 8 on Ultrabook devices as a platform for developing applications using gesture sequences. </div><p>Source: <a href="https://habr.com/ru/post/233773/">https://habr.com/ru/post/233773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233761/index.html">Databases and NoSQL (Chapter 4 of the book "Scalable and high-performance web applications")</a></li>
<li><a href="../233763/index.html">Automatic sex detection by name</a></li>
<li><a href="../233765/index.html">"Venture squared", or 13: 0 in favor of the investor</a></li>
<li><a href="../233767/index.html">Is there a difference - to work in an outsourcing or in a grocery company? Opinions from Yandex in Nizhny Novgorod</a></li>
<li><a href="../233769/index.html">Smart polivalka flower on the microcontroller Attiny13A</a></li>
<li><a href="../233775/index.html">iNew V8 - special, but not perfect</a></li>
<li><a href="../233777/index.html">Alfa Camp 2014: 94 participants implement their ideas in 5 weeks and present them to investors</a></li>
<li><a href="../233779/index.html">Fly6: HD DVR and LED bike light in one package</a></li>
<li><a href="../233781/index.html">Looking for the perfect hub</a></li>
<li><a href="../233783/index.html">New service: regular C / C ++ code audit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>