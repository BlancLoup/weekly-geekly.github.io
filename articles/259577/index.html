<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of symfony 2 and google calendar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When you create a modern web project you can not do without working with external services. Recently, we had a task to work with calendars. In this ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of symfony 2 and google calendar</h1><div class="post__text post__text-html js-mediator-article">  When you create a modern web project you can not do without working with external services.  Recently, we had a task to work with calendars.  In this article I would like to talk about some points of integrating a project on Symfony2 with Google Calendar. <br><a name="habracut"></a><br><h2>  Getting the key </h2><br>  To exchange data with google you need to get the key.  Our site will ask for information unnoticed by the user, so we need a key for the account service.  To get the key you need to go to the <a href="https://console.developers.google.com/">console for developers</a> .  Add an application, go to the Api tab and activate the calendar.  Now you can get the key in the Credentials tab. <br>  There is a json or p12 option.  There is no particular difference, it depends on what is more convenient for you. <br><br><h2>  Google Api Module </h2><br>  To work with google services there is an <a href="https://github.com/google/google-api-php-client">api client</a> .  Install it through composer <br><blockquote>  php composer.phar require google / apiclient </blockquote><br>  We make a small wrapper and declare it as a service. <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Google</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Google_Client */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $client; <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Google_Service_Calendar */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $calendar; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $scope; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($scope)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Google_Client(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;scope = $scope; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCredentialsP12</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p12Path, $email)</span></span></span><span class="hljs-function"> </span></span>{ $credentials = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Google_Auth_AssertionCredentials( $email, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;scope, file_get_contents($p12Path) ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client-&gt;setAssertionCredentials($credentials); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCredentialsJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($jsonPath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client-&gt;loadServiceAccountJson($jsonPath, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;scope); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Google_Service_Calendar */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCalendar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;calendar) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;calendar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Google_Service_Calendar(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;client); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;calendar; } }</code> </pre> <br><br><pre> <code class="hljs scala">services: google.client: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">MyBundle</span></span>\<span class="hljs-type"><span class="hljs-type">Google</span></span> arguments: [<span class="hljs-symbol"><span class="hljs-symbol">'https</span></span>:<span class="hljs-comment"><span class="hljs-comment">//www.googleapis.com/auth/calendar.readonly'] #        </span></span></code> </pre><br>  The setCredentialsP12 and setCredentialsJson methods are needed in order to transfer keys into our service.  The getCalendar method returns the prepared calendar object and we do not need to somehow supplement it outside our service. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Key Connection </h2><br>  We may have different keys in different environments, and each developer may have his own key.  Therefore, we will transfer the key to the service depending on the presence of certain parameters that can be set in the local config.  To do this, write and connect CompilerPass. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">DependencyInjection</span></span>\<span class="hljs-title"><span class="hljs-title">Compiler</span></span>\<span class="hljs-title"><span class="hljs-title">CompilerPassInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">DependencyInjection</span></span>\<span class="hljs-title"><span class="hljs-title">ContainerBuilder</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CredentialsPass</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompilerPassInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerBuilder $container)</span></span></span><span class="hljs-function"> </span></span>{ $googleClient = $container-&gt;getDefinition(<span class="hljs-string"><span class="hljs-string">'google.client'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        if ($container-&gt;hasParameter('google_p12_path') &amp;&amp; $container-&gt;hasParameter('google_p12_email')) { $path = $container-&gt;getParameter('google_p12_path'); $email = $container-&gt;getParameter('google_p12_email'); $googleClient-&gt;addMethodCall('setCredentialsP12', [$path, $email]); } elseif ($container-&gt;hasParameter('google_json_path')) { $googleClient-&gt;addMethodCall('setCredentialsJson', [$container-&gt;getParameter('google_json_path')]); } } }</span></span></code> </pre><br>  And now it is enough for us to write in the local config. <br><pre> <code class="hljs perl">parameters: google_p12_path: <span class="hljs-keyword"><span class="hljs-keyword">my</span></span>-certificate.p12 google_p12_email: <span class="hljs-keyword"><span class="hljs-keyword">my</span></span>-email@mail.com</code> </pre>  or <pre> <code class="hljs pgsql">parameters: google_json_path: my-certificate.json</code> </pre><br><br><h2>  Getting a list of events </h2><br>  Now we have a service and we can request a list of events. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $start \DateTime */</span></span> $start; <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $end \DateTime */</span></span> $end; $events = $google-&gt;getCalendar()-&gt;events-&gt;listEvents(<span class="hljs-string"><span class="hljs-string">'example@mail.com'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'timeMin'</span></span> =&gt; $start-&gt;format(<span class="hljs-string"><span class="hljs-string">'c'</span></span>), <span class="hljs-string"><span class="hljs-string">'timeMax'</span></span> =&gt; $end-&gt;format(<span class="hljs-string"><span class="hljs-string">'c'</span></span>), ]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (\Google_Service_Exception $exception) { <span class="hljs-comment"><span class="hljs-comment">//TODO implement error catching }</span></span></code> </pre><br>  Each calendar has its own unique email (example@mail.com in the example above).  With the help of the listEvents method here we get all the events from our calendar for a certain period of time.  Google uses the ISO 8601 standard for time parameters (timeMin, timeMax), so for formatting time it suffices to use the letter c. <br><br><h2>  Instead of conclusion </h2><br>  Spending a little time, we get access from our project to the google calendar.  You can further develop this integration, for example, you can organize a more complex search or add events from our project.  And if you are ready to entrust your calendars (and maybe not yours) to Google, then you can get a very powerful tool for cheap, which you can flexibly adjust to your needs. </div><p>Source: <a href="https://habr.com/ru/post/259577/">https://habr.com/ru/post/259577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259565/index.html">Talking with first customers</a></li>
<li><a href="../259567/index.html">Setting an object property using lambda expressions</a></li>
<li><a href="../259569/index.html">BSON injection in MongoDB adapter for Ruby</a></li>
<li><a href="../259573/index.html">Whether it is necessary to move to a hosting in Russia, or Fault tolerance on 242-FZ</a></li>
<li><a href="../259575/index.html">Watch networks of the past</a></li>
<li><a href="../259579/index.html">Controlling the volume of a multi-zone amplifier with an Android and Arduino application</a></li>
<li><a href="../259583/index.html">OpenCV 3.0 release with Python 3 support</a></li>
<li><a href="../259589/index.html">Loading models, traits</a></li>
<li><a href="../259591/index.html">Usability - one Redmine plugin, providing a lot of useful things. Part two</a></li>
<li><a href="../259593/index.html">DevConf 2015 - the final vote for the reports. Make the program better and more useful</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>