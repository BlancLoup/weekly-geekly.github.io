<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Combining Qt and AdMob</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At one point, it took me to integrate advertising into a mobile application on Qt and I was very surprised to find that, in general, there were no sol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Combining Qt and AdMob</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/28b/efc/03a/28befc03a0234ba88ab985cf1cc1b869.jpg" alt="image"><br>  At one point, it took me to integrate advertising into a mobile application on Qt and I was very surprised to find that, in general, there were no solutions.  No, there is of course, the <a href="http://plugins.v-play.net/plugins/admob/">V-Play AdMob plugin</a> , but you excuse me, 160 bucks for what you can do over the weekend is too much.  Subsequent searches led me to <a href="http://habrahabr.ru/post/220947/">this</a> article on Habr√©, which served as material for the Android implementation, and eventually turned out to be a small framework for working with AdMob advertising on IOS and Android. <br><a name="habracut"></a><br>  The framework itself can be found on <a href="https://github.com/yevgeniy-logachev/QtAdMob">GitHub</a> .  Here, in QtAdMob is the library, and QtAdMobApp is a test application that demonstrates the capabilities of the library.  Currently supported banners and Interstitial advertising (full-screen advertising).  The banner interface is represented by <b>IQtAdMobBanner</b> , containing a set of methods for managing the banner (setting position, size, showing / hiding, etc.).  Specific implementations are made in <b>QtAdMobBanner <i>Ios / Android / Dummy</i></b> classes, respectively for IOS, Android and the latter is a stub class for unsupported platforms.  Creating a platform-specific banner lay on the shoulders of the <b>CreateQtAdMobBanner ()</b> function. <br>  This structure also applies to interstitial advertising; it has its basic <b>IQtAdMobInterstitial</b> interface, a platform-specific implementation in <b>QtAdMobInterstitial <i>Ios / Android / Dummy</i></b> classes, as well as the creation <b>function CreateQtAdMobInterstitial ()</b> . <br><br><div class="spoiler">  <b class="spoiler_title">usage example:</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"MainWindow.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ui_MainWindow.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"QtAdMob/QtAdMobBanner.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"QtAdMob/QtAdMobInterstitial.h"</span></span></span><span class="hljs-meta"> MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent) , ui(new Ui::MainWindow) , m_Switch(false) { ui-&gt;setupUi(this); m_Banner = CreateQtAdMobBanner(); m_Banner-&gt;Initialize(); m_Banner-&gt;SetUnitId(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ca-app-pub-7485900711629006/8288667458"</span></span></span><span class="hljs-meta">); m_Banner-&gt;SetSize(IQtAdMobBanner::Banner); m_Banner-&gt;AddTestDevice(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"514ED2E95AD8EECE454CC5565326160A"</span></span></span><span class="hljs-meta">); m_Banner-&gt;Show(); m_Interstitial = CreateQtAdMobInterstitial(); m_Interstitial-&gt;LoadWithUnitId(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ca-app-pub-7485900711629006/9462519453"</span></span></span><span class="hljs-meta">); m_Interstitial-&gt;AddTestDevice(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"514ED2E95AD8EECE454CC5565326160A"</span></span></span><span class="hljs-meta">); m_Interstitial-&gt;Show(); connect(ui-&gt;okButton, SIGNAL(clicked()), this, SLOT(OnButtonOkClicked())); } MainWindow::~MainWindow() { m_Banner-&gt;Shutdown(); delete m_Banner; delete m_Interstitial; delete ui; } void MainWindow::resizeEvent(QResizeEvent *event) { UNUSED(event); QPoint position((width() - m_Banner-&gt;GetSizeInPixels().width()) * 0.5f, 50.0f); m_Banner-&gt;SetPosition(position); } void MainWindow::OnButtonOkClicked() { bool isShowed = m_Banner-&gt;IsShow(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!isShowed) { m_Banner-&gt;Show(); ui-&gt;okButton-&gt;setText(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hide Banner"</span></span></span><span class="hljs-meta">); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { m_Banner-&gt;Hide(); ui-&gt;okButton-&gt;setText(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Show Banner"</span></span></span><span class="hljs-meta">); } }</span></span></code> </pre> <br>  Initialize - the method performs the basic initialization of the banner, specifically in IOS this method makes the search for the main view and "attaches" the banner view to it.  Actually, in android, this method does almost the same thing. <br>  SetUnitId - sets the advertisement identifier that can be obtained in the company settings of your application on the AdMob page. <br>  SetSize - as the name says, sets the size of the banner.  Possible sizes are specified in the listing in the banner interface. <br>  AddTestDevice - adds test device IDs, ads on such devices will be represented by a test banner, indicating the size of the banner, and so on.  Debazhnyh things.  The device ID can be pulled from the console when the application is launched on the device. <br>  Show - well, and the method that performs the loading and display of advertising.  To hide ads there is a method to hide <br>  In the example above, in the resizeEvent method, the banner is positioned in the center. <br><br>  For full-screen advertising is still easier, because  there is no possibility to set the position and size, the interface is reduced to a couple of methods.  As a rule, this type of advertisement is displayed when switching between levels in games, and therefore it should already be loaded at the time of the show.  Therefore, the methods of loading and displaying are separated here.  LoadWithUnitId - the method loads an advertisement with a specific identifier and must be called as early as possible.  After the advertisement is loaded, it will not be displayed until the Show method is called <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>IOS integration:</b> <br><br>  Integration for IOS turned out to be quite simple and boils down to copying the framework into the desired project directory and adding the necessary libraries to the project.  To begin, we will include the framework in the .pro project file <br><pre> <code class="cpp hljs">include(QtAdMob/QtAdMob.pri)</code> </pre><br>  And also add all the necessary compilation flags and libraries. <br><pre> <code class="cpp hljs">ios:QMAKE_CXXFLAGS += -fobjc-arc ios:QMAKE_LFLAGS += -ObjC ios:QT += gui_private ios:LIBS += -F $$PWD/QtAdMob/platform/ios/GoogleMobileAds -framework GoogleMobileAds \ -framework AVFoundation \ -framework AudioToolbox \ -framework CoreTelephony \ -framework MessageUI \ -framework SystemConfiguration \ -framework CoreGraphics \ -framework AdSupport \ -framework StoreKit \ -framework EventKit \ -framework EventKitUI \ -framework CoreMedia</code> </pre><br><br>  <b>Android integration:</b> <br><br>  Since  I have practically no experience with java and android, the implementation turned out to be somewhat "monstrous" for me.  The main problem is that the flow in which the QT UI and the java UI flow work are two different flows, and all calls from C ++ to Java had to be transferred to the UI flow of Java, because the QtAdMobActivity implementation was rewarded with the same type of runOnUiThread calls. <br><br>  To connect the framework, you will need the following: <br>  - Copy the directory with the framework into the project directory and lock it into the .pro project file, as is the case with the IOS version <br><pre> <code class="cpp hljs">include(QtAdMob/QtAdMob.pri)</code> </pre><br>  - Copy the src / and google-play-services_lib / directories from the QtAdMob / platform / android directory to the directory where the AndroidManifest.xml manifest is located <br><br>  - Make all changes to your manifest as in the screenshot below. <br><img src="https://habrastorage.org/files/41f/baf/3ec/41fbaf3ecbb44fff976e44e325a2ba4b.png"><br><br>  - Link the following Qt libraries in the project file: <br><pre> <code class="cpp hljs">android:QT += androidextras gui-<span class="hljs-keyword"><span class="hljs-keyword">private</span></span></code> </pre><br>  - If it does not exist, create a project.properties file in the directory with the manifest file and add the path to the Google Play Services library <br><pre> <code class="cpp hljs">android.library.reference<span class="hljs-number"><span class="hljs-number">.1</span></span>=./google-play-services_lib/</code> </pre><br>  - and add a path to activations <br><pre> <code class="cpp hljs">android:DISTFILES += &lt;Path_to_manifest_location&gt;/src/org/dreamdev/QtAdMob/QtAdMobActivity.java</code> </pre><br><br>  An example of the test application <br><img src="https://habrastorage.org/files/288/5bc/b65/2885bcb6538e47fea3da22f6464f5a3e.png"><br><br>  That's all, I hope someone will benefit from this implementation.  Well, if you notice inaccuracies, typographical errors or have any suggestions - write to me in the meeting room or lichku </div><p>Source: <a href="https://habr.com/ru/post/261425/">https://habr.com/ru/post/261425/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261413/index.html">Skin Detection in Wolfram Language (Mathematica)</a></li>
<li><a href="../261415/index.html">Your cloud hosting in 5 minutes. Part 1: Ansible, Docker, Docker Swarm</a></li>
<li><a href="../261417/index.html">The Subtleties of ES6: Collections (Part 2)</a></li>
<li><a href="../261419/index.html">CIFS in Android, or how I got files from a broken phone</a></li>
<li><a href="../261421/index.html">The magic of tensor algebra: Part 1 - what is a tensor and what is it for?</a></li>
<li><a href="../261431/index.html">Remote work or freelancing in the outback. Aspects of communication. Part 2. There is a connection</a></li>
<li><a href="../261433/index.html">Good design, bad design ...</a></li>
<li><a href="../261437/index.html">Heme to send SMS (Ruby)</a></li>
<li><a href="../261439/index.html">Ruby Design Patterns</a></li>
<li><a href="../261441/index.html">How we transport data centers (the complexity of data center migration in the middle lane)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>