<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Problems after migration from openvz to lxc in Proxmox 4.x</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unfortunately, the development of openvz has come to a certain dead end, the paid version of virtuozo has gone to the side of the codebase and at some...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Problems after migration from openvz to lxc in Proxmox 4.x</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/36a/e58/f62/36ae58f62aac4d9abacfbc52d07eeca5.png"></div><br><br>  Unfortunately, the development of openvz has come to a certain dead end, the paid version of virtuozo has gone to the side of the codebase and at some point it turned out that openvz only works on the old kernel version 2.6.32, and work on merging openvz and virtuozo7 is going, say honestly not fast. <br><br>  Actually, this prompted the proxmox command in version 4.0 to abandon openvz in favor of lxc and kernel version 4.2.6.  Unfortunately, the proxmox team didn‚Äôt pay much attention to testing lxc in proxmox, I strongly recommend abstaining from anyone who wants to migrate with openvz. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below I will talk about all the difficulties and problems after migrating to lxc. <a name="habracut"></a><br><br>  I tried several times already lxc, to be honest, it was full of children's problems, and this every time I was repelled by using it in production, and I can poach homepagies and on openvz without children's problems lxc, even the same docker went much further into stability and predictability. <br><br>  From the openvz global problems, I only remember the problem in centos 7 where the network did not rise, and it was necessary to default to register with pens in rc.local, or by installing <a href="https://forum.proxmox.com/threads/fix-for-centos-7-container-networking.22770/">this patch</a> . <br><br>  In lxc everything turned out to be much worse, I switched to it from openvz, when the version of proxmox 4.1 was released, I honestly thought everything would work in lxc as expected and stable, as in Windows after the first service pack.  The advantage was to envelope the openvz backup in lxc with two teams, but unfortunately the move eventually responded with excruciating pain and a lot of wasted time, I wish I had sat on openvz for another year. <br><br>  lzop -d vzdump-openvz-126-2016_01_27-11_08_32.tar.lzo <br>  pct restore 126 vzdump-openvz-126-2016_01_27-11_08_32.tar --rootfs local: 0 <br><br>  Use the option to remove the disk quota --rootfs local: 0 if your storage is not on lvm or zfs.  Here is a <a href="https://pve.proxmox.com/wiki/Convert_OpenVZ_to_LXC">more detailed guide</a> for those who do not understand. <br><br>  The five main problems lxc I have encountered: <br><br><ul><li>  In centos 6 pkhp not to connect to the mysql socket, it is necessary to prescribe everywhere instead of localhost ip 127.0.0.1, I dug this problem for a long time but did not find a solution, at first I thought this was due to what I converted from openvz, but on a fresh installation of lxc centos 6 there is same problem.  Tried to put percona 5.6 problem persists. </li><li>  Monstrously slow work of lxc in the image base, that is, if the files are stored as a disk image on the host machine, the performance of the disk subsystem drops severalfold, from 3 to 20 times.  I have not tested lxc on lvm and zfs.  On lvm there is still no thin provision, but they promise in the next versions.  I have quite a lot of things deployed in image base in kvm and there is a certain overhead to write to disk, but it is measured in percent, even probably not in tens of percent, but such a catch is that writing to mysql becomes 20 times slower from lxc in proxmox I was not expecting.  Cured as a result by storing guest files directly in the host file system as in openvz.  At the same time, disk quotas do not work, but since there is plenty of space and monitoring of a place, it is scored on quotas, although disk quotas are more relevant for ssd systems.  When creating and restoring, specify the option --rootfs local: 0; unfortunately, this cannot be done from the web interface. </li><li>  Not working backups lxc, proxmox backup just hung on suspend vm even in version proxmox 4.1, this bug was fixed literally on March 2. </li><li>  It is really slower than openvz. </li><li>  I had two containers stuck tightly and they could not be killed by any means, the server was also not able to reboot gently because of them, so I had to make the reset button on the server. </li></ul><br><br>  Migration issues: <br><br><ul><li>  It was not possible to launch debian 6 normally after converting to lxc, I don‚Äôt remember exactly what the problem was, but due to the fact that debian 6 is heavily legacy, I transferred all applications to fresh debian with 8 hands. </li><li>  Above, I mentioned that php does not connect to mysql via socket. </li><li>  In centos 6 the network does not rise due to the renaming of network interfaces from venet to eth0, you need to go to the container from the host via pct enter ID and execute the commands <br>  sed -i -e 's / venet0 / eth0 / g' / etc / sysconfig / network <br>  rm -rf / etc / sysconfig / network-scripts / ifcfg-venet0: 0 <br>  rm -rf / etc / sysconfig / network-scripts / ifcfg-venet0 <br>  reboot </li><li>  You can‚Äôt go to the redhat based ssh container due to the lack of tty, as udev does a crooked work after conversion <br>  pct enter ID <br>  sed -i -e 's / start_udev / false / g' /etc/rc.d/rc.sysinit <br>  reboot </li></ul><br>  FYI: <br><br>  1) Detailed <a href="">guidelines</a> for updating proxmox 3-&gt; 4; <br>  2) Description of the problem with the speed of disks in lxc: <a href="https://forum.proxmox.com/threads/performance-issue-with-proxmox-4-high-io-delay.26012/">one</a> , <a href="https://forum.proxmox.com/threads/proxmox-4-lxc-chroot-instead-of-raw-images.22881/">two</a> , <a href="https://forum.proxmox.com/threads/high-wait-io-after-and-load-average-upgrade-to-proxmox-4.25128/">three</a> ; <br>  3) Support for proxmox 3.x will end in April 2016; <br>  4) <a href="https://forum.proxmox.com/threads/moving-to-lxc-is-a-mistake.25603/">Trade</a> , why lxc is bad; <br>  5) <a href="https://forum.proxmox.com/threads/can-lxc-backup-be-restored-to-openvz.25262/">How to migrate</a> c lxc back to openvz. <br><br>  I hope this post will save someone a lot of time. <br>  UPD1: I found another bug in some virtual machines in my backup vzdump does not save the / var / log folder and if you restart from backup, all services do not rise and swear at the absence of the log folder. </div><p>Source: <a href="https://habr.com/ru/post/278877/">https://habr.com/ru/post/278877/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278863/index.html">An example of game development based on Google Analytics data</a></li>
<li><a href="../278865/index.html">Certificate Authority Let's Encrypt has issued a million free certificates</a></li>
<li><a href="../278867/index.html">FizzBuzz problem solution</a></li>
<li><a href="../278869/index.html">We are looking for you to help you earn $ 5000 this summer</a></li>
<li><a href="../278871/index.html">Unit for node.js</a></li>
<li><a href="../278879/index.html">Windows 10 IoT: Evolution of Development Tools</a></li>
<li><a href="../278881/index.html">We are looking for errors in the game engine Xenko</a></li>
<li><a href="../278883/index.html">Umbrella monitoring of IT resources</a></li>
<li><a href="../278885/index.html">Error in Linux kernel sends damaged TCP / IP packets to Mesos, Kubernetes and Docker containers</a></li>
<li><a href="../278887/index.html">IBM and X Prize Foundation Announce Artificial Intelligence Competition With $ 5 Million Prize Fund</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>