<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>E-democracy or how to collect and process data on voting (and turnout) for renovation in Moscow</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was worth voting for the entry or exit from the renovation program to end - and for some reason, the turnout data for each particular house disappe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>E-democracy or how to collect and process data on voting (and turnout) for renovation in Moscow</h1><div class="post__text post__text-html js-mediator-article">  It was worth voting for the entry or exit from the renovation program to end - and for some reason, the turnout data for each particular house disappeared from the site of the mayor of Moscow, only votes for and against were left.  Certain numbers are written in the news, of course, but you want to see them yourself, play around with statistics, build graphs, don't you? <br><br>  And after statements like: <br><blockquote>  As for the popularity of these services, the public service centers ‚ÄúMy Documents‚Äù attracted a little more than half of all those who voted, slightly yielding to the <a href="https://rg.ru/2017/06/19/reg-cfo/golosovanie-moskvichej-po-renovacii-priznali-maksimalno-otkrytym.html">portal ‚ÄúActive Citizen‚Äù</a> </blockquote> somehow light doubts arise.  So - let's start collecting information!  And then we will analyze it.  To do this, we need some language (say, python), some kind of database (say, sqlite), and some kind of web scrapper, good for the python there are a lot of them.  Immediately I say, at the end I will give a link to the resulting database, you can do anything with it. <br><a name="habracut"></a><br>  We go to the <a href="https://www.mos.ru/city/projects/renovation/">website of the City Hall</a> , spin the wheel.  It is necessary to collect data from 4543 houses.  Clicks on a <a href="https://www.mos.ru/otvet-stroitelstvo/itogi-golosovaniya-zhitelej-po-proektu-programmy-renovacii/%3Fu%3D121">random house</a> , on <a href="https://www.mos.ru/renovation/rayon-voykovskiy/">regional lists</a> , and we look in what format the data is in general. <br><br>  Apparently, each house has a certain id, which we see in the url: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>https://www.mos.ru/otvet-stroitelstvo/itogi-golosovaniya-zhitelej-po-proektu-programmy-renovacii/?u=121</code> <br> <br>  Therefore, in order to process all the houses, we need somewhere to get a list of all ID students and sort them, taking the necessary information from each page, namely - the number of votes for, the number of votes against, the number of votes of all (there are also ‚Äúundecided ‚ÄùVotes, when one apartment has half voted for and half against, and whether there was a general house meeting (why? What if it comes in handy). <br><br>  Where to get a list of IT students?  As we have already seen above, in the regional lists there are no references to the indicated houses, this is just a textual list of addresses and that's it.  A pity it would be convenient.  Looks like it‚Äôs going to have to do a brute force.  But for starters, we‚Äôll still make a function that collects data from each specific IT specialist. <br><br>  To begin with, we will make a getter request for some house, and look at the resulting answer in order to understand what we need to scrap from there. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests r = requests.get(<span class="hljs-string"><span class="hljs-string">'https://www.mos.ru/otvet-stroitelstvo/itogi-golosovaniya-zhitelej-po-proektu-programmy-renovacii/?u=121'</span></span>) print(r.text)</code> </pre> <br>  We are surprised to find that there is no voting data in the answer, we are given some kind of page template.  We'll see with our eyes how the results load.  And really - at first we have a page in the browser with empty fields, and after a while the data appears in them.  Take a browser with the appropriate means "for the developer", for example, Mozilla, and see what actually happens there. <br><br><img src="http://i.imgur.com/EKtZtcy.png"><br><br>  Aha  We found a browser request to a certain api, and the ID is the same as the ID at home we are looking at. <br><br>  In other words, a <a href="https://www.mos.ru/altmosprx/api/1/renovation/house_result/121/">getter</a> request to <a href="https://www.mos.ru/altmosprx/api/1/renovation/house_result/121/">www.mos.ru/altmosprx/api/1/renovation/house_result/121</a> without any parameters gives us in response JSON of the following type: <br><br><pre> <code class="hljs xml">{ "execTime": 0.044450044631958, "errorMessage": "", "result": { "table": "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table table-big"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table-header"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apartment-id"</span></span></span><span class="hljs-tag">&gt;</span></span>0G6O4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-info"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>bf659227e8e3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>5f9403659209<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-choice"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-date"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>18.05<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>18.05<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apartment-position apartment-agree"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apartment-id"</span></span></span><span class="hljs-tag">&gt;</span></span>0G6O5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-info"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>3f12be5cea77<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-choice"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-date"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>15.05<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apartment-position apartment-agree"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apartment-id"</span></span></span><span class="hljs-tag">&gt;</span></span>0G6V1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-info"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>5acd126a410ea1a842e67066ea68fa8f<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-choice"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voting-date"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>24.05<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"apartment-position apartment-agree"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span>", "total": { "und": 0, "za": 100, "protocol_res": 0, "protiv": 0, "gorod_mark": 0, "protocol_date": null, "house_status": 1, "gorod": 0 }, "und_table": "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">table-big</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">\</span></span></span><span class="hljs-tag">"</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">table-header</span></span></span><span class="hljs-tag">\"&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span>", "address": " ,  63,  2" }, "request_id": "empty_requestid", "errorCode": 0 }</code> </pre> <br>  Well, here we don‚Äôt even need to scrap anything, all the data is immediately from api.  All you need is to count the number of apartment-id (total votes), to take ready data about the percentage of votes for, about the general house meeting. <br><br>  But still, in what range of aydishnikov will we look?  Total houses should be 4543. We give api 0 - there is such a house.  We give -1 - an error, well, thanks for that.  The lower limit determined.  We give 10,000 - there is such a house.  Okay, there are obviously more than 4543 of them. Let's try to determine the upper limit approximately by looking at a house from recently joined territories ... Back to the map, we climb somewhere in the ‚ÄúNew Moscow‚Äù away from the ‚Äúold‚Äù, about: Kokoshkino settlement, the summer resort of Kokoshkino , Truda Street, 2, id: 440931. Well, at least half a million of them we have. <br><br>  Going through half a million links in a normal loop is not the best idea, so we'll use the <a href="https://docs.python.org/3.3/library/concurrent.futures.html">concurrent.futures</a> module.  Of course, it would be possible to use something like asyncio, but we do not have such a large-scale task and can do it with ‚Äúlittle blood‚Äù.  Everything is very simple.  We look at what api gives when the house number is known to be right, when it is obviously wrong, and we make a function to check this all.  Then we twist it all in a loop with parallel queries, since  IT needs to process quite a lot.  Then we make out the result and write it down.  In general, you get something like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> concurrent.futures <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ProcessPoolExecutor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> concurrent.futures <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#try  ,   -,    ,     #             try: r = requests.get('https://www.mos.ru/altmosprx/api/1/renovation/house_result/' + str(url) + '/', timeout=10) print(url) r.encoding = 'utf-8' if '400: Bad Request' not in r.text: return str(url) except: #  ,        ,      woops = str(url) + ' failed' return woops results = [] with ProcessPoolExecutor(max_workers=6) as executor: future_results = {executor.submit(check, url): url for url in range(0, 1000000)} #   ,      : url in somelist for future in concurrent.futures.as_completed(future_results): results.append(future.result()) results[:] = [item for item in results if item or item == 0] #check  None,   , ;     ,     with open('/home/deb/mosres.txt', 'w') as f: for item in results: f.write('{}\n'.format(item))</span></span></code> </pre> <br>  We start and go about our business - this is a long time even with 6 workers.  Looking ahead, I will say that having processed a million, I got about 70 homes less than the results, so I had to turn this bagpipe to 10 million.  This is a long time, left work and went to work. <br>  Of course, it would be possible to raise the number of parallel requests, but we use someone else's ip, you need to behave politely (and then suddenly banned). <br><br>  In general, we have a list of all aydishnik houses, now we need to process them, take all the available information, etc.  It is inconvenient to process such an array into a text file without putting it in your hand.  We use sqlite3. <br><br>  Create a database.  All fields are obvious, except that the house and additional elements such as buildings, buildings, etc.  we will distribute - just in case, if we want, for example, to look at the trends of nearby houses. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sqlite3 schema = <span class="hljs-string"><span class="hljs-string">"CREATE TABLE `houses` (\ `id` INTEGER PRIMARY KEY,\ `street` TEXT NOT NULL ,\ `house_nbr` TEXT NOT NULL,\ `house_additional` TEXT,\ `total_votes` INTEGER,\ `total_za` INTEGER,\ `meeting` INTEGER DEFAULT '0',\ `flats` INTEGER\ );"</span></span> conn = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">'renovation.db'</span></span>) cur = conn.cursor() db = cur.execute(schema) conn.commit() conn.close()</code> </pre><br>  Well, to the point!  Let's make a function that adds and adds information on houses to the database, simultaneously we will record all JSON errors (most likely, there was no JSON in the answer) and unknown errors (most likely, there was no answer at all), and then we could see them and drive them away separately, if any, of course. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sqlite3 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gethouseinfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idd)</span></span></span><span class="hljs-function">:</span></span> print(idd) urly = <span class="hljs-string"><span class="hljs-string">'https://www.mos.ru/altmosprx/api/1/renovation/house_result/'</span></span> + str(idd) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: r = requests.get(urly) r.encoding = <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span> results = r.json() adress = results[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'address'</span></span>] print(adress) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> re.match(<span class="hljs-string"><span class="hljs-string">'(.*), (.*), (.*)'</span></span>, adress): adress_street = re.match(<span class="hljs-string"><span class="hljs-string">'(.*), (.*), (.*)'</span></span>, adress).group(<span class="hljs-number"><span class="hljs-number">1</span></span>) adress_house = re.match(<span class="hljs-string"><span class="hljs-string">'(.*), (.*), (.*)'</span></span>, adress).group(<span class="hljs-number"><span class="hljs-number">2</span></span>) adress_building = re.match(<span class="hljs-string"><span class="hljs-string">'(.*), (.*), (.*)'</span></span>, adress).group(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: adress_street = re.match(<span class="hljs-string"><span class="hljs-string">'(.*), (.*)'</span></span>, adress).group(<span class="hljs-number"><span class="hljs-number">1</span></span>) adress_house = re.match(<span class="hljs-string"><span class="hljs-string">'(.*), (.*)'</span></span>, adress).group(<span class="hljs-number"><span class="hljs-number">2</span></span>) adress_building = <span class="hljs-string"><span class="hljs-string">''</span></span> totalvotes = len(re.findall(<span class="hljs-string"><span class="hljs-string">'apartment-id'</span></span>, results[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'table'</span></span>])) + len(re.findall(<span class="hljs-string"><span class="hljs-string">'apartment-id'</span></span>, results[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'und_table'</span></span>])) aye = results[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'total'</span></span>][<span class="hljs-string"><span class="hljs-string">'za'</span></span>] meetinghappened = bool(results[<span class="hljs-string"><span class="hljs-string">'result'</span></span>][<span class="hljs-string"><span class="hljs-string">'total'</span></span>][<span class="hljs-string"><span class="hljs-string">'protocol_res'</span></span>]) iddlist = [] iddlist.append(idd) check = cur.execute(<span class="hljs-string"><span class="hljs-string">'SELECT * FROM houses WHERE id=?'</span></span>, iddlist) res = check.fetchone() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> res: print(<span class="hljs-string"><span class="hljs-string">'already exists'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: insert = cur.execute(<span class="hljs-string"><span class="hljs-string">'INSERT INTO houses (id, street, house_nbr, house_additional, total_votes, total_za, meeting) values (?, ?, ?, ?, ?, ?, ?)'</span></span>, [idd, adress_street, adress_house, adress_building, totalvotes, aye, meetinghappened]) print(<span class="hljs-string"><span class="hljs-string">'added '</span></span> + str(idd)) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: print(<span class="hljs-string"><span class="hljs-string">'no data for id '</span></span>+ str(idd)) jsonerror.append(idd) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(<span class="hljs-string"><span class="hljs-string">'unknown eggog'</span></span>) unknownerror.append(idd) jsonerror = [] unknownerror = [] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/home/deb/mosres.txt'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fc: mosres = fc.read().splitlines() conn = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">'/home/deb/renovation.db'</span></span>) cur = conn.cursor() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> house <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mosres: gethouseinfo(house) conn.commit() conn.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> jsonerror: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/home/deb/jsonerror.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jsonerror: f.write(<span class="hljs-string"><span class="hljs-string">'{}\n'</span></span>.format(item)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> unknownerror: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/home/deb/unknownerror.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> unknownerror: f.write(<span class="hljs-string"><span class="hljs-string">'{}\n'</span></span>.format(item))</code> </pre> <br>  So this is something.  Now we have a database for voting for renovation, created on the basis of public information on the website of the City Hall.  You can already delve into and (finally!) Draw graphics! <br><br>  All results (sorted from small to great, to clearly see the percentage of pros and cons, X - at home, games - interest for, green line - for convenience, cuts 66 percent, which had to be overcome): <br><br><img src="http://i.imgur.com/rtdJ1eT.png"><br><br>  Distribution of votes "for": <br><br><img src="http://i.imgur.com/ICFyuE5.png"><br><br>  All this is good, but we are interested in the turnout.  And here it becomes hard.  The fact is that there is no normal, simple, centralized resource with the number of apartments.  Perhaps, 2GIS has it, at least in the examples of paid unloading of information, the number of apartments is there, but - is it charged?  This is not our method!  We will go another way. <br><br>  The merciless googling and Yandex pointed to the site <a href="http://tvoyadres.ru/doma/">tvoyadres.ru/doma</a> , where it would seem there are houses, often with information about an apartment.  But how to collect them?  Ideally, you must first collect the entire list of houses (well, at least streets) for which there is data, and then try to link the addresses in our database, taken in the format of the city hall, with the addresses in the format of this site, and then pull them out that managed to tie up the apartment.  Should I start with the streets?  <a href="http://tvoyadres.ru/ulitsy/">tvoyadres.ru/ulitsy</a> - but sorting 200 pages, scraping and processing each issue, is very dreary.  Perhaps, it will be possible to find here any api? <br><br>  Success waited on the page of the city, where there is not only a list of streets, but also the ‚ÄúMore streets‚Äù button: <a href="http://tvoyadres.ru/moskovskaya-oblast/goroda/551/">tvoyadres.ru/moskovskaya-oblast/goroda/551</a> <br><br><img src="http://i.imgur.com/2cbqsFa.png"><br><br>  Aha  Request View <br> <code>http://tvoyadres.ru/js/street.php?region=81&amp;city=&amp;count=2073&amp;_=1499809159225</code> <br>  gives us a list of streets with links to them (and in the links is an ID).  Great, it remains to understand what the characters in the query mean.  The region, obviously, we will not touch, the city, too.  Let's try to remove the last incomprehensible, leaving only <a href="http://tvoyadres.ru/js/street.php%3Fregion%3D81%26city%3D%25D0%259C%25D0%25BE%25D1%2581%25D0%25BA%25D0%25B2%25D0%25B0%26count%3D2073">tvoyadres.ru/js/street.php?region=81&amp;city=Moscow&amp;count=2073</a> - the result is the same.  OK, press the button again - we will see that the same request was sent, but with a count of 100 less.  Let's play manually with this parameter. <br><br>  0 - an error is returned.  1 - returns one street.  2 - two streets return, and we have already seen one.  100 - returns 100 streets.  200 - returns another 100 streets.  We started with 2073 - try 2173?  Yes, these are the very first hundred streets that were displayed on the page of the city.  2174? <br><br><blockquote>  Critical error <br><br>  You have an error in your SQL syntax;  check the syntax for the use of mySQL server. </blockquote><br>  Op-pa.  Well, it seems, count goes to the <a href="http://www.mysqltutorial.org/mysql-limit.aspx">LIMIT</a> SELECT query, and the limit is always given 100 lines, but the line to start with is calculated as count minus 2173. By the way, it‚Äôs rather secular, I didn‚Äôt invent the sql injection here, it is not transmitted, but calculated, and if it‚Äôs not a number to put in there, it will be trivial.  Anyway.  The result is.  Great, now to the point. <br><br>  Everything is even easier than usual: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getstreets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> r = requests.get(url + str(num)) results = r.json() result = results[<span class="hljs-string"><span class="hljs-string">'string'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(result) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2272</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>): totalres += getstreets(i)</code> </pre><br><br>  and write the result.  The result will look like a heap of html-code.  In general, already here it would be possible to move on to something better than regular expressions, but since  The task is very simple - after all, we‚Äôll pull out the streets with IDs by them, and then we make a dictation with the key - the name of the street. <br><br><pre> <code class="python hljs">sids = re.findall(<span class="hljs-string"><span class="hljs-string">'ulitsy\/(.*?)"&gt;(.*?)&lt;\/a&gt;'</span></span>, totalres) <span class="hljs-comment"><span class="hljs-comment">#sids = streets with ids streetsdict = {} for i in range(len(sids)): key = sids[i][1] value = sids[i][0] streetsdict[key] = value</span></span></code> </pre> <br>  But then we have to get home from the pages of the streets, in other words - to work on a bunch of html heaps.  Such a bunch of regular expressions to try otparsit - more expensive.  Therefore, let's get acquainted with <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a> . <br><br>  We make a function, we start it for a separate dict, where the keys will already be an Aidish, and the values ‚Äã‚Äãwill be apartments.  The logic is as follows: by the name of the apartment it will be possible to get an idi, by idi - apartments. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gethouses</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> r = requests.get(<span class="hljs-string"><span class="hljs-string">'http://tvoyadres.ru/moskovskaya-oblast/moskva/ulitsy/'</span></span> + str(num) + <span class="hljs-string"><span class="hljs-string">'/'</span></span>) results = r.text soup = BeautifulSoup(results, <span class="hljs-string"><span class="hljs-string">'html.parser'</span></span>) ul = soup.find(<span class="hljs-string"><span class="hljs-string">"ul"</span></span>, {<span class="hljs-string"><span class="hljs-string">"class"</span></span>: <span class="hljs-string"><span class="hljs-string">"next"</span></span>}) houses = [] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> li <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ul.find_all(<span class="hljs-string"><span class="hljs-string">"li"</span></span>): urly = li.a[<span class="hljs-string"><span class="hljs-string">'href'</span></span>] urly = re.search(<span class="hljs-string"><span class="hljs-string">'doma\/(.*)\/'</span></span>, urly).group(<span class="hljs-number"><span class="hljs-number">1</span></span>) houses.append([li.get_text(), urly]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(houses) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(<span class="hljs-string"><span class="hljs-string">'None'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-string"><span class="hljs-string">'None'</span></span>) totalyres = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sids: num = sids[key] totalyres[num] = gethouses(num)</code> </pre><br>  Here we have two things that come to mind.  The first one is to make not a dictation, in which each street has a list, in which each value is a list with the name of the house and its ID, but a dictation with nested dictations.  This can be turned into a simple loop, we will not focus, but let's call this dictation totre - yes, in the end the fantasy completely left me.  Excuse me. <br><br>  The second - and after all, the Yurl of each house includes not only an IDU, but also a street transliteration!  <a href="http://tvoyadres.ru/moskovskaya-oblast/moskva/yahromskaya/doma/588211/">An example</a> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> totre: urlo = <span class="hljs-string"><span class="hljs-string">'http://tvoyadres.ru/moskovskaya-oblast/moskva/ulitsy/'</span></span> + key + <span class="hljs-string"><span class="hljs-string">'/'</span></span> ra = requests.get(urlo) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: streetname = re.search(<span class="hljs-string"><span class="hljs-string">'&lt;ul class="next"&gt;&lt;li&gt;&lt;a href="\/moskovskaya-oblast\/moskva\/(.+?)\/doma\/'</span></span>, ra.text).group(<span class="hljs-number"><span class="hljs-number">1</span></span>) totre[key][<span class="hljs-string"><span class="hljs-string">'streetname'</span></span>] = streetname <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(key)</code> </pre> <br>  And here we come to almost the most difficult.  We need those street names that we have in the database from the mayor's office, to associate with aydishnikami, using those street names that are from your address box.  <a href="https://docs.python.org/3/library/difflib.html">Difflib</a> will help us in this, since it is built into the python.  But it‚Äôs not enough to hope for difflib, it will be necessary to make a check by the user, because frequency and similarity are, of course, good, but we need to avoid stupid mistakes.  In general, we look at the formats, we notice that somewhere there are no letters as a class, somewhere the word ‚Äústreet‚Äù is removed from the street name, and we do this: <br><br><pre> <code class="python hljs">conn = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">'renovation.db'</span></span>) cur = conn.cursor() streets = cur.execute(<span class="hljs-string"><span class="hljs-string">'SELECT DISTINCT street FROM houses order by street asc'</span></span>) streeets = streets.fetchall() conn.close() exactmatches = {} keyslist = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sids.keys(): keyslist.append(key) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">glue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(maxres=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">, freq=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> each <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> streeets: eachnoyo = each[<span class="hljs-number"><span class="hljs-number">0</span></span>].replace(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) diffres = difflib.get_close_matches(eachnoyo, keyslist, maxres, freq) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> each[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> exactmatches.keys(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(diffres) == <span class="hljs-number"><span class="hljs-number">1</span></span>: print(each[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">': '</span></span> + diffres[<span class="hljs-number"><span class="hljs-number">0</span></span>]) notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> notcompleted == <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: inp = input(<span class="hljs-string"><span class="hljs-string">'Correct? y/n '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> inp == <span class="hljs-string"><span class="hljs-string">'y'</span></span>: notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> exactmatches[each[<span class="hljs-number"><span class="hljs-number">0</span></span>]] = sids[diffres[<span class="hljs-number"><span class="hljs-number">0</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> inp == <span class="hljs-string"><span class="hljs-string">'n'</span></span>: notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Incorrect input, try again'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(diffres) == <span class="hljs-number"><span class="hljs-number">0</span></span>: print(<span class="hljs-string"><span class="hljs-string">'No matches for '</span></span> + each[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(diffres) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: print(each[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">': '</span></span> + str(diffres)) notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> notcompleted == <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: inp = input(<span class="hljs-string"><span class="hljs-string">'List number? Or n '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: listnum = int(inp) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: listnum = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> inp == <span class="hljs-string"><span class="hljs-string">'n'</span></span>: notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> listnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, len(diffres)): notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> exactmatches[each[<span class="hljs-number"><span class="hljs-number">0</span></span>]] = sids[diffres[<span class="hljs-number"><span class="hljs-number">0</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Incorrect input, try again'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'exactmatches.json'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: json.dump(exactmatches, f, ensure_ascii=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre> <br>  We sit in the console, look at the issue, press the buttons.  When the whole cycle has passed, we start the function with more gentle parameters, for example, glue (10, freq = 0.4). <br><br><img src="http://i.imgur.com/FERGP0l.png"><br><br>  I had enough patience for 506 streets from 700 kopecks - in my opinion, an excellent result, and most importantly, statistically significant (most likely). <br><br>  And now you need to do the same for houses, and also take, in fact, their number of apartments.  And put in the database. <br><br><pre> <code class="python hljs">conn = sqlite3.connect(<span class="hljs-string"><span class="hljs-string">'renovation.db'</span></span>) cur = conn.cursor() allhouses = cur.execute(<span class="hljs-string"><span class="hljs-string">'SELECT * FROM houses WHERE flats IS NULL ORDER BY id'</span></span>) allhousesres = allhouses.fetchall() url2 = <span class="hljs-string"><span class="hljs-string">'http://tvoyadres.ru/moskovskaya-oblast/moskva/'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getnumberofflats</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(streetname, houseid)</span></span></span><span class="hljs-function">:</span></span> urlo = url2 + str(streetname) + <span class="hljs-string"><span class="hljs-string">'/doma/'</span></span> + str(houseid) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> r = requests.get(urlo) results = r.text numbe = re.search(<span class="hljs-string"><span class="hljs-string">'&lt;span class="left"&gt; &lt;\/span&gt; &lt;span class="right"&gt;(\d*)&lt;'</span></span>, results).group(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numbe <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gluehousesnumbers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(freq=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ratio=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> house <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> allhousesres: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> house[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> exactmatches.keys(): housenbr = house[<span class="hljs-number"><span class="hljs-number">2</span></span>].replace(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> house[<span class="hljs-number"><span class="hljs-number">3</span></span>]: housenbr = housenbr + <span class="hljs-string"><span class="hljs-string">' '</span></span> + house[<span class="hljs-number"><span class="hljs-number">3</span></span>] housenbr = housenbr.lower() diffres = difflib.get_close_matches(housenbr, totre[exactmatches[house[<span class="hljs-number"><span class="hljs-number">1</span></span>]]].keys(), freq, ratio) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(diffres) == <span class="hljs-number"><span class="hljs-number">1</span></span>: print(housenbr + <span class="hljs-string"><span class="hljs-string">': '</span></span> + diffres[<span class="hljs-number"><span class="hljs-number">0</span></span>]) notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> notcompleted == <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: inp = input(<span class="hljs-string"><span class="hljs-string">'Correct? y/n '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> inp == <span class="hljs-string"><span class="hljs-string">'y'</span></span>: notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: flatsnumber = getnumberofflats(totre[exactmatches[house[<span class="hljs-number"><span class="hljs-number">1</span></span>]]][<span class="hljs-string"><span class="hljs-string">'streetname'</span></span>], totre[exactmatches[house[<span class="hljs-number"><span class="hljs-number">1</span></span>]]][diffres[<span class="hljs-number"><span class="hljs-number">0</span></span>]]) insertion = cur.execute(<span class="hljs-string"><span class="hljs-string">'UPDATE houses SET flats = ? WHERE id = ?'</span></span>, [flatsnumber, house[<span class="hljs-number"><span class="hljs-number">0</span></span>]]) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(<span class="hljs-string"><span class="hljs-string">'weird, no flat number for '</span></span> + str(house)) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> inp == <span class="hljs-string"><span class="hljs-string">'n'</span></span>: notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Incorrect input, try again'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(diffres) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: print(housenbr + <span class="hljs-string"><span class="hljs-string">': '</span></span> + str(diffres)) notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> notcompleted == <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>: inp = input(<span class="hljs-string"><span class="hljs-string">'List number? Or n '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: listnum = int(inp) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: listnum = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> inp == <span class="hljs-string"><span class="hljs-string">'n'</span></span>: notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> listnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, len(diffres)): notcompleted = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: flatsnumber = getnumberofflats(totre[exactmatches[house[<span class="hljs-number"><span class="hljs-number">1</span></span>]]][<span class="hljs-string"><span class="hljs-string">'streetname'</span></span>], totre[exactmatches[house[<span class="hljs-number"><span class="hljs-number">1</span></span>]]][diffres[<span class="hljs-number"><span class="hljs-number">0</span></span>]]) insertion = cur.execute(<span class="hljs-string"><span class="hljs-string">'UPDATE houses SET flats = ? WHERE id = ?'</span></span>, [flatsnumber, house[<span class="hljs-number"><span class="hljs-number">0</span></span>]]) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(<span class="hljs-string"><span class="hljs-string">'weird, no flat number for '</span></span> + str(house)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Incorrect input, try again'</span></span>) conn.commit() conn.close()</code> </pre><br>  We continue to have fun.  The main thing - do not forget to commit changes after each run of the function.  I did not add the connection and commit to the functions themselves, so as not to constantly pull at the database. <br><br>  Yes, it is quite tiring.  But, again, if you give everything at the mercy of Difflib - there will be foolish errors, as in the screenshot, where he finds ‚Äú35b‚Äù closer to ‚Äú35‚Äù than to ‚Äú35 'b'‚Äù.  This, of course, is not a difflib error, but, to be honest, I would spend more time on the perfect query, and then I would stumble somewhere.  Best with user verification, more confident. <br><br><img src="http://i.imgur.com/o9z5B0Q.png"><br><br>  Total: the number of apartments there are for 3592 of approximately 4500 houses!  Excellent result (you can't praise yourself - nobody will praise).  But, of course, if you confirm so many matches, there will be errors. <br><br><img src="http://i.imgur.com/rbdYc7q.png"><br><br>  Let's take 43 apartments, in which more apartments have voted, than the apartments, it seems, have everything.  It is clear that there either I made a mistake when confirming matches, or there were obviously incorrect data. <br><br>  Well, with the rest you can already have fun.  Turnout is obviously counted as the number of voters, divided by the number of apartments.  Graphs are also drawn obviously, the only thing is, for each point of turnout data there is no sense in drawing a graph, since  it will be similar to the shaded paper, it is better to round the turnout data and take the average data on the results for this data point. <br><br>  Round up to the nearest integer: <br><br><img src="http://i.imgur.com/RFmtD0U.png"><br><br>  Round up to the nearest multiple of five: <br><br><img src="http://i.imgur.com/mUVV3ik.png"><br><br>  In general, with the exception of a pair of anti-peaks in the area of ‚Äã‚Äã80% turnout, or, if you look at rounding thinner, in areas of 30%, 40% and 80%, in general, turnout did not affect the result.  Is that a 100% turnout in an amazing way always gave a 100% result.  And the average turnout was 58.7%. <br><br>  Was it worth it?  For me, yes, I learned a lot of new things.  And for the reader?  Well, I post to the reader the <a href="http://rgho.st/6GsLxcgdH">database itself</a> . <br><br>  Maybe you can do something more interesting with this data. </div><p>Source: <a href="https://habr.com/ru/post/333540/">https://habr.com/ru/post/333540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333524/index.html">Skyeng API contest - first participants</a></li>
<li><a href="../333526/index.html">SDN with Red Hat OpenStack Platform: OpenDaylight Integration</a></li>
<li><a href="../333528/index.html">How thousands of Eve Online players help decipher the human body</a></li>
<li><a href="../333530/index.html">Cross-platform IoT: Using the Azure CLI and Azure IoT Hub</a></li>
<li><a href="../333532/index.html">Remove "4D video" using a depth-sensor and Delaunay triangulation</a></li>
<li><a href="../333544/index.html">How To Make Progressive Web Apps: A Beginner's Guide</a></li>
<li><a href="../333546/index.html">Translation of the Appium Essentials book. Chapter 6</a></li>
<li><a href="../333548/index.html">Testing the Mobile Delphi Application Database</a></li>
<li><a href="../333552/index.html">You don't know a damn thing in colors</a></li>
<li><a href="../333554/index.html">QML: how easy it is to get T-shirts in machine learning competitions for mail.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>