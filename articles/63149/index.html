<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Displaying pictures in ASP .NET MVC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Technologies: .NET Framework 3.5, ASP .NET MVC 
 Languages: Visual Basic .NET, C # 

 Quite often, when developing web applications, it is required to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Displaying pictures in ASP .NET MVC</h1><div class="post__text post__text-html js-mediator-article">  <b>Technologies:</b> .NET Framework 3.5, ASP .NET MVC <br>  <b>Languages:</b> Visual Basic .NET, C # <br><br>  Quite often, when developing web applications, it is required to give the user data in a format other than html.  For example, display a reduced copy of the image (ThumbImage), or issue protected data from the database.  In ASP .NET WebForms, you can use Handlers (handlers) or regular ASPX pages for this purpose.  In ASP .NET MVC, the situation has changed a bit.  Although of course, as before, nothing is forbidden to use handlers.  Unless, you may need a rule for <b>Routing</b> , such as: <i>routes.IgnoreRoute ("{resource} .ashx")</i> . <br>  In this review, we will consider an example of displaying images using ASP .NET MVC, however, the described approach can be used to output data of absolutely any format. <br><a name="habracut"></a><br><br><h4>  ActionResult </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As it is known (I hope that it is known), the result of the execution of any action (action) of the controller (controller) is an ActionResult.  <b>ActionResult</b> is a base class from which all classes inherit, ultimately forming content to be rendered to the client.  For example: ViewResult, JsonResult, ContentResult, RedirectResult, etc.  By itself, the ActionResult class cannot be used, it can only be inherited from it, and due to this, the list of results of controller actions is limited only by the imagination of developers. <br>  The formation of data for output occurs in the <b>ExecuteResult</b> method. <br><br><h4>  ImageResult </h4><br><br>  Actually, in order for the controller to provide the client with an image, you need to write your class inherited from ActionResult.  Logically, its name should be ImageResult, but this is up to you. <br><br>  <b>VB .NET:</b> <br> <code><font color="blue">Public Class</font> ImageResult <br> <font color="blue">Inherits</font> ActionResult <br> <font color="blue">End Class</font></code> <br> <br>  <b>C #:</b> <br> <code><font color="blue">public class</font> ImageResult: ActionResult <br> { } <br></code> <br><br>  As I said, the content is formed in the ExecuteResult method, however, before you do this, you need to get the source material.  In other words, transfer to the class the information on the basis of which the final data will be formed.  In the case of images, it will most universally transmit to the class Stream.  You will also need to transmit information about the type of content (Content-Type), so that search engines do not get scared, and browsers do not guess the coffee grounds and, as a result, do not hurt the user's psyche.  To do this, you will have to write a couple of relevant properties, and to complete the picture, prescribe a constructor. <br><br>  <b>VB .NET:</b> <br> <code><font color="blue">Private</font> _ImageStream <font color="blue">As</font> Stream <br> <font color="blue">Private</font> _ContentType <font color="blue">As String</font> = "" <br> <br> <font color="blue">Public Property</font> ImageStream() <font color="blue">As</font> Stream <br> <font color="blue">Get</font> <br> <font color="blue">Return</font> _ImageStream <br> <font color="blue">End Get</font> <br> <font color="blue">Set</font> ( <font color="blue">ByVal</font> value <font color="blue">As</font> Stream) <br> _ImageStream = value <br> <font color="blue">End Set</font> <br> <font color="blue">End Property</font> <br> <br> <font color="blue">Public Property</font> ContentType() <font color="blue">As String</font> <br> <font color="blue">Get</font> <br> <font color="blue">Return</font> _ContentType <br> <font color="blue">End Get</font> <br> <font color="blue">Set</font> ( <font color="blue">ByVal</font> value <font color="blue">As String</font> ) <br> _ContentType = value <br> <font color="blue">End Set</font> <br> <font color="blue">End Property</font> <br> <br> <font color="blue">Public Sub</font> New( <font color="blue">ByVal</font> imageStream <font color="blue">As</font> Stream, <font color="blue">ByVal</font> contentType <font color="blue">As String</font> ) <br> <font color="blue">If</font> imageStream <font color="blue">Is Nothing Then Throw New</font> ArgumentNullException("imageStream") <br> <font color="blue">If String</font> .IsNullOrEmpty(contentType) <font color="blue">Then Throw New</font> ArgumentNullException("contentType") <br> _ImageStream = imageStream <br> _ContentType = contentType <br> <font color="blue">End Sub</font></code> <br> <br>  <b>C #:</b> <br> <code><font color="blue">private static</font> Stream _ImageStream; <br> <font color="blue">private static string</font> _ContentType = ""; <br> <br> <font color="blue">public static</font> Stream ImageStream <br> { <br> <font color="blue">get</font> { <font color="blue">return</font> _ImageStream; } <br> <font color="blue">set</font> { _ImageStream = value; } <br> } <br> <br> <font color="blue">public static string</font> ContentType <br> { <br> get { <font color="blue">return</font> _ContentType; } <br> set { _ContentType = value; } <br> } <br> <br> <font color="blue">public</font> ImageResult(Stream imageStream, <font color="blue">string</font> contentType) <br> { <br> <font color="blue">if</font> (imageStream == null) <font color="blue">throw new</font> ArgumentNullException("imageStream"); <br> <font color="blue">if</font> ( <font color="blue">String</font> .IsNullOrEmpty(contentType)) <font color="blue">throw new</font> ArgumentNullException("contentType"); <br> _ImageStream = imageStream; <br> _ContentType = contentType; <br> }</code> <br> <br>  To complete this, you need to write code for the ExecuteResult method, which will display an image based on the data received. <br><br>  <b>VB .NET:</b> <br> <code><font color="blue">Public Overrides Sub</font> ExecuteResult( <font color="blue">ByVal</font> context <font color="blue">As</font> System.Web.Mvc.ControllerContext) <br> <font color="blue">If</font> context <font color="blue">Is Nothing Then Throw New</font> ArgumentNullException("context") <br> <font color="blue">Dim</font> Response <font color="blue">As</font> HttpResponseBase = context.HttpContext.Response <br> Response.ContentType = _ContentType <br> <font color="blue">Dim</font> buffer(1024) <font color="blue">As Byte</font> <br> <font color="blue">Do</font> <br> <font color="blue">Dim</font> read <font color="blue">As Integer</font> = _ImageStream.Read(buffer, 0, buffer.Length) <br> <font color="blue">If</font> read = 0 <font color="blue">Then Exit Do</font> <br> Response.OutputStream.Write(buffer, 0, read) <br> <font color="blue">Loop</font> <br> Response.End() <br> <font color="blue">End Sub</font></code> <br> <br>  <b>C #:</b> <br> <code><font color="blue">public static override</font> void ExecuteResult(System.Web.Mvc.ControllerContext context) <br> { <br> <font color="blue">if</font> (context == null) <font color="blue">throw new</font> ArgumentNullException("context"); <br> HttpResponseBase Response = context.HttpContext().Response; <br> Response.ContentType = _ContentType; <br> <font color="blue">byte</font> [] buffer = <font color="blue">new byte</font> [1024]; <br> <font color="blue">do</font> <br> { <br> <font color="blue">int</font> read = _ImageStream.Read(buffer, 0, buffer.Length); <br> <font color="blue">if</font> (read == 0) { <font color="blue">break</font> ; } <br> Response.OutputStream.Write(buffer, 0, read); <br> } <font color="blue">while</font> ( <font color="blue">true</font> ); <br> Response.End(); <br> }</code> <br> <br>  Now the result of the action of any controller can be ImageResult. <br><br>  <b>VB .NET:</b> <br> <code><font color="blue">Return New</font> ImageResult(System.IO.File.OpenRead("C:\kbyte.ru.gif"), "image/gif")</code> <br> <br>  <b>C #:</b> <br> <code><font color="blue">return new</font> ImageResult(System.IO.File.OpenRead("C:\\kbyte.ru.gif"), "image/gif");</code> <br> <br><h4>  Extension </h4><br><br>  For complete happiness, you can write an extension for System.Web.Mvc.Controller.  For this, you can create a regular module, and a static class with a name, for example, <b>ControllerExtensions</b> , and write some convenient functions in it that will return ImageResult. <br><br>  <i><b>Note.</b></i>  Remember to import the <b>System.Runtime.CompilerServices namespace</b> . <br><br>  <b>VB .NET:</b> <br> <code><font color="blue">Public Module</font> ControllerExtensions <br> <br> &lt;Extension()&gt; _ <br> <font color="blue">Public Function</font> Image( <font color="blue">ByVal</font> controller <font color="blue">As</font> System.Web.Mvc.Controller, <font color="blue">ByVal</font> imageStream <font color="blue">As</font> Stream, <font color="blue">ByVal</font> contentType <font color="blue">As String</font> ) <font color="blue">As</font> ImageResult <br> Return New ImageResult(imageStream, contentType) <br> End Function <br> <br> &lt;Extension()&gt; _ <br> <font color="blue">Public Function</font> Image( <font color="blue">ByVal</font> controller <font color="blue">As</font> System.Web.Mvc.Controller, <font color="blue">ByVal</font> imageBytes() <font color="blue">As Byte</font> , <font color="blue">ByVal</font> contentType <font color="blue">As String</font> ) <font color="blue">As</font> ImageResult <br> <font color="blue">Return New</font> ImageResult( <font color="blue">New</font> MemoryStream(imageBytes), contentType) <br> <font color="blue">End Function</font> <br> <br> &lt;Extension()&gt; _ <br> <font color="blue">Public Function</font> Image( <font color="blue">ByVal</font> controller <font color="blue">As</font> System.Web.Mvc.Controller, <font color="blue">ByVal</font> fileName <font color="blue">As String</font> , <font color="blue">ByVal</font> contentType <font color="blue">As String</font> ) <font color="blue">As</font> ImageResult <br> <font color="blue">Return New</font> ImageResult(System.IO.File.OpenRead("C:\kbyte.ru.gif"), contentType) <br> <font color="blue">End Function</font> <br> <br> <font color="blue">End Module</font></code> <br> <br>  <b>C #:</b> <br> <code><font color="blue">public static class</font> ControllerExtensions <br> { <br> <br> [Extension()] <br> <font color="blue">public static</font> ImageResult Image(System.Web.Mvc.Controller controller, Stream imageStream, <font color="blue">string</font> contentType) <br> { <br> <font color="blue">return new</font> ImageResult(imageStream, contentType); <br> } <br> <br> [Extension()] <br> <font color="blue">public static</font> ImageResult Image(System.Web.Mvc.Controller controller, <font color="blue">byte</font> [] imageBytes, <font color="blue">string</font> contentType) <br> { <br> return new ImageResult( <font color="blue">new</font> MemoryStream(imageBytes), contentType); <br> } <br> <br> [Extension()] <br> <font color="blue">public static</font> ImageResult Image(System.Web.Mvc.Controller controller, <font color="blue">string</font> fileName, <font color="blue">string</font> contentType) <br> { <br> <font color="blue">return new</font> ImageResult(System.IO.File.OpenRead("C:\\kbyte.ru.gif"), contentType); <br> } <br> <br> }</code> <br> <br>  Now in the controllers you can use the prescribed functions, for example: <br><br>  <b>VB .NET:</b> <br> <code><font color="blue">Return</font> Image(System.IO.File.OpenRead("C:\kbyte.ru.gif"), "image/gif")</code> <br> <br>  <b>C #:</b> <br> <code><font color="blue">return</font> Image(System.IO.File.OpenRead("C:\\kbyte.ru.gif"), "image/gif");</code> <br> <br><h4>  Afterword </h4><br><br>  Inheriting from the ActionResult class, you can display data of absolutely any format.  What code functionality will be registered in the ExecuteResult method depends entirely on your imagination.  As for images, if you will display images from files, I would recommend pre-reading them (making a copy, for example, into an array of bytes), so as not to accidentally lock files if you later need to perform any manipulations on them (above files) (move, delete). <br><br>  - <br>  <i>Nemiro Alexey,</i> <i><br></i>  <i>06/29/2009</i> </div><p>Source: <a href="https://habr.com/ru/post/63149/">https://habr.com/ru/post/63149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../63142/index.html">Spam spam</a></li>
<li><a href="../63143/index.html">Universal Audio UAD-2 SOLO / Laptop for Laptop</a></li>
<li><a href="../63145/index.html">Caching selectors for jQuery. Plugin</a></li>
<li><a href="../63146/index.html">Your company (do not) need sociality</a></li>
<li><a href="../63148/index.html">Making mistakes</a></li>
<li><a href="../63150/index.html">The first photo of recording information in the brain</a></li>
<li><a href="../63151/index.html">COWORKING in Moscow for 1 month for free! from July 1</a></li>
<li><a href="../63153/index.html">Lenovo IdeaPad S12 Version with VIA Nano Processor</a></li>
<li><a href="../63154/index.html">Three types of Internet users</a></li>
<li><a href="../63155/index.html">RU-BOARD.COM - forgot to extend the domain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>