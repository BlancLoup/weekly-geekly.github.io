<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>People against PVS-Studio: First Double</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening! 

 Inspired by this post and the Habrasoobshchestvom, I offer you my own version of the analysis of a well-developed utility (as Wo1f pu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>People against PVS-Studio: First Double</h1><div class="post__text post__text-html js-mediator-article">  Good evening! <br><br>  Inspired by <a href="http://habrahabr.ru/blogs/code_review/128534/">this post</a> and the Habrasoobshchestvom, I offer you my own version of the analysis of a well-developed utility (as <a href="https://habrahabr.ru/users/wo1f/" class="user_link">Wo1f</a> put it <a href="https://habrahabr.ru/users/wo1f/" class="user_link">mildly</a> ) - PVS-Studio. <br><br>  As a note, I used Visual Studio 2010 (cracked, of course) and downloaded PVS-Studio <a href="http://www.viva64.com/en/pvs-studio/">from the official site</a> by clicking ‚ÄúDownload and Try‚Äù and following the instructions.  I am writing all this because I have questions about this utility and I need your help, so to speak. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, we run tests from the previous article, and so: <br><br><h6>  Test 1: </h6><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; v; v.reserve(<span class="hljs-number"><span class="hljs-number">2</span></span>); assert(v.capacity() == <span class="hljs-number"><span class="hljs-number">2</span></span>); v[<span class="hljs-number"><span class="hljs-number">0</span></span>]; v[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>; v[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; v[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; v.reserve(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; v[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  <i>VS2010</i> : <font color="red">nothing</font> <br>  <i>PVS-Studio</i> : <font color="red">nothing</font> <br><a name="habracut"></a><br><h6>  Test 2: </h6><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prettyFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%4d"</span></span>, i); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; v; v.reserve(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">//.... char buf[5]; prettyFormat(10, buf); return 0; }</span></span></code> </pre><br>  <i>VS2010</i> : <font color="green">warning C4996: 'sprintf': This function or variable may be unsafe.</font>  <font color="green">Consider using sprintf_s instead.</font> <br>  <i>PVS-Studio</i> : <font color="red">nothing</font> <br><br><h6>  Test 3: </h6><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prettyFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%4d"</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* a; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ...</code> </pre><br>  <i>VS2010</i> : <font color="green">warning C4996: 'sprintf': This function or variable may be unsafe.</font>  <font color="green">Consider using sprintf_s instead.</font> <font color="green"><br></font>  <font color="green">warning C4700: uninitialized local variable 'a' used</font> <font color="green"><br></font> <br>  <i>PVS-Studio</i> : <font color="red">nothing</font> <br><br><h6>  Test 4: </h6><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prettyFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%4d"</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* a; fopen(<span class="hljs-string"><span class="hljs-string">"filename"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf2[<span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span>(buf2, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; }</code> </pre><br>  <i>VS2010</i> : In addition to the previous two, <font color="green">warning C4996: 'fopen': This function or variable may be unsafe.</font>  <font color="green">Consider using fopen_s instead.</font> <font color="green"><br></font>  <font color="green">warning C4996: 'strcpy': This function or variable may be unsafe.</font>  <font color="green">Consider using strcpy_s instead.</font> <font color="green"><br></font> <br>  <i>PVS-Studio</i> : <font color="red">nothing</font> <br><br>  My question is here: why PVS-Studio does not give out anything, I have all three levels of "issue" turned on.  Maybe I'm doing something wrong?  (I select PVS-Studio -&gt; Check Solution from the menu), do not laugh if I am not able to ‚Äúuse‚Äù the utility. <br><br><h5>  New tests </h5><br>  And so, we continue.  The simplest example that came to mind: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">strncpy</span></span>(buf, data, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(data));</code> </pre><br>  PVS-Studio is again silent, and Visual Studio again warns of a possible problem when using the ‚Äúunsafe‚Äù function, in this case, strncpy (). <br>  What is the real problem?  The problem is the classic buffer overflow, an error that caused many to stop loving C / C ++, and the rest found a reason to oppose these beautiful languages.  In this example, the length of the input buffer is passed as the last argument to the strncpy function, not the size of the target buffer! <br><br>  The next test is of a more ‚Äúprofessional‚Äù level, with an emphasis on multithreading.  Code snippet: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt; a_list; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!a_list.empty()) { ret = a_list.front(); a_list.pop_front(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>  <i>VS2010</i> : <font color="red">nothing</font> <br>  <i>PVS-Studio</i> : <font color="red">nothing</font> <br><br>  At first glance, everything is fine, if you do not think that there may be a race.  She - <a href="http://ru.wikipedia.org/wiki/Race_condition">race (race condition)</a> - can occur when there are two programs running in different processes or threads.  These programs can interrupt each other, and in doing so, each changes the same resource.  In the example above, it is enough that one thread finishes checking for the presence of elements in the list before the other one retrieves the last element from the list by calling pop_front. <br><br>  Here, I think for the first take is enough, in the next take it is planned to run a real test, a big such application.  I want to note that, as <a href="https://habrahabr.ru/users/idemura/" class="user_link">idemura</a> noted, one should not rely on analyzers; rather, one just needs to increase his level of professionalism. <br><br>  PS For grammatical errors ... - wrote a post late. </div><p>Source: <a href="https://habr.com/ru/post/128607/">https://habr.com/ru/post/128607/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128597/index.html">Are you interested in the experience of habrayuzer about immigration and about life abroad?</a></li>
<li><a href="../128598/index.html">Chess @ home: create the largest chess AI</a></li>
<li><a href="../128599/index.html">How-to VPN (pptpd + mysql + radius) on CentOS6</a></li>
<li><a href="../128601/index.html">Useful tools, tutorials and resources</a></li>
<li><a href="../128606/index.html">No one likes flash</a></li>
<li><a href="../128609/index.html">Cloud GIT Hosting</a></li>
<li><a href="../128611/index.html">What cross-platform engine do you use for developing mobile games?</a></li>
<li><a href="../128612/index.html">Turkish modder created a wooden "laptop" from Sega Saturn</a></li>
<li><a href="../128613/index.html">Microsoft is negotiating the purchase of Yahoo again</a></li>
<li><a href="../128614/index.html">Future SMART Phones = antimagocchi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>