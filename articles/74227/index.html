<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ClearType-smoothing in Linux, or fonts as in Ubuntu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr. I recently saw a new Ubuntu and I became jealous that it has more beautiful fonts than in my Mandriva (GNOME). And I began to dig. I c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ClearType-smoothing in Linux, or fonts as in Ubuntu</h1><div class="post__text post__text-html js-mediator-article">  Good day, Habr.  I recently saw a new Ubuntu and I became jealous that it has more beautiful fonts than in my Mandriva (GNOME).  And I began to dig.  I copied and experimented for a long time, but in the end I achieved the desired result.  Now I want to tell you how I did it.  I did this by rebuilding the libraries that are responsible for rendering fonts, with support for <a href="http://ru.wikipedia.org/wiki/ClearType">ClearType-</a> smoothing.  I don‚Äôt know if it‚Äôs more beautiful than Ubuntu or not, but I like it.  So let's get started. <br><br><a name="habracut"></a><h4>  <b>Libraries</b> </h4><br>  For drawing fonts such libraries are used: <br>  <a href="http://ru.wikipedia.org/wiki/Cairo">Cairo</a> is a library designed for rendering vector graphics. <br>  <a href="http://ru.wikipedia.org/wiki/Xft">Xft</a> is a free library designed to use the Freetype rasterizer with the X-extension X Rendering Extension;  This is usually necessary for using FreeType fonts with the X Window System. <br>  <a href="http://ru.wikipedia.org/wiki/FreeType">FreeType</a> is a library that is used to rasterize fonts and operations on them. <br><br><h4>  <b>Library sources</b> </h4><br>  It was with the latest stable versions, today it is: <br>  <a href="">Cairo 1.8.8</a> <br>  <a href="">Xft 2.1.14</a> <br>  <a href="">FreeType 2.3.11</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>Basic patches</b> </h4><br>  For patches, many thanks to the Arch Linux user community, for whom I have found them all. <br>  Each patch does not do anything difficult, it just makes some changes to the source code of the libraries.  To use them, you need the patch package, which you will find in the repositories.  You can read about its use and its parameters and keys <a href="http://ru.gentoo-wiki.com/wiki/HOWTO_diff_and_patch">here</a> .  Codes of patches updated to work with new versions of libraries.  If you look at the code of any of them, you can do it all manually by adding and replacing the code in the source code. <br><br>  Cairo: <br>  <a href="">cairo-1.2.4-lcd-cleartype-like.diff</a> - ClearType font rendering.  Similar smoothing is applied in ubuntu (based on a comparison).  Let me remind you that this method is registered by Microsoft. <br><br>  Xft: <br>  <a href="http://aur.archlinux.org/packages/libxft-cleartype/libxft-cleartype/libXft-2.1.14-lcd-cleartype.patch">libXft-2.1.14-lcd-cleartype.patch</a> is the same as for cairo.  This influenced my fonts in Opera, Lotus Symphony. <br><br>  FreeType: <br>  <a href="http://aur.archlinux.org/packages/freetype2-cleartype/freetype2-cleartype/bytecode.patch">bytecode.patch -</a> includes font rendering, patented by Apple, so it is turned off initially.  This is optional, you can not include it. <br>  <a href="">freetype-2.2.1-subpixel-disable-quantization.diff</a> - the name speaks for itself, turns off quantization. <br>  <a href="http://aur.archlinux.org/packages/freetype2-cleartype/freetype2-cleartype/freetype-2.3.0-enable-spr.patch">freetype-2.3.0-enable-spr.patch</a> - enable subpixel rendering <br>  <a href="http://aur.archlinux.org/packages/freetype2-cleartype/freetype2-cleartype/freetype-2.2.1-enable-valid.patch">freetype-2.2.1-enable-valid.patch</a> <br>  <a href="http://aur.archlinux.org/packages/freetype2-cleartype/freetype2-cleartype/freetype-2.2.1-memcpy-fix.patch">freetype-2.2.1-memcpy-fix.patch</a> <br><br>  They still have Canonical smoothing patches - freetype2-ubuntu, libxft-ubuntu, cairo-ubuntu, but they didn't help me much, they did even worse.  Especially since they are not for new versions of libraries. <br><br><h4>  <b>Building libraries</b> </h4><br>  All the dependencies to compile install in the process, because I do not remember them all. <br>  For starters let's collect Cairo.  Go to the source folder cairo-1.8.8 /.  We throw a patch there (it was more convenient for me), and in the console we execute: <br> <code>$ patch -Np1 -i cairo-1.2.4-lcd-cleartype-like.diff <br> $ ./configure --prefix=/usr <br> $ make &amp;&amp; make install</code> <br>  Naturally, for the make install command, you will need root rights, so either do everything in the console from root or use sudo to make install. <br>  If we restart X, we will see a significant difference in font rendering. <br><br>  Further we collect Xft.  We pack in libXft-2.1.14 /: <br> <code>$ patch -Np1 -i libXft-2.1.14-lcd-cleartype.patch <br> $ ./configure --prefix=/usr <br> $ make &amp;&amp; make install</code> <br> <br>  Now FreeType.  If you want to use Apple's rendering, then apply bytecode.patch.  freetype-2.3.11 /: <br> <code>$ patch -Np0 -i bytecode.patch</code> <br>  And additional changes that can be applied without bytecode.  It is already necessary to look for yourself, whether it is better with them or not: <br> <code>$ patch -Np1 -i freetype-2.2.1-subpixel-disable-quantization.diff <br> $ patch -Np1 -i freetype-2.3.0-enable-spr.patch <br> $ patch -Np1 -i freetype-2.2.1-enable-valid.patch <br> $ patch -Np1 -i freetype-2.2.1-memcpy-fix.patch <br> $ ./configure --prefix=/usr <br> $ make &amp;&amp; make install</code> <br> <br>  After that, you can restart X's. <br><br><h4>  <b>the end</b> </h4><br>  I will give you my screenshots so that you can see the difference: <br>  All the fonts of applications, documents, headers and robotshey table in my default settings - Sans. <br>  This is how Firefox looked at me with ‚Äúintact‚Äù libraries: <br>  one. <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/126/edf/bf7/126edfbf7f48e92a9b105a267f993c9d.jpg"></a> <br><br>  Firefox patched by Cairo: <br>  Now it became like Ubuntu. <br>  Full (Hinting) fonts (in the GNOME font settings): <br>  2 <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9fd/70b/989/9fd70b98951c684b375539ef6884d987.jpg"></a> <br>  Weak (Slight) refinement (Hinting) of fonts, which in Ubuntu is always the default: <br>  3 <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/908/5f6/1dc/9085f61dc1a5a696b19b1f56390c7cae.jpg"></a> <br><br>  Opera patched Xft: <br>  Weak (Slight) refinement (Hinting) of fonts: <br>  four. <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3ab/442/872/3ab4428723d6ae9f20717b05db68946f.jpg"></a> <br><br>  Firefox, patched FreeType with bytecode.patch: <br>  Full (Hinting) fonts: <br>  five. <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ebf/c89/b04/ebfc89b04c659ad894c3ba6db930693d.jpg"></a> <br>  Weak (Slight) refinement (Hinting) of fonts: <br>  By the way, this also looks like in Ubuntu. <br>  6 <a href=""><img src="http://img511.imageshack.us/img511/6009/firefoxbytecodeslight.th.png"></a> <br><br>  Lastly, I recommend playing in the font settings in GNOME (or KDE), especially with dpi.  You can still experiment with their patches, and achieve the best result. <br>  I have it all.  Thanks to everyone, I hope someone came in handy. <br><br>  <b>UPDATE:</b> <br>  Upon request, I post a summary picture of all 6 above shown screenshots: <br><img src="https://habrastorage.org/getpro/habr/post_images/4ab/fb0/8bf/4abfb08bf0cb6edbf3fb5987258d4fba.png" alt="image"><br>  I note that in the GNOME fonts settings, I always had anti-aliasing "Subpixel (LCD) monitors" turned on. <br>  Also note that the screenshots show that in the Opera the fonts are slightly darker.  But this is because Opera uses Xft, while Firefox (and the entire dwarf) use cairo.  Hence the conclusion - there is a difference in the rendering of libxft-cleartype and cairo-cleartype. <br><br>  <b>still UPDATE:</b> <br>  I dug deeper in the source code of the patches.  Compare patch for Cairo and patch Xft.  I found very interesting and similar lines in them: <br>  In the Xft patch: <br> <code>+static const int fir_filter[5] = { 0x10, 0x40, 0x70, 0x40, 0x10 };</code> <br>  In the patch Cairo: <br> <code>+static const int fir_filter[5] = { 0x1C, 0x38, 0x55, 0x38, 0x1C };</code> <br>  From the comment for this line in Xft (/ * note: keep the filter symetric, or bad things will happen * /) I realized that it was like an array of sizes of some kind, frequencies or something like that.  Well, how can I know something?)) But by the name of the array, you might think that the algorithm of <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580_%25D1%2581_%25D0%25BA%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25B8%25D0%25BC%25D0%25BF%25D1%2583%25D0%25BB%25D1%258C%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B9_%25D1%2585%25D0%25B0%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25B5%25D1%2580%25D0%25B8%25D1%2581%25D1%2582%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25B9">this thing</a> was used there.  )) But still, how do I know?  For a long time I did not think, and installed the same hexadecimal numbers (size, frequency?) In the patch for Cairo in the array as in the patch for Xft, I reassembled.  And, oh, a miracle, I have everywhere now the same dark and distinct fonts as in Opera (Qt). <br>  Firefox, all libraries patched, Full (Hinting) fonts: <br>  7 <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/532/564/a02/532564a02477808961e8464b597f5d54.jpg"></a> <br><img src="https://habrastorage.org/getpro/habr/post_images/8d4/a3d/f46/8d4a3df46915e7deb99e10f69aee91fd.png" alt="image"><br>  Compare with the 5th screen. <br><br>  Firefox, patched only Cairo, weak (Slight) refinement (Hinting) of fonts: <br>  eight. <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ead/9d8/214/ead9d821487dc931a8e65ea636895b81.jpg"></a> <br><img src="http://img197.imageshack.us/img197/5601/result8.png" alt="image"><br>  Compare with the 3rd screen and the 4th screen, where Opera. <br><br>  Everything, now I am satisfied.  =) Here is a <a href="http://narod.ru/disk/14812367000/cairo-1.2.4-lcd-cleartype-like-darkfix.diff.html">modified patch for Cairo</a> </div><p>Source: <a href="https://habr.com/ru/post/74227/">https://habr.com/ru/post/74227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../74218/index.html">Request a habr-topic and you will be rewarded!</a></li>
<li><a href="../74219/index.html">Super Half-Life Bros</a></li>
<li><a href="../74220/index.html">Joi Ito on the impact of information exchange on everyday life</a></li>
<li><a href="../74222/index.html">Lego Mindstorms for the programmer</a></li>
<li><a href="../74226/index.html">NASA movie. Speed ‚Äã‚Äãlimit in space by Einstein</a></li>
<li><a href="../74232/index.html">Sad statistics or never rely on freelancers</a></li>
<li><a href="../74233/index.html">Polycom 320 and sipXecs - work via the Internet?</a></li>
<li><a href="../74236/index.html">Xperia X10 - official announcement</a></li>
<li><a href="../74239/index.html">Apple site vulnerability</a></li>
<li><a href="../74240/index.html">Meizu M8: take all the best from the iPhone, Android and WinMo and rethink</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>