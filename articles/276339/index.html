<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Taming of the Shrew</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you like to develop databases? No, not newfangled NoSQL, but good old relational ones, where you can describe relationships and stored procedures f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Taming of the Shrew</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/26c/8e0/16a/26c8e016a21e41efbed0bf98feec53b3.png"><br><br>  Do you like to develop databases?  No, not newfangled NoSQL, but good old relational ones, where you can describe relationships and stored procedures for data access and logic.  Maybe you are developing databases for PostgreSQL?  If yes, then great - this post is definitely for you. <br><a name="habracut"></a><br>  There is probably no point in describing the benefits of <a href="http://www.postgresql.org/">PostgreSQL</a> .  Let me just say in a nutshell that this is a modern, fast, richly capable DBMS that is fully capable of competing with commercial database management systems.  The fact that PostgreSQL is distributed under a <a href="http://www.postgresql.org/about/licence/">free license</a> , similar to the BSD license (which allows you to use it without license fees in commercial projects and opens up full access to the source code without having to open your own when changes are made), is being actively developed now (most recently , in January 2016, version 9.5 was released with some very <a href="http://www.postgresql.org/docs/9.5/static/release-9-5.html">nice improvements</a> ), which allows us to state that PostgreSQL could be one of the best DBMS available today.  But what prevents gaining popularity among the PostgreSQL developers? <br><br> <a href="http://db-engines.com/en/ranking_trend"><img src="https://habrastorage.org/files/0fe/fdc/1f7/0fefdc1f71084302a397e9e966c347a7.png" alt=" RDBMS" title="Figure from http://db-engines.com/en/ranking_trend"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of these factors is a fairly small number of tools for both database development and further maintenance.  Of course, there are JDBC drivers for PostgreSQL, and all those tools that use JDBC work with it, but these tools are usually universal and can not always use the features of a particular DBMS. <br><br>  What features of development are we talking about?  For example, quite often, when you modify existing database objects (usually tables or views), you may encounter an object modification error, because PostgreSQL does not allow this, because  there are dependent objects. <br><br><pre><code class="sql hljs">ags=<span class="hljs-comment"><span class="hljs-comment"># create table t1 (f1 text); CREATE TABLE ags=# create view v1 as select * from t1; CREATE VIEW ags=# alter table t1 alter column f1 type char(5); ERROR: cannot alter type of a column used by a view or rule : rule _RETURN on view v1 depends on column "f1"</span></span></code> </pre> <br>  This feature has already bothered many developers, is fixed in TODO <a href="https://wiki.postgresql.org/wiki/Todo">wiki.postgresql.org/wiki/Todo#Views_and_Rules</a> and has some possible solutions (for example: <a href="http://mwenus.blogspot.nl/2014/04/postgresql-how-to-handle-table-and-view.html">mwenus.blogspot.nl/2014/04/postgresql-how-to-handle-table- and-view.html</a> ). <br><br>  Or another example.  Did this happen to you: you created a stored procedure, began to actively use it, and after a while, as is usually the case, you wanted to modify it.  And only when you start to understand why the logic partially works, and partially not, do you notice that you actually created an additional procedure with a new signature (which is used by a part of the code), while the other part of the code uses the old procedure that was accidentally left due to oversight? <br><br><pre> <code class="sql hljs">ags=<span class="hljs-comment"><span class="hljs-comment"># \df f1    |  |    |    |  --------+-----+-----------------------+------------------------+--------- public | f1 | void | |  public | f1 | void | p1 integer |  (2 )</span></span></code> </pre><br>  To face this situation is very simple, and this is facilitated, in my opinion, by the absence of grouping objects like Oracle packages, which logically combine stored procedures and roll onto the base, usually in one package, which eliminates the appearance of ‚Äúforgotten‚Äù objects.  Yes, of course, if you test your code, then the probability of hitting such objects in battle is small, but this behavior increases the complexity of tracking. <br><br>  What to do if you want to compare two databases and create a script for converting one to another?  Most likely, you will want to use <a href="http://www.liquibase.org/">Liquibase</a> , however, you will be unpleasantly upset when you learn that Liquibase does not know anything about how to solve emerging problems with dependencies, which I mentioned a little earlier. <br><br>  We faced similar issues when we started the migration process from <a href="http://www.microsoft.com/ru-ru/server-cloud/products/sql-server/">MSSQL</a> to PostgreSQL about three years ago.  At that time, we used <a href="https://www.red-gate.com/products/sql-development/sql-source-control/">Redgate SQL Source Control</a> to work with MSSQL and were terribly annoyed by the lack of such a tool for working with PostgreSQL.  They were so annoyed that they decided to create their own tool capable of tracking changes in the database and create scripts for migrating selected objects both interactively and automatically. <br><br>  Since we are programming mostly in Java, the decision to choose a development platform came quickly enough.  The application began to evolve, after several iterations of trial and error, as a set of Eclipse add-ons. <br><br>  After a while, our product, pgCodeKeeper, was born. <br><br>  In short, his work can be described as follows: the database objects are saved to disk as an Eclipse project, which can later (if desired) be placed in the version storage system.  After comparing the database with the project or any of the branches of the project, you can create a migration script from the database (to transfer the state of objects from the project to the database), and in the opposite direction.  And due to the fact that we use our own <a href="http://www.antlr.org/">ANTLR</a> grammars to parse objects, this allows us to build well-developed object dependency graphs, which leads to the creation of correct migration scripts (taking into account the existing problems with dependencies that I voiced above). <br><br>  Using pgCodeKeeper can help build a workflow for making changes to the database.  At home we successfully use the following scheme: <br><br><ol><li>  The developer makes changes to the developer database (without thinking about creating a migration script that will be needed when running into a combat database).  By the way, a developer database can be one shared between several developers.  When applying changes, pgCodeKeeper allows you to transfer only selected objects. <br></li><li>  Changes (if necessary, changes only parts of the objects) made by the developer using pgCodeKeeper are transferred to the development branch of the project and a request to merge with the main branch is created. <br></li><li>  The merger request is verified and accepted by the responsible person. <br></li><li>  After accepting the merge request, pgCodeKeeper generates a migration script (it warns you if instructions are formed in the script that can lead to data loss) from the main branch to the combat database. <br></li><li>  The created script rolls onto the combat database. <br></li></ol><br>  The first two points are performed by the developer, the third is performed by the inspector, the fourth and fifth can be performed by the person accompanying the database.  The fourth and fifth paragraphs can also be performed automatically, and this can be very convenient for building the processes of continuous delivery [Continuous Delivery], but in the current article we will not talk about this. <br><br>  In the described workflow, not all actions are performed via pgCodeKeeper.  For example, the creation of a new branch in the version control system is performed by the <a href="http://www.eclipse.org/egit/">EGit</a> add- <a href="http://www.eclipse.org/egit/">on</a> for Eclipse.  While checking the request for merging code [merge request code review] we perform using the capabilities of <a href="https://about.gitlab.com/">GitLab</a> . <br><br>  <i>Those.</i>  <i>The main goal of pgCodeKeeper is to compare a previously created project with a database instance, identify modified objects and apply changes either to a project from a database (modification of project files) or to a database from a project (by creating a migration script).</i> <br><br>  The time has passed, the project started successfully developed and at some point there was no doubt that the product copes with current requirements for maintaining our internal databases excellently, but the product backlog is not at all empty.  And it is filled with those features or errors that could potentially be found in databases of other developers.  It became clear that the project will either remain within the framework of a corporate project (and, possibly, will go into a stagnation stage, because the current requested features have been completed almost all), or will try to enter the public market and receive feedback on the following questions through feedback: <br><br><ol><li>  Is the product currently in demand in the software market? <br></li><li>  If it is claimed, which product distribution / licensing model may be the most interesting both for us and the market? <br></li></ol><br>  Now we are ready to release pgCodeKeeper to a public beta test with the only condition of use - providing feedback.  Is there anyone willing to try the product at work? <br><br><h4>  We try in </h4><br>  So, I hope that if you have read this far, you are already interested enough to try pgCodeKeeper in the work.  Ready?  Getting started. <br><br>  As I wrote earlier, at the end of its evolutionary path, pgCodeKeeper began to be a set of add-ons for the Eclipse platform.  This means that everything is excellent with multiplatform, and it works both under Linux and under Windows.  Naturally, it will work under other platforms on which the Eclispe platform can be run, but we use only these two. <br><br>  For pgCodeKeeper to work correctly, Eclipse Juno platform version or higher is required, however, this note applies to those who want to install into an existing Eclipse instance.  For new Eclipse installations, get the latest version from <a href="https://eclipse.org/downloads/">eclipse.org/downloads</a> .  You can install the Eclipse IDE for Java Developers (because, among other things, it has already installed add-ons for integration with Git and relatively small size), or choose any that you like (do not forget: Eclipse is a Java application , and for it to work, you must first install the JRE / JDK). <br><br> <a href="https://eclipse.org/downloads/"><img src="https://habrastorage.org/files/524/65c/d0b/52465cd0b70b4b6a9088fd91297e8bc2.png" alt=" Eclipse.org" title="Figure http://www.eclipse.org/downloads/"></a> <br><br>  Select the menu items Help - Install new software and enter the URL of the update site: <a href="http://pgcodekeeper.ru/update/release/">pgcodekeeper.ru/update/release</a> <br><br>  Select and install the pgCodeKeeper add-on.  We are overloading Eclispe and, if we see the pgCodeKeeper project in the list of wizards, we consider the installation mission to be completed. <br><br>  The job of pgCodeKeeper comes down to comparing objects in a project and a database, at the time of creating a project you should already have a database with which you want to make an initial ‚Äúcast‚Äù of the project.  Let's create a database and try to go through the database development process. <br><br><div class="spoiler">  <b class="spoiler_title">DB Formation Script</b> <div class="spoiler_text"><pre> <code class="sql hljs">$ psql -X &lt;&lt;SQL <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> dev; \c dev <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t1 (f1 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> v1 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> t1; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> v2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> v1; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> f1(p1 <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> v2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'select * from v2 limit 1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">language</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>; SQL <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span>      <span class="hljs-string"><span class="hljs-string">"dev"</span></span>   <span class="hljs-string"><span class="hljs-string">"ags"</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> $ psql dev psql (<span class="hljs-number"><span class="hljs-number">9.4</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span>,  <span class="hljs-number"><span class="hljs-number">9.3</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>)  <span class="hljs-string"><span class="hljs-string">"help"</span></span>,   . (ags@<span class="hljs-number"><span class="hljs-number">10.84</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span>:<span class="hljs-number"><span class="hljs-number">5432</span></span>) <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span> [dev] =<span class="hljs-comment"><span class="hljs-comment"># \d \df   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ public ‚îÇ t1 ‚îÇ  ‚îÇ ags ‚îÇ ‚îÇ public ‚îÇ v1 ‚îÇ  ‚îÇ ags ‚îÇ ‚îÇ public ‚îÇ v2 ‚îÇ  ‚îÇ ags ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò (3 )   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ  ‚îÇ    ‚îÇ    ‚îÇ  ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ public ‚îÇ f1 ‚îÇ v2 ‚îÇ p1 integer ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò (1 )</span></span></code> </pre><br></div></div><br>  Well, we have a database, it's time to have some fun and write some code.  Change table t1: <br><br><pre> <code class="sql hljs">(ags@10.84.0.6:5432) 15:12:28 [dev] =<span class="hljs-comment"><span class="hljs-comment"># alter table t1 alter column f1 type char(5); ERROR: cannot alter type of a column used by a view or rule : rule _RETURN on view v1 depends on column "f1" : 2,393 </span></span></code> </pre><br>  Quite expected - we can not perform the requested action, because  representation v1 depends on the table t1.  Moreover, in order to remove v1, we will have to delete both v2 and f1. <br><br><pre> <code class="sql hljs">(ags@10.84.0.6:5432) 15:16:05 [dev] * =<span class="hljs-comment"><span class="hljs-comment"># drop view v1; ERROR: cannot drop view v1 because other objects depend on it : view v2 depends on view v1 function f1(integer) depends on type v2 : Use DROP ... CASCADE to drop the dependent objects too. : 1,631 </span></span></code> </pre><br>  Yes ... it looks like we are in a small trap, now we have to resort to using miracle scripts (for example, similar to the one I wrote about above ... true, they do not work with all the objects that can fall into the dependency graph), or use pgCodeKeeper (there is another option to delete the view and dependent objects in a cascade and then restore the lost objects from the previously saved dump, but we will not use this ‚Äúopportunity‚Äù). <br><br>  It's time to create a project to maintain the database. <br><br><img src="https://habrastorage.org/files/498/3b3/2a8/4983b32a8bcc464fb1becbbcc3d515ed.png" alt="image"><br><br>  Enter the name of the new project: <br><br><img src="https://habrastorage.org/files/d56/8d2/806/d568d2806b824dcc8dd6bb0b8b770a96.png" alt="image"><br><br>  We are setting up the source for the database (yes, you may encounter a slightly unobvious moment of adding a new source, but be patient, we will definitely improve this in the future).  I personally usually store passwords in .pgpass and pgCodeKeeper can take them from it, but if you don‚Äôt use it, fill in the password field in the wizard. <br><br><img src="https://habrastorage.org/files/455/04d/b87/45504db87d784901aed83a98a472da3b.png" alt="image"><br><br>  Creating a project is completed, click the ‚ÄúFinish‚Äù button.  If you did everything correctly, the new project will be initialized and populated with database objects. <br><br><img src="https://habrastorage.org/files/b49/4be/d9b/b494bed9b6194fb795e639994f95786c.png" alt="image"><br><br>  The database object in the project is a readable file, which can also be edited. <br><br><img src="https://habrastorage.org/files/a74/7d3/f6b/a747d3f6b8ab42e7b0cd0b0fec53104f.png" alt="image"><br><br>  Currently, pgCodeKeeper is not positioned as a full-fledged SQL editor or PL / pgSQL code, but sometimes - like, for example, in this case - there is nothing better than editing the file directly in the editor.  Let's change the type of the only field from text to char (5). <br><br><img src="https://habrastorage.org/files/474/d05/cba/474d05cbaf4a4d30a82bf71e0787a967.png" alt="image"><br><br>  Let's go to the main project panel (the bottom tab is ‚ÄúUpdate DB‚Äù) and click the ‚ÄúGet changes‚Äù button.  pgCodeKeeper displayed a list of objects that differ both in the database and in the project.  Diff panel shows detailed changes in the database objects. <br><br><img src="https://habrastorage.org/files/194/e93/3ea/194e933eafec4fb1bdd75e1619f7180c.png" alt="image"><br><br>  Well, now just a little remains, tick the database objects that we want to synchronize with the project objects and press the ‚ÄúGenerate Script‚Äù button.  pgCodeKeeper will helpfully report that the generated script contains dangerous instructions that can lead to data loss and will generate the following script: <br><br><div class="spoiler">  <b class="spoiler_title">Migration script generated by pgCodeKeeper</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> TIMEZONE <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'UTC'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> check_function_bodies = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- DEPCY: This FUNCTION depends on the COLUMN: t1.f1 DROP FUNCTION f1(p1 integer); -- DEPCY: This VIEW depends on the COLUMN: t1.f1 DROP VIEW v2; -- DEPCY: This VIEW depends on the COLUMN: t1.f1 DROP VIEW v1; ALTER TABLE t1 ALTER COLUMN f1 TYPE char(5); /*    - : t1 : text : char(5) */ -- DEPCY: This VIEW is a dependency of FUNCTION: f1(integer) CREATE VIEW v1 AS SELECT t1.f1 FROM t1; ALTER VIEW v1 OWNER TO ags; -- DEPCY: This VIEW is a dependency of FUNCTION: f1(integer) CREATE VIEW v2 AS SELECT v1.f1 FROM v1; ALTER VIEW v2 OWNER TO ags; CREATE OR REPLACE FUNCTION f1(p1 integer) RETURNS v2 LANGUAGE sql AS $$select * from v2 limit 1$$; ALTER FUNCTION f1(p1 integer) OWNER TO ags;</span></span></code> </pre><br></div></div><br>  Hooray!!!  A couple of mouse clicks (except for project initialization) and we can form migration scripts!  The resulting script can be rolled on its own through pgAdmin / psql, or through pgCodeKeeper.  Since in PostgreSQL, DDL instructions are transactional, I specify the necessity of executing a script in one transaction (key -1 in psql) when rolling in such scripts in order to prevent the inconsistent database state from occurring in case an error occurs during the execution of the script. <br><br>  If we now re-perform a comparison of the project and the database, we will see that the objects in the project and the database ... Are different? <br><br>  Without panic, this is due to the fact that when we made changes to the project with our hands, we specified the abbreviated form of character type as char, in the database it is now displayed in full form. <br><br><img src="https://habrastorage.org/files/24a/cd5/452/24acd545227442f3a85bb9e8aee26628.png" alt="image"><br><br>  To update the project, switch to the lower tab ‚ÄúUpdate project‚Äù, click ‚ÄúGet changes‚Äù, select the necessary objects and click on the ‚ÄúApply selected changes‚Äù button.  After performing these steps, the database objects and the project will become identical. <br><br><h4>  Famous product features </h4><br>  Since the product was originally developed for internal databases, only those object types that we use were first tested, some are not yet supported (for example, FOREIGN TABLE).  pgCodeKeeper does not support work with all versions of PostgreSQL, currently it is guaranteed to work for versions 9.3 and above (you need to check - it is possible that it will work with 9.1-9.2, but not earlier). <br><br><h4>  Conclusion </h4><br>  Today you met a new product that makes it easier to work with PostgreSQL, I told you about the main features of the product, without mentioning such topics as: manually adding dependencies (if our parser did not cope, you can always tell it), work with version control systems, work pgCodeKeeper in automatic, non-interactive mode. <br><br>  The article did not go without neologisms, jargon or a few outdated turns of speech, in all cases I indicated the meaning of a word or expression, when it was first used, in English most accurately defines it. <br><br>  Currently, pgCodeKeeper is in the process of registering in the domestic software registry in accordance with Government Decree No. 1236 of November 16, 2015 ‚ÄúOn imposing a ban on the admission of software originating from foreign countries for procurement purposes for meeting state and municipal needs‚Äù <a href="http://www.garant.ru/hotlaw/federal/671898/">www. garant.ru/hotlaw/federal/671898</a> and this means that in the near future pgCodeKeeper will be able to participate in the program of import substitution. <br><br>  Using pgCodeKeeper makes it easier to maintain PostgreSQL databases (even the addictive effect was noticed). <br><br>  How interesting was pgCodeKeeper? </div><p>Source: <a href="https://habr.com/ru/post/276339/">https://habr.com/ru/post/276339/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276327/index.html">Linux kernel support 2.6.32 LTS ends in February</a></li>
<li><a href="../276329/index.html">Quantum morris</a></li>
<li><a href="../276331/index.html">Add range operator in PHP</a></li>
<li><a href="../276333/index.html">Using or Using?</a></li>
<li><a href="../276335/index.html">HPE Aruba - Corporate-grade Wi-Fi</a></li>
<li><a href="../276341/index.html">Microsoft Azure Stack TP1</a></li>
<li><a href="../276343/index.html">BlueZ bracelet control</a></li>
<li><a href="../276345/index.html">Firmware security using the example of industrial switches Hirschmann and Phoenix Contact</a></li>
<li><a href="../276347/index.html">Does your antivirus catch password-protected archives?</a></li>
<li><a href="../276349/index.html">Foreign hackers hacked the database of the largest US police union</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>