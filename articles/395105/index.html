<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a Z-Wave Vacuum Cleaner iRobot Roomba</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Without extra preludes immediately to the case. The apartment is automated with Z-Wave technology, and the iRobot Roomba 770 vacuum cleaner is not con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a Z-Wave Vacuum Cleaner iRobot Roomba</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c59/3ff/6bf/c593ff6bf1ef4aa0a4234fbeab1f90dd.png"><br><br>  Without extra preludes immediately to the case.  The apartment is automated with Z-Wave technology, and the iRobot Roomba 770 vacuum cleaner is not connected to the network in any way and is removed according to its schedule.  It's time to add a vacuum cleaner to the Z-Wave network!  This will help me Z-Wave board for developers - <a href="http://z-uno.z-wave.me/">Z-Uno</a> . <br>  What are the advantages of automating a vacuum cleaner with Z-Wave? <br><ul><li>  Ability to conveniently configure the schedule from the Web interface </li><li>  Get data from a vacuum cleaner about batteries and sensors </li><li>  Manage from mobile app </li><li>  Use in scenarios simulating the presence of a person in the house </li></ul><br><a name="habracut"></a><br>  <a href="https://cdn-shop.adafruit.com/datasheets/create_2_Open_Interface_Spec.pdf">IRobot Roomba management documentation is</a> open.  It follows that communication with the vacuum cleaner occurs through the Mini-DIN connector on the UART at a speed of 115200, TTL level 5V. <br><br><img src="https://habrastorage.org/files/4a9/2e0/490/4a92e0490e594bf78936f3aed1c53f15.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All documentation on Z-UNO is available at <a href="http://z-uno.z-wave.me/">http://z-uno.z-wave.me/</a> , it includes a description of all available functions, examples, schema. <br><br><img src="https://habrastorage.org/files/1aa/2fd/f28/1aa2fdf28d334cc5969cd81b75f27704.png"><br><br>  Z-Uno uses a UART with a TTL 3.3V level, so a voltage divider of 1k and 2.2k resistors should be placed on the Rx Z-UNO line. <br><br><img src="https://habrastorage.org/files/474/b0a/d6e/474b0ad6e49f43368b51523868c928f9.png"><br><br>  When connecting Roomba to Arduino, there is a problem that Roomba produces a very small current on Tx, so data can be lost, if there is a similar problem on Z-UNO, then you need to use a transistor together with a voltage divider: <br><br><img src="https://habrastorage.org/files/041/d06/778/041d067783064fbfb2dad317a7877f49.jpg"><br>  <a href="http://www.irobot.com/~/media/MainSite/PDFs/About/STEM/Create/Arduino_Tutorial.pdf">http://www.irobot.com/~/media/MainSite/PDFs/About/STEM/Create/Arduino_Tutorial.pdf</a> <br><br>  Z-Uno can be powered from 3.3V, from 5V through a regular voltage regulator and from 7-20V through the second regular voltage regulator.  During cleaning, the iRobot Roomba's supply voltage is approximately 14V when the vacuum cleaner is at the base, the voltage rises to 20V.  If you connect the Z-Uno to iRobot Roomba directly, the linear voltage regulator on the Z-Uno starts to get very hot, which will cause the power to go off by temperature, so you need to use either a radiator or a switching voltage regulator.  I chose the second option and use the very compact Chinese voltage regulator <a href="http://ru.aliexpress.com/item/Free-shipping-Mini-3A-DC-DC-Converter-Step-Down-Module-Adjustable-3V-5V-16V-Power-Power/32552698837.html">MP1584EN</a> . <br><br><img src="https://habrastorage.org/files/ecf/28c/a29/ecf28ca29df245069ceb232b69d543e2.jpg"><br><br>  Brief characteristics of the voltage regulator MP1584EN: <br><ul><li>  Input voltage: 4.5-28V </li><li>  Output voltage: 0.8-20V (adjustable) </li><li>  Output Current: 3A </li><li>  Efficiency: 96% </li></ul><br>  Voltage regulator and voltage divider fit on the back side of the Z-UNO, while not increasing the dimensions of the board. <br><br><img src="https://habrastorage.org/files/40d/670/67d/40d67067df6c4b578d197c49a32e5e81.jpg"><br><br>  Connecting Z-Uno to iRobot Roomba 770: <br><br><img src="https://habrastorage.org/files/6ea/7ac/c9e/6ea7acc9e53e4097bb727f8fbbfd25c8.JPG"><br><br><h4>  Cleaning Dock station </h4><br>  With the <b>Cleaning-Dock</b> sketch, <b>the</b> Z-Uno <b>station</b> on the radio receives ON / OFF commands and sends a Clean (clean) and Seek Dock (Search for a docking station) commands to the UART vacuum cleaner.  When receiving a radio command, Z-Uno flashes once with the built-in LED.  The radio command On / Off can send any Z-Wave device: keychain, switch, controller, etc. <br><br><img src="https://habrastorage.org/files/518/fbf/bb6/518fbfbb610d4232b0095441185ec223.png"><br><br><div class="spoiler">  <b class="spoiler_title">Sketch Cleaning-Dock Station for Z-Uno for Vacuum Cleaner Roomba</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED_PIN 13 byte roombaState = 0; ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_BINARY(getter, setter)); void setup() { pinMode(LED_PIN, OUTPUT); Serial1.begin(); } void loop() { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*Empty*/</span></span></span><span class="hljs-meta"> } void setter(byte value) { digitalWrite (LED_PIN, HIGH); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Turn On LED if (value) { Serial1.write(128); // Roomba START Communication Serial1.write(131); // SAFE MODE Serial1.write(135); // Clean roombaState = 1; } else { digitalWrite (LED_PIN, LOW); Serial1.write(128); // Roomba START Communication Serial1.write(131); // SAFE MODE Serial1.write(143); // Seek Dock roombaState = 0; } } byte getter() { return roombaState; }</span></span></span></span></code> </pre> <br></div></div><br><br>  After casting the sketch, you need to add the Z-Uno to the Z-Wave controller.  Z-Uno is displayed as a switch with On and Off buttons. <br><br><img src="https://habrastorage.org/files/d4f/e07/68d/d4fe0768d32c4e1c8ddc5d78f4eafece.PNG" width="50%"><br><br><h4>  Read battery charge </h4><br>  Add to the function enable / disable the vacuum cleaner function to read the battery charge.  With a sketch <b>Reading the battery charge of the</b> Z-Uno periodically or on request sends the battery charge of the Roomba vacuum cleaner to the Z-Wave controller. <br><br><img src="https://habrastorage.org/files/b93/f18/ac0/b93f18ac0e4442098f5c9eade6f8fdf9.png"><br><div class="spoiler">  <b class="spoiler_title">Sketch Battery Vacuum Cleaner Roomba and Cleaning-Docking Station for Z-Uno</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED_PIN 13 byte roombaState = 0; word batteryValue = 0; ZUNO_SETUP_CHANNELS(ZUNO_SWITCH_BINARY(getter, setter),ZUNO_SENSOR_MULTILEVEL(ZUNO_SENSOR_MULTILEVEL_TYPE_VOLTAGE, SENSOR_MULTILEVEL_SCALE_VOLT, SENSOR_MULTILEVEL_SIZE_ONE_BYTE, 1, getterBattery)); void setup() { pinMode(LED_PIN, OUTPUT); Serial1.begin(); } void loop() { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Get battery value every 1 minute byte data[2] = {0,0}; // array to store data from battery byte i = 0; Serial1.write(142); // Send a packet of sensor data bytes Serial1.write(22); // Get battery value delay(200); while (Serial1.available()) { data[i++] = Serial1.read(); } // highbyte is shifted left eight bits, lowbyte is added to highbyte // encoder_count=highbyte&lt;&lt;8+lowbyte batteryValue= (data[0]&lt;&lt;8)+data[1]; zunoSendReport(2); // Send Battery every 30 seconds delay(30000); } void setter(byte value) { if (value) { digitalWrite (LED_PIN, HIGH); Serial1.write(128); // Roomba START Communication Serial1.write(131); // SAFE MODE Serial1.write(135); // Clean roombaState = 1; } else { digitalWrite (LED_PIN, LOW); Serial1.write(128); // Roomba START Communication Serial1.write(131); // SAFE MODE Serial1.write(135); // Stop Clean roombaState = 0; } } byte getter() { return roombaState; } byte getterBattery() { return batteryValue; }</span></span></span></span></code> </pre><br></div></div><br><br>  Now Z-Uno is displayed as a 2-channel device with the functions of a switch and a multi-level sensor, i.e.  On / Off and charge in volts buttons are displayed. <br><br><img src="https://habrastorage.org/files/ec9/2f5/f13/ec92f5f1307b4cacb4cb300b007d26a2.PNG" width="50%"><br><br>  If necessary, you can add direct control, realize the reading of the temperature sensor, a report on the meeting with the wall and an alert when it is impossible to drive.  You can add a function that would allow Roomba to get stuck under the sofa by sending him a command to play a melody. <br><br>  Z-Uno is certainly not the only Roomba radio control option, there is <a href="http://www.roowifi.com/">RooWiFi</a> and many projects like Arduino + ESP8266, but if you already have a Z-Wave network, then why not use Z-Uno to control your Roomba vacuum cleaner! <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Mu_d-xeGlUo%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjn86mqXtEf1sjkdBiXLdrTgcHetg" frameborder="0" allowfullscreen=""></iframe><br><br>  For those who want to save money, <a href="http://www.5smart.ru/">5smart.ru</a> shop gives a 10% discount on Z-Uno and on all Z-Wave equipment.  Coupon <b>GT_SUMMER</b> . </div><p>Source: <a href="https://habr.com/ru/post/395105/">https://habr.com/ru/post/395105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../395093/index.html">The development of the game "Fable" ruined my life, but I do not regret it</a></li>
<li><a href="../395095/index.html">JD.ru one year in Russia: everything is just beginning</a></li>
<li><a href="../395099/index.html">Audio Digest # 5: About Sound, Music, and Audio Technology</a></li>
<li><a href="../395101/index.html">The Bot Power 2016 bot rating</a></li>
<li><a href="../395103/index.html">Cougar 600K - simple and with brains</a></li>
<li><a href="../395107/index.html">Enhanced human intelligence (AI) vs AII and CII. Reach all who used to?</a></li>
<li><a href="../395109/index.html">Record sound through the phone's vibration motor</a></li>
<li><a href="../395111/index.html">This is Science: How does coffee help you recover from physical exertion?</a></li>
<li><a href="../395115/index.html">Bionic hand market review for 2016: what to buy in Russia</a></li>
<li><a href="../395117/index.html">Ask Ethan # 57: How do black holes die?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>