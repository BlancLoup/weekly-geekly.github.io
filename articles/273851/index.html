<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The phase shift signal on VHDL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a continuation of a series of topics VHDL delay element , VHDL delay element. Another look at the delay elements on VHDL implemented i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The phase shift signal on VHDL</h1><div class="post__text post__text-html js-mediator-article">  This article is a continuation of a series of topics <a href="http://geektimes.ru/post/253758/">VHDL</a> <a href="http://geektimes.ru/post/253858/">delay element</a> , <a href="http://geektimes.ru/post/253758/">VHDL</a> <a href="http://geektimes.ru/post/253858/">delay element.</a>  <a href="http://geektimes.ru/post/253858/">Another look</a> at the delay elements on VHDL implemented in the FPGA. <br><br>  The focus will be on a specific application example, which anyone can run in the simulator or a real gland.  The example was created for convenient simulation in the Xilinx ISE environment using Modelsim SE and with minimal changes implemented into a full-fledged IP Core. <br><a name="habracut"></a><br><h4>  Formulation of the problem </h4><br>  Perform a phase shift of the pulsed signal by a predetermined amount (the pulse duration is arbitrary), possibly not synchronous with the frequency of the core logic.  Do this without rebooting or shutting down the module / device. <br><br><h4>  Instruments </h4><br>  DIP switch 8 positions, which set the delay code in the binary code (shift value).  Hard or Soft Reset - initial reset, setting default parameters.  The reference frequency is 100 MHz, i.e. 10 ns minimum displacement time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Implementation </h4><br>  Impulse will call a logical unit - 1. <br>  Pause, logical zero - 0. <br><br>  The code is implemented as a state machine, which, in my opinion, thanks to the step-by-step structure and the ability to give a distinct name to each stage, is very simple and straightforward. <br><br>  In addition to the comments to the code, a testbench simulation file is attached. <br><br>  Chart finite state machine: <br><br><img src="https://habrastorage.org/files/877/af7/1a2/877af71a2ac346dc8ee693ddb0e3f8fe.png" alt="image"><br><br>  The main logic.  The code tracks the change in the signal level, then the counter is started, when its value becomes equal to the offset set, the output goes to the same level as it is being monitored and so on in a circle. <br><br><div class="spoiler">  <b class="spoiler_title">freq_shift_half_cycle.vhd</b> <div class="spoiler_text"><pre><code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">library</span></span> ieee; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ieee.std_logic_1164.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ieee.numeric_std.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ieee.std_logic_arith.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ieee.std_logic_unsigned.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> freq_shift_half_cycle <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span> ( Bus2IP_Clk : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">STD_LOGIC</span></span>; <span class="hljs-comment"><span class="hljs-comment">--    Bus2IP_Reset : in STD_LOGIC; --  Clk_in : in STD_LOGIC; --   Shift_reg : in STD_LOGIC_VECTOR (7 downto 0); --     Bus2IP_Clk counter_reg_test : out STD_LOGIC_VECTOR (7 downto 0); --   Clk_out : out STD_LOGIC --   ); end freq_shift_half_cycle; architecture Behavioral of freq_shift_half_cycle is type state_type is (set_level, wait_high_low, wait_low_high); --    signal current_stage : state_type; signal counter_shift : STD_LOGIC_VECTOR (7 downto 0); --   begin shift_fsm : process (Bus2IP_Reset, Bus2IP_Clk, Clk_in, Shift_reg) begin if Shift_reg = x"00" or Bus2IP_Reset = '1' then --      reset Clk_out &lt;= Clk_in; counter_shift &lt;= x"01"; counter_reg_test &lt;= x"01"; --   current_stage &lt;= set_level; elsif (Bus2IP_Clk'event and Bus2IP_Clk = '1') then case current_stage is when set_level =&gt; if counter_shift = Shift_reg then --   ,    0  1 if Clk_in = '1' then Clk_out &lt;= '1'; current_stage &lt;= wait_high_low; else Clk_out &lt;= '0'; current_stage &lt;= wait_low_high; end if; counter_shift &lt;= x"01"; counter_reg_test &lt;= x"01"; --   elsif counter_shift &lt; Shift_reg then counter_shift &lt;= counter_shift + 1; counter_reg_test &lt;= counter_shift + 1; --   current_stage &lt;= set_level; end if; when wait_high_low =&gt; --   1  0    set_level if Clk_in = '1' then current_stage &lt;= wait_high_low; else current_stage &lt;= set_level; end if; when wait_low_high =&gt; --   0  1    set_level if Clk_in = '0' then current_stage &lt;= wait_low_high; else current_stage &lt;= set_level; end if; when others =&gt; current_stage &lt;= set_level; end case; end if; end process shift_fsm; end Behavioral;</span></span></code> </pre> <br></div></div><br>  Simulation code for Modelsim: <br><br><div class="spoiler">  <b class="spoiler_title">testbench_half_cycle.vhd</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">LIBRARY</span></span> ieee; <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> ieee.std_logic_1164.<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- Uncomment the following library declaration if using -- arithmetic functions with Signed or Unsigned values --USE ieee.numeric_std.ALL; ENTITY testbench_half_cycle IS END testbench_half_cycle; ARCHITECTURE behavior OF testbench_half_cycle IS -- Component Declaration for the Unit Under Test (UUT) COMPONENT freq_shift_half_cycle PORT( Bus2IP_Clk : IN std_logic; Bus2IP_Reset : IN std_logic; Clk_in : IN std_logic; Shift_reg : IN std_logic_vector(7 downto 0); counter_reg_test : OUT std_logic_vector(7 downto 0); Clk_out : OUT std_logic ); END COMPONENT; --Inputs signal Bus2IP_Clk : std_logic := '0'; signal Bus2IP_Reset : std_logic := '0'; signal Clk_in : std_logic := '0'; signal Shift_reg : std_logic_vector(7 downto 0) := (others =&gt; '0'); --Outputs signal counter_reg_test : std_logic_vector(7 downto 0); signal Clk_out : std_logic; -- Clock period definitions constant Bus2IP_Clk_period : time := 10 ns; constant Clk_in_period : time := 100 ns; BEGIN -- Instantiate the Unit Under Test (UUT) uut: freq_shift_half_cycle PORT MAP ( Bus2IP_Clk =&gt; Bus2IP_Clk, Bus2IP_Reset =&gt; Bus2IP_Reset, Clk_in =&gt; Clk_in, Shift_reg =&gt; Shift_reg, counter_reg_test =&gt; counter_reg_test, Clk_out =&gt; Clk_out ); -- Clock process definitions Bus2IP_Clk_process :process begin Bus2IP_Clk &lt;= '1'; wait for Bus2IP_Clk_period/2; Bus2IP_Clk &lt;= '0'; wait for Bus2IP_Clk_period/2; end process; Clk_in_process :process begin Clk_in &lt;= '1'; wait for Clk_in_period/2; Clk_in &lt;= '0'; wait for Clk_in_period/2; -- wait for 1000 ns; end process; -- Stimulus process stim_proc: process begin -- hold reset state for 100 ns. Bus2IP_Reset &lt;= '1'; wait for 500 ns; Bus2IP_Reset &lt;= '0'; wait for 5000 ns; Shift_reg &lt;= x"01"; --   wait for 5000 ns; Shift_reg &lt;= x"00"; wait for 5000 ns; Shift_reg &lt;= x"04"; wait for Bus2IP_Clk_period*10; -- insert stimulus here wait; end process; END;</span></span></code> </pre><br></div></div><br>  An experienced electronics engineer could notice the shortcomings of this code, namely.  Exposed delay should not exceed: <br><br>  - pulse duration, if the pulse duration is less than the pause duration; <br>  - pause duration, if the pause duration is less than the pulse duration. <br><br>  Those.  the value of the phase shift should not exceed 180 ¬∞ for both 0 and 1 in the case of a pulse signal. <br><br>  In the diagram below you can see how the phase of the input signal is shifted by 40 ns in real time, so to speak, with a delay in the operation of the logic: <br><br><img src="https://habrastorage.org/files/db2/3dc/fe7/db23dcfe7740400084097616b2ff79c7.png"><br><br>  The following is a demonstration of the situation if the tuned signal and the reference frequency are asynchronous: <br><br><img src="https://habrastorage.org/files/656/ded/561/656ded56122643e3965acad942a64301.png"><br><br>  I suggest you analyze this situation and draw your own conclusions. <br><br>  I will be glad to your comments and comments, with the help of which in the next article, this code will be supplemented with new functionality. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/273851/">https://habr.com/ru/post/273851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273841/index.html">Thread support in Mail.Ru Mail Android application: we are achieving complete sync</a></li>
<li><a href="../273843/index.html">From STUPID code to SOLID code</a></li>
<li><a href="../273845/index.html">Welcome to Tarantool meetup January 28</a></li>
<li><a href="../273847/index.html">The digest of news from the world of development on Unity</a></li>
<li><a href="../273849/index.html">Static time analysis demystified</a></li>
<li><a href="../273859/index.html">Alljoyn: embedded view of the developer. Part 1: Introduction</a></li>
<li><a href="../273863/index.html">On the issue of standard libraries</a></li>
<li><a href="../273865/index.html">Make iBeacon and Eddystone Beacon "on the knee"</a></li>
<li><a href="../273871/index.html">RC Car with GPS on Arduino Nano</a></li>
<li><a href="../273873/index.html">German-Chinese device and a bit of math</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>