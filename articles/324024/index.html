<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Detailed TTL Tuning Guide for DNS Records</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="DNS is a fundamental technology product. Processing virtually all top-level network requests and Internet searches, sending Internet traffic and e-mai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Detailed TTL Tuning Guide for DNS Records</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/11f/1bb/8b2/11f1bb8b23ca44118ab45cefc63b1ba1.png" alt="image"><br><br>  DNS is a fundamental technology product.  Processing virtually all top-level network requests and Internet searches, sending Internet traffic and e-mail, as well as many other operations, are made possible by setting certain matches when searching for DNS (converting names such as some.domain.org to IP addresses or names of other domains). <br><a name="habracut"></a><br>  We decided to write about the time to live (Time To Live, TTL) data, since most system administrators do not have to work with DNS configurations every day and much of the information about this parameter is half-forgotten tales transmitted by system administrators from generation to generation. <br><br>  After asking the corresponding question on Twitter, we found out that some system administrators cannot even decipher the abbreviation TTL (although such, fortunately, are in the minority). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Guess the riddle!  What does the abbreviation TTL mean when it comes to DNS? <br><br>  18:43 Oct 26  2016 <br>  4% Border of terminal transfer <br>  85% lifetime <br>  8% Telemetry transport line <br>  3% Trusted Technology List <br>  26 votes ‚Ä¢ Final result <br>  Retweet 1 Like mark 1 <br><br>  To clarify, we will cover the following topics. <br><br>  <u>1. Overview of the DNS system and TTL setting</u> <u><br></u>  <u>2. Troubleshooting TTL problems in DNS records</u> <u><br></u>  <u>3. Recommendations for managing changes in DNS records</u> <u><br></u>  <u>4. DNS tools</u> <u><br></u>  <u>5. Further actions</u> <br><br>  <b>1. GENERAL INFORMATION ON DNS SYSTEM</b> <br><br>  <i>What is a DNS record?</i> <br><br>  The Domain Name Server (Domain Name Server) DNS entry contains two important parameters: <br>  addressing (matching) requests for a particular entry; <br>  time of entry for caching - this is the meaning that the ominous name ‚Äúlifetime‚Äù (TTL) has received. <br><br>  <i>Why are DNS records cached?</i> <br><br>  Many organizations set up DNS records once and after that they have not changed them for years.  Because DNS records are often requested, but rarely updated, caching them can significantly improve network performance, increasing the complexity of the assessment and troubleshooting DNS problems. <br><br>  <i>What is TTL?</i> <br><br>  Time to Live (TTL) is the duration of the caching of the record * by each link * of the DNS matching chain.  This value is measured in seconds (the importance of this will be explained below). <br><br>  Unfortunately, the generally accepted term ‚Äúlifetime‚Äù cannot be called exhaustive.  Perhaps it would be more logical to call the name ‚Äúsearch time‚Äù or ‚Äúthe duration of the storage of the DNS record in the cache‚Äù <br><br>  <i>What is the standard TTL value for DNS records?</i> <br><br>  The TTL value is always expressed in seconds.  Most DNS configuration services provide a complete list of values ‚Äã‚Äãfor records. <br>  300 seconds = 5 minutes = ‚ÄúVery short‚Äù <br>  3600 seconds = 1 hour = "Short" <br>  86,400 seconds = 24 hours = "Long" <br>  604,800 seconds = 7 days = ‚ÄúAbsolute Maximum‚Äù <br><br>  <i>How is a DNS lookup performed?</i> <br><br>  When you enter a URL in a browser, a whole series of searches are created. <br>  At each stage of this process (often there are more stages than listed) the following questions are asked. <br><br>  1. Is the entry cached? <br>  2. If so, is it a TTL value? <br><br>  If the answer ‚ÄúNo‚Äù is received to any of these questions, the request moves to the next link in the chain. <br><br>  <i>Why is DNS based on network connections, not devices?</i> <br><br>  Resolving DNS problems is not an easy task, not only because of a number of difficulties associated with the use of TTL and caching systems, but also because many modern devices are connected through various networks and chains of DNS servers. <br><br>  Consider the situation on the example of an ordinary laptop.  I usually work on a laptop at home.  Despite the fact that I have not taken it anywhere for several weeks, during this time the following connections were made on the device: <br><br>  ‚Ä¢ to the main home network Wi-Fi / cable network; <br>  ‚Ä¢ to a mobile phone when the cable network is unavailable; <br>  ‚Ä¢ Both options are higher, but connected via VPN. <br><br>  Each time the network changes, a new DNS chain is activated.  If this happens at the time of the change, the servers and caching nodes in the DNS chain may provide incorrect data. <br><br>  This often happens in corporate networks where the Active Directory domain name matches the address of the company's website.  The external DNS server (Internet provider level) stores the DNS record that directs the address <a href="http://www.example.com/">www.example.com</a> to the correct IP address / CNAME of the web server, but the internal DNS server used by Active Directory does not duplicate the records. <br><br>  A panic will immediately begin: ‚ÄúThe web server is not working!‚Äù, ‚ÄúThis is the end of the world!‚Äù, ‚ÄúWhere are my pants?‚Äù.  But, starting to fix the problem, you will find that it was caused by an unclosed connection via VPN. <br><br>  <b>2. TROUBLESHOOTING WITH TTL IN DNS RECORDS</b> <br><br>  <i>How long does it take to update a DNS record?</i> <br><br>  To calculate the maximum (worst case) time interval required to update the value of the DNS record in the links for all clients, multiply the number of links in the chain (excluding the authoritative server) by the TTL value. <br><br>  For example, if the TTL value is 3600 seconds (1 hour), and the DNS chain consists of 5 links, the full propagation of changes should take no more than 18,000 seconds (5 hours). <br>  But if everything was so simple. <br><br>  <i>What are the costs of DNS lookup?</i> <br><br>  When it comes to the ‚Äúcosts‚Äù of a DNS search, it usually means not monetary, but time costs.  Depending on the number of Internet gremlins in the global network, it usually takes 100‚Äì200 milliseconds to complete a DNS query. <br><br>  This is a very short time, but imagine a web page.  The correspondence between the name and the IP address in the DNS system must be configured for all images, CSS files and JavaScript asset files that are accessible via links on the page.  Without caching, the boot time will increase significantly. <br><br>  <i>Simplified DNS Lookup Costing Scheme</i> <br><br>  I called this scheme simplified, since it is unlikely that all the assets on your website are in different domains.  In addition, many different caching tools are embedded in browsers that provide faster loading of content than shown in my diagram. <br><br>  <u>With caching</u> <br><br>  (30 image files x 50 ms to download each file) + (100 ms to perform one DNS lookup followed by caching) = 1600 ms <br><br>  <u>No caching</u> <br><br>  (30 image files x 50 ms per download of each file) + (30 x 100 ms for each DNS search) = 3000 ms <br><br>  <i>Why aren't my DNS records updated</i> ? <br><br>  There are other factors that increase the propagation time of changes.  Some of them are listed below. <br><br>  ‚Ä¢ Web browsers self-cache DNS records and store them for some time without TTL, which allegedly increases their speed.  For example, modern versions of Internet Explorer by default cache DNS records for 30 minutes (up to IE 4 this time was 24 hours) and ignore lower TTL values. <br>  ‚Ä¢ Mobile Internet providers may try to reduce total traffic by increasing TTL time, which reduces the frequency of requests. <br>  ‚Ä¢ Complex internal networks with a larger number of DNS servers than expected have been updated longer for obvious reasons. <br><br>  That is why in many services you can meet the following statement: "The full dissemination of changes in DNS records can take several days, so plan your actions accordingly." <br><br>  <i>Is it possible to somehow force the client to remotely update the DNS record?</i> <br><br>  This question is usually asked in the following context: ‚ÄúAfter updating the DNS records, the client cannot access some sites.  How to perform the update force? " <br>  Unfortunately, the only answer to this question: "None."  There is no command in the DNS system that allows you to force an early update of data for lower level clients. <br><br>  You can use commands to remove DNS records from the local cache, but they usually do not work as effectively as we would like, due to the presence of both upstream (caching DNS records on the side of the Internet provider) and downstream (caching DNS records in the browser) channels . <br><br>  It is best to change the TTL values ‚Äã‚Äãin your records in advance. <br><br>  <b>3. RECOMMENDATIONS ON MANAGING CHANGES IN DNS RECORDS</b> <br><br>  <i>Which TTL values ‚Äã‚Äãare better: small or large?</i> <br><br>  Developers have been waging a holy war for a long time about how to indent code in the code: using tabs or spaces.  I found out that network administrators have roughly the same feelings when it comes to the duration of a TTL. <br>  Typically, this view is supported by their own experience in repelling previous network attacks and troubleshooting network configuration problems. <br><br>  A DDOS attack that can stop the work of the root DNS servers or similar servers of the Internet provider for 12 hours will have less impact on sites with a very high TTL value.  In such cases, clients will work even if the DNS server is shut down or overloaded. <br>  However, if you accidentally make a mistake when switching Internet or e-mail sites, 12 hours without any possibility of eliminating it is the last thing you need.  That is why some administrators believe that the lifetime should not exceed 1 minute. <br><br>  Personally, I try to specify a small TTL value for DNS records (less than 1 hour / 3600 seconds). <br><br>  <i>How do I know when a client requests an updated DNS record?</i> <br><br>  Determining when all customers update data is very difficult. <br>  Lifetime is * not * an expiration date.  You should not compare the TTL value in the DNS record with the recommended date of use, indicated, for example, on stale bread: this is not a definite time, at the occurrence of which the record will become invalid and will require replacement. <br><img src="https://habrastorage.org/files/91e/2ba/e73/91e2bae73a7342e0993d71671a1ada26.png" alt="image"><br>  A DNS record is rather a staffing table, with changes slowly propagating throughout the network.  When the clients in the ‚Äúlower‚Äù schedule expire on the cache, they request a higher-level DNS server for the entry. <br>  <i>What is the best way to change DNS records?</i> <br><br>  Creating a ‚Äúplan‚Äù or ‚Äústrategy‚Äù to perform relatively simple tasks, which include changing a single record in a domain, may seem overwhelming, but given the enormous impact of DNS failures on the availability of your data, it is still worth some caution.  As the old saying goes: ‚ÄúPreventing is easier than curing.‚Äù <br>  There is an easy way to minimize errors: never update the DNS record and TTL value for this record at the same time.  Ideally, you should have the following process implemented. <br><br>  1. A few days before switching, set the TTL DNS record to a low value, for example, 300 seconds. <br>  2. Set the switching date for the entry. <br>  3. A few days after switching, set a higher TTL value. <br>  What is the best way to add new DNS records? <br>  Adding a new entry is easier than changing an existing one. <br>  1. Add an entry with a low TTL value. <br>  2. Check if everything works and increase the TTL value. <br><br>  <i>What is the most common TTL value?</i> <br><br>  Opinions on the * correct * TTL values ‚Äã‚Äãare so divergent that we attempted to determine it based on statistics.  The list of the 500 most important Moz websites seemed to us an excellent cut of the Internet.  In addition, a ready-made CSV file with a list of sites included in the final list was available on this resource. <br><br>  I wrote a small script to iterate through the list and search for the current TTL value for the main entry in each domain.  As with any data analysis project, this data will vary greatly depending on the question.  The example is not comprehensive, it presents current (cached) results, etc., etc. Despite all these reservations, the results obtained still have a certain value. <br><br>  <i>Analysis of TTL values ‚Äã‚Äãfor the 500 most important Internet domains according to Moz</i> <br><br>  You can view or edit this script or download it and perform the analysis yourself: <a href="https://gist.github.com/mbuckbee/79b2e76bd9271bea38487defd8a9138b">gist.github.com/mbuckbee/79b2e76bd9271bea38487defd8a9138b</a> <br>  View the list and download it in CSV format at <a href="https://moz.com/top500">moz.com/top500</a> <br><br>  The minimum TTL value: 1 <br>  The maximum value of TTL: 129 540 <br>  Established Compliance Domains: 485 <br>  Arithmetic average TTL: 6468 <br>  Median TTL value: 300 <br><br>  Minimum values ‚Äã‚Äãwere obtained from domains that very often change DNS records for load balancing.  The maximum values ‚Äã‚Äãcorresponded to domains that have not been updated for a long time (yes, python.org, I mean you). <br><br>  If you need to justify your decision to set a low (within 1 hour, 3600 seconds) TTL value, you can provide a median value of 300 seconds (5 minutes) and confidently state that you have empirical evidence of your choice. <br><br>  <b>4. DNS PLATFORM TOOLS</b> <br><br>  <i>How to check TTL value for DNS record in Windows?</i> <br><br>  The easiest way to check DNS records in Windows is to use the nslookup utility: <a href="https://technet.microsoft.com/en-us/library/bb490950.aspx">technet.microsoft.com/en-us/library/bb490950.aspx</a> . <br>  Example: C: \&gt; nslookup-type = cname -debug <a href="http://www.varonis.com/">www.varonis.com</a> <br><br><img src="https://habrastorage.org/files/c8b/76a/1c7/c8b76a1c73354e69918204ed8ae438e5.png" alt="image"><br>  The TTL value is indicated at the bottom of the output.  The phrase Non-authoritative answer indicates the TTL value received from the client (2 minutes 11 seconds before the local client checks the next level in the DNS chain). <br><br>  <i>How to check TTL value for DNS record in Unix / Linux / Mac?</i> <br><br>  On a Unix system (and its derivatives), the dig command is used to troubleshoot DNS problems. <br>  Example: dig <a href="http://www.varonis.com/">www.varonis.com</a> <br><br><img src="https://habrastorage.org/files/09b/b90/ec4/09bb90ec4b5748908bfe50e0f64571a9.png" alt="image"><br>  The TTL value is circled in red. <br><br>  <i>How to check the DNS record over the Internet?</i> <br><br>  Sometimes it happens that you need to check the DNS record without a computer at hand.  A convenient (and free) version of the dig command is available in the Google tools at the following address: <a href="https://toolbox.googleapps.com/apps/dig/">toolbox.googleapps.com/apps/dig</a> . <br><br><img src="https://habrastorage.org/files/e36/123/c40/e36123c40f35473a927035419a5d9801.png" alt="image"><br>  The TTL value is circled in red. <br><br>  <i>How to ensure TTL distribution for DNS record?</i> <br><br>  If you need to find out whether the DNS record settings are updated on a specific DNS server, then in any DNS tool (dig, nslookup, etc.), instead of the local default setting, you can select the DNS server that will be used for the query. <br><br>  For a complete picture of the changes, I recommend the whatsmydns.net resource, which allows you to check a lot of top-level DNS servers (the Internet provider level) and identify potential problems. <br><br><img src="https://habrastorage.org/files/b8a/d5d/35a/b8ad5d35adb546db9c3026091edff940.png" alt="image"><br><br>  <b>FUTURE ACTIONS TO SETUP A TTL FOR DNS RECORDS</b> <br><br>  Setting up a TTL for DNS records can be a daunting task, but if you select small values ‚Äã‚Äã(less than one hour), you can keep the network working and better prepare it for the changes. <br><br>  If you enjoyed this article, I also recommend that you familiarize yourself with our <a href="https://info.varonis.com/web-security-fundamentals">course</a> on the basics of web security.  This will help you better protect the site or application for which you have just configured a DNS record.  The course is free and very informative. </div><p>Source: <a href="https://habr.com/ru/post/324024/">https://habr.com/ru/post/324024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324010/index.html">File storage in the social network and other projects of the students of Innopolis University</a></li>
<li><a href="../324012/index.html">We saw the catalog of goods without touching relational algebra</a></li>
<li><a href="../324016/index.html">Network configuration in guest Ubuntu 16.04 Server on VirtualBox + Windows 7</a></li>
<li><a href="../324018/index.html">Welcome to GeekDay Evolution March 25</a></li>
<li><a href="../324022/index.html">Hacker for a fee destroyed data on fines for violating traffic rules</a></li>
<li><a href="../324026/index.html">The report on the results of "My Circle" for February 2017 and the most popular vacancies of the month</a></li>
<li><a href="../324028/index.html">Four kinds of accidents in Hearthstone</a></li>
<li><a href="../324030/index.html">Chaincode debugging in Hyperledger Fabric</a></li>
<li><a href="../324034/index.html">CSS slider</a></li>
<li><a href="../324036/index.html">Hackathon of Kaspersky Lab: save the gas oil processing plant from hackers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>