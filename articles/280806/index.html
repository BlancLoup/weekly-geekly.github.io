<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SSO for beauty and monster</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the picture - a silly beauty gives the user account of the monster. 

 In one country, there was an old ugly administration system for schools, wri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SSO for beauty and monster</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b99/46a/e84/b9946ae84b134094903fc8ee6c091327.jpg"><br>  In the picture - a silly beauty gives the user account of the monster. <br><br>  In one country, there was an old ugly administration system for schools, written in Classic ASP.  It was used by all teachers, students, as well as their parents.  And one beautiful sunny day they decided to modernize it.  Modern ASP.Net MVC 5 with a new design should replace the outdated technology. <br>  However, overnight, it is not possible to rewrite all 6000 asp files, for some time the old and new systems should exist in parallel. <br>  And now, six months later, the new, sparkling (although in some places, rust and patches still show up, because the deadlines), the system accepted the first users. <br>  The next step was to apply single sign-on ( <abbr title="Single sign-on">SSO</abbr> ) technology to users so that everyone could move freely between the still silly beauty and the full-featured monster. <br>  In addition, one of the largest learning management systems ( <abbr title="Learning management system">LMS</abbr> ) wanted to have tight integration with our administration system, including SSO. <br><a name="habracut"></a><br><br><h4>  Problem statement and problems </h4><br>  So, as input we have: 2500 schools, 1.5 million active users.  In the new system, each school has its own third-level domain, in the old - an arbitrary domain. <br>  You need to create an account provider (IdP) and use it in both systems to ensure switching between them without having to log in. <br>  The first problem is the multi-tenant application architecture.  The school database is separated from the rest, respectively, there is no single list of users. <br>  The second problem is the obsolete technology Classic ASP, for which it is difficult to find already existing solutions for the use of any IdP. <br>  The third problem is that already existing IdPs are used as the account provider, with which you need to continue working.  It turns out the chain: third-party IdP -&gt; our IdP -&gt; end user (Service Provider). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Selection of SSO technology </h4><br>  The task is not new and there are several ways to implement SSO.  Most popular protocols: <br><ul><li>  <abbr title="Security Assertion Markup Language">Saml</abbr> </li><li>  Openid </li></ul><br>  OAuth in our case is not suitable, because in fact it is an authorization protocol, and not authentication.  You can expand it, but it does not fit into other customer requirements. <br>  SAML 2.0 is still the global standard, even though it is old.  Some of the already existing IdPs mentioned above use this protocol to one degree or another.  In addition, LMS understands SAML, but does not use OpenID.  Therefore, it was decided to use SAML 2.0. <br>  The next step was to select a specific SAML implementation.  There are solutions out of the box and libraries, a list of which is easy to find on Wikipedia - <a href="https://en.wikipedia.org/wiki/SAML-based_products_and_services">SAML-based products and services</a> .  It was possible to use something ready and simple, like <a href="https://simplesamlphp.org/">SimpleSAMLphp</a> , but, firstly, it is php, with which there is little experience, and secondly, it needs to be separately hosted, maintained and monitored.  Proshstivste implementation on .Net and not finding a solution out of the box, chose the library from <a href="http://www.componentspace.com/saml/">ComponentSpace</a> , against the rest looking more mature.  In general, this decision was justified, although some unpleasant features of use were revealed, which will be discussed later. <br>  Multi-tenant application architecture revealed another task - what should be IdP and SP in the case of each particular school?  Two options: <br><ol><li>  Each school is a separate IdP.  Easy to implement, because all IdP users are stored in the same database.  It is quite enough to provide SSO between the old and the new systems.  It is very inconvenient for SSO with LMS or any other system - in fact, you need to register 2500 different IdPs in order to be able to enter any school. </li><li>  IdP is centralized, each school is a separate SP.  The implementation is not so simple, users are smeared on 2500 bases.  But integration with other systems is simplified and interesting opportunities appear in the future - to make a single login for all schools and for all roles.  In this case, a large parent with children in different schools will have only one login, and not many, as now. </li></ol><br>  Having discussed the options with the customer, we stopped at the second. <br>  For Classic ASP, we did not find any implementations, but we didn‚Äôt want to write ourselves either, and there was no time.  I had to dwell on the fact that the new system will have a proxy that the old one will use.  Not very nice, but it will work. <br>  It remained to receive confirmation from the customer and the paid version of ComponentSpace SAML 2.0 for .Net.  Now you can finally start writing code. <br><br><h4>  Authentication process </h4><br>  The problem of user base spreading has not been solved yet.  Since, in essence, the application is one and all schools have one subdomain (say, newsystem.localhost), you can not select the IdP in a separate application, but enter it inside an existing one.  It will be a pseudo-school with its third level domain "idp". <br>  In fact, we will have 2 different user IDs, this with OWIN can be done as follows: <br><pre><code class="cs hljs">app.UseCookieAuthentication(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CookieAuthenticationOptions { AuthenticationType = <span class="hljs-string"><span class="hljs-string">"SSO.ApplicationCookie"</span></span>, CookieDomain = <span class="hljs-string"><span class="hljs-string">".newsystem.localhost"</span></span>, ExpireTimeSpan = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), SlidingExpiration = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); app.UseCookieAuthentication(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CookieAuthenticationOptions { AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie, LoginPath = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PathString(<span class="hljs-string"><span class="hljs-string">"/Account/Login"</span></span>) });</code> </pre> <br>  The first cookie for an IdP user with a second level subdomain common to all schools.  Shelf life - 6 hours with automatic renewal during use.  The second is the usual cookie for the school user. <br>  Then each school at the right time will act as IdP. <br><br>  If the user is not yet authenticated at a particular school, ‚ÄúAccount / Login‚Äù will create a SAML request and send it to ‚ÄúSsoService‚Äù.  IdP processes this request and, if the user is not yet authenticated, sends it back to the school, but to a special ‚ÄúAccount / IdPLogin‚Äù page.  The school itself will process the login and password, authenticate the user, but not at home, but in IdP.  IdP itself can also complete the process - ‚ÄúSso / SsoCompete‚Äù responds to the request.  Next, the school is already acting as an SP and processes the answer in its ‚ÄúSso / AssertionConsumerService‚Äù. <br>  There is a small snag - sometimes we don‚Äôt know in which school the user has a login and password.  So it turns out, if the request came from a third-party system.  In this case, you can provide the user to choose the school.  It is inconvenient to choose from 2500 possible options, but you can optimize this process in several ways - remember the last selected school and let SP limit the list for selection by adding a custom SAML attribute to the request. <br>  Another problem is what if the current IdP user is not in the selected school?  Then we will show a special page with the ability for the current user to exit and initiate a new authentication. <br><div class="spoiler">  <b class="spoiler_title">Authentication process</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/5e9/cea/e12/5e9ceae12d534bc38f1479d130226f3d.png"></a> <br></div></div><br>  school.newsystem.localhost is both SP (left) and IdP (right) simultaneously. <br>  You can authenticate a user to Account / IdPLogin using your login and password for the school, or contact a third-party IdP. <br><div class="spoiler">  <b class="spoiler_title">Exit process diagram</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/5a5/bb9/f36/5a5bb9f3634448e8b2bd644b6ded8661.png"></a> <br></div></div><br>  Next come the implementation details, you can skip them if you don‚Äôt want to go deep into the details.  But I still recommend reading the result at the end anyway. <br><br><h4>  Configuration </h4><br>  We start with the most difficult - IdP and SP settings.  We decided that IdP will be one, but SP will be a lot.  2500 for the new system, 2500 for the old system and at least 1 more for the LMS.  ComponentSpace allows you to load settings from a file and programmatically.  So let's do both! <br>  The configuration file is called saml.config, there we put the general settings: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SAMLConfiguration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:componentspace:SAML:2.0:configuration"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Identity provider configuration --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IdentityProvider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:example:SAML:2.0:idp.newsystem.localhost"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LocalCertificateSerialNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blabla"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Service provider configuration --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServiceProvider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:example:SAML:2.0:idp.newsystem.localhost"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssertionConsumerServiceUrl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://idp.newsystem.localhost/sso/idp/sp/AssertionConsumerService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LocalCertificateSerialNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blabla"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Partner Identity providers configuration --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PartnerIdentityProvider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:3rdPartyIdP"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SignAuthnRequest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">WantSAMLResponseSigned</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">WantAssertionSigned</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">WantAssertionEncrypted</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SingleSignOnServiceUrl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://localhost:50320/SAML/SSOService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SingleLogoutServiceUrl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://localhost:50320/SAML/SLOService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PartnerCertificateSerialNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blabla"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Service providers configurations --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PartnerServiceProvider</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:lms"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">WantAuthnRequestSigned</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SignSAMLResponse</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SignAssertion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">EncryptAssertion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssertionConsumerServiceUrl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://lms.localhost/sso/sp/AssertionConsumerService.aspx"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SingleLogoutServiceUrl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://lms.localhost/sso/sp/SingleLogoutHandler.aspx"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PartnerCertificateSerialNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"blabla"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SAMLConfiguration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here we register <br><ul><li>  yourself as an IdentityProvider with a name (in fact, it is a globally unique identifier) ‚Äã‚Äã‚Äúurn: example: SAML: 2.0: idp.newsystem.localhost‚Äù and a certain certificate; </li><li>  yourself as a ServiceProvider with the same name and determine the path to our AssertionConsumerService and certificate; </li><li>  third-party IdentityProvider (in our case, this is just an example of the IdP from ComponentSpace), for which we are a ServiceProvider, with their certificates, paths and settings; </li><li>  Third-party ServiceProvider (in our case, this is LMS), for which we are IdP, with their certificates, paths and settings. </li></ul><br>  The last list includes only third-party systems, we will register our schools programmatically.  Certificates are needed to be able to sign and encrypt requests and responses.  When new third-party systems appear, we simply add them to this file, and everything will work without changing the code. <br><br>  Now at the start of the application you need to configure all other SP.  There is one feature - our application at different times acts as both IdP, and as one of 5000 SP.  Why 5000?  Because the proxy for the old system is in fact a separate set of 2500 SP.  ComponentSpace allows you to have an arbitrary number of configurations, which we will use. <br>  First, load the configuration from the file: <br><pre> <code class="cs hljs">SAMLConfiguration.Load();</code> </pre><br>  ComponentSpace will create the configuration itself with the predefined name ‚Äúdefault‚Äù.  Once created, it is current, so that it can be accessed through SAMLConfiguration.Current. <br>  Then we create the IdP configuration, essentially copying everything from the current one: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identityProviderConfigurationId = SAMLConfiguration.Current.LocalIdentityProviderConfiguration.Name; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> identityProviderConfiguration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SAMLConfiguration { LocalIdentityProviderConfiguration = SAMLConfiguration.Current.LocalIdentityProviderConfiguration, PartnerServiceProviderConfigurations = SAMLConfiguration.Current.PartnerServiceProviderConfigurations, LocalServiceProviderConfiguration = SAMLConfiguration.Current.LocalServiceProviderConfiguration, PartnerIdentityProviderConfigurations = SAMLConfiguration.Current.PartnerIdentityProviderConfigurations, ReloadOnConfigurationChange = SAMLConfiguration.Current.ReloadOnConfigurationChange, CertificateManager = SAMLConfiguration.Current.CertificateManager, TraceLevel = SAMLConfiguration.Current.TraceLevel }; SAMLConfiguration.Configurations.Add(identityProviderConfigurationId, identityProviderConfiguration);</code> </pre><br>  For the rest, this will be PartnerIdentityProviderConfiguration: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> partnerIdentityProviderConfigurations = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, PartnerIdentityProviderConfiguration&gt; { { identityProviderConfigurationId, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PartnerIdentityProviderConfiguration { Name = identityProviderConfigurationId, SignAuthnRequest = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, WantSAMLResponseSigned = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, WantAssertionSigned = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, WantAssertionEncrypted = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, SingleSignOnServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/sso/ssoservice"</span></span>, identityProviderHost), SingleLogoutServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/sso/sloidpservice"</span></span>, identityProviderHost), PartnerCertificateSerialNumber = identityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateSerialNumber, PartnerCertificateFile = identityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateFile, PartnerCertificateSubject = identityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateSubject, PartnerCertificateThumbprint = identityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateThumbprint } } };</code> </pre><br>  We create, using school domains, SP configurations, and supplement IdP with our own SPs for the new system: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spConfigurationId = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"urn:example:saml:2.0:{0}"</span></span>, domain); SAMLConfiguration.Configurations.Add(spConfigurationId, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SAMLConfiguration { LocalServiceProviderConfiguration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalServiceProviderConfiguration { Name = spConfigurationId, AssertionConsumerServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/sso/assertionconsumerservice"</span></span>, domain), LocalCertificateSerialNumber = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateSerialNumber, LocalCertificateFile = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateFile, LocalCertificatePassword = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificatePassword, LocalCertificatePasswordKey = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificatePasswordKey, LocalCertificateSubject = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateSubject, LocalCertificateThumbprint = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateThumbprint }, PartnerIdentityProviderConfigurations = partnerIdentityProviderConfigurations }); } identityProviderConfiguration .PartnerServiceProviderConfigurations .Add(spConfigurationId, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PartnerServiceProviderConfiguration { Name = spConfigurationId, WantAuthnRequestSigned = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, SignSAMLResponse = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, SignAssertion = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, EncryptAssertion = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, AssertionConsumerServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/sso/assertionconsumerservice"</span></span>, domain), SingleLogoutServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/sso/slospservice"</span></span>, domain), PartnerCertificateSerialNumber = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateSerialNumber, PartnerCertificateFile = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateFile, PartnerCertificateSubject = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateSubject, PartnerCertificateThumbprint = IdentityProviderConfiguration.LocalIdentityProviderConfiguration.LocalCertificateThumbprint });</code> </pre><br><br>  The same for proxy, the difference will be only in the ways: <br><pre> <code class="cs hljs"> AssertionConsumerServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/proxy/assertionconsumerservice"</span></span>, domain), SingleLogoutServiceUrl = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"https://{0}/proxy/sloservice"</span></span>, domain),</code> </pre><br>  In the course of work, a problem was discovered - ComponentSpace needs a session to store its internal information, and our ASP.Net MVC distributed application does not use the session.  Only for the sake of SSO to include it is not very correct, then someone will surely be tempted to put something else there, and went off, goodbye sessionless.  There is a way out - use Redis as SessionStore, for example: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SessionStore</span></span> : <span class="hljs-title"><span class="hljs-title">AbstractSSOSessionStore</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type type</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sessionObject = RedisSsoSessionComponent.Load(GetDatabaseSessionId(type)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sessionObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sessionObject.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? Deserialize(sessionObject) : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ssoSession</span></span></span><span class="hljs-function">)</span></span> { RedisSsoSessionComponent.Save(Serialize(ssoSession), GetDatabaseSessionId(ssoSession.GetType())); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SessionID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { CookieFacade.SsoSessionId; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDatabaseSessionId</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type type</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{0}:{1}"</span></span>, SessionID, type.Name); } }</code> </pre><br>  Here RedisSsoSessionComponent is engaged in direct communication with Redis.  There is a snag with the session ID, you can store it in cookies - in the CookieFacade we have the property SsoSessionId: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> cookieName = <span class="hljs-string"><span class="hljs-string">"SsoSessionId"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cookie = HttpContext.Current.Request.Cookies[cookieName]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookie != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(cookie.Value)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cookie.Value; } cookie = HttpContext.Current.Response.Cookies[cookieName]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookie != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(cookie.Value)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cookie.Value; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sessionId = Guid.NewGuid().ToString(); cookie = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpCookie(cookieName, sessionId); HttpContext.Current.Response.Cookies.Remove(cookie.Name); HttpContext.Current.Response.AppendCookie(cookie); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sessionId;</code> </pre><br>  If the desired cookie was not found, create a new identifier. <br>  It remains to connect our samopinny storage: <br><pre> <code class="cs hljs">SAMLConfiguration.SSOSessionStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SessionStore();</code> </pre><br>  The configuration is finally complete. <br><br><h4>  Necessary infrastructure </h4><br>  In the process, you need to distinguish which configuration to use for each request.  You can do this by changing SAMLConfiguration.ConfigurationID on the fly. <br>  Create attributes that will mark the necessary actions in the controllers: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SamlIdentityProviderAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ActionExecutingContext filterContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(SAMLConfiguration.ConfigurationID) || !SAMLConfiguration.ConfigurationID.Equals(SamlConfig.IdentityProviderConfigurationId, StringComparison.InvariantCultureIgnoreCase)) { SAMLConfiguration.ConfigurationID = SamlConfig.IdentityProviderConfigurationId; } <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuting(filterContext); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SamlServiceProviderAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ActionExecutingContext filterContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> spConfigurationId = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"urn:example:saml:2.0:{0}"</span></span>, domain); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(SAMLConfiguration.ConfigurationID) || !SAMLConfiguration.ConfigurationID.Equals(spConfigurationId, StringComparison.InvariantCultureIgnoreCase)) { SAMLConfiguration.ConfigurationID = spConfigurationId; } <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnActionExecuting(filterContext); } }</code> </pre><br><br><h4>  IdP logic </h4><br><div class="spoiler">  <b class="spoiler_title">All IdP actions can be added to a separate controller - SamlIdentityProviderController.</b> <div class="spoiler_text">  Ssoservice <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SAMLIdentityProvider.ReceiveSSO(Request, out partnerSp); //      ,   Low level API HTTPRedirectBinding.ReceiveRequest(HttpContext.Request, out authnRequestElement, out relayState, out signatureAlgorithm, out signature); domains = _ssoComponent.GetSchoolDomains(authnRequestElement); //          if (HttpContext.User.Identity.IsAuthenticated) { return RedirectToAction(MVC.SamlIdentityProvider.SsoComplete()); } //    IdPLogin  ,       return Redirect(GetDomainLoginUrl(domain)); //      ,      return RedirectToAction(MVC.SamlIdentityProvider.SchoolSelect());</span></span></code> </pre><br>  SsoComplete <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  SAML    var attributes = new Dictionary&lt;string, string&gt; { { Saml2Helper.Attributes.UserRoleKey, userIdentity.UserRole.ToString() }, { Saml2Helper.Attributes.UserFirstNameKey, userIdentity.FirstName }, { Saml2Helper.Attributes.UserLastNameKey, userIdentity.LastName } }; //    SAMLIdentityProvider.SendSSO(Response, userIdentity.UserIdentifier, attributes);</span></span></code> </pre><br>  Sloservice <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SAMLIdentityProvider.ReceiveSLO(Request, Response, out isRequest, out hasCompleted, out logoutReason, out partnerServiceProvider); //     IdP HttpContext.GetOwinContext().Authentication.SignOut(); //    SP,      SP SAMLIdentityProvider.SendSLO(Response, null); //      IdP SAMLServiceProvider.SendSLO(Response, null);</span></span></code> </pre><br>  SchoolSelect <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//        IdPLogin  </span></span></code> </pre><br>  Initso <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   SSO   IdP SAMLServiceProvider.InitiateSSO(Response, null, partnerIdP);</span></span></code> </pre><br>  AssertionConsumerService <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//     IdP SAMLServiceProvider.ReceiveSSO(Request, out isInResponseTo, out partnerIdP, out userName, out attributes, out relayState); //     var user = await userManager.FindAsync(new UserLoginInfo(‚ÄúIdP‚Äù, userId)); //       IdP    ,   SP await _nativeLoginProcessor.SignInAsync(user); return Redirect(MVC.SamlIdentityProvider.SsoComplete()); //      ‚Äú  ‚Äù</span></span></code> </pre><br>  IdpSpSloService <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//     IdP   SAMLServiceProvider.ReceiveSLO(Request, out isRequest, out logoutReason, out partnerIdP); //       HttpContext.GetOwinContext().Authentication.SignOut("SSO.ApplicationCookie"); //     SP SAMLIdentityProvider.InitiateSLO(Response, null); //     SP    SAMLIdentityProvider.SendSLO(Response, null);</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">AccountController will have a special action associated with IdP.</b> <div class="spoiler_text">  IdPLogin <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//          ,     IdP await _nativeLoginProcessor.SignInAsync(user); //      return RedirectToAction(MVC.SamlIdentityProvider.SsoComplete()); //     IdP   SSO return RedirectToAction(MVC.SamlIdentityProvider.InitSso(partnerIdP));</span></span></code> </pre><br></div></div><br><br><h4>  SP logic </h4><br><div class="spoiler">  <b class="spoiler_title">The main SP actions will be in SamlServiceProviderController.</b> <div class="spoiler_text">  AssertionConsumerService <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    IdP SAMLServiceProvider.ReceiveSSO(Request, out isInResponseTo, out partnerIdP, out userName, out attributes, out relayState); //     var user = await _samlServiceProviderComponent.FindUserAsync(attributes); //            ,     relayState await _nativeLoginProcessor.LocalSignInAsync(user); return RedirectToLocal(relayState); //            return RedirectToAction(MVC.SamlServiceProvider.LogOut());</span></span></code> </pre><br>  Sloservice <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SAMLServiceProvider.ReceiveSLO(Request, out isRequest, out logoutReason, out partnerIdP); //      HttpContext.GetOwinContext().Authentication.SignOut(DefaultAuthenticationTypes.ApplicationCookie); //   ,     IdP SAMLServiceProvider.SendSLO(Response, null); //    ,      return RedirectToAction(MVC.Account.Login());</span></span></code> </pre><br>  Logout <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      ‚Äú        ,  ,       ‚Äù</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">In addition, you need to change the SP-related actions in AccountController.</b> <div class="spoiler_text">  Login <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    IdP SAMLServiceProvider.InitiateSSO(Response, returnUrl, SamlConfig.IdentityProviderConfigurationId);</span></span></code> </pre><br>  Logoff <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      HttpContext.GetOwinContext().Authentication.SignOut(DefaultAuthenticationTypes.ApplicationCookie) //    IdP SAMLServiceProvider.InitiateSLO(Response, null);</span></span></code> </pre><br></div></div><br><br><h4>  Proxy logic for the old system </h4><br><div class="spoiler">  <b class="spoiler_title">Another controller is ProxyController.</b> <div class="spoiler_text">  Login - called by the old system when a user tries to enter it <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  SAMLServiceProvider.InitiateSSO(Response, relayState, SamlConfig.IdentityProviderConfigurationId);</span></span></code> </pre><br>  AssertionConsumerService <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    IdP SAMLServiceProvider.ReceiveSSO(Request, out isInResponseTo, out partnerIdP, out userName, out attributes, out relayState); //     var user = await _samlServiceProviderComponent.FindUserAsync(attributes); //        ,      ,   string timeStamp = DateTime.UtcNow.ToString("yyyyMMddHHmm"); string queryParams = string.Format("userId={0}&amp;userLoginProvider={1}√ótamp={2}&amp;auth={3}", userId, userLoginProviderKey, timeStamp, MD5Helper.ComputeHash(string.Format("{0}{1}{2}{3}", userId, userLoginProviderKey, timeStamp, "Secret"))); //            return RedirectToAction(MVC.Proxy.LogOut());</span></span></code> </pre><br>  InitiateSlo <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SAMLServiceProvider.InitiateSLO(Response, null);</span></span></code> </pre><br>  Sloservice <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SAMLServiceProvider.ReceiveSLO(Request, out isRequest, out logoutReason, out partnerIdP); //       ,        ProcessSlo</span></span></code> </pre><br>  ProcessSlo <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    SAMLServiceProvider.SendSLO(HttpContext.Response, null);</span></span></code> </pre><br>  Logout <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      ‚Äú        ,  ,       ‚Äù</span></span></code> </pre><br></div></div><br>  This is only the top of the process, inside there are still a lot of little things that are too long and uninteresting to write. <br><br><h4>  Result and conclusions </h4><br>  Switching to SSO is difficult and slow.  The owners of the old system were very skeptical and cautious about the idea itself and its implementation.  The transition took place gradually, in packs of 100‚Äì200 schools per week. <br>  The third pack started having problems with the speed of response from IdP.  It turned out that only one web server was allocated for it, although we asked to allocate at least 3 and control the number of requests, adding more servers if necessary.  The customer understood the error and corrected the situation.  Now 6 servers are serviced by 1.5 million users who are in the habit of logging in in the morning almost simultaneously. <br>  Next in 1000 schools, everything died suddenly.  Logs showed that Redis is not responding.  Here it must be mentioned that the customer himself volunteered to provide us with the necessary infrastructure and even bought Redis Labs Enterprise Cluster (RLEC).  And for some reason they set up a cluster not just for the requested 100 GB, but only by 5. When the data became more of this restriction, the RLEC just got up ... No warning, no crowding out of old data, just stopped responding to any requests.  Redis Labs technical support was very weak and slow - it took them a week to find the cause, they later called their recommendations erroneous, and in general had to re-create the entire cluster several times.  Now the cluster works without failures, but the sediment remains unpleasant. <br>  Libraries from ComponentSpace can be successfully used, although there are inconveniences in their structure - almost everything is static and not thread safe.  We had to carefully check everything ourselves, dig into the source code and, if necessary, wrap it up with our own thread-safe components.  This is more true for the High level API, which was not enough, in some places they used Low level.  In addition, the classes stored in the session are internal.  Therefore, for example, finding out the name of SP, whose request we are currently processing, is not so easy, despite the fact that we have access to SSOSessionStore.  I had to get the necessary data by reflection. <br>  In general, everything works perfectly, there is a huge potential for improvement and optimization, which is currently being gradually implemented. </div><p>Source: <a href="https://habr.com/ru/post/280806/">https://habr.com/ru/post/280806/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280796/index.html">WPS Pixie Dust Attack - Hacking a Wi-Fi network in 5 minutes. Vulnerability description</a></li>
<li><a href="../280798/index.html">Unable to check email address for validity using regular expressions</a></li>
<li><a href="../280800/index.html">Site links in Active Directory. We destroy the stereotype</a></li>
<li><a href="../280802/index.html">The digest of interesting materials from the world of Drupal # 19</a></li>
<li><a href="../280804/index.html">The effect of shirts on mobile shaders</a></li>
<li><a href="../280810/index.html">Use an Intel RealSense camera with TouchDesigner. Part 1</a></li>
<li><a href="../280812/index.html">Mythbusters: Automatic Google Recaptcha Solution</a></li>
<li><a href="../280814/index.html">Framework fastcgi container</a></li>
<li><a href="../280816/index.html">About the UHD-resolution restaurant table and other interactive technologies from Kodisoft</a></li>
<li><a href="../280818/index.html">As I wrote the library under IEC 870-5-104 on Arduino using Wireshark</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>