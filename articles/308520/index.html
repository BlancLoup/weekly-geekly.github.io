<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking MSBuild source code with PVS-Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While working on the development of the PVS-Studio static source code analyzer, we often encounter the need to check for errors from large open source...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking MSBuild source code with PVS-Studio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/0da/42d/73e/0da42d73ea184f6e93e57f998e0daf60.png" align="left">  While working on the development of the PVS-Studio static source code analyzer, we often encounter the need to check for errors from large open source projects from well-known developers.  The fact that even in such projects it is possible to find mistakes makes our work much more meaningful.  Unfortunately, everyone makes mistakes.  No matter how well the quality control system of the released program code is built, there is absolutely no way to avoid the peculiarities of the ‚Äúhuman factor‚Äù.  As long as people develop software, the relevance of using tools for finding errors in the code, such as PVS-Studio, will not decrease.  Today we will look for errors in the MSBuild source code, which, alas, is also not perfect. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  Microsoft Build Engine ( <a href="https://msdn.microsoft.com/en-us/library/dd393574.aspx">MSBuild</a> ) is a platform for automating the build of applications from Microsoft.  MSBuild is usually used with Microsoft Visual Studio, but does not depend on it.  MSBuild provides for the project file (* .csproj, * .vbproj, * .vcxproj) an XML schema that controls how the application platform processes and assembles applications.  MSBuild is part of the .NET platform and is developed in the C # programming language. <br><br>  Microsoft provides MSBuild source code for free download on the <a href="https://github.com/microsoft/msbuild">GitHub</a> resource.  Given the high quality standards of application development adopted by Microsoft, the task of finding errors in MSBuild source code is not easy even for a high-quality static analyzer.  But the road will be mastered by walking.  Let's check the source code of MSBuild with PVS-Studio version 6.07. <br><br><h2>  Baseline and general verification statistics </h2><br>  The MSBuild solution consists of 14 projects, which, in turn, contain a total of 1,256 files with source code in the C # programming language.  The approximate number of lines of code is 440,000. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After checking MSBuild with the static analyzer PVS-Studio, 262 warnings were received.  The general statistics of testing with the distinction of the importance of received warnings is: <br><br><p><img src="https://habrastorage.org/files/c93/f82/d2b/c93f82d2b4db41d28ed73f6be3c29ada.png"></p><br>  The diagram shows that 73 high level warnings, 107 medium warnings and 82 low warnings were issued.  The main emphasis should be placed on the study of messages with levels of High and Medium.  It contains potentially hazardous structures and real errors.  Low level alerts also indicate errors, but they have a high percentage of false positives, and we usually do not study them when writing articles. <br><br>  The analysis of the received warnings revealed that the High and Medium levels contain about 45% of erroneous constructions (81 errors).  The remaining warnings are not errors, but are simply constructions that are suspicious from the point of view of PVS-Studio and false positives.  Some warnings were received for Unit tests or in those parts of the code where there are comments explaining that the design is deliberately unsafe and is used to check for an exception is thrown.  Nevertheless, the remaining warnings of the analyzer require close attention of the developers, since only the authors really know their code and are able to give an adequate assessment of the correctness of a warning. <br><br>  With this in mind, the PVS-Studio error detection rate at the High and Medium levels per thousand lines of code (error density) is only 0.184 (errors / 1 KLoc).  This is not surprising for a product being developed by Microsoft, and indicates the high quality of the MSBuild code. <br><br>  We describe the results in more detail.  In this case, we note that the analysis of all warnings issued by the analyzer is beyond the scope of this article.  We confine ourselves to the description of the most interesting messages, grouping cases of the same type. <br><br><h2>  Test results </h2><br>  <b>Error check for null equality</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly an incorrect variable compared to null after type conversion using 'as' keyword.  Check variables 'obj', 'name'.  AssemblyRemapping.cs 64 <br><br>  Perhaps already a classic error, which occurs in almost every project we test.  After casting a type using the <i>as</i> operator, the wrong variable is checked for <i>null</i> equality: <br><br><pre><code class="cs hljs">AssemblyNameExtension name = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AssemblyNameExtension; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { return false; }</span></span></code> </pre> <br>  In this case, it is necessary to check the <i>name</i> variable for equality.  The correct code is: <br><br><pre> <code class="cs hljs">AssemblyNameExtension name = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AssemblyNameExtension; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  <b>Late equality test for null</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0504/">V3095</a> The 'diskRoots' object was used against null.  Check lines: 2656, 2659. ToolLocationHelper.cs 2656 <br><br>  Notice the <i>diskRoots</i> parameter.  This is an object of the <i>List</i> class <i>,</i> and its value can be <i>null</i> .  However, this fact is checked only in the second <i>if</i> block after the variable <i>diskRoots has</i> been used to insert values ‚Äã‚Äãinto the list: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtractSdkDiskRootsFromEnvironment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; diskRoots, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> directoryRoots</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!String.IsNullOrEmpty(directoryRoots)) { .... diskRoots.AddRange(splitRoots); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } if (diskRoots != null) // &lt;= .... }</span></span></code> </pre> <br>  In MSBuild code, another 8 similar potentially unsafe constructions were found: <br><br><ul><li>  V3095 The 'propertyValue' object was used before it was verified against null.  Check lines: 2760, 2799. Expander.cs 2760 </li><li>  V3095 The 'publicKeyToken' object was used before it was verified against null.  Check lines: 232, 236. GenerateBindingRedirects.cs 232 </li><li>  V3095 The 'searchLocation' object was used before it was verified against null.  Check lines: 170, 178. Resolver.cs 170 </li><li>  V3095 The 'assemblyName' object was used before it was verified against null.  Check lines: 176, 194. Resolver.cs 176 </li><li>  V3095 The 'searchLocation' object was used before it was verified against null.  Check lines: 249, 264. Resolver.cs 249 </li><li>  V3095 The 'ReferenceInfo' object was used before it was verified against null.  Check lines: 87, 97. AxReference.cs 87 </li><li>  V3095 The 'packageFileName' object was used before it was verified against null.  Check lines: 1448, 1457. BootstrapperBuilder.cs 1448 </li><li>  V3095 The 'metadataNames' object was used before it was verified against null.  Check lines: 243, 253. CommandLineBuilderExtension.cs 243 </li></ul><br>  <b>Wrong assumption about the length of the string</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0460/">V3057</a> The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  Utilities.cs 328 <br><br>  The condition for entering an <i>if</i> block is a string consisting of one or more characters.  In this case, an attempt is made inside the block to get the substring of the source string.  Obviously, in a string consisting of one character, the second parameter of the <i>Substring</i> method will be negative, and the method will throw an exception <br><br>  <i>ArgumentOutOfRangeException</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (toolsVersionList.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { toolsVersionList = toolsVersionList.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, toolsVersionList.Length - <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br>  A safe version of this code snippet would look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (toolsVersionList.Length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { toolsVersionList = toolsVersionList.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, toolsVersionList.Length - <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br>  Similar errors in the code: <br><br><ul><li>  V3057 The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  SolutionFile.cs 1217 </li><li>  V3057 The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  XMake.cs 2929 </li><li>  V3057 The 'Remove' function could receive the '-1' value while non-negative value is expected.  Inspect the first argument.  BootstrapperBuilder.cs 767 </li></ul><br>  <b>Type reduction with loss of accuracy</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0425/">V3041</a> The expression was implicitly cast from 'long' type to 'float' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  CommunicationsUtilities.cs 593 <br><br>  The variables <i>now</i> and <i>s_lastLoggedTicks</i> are of type <i>long</i> .  Calculations are made, the result of which must be a value of type <i>float</i> .  However, since the division operation is performed on variables of the <i>long</i> type, and only after this the result of the expression is reduced to the type of <i>float</i> , there will be a loss of precision: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> millisecondsSinceLastLog = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)((now ‚Äì s_lastLoggedTicks)/<span class="hljs-number"><span class="hljs-number">10000L</span></span>);</code> </pre> <br>  The correct version of this design: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> millisecondsSinceLastLog = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(now ‚Äì s_lastLoggedTicks)/<span class="hljs-number"><span class="hljs-number">10000</span></span>;</code> </pre> <br>  You should always be careful about computations that use integer and floating point values ‚Äã‚Äãtogether. <br><br>  <b>Method that always returns true</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0387/">V3009</a> It's one of those true values.  ComReference.cs 304 <br><br>  The <i>GetTypeLibNameForITypeLib</i> method returns <i>true</i> under any conditions: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTypeLibNameForITypeLib</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeLib2 == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } .... try { if (data == null || ...) { .... return true; // &lt;= } .... } catch (COMException ex) { .... return true; // &lt;= } return true; // &lt;= }</span></span></code> </pre> <br>  In this <i>case, the</i> value of type <i>bool</i> returned by the <i>GetTypeLibNameForITypeLib</i> method is checked in the calling code.  This behavior can lead to unpredictable consequences.  You need to refactor the code and fix the error. <br><br>  <b>Meaningless comparison</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'itemsAndMetadataFound.Metadata.Values.Count&gt; 0' is always true.  Evaluator.cs 1752 <br><br>  After <i>itemsAndMetadataFound.Metadata.Values.Count&gt; 0</i> is checked in the <i>if</i> external block, the same check, already meaningless, is performed inside the block: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemsAndMetadataFound.Metadata != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; itemsAndMetadataFound.Metadata.Values.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemsAndMetadataFound.Metadata.Values.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { needToProcessItemsIndividually = true; } .... }</span></span></code> </pre> <br>  In addition to this, 7 more similar errors were detected in the MSBuild code: <br><br><ul><li>  V3022 Expression 'fixedPathInfo! = Null' is always true.  FrameworkLocationHelper.cs 794 </li><li>  V3022 Expression '_shutdownException! = Null' is always false.  InProcNode.cs 527 </li><li>  V3022 Expression 'proj! = Null' is always true.  SolutionFile.cs 817 </li><li>  V3022 Expression '_directMetadata == null' is always false.  ProjectItem.cs 755 </li><li>  V3022 Expression 'Constants.defaultToolsVersion == "2.0"' is always true.  ToolsetReader.cs 194 </li><li>  V3022 Expression '! IsQuotedTransform &amp;&amp; functionCapture == null' is always true.  ExpressionShredder.cs 281 </li><li>  V3022 Expression '! IsQuotedTransform &amp;&amp; functionCapture == null' is always true.  ExpressionShredder.cs 414 </li></ul><br>  <b>Mutually exclusive comparisons</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0407/">V3011</a> Two opposite conditions were encountered.  The second condition is always false.  Check lines: 2840, 2838. XMake.cs 2840 <br><br>  The condition for entering the <i>if</i> block is that the variable <i>logger</i> is <i>null</i> .  However, already inside the block, the <i>VerifyThrow</i> method uses a check for the <i>null</i> inequality of the same variable.  Thus, the verification performed for the <i>VerifyThrow</i> method will always be false: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (logger == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { InitializationException.VerifyThrow(logger != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-comment"><span class="hljs-comment">// &lt;= "LoggerNotFoundError", unquotedParameter); }</span></span></code> </pre> <br>  It is difficult to say how the correct code should look, but definitely not.  Perhaps the use of the <i>if statement</i> in this case is not required at all. <br><br>  <b>Unused arguments when formatting a string</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0392/">V3025</a> Incorrect format.  A different number of items is expected while calling the 'WriteLine' function.  Arguments not used: 1st.  Scheduler.cs 2216 <br><br>  The error is contained in the second line of code.  Apparently, it was obtained by copying the first line (the notorious copy-paste) and replacing the first parameter in it.  At the same time, the second parameter which became unnecessary <i>_schedulingData.EventTime.Ticks</i> , was forgotten to be deleted: <br><br><pre> <code class="cs hljs">file.WriteLine(<span class="hljs-string"><span class="hljs-string">"Scheduler state at timestamp {0}:"</span></span>, _schedulingData.EventTime.Ticks); file.WriteLine(<span class="hljs-string"><span class="hljs-string">"------------------------------------------------"</span></span>, _schedulingData.EventTime.Ticks); <span class="hljs-comment"><span class="hljs-comment">// &lt;=</span></span></code> </pre> <br>  Thus, in the second line of the code, the overload of the <i>WriteLine</i> method <i>(string format, object arg0) is</i> mistakenly used instead of the correct one. <br><br>  Similar errors found: <br><br><ul><li>  V3025 Incorrect format.  A different number of formatted items is expected while calling 'Format' function.  Arguments not used: resource.  XmlUtil.cs 75 </li><li>  V3025 Incorrect format.  A different number of formatted items is expected while calling 'Format' function.  Arguments not used: resource.  XmlUtil.cs 82 </li><li>  V3025 Incorrect format.  A different number of formatted items is expected while calling 'Format' function.  Arguments not used: resource.  XmlUtil.cs 91 </li><li>  V3025 Incorrect format.  A different number of formatted items is expected while calling 'Format' function.  Arguments not used: resource.  XmlUtil.cs 112 </li></ul><br>  <b>Unused parameter</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0468/">V3061</a> Parameter 'numericValue' is always rewritten.  NodePacketTranslator.cs 320 <br><br>  The list of formal parameters of the method contains the variable <i>numericValue</i> , the value of which is never used, since it is immediately replaced by a new value: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TranslateEnum&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numericValue) { numericValue = _reader.ReadInt32(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= Type enumType = value.GetType(); value = (T)Enum.ToObject(enumType, numericValue); }</span></span></code> </pre> <br>  The code may have been refactored, but the method signature (unlike its body) could not be changed.  Otherwise, it makes sense to adjust this method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TranslateEnum&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numericValue = _reader.ReadInt32(); Type enumType = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = (T)Enum.ToObject(enumType, numericValue); }</code> </pre> <br>  Another similar warning: <ul><li>  V3061 Parameter 'defaultToolsVersion' is always rewritten.  ToolsetProvider.cs 118 </li></ul><br>  <b>Extra assignment</b> <br><br>  <b>PVS-Studio analyzer warning:</b> <a href="http://www.viva64.com/ru/d/0403/">V3005</a> The '_nextProjectId' variable is assigned to itself.  LoggingService.cs 325 <br><br>  The analyzer detected a construction in which an extra assignment is made for the <i>_nextProjectId</i> field.  First, the <i>MaxCPUCount + 2</i> value is calculated, which is added to the <i>_nextProjectId</i> value and assigned to it by the <i>+ =</i> operator.  And then the resulting value is once again assigned to the <i>_nextProjectId</i> field: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NextProjectId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (_lockObject) { _nextProjectId = _nextProjectId += MaxCPUCount + <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= return _nextProjectId; } } }</span></span></code> </pre> <br>  In this case, there is no error, but the code looks strange.  It makes sense to simplify this construction: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NextProjectId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (_lockObject) { _nextProjectId += MaxCPUCount + <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _nextProjectId; } } }</code> </pre> <br><h2>  Conclusion </h2><br>  In conclusion, I would like to note how useful regular use of static code analyzers, such as PVS-Studio, can be for searching for potential and real errors, even in such quality projects as MSBuild. <br><br>  You can always repeat the error search examples given in this article, as well as check your own projects with the help of the demo version of the <a href="http://www.viva64.com/ru/pvs-studio-download/">PVS-Studio</a> analyzer. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0424/"><img src="https://habrastorage.org/files/a93/b92/8e5/a93b928e5b2e4ad6b0b247a63f47be92.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Khrenov.  <a href="http://www.viva64.com/en/b/0424/">Checking the Source Code of MSBuild with PVS-Studio</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/308520/">https://habr.com/ru/post/308520/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308508/index.html">Modern art on the screen of a hardware company engineer</a></li>
<li><a href="../308510/index.html">Microsoft offers free Windows Server 2016 Datacenter licenses for customers who refuse VMware</a></li>
<li><a href="../308512/index.html">Attackers use Twitter to manage malware for Android</a></li>
<li><a href="../308514/index.html">How to find out what kind of flowers to give to a girl, if only her head moves and she cannot speak?</a></li>
<li><a href="../308516/index.html">1 second loading acceleration gave a 10% conversion increase: case Staples</a></li>
<li><a href="../308522/index.html">What Google is silent on and why you should use Apache HttpComponents in Android</a></li>
<li><a href="../308526/index.html">Math on the fingers: let's count at least one row of Fourier in the mind</a></li>
<li><a href="../308528/index.html">About Legacy code without maximalism: what to do</a></li>
<li><a href="../308532/index.html">Selection of programming podcasts in Russian and English</a></li>
<li><a href="../308534/index.html">R and Spark</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>