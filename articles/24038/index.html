<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Eval or include?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am developing one of the current projects on my own framework, running it in parallel and finishing it. Why did I need to reinvent the wheel, and ho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Eval or include?</h1><div class="post__text post__text-html js-mediator-article">  I am developing one of the current projects on my own framework, running it in parallel and finishing it.  Why did I need to reinvent the wheel, and how it differs from the existing ones, I will write when I present it to the public.  Now I want to share some thoughts about performance and at the same time listen to the opinions of colleagues.  Perhaps my observations will be useful to those who do not use frameworks. <img src="https://habrastorage.org/getpro/habr/post_images/842/75d/bb3/84275dbb38214aafef60cd7f25bebcfa.gif" width="1" height="1"><br><br>  When I had to implement a comment tree, I encountered the need to recursively call a view (view in MVC).  Since I, and practically everywhere, have views, these are regular files with chunks of HTML code and the ability to insert PHP, they are connected using include.  I felt uneasy when I introduced how this include is called recursively hundreds of times.  The first thought is to thrust the presentation file at the first request into memory and then execute it via eval.  This approach will allow caching the code of views, and even store it in a database.  Since eval eats only PHP, and our views are not pure PHP code, we frame the contents in '?&gt;' And '&lt;? Php'. <br><br><a name="habracut"></a>  So, for the cause. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Tests </h2> To begin with, in various ways in a loop, we will derive a simple view 'view.php' containing, for example: <code>i=&lt;?=$i?&gt;</code> <br><br><table><tbody><tr><td>  <b>Code</b> </td><td>  <b>Time</b> with <br>  <font><nobr>(in brackets - with eAccelerator)</nobr></font> </td></tr><tr><td><pre>  for ($ i = 0; $ i &lt;100; $ i ++) include ('view.php'); </pre></td><td>  0.0058141 <font>(0.002068)</font> </td></tr><tr><td><pre>  for ($ i = 0; $ i &lt;100; $ i ++) {$ code = '?&gt;'. file_get_contents ('view.php'). '&lt;? php';  eval ($ code);  } </pre></td><td>  0.005527 <font>(0.0056472)</font> </td></tr><tr><td><pre>  $ code = '?&gt;'. file_get_contents ('view.php'). '&lt;? php';  for ($ i = 0; $ i &lt;100; $ i ++) {eval ($ code);  } </pre></td><td>  0.0015929 <font>(0.0016122)</font> </td></tr></tbody></table><br><br>  And recursively <br><br><table><tbody><tr><td>  <b>Code</b> </td><td>  <b>Time</b> with <br>  <font><nobr>(in brackets - with eAccelerator)</nobr></font> </td></tr><tr><td><pre>  $ i = 0;  include ('view.php');  ---------- view.php ---------- html &lt;? php if (++ $ i &lt;100) {include ('view.php');  }?&gt; </pre></td><td>  0,006865 <font>(0,0019491)</font> </td></tr><tr><td><pre>  $ i = 0;  $ code = '?&gt;'. file_get_contents ('view.php'). '&lt;? php';  eval ($ code);  ---------- view.php ---------- html &lt;? php if (++ $ i &lt;100) {$ code = '?&gt;'. file_get_contents ('view. php ').' &lt;? php ';  eval ($ code);  }?&gt; </pre></td><td>  0.008599 <font>(0.0087898)</font> </td></tr><tr><td><pre>  $ i = 0;  $ code = '?&gt;'. file_get_contents ('view.php'). '&lt;? php';  eval ($ code);  ---------- view.php ---------- html &lt;? php if (++ $ i &lt;100) {eval ($ code);  }?&gt; </pre></td><td>  0.0034332 <font>(0.0032461)</font> </td></tr></tbody></table><br><br><h2>  findings </h2>  The first thing that catches your eye is that options with eval cannot be optimized and cached with eAccelerator.  Therefore, if you use it and you do not need other advantages of eval, it is better to stop at include. <br><br>  Using eval makes sense where views are called multiple times, but it is not possible to use accelerators.  Or if views are stored in the database. <br><br>  The error handling in eval is a bit different.  If an error of code parsing occurs, for example, the script execution is not interrupted.  This can be useful in some cases.  But at the same time, the error message looks different, which can be a bit confusing: <br><br> <code>Parse error: syntax error, unexpected T_ECHO, expecting ')' in /www/test/eval_vs_include/test.php(39) : eval()'d code on line 4</code> <br> <br>  Here the indicated error occurred in the 4th line of the view.php file, which was fed into eval, located in the 39th line of the test.php file.  Of course, nothing prevents us from displaying the name of the included file, if eval returned false.  Considering that the work on errors is not a regular mode, and errors are not displayed on the working draft, I consider this drawback to be not significant. <br><br><h3>  Eval </h3>  + Faster than include if accelerators are not used <br>  + Possibility of caching the code of views in the framework or template engine <br>  + Ability to store views in the database <br>  + Script execution is not interrupted when errors occur. <br>  <font color="#ff3300">- Not optimized and not cached by external accelerators</font> <font color="#ff3300"><br></font>  <font color="#ff3300">- The output of errors differ from the usual</font> <font color="#ff3300"><br></font>  <font color="#ff3300">- On some hosting eval may be prohibited</font> <br><br><h3>  Include </h3>  + Works everywhere <br>  + External accelerators greatly increase productivity <br>  <font color="#ff3300">- Low speed without accelerators</font> <font color="#ff3300"><br></font>  <font color="#ff3300">- There is no possibility to cache the code connected from the file in your engine</font> <font color="#ff3300"><br></font>  <font color="#ff3300">- Link code can only be in the file</font> <br><br>  It should be noted that the CodeIgniter eval framework is also used to display views, but only if the settings indicate the need to replace short '&lt;? =' With '&lt;? Php esho' and the short tags in PHP settings will be disabled.  In all other cases, include is used.  CakePHP always uses include. </div><p>Source: <a href="https://habr.com/ru/post/24038/">https://habr.com/ru/post/24038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../24037/index.html">Yahoo! Profit in the first quarter of 2008. increased more than 3 times</a></li>
<li><a href="../240373/index.html">New course from the School of Interface Development. In Yekaterinburg and everywhere</a></li>
<li><a href="../240375/index.html">Objects in javascript and create js component. Part 1</a></li>
<li><a href="../240377/index.html">Vulnerability of zero day in Microsoft Windows (the patch will be available today)</a></li>
<li><a href="../240379/index.html">Dear bytes of the past millennium</a></li>
<li><a href="../240383/index.html">Firefox 33 release</a></li>
<li><a href="../240385/index.html">Thread-safe events in C # or John Skeet vs. Jeffrey Richter</a></li>
<li><a href="../240387/index.html">Create a testing department</a></li>
<li><a href="../240389/index.html">Check your hoster for Shellshock vulnerability (part 2)</a></li>
<li><a href="../24039/index.html">Time line - to be or not to be?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>