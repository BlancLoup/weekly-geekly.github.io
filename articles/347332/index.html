<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We read data from the open part of KOMPAS-3D files for integration with Pilot-ICE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KOMPAS-3D files contain information about the document: the name and designation of the drawing, the name of the developer checking and approving, the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We read data from the open part of KOMPAS-3D files for integration with Pilot-ICE</h1><div class="post__text post__text-html js-mediator-article">  KOMPAS-3D files contain information about the document: the name and designation of the drawing, the name of the developer checking and approving, the type of document, format, number of sheets.  When an enterprise uses a system to automate workflow, the designer often has to enter this information manually. <br><br><img src="https://habrastorage.org/webt/iu/z0/cf/iuz0cfr5lj-vizivlbpjzgr0zpg.png" alt="image"><br>  <i>Adding a document to the workflow system (Document Card)</i> <br><br>  The data to be entered into the card may already be in the source file, and therefore the input process can be automated. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Library for receiving data from KOMPAS-3D </h3><br><br>  Beginning with version 16 in the KOMPAS-3D data format, major changes have occurred.  Firstly, it became more open, and secondly, the file size decreased.  The format of KOMPAS-3D files version 16 and higher is a zip-archive that contains metadata in XML format with information about attributes and objects of this document.  To read the KOMPAS-3D files, I developed the .NET library <a href="https://habr.com/ru/company/ascon/blog/347332/">KompasFileReader</a> , which is published under the MIT license [1]. <br><br><h3>  Integration with the workflow system </h3><br>  We use <a href="http://pilotems.com/">Pilot-ICE</a> as a workflow system.  The algorithm of the user in the system is very simple.  All the source files in the design are on a virtual disk Pilot-Storage, like Dropbox.  If it is required to publish an electronic document and complete its approval, the Pilot-XPS virtual printer is used; as a result of printing, an electronic document is generated.  The user selects a folder in the electronic archive and fills in the document card, then saves the document to the archive and coordinates it (if required).  But if we work in the KOMPAS-3D system, correctly and accurately draw up the documents and as a result, fill out the main title of the drawing, we can automatically transfer the data from the main title to the Pilot-ICE document card.  How to create such a plugin will be written below. <br><br>  The Pilot-ICE system supports the ability to develop plug-ins, the SDK can be downloaded <a href="https://pilot.ascon.ru/">from the link</a> in the download center [3]. <br><br>  You can create a new project according to the instructions from the SDK (Documentation.html). <br><br>  In order to automatically fill out a document card, it is necessary to intercept the call to print a virtual printer and load a document card. <br><br>  The plugin must use the IAutoImportHandler and IObjectCardHandler interfaces.  To analyze the source file, you need to implement the IAutoImportHandler interface's Handle method, and also for filling the card, the method with the exact same interface name IObjectCardHandler. <br>  Fragment of the plugin: <br><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> Ascon.Pilot.SDK.KompasAttrAutoImport { [Export(typeof(IAutoimportHandler))] [Export(typeof(IObjectCardHandler))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KompasAttrAutoImport</span></span></span><span class="hljs-class"> :</span></span> IAutoimportHandler, IObjectCardHandler, ... { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filePath, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sourceFilePath, AutoimportSource autoimportSource)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IAttributeModifier modifier, ObjectCardContext context)</span></span></span><span class="hljs-function"> </span></span>{ ... } } }</code> </pre> <br><br><h4>  Retrieving and analyzing the source file </h4><br>  We intercept the path to the source file, which we print, we analyze the file and get its attributes. <br><br><pre> <code class="hljs coffeescript">public bool Handle(string filePath, string sourceFilePath, AutoimportSource autoimportSource) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (string.IsNullOrWhiteSpace(sourceFilePath)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    .  . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsFileExtension(sourceFilePath, CDW_EXT) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; using (var inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(sourceFilePath, FileMode.Open, FileAccess.Read)) { var ms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(); inputStream.Seek(<span class="hljs-number"><span class="hljs-number">0</span></span>, SeekOrigin.Begin); inputStream.CopyTo(ms); ms.Position = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsFileExtension(sourceFilePath, SPW_EXT)) { var taskOpenSpwFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Task&lt;SpwAnalyzer&gt;(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpwAnalyzer(ms)); taskOpenSpwFile.Start(); taskOpenSpwFile.Wait(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (taskOpenSpwFile.Result.IsCompleted) { var spc = taskOpenSpwFile.Result.GetSpecification; spc.FileName = sourceFilePath; _doc = spc; } ... } ... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br><br><h4>  Filling the document card </h4><br>  Immediately after printing, a document card opens, intercepts its fields and fills them based on the data obtained above. <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool Handle(IAttributeModifier modifier, ObjectCardContext context) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isObjectModification = context.EditiedObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isObjectModification || context.IsReadOnly) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_doc == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> docProp = _doc.GetProps(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pairPilotKompasAttr <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _pairPilotKompasAttrs) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = docProp.FirstOrDefault(x =&gt; x.Name == pairPilotKompasAttr.NamePropKompas)?.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) modifier.SetValue(pairPilotKompasAttr.NameAttrPilot, ValueTextClear(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br><br>  where _pairPilotKompasAttrs is a pair of attribute name values ‚Äã‚Äãin the Pilot ICE and KOMPAS-3D systems. <br>  * Listings are given in a simplified form, you can see in more detail on the project page [1]. <br><br><h4>  Demonstration of work </h4><br>  As an example, we take any drawing that is on the Pilot-Storage. <br><br><img src="https://habrastorage.org/webt/y6/at/fx/y6atfxkc3hmytv-w-ucqjzbl8lk.png" alt="image"><br>  <i>The drawing must be filled with the title block.</i> <br><br><img src="https://habrastorage.org/webt/z-/-u/by/z--ubyk6iekryd6y0voghmfbone.png" alt="image"><br>  <i>We print to a virtual printer.</i> <br><br><img src="https://habrastorage.org/webt/4i/_j/vi/4i_jvi252axyt3fizkwwigywk8u.png" alt="image"><br>  <i>Perfectly!</i>  <i>The document card is filled automatically!</i> <br><br><h3>  Plugin Setup </h3><br>  To adapt the plug-in to the configuration of your enterprise, we will provide the ability to customize the correspondence between the attributes of KOMPAS-3D and the attributes of the workflow system. <br>  To do this, you can use the JSON format and store this data in the general system settings. <br><br>  <i>Settings example:</i> <br><pre> <code class="javascript hljs">[{ <span class="hljs-string"><span class="hljs-string">"NameAttrPilot"</span></span>: <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-string"><span class="hljs-string">"NamePropKompas"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }, { <span class="hljs-string"><span class="hljs-string">"NameAttrPilot"</span></span>: <span class="hljs-string"><span class="hljs-string">"mark"</span></span>, <span class="hljs-string"><span class="hljs-string">"NamePropKompas"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } ]</code> </pre><br><br>  where NameAttrPilot is the attribute name in the Pilot-ICE system, you can see it in Pilot-myAdmin, <br>  NamePropKompas is the attribute name in the KOMPAS-3D system, you can find out by opening the KOMPAS-3D file as a zip-archive and examining the MetaInfo file. <br><br><h3>  References: </h3><br><br><ol><li><a name="CADReader"></a>  Plugin for integration of the Pilot-ICE system with KOMPAS-3D - <a href="https://github.com/kozintsev/Pilot.CADReader">github.com/kozintsev/Pilot.CADReader</a> . </li><li>  Pilot-ICE - a system for managing a project organization - <a href="http://pilotems.com/">pilotems.com</a> . </li><li>  Download Center Pilot - <a href="https://pilot.ascon.ru/">pilot.ascon.ru</a> . </li></ol><br><br>  Oleg Kozintsev </div><p>Source: <a href="https://habr.com/ru/post/347332/">https://habr.com/ru/post/347332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347320/index.html">Navalny Headquarters IT infrastructure and collection of signatures: Reaper-2018</a></li>
<li><a href="../347322/index.html">Not a feature, but a bug</a></li>
<li><a href="../347324/index.html">Risks of using virtual number services for receiving SMS when registering on Internet resources</a></li>
<li><a href="../347328/index.html">Creating parametric database objects in nanoCAD Mechanics (Part 2)</a></li>
<li><a href="../347330/index.html">Developing AI for a turn-based game on Node.js (part 2)</a></li>
<li><a href="../347338/index.html">The obvious benefit: how and why to use the service approach beyond IT</a></li>
<li><a href="../347340/index.html">Scales and barcodes: How retailers and manufacturers ended up in a deep ... puddle</a></li>
<li><a href="../347342/index.html">Navalny Headquarters IT infrastructure and signature collection: project management</a></li>
<li><a href="../347344/index.html">Features of industrial aerial photography. Part I. Preparatory rake</a></li>
<li><a href="../347346/index.html">How to use all the features of mobile OS in React Native</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>