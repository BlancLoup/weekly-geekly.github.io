<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ABBYY FlexiCapture Engine 10.0: we train flexibility with the new tool</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the range of our products for developers replenishment - the next version of ABBYY FlexiCapture Engine has been released. Let me remind you that th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ABBYY FlexiCapture Engine 10.0: we train flexibility with the new tool</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e40/44a/227/e4044a2272d7107f2fb78fa312e36ae7.jpg" align="right">  In the range of our products for developers replenishment - the next version of ABBYY FlexiCapture Engine has been released.  Let me remind you that this is a product that allows you to embed data entry technology from images (data capture) into user solutions. <br><br>  One of the interesting features of the new version was the ability to quickly configure to extract data from documents of simple types.  My colleagues <a href="http://habrahabr.ru/company/abbyy/blog/130459/">have already told</a> Habr readers how this function is implemented in FlexiLayout Studio 10. An API has been added to the new version of the product, which gives full programmatic access to this functionality.  In addition, we made an easy-to-use tool (also available as source code) that allows you to tune in to the user's task in just a few minutes (as shown here in <a href="http://youtu.be/3aNKJ4Xu6Z4">this video</a> ) and make a quick working prototype of the solution, without going deep into the subtleties of technology. <br><br>  This article is written by a developer for developers and will tell you about the possibilities and limitations of this technology - something that you will not find in marketing materials. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of the well-known problems that stand in the way of the wide use of data capture technologies is the high initial investment of time and effort to customize work with the required types of images.  Developing an integrator needs to learn how to work with a variety of tools and understand the intricacies of a fairly complex technology, which often does not correspond to its main job profile and previous experience.  Only after that he can assemble the simplest prototype of a ready-made solution and evaluate the effectiveness and feasibility of the entire project. <br><br>  The new toolkit allows you to postpone a deep acquaintance with the technology either at the stage of fine-tuning the ready-made solution before release, or even at version two.  It cannot completely replace an advanced tool such as FlexiLayout Studio, but it allows you not to over-work in simple cases or in more complex cases to quickly get a simplified working prototype. <br><br>  As we already described <a href="http://habrahabr.ru/company/abbyy/blog/125347/">in this article</a> , the actual data extraction using the API requires only a few lines of code, among which, however, there is this: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//            IFlexiCaptureProcessor processor = engine.CreateFlexiCaptureProcessor(); processor.AddDocumentDefinitionFile( sampleFolder + "Invoice_eng.fcdot" );</span></span></code> </pre> <br>  This single line of code sets up a job for a specific type of document.  The file with the FCDOT extension ( <b>F</b> lexi <b>C</b> apture <b>DO</b> cument <b>T</b> emplate) contains a description of the extracted data with constraints imposed, a way to find this data on the image, recognition settings and, optionally, settings for exporting document data. <br><br>  When working with examples, everything is simple - the required document definition file is attached.  However, how to get a similar definition of the document for the current task, just to ‚Äútouch‚Äù, how will it work? <br><br>  Before the release of the 10-ki, in any case, it was necessary to install the desktop version of FlexiCapture and learn how to work with the document definition editor (for working with documents with a rigid structure with well-defined reference frames), and in most cases even more learn to work with the tool for describing the flexible layout of documents FlexiLayout Studio.  At the same time, you would hardly have been able to create even the simplest working version of a ‚Äúgathering‚Äù - you almost certainly would have to thoughtfully read the documentation for both tools or take a course. <br><br>  What now?  Now we have a simple example, the <b>Automatic Template Generation</b> tool, made in the form of a wizard that will help you get a satisfactory working prototype in a few minutes.  Let's look at an example of how this works. <br><br><h4>  Task </h4><br> <a href=""><img src="https://habrastorage.org/storage2/429/1cf/2c9/4291cf2c9a010b9493405b9c76ce653b.jpg" align="right"></a>  Suppose we want to write an application for registering checks in some accounting system and we have a pack of scanned checks.  We will select the same type checks from this pack and try to make a prototype of the document definition (document template) for our application. <br><br>  I will tell you in advance about the possibilities and limitations: <br><br>  ‚Ä¢ we <b>can not</b> make a universal template that works well with arbitrary checks - our template will work well with more or less of the <b>same type of</b> checks, preferably from one source <br>  ‚Ä¢ in the current version we will <b>not be able to</b> describe complex structures of the type of tables;  for such things you need to study FlexiLayout Studio <br>  ‚Ä¢ but we can completely extract such ‚Äúflat‚Äù data as <b>number, date, amount</b> , etc. <br><br><h4>  Decision </h4><br>  So, let's begin.  First we need a daddy with several (3-5 pcs.) Images of the type of interest to us.  This will be the training images folder.  At this stage, we would like good-quality images so that there is no excessive ‚Äúnoise‚Äù in the data and the pattern would match the case with perfect recognition. <br><br>  1. Run the wizard and specify the path to our folder: <br> <a href=""><img src="https://habrastorage.org/storage2/184/756/eb9/184756eb933f0fbb4d03000eb83912a2.jpg"></a> <br><br>  2. Choose a language: <br> <a href=""><img src="https://habrastorage.org/storage2/cbe/561/35a/cbe56135a12be35e887aed43cb1c5892.jpg"></a> <br><br>  3. ‚ÄúDraw‚Äù the extracted fields and give them the names: <br> <a href=""><img src="https://habrastorage.org/storage2/48a/45c/095/48a45c095646f715b97771b77dfcd9ed.jpg"></a> <br><br>  4. Now we need to draw reference elements.  This is the only not quite trivial step in the whole process.  Supporting elements are a few selected static (that is, permanent) objects in the image (usually text) for which fields with variable content are searched.  Usually, as in our example (see screenshot), field names are good candidates for supporting elements. <br><br><div class="spoiler">  <b class="spoiler_title">Mistress note</b> <div class="spoiler_text">  Nb.  The reference element does not have to be in each field.  This may be one permanent line on a small document, relative to which the fields are fairly rigid.  There should not be too many supporting elements so as not to cause unnecessary confusion.  The text of the support element can change, the main thing is that the semantics be preserved: in our case, instead of ‚ÄúTotal:‚Äù, on some checks there could be ‚ÄúTotal:‚Äù - in the process of learning it would be necessary to simply indicate once that this is the same thing.  It is important that the text is unique - for example, if ‚ÄúTotal‚Äù and ‚ÄúTotal with VAT‚Äù are simultaneously present on the document, then the separate word ‚ÄúTotal‚Äù will be a poor support. <br></div></div><br> <a href=""><img src="https://habrastorage.org/storage2/0c2/c44/d33/0c2c44d3368c9079a48249a9a3402a38.jpg"></a> <br><br>  5. Next we sequentially go through all the images in our training package and check the markup.  The system for each image offers a variant of the markup, which is obtained from the results of training on the already proven images.  Our task is to correct the errors: correct the geometry of the fields, draw the missing ones, delete the extra ones.  In our case, there are no errors in the overlay after the first picture, but there are minor problems with recognition. <br><br><div class="spoiler">  <b class="spoiler_title">Mistress note</b> <div class="spoiler_text">  Nb.  Problems with recognition happen due to the fact that we use the default recognition parameters where we could refine them (for example, set the font type - dot matrix printer and limit the possible alphabet or set a regular expression for some fields).  In the API, this possibility is already now, but in the considered tool there is no such functionality yet. <br><br>  Nb.  Some field may be missing in some images. <br><br>  Nb.  Through the menu Template \ Modify Language and Fields, you can return to editing the language and fields at any time if you have forgotten something. <br></div></div><br><br> <a href=""><img src="https://habrastorage.org/storage2/00c/266/905/00c26690534b23a69a393a76c613d569.jpg"></a> <br><br>  6. After we have completed training on selected images, it is suggested to check the resulting template.  We answer ‚Äúyes‚Äù and select as a test folder where all the images of the desired type that we have are located. <br><br>  Consistently for each image from the folder we are offered the results of the overlay.  Our task is to click Succeeded or Failed to collect statistics.  If the template is not superimposed on some image, and the image looks quite normal, we can add it to the test package by clicking the Add current image to the training batch button.  After the test is completed, it will be possible to ‚Äúlearn from the added pictures‚Äù and, thus, consistently improve the template. <br><br><div class="spoiler">  <b class="spoiler_title">Mistress note</b> <div class="spoiler_text">  Nb.  At this stage, you can mix in the package for training images of lower quality, to take into account common errors.  The main thing is not to overdo it. <br>  Nb.  You can stop working with the application at any time.  When you restart, you can continue from where you left off.  Moreover, we can always return to our ‚Äúproject‚Äù if in a week or a month we have new images in which we want to improve our work. <br></div></div><br> <a href=""><img src="https://habrastorage.org/storage2/638/3da/8e6/6383da8e604b38f47774ae012d4b06cc.jpg"></a> <br><br>  7. After we are satisfied with the result, the last thing left for us to do is export the resulting template to the FCDOT file, which is how it all started, and go back to writing the code for our application. <br> <a href=""><img src="https://habrastorage.org/storage2/ec5/2fe/284/ec52fe284d88cc5e2c943d5a7146d4f7.jpg"></a> <br><br><h4>  Result </h4><br>  As a result, we received a pattern that superimposes very well on our images (with a quality higher than 90), but there are some problems in recognizing fields, since the font features and data types of the fields (date, number, etc.) are not taken into account.  For the prototype, it is quite good. <br><br>  Once again, the tool described does not claim to be universal.  If versatility is needed, you will have to learn how to use FlexiLayout Studio and the language of flexible descriptions.  But for really simple tasks like ‚Äúextract a few fields‚Äù, it works quite well and allows you to get a working solution faster and easier. <br><br><h4>  About API </h4><br>  The described tool is written entirely on the public API, comes with source codes, and our customers can modify it to fit their needs or use as a base for making tools for end users.  Such functionality may be useful for end users in order to be able to quickly set up the system for new documents. <br><br>  The work of the example at the level of API calls looks like this (see further comments): <br><h6>  SCENARIO 1 - LINEAR.  GOING PREDICTABLE FROM START TO END.  EASIER FOR UNDERSTANDING </h6><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//        ITrainingBatch trainingBatch = engine.CreateTrainingBatch( rootFolder, "_TrainingBatch", "English" ); try { trainingBatch.AddImageFile( rootFolder + "\\00.jpg" ); trainingBatch.AddImageFile( rootFolder + "\\01.jpg" ); //       ITrainingPage firstPage = trainingBatch.Pages[0]; //      .        //   (    UI   ) firstPage.PrepareLayout(); //  ‚Äú‚Äù      .    for( int j = 0; j &lt; firstPage.ImageObjects.Count; j++ ) { ITrainingImageObject obj = firstPage.ImageObjects[j]; string text = obj.RecognizedText; //  ‚Äú‚Äù  if( text == "978-1-4095-3439-6" ) { // ‚Äú‚Äù  ITrainingField isbnField = trainingBatch.Definition.Fields.AddNew( "ISBN", TrainingFieldTypeEnum.TFT_Field ); firstPage.SetFieldBlock( isbnField, obj.Region ); break; } } for( int j = 0; j &lt; firstPage.ImageObjects.Count; j++ ) { ITrainingImageObject obj = firstPage.ImageObjects[j]; string text = obj.RecognizedText; //  ‚Äú‚Äù    if( text == "ISBN" ) { // ‚Äú‚Äù   ITrainingField isbnTag = trainingBatch.Definition.Fields.AddNew( "ISBNTag", TrainingFieldTypeEnum.TFT_ReferenceText ); firstPage.SetFieldBlock( isbnTag, obj.Region ); break; } } assert( trainingBatch.Definition.Fields.Count == 2 ); //      trainingBatch.SubmitPageForTraining( firstPage ); //      for( int i = 1; i &lt; trainingBatch.Pages.Count; i++ ) { ITrainingPage page = trainingBatch.Pages[i]; //    ,     page.PrepareLayout(); //    trainingBatch.SubmitPageForTraining( page ); } //   .        CreateDocumentDefinitionFromAFL trainingBatch.Definition.ExportToAFL( rootFolder + "\\_TrainingBatch\\NewTemplate.afl" ); } finally { trainingBatch.Close(); }</span></span></code> </pre><br></div></div><br><br><h6>  SCENARIO 2 - NONLINEAR.  THE USER LITERATING THROUGH THE PAGES AND MAY CHANGE THE DESCRIPTION TO ANY MOMEN.  CONVENIENT FOR USER </h6><br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//        ITrainingBatch trainingBatch = engine.CreateTrainingBatch( rootFolder, "_TrainingBatch", "English" ); try { trainingBatch.AddImageFile( rootFolder + "\\00.jpg" ); trainingBatch.AddImageFile( rootFolder + "\\01.jpg" ); //  ,        ITrainingPage page = trainingBatch.PrepareNextPageNotSubmittedForTraining(); while( page != null ) { //       ,       .   //  ,           if( page == trainingBatch.Pages[0] ) { for( int j = 0; j &lt; page.ImageObjects.Count; j++ ) { TrainingImageObject obj = page.ImageObjects[j]; string text = obj.RecognizedText; //  ‚Äú‚Äù  if( text == "978-1-4095-3439-6" ) { // ‚Äú‚Äù  ITrainingField isbnField = trainingBatch.Definition.Fields.AddNew( "ISBN", TrainingFieldTypeEnum.TFT_Field ); page.SetFieldBlock( isbnField, obj.Region ); break; } } for( int j = 0; j &lt; page.ImageObjects.Count; j++ ) { ITrainingImageObject obj = page.ImageObjects[j]; string text = obj.RecognizedText; //  ‚Äú‚Äù    if( text == "ISBN" ) { // ‚Äú‚Äù   ITrainingField isbnTag = trainingBatch.Definition.Fields.AddNew( "ISBNTag", TrainingFieldTypeEnum.TFT_ReferenceText ); page.SetFieldBlock( isbnTag, obj.Region ); break; } } assert( trainingBatch.Definition.Fields.Count == 2 ); } //    trainingBatch.SubmitPageForTraining( page ); //      page = trainingBatch.PrepareNextPageNotSubmittedForTraining(); } //   .        CreateDocumentDefinitionFromAFL trainingBatch.Definition.ExportToAFL( rootFolder + "\\_TrainingBatch\\NewTemplate.afl" ); } finally { trainingBatch.Close(); }</span></span></code> </pre><br></div></div><br><br><h4>  Finally </h4><br>  In addition to the described from the new features interesting to developers, we now have: <br><br>  ‚Ä¢ Advanced <b>image preprocessing tools</b> .  Among them, advanced noise control and customizable filter operating in the frequency domain, like wavelets.  After adjustment, this filter can significantly improve the quality of work with photos (light defocusing, noise). <br>  ‚Ä¢ API to access <b>word and character recognition options</b> .  This allows, in some cases, when the model of extracted data is well known, to programmatically select the option that best suits this model and improve the quality of the output.  For example, you can meaningfully compare with the data contained in a certain database, or read the checksum. <br>  ‚Ä¢ <u><b>According to the comments of readers Habra!</b></u>  Decent <b>Java support</b> - the distribution includes a JAR containing the structure of objects and interfaces (repeating the interfaces as they appear from .Net), and a dll with all the necessary JNI adapters for calls.  For 99% of cases, you can use it straight out of the box.  There is no only support for callbacks that users can selectively implement themselves when strongly needed (we will tell you how). <br>  You can read more about ABBYY FlexiCapture Engine <a href="http://www.abbyy.ru/flexicapture_engine/">on the ABBYY website</a> . <br><br>  <i>Aleksey Kalyuzhny <a href="http://habrahabr.ru/users/alekseyka/" class="user_link">AlekseyKa</a></i> <i><br></i>  <i>Head of FlexiCapture Engine Development Group</i> </div><p>Source: <a href="https://habr.com/ru/post/146679/">https://habr.com/ru/post/146679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146670/index.html">Cloud video processing in CDN</a></li>
<li><a href="../146672/index.html">Twitter bots create events internationally</a></li>
<li><a href="../146673/index.html">Pynba - pinba for python</a></li>
<li><a href="../146674/index.html">More than usability: four components of User Experience</a></li>
<li><a href="../146677/index.html">OS Migration to OpenVZ Container</a></li>
<li><a href="../146681/index.html">Yandex.Money: now in European banks</a></li>
<li><a href="../146683/index.html">Android: 600,000 applications, 1 million activations per day, 400 million devices</a></li>
<li><a href="../146684/index.html">Published reports and interviews from the conference DevCon'12</a></li>
<li><a href="../146686/index.html">Nexus Q and Nexus Accessories</a></li>
<li><a href="../146687/index.html">Dating for IT people</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>