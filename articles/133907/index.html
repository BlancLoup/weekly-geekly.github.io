<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Binary compatibility in the examples and not only</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps many of you have asked questions like "What would happen if someone puts the wrong version of the library to my application?" . The question i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Binary compatibility in the examples and not only</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/4d652554/eef00c06/1475a9d1/4edbe6e0.png" align="left">  Perhaps many of you have asked questions like <i><b>"What would happen if someone puts the wrong version of the library to my application?"</b></i> .  The question is good, and you will find the answer to it and some others in this topic.  For the seed task: let there are two interfaces and a class that implements one of them: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... } public interface B { //... } public class C implements A { //... }</span></span></code> </pre> <br>  And also a class in which there is a method <b><code>foo</code></b> , overloaded for <b><code>A</code></b> and <b><code>B</code></b>  This method is called from an instance of class <b><code>C</code></b> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompatibilityChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(A a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"A"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(B b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"B"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ CompatibilityChecker checker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompatibilityChecker(); System.out.println(checker.foo(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> C())); } }</code> </pre><br>  It is quite obvious that "A" will be displayed.  It is equally obvious that if you say that <b><code>C implements A, B</code></b> , you get a compilation error ( <i><font color="grey">for those who are not obvious to the latter, I can recommend reading about how the methods are chosen. For example, in the <a href="http://java.sun.com/docs/books/jls/third_edition/html/expressions.html">standard</a> in section 15.12.2 or more just describing the <a href="http://geekexplains.blogspot.com/2009/06/choosing-most-specific-method-tricky.html">ground</a></font></i> ). <br>  But what will happen if we recompile only <b><code>C.java</code></b> , and then run the <b><code>CompatibilityChecker</code></b> from the existing class file, is already a more complicated issue.  Interested?  I ask under the cat! <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Static dispatch </h1>  Those who know that the overloaded methods are selected at compile time can figure out that for this reason the class file will immediately contain information about what method to call, and therefore the result will be ‚ÄúA‚Äù.  Let's check this assumption: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(java.lang.String[])</span></span></span></span>; Code: <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> #<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-comment"><span class="hljs-comment">//class CompatibilityChecker 3: dup 4: invokespecial #5; //Method "&lt;init&gt;":()V 7: astore_1 8: getstatic #6; //Field java/lang/System.out:Ljava/io/PrintStream; 11: aload_1 12: new #7; //class C 15: dup 16: invokespecial #8; //Method C."&lt;init&gt;":()V 19: invokevirtual #9; //Method foo:(LA;)Ljava/lang/String; 22: invokevirtual #10; //Method java/io/PrintStream.println:(Ljava/lang/String;)V 25: return</span></span></code> </pre><br>  Indeed, as can be seen from the instructions indented 19, there is a call for a very specific method.  However, those who heard about the <a href="http://java.sun.com/docs/books/jls/third_edition/html/execution.html">verifier</a> may argue and suggest that he will notice that <del>  <font color="grey">these are some wrong bees</font> </del>  class <b><code>C</code></b> has changed, and throw an exception.  Fortunately, they are mistaken, because the verifier checks only the correctness of the structure of classes and interfaces, and not the correspondence of the class-file versions. <br><br>  So, let's run our code and make sure that the initial assumption was correct: a real "A" will be displayed. <br><br>  In addition, it can be assumed that there may be some incorrect address in the virtual address table, and therefore everything will break in <b><code>NoSuchMethodError</code></b> with <b><code>NoSuchMethodError</code></b> .  This assumption is also erroneous, since the <b><code>foo(A)</code></b> method is called, and in a virtual table it is such one.  It‚Äôs another thing if there were heirs who redefine it ... <br><br><h1>  Dynamic dispatch </h1>  Suppose we have the following three classes: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"A"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"B"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.foo() + <span class="hljs-string"><span class="hljs-string">"C"</span></span>; } }</code> </pre><br>  And the class that calls <b><code>foo</code></b> in different ways: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompatibilityChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ A a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); A ab = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); B bb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); A ac = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> C(); C cc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> C(); System.out.println(a.foo()); System.out.println(ab.foo()); System.out.println(bb.foo()); System.out.println(ac.foo()); System.out.println(cc.foo()); } }</code> </pre><br>  Everyone, of course, knows that since methods of redefined types are selected in runtime, the initial output will be: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">A</span></span> B B AC AC</code> </pre><br>  It's time to make a dirty trick, replacing the class file from <b><code>A</code></b> with the result of compiling the following code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object dummy)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"A"</span></span>; } }</code> </pre><br>  To understand what will happen in this case is quite simple.  First, all attempts to call methods, where <b><code>foo</code></b> is called on an instance of class <b><code>A</code></b> , will definitely crash with <b><code>NoSuchMethodError</code></b> .  Among these attempts is also the call <b><code>super.foo()</code></b> in class <b><code>C</code></b>  Secondly, as we have seen before, the <b><code>B.foo()</code></b> method <b><code>B.foo()</code></b> called successfully. <br><br>  Now let's change the tactics: <b><code>A.foo</code></b> make <b><code>A.foo</code></b> again the way it was, but now let's change <b><code>B</code></b> and <b><code>C</code></b> , completely removing the <b><code>foo</code></b> method override from them: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  When you run the code, dynamic dispatch will detect only one entry for <b><code>A.foo</code></b> , and therefore will cause it in all cases, with the result that we will see only the letters ‚ÄúA‚Äù in the console and the complete absence of any exceptions. <br><br>  We continue our research by redefining the methods in <b><code>B</code></b> and <b><code>C</code></b> again.  After launch, as we can expect, dynamic dispatch will find all the entries in the virtual table, and will give exactly the same output as the one we would have received, recompiling everything. <br><br><h1>  Fields of unsuitable types </h1>  Earlier we tried to experiment only with methods.  Now let's see what happens with the fields.  Let there be a class that stores the value of type int and a successor of this class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> answer; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  And, traditionally, a class <b><code>B</code></b> consumer: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompatibilityChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ B b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); b.answer = <span class="hljs-number"><span class="hljs-number">42</span></span>; } }</code> </pre><br>  We now add to class <b><code>B</code></b> our own field with the same name: <br><br><pre> <code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-type"><span class="hljs-type">String</span></span> answer; }</code> </pre><br>  Let's see which byte code was generated for <b><code>CompatibilityChecker</code></b> : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(java.lang.String[])</span></span></span></span>; Code: <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> #<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">//class B 3: dup 4: invokespecial #3; //Method B."&lt;init&gt;":()V 7: astore_1 8: aload_1 9: bipush 42 11: putfield #4; //Field B.answer:I 14: return</span></span></code> </pre><br>  This listing can be confusing, since on the indent 11 in the commentary it seems that it is said that the field belongs to B. Therefore, it is worth believing that when recompiling <b><code>B</code></b> we will encounter an error.  However, it turns out that this is not the case at all.  Since physically only the base class has a field, the operand of the <b><code>putfield</code></b> indicates exactly that field, with the result that the code continues to work after the changes. <br><br><h1>  And what does the specification say? </h1><br>  In the specification, a <a href="http://java.sun.com/docs/books/jls/second_edition/html/binaryComp.doc.html">whole chapter is</a> devoted to binary compatibility, in which the basic concept is ‚Äúbinary compatible‚Äù or ‚Äúsafe‚Äù change.  The specification states that making only safe changes ensures safe execution of the application without recompiling the rest and linking errors.  Strangely enough, but in the whole huge chapter there is no exact definition of a binary compatible operation, however there are a lot of examples: <ul><li>  Modifying the implementation of existing methods, constructors, or initialization blocks </li><li>  Adding new fields, methods and constructors to existing classes and interfaces </li><li>  Deleting private fields, methods and class constructors </li><li>  Moving methods up the class hierarchy </li><li>  Adding new classes and interfaces </li></ul><br>  Perhaps it is because of such a weak definition of binary compatible operations that problems arise. <br><br><h1>  A spoon of tar </h1>  As it turned out, the specification is not strict enough, and you can think of a case in which safe changes will lead to an error in the link.  Consider an interface, a class that implements this interface, and another class that uses them: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompatibilityChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ A b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); } }</code> </pre><br>  Make two safe changes: add the <b><code>foo</code></b> method to interface <b><code>A</code></b> and change the implementation of the <b><code>main</code></b> method of the <b><code>main</code></b> class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CompatibilityChecker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ A b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); b.foo(); } }</code> </pre><br>  When you start, as you could understand, an error will occur, namely <b><code>AbstractMethodError: B.foo()V</code></b> , which in theory should not be.  This problem is known and underlies the processing of Java bytecode.  There were <a href="http://pubs.doc.ic.ac.uk/BinaryCompatibility/BinaryCompatibility.pdf">proposals</a> to remedy the situation, but they still have not led to anything. <br><br><h4>  the end </h4><br>  So, the answer to the question that defended at the very beginning of the article (‚ÄúAnd what will happen if someone fits the wrong version of the library to my application?‚Äù) Like this: ‚ÄúAnd who knows?  Looking at what the version that was used during the compilation is different from that used in runtime. ‚Äù <br><br>  The article does not address some obvious things.  For example, that with incompatible changes like deleting methods and classes or turning a class into an interface, merciless errors like <b><code>NoSuchMethodError</code></b> , <b><code>NoClassDefFoundError</code></b> or <b><code>IncompatibleClassChangeError</code></b> will be <b><code>NoClassDefFoundError</code></b> . <br><br>  I will be glad to answer questions and read comments and additions.  <font color="grey">By the way, this is my first topic in the second life on Habrahabr.</font>  <font color="grey">I do not even know what I'm saying.</font> </div><p>Source: <a href="https://habr.com/ru/post/133907/">https://habr.com/ru/post/133907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133896/index.html">Kaspersky vs SOPA</a></li>
<li><a href="../133897/index.html">Cross platform is cool</a></li>
<li><a href="../133900/index.html">Symbian Web Runtime: easy mobile application development</a></li>
<li><a href="../133903/index.html">Optimization of code execution speed</a></li>
<li><a href="../133906/index.html">Anti-rootkit hypervisor: how it works</a></li>
<li><a href="../133909/index.html">Upgrade viola jones</a></li>
<li><a href="../133910/index.html">Combat rebuilding cache with RED</a></li>
<li><a href="../133911/index.html">Model-oriented design, or continue taming the Cortex M3 with Matlab / Simulink</a></li>
<li><a href="../133912/index.html">How to make a combined user script for the site?</a></li>
<li><a href="../133914/index.html">Anti-piracy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>