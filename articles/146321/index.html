<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Racing radio-controlled tarantasses for 4 weeks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I am one of the creators of the race of radio-controlled tarantas . 

 www.redbullsoapboxrace.ru is an online project dedicated to the Red Bull...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Racing radio-controlled tarantasses for 4 weeks</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I am one of the creators of the <a href="http://redbullsoapboxrace.ru/">race of radio-controlled tarantas</a> . <br><br>  <a href="http://redbullsoapboxrace.ru/">www.redbullsoapboxrace.ru</a> is an online project dedicated to the Red Bull Soapbox Race event and is a miniature tarantass racing. <br><br>  A <a href="http://habrahabr.ru/post/145897/">post was</a> written about our project, and this is an answer to an invitation to talk about the project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea was born in the kitchen over a cup of coffee, and how it all happened and how we managed to implement the project in 4 weeks, read on. <br><a name="habracut"></a><br>  I publish a post at the request of <a href="http://habrahabr.ru/users/dmitrymaxi/">Dmitry Maximov</a> - the author of the idea and architecture of the project. <br><br>  In fact, we did have only 4 weeks to launch the project, but, surprisingly, with a team of 6 people we coped with this task.  For us, this was a good school of teamwork in extreme conditions. <br><br><h4>  Week 1 </h4><br><h5>  Architecture </h5><br>  The architecture at first glance is quite simple: <br><br><img src="https://habrastorage.org/storage2/c20/c5e/54f/c20c5e54f55ad93650a2539598aa5992.png"><br><br>  Considered several implementation options: <br><br><ol><li>  <a href="http://www.robotshop.com/superdroid-hd2-wifi-pan-tilt.html">Ready cars with control over the Internet</a> .  This option was obtained in gold, so they refused it immediately. </li><li>  They applied to <a href="http://www.jokerracer.com/">www.jokerracer.com</a> , but they said that it took them half a year to create a project and it would take as much to re-raise it, and we had a little more than 3 weeks.  By the way, they were just pokatushki, not a race.  So, we can still wear the title of "First in the world." </li><li>  Aurdino, which at one end is inserted into the usb port, and the other clings to the console and transmits a radio signal to the machine.  However, under the Arduino, development in a low-level language was required, and time was running out. </li><li>  <a href="http://www.phidgets.com/">Phidgets</a> is a platform with a high-level API in more than 20 languages ‚Äã‚Äãand libraries for controlling engine controllers, cameras and all sorts of sensors. </li></ol><br>  The last option went perfectly! <br><br>  On the machine is installed on-board computer on Linux with 6 usb, which is connected to the microcontroller for DC motor (collector motor for movement) and the microcontroller for the servo drive (responsible for turning the front wheels). <br><br>  Plus, a magnetic sensor is connected to the computer to record the lap time, and via usb - a camera and a wi-fi adapter. <br><br>  It looks like this: <br><br><img src="https://habrastorage.org/storage2/1e1/809/e89/1e1809e89b9cc6b3cd20da3d029c9aa8.png"><br><br>  The only minus of phidgets was that we needed 7 sets for 7 machines, and that number in the complete set could only be bought in Canada. <br><br><h5>  Cars </h5><br>  From the very beginning, they planned to use this machine: <a href="http://www.hspracing.com/product_view.asp%3Fid%3D992">Monster Truck from HCP Racing</a> .  The machine is professional, and it is easy to find spare parts for it. <br><br><img src="https://habrastorage.org/storage2/6bc/fea/257/6bcfea257a9c275fbdca2f7d5e73de90.jpg"><br><br>  Even before the start of the project, we consulted with the guys from <a href="http/%2520/www.glavbot.ru/">Glavbot</a> , who recommended cars with brushless motors, since the collector ones would have to be changed every 3 days at the planned load.  But phidgets work only with DC motors, so I had to take a risk, which, by the way, was justified in the end - the motors, of course, had to be changed, but not often, and not because of the heavy load. <br><br>  The machine can reach speeds of up to 16 m / s, and the racing room is 15 m long, so I had to figure out how to slow down: <br><ol><li>  If you put the resistors, then the machine will not go on the battery that has sat down.  We celebrate. </li><li>  We thought to make the gearboxes, but we would have made a manual assembly, which, with the planned load, would break daily.  We celebrate. </li><li>  Looked into the API fidgets and oh, a miracle!  - it is possible to adjust the speed.  On this and stopped. </li></ol><br><h5>  Batteries </h5><br>  The battery, which comes with the machine, allows you to continuously drive for about 15 minutes.  The races are practically around the clock and we wanted to make sure that more people could ride, so technical breaks had to be reduced to a minimum. <br><br>  As a result, we picked up a version of batteries that can hold a charge for up to 4 hours, but we, just in case, change them every 2 hours. <br><br><img src="https://habrastorage.org/storage2/8cb/cd7/3f5/8cbcd73f53c035ad62d9f99dcefb5ba9.jpg"><br><br>  It seems with all the components decided, it was necessary to get everything, program and test. <br><br>  UPD: As promised, we publish the remaining information about the project! <br><br><h4>  Week 2: Build </h4><br>  As I wrote earlier, we had to order fidgets from Canada directly from the fidget site.  There were about 30 microchips in total, which would definitely hang on the Russian customs for a couple of months, so they drove through Finland with a double customs clearance.  In July, according to the fidgets, a distributor will appear in Russia, but we didn‚Äôt have that much time. <br><br>  When we had everything in our hands and we assembled the first prototype, the weight of the machine turned out to be 3 kg (excluding the hull) - we had to strengthen the shock absorbers so that the machine would not go on the belly. <br><br>  In the end, it looked like this: <br><br><img src="https://habrastorage.org/storage2/cb8/ca7/2b4/cb8ca72b4d0862707111b13021ac5f33.jpeg"><br><br><img src="https://habrastorage.org/storage2/887/68c/417/88768c4174468a45be5c5c6cbce444fe.jpeg"><br><br>  With the help of the program that came with the Windows fidget, we were able to test the work of the fidget, and immediately found several problems. <br><br><img src="https://habrastorage.org/storage2/58e/c84/bf8/58ec84bf853a2a5b054b6a865eccf4bf.png"><br><br><h5>  Camera </h5><br>  <a href="http://www.phidgets.com/products.php%3Fproduct_id%3D3402_0">The Fijet camera</a> transmitted the image in terrible quality, which constantly hung up at a resolution of 320x240 and 10 frames per second <br>  At first there was an assumption that this was related to the fidget itself, so they decided to immediately use an IP camera so that the video went directly.  But this option has made the machine another 500 grams, and this she could not withstand at the planned load. <br><br>  We tried another UVC-compatible camera (Logitech HD Pro Webcam C920) with autofocus, Full HD image and hardware video codec in h.264, and the result was just great!  It is true that the h.264 codec could not be used because it was not supported by fjetts.  I had to stop at MJPEG. <br><br>  We also tried a cheaper version of the Logitech HD Webcam C525 (now stands on the online broadcast from the track), but the video again began to freeze. <br><br>  We also noticed that if there are wires next to the camera, the quality of the picture deteriorates significantly, so the camera body was not removed, although from an aesthetic point of view it would be better if the camera is in the machine case. <br><br>  The length of all wires had to be shortened due to interference affecting the operation of the camera and wi-fi adapter. <br><br><h4>  Week 3: Programming </h4><br>  Rides last 5 minutes, at the same time in the races can participate 5 machines.  There are 2 spare machines that are activated if one of the 5 fails to pass ping. <br><br>  Between races, 1 minute is allotted for switching control from one user to another. <br><br>  Every 2 hours - a technical break for 30 minutes for the replacement of batteries and repair, if something went wrong. <br><br>  Initially, we thought that the biggest problems would arise with video lags, or rather, with a delayed signal associated with the remoteness of the user from Moscow.  Users who are farther than 200 kilometers from Moscow (where races are physically running) will definitely have problems with skating.  Moreover, they will not even understand that a delay is happening: the machine just becomes poorly controlled - the user pressed forward, and the machine went only half a second later.  This is not a big problem for moving back and forth, but it was critical for turns.  But we considered it not right to limit participation, and did the following: <br><br>  1) Anyone who lived within a radius of 200 kilometers could sign up for the near future. <br>  2) Other cities could enroll starting from the end of the schedule. <br><br>  There was no problem with the delay, but in any case there were no bad reviews at the beginning. <br><br>  Later we expanded the possibility of recording for the near future for the entire central region. <br><br><h5>  Video </h5><br>  For quality skating it was very important that the delay was minimal, so the options for broadcasting video from the machine through the media server disappeared. <br><br>  There were options for the user to install a Java plugin for himself, but, firstly, he weighed a lot, and secondly, hardly anyone would install it himself.  We also wanted to use the Flash element, but it required the presence of the security file crossdomain.xml on the domain with the video stream, and the httpd web server did not manage to configure the mime types for the xml files. <br><br>  We stopped on the following version: <br>  For FF, Safari and Chrome, we use the tools of the browsers themselves, which can support the MPEG stream.  For other browsers, Java script with image update.  As a result, the delay in the local network was 50 milliseconds (for reference, the machine becomes almost uncontrollable with a delay of half a second). <br><br><h5>  Control </h5><br>  Sometimes it turned out that when connected to a typewriter, the DC controller was not connected, i.e.  user could not go forward / backward.  We have fixed this problem by reconnecting.  Therefore, during the countdown and the first few seconds after the machine is in place, and after 10 seconds, finally starts to go. <br><br><h5>  Server </h5><br>  A server is a regular computer with the following parameters: <br>  - Intel Core i3-2100 processor <br>  - motherboard GIGABYTE GA-H61M-S2V-B3 <br>  - RAM DDR3 DIMM Hynix - 4 GB <br><br>  CPU load, if skated 5 machines, is not more than 10 percent. <br><br><h5>  the Internet </h5><br>  We planned to use a dedicated 100 MB channel.  In the end, we had the channel of 20 Mbit.  With one-variable participation in the race of five machines outgoing traffic is about 7 Mbps.  Inbound traffic is generally not significant. <br><br>  First tried to use a home router from Trendnet.  However, when three machines were connected at the same time, it began to hang.  The position corrected the transition to the Linksys e1200 router from Cisco. <br><br>  Periodically there are interferences in the wi-fi signal, and the ping of the machines either disappears or becomes unrealistically large.  This happens every 2 days and lasts 5-10 minutes, then everything stabilizes.  A clear pattern could not be identified.  It is still interesting, what can this be included on Red October? :) <br><br>  The biggest problem with management was related to the fact that the connection with the machine or the user periodically disappeared at the moment when the request was ‚Äúforward / backward‚Äù - in this case the machine hung in the forward direction, stuck into an obstacle and burned the motor. <br><br>  We thought about switching to another frequency of transmitting a wi-fi signal (5 GHz), but for this it was necessary to switch to a router and wi-fi adapters with 5 GHz frequency and install the appropriate drivers on the on-board computer.  Despite the fact that the on-board computer is Linux Phidgets does not have a standard mechanism for installing drivers.  Therefore, the idea of ‚Äã‚Äãswitching to another frequency was abandoned. <br><br><h4>  Week 4: Test and Run </h4><br>  At the beginning of the route was built, representing a figure of eight, with a smooth rise and steep descent. <br><br><img src="https://habrastorage.org/storage2/bd2/406/b3a/bd2406b3ae188edeb271ddffc3c2ce96.jpg"><br><br>  A magnet was installed on the trigger (normal, for sharpening knives), which activated a magnetic sensor to record the lap time. <br><br><h5>  Speed ‚Äã‚Äãadjustment </h5><br>  We planned to make a constant speed of the machines, limiting it to such a value that the machine would climb onto the slide without any problems.  But faced with the dependence of the speed of the state of charge of the battery.  After 4 laps, the machine could not climb up without increasing the speed, so it would be necessary to change the batteries or increase the speed every 4 laps. <br><br>  We chose the second option in order to automate the process as much as possible and reduce technical interruptions.  Speed ‚Äã‚Äãadjustment was made to the machine control interface.  The user has the opportunity to add speed using the AZ buttons to climb the slide. <br><br>  When the project was launched, it turned out that the climb is not very interesting from the point of view of skating - it is narrow, it is difficult to turn around if it crashed, and most users get stuck on it.  The lift was removed and made a circular track with a small step, so that the user could not drive back. <br><br><h5>  Motors </h5><br>  While there was a lift on the track, we had to change the motors, because they were burning because of the applied voltage, if the machine did not move.  Fans from laptops helped to cool the engine, but not always. <br><br>  At some point, the motors in Moscow ended :-) I had to install a fuse that would break the contact between the controller and the motor when it was very hot.  Unfortunately, this led to the fact that the user in the middle of the race just stopped and waited for the fuse to cool and recover.  Now there is no such problem, since the route has been broken. <br><br><h5>  Fans </h5><br>  Fans used the most common from laptops: <br><br>  In the first version of the assembly, the fans operated continuously, directly powered by batteries.  But in this case, they quickly burned and, moreover, put the battery in, so the fans were connected to a separate port of the controller so that it turned on only when the machine was driving. <br><br><h5>  Housing </h5><br>  The body was made of solid foam, covering the top, and on the sides - the bumper of metal plates.  In the process, our ears and fins flew off, and the eggs fell out of the nest, but the shells themselves remained intact: <br><br><img src="https://habrastorage.org/storage2/302/220/067/302220067424308a7ef29f406338b192.jpeg"><br><br><img src="https://habrastorage.org/storage2/8cb/90f/102/8cb90f1022522494a0f66582611fb762.jpeg"><br><br>  <b>Update 1</b> : <br><br>  Maybe habreffekt, and maybe something else, but today 5 machines at the same time drove with difficulty.  Put 2 routers - it became better. <br><br>  <b>Update 2 - about the lap time</b> <br><br>  Another interesting issue on the project was the choice of a time lapse system.  There were several options. <br><br>  Use a turnkey solution.  For off-line radio controlled car competition, many clubs use <a href="http://www.mylaps.com/">My Laps</a> professional time tracking system.  The system consists of a decoder, transponders, which are installed on the typewriter and frame, fixing the intersection of the finish line.  Moreover, if the machine crosses the finish line in the opposite direction, the decoder understands this. <br><br>  However, My Laps is quite an expensive solution.  We found an interesting alternative - the <a href="http://www.rclapcounter.com/">I-Laps system</a> , which is almost as good as My Laps in terms of technical characteristics, but the price is several times cheaper. <br><br>  I-Laps has its own competition software.  However, it was not suitable for our purposes, since it was not possible to upload data from the system to show the time of each lap and the best lap time after the end of the race. <br><br>  We also found <a href="http://dcdtime.ru/">DCD timeR</a> - it looks like a very elegant solution, and for the price it was affordable.  But the manufacturers said that they could not make an API for us so that we would upload the data to our website.  It's a pity - we really liked this decision. <br><br>  We almost got used to the idea that we would have to write integration with I-Laps ourselves, but it turned out that an analog magnetic sensor could be connected to the on-board computer.  As the magnetic field increases, it sends a signal to the onboard computer.  As a source of magnetic field, we used a magnet to fasten the tools to the wall.  Gol asked a question about how we coped with the fact that the cars can move across the finish line in the opposite direction.  While decided by the steps.  More interesting solutions - put on each machine two magnetic sensors.  Then by the sequence of their operation you can determine in which direction the machine crossed the finish line. <br><br>  There are really a lot of people who want to go - we had to open the night hours for the races so that everyone could try.  It is a pity, of course, that not everyone was able to drive normally, but this is only the beginning! </div><p>Source: <a href="https://habr.com/ru/post/146321/">https://habr.com/ru/post/146321/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146313/index.html">Camlex 3.2: reverse engineering CAML and adding conditions to string queries in Sharepoint using lambda expressions</a></li>
<li><a href="../146314/index.html">The study of ITIL in the form of "Formula 1" + habraskidka</a></li>
<li><a href="../146317/index.html">Life with a sysadmin</a></li>
<li><a href="../146319/index.html">How does Google search change</a></li>
<li><a href="../146320/index.html">June updates of ‚ÄúSimple Business‚Äù - more opportunities for maintaining a client base and sharing ideas</a></li>
<li><a href="../146322/index.html">Google released the Google I / O 2012 application</a></li>
<li><a href="../146323/index.html">You are a bank: what to do to reduce risks?</a></li>
<li><a href="../146329/index.html">Skype + QIWI</a></li>
<li><a href="../146331/index.html">Interesting results about the evolutionary systematics of prokaryotes or ‚Äúmultiple origin‚Äù</a></li>
<li><a href="../146333/index.html">Who controls social networks?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>