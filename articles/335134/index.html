<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WiFiBeat: We detect suspicious traffic in a wireless network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will talk about WiFiBeat, an agent that can send 802.11 frames to Elasticsearch, where we can analyze them, build graphs and detect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WiFiBeat: We detect suspicious traffic in a wireless network</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/db4/009/188/db4009188e75414f9eb89489236f0923.jpg"></div><br>  In this article we will talk about WiFiBeat, an agent that can send 802.11 frames to Elasticsearch, where we can analyze them, build graphs and detect attacks.  This whole system is built entirely on free software. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  ‚Üí <a href="https://www.wlanpros.com/resources/wifi-beat/">Official utility website</a> <br>  ‚Üí <a href="https://github.com/WiFiBeat/WiFiBeat">GitHub</a> <br><br>  WiFiBeat allows you to work with a Wi-Fi adapter in monitor mode, create objects from JSON frames and send them to the database of the analytical engine <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> .  In addition, WiFiBeat can read frames from a PCAP file. <br><br>  The analysis of the collected information takes place in another Elastic free product - the <a href="https://www.elastic.co/products/kibana">Kibana</a> visualizer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/d12/3e9/964/d123e9964c51407983dede4d03104c32.png"><br><br>  WiFiBeat officially works steadily on Ubuntu 16.04, but, of course, it can be run on other distributions, however, there may be difficulties with dependencies and the inconsistency of the versions of the libraries under which the utility was written.  We will use the 64-bit Ubuntu 16.04, which is connected to the USB Wi-Fi adapter <a href="http://www.tp-linkru.com/products/details/cat-11_TL-WN722N.html">TP-LINK TL-WN722N</a> in monitor mode, to launch WiFiBeat. <br>  Elasticsearch and Kibana will be deployed on 64-bit Debian 9. <br><br><h2>  Installing WiFiBeat </h2><br>  The installation process is described in detail on <a href="https://github.com/WiFiBeat/WiFiBeat">GitHub</a> . <br><br>  Install libtins <br><br><pre><code class="bash hljs">wget https://github.com/mfontanini/libtins/archive/v3.5.tar.gz tar -zxf v3.5.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> libtins-3.5 apt-get install libpcap-dev libssl-dev build-essential libboost-all-dev mkdir build <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake ../ -DLIBTINS_ENABLE_CXX11=1 make make install ldconfig</code> </pre> <br>  Installing missing packages in the system <br><br><pre> <code class="bash hljs">apt-get install libyaml-cpp-dev libpoco-dev rapidjson-dev libtsan0 libboost-all-dev libb64-dev libwireshark-data build-essential libnl-3-dev libnl-genl-3-dev libnl-idiag-3-dev</code> </pre> <br>  Install <a href="https://codelite.org/">Codelite</a> to build WiFiBeat <br><br><pre> <code class="bash hljs">apt-get install codelite codelite-plugins</code> </pre><br>  Run the codelite and create a new workspace <br><br><img src="https://habrastorage.org/web/66f/78c/335/66f78c3359ee4f5a86570ef37a9b2d05.PNG"><br><br>  C ++ type <br><br><img src="https://habrastorage.org/web/25a/036/e25/25a036e2508d46f6ac17df38c6cf1474.PNG"><br><br>  Remember the directory <br><br><img src="https://habrastorage.org/web/770/9b9/e77/7709b9e77d874dfb9b350eb4a6f947d2.PNG"><br><br>  When the workspace is created, go to the directory and download the WiFiBeat and libraries from GitHub. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/WiFiBeat git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/WiFiBeat/WiFiBeat git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/WiFiBeat/elasticbeat-cpp git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/WiFiBeat/simplejson-cpp</code> </pre> <br>  Add all 3 projects to our workspace in codelite <br><br><img src="https://habrastorage.org/web/374/b55/32e/374b5532e8464e30b6075667a4eea8bf.PNG"><br><br><img src="https://habrastorage.org/web/181/229/86b/18122986ba8b41afbb2617c1be61c810.PNG"><br><br>  The result should be the following <br><br><img src="https://habrastorage.org/web/9e3/6c4/818/9e36c48181db421db12e367cf308f0ae.PNG"><br><br>  After double clicking on wifibeat in the project list, it should stand out <br><br><img src="https://habrastorage.org/web/81a/2d9/9e8/81a2d99e895246a6b23aa2d29ed2f2ac.PNG"><br><br>  Right click on wifibeat select Build <br><br><img src="https://habrastorage.org/web/ea8/715/a66/ea8715a6699e4385b226d975b03278c0.PNG"><br><br>  Choose a compiler if not selected, and again Build <br><br><img src="https://habrastorage.org/web/db6/672/568/db66725689824fa7a108baf8129b1f6b.PNG"><br><br>  If all the dependencies are installed in the system and you did everything correctly before this, then at the end of the compilation process you will see a message about the absence of errors. <br><br><pre> <code class="bash hljs">====0 errors, 2 warnings, total time: 00:01:13 seconds====</code> </pre><br><h2>  Customization </h2><br>  The installation process for Elasticsearch and Kibana will not be covered in this article.  There are enough materials on this topic on the net.  We assume that they work on the machine 192.168.1.30, and WiFiBeat on the machine 192.168.1.31.  Elasticsearch listens on HTTP port 9200 and does not require authentication. <br><br>  By car 192.168.1.31 I connected the Wi-Fi adapter and put it into monitor mode. <br>  In the system, it is displayed as mon0. <br><br>  From the directory with WiFiBeat we copy the configuration file to etc and edit <br><br><pre> <code class="bash hljs">cp wifibeat.yml /etc vi /etc/wifibeat.yml</code> </pre> <br>  This file is well documented, briefly go through the main options. <br><br>  I'm going to analyze the traffic of one network operating on the fifth channel of the 2.4 GHz band. <br>  Therefore, I leave one entry in the interface settings.  It is possible to analyze several channels at once and for each set the listening time. <br><br><pre> <code class="bash hljs">wifibeat.interfaces.devices: mon0: [5]</code> </pre> <br>  Delete everything from the Output file section <br>  In the section with PCAP-filters, I ask the following <br><br><pre> <code class="bash hljs">wifibeat.interfaces.filters: mon0: <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> mgt</code> </pre> <br>  Here filters are specified as in <a href="https://www.wireshark.org/">Wireshark</a> , and in this case I indicate that I am only interested in 802.11 frames.  These include: <br><br><ul><li>  Authentication frame </li><li>  Deauthentication frame </li><li>  Association request frame </li><li>  Association response frame </li><li>  Reassociation request frame </li><li>  Reassociation response frame </li><li>  Disassociation frame </li><li>  Beacon frame </li><li>  Probe request frame </li><li>  Test response frame </li><li>  Request to Send (RTS) frame </li><li>  Clear to Send (CTS) frame </li><li>  Acknowledgment (ACK) frame </li></ul><br>  I commented out everything in the sections Local file and Decryption, I will not need the encryption keys in my example and I will not read from the PCAP file either. <br><br>  I will not change anything in the Queues section and in the Outputs section I will set the address and port of Elasticsearch. <br><br><pre> <code class="bash hljs">output.elasticsearch: enabled: <span class="hljs-literal"><span class="hljs-literal">true</span></span> protocol: <span class="hljs-string"><span class="hljs-string">"http"</span></span> <span class="hljs-comment"><span class="hljs-comment"># Array of hosts to connect to. hosts: [ "192.168.1.30:9200" ]</span></span></code> </pre> <br>  Save and go to the directory with WiFiBeat and the Debug subdirectory.  This should contain the compiled wifibeat executable. <br><br><h2>  Launch </h2><br>  We start Elasticsearch and Kibana by car 192.168.1.30.  Make sure that port 9200 (Elasticsearch) and Kibana (5601) are tapped. <br><br>  On the machine 192.168.1.31 we verify that we did not make mistakes in the configuration <br><br><pre> <code class="bash hljs">./wifibeat -d</code> </pre><br>  You should see the parsing of the configuration file.  If there are errors, wifibeat will report the problem.  If everything is good, then run <br><br><pre> <code class="hljs">./wifibeat -f</code> </pre><br>  The -f switch allows you to run wifibeat in non-daemon mode.  For us, this is more convenient. <br><br>  Now, if you open Kibana and check the indexes, you should see that the new wifibeat index has appeared * <br><br><img src="https://habrastorage.org/web/8d1/62f/2ec/8d162f2ece72463788dd06d8f7db18b6.PNG"><br><br>  Let's set up Kibana.  Go to Management, Index Patterns <br><br><img src="https://habrastorage.org/web/fff/e0f/237/fffe0f23729b4fb68c05174d252a4bfc.PNG"><br><br>  Create a new template. <br><br><img src="https://habrastorage.org/web/99c/c16/72a/99cc1672ab44436fb6991122eac92806.PNG"><br><br><img src="https://habrastorage.org/web/0ea/936/09a/0ea93609a29e46a4930947f4d297eb99.PNG"><br><br>  We mark it as the main <br><br><img src="https://habrastorage.org/web/43d/0ba/dc0/43d0badc04d54ffaab7345bcac42668c.PNG"><br><br>  Now import the Dashboards and Visualizations that come with WiFiBeat <br><br><img src="https://habrastorage.org/web/504/52b/835/50452b8353224e7ea91f59f8054e09e6.PNG"><br><br><img src="https://habrastorage.org/web/3ac/9b4/2d6/3ac9b42d68c144d39c5d218f6190c197.PNG"><br><br>  Select the kibana.json file from the WiFiBeat / kibana directory <br><br>  If the import was successful, you can go to the Dashboard tab and find WLAN there. <br><br><img src="https://habrastorage.org/web/e39/52f/b41/e3952fb411944e04980432e0fa49204d.PNG"><br><br>  If you do not use filters in wifibeat.yml, it will look like this <br><br><img src="https://habrastorage.org/web/1e7/eea/dd4/1e7eeadd46cf4aa6b7e1436a47b2626c.PNG"><br><br>  With filters (in our case), we will not see data on Control Frames and Data Frames. <br><br>  In addition to the dashboards, we have new visualizations. <br><br><img src="https://habrastorage.org/web/5c6/7a4/a82/5c67a4a8257c41a08c515c9f33cf73f2.PNG"><br><br><img src="https://habrastorage.org/web/407/cf5/44f/407cf544f7e947029ed5762fb0f2a35c.PNG"><br><br><h2>  In custody </h2><br>  Further, using another component of the Elasitc package - <a href="https://www.elastic.co/products/x-pack">X-Pack,</a> you can configure actions when it detects, say a burst of deauthentication frames, which can mean a DoS attack or an attempt to get a handshake for brute force.  In this way, it is possible to assemble a system for detecting attacks on a wireless network. </div><p>Source: <a href="https://habr.com/ru/post/335134/">https://habr.com/ru/post/335134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335114/index.html">Interactive recommenders: how to create, how to work</a></li>
<li><a href="../335120/index.html">RailsClub 2017: we are waiting for all rubists on September 23 in Moscow</a></li>
<li><a href="../335122/index.html">Speed ‚Äã‚Äãup your website using machine learning.</a></li>
<li><a href="../335128/index.html">Getting started with Wagtail CMS (Django) and GraphQL</a></li>
<li><a href="../335132/index.html">Dedicated servers based on Intel Xeon processors Skylake-SP</a></li>
<li><a href="../335136/index.html">Intelligent Automatic Pet Feeder Based on Arduino - STEP 1</a></li>
<li><a href="../335138/index.html">RequestQueueLimitPerSession and its distribution to older versions of .net</a></li>
<li><a href="../335140/index.html">Optimization and automation of web application testing</a></li>
<li><a href="../335142/index.html">About PKI "on the fingers" in 10 minutes</a></li>
<li><a href="../335144/index.html">Malicious code in npm-packages and the fight against it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>