<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a calculator with units</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I needed to implement a calculator for folding and converting physical quantities. I did not have time limits at that time, so I solved the probl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a calculator with units</h1><div class="post__text post__text-html js-mediator-article">  Once I needed to implement a calculator for folding and converting physical quantities.  I did not have time limits at that time, so I solved the problem at a high level of abstraction and, accordingly, under a wide range of tasks.  I offer you my decision. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7a/uk/mo/7aukmoe-e6fngiztnlexcgxyka0.jpeg" alt="image"></div><br>  Imagine that you need to write a calculator that can not just count the numbers, but operate with physical (measured) values ‚Äã‚Äã- add the length, convert the amount of something from one unit of measure to another, etc.  First of all, let's define a slightly more specific task.  We will have these features here: <br><a name="habracut"></a><br><ul><li>  The calculator should support conditionally any mathematical operation, i.e.  the concept of operation must be a kind of interface so that, if necessary, they can be added.  But for the initial stage, let's focus on the following list: <ul><li>  Addition / Subtraction </li><li>  Multiplication / division </li></ul></li><li>  When working with a calculator, we want to completely shift to the shoulders of the calculator the issues of converting units of measurement.  It follows 2 things: <ul><li>  As long as the requested operation has a physical meaning, the calculator must itself understand how to convert the operands to perform the mathematical operation.  For example: <i>10 feet + 5 meters</i> (2 lengths are added) or <i>10 Newtons * 1 dm</i> (if you remember physics, then the result should be in Joules). </li><li>  If, from a physical point of view, the requested operation is meaningless, then even if there is a mathematical sense, it is necessary to refuse to perform it.  For example, <i>10 meters + 5 kg</i> from a physical point of view is complete nonsense, although mathematically we could somehow add up 10 and 5. </li></ul></li><li>  Although there is some kind of performance: on samples of size 10-100 thousand expressions, the calculator should work out in a fraction of a second. </li><li>  The specific task for which I was looking for a solution required storing the ‚Äúmeasured values‚Äù in the database. </li></ul><br><h2>  Domain Analysis </h2><br>  In the process of analysis, I will move from the general to the particular. <br><br>  First of all, it is clear that there is a kind of two dimensions here - physics and mathematics.  For physics, the dimension of each of the operators is important.  After all, <i>5 meters / 2 seconds</i> is not <i>5 kg / 2 m2</i> for units of measurement are different.  And for mathematics, <i>5 meters * 100</i> differs from <i>5 km * 0.1</i> , since  there are different numbers involved. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, we introduce the notion of expression.  Let it be something that the calculator will operate on.  The simplest expressions can be things from the category of <i>5 meters</i> , <i>45</i> (just a dimensionless constant), etc.  But expressions can be more complicated: <i>10 meters + 2 cm</i> or <i>5 kg * 45</i> . <br><br>  Anyway, any expression should know (or be able to find) 2 of its properties: <br><br><ol><li>  absolute value (mathematics) </li><li>  dimension (physics) </li></ol><br>  The absolute value can be found by reducing the units of measurement to their SI base unit and calculating the numbers.  For an expression of <i>10 km / 3 hours, the</i> absolute value will be ~ 1.39: <i>10 km / 3 hours</i> = <i>10,000 m / 7,200 s</i> = <i>1.39 m / s</i> .  Well, the physical dimension is already obvious: <i>m / s</i> . <br><br>  And for the expression 5 * 2, the absolute value is 10, the physical dimension is zero (nothing). <br>  At the expense of operators (actions) we can build more complex ones from simple expressions and this complexity has no limits. <br><br><h2>  Physical dimension </h2><br>  It is intuitively clear for us that <i>2 km</i> and <i>2 m2 / 10 cm</i> have the same dimension - meters.  And how to explain this to a computer?  To begin, we need basic physical measurements.  We will not reinvent the wheel and take SI units of measurement as basic: <br><br><ul><li>  length, m </li><li>  weight, kg </li><li>  time with </li><li>  ... this list can be continued by introducing new dimensions (electric charge, temperature, etc.), but for simplicity of our analysis, let's focus on the first three. </li></ul><br>  Then the dimension of any expression can be represented as a vector of dimension.  The length of such a dimension vector will be equal to the number of known basic units of measurement.  The value opposite each of the basic dimensions will indicate the degree of dimensionality for that dimension. <br><br><img src="https://habrastorage.org/webt/tv/dw/1c/tvdw1cpxpakfgze9tld12wyuub8.png" alt="image"><br><br>  Then from the standpoint of physics, we always look at the dimension (dimension vector) of expressions.  For example: <i>10 km</i> or <i>1 m</i> - the vector of dimension for both expressions is the same, although they use two different units of measurement. <br><br>  With mathematics (absolute value), I hope, it is not necessary to explain strongly - just consider the dial as on a regular calculator. <br><br><h2>  Complex Units </h2><br>  We still need to learn how to decompose complex (non-basic) units of measurement to basic ones ‚Äî it will be useful both for physics (well, tell me a vector of dimension <i>1 Joule</i> ) and for mathematics (what is the absolute value of <i>8 km</i> ). <br><br>  Imagine that we will have a reference table, where the key is the unit of measurement, and the expression value, which splits this unit of measurement into basic ones, while maintaining the dimension and absolute value of the original complex unit of measurement. <br><br>  Accordingly, if the units of measurement are not in the reference table, then such a unit is already basic (indecomposable) and therefore it is included in the dimension vector.  Let's call such reference table a decomposition table, since  she explains how to decompose complex units of measurement into basic ones. <br><br><img src="https://habrastorage.org/webt/gn/h6/lj/gnh6lj9nwyh3eeuss8yncdfum7m.png" alt="image"><br><br>  Please note that decomposition can occur both at the physical level (Newton is decomposed exclusively into other units of measurement, in absolute value it does not change) and mathematically (kilometer is decomposed into its basic unit of measurement and ‚Äúcorrected‚Äù numerically). <br><br><h2>  Public (high-level) interface </h2><br>  Here we have already felt certain abstractions that are hiding behind the task.  Now let's think of the interface that we want to provide outside, and which our calculator undertakes to implement.  At this point, it is important to design the interface so that it is elegant, easy to understand and use outside. <br><br>  Of course, in the center of the scene you need to put our abstraction expression.  The input to the calculator will be given some complex expressions with multiplication, sum, etc., and at the output it should give an equivalent expression, which has already been calculated and reduced to the simplest form. <br><br><h3>  Expression interface </h3><br>  What methods do we need in this interface expression?  I suggest the following: <br><br><ul><li> <code>dimension() : Dimension</code> to get the dimension vector of our expression.  We will use it internally to validate the physical meaning (flies can only be folded with flies).  It will be useful to give it ‚Äúout‚Äù as part of the public interface, since  it is quite logical that someone, sooner or later, will want to know the dimension of some expression. </li><li>  <code>evaluate() : float</code> Calculate the absolute value of the expression, i.e.  count math. </li><li>  <code>decompose() : MathematicalExpression</code> decompose all complex units of measure in terms of their decomposition.  This method will be useful to us both for calculating the absolute value and for calculating the dimension vector.  But again, it sounds quite logical to include this operation in our public interface because someone may need such an operation outside the internal implementation of our calculator. </li><li>  <code>formatQuantity(float $quantity)</code> enter constants in our expression (and select these constants) so that the expression starts to equal <code>$quantity</code> .  Such a method will be slightly more flexible than simply converting from one unit to another.  Here is an example: Americans use feet and inches for human growth.  I am 180 cm tall. I could convert it to feet (5.905512) or inches (70.8661457).  But for the American brain, the canonical form is to single out full feet and write the remainder as inches - 5 inches 10.8 inches.  Then outside you can imagine the following pseudo-code for formatting / converting (maybe 2-3 lines more code, but the design flexibility is an order of magnitude higher): <br><br><pre> <code class="php hljs">$quantity = $source_expression-&gt;evaluate(); $european_height = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MathematicalExpression(‚Äú<span class="hljs-number"><span class="hljs-number">1</span></span> * meter‚Äù); $european_height-&gt;formatQuantity($quantity); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $european_height-&gt;toString() . ‚Äú\n‚Äù; <span class="hljs-comment"><span class="hljs-comment">// 1.8 * meter $us_height = new MathemticalExpression(‚Äú1 * foot + 1 * inch‚Äù); $us_height-&gt;formatQuantity($quantity); print $us_height-&gt;toString() . ‚Äú\n‚Äù; // 5 * foot + 10.8 * inch</span></span></code> </pre> <br></li></ul><br>  Notice, we can argue that two expressions are equal if and only if their dimension vectors are equal and when their absolute value is the same.  Here are some examples: <br><br><ul><li>  100 m and 0.1 km are equal, because  both have a meter dimension and an absolute value of 100. </li><li>  100 m and 100 kg are not equal, because  their physical dimension is different. </li></ul><br><h3>  Dimension interface </h3><br>  We also have the concept of vector dimension.  It would be nice to introduce some interface for working with dimensions.  It will be appropriate for us to define the following operations on dimension vectors: <br><br><ul><li>  <code>addDimension(Dimension $dimension1, Dimension $dimension2) : Dimension</code> Add one dimension to another.  Tritely perform vector addition / subtraction.  This will be useful in multiplication operations, when dimensions are added. </li><li>  <code>subtractDimension(Dimension $dimension1, Dimension $dimension2) : Dimension</code> Subtract one dimension from another.  Similarly, with the previous operation, only the sign is inverted.  It will be useful when the division operation is processed. </li><li>  <code>isEqual(Dimension $dimension1, Dimension $dimension2) : bool</code> Compare one dimension with another.  The whole validation logic of physical dimensions will be based on this method.  With this function, we will understand whether it makes physical sense to add / subtract two expressions. </li></ul><br><h3>  Operator Interface </h3><br>  I have already mentioned that we need the concept of a mathematical operation.  It's time to look at it in detail.  First of all, we have already determined that the ‚Äúworkhorse‚Äù of our calculator is an interface expression.  Our calculator should certainly be able to fully work with operators, it follows from this that the operator interface must extend the expression interface.  By the way, this is very logical!  If <i>10 m</i> is an expression, then why not <i>10 m + 20 cm</i> not be an expression? <br><br>  This means that operators should be able to calculate their dimension, calculate their absolute value, and other functionality implied by the <code>MathematicalExpression</code> interface. <br><br>  But operators are obviously a bit more than just an expression.  Let's add the following methods to the operator interface: <br><br><ul><li>  <code>operand1() : MathematicalExpression</code> get the first (left) operand </li><li>  <code>operand2() : MathematicalExpression</code> get the second (right) operand </li></ul><br>  Again, it is logical to allow someone outside to explore the left and right operand in case someone wants to somehow analyze an already existing expression.  This is a good example of a complete interface - I don‚Äôt know why someone might need left and right operands, but it sounds damn like an integral part of the operator interface. <br><br><h2>  Distribution of responsibilities between the application layer and the database </h2><br>  In the formulation of the problem, we agreed that we would store these expressions in the database, and that the system should be productive on a scale of tens to hundreds of thousands of expressions.  This means that the sorting by absolute value must be performed inside the database.  Otherwise we will be very slow. <br><br>  There are literally three points that need to be said: <br><br><ul><li>  The data validation logic must be at the application level.  In our case, all validation reduces to the fact that the expression must have a physical meaning, i.e.  dimensions do not contradict each other.  The application layer should not write an expression to the database that has no physical meaning.  From this it follows that at the DB level we do not need to bother about the dimension, since  any expression is guaranteed to be valid.  This is great news because  we do not need to implement dimension issues at the database level ‚Äî and this is less work and potential performance gains, since  will need to execute less logic at the time of the SQL query. </li><li>  Expressions must be written to the database in its original (unmodified) form.  This principle is useful for almost any task.  In our particular case, it is important to write the original expression in case the decomposition table changes. </li><li>  It turns out that the database is only responsible for calculating the absolute value.  In practice, it is expected that this function will be used for ORDER BY or WHERE parts of an SQL query. </li></ul><br><h2>  Internal implementation </h2><br>  In this place we will draw a fat line.  We have finished discussing the high-level interface that our calculator provides and are starting to move deeper (jungle) of its implementation. <br><br><h3>  Dimension vector interface </h3><br>  Here, a rather trivial implementation is just some dictionary, where the key is the basic dimensions, and the value is the degree of the dimension.  Vector addition and subtraction are implemented by several lines in any programming language. <br><br>  The <code>isEqual(Dimension $dimension1, Dimension $dimension2) : bool</code> function <code>isEqual(Dimension $dimension1, Dimension $dimension2) : bool</code> can be implemented as follows: <br><br><ol><li>  Subtract one dimension from another. </li><li>  If the resulting vector consists solely of zeros, then the dimensions are the same. </li></ol><br><h3>  Expression interface </h3><br>  In the expression interface, we still need to add one ‚Äúinternal‚Äù method that will make life easier for us when implementing the <code>formatQuantity()</code> method.  A method called <code>containsDimensionlessMember()</code> will return a bool and indicate whether this expression can somehow mutate to be numerically equal to some value.  Since  only a constant affects the numerical value, so the method is called ‚ÄúhaveLiTsF‚Äú dimensionlessChlen ‚Äù. <br><br>  This interface will have 2 implementations: under the unit of measurement and under the constant.  So it will be very convenient - the unit of measurement dictates the dimension and, if necessary, it can / should be decomposed, while the constant is obviously dimensionless and only affects the absolute value of the result. <br><br>  I‚Äôll just give you a listing of PHP code here.  I think it will be easier than writing in words. <br><br><h4>  Constant </h4><br><div class="spoiler">  <b class="spoiler_title">Calculate the dimension of the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Determine physical dimension of this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * Dimension array of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      . return array(); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">You have the dimensionless member ()</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Test whether this mathematical expression includes a dimensionless member. * * Whether this mathematical expression contains at least 1 dimensionless * member. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool * Whether this mathematical expression contains at least 1 dimensionless * member */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">containsDimensionlessMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Enter the required absolute value in the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Format a certain amount of quantity within this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $quantity * Quantity to be formatted * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Formatted quantity into this mathematical expression. Sometimes the * mathematical expression itself must mutate in order to format the * quantity. So the returned mathematical expression may not necessarily be * the mathematical expression on which this method was invoked. For * example, the expression "unit" would mutate into "1 * unit" in order to * have a dimensionless member and therefore be able to format the $quantity */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatQuantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($quantity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ‚Äú   -‚Äù, //      . $this-&gt;constant = $quantity; return $this; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Calculate the absolute value of the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Numerically evaluate this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> float * Numerical value of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     . return $this-&gt;constant; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Expression decomposition</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Decompose (simplify) this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Decomposed (simplified) version of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,    . return $this; }</span></span></code> </pre> <br></div></div><br><h4>  Unit of measurement </h4><br>  To simplify the article, let's leave beyond its scope the issues of working with the decomposition reference table (the table where we store data on how non-basic units of measurement can be decomposed into basic ones).  Just imagine that in our class ‚Äúunits‚Äù there is already a property, and decomposition is written to it.  If this is a basic unit, then this property is not initialized. <br><br><div class="spoiler">  <b class="spoiler_title">Calculate the dimension of the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Determine physical dimension of this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * Dimension array of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,      . //       ,      //    . return is_object($this-&gt;decomposition) ? $this-&gt;decompose()-&gt;dimension() : array($this-&gt;identifier() =&gt; 1); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">You have the dimensionless member ()</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Test whether this mathematical expression includes a dimensionless member. * * Whether this mathematical expression contains at least 1 dimensionless * member. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool * Whether this mathematical expression contains at least 1 dimensionless * member */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">containsDimensionlessMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ,   ,  ,   //  . return FALSE; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Enter the required absolute value in the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Format a certain amount of quantity within this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $quantity * Quantity to be formatted * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Formatted quantity into this mathematical expression. Sometimes the * mathematical expression itself must mutate in order to format the * quantity. So the returned mathematical expression may not necessarily be * the mathematical expression on which this method was invoked. For * example, the expression "unit" would mutate into "1 * unit" in order to * have a dimensionless member and therefore be able to format the $quantity */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatQuantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($quantity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       -,   . //   ‚Äì  ,  ‚Äì    . //      ,      . //      ,     $quantity. //        ,    // ‚Äú ‚Äù. // We expand this unit into "1 * $this" so we get a dimensionless // member that can be formatted. return (new MathematicalExpression(1 * ‚Äú . $this-&gt;toString()))-&gt;formatQuantity($quantity); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Calculate the absolute value of the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Numerically evaluate this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> float * Numerical value of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       ,  //       . //    ? - ,   ‚Äú‚Äù, //   ‚Äú ‚Äù. return is_object($this-&gt;decomposition) ? $this-&gt;decompose()-&gt;evaluate() : NULL; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Expression decomposition</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Decompose (simplify) this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Decomposed (simplified) version of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ,  . if (is_object($this-&gt;decomposition)) { return $this-&gt;decomposition-&gt;decompose(); } //         . return $this; }</span></span></code> </pre> <br></div></div><br><h4>  Mathematical operation </h4><br>  Here implementation will be a little more difficult. <br><br>  First, let's define the constants and units through the multiplication sign, i.e.  <i>10 meter</i> actually should be written in the form of <i>10 * meter</i> .  This is very useful because  allows you to write only units of measurement <i>meter / second</i> and their combination of any complexity: <i>10 * meter / second</i> or <i>10 * meter / (2 * second)</i> . <br><br>  We will take the binary tree as a basis.  In the tree node there will be an operator, and two children will have its operands.  With this construction we can build expressions of any complexity.  The expression <i>10 * meter + 20 * inch</i> will look like this: <br><br><img src="https://habrastorage.org/webt/a-/xs/0a/a-xs0ansrzn9sxr9w5ll_mwzblq.png" alt="image"><br><br>  Note that in the leaves of such a tree (the terminal node) there will be either units of measurement or constants, and in the other nodes - operators. <br><br>  For the most part, the operator implementation delegates the calls in the correct order to its two operands.  Our 4 operators differ from each other only in read places.  Therefore, I wrote a single implementation class and parameterized such a few places through the <code>$this-&gt;operator</code> property, the following parameters are packed in this property: <br><br><ul><li>  Calculating the absolute value having the absolute values ‚Äã‚Äãof both operands on hand.  I abstracted this part in the implementation in <code>$this-&gt;operator['evaluate callback']</code> . </li><li>  The need to compare dimensions - some operators require that both their operands have identical dimensions (sum), while others do not expose such a requirement (multiplication).  To do this, we store a simple Bulin flag in <code>$this-&gt;operator['dimension check']</code> . </li><li>  The calculation of the resulting dimension with known dimensions of both operands is abstracted into <code>$this-&gt;operator['dimension callback']</code> . </li><li>  The most difficult part is the logic responsible for formatting some absolute amount (the <code>formatQuantity()</code> method).  It is abstracted into <code>$this-&gt;operator['split quantity callback']</code> , which must distribute the absolute value between the first and second operand so that at least one of them has a ‚Äúbeautiful‚Äù constant. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Calculate the dimension of the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Determine physical dimension of this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * Dimension array of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      . //    /,   . //     /,  . , //        . // //       . //          // .  ‚Äúmeter ^ 2‚Äù   ‚Äúmeter ^ 3‚Äù.   //     dimension callback ‚Äì    //   ,     . $dimension_callback = $this-&gt;operator['dimension callback']; list($evaluate1, $evaluate2) = $this-&gt;evaluateOperands(); return $dimension_callback($this-&gt;operand1-&gt;dimension(), $this-&gt;operand2-&gt;dimension(), $evaluate1, $evaluate2); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">You have the dimensionless member ()</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Test whether this mathematical expression includes a dimensionless member. * * Whether this mathematical expression contains at least 1 dimensionless * member. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool * Whether this mathematical expression contains at least 1 dimensionless * member */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">containsDimensionlessMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ,        //   . return $this-&gt;operand1-&gt;containsDimensionlessMember() || $this-&gt;operand2-&gt;containsDimensionlessMember(); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Enter the required absolute value in the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Format a certain amount of quantity within this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> float $quantity * Quantity to be formatted * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Formatted quantity into this mathematical expression. Sometimes the * mathematical expression itself must mutate in order to format the * quantity. So the returned mathematical expression may not necessarily be * the mathematical expression on which this method was invoked. For * example, the expression "unit" would mutate into "1 * unit" in order to * have a dimensionless member and therefore be able to format the $quantity */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatQuantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($quantity)</span></span></span><span class="hljs-function"> </span></span>{ $contains_dimensionless1 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;operand1-&gt;containsDimensionlessMember(); $contains_dimensionless2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;operand2-&gt;containsDimensionlessMember(); <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($quantity1, $quantity2) = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;evaluateOperands(); <span class="hljs-comment"><span class="hljs-comment">//  ,        2 ,  //    ‚Äì     ,   // .  : (‚Äú1 * meter‚Äù)-&gt;formatQuantity(100);    //     , ..  2  ()  // ‚Äú‚Äù . if ($contains_dimensionless1 xor $contains_dimensionless2) { if ($contains_dimensionless1) { $this-&gt;operand1-&gt;formatQuantity($quantity / $quantity2); } else { $this-&gt;operand2-&gt;formatQuantity($quantity / $quantity1); } } else { //     ,     . //   ‚Äú1 * foot + 1 * inch‚Äù.      //     ,      - // ‚Äú‚Äù ,       . //     ‚Äú‚Äù    //  .         // split quantity    . $split_quantity = $this-&gt;operator['split quantity callback']; list($quantity1, $quantity2) = $split_quantity($quantity, $quantity1, $quantity2, $this-&gt;operator); //    ‚Äú‚Äù     , . $this-&gt;operand1-&gt;formatQuantity($quantity1); $this-&gt;operand2-&gt;formatQuantity($quantity2); } return $this; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Calculate the absolute value of the expression</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Numerically evaluate this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> float * Numerical value of this mathematical expression * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> UnitsMathematicalExpressionDimensionException * Exception is thrown if this mathematical expression has inconsistency in * physical dimensions */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,    . if ($this-&gt;operator['dimension check'] &amp;&amp; !units_dimension_equal($this-&gt;operand1-&gt;dimension(), $this-&gt;operand2-&gt;dimension())) { throw new UnitsMathematicalExpressionDimensionException(); } list($evaluate1, $evaluate2) = $this-&gt;evaluateOperands(); //       ,   //   ‚Äì  $evaluate1  $evaluate2  / //   ,  /    ,  //     $this-&gt;operator. $evaluate_callback = $this-&gt;operator['evaluate callback']; return $evaluate_callback($evaluate1, $evaluate2); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Expression decomposition</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Decompose (simplify) this mathematical expression. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Decomposed (simplified) version of this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         //           . return new OperatorMathematicalExpression($this-&gt;operator, $this-&gt;operand1()-&gt;decompose(), $this-&gt;operand2()-&gt;decompose()); }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Methods operand1 () and operand2 ()</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Retrieve operand #1 from this mathematical operator. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Operand #1 from this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operand1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;operand1; } <span class="hljs-comment"><span class="hljs-comment">/** * Retrieve operand #2 from this mathematical operator. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MathematicalExpression * Operand #2 from this mathematical expression */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operand2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;operand2; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Auxiliary method for calculating the absolute values ‚Äã‚Äãof the operands</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Numerically evaluate both operands and return them as an array. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * Array of length 2: the 2 operands numerically evaluated */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluateOperands</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $evaluate1 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;operand1-&gt;evaluate(); $evaluate2 = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;operand2-&gt;evaluate(); <span class="hljs-comment"><span class="hljs-comment">//  ,     ‚Äì   , //         // ,     . //  ,   0.   ‚Äì . //    =  * 1   6 .   //   ,    (  //   )   //  ,   . if (is_null($evaluate1)) { $evaluate1 = $this-&gt;operator['transparent operand1']; } if (is_null($evaluate2)) { $evaluate2 = $this-&gt;operator['transparent operand2']; } return array($evaluate1, $evaluate2); }</span></span></code> </pre> <br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such an implementation perfectly covers the needs of sum, subtraction, multiplication and division. </font><font style="vertical-align: inherit;">In conclusion, I will give a listing of some callbacks.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Callbacks for the amount </font></font></h4><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculating the absolute value for the sum</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">units_operator_add_evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($operand1, $operand2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    . return $operand1 + $operand2; }</span></span></code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of the resulting dimension for the sum</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">units_operator_add_dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($dimension1, $dimension2, $operator1, $operator2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ..       ,  //         . return $dimension1; }</span></span></code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The distribution of the absolute number between 2 sum operands</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">units_operator_add_split_quantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($total_quantity, $quantity1, $quantity2, $operator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    :  ,     //  (   +    ),   .  //     ,    . ..  //        ‚Äú ‚Äù    //  . $greatest_quantity = max($quantity1, $quantity2); $for_greater_quantity = floor($total_quantity / $greatest_quantity) * $greatest_quantity; $for_fewer_quantity = $total_quantity - $for_greater_quantity; return $quantity1 &gt; $quantity2 ? array($for_greater_quantity, $for_fewer_quantity) : array($for_fewer_quantity, $for_greater_quantity); }</span></span></code> </pre> <br></div></div><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kolbeki for multiplication </font></font></h4><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of the absolute value for multiplication</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">units_operator_multiply_evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($operand1, $operand2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $operand1 * $operand2; }</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculation of the resulting dimension for multiplication</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">units_operator_multiply_dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($dimension1, $dimension2, $operator1, $operator2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    . return units_dimension_add($dimension1, $dimension2); }</span></span></code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The distribution of the absolute number between 2 multiplication operands</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">units_operator_multiply_split_quantity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($total_quantity, $quantity1, $quantity2, $operator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      formatQuantity()     //  ,      : // 1 * foot + 1 * inch.   1 * foot  1 * inch ,    . //          ‚Äì   //    ,      // . return array($total_quantity, $operator['transparent operand2']); }</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similarly, Kolbeks look for other operations. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tasks with an asterisk * </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At school, at the very end of the lesson, the textbook had assignments with an asterisk ‚Äî the top five with a plus. </font><font style="vertical-align: inherit;">In this section I have placed such additional tasks, the implementation of which I will not include in the article.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Database </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We said that the database should be able to numerically calculate the value of expressions so that they can be sorted and filtered ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show the list of students sorted by height</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show students above 3 feet + 5 inches</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">I tried different ways to implement this task in the SQL toolkit and eventually came to recursive CTE (recursive Common Table Expressions).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Human-friendly interface </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would be necessary to implement the conversion of our expressions into a string that is convenient for human perception (this notation is called infix). </font><font style="vertical-align: inherit;">You can add a method to the expression interface </font></font><code>toInfix()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">But we also need the inverse operation ‚Äî something that can parse an infix expression into our binary tree. </font><font style="vertical-align: inherit;">This problem is solved rather trivially in the presence of Wikipedia and sensible brain. </font><font style="vertical-align: inherit;">Read about parsing infix and postfix notation. </font><font style="vertical-align: inherit;">The presence of such an infix parser makes life much easier for a programmer, since </font><font style="vertical-align: inherit;">expressions can be assembled by a simple call </font></font><code>units_mathematical_expression_create_from_infix(‚Äú10 * meter * kilogram / second‚Äù)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">And not a cumbersome construction in several lines, where for each operand we create our own object and put one object into another to build the final binary tree.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Additional operations </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mathematics is not limited to only four operations. </font><font style="vertical-align: inherit;">There is also a degree, root, factorial. </font><font style="vertical-align: inherit;">In my implementation, in addition to the four considered here, there is also a degree. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moreover, some operators have only 1 operand: factorial, for example. </font><font style="vertical-align: inherit;">This means that my model can and should be done more flexibly if we want to support more operations.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nonlinear conversions </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the challenge is straight with two asterisks **! The whole model that I described works only with linear conversions, i.e. with such units of measurement, which are converted among themselves by multiplying by some factor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such a conversion scheme is very practical, and therefore very popular: 100 meters in a meter, 12 inches in a foot. But there is one snag, and the name of that snag is Fahrenheit degrees. Honestly, I find it difficult to imagine how anyone could come up with such a temperature scale ... And then someone could take it as the main one to measure the temperature. But alas, the fact of the past days, and we, the descendants of those husbands, have no choice but to adapt to the situation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The problem with Fahrenheit is as follows. Quote from wikipedia:</font></font><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the Fahrenheit scale, the melting temperature of ice is +32 ¬∞ F, and the boiling point of water is +212 ¬∞ F (at normal atmospheric pressure). </font><font style="vertical-align: inherit;">In this case, one degree Fahrenheit is equal to 1/180 of the difference between these temperatures.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps this definition is not so obvious, but Fahrenheit is not converted linearly to Celsius. </font><font style="vertical-align: inherit;">There is no such factor, multiplying by which, we convert one into another.</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>t</mi><mi>C</mi></msub><mo>=</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mfrac><mn>5</mn><mn>9</mn></mfrac></mrow><mo>&amp;#x22C5;</mo><mrow><mo>(</mo><mrow><msub><mi>t</mi><mi>F</mi></msub><mo>&amp;#x2212;</mo><mn>32</mn></mrow><mo>)</mo></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.374ex" height="5.07ex" viewBox="0 -1402.6 7911.2 2182.7" role="img" focusable="false" style="vertical-align: -1.812ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-43" x="511" y="-219"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-3D" x="1277" y="0"></use><g transform="translate(2333,0)"><g transform="translate(120,0)"><rect stroke="none" width="620" height="60" x="0" y="220"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-35" x="60" y="676"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-39" x="60" y="-686"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-22C5" x="3416" y="0"></use><g transform="translate(3916,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-46" x="511" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-2212" x="1213" y="0"></use><g transform="translate(2214,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-32" x="500" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-29" x="3604" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mi>C</mi></msub><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mfrac><mn>5</mn><mn>9</mn></mfrac></mrow><mo>‚ãÖ</mo><mrow><mo>(</mo><mrow><msub><mi>t</mi><mi>F</mi></msub><mo>‚àí</mo><mn>32</mn></mrow><mo>)</mo></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1">t_C = { 5 \over 9 } \cdot \left( t_F - 32 \right)</script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>t</mi><mi>F</mi></msub><mo>=</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mfrac><mn>9</mn><mn>5</mn></mfrac></mrow><mo>&amp;#x22C5;</mo><msub><mi>t</mi><mi>C</mi></msub><mo>+</mo><mn>32</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.565ex" height="5.07ex" viewBox="0 -1402.6 7132.2 2182.7" role="img" focusable="false" style="vertical-align: -1.812ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-46" x="511" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-3D" x="1269" y="0"></use><g transform="translate(2325,0)"><g transform="translate(120,0)"><rect stroke="none" width="620" height="60" x="0" y="220"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-39" x="60" y="676"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-35" x="60" y="-686"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-22C5" x="3408" y="0"></use><g transform="translate(3908,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMATHI-43" x="511" y="-219"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-2B" x="5130" y="0"></use><g transform="translate(6131,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/359198/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhguZJY_HLxtK--hKMi_t6WzQu8ZzA#MJMAIN-32" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>t</mi><mi>F</mi></msub><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mfrac><mn>9</mn><mn>5</mn></mfrac></mrow><mo>‚ãÖ</mo><msub><mi>t</mi><mi>C</mi></msub><mo>+</mo><mn>32</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2">t_F = { 9 \over 5 } \cdot t_C + 32</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now the magic, watch your hands carefully: take 100 meters. Imagine them in the form of kilometers: 0.1 km. Multiply both options by 10. We get 1000 meters and 1 km. We give both options to meters and see the expected result - both expressions are equal. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repeat the trick with the temperature: take 10 C. Imagine in the form of Fahrenheit (50 F). Multiply by 10. Get 100 C and 500 F. Convert both into Celsius: 100 C and 260 C. What is it? By performing the same operation in two different ways, we received very different answers. This means that Celsius and Fahrenheit use fundamentally different scales and no math between them is applicable! At least without any adaptation of this mathematics, well or not all 100% of this mathematics. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try to analyze what can be done with this problem.</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will allow myself the last paragraph in order to turn back and look at the solution I described from an architectural point of view. Did you find the task difficult at the beginning? Is the proposed architecture easy to understand? Have you noticed that to solve it, I used 3 interfaces, 3 objects and a dozen functions? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is it convenient to extend such a calculator to additional basic units of measurement (for example, currency: dollars, euro) - easily! Even the code does not need to be edited. Whether it is possible to add new mathematical operations - it is possible, by means of local changes to obviously determined places.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is it convenient to use such a calculator? </font><font style="vertical-align: inherit;">Is it good with the portability (reuse) of such a system? </font><font style="vertical-align: inherit;">- It seems to be good, it can be used at a purely software API level, you can fasten some user interface with buttons. </font><font style="vertical-align: inherit;">Re-write the implementation to another programming language also does not imply any particular complexity. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The architecture is not overloaded with abstractions; each actor performs one exact self-sufficient operation, which means that it is not easy to ‚Äúnot understand‚Äù the meaning of an operation and it is difficult to use it for other purposes. </font><font style="vertical-align: inherit;">All functions / methods in their implementation do not occupy more than 20 lines of code. </font><font style="vertical-align: inherit;">Putting it all on unit testing is trite. </font><font style="vertical-align: inherit;">Architecture on the similarity of this, and I call it elegant. </font><font style="vertical-align: inherit;">They are beautiful and concise.</font></font></div><p>Source: <a href="https://habr.com/ru/post/359198/">https://habr.com/ru/post/359198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../359188/index.html">Intelligent Decision Support Systems - Brief Overview</a></li>
<li><a href="../359190/index.html">As our customer did not want to let go of the provider</a></li>
<li><a href="../359192/index.html">Classic JavaScript algorithms and data structures</a></li>
<li><a href="../359194/index.html">Java and Project Reactor. Episode 2</a></li>
<li><a href="../359196/index.html">Google Tag Manager usage examples for customTask</a></li>
<li><a href="../359200/index.html">Google accused of spying on users Safari on iPhone</a></li>
<li><a href="../359204/index.html">Build projects with dapp. Part 2: JavaScript (frontend)</a></li>
<li><a href="../359206/index.html">Caution. How to use process metrics without harming process health</a></li>
<li><a href="../359208/index.html">How to quickly and efficiently work with priorities according to the Lean Prioritization method?</a></li>
<li><a href="../359210/index.html">VPNFilter infected more than 500,000 devices worldwide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>