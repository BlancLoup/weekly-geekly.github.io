<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make 200 lines from two lines of code, and why do you need to do that</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 


 I (we as a company) finish the platform from the supplier, the platform is a plugin for WordPress. I am familiar with the frontend, JS, HTM...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make 200 lines from two lines of code, and why do you need to do that</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello. </p><br><p>  I (we as a company) finish the platform from the supplier, the platform is a plugin for WordPress.  I am familiar with the frontend, JS, HTML only insofar as, therefore, the <strong>given solutions may not be literate, but this is not the essence of the article</strong> . </p><br><p>  The point is to show clearly why sometimes instead of two lines of code, it would be the right decision to write two hundred. </p><br><p>  Beginner developers, and developers with experience for which such a thought looks dubious, please under the cat. </p><a name="habracut"></a><br><h2 id="vvedenie">  Introduction </h2><br><p>  Reading the article without reading the comments in the code does not make sense, because the comments of the code are not duplicated in the text of the article and the text of the article implies that the reader has read the comments. </p><br><h2 id="zadacha">  Task </h2><br><p>  It was necessary to make changes to JS, I make changes to separate files in order to "pollute" the source code of the platform provider as little as possible, so in the future it will be easier to adapt updates to the source code of the platform. </p><br><p>  Accordingly, the code of the new functionality is in the new files that need to be uploaded on the page. </p><br><p>  Task: it is required when loading the page to load certain files. </p><br><h2 id="pervyy-blin-komom">  First damn lump </h2><br><pre><code class="xml hljs">+<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e-cryptex.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> +<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wp-content/themes/tol-child/js/child_realforex.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  (lines with "+" are new lines in the source code) </p><br><p>  The solution was tested for the main page and it worked there, it later turned out that for the pages with the example.com/about address, the solution did not work, because the browser tried to load example.com/about/e-cryptex.js and the browser received - error 404 , because the file really lay in the root - example.com/e-cryptex.js. </p><br><h2 id="vtoroy-variant">  Second option </h2><br><p>  I looked at how the developers of the platform cling to the page: </p><br><pre> <code class="php hljs">wp_register_script(FILE-ID,FILE-PATH); wp_enqueue_script(FILE-ID);</code> </pre> <br><p>  Files are attached using WordPress functionality - ok, let's do the same: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// : -&lt;script src="e-cryptex.js"&gt;&lt;/script&gt; -&lt;script src="wp-content/themes/tol-child/js/child_realforex.js"&gt;&lt;/script&gt; //  : +</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> +const E_CRYPTEX_JS ='e-cryptex_js'; +wp_register_script(E_CRYPTEX_JS,'/e-cryptex.js',array(),null); +wp_enqueue_script(E_CRYPTEX_JS); +const CHILD_REALFOREX_JS = 'child_realforex_js'; +wp_register_script( + CHILD_REALFOREX_JS, + '/wp-content/themes/tol-child/js/child_realforex.js', + array(E_CRYPTEX_JS), + null); +wp_enqueue_script(CHILD_REALFOREX_JS); +</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  (lines with "+" are new lines in the source code, lines with "-" are lines deleted from the source code). </p><br><p>  Checked - works, ok. </p><br><p>  There were two lines - it was 12, all within the same file. </p><br><h2 id="refaktoring">  Refactoring </h2><br><p>  I looked at this code, and my sense of beauty rebelled: </p><br><ul><li>  a person not familiar with WordPress will not understand anything - you will have to go into the directory to understand the purpose of the functions wp_register_script () and wp_enqueue_script () </li><li>  obviously the same thing is done twice in a row, the arguments are just different - DRY is broken </li></ul><br><p>  Ok, refactor. </p><br><p>  First, we make a class (one file), and second, we connect the class and use it (we change another file). </p><br><h3 id="delaem-klass">  Making a class </h3><br><pre> <code class="php hljs">+<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migesco</span></span></span><span class="hljs-class"> </span></span>{ + + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SCRIPT = <span class="hljs-string"><span class="hljs-string">'script'</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOURCE = <span class="hljs-string"><span class="hljs-string">'source'</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEPENDENCY = <span class="hljs-string"><span class="hljs-string">'dependency'</span></span>; + <span class="hljs-comment"><span class="hljs-comment">//   ,      'configuration.js', //     ""   . + static function attachConfigurationJS(){ + $configurationFiles = array( + array(Migesco::SCRIPT =&gt; 'configuration.js', + Migesco::SOURCE=&gt;'/configuration.js')); + Migesco::includeScriptFiles($configurationFiles); + } //              + static function includeScriptFiles($scriptFiles){ + foreach ($scriptFiles as $scriptFile){ + $dependency = array_key_exists(self::DEPENDENCY,$scriptFiles) + ? $scriptFile[self::DEPENDENCY] + : array(); + self::includeScript($scriptFile[self::SCRIPT],$scriptFile[self::SOURCE],$dependency); + } + } //    , //    "",     // (     ) + static function includeScript($id,$source,$dependency){ + wp_register_script($id,$source,$dependency,null); + wp_enqueue_script($id); + } +}</span></span></code> </pre> <br><h3 id="podklyuchaem-i-ispolzuem">  We connect and use </h3><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//: -const E_CRYPTEX_JS ='e-cryptex_js'; -wp_register_script(E_CRYPTEX_JS,'/e-cryptex.js',array(),null); -wp_enqueue_script(E_CRYPTEX_JS); -const CHILD_REALFOREX_JS = 'child_realforex_js'; -wp_register_script( - CHILD_REALFOREX_JS, - '/wp-content/themes/tol-child/js/child_realforex.js', - array(E_CRYPTEX_JS), - null); -wp_enqueue_script(CHILD_REALFOREX_JS); // : //  +require_once(ABSPATH . 'configuration.php'); //  +const ECRYPTEX_JS = 'cryptex'; +const TRADEROOM_SCRIPT_FILES = array( + array(Migesco::SCRIPT =&gt; ECRYPTEX_JS, + Migesco::SOURCE=&gt;'/e-cryptex.js'), + array(Migesco::SCRIPT =&gt; 'child_realforex', + Migesco::SOURCE=&gt;'/wp-content/themes/tol-child/js/child_realforex.js', + Migesco::DEPENDENCY =&gt;ECRYPTEX_JS) +); +Migesco::includeScriptFiles(TRADEROOM_SCRIPT_FILES); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  There were 12 lines of source in one file was 35, and in two (support it later, look for rysch where else to correct, whatever you forget, not to miss, not to miss). </p><br><h2 id="i-eschyo-raz-refaktring">  And again refactoring </h2><br><p>  Looked at the new code: </p><br><ul><li>  what static methods </li><li>  what are the constants ... </li></ul><br><p>  looks clumsy!  I remember this advice: "if the constructor has no arguments, is such a class necessary?" </p><br><p>  Let's redo it, but a normal class, with a normal constructor and methods. </p><br><h3 id="klass">  Class </h3><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// : -class Migesco { - - const SCRIPT = 'script'; - const SOURCE = 'source'; - const DEPENDENCY = 'dependency'; - - static function attachConfigurationJS(){ - $configurationFiles = array( - array(Migesco::SCRIPT =&gt; 'configuration.js', - Migesco::SOURCE=&gt;'/configuration.js')); - Migesco::includeScriptFiles($configurationFiles); - } - static function includeScriptFiles($scriptFiles){ - foreach ($scriptFiles as $scriptFile){ - $dependency = array_key_exists(self::DEPENDENCY,$scriptFiles) - ? $scriptFile[self::DEPENDENCY] - : array(); - self::includeScript($scriptFile[self::SCRIPT],$scriptFile[self::SOURCE],$dependency); - } - } - static function includeScript($id,$source,$dependency){ - wp_register_script($id,$source,$dependency,null); - wp_enqueue_script($id); - } -} //: //      : //   //   //    //       +namespace Migesco; + + //      html- +class Configurator +{ //               + static function attachConfigurationJS() + { + $configurationFiles = array( + (new WebResource('configuration.js'))-&gt;setSource('/configuration.js')); + self::attachFiles($configurationFiles); + } + //      html- + static function attachFiles($resourceList) + { + (new Registrar($resourceList))-&gt;toRegistrate(); + } +} + //      html- +class Registrar +{ //     + public $list = array(); //     private (   ) + /** @var WebResource $resource */ + public $resource = null; + + public function __construct($list) + { + $isArray = is_array($list); + if ($isArray) { + $this-&gt;list = $list; + } + } + //      WordPress + function registerScript() + { + wp_register_script( + $this-&gt;resource-&gt;getName(), + $this-&gt;resource-&gt;getSource(), + $this-&gt;resource-&gt;getDependency(), + null); + } + //     + function enqueueScript() + { + wp_enqueue_script($this-&gt;resource-&gt;getName()); + } + //      + function toRegistrate() + { + $result = false; + foreach ($this-&gt;list as $resource) { + /** @var WebResource $resource */ + $isResource = $resource instanceof WebResource; + if ($isResource) { + $this-&gt;resource = $resource; + $this-&gt;registerScript(); + $this-&gt;enqueueScript(); + + $result = true; + } + } + return $result; + } +} + //     +class WebResource +{ //    + public $source = ''; //   + public $name = ''; //   + public $dependency = array(); + + public function __construct($name) + { + $this-&gt;setName($name); + } + + /** + * @param string $source + * @return WebResource + */ + public function setSource($source) + { + $this-&gt;source = strval($source); + return $this; + } + + /** + * @param string $name + * @return WebResource + */ + public function setName($name) + { + $this-&gt;name = strval($name); + return $this; + } + + /** + * @param array $dependency + * @return WebResource + */ + public function setDependency($dependency) + { + $isArray = is_array($dependency); + if ($isArray) { + $this-&gt;dependency = $dependency; + } + return $this; + } + + /** + * @return string + */ + public function getSource() + { + return $this-&gt;source; + } + + /** + * @return string + */ + public function getName() + { + return $this-&gt;name; + } + + /** + * @return array + */ + public function getDependency() + { + return $this-&gt;dependency; + } +}</span></span></code> </pre> <br><h3 id="ispolzovanie">  Using </h3><br><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// : -const TRADEROOM_SCRIPT_FILES = array( - array(Migesco::SCRIPT =&gt; ECRYPTEX_JS, - Migesco::SOURCE=&gt;'/e-cryptex.js'), - array(Migesco::SCRIPT =&gt; 'child_realforex', - Migesco::SOURCE=&gt;'/wp-content/themes/tol-child/js/child_realforex.js', - Migesco::DEPENDENCY =&gt;ECRYPTEX_JS) -); -Migesco::includeScriptFiles(TRADEROOM_SCRIPT_FILES); // : +$traderoomScriptFiles = array( + (new Migesco\WebResource(ECRYPTEX_JS)) + -&gt;setSource('/e-cryptex.js'), + (new Migesco\WebResource('child_realforex')) + -&gt;setSource('/wp-content/themes/tol-child/js/child_realforex.js') + -&gt;setDependency(array(ECRYPTEX_JS)) +); +Migesco\Configurator::attachFiles($traderoomScriptFiles); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  You can do refactoring again (the platform works on PHP 5.6 - I would like to place types everywhere, but unfortunately it‚Äôs impossible, you can make the static class Configurator more human, for example, initialize from the list of files - web resources and the attachFiles method do not static), but ideal things for an ideal world, we live in a real world, and this makes its own corrections - time is spent on the task - work on the task is stopped. </p><br><p>  Total: there were 35 lines in source codes in two files, it became ~ 170, also in two files. </p><br><h2 id="chto-my-poluchili-">  What did we get? </h2><br><ol><li>  Now it is not necessary to go into Help WordPress  ªa, to understand the purpose of the parameters of "functions". </li><li>  Now we have a wrapper for connecting files and we can painfully change the file connection algorithm - we don‚Äôt have to edit all wp_register_script and wp_enqueue_script calls </li><li>  Now we can change WordPress to anything and only have to rewrite the class <br>  Registrar, it is not necessary to replace all wp_register_script and wp_enqueue_script calls and follow the logic of WordPress. </li></ol><br><p>  Is it worth it? </p><br><p>  Everyone has their own approach to the support of the code base and their opinion. </p><br><p>  My answer is yes. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/435216/">https://habr.com/ru/post/435216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435206/index.html">In Europe, approved the Copyright Directive - why streaming platforms oppose</a></li>
<li><a href="../435208/index.html">Internet of things ... that cry for good UI / UX</a></li>
<li><a href="../435210/index.html">Xamarin work with SDK written in C</a></li>
<li><a href="../435212/index.html">How to forget about paper business cards in the new year</a></li>
<li><a href="../435214/index.html">Linux 4.20 released - what has changed in the new kernel version</a></li>
<li><a href="../435220/index.html">Kotlin Native: Watch Files</a></li>
<li><a href="../435224/index.html">How to communicate in an English-speaking office: 14 useful idioms</a></li>
<li><a href="../435226/index.html">Recover data from empty space</a></li>
<li><a href="../435228/index.html">Kubernetes Cluster for $ 20 per month</a></li>
<li><a href="../435234/index.html">Smarter, more, more precisely: how does AI change flights into space</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>