<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mobile Internet security inside and out</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the development of mobile networks, mobile Internet is also developing. Everyone is used to the usual Internet: twisted pair, Ethernet, TCP / IP....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mobile Internet security inside and out</h1><div class="post__text post__text-html js-mediator-article">  With the development of mobile networks, mobile Internet is also developing.  Everyone is used to the usual Internet: twisted pair, Ethernet, TCP / IP.  And what does the Internet mobile hide in itself?  Let's try to find out!  In our study, we will touch on the general principles of the mobile Internet, take a closer look at the GPRS Tunneling Protocol, talk about the GRX network and discuss some practical approaches to the security of a mobile packet network. <br><br>  How each of us connects to the mobile Internet?  In principle, you need to know only three parameters: APN, login and password.  APN is an access point through which a subscriber can connect to the necessary service (WAP, MMS, Internet);  with our operators, it usually looks like internet. &lt;operator-name&gt; .ru.  Login and password are usually simple: internet - internet or something like that. <a name="habracut"></a><br><br>  Now that we know the necessary parameters, we can connect to the mobile Internet!  How does this mysterious procedure occur?  It occurs in two stages: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  GPRS Attach, </li><li>  PDP Context Activation. </li></ol><br>  Let's take a closer look at each of them. <br><br><h4>  GPRS Attach </h4><br>  In the GPRS Attach procedure, the phone starts to ‚Äúcommunicate‚Äù with the operator's packet network.  There is an authentication and authorization of user equipment on the following parameters: <br><br>  IMSI (International Mobile Subscriber Identity, individual subscriber number) - for identification <ul><li>  subscriber; </li><li>  Keys stored on the SIM card - for subscriber authentication; </li><li>  checking available services to the subscriber (Internet, MMS, WAP) by recording in the subscriber database </li></ul>  . <br>  IMEI (International Mobile Equipment Identity - International Mobile Equipment Identity) can also be checked.  This identifier can be used to check the lists of stolen equipment, and if a specific IMEI is on the list of stolen, then access to the network may be denied, or even reported "where it should be" :) <br><br>  Upon successful completion of the GPRS Attach procedure, the PDP (Packet Data Protocol) Context Activation procedure begins.  To understand this procedure, we digress and define some concepts. <br>  SGSN (Serving GPRS Support Node, GPRS customer service node) is a device that implements the basic functions of packet data processing in a mobile network. <br><br>  GGSN (GPRS Gateway Service Node, gateway GPRS node) is a device that provides data transmission from the operator‚Äôs network to external networks (for example, to the Internet).  In fact, it can be a regular router with support for some specific functions. <br><br>  GTP (GPRS Tunneling Protocol) is a protocol stack used in GPRS, UMTS and LTE networks. <br>  So, PDP Context Activation (the scheme is greatly simplified). <br><br><img src="https://habrastorage.org/storage2/42e/3ac/008/42e3ac008225a92c670977fdca9e3652.png"><br><br>  What happens during the implementation of this scheme? <br><br><ol><li>  The phone sends a context activation request to the SGSN, which, among other things, includes a username, password and APN. </li><li>  SGSN, having received the APN, tries to resolve it on the internal DNS server.  The server resolves the provided APN and returns the address of the responsible APN GGSN. </li><li>  At this address, the SGSN sends a request to create a PDP context. </li><li>  GGSN checks the login and password provided on the RADIUS server. </li><li>  Then it gets an IP address for our phone. </li><li>  And all the information needed to activate the PDP context is transmitted back to the SGSN. </li><li>  The SGSN completes the activation procedure by sending the data necessary for establishing a connection to the telephone. </li></ol><br>  In essence, the PDP Context Activation procedure is the creation of a tunnel between the telephone and the gateway in the carrier's network.  And now we can go to your favorite sites and read the mail. <br><br><h4>  Roaming </h4><br>  Immediately the question arises: how does all this work in roaming?  It turns out that there is a special network: GRX (Global Roaming Exchange) - a network for exchanging packet data of roaming subscribers of mobile networks.  Through it and all our traffic "runs".  Like this: <br><br><img src="https://habrastorage.org/storage2/ad6/a8b/324/ad6a8b324d69d1cd5675cc22d455157c.png"><br><br><ol><li>  Successfully having reached the hot edges, we decided to download our favorite series.  Turned on the phone, started to connect to the Internet (send login, password, APN). </li><li>  The foreign SGSN tries to resolve the APN provided by us on its DNS server. </li><li>  The DNS server, not having found such records, calls the root DNS server, which is located in the GRX network. </li><li>  The root DNS server sends a request to the DNS server on the network of our native operator. </li><li>  That, in turn, responds to it with the address of our GGSN. </li><li>  The root DNS reports this address to the DNS server of the foreign operator. </li><li>  Which in turn reports this address to a foreign SGSN. </li><li>  The SGSN, knowing the GGSN address, sends it a request to activate the PDP context. </li><li>  GGSN, if all the conditions are met (there is money in the account, the correct username and password are indicated, etc.), sends a confirmation, SGSN accepts it and sends a confirmation to our phone for Internet access. </li></ol><br>  What do we see?  We see that the packages with our favorite series run through half the world from our operator to the operator in a warm country.  They run on a special network, wrapped in GTP protocol.  And all the negotiations between the operators' special trains are being conducted on the same GTP. <br><br>  And here comes the idea: wouldn‚Äôt we try to figure out something similar under laboratory conditions?  Build your SGSN and GGSN.  Well, how come to incredible discoveries? <br><br><h4>  SGSN + GGSN on the knee </h4><br><img src="https://habrastorage.org/storage2/f21/bc7/609/f21bc7609071a6d6e6de548c5d942f3f.jpg"><br><br>  After a long search, it turned out the following. <br><br>  There is a special purpose software that implements some of the functions of the SGSN.  It looks like a script for Linux, which is able to emulate all the necessary procedures (GPRS Attach and PDP Context Activation) and issue a complete interface for accessing the Internet as if we stuck a 3G modem.  Upon learning of this, we immediately rushed to look for a device that was ready to shoulder the functions of GGSN.  It turned out that the popular Cisco 7200 router is quite suitable. <br><br>  After some manipulations, settings and tests, success awaited us. <br><br><img src="https://habrastorage.org/storage2/4ee/e39/c1d/4eee39c1d71f18185bcb98f3efd8fd0d.png"><br><br>  The stand easily lifted tunnels through which the real Internet was "visible".  We immediately began to look at what packages go between our mighty SGSN and GGSN.  Do they look like real ones?  With a sinking heart, we open a dump - and yes!  packages like real ones. <br><br><img src="https://habrastorage.org/storage2/dd0/24a/e8a/dd024ae8a43507984dad0e21b9286ede.png"><br><br>  Similar packages can go to the GRX-network, and they may well be overheard by an evil hacker.  What does he see there?  Let's try to find out. <br><br><h4>  Security questions </h4><br>  GTP protocol can be of several types: GTP-U is used to directly package and transfer user data, GTP-C for session management (it is with its help the PDP Context Activation procedure and other service procedures are performed);  there is also GTP '(GTP Prime) - it is used to transfer billing information.  GTP does not support peer authentication and encryption; it works over UDP.  What is interesting about all this?  It is interesting here almost everything! <br><br>  Take GTP-U and see what a tunnel with user data looks like.  Tunnels are separated by a TEID (Tunnel Endpoint Identificator) parameter. <br><br><img src="https://habrastorage.org/storage2/ea4/0c6/d80/ea40c6d80bc1c3aeb803402aa80f8f59.png"><br><br>  Upon further study, it turned out that, if desired, the TEID field can be changed, and by sending a packet with a spoofed tunnel identifier, you can unexpectedly break into someone else's session. <br><br>  But GTP-C.  Surprisingly, if there is no authentication or hints of encryption of the transmitted data, you can try not only to listen, but also, sorry, send something.  For example, "left" requests to establish or terminate a session. <br><br>  Let us try to outline the vectors of possible attacks and consider them closer. <br><br><img src="https://habrastorage.org/storage2/c5d/20e/3c0/c5d20e3c0e92e4a5911401b524745b05.png"><br><br>  Here, for example, attack DNS flood.  The attacker sends a large number of requests for permission APN of our operator.  All these packets will bombard the poor carrier DNS, which will not withstand the heat and generally refuse to transmit the GGSN address to anyone, causing a global DoS for subscribers. <br><br><img src="https://habrastorage.org/storage2/8f3/661/62e/8f366162e6604664a0299dc2f0b6c27b.png"><br><br>  Or, the attacker will begin to send his own requests to create a PDP context.  GGSN, seeing such pressure, may well think, or even hang.  Which again will lead to a denial of service subscribers. <br><br>  But what if, instead of creating requests, you try sending session break requests? <br><br>  For example, like this: <br><br><img src="https://habrastorage.org/storage2/c04/a5a/3af/c04a5a3af37c68af3c12b1f17bac9073.png"><br><br>  Angry hacker, substituting the address of a foreign SGSN, will send requests to disconnect.  GGSN, thinking that the subscriber downloaded his favorite series and wants to complete the Internet session, removes this tunnel from himself, breaking the connection. <br><br>  Sketching a few vectors, turn our eyes to real objects in order to ‚Äútouch‚Äù all this.  Type the query "GGSN" in the shodan.  Here is a piece of results issued. <br><br><img src="https://habrastorage.org/storage2/dd5/f5c/e5c/dd5f5ce5cdd07db72982f3cc24b8bfb7.png"><br><br>  All this looks like a real GGSN, put on the Internet. <br><br>  Or try writing a script that sends GTP-echo requests, and even let it go for a walk on the Internet: what if someone responds.  And the respondents are: <br><br><img src="https://habrastorage.org/storage2/8f2/73b/a00/8f273ba001c851a750dd8fce8d765ef2.png"><br><br>  Sometimes even with open telnet. <br><br><img src="https://habrastorage.org/storage2/1c9/b2b/e1f/1c9b2be1fc777ef608e17b5c91c1beef.png"><br><br>  In the new generation standard, codenamed LTE, GTP is still used, and therefore all of the above is relevant and will be relevant in the foreseeable future. <br><br>  That's all for today.  See you again! <br><br>  I want to express my gratitude to the department of security analysis of network devices Positive Technologies for their help in preparing the material. <br><br>  Author: Ilya Safronov, Positive Research. </div><p>Source: <a href="https://habr.com/ru/post/188574/">https://habr.com/ru/post/188574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188562/index.html">The last day of the 21st century in Russia and the evolution of protest</a></li>
<li><a href="../188566/index.html">Brief history of immortality</a></li>
<li><a href="../188568/index.html">And one more post about Flat Design, or why everyone ‚Äúrushed‚Äù to make flat interfaces</a></li>
<li><a href="../188570/index.html">Startup-gatherings: Aigul Mirzayanova held a master class on working with the audience in public speaking</a></li>
<li><a href="../188572/index.html">Facebook has enabled https for everyone</a></li>
<li><a href="../188576/index.html">Avaya Aura Communication Manager: Automatic Dialing</a></li>
<li><a href="../188578/index.html">XKeyscore is another secret program from the NSA of the USA, revealed by Snowden</a></li>
<li><a href="../188580/index.html">Why web applications on mobile platforms are slow</a></li>
<li><a href="../188582/index.html">Limbo similar puzzle platformer - Monochroma</a></li>
<li><a href="../188586/index.html">The last day of the 21st century or the end of the oil toad?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>