<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rust 1.34 release</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to your attention the translation of the article "The Rust Release Team" Announcing Rust 1.34.0 " . 


 The Rust development team ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rust 1.34 release</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  I present to your attention the translation of the article <a href="https://blog.rust-lang.org/2019/04/11/Rust-1.34.0.html">"The Rust Release Team" Announcing Rust 1.34.0 "</a> . </p><br><p>  The Rust development team is pleased to announce the release of a new version of Rust, 1.34.0.  Rust is a programming language that enables everyone to create reliable and efficient software. </p><br><p>  If you have a previous version of Rust installed using rustup, then to update Rust to version 1.34.0, you just need to run: </p><br><pre><code class="plaintext hljs">$ rustup update stable</code> </pre> <br><p>  If you have not yet installed rustup, you can <a href="https://www.rust-lang.org/install.html">install it</a> from the corresponding page of our website. </p><br><h2 id="chto-voshlo-v-stabilnuyu-versiyu-1340">  What is included in the stable version 1.34.0 </h2><br><p>  The main improvement to this release is support for alternative cargo registries.  Does the release also include support <code>?</code>  in documentation tests, some improvements in <code>#[attribute(...)]</code> and <code>TryFrom</code> stabilization.  Read on for key points or see the <a href="">detailed release notes</a> for more information. </p><a name="habracut"></a><br><h3 id="alternativnye-cargo-reestry">  Alternative <code>cargo</code> registries </h3><br><p>  Even before version 1.0, Rust had a public registry, <a href="http://crates.io/">crates.io</a> .  People published crates with <code>cargo publish</code> and easily connected these crates in the <code>[dependencies]</code> section of <code>Cargo.toml</code> . </p><br><p>  However, not everyone <em>wants to</em> publish their crates on crates.io.  People supporting closed source projects could not use crates.io, and instead they had to specify <code>git</code> or <code>path</code> in dependencies.  There is nothing like this for small projects, but if your large organization has a lot of closed-source crate, you lose the benefits of versioning support, which is in crates.io. </p><br><p>  Starting with this release, Cargo may support alternative registries.  These registries coexist with crates.io, so you can write programs that depend on crates.io and your registry.  However, crates.io crates cannot depend on an external registry. </p><br><p>  To use alternative registries, you must add the following lines to <code>.cargo/config</code> .  This file can be in your home directory ( <code>~/.cargo/config</code> ) or in a package directory. </p><br><pre> <code class="plaintext hljs">[registries] my-registry = { index = "https://my-intranet:8080/git/index" }</code> </pre> <br><p>  Add dependencies from an alternative registry is easy.  When you specify a dependency in <code>Cargo.toml</code> , use the <code>registry</code> key so that Cargo knows that you want to receive the crate from an alternative registry: </p><br><pre> <code class="plaintext hljs">[dependencies] other-crate = { version = "1.0", registry = "my-registry" }</code> </pre> <br><p>  As the author of the crate, if you want to publish your crate in the alternative registry, the first thing you need to do is save the authentication token in <code>~/.cargo/credentials</code> using the <code>cargo login</code> command: </p><br><pre> <code class="plaintext hljs">cargo login --registry=my-registry</code> </pre> <br><p>  Then you can use the <code>--registry</code> flag to specify the registry to which the crate will be published: </p><br><pre> <code class="plaintext hljs">cargo publish --registry=my-registry</code> </pre> <br><p>  How you can run your own registry, you can find in the <a href="https://doc.rust-lang.org/nightly/cargo/reference/registries.html">documentation</a> . </p><br><h3 id="-v-dokumentacionnyh-testah"> <code>?</code>  in documentation tests </h3><br><p>  In <a href="https://rust-lang.github.io/rfcs/1937-ques-in-main.html">RFC 1937,</a> it was suggested to add support for using the operator <code>?</code>  in <code>fn main()</code> , <code>#[test]</code> functions and documentation tests, allowing them to return <code>Option&lt;T&gt;</code> or <code>Result&lt;T, E&gt;</code> where the error option results in a nonzero exit code in the case of <code>fn main()</code> or a dropped test in the case of tests . </p><br><p>  Support in <code>fn main()</code> and <code>#[test]</code> was implemented <a href="https://blog.rust-lang.org/2018/05/10/Rust-1.26.html">a long time ago</a> .  However, support in documentation tests was limited to tests in which <code>fn main()</code> clearly present. </p><br><p>  Does this release add full support <code>?</code>  in the documentation tests.  Now you can write in your documentation tests: </p><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">/// ```rust /// use std::io; /// let mut input = String::new(); /// io::stdin().read_line(&amp;mut input)?; /// # Ok::&lt;(), io:Error&gt;(()) /// ``` fn my_func() {}</span></span></code> </pre> <br><p>  At the bottom of the documentation test, you still need to specify the type of error that will be used. </p><br><h3 id="podderzhka-proizvolnogo-potoka-tokenov-v-polzovatelskih-atributah">  Support for arbitrary token flow in custom attributes </h3><br><p>  <a href="https://blog.rust-lang.org/2018/12/21/Procedural-Macros-in-Rust-2018.html">Procedural macros</a> in Rust can define custom attributes that they use.  Until now, these attributes were limited to path trees and literals according to the following syntax: </p><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[foo(bar)]</span></span> <span class="hljs-meta"><span class="hljs-meta">#[foo = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"bar"</span></span></span><span class="hljs-meta">]</span></span> <span class="hljs-meta"><span class="hljs-meta">#[foo = 0]</span></span> <span class="hljs-meta"><span class="hljs-meta">#[foo(bar = true)]</span></span> <span class="hljs-meta"><span class="hljs-meta">#[foo(bar, baz(quux, foo = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"bar"</span></span></span><span class="hljs-meta">))]</span></span></code> </pre> <br><p>  Unlike procedural macros, these auxiliary attributes could not accept an arbitrary stream of tokens in the delimiter, which is why you could not write <code>#[range(0..10)]</code> or <code>#[bound(T: MyTrait)]</code> .  The crate of procedural macros instead used strings for syntax like this, for example <code>#[range("0..10")]</code> . </p><br><p>  With this release, custom attributes <code>#[attr($tokens)]</code> <a href="https://github.com/rust-lang/rust/pull/57367">allow you to use</a> arbitrary tokens in <code>$tokens</code> , aligning them with macros.  If you are the author of the procedure macro crate, please check if the syntax of your user attributes is used in the syntax and can be replaced with a stream of tokens. </p><br><h3 id="tryfrom-i-tryinto">  <code>TryFrom</code> and <code>TryInto</code> </h3><br><p>  The <a href="https://doc.rust-lang.org/std/convert/trait.TryFrom.html"><code>TryFrom</code></a> and <a href="https://doc.rust-lang.org/std/convert/trait.TryInto.html"><code>TryInto</code></a> were stabilized to support type conversion errors. </p><br><p>  For example, <a href="https://doc.rust-lang.org/std/primitive.u32.html"><code>from_be_bytes</code></a> and the associated methods of integer types get an array, but the data is often read through slices.  Manual conversion between slices and arrays is tedious.  With new traits, it is possible to do this in a single line with <code>.try_into()</code> . </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> num = <span class="hljs-built_in"><span class="hljs-built_in">u32</span></span>::from_be_bytes(slice.try_into()?);</code> </pre> <br><p>  For conversions that cannot complete with an error, such as <code>u8</code> to <code>u32</code> , the type <a href="https://doc.rust-lang.org/std/convert/enum.Infallible.html"><code>Infallible</code></a> added.  Due to this, <code>TryFrom</code> automatically implemented for everything that the <code>From</code> trait implements.  In the future, we hope to make <code>Infallible</code> pseudonym for the <a href="https://github.com/rust-lang/rust/issues/35121"><code> !</code></a>  <a href="https://github.com/rust-lang/rust/issues/35121">(never)</a> . </p><br><h3 id="fn-before_exec-ustarela-v-polzu-unsafe-fn-pre_exec">  <code>fn before_exec</code> deprecated in favor of <code>unsafe fn pre_exec</code> </h3><br><p>  On Unix-like systems, the <a href="https://doc.rust-lang.org/std/os/unix/process/trait.CommandExt.html"><code>CommandExt::before_exec</code></a> allowed you to schedule a closure before calling <code>exec</code> . </p><br><p>  This closure was performed in the context of the child process after the fork.  This means that resources, such as file descriptors and memory areas, could be duplicated.  In other words, you could get a copy of the value of a non- <code>Copy</code> type in different processes, while the original would remain in the parent.  <a href="https://github.com/rust-lang/rust/issues/39575">This could</a> lead to indefinite behavior and break down <a href="https://github.com/rust-lang/rust/issues/39575">libraries implying no duplication</a> . </p><br><p>  Therefore, the <code>before_exec</code> function should be marked <code>unsafe</code> .  In this issue, we have marked <code>fn before_exec</code> obsolete in favor of <code>unsafe fn pre_exec</code> .  When calling <a href="https://doc.rust-lang.org/std/os/unix/process/trait.CommandExt.html"><code>CommandExt::pre_exec</code></a> you need to make sure that the closure does not violate the library invariants by creating non-valid duplicates.  If you are providing a library that is in a situation similar to <code>before_exec</code> , consider obsolescence and provide an alternative to <code>unsafe</code> . </p><br><h3 id="stabilizaciya-v-bibliotekah">  Library Stabilization </h3><br><p>  In 1.34.0, the set of stable atomic integer signed and unsigned types is extended, starting with 8 bit ( <a href="https://doc.rust-lang.org/std/sync/atomic/struct.AtomicU8.html"><code>AtomicU8</code></a> ) and ending with 64 bit. </p><br><p>  <a href="">Previously</a> , nonzero unsigned integer numbers such as <a href="https://doc.rust-lang.org/std/num/struct.NonZeroU8.html"><code>NonZeroU8</code></a> have been stabilized.  Thanks to this, the <code>Option&lt;NonZeroU8&gt;</code> is the same size as the <code>u8</code> .  In this release, sign versions are stabilized, such as <a href="https://doc.rust-lang.org/std/num/struct.NonZeroI8.html"><code>NonZeroI8</code></a> . </p><br><p>  The functions <a href="https://doc.rust-lang.org/std/iter/fn.from_fn.html"><code>iter::from_fn</code></a> and <a href="https://doc.rust-lang.org/std/iter/fn.successors.html"><code>iter::successors</code></a> stabilized.  The first allows you to create an iterator from <code>FnMut() -&gt; Option&lt;T&gt;</code> .  To iteratively get elements from a vector, you can now write <code>from_fn(|| vec.pop())</code> .  Meanwhile, the second function creates a new iterator, where each next element is calculated based on the previous one. </p><br><p>  Additionally, the following APIs have been stabilized: </p><br><ul><li>  <a href="https://doc.rust-lang.org/std/any/trait.Any.html">Any :: type_id</a> </li><li>  <a href="https://doc.rust-lang.org/std/error/trait.Error.html">Error :: type_id</a> </li><li>  <a href="https://doc.rust-lang.org/std/primitive.slice.html">slice :: sort_by_cached_key</a> </li><li>  <a href="https://doc.rust-lang.org/std/primitive.str.html">str :: escape_debug</a> </li><li>  <a href="https://doc.rust-lang.org/std/primitive.str.html">str :: escape_default</a> </li><li>  <a href="https://doc.rust-lang.org/std/primitive.str.html">str :: escape_unicode</a> </li><li>  <a href="https://doc.rust-lang.org/std/primitive.str.html">str :: split_ascii_whitespace</a> </li><li>  <a href="https://doc.rust-lang.org/std/time/struct.Instant.html">Instant :: checked_add</a> </li><li>  <a href="https://doc.rust-lang.org/std/time/struct.Instant.html">Instant :: checked_sub</a> </li><li>  <a href="https://doc.rust-lang.org/std/time/struct.SystemTime.html">SystemTime :: checked_add</a> </li><li>  <a href="https://doc.rust-lang.org/std/time/struct.SystemTime.html">SystemTime :: checked_sub</a> </li></ul><br><p>  See the <a href="">detailed release notes for details</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/448366/">https://habr.com/ru/post/448366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448354/index.html">GraphQL Voyager as a tool for finding vulnerabilities</a></li>
<li><a href="../448358/index.html">We listen to music and lectures from Youtube with a locked smartphone screen and without advertising using Telegram</a></li>
<li><a href="../448360/index.html">A small backdoor on Flask or how to control a computer on a local network</a></li>
<li><a href="../448362/index.html">I thought I needed to send the designers to ...</a></li>
<li><a href="../448364/index.html">Stormglass - Crystals Predictors</a></li>
<li><a href="../448372/index.html">Stop rejecting excellent applicants with your wrong questions.</a></li>
<li><a href="../448374/index.html">New evidences of volcanic activity have been obtained that caused the most massive extinction in history.</a></li>
<li><a href="../448376/index.html">Mathematics telling cells how they should be</a></li>
<li><a href="../448378/index.html">DHCP security in Windows 10: disassemble critical vulnerability CVE-2019-0726</a></li>
<li><a href="../448382/index.html">How we evaluated the quality of the documentation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>