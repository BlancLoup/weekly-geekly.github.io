<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My way to backup Oracle database on Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. I work as a database administrator is not the first year, but always worked in large companies. During this time I worked with Linux,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My way to backup Oracle database on Windows</h1><div class="post__text post__text-html js-mediator-article">  Good day to all. I work as a database administrator is not the first year, but always worked in large companies.  During this time I worked with Linux, Solaris, HP-UX.  But about a year ago I got into a small company, and oh, horror, all the servers on Windows, as such, backup was not done, or rather only export. <a name="habracut"></a>  It was necessary to make a normal physical backup, decided to write a script, as the requirements for myself highlighted a few points: <ol><li>  The script should work should work with any OS starting with win 2003 server, without requiring additional software. </li><li>  The script should work on any Oracle starting with version 9i, while doing a full, incremental backup, and backup archivals. </li><li>  The script should be as simple as possible, transferred from server to server, preferably it should be one file. </li></ol>  The first thought was to put cygwin or perl, to make Windows similar to unix, but then there will be difficulties with transferring to other servers.  I decided to write a simple batch file ms-dos, although nothing more complicated than copy con my_text.txt in batch files I did not write.  The implementation of paragraph 3, in general, turned out to be a nightmare, I have no embedded documents, I can not write: <pre><code class="bash hljs">sqlplus <span class="hljs-string"><span class="hljs-string">"/ as sysdba"</span></span> &lt;&lt; SQL select sysdate from dual; SQL</code> </pre>  I decided to write all additional scripts to temporary files, and output the program to variables.  Unexpectedly, another problem got out if the variable is not set to echo% AAA% displays% AAA%, we had to assign a space to the variable. For 10g and higher, the archivogues are going to backup, because there is compression.  For 9i, the archivogs are copied as is, since there is no catalog command, when recovering from multiple backups, you will have to restore the control files.  With a full backup, the entire contents of the DEST directory are transferred to the OLD.  And that's what I finally got: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> version <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>  "rman_Backup_DB.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> [t|a|d|<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>]" <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>    (<span class="hljs-number"><span class="hljs-number">0</span></span> - ) <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> a     <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> t   ,   sqlplus,rman,   DEST <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> d   ,    ,      <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> -------------------  --------------------------------- <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> DEST=\\SMB_server\share <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>     <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> OLD=<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\OLD <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ORACLE_SID=ORCL <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ORACLE_HOME=C:\APP\orabase\product\<span class="hljs-number"><span class="hljs-number">11</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\dbhome_1 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> NLS_LANG=AMERICAN_AMERICA.CL8MSWIN1251 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> NLS_DATE_FORMAT=YYYY.MM.DD HH24.MI.SS <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> COMPRESS=  <span class="hljs-number"><span class="hljs-number">9</span></span>i   ( ) <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>  <span class="hljs-number"><span class="hljs-number">10</span></span>   =as compressed backupset <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> COMPRESS=as compressed backupset <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   Rman   <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> CONSTRING=target / <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   sqlplus <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> CONSQL="/ as sysdba" <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>  Rman <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> RMAN=<span class="hljs-variable"><span class="hljs-variable">%ORACLE_HOME%</span></span>\bin\rman <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>  SQLPLUS <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> SQLPL=<span class="hljs-variable"><span class="hljs-variable">%ORACLE_HOME%</span></span>\bin\sqlplus <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> TFILE=<span class="hljs-variable"><span class="hljs-variable">%TEMP%</span></span>\backup_<span class="hljs-variable"><span class="hljs-variable">%ORACLE_SID%</span></span>.tmp <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> --------------------------------------------- <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ERR=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> EXEC=%<span class="hljs-number"><span class="hljs-number">0</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> "<span class="hljs-variable"><span class="hljs-variable">%EXEC%</span></span>"=="%<span class="hljs-number"><span class="hljs-number">0</span></span> " <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> prov <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span>==t <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> prov <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span>==a <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> backarc <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span>==d <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> delarc <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> alter system archive log current; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> select upper ('posled '),(max (SEQUENCE#)-<span class="hljs-number"><span class="hljs-number">5</span></span>) from v$archived_log where DELETED='NO'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /F "tokens=<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span> usebackq " <span class="hljs-variable"><span class="hljs-variable">%%1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`<span class="hljs-variable"><span class="hljs-variable">%SQLPL%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSQL%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span>`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-variable"><span class="hljs-variable">%%1</span></span>==POSLED <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> SEQN=<span class="hljs-variable"><span class="hljs-variable">%%2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">move</span></span> /Y <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\*.BK? <span class="hljs-variable"><span class="hljs-variable">%OLD%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> backdb ) <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> %<span class="hljs-number"><span class="hljs-number">1</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> backdb :prov <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.Testing sqlplus connection <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> select 'POSLED ','Test_SQLPLUS_OK' from dual; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /F "tokens=<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span> usebackq " <span class="hljs-variable"><span class="hljs-variable">%%1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`<span class="hljs-variable"><span class="hljs-variable">%SQLPL%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSQL%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span>`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-variable"><span class="hljs-variable">%%1</span></span>==POSLED <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> SEQN=<span class="hljs-variable"><span class="hljs-variable">%%2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Test Complete <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>.Testing write to destination <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>. Test write on destination <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> OK &gt; <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\test_file.txt <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ERRORLEVEL</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Write Error <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> eof ) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Test Complete <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>.Testing rman conection <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\test_backup.bak' spfile; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-variable"><span class="hljs-variable">%RMAN%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSTRING%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Test Complete <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Results: <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>. <span class="hljs-variable"><span class="hljs-variable">%SEQN%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\test_file.txt <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> /q /f <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\test_file.txt <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXIST</span></span> <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\test_backup.bak ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>. Testing rman OK <span class="hljs-built_in"><span class="hljs-built_in">del</span></span> /q /f <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\test_backup.bak ) <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>. Test RMAN failed ) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> eof :delarc <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> crosscheck archivelog all; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> delete FORCE NOPROMPT archivelog all; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-variable"><span class="hljs-variable">%RMAN%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSTRING%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *********************************************************** <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *** <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> forget to <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> FULL BACKUP OF THE DATABASE <span class="hljs-variable"><span class="hljs-variable">!!!</span></span> *** <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *********************************************************** <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> eof :backdb <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> run { &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sql 'alter system archive log current'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sql 'alter system checkpoint'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> allocate channel d1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> disk; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> limit channel d1 kbytes <span class="hljs-number"><span class="hljs-number">4000000</span></span>; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-variable"><span class="hljs-variable">%COMPRESS%</span></span> incremental level %<span class="hljs-number"><span class="hljs-number">1</span></span> skip inaccessible filesperset <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\<span class="hljs-variable"><span class="hljs-variable">%%d</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%T</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%U</span></span>.bkd' database include current controlfile; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sql 'alter system checkpoint'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sql 'alter system archive log current'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-variable"><span class="hljs-variable">%COMPRESS%</span></span> filesperset <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\<span class="hljs-variable"><span class="hljs-variable">%%d</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%T</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%U</span></span>.bka' archivelog from sequence <span class="hljs-variable"><span class="hljs-variable">%SEQN%</span></span> ; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\<span class="hljs-variable"><span class="hljs-variable">%%d</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%T</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%U</span></span>.bkc' current controlfile; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\<span class="hljs-variable"><span class="hljs-variable">%%d</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%T</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%U</span></span>.bks' spfile; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> } &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-variable"><span class="hljs-variable">%RMAN%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSTRING%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /a ERR=<span class="hljs-variable"><span class="hljs-variable">%ERR%</span></span>+<span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span> :backarc <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%COMPRESS%</span></span>|<span class="hljs-built_in"><span class="hljs-built_in">findstr</span></span> compressed <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ERRORLEVEL</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> alter system archive log current; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> feedback off pagesize <span class="hljs-number"><span class="hljs-number">0</span></span> heading off <span class="hljs-built_in"><span class="hljs-built_in">verify</span></span> off linesize <span class="hljs-number"><span class="hljs-number">200</span></span> trimspool off &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> spool <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span>.bat &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> select '<span class="hljs-built_in"><span class="hljs-built_in">move</span></span> /Y '^|^|name^|^|' <span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>' from v$archived_log where DEST_ID=<span class="hljs-number"><span class="hljs-number">1</span></span> and STATUS='A'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> spool off &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-variable"><span class="hljs-variable">%SQLPL%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSQL%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span>.bat <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /a ERR=<span class="hljs-variable"><span class="hljs-variable">%ERR%</span></span>+<span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> crosscheck backup; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> crosscheck archivelog all; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> DELETE FORCE NOPROMPT EXPIRED backup; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-variable"><span class="hljs-variable">%RMAN%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSTRING%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> crosscheck backup; &gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> crosscheck archivelog all; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> DELETE FORCE NOPROMPT EXPIRED backup; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sql 'alter system checkpoint'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> sql 'alter system archive log current'; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-variable"><span class="hljs-variable">%COMPRESS%</span></span> filesperset <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\<span class="hljs-variable"><span class="hljs-variable">%%d</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%T</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%U</span></span>_all.bka' archivelog all delete input; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> backup <span class="hljs-built_in"><span class="hljs-built_in">format</span></span> '<span class="hljs-variable"><span class="hljs-variable">%DEST%</span></span>\<span class="hljs-variable"><span class="hljs-variable">%%d</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%T</span></span>_<span class="hljs-variable"><span class="hljs-variable">%%U</span></span>.bkc' current controlfile; &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> <span class="hljs-variable"><span class="hljs-variable">%RMAN%</span></span> <span class="hljs-variable"><span class="hljs-variable">%CONSTRING%</span></span> @<span class="hljs-variable"><span class="hljs-variable">%TFILE%</span></span> ) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> /a ERR=<span class="hljs-variable"><span class="hljs-variable">%ERR%</span></span>+<span class="hljs-variable"><span class="hljs-variable">%ERRORLEVEL%</span></span> :eof <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> /b <span class="hljs-variable"><span class="hljs-variable">%ERR%</span></span></code> </pre>  Thanks for attention.  <a href="https://docs.google.com/open%3Fid%3D0B3gCpiR744QeYXA4REhsOWFTeG8">Link to the script</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/142390/">https://habr.com/ru/post/142390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142385/index.html">10 best tools for developing and administering MySQL</a></li>
<li><a href="../142386/index.html">Vulnerability in MS SQL Server 2000</a></li>
<li><a href="../142387/index.html">How to find a letter from the past</a></li>
<li><a href="../142388/index.html">What platform does your phone work on?</a></li>
<li><a href="../142389/index.html">Proxy for Android</a></li>
<li><a href="../142392/index.html">1C-Hosting by ColoBridge</a></li>
<li><a href="../142393/index.html">MyAsterisk is the telephony you have been waiting for!</a></li>
<li><a href="../142395/index.html">The main it-event of Ukraine is IForum (+ photos and reviews)</a></li>
<li><a href="../142396/index.html">RIF + CIB-2012: where is the Russian Internet heading</a></li>
<li><a href="../142397/index.html">Manage domain delegation or why goat bayan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>