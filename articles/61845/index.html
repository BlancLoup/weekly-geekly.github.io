<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determine the order of the columns in the composite index</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share a simple empirical method that I use to determine in which order the columns in the composite index should go. This method is suitable...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determine the order of the columns in the composite index</h1><div class="post__text post__text-html js-mediator-article">  I want to share a simple empirical method that I use to determine in which order the columns in the composite index should go.  This method is suitable not only for MySQL, it is also applicable to any DBMS in which b-tree indices are used. <br><br>  Let's start with a query that returns an empty result, but it does a full table scan.  EXPLAIN will show on it that there are no indexes available (i.e. possible_keys = NULL) <br><br><blockquote><code><font color="black"><font color="#0000ff">SELECT</font> * <font color="#0000ff">FROM</font> tbl <br> <font color="#0000ff">WHERE</font> <br> status= <font color="#A31515">'waiting'</font> <font color="#0000ff">AND</font> <br> source= <font color="#A31515">'twitter'</font> <font color="#0000ff">AND</font> <br> no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> <font color="#0000ff">AND</font> <br> tries &lt;= 20 <br> <font color="#0000ff">ORDER</font> <font color="#0000ff">BY</font> <font color="#0000ff">date</font> <font color="#0000ff">ASC</font> <font color="#0000ff">LIMIT</font> 1; <br></font></code> </blockquote><a name="habracut"></a><br>  Do not try to understand the meaning of this request, it is given only as an example.  In the simplest case, we want to place the most selective column in the index first, so that the possible number of matching rows is minimal, so we will find the necessary rows as quickly as possible.  Assuming that all columns have some distribution of values, we can simply count the number of matches for each condition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><font color="black"><font color="#0000ff">SELECT</font> <br> <font color="#0000ff">sum</font> (status= <font color="#A31515">'waiting'</font> ), <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ), <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ), <br> <font color="#0000ff">sum</font> (tries &lt;= 20), <br> <font color="#0000ff">count</font> (*) <br> <font color="#0000ff">FROM</font> tbl\G <br> <br> *************************** 1. <font color="#0000ff">row</font> *************************** <br> <font color="#0000ff">sum</font> (status = <font color="#A31515">'waiting'</font> ): 550 <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ): 37271 <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ): 36975 <br> <font color="#0000ff">sum</font> (tries &lt;= 20): 36569 <br> <font color="#0000ff">count</font> (*): 37271 <br></font></code> </blockquote><br><br>  It's simple - I wrapped each condition with the SUM () function, which for MySQL is equivalent to COUNT (number_time_when_tru).  As you can see, the most selective condition is ‚Äústatus = waiting‚Äù.  Let's put this column in the index first, then move the condition from the SELECT to WHERE and run the query again to count the matches in the remaining set. <br><br><blockquote> <code><font color="black"><font color="#0000ff">SELECT</font> <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ), <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ), <br> <font color="#0000ff">sum</font> (tries &lt;= 20), <br> <font color="#0000ff">count</font> (*) <br> <font color="#0000ff">FROM</font> tbl <br> <font color="#0000ff">WHERE</font> <br> status= <font color="#A31515">'waiting'</font> \G <br> *************************** 1. <font color="#0000ff">row</font> *************************** <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ): 549 <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ): 255 <br> <font color="#0000ff">sum</font> (tries &lt;= 20): 294 <br> <font color="#0000ff">count</font> (*): 549 <br></font></code> </blockquote><br><br>  Now we have dropped to an acceptable number of rows.  It can be seen that ‚Äúsource‚Äù does not have selectivity at all, i.e.  using it, nothing will be filtered out, and adding it to the index will not do any good.  You can filter the remaining set either using 'no_send_before' or 'tries'.  Running a query with any of them in where will reduce the number of matches for the other condition to zero. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">SELECT</font> <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ), <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ), <br> <font color="#0000ff">sum</font> (tries &lt;= 20), <br> <font color="#0000ff">count</font> (*) <br> <font color="#0000ff">FROM</font> tbl <br> <font color="#0000ff">WHERE</font> <br> status= <font color="#A31515">'waiting'</font> <font color="#0000ff">AND</font> <br> no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> \G <br> *************************** 1. <font color="#0000ff">row</font> *************************** <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ): 255 <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ): 255 <br> <font color="#0000ff">sum</font> (tries &lt;= 20): 0 <br> <font color="#0000ff">count</font> (*): 255 <br> <br> *************************************************************** <br> <br> <font color="#0000ff">SELECT</font> <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ), <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ), <br> <font color="#0000ff">sum</font> (tries &lt;= 20), <br> <font color="#0000ff">count</font> (*) <br> <font color="#0000ff">FROM</font> tbl <br> <font color="#0000ff">WHERE</font> <br> status= <font color="#A31515">'waiting'</font> <font color="#0000ff">AND</font> <br> tries &lt;= 20\G <br> *************************** 1. <font color="#0000ff">row</font> *************************** <br> <font color="#0000ff">sum</font> (source= <font color="#A31515">'twitter'</font> ): 294 <br> <font color="#0000ff">sum</font> (no_send_before &lt;= <font color="#A31515">'2009-05-28 03:17:50'</font> ): 0 <br> <font color="#0000ff">sum</font> (tries &lt;= 20): 294 <br> <font color="#0000ff">count</font> (*): 294 <br></font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  This means that we can do an index with any of them - (status, tries) or (status, no_send_before) and we will find our zero lines very effectively.  Which one is better depends on what this table is really used for <i>(as well as on the availability and structure of other queries to this table - note of the translation)</i> . </div><p>Source: <a href="https://habr.com/ru/post/61845/">https://habr.com/ru/post/61845/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../61836/index.html">Is the end of Beltelecom's monopoly close?</a></li>
<li><a href="../61837/index.html">UserJS. Part 2: Tricks</a></li>
<li><a href="../61839/index.html">FMSPy, Alpha release (0.1)</a></li>
<li><a href="../61840/index.html">UserJS. Part 3: Security</a></li>
<li><a href="../61842/index.html">Preventive protection of your and not your scripts</a></li>
<li><a href="../61847/index.html">New beta: Flash Builder 4, Flash Catalyst, Flex SDK 4</a></li>
<li><a href="../61848/index.html">Accelerate Windows 7. Part last</a></li>
<li><a href="../61849/index.html">Hypertext generator</a></li>
<li><a href="../61851/index.html">Improving the display of comments</a></li>
<li><a href="../61853/index.html">Julian Smith - Got my Mac on iPhone3GS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>