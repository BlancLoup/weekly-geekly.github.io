<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Client side CORS emulation: cross-browser solution of some user tasks without extensions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I. What is the problem 

 Browser extensions are a powerful tool for advanced web surfing , the most accessible, developed and widespread part of a nu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Client side CORS emulation: cross-browser solution of some user tasks without extensions</h1><div class="post__text post__text-html js-mediator-article"><h3>  I. What is the problem </h3><br><br>  Browser extensions are a powerful tool for <a href="https://en.wikipedia.org/wiki/Augmented_browsing">advanced web surfing</a> , the most accessible, developed and widespread part of <a href="https://en.wikipedia.org/wiki/List_of_augmented_browsing_software">a number of tools</a> .  However, the extensions have weaknesses: each browser requires knowledge and application of its own rules and formats, and this is an additional difficulty for the creator.  Extensions are not cross-browser, which immediately limits their destination.  There are attempts to <a href="http://kangoextensions.com/">generalize the creation of extensions</a> , but they can add their own additional layer of formats and rules. <br><br>  When the extension improves the specific side of the browser interface, you can not do without it.  But some tasks are universal, not related to private browser tools and, nevertheless, they cannot be completed without expansion too.  One such task is cross-domain <code>XMLHttpRequest</code> requests that violate <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25BB%25D0%25BE_%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B8%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B4%25D0%25BE%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B0">a single source policy</a> . <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Ii.  Private Attempts </h3><br><br>  There is a type of extensions that helps in this case and even more so - it is designed to eliminate the need for many other extensions.  These are the famous <a href="https://ru.wikipedia.org/wiki/Greasemonkey"><b>Greasemonkey</b></a> and <a href="https://tampermonkey.net/"><b>Tampermonkey</b></a> : they allow you to do with simple JavaScript code to solve many problems and at the same time create a number of auxiliary ways to quickly install such scripts from common sources regardless of user training.  However, they do not completely solve the problem of cross-browser compatibility and ease of creation and use.  In addition, the description of the capabilities of one of their most powerful tools, <code>GM_xmlhttpRequest</code> , suggests that not all new standards are implemented in it (it‚Äôs hard to know whether you can get any type of response other than <code>responseText</code> , in particular, whether the document is available as DOM- tree). <br><br>  Ideally, I would like pure javascript that would work in all browsers.  How this is done in bookmarklets or local HTML pages with scripts.  But both bookmarklets that work in the context of the current page and local files cannot make cross-domain <code>XMLHttpRequest</code> queries. <br><br>  This is <a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing"><b>where CORS</b></a> technology comes to our rescue.  Not by itself: its very principle does not allow the user to influence its mechanisms, completely giving the exchange of data to the power of the server and browser.  But there are mechanisms to interfere in the communication of these two elements and adjust it to the needs of the user. <br><br>  Some of them are implemented again in the form of browser extensions (hm). <br><br>  Firefox has a great tool for editing HTTP headers on the fly: <a href="https://github.com/warren-bank/moz-rewrite"><b>moz-rewrite</b></a> .  Its most functional subtype is <a href="https://addons.mozilla.org/en-US/firefox/addon/moz-rewrite-js/"><b>Rewrite HTTP Headers (JS)</b></a> .  The extension provides good control over the editing of headers depending on different conditions; it allows you to write rules on JavaScript itself using variables and access to the headers already received. <br><br>  Google Chrome has a number of less functional extensions like <a href="https://chrome.google.com/webstore/detail/requestly/mdnleldcmiljblolnjhpnblkcekpdkpa"><b>Requestly</b></a> : their capabilities are much more modest and poorly suited to our needs. <br><br>  IE doesn't seem to have got anything appropriate here. <br><br><h3>  Iii.  Universal solution. </h3><br><br>  In general, we again approached the same problem: cross-browser compatibility and simplicity suffers.  A tool is needed that would be independent of particular browsers, and here a local proxy server comes to mind.  Fortunately, there is a very simple and lightweight solution: it is quickly installed, requires almost no configuration, it has already been implemented for all major operating systems.  This is <a href="http://www.telerik.com/fiddler"><b>Fiddler</b></a> . <br><br>  Most often it is used to study HTTP traffic on the user side.  But the program can also edit HTTP headers on the fly, and even change the response bodies, which, in principle, allows it to replace extensions for user scripts and styles, such as <b>Greasemonkey</b> or <b>Stylish</b> (users of IE can try the power of such tools for the first time) - however, we will not write about this side of the application for the time being and will only focus on intercepting and editing headers. <br><br>  Download the program <a href="http://www.telerik.com/download/fiddler">here</a> .  I advise you to immediately add an extension (hmm ...) to it for more convenient editing of rules for intercepting and changing traffic.  It has at least two names and two habitats on the site: <br><br>  <a href="http://www.telerik.com/download/fiddler/fiddlerscript-editor">FiddlerScript Editor</a> <br><br>  <a href="http://www.telerik.com/fiddler/add-ons">Syntax-Highlighting Add-Ons</a> <br><br>  Among other things, it will add a good reference book of all the built-in properties and methods of Fiddler directly to the program, because even quite voluminous <a href="http://docs.telerik.com/fiddler">documentation</a> does not mention all the wealth. <br><br>  There is no need to be intimidated: Fiddler uses quite standard <a href="https://msdn.microsoft.com/en-us/library/z688wt03.aspx">JScript.NET</a> , in fact, the same JavaScript, and familiarity with additional objects, properties and methods of the application is equal to learning one small interface, like the same <code>XMLHttpRequest</code> or properties of DOM elements.  <a href="http://www.telerik.com/blogs/understanding-fiddlerscript">There is a brief introduction from the author</a> . <br><br><h3>  Iv.  Fast start </h3><br><br>  Those who want to get complete control over the tool can spend several hours reading the documentation and studying the built-in reference book (or even read a <a href="http://fiddlerbook.com/book/">book written by the author of the program</a> ), but I will try to sketch out an answer option for this case: you wrote a bookmarklet or application as a local one (or even a hosted on the network) HTML pages and should explain to the average user how to make it all work in his browser (there is a chance that some Firefox or Chrome users, spoiled by extensions, don‚Äôt understand you  t, but IE users gain here is almost the only way out into the wild). <br><br>  1. Download and install Fiddler and its extension (good, both files weigh only 1.7 MB, they can even be sent as an email attachment). <br><br>  2. By default, the program has almost everything configured for our needs.  The only additional setting will be needed if your application uses <b>HTTPS</b> requests.  Just check this tab: <br><br><img src="https://habrastorage.org/files/bad/9b7/18b/bad9b718bd9a4942977d6f419281f24c.png"><br><br>  3. IE and Google Chrome do not need to be further configured: they use the system proxy by default, if one appears, and Fiddler registers itself with such a proxy at launch time, very easy and convenient.  The default Firefox settings are slightly different, but this is also nothing complicated.  Everything is briefly described here: <br><br>  <a href="http://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/ConfigureBrowsers">docs.telerik.com/fiddler/Configure-Fiddler/Tasks/ConfigureBrowsers</a> <br>  <a href="http://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/FirefoxHTTPS">docs.telerik.com/fiddler/Configure-Fiddler/Tasks/FirefoxHTTPS</a> <br><br>  4. After these three steps, each time you start Fiddler, the traffic will automatically go through it, and after closing the program, it will return to the normal path again.  If you do not want Fiddler to be a regular broker, and plan to launch it only while running a bookmarklet or a local application, then it‚Äôs more convenient to add an option to the program launch shortcut: <br><br><img src="https://habrastorage.org/files/1a6/176/eb9/1a6176eb9c6e4c60bbaa5788bdbeb592.png"><br><br>  and in the Fiddler settings, select minimize to icon.  Then the program will simply appear for a while in the tray (you can close it from the menu of the local icon).  At first it seems too complicated: run the whole application for the work of a bookmarklet or page, but you quickly get used to it.  You can take Fiddler as a cross-browser extension or as a platform for cross-browser extensions, if it is psychologically more convenient.  And if you keep it working all the time and set up an automatic start when you log into the system, you can forget about it at all: it works completely transparent, consumes little memory (especially if you configure it to save and display the minimum number of sessions, which doesn‚Äôt harm us at all - quietly choose ‚ÄúKeep 100 sessions‚Äù, after that there will always be only 100 lines of the last requests on the screen, and the memory will not be substantially filled);  the processor is also not loaded, and there are no functional problems or any noticeable delays in the work of the sites. <br><br>  5. One last step is left - not quite trivial for the average user, but if you carefully follow it, there is nothing to worry about either.  We need to add a small code that will be executed by Fiddler for each suitable HTTP connection and change / add the headers we need.  The code is universal for most cross-domain query needs. <br><br>  Launch Fiddler and select this menu item in the menu (or simply press Ctrl + R): <br><br><img src="https://habrastorage.org/files/296/8da/ba5/2968daba58d44cfba10d7e429e9bc8e0.png"><br><br>  If you installed the mentioned extension, a small built-in editor opens in response (just to the right there will be a column with a full reference book of everything that Fiddler adds to regular JavaScript; when you select a list item, a brief description of the object, property or method appears at the top of the column): <br><br><img src="https://habrastorage.org/files/8bd/bb6/689/8bdbb6689dd14a659fb5e396c3fcfae8.png"><br><br>  In the editor, a special script similar to user Greasemonkey scripts will be loaded: it only runs not every time a suitable page is loaded in the browser, but at every suitable event in the HTTP traffic passing through Fiddler.  The script already has a preliminary code from the developers themselves, but we do not need to understand it.  We just need to insert our small fragment into an already present function.  To facilitate our task, the editor has a special menu item that immediately translates to this function: <br><br><img src="https://habrastorage.org/files/8b6/b23/778/8b6b23778c8e44fc9b10abb473577ccf.png"><br><br>  We need to insert the following code there (it will be explained later): <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oRequest.headers.ExistsAndContains(<span class="hljs-string"><span class="hljs-string">'Accept-Language'</span></span>, <span class="hljs-string"><span class="hljs-string">',qya;q=0.001'</span></span>) &amp;&amp; oSession.oRequest.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Origin'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>] = oSession.oRequest.headers[<span class="hljs-string"><span class="hljs-string">'Origin'</span></span>]; oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>] = <span class="hljs-string"><span class="hljs-string">'true'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oRequest.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Method'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>] = oSession.oRequest.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Method'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oRequest.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Headers'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>] = oSession.oRequest.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Headers'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oResponse.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Vary'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Vary'</span></span>] += <span class="hljs-string"><span class="hljs-string">', Origin'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Vary'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Origin'</span></span>; } }</code> </pre><br><br>  After insertion, the function code should look like this (before the insertion there was already one small block, you need to insert it after it): <br><br><img src="https://habrastorage.org/files/bfc/f0e/b25/bfcf0eb25e7642eb801b889dec07699a.png"><br><br>  After saving the file, Fiddler will automatically reload and analyze the script and, if everything is in order, will make an approving sound and will report on the acceptance of the new version in the status bar.  If the insertion breaks something, an error message will be displayed.  If something went wrong and you can not return the file to its original position, simply delete it, and the next time the program starts, it will restore it to its original form (the address of the file in Win 7 is <code>c:\Users\[ ]\Documents\Fiddler2\Scripts\CustomRules.js</code> , see disaster recovery <a href="http://docs.telerik.com/fiddler/Extend-Fiddler/AddRules">in the help</a> or comments in the very beginning of the file).  In the end, if you need to transfer your application to a person who will be afraid to edit the rule file himself, give him the finished one, already with an insert, and let him replace it at the right address. <br><br>  That's all.  After these steps, the ‚ÄúFiddler + bookmarklet / local page‚Äù bundle can be considered as a cross-browser extension or application (at the end of the article I will present some primitive examples). <br><br><h3>  V. Some features of the mechanism </h3><br><br>  1. First of all, I set out to somehow <i>highlight requests</i> from my applications in the general flow so that Fiddler would not have to change all the headers and perform extra checks within inappropriate sessions.  I had to consistently test and discard several options. <br><br>  but.  Adding to the addresses of requests for a special <a href="https://en.wikipedia.org/wiki/Fragment_identifier"><u>hash</u></a> ( <code>#fiddler--</code> ).  It will not work, since the hash is not sent via HTTP, it only makes sense for the browser (therefore, this method would be useful if we had to deal with the advanced extension of HTTP editing for the browser: it could intercept the hashes and change the headers based on this condition ( the mentioned <i>Rewrite HTTP Headers (JS)</i> can); if such an extension is ever developed with an implementation for all major browsers including Edge, you can think about this option). <br><br>  b.  Explicit addition of the default <u>port</u> will be cut off by the browser.  To add a non-standard port so that Fiddler intercepted it and changed it to a regular one, I considered it a risky business. <br><br>  at.  Adding to the domain of the <u>authorization part of the</u> URL of the form <code>user:password@</code> with arbitrary strings in the hope that the server will ignore them.  It turned out that browsers for some reason do not send this part via HTTP, it does not reach Fiddler.  In addition, this part, as well as the port number, would still disappear during redirects, which for <code>XMLHttpRequest</code> are transparent, without interception, and the exchange of headers with the new address would have already passed without Fiddler's participation. <br><br>  Adding a marker to the <u>query / search part</u> ( <code>&amp;fiddler=1</code> ).  It was found that some servers, finding an unfamiliar option in this part, are redirecting to a URL without this option.  For such cases, it would be possible to add a marker, say, <code>&amp;&amp;&amp;</code> , which for the server would not be visible (when parsing would turn into three empty options and would not cause server concerns), but, again, if normal forwarding occurs, He will disappear from the address. <br><br>  D. <u>Cookies</u> .  Will disappear when redirecting to another domain. <br><br>  e. Adding a <u>custom custom header</u> (some <code>X-Hello-Fiddler</code> ).  It turned out that the presence of such a header causes a so-called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS"><b>Preflighted request</b></a> , which can be intercepted and edited, but if it is followed by a redirect, the browser will generally interrupt the request - Preflighted request with redirection is incompatible. <br><br>  .  Adding a <u>standard header</u> .  It turned out that there is not so simple.  The browser does not allow to add some of the headers for security reasons; it can only create them by itself.  Part of the headers, even the standard ones, still cause Preflighted request.  To prevent this from happening, you need to limit yourself to a very small number of headers that are considered ‚Äúsimple‚Äù.  See about them: <a href="http://www.w3.org/TR/cors/">www.w3.org/TR/cors/#terminology</a> ( <b>"simple header"</b> ). <br><br>  So I came to the remaining way: making safe changes to the usual headers that the browser allows you to change.  The only such title was <u><code>Accept-Language</code></u> .  It is configured by the browser according to the preferences of the preferred languages ‚Äã‚Äãin the browser options.  You can get an idea of ‚Äã‚Äãthem in JavaScript code using the navigator.languages ‚Äã‚Äãproperty, but it is not supported in IE11 (the navigator property supported by all browsers only gives the browser interface language).  For example, in my three browsers, the <code>JSON.stringify([navigator.language, navigator.languages])</code> code in the console displays the following: <br><br><pre> <code class="javascript hljs">Chrome: <span class="hljs-string"><span class="hljs-string">"[ "</span></span>en-US<span class="hljs-string"><span class="hljs-string">", [ "</span></span>en-US<span class="hljs-string"><span class="hljs-string">", "</span></span>en<span class="hljs-string"><span class="hljs-string">", "</span></span>ru<span class="hljs-string"><span class="hljs-string">", "</span></span>uk<span class="hljs-string"><span class="hljs-string">" ] ]"</span></span> Firefox: <span class="hljs-string"><span class="hljs-string">"[ "</span></span>en-US<span class="hljs-string"><span class="hljs-string">", [ "</span></span>en-US<span class="hljs-string"><span class="hljs-string">", "</span></span>en<span class="hljs-string"><span class="hljs-string">", "</span></span>ru<span class="hljs-string"><span class="hljs-string">", "</span></span>uk<span class="hljs-string"><span class="hljs-string">" ] ]"</span></span> IE11: <span class="hljs-string"><span class="hljs-string">"[ "</span></span>ru-RU<span class="hljs-string"><span class="hljs-string">", null ]"</span></span></code> </pre><br><br>  The most convenient way is to look in the web console, which header the browser itself sends, and use this code in your scripts, adding a token to it.  My browsers give the following <code>Accept-Language</code> headers: <br><br><pre> <code class="javascript hljs">Chrome: en-US,en;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,ru;q=<span class="hljs-number"><span class="hljs-number">0.6</span></span>,uk;q=<span class="hljs-number"><span class="hljs-number">0.4</span></span> Firefox: en-US,en;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,ru;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,uk;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span> IE11: en-US,en;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,ru;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,uk;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span></code> </pre><br><br>  It remains to add to them some rare language with the smallest coefficient of preference.  I chose <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B2%25D0%25B5%25D0%25BD%25D1%258C%25D1%258F">Quenya</a> , since it is <a href="http://www.iana.org/assignments/language-subtag-registry/language-subtag-registry">already included in the standard</a> under the <code>qya</code> code.  So, we need to add something like <code>qya;q=0.001</code> to the header (the minimum number allowed by the standard), which we see in the very first checked condition for Fiddler a little higher (along with checking the <code>Origin</code> header, which is a cross-domain query, - without it, there is no point in interfering with headlines, everything will work this way). <br><br>  <i>2. What do insert directives do after checking two conditions:</i> <br><br>  but.  Mirror sent by the <u><code>Origin</code></u> request - without this, the browser will not give the answer to the script (when querying for local pages, it will be <code>null</code> , but the server must return it); <br><br>  b.  add authorization support for requests ( <u><code>Access-Control-Allow-Credentials</code></u> - without this, the browser will not give access to the received information related to cookies, that is, you will not get the page that you get when you authorize on the site); <br><br>  at.  for securing, mirroring browser requests for special <u>methods and headers</u> , if you suddenly manage to add them to the script or the browser itself wants to add them (I have not yet encountered such cases); <br><br>  add the <u><code>Vary</code></u> header, without which the browser simply caches the response and will receive it from the cache, bypassing Fiddler, but it will come across another source in <code>Access-Control-Allow-Origin</code> and terminate the request - the <code>Vary</code> header will just put the caching such responses depending on the source of the request. <br><br>  <i>3. Some possible problems (mainly in IE) and attempts to solve them.</i> <br><br>  but.  IE11 is still not using the popular <a href="https://ru.wikipedia.org/wiki/P3P">P3P</a> technology.  If the server does not implement it (as it happens in most cases), IE will not send cookies to such a server if they are not basic (which is exactly the rule for cross-domain <code>XMLHttpRequest</code> requests).  Firefox has <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D436471">an old bug</a> that prevents even extensions from sending cookies if <u>third-party cookies are</u> not allowed in the browser settings.  In IE, we have something similar.  The <code>P3P</code> rules are very complicated, not controlled by the user and interfered with them with the help of Fiddler. applications).  However, there is an easy way out.  In IE settings, you need to open these windows and check such options: <br><br><img src="https://habrastorage.org/files/5c2/1e7/e48/5c21e7e4838b43b0b4f275d041a4e234.png"><br><br>  After that, you will get authorization support in <code>XMLHttpRequest</code> requests for IE.  By the way, I stumbled upon a strange glitch: after a single use of this option and the subsequent cancellation of it, IE still continued to send third-party cookies.  Perhaps it was a unique set of circumstances. <br><br>  You can also try to add each necessary site to the exceptions in the same dialogue or in the privacy policy dialogue, but this is a long and not universal way, albeit a little soothing, useful or excessive paranoia. <br><br>  In Chrome and Firefox, third-party cookies are enabled by default (in Firefox there is a useful option to accept only cookies of visited sites, which is enough in most cases), so here you can additionally not configure anything. <br><br>  b.  In IE11 there is a very strange bug, the nature of which I did not understand.              : <br><br> <code>SEC7120:  null     Access-Control-Allow-Origin.</code> <br> <br> <code>XMLHttpRequest:   0x80070005,   .</code> <br> <br>       :   ,       ,    <u><code>null</code></u> (      ).    ,       <code>null</code> ,  .   ,    . <br><br>  at.   ,   <u></u>      ,   Fiddler- (       <code>Vary</code>     <code>Origin</code> ),              .   ,    ,     (  ),            ‚Äî ,       :  Chrome  Firefox     ,   IE11     .       ,        . <br><br> .           : <a href="https://en.wikipedia.org/wiki/Content_Security_Policy"><u>Content Security Policy</u></a> .  Firefox <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D866522">   </a> ,       ,   <code>XMLHttpRequest</code> ,     <code>CSP</code> (, Twitter  GitHab).    <code>CSP</code>      .       (     CSP   ,   , ‚Äî     ): <br><br> ‚Äî     Fiddlera-     Content-Security-Policy (     ): <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-regexp"><span class="hljs-regexp">/[?&amp;]tempnocsp=1\b/i</span></span>.test(oSession.PathAndQuery)) { oSession.oResponse.headers.Remove(<span class="hljs-string"><span class="hljs-string">'Content-Security-Policy'</span></span>); oSession.oResponse.headers.Remove(<span class="hljs-string"><span class="hljs-string">'X-Content-Security-Policy'</span></span>); }</code> </pre><br><br> ‚Äî    ,      query- <code>tempnocsp=1</code>  URL (      ,      ;    ,       ,       ‚Äî         Fiddler-).           : <br><br><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-regexp"><span class="hljs-regexp">/[?&amp;]tempnocsp=1\b/i</span></span>.test(l.href)) { l.href += (<span class="hljs-regexp"><span class="hljs-regexp">/\?/</span></span>.test(l.href) ? <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span> : <span class="hljs-string"><span class="hljs-string">"?"</span></span>) + <span class="hljs-string"><span class="hljs-string">"tempnocsp=1"</span></span>; } })(location);</code> </pre><br><br>    ,   .           ,        .   -    Fiddler-     ,          Firefox  Chrome ‚Äî      .        ,         .   Fiddler,              ‚Äî  . <br><br><h3>  Vi.    </h3><br><br>       ,    ,       .      ,  ,    ,     ,      (   IE).    ‚Äî      . <br><br> <b>1.  , ,  /        .</b> <br><br>       <code>HEAD</code> ,    <code>Content-Type</code> , <code>Last-Modified</code>  <code>Content-Length</code> .        ,           .    ,       .    <a href="https://xhr.spec.whatwg.org/"><code>responseURL</code></a>    IE11           ( , , ,       Edge). <br><br>  :  <code>Content-Type</code>  <code>Last-Modified</code>     ,    <code>Content-Length</code>          . , Chrome  : <br><br> <code>VM117:1 Refused to get unsafe header "Content-Length"</code> <br> <br>         Fiddler-,     CORS:  ,        .      ,        : <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.RequestMethod == <span class="hljs-string"><span class="hljs-string">'HEAD'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oResponse.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>] += <span class="hljs-string"><span class="hljs-string">', Content-Length'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>; } }</code> </pre><br><br>  ,  ,        Fiddler-      ,  : <br><br><div class="spoiler"> <b class="spoiler_title">     OnBeforeResponse</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oRequest.headers.ExistsAndContains(<span class="hljs-string"><span class="hljs-string">'Accept-Language'</span></span>, <span class="hljs-string"><span class="hljs-string">',qya;q=0.001'</span></span>) &amp;&amp; oSession.oRequest.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Origin'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>] = oSession.oRequest.headers[<span class="hljs-string"><span class="hljs-string">'Origin'</span></span>]; oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>] = <span class="hljs-string"><span class="hljs-string">'true'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oRequest.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Method'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>] = oSession.oRequest.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Method'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oRequest.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Headers'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>] = oSession.oRequest.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Request-Headers'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oResponse.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Vary'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Vary'</span></span>] += <span class="hljs-string"><span class="hljs-string">', Origin'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Vary'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Origin'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.RequestMethod == <span class="hljs-string"><span class="hljs-string">'HEAD'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oSession.oResponse.headers.Exists(<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>)) { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>] += <span class="hljs-string"><span class="hljs-string">', Content-Length'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { oSession.oResponse.headers[<span class="hljs-string"><span class="hljs-string">'Access-Control-Expose-Headers'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-regexp"><span class="hljs-regexp">/[?&amp;]tempnocsp=1\b/i</span></span>.test(oSession.PathAndQuery)) { oSession.oResponse.headers.Remove(<span class="hljs-string"><span class="hljs-string">'Content-Security-Policy'</span></span>); oSession.oResponse.headers.Remove(<span class="hljs-string"><span class="hljs-string">'X-Content-Security-Policy'</span></span>); }</code> </pre></div></div><br><br>      , ,           , ‚Äî , ,             : <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, xhr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!url) {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;} xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {xhr.open(<span class="hljs-string"><span class="hljs-string">'HEAD'</span></span>, url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { alert(e.name + <span class="hljs-string"><span class="hljs-string">': '</span></span> + e.message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">'Accept-Language'</span></span>, <span class="hljs-string"><span class="hljs-string">'en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001'</span></span>); xhr.responseType = <span class="hljs-string"><span class="hljs-string">'document'</span></span>; xhr.timeout = <span class="hljs-number"><span class="hljs-number">10000</span></span>; xhr.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt, l</span></span></span><span class="hljs-function">) </span></span>{ l = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getResponseHeader(<span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>); alert([ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseURL || <span class="hljs-string"><span class="hljs-string">'?'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getResponseHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>) || <span class="hljs-string"><span class="hljs-string">'?'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getResponseHeader(<span class="hljs-string"><span class="hljs-string">'Last-Modified'</span></span>) || <span class="hljs-string"><span class="hljs-string">'?'</span></span>, l ? [l + <span class="hljs-string"><span class="hljs-string">' B'</span></span>, (l / <span class="hljs-number"><span class="hljs-number">1024</span></span>) .toFixed(<span class="hljs-number"><span class="hljs-number">3</span></span>) + <span class="hljs-string"><span class="hljs-string">' kB'</span></span>, (l / <span class="hljs-number"><span class="hljs-number">1048576</span></span>) .toFixed(<span class="hljs-number"><span class="hljs-number">3</span></span>) + <span class="hljs-string"><span class="hljs-string">' MB'</span></span>, (l / <span class="hljs-number"><span class="hljs-number">1073741824</span></span>).toFixed(<span class="hljs-number"><span class="hljs-number">3</span></span>) + <span class="hljs-string"><span class="hljs-string">' GB'</span></span>].join(<span class="hljs-string"><span class="hljs-string">' \u2248 '</span></span>) : <span class="hljs-string"><span class="hljs-string">'?'</span></span> ].join(<span class="hljs-string"><span class="hljs-string">'\n\n'</span></span>) + <span class="hljs-string"><span class="hljs-string">'\n\n'</span></span>); }; xhr.ontimeout = xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt</span></span></span><span class="hljs-function">) </span></span>{alert(evt.type.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>).toUpperCase() + evt.type.slice(<span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">'.'</span></span>);}; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {alert(e.name + <span class="hljs-string"><span class="hljs-string">': '</span></span> + e.message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;} })(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.activeElement.href || prompt(<span class="hljs-string"><span class="hljs-string">'URL:'</span></span>))</code> </pre></div></div><br><br>       ,      URL   ,     . ,       (   IE11 ‚Äî <a href="">habrastorage.org/files/5c2/1e7/e48/5c21e7e4838b43b0b4f275d041a4e234.png</a> )   Chrome  : <br><br><img src="https://habrastorage.org/files/24e/759/368/24e7593686c949b78a9fa2871a13e010.png"><br><br>       Firefox     Nightly : <br><br><img src="https://habrastorage.org/files/6c6/0e2/f18/6c60e2f184f747798154ca4619f6ef90.png"><br><br>   ,         ‚Äî       . Chrome    <code>xhr.onerror</code>   : <br><br> <code>XMLHttpRequest cannot load file:///... Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https, chrome-extension-resource.</code> <br> <br> Firefox      <code>xhr.send()</code> , ,    ,  .   : <br><br> <code>NS_ERROR_DOM_BAD_URI: Access to restricted URI denied</code> <br> <br> IE11    ,   <code>xhr.open()</code> .       .  IE    : <br><br> <code>Error:   .</code> <br> <br> <b>2.   ¬´ ¬ª</b> <br><br>     <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25B3%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2586%25D0%25B5%25D0%25BF%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B0"> </a>  <a href="https://en.wikipedia.org/wiki/Breadcrumb_(navigation)">¬´Breadcrumbs¬ª</a> ,     Total Commander,        . <br><br>  Firefox    <a href="https://addons.mozilla.org/en-US/firefox/addon/advanced-locationbar/">Advanced Locationbar</a> .  Chrome         <a href="https://chrome.google.com/webstore/detail/breadcrumb-navigator/hphdahmligbkhjoedbpeoigbmopehdhm">Breadcrumb Navigator</a> .  IE11, ,   (    IE   Explorer-       ). <br><br> ,       ,     .           ,   ,    .     :   (  ),  (  ),   (   ).          ,    ‚Äî    ,        <code>XMLHttpRequest</code>    .           (           ‚Äî       ). <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d, l, throbber, div, url, ar, arl, i, str, el, info_url, info_title</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d.activeElement.href) {l = d.activeElement;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {l = location;} throbber = <span class="hljs-string"><span class="hljs-string">'data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7'</span></span>; div = d.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); div.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-main'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'style'</span></span>)).textContent=[ <span class="hljs-string"><span class="hljs-string">'div[data-breadcrumbs-main] {position:fixed; top:0px; left:0; z-index:999999; width:100%; padding:10px !important; background-color:white !important; outline:1px solid black !important; font-size: 12pt !important; text-align: left !important;}'</span></span>, <span class="hljs-string"><span class="hljs-string">'div[data-breadcrumbs-main] a {font-size: 12pt !important; text-decoration: underline !important;}'</span></span>, <span class="hljs-string"><span class="hljs-string">'div[data-breadcrumbs-main] div {margin-top: 20px!important; color: silver !important;}'</span></span>, <span class="hljs-string"><span class="hljs-string">'div[data-breadcrumbs-info-title] {background-repeat: no-repeat !important; background-position: left center !important; padding-left: 20px !important;}'</span></span>, ].join(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); url = l.protocol + (<span class="hljs-regexp"><span class="hljs-regexp">/:[/][/]/</span></span>.test(l.href) ? <span class="hljs-string"><span class="hljs-string">'//'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>); div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = url; ar = l.hostname.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>); arl = ar.length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arl &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { ar.splice(arl - <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ar.slice(arl - <span class="hljs-number"><span class="hljs-number">2</span></span>).join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)); arl--; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arl; i++) { str = ar[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) {div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">'.'</span></span>;} el = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)); el.textContent = str; el.href = url + ar.slice(i).join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>); } url += l.hostname; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(l.port &amp;&amp; <span class="hljs-regexp"><span class="hljs-regexp">/:\d+$/</span></span>.test(l.host)) { div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">':'</span></span>; el = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)); el.textContent = l.port; url += <span class="hljs-string"><span class="hljs-string">':'</span></span> + l.port; el.href = url; } div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; url += <span class="hljs-string"><span class="hljs-string">'/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(l.pathname.length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>){ ar = l.pathname.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); ar.shift(); arl = ar.length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arl; i++) { str = ar[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; arl<span class="hljs-number"><span class="hljs-number">-1</span></span>) { el = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)); el.textContent = str; url += str; div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; url += <span class="hljs-string"><span class="hljs-string">'/'</span></span>; el.href = url; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str !== <span class="hljs-string"><span class="hljs-string">''</span></span>) { el = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)); el.textContent = str; url += str; el.href = url; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(l.search){ ar = l.search.split(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>); arl = ar.length; ar[<span class="hljs-number"><span class="hljs-number">0</span></span>] = ar[<span class="hljs-number"><span class="hljs-number">0</span></span>].substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">'?'</span></span>; url += <span class="hljs-string"><span class="hljs-string">'?'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arl; i++) { str = ar[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>; url += <span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>; } el = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)); el.textContent = str; url += str; el.href = url; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(l.hash){ div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent = <span class="hljs-string"><span class="hljs-string">'#'</span></span>; el = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)); el.textContent = l.hash.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); url += l.hash; el.href = url; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (div.querySelector(<span class="hljs-string"><span class="hljs-string">'a:last-of-type'</span></span>).href == location.href) { div.querySelector(<span class="hljs-string"><span class="hljs-string">'a:last-of-type'</span></span>).setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>, d.title); } info_url = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>)); info_url.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-info-url'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); info_url.textContent = <span class="hljs-string"><span class="hljs-string">'URL'</span></span>; info_title = div.appendChild(d.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>)); info_title.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-info-title'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); info_title.textContent = <span class="hljs-string"><span class="hljs-string">'Title'</span></span>; div.addEventListener(<span class="hljs-string"><span class="hljs-string">'mouseover'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt, h, t</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (h = evt.target.href) { info_url.textContent = h; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t = evt.target.getAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>)) { info_title.textContent = t; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{getTitle(evt.target);} } }); div.addEventListener(<span class="hljs-string"><span class="hljs-string">'dblclick'</span></span> <span class="hljs-comment"><span class="hljs-comment">/*mouseleave*/</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{div.parentNode.removeChild(div);}); d.body.appendChild(div); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lnk, xhr</span></span></span><span class="hljs-function">) </span></span>{ info_title.style.backgroundImage = <span class="hljs-string"><span class="hljs-string">'url('</span></span>+ throbber + <span class="hljs-string"><span class="hljs-string">')'</span></span>; xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {xhr.open(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, lnk.href, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { info_title.style.backgroundImage = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; info_title.textContent = e.name + <span class="hljs-string"><span class="hljs-string">': '</span></span> + e.message; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } xhr.setRequestHeader(<span class="hljs-string"><span class="hljs-string">'Accept-Language'</span></span>, <span class="hljs-string"><span class="hljs-string">'en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001'</span></span>); xhr.responseType = <span class="hljs-string"><span class="hljs-string">'document'</span></span>; xhr.timeout = <span class="hljs-number"><span class="hljs-number">10000</span></span>; xhr.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xhr.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ info_title.style.backgroundImage = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response.title) { info_title.textContent = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response.title; lnk.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response.title); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { info_title.textContent = <span class="hljs-string"><span class="hljs-string">'?'</span></span>; lnk.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>, <span class="hljs-string"><span class="hljs-string">'?'</span></span>); } }; xhr.ontimeout = xhr.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">evt</span></span></span><span class="hljs-function">)</span></span>{ info_title.style.backgroundImage = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; info_title.textContent = evt.type.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>).toUpperCase() + evt.type.slice(<span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">'.'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {xhr.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { info_title.style.backgroundImage = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; info_title.textContent = e.name + <span class="hljs-string"><span class="hljs-string">': '</span></span> + e.message; } } })(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>)</code> </pre></div></div><br><br>       ( , )   -        ,        <code>CORS</code> .        ,      . ,  <a href="https://developer.mozilla.org/en-US/search%3Fq%3DXMLHttpRequest">   MDN</a>         ,   : <br><br><img src="https://habrastorage.org/files/072/027/fdf/072027fdf9c548ad841415bda7ed61d4.png"><br><br>          . <br><br>          IE11 (.    ),   ,    <a href="http://lisperator.net/uglifyjs/">UglifyJS</a> : <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="javascript hljs">javascript:(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,t,n,a,A,i,r,o,l,p,d,s</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,t</span></span></span><span class="hljs-function">)</span></span>{s.style.backgroundImage=<span class="hljs-string"><span class="hljs-string">'url('</span></span>+n+<span class="hljs-string"><span class="hljs-string">')'</span></span>,t=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest;<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{t.open(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>,e.href,!<span class="hljs-number"><span class="hljs-number">0</span></span>)}<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(a){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s.style.backgroundImage=<span class="hljs-string"><span class="hljs-string">'none'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(s.textContent=a.name+<span class="hljs-string"><span class="hljs-string">': '</span></span>+a.message)}t.setRequestHeader(<span class="hljs-string"><span class="hljs-string">'Accept-Language'</span></span>,<span class="hljs-string"><span class="hljs-string">'en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001'</span></span>),t.responseType=<span class="hljs-string"><span class="hljs-string">'document'</span></span>,t.timeout=<span class="hljs-number"><span class="hljs-number">1e4</span></span>,t.withCredentials=!<span class="hljs-number"><span class="hljs-number">0</span></span>,t.onload=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{s.style.backgroundImage=<span class="hljs-string"><span class="hljs-string">'none'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response&amp;&amp;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response.title?(s.textContent=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response.title,e.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.response.title)):(s.textContent=<span class="hljs-string"><span class="hljs-string">'?'</span></span>,e.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>,<span class="hljs-string"><span class="hljs-string">'?'</span></span>))},t.ontimeout=t.onerror=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{s.style.backgroundImage=<span class="hljs-string"><span class="hljs-string">'none'</span></span>,s.textContent=e.type.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>).toUpperCase()+e.type.slice(<span class="hljs-number"><span class="hljs-number">1</span></span>)+<span class="hljs-string"><span class="hljs-string">'.'</span></span>};<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{t.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>)}<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(a){s.style.backgroundImage=<span class="hljs-string"><span class="hljs-string">'none'</span></span>,s.textContent=a.name+<span class="hljs-string"><span class="hljs-string">': '</span></span>+a.message}}<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(t=e.activeElement.href?e.activeElement:location,n=<span class="hljs-string"><span class="hljs-string">'data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7'</span></span>,a=e.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>),a.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-main'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'style'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'div[data-breadcrumbs-main] {position:fixed; top:0px; left:0; z-index:999999; width:100%; padding:10px !important; background-color:white !important; outline:1px solid black !important; font-size: 12pt !important; text-align: left !important;}\ndiv[data-breadcrumbs-main] a {font-size: 12pt !important; text-decoration: underline !important;}\ndiv[data-breadcrumbs-main] div {margin-top: 20px!important; color: silver !important;}\ndiv[data-breadcrumbs-info-title] {background-repeat: no-repeat !important; background-position: left center !important; padding-left: 20px !important;}'</span></span>,A=t.protocol+(<span class="hljs-regexp"><span class="hljs-regexp">/:[\/][\/]/</span></span>.test(t.href)?<span class="hljs-string"><span class="hljs-string">'//'</span></span>:<span class="hljs-string"><span class="hljs-string">''</span></span>),a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=A,i=t.hostname.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>),r=i.length,r&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>&amp;&amp;(i.splice(r<span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,i.slice(r<span class="hljs-number"><span class="hljs-number">-2</span></span>).join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)),r--),o=<span class="hljs-number"><span class="hljs-number">0</span></span>;r&gt;o;o++)l=i[o],o&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>&amp;&amp;(a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'.'</span></span>),p=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)),p.textContent=l,p.href=A+i.slice(o).join(<span class="hljs-string"><span class="hljs-string">'.'</span></span>);<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(A+=t.hostname,t.port&amp;&amp;<span class="hljs-regexp"><span class="hljs-regexp">/:\d+$/</span></span>.test(t.host)&amp;&amp;(a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">':'</span></span>,p=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)),p.textContent=t.port,A+=<span class="hljs-string"><span class="hljs-string">':'</span></span>+t.port,p.href=A),a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'/'</span></span>,A+=<span class="hljs-string"><span class="hljs-string">'/'</span></span>,t.pathname.length&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=t.pathname.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>),i.shift(),r=i.length,o=<span class="hljs-number"><span class="hljs-number">0</span></span>;r&gt;o;o++)l=i[o],r<span class="hljs-number"><span class="hljs-number">-1</span></span>&gt;o?(p=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)),p.textContent=l,A+=l,a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'/'</span></span>,A+=<span class="hljs-string"><span class="hljs-string">'/'</span></span>,p.href=A):<span class="hljs-string"><span class="hljs-string">''</span></span>!==l&amp;&amp;(p=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)),p.textContent=l,A+=l,p.href=A);<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(t.search)<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=t.search.split(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>),r=i.length,i[<span class="hljs-number"><span class="hljs-number">0</span></span>]=i[<span class="hljs-number"><span class="hljs-number">0</span></span>].substring(<span class="hljs-number"><span class="hljs-number">1</span></span>),a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'?'</span></span>,A+=<span class="hljs-string"><span class="hljs-string">'?'</span></span>,o=<span class="hljs-number"><span class="hljs-number">0</span></span>;r&gt;o;o++)l=i[o],o&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>&amp;&amp;(a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>,A+=<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>),p=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)),p.textContent=l,A+=l,p.href=A;t.hash&amp;&amp;(a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'span'</span></span>)).textContent=<span class="hljs-string"><span class="hljs-string">'#'</span></span>,p=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)),p.textContent=t.hash.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>),A+=t.hash,p.href=A),a.querySelector(<span class="hljs-string"><span class="hljs-string">'a:last-of-type'</span></span>).href==location.href&amp;&amp;a.querySelector(<span class="hljs-string"><span class="hljs-string">'a:last-of-type'</span></span>).setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>,e.title),d=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>)),d.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-info-url'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),d.textContent=<span class="hljs-string"><span class="hljs-string">'URL'</span></span>,s=a.appendChild(e.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>)),s.setAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-info-title'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),s.textContent=<span class="hljs-string"><span class="hljs-string">'Title'</span></span>,a.addEventListener(<span class="hljs-string"><span class="hljs-string">'mouseover'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e,t,n</span></span></span><span class="hljs-function">)</span></span>{(t=e.target.href)&amp;&amp;(d.textContent=t,(n=e.target.getAttribute(<span class="hljs-string"><span class="hljs-string">'data-breadcrumbs-doc-title'</span></span>))?s.textContent=n:h(e.target))}),a.addEventListener(<span class="hljs-string"><span class="hljs-string">'dblclick'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{a.parentNode.removeChild(a)}),e.body.appendChild(a)})(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>)</code> </pre></div></div><br><br> <b>3.     .</b> <br><br>              .       <code>sites</code> ,         .         :    CSS- ,     ;      :         (       )   ,      (      ‚Äî    ). <br><br>              ( IE11            ,         DOM-). <br><br>                 ,      ,            . <br><br>   ,                 -.      (         ,       ).      ,   ,    ,      . <br><br>     HTML-          : <br><br><img src="https://habrastorage.org/files/297/208/e69/297208e69ab6485294144efb06e0f72c.png"><br><br>   : <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'UTF-8'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>User Data Aggregation<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">a</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">: inline-block; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-repeat</span></span></span><span class="css">: no-repeat;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">pre</span></span></span><span class="css">, </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">a</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">5px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">5px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">5px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0px</span></span></span><span class="css">;} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'use strict'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> sites = { </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'habrahabr.ru'</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">checkPageURL</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://habrahabr.ru/users/vmb/'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">keyElementSelectors</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#layout &gt; div.inner &gt; div.user_header &gt; div.karma, #layout &gt; div.inner &gt; div.user_header &gt; div.rating, #layout &gt; div.inner &gt; div.content_left &gt; div.user_profile &gt; div.rating-place, #layout &gt; div.inner &gt; div.sidebar_right &gt; div.block.user_info &gt; div.info'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">re</span></span></span><span class="javascript">: [ </span><span class="hljs-regexp"><span class="javascript"><span class="hljs-regexp">/(\d+) (\d+ .+)/</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$1 ($2)'</span></span></span><span class="javascript"> ] }, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'geektimes.ru'</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">checkPageURL</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://geektimes.ru/users/vmb/'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">keyElementSelectors</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#layout &gt; div.inner &gt; div.user_header &gt; div.karma, #layout &gt; div.inner &gt; div.user_header &gt; div.rating, #layout &gt; div.inner &gt; div.content_left &gt; div.user_profile &gt; div.rating-place, #layout &gt; div.inner &gt; div.sidebar_right &gt; div.block.user_info &gt; div.info'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">re</span></span></span><span class="javascript">: [ </span><span class="hljs-regexp"><span class="javascript"><span class="hljs-regexp">/(\d+) (\d+ .+)/</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$1 ($2)'</span></span></span><span class="javascript"> ] }, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'megamozg.ru'</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">checkPageURL</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://megamozg.ru/users/vmb/'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">keyElementSelectors</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#layout &gt; div.inner &gt; div.user_header &gt; div.karma, #layout &gt; div.inner &gt; div.user_header &gt; div.rating, #layout &gt; div.inner &gt; div.content_left &gt; div.user_profile &gt; div.rating-place, #layout &gt; div.inner &gt; div.sidebar_right &gt; div.block.user_info &gt; div.info'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">re</span></span></span><span class="javascript">: [ </span><span class="hljs-regexp"><span class="javascript"><span class="hljs-regexp">/(\d+) (\d+ .+)/</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$1 ($2)'</span></span></span><span class="javascript"> ] }, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'toster.ru'</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">checkPageURL</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'https://toster.ru/user/vmb'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">keyElementSelectors</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#js-canvas &gt; div.layout__body &gt; section &gt; div.column_main &gt; main &gt; header &gt; div.page-header__stats &gt; ul &gt; li'</span></span></span><span class="javascript">, }, }; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> throbber = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'DOMContentLoaded'</span></span></span><span class="javascript">, init); </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">init</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript"> (</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">in</span></span></span><span class="javascript"> sites) { </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> div = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.body.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'div'</span></span></span><span class="javascript">)); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> querier = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a'</span></span></span><span class="javascript">); querier.textContent = site; querier.target = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'_blank'</span></span></span><span class="javascript">; querier.href = sites[site].openPageURL || sites[site].checkPageURL; div.appendChild(querier); } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(!location.hash){getAll();} } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> queriers = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.querySelectorAll(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript"> (</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">, querier; querier = queriers[i]; i++) { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.setTimeout(getDoc, i*</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1000</span></span></span><span class="javascript">, querier); } } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">querier</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ querier.style.backgroundImage = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'url('</span></span></span><span class="javascript">+ throbber + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">')'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site = querier.textContent; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> xhr = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> XMLHttpRequest(); xhr.open(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GET'</span></span></span><span class="javascript">, sites[site].checkPageURL, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); xhr.setRequestHeader(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Accept-Language'</span></span></span><span class="javascript">,</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001'</span></span></span><span class="javascript">); xhr.responseType = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'document'</span></span></span><span class="javascript">; xhr.timeout = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">10000</span></span></span><span class="javascript">; xhr.withCredentials = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; xhr.onload = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ processDoc(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.response, querier); }; xhr.ontimeout = xhr.onerror = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">evt</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ querier.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).textContent = evt.type.charAt(</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">).toUpperCase() + evt.type.slice(</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'.'</span></span></span><span class="javascript">; querier.style.backgroundImage = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'none'</span></span></span><span class="javascript">; }; xhr.send(</span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">); } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">doc, querier</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site = querier.textContent; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> keyElements = doc.querySelectorAll(sites[site].keyElementSelectors); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (keyElements.length) { querier.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).textContent = [].map.call(keyElements, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ el = el.textContent.trim().replace(</span><span class="hljs-regexp"><span class="javascript"><span class="hljs-regexp">/\s+/g</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' '</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (sites[site].re) {el = el.replace(sites[site].re[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">], sites[site].re[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">]);} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> el; }).join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n'</span></span></span><span class="javascript">); } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> { querier.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).textContent = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Parsing error.'</span></span></span><span class="javascript">; } querier.style.backgroundImage = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'none'</span></span></span><span class="javascript">; } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><br> <b>4.        </b> <br><br>             .     ,         (     )      ,      ,      . <br><br>      IMDb (          ): 250    250   .          :  ,  ,      . <br><br>           ,    :        ( ,         ). <br><br>      <code>localStorage</code> , ,        ,          <a href="https://developer.mozilla.org/ru/docs/IndexedDB"><code>indexedDB</code></a> . <br><br>              ( ,         ;    IMDb,    ,     ,      ‚Äî     ;       ). <br><br>           ,   ,   (       ),       . <br><br>   (  )  Chrome   (      ,  ‚Äî     ( ,         ‚Äî     ),       ). <br><br>  but.  : <br><br><img src="https://habrastorage.org/files/05a/6a7/99c/05a6a799cefa4355a2b32f962645cbf9.png"><br><br>  b.  : <br><br><img src="https://habrastorage.org/files/7e3/f82/d9b/7e3f82d9b92245d28d0079198a705fe5.png"><br><br>       . Chrome  Firefox  <code>localStorage</code>   ,  IE11 ‚Äî  (, ,  ,       Edge).  Fiddler      .         .      ,               ,  IE11    <code>localStorage</code> .         Fiddler-,  ¬´AutoResponder¬ª (    ,   Fiddler   ,      URL): <br><br><img src="https://habrastorage.org/files/39f/2f4/cf4/39f2f4cf4216418f8cd9632762667e15.png"><br><br>       :     <code>localhost</code> (  <code>127.0.0.1</code> ;  ,    ,       ),      IE11;      .        IE11. , ,   ,    ,    status quo: <br><br><img src="https://habrastorage.org/files/907/0ce/26c/9070ce26c2b14b7c97ba2e9e8abb431a.png"><br><br> ,  : <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'UTF-8'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>IMDb Charts History<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; * {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">5px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">5px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">2px</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">a</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">: inline-block; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-repeat</span></span></span><span class="css">: no-repeat; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-position</span></span></span><span class="css">: left center;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">pre</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> solid silver;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">pre</span></span></span><span class="hljs-selector-pseudo"><span class="css"><span class="hljs-selector-pseudo">:not(</span></span></span><span class="hljs-selector-pseudo"><span class="css"><span class="hljs-selector-pseudo">:first-of-type)</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: gainsboro;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">div</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">pre</span></span></span><span class="css"> &gt; </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">button</span></span></span><span class="css"> {</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">0px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">0px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css">;} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'use strict'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> sites = { </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDb Top 250'</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">checkPageURL</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://www.imdb.com/chart/top'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">keyElementsSelector</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#main &gt; div &gt; span &gt; div &gt; div &gt; div.lister &gt; table &gt; tbody &gt; tr &gt; td.titleColumn &gt; a'</span></span></span><span class="javascript">, }, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDb Top 250 TV'</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">checkPageURL</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://www.imdb.com/chart/toptv'</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">keyElementsSelector</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#main &gt; div &gt; span &gt; div &gt; div &gt; div.lister &gt; table &gt; tbody &gt; tr &gt; td.titleColumn &gt; a'</span></span></span><span class="javascript">, }, }; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> netData = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.parse(localStorage[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDbChartsHistory.netData'</span></span></span><span class="javascript">] || </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'{}'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> throbber = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'DOMContentLoaded'</span></span></span><span class="javascript">, init); </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">init</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript"> (</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">in</span></span></span><span class="javascript"> sites) { </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(!netData[site]) { netData[site] = {</span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">lastEntries</span></span></span><span class="javascript">: [], </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">lastEntriesTitles</span></span></span><span class="javascript">: [], </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">history</span></span></span><span class="javascript">: [], </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">saveHistory</span></span></span><span class="javascript">: </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">lastCheck</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">''</span></span></span><span class="javascript">}; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> div = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.body.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'div'</span></span></span><span class="javascript">)); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> watcher = div.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a'</span></span></span><span class="javascript">)); watcher.textContent = site; watcher.target = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'_blank'</span></span></span><span class="javascript">; watcher.href = sites[site].openPageURL || sites[site].checkPageURL; } localStorage[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDbChartsHistory.netData'</span></span></span><span class="javascript">] = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.stringify(netData); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(!location.hash){getAll();} } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> watchers = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.querySelectorAll(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript"> (</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">, watcher; watcher = watchers[i]; i++) { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.setTimeout(getDoc, i*</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2000</span></span></span><span class="javascript">, watcher); } } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">getDoc</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">watcher</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ watcher.style.backgroundImage = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'url('</span></span></span><span class="javascript">+ throbber + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">')'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site = watcher.textContent; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> xhr = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> XMLHttpRequest(); xhr.open(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GET'</span></span></span><span class="javascript">, sites[site].checkPageURL, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); xhr.setRequestHeader(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Accept-Language'</span></span></span><span class="javascript">,</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001'</span></span></span><span class="javascript">); xhr.responseType = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'document'</span></span></span><span class="javascript">; xhr.timeout = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">10000</span></span></span><span class="javascript">; xhr.withCredentials = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; xhr.onload = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ processDoc(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.response, watcher); }; xhr.ontimeout = xhr.onerror = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">evt</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ watcher.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).textContent = evt.type.charAt(</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">).toUpperCase() + evt.type.slice(</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'.'</span></span></span><span class="javascript">; watcher.style.backgroundImage = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'none'</span></span></span><span class="javascript">; }; xhr.send(</span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">); } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">processDoc</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">doc, watcher</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site = watcher.textContent; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> siteData = netData[site]; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> keyElements = doc.querySelectorAll(sites[site].keyElementsSelector); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> info, news; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (keyElements.length) { </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> now = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">Date</span></span></span><span class="javascript">.now()).toLocaleString(); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> curEntries = [].map.call(keyElements, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ el.search = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">''</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> el.href; }); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> curEntriesTitles = [].map.call(keyElements, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> el.textContent; }); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (siteData.lastEntries.length) { </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> added = curEntries.filter(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> siteData.lastEntries.indexOf(el) == </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">; }).map(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> ci = curEntries.indexOf(el); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'+ '</span></span></span><span class="javascript"> + (ci + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\t&lt;a href="'</span></span></span><span class="javascript"> + el + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"&gt;'</span></span></span><span class="javascript"> + curEntriesTitles[ci] + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'&lt;/a&gt;'</span></span></span><span class="javascript">; }); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> removed = siteData.lastEntries.filter(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> curEntries.indexOf(el) == </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">; }).map(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> li = siteData.lastEntries.indexOf(el); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'- ('</span></span></span><span class="javascript"> + (li + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">')\t&lt;a href="'</span></span></span><span class="javascript"> + el + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"&gt;'</span></span></span><span class="javascript"> + siteData.lastEntriesTitles[li] + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'&lt;/a&gt;'</span></span></span><span class="javascript">; }); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> risen = siteData.lastEntries.filter(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el, li</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> ci = curEntries.indexOf(el); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> ci &gt; </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript"> &amp;&amp; ci &lt; li; }).map(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> ci = curEntries.indexOf(el); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'‚Üë '</span></span></span><span class="javascript"> + (siteData.lastEntries.indexOf(el) + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\t‚Üí\t'</span></span></span><span class="javascript"> + (ci + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\t&lt;a href="'</span></span></span><span class="javascript"> + el + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"&gt;'</span></span></span><span class="javascript"> + curEntriesTitles[ci] + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'&lt;/a&gt;'</span></span></span><span class="javascript">; }); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> fallen = siteData.lastEntries.filter(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el, li</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> curEntries.indexOf(el) &gt; li; }).map(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> ci = curEntries.indexOf(el); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'‚Üì '</span></span></span><span class="javascript"> + (siteData.lastEntries.indexOf(el) + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\t‚Üí\t'</span></span></span><span class="javascript"> + (ci + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">) + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\t&lt;a href="'</span></span></span><span class="javascript"> + el + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"&gt;'</span></span></span><span class="javascript"> + curEntriesTitles[ci] + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'&lt;/a&gt;'</span></span></span><span class="javascript">; }); news = added.length || removed.length || risen.length || fallen.length; info = now + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' (previous check: '</span></span></span><span class="javascript"> + siteData.lastCheck + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">')&lt;hr&gt;'</span></span></span><span class="javascript"> + (news? [added.join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n'</span></span></span><span class="javascript">), removed.join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n'</span></span></span><span class="javascript">), risen.join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n'</span></span></span><span class="javascript">), fallen.join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n'</span></span></span><span class="javascript">)] .filter(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">el</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> el.length;}).join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n\n'</span></span></span><span class="javascript">) : </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'No news.'</span></span></span><span class="javascript"> ); } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> { info = now + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'&lt;hr&gt;First launch. Data saved ('</span></span></span><span class="javascript"> + curEntries.length + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' entries).'</span></span></span><span class="javascript">; } watcher.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).innerHTML = info; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> historyHeader = watcher.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> historyOptionLabel = historyHeader.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'label'</span></span></span><span class="javascript">)); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> historyOption = historyOptionLabel.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'input'</span></span></span><span class="javascript">)); historyOption.type = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'checkbox'</span></span></span><span class="javascript">; historyOption.checked = siteData.saveHistory; historyOption.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'click'</span></span></span><span class="javascript">, toggleHistory); historyOptionLabel.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createTextNode(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Save history'</span></span></span><span class="javascript">)); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> clearer = historyHeader.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'button'</span></span></span><span class="javascript">)); clearer.type = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'button'</span></span></span><span class="javascript">; clearer.textContent = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Clear history'</span></span></span><span class="javascript">; clearer.disabled = !siteData.history.length; clearer.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'click'</span></span></span><span class="javascript">, clearHistory); watcher.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).innerHTML = siteData.history.length? siteData.history.join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'\n&lt;hr&gt;\n'</span></span></span><span class="javascript">) : </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'No history.'</span></span></span><span class="javascript">; siteData.lastEntries = curEntries; siteData.lastEntriesTitles = curEntriesTitles; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (news &amp;&amp; siteData.saveHistory) {siteData.history.unshift(info);} siteData.lastCheck = now; localStorage[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDbChartsHistory.netData'</span></span></span><span class="javascript">] = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.stringify(netData); } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> { watcher.parentNode.appendChild(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre'</span></span></span><span class="javascript">)).textContent = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Parsing error.'</span></span></span><span class="javascript">; } watcher.style.backgroundImage = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'none'</span></span></span><span class="javascript">; } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">toggleHistory</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">evt</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site = evt.target.parentNode.parentNode.parentNode.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a'</span></span></span><span class="javascript">).textContent; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> siteData = netData[site]; siteData.saveHistory = evt.target.checked; localStorage[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDbChartsHistory.netData'</span></span></span><span class="javascript">] = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.stringify(netData); } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">clearHistory</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">evt</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> site = evt.target.parentNode.parentNode.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a'</span></span></span><span class="javascript">).textContent; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> siteData = netData[site]; siteData.history = []; evt.target.parentNode.parentNode.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'pre:last-of-type'</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'History cleared.'</span></span></span><span class="javascript">; localStorage[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'IMDbChartsHistory.netData'</span></span></span><span class="javascript">] = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.stringify(netData); evt.target.disabled = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; } </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">/******************************************************************************/</span></span></span><span class="javascript"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><br><h3>  VII.  application </h3><br><br> 1.   IE     ‚Äî  ,           HTML-.    ,   IE     ,  : <br><br><div class="spoiler"> <b class="spoiler_title">  -</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Bookmarklets<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-align: center; font-family: monospace; font-size: 12pt;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:(function(url, xhr) {if(!url) {return;}xhr = new XMLHttpRequest();try {xhr.open('HEAD', url, true);}catch (e) {alert(e.name + ': ' + e.message);return;}xhr.setRequestHeader('Accept-Language', 'en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001');xhr.responseType = 'document';xhr.timeout = 10000;xhr.withCredentials = true;xhr.onload = function(evt, l) {l = this.getResponseHeader('Content-Length');alert([this.responseURL || '?',this.getResponseHeader('Content-Type') || '?',this.getResponseHeader('Last-Modified') || '?',l ?[l + ' B',(l / 1024) .toFixed(3) + ' kB',(l / 1048576) .toFixed(3) + ' MB',(l / 1073741824).toFixed(3) + ' GB'].join(' \u2248 '):'?'].join('\n\n') + '\n\n');};xhr.ontimeout = xhr.onerror = function(evt) {alert(evt.type.charAt(0).toUpperCase() + evt.type.slice(1) + '.');};try {xhr.send(null);}catch (e) {alert(e.name + ': ' + e.message); return;}})(document.activeElement.href || prompt('URL:'))"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:(function(e,t,n,a,A,i,r,o,l,p,d,s){function h(e,t){s.style.backgroundImage='url('+n+')',t=new XMLHttpRequest;try{t.open('GET',e.href,!0)}catch(a){return s.style.backgroundImage='none',void(s.textContent=a.name+': '+a.message)}t.setRequestHeader('Accept-Language','en-US,en;q=0.8,ru;q=0.6,uk;q=0.4,qya;q=0.001'),t.responseType='document',t.timeout=1e4,t.withCredentials=!0,t.onload=function(){s.style.backgroundImage='none',this.response&amp;&amp;this.response.title?(s.textContent=this.response.title,e.setAttribute('data-breadcrumbs-doc-title',this.response.title)):(s.textContent='?',e.setAttribute('data-breadcrumbs-doc-title','?'))},t.ontimeout=t.onerror=function(e){s.style.backgroundImage='none',s.textContent=e.type.charAt(0).toUpperCase()+e.type.slice(1)+'.'};try{t.send(null)}catch(a){s.style.backgroundImage='none',s.textContent=a.name+': '+a.message}}for(t=e.activeElement.href?e.activeElement:location,n='data:image/gif;base64,R0lGODlhEAAQAOMIAAAAABoaGjMzM0xMTGZmZoCAgJmZmbKysv///////////////////////////////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgAIACwAAAAAEAAQAAAESBDJiQCgmFqbZwjVhhwH9n3hSJbeSa1sm5GUIHSTYSC2jeu63q0D3PlwCB1lMMgUChgmk/J8LqUIAgFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UKgmFqbpxDV9gAA9n3hSJbeSa1sm5HUMHTTcTy2jeu63q0D3PlwDx2FQMgYDBgmk/J8LqWPQuFRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YSgmFqb5xjV9gQB9n3hSJbeSa1sm5EUQXQTADy2jeu63q0D3PlwDx2lUMgcDhgmk/J8LqUPg+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+cagmFqbJyHV9ggC9n3hSJbeSa1sm5FUUXRTEDy2jeu63q0D3PlwDx3FYMgAABgmk/J8LqWPw+FRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+QihmFqbZynV9gwD9n3hSJbeSa1sm5GUYXSTIDy2jeu63q0D3PlwDx3lcMgEAhgmk/J8LqUPAOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+UqhmFqbpzHV9hAE9n3hSJbeSa1sm5HUcXTTMDy2jeu63q0D3PlwDx0FAMgIBBgmk/J8LqWPQOBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+YyhmFqb5znV9hQF9n3hSJbeSa1sm5EUAHQTQTy2jeu63q0D3PlwDx0lEMgMBhgmk/J8LqUPgeBRhV6z2q0VF94iJ9pOBAAh+QQBCgAPACwAAAAAEAAQAAAESPDJ+c6hmFqbJwDV9hgG9n3hSJbeSa1sm5FUEHRTUTy2jeu63q0D3PlwDx1FIMgQCBgmk/J8LqWPweBRhV6z2q0VF94iJ9pOBAA7',a=e.createElement('div'),a.setAttribute('data-breadcrumbs-main',''),a.appendChild(e.createElement('style')).textContent='div[data-breadcrumbs-main] {position:fixed; top:0px; left:0; z-index:999999; width:100%; padding:10px !important; background-color:white !important; outline:1px solid black !important; font-size: 12pt !important; text-align: left !important;}\ndiv[data-breadcrumbs-main] a {font-size: 12pt !important; text-decoration: underline !important;}\ndiv[data-breadcrumbs-main] div {margin-top: 20px!important; color: silver !important;}\ndiv[data-breadcrumbs-info-title] {background-repeat: no-repeat !important; background-position: left center !important; padding-left: 20px !important;}',A=t.protocol+(/:[\/][\/]/.test(t.href)?'//':''),a.appendChild(e.createElement('span')).textContent=A,i=t.hostname.split('.'),r=i.length,r&gt;1&amp;&amp;(i.splice(r-2,2,i.slice(r-2).join('.')),r--),o=0;r&gt;o;o++)l=i[o],o&gt;0&amp;&amp;(a.appendChild(e.createElement('span')).textContent='.'),p=a.appendChild(e.createElement('a')),p.textContent=l,p.href=A+i.slice(o).join('.');if(A+=t.hostname,t.port&amp;&amp;/:\d+$/.test(t.host)&amp;&amp;(a.appendChild(e.createElement('span')).textContent=':',p=a.appendChild(e.createElement('a')),p.textContent=t.port,A+=':'+t.port,p.href=A),a.appendChild(e.createElement('span')).textContent='/',A+='/',t.pathname.length&gt;1)for(i=t.pathname.split('/'),i.shift(),r=i.length,o=0;r&gt;o;o++)l=i[o],r-1&gt;o?(p=a.appendChild(e.createElement('a')),p.textContent=l,A+=l,a.appendChild(e.createElement('span')).textContent='/',A+='/',p.href=A):''!==l&amp;&amp;(p=a.appendChild(e.createElement('a')),p.textContent=l,A+=l,p.href=A);if(t.search)for(i=t.search.split('&amp;'),r=i.length,i[0]=i[0].substring(1),a.appendChild(e.createElement('span')).textContent='?',A+='?',o=0;r&gt;o;o++)l=i[o],o&gt;0&amp;&amp;(a.appendChild(e.createElement('span')).textContent='&amp;',A+='&amp;'),p=a.appendChild(e.createElement('a')),p.textContent=l,A+=l,p.href=A;t.hash&amp;&amp;(a.appendChild(e.createElement('span')).textContent='#',p=a.appendChild(e.createElement('a')),p.textContent=t.hash.substring(1),A+=t.hash,p.href=A),a.querySelector('a:last-of-type').href==location.href&amp;&amp;a.querySelector('a:last-of-type').setAttribute('data-breadcrumbs-doc-title',e.title),d=a.appendChild(e.createElement('div')),d.setAttribute('data-breadcrumbs-info-url',''),d.textContent='URL',s=a.appendChild(e.createElement('div')),s.setAttribute('data-breadcrumbs-info-title',''),s.textContent='Title',a.addEventListener('mouseover',function(e,t,n){(t=e.target.href)&amp;&amp;(d.textContent=t,(n=e.target.getAttribute('data-breadcrumbs-doc-title'))?s.textContent=n:h(e.target))}),a.addEventListener('dblclick',function(){a.parentNode.removeChild(a)}),e.body.appendChild(a)})(document)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><br> 2.    -   , ,     ,       (        IE): <br><br> <a href="http://habrahabr.ru/post/263443/">  Internet Explorer 11:  ,    ,  </a> <br><br> <a href="http://habrahabr.ru/post/262853/">:  XPath ,       DOM  </a> <br><br> <a href="http://habrahabr.ru/post/249949/"> localStorage  </a> <br><br>   ) <br><br><hr><br><br> PS   <a href="http://blogs.windows.com/msedgedev/2015/08/17/windows-10-virtual-machines-now-available-on-microsoft-edge-dev/"> </a> ,   MS Edge  11.00.10240.16397  7.22.2015 (  ),   20.10240.16384.0 (   ): <br><br>  but.       ,      <code>XMLHttpRequest.withCredentials</code>  ; <br><br>  b.  <code> null     Access-Control-Allow-Origin</code>     :   <code>Origin</code>   <code>null</code>    ,   . <br><br>  at.  <code>navigator.languages</code>    ; <br><br> .  <code>XMLHttpRequest.responseURL</code>    ; <br><br> .  <code>localStorage</code>          . </div><p>Source: <a href="https://habr.com/ru/post/265013/">https://habr.com/ru/post/265013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264997/index.html">Bayes and the challenge about Morpheus</a></li>
<li><a href="../265001/index.html">Build system for large modular projects</a></li>
<li><a href="../265007/index.html">How to easily understand logistic regression</a></li>
<li><a href="../265009/index.html">JQuery - separation of events on–°lick and onDbl–°lick</a></li>
<li><a href="../265011/index.html">Gartner agency named IBM the Magic Quadrant leader in the category of mobile application development platforms.</a></li>
<li><a href="../265015/index.html">Materials from the free on-site seminar "Kerio Control: Everything you wanted to know, but did not know who to ask"</a></li>
<li><a href="../265017/index.html">Optimization of data center operation at no extra cost</a></li>
<li><a href="../265019/index.html">Digest of the game industry: July</a></li>
<li><a href="../265021/index.html">SCADA and mobile phones: an assessment of the safety of applications that turn a smartphone into a plant control panel</a></li>
<li><a href="../265023/index.html">Configure D-Link DIR-320 / NRU + 3G Rostelecom R41 (Sense R41)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>