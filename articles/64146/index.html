<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>php: Storing objects in session</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the recently published resource here, I stumbled upon the question of storing objects created in the script in a php session. 

 How bad the practi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>php: Storing objects in session</h1><div class="post__text post__text-html js-mediator-article"> On the recently published resource here, I stumbled upon the question of storing objects created in the script in a php session. <br><br>  How bad the practice is, in principle, the storage of objects in a session, I will not discuss, but just show you how to work with such objects.  However, if experts have already found a recipe on <a href="http://php.net/">php.net</a> , and believe that everything is trivial, I completely agree with them.  However, if you do not know a bit ... <br><a name="habracut"></a><br>  So, we set out to put an object in a session, say, a certain user. <br><br>  About our files will look like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      myclass.php: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-class"><span class="hljs-keyword"><span class="php"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span><span class="php"><span class="hljs-class"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span></span><span class="php"><span class="hljs-class"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> $user; }</span></span></code> </pre><br><br>  index.php: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> session_start(); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">require</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'myclass.php'</span></span></span><span class="php">; header(</span><span class="hljs-string"><span class="php"><span class="hljs-string">"content-type: text/plain"</span></span></span><span class="php">); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">if</span></span></span><span class="php"> (!</span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">isset</span></span></span><span class="php">($_SESSION[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'classTst'</span></span></span><span class="php">])) { $myclass = </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">new</span></span></span><span class="php"> MyClass(); $myclass-&gt;user = </span><span class="hljs-string"><span class="php"><span class="hljs-string">'me'</span></span></span><span class="php">; $_SESSION[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'classTst'</span></span></span><span class="php">] = $myclass; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">"Class is into session array now"</span></span></span><span class="php">; } </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">else</span></span></span><span class="php"> { </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">"\$_SESSION['classTst'] dump: \n\n"</span></span></span><span class="php">; var_dump($_SESSION[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'classTst'</span></span></span><span class="php">]); } </span></span><br></code> </pre> <code>&lt;?php session_start(); require 'myclass.php'; header("content-type: text/plain"); if (!isset($_SESSION['classTst'])) { $myclass = new MyClass(); $myclass-&gt;user = 'me'; $_SESSION['classTst'] = $myclass; echo "Class is into session array now"; } else { echo "\$_SESSION['classTst'] dump: \n\n"; var_dump($_SESSION['classTst']); } <br></code> <br><br>  And now let's figure out what we are doing. <br><br>  In the first launch of the index.php script, we create an object of the class myclass and put it into the session.  In any subsequent case (until we destroy the session or destroy the ‚Äúlink‚Äù to it - in the form of a cookie in the browser, for example) we load the session in which our object already exists.  However, instead of being an instance of the class MyClass, var_dump () ‚Äúpleases‚Äù us with the class "__PHP_Incomplete_Class": <br><br><pre> $ _SESSION ['classTst'] dump: 

 object (__ PHP_Incomplete_Class) # 1 (2) {
   ["__PHP_Incomplete_Class_Name"] =&gt;
   string (7) "MyClass"
   ["user"] =&gt;
   string (2) "me"
 }
</pre><br><br>  Everything is very simple.  When the session is initialized, php stumbles upon the fact that it has an instance of the class MyClass in $ _SESSION ['classTst'] (those who wish can look at the contents of the file (if you have sessions in files) of the session and make sure that our serialized object will be there, with a description of which class it is an instance of).  But (surprise!), As can be seen from the script, at the time of the session start up, php knows nothing about the existence of the class MyClass.  Therefore, a completely logical interpreter further perceives this object as an object of a certain __PHP_Incomplete_Class. <br><br>  But if we change the order of the session start and class loading: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">require</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'myclass.php'</span></span></span><span class="php">; session_start(); header(</span><span class="hljs-string"><span class="php"><span class="hljs-string">"content-type: text/plain"</span></span></span><span class="php">); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">if</span></span></span><span class="php"> (!</span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">isset</span></span></span><span class="php">($_SESSION[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'classTst'</span></span></span><span class="php">])) { $myclass = </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">new</span></span></span><span class="php"> MyClass(); $myclass-&gt;user = </span><span class="hljs-string"><span class="php"><span class="hljs-string">'me'</span></span></span><span class="php">; $_SESSION[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'classTst'</span></span></span><span class="php">] = $myclass; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">"Class is into session array now"</span></span></span><span class="php">; } </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">else</span></span></span><span class="php"> { </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">"\$_SESSION['classTst'] dump: \n\n"</span></span></span><span class="php">; var_dump($_SESSION[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'classTst'</span></span></span><span class="php">]); } </span></span><br></code> </pre> <code>&lt;?php require 'myclass.php'; session_start(); header("content-type: text/plain"); if (!isset($_SESSION['classTst'])) { $myclass = new MyClass(); $myclass-&gt;user = 'me'; $_SESSION['classTst'] = $myclass; echo "Class is into session array now"; } else { echo "\$_SESSION['classTst'] dump: \n\n"; var_dump($_SESSION['classTst']); } <br></code>  , <br><br>  as, voila, we get what we wanted: <br><br><pre> $ _SESSION ['classTst'] dump: 

 object (MyClass) # 1 (1) {
   ["user"] =&gt;
   string (2) "me"
 }
</pre><br><br>  In general, everything is really simple: all objects that you want to store in a session should be known to the interpreter <b>BEFORE</b> you start the session. <br><br>  Thus, for example, if your standard is session.auto_start On, storing objects in a session is not your fate.  Also, if you rely on frameworks whose authors have decided for you, where and when what objects to load (and you rely entirely on authors), storing certain specific objects in a session can become just a death number (in the case of an object with other embedded objects , called "on demand" somewhere before the execution, say, of the controller, when the session started a long time ago).  In the case of a compound object (containing 2-3 service objects in properties, for example), a reasonable question may arise: what is ‚Äúcheaper‚Äù to throw everything into a session, or to get an object again with one or two queries from the database (or database cache)? <br><br>  So, to store or not to store objects in a session, and how to do it based on the realities of your project - it's up to you anyway :) </div><p>Source: <a href="https://habr.com/ru/post/64146/">https://habr.com/ru/post/64146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../64134/index.html">Semiconductor Industry News of Russia</a></li>
<li><a href="../64136/index.html">Andromedia Software Development - LifeForce</a></li>
<li><a href="../64140/index.html">CMS, CMF, ERP do it yourself</a></li>
<li><a href="../64143/index.html">July</a></li>
<li><a href="../64144/index.html">Programming Olympiad, view from NSU. Article 5 - how the team plays</a></li>
<li><a href="../64157/index.html">Entertainment industry and sausage cheese</a></li>
<li><a href="../64159/index.html">The Elder Scrolls II: Daggerfall give away free and legal</a></li>
<li><a href="../64161/index.html">Stargate in the photosinta prism</a></li>
<li><a href="../64162/index.html">Cooling systems - from radiator to liquid nitrogen! Part 1</a></li>
<li><a href="../64163/index.html">Subtleties of Chinese web design, part 1: colors and colors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>