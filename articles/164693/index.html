<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OMNI-395 payment terminal from the inside</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My real acquaintance with the ‚Äúunder‚Äù of the PC happened (by chance) in the early 2000s, when I got a job in the processing department of plastic card...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OMNI-395 payment terminal from the inside</h1><div class="post__text post__text-html js-mediator-article">  My real acquaintance with the ‚Äúunder‚Äù of the PC happened (by chance) in the early 2000s, when I got a job in the processing department of plastic cards of one bank.  More specifically, in the development of software for payment terminals, POS-s.  A PIC for accepting payments with plastic cards is usually a complete device, a mini or micro computer, with a screen, a keyboard, with a magnetic stripe reader from a card, often with a printer, and now also a reader for chip cards. <br><br>  I started with OMNI-395.  Built on Zilog Z180, has up to 1M non-volatile memory for storing data (operation logs, for example), an AT-modem for 2400 (even with some kind of correction), twelve-volt RS232 ports for a PIN-keyboard, a printer, and just a general purpose port (we used it to connect to a multi-port gateway in TCP / IP) (alas, not all ports have a full set of RS232 lines, which forces them to reinvent software bicycles), and also an LCD screen. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/097/12f/9e5/09712f9e575626b67f5d0e29b3931920.jpg"><br><br>  The architecture, by the way, is interesting.  A virtual machine was used to execute user code (apparently, this was how the addressing restrictions, pages, etc. were treated as).  This allowed us to use a lot of memory for the data, but the size and speed of the code was very modest.  It was necessary, for example, not to use native sprintf, but to write one to avoid overflow of the local stack, etc.  Calculation of tabular CRC on 5-10KB data worked visible seconds. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/46c/ae0/a5f/46cae0a5f845a34a418c703a2c16f287.jpg"><br><br>  Although, frankly, compared to the terminals of other companies at that time (Injenico, Nurit, etc.), where it was often necessary to do nonsense such as manual switching of memory pages and store magazines there, the VeriFone (TXO) environment gave standard C library, where you could work with ports and files through read / write / ioctl, etc.  And the fact that the naughty minds of developers usually want to stuff an elephant into a miserable device - and that caused problems.  When, over time, the limitations were more or less mastered, the development became almost trouble-free. <br><br>  Compiler C supported almost all of the standard library and separate compilation of modules.  The boot modules (R-modules) could be dynamically run directly from the user code (such as the overlay mechanism or CHAIN ‚Äã‚Äãin classical BASICS). <br><br>  And then Santa Claus brought an old OMNI-395 written off, and there was no limit to my joy.  Will we uncork?  Of course! <br><br>  We turn on, just in case, and, lo and behold, one of my firmwares is still loaded there. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a4f/c83/a6a/a4fc83a6a52e1e4043efd992722f2b28.jpg"><br><br>  So, the view from the inside. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b0/8c4/097/0b08c4097201017e6263220ba741a201.jpg"><br><br>  Two boards - the top, under the keyboard, and the bottom, with connectors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a52/e13/d47/a52e13d47e12b1c13a17e52947954c9f.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c94/930/5c4/c949305c47f8f8af0442574c0bc25fb6.jpg"><br><br>  I will dig out the compiler and the loader in the bottom of the barrel, try to write something. <br><br>  Alas, I did not find the descriptions of the hardware details, and the official documentation describes only the standard library and a little virtual machine, into the codes of which the user code is compiled. <br><br>  Of course, OMNI-395 can safely be used as a NEDO-PC as it is.  For example, as a controller of something.  If general purpose ports are needed, then RS-232 is suitable (DTR / RTS output, CTS / DSR input). <br><br>  But ideally, you can disassemble the firmware (there is only 64KB), and having understood the architecture, you can write purely on the Z80, and then it will work much faster. <br><br><h2>  PS </h2><br>  It must be said that, despite the change of the hardware platform and the compiler (more than once), VefiFone has an excellent succession of the library interface, which allows porting firmware to subsequent models with minimal changes.  After the 395th, I still worked with OMNI-3350, 3750, VX510, VX610. <br><br>  By the way, on the tag <a href="https://twitter.com/search%3Fq%3D%2523cardpayments%26src%3Dhash">#cardpayments</a> on Twitter, I post photos of POS, pinpads and other devices for accepting bank cards that I meet in life if anyone is interested. </div><p>Source: <a href="https://habr.com/ru/post/164693/">https://habr.com/ru/post/164693/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164679/index.html">Webinar: Sikuli - simple examples of proper automation (Java)</a></li>
<li><a href="../164683/index.html">Pictures in doc-file: weight reduction by surgery</a></li>
<li><a href="../164685/index.html">Rails params & gc</a></li>
<li><a href="../164687/index.html">Alternative terminal for Windows</a></li>
<li><a href="../164689/index.html">We are looking for money. Catalog of investors for a startup</a></li>
<li><a href="../164695/index.html">Mars rover Spirit went down to Mars 9 years ago</a></li>
<li><a href="../164697/index.html">Corning will present Gorilla Glass 3 at CES 2013</a></li>
<li><a href="../164699/index.html">Plugin system as an exercise in C ++ 11</a></li>
<li><a href="../164701/index.html">Clojure in the Belarusian State University</a></li>
<li><a href="../164703/index.html">AWS: Semifinalists Startup Contest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>