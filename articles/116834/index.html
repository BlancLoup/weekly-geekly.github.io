<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sectional Symfony2 Application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Watching open mouth for a virtuoso magician and his beautiful helpers, many, however, are focused on something else entirely: how does he do it? how i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sectional Symfony2 Application</h1><div class="post__text post__text-html js-mediator-article">  Watching open mouth for a virtuoso magician and his beautiful helpers, many, however, are focused on something else entirely: how does he do it?  how is everything inside there? <br><br><img src="https://habrastorage.org/storage/defbdc12/fd177c73/efb06b7b/e5df7d72.gif" align="left"><br>  The same thing happens when working with frameworks that do everything for us, but I want to know how they do it, and if necessary, be able to change their behavior.  Unfortunately, the documentation, no matter how good it is ( <a href="http://symfony.com/doc/2.0/">and in Symfony 2 it is already quite good</a> ), tells how to use all this ‚Äúmagic‚Äù, but does not reveal the whole point. <br><br clear="all">  This article is an attempt to figure out how the application is initialized and what ‚ÄúSymfony2 Kernel‚Äù is. <br><a name="habracut"></a><br>  For those who do not like big texts, a brief outline of the main components and a small description of the ongoing actions are immediately attached. <br><br><h1>  Brief description of the process </h1><br> <a href=""><img src="https://habrastorage.org/storage/c7e32824/ecf34456/96ebf76b/dcbfba05.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <em>Clickable</em> <br><br>  1. All requests are accepted by the Front Controller (FrontController). <br>  2. Configure class autoloading (autoload). <br>  3. A kernel is created depending on the environment. <br>  4. Runs the kernel. <br>  1. Initialize the Bundle list. <br>  2. A Dependency Injection Container is created. <br>  1. A container is created with the main parameters. <br>  2. Each bundle modifies (build) the container. <br>  3. The application configuration is loaded. <br>  4. The container is compiled. <br>  1. Extensions are processed. <br>  2. References to parameters are replaced by real values. <br>  3. The container is placed in read-only mode (frozen). <br>  3. Run the bundles. <br><br><br><h2>  Frontcontroller </h2><br>  As the front controller are the usual scripts.  Examples include scripts from the <a href="https://github.com/symfony/symfony-standard">standard Symfony2 distribution</a> . <br><ul><li>  <em>app / console</em> - access to the application through the CLI. </li><li>  <em>web / app.php</em> - access to the application through the web. </li><li>  <em>web / app_dev.php</em> - access to the application through the web in development mode. </li></ul><br>  All these front controllers are built on the same principle: <br><ul><li>  autoload is configured by connecting a script with registering the class loader; </li><li>  sometimes used class cache (frequently used classes, collected in 1 file); </li><li>  the kernel starts; </li></ul><br><br><h2>  Kernel </h2><br>  The kernel is a class that implements the <a href="http://api.symfony.com/2.0/Symfony/Component/HttpKernel/KernelInterface.html">KernelInterface</a> interface, its task is to initialize the environment.  The core of the kernel is based on two main components: the Dependency Injection container (the theory can be learned, for example, <a href="http://martinfowler.com/articles/injection.html">from Fowler</a> ) and the bundle system.  Bundle (bundle) - analogue plug-in from symfony 1.x.  More information about the bundles can be found <a href="http://symfony.com/doc/2.0/book/bundles.html">in the official documentation</a> .  Of course, besides the kernel interface itself, there is a standard abstract implementation of <a href="http://api.symfony.com/2.0/Symfony/Component/HttpKernel/Kernel.html">Kernel</a> , which is mainly discussed further. <br>  The initialization code looks something like this: <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// init bundles $this-&gt;initializeBundles(); // init container $this-&gt;initializeContainer(); foreach ($this-&gt;getBundles() as $bundle) { $bundle-&gt;setContainer($this-&gt;container); $bundle-&gt;boot(); }</span></span></code> </pre> <br><ul><li>  <em>(4.1) initializeBundles</em> - collects information about bundles (the ones that the developer registers for his application via <em>KernelInterface :: registerBundles</em> , see the <a href="https://github.com/symfony/symfony-standard/blob/master/app/AppKernel.php">example from the standard delivery</a> ); </li><li>  <em>(4.2) initializeContainer</em> - creates a DI container and fills it with data; </li><li>  (4.3) run each of the bundles. </li></ul><br><h3>  Container initialization </h3><br>  The result of this step is a fully-ready read-only container.  This process is divided into 4 sub-steps: <br><ul><li>  A container ( <a href="http://api.symfony.com/2.0/Symfony/Component/DependencyInjection/ContainerBuilder.html">ContainerBuilder</a> ) is created and standard kernel parameters are placed there: paths to the main directories, environment parameters (debug), and others. </li><li>  For each bundle, the <a href="http://api.symfony.com/2.0/Symfony/Component/HttpKernel/Bundle/BundleInterface.html">build is</a> started; at this stage, bundles are given the opportunity to modify the container. </li><li>  A configuration defined by the developer is added (via the <a href="http://api.symfony.com/2.0/Symfony/Component/HttpKernel/KernelInterface.html">registerContainerConfiguration of the</a> kernel).  In the standard package, this method looks very simple: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerContainerConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoaderInterface $loader)</span></span></span><span class="hljs-function"> </span></span>{ $loader-&gt;load(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/config/config_'</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getEnvironment().<span class="hljs-string"><span class="hljs-string">'.yml'</span></span>); }</code> </pre></li><li>  And finally, the container is compiled ( <a href="http://api.symfony.com/2.0/Symfony/Component/DependencyInjection/ContainerBuilder.html">compile</a> ): the real values ‚Äã‚Äãof the parameters are substituted;  <em>‚Äúcompiler passes‚Äù *</em> ( <em>CompilerPass) are performed, it is they who carry out the modifications added by bundles (more about them further);</em>  <em>the container ‚Äúfreezes‚Äù, i.e.</em>  <em>switches to read-only mode, after which any attempt to modify it will cause an exception</em> . <br></li></ul>  <strong><em>* In compiler theory, there is the concept of ‚Äúpassage‚Äù; here it is meant roughly the same thing, therefore CompilerPass translated it this way.</em></strong> <br><br><h3>  Modification of the container with bundles </h3><br>  As noted above, during the compilation process, each bundle has the ability to make modifications to the common container.  The main modification method is to add <em>compiler passes.</em> <br><br><h4>  Compiler pass </h4><br>  At compile time, the container performs a series of passes to bring its contents to the final state.  Passages are implementations of the <a href="http://api.symfony.com/2.0/Symfony/Component/DependencyInjection/Compiler/CompilerPassInterface.html">CompilerPassInterface</a> interface and come in 6 types (in order of execution): <em>merge, beforeOptimization, optimization, beforeRemoving, removing, afterRemoving</em> ‚Äî the default <a href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/DependencyInjection/Compiler/PassConfig.php">configuration of the compiler</a> already contains a set of passwords. <br><ul><li>  <em>before * / after *</em> - only ‚Äúhooks‚Äù for user ‚Äúpasses‚Äù and are not used by standard ones (added by default); </li><li>  <em>merge</em> - handles <em>extensions of the</em> container; </li><li>  <em>optimization</em> optimizes the container, examples are: ResolveInterfaceInjectorsPass (converts <a href="http://martinfowler.com/articles/injection.html">interface injections</a> ), CheckCircularReferencesPass (checks circular references in the container) </li><li>  <em>removing</em> - removes unused services, for example, RemoveUnusedDefinitionsPass (removes unused private services) </li></ul><br>  In CompilerPass bundles, it is most often used to process <a href="http://symfony.com/doc/2.0/book/service_container.html">tags in a container</a> .  An example of a standard TwigBundle: <br><pre> <code class="php hljs"> $definition = $container-&gt;getDefinition(<span class="hljs-string"><span class="hljs-string">'twig'</span></span>); $calls = $definition-&gt;getMethodCalls(); $definition-&gt;setMethodCalls(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>()); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($container-&gt;findTaggedServiceIds(<span class="hljs-string"><span class="hljs-string">'twig.extension'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $id =&gt; $attributes) { $definition-&gt;addMethodCall(<span class="hljs-string"><span class="hljs-string">'addExtension'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Reference($id))); } $definition-&gt;setMethodCalls(array_merge($definition-&gt;getMethodCalls(), $calls));</code> </pre><br><br><h4>  Container extensions </h4><br>  The container is the central element of the system, in fact, it concentrates all the functionality of the application, respectively, to add any functionality, you need to put the necessary services and parameters in the container.  For the convenience of such modifications, there are <a href="http://symfony.com/doc/2.0/book/service_container.html">container extensions</a> (which are processed by a special ‚Äúmerge‚Äù pass mentioned above). <br>  Extensions is an implementation of the <a href="http://api.symfony.com/2.0/Symfony/Component/DependencyInjection/Extension/ExtensionInterface.html">ExtensionInterface</a> interface, and the abstract <a href="http://api.symfony.com/2.0/Symfony/Component/HttpKernel/DependencyInjection/Extension.html">Extension</a> class reduces routine actions and adds convenient methods.  Extensions usually work as follows: <br><ul><li>  definitions of services and default parameters are loaded from the extension config (most often xml file); </li><li>  the extension-specific config file is processed by overwriting default values; </li><li>  classes are registered for building into one file (the same class cache in one file mentioned in the front controller) </li></ul><br>  Extension configuration example ( <em>app / config / config.yml</em> ): <br><pre> <code class="hljs pgsql"># Twig <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> twig: <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>: %kernel.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>% strict_variables: %kernel.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>%</code> </pre><br>  This configuration says that you need to pass to the extension ( <a href="http://api.symfony.com/2.0/Symfony/Component/DependencyInjection/Extension/ExtensionInterface.html">ExtensionInterface :: load ()</a> ) with the name <em>twig</em> ( <a href="http://api.symfony.com/2.0/Symfony/Component/DependencyInjection/Extension/ExtensionInterface.html">ExtensionInterface :: getAlias ‚Äã‚Äã()</a> ) the parameters defined in the corresponding section. <br><br>  It is very simple to connect the bundle extension, you just need to create a class with the appropriate name ( <em>DependencyInjection \ BundleNameExtension</em> ) and the code of the <a href="http://api.symfony.com/2.0/Symfony/Component/HttpKernel/Bundle/Bundle.html">Extension :: build ()</a> method will load the extension itself (the main thing is to remember to call the parent method and the heir;)). <br><br><h3>  Run the bundle </h3><br>  And the last stage is the launch of the bundles.  In fact, most bundles do nothing at this stage; it is designed to perform actions that cannot be performed by the container.  For example, the main Symfony2 bundle (FrameworkBundle) at this stage loads the class cache, mentioned more than once in this article. <br><br><h1>  Conclusion </h1><br>  At this point, the initialization process of the Symfony2 application can be considered complete: all the preparatory steps are completed, and the container contains all the necessary functionality.  It remains to get the necessary service from the container and call its methods to execute the application. <br>  The reader is probably concerned about a rather complicated and resource-intensive initialization process, but everything is not so bad.  Symfony2, along with flexibility, does not forget about speed, so "out of the box" provides many optimization solutions.  So, for example, the entire container creation process is cached by creating a class containing all the settings, and on the next call (if this is a debug mode) instead of loading a lot of configs of various parameters, running the container compiler, etc.  the generated class will be just loaded and the finished container object is immediately created. <br><br><h2>  From the author </h2><br>  This completes the first dive into the wilds of symfony2.  If this type of articles about Symfony2 is interesting for readers, then it is possible to turn it all into a series of articles with an analysis of the framework's internal parts, individual components and popular bundles.  In addition, this is my first article, despite the long stay on Habr√©.  I like to speak more than to write, but I try to cultivate in myself such a way of presenting my thoughts.  Therefore, I would be very grateful for the feedback directly on the presentation of the material: how difficult it is perceived;  what is better to do more emphasis on what is less;  may need more illustrations and code examples;  rely more on those who are familiar with the subject area, or try to describe, so that it is clear to all, etc. </div><p>Source: <a href="https://habr.com/ru/post/116834/">https://habr.com/ru/post/116834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116823/index.html">And maybe the truth web 2.0 implies openness, or at least web 3.0</a></li>
<li><a href="../116824/index.html">Object tracking on video</a></li>
<li><a href="../116825/index.html">About documentation standards</a></li>
<li><a href="../116827/index.html">Operator comma</a></li>
<li><a href="../116830/index.html">Parsing XML with Simple Framework</a></li>
<li><a href="../116835/index.html">Simple data scrambling algorithms</a></li>
<li><a href="../116837/index.html">Signal quality criteria for WiMax networks</a></li>
<li><a href="../116838/index.html">We optimize the work process in the console</a></li>
<li><a href="../116840/index.html">New Year's Eve update on Habr√©</a></li>
<li><a href="../116842/index.html">Govnokod: the enemy must know in person</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>