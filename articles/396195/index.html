<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lumen Taba on guard of productivity: we write our own application for a smart bulb</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone, I have long been interested in "smart" home, and in particular the programming of some improvised devices. Last time I put OpenWrt on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lumen Taba on guard of productivity: we write our own application for a smart bulb</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/534/dbc/c5b/534dbcc5b2df0b824a53d66c1e64e4d3.jpg" alt="image" height="250" align="right">  Hello everyone, I have long been interested in "smart" home, and in particular the programming of some improvised devices.  Last time I put OpenWrt on my router and opened the front door through the phone using GPIO (for now, the layout).  This time it will be about productivity, not security. <br><br>  Many have already heard about "smart" light bulbs that can change colors and even flash to the music.  And not so long ago I received one such in my hands.  This is LuMini.  Which of us, programmers, is interested in simply a ‚Äúsmart‚Äù device, for which we cannot make our own applications, but there are many ideas. <a name="habracut"></a><br><br>  It turns out that LuMini is for us.  Having opened my native iOS application, I immediately realized that I would get access to the light bulb.  The light bulb was connected in a magical way, and after connecting it, I started reverse-engineering Android applications.  I heard somewhere that they are perfectly decompiled into Java files, and from there you can take all the logic of working with the lamp.  Getting apk was not difficult.  Here you can find apk applications from Google Play, and here you <a href="http://www.javadecompilers.com/apk"><u>can</u></a> decompile the code.  In parallel, I already told my colleague about the idea and heard a positive review.  So, while I was decompiling, she found a <a href="https://github.com/emanuele-f/lumen-control"><u>server on Node.js</u></a> , which connects to the lamp and gives a ‚Äúhandle‚Äù for management.  I thought and decided why not.  So, now I can control the lamp myself - half the job is done. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/geektimes/post_images/797/f59/893/797f5989370932907a8bcb24da7bba56.jpg" alt="image" width="900"><img src="https://habrastorage.org/getpro/geektimes/post_images/fe8/962/9b1/fe89629b1a3920dd676371c300516a44.jpg" alt="image" width="900"><br><br>  After that you had to choose an idea. <br>  1. Place a light bulb over the monitor and turn on the color under the image on the screen.  I have seen several such TVs. <br>  2. Turn on the color of the light bulb in the morning based on the weather. <br>  3. Adjust the brightness of the light depending on the brightness of the screen (for example, not quite bright at night).  It turned out to be useless. <br>  4. Place a light bulb on the monitor and turn on the red light when you come into contact behind the memes during operation, for example. <br><br>  The fourth idea seemed the most useful.  We were already two in the team and we rushed to do.  I wrote an application for still OS X on Swift, and a colleague removed the superfluous from the north.  About the server, I will not write anything else, all the interesting can be found <a href="https://github.com/Ksenia2805/lumen"><u>here</u></a> . <br><br>  I chose OS X and Swift, because I know the latter more or less, and for the first, my hands were itching for a long time to write something, I hope it worked out well.  So, the application should track the "bad" sites and drive a light bulb into the paint: turn on the red light.  There is no such possibility built into the language (and well).  Well, I went to the garret <a href="https://www.youtube.com/watch%3Fv%3DfjNMbvUkbZs"><u>asking Google</u></a> . <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/ae2/331/7b7/ae23317b74f75e3141b1798d4f81d933.jpg" alt="image"><br><br>  - I want to know the open tabs in the browser using Swift or at least Objective-C. <br>  - I think you do not need it, here's your AppleScript. <br>  - Well, cool, but what is it? <br>  - Built-in scripts that can manage the system and usually use them for automation. <br>  - Okay, then tell me how to find out the open tabs, for example, in Safari. <br>  - Yes, that's it ( <a href="https://gist.github.com/vitorgalvao/5392178"><u>link</u></a> ).  There is also on other browsers. <br>  - Well, this is already possible to work, thank you. <br><br>  Let's change a little script. <br><br><pre><code class="actionscript hljs">tell application <span class="hljs-string"><span class="hljs-string">"System Events"</span></span> to <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> frontApp to name of first process whose frontmost <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (frontApp = <span class="hljs-string"><span class="hljs-string">"Safari"</span></span>) then using terms from application <span class="hljs-string"><span class="hljs-string">"Safari"</span></span> tell application frontApp to <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> currentTabUrl to URL of front document tell application frontApp to <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> currentTabTitle to name of front document end using terms from <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (frontApp = <span class="hljs-string"><span class="hljs-string">"Google Chrome"</span></span>) then using terms from application <span class="hljs-string"><span class="hljs-string">"Google Chrome"</span></span> tell application frontApp to <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> currentTabUrl to URL of active tab of front window tell application frontApp to <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> currentTabTitle to title of active tab of front window end using terms from <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (frontApp = <span class="hljs-string"><span class="hljs-string">"Lumen Taba"</span></span>) then <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentTabUrl</code> </pre> <br><br>  Now it remains to run this thing in the background, and it's in the bag. <br><br><pre> <code class="hljs lisp">//run tracker in background mode let qualityOfServiceClass = QOS_CLASS_BACKGROUND let backgroundQueue = dispatch_get_global_queue(<span class="hljs-name"><span class="hljs-name">qualityOfServiceClass</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) dispatch_async(<span class="hljs-name"><span class="hljs-name">backgroundQueue</span></span>, { while !self.needStop { self.isRunning = true var error: NSDictionary? //run script if let scriptObject = NSAppleScript(<span class="hljs-name"><span class="hljs-name">source</span></span>: self.scriptText!) { if let output: NSAppleEventDescriptor = scriptObject.executeAndReturnError( <span class="hljs-name"><span class="hljs-name">&amp;error</span></span>) { //if browser is active if output.stringValue != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { //this app is active if (<span class="hljs-name"><span class="hljs-name">output</span></span>.int32Value == <span class="hljs-number"><span class="hljs-number">1</span></span>) { continue } //if bad url if self.urlValidator.isUrlStringBanned(<span class="hljs-name"><span class="hljs-name">output</span></span>.stringValue!) { //bad url isn't changed if self.lastBadUrl == output.stringValue { continue } self.lastBadUrl = output.stringValue NSNotificationCenter.defaultCenter().postNotificationName(<span class="hljs-string"><span class="hljs-string">"BadUrlIsOpened"</span></span>, object: self.lastBadUrl) continue } } //the browser is not active //turn off lamp if it was on if self.lastBadUrl != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { self.lastBadUrl = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> NSNotificationCenter.defaultCenter().postNotificationName(<span class="hljs-string"><span class="hljs-string">"BadUrlIsClosed"</span></span>, object: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } } else if (<span class="hljs-name"><span class="hljs-name">error</span></span> != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { print(<span class="hljs-string"><span class="hljs-string">"error"</span></span>) } } sleep(<span class="hljs-name"><span class="hljs-name">self</span></span>.CHECK_INTERVAL) } self.isRunning = false })</code> </pre><img src="https://habrastorage.org/getpro/geektimes/post_images/771/7e9/fa3/7717e9fa393c51a11cb53e0567e35321.jpg" alt="image" height="230" align="right"><br>  This is how it is done in Swift. <br><br>  Now we are testing the url for its corruption.  As a stop list was chosen to use regex expressions.  All you need is a domain and all pages of the site will be blocked.  Of course, it is possible and a little other cases where another site will contain a banned domain, but here you probably do something wrong (why are you looking for vk.com in Google).  Adding sites placed in the settings with preservation in the file embedded in the application, and the check itself in the code looks like this: <br><br><pre> <code class="hljs pgsql">private func checkUrl(url: NSURL) -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { let <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> = url.host //there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> == nil) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } let badRegexes = getBadRegexes() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> br <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> badRegexes { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> matchesForRegexInText(br, <span class="hljs-type"><span class="hljs-type">text</span></span>: url.absoluteString) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } private func matchesForRegexInText(regex: String!, <span class="hljs-type"><span class="hljs-type">text</span></span>: String!) -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { let regex = try NSRegularExpression(pattern: regex, <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>: []) let nsString = <span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> NSString let results = regex.matchesInString(<span class="hljs-type"><span class="hljs-type">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>: [], range: NSMakeRange(<span class="hljs-number"><span class="hljs-number">0</span></span>, nsString.length)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results.count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } catch let error <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> NSError { print("invalid regex: \(error.localizedDescription)") <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } }</code> </pre><br><br>  You can view all the code in the <a href="https://github.com/vvorlov/lumen-work-productivity"><u>repository</u></a> , but for now I will show the final result. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/47d/dd1/db4/47ddd1db43b4e9c2015e161cfb87de4a.jpg" alt="image" width="900"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/1a5/fc7/8ce/1a5fc78ce4f59284cf877971fa324864.jpg" alt="image" width="900"><br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Lv-lQEiI8HU%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgKmWNBNWT32vL6AmSNDONkbcpBxQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Waiting for comments and new ideas, how cool can you use a similar light bulb? <br><br>  Also, if you are interested in the article and you would like to have such an employee, then just for you my resume: <a href="https://goo.gl/ppnr6z">goo.gl/ppnr6z</a> . <br><br>  Within 14 days from the date of publication of this article, you can <a href="https://goo.gl/5dmAv9">purchase a Lumen Smart</a> <b>Light Bulb</b> <a href="https://goo.gl/5dmAv9">with a 10% discount using the</a> <b>GEEKT-UL</b> <a href="https://goo.gl/5dmAv9">code</a> . </div><p>Source: <a href="https://habr.com/ru/post/396195/">https://habr.com/ru/post/396195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../396185/index.html">5 autopilot sensors and their (so far) unsolvable difficulties</a></li>
<li><a href="../396187/index.html">Why new antibiotics do not enter the market</a></li>
<li><a href="../396189/index.html">Turn over Armstrong or the story of the first moon walk broadcast</a></li>
<li><a href="../396191/index.html">In DARPA intend to use artificial intelligence to protect against existing and newest cyber threats</a></li>
<li><a href="../396193/index.html">Elcaset: giant audio tapes of the past from Japan and forgotten audio format</a></li>
<li><a href="../396197/index.html">What to expect from Brexit: the views of global financial analysts</a></li>
<li><a href="../396199/index.html">Space exhibitions in Moscow</a></li>
<li><a href="../396201/index.html">Edward Snowden and hacker Bunny have developed a device for monitoring GSM, GPS, WiFi, Bluetooth, NFC signals on the telephone bus</a></li>
<li><a href="../396203/index.html">Amazing Plan to Grow Money in the Trees</a></li>
<li><a href="../396207/index.html">Two Big Bangs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>