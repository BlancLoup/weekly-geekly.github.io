<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The internal work of the jQuery validate unobtrusive plugin in ASP.Net MVC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is part 3 of the series ‚ÄúUnderstanding Unobtrusive Validation in ASP.Net MVC‚Äù. 

 1. The jQuery validate plugin works from the inside 
 2. Unders...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The internal work of the jQuery validate unobtrusive plugin in ASP.Net MVC</h1><div class="post__text post__text-html js-mediator-article">  This is part 3 of the series ‚ÄúUnderstanding Unobtrusive Validation in ASP.Net MVC‚Äù. <br><br>  <a href="http://habrahabr.ru/post/180279/">1. The jQuery validate plugin works from the inside</a> <br>  <a href="http://habrahabr.ru/post/181754/">2. Understanding Html-code generated by unobtrusive validation in ASP.Net MVC</a> <br>  3. Internal work of the jQuery validate unobtrusive plugin in ASP.Net MVC. <br><br>  What we will discuss in this article: <br><ul><li>  Method "parse" <br><ul><li>  section "parceElement" <br><ul><li>  explanation of the parameter "skipAttach" </li><li>  explanation of the ‚ÄúparceElement‚Äù function </li></ul><br></li><li>  section "validateInfo" <br><ul><li>  explanation of the "validateInfo" function </li><li>  explanation of the object "return" </li></ul><br></li></ul><br></li><li>  Adapters </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Method "parse" </h4><br>  We will explain the cycle of unobtrusive validation that occurs when the document is loaded, and understand the role of each component. <br>  If we look at the end of jquery.validate.unobtrusive.js we will find <br><br><pre><code class="javascript hljs">$(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $jQval.unobtrusive.parse(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>); });</code> </pre> <br>  So, we call the "parse ()" method and pass it the "document" <br>  What is the parse () method? <a name="habracut"></a><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">parse</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Parses all the HTML elements in the specified selector. It looks for input elements decorated /// with the [data-val=true] attribute value and enables validation according to the data-val-* /// attribute values. /// &lt;/summary&gt; ///Any valid jQuery selector. $(selector).find(":input[data-val=true]").each(function () { $jQval.unobtrusive.parseElement(this, true); }); var $forms = $(selector) .parents("form") .andSelf() .add($(selector).find("form")) .filter("form"); $forms.each(function () { var info = validationInfo(this); if (info) { info.attachValidation(); } }); } }</span></span></code> </pre><br>  The ‚Äúparse ()‚Äù method has two sections. <br><br><h5>  1. Section "parceElement" </h5><br>  <i>parseElement (element, skipAttach)</i> <br><br><pre> <code class="javascript hljs">$(selector).find(<span class="hljs-string"><span class="hljs-string">":input[data-val=true]"</span></span>).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $jQval.unobtrusive.parseElement(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); });</code> </pre><br>  The first thing that happens is that we loop through all the elements containing ‚Äúdata-val = true‚Äù inside the selector that we are passing (in our case, this is ‚Äúdocument‚Äù) <br>  Then we call parseElement () and pass it the element that we want to validate and true for skipAttach. <br><br><h6>  Explanation of the "skipAttach" parameter </h6><br>  It may be asked why we pass true rather than false in skipAttach. <br><br>  "SkipAttach" is a flag to call "validate ()" on a form. <br>  If we pass ‚Äúfalse‚Äù to the element that we pass, validation rules are attached and the ‚Äúvalidate‚Äù method is immediately called for the array of rules, and further options are given that are necessary for unobtrusive validation (If there is any other element that they collect parsit). <br>  We do not want this.  First of all, we want to attach rules to each element of the form, and then, when all the rules are attached, we call validate (), which is the main part of the parse method. <br><br>  When do we need to pass ‚Äútrue‚Äù to ‚ÄúskipAttach‚Äù? <br><br>  If we want to add a dynamic element to a form that has already been validated, we will pass ‚Äútrue‚Äù in order not to validate the form again, because we don‚Äôt want something to happen (we will talk about dynamic validation of the element in the next article) <br><br><h6>  Explanation of the "parseElement" function </h6><br>  Basically, the "parseElement ()" function does two things: <br><br>  1. When the form element is called for the first time (no element was called before in this form), the function constructs an object of options that will be passed to the validate () method.  Options are used by jquery.unobtrusive as a separate function ‚ÄúerrorPlacement‚Äù, a separate ‚ÄúerrorClass‚Äù and as an empty array of rules. <br>  Note: this can all be done in a private method ‚ÄúvalidationInfo (form)‚Äù, which is called without ‚ÄúparseElement‚Äù, and when it is called more than 1 time, it simply returns the same object.  Thus, we can add, change or call data / functions in it. <br>  2. For each element, when we call ‚ÄúparseElement‚Äù, it understands the rules that are written in this element (‚Äúthe data- *‚Äù), using adapters (then there is a clause explaining how adapters work), and then translates and adds them to the array of rules that was created on the first call. <br>  Note: Each time a parseElement is called, its result will be saved in the form using the $ .data method (‚ÄúunobtrusiveValidation‚Äú).  Thus, individual calls are synchronized with the same data source. <br><br><h5>  2. Section "validateInfo" </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $forms = $(selector) .parents(<span class="hljs-string"><span class="hljs-string">"form"</span></span>) .andSelf() .add($(selector).find(<span class="hljs-string"><span class="hljs-string">"form"</span></span>)) .filter(<span class="hljs-string"><span class="hljs-string">"form"</span></span>); $forms.each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> info = validationInfo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (info) { info.attachValidation(); } });</code> </pre><br><br><h6>  Explanation of the "validateInfo" function </h6><br>  We have already mentioned that calling the function "validateInfo ()" constructs an options object of the method "validate ()".  Options are used by jquery.unobtrusive as a separate function ‚ÄúerrorPlacement‚Äù, a separate ‚ÄúerrorClass‚Äù and an empty array of rules. <br>  Here we also call "validateInfo ()" for each form on the page.  Usually, by calling ‚ÄúvalaidateInfo‚Äù in this place, we only get an object saved in a form that was already filled in the first phase.  That is, we use it as a "getter". <br>  Then we call ‚ÄúattachValidation ()‚Äù, which calls the ‚Äúvalidate ()‚Äù method, passing it options filled with the ‚ÄúvalidationInfo ()‚Äù call. <br><pre> <code class="javascript hljs">data_validation = <span class="hljs-string"><span class="hljs-string">"unobtrusiveValidation"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validationInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">form</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $form = $(form), result = $form.data(data_validation), onResetProxy = $.proxy(onReset, form); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!result) { result = { <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-comment"><span class="hljs-comment">// options structure passed to jQuery Validate's validate() method errorClass: "input-validation-error", errorElement: "span", errorPlacement: $.proxy(onError, form), invalidHandler: $.proxy(onErrors, form), messages: {}, rules: {}, success: $.proxy(onSuccess, form) }, attachValidation: function () { $form .unbind("reset." + data_validation, onResetProxy) .bind("reset." + data_validation, onResetProxy) .validate(this.options); }, validate: function () { // a validation function that is called by unobtrusive Ajax $form.validate(); return $form.valid(); } }; $form.data(data_validation, result); } return result; }</span></span></code> </pre><br>  First, we check if we have already called this function on the form earlier, using $ form.data (‚ÄúunobtrusiveValidation‚Äú).  If already called, then we do nothing and return the result. <br><br><h6>  Explanation of the object "return". </h6><br>  If this is the first call to the ‚ÄúvalidationInfo ()‚Äù function, then we create a result object and save it on the form using the $ .data () method.  This object contains 3 parts: <br><ul><li>  An object that we will pass to the "validate ()" method with an empty array of rules and messages that we will construct later. </li><li>  The ‚ÄúattachValidation ()‚Äù method, which will bind its own ‚Äúreset.unobtrusiveValidation‚Äù event to the form, and after calling ‚Äúvalidate‚Äù on the method with all options, this method will be called when the array of rules and messages is filled (causing its own ‚Äúreset ", We will call the" onReset () "method, which resets everything). <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// 'this' is the form element var $form = $(this); $form.data("validator").resetForm(); $form.find(".control-group").removeClass("error"); $form.find(".validation-summary-errors") .addClass("validation-summary-valid") .removeClass("validation-summary-errors"); $form.find(".field-validation-error") .addClass("field-validation-valid") .removeClass("field-validation-error") .removeData("unobtrusiveContainer") .find("&gt;*") // If we were using valmsg-replace, get the underlying error .removeData("unobtrusiveContainer");</span></span></code> </pre><br>  So, if we want to trigger the ‚Äúreset‚Äù event to nullify the form validation: <br> <code>$('form').trigger('reset.unobtrusiveValidation')</code> <br> </li><li>  A separate method "validate ()" will be called from unobtrusive Ajax </li></ul><br><br><h4>  Adapters </h4><br><br>  I specifically missed the topic of adapters when I talked about the ‚ÄúparseElement ()‚Äù method, because they are complex enough to highlight a sub-item for them. <br>  We looked at how Html is generated using unobtrusive validation, and how to add individual validation attributes in normal jquery.validate.  To connect these two parts are used adapters. <br>  So, what are adapters responsible for? <br>  Adapters are responsible for translating the Html "data- *" into a format understandable to the regular jquery.validate plugin.  If a user wants to add a separate validation method using unobtrusive validation, he must also create an adapter for it.  The adapter collection is located in $ .validator.unobtrusive.adapters.  The adapter collection consists of all the default adapters that are defined in jquery.unobstrusive and those defined by the user. <br>  It also contains 4 methods for adding your own adapter, which we will look at later. <br><br> <a href="http://piccy.info/view3/4656265/cce2c37a6c3bfa2f18f5dc3f53aa51f2/orig/"><img src="https://habrastorage.org/getpro/habr/post_images/847/5c9/1f3/8475c91f3de543040ed0ab20384ce17d.jpg" alt="Piccy.info - Free Image Hosting"></a> <a href="http://i.piccy.info/a3c/2013-06-01-19-07/i7-4656265/800x313-r"><img src="https://habrastorage.org/getpro/habr/post_images/0ca/608/1c3/0ca6081c3a10b0f426bc590924d6001b.gif"></a> <br><br>  The most basic method: <br>  <i>jQuery.validator.unobtrusive.adapters.add (adapterName, [params], fn)</i> <br><br>  We can consider this method as $ .ajax method, three other methods are auxiliary, use this method <br><br>  Let's break down the parameters: <br><br><ul><li>  adapterName: This is the name of the adapter, it matches the ‚ÄúruleName‚Äù in the Html element (data-val-ruleName) </li><li>  [params]: an optional array of parameters that the validation method will use to complete the validation. </li><li>  fn: called to connect the Html "data- *" with the rules and messages used by the "validate ()" method.  It has the option of parameters that are passed to it as an object with the following properties: <br><ul><li>  element: Html element that is validated; </li><li>  form: form element; </li><li>  message: an error message for this rule, extracted from the data- * attributes of this element; </li><li>  params: parameters that are used for validation and their array, extracted from the ‚Äúdata- *‚Äù attributes of the Html element (data-val-ruleName-param1); </li><li>  rules: an array of jQuery rules for this element.  To add a rule (-la) to this array, we will pass the key / value pairs, the key is the name of the validation rule, the value is the parameter used for this rule (as written in the first article of the cycle in the section "Adding Your Own Validation Rules") </li><li>  messages: an array of jquery messages for this element, as well as with the rule object, we fill it in and it is used as the message object for this Html element in the "validate" method. <br>  Note: this method returns no result.  The array of rules and messages will be saved on the form itself using $ .data (‚ÄúunobtrusiveValidation‚Äú).  We can test the ‚ÄúparseElement‚Äù method to see in detail how the parameters were passed to the adapter function. </li></ul><br></li></ul>  Example: <br>  Html <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"val"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"val"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-between</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Must be in the right range"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-between-min</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-between-max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Javascript <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//The adapter jQuery.validator.unobtrusive.adapters.add( 'between', ['min' ,'max'], function (options) { options.rules['between'] = { min: options.params.min, max: options.params.max }; options.messages['between'] = options.message; } ); //The validation method jQuery.validator.addMethod("between", function (value, element, params) { params.min == 5; //true params.max == 30; //true });</span></span></code> </pre><br><br>  What about other adapters: <br><br>  addBool <br>  addSingleVal <br>  addMinMax <br><br>  They are quite simple if you understand the concept of adding your own adapter using the add () method explained earlier. <br>  You can also see the <a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html">Brad Wilson</a> article <a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html">"Unobtrusive Client Validation in ASP.NET MVC 3"</a> , where he explains the topic of adapters in more detail. <br><br>  JQuery jade legal translation <a href="http://nadeemkhedr.wordpress.com/2012/08/27/how-the-unobtrusive-jquery-validate-plugin-works-internally-in-asp-net-mvc/">plugin works internally in Asp.net MVC</a> <br><br>  update: added a picture with a list of adapters and links to other posts in the series </div><p>Source: <a href="https://habr.com/ru/post/181758/">https://habr.com/ru/post/181758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181748/index.html">Petersburg game development evenings with Unity Technologies</a></li>
<li><a href="../181750/index.html">Died co-founder of the project Oculus Rift</a></li>
<li><a href="../181752/index.html">"Burroughs Adding Machine Co." at the time of its power</a></li>
<li><a href="../181754/index.html">Understanding Html code generated by unobtrusive validation in ASP.Net MVC</a></li>
<li><a href="../181756/index.html">Energy Management (Energy Management)</a></li>
<li><a href="../181760/index.html">Sort the list by analogy of "Windows Explorer"</a></li>
<li><a href="../181764/index.html">3d modeling + livecoding = game development acceleration</a></li>
<li><a href="../181766/index.html">Interactive SVG cartogram with d3.js</a></li>
<li><a href="../181768/index.html">Testing Python 2.7 performance when processing lists in various ways</a></li>
<li><a href="../181770/index.html">Configuring Opera 15 with the "file" method</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>