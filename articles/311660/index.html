<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why open up a black JVM box - Interview with Charles Nutter, Red Hat JVM developer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Autumn is a great time to meet old friends, travel to conferences, walk in parks. Many have already returned from the holidays with new impressions, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why open up a black JVM box - Interview with Charles Nutter, Red Hat JVM developer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/831/c2d/f76/831c2df76daf4b54a6c003dcb9e1433d.png"><br><br><img align="left" src="https://habrastorage.org/files/d76/bba/bed/d76bbabedf69438bbf13dd04dc91f32e.jpg" width="300">  Autumn is a great time to meet old friends, travel to conferences, walk in parks.  Many have already returned from the holidays with new impressions, ideas, ready to share them, communicate with others.  Our interview today is not about traveling, although undoubtedly, diving into the world of Java can also be called such.  Talk about JVM.  Our interviewee is <b>Charles Nutter</b> , JVM developer at Red Hat, lead engineer for the <a href="http://jruby.org/">JRuby</a> project. <br><br>  So, stock up on coffee and start. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>‚ÄúOur theme today is JVM and its‚Äú dark ‚Äùcontent.</strong>  <strong>Charles, tell me, when did the JVM stop being a mystery for you?</strong> <br><a name="habracut"></a><br><br>  Yes, the feeling of working with a black box, there is a majority of users of the Java virtual machine, with whom I am familiar. <br><br>  I think that the learning process started when I released open source OpenJDK.  Around this time, I began to understand how the JVM works.  At that time, behind the back was already ten years of experience of the developer.  The interest was to understand what was really going on behind the scenes, in key places of the JVM.  Not to say that at that moment I was picking exactly in the guts of the Java virtual machine. <br><br>  That all changed while working on JRuby, a Ruby implementation running on the JVM. <br><br>  In order to make the language useful and powerful, we began to closely study the JVM, the very secret places of the virtual machine.  An understanding of how JVM works is required to work out optimization algorithms. <br><br>  Together with the engineers working on the JVM, we developed functions, such as invokedynamic, for example, that help functional languages, in our case, JRuby. <br><br>  So after ten years of working on JRuby, I gained the knowledge and experience of how the JVM works, and made a few of these dark spots a little less dark. <br><br>  <strong>- What do you think about the outdated, but stubbornly entrenched in people's minds idea that Java is slow?</strong>  <strong>How does the filling match the capabilities of the hardware today?</strong> <br><br>  - The truth is that this issue was raised frequently by us as participants in the JRuby project.  People who are not familiar with Java or with the JVM, heard about the idea of ‚Äã‚Äãimplementing Ruby on it: Ruby is a language that is not considered fast, in Java, which, unfortunately, has an incorrect, outdated reputation for being slow.  In such a performance language did not make sense to many people. <br><br>  We had to solve this issue.  The truth is that Java was slow fifteen years ago.  The tremendous work on JIT compilers and the garbage collector has continued and continues to this day, every day.  There are a lot of people left who were in the industry and remember the ‚Äúbad times‚Äù of slow Java.  Because of this, the myth does not disappear for so long. <br><br>  Java is very powerful these days, but speed and many of the great features depend on JIT compilers and the garbage collector, which often leads to launch losses. <br><br>  However, even today Java has something to improve, to optimize, for example - the time of the warm-up curve should be reduced for maximum peak performance.  Fortunately, painstaking work continues on these things. <br><br>  <strong>‚ÄúOne of the reasons that developers devote little time to studying the internal structure and operation of the JVM is that programs run perfectly in different environments and are not required to be rewritten and optimized for each platform.</strong>  <strong>Do you agree with this thesis?</strong> <br><br>  ‚ÄúThe big plus of the JVM is that when you get the so-called black box, in most cases the developer does not need to look under the cover to understand how the JVM works and how it works.  However, as in any operating systems, programming languages, libraries, frameworks that you use, knowledge of how they work, makes you better, more experienced. <br><br>  In my case, we were forced to understand why the JVM is not always as fast as we want it to be.  It was necessary to figure out what actions need to be done to teach the JVM to execute Ruby code faster. <br><br>  It is necessary to look inside the JVM and understand how it works, from and to. <br>  Many developers never get to this point of exploration.  You know how the garbage collector, JIT compilers work, sometimes that's enough.  It is normal when you do not know what is going on inside when you are developing applications.  But there are cases when you may need maximum performance or other critical things for a large business, for some websites, at this very moment you will need the details that you will receive only during the ‚Äúdive‚Äù. <br><br>  <strong>‚ÄúOr maybe it‚Äôs right that the developers don‚Äôt look into the JVM settings until they see the problem?‚Äù</strong>  <strong>You can usefully spend this time writing new programs, right?</strong> <br><br>  - Yes, I agree, this is exactly the real strength of the Java virtual machine.  And that was one of the main reasons why Java has evolved so rapidly over the last twenty years.  People can quickly develop applications, surprisingly quickly. <br><br>  Obviously, I would never recommend everyone to delve into the work of the JIT compiler or read the code of the garbage collector.  There are many features that you need to know and understand them, but this may not always be useful for everyday development. <br><br>  I plan to tell a lot of interesting things on <a href="http://jokerconf.com/">Joker 2016</a> , for example, how to look behind the scenes of JVM ... how to enable JVM JIT logging and see how the code is compiled, see what decisions the machine makes during optimization.  You can go even further and start watching the code in assembly language if you have an algorithm or program that you want to optimize.  You will not need to dive very deep into the depths of the JVM in order to come to a better understanding of how it works and how to make the JVM work for your application one hundred percent. <br><br>  <strong>- During our dialogue, I had another question, at first glance, not related to the JVM.</strong>  <strong>Do you think the modules and modular system planned for Java 9 will help with optimization issues?</strong> <br><br>  ‚ÄúI followed the JVM modularization process.‚Äù  There were conversations about breaking up into small parts for easy distribution while I was working at Sun Microsystem.  I think that this is an amazing and at the same time complex work that is happening now, given the huge amount of code, including the internal structure of the JVM.  Embedding the entire runtime in a whole platform on the JVM is a huge challenge. <br><br>  There are a large number of dependencies within the main JDK classes with classes that we don‚Äôt see from the scene.  What I really admire in modularity is the fact that we have an exact way to limit certain blocks in an application and all its dependencies.  As in Maven at the time of assembly, it is now possible to transfer applications with all the other handy tools that will be released soon in JDK 9. <br><br>  Another interesting feature in JDK 9 is the optimization of individual elements, the ability to analyze individual parts of the code and perform pre-optimization.  This will help when loading, will increase the intensity of the warm-up, perhaps the implementation of early compilation. <br><br>  Most of these things would be difficult to implement without modularity, we will get much more flexibility after its implementation. <br><br>  <strong>- As we know, there are static and dynamic compilers.</strong>  <strong>Why is it easier with Just-In-Time (JIT)?</strong>  <strong>Please tell us how JIT mechanisms help to create faster sequences of instructions and replace instructions with more efficient sets.</strong> <br><br>  - Static compilers should always make a forced compromise when making decisions about optimizing code, since it is more difficult for them to understand, to figure out how the program will behave during execution.  This is the advantage of JIT compilers: they collect information about the objects used, the branches, and the methods called where the most code is executed.  JIT compilers can use tricks such as embedding to combine methods and deoptimization, which allow aggressive code optimization with a safe rollback (for example, an interpreter or a less optimized version of code) in case these optimizations need to be changed. <br><br>  <strong>- Another important part in the work of the JVM is the garbage collector.</strong>  <strong>A few months ago, I read a note about Shenandoah garbage collection technology.</strong>  <strong>‚ÄúShenandoah is a parallel and concurrent compacting garbage collector.</strong>  <strong>It is a work that has been carried out.</strong> <strong><br><br></strong>  <strong>Can you tell us about the work in this direction?</strong> <br><br>  ‚ÄúI only have information about the Shenandoah project as part of what I read myself, but I welcome my friends at Red Hat to go beyond the limitations of OpenJDK. <br>  Choosing a garbage collector is one of the most difficult problems for JVM users.  Shenandoah falls into the group of garbage collectors focused on short pauses for large heaps, this is especially true now, in the era of big data.  It attempts to improve the aspects of the CMS and G1 garbage collectors by providing a simultaneous heap compaction (plugging ‚Äúholes‚Äù immediately after assembling objects) and using alternative strategies to correct objects while the application continues to work.  It is undoubtedly worth exploring Shenandoah if you have a big heap and you need to keep the pauses to a minimum. <br><br>  <strong>- Is there a possibility of "fine" settings of the garbage collector?</strong>  <strong>How justified is the use of various garbage collectors (GC), and in what cases should this feature be used?</strong>  <strong>What can you say about CMS GC and G1 GC?</strong>  <strong>What kind of "tuning" can I use for tuning?</strong> <br><br>  It was interesting to watch as the Concurrent Mark-Sweep garbage collector slowly began to give way to the G1.  The first was a workhorse for many large JVM projects, despite the need to set up a bundle of non-obvious flags or to accept more frequent events of ‚Äúconcurrent mode failure‚Äù, leading to pauses in the system.  G1 has been steadily developing over the past few years, and now it seems to be a more popular option for big heap and short pauses.  That's a small recommendation, as I understand it, G1 is more tolerant of default settings.  Setting up the garbage collector is unlikely to ever go away, but it seems to me that the trend is to perform specific tasks by the garbage collector without undue user intervention. <br><br>  <strong>- We paid attention to such central topics as working with memory, compilers and garbage collectors.</strong>  <strong>Maybe we missed something, and Java has not become clearer to us?</strong>  <strong>What else is sure to tell, showing Java from the inside?</strong> <br><br>  It is interesting to know how the JVM itself works, with its code, JIT compilers, memory model and garbage collectors, but many of the most interesting parts of Java live in the middle layers.  Every Java developer must have a good knowledge of the bytecode JVM, from its initial structure to the moment it is executed by the virtual machine. <br><br>  I think most Java developers will want to know how invokedynamic (added in Java 7) enhances the capabilities of new languages ‚Äã‚Äãon the JVM and new Java features.  It is important to have a general understanding of the platform, even if you will never go deep into any layer. <br><br>  <strong>- Finally, I would like to know a little about the innovations awaiting us in version 9, such as JVMCI and graal.</strong> <br><br>  OpenJDK 9 will bring with it a new API called JVMCI.  Using this API, the JIT compiler used by the JVM to optimize code can be changed using the command line.  This option will be familiar to people who have ever moved to another GC, for those of us who remember the struggle with the ‚Äúserver‚Äù and ‚Äúclient‚Äù flags a few years ago.  This will allow you to explore JIT compilers, such as the new Graal (written in Java JIT compiler, ready to compete with its own HotSpot JIT), without reconfiguring the JVM.  Graal, in turn, is used to find new ways to implement high-performance languages ‚Äã‚Äãon the JVM, including a new Ruby implementation developed alongside the JRuby project.  Now is a very exciting time to be on the Java platform! <br><br>  <strong>- Thank you so much for the conversation.</strong> <br><br><hr><br>  On October 14 and 15 (Joker 2016 in a week!) Charles will make two hardcore presentations: keyout <a href="http://jokerconf.com/talks/from-java-to-assembly-down-the-rabbit-hole/">From Java to Assembly: Down the Rabbit Hole</a> and a talk <a href="http://jokerconf.com/talks/lets-talk-about-invokedynamic">Let's Talk About Invokedynamic</a> . <br><br>  In addition, if you like the ‚Äúguts‚Äù of the JVM just like us, then in addition to the reports of Charles Nutter, we recommend you to look at the following reports of Joker 2016: <br><br><ul><li>  <a href="http://jokerconf.com/talks/close-encounters-of-java-memory-model-kind/">Close JMM Degree Contacts</a> </li><li>  <a href="http://jokerconf.com/talks/java-on-elbrus/">Java on Elbrus</a> </li><li>  <a href="http://jokerconf.com/talks/hotspot-internals-safepoints-nullpointers-and-stackoverflows/">HotSpot Internals: Safepoints, NullPointers and StackOverflows</a> </li><li>  <a href="http://jokerconf.com/talks/native-code-off-heap-data-and-java/">Native code, off-heap data and java</a> </li><li>  <a href="http://jokerconf.com/talks/lifecycle-of-a-jit-compiled-code/">JIT code life cycle</a> </li><li>  <a href="http://jokerconf.com/talks/myths-and-facts-about-java-performance/">Myths and Facts about Slow Java</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/311660/">https://habr.com/ru/post/311660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311650/index.html">How we updated the contact center of a large bank in 2 months: migration without jambs (almost)</a></li>
<li><a href="../311652/index.html">The book "Distributed Algorithms. Intuitive approach "</a></li>
<li><a href="../311654/index.html">What should not forget the developer</a></li>
<li><a href="../311656/index.html">Layout of responsive emails: Problems and solutions</a></li>
<li><a href="../311658/index.html">Selection of a DBMS for a mobile Delphi application</a></li>
<li><a href="../311662/index.html">In the video - the developer of one of the blocks inside the Russian microprocessor Baikal-T</a></li>
<li><a href="../311664/index.html">The study states that CIOs enjoy greater business influence.</a></li>
<li><a href="../311666/index.html">NoSQL's layered approach to big data security</a></li>
<li><a href="../311670/index.html">Antiviruses for Android may not see the virus - study and "Laundry viruses"</a></li>
<li><a href="../311674/index.html">Passage of the quest from mail.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>