<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quadstor - a virtual SAN for state employees</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago, I came across an article ‚Äú50 tools for automating cloud infrastructure‚Äù which described the tools for working with virtualization an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quadstor - a virtual SAN for state employees</h1><div class="post__text post__text-html js-mediator-article">  About a year ago, I came across an article <a href="https://habrahabr.ru/company/it-grad/blog/281801/">‚Äú50 tools for automating cloud infrastructure‚Äù</a> which described the tools for working with virtualization and flashed a tool called Quadstor.  And recently, finally got around to this wonderful software, and now I want to tell a little about it, what it is and what it is eaten with! <br>  <b>Quadstor</b> is storage-based virtualization based on iSCSI.  <a href="http://quadstor.com/">quadstor.com</a> <br><br>  <b>And so that he can:</b> <br><br><ol><li>  Fiber Channel, iSCSI or local disk virtual disk support. </li><li>  Thin Disks (Thin Provisioning) </li><li>  Data deduplication </li><li>  High Availability </li><li>  VAAI Support (Hardware Acceleration) </li><li>  Cluster support for Windows server 2012, Hyper-V, VMware </li><li>  ZFS support </li><li>  And the most important thing is that it is free (well, support for money). </li><li>  The size of the virtual disk to 64TB. </li></ol><a name="habracut"></a><br>  Quadstor runs on Linux and supports RHEL / CentOS, SLES and Debian. <br>  The most interesting pieces are HA (High Availability), high availability (synchronous mirroring), it can be: Active-Active, Active-Pasive.  As well as support for <a href="http://blog.tsugliani.fr/vsphere/vmware-lab-storage-software-appliance-quadstor/">ZFS</a> , which is very convenient if you use a regular PC with multiple disks and without hardware RAID. <br>  Installing and configuring Quadstor is simple and does not require "dancing with tambourines." <br>  And now I will describe the installation and configuration of Quadstor using the example of OS CentOS 7. <br>  At the same time on the server a single disk or partition must be unformatted and not marked (raw). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Quadstor installation </h3><br>  Install packages for convenience and work: <br><br><pre><code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> &amp;&amp; yum <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> mc wget unzip bash-completion screen htop logwatch net-tools</code> </pre> <br>  Install the packages necessary for QUADStor to work: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> httpd gcc perl kernel-devel sg3_utils iotop sysstat lsscsi yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> fence-agents</code> </pre> <br>  Next, disable selinux.  Using vi nano or mc, open the file / etc / selinux / config <br>  and set SELINUX = disabled.  We do reboot.  Download QUADStor distribution.  At the moment, the latest version is 3.2.11, and install: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">wget</span></span> http://www.quadstor.com/virtentdub3z/quadstor-virt-3.2.11-rhel.x86_64.rpm rpm -i quadstor-virt-<span class="hljs-number"><span class="hljs-number">3</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">11</span></span>-rhel.x86_64.rpm</code> </pre> <br>  If everything went well, the installation process passes without errors, and if there is not enough package, then during the installation process there will be errors and the installer will indicate which packages are missing. <br><br>  QUADStor has a web interface and uses apache for this.  It does not need to be specifically configured, just install it in autoload and install ServerName.  Go to / etc / httpd / conf / and open the httpd.conf file.  Find the lines that start with ServerName and remove the sign (#) from the comment and change: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ServerName</span></span> localhost:<span class="hljs-number"><span class="hljs-number">80</span></span></code> </pre> <br>  If you want to set up authentication / authorization (SSL) for the QUADStor web interface, this is easy to do with the Apache web server.  And this setting can be easily found on the Internet or on the <a href="http://www.quadstor.com/support/62-accessing-webadmin.html">QUADStor</a> website. <br><br>  We start the quadstor and apache service and include them in autoload. <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> httpd systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> quadstor chkconfig httpd <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> chkconfig quadstor <span class="hljs-keyword"><span class="hljs-keyword">on</span></span></code> </pre> <br>  If you leave firewallD (CentOS 7) enabled, then you need to register the ports: <br><br><pre> <code class="hljs dos">firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">22</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">25</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">80</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">443</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">8090</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">8091</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">860</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">3260</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">3261</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9950</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9951</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9952</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9953</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9954</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9955</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --add-port=<span class="hljs-number"><span class="hljs-number">9956</span></span>/tcp firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --reload firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --list-all</code> </pre> <br><h3>  QUADStor Web Interface </h3><br>  Using the browser, go to the server at the ip address http: // &lt;address of the QUADStor&gt; <br>  The web interface is very simple and contains only 4 menu items: <br><br><img src="https://habrastorage.org/files/383/21b/6f3/38321b6f3247498da2c29489915dda49.png"><br><br>  <b>1. System</b> <br>  The point in which general information is: server name, QUADStor version, server status, restart button of the service and the system as a whole, as well as there is a button that allows you to generate a log of the QUADStor operation and save it to your PC. <br><br>  <b>2. Physical Storage</b> <br>  List of disks that can be added to the general pool of disks, as well as global statistics of disks: size, use of de-duplication, compression, etc. <br><br>  <b>3. Storage Pools</b> <br>  At this point we create a disk pool and give it a name, as well as the inclusion of logging and deduplication. <br><br>  <b>4. Virtual Disks</b> <br>  At this point, almost the basic settings of virtual disks are concentrated: create virtual disks and include them in the disk pool, enable / disable compression, deduplication, verification, as well as the High Availability setting and iSCSI settings. <br><br>  To create a virtual disk, first you need to create a disk pool.  Go to the menu item "Storage Pools", click "Add Pool". <br><br><img src="https://habrastorage.org/files/ebf/e74/612/ebfe746127dd436fb482dea1e632d852.png"><br><br>  Give the name of the disk pool (for example, HA) and tick the boxes next to ‚ÄúEnable Dedupe Metadata‚Äù and ‚ÄúEnable Logs‚Äù and click the ‚ÄúSubmit‚Äù button. <br><br><img src="https://habrastorage.org/files/d70/6fb/bca/d706fbbca85f485ab2a45a28d776467d.png"><br><br>  Next, go to the "Physical Storage" and on a free disk click the link "Add". <br><br><img src="https://habrastorage.org/files/d75/100/811/d751008118e348c6b1c6a3cfb0a02621.png"><br><br>  Select the name of the pool to which we want to bind a physical disk.  Put the checkboxes ‚ÄúLog Disk‚Äù (Enable log) and ‚ÄúHA Disk‚Äù (Enable HA). <br><br>  ‚ÄúEnable Compression‚Äù - enable data compression.  You can turn it on if you want to save space, but compression requires a powerful processor and a lot of RAM (min 4GB).  If there is a weak PC or server, then write / read will slow down. <br><br><img src="https://habrastorage.org/files/f72/565/3e0/f725653e06d94b889e81bfe212939a12.png"><br><br>  The last step is to create a virtual disk. <br><br>  Go to the "Virtual Disks" and click "Add Vdisk".  Set the name of the virtual disk (any - for example: HAVDisk).  Set the size of the disk in GB (but not more than the size of the physical disk).  Specify the pool in which we want to create a virtual disk.  And click "Submit". <br><br><img src="https://habrastorage.org/files/e9b/949/d71/e9b949d71c74495d90e7c3a670327cea.png"><br><br>  If you use only one node, the disk creation process is finished and now it can be connected to any iSCSI server. <br><br><h3>  Configure QUADStor High Availability </h3><br>  HA (High Availability) requires two physical or virtual servers with two network interfaces; some network interfaces look at a public or public network, while others are only linked together for synchronization. <br><br>  To configure the HA cluster, we make two nodes according to the instructions above.  We set up a separate network for the nodes so that there is synchronization. <br><br>  <i>Node1</i> <i><br></i>  <i>Name: vm-qs1</i> <i><br></i>  <i>lan1 - 10.5.113.207 - Shared Network (public network)</i> <i><br></i>  <i>lan2 - 192.168.0.1 - internal network (jumper between nodes)</i> <br><br>  <i>Node2</i> <i><br></i>  <i>Name: vm-qs2</i> <i><br></i>  <i>lan1 - 10.5.113.208 - Shared Network (public network)</i> <i><br></i>  <i>lan2 - 192.168.0.2 - internal network (jumper between nodes)</i> <br><br>  At the addresses 10.5.113.207 and 10.5.113.208 will be connected to the server via iscsi.  At addresses 192.168.0.1 and 192.168.0.2, synchronization of nodes is enabled. <br><br>  To enable synchronization, on each node we create the file /quadstor/etc/ndrecv.conf - we write in this file RecvAddr = 192.168.0.1 # For node1 <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">echo</span></span> <span class="hljs-string"><span class="hljs-string">"RecvAddr=192.168.0.1"</span></span> &gt; /quadstor/etc/ndrecv.conf</code> </pre> <br>  RecvAddr = 192.168.0.2 # For node2 <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">echo</span></span> <span class="hljs-string"><span class="hljs-string">"RecvAddr=192.168.0.2"</span></span> &gt; /quadstor/etc/ndrecv.conf</code> </pre> <br>  This means that we enable synchronization by ip address on the node.  Next, restart the quadstor service. <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> quadstor systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> quadstor</code> </pre> <br>  Now, using the browser, we go to one of the nodes (for example, vm-qs1) at 10.5.113.207 and create a virtual disk (as described above), and on the second node (ip-10.5.113.208) we create only ‚ÄúStorage Pools‚Äù and ‚ÄúPhysical Storage. "  All actions (names and settings) must exactly match the first node.  Creating a virtual disk on the second node is not necessary.  It is created automatically when mirroring is configured.  After that, on the first node, go to ‚ÄúVirtual Disks‚Äù and on the virtual disk click the ‚ÄúModify‚Äù link. <br><br><img src="https://habrastorage.org/files/077/65d/905/07765d90554641528b4ae22413656a67.png"><br><br>  And before us open all the settings of the virtual disk.  We can turn on / off: deduplication, compression and verification.  And we can also set up a login and password for the iSCSI client.  And most importantly, specify the second node for mirroring. <br><br>  In the line ‚ÄúMirror IP Address‚Äù we indicate the IP address of the second node 192.168.0.2 (IP address for synchronization) and click ‚ÄúSubmit‚Äù.  If everything is successful then we will see ‚ÄúMirror Address‚Äù, ‚ÄúSource Address‚Äù, ‚ÄúCurent Role‚Äù and ‚ÄúStatus‚Äù in the line. <br><br><img src="https://habrastorage.org/files/882/1af/9b8/8821af9b8a8644b19df021c90cda58bc.png"><br><br>  On the second node in ‚ÄúVirtual Disks‚Äù a virtual disk will be created automatically.  Click the ‚ÄúModify‚Äù link and there are the same settings as on the first node, but only vice versa. <br><br><img src="https://habrastorage.org/files/fab/9a3/e10/fab9a3e1027642e3acc7470f946adc9c.png"><br><br>  HA mirroring is configured and the disk can now be connected to servers at 10.5.113.207 and 10.5.113.208.  The client will need to configure the iSCSI multipath (support for multipath drives). <br><br>  Now it remains to make another important setting.  The fact is that if one of the nodes "falls", then the entire virtual disk on the client will fall off.  To prevent this from happening, you need to enable "ignore mirror drop" on the nodes.  First we go to the first node (vm-qs1) via ssh and give the command (as root) <br><br><pre> <code class="hljs">/quadstor/bin/qmirrorcheck -a -t ignore -r 192.168.0.2</code> </pre> <br>  Then we go to the second node (vm-qs2) via ssh and give the command (as root) <br><br><pre> <code class="hljs">/quadstor/bin/qmirrorcheck -a -t ignore -r 192.168.0.1</code> </pre> <br>  Now, the nodes will not control the ‚Äúfall‚Äù of each other, and if one of the nodes ‚Äúfalls‚Äù, the second will not turn off, but will take over the initiative of the virtual disk itself. <br>  To see the mode of operation, you can give a command. <br><br><pre> <code class="hljs">/quadstor/bin/qsync -l</code> </pre> <br><img src="https://habrastorage.org/files/c27/653/f37/c27653f372d14d9f9ae502d022da84ad.png"><br><br>  As soon as the "fallen" node is restored, data synchronization will begin and this can be seen with the help of the command <br><br><pre> <code class="hljs">/quadstor/bin/qsync -l</code> </pre> <br>  That's probably all.  In the next post I will try to compare the speed of Quadstor HA and StarWind HA. </div><p>Source: <a href="https://habr.com/ru/post/323114/">https://habr.com/ru/post/323114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323102/index.html">Another way to localize applications</a></li>
<li><a href="../323106/index.html">Accelerate Node.js with Rust</a></li>
<li><a href="../323108/index.html">Two providers simultaneously or Dual ISP with VRF on Cisco | Part 2</a></li>
<li><a href="../323110/index.html">Protect a remote terminal server or two-factor authentication of RDG clients using Azure MFA</a></li>
<li><a href="../323112/index.html">OSSEC note on configuring parsers (decoders)</a></li>
<li><a href="../323116/index.html">Solving Winter CrackMe Problems</a></li>
<li><a href="../323118/index.html">We put networks - we catch robots</a></li>
<li><a href="../323120/index.html">Rust game development. My history</a></li>
<li><a href="../323122/index.html">"The Cure for the Disease": automatic programming</a></li>
<li><a href="../323124/index.html">We make internal development as a software asset in five steps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>