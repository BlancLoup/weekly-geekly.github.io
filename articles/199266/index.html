<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Runtime-generating .Net code for those who have no time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The .Net infrastructure contains built-in code generation (On-the-Fly Code Generation). This allows the .Net program to compile the text written in an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Runtime-generating .Net code for those who have no time</h1><div class="post__text post__text-html js-mediator-article"> The .Net infrastructure contains built-in code generation (On-the-Fly Code Generation).  This allows the .Net program to compile the text written in any programming language and execute the resulting code at the time of its execution itself (without the participation of the programmer).  It would be logical to expect that the simplest method of the corresponding class is provided for the implementation of these actions in the standard .Net library.  But unfortunately it is not.  Microsoft, having done a tremendous way of embedding code generation tools on .Net, did not take the very last step towards the simplest needs of programmers.  So you have to do this step yourself. <br><br>  The simplest means offered by Microsoft for solving the described task is the CSharpCodeProvider class, which is included in the .Net standard library.  Using this class is not a very difficult task, but nevertheless it would be useful to have a tool that turns the use of code generated on the fly into a trivial task. <br><a name="habracut"></a><br><br>  The result is a small set of classes, of which <code>Tech.DynamicCoding.CodeGenerator</code> is <code>Tech.DynamicCoding.CodeGenerator</code> .  Let's begin its description with the simplest example of use.  (Texts of the library and examples are in the <a href="">archive</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Generating the simplest code </h4><br>  Suppose you need to calculate the value of a numeric expression given in text form.  For example, here is such a "12345678 * 9 + 9".  In this case, you just need to write the following: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = CodeGenerator.ExecuteCode&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"return 12345678 * 9 + 9;"</span></span>);</code> </pre><br>  At first, you create a fragment of C # code and pass it as a parameter to the <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code></code> method <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code></code> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <pre> <code class="hljs pgsql"><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">9876543.21</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">-0.01</span></span>)); var result2 = CodeGenerator.ExecuteCode&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;("return a * b + c;", CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("a", <span class="hljs-number"><span class="hljs-number">12345678.9</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("b", <span class="hljs-number"><span class="hljs-number">8</span></span>), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("c", <span class="hljs-number"><span class="hljs-number">0.9</span></span>));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime)), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("Duration", typeof(<span class="hljs-type"><span class="hljs-type">int</span></span>))); var result1 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-01-01"), <span class="hljs-number"><span class="hljs-number">256</span></span>); var result2 = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("2013-10-13"), <span class="hljs-number"><span class="hljs-number">131</span></span>);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("StartDate", typeof(DateTime))); var result = code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, @"System.IO.File.Delete(filePath);", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> CodeParameter("filePath", typeof(string))); code.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AirConditioner : MarshalByRefObject { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Working { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> struct Climate { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AirConditioner(); var limate = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Climate { Temperature = <span class="hljs-number"><span class="hljs-number">28</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (var sandbox = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(sandbox, VB.Compiler, controlAlgorithm, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Unit", unit), CodeParameter.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>("Climate", limate)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(unit, limate); Thread.Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>); limate.Temperature += unit.Working ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [<span class="hljs-keyword"><span class="hljs-keyword">Serializable</span></span>]. <br> <br>     <br>          . <br> <br> <span class="hljs-number"><span class="hljs-number">1.</span></span>       #-          <code><span class="hljs-keyword"><span class="hljs-keyword">System</span></span></code> ,     ,  .   C#       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span><span class="hljs-string"><span class="hljs-string">'.       .     ,       ,          .        . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,          ,      .      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> 3.           C#.       .        VB.Net.              . (        .) </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string">  ,   ,     .  </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string">       .            . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,           .   , ,    -,       .  ,  -             (plugin modules). </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         . ,     .          ,       . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> ,     ,            ,           . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://habrahabr.ru/post/67431/"><span class="hljs-string"><span class="hljs-string">    C#</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html"><span class="hljs-string"><span class="hljs-string">    </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"><span class="hljs-string"><span class="hljs-string"> C#  " "</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href=""><span class="hljs-string"><span class="hljs-string"> </span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://www.csscript.net/index.html"><span class="hljs-string"><span class="hljs-string">CS-Script - The C# Script Engine</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx"><span class="hljs-string"><span class="hljs-string">Security and On-the-Fly Code Generation</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx"><span class="hljs-string"><span class="hljs-string">How to: Run Partially Trusted Code in a Sandbox</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf"><span class="hljs-string"><span class="hljs-string">Metaprogramming in .NET. EBook</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><a href="http://ask.make-money-article.com/que/1593920"><span class="hljs-string"><span class="hljs-string">Debugging a generated .NET assembly from within the application that generated it</span></span></a></code> </pre> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h4> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> <h5> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </h5> <code><code>CodeGenerator.ExecuteCode.        - .  ,        .  ?  ? <br> <br>     <br>       .   " ",   " "  ExecuteCode</code> .   ,        ,  ,     ,   .    ,           ,        ,    .     ,      ,     ,      ,    . <br> <br>    ,       .            . <br> <br> <code class="cs"> var result = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 9876543.21), CodeParameter.Create("b", 9), CodeParameter.Create("c", -0.01)); var result2 = CodeGenerator.ExecuteCode&lt;double&gt;("return a * b + c;", CodeParameter.Create("a", 12345678.9), CodeParameter.Create("b", 8), CodeParameter.Create("c", 0.9));</code> <br>   ,    ,    .  ExecuteCode ,       ,     .   C#-,   ,       ,        ExecuteCode  . <br> <br>     <br>         .   ,         . <br> <br> <code class="cs"> var code = CodeGenerator.CreateCode&lt;DateTime&gt;( "return StartDate.AddDays(Duration);", new CodeParameter("StartDate", typeof(DateTime)), new CodeParameter("Duration", typeof(int))); var result1 = code.Execute(DateTime.Parse("2013-01-01"), 256); var result2 = code.Execute(DateTime.Parse("2013-10-13"), 131);</code> <br>          .        C#-,   ,    .              .           . <br> <br>        .     . <br> <br>  .  ,          ,         .   ,     -     .  ,           .         ,   . <br> <br>   -  .          ,     .           (,       ).        ,         . <br> <br>      <br>    ,      (AppDomain)       -   "" (sandbox).    ,           . ,          ,   . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, "return (int)(DateTime.Now - StartDate).TotalDays;", new CodeParameter("StartDate", typeof(DateTime))); var result = code.Execute(DateTime.Parse("1962-09-17")); }</code> <br>      <code>Sandbox</code> ,   AppDomain.          .      . <br> <br>       <br>  ,   ,  .     -     . <br> <br> <code class="cs"> using (var sandbox = new Sandbox()) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(@"c:\temp\a.txt"); // SecurityException }</code> <br>    ,        .    . <br> <br> <code class="cs"> const string FILE_PATH = @"c:\temp\a.txt"; using (var sandbox = new Sandbox( new FileIOPermission(FileIOPermissionAccess.AllAccess, FILE_PATH))) { var code = CodeGenerator.CreateCode&lt;int&gt;(sandbox, @"System.IO.File.Delete(filePath);", new CodeParameter("filePath", typeof(string))); code.Execute(FILE_PATH); }</code> <br> <br>       ,    <br>          .      ,         .    , ..         . <br> <br>   ,            .          ,   MarshalByRefObject.     .Net Remoting,    . <br> <br>           .        : <br> <br> <code class="cs"> public class AirConditioner : MarshalByRefObject { public bool Working { get; set; } } [Serializable] public struct Climate { public double Temperature { get; set; } }</code> <br>      ,      / ,      . <br> <br> <code class="cs"> const string controlAlgorithm = @" IF Climate.Temperature &gt; 26 THEN Unit.Working = TRUE IF Climate.Temperature &lt; 22 THEN Unit.Working = FALSE"; var unit = new AirConditioner(); var limate = new Climate { Temperature = 28 }; using (var sandbox = new Sandbox()) { var controlCode = CodeGenerator.CreateCode&lt;int&gt;(sandbox, VB.Compiler, controlAlgorithm, null, null, CodeParameter.Create("Unit", unit), CodeParameter.Create("Climate", limate)); while (!Console.KeyAvailable) { Console.WriteLine("t={0}¬∞C", limate.Temperature); controlCode.Execute(unit, limate); Thread.Sleep(300); limate.Temperature += unit.Working ? -1 : 1; } }</code> <br> ,     ,        MarshalByRefObject,    Climate     [Serializable]. <br> <br>     <br>          . <br> <br> 1.       #-          <code>System</code> ,     ,  .   C#       using'.       .     ,       ,          .        . <br> <br> 2.             System.dll  mscorlib.dll,    .     ,      .     ,      . <br> <br> ,          ,      .      . <br> <br> 3.           C#.       .        VB.Net.              . (        .) <br> <br>  <br>  ,   ,     .  <a href=""> </a>       .            . <br> <br> ,           .   , ,    -,       .  ,  -             (plugin modules). <br> <br>         . ,     .          ,       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/e5a/ecb/22d/e5aecb22d69f9d1a09504df1ff52885d.png"> <br> <br> ,     ,            ,           . <br> <br>     <br> <a href="http://habrahabr.ru/post/67431/">    C#</a> <br> <a href="http://www.cyberguru.ru/microsoft-net/net-framework/dotnet-dynamic-code-compilation-page2.html">    </a> <br> <a href="http://yrevotyuk.blogspot.ru/2013/03/in-flight-csharp.html"> C#  " "</a> <br> <a href=""> </a> <br> <a href="http://www.csscript.net/index.html">CS-Script - The C# Script Engine</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/x222e4ce.aspx">Security and On-the-Fly Code Generation</a> <br> <a href="http://msdn.microsoft.com/ru-ru/library/bb763046.aspx">How to: Run Partially Trusted Code in a Sandbox</a> <br> <a href="http://dl.e-book-free.com/2013/07/metaprogramming_in_.net.pdf">Metaprogramming in .NET. EBook</a> <br> <a href="http://ask.make-money-article.com/que/1593920">Debugging a generated .NET assembly from within the application that generated it</a></code> </div><p>Source: <a href="https://habr.com/ru/post/199266/">https://habr.com/ru/post/199266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199252/index.html">Attention! Competition! We develop instant messenger Vkontakte for Tizen</a></li>
<li><a href="../199254/index.html">Given the ever-increasing number of camcorders</a></li>
<li><a href="../199256/index.html">Motion planning: visibility graph, road maps</a></li>
<li><a href="../199258/index.html">Barcode Android Recognition</a></li>
<li><a href="../199264/index.html">Uzbeks and IT</a></li>
<li><a href="../199268/index.html">How I did multilanguage on Codeigniter</a></li>
<li><a href="../199270/index.html">Blink Scroll lock'om with incoming email message (perl + bash)</a></li>
<li><a href="../199272/index.html">Is meditation another way to motivate, or why does Google provide rooms for them?</a></li>
<li><a href="../199278/index.html">System of selling computer and video games with distributed cost</a></li>
<li><a href="../199280/index.html">Re: Developer Interview (Alternative / Addition)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>