<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do FortiASIC ‚Äã‚Äãprocessors work?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a world leader in high-performance information security solutions, in terms of performance, Fortinet relies on the FortiOS operating system in conj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do FortiASIC ‚Äã‚Äãprocessors work?</h1><div class="post__text post__text-html js-mediator-article"> As a world leader in high-performance information security solutions, in terms of performance, Fortinet relies on the <b>FortiOS</b> operating system in conjunction with <b>FortiASIC</b> , which is a specialized chipset, processors accelerating content analysis and processing network traffic of its own design.  In this article, the work of these processors will be described in detail.  We will explain how they speed up packet processing / analysis. <br><br><img src="https://habrastorage.org/files/5c1/760/988/5c176098850c4b68b7c5f5b9d876e2b4.jpg"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>FortiASIC</b> <br><br>  Most FortiGate models have FortiASIC ‚Äã‚Äã(Application Specific Integrated Circuit) hardware acceleration to handle traffic and reduce latency, which offloads the main processor (CPU). <br><br>  - Network processors (NPs) - for processing network traffic <br>  - Content processors (CPs) - for security features <br>  - System-on-a-Chip Processor (SOC2) - for joint operation of security features and traffic processing <br><br>  For performance, Fortinet divides its FortiGate line into three categories: <br><br>  - Entry Level (Desktop) <br>  - Mid-Range <br>  - High-End <br><br>  In each of the categories, different CPUs and FortiASICs are used, as well as a different number of them. <br><br>  <b>Network processors</b> <br><br>  NP network processors operate at the interface level to speed up traffic by offloading traffic from the main processor.  Current models contain NP4 and NP6.  Older FortiGate models include NP1 (also known as FortiAccel or FA2) and NP2. <br><br><img src="https://habrastorage.org/files/d73/28b/b49/d7328bb4956345a788d0136c2b6605dd.jpg"><br><br>  At the moment, NP6 processors are the latest development and can offload the following traffic and services: <br><br>  - IPv4 and IPv6 traffic, NAT64 and NAT46 traffic <br>  - Link aggregation (LAG) (IEEE 802.3ad) traffic <br>  - TCP, UDP, ICMP and SCTP <br>  - IPsec VPN traffic, as well as IPsec encryption / decryption (including SHA2-256 and SHA 2-512) <br>  - Unencrypted IPsec traffic <br>  - IPS based on anomalies, checksum offload and packet fragmentation <br>  - SIT and IPv6 Tuning session <br>  - Multicast traffic (including Multicast inside IPsec) <br>  - CAPWAP traffic <br>  - Shaping traffic and queuing by priority <br>  - Syn proxying <br>  - Traffic passing through the Inter-VDOM link <br>  - IPS <br>  - Application Control <br>  - CASI <br>  - Flow-based antivirus <br>  - Flow-based web filtering <br><br>  NP does not support downloading modified content at the application level, which means that sessions are not unloaded if the following security features are enabled in the policy: <br><br>  - proxy-based virus scanning <br>  - proxy-based web filtering <br>  - DNS filtering <br>  - DLP <br>  - Anti-Spam <br>  - VoIP <br>  - ICAP <br>  - Web Application Firewall <br>  - Proxy options <br><br>  <b>Content processors</b> <br><br>  CP content processors operate at the system level with tasks defined by the CPU.  New FortiGate models (2000E, 2500E, 6040E) contain CP9.  The older versions are CP4, CP5, CP6, and the current FortiGate models use the CP8. <br><br>  CP8 can unload the following tasks: <br><br>  - Flow-based inspection IPS, Application Control, Cloud Access Security Inspection (CASI), Web Filtering, DLP, and Antivirus <br>  - High performance VPN bulk data engine <br>  - IPsec and SSL / TLS protocol processor <br>  - DES / 3DES / AES in accordance with FIPS46-3 / FIPS81 / FIPS197 <br>  - ARC4 in compliance with RC4 <br>  - MD5 / SHA-1 / SHA256 with RFC1321 and FIPS180 <br>  - HMAC in accordance with RFC2104 / 2403/2404 and FIPS198 <br>  - Key Exchange Processor support high performance IKE and RSA computation <br>  - Public key exponentiation engine with hardware CRT support <br>  - Primarily checking for RSA key generation <br>  - Handshake accelerator with automatic key material generation <br>  - Random Number generator compliance with ANSI X9.31 <br>  - Sub public key engine (PKCE) to support up to 4096 bit operation directly <br>  - Message authentication module offers high performance cryptographic engine for calculating SHA256 / SHA1 / MD5 data bytes (used by many applications) <br>  - PCI express Gen 2 four lanes interface <br>  - Cascade Interface for chip expansion <br><br>  <b>System-on-a-Chip Processor</b> <br><br>  SOC processors are used in the lower Entry Level category (Desktop).  The purpose of the SoC-architecture is to combine several processors in a single chip, simplifying the overall hardware design.  SOC combines CP, NP, RISC-based CPU processors. <br><br>  Currently, SOC version 2 is relevant, which offloads the traffic described in the NP and CP section. <br><br><img src="https://habrastorage.org/files/eb7/cf0/5ad/eb7cf05adb75481ab655c8284fb2b8b7.jpg"><br>  <i>SOC Architecture</i> <br><br>  <b>Offloading</b> <br><br>  The process of unloading the session occurs in several stages.  The first batch of each new session always goes to the CPU.  If the NP supports the requested security features that must be performed, the CPU sends out instructions to the NP that it can handle this session.  All subsequent packets for the ‚Äúfast path‚Äù session are redirected to NP.  Finally, after the last TCP packet, ‚ÄúFIN‚Äù (finish) or ‚ÄúRST‚Äù (reset) NP returns the session to the CPU to close the session.  Otherwise, if the NP does not support the requested security functions that are required to be processed, all packets in this session should work out the CPU. <br><br><img src="https://habrastorage.org/files/d7c/1da/e6a/d7c1dae6a2e54f6a8ac07b5715352356.jpg"><br>  <i>Package Path in Session Unloading</i> <br><br><img src="https://habrastorage.org/files/6e3/905/545/6e390554562946de8e7f5facddfa26eb.jpg"><br>  <i>The path of the first packet in the unloaded session</i> <br><br><img src="https://habrastorage.org/files/847/b31/292/847b312929bd46e7aa5f516287f18713.jpg"><br>  <i>Path of subsequent packets in an unloaded session</i> <br><br>  FortiGate High-End models with two or more NP6s are physically connected together through an Integrated Switch Fabric (ISF), which allows communication between all interfaces and NP6 processors, bypassing the central processor.  Thus, traffic is unloaded, even if the input and output port belongs to more than one NP processor. <br><br><img src="https://habrastorage.org/files/0fd/cd8/2ab/0fdcd82abcb240539135419a2f838bb8.jpg"><br>  <i>Integrated switch fabric</i> <br><br>  <b>NTurbo-acceleration</b> <br><br>  The NTurbo acceleration functionality allows you to offload UTM / NGFW sessions that pass through the NP processor. <br><br>  Thanks to NTurbo, a special ‚Äúdata channel‚Äù is created to redirect traffic from NP to IPS and back.  Unloading Steps: <br><br>  1.NP accepts the packet and performs the required actions; <br>  1.1If the packet is encrypted, the packet is transmitted to the CP by the processor; <br>  1.2Decoding with CP; <br>  1.3CP transmits NP data to the processor; <br>  2. For flow-based UTM / NGFW inspections, NP creates a data transmission channel with an IPS engine (worked out on the CPU) and transmits data to it; <br>  3.IPS-engine transfers the data inspection task to the CP for its acceleration; <br>  4.CP returns the IPS data to the engine; <br>  5.IPS-engine returns NP data to the processor; <br>  6.If the data has been decrypted, it is transmitted to the CP for encryption; <br>  7. Produce encryption using CP; <br>  8.CP transfers NP data to the processor; <br>  9.NP processor transmits a packet of CPU. <br><br>  NTurbo support NP4 and NP6. <br><br><img src="https://habrastorage.org/files/4b0/7d4/460/4b07d446052a479384c168ad5622db8c.jpg"><br>  <i>NTurbo session with IPSA offload</i> <br><br>  <b>IPSA acceleration</b> <br><br>  IPSA technology offloads ‚Äúpattern matching‚Äù extensions for flow-based UTM / NGFW checks, the technology is available in NTurbo and standard firewall sessions.  IPSA support CP7, CP8 and CP9. <br><br>  <b>IPsec Encryption / Decryption</b> <br><br>  If the IPsec tunnel uses encryption and hashing algorithms supported by the NP network processor, then IPsec user data processing can be unloaded to improve performance.  In this case, the NP will only decrypt the traffic, and the CP will encrypt. <br><br><img src="https://habrastorage.org/files/fd5/bb6/27b/fd5bb627b0da425c9d73d7eacc8722ae.jpg"><br>  <i>IPsec Encryption / Decryption</i> <br><br>  <b>Accelerated Flow-based and Proxy-based Inspection with CP</b> <br><br>  Flow-based UTM / NGFW Inspection identifies and blocks real-time security threats by sampling packets in a session using a single-pass architecture that includes Direct Filter Approach (DFA) pattern matching to identify possible attacks or threats. <br><br>  Before testing, the IPS engine can be applied using a series of decoders to determine the appropriate security modules that will be used depending on the packet protocol and policy settings.  In addition, SSL packets will also be decrypted.  SSL decryptions are unloaded and accelerated by the CP8 or CP9 processors. <br><br>  The use of security modules (IPS, Application Control, CASI, flow-based Web Filtering, flow-based DLP filtering) occurs simultaneously in a single approach and is accelerated by the CP8 and CP9 processors.  CASI signatures are applied in the Application Control portion of the check.  Flow-based Antivirus caches files during protocol decoding, and then scans them.  If it was an SSL packet, at the end of the check it is encrypted and, accordingly, the CP8 and CP9 processors speed up the process. <br><br><img src="https://habrastorage.org/files/5b9/736/2c1/5b97362c153546928a59359904c5bed5.jpg"><br>  <i>Stages of flow-based inspection</i> <br><br>  Proxy-based UTM / NGFW inspection retrieves and caches files for further verification. <br><br>  Initially, packets get into the IPS engine and pass flow-based inspection with security functions that work only in this mode (single-pass IPS, Application Control and CASI) and, accordingly, traffic is accelerated using CP8 and CP9.  After that, the packets go to the FortiOS Proxy-server to check the security function in proxy-based mode.  First, the proxy detects the SSL traffic.  SSL packets will be decrypted using CP8 or CP9 and sent back to the IPS engine to re-examine the flow-based security functions (single-pass IPS, Application Control and CASI) of the decrypted traffic.  Then the traffic goes to the Proxy-server, where proxy-based security features are used.  The inspection takes place in the following order: <br><br>  ‚Ä¢ VoIP inspection <br>  ‚Ä¢ DLP <br>  ‚Ä¢ AntiSpam <br>  ‚Ä¢ Web Filtering <br>  ‚Ä¢ Antivirus <br>  ‚Ä¢ ICAP <br><br>  After checking the decryption, the SSL traffic is encrypted.  If no threat is found, the proxy server sends the file to its destination.  If the threat is found, the proxy server can block the file and in response send a message about the reason for blocking. <br><br><img src="https://habrastorage.org/files/714/3d8/54c/7143d854c7564792b51b9fac6dab8952.jpg"><br>  <i>Proxy-based inspection steps</i> </div><p>Source: <a href="https://habr.com/ru/post/305954/">https://habr.com/ru/post/305954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305940/index.html">Archiving as an answer to the ‚ÄúSpring package‚Äù</a></li>
<li><a href="../305944/index.html">Tale about a peasant, or how to change dusty "aglitskie" chipset coders</a></li>
<li><a href="../305948/index.html">Mobile UX-Design: How to correctly request user permissions</a></li>
<li><a href="../305950/index.html">The use of cloud technologies in stock trading - features and prospects</a></li>
<li><a href="../305952/index.html">Usability Testing: Do you want to know the truth about your users?</a></li>
<li><a href="../305956/index.html">Yandex.Toloka. How people help teach machine intelligence</a></li>
<li><a href="../305960/index.html">Control Flow Guard. The principle of work and workarounds on the example of Adobe Flash Player</a></li>
<li><a href="../305964/index.html">Optimization of image processing using GPU on the example of Median filtering</a></li>
<li><a href="../305966/index.html">Teach practical security: Summer internship at Positive Technologies</a></li>
<li><a href="../305968/index.html">.NET conference DotNext 2016 Moscow, December 9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>