<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From the ugly duckling to the swan, or how to fix the curved code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is it about? 
 Many are starting to write a project to work with one small task, without implying that this story will lead to a multi-user contr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From the ugly duckling to the swan, or how to fix the curved code</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a80/ada/1ec/a80ada1ec9c8b9ffd7f6541d987e1a40.jpg" alt="image"><br><br><h2>  What is it about? </h2><br>  Many are starting to write a project to work with one small task, without implying that this story will lead to a multi-user control system, well, let's say, content or save, production.  And everything seems to be cool and cool, everything works until you begin to understand that the code that is written consists entirely of crutches and hardcodes. <a name="habracut"></a>  An urgent problem arises: when adding a new feature, you have to mess around with this code for a very long time, remembering ‚Äúwhat was written there?‚Äù And curse yourself in the past.  In particular, this article is intended for novice developers who need refactoring at the first stage is not obvious, but today they are in an unpleasant situation. <br><br>  For example, at the entrance we have a hard code with layout, queries, crutches, which sometimes can not be read. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  How it helps </h2><br>  What will the system gain as a result of refactoring? <br>  - Structured and modular code. <br>  - Separation of UI and logic. <br>  - Ability to write UNIT tests. <br>  - The ability to write APIs only for applications authorized in the API. <br>  - A simpler approach to transfer to another database. <br><br>  A particular example of the case "how to do it and where to start?".  I propose to deal with such corrections consistently, and at the same time, without completing the second stage, do not begin to take on the third.  We will fix the code in the working system; it is better to write functional tests in advance in order to understand that everything works as it should. <br><br><h2>  Stages </h2><br>  1. <i><b>Algorithmic approach</b></i> . <br>  Let's look at our horrible source code with a layout that cannot be tested (and probably repeats in other places).  Simple and straightforward, but the sequence of such a code generates a bunch of known troubles. <br><br>  index.php <br><pre><code class="php hljs">&lt;h1&gt;&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> $DB = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DBConnector; $DB-&gt;query(<span class="hljs-string"><span class="hljs-string">'SELECT * FROM users LIMIT 10'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($DB-&gt;get_num_rows()){ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($user = $DB-&gt;fetch_row()){ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;'</span></span>.$user[<span class="hljs-string"><span class="hljs-string">'name'</span></span>].<span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;'</span></span>; } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br>  2. <i><b>Procedural approach</b></i> . <br>  Why not write a function and call it in other places of this system?  The transition to procedural programming will help to reduce the code, although with the example of 1 call - it looks worse. <br><br>  functions.php <br><pre> <code class="php hljs">$DB = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DBConnector <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $DB; $DB-&gt;query(<span class="hljs-string"><span class="hljs-string">'SELECT * FROM users LIMIT 10'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($DB-&gt;get_num_rows()){ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($user[] = $DB-&gt;fetch_row()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $users; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  index.php <br><pre> <code class="php hljs">&lt;h1&gt;&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'functions.php'</span></span>; $users = GetUsers(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;'</span></span>.$u.<span class="hljs-string"><span class="hljs-string">'&lt;/p&gt;'</span></span>; } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Comment: <i>Already better.</i>  <i>If you translate all requests to such a view, then you‚Äôll get a list of some functions.php working with some module.</i>  <i>Thus, the model is already separated from the UI and each function can be tested, as well as a sequence of calls to such functions.</i> <br><br>  3. <i><b>Object-oriented approach</b></i> . <br>  Why do I need to connect all the functions in the system, if it is enough to work only with the necessary set of functionality?  For example, on the simple user list page - there is no need to connect the entire list of functions, such as, for example, a task, or a project.  Why not create a class for working with a module, from which the object of working only with this module will be created?  You can build the architecture in such a way that the inheritance of functions of the same parameters of the Get (add / edit) methods will simply be inherited from some kind of superclass that generates classes of working with modules.  Also, there is a possibility that it will not always be necessary to refer to the database for any functionality, so it means that we will be able to connect to it in general. <br><br>  Let's write a basic abstract superclass that will connect to the database and have a method for getting a list of some records.  From it we inherit the class of work with users, create an object and get records. <br><br>  BaseClass.php <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseClass</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $dataBase; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $moduleName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;dataBase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DBConnector; } <span class="hljs-comment"><span class="hljs-comment">//        function Get($limit=10){ $DB-&gt;query('SELECT * FROM '.$this-&gt;moduleName.' LIMIT '.$limit); if($DB-&gt;get_num_rows()){ while($user[] = $DB-&gt;fetch_row()); return $users; } else { return array(); } } }</span></span></code> </pre> <br><br>  UserClass.php <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'BaseClass.php'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserClass</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extend</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseClass</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::construct(<span class="hljs-string"><span class="hljs-string">'users'</span></span>); } }</code> </pre><br><br>  index.php <br><pre> <code class="php hljs">&lt;h1&gt;&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'UserClass.php'</span></span>; $users = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserClass; $users = $users-&gt;get(); <span class="hljs-comment"><span class="hljs-comment">//  foreach($users as $u) { echo '&lt;p&gt;'.$u.'&lt;/p&gt;'; } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  Comment: <i>Even better, though a lot of code, right?</i>  <i>The fact is that these two classes are the first step to writing an API.</i>  <i>Why is that?</i>  <i>The fact is that requests through the RESTFull API are made to the address and very often there are module names.</i>  <i>Depending on the address, you can connect any class (or connect a ClassLoader, since they are a pond now) and call the set of functions that this user is allowed (you can insert a rights or role handler, but this is another story).</i> <br><br><h2>  Salt </h2><br>  The essence of the article is that refactoring is almost <u>always possible and often necessary</u> even in the most hopeless situation.  Everyone loves beautiful code, but often there is no time to write it and this is undoubtedly a bad practice. <br><br>  In this case, there are 3 stages, as a result of which, the system will receive a distinction between UI and application logic.  This will allow you to prepare your system, which is overloaded with curved code, for the possibility of writing Unit tests, writing a RESTfull API, and to a sense of self-satisfaction for the work done.  For many, this, of course, may be obvious, but when asked to write a third-party application, or to provide an API, sometimes you have to blush. <br><br>  PS: I will be glad to any comments and, possibly, links to other methods and solutions for a problem of a similar nature. </div><p>Source: <a href="https://habr.com/ru/post/147416/">https://habr.com/ru/post/147416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147408/index.html">Some poorly known rules of thumb</a></li>
<li><a href="../147409/index.html">Samsung Galaxy S III Review</a></li>
<li><a href="../147412/index.html">Sony Xperia U Review</a></li>
<li><a href="../147414/index.html">Your favorite web server control panel?</a></li>
<li><a href="../147415/index.html">Do not kill: mailing for the online store</a></li>
<li><a href="../147417/index.html">A little Eclipse Juno setting: getting rid of huge tabs and tab closing buttons</a></li>
<li><a href="../147419/index.html">How we placed the IFrame application in four social networks (moderation pitfalls)</a></li>
<li><a href="../147421/index.html">‚ÄúRunet today‚Äù, July 9, 2012. Experts of the issue: Yuri Virovets, Pavel Rogozhin</a></li>
<li><a href="../147422/index.html">If hackers did not exist, the government would have to invent them</a></li>
<li><a href="../147423/index.html">135 launches of space shuttles in one video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>