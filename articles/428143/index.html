<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Approach to RBAC implementation in ReactJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Hello dear reader! 

 Some time (about a year) I was faced with the need for conditional rendering of components in ReactJS, depending ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Approach to RBAC implementation in ReactJS</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br>  Hello dear reader! <br><br>  Some time (about a year) I was faced with the need for conditional rendering of components in ReactJS, depending on the current user rights.  The first thing I began to look for ready-made solutions and "best practices."  The article " <a href="https://hackernoon.com/role-based-authorization-in-react-c70bb7641db4">Role based authorization in React</a> " made the most of its impressions with its use of the <a href="https://reactjs.org/docs/higher-order-components.html">Higher-Order Components</a> (HOC).  But, unfortunately, I did not find a solution that satisfies me. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Apparently, I missed something after all ...</b> <div class="spoiler_text">  ... or did not know about the existence of contexts.  At the time of this writing, I stumbled upon a wonderful <a href="https://stackoverflow.com/questions/42567575/hide-some-react-component-children-depending-on-user-role/47579290">answer in stackoverflow</a> .  I ended up with a very similar solution. <br></div></div><br>  At that time, I was a little familiar with ‚Äúreact-redux-connect‚Äù (npm-module), and I was strongly hooked on the decoration approach used in the connect function.  A detailed analysis of the connect device can be found <a href="https://medium.com/devschacht/jakob-lind-code-your-own-redux-part-2-the-connect-function-d941dc247c58">here</a> . <br><br><h3>  Solution Description </h3><br>  First you need to determine what minimum information is needed to make a decision about the component rendering.  Obviously, for drawing it is necessary to fulfill some condition (as an option, the presence of some right - for example, the right to add a new user).  Call this condition a <b>requirement</b> (or requirement in English).  We can understand whether the requirement has been satisfied, based on <b>the current set of</b> user <b>rights</b> - <b>credentials</b> .  That is, it is enough to define a function: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSatisfied</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">requirement, credentials</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (...) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Now we have more or less decided on the rendering condition.  How to use it? <br><br>  1. We can use the approach in the forehead: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> requirement = {...}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {credentials} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isSatisfied(requirement, credentials) &amp;&amp; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TargetComponent</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; } }</span></span></code> </pre><br>  2. We can go a little further, and wrap the target component in another, which will do the verification of the requirement: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> requirement = {...}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProtectedTargetComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {credentials} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( isSatisfied(requirement, credentials) ? <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TargetComponent</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">}&gt;</span></span></span><span class="xml"> {this.props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TargetComponent</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {credentials} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ProtectedTargetComponent</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span></span>; } }</code> </pre><br>  Manually writing a wrapper for each target component is rather a chore.  How can this be simplified? <br><br>  3. We can resort to the HOC mechanism (by analogy with the connect from ‚Äúreact-redux-connect‚Äù): <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">protect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">requirement, WrappedComponent</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { credentials } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( isSatisfied(requirement, credentials) ? <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">WrappedComponent</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">}&gt;</span></span></span><span class="xml"> {this.props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">WrappedComponent</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); } } } ... const requireAdmin = {...}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AdminButton = protect(requireAdmin, Button); ... class App extends Component { render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {credentials} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( ... &lt;AdminButton credentials={credentials}&gt; Add user &lt;<span class="hljs-regexp"><span class="hljs-regexp">/AdminButton&gt; ... ); } }</span></span></code> </pre><br>  Already better, but still poor - you need to send credentials through the entire tree of components with your hands.  What can be done with this?  It is logical to assume that the current user's credentials is a global object for the entire application.  Then ‚Äúreact-redux-connect‚Äù comes again.  After reading the article about the device of this module, we find that it uses some ReactJS <a href="https://reactjs.org/docs/context.html">contexts</a> . <br><br>  4. Using the context mechanism, we get the final approach: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Provider, Consumer } = React.createContext(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">protect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">requirement, WrappedComponent</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Consumer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> { credentials =&gt; isSatisfied(requirement, credentials) ? </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">WrappedComponent</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">}&gt;</span></span></span><span class="xml"> {this.props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">WrappedComponent</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> : null } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Consumer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } } ... const requireAdmin = {...}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AdminButton = protect(requireAdmin, Button); ... class App extends Component { render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { credentials } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{credentials}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AdminButton</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Add user </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AdminButton</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } }</code> </pre><br><h3>  Afterword </h3><br>  It was a brief insight into the idea itself.  On the basis of this idea, a module was implemented ( <a href="https://github.com/nurzhan-saktaganov/react-rbac-guard">github</a> , <a href="https://www.npmjs.com/package/react-rbac-guard">npm</a> ), which provides more interesting features and is easier to embed (see README.md in githubs and <a href="https://codesandbox.io/s/znmxlw59jm">demos</a> using the module). <br><br>  Only for some reason I could not get the package created by npm in the demo, so I had to insert the module code itself there.  But the module installed via <b>npm install react-rbac-guard</b> works locally (Chrome 69.0.3497.100).  I suspect that the problem is in the build method - I just copied the package.json and webpack.config.prod.js files from a <a href="https://github.com/brainhubeu/react-permissible">module</a> with the same purpose. <br><br>  Since I am not a front-end developer, there is still a lot of unfinished (lack of tests, inoperability in <a href="https://codesandbox.io/">https://codesandbox.io</a> and, possibly, other lost moments).  Therefore, if there are comments, suggestions or pull-requests, then welcome! <br><br>  PPS: All comments on spelling, including in README.md, please send in private messages or in the form of a pull-request. </div><p>Source: <a href="https://habr.com/ru/post/428143/">https://habr.com/ru/post/428143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428131/index.html">The whole truth about the RTOS. Article # 17. Event flag groups: introduction and basic services</a></li>
<li><a href="../428133/index.html">Hasura. High-Performance GraphQL to SQL Server Architecture</a></li>
<li><a href="../428135/index.html">How to configure or disable lint in the built-in code editor</a></li>
<li><a href="../428137/index.html">Olympiad, idea competition, lectures on IT project management and film screenings: 10 upcoming events at ITMO University</a></li>
<li><a href="../428141/index.html">Backend for the frontend, or How in Yandex.Market create an API without crutches</a></li>
<li><a href="../428147/index.html">Script collector quotes and recognition of text from video to Python</a></li>
<li><a href="../428149/index.html">Your new ally in the sky Mavic 2 Enterprise</a></li>
<li><a href="../428151/index.html">Express performance review of PostgreSQL 10.5 in the latest cloud services of Yandex. Oblak</a></li>
<li><a href="../428155/index.html">Speed ‚Äã‚Äãlimit for electric vehicles</a></li>
<li><a href="../428159/index.html">Tableau from the teapot or visualization of the analysis of PAMM accounts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>