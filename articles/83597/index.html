<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>mod_rewrite - just about complicated</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What it is? 
 mod_rewrite is an Apache web server module for URL conversion. The module uses in its work rules that can be described both in the serve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>mod_rewrite - just about complicated</h1><div class="post__text post__text-html js-mediator-article"><h4>  What it is? </h4><br>  mod_rewrite is an Apache web server module for URL conversion.  The module uses in its work rules that can be described both in the server configuration (httpd.conf) and in the .htaccess files directly in the file structure of your site.  Rules are described as <a href="http://ru.wikipedia.org/wiki/PCRE">PCRE</a> regular expressions. <br><br><h4>  Hello world </h4><br>  The simplest example.  Suppose you want no one to know that your site is written in PHP and decide to mask file extensions.  You can, of course, make the appropriate directive in the Apache configuration and then all files with the extension ".msl" ("My Super Language") will be processed by the PHP interpreter.  But you can do it easier: <br>  create a .htaccess file in the root of our site with the following content <br> <code>RewriteEngine On <br> RewriteBase / <br> RewriteRule ^(.*)\.msl$ $1.php [QSA,L]</code> <br> <br>  The first directive includes the mod_rewrite mechanism in the current folder and in all its subfolders.  The second indicates to the mod_rewrite module that the current folder in the file system corresponds to the site root.  The third is the URL translation rule itself. <br><br>  You can read it like this: <br>  <i>If immediately after the beginning of the line ("^") there is an arbitrary number of any characters ("(. *)"), And we want to remember what kind of characters these are, surrounding them with brackets, then a dot ("\.") Goes (we screen point, because a single point is just any character), then the characters ‚Äúmsl‚Äù and the line ends ("$"), then we replace the original URL with the following: take the first memorized substring in brackets from the rule, add to it ". php ", add all additional address parameters that could be" [QSA] "and finish this, we will not use further</i>  <i>mation if they are "[L]"</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Everything, now you can safely change all links ending in ".php" to ".msl" and write on your blog that you have invented a new scripting language.  Apache, having encountered a link to ‚Äúindex.msl‚Äù using mod_rewrite on the fly, converts it into ‚Äúindex.php‚Äù and invokes the necessary script. <br><br><h4>  And what else mod_rewrite can do? </h4><br><a name="habracut"></a>  Oh, this module can do a lot.  Personally, I‚Äôm waiting for someone sufficiently advanced in magic and PCRE to write Sea Battle on mod_rewrite. <br><br>  But so far this has not happened, I will show a few more options for using this wonderful module. <br><br>  Suppose you decide to write a blog engine.  Each user will be able to create his own blog, choose a name for it, write to his blog and read other people's posts. <br><br><h5>  Primary data filtering </h5><br>  Suppose that user blog addresses will look like "/ blogs / ABC /", and the script that will show the tape of a particular blog is called "viewblog.php". <br>  A simple mod_rewirte rule will allow us to weed out incorrect blog names that attackers can use: <br> <code>RewriteRule blogs/([a-z0-9_-]+)([\/]{0,1})$ viewblog.php?blogname=$1 [L] <br> RewriteRule viewblog.php - [F]</code> <br> <br>  In square brackets, in accordance with the PCRE syntax, we define a class of characters, including numbers, Latin letters, minus and underscore characters.  All addresses in which there will be some other characters will not be tested by this rule and will result in error 404. The [L] flag is required so that the mod_rewrite engine, having successfully completed the conversion, does not go further to the second rule.  This flag is similar to the break statement inside the loop. <br><br>  The second rule does not directly specify the address translation (the "-" symbol), but prohibits direct access to the viewblog.php script (the "[F]" flag), thereby preventing the villains from transmitting something malicious in the parameters. <br><br>  <i>By the way:</i> <i><br></i>  <i>It will be a good idea to start your rules from the line</i> <i><br> <code>RewriteRule .htaccess - [F]</code> <br></i>  <i>This will prevent access to the .htaccess file in case of a badly configured hosting service.</i> <i><br></i> <br><br><h5>  Use for caching in FS </h5><br>  Suppose your project grows.  Hosting stops coping with loads - hundreds of bloggers, tens of thousands of views of their blogs, and even comments ... <br><br>  And here mod_rewrite can come to the rescue, if for some reason you do not want to go to your server. <br><br>  First, modify your viewblog.php script so that when accessing it, it not only renders the generated page to the browser, but also writes it to the file system at /blogs/ABC.html <br><br>  The easiest way to do this is by using the buffering control functions.  Suppose that the source code of the viewblog.php script looks like this: <br> <code>&lt;?php <br> $blogname = $_GET['blogname']; <br> if ( !Blogs::exists($blogname) ) <br> die("No blog!"); <br> <br> Blogs::display($blogname); <br> ?&gt;</code> <br> <br>  Apply output buffering and write the output to a file. <br> <code>&lt;?php <br> $blogname = $_GET['blogname']; <br> if ( !Blogs::exists($blogname) ) <br> die("No blog!"); <br> <br> ob_start(); <br> Blogs::display($blogname); <br> $content = ob_get_contents(); <br> ob_end_flush(); <br> <br> $f = fopen(_YOUR_SITE_ROOT . "/blogs/" . $blogname . ".html", "w"); <br> fwrite($f, $content); <br> fclose($f); <br> ?&gt;</code> <br> <br>  Now it remains only to slightly modify your rules in .htaccess to get a full-fledged content caching system: <br><br> <code>RewriteRule blogs\/([a-z0-9_-]+)([\/]{0,1})$ blogs\/$1\.html <br> <br> RewriteCond %{REQUEST_FILENAME} blogs\/([a-z0-9_-]+)\.html$ <br> RewriteCond %{REQUEST_FILENAME} !-s <br> RewriteRule (.*) viewblog.php?blogname=%1</code> <br> <br>  In the first line, we convert the URLs of the type blogs / ABC / to blogs / ABC.html, thus redirecting Apache to the page cache file generated by us. <br>  The next three lines represent one big rule.  If there is a request for blogs / ABC.html and there is no such file in the file system, the request is redirected to the script viewblog.php <br><br>  Thus, we can only provide a system for timely cleaning of the cache and the problem is solved. <br><br><h4>  Other uses </h4><br>  Personally, I use the mod_rewrite module similarly to the last example for generating and storing image previews in FS. <br><br>  It is very easy using mod_rewrite to map subdomains to folders, for example forum.localhost.localdomain will be physically located in localhost.localdomain / forum, which is often easier for the application developer. <br><br>  Irreplaceable mod_rewrite to restrict file downloads on file hosting or in a digital goods store (you have to use the symbolic link mechanism) or to ban hotlinking (by checking the referrer). <br><br>  In general, this is Voodoo :) <br>  Damn interesting Voodoo, allowing every day to discover new aspects and applications. <br><br><h4>  What else to read? </h4><br>  <a href="httpd.apache.org/docs/2.2/mod/mod_rewrite.html">httpd.apache.org/docs/2.2/mod/mod_rewrite.html</a> <br>  <a href="http://www.codenet.ru/webmast/php/mod_rewrite.php">www.codenet.ru/webmast/php/mod_rewrite.php</a> <br>  <a href="http://www.egoroff.spb.ru/portfolio/apache/mod_rewrite.html">www.egoroff.spb.ru/portfolio/apache/mod_rewrite.html</a> <br>  <a href="http://regexp.ru/">regexp.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/83597/">https://habr.com/ru/post/83597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83588/index.html">Introducing the Arduino, part 2. Morse keyboard: alpha version</a></li>
<li><a href="../83590/index.html">Old methods for new sources. Nowhere call</a></li>
<li><a href="../83592/index.html">Its minimal grid CSS framework. What should be in it?</a></li>
<li><a href="../83595/index.html">Conference Cloudconf-2010. Let's talk about the "clouds"?</a></li>
<li><a href="../83596/index.html">The most accurate watches in the world</a></li>
<li><a href="../83598/index.html">Why Photoshop</a></li>
<li><a href="../83599/index.html">Floppy painting</a></li>
<li><a href="../83600/index.html">Wearable Robot - little "big brother"</a></li>
<li><a href="../83601/index.html">Setting up a hardware decoder HD video Broadcom CrystalHD BCM70012 in conjunction with XBMC on Ubuntu Karmic 9.10</a></li>
<li><a href="../83602/index.html">Start-up tournament Harvest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>