<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Text VGA module on VHDL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will introduce a text VGA module written in VHDL. This module can be useful when debugging a board, and takes up relatively little s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Text VGA module on VHDL</h1><div class="post__text post__text-html js-mediator-article">  In this article I will introduce a text VGA module written in VHDL.  This module can be useful when debugging a board, and takes up relatively little space. <br><br><h2>  General characteristics </h2><br>  The module operates at a clock frequency of 50 MHz. <br>  Produces a picture with a resolution of 640x480 with a frequency of 60Hz. <br>  The character size is 8x16 dots.  On the screen 8025 characters. <br>  The palette is 32 colors. <br><br>  Resources occupied in FPGA: <br><img src="https://habrastorage.org/storage1/3f8178a2/36fbced0/376c6e20/6e5a894e.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h2>  Implementation </h2><br><br>  The module interface includes a clock generator input (clk), an output to the VGA connector (r, g, b, vsync, hsync) and an output to the processor bus (addr, data, iowr, dout).  On the board with which I worked, there are 8-bit DACs in the amount of three pieces (one for each color), so 8-bit lines of colors come from the module.  Taking the most significant bit of color, we get a working version for boards without a DAC. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/baaf62ec/f7447963/67c01a2a/261a36ef.gif"></div><br><blockquote>  <font color="#000080">entity</font> vga_text <font color="#000080">is</font> <br>  <font color="#000080">Port</font> <font color="#000066">(</font> clk <font color="#000066">:</font> <font color="#000080">in</font> <font color="#0000ff">STD_LOGIC</font> <font color="#000066">;</font> <br>  iowr <font color="#000066">:</font> <font color="#000080">in</font> <font color="#0000ff">STD_LOGIC</font> <font color="#000066">;</font> <br>  addr <font color="#000066">:</font> <font color="#000080">in</font> <font color="#0000ff">STD_LOGIC_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">31</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  data <font color="#000066">:</font> <font color="#000080">in</font> <font color="#0000ff">STD_LOGIC_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">31</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  dout <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">std_logic_vector</font> <font color="#000066">(</font> <font color="#ff0000">31</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  r <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">STD_LOGIC_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  g <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">STD_LOGIC_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  b <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">STD_LOGIC_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  vga_blank <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">STD_LOGIC</font> <font color="#000066">;</font> <br>  vsync <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">STD_LOGIC</font> <font color="#000066">;</font> <br>  hsync <font color="#000066">:</font> <font color="#000080">out</font> <font color="#0000ff">STD_LOGIC</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> vga_text <font color="#000066">;</font> </blockquote><br><br>  The monitor requires 3 synchronization signals and 3 color signals.  To generate synchronization signals, VCounter and HCounter counters are used.  Synchronization signals are issued at the moments shown in the diagram. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/5e829276/402922ce/2d50ccee/c69db43a.gif"></div><br>  Counter code: <br><blockquote>  <font color="#000080">architecture</font> Behavioral <font color="#000080">of</font> vga_text <font color="#000080">is</font> <br><br>  <font color="#000080">signal</font> VCounter <font color="#000066">:</font> <font color="#0000ff">integer</font> <font color="#000080">range</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">520</font> <font color="#000066">: =</font> <font color="#ff0000">0</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> HCounter <font color="#000066">:</font> <font color="#0000ff">integer</font> <font color="#000080">range</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">800</font> <font color="#000066">: =</font> <font color="#ff0000">0</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> div <font color="#000066">:</font> <font color="#0000ff">std_logic</font> <font color="#000066">: =</font> ' <font color="#ff0000">0</font> ' <font color="#000066">;</font> <br><br>  <font color="#000080">begin</font> <br><br>  <font color="#000080">process</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <br>  <font color="#000080">begin</font> <br>  <font color="#000080">if</font> <font color="#000080">rising_edge</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <font color="#000080">then</font> <br>  div <font color="#000066">&lt;=</font> <font color="#000080">not</font> <font color="#000066">(</font> div <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">if</font> div <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">then</font> <br>  <font color="#000080">if</font> HCounter <font color="#000066">=</font> <font color="#ff0000">799</font> <font color="#000080">then</font> <br>  HCounter <font color="#000066">&lt;=</font> <font color="#ff0000">0</font> <font color="#000066">;</font> <br>  <font color="#000080">if</font> VCounter <font color="#000066">=</font> <font color="#ff0000">520</font> <font color="#000080">then</font> <br>  VCounter <font color="#000066">&lt;=</font> <font color="#ff0000">0</font> <font color="#000066">;</font> <br>  <font color="#000080">else</font> <br>  VCounter <font color="#000066">&lt;=</font> VCounter + <font color="#ff0000">1</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">else</font> <br>  HCounter <font color="#000066">&lt;=</font> HCounter + <font color="#ff0000">1</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">process</font> <font color="#000066">;</font> <br><br>  <font color="#000080">end</font> behavioral <font color="#000066">;</font> </blockquote><br>  Formation of synchronization signals: <br><blockquote>  vsync <font color="#000066">&lt;=</font> ' <font color="#ff0000">0</font> ' <font color="#000080">when</font> VCounter <font color="#000066">&lt;</font> <font color="#ff0000">2</font> <font color="#000080">else</font> ' <font color="#ff0000">1</font> ' <font color="#000066">;</font> <br>  hsync <font color="#000066">&lt;=</font> ' <font color="#ff0000">0</font> ' <font color="#000080">when</font> HCounter <font color="#000066">&lt;</font> <font color="#ff0000">96</font> <font color="#000080">else</font> ' <font color="#ff0000">1</font> ' <font color="#000066">;</font> <br>  vga_blank <font color="#000066">&lt;=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">when</font> <font color="#000066">(</font> <font color="#000066">(</font> HCounter <font color="#000066">&gt;</font> <font color="#ff0000">143</font> <font color="#000066">)</font> <font color="#000080">and</font> <font color="#000066">(</font> HCounter <font color="#000066">&lt;</font> <font color="#ff0000">784</font> <font color="#000066">)</font> <font color="#000080">and</font> <br>  <font color="#000066">(</font> VCounter <font color="#000066">&gt;</font> <font color="#ff0000">30</font> <font color="#000066">)</font> <font color="#000080">and</font> <font color="#000066">(</font> VCounter <font color="#000066">&lt;</font> <font color="#ff0000">511</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000080">else</font> ' <font color="#ff0000">0</font> ' <font color="#000066">;</font> </blockquote><br>  The size of one character is 8x16 dots.  The array of characters will be 256 cells of 128 bits each.  Each bit is responsible for whether there is a point in the current position or not.  The location of the points in the memory cell: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/9498049c/f96cf0c0/97368a7d/bd0d8596.gif"></div><br><br>  In FPGA there is a block memory configuration of 1024x18 bits (18432 bits), which we will be guided by.  CAD automatically implements almost any selected configuration using such memory blocks.  So, for the memory of symbols, 256 √ó 128 bits = 32768 bits of memory are needed, which will take 2 memory blocks (BRAM). <br>  The symbol memory is initialized during design and can be changed during operation. <br><br>  Another necessary memory is the screen (visible area) memory.  In this memory, we encode the symbol number, symbol color and background color.  To save color memory encode number in the palette.  Based on the configuration of the memory with a cell of 18 bits, we will take the symbol number to 8 bits, the color of the symbol is 5 bits, and the background color will also be 5 bits.  Under the palette allocated 32 cells of 24 bits (8 bits per color). <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/51cccdf9/84a1ac60/6d711cba/273b5d4d.gif"></div><br><br>  Based on the resolution and size of the character, the screen fits 80x30 characters.  But it takes 2400 cells in memory (3 memory blocks).  Since, from the very beginning, the task of the minimum size of this module was posed, 5 bottom lines were cut out.  As a result, we get 80x25 displayed characters, which takes 2000 memory cells (2 memory blocks). <br><br>  Symbols are generated in the coregenerator.  The memory is connected to the module as follows: <br><blockquote>  <font color="#000080">signal</font> SAddrA <font color="#000066">:</font> <font color="#0000ff">std_logic_vector</font> <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> SAddrRead, SAddrWrite <font color="#000066">:</font> <font color="#0000ff">integer</font> <font color="#000080">range</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">255</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> SDataA, SDinA <font color="#000066">:</font> <font color="#0000ff">std_logic_vector</font> <font color="#000066">(</font> <font color="#ff0000">127</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> SWeA <font color="#000066">:</font> <font color="#0000ff">std_logic</font> <font color="#000066">;</font> <br>  <font color="#008000">- ...</font> <br>  <font color="#000080">component</font> vga640_symbols <br>  <font color="#000080">port</font> <font color="#000066">(</font> <br>  addr <font color="#000066">:</font> <font color="#000080">IN</font> <font color="#0000ff">std_logic_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  clk <font color="#000066">:</font> <font color="#000080">IN</font> <font color="#0000ff">std_logic</font> <font color="#000066">;</font> <br>  din <font color="#000066">:</font> <font color="#000080">IN</font> <font color="#0000ff">std_logic_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">127</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  dout <font color="#000066">:</font> <font color="#000080">OUT</font> <font color="#0000ff">std_logic_VECTOR</font> <font color="#000066">(</font> <font color="#ff0000">127</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  we <font color="#000066">:</font> <font color="#000080">IN</font> <font color="#0000ff">std_logic</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">component</font> <font color="#000066">;</font> <br>  <font color="#008000">- ...</font> <br>  <font color="#000080">begin</font> <br>  <font color="#008000">- ...</font> <br>  vga640_symbols_0 <font color="#000066">:</font> vga640_symbols <br>  <font color="#000080">Port</font> <font color="#000080">map</font> <font color="#000066">(</font> <br>  addr <font color="#000066">=&gt;</font> SAddrA, <br>  clk <font color="#000066">=&gt;</font> clk, <br>  din <font color="#000066">=&gt;</font> NewSymbol, <br>  dout <font color="#000066">=&gt;</font> SDataA, <br>  we <font color="#000066">=&gt;</font> SWeA <br>  <font color="#000066">)</font> <font color="#000066">;</font> <br>  SWeA <font color="#000066">&lt;=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">when</font> <font color="#000066">(</font> isLowLevel <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">and</font> <font color="#000066">(</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">337</font> <font color="#000080">and</font> iowr <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">else</font> ' <font color="#ff0000">0</font> ' <font color="#000066">;</font> <br>  SAddrA <font color="#000066">&lt;=</font> conv_std_logic_vector <font color="#000066">(</font> SAddrWrite, <font color="#ff0000">8</font> <font color="#000066">)</font> <font color="#000080">when</font> <font color="#000066">(</font> isLowLevel <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">and</font> <font color="#000066">(</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">337</font> <font color="#000080">and</font> iowr <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">else</font> conv_std_logic_vector <font color="#000066">(</font> SAddrRead, <font color="#ff0000">8</font> <font color="#000066">)</font> <font color="#000066">;</font> </blockquote><br><br>  Screen memory is created by writing template code (although you can do the same as with character memory). <br><blockquote>  <font color="#000080">type</font> TScreen <font color="#000080">is</font> array <font color="#000066">(</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">1999</font> <font color="#000066">)</font> <font color="#000080">of</font> <font color="#0000ff">std_logic_vector</font> <font color="#000066">(</font> <font color="#ff0000">17</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> Screen <font color="#000066">:</font> TScreen <font color="#000066">;</font> <br>  <font color="#000080">signal</font> scrAddrA, scrAddrB <font color="#000066">:</font> <font color="#0000ff">integer</font> <font color="#000080">range</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">1999</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> scrDataA, scrDataB, scrDinB <font color="#000066">:</font> <font color="#0000ff">std_logic_vector</font> <font color="#000066">(</font> <font color="#ff0000">17</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> scrWeB <font color="#000066">:</font> <font color="#0000ff">std_logic</font> <font color="#000066">;</font> <br>  <font color="#008000">- ...</font> <br>  <font color="#000080">begin</font> <br>  <font color="#008000">- ...</font> <br>  <font color="#000080">process</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <br>  <font color="#000080">begin</font> <br>  <font color="#000080">if</font> <font color="#000080">rising_edge</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <font color="#000080">then</font> <br>  <font color="#000080">if</font> scrWeB <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">then</font> <br>  Screen <font color="#000066">(</font> scrAddrB <font color="#000066">)</font> <font color="#000066">&lt;=</font> scrDinB <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  scrDataA <font color="#000066">&lt;=</font> Screen <font color="#000066">(</font> scrAddrA <font color="#000066">)</font> <font color="#000066">;</font> <br>  scrDataB <font color="#000066">&lt;=</font> Screen <font color="#000066">(</font> scrAddrB <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">process</font> <font color="#000066">;</font> <br><br>  scrDinB <font color="#000066">&lt;=</font> scrDinBLowLevel <font color="#000080">when</font> isLowLevel <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">else</font> scrDinBNormal <font color="#000066">;</font> <br>  scrWeb <font color="#000066">&lt;=</font> scrWeBLowLevel <font color="#000080">when</font> isLowLevel <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">else</font> scrWebNormal <font color="#000066">;</font> <br>  scrAddrB <font color="#000066">&lt;=</font> scrAddrBLowLevel <font color="#000080">when</font> isLowLevel <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">else</font> scrAddrBNormal <font color="#000066">;</font> <br><br>  scrDinBLowLevel <font color="#000066">&lt;=</font> data <font color="#000066">(</font> <font color="#ff0000">17</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  scrWeBLowLevel <font color="#000066">&lt;=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">when</font> <font color="#000066">(</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">300</font> <font color="#000080">or</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">309</font> <font color="#000066">)</font> <font color="#000080">and</font> iowr <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">else</font> ' <font color="#ff0000">0</font> ' <font color="#000066">;</font> <br><br>  scrAddrBNormal <font color="#000066">&lt;=</font> GotoY * <font color="#ff0000">80</font> + GotoX <font color="#000066">;</font> <br>  scrDiNBNormal <font color="#000066">&lt;=</font> BgColor &amp; Color &amp; data <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  scrWebNormal <font color="#000066">&lt;=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">when</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">306</font> <font color="#000080">and</font> iowr <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">else</font> ' <font color="#ff0000">0</font> ' <font color="#000066">;</font> </blockquote><br><br>  You also need to set the color table of the palette, which is carried out as follows. <br><blockquote>  <font color="#000080">type</font> TColor <font color="#000080">is</font> array <font color="#000066">(</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">31</font> <font color="#000066">)</font> <font color="#000080">of</font> <font color="#0000ff">std_logic_vector</font> <font color="#000066">(</font> <font color="#ff0000">23</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> PalleteColor <font color="#000066">:</font> TColor <font color="#000066">: =</font> <br>  <font color="#000066">(</font> <br>  <font color="#ff0000">0</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"000000"</font> , <br>  <font color="#ff0000">1</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"0000FF"</font> , <br>  <font color="#ff0000">2</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"00FF00"</font> , <br>  <font color="#ff0000">3</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"00FFFF"</font> , <br>  <font color="#ff0000">4</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"FF0000"</font> , <br>  <font color="#ff0000">5</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"FF00FF"</font> , <br>  <font color="#ff0000">6</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"FFFF00"</font> , <br>  <font color="#ff0000">7</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"FFFFFF"</font> , <br>  <font color="#000080">others</font> <font color="#000066">=&gt;</font> x <font color="#7f007f">"FFFFFF"</font> <br>  <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">signal</font> PalleteAddr <font color="#000066">:</font> <font color="#0000ff">integer</font> <font color="#000080">range</font> <font color="#ff0000">0</font> <font color="#000080">to</font> <font color="#ff0000">31</font> <font color="#000066">;</font> </blockquote><br><br>  All the necessary memory is formed, now you can do the implementation of the preparation of the pixel for display on the screen. <br>  Current FPGA design trends imply fully synchronous designs.  We will not deviate from these trends, and will implement to prepare the next pixel pipeline.  At the entrance there will be counters HCount and VCount, which determine the current position on the screen, and at the output - the color of the pixel that needs to be output. <br><br>  Stages conveyor: <br><ol><li>  Calculation of signals scrX, scrY, determining the position in the visible part of the screen. </li><li>  Calculation of the signals defining the cell in the memory of the screen with the required symbol <br>  textX = scrX / 8 <br>  textY = scrY / 16 <br>  Calculation of the signals that determine the desired pixel in the symbol <br>  SymbolX = scrX mod 8 - 1 <br>  SymbolY = scrY mod 16 <br>  where mod is the remainder of the division. </li><li>  Calculation of addresses on signals X, Y. </li><li>  Getting the current character. </li><li>  Getting the current pixel and the formation of color. </li></ol><br><blockquote>  <font color="#000080">process</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <br>  <font color="#000080">begin</font> <br>  <font color="#000080">if</font> <font color="#000080">rising_edge</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <font color="#000080">then</font> <br>  <font color="#000080">if</font> div <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">then</font> <br>  <font color="#008000">-- one</font> <br>  scrX <font color="#000066">&lt;=</font> conv_std_logic_vector <font color="#000066">(</font> HCounter - <font color="#ff0000">139</font> , <font color="#ff0000">10</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  scrY <font color="#000066">&lt;=</font> conv_std_logic_vector <font color="#000066">(</font> VCounter - <font color="#ff0000">70</font> , <font color="#ff0000">10</font> <font color="#000066">)</font> <font color="#000066">;</font> <br><br>  <font color="#008000">- 2</font> <br>  textX <font color="#000066">&lt;=</font> conv_integer <font color="#000066">(</font> scrX <font color="#000066">(</font> <font color="#ff0000">9</font> <font color="#000080">downto</font> <font color="#ff0000">3</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  textY <font color="#000066">&lt;=</font> conv_integer <font color="#000066">(</font> scrY <font color="#000066">(</font> <font color="#ff0000">9</font> <font color="#000080">downto</font> <font color="#ff0000">4</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  SymbolX <font color="#000066">&lt;=</font> scrX <font color="#000066">(</font> <font color="#ff0000">2</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> - <font color="#ff0000">1</font> <font color="#000066">;</font> <br>  SymbolY <font color="#000066">&lt;=</font> scrY <font color="#000066">(</font> <font color="#ff0000">3</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">;</font> <br><br>  <font color="#008000">- 3</font> <br>  scrAddrA <font color="#000066">&lt;=</font> textY * <font color="#ff0000">80</font> + textX <font color="#000066">;</font> <br>  SymbolPoint <font color="#000066">&lt;=</font> conv_integer <font color="#000066">(</font> SymbolY <font color="#000066">)</font> * <font color="#ff0000">8</font> + <font color="#ff0000">7</font> - conv_integer <font color="#000066">(</font> SymbolX <font color="#000066">)</font> <font color="#000066">;</font> <br><br>  <font color="#008000">-- four</font> <br>  SAddrRead <font color="#000066">&lt;=</font> conv_integer <font color="#000066">(</font> scrDataA <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  scrData <font color="#000066">&lt;=</font> scrDataA <font color="#000066">;</font> <br><br>  <font color="#008000">-- five</font> <br>  <font color="#000080">if</font> <font color="#000066">(</font> VCounter <font color="#000066">&gt;</font> <font color="#ff0000">69</font> <font color="#000066">)</font> <font color="#000080">and</font> <font color="#000066">(</font> VCounter <font color="#000066">&lt;</font> <font color="#ff0000">470</font> <font color="#000066">)</font> <font color="#000080">then</font> <br>  <font color="#000080">if</font> SDataA <font color="#000066">(</font> SymbolPoint <font color="#000066">)</font> <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">then</font> <br>  curColor <font color="#000066">&lt;=</font> PalleteColor <font color="#000066">(</font> conv_integer <font color="#000066">(</font> scrData <font color="#000066">(</font> <font color="#ff0000">12</font> <font color="#000080">downto</font> <font color="#ff0000">8</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">else</font> <br>  curColor <font color="#000066">&lt;=</font> PalleteColor <font color="#000066">(</font> conv_integer <font color="#000066">(</font> scrData <font color="#000066">(</font> <font color="#ff0000">17</font> <font color="#000080">downto</font> <font color="#ff0000">13</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">else</font> <br>  curColor <font color="#000066">&lt;=</font> x <font color="#7f007f">"000000"</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">process</font> <font color="#000066">;</font> <br><br>  b <font color="#000066">&lt;=</font> curColor <font color="#000066">(</font> <font color="#ff0000">23</font> <font color="#000080">downto</font> <font color="#ff0000">16</font> <font color="#000066">)</font> <font color="#000080">when</font> <font color="#000066">(</font> vga_blank <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">else</font> <font color="#7f007f">"00000000"</font> <font color="#000066">;</font> <br>  g <font color="#000066">&lt;=</font> curColor <font color="#000066">(</font> <font color="#ff0000">15</font> <font color="#000080">downto</font> <font color="#ff0000">8</font> <font color="#000066">)</font> <font color="#000080">when</font> <font color="#000066">(</font> vga_blank <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">else</font> <font color="#7f007f">"00000000"</font> <font color="#000066">;</font> <br>  r <font color="#000066">&lt;=</font> curColor <font color="#000066">(</font> <font color="#ff0000">7</font> <font color="#000080">downto</font> <font color="#ff0000">0</font> <font color="#000066">)</font> <font color="#000080">when</font> <font color="#000066">(</font> vga_blank <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000066">)</font> <font color="#000080">else</font> <font color="#7f007f">"00000000"</font> <font color="#000066">;</font> </blockquote><br><br>  We will work with the module via the bus with the interface <br><ul><li>  Addr (32 bit) - address </li><li>  Data (32 bit) - data </li><li>  Iowr (1 bit) - write (OUTPORT) </li><li>  Dout (32 bit) - response data (INPORT) </li></ul><br><br>  The bus is controlled by a <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D1%2582_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">fort</a> processor, implemented on the same FPGA.  At the OUTPORT command, the Addr lines are set, Data and the Iowr line rises to ‚Äú1‚Äù for one clock cycle.  At the INPORT command, the processor exposes the Addr line and retrieves data from the Dout line. <br>  Bus operation example: <br><blockquote>  <font color="#000080">process</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <br>  <font color="#000080">begin</font> <br>  <font color="#000080">if</font> <font color="#000080">rising_edge</font> <font color="#000066">(</font> clk <font color="#000066">)</font> <font color="#000080">then</font> <br>  <font color="#008000">- setting the cursor to position X (GOTOX)</font> <br>  <font color="#000080">if</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">302</font> <font color="#000080">and</font> iowr <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">then</font> <br>  <font color="#000080">if</font> conv_integer <font color="#000066">(</font> data <font color="#000066">)</font> <font color="#000066">&gt;</font> <font color="#ff0000">79</font> <font color="#000080">then</font> <br>  GotoX <font color="#000066">&lt;=</font> <font color="#ff0000">0</font> <font color="#000066">;</font> <br>  <font color="#000080">else</font> <br>  GotoX <font color="#000066">&lt;=</font> conv_integer <font color="#000066">(</font> data <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br><br>  <font color="#008000">- set the cursor to the Y position (GOTOY)</font> <br>  <font color="#000080">if</font> conv_integer <font color="#000066">(</font> addr <font color="#000066">)</font> <font color="#000066">=</font> <font color="#ff0000">303</font> <font color="#000080">and</font> iowr <font color="#000066">=</font> ' <font color="#ff0000">1</font> ' <font color="#000080">then</font> <br>  <font color="#000080">if</font> conv_integer <font color="#000066">(</font> data <font color="#000066">)</font> <font color="#000066">&gt;</font> <font color="#ff0000">24</font> <font color="#000080">then</font> <br>  GotoY <font color="#000066">&lt;=</font> <font color="#ff0000">0</font> <font color="#000066">;</font> <br>  <font color="#000080">else</font> <br>  GotoY <font color="#000066">&lt;=</font> conv_integer <font color="#000066">(</font> data <font color="#000066">)</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">if</font> <font color="#000066">;</font> <br>  <font color="#000080">end</font> <font color="#000080">process</font> <font color="#000066">;</font> </blockquote><br><br>  In the same way, most of the commands for working with the module are implemented. <br><br>  Full listing of the module is available here. <br>  <a href="http://pastebin.com/BYs3SN1j">Module listing</a> <br>  <a href="http://pastebin.com/LtDfi8kb">To initialize character memory</a> <br><br>  UPD: <br>  <b>Basic functions</b> <br>  300 - write / read from screen memory <br>  301 - address to write to the screen memory <br><br>  302 - set the X coordinate of the carriage (GotoX) <br>  303 - Set the carriage coordinate (gotoY) <br>  304 - set the color of the symbol (SetColor) <br>  305 - set the background color (SetBgColor) <br>  306 - character output and carriage movement (EMIT) <br>  307 - mode switching <br>  1 - LowLevel mode.  Functions 300, 301 available for direct memory handling <br>  0 - Normal mode.  Function 306 is available to set the character with the specified color to the specified position and move the carriage. <br>  308 - CR <br>  309 - VGA_SetData (A ++) <br><br>  <b>Cursor options</b> <br>  310 - set the cursor parameters. <br>  0 bit - the bottom bar in the cursor <br>  1 bit - black square <br>  2 bits - flicker <br>  3 bits - vertical strip <br>  311 - setting bit ‚Ññ0 in the cursor parameters <br>  ... <br>  314 - setting bit number 3 in the parameters of the cursor <br><br>  320 - setting the cursor color <br>  321 - setting the blink time of the cursor <br>  322 - setting the time of the burning cursor <br><br>  <b>Work with palette</b> <br>  330 - Setting the address of the color palette <br>  331 - Record color to set address <br><br>  <b>Working with symbol table</b> <br>  335 - Setting the address in the symbol table <br>  337 - Write NewSymbol at a given address <br>  340 - Setting the low 32 bits of the NewSymbol signal (NewSymbol (31: 0)) <br>  341 - Setting the next 32 bits of NewSymbol (63:32) <br>  342 - NewSymbol (95:64) <br>  343 - NewSymbol (127: 96) <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/129746/">https://habr.com/ru/post/129746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129739/index.html">Assembler for beginners</a></li>
<li><a href="../129742/index.html">Social advertising: is it possible to survive in the USA with a salary of $ 9 / hour</a></li>
<li><a href="../129743/index.html">"Smart Home" with their own hands</a></li>
<li><a href="../129744/index.html">C / C ++. The main thing is to start!</a></li>
<li><a href="../129745/index.html">Rebuild the browser window</a></li>
<li><a href="../129747/index.html">New domain registration rules: protection from porn?</a></li>
<li><a href="../129748/index.html">Evernote for iOS Update: Major Improvements and iOS 5 Support</a></li>
<li><a href="../129750/index.html">HP Acquires Autonomy for $ 10.4 Billion</a></li>
<li><a href="../129751/index.html">How we got to Skolkovo - the story of the resident</a></li>
<li><a href="../129752/index.html">META company released an updated MetaMarket</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>