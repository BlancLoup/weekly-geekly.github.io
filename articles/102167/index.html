<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MySQL support in Node.js: node-mysql-libmysqlclient</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have been postponing this announcement for a long time, but now it is his time. 

 Meet: node-mysql-libmysqlclient v0.0.7 , MySQL connector for Node...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MySQL support in Node.js: node-mysql-libmysqlclient</h1><div class="post__text post__text-html js-mediator-article">  I have been postponing this announcement for a long time, but now it is his time. <br><br>  Meet: <a href="">node-mysql-libmysqlclient v0.0.7</a> , MySQL connector for Node.js, supporting synchronous and asynchronous database queries and having an API close to the API of similar connectors for PHP / Perl / Ruby etc. <br><br><a name="habracut"></a><h4>  <b>MySQL and Node.js: history of relations</b> </h4><br>  Node.JS was developed mainly for writing fast asynchronous servers (see [1]), for serving message queues, returning a small amount of statics and other tasks that operate with small amounts of data.  Therefore, the first appeared connectors to NoSQL databases and Memcached.  At that stage of development, Node.JS seemed to cover most of the possible applications of the system.  In case you needed to work with relational databases, a daemon was written in another language that prepared the data for the Node.js server.  As you understand, this slowed down the development of Node.js, because many people are used to supporting relational databases in standard libraries of common server programming languages.  This was not denied by the developer of Node.js, who planned to include such connectors in one of the later stable versions.  However, so far this has not happened, and third-party connectors to relational databases have begun to appear.  At the time of writing node-mysql-libmysqlclient there were several: <br><ul><li>  <a href="http://github.com/masuidrive/node-mysql">node-mysql</a> </li><li>  <a href="">node.dbslayer.js</a> </li><li>  <a href="http://github.com/ry/node_postgres">node_postgres</a> </li></ul><h4>  <b>Yet another MySQL connector for Node.js?</b> </h4><br>  I think they all had their flaws.  Undoubtedly, it is convenient to write the connector directly to Javascript, as was done in node-mysql.  However, this is a fairly large amount of code that needs to be thoroughly tested and meticulously updated as the Node.js API changes.  Also, as it turned out, implementation in C / C ++ is 3-5 times faster than in JavaScript.  To use node.dbslayer.js, you must use a DBsLayer layer to ensure asynchronous execution of queries.  Node_postgres in its first implementations was very little functional.  And none of these connectors came close to similar ones in other languages ‚Äã‚Äãin the presence of utilitarian functions.  This was the main reason why I started writing node-mysql-libmysqlclient. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>Node-mysql-libmysqlclient: features</b> </h4><br>  Bindings are currently implemented <a href="http://github.com/Sannis/node-mysql-libmysqlclient/blob/master/docs/api_node_mysql_libmysqlclient.markdown">for all functions of the libmysqlclient library API</a> concerning utilitarian functions, execution of queries and data retrieval.  The connector also allows you to execute queries asynchronously, with or without callback.  Example: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* http://gist.github.com/537870 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mysql_libmysqlclient = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mysql-libmysqlclient"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn = mysql_libmysqlclient.createConnection(host, user, password, database); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!conn.connected()) { sys.puts(<span class="hljs-string"><span class="hljs-string">"Connection error: "</span></span> + conn.connectErrno() + <span class="hljs-string"><span class="hljs-string">", "</span></span> + conn.connectError()); process.exit(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> string = conn.escape(<span class="hljs-string"><span class="hljs-string">"Sannis's code"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* Sync queries */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = conn.query(<span class="hljs-string"><span class="hljs-string">"CREATE TEMPORARY TABLE t1 (alpha INTEGER, beta VARCHAR(255), pi FLOAT);"</span></span>); sys.puts(<span class="hljs-string"><span class="hljs-string">"'CREATE TABLE' result: "</span></span> + sys.inspect(res)); res = conn.query(<span class="hljs-string"><span class="hljs-string">"INSERT INTO t1 VALUES (1, 'hello', 3.141);"</span></span>); sys.puts(<span class="hljs-string"><span class="hljs-string">"LastInsertId: "</span></span> + sys.inspect(conn.lastInsertId())); <span class="hljs-comment"><span class="hljs-comment">/* Async queries */</span></span> conn.queryAsync(<span class="hljs-string"><span class="hljs-string">"INSERT INTO t1 VALUES (2, 'world', 2.718);"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) </span></span>{ conn.queryAsync(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM t1;"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) </span></span>{ sys.puts(<span class="hljs-string"><span class="hljs-string">"NumRows: "</span></span> + res.numRows()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rows = res.fetchAll(); sys.puts(<span class="hljs-string"><span class="hljs-string">"Rows: "</span></span> + sys.inspect(rows)); conn.queryAsync(<span class="hljs-string"><span class="hljs-string">"DELETE * FROM t1;"</span></span>); }); });</code> </pre> <br><br><h4>  <b>Immediate plans</b> </h4><ul><li>  More tests, especially for asynchronous requests </li><li>  Update API documentation and write usage examples for all functions. </li><li>  Writing benchmarks for all currently existing MySQL connectors </li><li>  Implementing prepared statements </li></ul><h5>  <b>Asynchronous implementation</b> </h5><br>  The libmysqlclient library does not natively support asynchronous query execution.  The second call to mysql_query () before getting all the results after mysql_use_result () or calling mysql_store_result () will cause an error.  There is, however, an undocumented mysql_send_query function that the mysql2 connector developer uses for Ruby, but I decided not to go this way. <br><br>  To support asynchronous I / O operations, <a href="http://software.schmorp.de/pkg/libeio.html">libeio is</a> included in <a href="http://software.schmorp.de/pkg/libeio.html">Node.js.</a>  It not only supports the execution of disk operations with callbacks for the result, but also with the help of eio_custom allows you to perform any function in a separate thread and return the result of its execution to a callback.  In libeio, it uses threads-pool, so in order to avoid running mysql_query in parallel, it is also wrapped in a mutex. <br><br>  Perhaps the current implementation will not stand the competition in case of a high load on the event-loop or libeio threads-pool and then I think they will return to the system with the request queue, when the queue will be responsible for the sequential launch of mysql_query and the use of a mutex will not be required. <br><br>  Asynchronous requests for code snippet: <a href="">github.com/Sannis/node-mysql-libmysqlclient/blob/v0.0.7/src/mysql_bindings_connection.cc#L825-946</a> <br><br><h5>  <b>Related Links</b> </h5><br>  [1] <a href="http://nodejs.org/">Node.js website</a> <br>  [2] <a href="http://github.com/ry/node">Node.js on github</a> <br>  [3] <a href="http://github.com/Sannis/node-mysql-libmysqlclient">Node-mysql-libmysqlclient on GitHub</a> <br>  [4] <a href="http://github.com/Sannis/node-mysql-libmysqlclient/blob/master/docs/api_node_mysql_libmysqlclient.markdown">Node-mysql-libmysqlclient API</a> <br><br>  PS I have enough karma for the publication of the topic in a thematic blog.  But I just can‚Äôt decide which one is better for him: <a href="http://habrahabr.ru/blogs/javascript/">JavaScript</a> or <a href="http://habrahabr.ru/blogs/webdev/">Web development</a> ? </div><p>Source: <a href="https://habr.com/ru/post/102167/">https://habr.com/ru/post/102167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102157/index.html">Habrahabr vs Intel team: photo report</a></li>
<li><a href="../102159/index.html">35 lessons learned by age 35</a></li>
<li><a href="../102160/index.html">Eight most necessary features to be implemented in ¬µTorrent</a></li>
<li><a href="../102162/index.html">The next technological breakthrough is ‚ÄúVery Mass Medicine‚Äù</a></li>
<li><a href="../102163/index.html">Welcome</a></li>
<li><a href="../102168/index.html">How to hack Second Life via QuickTime</a></li>
<li><a href="../102169/index.html">... and the hamster is tearing apart!</a></li>
<li><a href="../102172/index.html">Video Stream: Acer's Android flagship</a></li>
<li><a href="../102173/index.html">Error messages + templates: some simple tips</a></li>
<li><a href="../102174/index.html">New information about Diablo3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>