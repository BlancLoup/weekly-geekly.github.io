<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>sasl: overload. Or - ‚Äúdo not put more in the plate than it can accommodate‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Erlang is an excellent platform for building servers, and its standard library provides many tools that make life much easier for a developer. 

 One ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>sasl: overload. Or - ‚Äúdo not put more in the plate than it can accommodate‚Äù</h1><div class="post__text post__text-html js-mediator-article">  Erlang is an excellent platform for building servers, and its standard library provides many tools that make life much easier for a developer. <br><br>  One of the typical tasks of the industrial level server developer is to control the load.  That is, our server must behave adequately even if requests come more than the server can handle (on our hardware). <br><br>  This is actually one of the key differences between ‚Äúknee‚Äù solutions and ‚ÄúEnterprise‚Äù.  A real, well-designed server is ‚Äúin the know‚Äù that it cannot spend resources without limit, keeps records of resources and controls the load. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How it's done? <br><a name="habracut"></a><br><br>  One of the controls for loading into erlang programs is the <i>overload</i> module in the <i>sasl</i> application.  His idea is very simple - with a new request from a client, we check the current download, if it is more than N per second, we send a polite refusal to the client.  If the load is less than this threshold, then we transfer this request for the main processing. <br><br>  The idea is simple - but the implementation is rather unpleasant, we must remember the time when the last few requests came, keep in mind that there may be local "peaks" of query intensity, etc. <br><br>  Fortunately, the overload module does all this.  In the program settings, you can specify the required threshold (roughly speaking in <i>sys.config</i> ), and then, when a request comes from the client, simply perform <i>overload: request ()</i> and see the result ‚Äî accept ‚Äî continue work, reject ‚Äî deny service. <br><br>  That is something like <br><pre> handle_call (SomeRequest, State) -&gt;
   case overload: request () of
      reject -&gt; {reply, overloaded, State}
      accept -&gt; {Result, NewState} = do_something (SomeRequest, State),
                     {reply, Result, NewState}
    end.
</pre><br><br>  Behind the scenes - sasl counts when and how many times overload was called: request (), and based on this it considers the load using a complex formula (you can see it in the documentation), and decides whether the current request to process it is worth it. <br><br>  How it looks in practice: <br><br>  We configure sasl, approximately such sys.config: <br><br><pre> [
 {sasl, [{overload_max_intensity, 300.0}, {sasl_error_logger, {file, "/ var / log / rcvr.log"}}, {utc_log, false}]}
 ].
</pre><br><br>  Here we set the maximum intensity to 300 requests per second.  We start, for example <br><br>  erl + K true -sname rcvr -setcookie 123 -config sys.config <br><br>  And follow the download.  A week later, munin shows us this: <br><br><img src="https://habrastorage.org/storage/197795be/237dcf0e/f775eea7/d3519e1d.png"><br><br>  Here you can see that the server accepts and processes only 300 requests per second, which is what we needed. <br><br><h5>  Disadvantages overload </h5><br><ul><li>  Since sasl considers the intensity of overload: request () calls to determine the current load - overload: request () can be used only in one place in the program.  You won‚Äôt get lost for a server that accepts (for example) http and rpc requests to configure overload separately for rpc and separately for http. </li><li>  Settings are set in sys.config (well, or in the .app file) and cannot be changed while the program is running.  that is, to reconfigure sasl: overload, you will have to restart the server. </li></ul><br><br><h5>  Morality </h5><br><br>  The overload module is convenient, but not applicable everywhere because of its limitations.  but in any case, to know and remember him is necessary. </div><p>Source: <a href="https://habr.com/ru/post/117338/">https://habr.com/ru/post/117338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117332/index.html">Go!</a></li>
<li><a href="../117333/index.html">The method of achieving the goal. Recipe</a></li>
<li><a href="../117334/index.html">Eight hundred megapixel panorama of night Moscow</a></li>
<li><a href="../117335/index.html">Choosing a manager's workplace: iPad, HP Touchscreen, Viewsonic VPAD ...?</a></li>
<li><a href="../117337/index.html">Mail + SMS notification. Customization experience</a></li>
<li><a href="../117339/index.html">Use Evernote for the full: 7 reasons to use the desktop version of Evernote</a></li>
<li><a href="../117343/index.html">Open data as a basis</a></li>
<li><a href="../117344/index.html">Information Society and Information Reuse</a></li>
<li><a href="../117345/index.html">First after Habr</a></li>
<li><a href="../117346/index.html">The kids grew up ... and called their parents.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>