<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ContactManager, part 4. Add a web service (REST)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The ink on the previous version of the ContactManager application did not have time to dry out , as the phone rang, and I heard the voice of a friend ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ContactManager, part 4. Add a web service (REST)</h1><div class="post__text post__text-html js-mediator-article">  The ink on the <a href="http://habrahabr.ru/post/171911">previous version of the ContactManager application did</a> not have time to dry <a href="http://habrahabr.ru/post/171911">out</a> , as the phone rang, and I heard the voice of a friend in the tube, who began to master the development for Android and was looking for a test project on which he could practice working with web services. <br><br>  ‚ÄúNothing is easier!‚Äù I replied. <br><a name="habracut"></a><br>  So what do we have at the moment? <br>  A web application that runs in a browser, for authorization, the user must enter a username and password.  The controller manages views that display specific JSP pages to the user. <br><br>  In the case of a web service, there is no login form, no JSP pages.  One solid HTTP: data is sent in requests and returned back as JSON (as an option, XML). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Work plan: <br><ul><li>  add security settings </li><li>  add controller </li><li>  to test </li></ul><br><br>  "Straight on points and let's go" (C). <br><br><h5>  1. Add security settings. </h5><br>  Security for a web service can be implemented using <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic Authentication</a> .  Let's see how Spring supports this mechanism. <br><br>  To begin with we will be defined with a format of requests.  We already have a set of URLs for working with the browser, we can take it as a sample.  Just ‚Äúhide‚Äù URLs for the web service behind the mnemonic prefix " <code>/ws</code> ".  That is, we must handle the following set of addresses: <code>/ws/index</code> , <code>/ws/add</code> , <code>/ws/delete</code> .  Access to the root " <code>/ws</code> " we voluntarily decide to ban, because there is no need. <br><br>  Spring allows you to specify multiple http elements in a single security file.  Take advantage of this.  Add to the beginning: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">realm</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Contact Manager REST-service"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/ws/**"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">use-expressions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intercept-url</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/ws/index*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">access</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hasAnyRole('ROLE_USER','ROLE_ANONYMOUS')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intercept-url</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/ws/add*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">access</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hasRole('ROLE_USER')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intercept-url</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/ws/delete/*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">access</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hasRole('ROLE_ADMIN')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intercept-url</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/ws/**"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">access</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"denyAll"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http-basic</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It is important to add this section to the beginning, before the existing settings. Since it is more specific, it must be processed first in order to intercept the request with the <code>/ws</code> prefix in a timely manner. <br><br>  What changed?  Very little.  Everything related to JSP has disappeared, checking roles now uses the expression mechanism <code>use-expressions="true"</code> (but this is not important, just as an illustration).  Perlfix <code>/ws</code> added to all existing urls, access to the <code>/ws</code> root is denied for all ( <code>denyAll</code> ).  Examples of the use of other SPEL expressions can be found <a href="http://www.seostella.com/ru/article/2012/07/05/spring-el-expressions-v-spring-security.html">here</a> .  I repeat - the order of specifying masks is important, the most common <code>/ws/**</code> the last.  The <code>realm</code> attribute is added again for beauty, it will be displayed in the authorization window, if someone decides to admire the JSON contact list through the browser. <br><br>  And further the invisible element <code>&lt;http-basic/&gt;</code> already sheltered.  Behind this short construction, Spring (in its usual style) hides from the developer the complexity of the mechanism of this Basic Authentication itself.  And we have no reason not to trust him in this.  One down, two to go.  Let's do the controller. <br><blockquote>  NB We must not forget that we have 2 security.xml files, the main one for tests.  Changes need to be made in both. </blockquote><br><h5>  2. Add a controller. </h5><br>  How do we turn a controller for a JSP into a controller for a web service?  Very simple.  Existing methods return a String with the name view, or with a forward / redirect page, while the data (lists of contracts and their types) are passed in the attributes of the model.  Web service methods must return objects suitable for serialization in JSON.  Plus, the POST method <code>/ws/add</code> will accept the data of the new contact in the form of a JSON string directly in the request body.  It's time to work. <br><br>  Create a new <code>ContactWsController.java</code> file in the same package as the old controller.  And immediately at the class level, we denote our claims that this is a web service. <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/ws"</span></span>, produces = MediaType.APPLICATION_JSON_VALUE) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContactWsController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ContactService contactService; }</code> </pre><br>  <code>@RequestMapping(value="/ws")</code> at the class level sets a common prefix that will be automatically added to all URLs of individual methods.  <code>produces = MediaType.APPLICATION_JSON_VALUE</code> says that by default all methods of this controller will render JSON.  If necessary, in a specific method, this value can be redefined. <br>  By tradition, start with a list of contacts.  The old method looks like this: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/index"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map&lt;String, Object&gt; map)</span></span></span><span class="hljs-function"> </span></span>{ map.put(<span class="hljs-string"><span class="hljs-string">"contact"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Contact()); map.put(<span class="hljs-string"><span class="hljs-string">"contactList"</span></span>, contactService.listContact()); map.put(<span class="hljs-string"><span class="hljs-string">"contactTypeList"</span></span>, contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"contact"</span></span>; }</code> </pre><br>  In order not to make a <a href="http://ru.wikipedia.org/wiki/DTO">DTO</a> for each method, <a href="http://ru.wikipedia.org/wiki/DTO">let</a> 's accept the agreement that the structure of the returned JSON will be a Map.  We remove the method parameter, we do not need it, change the type of the return value to Map and add the <code>@ResponseBody</code> annotation to the return value.  It tells Spring that we want this value to be serialized in JSON and written to the response body.  The new method looks like this: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/index"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, Object&gt;(); map.put(<span class="hljs-string"><span class="hljs-string">"contact"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Contact()); map.put(<span class="hljs-string"><span class="hljs-string">"contactList"</span></span>, contactService.listContact()); map.put(<span class="hljs-string"><span class="hljs-string">"contactTypeList"</span></span>, contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; }</code> </pre><br><br>  In order not to postpone the matter indefinitely and quickly see the fruits of our efforts, let us step back a little from our plan and immediately try to test this method. <br><br><h6>  2.1 First test method </h6><br>  But it is important to understand exactly what results we have to wait in the test.  Make a new class <code>MockMvcWsTest.groovy</code> , copy into it all the main stuffing related to setting up MockMvc.  And copy the old test: <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index_user1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mockMvc.perform(MockMvcRequestBuilders.get(<span class="hljs-string"><span class="hljs-string">"/index"</span></span>) .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andExpect(MockMvcResultMatchers.view().name(<span class="hljs-string"><span class="hljs-string">"contact"</span></span>)) .andExpect(MockMvcResultMatchers.model().attributeExists(<span class="hljs-string"><span class="hljs-string">"contact"</span></span>)) .andExpect(MockMvcResultMatchers.model().attributeExists(<span class="hljs-string"><span class="hljs-string">"contactList"</span></span>)) .andExpect(MockMvcResultMatchers.model().attributeExists(<span class="hljs-string"><span class="hljs-string">"contactTypeList"</span></span>)) }</code> </pre><br>  All data come in models.  But in the web service we were going to send them in the request body.  Maybe there is a search for them?  Let's try. <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index_user1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ def result = mockMvc.perform(MockMvcRequestBuilders.get(<span class="hljs-string"><span class="hljs-string">"/ws/index"</span></span>) .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andReturn() <span class="hljs-comment"><span class="hljs-comment">//      -   JSON println result.response.contentAsString }</span></span></code> </pre><br>  We start.  The test is completed, but there is nothing in the console.  Hm  We'll have to podobezhit, set the breakpoint in the controller, run.  Yeah, it enters the controller.  But back something useful does not come.  We look at the value of the result - that is, in <code>resolvedException</code> stands <code>HttpMediaTypeNotAcceptableException</code> , and <code>mockResponse.status</code> = 406. The diagnosis is still disappointing ‚ÄúCould not find acceptable representation‚Äù. <br><br>  But on the other hand, we asked to turn the Map into JSON, and we didn‚Äôt say who will do it and how.  Spring, of course, can do a lot, but not everything.  <a href="http://static.springsource.org/spring-framework/docs/3.2.x/spring-framework-reference/html/mvc.html">Examining the documentation</a> gives us the following result: <br><ul><li>  In <code>pom.xml</code> you need to add dependencies to the JSON library. <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.fasterxml.jackson.core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jackson-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.1.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.fasterxml.jackson.core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jackson-databind<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.1.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></li><li>  in xml configuration, change <code>annotation-driven</code> to <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mvc:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content-negotiation-manager</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"contentNegotiationManager"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"contentNegotiationManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.web.accept.ContentNegotiationManagerFactoryBean"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favorPathExtension"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"favorParameter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mediaTypes"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> json=application/json <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  (see <code>servlet-context.xml</code> ).  <b>It</b> is <b>important</b> to change the XSD scheme to version 3.2 (eg <code>spring-mvc-3.2.xsd</code> ) <br></li><li>  and in the java-configuration for tests - just one annotation <code>@EnableWebMvc</code> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//... @ImportResource('classpath:security.xml') @EnableWebMvc class TestConfig { /*...*/ }</span></span></code> </pre></li></ul><br>  Hmm, the presence of two configurations is definitely starting to cause inconvenience, but for now we will not be distracted by this.  We start the test, we see the required line.  But ... instead of Cyrillic krakozybly. <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"contactTypeList"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"family"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"√ê¬°√ê¬µ√ê¬º√ë≈í√ë "</span></span>,<span class="hljs-string"><span class="hljs-string">"defaulttype"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"contacts"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>},{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"job"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"√ê √ê¬∞√ê¬±√ê¬æ√ë‚Äö√ê¬∞"</span></span>,<span class="hljs-string"><span class="hljs-string">"defaulttype"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"contacts"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>},{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"stuff"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"√ê‚Äî√ê¬Ω√ê¬∞√ê¬∫√ê¬æ√ê¬º√ë‚Äπ√ê¬µ"</span></span>,<span class="hljs-string"><span class="hljs-string">"defaulttype"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"contacts"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>}],<span class="hljs-string"><span class="hljs-string">"contactList"</span></span>:[],<span class="hljs-string"><span class="hljs-string">"contact"</span></span>:{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"firstname"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"lastname"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"telephone"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"contacttype"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>}}</code> </pre> <br>  Again, we google, smoke manuals and source codes and find the following solution: add a charset to @ RequestMapping.produces (to the one that is at the class level). <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/ws"</span></span>, produces = MediaType.APPLICATION_JSON_VALUE+<span class="hljs-string"><span class="hljs-string">";charset=UTF-8"</span></span> )</code> </pre><br>  It does not look like a fountain, those who wish can search for a ‚Äúmore different‚Äù option, we will stop there. <br><br><h6>  Another couple of comments </h6><br>  <b>Remark 1</b> .  Understanding what happens inside the test will facilitate the construction of <code>.andDo(MockMvcResultHandlers.print())</code> It displays detailed information in the log.  For example, for our request the log will look like this. <br><pre> <code class="nginx hljs">MockHttpServletRequest: <span class="hljs-attribute"><span class="hljs-attribute">HTTP</span></span> Method = GET Request URI = /ws/index Parameters = {} <span class="hljs-attribute"><span class="hljs-attribute">Headers</span></span> = {} Handler: <span class="hljs-attribute"><span class="hljs-attribute">Type</span></span> = net.schastny.contactmanager.web.ContactWsController Method = public java.util.Map&lt;java.lang.String, java.lang.Object&gt; net.schastny.contactmanager.web.ContactWsController.listContacts() Async: Was async started = <span class="hljs-literal"><span class="hljs-literal">false</span></span> Async result = null Resolved Exception: Type = null ModelAndView: View name = null View = null Model = null FlashMap: MockHttpServletResponse: Status = <span class="hljs-number"><span class="hljs-number">200</span></span> Error message = null Headers = {Content-Type=[application/json;charset=UTF-8]} <span class="hljs-attribute"><span class="hljs-attribute">Content</span></span> type = application/json;charset=UTF-8 <span class="hljs-attribute"><span class="hljs-attribute">Body</span></span> = {"contactTypeList":[{"id":1,"code":"family","name":"","defaulttype":false,"contacts":null},{"id":2,"code":"job","name":"","defaulttype":false,"contacts":null},{"id":3,"code":"stuff","name":"","defaulttype":true,"contacts":null}],"contactList":[],"contact":{"id":null,"firstname":null,"lastname":null,"email":null,"telephone":null,"contacttype":null}} <span class="hljs-attribute"><span class="hljs-attribute">Forwarded</span></span> URL = null Redirected URL = null Cookies = []</code> </pre><br>  Much better, isn't it? <br><br>  <b>Remark 2</b> .  You can see that the ContactType class is serialized by default to JSON along with all the attributes.  But the serialization of the <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code></code> attribute is <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code></code> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <pre> <code class="hljs pgsql"><code>List contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  ,    -     <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> = FetchType.LAZY, <span class="hljs-keyword"><span class="hljs-keyword">cascade</span></span> = [CascadeType.<span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span>, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> <br> <br> ,       .      . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> index_user1() { def result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/ws/index") .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(result.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList.size() == <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> <span class="hljs-number"><span class="hljs-number">2.2</span></span>   <br>        . <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    <span class="hljs-type"><span class="hljs-type">JSON</span></span>-    ( <code>@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span></code> )  <span class="hljs-type"><span class="hljs-type">JSON</span></span>  ,        ,    Map,  ,    <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>      <br>    : <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; addContactWs(@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span>) { Contact contact = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(<span class="hljs-type"><span class="hljs-type">json</span></span>, Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); contactService.addContact(contact); Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } catch (IOException e) { Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", ""); map.put("message", e.getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       <span class="hljs-type"><span class="hljs-type">JSON</span></span>.       Jackson ObjectMapper(),       Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder,      Groovy    <span class="hljs-number"><span class="hljs-number">1.8</span></span>.  <span class="hljs-type"><span class="hljs-type">JSON</span></span>     ,  contentType  .      : <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_user1() { def contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !contacts def contactTypes = contactService.listContactType() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contactTypes // Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder def jsonBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JsonBuilder() jsonBuilder { firstname <span class="hljs-string"><span class="hljs-string">''</span></span> lastname <span class="hljs-string"><span class="hljs-string">''</span></span> email <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> telephone <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> contacttype ( id : contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id ) } String <span class="hljs-type"><span class="hljs-type">json</span></span> = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(<span class="hljs-type"><span class="hljs-type">json</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>)) MvcResult ret = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(ret.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.status == <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id //      Contact contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Contact(map.contact) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.id == contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.firstname == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.lastname== <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.email == <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.telephone == <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.contacttype.id == contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id contactService.removeContact(contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id) }</code> <br>    user1,     .         <span class="hljs-type"><span class="hljs-type">JSON</span></span>,    <span class="hljs-number"><span class="hljs-number">401</span></span> . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_na() { ResultActions result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content(<span class="hljs-string"><span class="hljs-string">'{"J":5,"0":"N"}'</span></span>) //.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">ADMIN</span></span>))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </pre> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <pre> <code class="hljs pgsql"><code>List contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  ,    -     <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> = FetchType.LAZY, <span class="hljs-keyword"><span class="hljs-keyword">cascade</span></span> = [CascadeType.<span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span>, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> <br> <br> ,       .      . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> index_user1() { def result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/ws/index") .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(result.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList.size() == <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> <span class="hljs-number"><span class="hljs-number">2.2</span></span>   <br>        . <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    <span class="hljs-type"><span class="hljs-type">JSON</span></span>-    ( <code>@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span></code> )  <span class="hljs-type"><span class="hljs-type">JSON</span></span>  ,        ,    Map,  ,    <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>      <br>    : <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; addContactWs(@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span>) { Contact contact = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(<span class="hljs-type"><span class="hljs-type">json</span></span>, Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); contactService.addContact(contact); Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } catch (IOException e) { Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", ""); map.put("message", e.getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       <span class="hljs-type"><span class="hljs-type">JSON</span></span>.       Jackson ObjectMapper(),       Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder,      Groovy    <span class="hljs-number"><span class="hljs-number">1.8</span></span>.  <span class="hljs-type"><span class="hljs-type">JSON</span></span>     ,  contentType  .      : <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_user1() { def contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !contacts def contactTypes = contactService.listContactType() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contactTypes // Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder def jsonBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JsonBuilder() jsonBuilder { firstname <span class="hljs-string"><span class="hljs-string">''</span></span> lastname <span class="hljs-string"><span class="hljs-string">''</span></span> email <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> telephone <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> contacttype ( id : contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id ) } String <span class="hljs-type"><span class="hljs-type">json</span></span> = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(<span class="hljs-type"><span class="hljs-type">json</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>)) MvcResult ret = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(ret.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.status == <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id //      Contact contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Contact(map.contact) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.id == contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.firstname == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.lastname== <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.email == <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.telephone == <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.contacttype.id == contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id contactService.removeContact(contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id) }</code> <br>    user1,     .         <span class="hljs-type"><span class="hljs-type">JSON</span></span>,    <span class="hljs-number"><span class="hljs-number">401</span></span> . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_na() { ResultActions result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content(<span class="hljs-string"><span class="hljs-string">'{"J":5,"0":"N"}'</span></span>) //.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">ADMIN</span></span>))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </pre> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <h6> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </h6> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <pre> <code class="hljs pgsql"><code>List contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  ,    -     <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> = FetchType.LAZY, <span class="hljs-keyword"><span class="hljs-keyword">cascade</span></span> = [CascadeType.<span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span>, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> <br> <br> ,       .      . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> index_user1() { def result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/ws/index") .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(result.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList.size() == <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> <span class="hljs-number"><span class="hljs-number">2.2</span></span>   <br>        . <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    <span class="hljs-type"><span class="hljs-type">JSON</span></span>-    ( <code>@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span></code> )  <span class="hljs-type"><span class="hljs-type">JSON</span></span>  ,        ,    Map,  ,    <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>      <br>    : <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; addContactWs(@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span>) { Contact contact = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(<span class="hljs-type"><span class="hljs-type">json</span></span>, Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); contactService.addContact(contact); Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } catch (IOException e) { Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", ""); map.put("message", e.getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       <span class="hljs-type"><span class="hljs-type">JSON</span></span>.       Jackson ObjectMapper(),       Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder,      Groovy    <span class="hljs-number"><span class="hljs-number">1.8</span></span>.  <span class="hljs-type"><span class="hljs-type">JSON</span></span>     ,  contentType  .      : <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_user1() { def contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !contacts def contactTypes = contactService.listContactType() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contactTypes // Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder def jsonBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JsonBuilder() jsonBuilder { firstname <span class="hljs-string"><span class="hljs-string">''</span></span> lastname <span class="hljs-string"><span class="hljs-string">''</span></span> email <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> telephone <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> contacttype ( id : contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id ) } String <span class="hljs-type"><span class="hljs-type">json</span></span> = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(<span class="hljs-type"><span class="hljs-type">json</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>)) MvcResult ret = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(ret.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.status == <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id //      Contact contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Contact(map.contact) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.id == contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.firstname == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.lastname== <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.email == <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.telephone == <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.contacttype.id == contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id contactService.removeContact(contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id) }</code> <br>    user1,     .         <span class="hljs-type"><span class="hljs-type">JSON</span></span>,    <span class="hljs-number"><span class="hljs-number">401</span></span> . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_na() { ResultActions result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content(<span class="hljs-string"><span class="hljs-string">'{"J":5,"0":"N"}'</span></span>) //.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">ADMIN</span></span>))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </pre> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <ul><li> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </li> <li> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </li> <li> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </li> <li> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </li> <li> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </li> </ul> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <pre> <code class="hljs pgsql"><code>List contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  ,    -     <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> = FetchType.LAZY, <span class="hljs-keyword"><span class="hljs-keyword">cascade</span></span> = [CascadeType.<span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span>, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> <br> <br> ,       .      . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> index_user1() { def result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/ws/index") .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(result.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList.size() == <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> <span class="hljs-number"><span class="hljs-number">2.2</span></span>   <br>        . <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    <span class="hljs-type"><span class="hljs-type">JSON</span></span>-    ( <code>@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span></code> )  <span class="hljs-type"><span class="hljs-type">JSON</span></span>  ,        ,    Map,  ,    <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>      <br>    : <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; addContactWs(@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span>) { Contact contact = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(<span class="hljs-type"><span class="hljs-type">json</span></span>, Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); contactService.addContact(contact); Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } catch (IOException e) { Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", ""); map.put("message", e.getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       <span class="hljs-type"><span class="hljs-type">JSON</span></span>.       Jackson ObjectMapper(),       Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder,      Groovy    <span class="hljs-number"><span class="hljs-number">1.8</span></span>.  <span class="hljs-type"><span class="hljs-type">JSON</span></span>     ,  contentType  .      : <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_user1() { def contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !contacts def contactTypes = contactService.listContactType() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contactTypes // Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder def jsonBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JsonBuilder() jsonBuilder { firstname <span class="hljs-string"><span class="hljs-string">''</span></span> lastname <span class="hljs-string"><span class="hljs-string">''</span></span> email <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> telephone <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> contacttype ( id : contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id ) } String <span class="hljs-type"><span class="hljs-type">json</span></span> = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(<span class="hljs-type"><span class="hljs-type">json</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>)) MvcResult ret = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(ret.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.status == <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id //      Contact contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Contact(map.contact) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.id == contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.firstname == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.lastname== <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.email == <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.telephone == <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.contacttype.id == contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id contactService.removeContact(contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id) }</code> <br>    user1,     .         <span class="hljs-type"><span class="hljs-type">JSON</span></span>,    <span class="hljs-number"><span class="hljs-number">401</span></span> . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_na() { ResultActions result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content(<span class="hljs-string"><span class="hljs-string">'{"J":5,"0":"N"}'</span></span>) //.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">ADMIN</span></span>))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </pre> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <pre> <code class="hljs pgsql"><code>List contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  ,    -     <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> = FetchType.LAZY, <span class="hljs-keyword"><span class="hljs-keyword">cascade</span></span> = [CascadeType.<span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span>, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> <br> <br> ,       .      . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> index_user1() { def result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/ws/index") .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(result.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList.size() == <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> <span class="hljs-number"><span class="hljs-number">2.2</span></span>   <br>        . <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    <span class="hljs-type"><span class="hljs-type">JSON</span></span>-    ( <code>@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span></code> )  <span class="hljs-type"><span class="hljs-type">JSON</span></span>  ,        ,    Map,  ,    <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>      <br>    : <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; addContactWs(@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span>) { Contact contact = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(<span class="hljs-type"><span class="hljs-type">json</span></span>, Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); contactService.addContact(contact); Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } catch (IOException e) { Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", ""); map.put("message", e.getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       <span class="hljs-type"><span class="hljs-type">JSON</span></span>.       Jackson ObjectMapper(),       Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder,      Groovy    <span class="hljs-number"><span class="hljs-number">1.8</span></span>.  <span class="hljs-type"><span class="hljs-type">JSON</span></span>     ,  contentType  .      : <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_user1() { def contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !contacts def contactTypes = contactService.listContactType() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contactTypes // Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder def jsonBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JsonBuilder() jsonBuilder { firstname <span class="hljs-string"><span class="hljs-string">''</span></span> lastname <span class="hljs-string"><span class="hljs-string">''</span></span> email <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> telephone <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> contacttype ( id : contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id ) } String <span class="hljs-type"><span class="hljs-type">json</span></span> = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(<span class="hljs-type"><span class="hljs-type">json</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>)) MvcResult ret = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(ret.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.status == <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id //      Contact contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Contact(map.contact) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.id == contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.firstname == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.lastname== <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.email == <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.telephone == <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.contacttype.id == contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id contactService.removeContact(contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id) }</code> <br>    user1,     .         <span class="hljs-type"><span class="hljs-type">JSON</span></span>,    <span class="hljs-number"><span class="hljs-number">401</span></span> . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_na() { ResultActions result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content(<span class="hljs-string"><span class="hljs-string">'{"J":5,"0":"N"}'</span></span>) //.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">ADMIN</span></span>))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </pre> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> <pre> <code class="hljs pgsql"><code>List contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  ,    -     <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span>,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> = FetchType.LAZY, <span class="hljs-keyword"><span class="hljs-keyword">cascade</span></span> = [CascadeType.<span class="hljs-keyword"><span class="hljs-keyword">REFRESH</span></span>, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> <br> <br> ,       .      . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> index_user1() { def result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("/ws/index") .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(result.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList.size() == <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> <span class="hljs-number"><span class="hljs-number">2.2</span></span>   <br>        . <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    <span class="hljs-type"><span class="hljs-type">JSON</span></span>-    ( <code>@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span></code> )  <span class="hljs-type"><span class="hljs-type">JSON</span></span>  ,        ,    Map,  ,    <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>      <br>    : <br> <code class="java"> @RequestMapping(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = "/add", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; addContactWs(@RequestBody String <span class="hljs-type"><span class="hljs-type">json</span></span>) { Contact contact = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; try { contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(<span class="hljs-type"><span class="hljs-type">json</span></span>, Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); contactService.addContact(contact); Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } catch (IOException e) { Map&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt; map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashMap&lt;String, <span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>&gt;(); map.put("status", ""); map.put("message", e.getMessage()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       <span class="hljs-type"><span class="hljs-type">JSON</span></span>.       Jackson ObjectMapper(),       Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder,      Groovy    <span class="hljs-number"><span class="hljs-number">1.8</span></span>.  <span class="hljs-type"><span class="hljs-type">JSON</span></span>     ,  contentType  .      : <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_user1() { def contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> !contacts def contactTypes = contactService.listContactType() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contactTypes // Groovy <span class="hljs-type"><span class="hljs-type">JSON</span></span>-builder def jsonBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JsonBuilder() jsonBuilder { firstname <span class="hljs-string"><span class="hljs-string">''</span></span> lastname <span class="hljs-string"><span class="hljs-string">''</span></span> email <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> telephone <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> contacttype ( id : contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id ) } String <span class="hljs-type"><span class="hljs-type">json</span></span> = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(<span class="hljs-type"><span class="hljs-type">json</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>)) MvcResult ret = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ObjectMapper().readValue(ret.response.contentAsString, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.status == <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactList <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> map.contactTypeList contacts = contactService.listContact() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id //      Contact contact = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Contact(map.contact) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> == Contact.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.id == contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.firstname == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.lastname== <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.email == <span class="hljs-string"><span class="hljs-string">'ivan.ivanov@gmail.com'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.telephone == <span class="hljs-string"><span class="hljs-string">'555-1234'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> contact.contacttype.id == contactTypes[<span class="hljs-number"><span class="hljs-number">0</span></span>].id contactService.removeContact(contacts[<span class="hljs-number"><span class="hljs-number">0</span></span>].id) }</code> <br>    user1,     .         <span class="hljs-type"><span class="hljs-type">JSON</span></span>,    <span class="hljs-number"><span class="hljs-number">401</span></span> . <br> <code class="java"> @Test <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> add_na() { ResultActions result = mockMvc.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content(<span class="hljs-string"><span class="hljs-string">'{"J":5,"0":"N"}'</span></span>) //.<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>(SecurityRequestPostProcessors.userDetailsService(<span class="hljs-keyword"><span class="hljs-keyword">ADMIN</span></span>))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </pre> <code><code>List contacts = null  ,    -     No Session,       .   -   " "      @JsonIgnore</code> <br> <code class="java"> @JsonIgnore @OneToMany(fetch = FetchType.LAZY, cascade = [CascadeType.REFRESH, CascadeType.MERGE], mappedBy = "contacttype") List&lt;Contact&gt; contacts = null</code> <br> <br> ,       .      . <br> <code class="java"> @Test public void index_user1() { def result = mockMvc.perform(MockMvcRequestBuilders.get("/ws/index") .with(SecurityRequestPostProcessors.userDetailsService(USER1))) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(result.response.contentAsString, Map.class); assert !map.contactList assert map.contactTypeList.size() == 3 }</code> <br>     <code>index_admin()</code>  <code>index_na()</code>      . <br> <br> 2.2   <br>        . <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST) public String addContact(@ModelAttribute("contact") Contact contact, BindingResult result) { contactService.addContact(contact); return "redirect:/index"; }</code> <br>      - : <br>      Map    <code>@ResponseBody</code>   ,    JSON-    ( <code>@RequestBody String json</code> )  JSON  ,        ,    Map,  ,    index      <br>    : <br> <code class="java"> @RequestMapping(value = "/add", method = RequestMethod.POST, consumes = MediaType.TEXT_PLAIN_VALUE) @ResponseBody public Map&lt;String, Object&gt; addContactWs(@RequestBody String json) { Contact contact = null; try { contact = new ObjectMapper().readValue(json, Contact.class); contactService.addContact(contact); Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", " "); //     -   -    map.put("contact", contact); map.put("contactList", contactService.listContact()); map.put("contactTypeList", contactService.listContactType()); return map; } catch (IOException e) { Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); map.put("status", ""); map.put("message", e.getMessage()); return map; } }</code> <br>  <code>@RequestMapping</code>   <code>consumes = MediaType.TEXT_PLAIN_VALUE</code>    ,    "".    -  status,        .   .       JSON.       Jackson ObjectMapper(),       Groovy JSON-builder,      Groovy    1.8.  JSON     ,  contentType  .      : <br> <code class="java"> @Test public void add_user1() { def contacts = contactService.listContact() assert !contacts def contactTypes = contactService.listContactType() assert contactTypes // Groovy JSON-builder def jsonBuilder = new JsonBuilder() jsonBuilder { firstname '' lastname '' email 'ivan.ivanov@gmail.com' telephone '555-1234' contacttype ( id : contactTypes[0].id ) } String json = jsonBuilder.toString() MockHttpServletRequestBuilder requestBuilder = MockMvcRequestBuilders.post("/ws/add") .contentType(MediaType.TEXT_PLAIN) .content(json) .with(SecurityRequestPostProcessors.userDetailsService(user)) MvcResult ret = mockMvc.perform(requestBuilder) .andExpect(MockMvcResultMatchers.content().contentType("${MediaType.APPLICATION_JSON_VALUE};charset=UTF-8")) .andDo(MockMvcResultHandlers.print()) .andReturn() def map = new ObjectMapper().readValue(ret.response.contentAsString, Map.class); assert map.status == ' ' assert map.contactList assert map.contactTypeList contacts = contactService.listContact() assert contacts assert contacts[0].id //      Contact contact = new Contact(map.contact) assert contact.class == Contact.class assert contact.id == contacts[0].id assert contact.firstname == '' assert contact.lastname== '' assert contact.email == 'ivan.ivanov@gmail.com' assert contact.telephone == '555-1234' assert contact.contacttype.id == contactTypes[0].id contactService.removeContact(contacts[0].id) }</code> <br>    user1,     .         JSON,    401 . <br> <code class="java"> @Test public void add_na() { ResultActions result = mockMvc.perform(MockMvcRequestBuilders.post("/ws/add") .accept(MediaType.APPLICATION_JSON) .contentType(MediaType.TEXT_PLAIN) .characterEncoding("UTF-8") .content('{"J":5,"0":"N"}') //.with(SecurityRequestPostProcessors.userDetailsService(ADMIN))     ) result.andExpect(MockMvcResultMatchers.status().isUnauthorized()) }</code> <br> <br>  ,  REST- .  -  .  Basic Authentication   ,      .          HTTPS  -   . <br> <br>  . <br> <br> <a href="https://github.com/monzdrpower/ContactManager-REST">    GitHub</a></code> </div><p>Source: <a href="https://habr.com/ru/post/173593/">https://habr.com/ru/post/173593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173573/index.html">Curiosity is back to active mode.</a></li>
<li><a href="../173575/index.html">Google expands Google Fiber service</a></li>
<li><a href="../173579/index.html">KFC + Imagine Cup = another opportunity to reach the world final</a></li>
<li><a href="../173581/index.html">In Russia, a man was first convicted for Xbox 360 firmware, and then acquitted!</a></li>
<li><a href="../173587/index.html">Graphene and molybdenite based memory</a></li>
<li><a href="../173595/index.html">Cowboy Web Server</a></li>
<li><a href="../173599/index.html">Combine multiple videos in iOS using AVMutableVideoComposition</a></li>
<li><a href="../173603/index.html">Cowon D20 - the heir to the legendary D2 +</a></li>
<li><a href="../173605/index.html">Exim + DKIM using the example of FreeBSD 8.2</a></li>
<li><a href="../173607/index.html">Dynamic graphic password</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>