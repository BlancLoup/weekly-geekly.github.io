<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hardcore Java / JVM puzzles</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Performance tasks from Contour have already been , and our turn has come: we present hardcore tasks from the Java conference JBreak 2018, aka ‚Äú hell f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hardcore Java / JVM puzzles</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/0e/5f/lq/0e5flqsdfy9-xj19zyxgthazz_4.png" align="right">  Performance tasks from Contour <a href="https://habrahabr.ru/company/skbkontur/blog/350800">have already been</a> , and our turn has come: we present hardcore tasks from the Java conference JBreak 2018, aka ‚Äú <a href="https://habrahabr.ru/post/350808">hell from Excelsior</a> ‚Äù. </p><br><p>  The tasks are given in the original formulations, in each task there can be several correct answers, and each task is given a solution under the spoiler. </p><br><h3 id="zadacha-1">  Task 1 </h3><br><p>  Your colleague has been reading the Java Language Specification and wrote the following: </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playWithRef</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Object obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(); WeakReference&lt;Object&gt; ref = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference&lt;&gt;(obj); System.out.println(ref.get() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); System.gc(); System.out.println(ref.get() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); }</code> </pre> <br><p>  And rake you: what performance results are possible? </p><a name="habracut"></a><br><ul><li>  <strong>A</strong> : false, false </li><li>  <strong>B</strong> : false, true </li><li>  <strong>C</strong> : true, false </li><li>  <strong>D</strong> : true, true </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  The correct answer is: <strong>A</strong> , <strong>C</strong> , <strong>D.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  The scope of the <code>obj</code> variable is the entire method, and the scope of life ends after exiting the <code>WeakReference</code> constructor (in fact, even a little earlier - in the insides of the constructor).  And it is the area of ‚Äã‚Äãlife that affects whether <abbr title="garbage collector">GC can</abbr> destroy this object. </p><br><p>  However, sometimes <abbr title="virtual machine">VM</abbr> can prolong the life of variables if it is convenient for it.  For example, the HotSpot interpreter tells the GC that the variables are alive while they are visible (this can be observed in the debugger).  That is, option <strong>D is</strong> easily achieved by running the example without any additional options on the HotSpot VM (or with explicit <code>-Xint</code> ). </p><br><p>  Result <strong>C is</strong> achieved on many compilers (for example, HotSpot C1 / C2, Excelsior JET JIT &amp; AOT, ...).  The compilers are smart enough to calculate that the <code>obj</code> variable is not used and by the first call to <code>get()</code> nothing prevents the GC from destroying the object.  However, most often GC will come only when <code>System.gc()</code> explicitly called; this behavior is manifested on HotSpot VM from <code>-Xcomp</code> or Excelsior JET in any mode. </p><br><p>  Option <strong>A is</strong> theoretically achievable if the GC comes, for example, at the end of the execution of the <code>WeakReference</code> constructor. </p><br><p>  The problem is based on a bug in the JDK 8 code, where the method argument was inaccurately kept in a <code>WeakReference</code> and died during the execution of the method.  About this there is a separate detailed <a href="https://www.excelsiorjet.com/blog/articles/the-object-is-dead-long-live-the-object">post</a> in our technical blog. </p></div></div></div></div><br><h3 id="zadacha-2">  Task 2 </h3><br><p>  An evil hacker deleted the original java file and shuffled the pieces of your class file: </p><br><pre> <code class="hljs go">A: <span class="hljs-number"><span class="hljs-number">0700</span></span> <span class="hljs-number"><span class="hljs-number">0401</span></span> <span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-number"><span class="hljs-number">4300</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span> <span class="hljs-number"><span class="hljs-number">0300</span></span> <span class="hljs-number"><span class="hljs-number">0100</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> B: <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> C: <span class="hljs-number"><span class="hljs-number">6</span></span>a61 <span class="hljs-number"><span class="hljs-number">7661</span></span> <span class="hljs-number"><span class="hljs-number">2f</span></span>6c <span class="hljs-number"><span class="hljs-number">616</span></span>e <span class="hljs-number"><span class="hljs-number">672f</span></span> <span class="hljs-number"><span class="hljs-number">4f</span></span>62 <span class="hljs-number"><span class="hljs-number">6</span></span>a65 <span class="hljs-number"><span class="hljs-number">6374</span></span> D: cafe babe <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0031</span></span> <span class="hljs-number"><span class="hljs-number">0005</span></span> <span class="hljs-number"><span class="hljs-number">0700</span></span> <span class="hljs-number"><span class="hljs-number">0201</span></span> <span class="hljs-number"><span class="hljs-number">0010</span></span></code> </pre> <br><p>  Rearrange them so that a verified class file is obtained. </p><br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  The correct answer is: <strong>D</strong> , <strong>C</strong> , <strong>A</strong> , <strong>B.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  This task is rather wit, but still teaches something new. </p><br><p>  <a href="https://en.wikipedia.org/wiki/Java_class_file">It is widely known</a> that a class file begins with a four-byte header <code>0xCAFEBABE</code> , which means <strong>D is</strong> exactly the first.  Common sense dictates that a short piece of <strong>B</strong> comes last - this is the tail. </p><br><p>  Then it was possible to recall that the class file contains a <a href="https://en.wikipedia.org/wiki/Java_class_file">ConstantPool</a> , in which there are string constants consisting of two-byte length and the actual string encoded in UTF-8.  The only piece that is similar to UTF-8 is the <strong>C</strong> piece - this is the UTF-8 representation of the <code>java/lang/Object</code> string (a link to the superclass of our class).  So before it should be bytes <code>0x0010</code> (the string has a length of 16), and the only suitable option is <strong>D</strong> , that is, <strong>C</strong> is the second. </p><br><p>  Alternatively, it was possible to notice that the entire last line <strong>B</strong> consists of zeros, which means that the last but one line should end in zeros, that is, it is <strong>A</strong> ! </p><br><div class="spoiler">  <b class="spoiler_title">Javap output</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">minor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">version</span></span></span><span class="hljs-class">: 0 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">major</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">version</span></span></span><span class="hljs-class">: 49 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">flags</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ACC_SUPER</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Constant</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pool</span></span></span><span class="hljs-class">: #1 </span></span>= Class #<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment">// java/lang/Object #2 = Utf8 java/lang/Object #3 = Class #4 // C #4 = Utf8 C { }</span></span></code> </pre> </div></div></div></div></div></div><br><h3 id="zadacha-3">  Task 3 </h3><br><p>  After listening to the next report about Graal, having enthusiastically looked at the JVM Compiler Interface, you decided to write your own compiler for Java!  And we decided to start by generating the x86_64 code for the method: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !x; }</code> </pre> <br><p>  What generated code will be correct for this method? </p><br><p>  <em>Legend: Intel-syntax is used, the calling convention is such that the <code>rcx</code> contains an argument, and <code>rax</code> is the result.</em> </p><br><pre> <code class="hljs vbscript">A: test ecx, ecx jnz <span class="hljs-literal"><span class="hljs-literal">True</span></span> mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> ret <span class="hljs-literal"><span class="hljs-literal">True</span></span>: mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> ret B: <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> eax, eax test ecx, ecx jnz <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> add eax, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span>: ret C: mov eax, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sub</span></span> eax, ecx ret D: mov eax, ecx <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> eax, <span class="hljs-number"><span class="hljs-number">1</span></span> ret</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  The correct answer is: <strong>A</strong> , <strong>B.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  Increasingly at Java conferences, you can see assembler listings, but in case you are not familiar with <a href="https://en.wikipedia.org/wiki/X86_instruction_listings">the Intel x86 instruction set</a> , below is the equivalent C code: </p><br><pre> <code class="hljs lua">A: res = (<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; B: res = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">arg</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) res += <span class="hljs-number"><span class="hljs-number">1</span></span>; C: res = <span class="hljs-number"><span class="hljs-number">1</span></span>; res -= <span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>; D: res = <span class="hljs-built_in"><span class="hljs-built_in">arg</span></span>; res ^= <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  In fact, all these inversion algorithms work correctly, while the input argument takes the usual logical values <code>0</code> and <code>1</code> . </p><br><p>  Next comes the interesting.  From the point of view of the <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-4.html">verifier,</a> all short integer types ( <code>boolean</code> , <code>byte</code> , <code>char</code> , <code>short</code> ) are equivalent to the type <code>int</code> .  <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-2.html">Moreover</a> , <code>boolean</code> -specific byte-code instructions do not exist at all.  For example, the <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-6.html">byte-code instructions of</a> the method under study are as follows: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-number"><span class="hljs-number">0</span></span>: iload_0 <span class="hljs-number"><span class="hljs-number">1</span></span>: ifne <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: iconst_1 <span class="hljs-number"><span class="hljs-number">5</span></span>: goto <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: iconst_0 <span class="hljs-number"><span class="hljs-number">9</span></span>: ireturn</code> </pre> <br><p>  Thus, a method accepting a <code>boolean</code> must be ready to work with any <code>int</code> , and any non-zero value is treated as <code>true</code> .  In this case, the ‚Äúoptimized‚Äù options <strong>C</strong> and <strong>D</strong> start to behave incorrectly <code>C(2) = -1</code> and <code>D(2) = 3</code> , and the more straightforward <strong>A</strong> and <strong>B</strong> continue to work <code>A(2) = B(2) = 0</code> . </p><br><p>  To illustrate these subtleties will have to manipulate the byte code.  The example <a href="https://github.com/excelsior-oss/excelsior-jet-samples/tree/master/jbreak-quiz/3-invert-boolean">is available on GitHub</a> : the numbers 0, 1, 2, 3, -1 are passed to the <code>invert</code> method, and the result is output, followed by calls to <code>println(boolean)</code> and <code>println(int)</code> . </p><br><p>  A curious fact: in JDK 8, the HotSpot C2 compiler generated option <strong>D</strong> , and in JDK 9, the generation template was changed to a more correct one. </p><br><div class="spoiler">  <b class="spoiler_title">Code generated by HotSpot C2 on Intel x86_64</b> <div class="spoiler_text"><p>  In JDK 8, the pattern <strong>D</strong> and the incorrect result returned are clearly visible: </p><br><pre> <code class="hljs go">$ jdk8/bin/java -Xcomp -Xbatch -XX:-TieredCompilation -XX:CompileCommand=<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>,Inverter.invert -XX:+UnlockDiagnosticVMOptions -XX:PrintAssemblyOptions=intel BooleanHell ... Compiled method (c2) <span class="hljs-number"><span class="hljs-number">1216</span></span> <span class="hljs-number"><span class="hljs-number">533</span></span> Inverter::invert (<span class="hljs-number"><span class="hljs-number">10</span></span> bytes) ... # {method} {<span class="hljs-number"><span class="hljs-number">0x0000000012600d</span></span>08} <span class="hljs-string"><span class="hljs-string">'invert'</span></span> <span class="hljs-string"><span class="hljs-string">'(Z)Z'</span></span> in <span class="hljs-string"><span class="hljs-string">'Inverter'</span></span> # parm0: rdx = boolean # [sp+<span class="hljs-number"><span class="hljs-number">0x20</span></span>] (sp of caller) <span class="hljs-number"><span class="hljs-number">0x00000000057d</span></span>7ac0: sub rsp,<span class="hljs-number"><span class="hljs-number">0x18</span></span> <span class="hljs-number"><span class="hljs-number">0x00000000057d</span></span>7ac7: mov QWORD PTR [rsp+<span class="hljs-number"><span class="hljs-number">0x10</span></span>],rbp ;*synchronization entry ; - Inverter::invert@<span class="hljs-number"><span class="hljs-number">-1</span></span> (line <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">0x00000000057d</span></span>7acc: mov eax,edx <span class="hljs-number"><span class="hljs-number">0x00000000057d</span></span>7ace: xor eax,<span class="hljs-number"><span class="hljs-number">0x1</span></span> ;*ireturn ; - Inverter::invert@<span class="hljs-number"><span class="hljs-number">9</span></span> (line <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">0x00000000057d7ad</span></span>1: add rsp,<span class="hljs-number"><span class="hljs-number">0x10</span></span> <span class="hljs-number"><span class="hljs-number">0x00000000057d7ad</span></span>5: pop rbp <span class="hljs-number"><span class="hljs-number">0x00000000057d7ad</span></span>6: test DWORD PTR [rip+<span class="hljs-number"><span class="hljs-number">0xfffffffffdf</span></span>58524],eax # <span class="hljs-number"><span class="hljs-number">0x0000000003730000</span></span> ; {poll_return} <span class="hljs-number"><span class="hljs-number">0x00000000057d7ad</span></span>c: ret ... <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">-2</span></span>)</code> </pre> <br><p>  In JDK 9, we <a href="https://bugs.openjdk.java.net/browse/JDK-8161720">improved the</a> normalization of <code>boolean</code> values: adding the input argument to the {0, 1} range ( <code>test</code> and <code>setne</code> ) and the result was correct: </p><br><pre> <code class="hljs go">$ jdk9/bin/java -Xcomp -Xbatch -XX:-TieredCompilation -XX:CompileCommand=<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>,Inverter.invert -XX:+UnlockDiagnosticVMOptions -XX:PrintAssemblyOptions=intel BooleanHell ... Compiled method (c2) <span class="hljs-number"><span class="hljs-number">4702</span></span> <span class="hljs-number"><span class="hljs-number">1496</span></span> Inverter::invert (<span class="hljs-number"><span class="hljs-number">10</span></span> bytes) ... # {method} {<span class="hljs-number"><span class="hljs-number">0x000001fa974d2d</span></span>c0} <span class="hljs-string"><span class="hljs-string">'invert'</span></span> <span class="hljs-string"><span class="hljs-string">'(Z)Z'</span></span> in <span class="hljs-string"><span class="hljs-string">'Inverter'</span></span> # {method} {<span class="hljs-number"><span class="hljs-number">0x000001fa974d2d</span></span>c0} <span class="hljs-string"><span class="hljs-string">'invert'</span></span> <span class="hljs-string"><span class="hljs-string">'(Z)Z'</span></span> in <span class="hljs-string"><span class="hljs-string">'Inverter'</span></span> # parm0: rdx = boolean # [sp+<span class="hljs-number"><span class="hljs-number">0x20</span></span>] (sp of caller) <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb57720: sub rsp,<span class="hljs-number"><span class="hljs-number">0x18</span></span> <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb57727: mov QWORD PTR [rsp+<span class="hljs-number"><span class="hljs-number">0x10</span></span>],rbp ;*synchronization entry ; - Inverter::invert@<span class="hljs-number"><span class="hljs-number">-1</span></span> (line <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb5772c: test edx,edx <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb5772e: setne al <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb57731: movzx eax,al <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb57734: xor eax,<span class="hljs-number"><span class="hljs-number">0x1</span></span> ;*ireturn {reexecute=<span class="hljs-number"><span class="hljs-number">0</span></span> rethrow=<span class="hljs-number"><span class="hljs-number">0</span></span> return_oop=<span class="hljs-number"><span class="hljs-number">0</span></span>} ; - Inverter::invert@<span class="hljs-number"><span class="hljs-number">9</span></span> (line <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb57737: add rsp,<span class="hljs-number"><span class="hljs-number">0x10</span></span> <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb5773b: pop rbp <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb5773c: test DWORD PTR [rip+<span class="hljs-number"><span class="hljs-number">0xfffffffffdf</span></span>688be],eax # <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>aac0000 ; {poll_return} <span class="hljs-number"><span class="hljs-number">0x000001faf</span></span>cb57742: ret ... <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-literal"><span class="hljs-literal">true</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>) -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> </div></div></div></div></div></div><br><h3 id="zadacha-4">  Task 4 </h3><br><p>  Suddenly, you realize that you are very interested in what can call this method: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">guessWhat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;?&gt; x)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(x.getClass()); }</code> </pre> <br><ul><li>  <strong>A</strong> : <code>class java.util.ArrayList</code> </li><li>  <strong>B</strong> : <code>null</code> </li><li>  <strong>C</strong> : <code>interface java.lang.Iterable</code> </li><li>  <strong>D</strong> : <code>class java.lang.Integer</code> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  The correct answer is: <strong>A</strong> , <strong>D.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  Options <strong>B</strong> and <strong>C are</strong> not possible, since <code>Object.getClass()</code> always returns a non-zero class, and there are no instances of an interface type.  Version <strong>A is</strong> easily implemented: <code>guessWhat(new ArrayList&lt;Object&gt;())</code> . </p><br><p>  However, option <strong>D is</strong> reachable: <code>Integer</code> does not implement the <code>Iterable</code> interface, but nevertheless its instance can come into this method.  The answer is that the severity of the typical Java language system again fell under the weakness of the typical JVM verifier system: any reference type <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-4.html">is assignment compatible</a> with any interface.  That is, almost everywhere where the interface type is expected (including parameters, return value, fields), you can pass any reference value (that is, arbitrary classes and arrays). </p><br><p>  This effect <a href="https://github.com/excelsior-oss/excelsior-jet-samples/tree/master/jbreak-quiz/4-interf-variable">can be demonstrated</a> either by manipulating the bytecode, or by partially recompiling the class files. </p></div></div></div></div><br><h3 id="zadacha-5">  Task 5 </h3><br><p>  Having once again believed in the infallibility of javac, you decided to experiment: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBoolean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBoolean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] a)</span></span></span><span class="hljs-function"> </span></span>{ foo(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> D()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I i)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(i.getBoolean()); } }</code> </pre> <br><p>  What happens when you try to compile and run the <code>Test</code> class? </p><br><ul><li>  <strong>A</strong> : Cannot compile </li><li>  <strong>B</strong> : <code>java.lang.IllegalAccessError</code> thrown </li><li>  <strong>C</strong> : Prints " <code>true</code> " </li><li>  <strong>D</strong> : " <code>false</code> " is printed </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  The correct answer is: <strong>B.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  Many believe that <code>IllegalAccessError</code> is the lot of those who are too clever with partial recompilation or obfuscation.  So it was with us, when <a href="https://sourceforge.net/p/proguard/bugs/662">ProGuard, during obfuscation,</a> gave two different methods (one private, the other default) the same names, and the resulting application began to throw <code>IllegalAccessError</code> . </p><br><p>  However, it turned out that if two such methods will have the same name immediately in the source code, <code>javac</code> compile them without any warnings, and during execution <code>IllegalAccessError</code> also be thrown. </p><br><p>  This behavior of the JVM is explained by the way the target method is searched for the <code>invokeinterface</code> instruction.  According to the <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-6.html">specification</a> , instance-methods of the class and all superclasses are viewed first, and only then a suitable default method is searched among the super-interfaces, and the privacy of the found method is checked only after the entire process is completed. </p><br><p>  Thus, the search ends with the private method <code>getBoolean</code> from the <code>getBoolean</code> <code>C</code> , which got in the way of finding the default of the <code>getBoolean</code> method from the super-interface <code>I</code>  After this, <code>IllegalAccessError</code> is logically thrown. </p><br><p>  Interestingly, in Java 11 it <a href="http://mail.openjdk.java.net/pipermail/compiler-dev/2018-February/011667.html">is planned to change this</a> , and skip private methods in the search process. </p></div></div></div></div><br><h3 id="zadacha-6">  Task 6 </h3><br><p>  Suddenly you find yourself debugging the native code of a compiled Java application.  You do not have the source code, but you have already found the problem method, here it is: </p><br><pre> <code class="hljs css">1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">lea</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rax</span></span>, <span class="hljs-selector-attr"><span class="hljs-selector-attr">[rel _Test_foo]</span></span> 2: <span class="hljs-selector-tag"><span class="hljs-selector-tag">push</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rax</span></span> 3: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eax</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[rcx+0FH]</span></span> 4: <span class="hljs-selector-tag"><span class="hljs-selector-tag">idiv</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[rdx+0FH]</span></span> 5: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rbx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">qword</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[rel _Test_array]</span></span> 6: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ebx</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">dword</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[rbx+3BH]</span></span> 7: <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">eax</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">ebx</span></span> 8: <span class="hljs-selector-tag"><span class="hljs-selector-tag">ret</span></span> 8</code> </pre> <br><p>  You suspect that executing this method could trigger a Java throw of exceptions of various types.  It remains to understand what instructions could be to blame (specify their numbers)? </p><br><ul><li>  <code>StackOverflowError</code> : _________ </li><li>  <code>NullPointerException</code> : _________ </li><li>  <code>ArithmeticException</code> : _________ </li><li>  <code>IndexOutOfBoundsException</code> : _________ </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  Correct answer: </p><br><ul><li>  <code>StackOverflowError</code> : 2 </li><li>  <code>NullPointerException</code> : 3, 4, 6 </li><li>  <code>ArithmeticException</code> : 4 </li><li>  <code>IndexOutOfBoundsException</code> : none </li></ul><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  The compiler can generate exception checks in various ways.  For example, before accessing the field of an object, it is possible to generate an <em>explicit</em> check of the object for difference from <code>null</code> with an exception throw in case of failure.  However, such explicit checks negatively affect the performance and size of the code.  Therefore, the compiler tries to do with <em>implicit</em> checks: only the pointer dereference code is generated, which in the case of a null pointer will result in a hardware exception, which the JVM will catch, recognize and rethrow as the corresponding Java exception. </p><br><p>  In this problem, it was just necessary to find instructions that could trigger such implicit exceptions. </p><br><p>  <code>StackOverflowError</code> occurs when trying to write / read the next stack slot outside the allowed range.  This can occur in a <code>push rax</code> instruction. </p><br><p>  There is also a single candidate for <code>idiv dword [rdx+0FH]</code> implicit <code>ArithmeticException</code> : the integer division instruction <code>idiv dword [rdx+0FH]</code> .  If the dereferenced value is zero, a hardware division by zero will occur, followed by an <code>ArithmeticException</code> . </p><br><p>  Implicit checks where <code>NullPointerException</code> can be thrown are very popular in Java code.  To find them, it is enough to consider all the places where something is dereferenced.  The instruction <code>mov rbx, qword [rel _Test_array]</code> dereferences static data to a relative address, so it can never lead to errors.  But the instructions <code>mov eax, dword [rcx+0FH]</code> , <code>idiv dword [rdx+0FH]</code> , <code>mov ebx, dword [rbx+3BH]</code> dereference method parameters and read static data, that is, they can throw a <code>NullPointerException</code> . </p><br><p>  Interestingly, the <code>idiv dword [rdx+0FH]</code> contains two implicit checks at once, which <a href="https://www.excelsiorjet.com/blog/articles/an-exceptional-case">can</a> sometimes <a href="https://www.excelsiorjet.com/blog/articles/an-exceptional-case">cause a lot of problems with the JVM</a> . </p><br><p>  An implicit check for an <code>IndexOutOfBoundsException</code> must be in an instruction accessing an array element.  The clue is reading a certain <code>_Test_array</code> into a register and its dereference in instructions <code>5</code> and <code>6</code> .  However, it should be noted that with such a pattern of generation of access to an array element, indices that fall outside the allowable range will simply access the memory on the heap adjacent to the array, which does not trigger any hardware exceptions.  Therefore, on most processor architectures, checks for <code>IndexOutOfBoundsException</code> are explicitly generated.  However, in rare cases, the compiler may prove that such a test is not needed at all, which is what happens in this task.  That is, an <code>IndexOutOfBoundsException</code> cannot be thrown here at all. </p></div></div></div></div><br><h3 id="zadacha-7">  Task 7 </h3><br><p>  An evil hacker hacked your computer again and edited it in the <code>Helper.class</code> hex editor so that the ending of the <code>sayC</code> method was unverifiable: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.print(<span class="hljs-string"><span class="hljs-string">"A"</span></span>); Helper.sayB(); Helper.sayC(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Helper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.print(<span class="hljs-string"><span class="hljs-string">"B"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.print(<span class="hljs-string"><span class="hljs-string">"C"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// bad bytecode goes here } }</span></span></code> </pre> <br><p>  What happens when you run the <code>Main</code> class? </p><br><ul><li>  <strong>A</strong> : VerifyError will be <code>VerifyError</code> </li><li>  <strong>B</strong> : ‚Äú <code>A</code> ‚Äù is printed and <code>VerifyError</code> thrown <code>VerifyError</code> </li><li>  <strong>C</strong> : ‚Äú <code>AB</code> ‚Äù will be printed and <code>VerifyError</code> thrown <code>VerifyError</code> </li><li>  <strong>D</strong> : ‚Äú <code>ABC</code> ‚Äù is printed and <code>VerifyError</code> thrown <code>VerifyError</code> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer and Decision</b> <div class="spoiler_text"><p>  The correct answer is: <strong>B.</strong> </p><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text"><p>  Verification of the byte-code of a certain class works before any method of this class is executed.  In the class <code>Helper</code> there is an <code>sayC</code> method <code>sayC</code> , which means that the whole class is completely unverifiable.  Thus, options <strong>C</strong> and <strong>D are</strong> definitely wrong: execution never reaches the <code>sayB</code> method. </p><br><p>  Next, you need to understand at what point <code>VerifyError</code> thrown.  <a href="https://docs.oracle.com/javase/specs/jvms/se9/html/jvms-5.html">According to the specification</a> , link resolution errors should be thrown when the link is required at runtime, even if the JVM has link resolution vigorous (all links are resolved right away when the class is loaded).  In this task, the reference to <code>Helper</code> needed only after the ‚Äú <code>A</code> ‚Äù output, so the correct answer is <strong>B.</strong> </p><br><p>  <a href="https://github.com/excelsior-oss/excelsior-jet-samples/tree/master/jbreak-quiz/7-verifier">A good example</a> demonstrates the described behavior.  Unverifiable bytecode obtained by manual manipulation. </p><br><p>  More details about Java bytecode verification were described by Nikita Lipsky aka <a href="https://habrahabr.ru/users/pjbooms/" class="user_link">pjBooms</a> on <a href="https://2018.jbreak.ru/talks/rnonkzfgseamss6qqews4">JBreak 2018</a> (so far only slides) and on <a href="http://2017.jpoint.ru/talks/java-byte-code-verification-when-how-or-maybe-to-turn-it-off">JPoint 2017</a> ( <a href="https://www.youtube.com/watch%3Fv%3Dm16AIz1fIFI">there is a video</a> ). </p></div></div></div></div><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Although at the conference some were frightened by the type of assembler, there were quite a few people who decided to dive into the subtleties of the JVM: everyone who passed the tasks to our booth, we conducted an express course on the subtleties of the byte code, verifier and implicit exceptions.  I hope you, having read the decisions, <em>have learned something new</em> .  If so, then our goal is achieved! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/350638/">https://habr.com/ru/post/350638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350626/index.html">Flask Mega-Tutorial, Part XIV: Ajax</a></li>
<li><a href="../350628/index.html">Software Transactional Memory on Free Monads</a></li>
<li><a href="../350630/index.html">Unleash the game code using the Command pattern, and debugging while flying on the time machine</a></li>
<li><a href="../350632/index.html">Security Week 7: Dating through a coder and spam updates</a></li>
<li><a href="../350636/index.html">Cooking Juniper Network with Ansible</a></li>
<li><a href="../350640/index.html">Bathroom mosaic and Diophantine equations</a></li>
<li><a href="../350642/index.html">How I earned $ 200,000 at 16</a></li>
<li><a href="../350646/index.html">How we communicate with React components using TypeScript decorators</a></li>
<li><a href="../350648/index.html">Creating and hosting a telegram bot. From A to Z</a></li>
<li><a href="../350654/index.html">Interview on Data Science: what is expected of you</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>