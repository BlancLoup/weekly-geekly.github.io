<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anonymous chat TorChat and its improvement</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TorChat is an anonymous, cross-platform instant messenger that uses the Tor network and encrypts correspondence. This article describes the protocol u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Anonymous chat TorChat and its improvement</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://github.com/prof7bit/TorChat"><img src="https://habrastorage.org/getpro/habr/post_images/74b/b3e/4d4/74bb3e4d441f84b821b7154789522940.png" alt="TorChat"></a> <br><br>  TorChat is an anonymous, cross-platform instant messenger that uses the Tor network and encrypts correspondence.  This article describes the protocol used by TorChat, and the improvements made to the TorChat implementation in Python. <br><a name="habracut"></a><br><h4>  Introduction, description of Tor and hidden service </h4><br>  Tor's anonymity system, which often pops up in the media, serves to anonymously visit and create websites.  Anyone can get a ‚Äúdomain‚Äù of the form <b>test3unszyhvy7um.onion</b> and in a few seconds this site will be available for all users of the Tor network to visit.  To create a domain, an RSA key is created, from the public part of which the hash sum is calculated (in the case of this domain, it is equal to test3unszyhvy7um).  Tor remembers matching a domain name to a public key in the DHT.  This site is called hidden service.  Tor creates a TCP connection between the client and hidden service.  Through such a connection, you can skip different protocols: HTTP (S), SSH, IRC, Bitcoin, and others.  A description of one of these protocols, TorChat, is in the next section. <br><br>  <a href="">The algorithm for connecting to hidden service is</a> not directly related to the topic of the article, its consideration deserves a separate article.  So far I will note important points.  The hidden service domain name cannot be selected without access to the private part of the RSA key.  It is impossible to listen to the channel between the client and hidden service or replace the data on this channel.  It is impossible to find the IP address where the hidden service is running or the IP address of its client. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  TorChat protocol </h4><br>  This section is based on the <a href="https://github.com/prof7bit/TorChat/blob/torchat_py/torchat/src/tc_client.py">tc_client.py</a> file.  There are enough comments in the file, but there is no protocol in text form. <br><br>  Clients interact directly through Tor, there are no servers in the TorChat system.  The client starts its own Tor process or uses an already running Tor, controlling it via the Control port. <br><br>  Each user has his own hidden service with a domain name like abc.onion, on which he listens to port 11009. The first part of the name (abc) has a length of 16 characters, may consist of characters 234567abcdefghijklmnopqrstuvwxyz (base32) and serves as a TorChat ID.  Each user has the ability to connect to other users through their TorChat ID. <br><br>  Tor guarantees that only the creator, the holder of the corresponding key, can control this domain name.  However, there is no information about who connects to the hidden service, so the authentication includes the creation of a reverse connection.  So let's say Alice (alice.onion) connects to Bob (bob.onion).  To do this, Alice sends Bob a message like "ping alice &lt;random string from Alice&gt;".  Bob sends Alice "ping bob &lt;random string from Bob&gt;" and "pong &lt;random string from Alice&gt;".  Alice replies "pong &lt;random string from Bob&gt;".  The parties compare sent and received random strings.  Matching the lines confirms that the incoming connection is really from who it "presents".  Thus, both have a pair of sockets (incoming and outgoing) and confidence that the incoming socket is from the same person the outgoing is sent to.  Socket messages are transmitted only in one direction (with the exception of file transfers that are sent in the opposite direction, so as not to compete with text transmission). <br><br>  TorChat protocol message scheme: <br><pre> &lt;command&gt; &lt;encoded&gt; \ n
</pre><br>  The command can contain only lowercase Latin letters and underscores.  Encoded consists of any characters except the end of line character.  The end of line character is replaced by ‚Äú\‚Äù and ‚Äún‚Äù.  Previously, "\" is replaced by "\" and "\". <br><br>  List of commands: <br><ul><li>  <b>ping, pong</b> - see above. </li><li>  <b>not_implemented</b> - sent to the sender if the recipient does not understand the command. </li><li>  <b>client</b> - transmits the name of the client, for example TorChat. </li><li>  <b>version</b> - sends the client version, for example, 0.9.9.553. </li><li>  <b>status</b> - passes the status. <img src="https://habrastorage.org/getpro/habr/post_images/1a7/fba/741/1a7fba74188fec7042039fea8311843f.png">  Available <img src="https://habrastorage.org/getpro/habr/post_images/957/886/832/957886832b821f3b1d0b3d026801192a.png">  walked away <img src="https://habrastorage.org/getpro/habr/post_images/8ed/489/413/8ed489413edf279437728885e8cdf94c.png">  busy (xa).  There are other statuses that are not transmitted: <img src="https://habrastorage.org/getpro/habr/post_images/a60/94c/84f/a6094c84f23bf5389359539fa7c492df.png">  offline (offline), <img src="https://habrastorage.org/getpro/habr/post_images/f66/48c/742/f6648c7428771712d8bac2e1b86becbf.png">  waiting for a handshake  Handshake continues from the moment an outgoing connection is established and a ping is sent, but no pong is received.  The client reports his status after pong, after changing the status or at least once every 120 seconds. </li><li>  <b>profile_name</b> - passes the nickname of the user.  Nick is optional.  In addition to the nickname, which the user says about himself, there is a local nickname that the local user assigned.  The local nick has higher priority when displayed. </li><li>  <b>profile_text</b> is an optional detailed description that a user can fill out about himself. </li><li>  <b>profile_avatar_alpha</b> - avatar's alpha channel (64 * 64 * 8 bits).  Sent to the data of the avatar itself.  If the avatar is not present, then this message is skipped or sent by launching a string. </li><li>  <b>profile_avatar</b> - avatar (64 * 64 * 24 bits).  Optional.  If sent, then sent after profile_avatar_alpha. </li><li>  <b>add_me</b> - request to add to the contact list.  Customer version 0.9.9.553 agrees to add to the contact list of all comers. </li><li>  <b>remove_me</b> - request to exclude from the list of contacts.  The client should not automatically be added back to the contact list after receiving such a message. </li><li>  <b>message</b> is a plain text message.  Client version 0.9.9.553 rejects messages if the sender is not in the contact list. </li><li>  <b>filename</b> - file transfer request.  It includes the transmission identifier, the size in bytes, the block size in bytes (ignored by the receiver in version 0.9.9.553) and the name of the file being transferred.  Fields are separated by a space.  This and other file transfer commands are sent through an incoming connection, and not through an outgoing connection, so that file transfer does not interfere with textual correspondence.  To start the transfer does not require confirmation of the receiving party, both parties can cancel the active transfer.  Client version 0.9.9.553 records the transfer to a temporary file, after the transfer is completed, the data is transferred to the file specified by the user. </li><li>  <b>filedata</b> - sends a fragment of the file.  It includes the transmission identifier, the offset in bytes, the fragment md5 and the fragment itself.  Sent in order. </li><li>  <b>filedata_ok</b> - confirmation of receipt of a fragment of the file.  Includes transmission identifier and offset in bytes.  Sent in order.  The sender stops sending fragments if it does not receive confirmation of their receipt.  In client version 0.9.9.553, the transfer is suspended after 16 unconfirmed fragments. </li><li>  <b>filedata_error</b> - sent instead of filedata_ok in case of a receive error (skip fragment, md5 mismatch).  Includes transmission identifier and offset in bytes.  The sender must resume transmission from the specified location. </li><li>  <b>file_stop_sending</b> - the sender transmits this command if it decides to abort the transfer.  Includes a transfer ID. </li><li>  <b>file_stop_receiving</b> - the receiver transmits this command if it decides to abort the transfer.  Includes a transfer ID. </li></ul><br><br><h4>  Implementations </h4><br>  I managed to find 4 implementations of the TorChat client. <br><br>  Python torchat_py from Prof7bit (Bernd Kreuss, Hannover, Germany), 2007.  The first implementation.  Now it is in the torchat_py repository on github. <br>  <b><a href="https://github.com/prof7bit/TorChat/tree/torchat2">torchat2</a></b> on Lazarus + Free Pascal by Prof7bit.  New implementation, 2012.  Simplified to run multiple instances on the same machine.  The kernel is completely separate from the GUI, which allows you to run, including without a GUI.  Implemented a plugin for the Purple library, which is used by IM-clients Pidgin and Finch.  Uses just one execution thread per program.  Python's creates multiple threads for each contact. <br>  <b><a href="http://www.sourcemac.com/%3Fpage%3Dtorchat">TorChat for Max OS X</a></b> from Julien-Pierre Av√©rous, France.  In 2010, it was written in C ++, in 2013, the code was uploaded to <a href="https://github.com/javerous/torchat-mac">github</a> , then from C ++, they moved to Objective-C.  It is possible to make private notes about the interlocutor or block the interlocutor.  There is a multiplayer chat. <br>  <b><a href="https://github.com/jtorchat/jtorchat">jTorchat</a></b> in Java from daux2a.  Written in 2012.  File transfer is not implemented.  Added a broadcast mode that allows you to send messages to all users of the TorChat network, even those who are not in the contact list.  Implemented a random chat request from the network. <br><br><h5>  Representation in official distributions </h5><br>  The distributions of Gentoo, Debian, OpenSuse, Fedora and Windows have been studied. <br>  At the moment TorChat is included only in the Debian distribution. <br>  Package Page: <a href="http://packages.debian.org/wheezy/torchat">packages.debian.org/wheezy/torchat</a> <br><br><h4>  Python implementation </h4><br>  Consider the implementation of TorChat in Python version <a href="https://github.com/prof7bit/TorChat/tree/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src">0.9.9.553</a> . <br><br>  When sending messages to a recipient who is not online, these messages are stored locally and sent with the [delayed] prefix when the recipient appears on the network at the same time as the sender.  The sender is notified [delayed messages have been sent]. <br><br>  If you leave TorChat turned on for a week and do not use it, you‚Äôll get about 50 megabytes of outgoing and 100 incoming traffic.  Creating a new account occurs instantly (RSA key generation time), the first activation takes half a minute.  Subsequent activations occur in a couple of seconds.  Apparently, during the first activation, time is spent on the ‚Äúfirst acquaintance‚Äù of the Tor program with the Tor network. <br><br>  When creating a new account TorChat, it is automatically added to the contacts to itself under the nickname self.  This is useful for many reasons.  Firstly, the status of this contact shows whether our account is online.  Secondly, you can quickly copy your TorChat ID (right mouse button - Copy ID to clipboard).  Third, by ‚Äúchatting‚Äù with you, you can estimate the network latency.  Usually ping about 1 second.  Fourthly, this contact is convenient to use in plugins, for example in a conference (see below). <br><br>  The portable.txt file is in the program folder.  If it is, the program folder is used to store configs.  Otherwise, the folder ~ / .torchat or ~ / .torchat_ &lt;account name&gt; is used.  The account name is supplied as a command line argument.  The config includes the buddy-list.txt and torchat.ini files and the Tor folder with an RSA key. <br><br>  <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">Of</a> interest are the modules <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">tc_client.py</a> (kernel), <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_gui.py">tc_gui.py</a> (GUI), <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/dlg_settings.py">dlg_settings.py</a> (settings window), <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/config.py">config.py</a> (settings storage). <br><br>  In the <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">tc_client.py</a> file <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">there</a> are classes: <br><ul><li>  <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">BuddyList</a> - a list of contacts.  One copy of the class for the program.  It has methods for <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">adding</a> and <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">removing</a> contacts. </li><li>  <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">Buddy</a> - contact.  May or may not be in the contact list.  The method for <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">sending a message</a> and a little higher method that works when receiving messages. </li><li>  Classes "ProtocolMsg_ &lt;command&gt;", the heirs of <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_client.py">ProtocolMsg</a> are the managers of protocol messages.  The execute (self) method is responsible for the action performed when the corresponding command is received.  These classes are very convenient for plugin development. </li></ul><br>  The <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_gui.py">tc_gui.py</a> file <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_gui.py">contains</a> the wxPython code.  Of the interesting classes: <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_gui.py">ChatWindow</a> (chat window), <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/tc_gui.py">MainWindow</a> (main window, contains a link to BuddyList). <br><br>  There is only one class in the <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/dlg_settings.py">dlg_settings.py</a> file, Dialog, which is responsible for the settings window.  Adding your items to the settings window from the plugin is done by changing the <a href="https://github.com/bit-fag/TorChat/blob/34ea697e950bc3c25130d3fc8911ae86098686d0/torchat/src/dlg_settings.py">addPluginSettings</a> method (the method is added to my fork). <br><br>  The <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/config.py">config.py file</a> contains the <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/config.py">set</a> and <a href="https://github.com/prof7bit/TorChat/blob/17e7e51d1ed330807ba9d3df5481e6eca32e7068/torchat/src/config.py">get</a> wrappers for the ConfigParser from the standard Python library.  In the same file are the values ‚Äã‚Äãof the default settings (config_defaults).  Settings are stored in the file torchat.ini. <br><br>  The contact list is stored in the buddy-list.txt file in a table format (torchat_id [local nickname]). <br><br>  Translations are implemented as lang_xx.py files, where xx is the language code.  The files are in the <a href="https://github.com/bit-fag/TorChat/tree/34ea697e950bc3c25130d3fc8911ae86098686d0/torchat/src/translations">translations</a> folder.  Each text for translation is stored in a variable referenced from the rest of the program.  Non-standard option, but convenient when writing plug-ins: you just need to create the necessary variables in the appropriate modules.  TorChat is translated into many languages, including Russian (2011, translator: SB14.org, RusInfo.cc). <br><br><h4>  Python implementation improvements </h4><br>  People complained that TorChat lacks some functions.  Some of them, such as the ability to run multiple instances, are very simple to implement.  It is strange that the author did not immediately make them.  Others (for example, multi-user chats) are not so simple, but they can be implemented without changing the protocol (the method was described in Habr√©).  Finally, there are things that require protocol changes, such as voice communication.  I'm not at all sure that its implementation is possible, taking into account the delays of the Tor network.  Finally, there are things that probably will not work.  These things include video calling. <br><br>  When a critical mass of requests to TorChat had accumulated, I began to think about how to get these functions.  Unfortunately, the main developer is currently inactive, he is not in TorChat and cannot be contacted by mail.  I didn‚Äôt want to write on Pascal, Java, Objective-C or Max OS X, so I relied on the old Python implementation, contrary to the author‚Äôs preferences.  Python and the implementation of TorChat in Python have proven to be very convenient for writing plugins and making improvements.  An additional argument was that it was the Python implementation that was included in at least one distribution kit, Debian. <br><br>  When I began to study the source code, at first it seemed to me that it was not for nothing that they said that the code was of poor quality.  Apparently, the description of the protocol contributed to this exclusively in the source code.  However, then I looked and saw that the protocol and implementation were carried out conscientiously.  I daresay that the author, when he wrote this code a few years ago, did not have much experience with Python.  In some places you can meet &lt;&gt;, which speaks of the "Baysik" or "Pascal" past.  However, the code is written to fame. <br><br>  I <a href="https://github.com/bit-fag/TorChat/tree/torchat_py">forked the</a> repository on github and pretty quickly did everything I wanted.  What was done: <br><ul><li>  <b>Plugin system</b> .  At startup, the program searches for plugins in the subfolder of plugins located in the same folder as the program file (torchat.py) and in the subfolder of plugins located in the same folder as the torchat.ini configuration file.  Plugins are Python modules, that is, * .py files.  The plugin must have its name in the variables NAME_xx, where xx is the language code (en, ru, etc).  The plugin must have a load (torchat) function that loads the plugin.  It is supplied with the torchat argument, which contains the link to the torchat module, through which you can get to the other modules (config, tc_client, tc_gui, dlg_settings).  A plugin can replace classes or functions in these modules so as not to break the program or interfere with other plugins.  By default, all plugins are disabled, the user turns on the ones you need in the "Plugins" tab in the settings and restarts the program. </li><li>  <b>Multiple accounts</b> .  The SOCKS5 proxy port launched by Tor and the port on which TorChat accepts incoming connections from Tor are ‚Äúsewn up‚Äù to the original program.  To change them, <a href="https://github.com/prof7bit/TorChat/blob/torchat_py/torchat/doc/howto_second_instance.html">it was necessary</a> not only to get into the settings, but also to manually edit the torrc config.  To avoid these difficulties, the default ports were changed to 0, which is interpreted as any free port.  The port set in the settings is now perceived as desired, but not mandatory - if it is busy, the program connects any available port.  The config for Tor with the necessary changes is generated automatically. </li><li>  <b>Change the display name and version of the client</b> as a <a href="https://github.com/bit-fag/TorChat/blob/torchat_py/torchat/src/plugins/fake_user_agent.py">plugin</a> .  The more versions of TorChat, the wider the possibilities for using this information for de-anonymization or matching.  Usually, programs resist such functions, but this is still anonymous chat, not a browser, so anonymity comes first.  Moreover, this is done in the form of a plugin, which is disabled by default. </li><li>  <b>Ping companion</b> in the form of a <a href="https://github.com/bit-fag/TorChat/blob/torchat_py/torchat/src/plugins/ping.py">plugin</a> .  Sends ping and measures delay before getting pong.  The delay appears in the chat window.  To measure ping, an item is made in the chat context menu.  For the sake of this plugin, I had to change tc_client.py, to allow pong to be sent more than once per connection.  The change does not violate security and is compatible with previous versions. </li><li>  <b>Game stone-scissors-paper</b> in the form of a <a href="https://github.com/bit-fag/TorChat/blob/torchat_py/torchat/src/plugins/rps.py">plug</a> .  Adds items to choose from the chat context menu.  The game protocol is as follows: each opponent chooses a stone ‚Äúr‚Äù, scissors ‚Äús‚Äù or paper ‚Äúp‚Äù and random salt no shorter than 10 characters.  The result of adding the lines: salt, "-" and the choice (1 letter) - is in clear text.  From it sha1 is calculated and sent to the opponent.  Then the plaintext is sent.  I found a <a href="http://pastebin.com/7PeXNhwB">bash script</a> for playing on one of OnionNet's IRC channels.  I liked the idea and I wrote <a href="https://github.com/bit-fag/rpsqt">a Qt program</a> for the game.  In TorChat, this game also does not hurt. </li><li>  <b>Password</b> to add to the contact list as a <a href="https://github.com/bit-fag/TorChat/blob/torchat_py/torchat/src/plugins/add_password.py">plugin</a> .  In the settings you enter a password and a hint to it (optional).  When you add an account to your contacts, an automatic message is sent asking you to enter a password and a hint.  If the password is entered correctly, the account is added to the contact list.  Until then, there are no manifestations of attempts to add to contacts.  This plugin can be useful for protection from random idlers or from spam.  If bots for sending spam via TorChat appear, the password ‚Äú4‚Äù with the prompt ‚Äútwo and two‚Äù will save them. </li><li>  <b>Conferences are</b> implemented as a <a href="https://github.com/bit-fag/TorChat/blob/torchat_py/torchat/src/plugins/conference.py">plugin</a> .  The account on which this plugin is uploaded turns into a conference server, and people from its contact list become conference members.  When someone from the contact list writes something to the conference, she forwards his message to all of her online contacts, with a note from whom the message is from.  The conference assigns a role to each user.  The role system is quite simple, similar to the role system in Skype.  The role is retained by the user when he leaves the network or leaves the conference.  In addition to the main role (user), there are guests who can read what others are writing, but cannot write to the conference themselves.  There is a ‚ÄúNobody‚Äù role that can only receive help with the! Help command.  And there is the role of ‚ÄúBanned‚Äù, which can not do anything.  Banned users are automatically disconnected from the conference.  Let's move up the role system: moderator, administrator, owner.  The owner of the conference is only one, this is the conference itself, power emanates from it for administrators whom it can appoint and remove.  Administrators can change different conference settings, including avatar, subject (conference nickname) and description.  Administrators can assign moderators who can kick, ban, insert and remove a gag from the mouth of ordinary users and invite users to the conference.  Administrators can set a default role.  To make a closed conference, you need to explicitly assign all of them their role, and then change the default role to ‚ÄúBanned‚Äù.  You can protect the conference with a password using the appropriate plug-in.  By default, the ‚Äúprefer_nicks‚Äù setting is enabled, which makes torchat ID of conference members invisible to conference members with a role younger than a moderator.  This eliminates the conference members from spam on their torchat ID and complicates the deanonymization.  (You must first find the conference, then ‚Äúshake‚Äù the torchat user ID from its admin, then find it ...) Conference members can send each other private messages through the conference, their contents are not protected from the conference.  Torchat ID can be exchanged via the conference ‚Äúlichku‚Äù and after that you can conduct a dialogue directly via TorChat.  You can ignore users with a role below the moderator, then their messages, including the PM, are not delivered to the ignorer.  A conference <b>pegi5xdl3m4re3c3 has been</b> created for this article. </li><li>  <a href="https://github.com/bit-fag/TorChat/blob/torchat_py/torchat/src/plugins/disable_echo.py">A plugin</a> that disables the display of messages directed to oneself.  Useful in conjunction with the conference plugin so that the conference owner who writes to the conference from the conference account does not see duplicates of his messages. </li><li>  The contact list is now stored in JSON format as part of the configuration INI file.  For contacts is stored not only the local alice, but also the nickname selected by the user. </li><li>  <b>Bugfixes</b> <br><div class="spoiler">  <b class="spoiler_title">List of bugfixes</b> <div class="spoiler_text">  <a href="https://github.com/bit-fag/TorChat/commit/916e7f9d0fc210052bf04e9012db6999bbf1ee08">Fixed a bug when checking for checkboxes</a> <br>  <a href="https://github.com/bit-fag/TorChat/commit/99d64426451dd4e99ef228656f781f94c9a87266">If a user deletes an avatar, then his contacts had an old avatar hung before the program was restarted.</a> <br>  <a href="https://github.com/bit-fag/TorChat/commit/b69465fb816d32c7d9c78edb4540210c248a4dfd">Used proxy type changed from SOCKS4 to SOCKS5</a> <br>  <a href="https://github.com/bit-fag/TorChat/commit/d38d51b5f2135f0b0234ef0bd1d58c29c0dc69b5">Fixed in some cases, the reflection of the change in the user nickname from other users</a> <br>  <a href="https://github.com/bit-fag/TorChat/commit/fe43c02725d52c0ce8e26d7da76559347416078c">Forgotten () after calling the function</a> .  In Python, unlike Pascal, when calling a function without arguments, you cannot skip (). <br>  <a href="https://github.com/bit-fag/TorChat/commit/3f3406884892725d564626d8056f96875068ea9a">Disinfecting the username derived from it</a> .  A name that includes too long words caused the program to crash when trying to display a tooltip for this user. <br></div></div><br>  I would like to include them in Debian separately from the innovations. <br></li></ul><br><br><h4>  What's next? </h4><br><ul><li>  4 execution threads are created for each contact: for the incoming connection, for the outgoing connection, and 2 for the transfer of files (reception, issue).  It is quite wasteful.  You could not create execution streams for file transfers until this transfer occurs.  Better yet, use asyncore and generally reduce everything to a single thread for the entire program.  The problem is that asyncore does not include the ability to connect through a proxy.  I did not find a complete solution for this.  You can highlight this work in a separate project asyncore + socks.  By the way, the Pascal implementation spends only 1 thread per process. <br></li><li>  Dynamically loaded and unloaded plugins.  And without the need to write unload () for each plugin. <br></li><li>  Flexible customization of Tor accounts and processes.  Ability to connect to an already running torus.  Ability to use different Tor processes for inbound and outbound connections.  The ability to use "dual Tor" (Tor, connecting to the network through another Tor).  The use of the <a href="https://tails.boum.org/">tails</a> in the distribution (there is no way to launch a separate Tor process, since such a process will not have access to the network by default).  The ability to directly send messages (not via Tor), if the sender and the recipient are on the same machine (for example, the conference and its administrator).  When changing the configuration, do not restart the Tor process, but update the configuration in the running process via the Control port or the SIGHUP signal (Linux). <br></li><li>  Disposal of dependence on the GUI, the ability to run in console mode or via the web interface. <br></li><li>  The plug-in that creates a ‚Äúsite‚Äù on port 80 of the hidden service, so that you could write messages to the user without installing TorChat, but directly via the Tor Browser.  In conjunction with the conference plugin should get a web chat. <br></li><li>  File sharing plugin that allows you to upload and download files.  Useful in conjunction with the conference. <br></li><li>  Digital signature issued to the user when adding it to contacts.  If the list of contacts is lost, but the key is preserved, then at the new launch contacts will add this user.  To distinguish them from spam bots, it is useful to give them a digital signature in advance confirming that they are in contact.  It is also useful to encrypt the signature with your own key so that she would not prove anything to anyone except us. <br></li><li>  Generate key (s) from random seed.  Only this random seed will be sent to the backup.  Contact list copy is optional (see previous paragraph). <br></li><li>  Plugin for port forwarding from user to user.  Not only TCP, but also UDP support is desirable.  Through the forwarded port it will be possible to pass arbitrary protocols, including audio.  Speaking through Tor is already possible: <a href="http://torfone.org/">torfone.org</a> <br></li><li>  Make changes to upstream.  Open <a href="https://github.com/prof7bit/TorChat/pull/47">pull request</a> .  Back up the fixes to the Debian wheezy and send the new version to the Debian sid. <br></li></ul><br><br>  <b>UPD</b> .  <a href="http://www.fsf.org/blogs/licensing/interview-with-bernd-kreuss-of-torchat">Interview</a> with Bernd Kreuss, author of the stick, August 2013. </div><p>Source: <a href="https://habr.com/ru/post/201696/">https://habr.com/ru/post/201696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201682/index.html">Once again about obfuscation javascript or tale about how i obfuscator wrote. Part 1</a></li>
<li><a href="../201686/index.html">Vanilla JS vs jQuery 2.0</a></li>
<li><a href="../201688/index.html">Autorun Yandex.Disk as systemd service in Fedora 19</a></li>
<li><a href="../201692/index.html">Postmorthem: how to manage to make 14 mistakes, having developed one social game</a></li>
<li><a href="../201694/index.html">Performance comparison of various encryption systems for linux</a></li>
<li><a href="../201698/index.html">Scalable NAS</a></li>
<li><a href="../201700/index.html">API Development for the SolidWorks 2012 Software Package. Part 1</a></li>
<li><a href="../201702/index.html">How-to: robots and brokerage trading system APIs</a></li>
<li><a href="../201704/index.html">Android - iOS - Android</a></li>
<li><a href="../201710/index.html">Google Chrome blocks third-party extensions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>