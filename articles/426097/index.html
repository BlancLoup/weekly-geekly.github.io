<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino. Project "Robot Machine RoboCar4W"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You understand, ‚Äùthe editor explained,‚Äú it must be entertaining, fresh, full of interesting adventures ... So that the reader could not tear himself a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino. Project "Robot Machine RoboCar4W"</h1><div class="post__text post__text-html js-mediator-article"><p>  <em>You understand, ‚Äùthe editor explained,‚Äú it must be entertaining, fresh, full of interesting adventures ... So that the reader could not tear himself away.</em> <br>  I. Ilf, E. Petrov <em>"How Robinson was created"</em> . </p><br><p>  Getting started with Arduino, as with any other software or hardware platform, is always more interesting from a real project.  The programmers at the same time write the code outputting ‚ÄúHello, world‚Äù, arduinists blink the LED.  And everyone is happy as children. </p><br><p>  I decided to start with an advanced project, including with the secret hope of tearing the younger generation from Counter-Strike (it did not work). </p><br><p>  As you can guess from the name of RoboCar4W, the first project was a four-wheel robot machine.  Starting work, I already had programming experience, I was once able to solder, but I didn‚Äôt even know the Arduino pinouts and didn‚Äôt read the documentation at all.  All the wisdom studied in the course of the play and Google to help. </p><a name="habracut"></a><br><p>  Since the project itself is not fundamentally new, such descriptions on the network are sufficient, all components are known, no surprises were assumed.  Therefore, the idea was formulated in the most general terms and the main goal was to dive into the ‚Äúworld of things‚Äù with the help of Arduino, as a platform for rapid prototyping.  In this opus, someone might recognize themselves at the very beginning of the journey. </p><br><p>  All the "hardware" was purchased on ebay, and from my own experience I want to say that it is easier to purchase a starter kit right away (look according to the Arduino Starter Kit) and not to collect it in detail.  Yes, and all come together.  It was decided not to waste time on trifles, to buy a normal chassis, normal wheels, normal engines, so it was "expensive". </p><br><p>  The main secret of successful purchases on eBay is to buy from sellers with a high rating and at the same time carefully read the product description.  There are many articles on the Internet about this. </p><br><p>  What is the Arduino family charge? </p><br><p>  I took Arduino UNO, under it many projects with descriptions.  But now I would take the Arduino Mega 2560, it has more digital and analogue outputs and full compatibility with UNO on projects. </p><br><h1 id="obschee-opisanie-proekta">  General description of the project </h1><br><p>  In the world of software development, this is also called ‚Äúsystem requirements‚Äù. </p><br><p>  The idea of ‚Äã‚Äãthe project was as follows.  The first version of the robot machine called RoboCar4W should perform simple actions: </p><br><ul><li>  move forward </li><li>  measure the distance to the obstacles </li><li>  be able to automatically go around obstacles in front. </li></ul><br><p>  The second version of the machine must be controlled manually via bluetooth from an Android phone. </p><br><p>  To make you work better here, the entire final project of RoboCar4W in the collection (here without bluetooth). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/457/929/cc8/457929cc8554ef727654f53704ece195.jpg" alt="Arduino.  Robocar4w"></p><br><p>  Here is a video of running trials. </p><br><p>  In the first video, RoboCar4W rides automatically with a detour of obstacles on two different versions of the ‚Äúfirmware‚Äù, i.e.  the sketch, therefore, if someone is the most keen and noticed that the behavior of the robot in different episodes is slightly different. </p><br><p> <a href="http://www.youtube.com/watch%3Fv%3DwQMk7E-CupU"><img src="https://habrastorage.org/getpro/habr/post_images/a05/27c/f11/a0527cf11325d83a2b91826412b151b9.jpg" alt="Robot machine RoboCar4W"></a> </p><br><p>  In the second video, RoboCar4W moves using commands transmitted by the ‚Äúdriver‚Äù via Bluetooth from an Android mobile phone.  The phone has Bluetooth RC Car installed.  Moreover, if an obstacle is close ahead, the robot stops, i.e.  ram something does not work (but there is a "secret" button that disables safe mode). </p><br><p> <a href="http://www.youtube.com/watch%3Fv%3DKGV6_hZFcBs"><img src="https://habrastorage.org/getpro/habr/post_images/173/997/d9c/173997d9c4f497310ab582b11007d468.jpg" alt="Robot machine RoboCar4W"></a> </p><br><p>  In the third video, RoboCar4W shows a pre-programmed motion demo program with turns.  The demo program is activated by a team from the same mobile phone for Android.  The robot just rides for a while and makes turns. </p><br><p> <a href="http://www.youtube.com/watch%3Fv%3DjInplYD-rYQ"><img src="https://habrastorage.org/getpro/habr/post_images/820/a73/9f5/820a739f5e40ca959f0c441e53552e4d.jpg" alt="Robot machine RoboCar4W"></a> </p><br><h1 id="algoritm-upravleniya-dvizheniem">  Motion control algorithm </h1><br><p>  It is a mistake to call our way ‚Äúthe algorithm of avoiding obstacles‚Äù or ‚Äúsearching for a path‚Äù.  These are separate mathematical disciplines, pure mathematics.  If you like mathematics very, very much, then google these phrases, you will be provided with reading material for half a year. </p><br><p>  In the meantime, we are interested in things much easier.  Therefore, we call it simple - the algorithm for controlling the movement of a 4-wheeled robot.  Of course we are talking about automatic control without human intervention. </p><br><p>  Here is a simple algorithm written in words, for more complex algorithms you have to (like or not) make up flowcharts. </p><br><p>  Now simultaneously look at the source of the sketch <a href="">RoboCar4W-1.ino</a> . </p><br><ol><li>  We measure the distance to the obstacle ahead. </li><li> If this measured distance is less than the value of <code>DST_TRH_BACK</code> (shortened from the distance threshold), then we stop and drive backwards at the same time turning.  The direction of rotation is chosen as follows: if you have previously turned left, then turn right and vice versa. </li><li>  If the measured distance is greater than <code>DST_TRH_BACK</code> , but less than <code>DST_TRH_TURN</code> , then simply rotate.  The direction of rotation is chosen randomly. </li><li>  If the obstacle is far away, then just go ahead. </li><li>  Repeat all over again. </li></ol><br><p>  What is good that we have 4 wheels and all the leading?  We can perform (program) several types of turns: </p><br><ul><li>  Smooth turn.  All wheels rotate, but the wheels on the one hand rotate faster. </li><li>  Sharp turn.  Wheels rotate on one side only. </li><li>  Turn on the spot.  Like a tractor, the wheels of one side rotate back and the other - forward. </li></ul><br><p>  In the second version of the program, when operating from an Android phone, safe mode, when the robot tries to prevent frontal collisions, can be disabled if the program presses the button twice <br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/256/454/2d3256454e390ed508f62d212ffb1d15.jpg" alt="Button"></p><br><p>  and turned it back on by pressing it once. </p><br><p>  <em>Important note</em> .  All logic is controlled by Arduino.  Android here simply acts as a gaming console (without brains) from the console, its task is to stupidly transmit button presses (i.e. commands) via Bluetooth to the Arduino RoboCar4W. </p><br><h1 id="komponenty">  Components </h1><br><p>  Initially, the machine included a servo drive, which turned the ultrasonic distance meter at a certain angle for measurements in three directions.  But during the tests, due to careless handling, the servo burned down, so now the distance sensor is simply rigidly fixed in front of the case. </p><br><p>  A blessing in disguise, but the sketch has become a little easier. </p><br><p>  For the future, buy the servo the simplest and cheapest, special power, speed and accuracy of turning at a given angle are not needed, and it is quite easy to turn the servo out of order, as it turned out.  A SG90 worth $ 2 is fine. </p><br><p>  So the components of the project RoboCar4W, the description in English is given to facilitate the search on ebay and others like it: </p><br><ul><li>  Arduino UNO R3 </li><li>  Ready Chassis 4 Wheel Drive Mobile Robot Platform Smart Car Chassis Arduino Compatible </li><li>  DC motors (DC) with rotation in both directions - 4 pcs. </li><li>  Wheels - 4 pcs. </li><li>  Board to control 4 DC Motor Drive Shield L293D motors </li><li>  Ultrasonic Distance Meter HC-SR04 Ultrasonic Module Distance Measuring Sensor </li><li>  Ni-MH 1.2 V batteries - 8 pcs. </li><li>  Plastic box holder for batteries; Battery Box holder 4 AA Batteries - 2 pcs. </li><li>  Battery type "Krona" 8.4 V - 1 pc. </li><li>  Optional toggle switch - power switch </li></ul><br><p>  Chassis, DC motors and wheels were purchased immediately in the kit and even with assembly instructions. </p><br><h1 id="raspinovka">  Pinout </h1><br><p>  Analog inputs can be used as digital I / O port pins.  Arduino pins, corresponding to analog inputs, have numbers from 14 to 19. This applies only to Arduino pins, and not to the physical pin numbers of the Atmega microcontroller. </p><br><p>  It is not necessary to draw, you can simply reduce everything to a table.  I did it like this. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/504/d24/fff/504d24fff6bdc78120e1a28a39848967.png" alt="Pinout"></p><br><p>  Pins D4, D7, D8, D12 will be occupied if any DC or step motors are used. </p><br><p>  Pins D9 (Servo # 1 control), D10 (Servo # 2 control) will be occupied only if servos are used. </p><br><p>  By itself, the board for controlling the Motor Drive Shield L293D motors is not occupied by Arduino pins. </p><br><p>  The power supply pins 3.3 V, 5 V and ‚Äúground‚Äù are duplicated on the Motor Drive Shield in sufficient quantities.  Therefore, there is no need to worry about their shortage. </p><br><p>  If you still want to paint beautifully, then the free Fritzing program will help you. </p><br><h1 id="pitanie">  Nutrition </h1><br><p>  This is the second very important point.  A lot depends on nutrition.  For example, a servo-motor starts to consume a large current when the shaft turns through a given angle.  Moreover, if the servo is connected to the 5 V power supply of the Arduino, then the voltage drops and the rest of the circuit starts to fail, and the Arduino can even reboot at the same time. </p><br><p>  In any case, if you use motors in an odd job, the Motor Drive Shield is necessary (or a similar scheme). </p><br><p>  So, we have 4 DC motors (DC), a servo drive, the Arduino board itself, and several sensors.  The motors are the most voracious, but the sensors can be successfully powered from the connectors of the Arduino board itself, so everything is simple with them.  For convenience, I brought the whole economy in one table. </p><br><table><thead><tr><th></th><th>  Recommended or typical voltage.  Current consumption </th><th>  Max voltage </th><th>  What is planned to feed </th><th>  Notes </th></tr></thead><tbody><tr><td>  Arduino UNO R3 board </td><td>  7 - 12V, 200mA (average) </td><td>  6 - 20 </td><td>  ‚ÄúKrone 9V‚Äù Li-ion 650mAh, 8.4V </td><td>  Connector with a plus in the center </td></tr><tr><td>  Servo motor MG-995 </td><td>  5-6 V, 0.1 - 0.3A (peak) </td><td>  4.8 - 7.2 </td><td>  Batteries (5) pcs.  Ni-Mh 1.2V = 6V </td><td>  Food only from a separate source.  If powered with Arduino, everything will be buggy.  Ni-Mh battery voltage 4pcs.  * 1.2V = 4.8V is not enough.  Some argue that this servo should not be used on 6 volts, only 4.8 </td></tr><tr><td>  DC motors (4 pcs.) </td><td>  6 - 8V, current from 70mA to 250mA </td><td>  3 - 12 </td><td>  batteries (5 + 3) pcs.  Ni-Mh 1.2V = 9.6V </td><td>  You will not be able to start the engines from a 9V battery, so do not even waste time (and batteries)! </td></tr><tr><td>  Motor Drive Shield L293D </td><td>  not required </td><td>  4.5 - 36 </td><td>  not required </td><td></td></tr><tr><td>  Bluetooth module HC-0506 </td><td>  3.3 V, 50 mA </td><td>  1.8‚Äì3.6 </td><td>  From pin 3.3V Arduino board </td><td></td></tr><tr><td>  Ultrasonic distance meter HC-SR04 </td><td>  5 V, 2 mA </td><td>  five </td><td>  With pin 5V Arduino board </td><td></td></tr></tbody></table><br><p>  I did not have a DC / DC voltage converter.  Krone 9V was not a very good power source, I just had it already. </p><br><p>  But I refused to use high-capacity Li-ion batteries.  First, because of the high cost, and secondly, in Chinese online shops it is easy to run into a fake.  More precisely, not "easy", but "always."  In addition, Li-ion requires special handling, and it is not safe. </p><br><p>  So, as we see from the table, we need 3 independent power sources: </p><br><ul><li>  For Arduino board and sensors. </li><li>  For servomotor. </li><li>  For 4 DC motors. </li></ul><br><p>  Where is so much to dial?  The Arduino board itself, in any case, must be powered from a separate source, since  when the voltage drops, for example, from switching on the motors, the board can reboot or simply fail.  Here we use the battery of the ‚ÄúKron 9V‚Äù form factor, and the connector that will be connected to the Arduino should be with a ‚Äúplus in the center‚Äù. </p><br><p>  For servomotor and 4-DC motors, you can do with one power source.  The only problem is that the servomotor is designed for a voltage of 5-6V (maximum 7.2V) and a current of 100-300mA (peak), and DC motors require 6-8V (maximum 12V) and a current of 250mA. </p><br><p>  To solve the problem, there are DC-DC converters, but I did not have such.  As a result, I applied my ‚Äúproprietary‚Äù connection scheme (without any downward electronic circuits, only environmentally friendly voltage and current!): I connected 8 pcs.  1.2V batteries in series and made taps in the right places, as shown in the diagram. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f13/3f4/b82/f133f4b82dc88cf2de958804735c73b3.png" alt="Nutrition"></p><br><p>  6B went to the servomotor, and 9.6 to DC motors.  It is clear that the batteries 1--5 will experience increased load. </p><br><p>  To control the servo and DC motors, I used a 4-channel Motor Drive Shield based on the L293D chip. </p><br><h1 id="sborka">  Assembly </h1><br><p>  Assembling the finished chassis is a small problem.  But do not think that without finishing, everything will come together at once.  Therefore, prepare the files. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/f4a/d8b/058f4ad8b7a7b76295d5295dcd63afba.jpg" alt="Assembly"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5bb/d2d/32c/5bbd2d32c5caa7a97d8201bddabae96c.jpg" alt="Assembly"></p><br><p>  Connect normally several motors, servomotor or stepper directly to the Arduino will not succeed.  Since the pins (conclusions) Arduino are weak.  To solve the problem, there is an additional drive control module - Motor Drive Shield based on the L293D chip, which is one of the most common chips designed for this purpose.  The L293D chip is also known as the H-Bridge. </p><br><p>  I used a board that provides 4 channels for connecting on two L293D chips and a shift register.  Purchased on eBay for $ 5. </p><br><p>  This drive control module board has the following characteristics. </p><br><ul><li>  L293D Motor Drive Shield compatible with Arduino Mega 1280 and 2560, UNO, Duemilanove, Diecimila </li><li>  4 channel control </li><li>  motor power from 4.5V to 36V </li><li>  permissible load current 600 mA per channel, peak current - 1.2A </li><li>  overheat protection </li><li>  2 interfaces with a precise Arduino timer (there will be no ‚Äújitter‚Äù) for connecting servomotors to a voltage of 5V, if the supply voltage needs to be higher, then the power connection needs to be redone as described below </li><li>  4 bi-directional DC collector motors or 2 stepper and 2 servomotors can be controlled simultaneously </li><li>  4 bi-directional DC motors each connected to an 8-bit bus to select individual speeds. </li><li>  connection up to 2 stepper drives (unipolar or bipolar), with one coil, double coil or alternating pitch </li><li>  connector for connecting an external source for separate supply of control logic and motors </li><li>  RESET Arduino button </li><li>  Adafruit AFMotor library is used for management. </li></ul><br><p>  Motor Drive Shield requires a little work in order to be able to connect anything after it.  I soldered on top of the necessary connectors, it turned out that's what. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/470/943/060/47094306049d3d9ff9dbe393bd203b1a.jpg" alt="Motor drive shield"></p><br><p>  Motors can be connected to an additional power supply with respect to the Arduino board.  I recommend this type of connection.  To do this, remove, open the jumper, as shown in the picture. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a18/6c0/d8b/a186c0d8b3c77c02a7e260411eb1cbd9.jpg" alt="4 channel L293D Motor Drive Shield. Jumper for external power"></p><br><p>  In this case, the Arduino is powered and the motors are powered independently of each other. </p><br><p>  The LED on the motor-shield glows when there is power to the motors; if it is off, the motors will not work. </p><br><p>  New problem. </p><br><p>  The servo position of the power jumper does not apply, they will still be powered by 5V Arduino.  Since servomotors usually consume a large current and if there is not enough power, the whole device starts to fail, in the "best" case only the servo will fail - it will not turn at a given angle, or all the time before each turn, turn first to 0 degrees and then at a given angle (and if you have time).  Therefore, I recommend powering the servo also from an additional power source.  To do this, you will have to alter the connection scheme a bit: bite off the positive wire (usually red) from the standard connector and connect it directly to the power source. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d2f/6ea/fa1/d2f6eafa1d5721a6e36a38429aa4ad9e.jpg" alt="Refinement to connect power to the servomotor"></p><br><p>  When connecting Motor Drive Shield analog pins are not used.  Digital pins 2, 13 are not used. </p><br><p>  The following pins are used only if the corresponding DC motors or stepper motors (Stepper) are connected and used: </p><br><ul><li>  D11: DC Motor # 1 / Stepper # 1 (activation and speed control) </li><li>  D3: DC Motor # 2 / Stepper # 1 (activation and speed control) </li><li>  D5: DC Motor # 3 / Stepper # 2 (activation and speed control) </li><li>  D6: DC Motor # 4 / Stepper # 2 (activation and speed control) </li></ul><br><p>  These pins will be occupied if any DC / steppers are used: D4, D7, D8, D12. </p><br><p>  The following pins will be occupied only if the corresponding servomotors are used: </p><br><ul><li>  D9: Servo # 1 control </li><li>  D10: Servo # 2 control </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/27f/dd4/746/27fdd474619f83391b6c486a576a31fa.png" alt="Connection table"></p><br><p>  To get started with Motor Drive Shield, you need to download and install the <a href="https://github.com/adafruit/Adafruit-Motor-Shield-library/">Adafruit AFMotor</a> library. </p><br><p>  Sample code for controlling motors: </p><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;AFMotor.h&gt;</span></span></span><span class="hljs-meta"> //   Adafruit #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Servo.h&gt;</span></span></span><span class="hljs-meta"> //     AF_DCMotor motor(1); //   ,    DC    Motor Shiled , ,  frequency Servo servo; //    servo.attach(10); //     9  10 (    Motor Shiled) motor.setSpeed(speed); //   DC   0 ()  255 ( ) motor.run(RELEASE); // DC   motor.run(FORWARD); // DC   motor.run(BACKWARD); // DC   servo.write(90); //    90 .</span></span></code> </pre> <br><p>  DC motor I started to spin only when specifying a speed greater than 100, if less - just buzzing.  The minimum speed of your engine you have to determine experimentally. </p><br><p>  For motors connected to M1 and M2, you can set the frequency: MOTOR12_64KHZ, MOTOR12_8KHZ, MOTOR12_2KHZ, MOTOR12_1KHZ.  The highest speed is achieved at 64KHz, this frequency will be audible, a lower frequency and speed at 1KHz but also uses less energy.  Motors 3 and 4 always run at 1KHz. Other values ‚Äã‚Äãare ignored.  The default is 1KHz everywhere. </p><br><p>  After that, you need to drive test motors.  <a href="https://github.com/tim4dev/arduino/tree/master/project/RoboCar4W/DC_MotorTest">Sketch for testing can be found here</a> .  At the beginning of the sketch, change the motor number in the line (or lines) of the type: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  The sketch rotates the motor (s) for some time in the direction of movement of the robot, and then back.  Look carefully at whether the motor rotates and change the polarity of the connection if necessary. </p><br><p>  We connect the ultrasonic distance meter HC-SR04 Ultrasonic Module.  Pinout pinouts: </p><br><ul><li>  Vcc </li><li>  Trig (T) </li><li>  Echo (r) </li><li>  GND </li></ul><br><p>  The time spent by the ultrasonic rangefinder on the measurement (determined empirically): </p><br><ul><li>  maximum 240 msec if the distance is too large (out of range) </li><li>  at least 1 ms, if the distance is too short </li><li>  a distance of 1.5 m is determined in approximately 10 ms </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/de0/071/18e/de007118e81cee628722e426d8e83800.jpg" alt="Ultrasonic Distance Meter HC-SR04 Ultrasonic Module"></p><br><p>  Ultrasonic sensor rangefinder, because of its physical nature, and not because China, in some cases, poorly determines the distance to the obstacle: </p><br><ul><li>  if the obstacle is of a complex shape, then the ultrasound is reflected at different angles and the sensor is mistaken, </li><li>  Ultrasound is perfectly absorbed (i.e. not reflected) by soft furniture or toys, and the sensor considers that there is nothing in front of it. </li></ul><br><p>  In other words, for an ultrasonic range finder, ideally, it would be great if all the obstacles were in the form of a solid plane perpendicular to the direction of radiation of ultrasound. </p><br><p>  Some problems can be solved with an infrared distance sensor.  But he is also not perfect: </p><br><ul><li>  small maximum range in comparison with ultrasonic: 0.3‚Äî0.8 m versus 4 m </li><li>  big minimum distance in comparison with ultrasonic: 10 cm against 2 cm </li><li>  the dependence of the sensitivity of the sensor from the total illumination. </li></ul><br><p>  Although if you set these rangefinders in a pair, then their performance would noticeably increase. </p><br><h1 id="podklyuchaem-bluetooth-hc-05">  Connect Bluetooth HC-05 </h1><br><p>  As you can see from the datasheet the main pins of the ‚Äúbare‚Äù HC-05: </p><br><ul><li>  TX (pin 1) transmission </li><li>  RX (pin 2) reception </li><li>  3.3V (pin 12) 3.3V power supply </li><li>  GND (pin 13) land </li><li>  PIO8 (pin 31) mode indicator </li><li>  PIO9 (pin 32) connection status, if the connection is established, the output will be high </li><li>  PIO11 (pin 34) to enable AT command mode </li></ul><br><p>  Our module is soldered to the Breakout / Base Board, where there is already a voltage divider, so its operating voltage range is from 3.3V to 6V. </p><br><p>  We connect our complete Bluetooth module: </p><br><ul><li>  Arduino (TX) - (RX) HC-05 </li><li>  Arduino (RX) - (TX) HC-05 </li><li>  Arduino (+ 5V) - (VCC) Bluetooth </li><li>  Arduino (GND) - (GND) Bluetooth </li><li>  pins LED, KEY are not used </li></ul><br><p>  After energizing the Bluetooth HC-05 module, the LED should blink on it, which means that the bluetooth is working. </p><br><p>  Turn on bluetooth on the mobile, find the device with the name HC-05 and connect, password 1234. </p><br><p>  To test, fill in Arduino with a simple sketch: </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Test Arduino + Bluetooth. http://localhost"); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { count++; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Count = "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(count); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre> <br><p>  On Android phone, install Bluetooth Terminal.  Connect to the HC-05 device and watch the creeping lines on the phone screen with an increasing counter. </p><br><p>  To enable the module to receive AT commands, you need to transfer it to the appropriate mode ‚Äî to do this, set the KEY (PIO11) pin to logical 1. On some Breakout / Base Board, instead of the KEY pin, there is an EN (ENABLE) pin, which may or may not be soldered to the conclusion on the chip itself.  This only applies to HC05 chips.  That's just my conclusion EN board is not soldered anywhere.  Therefore, it can be soldered with a separate wire to the KEY (PIO11) output of the chip.  Or, during operation, to transfer the HC05 to the AT command mode, short the KEY (PIO11) chip output to the Vcc power output for a couple of seconds.  For HC06, KEY is not needed. </p><br><h1 id="programmnoe-obespechenie">  Software </h1><br><p>  Note.  Each time before loading the program in Arduino, make sure that the Bluetooth module is not connected to the Arduino.  This will cause problems casting the sketch.  Simply disconnect the power from the Bluetooth module or wire connecting the Arduino and RX, TX module pins. </p><br><p>  At the beginning of the sketch, change the numbers of the motors in the lines of the type: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  <a href="">Sketch for automatic mode with a detour of obstacles download here</a> . </p><br><p>  If you replace the string </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  on </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p>  This will enable debug mode. </p><br><p>  In the debug mode, the robot RoboCar4W will not actually drive or turn the wheels.  Instead, activate the serial monitor and see how it ‚Äúdrives‚Äù virtually.  Instead of a real drive forward, the line ‚ÄúForward‚Äù will be written to the serial port monitor, instead of the backward turn to the left - ‚ÄúTurn Back L (eft)‚Äù, etc.  The ultrasonic distance measurement sensor also does nothing; instead, the distances to the obstacles are generated programmatically and randomly. </p><br><p>  This debugging mode is convenient if you change the algorithm of the movement and instead of catching the typewriter around the room, just check everything on a ‚Äúidle‚Äù move. </p><br><p>  <a href="https://github.com/tim4dev/arduino/tree/master/project/RoboCar4W/RoboCar4W-2">Sketch for manual control on bluetooth download here</a> .  The sketch has no debug mode, since everything is transparent there.  You press the button - the robot goes. </p><br><p>  <a href="https://play.google.com/store/apps/details%3Fid%3Dbraulio.calle.bluetoothRCcontroller">Program for Adnroid Bluetooth RC Car</a> . </p><br><p>  Well that's all!  Happy road! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/32b/8dc/98f/32b8dc98ff44592014df2bf2f736f9d5.jpg" alt="Happy road!"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/426097/">https://habr.com/ru/post/426097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426087/index.html">Signing a PDF on JS and inserting a signature on C # using Krypto PRO</a></li>
<li><a href="../426089/index.html">American startup developed glasses-adblock</a></li>
<li><a href="../426091/index.html">8 cloud log analyzers for evaluating the working environment</a></li>
<li><a href="../426093/index.html">Monetization of user data vs Advertising in the application: pros and cons</a></li>
<li><a href="../426095/index.html">Open webinar "How not to write in Python"</a></li>
<li><a href="../426099/index.html">Typegram news</a></li>
<li><a href="../426101/index.html">Data integrity in microservice architecture - how to ensure it without distributed transactions and rigid connectivity</a></li>
<li><a href="../426103/index.html">Webinar "Do you need Kubernetes" October 15 at 19:00</a></li>
<li><a href="../426105/index.html">My catch for the week</a></li>
<li><a href="../426111/index.html">Google is going to launch a censored search service in China</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>