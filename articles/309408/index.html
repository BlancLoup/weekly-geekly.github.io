<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manual Start Timer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. This article is addressed to comprehending the art of Android development, just like me. 

 Recently, I had to do a timer that starts a task...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manual Start Timer</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr.  This article is addressed to comprehending the art of Android development, just like me. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/e45/580/ade/e45580adece14b3d98cdb5e8cae32e6d.jpg"></div><br>  Recently, I had to do a timer that starts a task after a certain period of time. <br><br>  But the differences from the standard solution were as follows: <br><ul><li>  First, if the task could not be completed, it is immediately necessary to repeat it.  And so, to the bitter end.  After that, we return to the normal mode. </li><li>  Secondly, it may be necessary to start the task manually, without waiting for the next timer to trigger. </li><li>  And thirdly, the timer should start if the device is restarted or the connection to the Internet has been restored. </li></ul><br>  The problem was solved as follows. <br><a name="habracut"></a><br>  Let's write a test application. Create a project with empty activity. <br><br>  The form: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">activity_main.xml</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru.alerttest.MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CheckBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/checkBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:checked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CheckBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/checkBox2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:checked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/checkBox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_alignParentStart</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  Create a new IntentService, with the name UniversalService. <br><br>  In the MainActivity we make changes to onCreate: <br><br><div class="spoiler">  <b class="spoiler_title">onCreate</b> <div class="spoiler_text"><pre> <code class="java hljs"> CheckBox checkBox, checkBox1; SharedPreferences sPref; SharedPreferences.Editor editor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); checkBox = (CheckBox)findViewById(R.id.checkBox); sPref = getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>,MODE_PRIVATE); editor = sPref.edit(); editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"chbAutomatic"</span></span>, checkBox.isChecked()); editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"success"</span></span>, checkBox.isChecked()); editor.commit(); checkBox.setOnCheckedChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompoundButton.OnCheckedChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCheckedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompoundButton buttonView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isChecked)</span></span></span><span class="hljs-function"> </span></span>{ editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"chbAutomatic"</span></span>, checkBox.isChecked()); editor.commit(); setServiceAlarm(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }); checkBox1 = (CheckBox)findViewById(R.id.checkBox2); checkBox1.setOnCheckedChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompoundButton.OnCheckedChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCheckedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompoundButton buttonView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isChecked)</span></span></span><span class="hljs-function"> </span></span>{ editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"success"</span></span>, checkBox1.isChecked()); editor.commit(); setServiceAlarm(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }); Button button = (Button)findViewById(R.id.button); button.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"   "</span></span>); Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UniversalService.class); startService(intent); } }); }</code> </pre><br></div></div><br>  And add a method: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setServiceAlarm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ SharedPreferences settings = getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, MODE_PRIVATE); Boolean automaticSynchronize = settings.getBoolean(<span class="hljs-string"><span class="hljs-string">"chbAutomatic"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, UniversalService.class); PendingIntent pendingIntent = PendingIntent.getService(context, <span class="hljs-number"><span class="hljs-number">0</span></span>, intent, <span class="hljs-number"><span class="hljs-number">0</span></span>); AlarmManager alarmManager = (AlarmManager)context.getSystemService(Context.ALARM_SERVICE); Integer period = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(automaticSynchronize){ alarmManager.setRepeating(AlarmManager.RTC, System.currentTimeMillis(), period*<span class="hljs-number"><span class="hljs-number">1000</span></span>, pendingIntent); Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"   , : "</span></span>+period*<span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); alarmManager.cancel(pendingIntent); pendingIntent.cancel(); } }</code> </pre><br>  In this code (in the onCreate method), we save in the General Settings, with the name ‚ÄúAlertTest‚Äù, the state of the checkboxes, and (in the setServiceAlarm method) we start the timer with a periodicity of 5 seconds, to run the UniversalService service. <br><br>  Also, we want to receive a response from the service, about the success of the operation. <br><br>  To do this, add a class to the MainActivity: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBroadRec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Boolean result = intent.getBooleanExtra(UniversalService.EXTRA_KEY_OUT, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Intent intentRec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UniversalService.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!result){ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); startService(intentRec); } } }</code> </pre><br>  And add onCreate to the end: <br><br><pre> <code class="java hljs"> MyBroadRec myBroadRec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyBroadRec(); IntentFilter intentFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(UniversalService.ACTION_MYINTENTSERVICE); intentFilter.addCategory(Intent.CATEGORY_DEFAULT); registerReceiver(myBroadRec, intentFilter); setServiceAlarm(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  And in UniversalService, we change the code to the following: <br><br><div class="spoiler">  <b class="spoiler_title">Universalservice</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.alerttest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.IntentService; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.SharedPreferences; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.preference.PreferenceManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntentService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String EXTRA_KEY_OUT = <span class="hljs-string"><span class="hljs-string">"EXTRA_OUT"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ACTION_MYINTENTSERVICE = <span class="hljs-string"><span class="hljs-string">"ru.timgor.alerttest.RESPONSE"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UniversalService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"UniversalService"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onHandleIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!verify()){ Intent responseIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); responseIntent.setAction(ACTION_MYINTENTSERVICE); responseIntent.addCategory(Intent.CATEGORY_DEFAULT); responseIntent.putExtra(EXTRA_KEY_OUT, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>); sendBroadcast(responseIntent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ SharedPreferences settings = getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, MODE_PRIVATE); Boolean success = settings.getBoolean(<span class="hljs-string"><span class="hljs-string">"success"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> success; } }</code> </pre><br></div></div><br>  As you can see, the verify method emulates our task.  In the event that it is executed unsuccessfully, an Intent is created that starts MyBroadRec, which starts our service again.  We can configure through the checkbox "Very important option."  If we put the ‚ÄúAuto Start‚Äù checkbox in an inactive state, the timer will stop working.  As soon as the task is completed, we switch to normal mode. <br><br>  But we still have the task of autostarting our application.  To do this, create a UniversalReceiver class inheriting from BroadcastReceiver: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.alerttest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.BroadcastReceiver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>); Intent intentNew = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, MainActivity.class); intentNew.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startActivity(intentNew); } }</code> </pre><br>  And in the manifest we add the following lines: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".UniversalReceiver"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.BOOT_COMPLETED"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.net.conn.CONNECTIVITY_CHANGE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Everything, the problem is solved.  So let me leave.  I hope someone will be useful.  If someone has comments and tips, I will listen to them with great pleasure. <br><br>  <strong>PS:</strong> Classes in full: <br><br><div class="spoiler">  <b class="spoiler_title">MainActivity</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.alerttest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.AlarmManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.PendingIntent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.BroadcastReceiver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.IntentFilter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.SharedPreferences; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.preference.PreferenceManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.CheckBox; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.CompoundButton; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ CheckBox checkBox, checkBox1; SharedPreferences sPref; SharedPreferences.Editor editor; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); checkBox = (CheckBox)findViewById(R.id.checkBox); sPref = getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>,MODE_PRIVATE); editor = sPref.edit(); editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"chbAutomatic"</span></span>, checkBox.isChecked()); editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"success"</span></span>, checkBox.isChecked()); editor.commit(); checkBox.setOnCheckedChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompoundButton.OnCheckedChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCheckedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompoundButton buttonView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isChecked)</span></span></span><span class="hljs-function"> </span></span>{ editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"chbAutomatic"</span></span>, checkBox.isChecked()); editor.commit(); setServiceAlarm(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }); checkBox1 = (CheckBox)findViewById(R.id.checkBox2); checkBox1.setOnCheckedChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompoundButton.OnCheckedChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCheckedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CompoundButton buttonView, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isChecked)</span></span></span><span class="hljs-function"> </span></span>{ editor.putBoolean(<span class="hljs-string"><span class="hljs-string">"success"</span></span>, checkBox1.isChecked()); editor.commit(); setServiceAlarm(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }); Button button = (Button)findViewById(R.id.button); button.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"   "</span></span>); Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UniversalService.class); startService(intent); } }); MyBroadRec myBroadRec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyBroadRec(); IntentFilter intentFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(UniversalService.ACTION_MYINTENTSERVICE); intentFilter.addCategory(Intent.CATEGORY_DEFAULT); registerReceiver(myBroadRec, intentFilter); setServiceAlarm(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBroadRec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Boolean result = intent.getBooleanExtra(UniversalService.EXTRA_KEY_OUT, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Intent intentRec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UniversalService.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!result){ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); startService(intentRec); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setServiceAlarm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ SharedPreferences settings = getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, MODE_PRIVATE); Boolean automaticSynchronize = settings.getBoolean(<span class="hljs-string"><span class="hljs-string">"chbAutomatic"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, UniversalService.class); PendingIntent pendingIntent = PendingIntent.getService(context, <span class="hljs-number"><span class="hljs-number">0</span></span>, intent, <span class="hljs-number"><span class="hljs-number">0</span></span>); AlarmManager alarmManager = (AlarmManager)context.getSystemService(Context.ALARM_SERVICE); Integer period = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(automaticSynchronize){ alarmManager.setRepeating(AlarmManager.RTC, System.currentTimeMillis(), period*<span class="hljs-number"><span class="hljs-number">1000</span></span>, pendingIntent); Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"   , : "</span></span>+period*<span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); alarmManager.cancel(pendingIntent); pendingIntent.cancel(); } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Universalservice</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.alerttest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.IntentService; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.SharedPreferences; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.preference.PreferenceManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntentService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String EXTRA_KEY_OUT = <span class="hljs-string"><span class="hljs-string">"EXTRA_OUT"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ACTION_MYINTENTSERVICE = <span class="hljs-string"><span class="hljs-string">"ru.timgor.alerttest.RESPONSE"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UniversalService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"UniversalService"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onHandleIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!verify()){ Intent responseIntent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); responseIntent.setAction(ACTION_MYINTENTSERVICE); responseIntent.addCategory(Intent.CATEGORY_DEFAULT); responseIntent.putExtra(EXTRA_KEY_OUT, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>); sendBroadcast(responseIntent); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ SharedPreferences settings = getSharedPreferences(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, MODE_PRIVATE); Boolean success = settings.getBoolean(<span class="hljs-string"><span class="hljs-string">"success"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> success; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Universalreceiver</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.alerttest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.BroadcastReceiver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UniversalReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"AlertTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>); Intent intentNew = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, MainActivity.class); intentNew.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startActivity(intentNew); } }</code> </pre><br></div></div><br><br>  PPS: Made changes to the BroadcastReceiver, for errors that <a href="https://habrahabr.ru/users/handy/" class="user_link">Handy</a> and <a href="https://habrahabr.ru/users/blackstream/" class="user_link">BlackStream</a> indicated to me. <br>  Now I understand with the SyncAdapter. </div><p>Source: <a href="https://habr.com/ru/post/309408/">https://habr.com/ru/post/309408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309394/index.html">The myth of RAM and O (1)</a></li>
<li><a href="../309400/index.html">The book ‚ÄúHTML5 and CSS3. Website development for any browsers and devices. 2nd ed. "</a></li>
<li><a href="../309402/index.html">Microsoft StorSimple virtual array. Part 2</a></li>
<li><a href="../309404/index.html">Why the 35-year-old SoftBank company again spoils its reputation because of the ‚Äúcrazy‚Äù deal with ARM Holdings</a></li>
<li><a href="../309406/index.html">Anniversary Edition Intercepter-NG 1.0</a></li>
<li><a href="../309410/index.html">GrabDuck: How we make bookmarked articles</a></li>
<li><a href="../309412/index.html">GoTech.vc: Last week</a></li>
<li><a href="../309414/index.html">Reverse engineering of visual stories (part 2)</a></li>
<li><a href="../309416/index.html">New security features Android 7</a></li>
<li><a href="../309420/index.html">Gentleman's set of R packages for automating business tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>