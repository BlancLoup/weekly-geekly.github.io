<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Launch Pentaho OLAP server step by step</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, dear habrovchane, I want to submit to your review the instructions, as we had to raise the OLAP-server in our company. Step by step, we will follo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Launch Pentaho OLAP server step by step</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/d5d/3f7/08e/d5d3f708e728c78bf8f9eafc78f3b803.jpg" align="right"><br>  So, dear habrovchane, I want to submit to your review the instructions, as we had to raise the OLAP-server in our company.  Step by step, we will follow the path we have taken, starting with the installation and setup of Pentaho and ending with the preparation of data tables and the publication of the olap-cube on the server.  Naturally, a lot of things here can be muddled / inaccurate / non-optimal, but when we needed to raise the server and see if Pentaho could replace our samopisny statistics, we didn‚Äôt have that ... <br><a name="habracut"></a><br>  I divided the whole process of raising the OLAP server into 3 parts: <br><ul><li>  <a href="https://habr.com/ru/post/187782/">Pentaho BI Server setup</a> </li><li>  <a href="https://habr.com/ru/post/187782/">preparation of fact tables and measurements</a> </li><li>  <a href="https://habr.com/ru/post/187782/">creating a cube and publishing it on the server</a> </li></ul><br><br><h3><a name="part1"></a>  Configure Pentaho BI Server </h3><br>  Install the <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK</a> . <br><br>  We expose variable environments: <br><pre><code class="hljs tex">JAVA_HOME=c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Java</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdk</span></span></span></span>1.7.0_15 JRE_HOME=c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Java</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdk</span></span></span></span>1.7.0_15<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jre</span></span></span></span> PENTAHO_JAVA_HOME=c:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Program</span></span></span></span> Files<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Java</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdk</span></span></span></span>1.7.0_15</code> </pre> <br>  Download and unpack the latest version of Pentaho Business Intelligence ( <a href="http://sourceforge.net/projects/pentaho/files/Business%2520Intelligence%2520Server/4.8.0-stable/">biserver-ce-4.8.0-stable.zip</a> ).  I uploaded the contents of the archive (the <em>administration-console</em> and <em>biserver-ce</em> folders) to the <em>c: \ Pentaho</em> folder.  So, unpack - unpacked, but the server is not yet configured.  We will deal with this now ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Download the MySQL Connector for Java ( <a href="http://www.mysql.com/downloads/connector/j/">mysql-connector-java-5.1.23-bin.jar</a> ).  We drop it into the <em>c: \ Pentaho \ biserver-ce \ tomcat \ lib</em> folder. <br><br>  By default, Pentaho uses the HSQLDB engine, i.e.  creates and stores all databases in memory, including the sampled data test database.  This is still normal for small tables (such as demo), but for combat data, the engine is usually changed to MySQL or Oracle, for example.  We will use MySQL. <br><br>  Fill in MySQL database hibernate and quartz.  Both are used for Pentaho system needs.  We download files <em>1_create_repository_mysql.sql</em> and <em>2_create_quartz_mysql.sql</em> <a href="https://docs.google.com/file/d/0B9Jmocc0fj_EN2MyZjc4ZjEtNzFkNC00NzIzLTljZTctZjIzZWQ1NjU3MzJk/edit%3Fhl%3Den%26pli%3D1">from here</a> .  Import them into MySQL. <br><br>  Now our MySQL server is configured as a Pentaho repository.  We will configure the Pentaho server to use this repository by default.  For this we will edit the following xml-ki: <br><br>  1. <em>\ pentaho-solutions \ system \ applicationContext-spring-security-hibernate.properties</em> <br><br>  Change driver, url and dialect to <strong>com.mysql.jdbc.Driver</strong> , <strong>jdbc: mysql: // localhost: 3306 / hibernate</strong> and <strong>org.hibernate.dialect.MySQL5Dialect</strong> respectively. <br><br>  2. <em>\ tomcat \ webapps \ pentaho \ META-INF \ context.xml</em> <br><br>  Change driverClassName parameters to <strong>com.mysql.jdbc.Driver</strong> , url parameters to <strong>jdbc: mysql: // localhost: 3306 / hibernate</strong> and <strong>jdbc: mysql: // localhost: 3306 / quartz</strong> respectively in 2 sections, change validationQuery parameters to <strong>select 1</strong> . <br><br>  3. <em>\ pentaho-solutions \ system \ hibernate \ hibernate-settings.xml</em> <br><br>  In the &lt;config-file&gt; parameter, we change hsql.hibernate.cfg.xml to <strong>mysql5.hibernate.cfg.xml</strong> . <br><br>  4. <em>\ pentaho-solutions \ system \ simple-jndi \ jdbc.properties</em> <br><br>  We delete all unnecessary trash except Hibernate and Quartz. <br><br>  5. We demolish the <em>\ pentaho-solutions \ bi-developers</em> , <em>\ pentaho-solutions \ plugin-samples</em> and <em>\ pentaho-solutions \ steel-wheels folders</em> .  This test data, which we need in principle will not. <br><br>  6. <em>\ tomcat \ webapps \ pentaho \ WEB-INF \ web.xml</em> <br><br>  We delete or comment on all the servlets of the <strong>[BEGIN SAMPLE SERVLETS]</strong> and <strong>[BEGIN SAMPLE SERVLET MAPPINGS] sections</strong> , except for ThemeServlet. <br><br>  Delete the <strong>[BEGIN HSQLDB STARTER]</strong> and <strong>[BEGIN HSQLDB DATABASES]</strong> sections. <br><br>  Delete the lines: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span>SystemStatusFilter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter-mapping</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  7. Delete the <em>\ data</em> directory.  This directory contains a test database, scripts to run this database and initialize the Pentaho repository. <br><br>  8. <em>\ pentaho-solutions \ system \ olap \ datasources.xml</em> <br><br>  Remove directories with the names SteelWheels and SampleData. <br><br>  9. <em>\ pentaho-solutions \ system \ systemListeners.xml</em> <br><br>  Delete or comment the line: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pooledDataSourceSystemListener"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.pentaho.platform.engine.services.connection.datasource.dbcp.PooledDatasourceSystemListener"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  10. <em>\ tomcat \ webapps \ pentaho \ WEB-INF \ web.xml</em> <br><br>  We specify our solution-path: <strong>c: \ Pentaho \ biserver-ce \ pentaho-solutions</strong> . <br><br>  11. <em>\ system \ sessionStartupActions.xml</em> <br><br>  Comment out or delete all blocks <code>...</code> <br><br><h5>  Customize Pentaho web-face </h5><br>  After all manipulations with configs, you can already podzapust something.  Go to the folder with our server and run <strong>start-pentaho.bat</strong> or sh-shnik, who needs what in its operating system.  In theory, there should be no ERRORs in the console or tomkata logs anymore. <br><br>  So, if everything went smoothly, then at <code><a href="http://localhost/"></a> localhost:8080</code>  <code><a href="http://localhost/"></a> localhost:8080</code> login form is displayed: <br><br><img src="https://habrastorage.org/storage2/872/7db/056/8727db056a82407d059dab61ed17d98d.jpg"><br><br>  Enter the standard login / password ( <strong>joe / password</strong> ) and get inside.  Now you need to install the olap-client, which will, in fact, display our requests to it.  The paid version of Pentaho has its own client, for CE we used the Saiku plugin. <br><br>  Go to the Pentaho Marketplace point of the top menu, install Saiku Analytics. <br><br>  Everything is here, it's time to prepare data for analytics. <br><br><br><br><h3><a name="part2"></a>  Preparation of fact tables and measurements </h3><br>  Pentaho is a ROLAP implementation of OLAP technology, i.e.  All the data that we will analyze are stored in ordinary relational tables, except perhaps in some way prepared in advance.  Therefore, all we need is to create the necessary tables. <br><br>  I will say a little about the subject area for which we needed statistics.  There is a website, there are customers and there are tickets that these customers can write.  Also with comments, yes.  Our support splits all these tickets according to various topics, projects, countries.  And here we needed, for example, to find out how many tickets on the ‚ÄúDelivery‚Äù topic came from each project from Germany last month.  And all this is divided by admins, i.e.  see who is from support and how many such tickets processed, etc.  etc. <br><br>  All such sections technology OLAP and allows for.  About OLAP itself I will not tell in detail.  We assume that with the concepts of the OLAP-cube, dimensions and measures, the reader is familiar with and in general terms imagines what it is and what it eats with. <br><br>  Of course, I will not analyze the real data of real customers as an example, but for this purpose I will use my small website with football statistics.  There is little practical benefit from this, but as a sample it‚Äôs the most. <br><br>  So, there is a table of <strong>players</strong> .  Let's try to find all sorts of different useful and not very statistics: the number of players in each country, the number of players by role, the number of active players, the number of Russian midfielders aged from 30 to 40 years.  Well, something like this ... <br><br>  So what did I stop at?  And, exactly, the preparation of tables.  There are several ways to do this: recreate all the tables with your hands and bare SQLs or use the <strong>Pentaho Data Integration</strong> utility (PDI, also known as Kettle), a component of the Pentaho complex that is responsible for the extraction, transformation and unloading of data (ETL).  It allows you to connect to a specific database and with the help of lots of different tools to prepare the tables we need.  Download <a href="http://sourceforge.net/projects/pentaho/files/Data%2520Integration/4.4.0-stable/">it</a> .  We throw the mysql-connector into the lib folder and launch PDI via <strong>Spoon.bat</strong> . <br><br>  First, we collect the heart of our statistics - a table of players.  Initially, its structure looks something like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`player`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'ID'</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`patronymic`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`surname`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`full_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">`birth_date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">`death_date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">`main_country_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'ID '</span></span>, <span class="hljs-string"><span class="hljs-string">`birthplace`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">`height`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`weight`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`status`</span></span> enum(<span class="hljs-string"><span class="hljs-string">'active'</span></span>,<span class="hljs-string"><span class="hljs-string">'inactive'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'  - ,    ..'</span></span>, <span class="hljs-string"><span class="hljs-string">`has_career`</span></span> enum(<span class="hljs-string"><span class="hljs-string">'no'</span></span>,<span class="hljs-string"><span class="hljs-string">'yes'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'no'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'     '</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`name`</span></span> (<span class="hljs-string"><span class="hljs-string">`name`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`surname`</span></span> (<span class="hljs-string"><span class="hljs-string">`surname`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`birth_date`</span></span> (<span class="hljs-string"><span class="hljs-string">`birth_date`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`death_date`</span></span> (<span class="hljs-string"><span class="hljs-string">`death_date`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`has_stat`</span></span> (<span class="hljs-string"><span class="hljs-string">`has_career`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`main_country_id`</span></span> (<span class="hljs-string"><span class="hljs-string">`main_country_id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`status`</span></span> (<span class="hljs-string"><span class="hljs-string">`status`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`full_name_country_id`</span></span> (<span class="hljs-string"><span class="hljs-string">`full_name_country_id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">''</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  Some of the fields (name, surname, patronymic, full_name or birthplace, for example) are not needed for statistics.  Fields of the Enum type (status, has_career) need to be placed in separate dimension tables, and in the main table you just need to put down the foreign key ID keys. <br><br><img src="https://habrastorage.org/storage2/b94/2b6/ecd/b942b6ecd12a3b7d097f16ef5301beff.png"><br><br>  So let's get started: <strong>File&gt; New&gt; Job</strong> (Ctrl + Alt + N).  The job's workspace opens.  Go to the View tab, create a new database <strong>connection</strong> ( <strong>Database connections&gt; New</strong> ): drive the server, database, user and password, give the connection some name (I have fbplayers) and save ( <em>c: \ Pentaho \ biserver-ce \ pentaho -solutions \ jobs \ fbplayers.kjb</em> ). <br><br>  Create a transformation ( <strong>File&gt; New&gt; Transformation</strong> , Ctrl + N).  Save it as <em>prepare_tables.ktr</em> .  In the same way as with the job (job), we add a connection to the database for transformation.  Is done. <br><br>  Go to the View tab and expand the Input section.  Select the <strong>Data Grid</strong> tool.  It is well suited if you need to render some fields with a small number of possible options in separate related tables.  So, pull the Data Grid into the workspace and open it for editing with a double click.  We drive in the name of this transformation step ( <strong>Player Status</strong> ), we begin to set the structure of this table (Meta tab) and the data itself (Data tab).  In the structure we have 2 fields: <br><br>  1. Name - id, Type - Integer, Decimal - 11 <br>  2. Name - status, Type - String, Length - 10. <br><br>  In the Data tab, we drive in 2 lines: 1 - active, 2 - inactive. <br><br>  Go to the Output section and pull out the Table Output element.  Double-click, set the item name as <strong>Player Status Dim</strong> .  The connection should appear in the next line.  In the Target Table field, we write the name of the table that will be created in the database to store the status of players: player_status_dim.  Set the Truncate Table checkbox.  We bind the input and output elements: click on the Player Status and with the Shift button held down, drag the mouse to the Player Status Dim.  The link should appear as an arrow connecting these elements. <br><br><img src="https://habrastorage.org/storage2/d35/10d/4d7/d3510d4d75471f5d97abbc0e378c8920.png"><br><br>  The same thing needs to be turned with a flag for a career ( <strong>Player Career</strong> ): <br><br>  1. Name - id, Type - Integer, Decimal - 11 <br>  2. Name - has_career, Type - String, Length - 3. <br><br>  In the Data tab we drive in 2 lines: 1 - no, 2 - yes. <br><br>  Similarly, we collect the output table <strong>Player Career Dim</strong> . <br><br><img src="https://habrastorage.org/storage2/3cb/cd3/7b6/3cbcd37b68f132c924a292e03ccea72f.png"><br><br>  Now we will move the player's birth date to a separate measurement table.  By and large, Pentaho allows you to use the date directly in the fact table, initially we did so with the data of our subject area.  But there were several problems: <br><br>  1. if you need to break 2 different fact tables (for example, Players and Trainers) by date of birth, then you need a common dimension for them (Dimension); <br>  2. when dividing the date in the fact table itself into its constituent parts, an extract or year function (month, ...) will be applied to each row of the table to get the year, month, etc.  What is not ice. <br><br>  So, for these reasons, we redesigned our original structure and created a table with all the unique time values, leaving the clock to a minimum.  For our test example, there will be no such detail; there will be only years, months and days. <br><br>  Create a new transformation ( <strong>initial_sql</strong> ).  Do not forget about the connection.  From the collection of elements, select <strong>Scripting&gt; Execute SQL Script</strong> .  In it we write date collector: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`player_birth_date_dim`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`player_birth_date_dim`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'ID'</span></span>, <span class="hljs-string"><span class="hljs-string">`year`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`month`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`day`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">' '</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`player_birth_date_dim`</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">YEAR</span></span>(p.birth_date) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">`year`</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">MONTH</span></span>(p.birth_date) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">`month`</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>(p.birth_date) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">`day`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> birth_date <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> player ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p)</code> </pre><br><img src="https://habrastorage.org/storage2/60c/c39/7e0/60cc397e0c7c38bac284e134bc3567c9.png"><br><br>  Right there, in this transformation, we create another 2 SQL scripts - to create the Player Career Dim and Player Status Dim tables: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> player_career_dim; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`player_career_dim`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'ID'</span></span>, <span class="hljs-string"><span class="hljs-string">`has_areer`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre><br><img src="https://habrastorage.org/storage2/b13/a33/2ca/b13a332caf3b05a876fc0d96eb1e01ab.png"><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> player_status_dim; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`player_status_dim`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'ID'</span></span>, <span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre><br><img src="https://habrastorage.org/storage2/27f/dd4/cc9/27fdd4cc9a75d56c4af7b79db8188a0b.png"><br><br>  We proceed to the main part of our mission - the assembly of the fact table.  Create a transformation ( <em>player_fact.ktr</em> ).  About the connection is not forgotten, right?  From the Input tab, throw Table Input, from Output - Table Output, respectively.  In the Table Input we write a cool SQL nickname: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.id <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> player_id, dd.id <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> birth_date_id, p.main_country_id, p.height, p.weight, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> p.status <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'inactive'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> status_id, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> p.has_career <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'no'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'yes'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> has_career_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> player <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">`p`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> player_birth_date_dim <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> dd <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">YEAR</span></span>(p.birth_date) = dd.<span class="hljs-string"><span class="hljs-string">`year`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MONTH</span></span>(p.birth_date) = dd.<span class="hljs-string"><span class="hljs-string">`month`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>(p.birth_date) = dd.<span class="hljs-string"><span class="hljs-string">`day`</span></span></code> </pre><br>  In Table Output, specify the name of the table - <strong>player_fact</strong> .  We link the source and result tables with an arrow. <br><br>  Again we go to our job.  From the General tab, add a new transformation.  Open it, give the name <strong>Prepare Tables</strong> and specify the path to our saved transformation <em>prepare_tables.ktr</em> . <br><br><img src="https://habrastorage.org/storage2/56e/9f0/052/56e9f0052789d00fa9f46a4ef7f46cc0.png"><br><br>  Do the same with the transformations <strong>Initial SQL</strong> and <strong>Player Fact</strong> . <br><br>  We drop the Start button on the form and connect the elements in the following sequence: <strong>Start&gt; Initial SQL&gt; Prepare Tables&gt; Load Player Fact</strong> . <br><br><img src="https://habrastorage.org/storage2/02d/111/e4f/02d111e4f51d601b6d87e362e2232f68.png"><br><br>  Now you can try to run the task.  In the toolbar click the green triangle.  If our hands were straight enough, then we will see a green tick near each of our elements.  You can log into your server and check that the labels are really created.  If something went wrong, the log will show all our sins. <br><br><br><br><h3><a name="part3"></a>  Creating a cube and publishing it on the server </h3><br>  Now that we have the data prepared, let's finally deal with the OLAP.  Pentaho has a <strong>Schema Workbench</strong> utility to create olap cubes.  Download, unpack, throw the mysql-connector in the drivers folder, run <strong>workbench.bat</strong> . <br><br>  Immediately go to the menu <strong>Options&gt; Connection</strong> .  Enter our parameters for connecting to the database. <br><br>  Getting Started: <strong>File&gt; New&gt; Schema</strong> .  Immediately save the scheme (I have <em>fbplayers.xml</em> ).  Set the name to the schema. <br><br><img src="https://habrastorage.org/storage2/bbf/9e0/72b/bbf9e072b01b0e50a64c56b43c8afd89.png"><br><br>  Using the context menu of the scheme, we create a cube.  Let's call it the name of the entity, the statistics for which we assume, i.e.  <strong>Player</strong> . <br><br>  Inside the cube, we specify the table that will be our fact table: <strong>player_fact</strong> . <br><br><img src="https://habrastorage.org/storage2/797/be7/3c1/797be73c16fc45d5e77d5e37302c6436.png"><br><br>  If you select the Player cube, the red line at the bottom of the right pane will tell us that Dimensions should be specified in the cube, i.e.  Those parameters, which will be made data slices. <br><br>  There are 2 ways to define a cube dimension: directly inside it (via <strong>Add Dimension</strong> ) and inside a schema (Add Dimension for the schema plus <strong>Add Dimension Usage</strong> at the cube itself).  We used the second option in our statistics, since  it allows one dimension to be applied to several fact tables at once (to several cubes).  We then combined these cubes into a virtual cube, which allowed us to display statistics on several cubes at the same time. <br><br>  In our test project, we also use the second method, except that we will not create virtual cubes. <br><br>  So, add the first dimension (by country).  Create a schema dimension, give it the name <strong>Country</strong> .  Inside it there is already 1 hierarchy, we will set the name <strong>Country_Hierarchy to it</strong> .  Add a table to this hierarchy that stores the values ‚Äã‚Äãof the Country dimension, i.e.  country. <br><br>  This is my usual mysql table with a list of countries of the following structure: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`country`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'ID'</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`english_name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">`iso_alpha_3`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-string"><span class="hljs-string">'  ISO 3166-1'</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`name`</span></span> (<span class="hljs-string"><span class="hljs-string">`name`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`england_name`</span></span> (<span class="hljs-string"><span class="hljs-string">`english_name`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span>=<span class="hljs-string"><span class="hljs-string">''</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre><br>  After that we add 1 level to the hierarchy (Add Level).  Let's call it <strong>Country_Level</strong> and <strong>link the</strong> fact table with this dimension table: set the table field to country, column to id, nameColumn to name.  Those.  this means that when comparing the country ID from the fact table country ID from the country table, the country name will be returned as a result (for readability).  The remaining fields, in principle, can not be filled. <br><br><img src="https://habrastorage.org/storage2/693/f59/bcb/693f59bcb0fd890a4273bb1a653a63b3.png"><br><br>  Now we can return to the Player cube and assign it the newly created dimension (via Add Dimension Usage).  We set the name (Country), source is our created Country dimension (it will be the only one in the drop-down list), and the foreignKey field is main_country_id, i.e.  This tells Pentaho that when he sees some kind of main_country_id in the fact table, he refers to the dimension table (Country) on the specified column (id) and substitutes the name value in the place of main_country_id.  Something like this‚Ä¶ <br><br><img src="https://habrastorage.org/storage2/871/dec/2d3/871dec2d38693b8086e14946d28eeae3.png"><br><br>  It remains only to specify the cube, that we actually want to aggregate something)) <strong>Add Measure</strong> to the cube ( <strong>Add Measure</strong> ).  Give it the name PlayerCount, the aggregator - distinct-count and the field by which we aggregate - player_id.  Done! <br><br><img src="https://habrastorage.org/storage2/e3b/e9c/165/e3be9c1656b1be7c5c5929dc54618388.png"><br><br>  Let's stop on this for a while and check what we have conjured here.  Launch Pentaho web: <code><a href="http://localhost/"></a> localhost:8080/pentaho</code>  <code><a href="http://localhost/"></a> localhost:8080/pentaho</code> (do not forget about start-pentaho.bat).  Go to <strong>File&gt; Manage&gt; Data Sources</strong> .  Click the add new source button.  Select the type - Database Table (s).  The most important thing we need here is to create a new connection (Connection).  We set a name (Fbplayers) and we drive in our data for access to a DB.  After saving Connection, we‚Äôll click Cancel everywhere, we don‚Äôt need anything else. <br><br>  Next, we need to publish the created scheme on the Pentaho: <strong>File&gt; Publish</strong> server.  We set the url: <code><a href="http://localhost/"></a> localhost:8080/pentaho</code>  <code><a href="http://localhost/"></a> localhost:8080/pentaho</code> and enter the password for publication.  This password is set in the file <em>c: \ Pentaho \ biserver-ce \ pentaho-solutions \ system \ publisher_config.xml</em> .  Set this password to 123, for example, the user and password are standard - joe / password.  If everything is normal, then after the folder selection window should appear, where to save our scheme.  Enter the name of the connection that we created in the last step (Fbplayers) in the "Pentaho or JNDI Source" field.  Create a <em>schema</em> folder and save the file in it.  If everything went well, we should see a joyful window: <br><br><img src="https://habrastorage.org/storage2/2a5/426/d2a/2a5426d2a8b4f517ee00553cd6b30670.png"><br><br>  Let's go look!  Go to the web-muzzle, open Saiku, choose our cube from the drop-down list.  We see the appeared dimension Country and measure PlayerCount.  We drag Country_Level in the field Rows, PlayerCount - in the Columns.  By default, the automatic request button is pressed on the Saiku panel.  It is usually worth pressing it before dragging measurements and measures, but this is not critical.  If automatic execution is disabled, click the Run button.  Rejoice! <br><br>  But if suddenly instead of beautiful data you saw a message like ‚ÄúEOFException: Can not read response from server.  ‚ÄúExpected to read 4 bytes, read 0 bytes before the connection was unexpectedly lost‚Äù, don't worry - it happens, just click Run again. <br><br><img src="https://habrastorage.org/storage2/1bd/20e/f56/1bd20ef564020d9bd07e692f19630518.png"><br><br>  By clicking the arrows on the measure button, we can sort the resulting selection in descending or ascending order. <br><br><img src="https://habrastorage.org/storage2/7e3/2a0/307/7e32a03075cad5d34809f418557151dc.png"><br><br>  While we have some data, let's see what else is available.  It is possible to limit the output data, say, only by countries with the letter A: <br><br><img src="https://habrastorage.org/storage2/034/683/d68/034683d6867fda31218f471755c5a432.png"><br><br>  We get: <br><br><img src="https://habrastorage.org/storage2/b36/e3a/e4d/b36e3ae4da519ff1c8dd9f424d1fe867.png"><br><br>  You can see the graphics.  This is usually beautiful if there is not much data in the sample. <br><br><img src="https://habrastorage.org/storage2/5d9/716/0a0/5d97160a036f4ba822c7bba5d27a3f95.png"><br><br>  You can see the statistics on the sample: minimum, maximum rate, average value, etc.  You can unload all this property in xls or csv.  We can also save the query that we have created using the constructor on the server in order to return to it later. <br><br>  So, the essence is clear.  Let's create a couple more measurements.  In principle, measurements by player status and career availability are no different from measurements by country.  And the result in both cases will be just 2 lines (active / inactive and has / no). <br><br>  Much more interesting is the case with the hierarchy of the type Date.  We will create it now.  Go back to Workbench, add a new dimension ( <strong>BirthDate</strong> ).  He instead of StandardDimension set the parameter <strong>TimeDimension</strong> .  Hierarchy is already there.  Add a dimension table - <strong>player_birth_date_dim</strong> . <br><br>  Add the first level - <strong>Year</strong> .  Set the values ‚Äã‚Äãtable = player_birth_date_dim, column = id, levelType = TimeYears.  For this level, add the Key Expression property with the value of `year`. <br><br>  Add the second level - <strong>Month</strong> .  Set the values ‚Äã‚Äãtable = player_birth_date_dim, column = id, levelType = TimeMonths.  For this level, add the Key Expression property with the value `month`, Caption Expression with the value‚Äú CONCAT (`year`, ',', MONTHNAME (STR_TO_DATE (` month`, '% m'))) ‚Äù. <br><br>  Add the third level - <strong>Day</strong> .  Set the values ‚Äã‚Äãtable = player_birth_date_dim, column = id, levelType = TimeDays.  For this level, add the Caption Expression property with the value ‚ÄúCONCAT (LPAD (` day`, 2, 0), '.', LPAD (`month`, 2, 0), '.',` Year`) ‚Äù. <br><br>  Add the created dimension to the cube, specifying bith_date_id as foreignKey. <br><br>  We publish.  Let's try to break all the players by year of birth. <br><br><img src="https://habrastorage.org/storage2/0c3/cb9/634/0c3cb963454c635fa2d97bda3cf94282.png"><br><br>  And now we add to the ‚ÄúYear‚Äù parameter also the ‚ÄúMonth‚Äù parameter.  Pentaho will break each of the years into months and count the number of players born in a particular month of each year.  By default, only the data by months is displayed, but if you press the ‚ÄúHide Parents‚Äù button in the toolbar, you can see the total number of players for the given year. <br><br><img src="https://habrastorage.org/storage2/ca5/a44/462/ca5a4446291327b5cccef5ec02a7bf75.png"><br><br>  But the main strength of Pentaho, and the whole OLAP, in fact, is not in such simple samples, but in sections on several dimensions at the same time.  Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for example, find the number of players born in each country after 1990. </font></font><br><br><img src="https://habrastorage.org/storage2/e3b/642/be2/e3b642be2c678175328c087bb9c6a669.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the increase in the number of metrics, queries can become more and more complex and targeted, reflecting a specific static need. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This concludes our long-long article. </font><font style="vertical-align: inherit;">I hope this tutorial will help someone take a fresh look at OLAP solutions, or maybe even introduce these solutions in their organizations.</font></font></div><p>Source: <a href="https://habr.com/ru/post/187782/">https://habr.com/ru/post/187782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187760/index.html">What brings us musical piracy. Part 2, positive</a></li>
<li><a href="../187764/index.html">Google introduces Android 4.3 and the new Nexus 7</a></li>
<li><a href="../187770/index.html">A girl is learning web programming: 180 sites in 180 days</a></li>
<li><a href="../187776/index.html">Designer Lego.cuusoo "Back to the Future" on sale from August 1</a></li>
<li><a href="../187780/index.html">The most simple JavaScript fractals</a></li>
<li><a href="../187786/index.html">NCOAM named after Makarov</a></li>
<li><a href="../187790/index.html">Hole in your pocket - Memo for mobile security</a></li>
<li><a href="../187794/index.html">Ilya Segalovich died</a></li>
<li><a href="../187796/index.html">Video from the open day JetBrains</a></li>
<li><a href="../187798/index.html">Ilya Segalovich, 1964‚Äì2013</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>