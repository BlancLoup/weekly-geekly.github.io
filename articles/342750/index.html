<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quadratic arithmetic programs: from mud to riches (translation)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing the series of articles on zk-SNARKs technology, we are studying a very interesting article by Vitalik Buterin " Quadratic Arithmetic Progra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quadratic arithmetic programs: from mud to riches (translation)</h1><div class="post__text post__text-html js-mediator-article"><p>  Continuing the series of articles on zk-SNARKs technology, we are studying a very interesting article by Vitalik Buterin " <a href="https://medium.com/%40VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649">Quadratic Arithmetic Programs: from Zero to Hero</a> " </p><br><p>  Previous article: <a href="https://habrahabr.ru/post/342262/">Introduction to zk-SNARKs with examples (translation)</a> </p><br><p>  Recently, interest in zk-SNARKs has grown immensely, and people are increasingly trying to <a href="https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/">demystify</a> what many have come to call ‚Äúlunar math‚Äù because of their rather indiscriminate complexity.  zk-SNARKs are really quite difficult to understand, especially because of the large number of components that need to be put together to make it all work, but if we disassemble the technology in parts, it will be much easier to comprehend it ... </p><a name="habracut"></a><br><p> The purpose of this publication is not a full introduction to the zk-SNARK technology.  It is also assumed that, firstly, you know what zk-SNARKs are and what they do, and secondly, you know mathematics well enough to be able to talk about things like polynomials (if the statement <code>P(x) + Q(x) = (P + Q)(x)</code> , where <code>P</code> and <code>Q</code> are polynomials, it seems natural and obvious to you, then your level is sufficient).  Rather, this publication reveals the mechanism behind the technology and tries to explain, as far as possible, the first half of the transformations shown by zk-SNARKs researcher Eran Tromer (Eran Tromer): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/438/fb2/ad0/438fb2ad0155c21da49975fa7183c982.png" alt="image"></p><br><p>  Conversions here can be divided into two components.  First, zk-SNARKs cannot be directly applied to any computational problem;  first you need to convert the task to the correct ‚Äúform‚Äù for the problem it solves.  A form is called a ‚Äúquadratic arithmetic program‚Äù (QAP), and the transformation of the function code into such a form is in itself a very nontrivial task.  Along with converting the function code to QAP, there is another separate action that is performed if you have an input argument for the function to be converted.  You need to create an appropriate solution (sometimes called a "certificate" for QAP).  There is also another rather complex mechanism for creating an actual ‚Äúproof with zero disclosure‚Äù for this evidence and a separate process for verifying the evidence that was passed to you, but this is a separate conversation beyond the scope of this publication.  (For an understanding of the general scheme of the process, see the <a href="https://habrahabr.ru/post/342262/">first article</a> . Comment. Translator). </p><br><p>  We will analyze a simple example: it is necessary to prove that you know the solution of a cubic equation: </p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>x</mi><mo>+</mo><mn>5</mn><mo>=</mo><mn>35</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.98ex" height="2.66ex" viewBox="0 -987.6 6880.4 1145.2" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-33" x="809" y="583"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2B" x="1248" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMATHI-78" x="2249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2B" x="3044" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35" x="4044" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-3D" x="4823" y="0"></use><g transform="translate(5879,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35" x="500" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>x</mi><mo>+</mo><mn>5</mn><mo>=</mo><mn>35</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> x ^ 3 + x + 5 = 35 </script></p><br>  (hint: answer 3).  This task is quite simple, so the resulting QAP will not be so big as to scare you.  But the code will be nontrivial enough so that you can see all the math in action. <br><br>  We describe our function as follows: <br><pre> <code class="javascript hljs">def qeval(x): y = x**<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y + <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br><p>  The simple special-purpose programming language used here supports basic arithmetic ( <code>+, -, *, /</code> ), limited exponentiation ( <code>x**7</code> , but not <code>x**y</code> ), and assignment to variables, which is quite a powerful tool, allowing you to theory to perform calculations inside the function (as long as the number of calculation steps is limited and cycles are not allowed).  Note that modulo division ( <code>%</code> ) and comparison operators ( <code>&lt;,&gt;, ‚â§, ‚â•</code> ) are not supported, as there is no effective way to produce division by modulus or comparison directly in the complete cyclic group arithmetic (be grateful for this, because if there was a way to implement one of these operations, cryptography on elliptic curves would be cracked faster than you would say ‚Äúbinary search‚Äù and ‚ÄúChinese remainder theorem‚Äù). </p><br><p>  You can extend the language to modulus and comparisons using bit decomposition, for example: </p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>13</mn><mo>=</mo><msup><mn>2</mn><mn>3</mn></msup><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.7ex" height="2.66ex" viewBox="0 -987.6 7190.3 1145.2" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-33" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-3D" x="1278" y="0"></use><g transform="translate(2335,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-33" x="707" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2B" x="3511" y="0"></use><g transform="translate(4512,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-32" x="707" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2B" x="5689" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-31" x="6689" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mn>13</mn><mo>=</mo><msup><mn>2</mn><mn>3</mn></msup><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>1</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> 13 = 2 ^ 3 + 2 ^ 2 + 1 </script></p><br>  as auxiliary parameters, checking the correctness of these expansions and performing mathematics in binary operations;  in the arithmetic of a finite field, checking equality (==) is also feasible and even much easier, but we will not deal with these things now.  We can extend the language to support conditional expressions (for example, <code>if x &lt; 5: y = 7; else: y = 9</code> ) by transforming them into an arithmetic form <code>y = 7 * (x &lt; 5) + 9 * (x &gt;= 5);</code>  but note that in this case both branches of the conditional expression must be fulfilled, and if you have a lot of nested conditions, this will lead to an increase in overhead costs. <br><br>  Let's now go through the conversion process in QAP step by step.  If you want to do it yourself for any code, I <a href="https://github.com/ethereum/research/tree/master/zksnark">implemented the compiler here</a> (only for educational purposes, and it is not yet ready to create QAP for real zk-SNARKs!). <br><h3 id="uproschenie">  Simplify </h3><br><p>  The first step is the ‚Äúsimplify‚Äù procedure.  In it, we convert the source code, which can contain an arbitrary number of complex operators and expressions, into a sequence of operators that have two forms: <br>  <code>x = y</code> (where <code>y</code> can be a variable or a number) and <br>  <code>x = y (op) z</code> (where <code>op</code> can be <code>+, -, *, /</code> ; <code>y</code> and <code>z</code> can be variables, numbers, or subexpressions). </p><br><p>  You can think of each of these operators as a logical transition in a circuit (meaning "logic gate", changing states. Approx. Translator).  The result of the simplification process for the above code is the following: </p><br><pre> <code class="hljs objectivec">sym_1 = x * x y = sym_1 * x sym_2 = y + x ~<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> = sym_2 + <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br><p>  If you look at the source code and the code above, you can easily see that they are equivalent. </p><br><h3 id="perehod-v-r1cs">  Transition to R1CS </h3><br><p>  Now we will transform this into what is called a "Rank-1 Restriction System" (R1CS).  R1CS is a sequence of groups of three vectors (a, b, c), and the solution R1CS is a vector <code>s</code> , where <code>s</code> must satisfy the equation <code>sa * sb - sc = 0</code> , where <code>.</code>  is a "taking a point" <strong>(multiplying a row vector by a column vector. Approx. translator)</strong> .  In simple terms, if we ‚Äúcombine‚Äù <code>a</code> and <code>s</code> , multiplying the values ‚Äã‚Äãof vectors in the same positions, and then take the sum of these products, then do the same for <code>b</code> and, <code>s</code> and then, the same for <code>c</code> and <code>s</code> then the third result will be equal to the product of the first two results.  Example of R1CS solution: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/70d/e12/f27/70de12f278efd571950379103b3f248a.png" alt="image"></p><br><p>  But instead of having only one restriction in the program, we introduce a set of restrictions: one for each logical transition.  There is a standard way of converting a logical transition to (a, b, c) triplet, depending on which operation is performed (+, -, * or /), and whether the arguments are variables or numbers.  The length of each vector is equal to the total number of variables in the system, which includes the dummy variable <code>~one</code> in having a value of 1, the input parameters, the dummy variable <code>~out</code> representing the result, as well as all intermediate variables ( <code>sym1</code> and <code>sym2</code> see above);  Vectors, as a rule, will be very ‚Äúsparse‚Äù, with filled values ‚Äã‚Äãcorresponding to variables that are affected by a particular logical transition. </p><br><p>  Let's denote the list of variables that we will use: <br> <code>'~one', 'x', '~out', 'sym_1', 'y', 'sym_2'</code> </p> <br><p>  The solution vector will consist of assigning values ‚Äã‚Äãfor all of these variables in a similar order. </p><br><p>  Now we will find (a, b, c) three for the first transition: </p><br><pre> <code class="javascript hljs">a = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] b = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] c = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><p>  It is easy to make sure that if the value of the solution vector in the second position is 3, and in the fourth position is 9, then regardless of the other values ‚Äã‚Äãof the solution vector, the vector check will be reduced to <code>3*3 = 9</code> and the solution will be correct.  If the value of the solution vector is -3 in the second position and 9 in the fourth, then the verification will also be successful.  The same is true for the value 7 in the second position and 49 in the fourth.  The purpose of this first check is to make sure that only the first transition only has inputs and outputs. </p><br><p>  Now let's go to the second transition: </p><br><pre> <code class="javascript hljs">a = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] b = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] c = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><p>  Similar to the first check, here we check <code>sym_1 * x = y</code> </p><br><p>  Third transition: </p><br><pre> <code class="javascript hljs">a = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] b = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] c = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]</code> </pre> <br><p>  Here, the pattern is somewhat different: it multiplies the first element in the solution vector by the second element, then by the fifth element, adding two results and checking whether the sum is equal to the sixth element.  Since the first element in the solution vector is always equal to one, this is just an addition check, confirming that the output is equal to the sum of the two inputs. </p><br><p>  Finally, the fourth transition: </p><br><pre> <code class="javascript hljs">a = [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] b = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] c = [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><p>  Here we reproduce the last check <code>~out = sym_2 + 5</code> .  The test works by taking the sixth element in the solution vector, adding the first element multiplied by 5 (recall: the first element is 1, so this actually means adding 5) and relating it to the third element where we store the output variable. </p><br><p>  So, we have R1CS with four limitations.  The evidence is simply the value of all variables, including input, output, and internal variables: </p><br><pre> <code class="javascript hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>]</code> </pre> <br><p>  You can calculate it yourself by simply ‚Äúexecuting‚Äù the simplified code above, starting with assigning the input variables x = 3, entering the values ‚Äã‚Äãof all intermediate variables and changing them during the calculation. </p><br><p>  Now we give the full R1CS for our case: </p><br><pre> <code class="javascript hljs">A [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] B [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] C [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> <br><h3 id="r1cs---qap">  R1CS - QAP </h3><br><p>  The next step is to convert this R1CS to a QAP form, which implements the same logic, but polynomials will be used instead of taking a point.  We will do this as follows: we will move from four groups of three vectors of six lengths to six groups of three 3rd degree polynomials, where each <code>x</code> coordinate of the polynomial corresponds to one of the constraints.  That is, if we calculate the values ‚Äã‚Äãof the polynomials at x = 1, then we get our first set of vectors, if we calculate the polynomials from x = 2, then we get the second set of vectors, etc. </p><br><p>  We can do this transformation using, for example, the Lagrange interpolation polynomial.  The problem that Lagrange interpolation solves is as follows: if you have a set of points (ie <code>(x, y)</code> coordinate pairs), then performing Lagrange interpolation at these points gives you a polynomial passing through all these points.  We do this by breaking the task as follows: for each value of <code>x</code> we create a polynomial that returns <code>y</code> value corresponding to the given point <code>(x, y)</code> and returns 0 in all other cases.  And then, to get the final result, we add all the polynomials. </p><br><p>  Let's give an example.  Suppose we need a polynomial passing through (1, 3), (2, 2) and (3, 4).  We start by creating a polynomial passing through (1, 3), (2, 0) and (3, 0).  As it turned out, to make a polynomial that takes a value only for x = 1 and is equal to zero in other cases is very simple: </p><br><pre> <code class="javascript hljs">(x - <span class="hljs-number"><span class="hljs-number">2</span></span>) * (x - <span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br><p>  On the graph it looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/be0/e71/0f5/be0e710f5c92e2a548c629a34ddf2771.png" alt="image"></p><br><p>  Now we just need to "zoom" in order for the height at the point x = 1 to be necessary: </p><br><pre> <code class="javascript hljs">(x - <span class="hljs-number"><span class="hljs-number">2</span></span>) * (x - <span class="hljs-number"><span class="hljs-number">3</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> / ((<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">3</span></span>))</code> </pre> <br><p>  This will give us: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>1.5</mn><mo>&amp;#x2217;</mo><msup><mi>x</mi><mn>2</mn></msup><mo>&amp;#x2212;</mo><mn>7.5</mn><mo>&amp;#x2217;</mo><mi>x</mi><mo>+</mo><mn>9</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.89ex" height="2.66ex" viewBox="0 -987.6 8994.2 1145.2" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2217" x="1501" y="0"></use><g transform="translate(2224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-32" x="809" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2212" x="3473" y="0"></use><g transform="translate(4473,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-37"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2217" x="5975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMATHI-78" x="6698" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2B" x="7492" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-39" x="8493" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mn>1.5</mn><mo>‚àó</mo><msup><mi>x</mi><mn>2</mn></msup><mo>‚àí</mo><mn>7.5</mn><mo>‚àó</mo><mi>x</mi><mo>+</mo><mn>9</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> 1.5 * x ^ 2 - 7.5 * x + 9 </script></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c3d/b46/fe7/c3db46fe7eb9ef75db379dd26d56765f.png" alt="image"></p><br><p>  Then we do the same thing with two other points and get two other similar polynomials, except that they take values ‚Äã‚Äãfor x = 2 and x = 3 instead of x = 1. </p><br><p>  We add all three polynomials together and get: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>1.5</mn><mo>&amp;#x2217;</mo><msup><mi>x</mi><mn>2</mn></msup><mo>&amp;#x2212;</mo><mn>5.5</mn><mo>&amp;#x2217;</mo><mi>x</mi><mo>+</mo><mn>7</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.89ex" height="2.66ex" viewBox="0 -987.6 8994.2 1145.2" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2217" x="1501" y="0"></use><g transform="translate(2224,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-32" x="809" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2212" x="3473" y="0"></use><g transform="translate(4473,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2217" x="5975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMATHI-78" x="6698" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-2B" x="7492" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/342750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJnzmqRDbLvMjtDRMiHAwEIAWcRA#MJMAIN-37" x="8493" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mn>1.5</mn><mo>‚àó</mo><msup><mi>x</mi><mn>2</mn></msup><mo>‚àí</mo><mn>5.5</mn><mo>‚àó</mo><mi>x</mi><mo>+</mo><mn>7</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> 1.5 * x ^ 2 - 5.5 * x + 7 </script></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5db/fb0/dfc/5dbfb0dfc08ea29c0261df5a7099b509.png" alt="image"></p><br><p>  This is exactly what we need.  The complexity of the execution time of the above algorithm is <code>O (n^3)</code> , since there are n points, and each point requires <code>O (n^2)</code> time to multiply the polynomials.  By optimizing a bit, complexity can be reduced to <code>O (n^2)</code> .  And if you use fast Fourier transform algorithms, etc., the complexity can still be reduced - this significantly optimizes zk-SNARKs, since  in practice, real functions can contain thousands of transitions. </p><br><p>  Now let's convert our R1CS to the Lagrange interpolation polynomial.  We take the value of the first position from each vector <code>a</code> , apply the Lagrange interpolation to get a polynomial (where the calculation of the value of the polynomial at the point <code>i</code> will give the value of the ith vector <code>a</code> in the first position).  Then repeat the process for the value of the first position of each vector <code>b</code> and <code>c</code> , and then repeat this process for subsequent positions.  For convenience, I will show you the result immediately: </p><br><pre> <code class="javascript hljs"> A [<span class="hljs-number"><span class="hljs-number">-5.0</span></span>, <span class="hljs-number"><span class="hljs-number">9.166</span></span>, <span class="hljs-number"><span class="hljs-number">-5.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.833</span></span>] [<span class="hljs-number"><span class="hljs-number">8.0</span></span>, <span class="hljs-number"><span class="hljs-number">-11.333</span></span>, <span class="hljs-number"><span class="hljs-number">5.0</span></span>, <span class="hljs-number"><span class="hljs-number">-0.666</span></span>] [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>] [<span class="hljs-number"><span class="hljs-number">-6.0</span></span>, <span class="hljs-number"><span class="hljs-number">9.5</span></span>, <span class="hljs-number"><span class="hljs-number">-4.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>] [<span class="hljs-number"><span class="hljs-number">4.0</span></span>, <span class="hljs-number"><span class="hljs-number">-7.0</span></span>, <span class="hljs-number"><span class="hljs-number">3.5</span></span>, <span class="hljs-number"><span class="hljs-number">-0.5</span></span>] [<span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.833</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.166</span></span>]  B [<span class="hljs-number"><span class="hljs-number">3.0</span></span>, <span class="hljs-number"><span class="hljs-number">-5.166</span></span>, <span class="hljs-number"><span class="hljs-number">2.5</span></span>, <span class="hljs-number"><span class="hljs-number">-0.333</span></span>] [<span class="hljs-number"><span class="hljs-number">-2.0</span></span>, <span class="hljs-number"><span class="hljs-number">5.166</span></span>, <span class="hljs-number"><span class="hljs-number">-2.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.333</span></span>] [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>] [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>] [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>] [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>]  C [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>] [<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>] [<span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.833</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.166</span></span>] [<span class="hljs-number"><span class="hljs-number">4.0</span></span>, <span class="hljs-number"><span class="hljs-number">-4.333</span></span>, <span class="hljs-number"><span class="hljs-number">1.5</span></span>, <span class="hljs-number"><span class="hljs-number">-0.166</span></span>] [<span class="hljs-number"><span class="hljs-number">-6.0</span></span>, <span class="hljs-number"><span class="hljs-number">9.5</span></span>, <span class="hljs-number"><span class="hljs-number">-4.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>] [<span class="hljs-number"><span class="hljs-number">4.0</span></span>, <span class="hljs-number"><span class="hljs-number">-7.0</span></span>, <span class="hljs-number"><span class="hljs-number">3.5</span></span>, <span class="hljs-number"><span class="hljs-number">-0.5</span></span>]</code> </pre> <br><p>  The coefficients are sorted in ascending order, so the first polynomial should be: 0.833 <em>x ^ 3 - 5</em> x ^ 2 + 9.166 * x - 5. This set of polynomials (plus the Z polynomial, the meaning of which I will explain later) are parameters of our QAP instance.  Please note that all the necessary actions are performed only once for the moment for the same function that you are going to use to check zk-SNARKs.  Once the QAP parameters are generated, they can be reused. </p><br><p>  Let's try to count all these polynomials for x = 1. Estimating a polynomial for x = 1 simply means adding all the coefficients (since 1 ^ k = 1 for any k), so this is not a difficult task.  We'll get: </p><br><pre> <code class="javascript hljs"> A  x=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>  B  x=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>  C  x=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Here we got the same set of three vectors for the first logical transition that we created above. </p><br><h3 id="proverka-qap">  QAP Verification </h3><br><p>  Now let's understand what is the meaning of all these crazy transformations?  The answer is that instead of checking the constraints in R1CS individually, we can now check all the constraints at the same time by performing a "taking a point" on polynomials. <br><img src="https://habrastorage.org/getpro/habr/post_images/096/564/fe2/096564fe20d3f175347c765a05dde608.png" alt="image"></p><br><p>  Since in this case the "taking a point" check is a series of additions and multiplications of polynomials, the result itself will be a polynomial.  If the resulting polynomial, calculated in each <code>x</code> coordinate, which we used above to represent a logical transition, is zero, then this means that all checks pass.  If the resulting polynomial gives a nonzero value on at least one of the <code>x</code> coordinates representing a logical transition, this means that the input and output values ‚Äã‚Äãare inconsistent for this logical transition (for example, the transition is <code>y = x*sym_1</code> , and values ‚Äã‚Äãare provided, for example <code>x = 2</code> , <code>sym_1 = 2</code> and <code>y = 5</code> ). </p><br><p>  Note that the resulting polynomial should not take zero for any values.  As a rule, in most cases, the values ‚Äã‚Äãwill differ from zero.  Its behavior can be any at points other than logical transitions, but it should take a value of zero at all points that truly correspond to logical transitions.  To verify the correctness of the entire solution, we will not evaluate the polynomial <code>t = As * Bs - Cs</code> at each point corresponding to the transition.  Instead, we divide <code>t</code> by another polynomial, <code>Z</code> and check that <code>Z</code> completely divides <code>t</code> , that is, the division of <code>t / Z</code> occurs without remainder. </p><br><p>  <code>Z</code> defined as <code>(x - 1) * (x - 2) * (x - 3) ...</code> is the simplest polynomial, equal to zero at all points corresponding to logical transitions.  As is known from mathematics, any polynomial that is equal to zero at all these points must be a multiple of the ‚Äúminimal‚Äù polynomial for these points.  Conversely, if a polynomial is a multiple of <code>Z</code> , then its value at any of these points will be equal to zero.  This equivalence simplifies our calculations. <br>  Now let's do a "taking a point" check with the polynomials above.  First, intermediate polynomials: </p><br><pre> <code class="javascript hljs">As = [<span class="hljs-number"><span class="hljs-number">43.0</span></span>, <span class="hljs-number"><span class="hljs-number">-73.333</span></span>, <span class="hljs-number"><span class="hljs-number">38.5</span></span>, <span class="hljs-number"><span class="hljs-number">-5.166</span></span>] Bs = [<span class="hljs-number"><span class="hljs-number">-3.0</span></span>, <span class="hljs-number"><span class="hljs-number">10.333</span></span>, <span class="hljs-number"><span class="hljs-number">-5.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.666</span></span>] Cs = [<span class="hljs-number"><span class="hljs-number">-41.0</span></span>, <span class="hljs-number"><span class="hljs-number">71.666</span></span>, <span class="hljs-number"><span class="hljs-number">-24.5</span></span>, <span class="hljs-number"><span class="hljs-number">2.833</span></span>]</code> </pre> <br><p>  Now calculate <code>As * Bs - Cs</code> : </p><br><pre> <code class="javascript hljs">t = [<span class="hljs-number"><span class="hljs-number">-88.0</span></span>, <span class="hljs-number"><span class="hljs-number">592.666</span></span>, <span class="hljs-number"><span class="hljs-number">-1063.777</span></span>, <span class="hljs-number"><span class="hljs-number">805.833</span></span>, <span class="hljs-number"><span class="hljs-number">-294.777</span></span>, <span class="hljs-number"><span class="hljs-number">51.5</span></span>, <span class="hljs-number"><span class="hljs-number">-3.444</span></span>]</code> </pre> <br><p>  Calculate the "minimal" polynomial <code>Z = (x - 1) * (x - 2) * (x - 3) * (x - 4)</code> : </p><br><pre> <code class="javascript hljs">Z = [<span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">-50</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">-10</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]</code> </pre> <br><p>  And if we divide the result above by Z, we get: </p><br><pre> <code class="javascript hljs">h = t / Z = [<span class="hljs-number"><span class="hljs-number">-3.666</span></span>, <span class="hljs-number"><span class="hljs-number">17.055</span></span>, <span class="hljs-number"><span class="hljs-number">-3.444</span></span>]</code> </pre> <br><p>  As you can see, without a trace. </p><br><p>  So, we have a solution for QAP.  If we try to change any of the variables in the R1CS solution that we received for this QAP solution, for example, set the last value to 31 instead of 30, then we get a polynomial <code>t</code> that does not pass one of the checks (in this particular case, the result for x = 3 will be equal to -1 instead of 0).  In addition, <code>t</code> will not be a multiple of <code>Z</code>  Dividing <code>t / Z</code> will give the remainder [-5.0, 8.833, -4.5, 0.666]. </p><br><p>  Please note that the above is a simplification.  In the "real world," adding, multiplying, subtracting and dividing will not happen with regular numbers, but with elements of a finite field - a creepy kind of arithmetic that is self-consistent, so all the algebraic laws that we know and love are still valid there.  But in all the answers there are elements of some set of finite size, usually integers in the range from 0 to n-1 for some n.  For example, if n = 13, then 1/2 = 7 (and 7 <em>2 = 1), 3</em> 5 = 2, etc. </p><br><p>  The use of finite field arithmetic eliminates the concern for rounding errors and allows the system to work well with elliptic curves, which are ultimately necessary for the rest of the zk-SNARKs, which makes the zk-SNARKs protocol virtually safe. </p><br><p>  Special thanks to Eran Tromera for helping me explain many details about the inner workings of zk-SNARKs. </p></div><p>Source: <a href="https://habr.com/ru/post/342750/">https://habr.com/ru/post/342750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342738/index.html">RNN: Can a neural network write like Leo Tolstoy? (Spoiler: no)</a></li>
<li><a href="../342740/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ289 (November 13 - 19, 2017)</a></li>
<li><a href="../342742/index.html">PHP Digest 120 (November 1 - 19, 2017)</a></li>
<li><a href="../342744/index.html">6 things on the Internet that people misunderstand</a></li>
<li><a href="../342748/index.html">Understanding MVC in ASP.NET MVC and more</a></li>
<li><a href="../342752/index.html">What to do if you do not know how the software works</a></li>
<li><a href="../342754/index.html">Selection of equipment for WLAN: how not to spend money in vain</a></li>
<li><a href="../342756/index.html">Cause time: choose a time management system</a></li>
<li><a href="../342758/index.html">[DotNetBook] Reference and significant data types, features of choice</a></li>
<li><a href="../342760/index.html">Digital events in Moscow from November 20 to 26</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>