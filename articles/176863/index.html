<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Prism Developer Guide - Part 4, Modular Application Development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Table of contents 


1. Introduction 
2. Initializing Prism Applications 
3. Manage dependencies between components 
4. Modular Application Developmen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Prism Developer Guide - Part 4, Modular Application Development</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <b>Table of contents</b> <br><ol><li>  <a href="http://habrahabr.ru/post/176851/">Introduction</a> </li><li>  <a href="http://habrahabr.ru/post/176853/">Initializing Prism Applications</a> </li><li>  <a href="http://habrahabr.ru/post/176861/">Manage dependencies between components</a> </li><li>  <a href="http://habrahabr.ru/post/176863/">Modular Application Development</a> </li><li>  <a href="http://habrahabr.ru/post/176867/">Implementation of the MVVM pattern</a> </li><li>  <a href="http://habrahabr.ru/post/176869/">Advanced MVVM scripts</a> </li><li>  <a href="http://habrahabr.ru/post/176895/">Creating user interface</a> <br><ol><li>  <a href="http://habrahabr.ru/post/177925/">User Interface Design Recommendations</a> </li></ol></li><li>  <a href="http://habrahabr.ru/post/178009/">Navigation</a> <ol><li>  <a href="http://habrahabr.ru/post/182052/">View-Based Navigation (View-Based Navigation)</a> </li></ol></li><li>  <a href="http://habrahabr.ru/post/182580/">The interaction between loosely coupled components</a> </li></ol></blockquote><br>  A modular application is such an application that can be divided into a number of functional blocks (modules) that can be integrated into one whole.  The client module encapsulates part of the overall functionality of the application and is usually a set of interrelated functional parts.  It may include a set of related components, such as application functions, including user interface and business logic, or parts of the application infrastructure, such as application-level services for logging, or authenticating and authorizing users.  Modules are independent of each other, but can interact with each other in a weakly coupled way.  Modular applications can facilitate the development, testing, deployment, and expansion of your application. <br><br>  For example, consider a personal banking application.  The user can access a variety of functions, such as transferring money between accounts, paying bills, and updating personal data using a single user interface (UI).  However, each of these functions is encapsulated within a discrete module.  These modules communicate with each other and with backend systems, such as database servers and web services.  Application services integrate the various components within each of the various modules and handle user interaction.  The user sees an integrated view that looks like a single seamless app. <br><br>  The following illustration shows the modular application project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img title="Modular application" src="https://habrastorage.org/getpro/habr/post_images/e2c/8e3/cbd/e2c8e3cbda84146b52c5b4d616aaefd0.png" alt="Modular application"><br><a name="habracut"></a><br><h3>  Benefits from creating modular applications </h3><br>  You are probably already creating a well-designed application using assemblies, interfaces, classes, and good object-oriented design principles.  In this case, if you do not take serious measures, the design of your applications will remain "monolithic" (where all the functionality is implemented in a highly connected way within the application), this can lead to the application being difficult to develop, test, expand, and maintain. <br><br>  A modular approach to building an application, on the other hand, can help highlight large-scale functional areas and develop or test them independently.  This can make development and testing easier, and your application more flexible and easily expandable in the future.  The advantage of the modular approach is that it can make the application architecture more flexible and maintainable by dividing the application into parts that are easy to manage.  Each part encapsulates a specific functionality, and integrates through clear, but weakly connected channels. <br><br><h4>  Prism development support for modular applications </h4><br>  Prism helps you develop modular applications and manage modules at runtime.  Using the functionality of Prism, you can save time, since you do not need to implement and test your own platform for building modular applications.  Prism supports the following functions for developing modular applications: <br><ul><li>  Catalog of modules for registering named modules, or determining their location;  You can create a catalog of modules in the following ways: <br><ul><li>  Defining modules in code, or in XAML. </li><li>  For WPF: detecting modules in a directory, so you can load all modules without explicitly defining them in a centralized directory. <br><blockquote>  <b>The note.</b> <br>  When using this approach, assemblies with modules may not be compiled automatically, when the project is built, and not copied into the output directory, since they are not referenced from the project of the executable file. <br></blockquote></li><li>  For WPF: defining modules in the configuration file. </li></ul><br></li><li>  Declaratively set attributes for modules, which are used to define the initialization mode and dependency injection. </li><li>  Integration with dependency injection containers to maintain loose coupling between modules. </li><li>  To load modules: <br><ul><li>  Dependency management, including duplication and loop detection, to ensure that modules load in the correct order and that they are loaded and initialized only once. </li><li>  Background loading of modules and loading on demand to minimize the launch time of the application;  the rest of the modules can be loaded and initialized in the background or as needed. </li></ul><br></li></ul><br><h3>  Basic concepts </h3><br>  This section provides basic concepts related to the modularity of Prism, including the <code>IModule</code> , the module loading process, the module catalog, the communication between the modules, and the dependency injection containers. <br><br><h4>  <i>IModule</i> : modular application building block </h4><br>  A module is a logical set of functional components and resources collected in one place.  Modules can be developed, tested, deployed, and integrated into the application separately.  A package can include one or more assemblies, which can be located separately, or assembled in a single XAP file.  Each module has a central class that is responsible for initializing and integrating the functionality of the module into the application.  This class implements the <code>IModule</code> .  The presence of a class that implements the <code>IModule</code> is enough to identify the package as a module.  The <code>IModule</code> has a single <code>Initialize</code> method, within which you can implement any logic necessary to initialize and integrate the functionality of the module into the application.  Depending on the purpose of the module, it can register views in the regions of the user interface, make additional services available to the application, or extend its functionality.  The following code shows the minimal implementation of the module. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyModule</span></span> : <span class="hljs-title"><span class="hljs-title">IModule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    . } }</span></span></code> </pre> <br><blockquote>  <b>The note</b> <br>  Instead of using the initialization mechanism provided by the <code>IModule</code> , <i>Stock Trader RI</i> uses a declarative, attribute-based approach to register views, services, and types. </blockquote><br><h4>  Module lifetime </h4><br>  The process of loading a module into Prism includes the following: <br><ol><li>  <b>Registration / detection of modules.</b>  The modules that will be loaded at runtime for a specific application are defined in the modules directory.  The catalog contains information about the loadable modules, their location, and the order in which they should be loaded. </li><li>  <b>Loading modules.</b>  Assemblies that contain modules are loaded into memory.  This phase may require loading the module from the network or from another remote location or local directory. </li><li>  <b>Initialization of modules.</b>  Creating a module class and calling the <code>Initialize</code> method via the <code>IModule</code> . </li></ol><br>  The following illustration shows the module loading process. <br><br><img title="Module loading process" src="https://habrastorage.org/getpro/habr/post_images/5fd/acb/a83/5fdacba83574cf7cc7cc2d4f77c715d9.png" alt="Module loading process"><br><br><h4>  Module Catalog </h4><br>  <code>ModuleCatalog</code> contains information about the modules that can be used by the application.  A directory is essentially a collection of <code>ModuleInfo</code> classes.  Each module is described by the <code>ModuleInfo</code> class, which stores the name, type, and location of the module.  There are several typical approaches to filling <code>ModuleCatalog</code> with <code>ModuleCatalog</code> instances: <br><ul><li>  Registration of modules in the code. </li><li>  Register modules in XAML. </li><li>  Registration of modules in the configuration file (only in WPF). </li><li>  Discovery of modules in the local directory on disk (WPF only). </li></ul><br>  The choice of registration and detection mechanism to use depends on what the application needs.  Using a configuration file or a XAML file allows an application not to store references to modules.  Using a local directory may allow an application to detect modules without having to define them in any file. <br><br><h4>  Management of the module loading moment </h4><br>  Prism applications can initialize modules as soon as possible, what is known as ‚Äúwhen available‚Äù, or when the application needs them, what is known as ‚Äúon-demand‚Äù.  For Silverlight applications, modules can be loaded with the application, or in the background after the application starts.  Consider the following module loading instructions: <br><ul><li>  The modules required for the application to work must be loaded with the application and initialized at startup. </li><li>  Modules containing functions that are almost always used during normal use of an application can be loaded in the background and initialized when they become available. </li><li>  Modules containing functions that are rarely used (or support modules on which other modules may depend) can be loaded in the background and initialized on demand. </li></ul><br>  Consider how the application is divided, common use scenarios, application launch rate, and the number and size of downloads to determine how to configure the loading and initialization of modules. <br><br><h4>  Module integration with the application </h4><br>  Prism provides the following classes needed to load your application: <code>UnityBootstrapper</code> and <code>MefBootstrapper</code> .  These classes can be used to create and configure a module manager, which is required to detect and load modules.  You can override the module directory configuration method to register the modules defined in the XAML file, the configuration file, or specify the directory location. <br><br>  Use the module <code>Initialize</code> method to integrate the module with the rest of the application.  The way you do this will depend on the structure of the application and the content of the module.  Below are the general steps you need to take to integrate the module into your application: <br><ul><li>  Add the views contained in the module to the navigation structure of the application.  This is a common step in creating a composite application UI using detection, or injection of views. </li><li>  Sign up for application or service level events. </li><li>  Register shared services in the application dependency injection container. </li></ul><br><h4>  Communication between modules </h4><br>  Even considering that modules should be weakly connected, they tend to exchange data and messages with each other.  There are several communication patterns for loosely coupled systems, each with its own advantages and disadvantages.  As a rule, eventually, combinations of these patterns are used.  The following are some of these patterns: <br><ul><li>  <b>Weakly related events.</b>  A module can broadcast that a specific event has occurred.  Other modules may subscribe to receive such events.  Thus, they will be notified when this event occurs.  Weakly coupled events are a fairly easy way to establish communication between modules.  In this regard, it is easily implemented.  However, a project that relies too much on events may become difficult to support, especially if there are many events, or they must be organized together to perform a single task.  In this case, the use of a common service may be more rational. </li><li>  <b>Shared services.</b>  A shared service is a class that can be accessed through a common interface, usually allowed through a container.  As a rule, shared services are in a shared assembly and provide system-wide services, such as authentication, logging, or configuration.  Such services are often singletons. </li><li>  <b>Shared resources.</b>  If you do not want modules to communicate directly with each other, you can have them communicate indirectly through a shared resource, such as a database or a series of web services. </li></ul><br><h4>  Dependency injection and modular applications </h4><br>  Containers such as the Unity Application Block (Unity) and the Managed Extensibility Framework (MEF) allow you to easily use Control Inversion (IoC) and dependency injection, which are powerful design patterns that help connect components in a loosely coupled way.  This allows components to get references to other components on which they depend, without the need to hard code these links, thus obtaining code reuse and increased flexibility.  Dependency injection is very useful when creating a loosely coupled modular application.  Prism was designed to be independent of the DI container used to compose the components of an application.  The choice of container is your business, and it will largely depend on the basic operational characteristics and preferences.  There are two main dependency injection platforms for consideration from Microsoft - Unity and MEF. <br><br>  Patterns &amp; practices The Unity Application Block represents a full-featured dependency injection container.  It supports property-based injection, constructor-based injection, and policy injection, which allows you to transparently introduce behaviors and policies between components.  It also supports many other features typical of dependency injection containers. <br><br>  MEF (which is now part of the .NET Framework 4 and Silverlight 4) allows you to create extensible applications, support dependency-based composition, and also provides other functions that support modular application development.  This allows an application to detect components at runtime and then integrate them into the application.  MEF provides excellent opportunities for expansion and composition.  These include detecting assemblies and types, resolving dependencies, introducing dependencies, and some features for downloading assemblies and XAP files.  Prism supports the use of MEF features such as: <br><ul><li>  Association of module types with the location of their XAP files. </li><li>  Registration of modules through XAML and in code for WPF and Silverlight. </li><li>  Registration of modules through configuration files and scanned directories for WPF. </li><li>  Monitoring the loading status of modules. </li><li>  Custom declarative metadata for modules. </li></ul><br><h3>  Key decisions </h3><br>  The first decision you have to make is whether you want to develop a modular application.  There are numerous advantages to creating modular applications, as discussed in the previous section, but there is also additional time and effort that you must make to get these benefits.  If you still decide to develop a modular application, then there are a few things to consider: <br><ul><li>  <b>Determine the platform you will use.</b>  You can create your own modular platform, use Prism, MEF, or another platform. </li><li>  <b>Determine how to organize your application.</b>  Approach the modular architecture by defining the boundaries of each module, including which assemblies are part of each module.  You can decide to use the modular principle to facilitate development, to control how the application is deployed, or to support a plug-in or extensible architecture. </li><li>  <b>Determine how to split your modules.</b>  Modules can be divided based on requirements, for example, by functional areas provided by modules, development teams and deployment requirements. </li><li>  <b>Identify the basic services that the application will provide to all modules.</b>  For example, it can be an error reporting service, or an authentication and authorization service. </li><li>  <b>If you use Prism, determine how you will register the modules in the modules directory.</b>  For WPF, you can register modules in code, in XAML, in a configuration file, or configure module detection in a local directory on disk.  For Silverlight, you can register modules in code or in XAML. </li><li>  <b>Define your data transfer strategy and dependencies between modules.</b>  Modules will need to communicate with each other, and you will need to deal with dependencies between modules. </li><li>  <b>Identify the dependency injection container.</b>  Modular systems typically require dependency injection, inversion of control, or a service locator to ensure loose coupling, dynamic loading, and the creation of modules.  Prism allows you to choose between Unity, MEF, or another container and provides libraries for Unity or MEF based applications. </li><li>  <b>Minimize the launch time of the application.</b>  Consider loading modules on demand and background loading to minimize application launch time. </li><li>  <b>Determine deployment requirements.</b>  You will need to think about how you intend to deploy your application.  This may affect the number of assemblies collected in XAP files.  You might also share shared libraries, such as Prism, to use assemblies cached in Silverlight. </li></ul><br>  The following sections examine these decisions in detail. <br><br><h4>  Dividing an application into modules </h4><br>  When you develop your application in a modular way, you structure it into separate client modules that can be individually developed, tested, and deployed.  Each module will encapsulate part of the full functionality of your application.  One of the first design decisions that needs to be made is to decide how to divide the functionality of your application into discrete modules. <br><br>  A module must encapsulate a number of related functionality and have a set of different responsibilities.  A module can represent a vertical section of an application or a horizontal layer of services.  Large applications are likely to have both types of modules. <br><br><img title="Application with modules organized around a vertical cut" src="https://habrastorage.org/getpro/habr/post_images/78d/250/a27/78d250a271a0cf389f7aeb73fc2a73bf.png" alt="  ,    "><br><br><img title="Application with modules organized around horizontal layers" src="https://habrastorage.org/getpro/habr/post_images/92f/4a9/e6d/92f4a9e6db894134c303b7483d0828c1.png" alt="  ,    "><br><br>  A large application can have modules organized both in vertical sections and in horizontal layers.  For example, modules may include the following: <br><ul><li>  A module that contains a specific application function, such as the news module in the <i>Stock Trader Reference Implementation (Stock Trader RI)</i> . </li><li>  A module that contains a specific subsystem or functionality for a number of related usage sections, such as purchase, invoicing, or general ledger. </li><li>  A module that contains infrastructure services, such as logging, caching, and authorization services, or web services. </li><li>  A module that contains services that invoke line-of-business (LOB) systems, such as Siebel CRM and SAP, in addition to other internal systems. </li></ul><br>  A module should have a minimum set of dependencies on other modules.  When a module has a dependency on another module, it must be loosely associated with it through the interfaces defined in the shared library, not through specific types, or, using <code>EventAggregator</code> , to communicate with other modules through events. <br><br>  The goal of the modular principle is to divide the application in such a way that it becomes flexible, maintainable, and sustainable, even when functions and technologies are added and removed.  The best way to achieve this is to develop your application so that the modules are as independent as possible, have well-defined interfaces, and are as isolated as possible. <br><br><h5>  Determining the ratio of projects and modules </h5><br>  There are several ways to create and package modules.  The recommended and most common way is to create a single assembly per module.  It helps to separate modules logically and promotes proper encapsulation.  It also allows you to talk about the assembly as a module and vice versa.  However, nothing prevents a single assembly from containing multiple modules, in some cases it may be preferable to minimize the number of projects in your solution.  A large application may well have 10-50 modules.  Moving each module to your own project adds complexity to the solution and can slow down Visual Studio performance.  Sometimes it makes sense to divide a module or a set of modules into your own solutions if you want to stick with one module per project or assembly. <br><br><h5>  XAP and factoring module </h5><br>  For Silverlight applications, modules are usually packaged in separate XAP files, although in some cases, you may have more than one module per XAP.  Consider how many XAP files you need to minimize the number and size of download requests required to run an application and activate a new option.  If you want to split each module into its own project / assembly, you must decide whether to insert each assembly into its own XAP for deployment or include several assemblies in a single XAP. <br><br>  Some factors affecting your choice of whether to include several modules in a single XAP file or to separate them: <br><ul><li>  <b>Download size and shared dependencies.</b>  Each XAP file has a small amount of additional size overhead in its declaration and .zip package.  In addition, if there are common dependencies between modules, and they do not belong to a dependent module or a cached library, then each XAP will include these dependent libraries, which can significantly increase the download size. </li><li>  <b>Synchronize when multiple modules are needed by the application.</b>  If several modules are loaded and used at the same time, such as providing views when the application is started, packing them in a single XAP file can make the download a little faster and guarantee that both modules will be physically available to the client at the same time.  The function of the modular principle Prism ensures that modules that indicate dependencies are loaded in the correct order.  But there is a small amount of performance overhead involved in creating two downloads instead of one, even if the total download size is the same. </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version control modules. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If different modules are developed on independent timelines and potentially deployed separately, you may want to put them in separate XAPs so that they can be marked with different versions more cleanly and updated independently.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To avoid loading the same builds several times in each XAP, there are two approaches that can be used: </font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spread shared dependencies into a separate infrastructure module, and have consumable modules that take dependencies from this shared module. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Use </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assembly Library Caching</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Silverlight to put shared types in a shared library that is loaded once and cached by Silverlight, not by the Prism module loader.</font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Use dependency injection to achieve loose coupling. </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A module may depend on components and services provided by the host application or other modules. </font><font style="vertical-align: inherit;">Prism supports the ability to register dependencies between modules so that they are loaded and initialized in the correct order. </font><font style="vertical-align: inherit;">Prism also supports initialization of modules after they are loaded. </font><font style="vertical-align: inherit;">During initialization, a module can get links to additional components and services that it needs, and / or register any components and services it contains to make them available to other modules.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A module must use an independent mechanism to get instances of external interfaces instead of directly creating specific types. It can do this through a dependency injection container or factory services. Dependency injection containers, such as Unity or MEF, allow a type to automatically obtain interface instances through dependency injection. Prism integrates with both Unity and MEF to allow modules to easily use dependency injection. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following diagram shows a typical sequence of operations when loading modules that are required to get or register links to components and services. </font></font><br><br><img title="  ." src="https://habrastorage.org/getpro/habr/post_images/247/1b3/f07/2471b3f0742c10fcf1770256591be452.png" alt="  ."><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this example, the assembly </font></font><code>OrdersModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defines a class</font></font><code>OrdersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(along with other views and classes that implement the functionality of the order). </font><font style="vertical-align: inherit;">The assembly </font></font><code>CustomerModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defines a class </font></font><code>CustomersViewModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that depends on the class </font></font><code>OrdersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">based on the interface provided by the service. </font><font style="vertical-align: inherit;">The launch of the application and the download process include the following steps:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bootstrapper starts the module initialization process, and the module loader loads and initializes </font></font><code>OrdersModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the initialization stage </font></font><code>OrdersModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, it registers </font></font><code>OrdersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in a container.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Loader module loads </font></font><code>CustomersModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The order of loading modules can be determined based on their metadata.</font></font></li><li> <code>CustomersModule</code>   <code>CustomerViewModel</code> ,    . <code>CustomerViewModel</code>    <code>OrdersRepository</code> (   )         .        ,   ,  <code>OrdersModule</code> .       <code>CustomerViewModel</code>  <code>OrderRepository</code>      . </li></ol><br><blockquote> <b></b> <br> , ,   <code>OrderRespository</code> ( <code>IOrderRepository</code> ),        ,     ,       ,    .  ,      <code>CustomersModule</code>  <code>OrdersModule</code> . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notice that both modules have an implicit dependency on the dependency injection container. </font><font style="vertical-align: inherit;">This dependency is introduced during the creation of the module in the loader.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Basic scripts </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This section describes common scenarios that you encounter when working with modules in your application. </font><font style="vertical-align: inherit;">These scenarios include defining a module, registering and discovering modules, loading modules, initializing modules, determining module dependencies, loading modules on demand, loading remote modules in the background, and determining the status of the loading process. </font><font style="vertical-align: inherit;">You can register modules in code, in XAML, in the application's configuration file, or by scanning the local directory.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Module definition </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A module is a logical set of functionality and resources that can be separately developed, tested, deployed, and integrated into an application. </font><font style="vertical-align: inherit;">Each module has a central class that is responsible for initializing the module and integrating its functionality into the application. </font><font style="vertical-align: inherit;">This class implements the interface </font></font><code>IModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as shown below.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyModule</span></span> : <span class="hljs-title"><span class="hljs-title">IModule</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  . } }</span></span></code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Module names must be unique within the entire application.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The way in which you implement the method </font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will depend on the requirements of your application. </font><font style="vertical-align: inherit;">The class type of the module, the initialization mode, and any dependencies of the module are specified in the module directory. </font><font style="vertical-align: inherit;">For each module in the directory, the loader creates an instance of the module class and then calls the method </font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Modules are processed in the order defined in the modules directory. </font><font style="vertical-align: inherit;">The order of initialization at run time depends on when the modules are loaded, become available, and their dependencies are satisfied. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depending on the type of module directory that your application uses, module dependencies can be set either by declarative attributes directly in the module class, or within the module directory file. </font><font style="vertical-align: inherit;">The following sections will provide more detailed information.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Registration and detection of modules </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The modules that an application can load are defined in the modules directory. Module Loader Prism uses the module directory to determine which modules are available for download, when to load them, and in what order they should be loaded. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The module directory is a class that implements the interface </font></font><code>IModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. The module catalog class is created by the loader class during application initialization. Prism provides various implementations of a catalog of modules from which you can choose the one you need. You can also populate a catalog of modules from another data source by calling a method </font></font><code>AddModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or inheriting a class from </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to create a catalog of modules with specialized behavior.</font></font><br><blockquote> <b></b> <br>  ,   Prism      Common Service Locator,    ,     .    , , ,        ,       ,   . -        . </blockquote><br><h5>     </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The most basic module directory is provided by the class </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">You can use this directory to register modules in code by specifying the class type of the module. </font><font style="vertical-align: inherit;">You can also specify the initialization mode and the module name. </font><font style="vertical-align: inherit;">To register a module directly in a class </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, call a method </font></font><code>AddModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the class of </font></font><code>Bootstrapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your application.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureModuleCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Type moduleCType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ModuleC); ModuleCatalog.AddModule( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModuleInfo() { ModuleName = moduleCType.Name, ModuleType = moduleCType.AssemblyQualifiedName, }); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous example, modules are directly referenced by the shell, thus the types of classes of modules that can be used in the method call are defined </font></font><code>AddModule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">That is why this example uses </font></font><code>typeof(Module)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to add modules to a directory.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If the application has a direct link to the module type, you can add this type, as shown above. </font><font style="vertical-align: inherit;">Otherwise, you must provide the fully qualified type name and location of the assembly.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To see another example of the determination module catalog in the code refer </font></font><code>StockTraderRIBootstrapper.cs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stock Trader the RI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The base class </font></font><code>Bootstrapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provides a method </font></font><code>CreateModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to assist in the creation </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">By default, this method creates an instance </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, but this method can be overridden in a derived class to create other types of module catalog.</font></font></blockquote><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Registering Modules Using the XAML File </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can define a catalog of modules declaratively in a XAML file. The XAML file determines which module directory class to create and which modules to add to it. Usually the </font></font><code>.xaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file is added as a resource to your shell project. The catalog of modules is created in the loader by a method call </font></font><code>CreateFromXaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. From a technical point of view, this approach is similar to the definition </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in code, because the XAML file simply defines a hierarchy of objects to be instantiated. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following code example shows a XAML file that defines a directory of modules.</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleCatalog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:sys</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:System;assembly=mscorlib"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:Modularity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:Microsoft.Practices.Prism.Modularity;assembly=Microsoft.Practices.Prism"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfoGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleB.xap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">InitializationMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WhenAvailable"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleB"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleB.ModuleB, ModuleB, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfoGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfoGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">InitializationMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OnDemand"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE.xap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE.ModuleE, ModuleE, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF.xap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF.ModuleF, ModuleF, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo.DependsOn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sys:String</span></span></span><span class="hljs-tag">&gt;</span></span>ModuleE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sys:String</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo.DependsOn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfoGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleD.xap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleD.ModuleD, ModuleD, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleCatalog</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notes</font></font></b> <br> <code>ModuleInfoGroups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> provide a convenient way to group modules that are in the same .xap file or assembly, initialized in the same way, or have dependencies only on modules in the same group. </font><font style="vertical-align: inherit;">The dependencies between the modules can be defined within the modules </font></font><code>ModuleInfoGroup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, however, it is not possible to specify the dependencies between the modules in different </font></font><code>ModuleInfoGroups</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Placing modules into groups of modules is optional. </font><font style="vertical-align: inherit;">The properties that are set for the group will be applied to all modules in it. </font><font style="vertical-align: inherit;">Note that modules can also be registered without being in a group.</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the class, </font></font><code>Bootstrapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you must indicate that the XAML file is the source for </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as shown below.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IModuleCatalog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateModuleCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ModuleCatalog.CreateFromXaml( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/MyProject.Silverlight;component/ModulesCatalog.xaml"</span></span>, UriKind.Relative)); }</code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Registration of modules using the configuration file </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In WPF, it is possible to specify information about a module in a file </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The advantage of this approach is that this file is not compiled into the application. </font><font style="vertical-align: inherit;">This makes it easy to add or remove modules at runtime, without recompiling the application. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following code shows the configuration file that defines the module directory. </font><font style="vertical-align: inherit;">If you want the module to automatically load, install </font></font><code>startupLoaded="true"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">assemblyFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModularityWithUnity.Desktop.ModuleE.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModularityWithUnity.Desktop.ModuleE, ModularityWithUnity.Desktop.ModuleE, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">startupLoaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">assemblyFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModularityWithUnity.Desktop.ModuleF.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModularityWithUnity.Desktop.ModuleF, ModularityWithUnity.Desktop.ModuleF, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">startupLoaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Even if your assemblies are in the global assembly cache or in the same folder as the application, an attribute is required </font></font><code>assemblyFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The attribute is used to map </font></font><code>moduleType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to the correct </font></font><code>IModuleTypeLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one to be used.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><code>Bootstrapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application </font><font style="vertical-align: inherit;">class </font><font style="vertical-align: inherit;">, you must specify that the configuration file is the source for </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To do this, use the class </font></font><code>ConfigurationModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as shown in the following code.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IModuleCatalog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateModuleCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationModuleCatalog(); }</code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You can still add modules to </font></font><code>ConfigurationModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the code. </font><font style="vertical-align: inherit;">You can use this, for example, in order to make sure that the modules absolutely necessary for the operation of your application are added to the module directory.</font></font></blockquote><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Silverlight does not support configuration files. </font><font style="vertical-align: inherit;">If you want to use this approach for configuration in Silverlight, it is recommended to create your own </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which reads the configuration of modules from the web service on the server.</font></font></blockquote><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Locate modules in the local directory </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The class </font></font><code>DirectoryModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">allows you to specify a local directory as a module directory in WPF. </font><font style="vertical-align: inherit;">This module directory will scan the specified folder, and look for assemblies that provide modules for your application. </font><font style="vertical-align: inherit;">To use this approach, you will need to use declarative attributes on your module classes to determine the module names and any dependencies they have. </font><font style="vertical-align: inherit;">The following code example shows a directory of modules that is populated by detecting assemblies in a local directory.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IModuleCatalog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateModuleCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DirectoryModuleCatalog() {ModulePath = <span class="hljs-string"><span class="hljs-string">@".\Modules"</span></span>}; }</code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This functionality is not supported in Silverlight, because the Silverlight security model does not allow you to load assemblies from the file system.</font></font></blockquote><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Module loading </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full, the modules are ready for loading and initialization. </font><font style="vertical-align: inherit;">Loading a module means that the module assembly is loaded from disk into memory. </font><font style="vertical-align: inherit;">If the assembly is not on disk, you may need to first get it from another source. </font><font style="vertical-align: inherit;">An example of this is downloading an assembly from the Internet using Silverlight </font></font><code>.xap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files. </font></font><code>ModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">responsible for coordinating the initialization and loading process.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Module initialization </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After loading the modules, they are initialized. </font><font style="vertical-align: inherit;">This means that an instance of the module class is created and its method is </font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">called. </font><font style="vertical-align: inherit;">Initialization is where the module is integrated into the application. </font><font style="vertical-align: inherit;">Consider the following options when initializing a module:</font></font><br><ul><li> <b>     .</b>         ,     ,              . </li><li> <b>      .</b>      / ,    .   <code>Initialize</code> ,          . ,    ,    ,        .  ,            . ,     <code>MenuService</code> (      ),  <code>Initialize</code>  ‚Äì  ,      . <br><blockquote> <b></b> <br>        .  ,    <code>Initialize</code>    ,     .         ,      .       ,     ,       ,     ¬´¬ª    . </blockquote></li><li> <b>     .</b>      ,   Unity  MEF,             .        ,    . </li></ul><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determination of module dependencies </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules may depend on other modules. </font><font style="vertical-align: inherit;">If </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module A</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> depends on the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module B</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module B</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> must be initialized before </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module A</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>ModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keeps track of these dependencies and initializes the modules in the correct order. </font><font style="vertical-align: inherit;">Depending on how you defined your module catalog, you can define your module dependencies in code, configuration, or XAML.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determining code dependencies </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For WPF applications that register modules in code or find them in a folder, Prism provides declarative attributes for the module class, as shown in the following example. </font></font><br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Module(ModuleName = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ModuleA"</span></span></span><span class="hljs-meta">)</span></span>] [ModuleDependency(<span class="hljs-string"><span class="hljs-string">"ModuleD"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModuleA</span></span>: <span class="hljs-title"><span class="hljs-title">IModule</span></span> { ... }</code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determination of dependencies in XAML </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following XAML shows that the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module F</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> depends on </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the Module E</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF.xap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleF.ModuleF, ModuleF, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo.DependsOn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sys:String</span></span></span><span class="hljs-tag">&gt;</span></span>ModuleE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sys:String</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo.DependsOn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determination of dependencies in the configuration file </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following example shows App.config file that </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module D</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> depends </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Module B</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modules</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">assemblyFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Modules/ModuleD.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleD.ModuleD, ModuleD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleD"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleB"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Loading modules on demand </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To load modules on demand, you must specify that they should be loaded into the module directory with the parameter set </font></font><code>InitializationMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>OnDemand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">After that, you must add code to your application requesting module loading.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Load on demand job in code </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The definition that the module should be loaded on demand through attributes is shown in the following example. </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureModuleCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Type moduleCType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ModuleC); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ModuleCatalog.AddModule(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModuleInfo() { ModuleName = moduleCType.Name, ModuleType = moduleCType.AssemblyQualifiedName, InitializationMode = InitializationMode.OnDemand }); }</code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> XAML load on demand job </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can determine </font></font><code>InitializationMode.OnDemand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when you </font><font style="vertical-align: inherit;">specify a </font><font style="vertical-align: inherit;">module directory in XAML, as shown in the following code example.</font></font><br><br><pre> <code class="xml hljs">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfoGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">InitializationMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OnDemand"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Modularity:ModuleInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE.xap"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ModuleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleE.ModuleE, ModuleE, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ...</code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Set load on demand in the configuration file </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can specify </font></font><code>InitializationMode.OnDemand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when specifying a directory of modules in a file </font></font><code>App.config</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as shown in the following code example.</font></font><br><br><pre> <code class="xml hljs">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">assemblyFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Modules/ModuleC.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleC.ModuleC, ModuleC"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModuleC"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">startupLoaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> ....</code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Module load request </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the module is defined as loadable on demand, the application may request that it be loaded. </font><font style="vertical-align: inherit;">The code that wants to initiate the download is required to obtain a link to the service </font></font><code>IModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registered in the container by the loader.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnLoadModuleCClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { moduleManager.LoadModule(<span class="hljs-string"><span class="hljs-string">"ModuleC"</span></span>); }</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remote module loading in the background </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Loading modules in the background after the application is launched, or only when the user needs them, can reduce the application launch time. </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preparing the module for remote download </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Silverlight applications, modules are packaged into </font></font><code>.xap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files. </font><font style="vertical-align: inherit;">To load the module separately from the application, create a separate </font></font><code>.xap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file. </font><font style="vertical-align: inherit;">You may want to put several modules in a single </font></font><code>.xap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file in order to optimize the number of load requests for replacing the size of each .xap file.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For each .xap file, you will need to create a new Silverlight application project. </font><font style="vertical-align: inherit;">In Visual Studio 2008 and 2010, only application projects produce separate </font></font><code>.xap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files. </font><font style="vertical-align: inherit;">You will not need </font></font><code>App.xaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or files </font></font><code>MainPage.xaml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in these projects.</font></font></blockquote><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tracking the boot process </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The class </font></font><code>ModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provides an event to track the progress of loading modules. </font><font style="vertical-align: inherit;">It provides loaded bytes versus full load size for percent promotion. </font><font style="vertical-align: inherit;">You can use it to display visual indicators of the download progress.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.moduleManager.ModuleDownloadProgressChanged += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ModuleManager_ModuleDownloadProgressChanged;</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModuleManager_ModuleDownloadProgressChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, ModuleDownloadProgressChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { ... }</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determining if a module has been loaded </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The service </font></font><code>ModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provides an event to track when a module is loaded or not able to load.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.moduleManager.LoadModuleCompleted += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ModuleManager_LoadModuleCompleted;</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModuleManager_LoadModuleCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, LoadModuleCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To keep the application and modules loosely coupled, you should avoid using this event to integrate the module with the application. </font><font style="vertical-align: inherit;">Use the module method instead </font></font><code>Initialize</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <code>LoadModuleCompletedEventArgs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contains a property </font></font><code>IsErrorHandled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If the module fails to load, and the application wants to prevent it from </font></font><code>ModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registering an error and throwing an exception, you must set this property to </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After the module is loaded and initialized, the module assembly cannot be unloaded. </font><font style="vertical-align: inherit;">The module instance reference will not be saved by Prism libraries, so an instance of the module class can be garbage collected after initialization has been completed.</font></font></blockquote><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modules in MEF </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This section only highlights the differences when using MEF as a dependency injection container. </font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When using MEF, </font></font><code>MefBootstrapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uses </font></font><code>MefModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It extends </font></font><code>ModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and implements the interface </font></font><code>IPartImportsSatisfiedNotification</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to ensure that it is </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updated when new types are imported by MEF.</font></font></blockquote><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Registering Modules in Code Using MEF </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When using MEF, you can apply an attribute </font></font><code>ModuleExport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to module classes so that MEF can automatically detect them.</font></font><br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ModuleExport(typeof(ModuleB))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModuleB</span></span> : <span class="hljs-title"><span class="hljs-title">IModule</span></span> { ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can also use MEF to locate and load modules using a class </font></font><code>AssemblyCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that can be used to locate all exported module classes in an assembly, and a class </font></font><code>AggregateCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that allows multiple directories to be combined into one logical directory. </font><font style="vertical-align: inherit;">By default, the class </font></font><code>MefBootstrapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creates an instance </font></font><code>AggregateCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">You can override the method </font></font><code>ConfigureAggregateCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to register assemblies.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureAggregateCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.ConfigureAggregateCatalog(); <span class="hljs-comment"><span class="hljs-comment">// Module A        . this.AggregateCatalog.Catalogs.Add( new AssemblyCatalog(typeof(ModuleA).Assembly)); this.AggregateCatalog.Catalogs.Add( new AssemblyCatalog(typeof(ModuleC).Assembly)); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Prism implementation </font></font><code>MefModuleManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">synchronizes </font></font><code>AggregateCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEF and Prism </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, thus allowing Prism to detect modules added through </font></font><code>ModuleCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>AggregateCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MEF is widely used</font></font><code><code>Lazy,           Value</code> .</code> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Locate modules in a local directory using MEF </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MEF provides a class </font></font><code>DirectoryCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that can be used to view a folder for assemblies containing modules (and other MEF types exported). </font><font style="vertical-align: inherit;">In this case, you override the method </font></font><code>ConfigureAggregateCatalog</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to register the directory. </font><font style="vertical-align: inherit;">This approach is only available in WPF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To use this approach, you must first define the module names and their dependencies using an attribute </font></font><code>ModuleExport</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as shown in the following example.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureAggregateCatalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.ConfigureAggregateCatalog(); DirectoryCatalog catalog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DirectoryCatalog(<span class="hljs-string"><span class="hljs-string">"DirectoryModules"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.AggregateCatalog.Catalogs.Add(catalog); }</code> </pre> <br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Defining code dependencies using MEF </font></font></h5><br>   WPF,   <code>ModuleExport</code> ,   . <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ModuleExport(typeof(ModuleA), DependsOnModuleNames = new string[</span></span>] { <span class="hljs-string"><span class="hljs-string">"ModuleD"</span></span> })] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModuleA</span></span> : <span class="hljs-title"><span class="hljs-title">IModule</span></span> { ... }</code> </pre> <br>  MEF       ,          .    MEF   <code>ModuleCatalog</code> ,  ,  <code>ModuleCatalog</code>   ,    XAML   (  -   ).      <code>ModuleCatalog</code>       MEF,     <code>ModuleCatalog</code> ,   <code>DependsOnModuleNames</code>  .  MEF  <code>ModuleCatalog</code>     Silverlight,        XAP. <br><br><h5>      MEF </h5><br>    MEF   <code>ModuleExport</code>  ,       ,    <code>InitializationMode</code> ,  ,       ,   . <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ModuleExport(typeof(ModuleC), InitializationMode = InitializationMode.OnDemand)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModuleC</span></span> : <span class="hljs-title"><span class="hljs-title">IModule</span></span> { ... }</code> </pre> <br><h5>       MEF </h5><br>  ,  Prism,  MEF,   MEF <code>DeploymentCatalog</code> ,   <code>.xap</code>          .xap . <code>MefXapModuleTypeLoader</code>   <code>DeploymentCatalog</code>  <code>AggregateCatalog</code> . <br><br>    <code>.xap</code>           ,     .     ,         ,   . <code>Microsoft.Practices.Prism.MefExtensions.dll</code>   . <br><br>    ,          DLL  <code>'Copy Local'=false</code> .       .xap      .       .xap .   ,        ,  ,    .xap ,      ,  .xap    . <br><br><h3>  Additional Information </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For more information about assembly caching, see "How to: Use Assembly Library Caching" on MSDN: </font></font><a href="http://msdn.microsoft.com/en-us/library/dd833069(VS.95).aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://msdn.microsoft.com/en-us/library/dd833069 (</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VS.95 ) </font><a href="http://msdn.microsoft.com/en-us/library/dd833069(VS.95).aspx"><font style="vertical-align: inherit;">.aspx</font></a></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To learn more about modular principle in Prism, see Modularity with MEF for WPF QuickStart or Modularity with Unity for WPF QuickStart. </font><font style="vertical-align: inherit;">To learn more about QuickStarts, see </font></font><a href="http://msdn.microsoft.com/en-us/library/ff921068(v%3DPandP.40).aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modularity QuickStarts for WPF</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For information about the Prism library functions used in building modular applications, see " </font></font><a href="http://msdn.microsoft.com/en-us/library/gg430866(v%3DPandP.40).aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " in " </font></font><a href="http://msdn.microsoft.com/en-us/library/gg430866(v%3DPandP.40).aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extending Prism</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ."</font></font></blockquote></div><p>Source: <a href="https://habr.com/ru/post/176863/">https://habr.com/ru/post/176863/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176851/index.html">Prism Developer Guide - Part 1, Introduction</a></li>
<li><a href="../176853/index.html">Prism Developer Guide - Part 2, Initializing Prism Applications</a></li>
<li><a href="../176857/index.html">Stanford invented a fully passive air conditioner</a></li>
<li><a href="../176859/index.html">Chronicles of LinguaLeo: how we did ‚ÄúDialogues in English‚Äù with Node.js and DynamoDB</a></li>
<li><a href="../176861/index.html">Prism Developer Guide - Part 3, managing dependencies between components</a></li>
<li><a href="../176867/index.html">Prism Developer Guide - Part 5, MVVM Pattern Implementation</a></li>
<li><a href="../176869/index.html">Prism Developer Guide - Part 6, Advanced MVVM Scripts</a></li>
<li><a href="../176877/index.html">How we did the Rubens Pipe</a></li>
<li><a href="../176879/index.html">ePayService at RIF + CIB 2013</a></li>
<li><a href="../176881/index.html">Mitap-group ‚ÄúMoscow Cassandra Users‚Äù starts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>