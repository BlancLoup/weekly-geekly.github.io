<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a video converter from 264 to avi for the QCM-08DL dashcam</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In fact, the article is devoted to the development of a program for repacking a DVR video from one container to another, if this can be called a conve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a video converter from 264 to avi for the QCM-08DL dashcam</h1><div class="post__text post__text-html js-mediator-article">  In fact, the article is devoted to the development of a program for repacking a DVR video from one container to another, if this can be called a conversion.  Although, all my life I believed that the converter is engaged in the conversion (recoding) of the video format.  This article is the second part of my previous publication, where I talked in detail about access to all video recorders of the DVR.  But at the very beginning of the publication I set another task: to study the algorithm that the regular 264-avi repackaging program works on and create the same program that would perform the same operations, but not on one, but on a whole group of files, and "One click". <br><a name="habracut"></a><br>  Let me explain once again the essence of all things in simple language. <br><br>  The user has a DVR, for example, the popular model QCM-08DL.  He needs a video for a certain date and time.  He can extract it either to a USB flash drive or via a DVR web interface to a computer.  The extracted video file (extension .264) will open only in the player program that came with the DVR.  The player is very uncomfortable.  It can also be opened in the VLC player by setting the RAW H264 mode in the demultiplexing settings (settings for advanced users).  But at the same time, blocks of audio streams, which are interpreted as video, interfere with normal playback, but there is no soundtrack.  And in order to open a video in any player, the .264 file must first be converted to some popular format, for example, avi.  A conversion program is also included with the DVR.  But she is also very uncomfortable.  When it comes to one or more files, there are no problems.  However, when the task is to get access to all the videos on the hard disk, and even more so to convert them all into a popular format, the standard toolkit is practically not suitable. <br><br><img src="https://habrastorage.org/webt/c2/t-/ca/c2t-cawgmqhqg-vqtlwof8vwqn0.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The task of access to all files solved.  This was the subject of the last publication.  We proceed to the solution of the second problem.  I have already been given "practical advice": it is enough to rename the extension from "264" to "avi" in the file name, and everything will trample, they say, there is nothing to bother with.  But this is the most common mistake of any ordinary user, who, as a rule, does not understand the relevant issues. <br><br>  In the last publication I already wrote briefly about the structure of the source file. 264.  I will remind you. <br><br>  <i>Basic information from audio and video streams begins at an offset of 65,536 bytes.</i>  <i>Blocks of a video stream begin with an 8-byte header ‚Äú01dcH264‚Äù (there is also ‚Äú00dcH264‚Äù).</i>  <i>The following 4 bytes describe the size of the current block of the video stream in bytes.</i>  <i>After 4 bytes of zeros (00 00 00 00) the video stream block itself begins.</i>  <i>Blocks of audio streams have the header ‚Äú03wb‚Äù (although, according to my observations, the first character of the header in some cases was not necessarily ‚Äú0‚Äù).</i>  <i>After - 12 bytes of information, which I have not yet divined.</i>  <i>And starting from the 17th byte - a fixed-length audio stream of 160 bytes.</i>  <i>There are no tags at the end of the file.</i> <br><br>  I will comment on the foregoing.  Everything that is before the offset of 65536 bytes, turned out to be unsolved and unnecessary.  From the offset of 65536 bytes to the first header of the stream there is a small gap, the contents of which are also not solved, and, moreover, as I checked, it is not found in the output avi file after conversion by a regular program. <br><br>  Each block of the video stream is one frame.  The first character in the block header of the video stream is optional "0".  I did not guess his purpose, because, as I found out, it is not the key to solving the task.  The second character of the video stream header can be either ‚Äú1‚Äù or ‚Äú0‚Äù.  In the second case, the content of the video stream block is the so-called reference frame.  And in the first case, the content of the video stream block is an encoded compressed frame, which depends on the reference frame.  The size of the contents of the reference frame is much larger than the size of the contents of the compressed auxiliary frame.  The repetition period of the reference frames most likely depends on the settings for the compression ratio in the DVR.  But in my case, the repetition period was 1 frame / sec. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yq/rl/k2/yqrlk2j_kl3x3gkx_ee1i3pcucc.jpeg"></div><br>  The standard program for repacking video from the ‚Äú264‚Äù container into the ‚Äúavi‚Äù container gave different results regarding the frame rate.  In the case of videos that were recorded in high resolution mode (704 * 576), the frame rate was 20 frames / sec.  And in the case of low resolution (352 * 288) - 25 frames / sec.  This information is provided by the MediaInfo utility. It also shows that the video size is the same for any case: 720 * 576, and the size of the video stream (the same utility reports) is 704 * 576 or 352 * 288.  Most players are deployed precisely under the size of the video stream.  However, I met a player that incorrectly displayed a half-screen mode when playing a 352 * 288 file.  I wanted to correct this minor flaw in the staff repacker by looking at the bytes of the content of the video stream and pulling out the frame size information from there.  But in a hurry, I could not do it.  The above is illustrated in the figure below. <br><br><img src="https://habrastorage.org/webt/ap/ad/z5/apadz55b06yvjdj4m1vyzcekwzu.png"><br><br>  Now about the frame rate.  As I found out, the regular repacker does not refer to any header field of the ‚Äú264‚Äù container.  He judges the frame rate by calculating the ratio of the number of video blocks and audio streams.  And this value is not even rounded to the integer value when calculating, as can be seen from the figure above (circled in green).  As I found out, the number of blocks of an audio stream per unit of time is always and everywhere (in any file) fixed, namely, 25 blocks per second.  If you examine a video file with a frequency of 20 frames / sec., Then the reference frame (block) is encountered every 19 compressed frames, and for the case of 25 frames / sec.  - every 24 compressed frames. <br><br>  We will continue to study the structure of the video stream header.  We figured out the first eight bytes: this is the label of the reference or compressed frame plus the keyword "H264".  The next four bytes describe, as I found out, not the exact, but the approximate size of the contents of the video stream.  A regular repacker transfers all the bytes of this content completely, and then the resulting size is written into the corresponding fields of the avi-container.  And this value is different from the value specified in the corresponding field of the original .264 file. <br><br>  Twelve bytes of information after the block header of the audio stream, I partially guessed.  In any case, the key elements are the last 4 bytes, after which the audio stream begins.  These are two 16-bit numbers that describe the initial parameters of the iterative decoding scheme from ADPCM to PCM.  Decoding increases the size of the audio stream by 4 times.  I found out in advance, after a detailed examination of the files, that the regular repacker decodes audio, but leaves the video content unchanged. <br><br>  Having no deep knowledge, for a long time I tried to figure out exactly which decoding algorithm was used in my case.  Intuitively, I already guessed that the ADPCM compression method was used.  More precisely, not intuitively, but with a competent approach, based on the fact that the audio stream is compressed exactly 4 times.  And when opening a fragment in Adobe Audition as RAW in various formats (and comparing the same fragment after repacking with a regular program), the ADPCM gave me a very similar (but not exact) sound result.  Information on the <a href="https://wiki.multimedia.cx/index.php/IMA_ADPCM">wiki.multimedia.cx/index.php/IMA_ADPCM</a> website helped me to parse the compression algorithm.  Here I learned about the two initial decoding parameters, and then, using the ‚Äúspear method,‚Äù I guessed that these initial parameters were recorded in 4 bytes before the beginning of the audio stream.  I will describe the work of the algorithm and give a rough mathematical interpretation (under the spoiler). <br><br><div class="spoiler">  <b class="spoiler_title">Details of the ADPCM decoding algorithm</b> <div class="spoiler_text">  There is a sequence of samples. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-8" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-10"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-12" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-13" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-14">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">s</span><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.755ex" height="2.486ex" viewBox="0 -772.3 6783.2 1070.5" role="img" focusable="false" style="vertical-align: -0.693ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-30" x="809" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2C" x="1026" y="0"></use><g transform="translate(1471,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2C" x="2497" y="0"></use><g transform="translate(2943,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2C" x="3969" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-64" x="4664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-6F" x="5188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-74" x="5673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-73" x="6035" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2E" x="6504" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> x_0, x_1, x_2, \ dots. </script>  In addition, as already mentioned, there are two initial parameters <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-20"><span class="MJXp-msubsup" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-23" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.193ex" height="1.936ex" viewBox="0 -535.3 944.4 833.5" role="img" focusable="false" style="vertical-align: -0.693ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-30" x="693" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> y_0 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-24"><span class="MJXp-msubsup" id="MJXp-Span-25"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-27" style="vertical-align: -0.4em;">0</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.145ex" height="1.798ex" viewBox="0 -535.3 923.4 774.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-30" x="663" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> s_0 </script>  .  Need to get a new sequence of samples <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-28"><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-31" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-36" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-39" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mtext" id="MJXp-Span-40">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">s</span><span class="MJXp-mo" id="MJXp-Span-45" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.149ex" height="2.486ex" viewBox="0 -772.3 6092.1 1070.5" role="img" focusable="false" style="vertical-align: -0.693ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-30" x="693" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2C" x="944" y="0"></use><g transform="translate(1389,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-31" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2C" x="2333" y="0"></use><g transform="translate(2779,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-32" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-64" x="3973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-6F" x="4497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-74" x="4982" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMATHI-73" x="5344" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/422163/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjyGmBRS3DcgnMU-j73PqrXGI3bFw#MJMAIN-2E" x="5813" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> y_0, y_1, y_2 \ dots. </script>  .  As you can already guess, the first output sample is already known: it coincides with one of the initial parameters. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-46"><span class="MJXp-msubsup" id="MJXp-Span-47"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-5"> y_0 </script>  .  This is something other than ‚Äúinitial displacement‚Äù.  It is worth noting that the input (source) samples are encoded with four bits.  For sign types, integers from -8 to 7 inclusive are included in the encoding.  The high bit is essentially responsible for the sign of the number.  PCM output samples that are obtained after decoding have a sign 16-bit standard format. <br><br>  Analyzing the code of the algorithm in C, you can see two tables.  They are listed below. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ima_index_table[] = { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> };</code> </pre> <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ima_step_table[] = { <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">41</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">66</span></span>, <span class="hljs-number"><span class="hljs-number">73</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">88</span></span>, <span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">107</span></span>, <span class="hljs-number"><span class="hljs-number">118</span></span>, <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">143</span></span>, <span class="hljs-number"><span class="hljs-number">157</span></span>, <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-number"><span class="hljs-number">190</span></span>, <span class="hljs-number"><span class="hljs-number">209</span></span>, <span class="hljs-number"><span class="hljs-number">230</span></span>, <span class="hljs-number"><span class="hljs-number">253</span></span>, <span class="hljs-number"><span class="hljs-number">279</span></span>, <span class="hljs-number"><span class="hljs-number">307</span></span>, <span class="hljs-number"><span class="hljs-number">337</span></span>, <span class="hljs-number"><span class="hljs-number">371</span></span>, <span class="hljs-number"><span class="hljs-number">408</span></span>, <span class="hljs-number"><span class="hljs-number">449</span></span>, <span class="hljs-number"><span class="hljs-number">494</span></span>, <span class="hljs-number"><span class="hljs-number">544</span></span>, <span class="hljs-number"><span class="hljs-number">598</span></span>, <span class="hljs-number"><span class="hljs-number">658</span></span>, <span class="hljs-number"><span class="hljs-number">724</span></span>, <span class="hljs-number"><span class="hljs-number">796</span></span>, <span class="hljs-number"><span class="hljs-number">876</span></span>, <span class="hljs-number"><span class="hljs-number">963</span></span>, <span class="hljs-number"><span class="hljs-number">1060</span></span>, <span class="hljs-number"><span class="hljs-number">1166</span></span>, <span class="hljs-number"><span class="hljs-number">1282</span></span>, <span class="hljs-number"><span class="hljs-number">1411</span></span>, <span class="hljs-number"><span class="hljs-number">1552</span></span>, <span class="hljs-number"><span class="hljs-number">1707</span></span>, <span class="hljs-number"><span class="hljs-number">1878</span></span>, <span class="hljs-number"><span class="hljs-number">2066</span></span>, <span class="hljs-number"><span class="hljs-number">2272</span></span>, <span class="hljs-number"><span class="hljs-number">2499</span></span>, <span class="hljs-number"><span class="hljs-number">2749</span></span>, <span class="hljs-number"><span class="hljs-number">3024</span></span>, <span class="hljs-number"><span class="hljs-number">3327</span></span>, <span class="hljs-number"><span class="hljs-number">3660</span></span>, <span class="hljs-number"><span class="hljs-number">4026</span></span>, <span class="hljs-number"><span class="hljs-number">4428</span></span>, <span class="hljs-number"><span class="hljs-number">4871</span></span>, <span class="hljs-number"><span class="hljs-number">5358</span></span>, <span class="hljs-number"><span class="hljs-number">5894</span></span>, <span class="hljs-number"><span class="hljs-number">6484</span></span>, <span class="hljs-number"><span class="hljs-number">7132</span></span>, <span class="hljs-number"><span class="hljs-number">7845</span></span>, <span class="hljs-number"><span class="hljs-number">8630</span></span>, <span class="hljs-number"><span class="hljs-number">9493</span></span>, <span class="hljs-number"><span class="hljs-number">10442</span></span>, <span class="hljs-number"><span class="hljs-number">11487</span></span>, <span class="hljs-number"><span class="hljs-number">12635</span></span>, <span class="hljs-number"><span class="hljs-number">13899</span></span>, <span class="hljs-number"><span class="hljs-number">15289</span></span>, <span class="hljs-number"><span class="hljs-number">16818</span></span>, <span class="hljs-number"><span class="hljs-number">18500</span></span>, <span class="hljs-number"><span class="hljs-number">20350</span></span>, <span class="hljs-number"><span class="hljs-number">22385</span></span>, <span class="hljs-number"><span class="hljs-number">24623</span></span>, <span class="hljs-number"><span class="hljs-number">27086</span></span>, <span class="hljs-number"><span class="hljs-number">29794</span></span>, <span class="hljs-number"><span class="hljs-number">32767</span></span> };</code> </pre><br><br>  These two ‚Äúmagic‚Äù arrays, one may say, are table functions, the arguments of which are substituted for the very two initial parameters, respectively.  During the iteration process, with each step, the parameters are recalculated and substituted into these tables again.  First, let's see how this is implemented in the code. <br><br>  We declare necessary, including auxiliary variables. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> current1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> step; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stepindex1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> diff; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> current; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stepindex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value; <span class="hljs-comment"><span class="hljs-comment">//  ;</span></span></code> </pre><br><br>  Before the start of the iteration, you must assign the initial parameter to the variable current. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-50"><span class="MJXp-msubsup" id="MJXp-Span-51"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-53" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-6"> y_0 </script>  , and stepindex variable - <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-54"><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-57" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-7"> s_0 </script>  .  This is done outside of the considered algorithm, so I do not reflect this code.  This is followed by conversions that are performed in a circle (in a loop). <br><br><pre> <code class="cpp hljs"> value = read(input_sample); <span class="hljs-comment"><span class="hljs-comment">//   ; current1 = current; stepindex1 = stepindex; step = ima_step_table[stepindex1]; diff = step&gt;&gt;3; if(value &amp; 1){ diff += step &gt;&gt; 2; } if(value &amp; 2){ diff += step &gt;&gt; 1; } if(value &amp; 4){ diff += step; } if(value &amp; 8){ current1 -= diff; if(current1 &lt; -32768){ //,  ""; current1 = -32768; } }else{ current1 += diff; if(current1 &gt; 32767){ //,  ""; current1 = 32767; } } //      :   current1; stepindex1 += ima_index_table[value &amp; 7]; if(stepindex1 &lt; 0){ // ""; stepindex1 = 0; } if(stepindex1 &gt; 88){ // ""; stepindex1 = 88; } output_sample = curent1; //   ; current = current1; stepindex = stepindex1;</span></span></code> </pre><br><br>  In the auxiliary step variable from the ima_step_table array, the value at the stepindex1 index is written.  For the first iteration, this is the initial parameter. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-58"><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-61" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-8"> s_0 </script>  For further iterations, this is a recalculated parameter. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-62"><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-9"> s_i </script>  .  Then the value from this array is divided by 8 (apparently, completely) by the bit shift to the right, and the variable diff is initialized as a result of this division.  Then, the three low-order bits of the input sample value are analyzed and, depending on their states, the diff variable can be corrected by three terms.  The terms represent a similar integer division of the diff value by 4 (&gt;&gt; 2), by 2 (&gt;&gt; 1), or diff without changes (let it be the division by 1 for generalization).  Then the most significant (sign) bit of the value of the input sample is analyzed.  Depending on its state, the variable diff, which was formed before this, is added or subtracted to the variable current1.  This will be the value of the output sample.  For correctness, the values ‚Äã‚Äãare limited above and below.  Then stepindex1 is corrected by adding a value from the ima_index_table array to the index value of the input sample with a zero-bit sign bit.  The values ‚Äã‚Äãof stepindex1 are also subject to a limit.  At the very end, before repeating this algorithm, the values ‚Äã‚Äãof current and stepindex are assigned the values ‚Äã‚Äãof current1 and stepindex1 just recalculated, and the algorithm is repeated anew. <br><br>  You can try to figure out how to figure out how the diff variable is formed.  Let be <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-66"><span class="MJXp-msubsup" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-69" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">f</span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-76" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-10"> f_i = f (s_i) </script>  .  These are the values ‚Äã‚Äãof the step variable at each i-th iteration step, as the value of the function (array) of the argument <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-77"><span class="MJXp-msubsup" id="MJXp-Span-78"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-80" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-11"> s_i </script>  where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">i</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-84">0</span><span class="MJXp-mo" id="MJXp-Span-85" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-86">1</span><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-88">2</span><span class="MJXp-mo" id="MJXp-Span-89" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-90">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">s</span></span></span><script type="math/tex" id="MathJax-Element-12"> i = 0, 1, 2, \ dots </script>  .  For convenience, we denote the diff variable as <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-95"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">d</span></span></span><script type="math/tex" id="MathJax-Element-13"> d </script>  .  Following the logic of the arguments described above, we have: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-97"><span class="MJXp-msubsup" id="MJXp-Span-98"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-100" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-101" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-102">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">c</span><span class="MJXp-mrow" id="MJXp-Span-107"><span class="MJXp-msubsup" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-110" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-111"><span class="MJXp-mn" id="MJXp-Span-112">8</span></span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-117"><span class="MJXp-mo" id="MJXp-Span-118">(</span><span class="MJXp-mn" id="MJXp-Span-119">0</span><span class="MJXp-mo" id="MJXp-Span-120">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">i</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-121">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">c</span><span class="MJXp-mrow" id="MJXp-Span-126"><span class="MJXp-msubsup" id="MJXp-Span-127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-129" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-130"><span class="MJXp-mn" id="MJXp-Span-131">4</span></span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-136"><span class="MJXp-mo" id="MJXp-Span-137">(</span><span class="MJXp-mn" id="MJXp-Span-138">1</span><span class="MJXp-mo" id="MJXp-Span-139">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">i</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-140">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">c</span><span class="MJXp-mrow" id="MJXp-Span-145"><span class="MJXp-msubsup" id="MJXp-Span-146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-148" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-149"><span class="MJXp-mn" id="MJXp-Span-150">2</span></span><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-155"><span class="MJXp-mo" id="MJXp-Span-156">(</span><span class="MJXp-mn" id="MJXp-Span-157">2</span><span class="MJXp-mo" id="MJXp-Span-158">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">i</span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-159"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-161" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-162" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><script type="math/tex;mode=display" id="MathJax-Element-14"> d_i = \ frac {f_i} {8} + x ^ {(0)} _ i \ frac {f_i} {4} + x ^ {(1)} _ i \ frac {f_i} {2} + x ^ {( 2)} _ if_i, </script></p>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-163"><span class="MJXp-msubsup" id="MJXp-Span-164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-mo" id="MJXp-Span-168">(</span><span class="MJXp-mn" id="MJXp-Span-169">0</span><span class="MJXp-mo" id="MJXp-Span-170">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-175"><span class="MJXp-mo" id="MJXp-Span-176">(</span><span class="MJXp-mn" id="MJXp-Span-177">1</span><span class="MJXp-mo" id="MJXp-Span-178">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-179" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-180"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-183"><span class="MJXp-mo" id="MJXp-Span-184">(</span><span class="MJXp-mn" id="MJXp-Span-185">2</span><span class="MJXp-mo" id="MJXp-Span-186">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">i</span></span></span></span></span></span></span></span><script type="math/tex" id="MathJax-Element-15"> x_i ^ {(0)}, x_i ^ {(1)}, x_i ^ {(2)} </script>  - low 3 bits of the number <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-187"><span class="MJXp-msubsup" id="MJXp-Span-188"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-190" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-16"> x_i </script>  .  Leading to a common denominator, we transform this expression into a more convenient form: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-191"><span class="MJXp-msubsup" id="MJXp-Span-192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-194" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-195" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-196">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">c</span><span class="MJXp-mrow" id="MJXp-Span-201"><span class="MJXp-msubsup" id="MJXp-Span-202"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-204" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mn" id="MJXp-Span-205">8</span><span class="MJXp-mtext" id="MJXp-Span-206">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">g</span><span class="MJXp-mo" id="MJXp-Span-211" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-212">1</span><span class="MJXp-mo" id="MJXp-Span-213" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-214">2</span><span class="MJXp-msubsup" id="MJXp-Span-215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-218"><span class="MJXp-mo" id="MJXp-Span-219">(</span><span class="MJXp-mn" id="MJXp-Span-220">0</span><span class="MJXp-mo" id="MJXp-Span-221">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-222" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-223">4</span><span class="MJXp-msubsup" id="MJXp-Span-224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-227"><span class="MJXp-mo" id="MJXp-Span-228">(</span><span class="MJXp-mn" id="MJXp-Span-229">1</span><span class="MJXp-mo" id="MJXp-Span-230">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-231" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-232">8</span><span class="MJXp-msubsup" id="MJXp-Span-233"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-236"><span class="MJXp-mo" id="MJXp-Span-237">(</span><span class="MJXp-mn" id="MJXp-Span-238">2</span><span class="MJXp-mo" id="MJXp-Span-239">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">i</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-240">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">g</span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-246" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span></span><script type="math/tex;mode=display" id="MathJax-Element-17"> d_i = \ frac {f_i} 8 \ Bigg (1 + 2x_i ^ {(0)} + 4x_i ^ {(1)} + 8x_i ^ {(2)} \ Bigg) = </script></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-247"><span class="MJXp-mo" id="MJXp-Span-248" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-249">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">c</span><span class="MJXp-mrow" id="MJXp-Span-254"><span class="MJXp-msubsup" id="MJXp-Span-255"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-257" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mn" id="MJXp-Span-258">8</span><span class="MJXp-mtext" id="MJXp-Span-259">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">g</span><span class="MJXp-mo" id="MJXp-Span-264" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-265">1</span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-267">2</span><span class="MJXp-mtext" id="MJXp-Span-268">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">g</span><span class="MJXp-mo" id="MJXp-Span-272" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-276"><span class="MJXp-mo" id="MJXp-Span-277">(</span><span class="MJXp-mn" id="MJXp-Span-278">0</span><span class="MJXp-mo" id="MJXp-Span-279">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-281">2</span><span class="MJXp-msubsup" id="MJXp-Span-282"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-285"><span class="MJXp-mo" id="MJXp-Span-286">(</span><span class="MJXp-mn" id="MJXp-Span-287">1</span><span class="MJXp-mo" id="MJXp-Span-288">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-289" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-290">4</span><span class="MJXp-msubsup" id="MJXp-Span-291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292" style="margin-right: 0.05em;">x</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-294"><span class="MJXp-mo" id="MJXp-Span-295">(</span><span class="MJXp-mn" id="MJXp-Span-296">2</span><span class="MJXp-mo" id="MJXp-Span-297">)</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-293">i</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-298">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">g</span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mtext" id="MJXp-Span-303">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">B</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-305">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-306">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307">g</span><span class="MJXp-mo" id="MJXp-Span-308" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-309" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-310">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-314">c</span><span class="MJXp-mrow" id="MJXp-Span-315"><span class="MJXp-msubsup" id="MJXp-Span-316"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-317" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-318" style="vertical-align: -0.4em;">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-319"><span class="MJXp-mn" id="MJXp-Span-320">8</span></span><span class="MJXp-mo" id="MJXp-Span-321" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-322">2</span><span class="MJXp-msubsup" id="MJXp-Span-323"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-325" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-327">1</span><span class="MJXp-mo" id="MJXp-Span-328" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-329" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex;mode=display" id="MathJax-Element-18"> = \ frac {f_i} 8 \ Bigg (1 + 2 \ Big (x_i ^ {(0)} + 2x_i ^ {(1)} + 4x_i ^ {(2)} \ Big) \ Bigg) = \ frac { f_i} {8} (2x_i + 1). </script></p>  The last conversion is based on the fact that, in a certain sense, the lower three bits (0 or 1) of the number <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-330"><span class="MJXp-msubsup" id="MJXp-Span-331"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-332" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-333" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-19"> x_i </script>  with the presented coefficients, there is something else like the record of the absolute value of this number, and the most significant bit of the number <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-334"><span class="MJXp-msubsup" id="MJXp-Span-335"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-337" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-20"> x_i </script>  will match the sign of the whole expression.  Further according to the formula <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-338"><span class="MJXp-msubsup" id="MJXp-Span-339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-341" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-342">i</span><span class="MJXp-mo" id="MJXp-Span-343">+</span><span class="MJXp-mn" id="MJXp-Span-344">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-345" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-346"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-348" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-349" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-352" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex;mode=display" id="MathJax-Element-21"> y_ {i + 1} = y_i + d_i </script></p>  the new value of the sample is calculated based on the old one.  In addition, a new variable value is calculated. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354">s</span></span></span><script type="math/tex" id="MathJax-Element-22"> s </script>  : <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-355"><span class="MJXp-msubsup" id="MJXp-Span-356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-358" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359">i</span><span class="MJXp-mo" id="MJXp-Span-360">+</span><span class="MJXp-mn" id="MJXp-Span-361">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-362" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-363"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-365" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-366" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-367">t</span><span class="MJXp-mo" id="MJXp-Span-368" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-369"><span class="MJXp-mo" id="MJXp-Span-370" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-371"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-372" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-373" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-374"><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-376" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex;mode=display" id="MathJax-Element-23"> s_ {i + 1} = s_i + t (| x_i |). </script></p>  The module in the formula indicates that the variable <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-378"><span class="MJXp-msubsup" id="MJXp-Span-379"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-381" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-24"> x_i </script>  gets into function <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-382"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383">t</span></span></span><script type="math/tex" id="MathJax-Element-25"> t </script>  without taking into account the high sign bit, which is reflected in the code.  And the function <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-384"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-385">t</span></span></span><script type="math/tex" id="MathJax-Element-26"> t </script>  - is the value of the ima_index_table array with the index corresponding to the argument. <br><br>  In the description of the formulas, I neglected the operations of restriction above and below.  So, the iteration scheme looks like this: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-386"><span class="MJXp-msubsup" id="MJXp-Span-387"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-388" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-389" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-390" style="margin-left: 0em; margin-right: 0.222em;">;</span><span class="MJXp-mtext" id="MJXp-Span-391">&nbsp;</span><span class="MJXp-msubsup" id="MJXp-Span-392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393" style="margin-right: 0.05em;">s</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-394" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0em; margin-right: 0.222em;">;</span><span class="MJXp-mtext" id="MJXp-Span-396">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-397">&nbsp;</span><span class="MJXp-msubsup" id="MJXp-Span-398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-400" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-401" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-402"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-403" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-404" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-405" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-406"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-408" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-409" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-410">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-414">s</span><span class="MJXp-mspace" id="MJXp-Span-415" style="width: 0.278em; height: 0em;"></span></span></span><script type="math/tex;mode=display" id="MathJax-Element-27"> y_0; \ s_0; \ \ x_0, x_1, x_2, \ dots \; </script></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-416"><span class="MJXp-msubsup" id="MJXp-Span-417"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-418" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-419" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-420" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-421">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-423">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425">c</span><span class="MJXp-mrow" id="MJXp-Span-426"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-427">f</span><span class="MJXp-mo" id="MJXp-Span-428" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-429"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-431" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-432" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mrow" id="MJXp-Span-433"><span class="MJXp-mn" id="MJXp-Span-434">8</span></span><span class="MJXp-mtext" id="MJXp-Span-435">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-437">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">g</span><span class="MJXp-mo" id="MJXp-Span-439" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-440">2</span><span class="MJXp-msubsup" id="MJXp-Span-441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-443" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-444" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-445">1</span><span class="MJXp-mtext" id="MJXp-Span-446">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-449">g</span><span class="MJXp-mo" id="MJXp-Span-450" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mspace" id="MJXp-Span-451" style="width: 0.278em; height: 0em;"></span></span></span><script type="math/tex;mode=display" id="MathJax-Element-28"> d_i = \ frac {f (s_i)} {8} \ big (2x_i + 1 \ big) \; </script></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-452"><span class="MJXp-msubsup" id="MJXp-Span-453"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-454" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-455" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">i</span><span class="MJXp-mo" id="MJXp-Span-457">+</span><span class="MJXp-mn" id="MJXp-Span-458">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-459" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-460"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-461" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-462" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-463" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-464"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-465" style="margin-right: 0.05em;">d</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-466" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mspace" id="MJXp-Span-467" style="width: 0.278em; height: 0em;"></span></span></span><script type="math/tex;mode=display" id="MathJax-Element-29"> y_ {i + 1} = y_i + d_i \; </script></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-468"><span class="MJXp-msubsup" id="MJXp-Span-469"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-470" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-471" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">i</span><span class="MJXp-mo" id="MJXp-Span-473">+</span><span class="MJXp-mn" id="MJXp-Span-474">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-475" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-478" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-479" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480">t</span><span class="MJXp-mo" id="MJXp-Span-481" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-482"><span class="MJXp-mo" id="MJXp-Span-483" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-484"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-485" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-486" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-487"><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-489" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mspace" id="MJXp-Span-490" style="width: 0.278em; height: 0em;"></span></span></span><script type="math/tex;mode=display" id="MathJax-Element-30"> s_ {i + 1} = s_i + t (| x_i |) \; </script></p><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-491"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-492">i</span><span class="MJXp-mo" id="MJXp-Span-493" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-494">0</span><span class="MJXp-mo" id="MJXp-Span-495" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-496">1</span><span class="MJXp-mo" id="MJXp-Span-497" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-498">2</span><span class="MJXp-mo" id="MJXp-Span-499" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-500">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-501">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-503">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-504">s</span><span class="MJXp-mo" id="MJXp-Span-505" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><script type="math/tex;mode=display" id="MathJax-Element-31"> i = 0, 1, 2, \ dots. </script></p><br><br>  Deeply deep into the ADPCM coding / decoding theory I didn‚Äôt go into it.  However, the table values ‚Äã‚Äãof the ima_step_table array (out of 89 pieces), judging by their reflection on the graph (see the figure below), describe the probability distribution of samples relative to the zero line.  In practice, it is usually this way: the closer the sample is to the zero line, the more frequent it is.  Therefore, ADPCM is based on a probabilistic model, and far from any original set of 16-bit PCM samples can be correctly converted to 4-bit ADPCM samples.  In general, ADPCM is a PCM with a variable quantization step.  Apparently, this chart reflects this very variable step.  He was chosen correctly, based on the law of distribution of audio data in practice. <br><br><img src="https://habrastorage.org/webt/df/i7/kr/dfi7krwxns4oahfnvruwbvtara4.png"><br></div></div><br>  We now turn to the description of the structure of the avi container.  In fact, it is a complex hierarchical structure. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ps/vr/8j/psvr8jkjj2wuttkcgklqbjhvzgm.jpeg"></div><br>  But, simplifying the task for a particular case, I presented the avi structure in a linear form.  The result was this: the avi file consists of a large header, zero byte skips (JUNK), audio and video streams (with their headers and content sizes), and a list of indexes.  The latter serves, in particular, to scroll through the video in the player.  Without this list scrolling will not work (checked).  It is only a table of contents, which lists the key names of the flow blocks (matching the names in the block headers), the corresponding size of the content and the values ‚Äã‚Äãof the offsets (addresses) relative to the beginning of the flow area. <br><br>  Now you can go to the development of the program.  The specific description of the problem is as follows. <br><br>  <i>At the root of section X: there is a ‚ÄúDVR‚Äù directory.</i>  <i>This directory contains many non-empty subdirectories (and only subdirectories) with names that correspond to certain dates.</i>  <i>In each of these subdirectories there are many files with different names and the extension "264".</i>  <i>Required in section Y: create a directory "DVR", and in it the same subdirectories as in section X :.</i>  <i>Each of such subdirectories should be filled with files with the same corresponding names, but with the extensions not ‚Äú264‚Äù, but ‚Äúavi‚Äù.</i>  <i>These avi-files need to be obtained from the original 264-files by processing them, which, one way or another, repeats the algorithm of an existing program.</i>  <i>Processing consists of direct repacking of video streams, repacking with decoding of audio streams, formatting the avi file.</i>  <i>The program should be launched from the command line as follows: "264toavi.exe X: Y:", where "264toavi.exe" is the name of the program, "X:" is the source section, "Y:" is the destination section.</i> <br><br>  In fact, to simplify the task, you could write a program that would only deal with the conversion (repacking) of a single file, making the day two arguments: the name of the input file and the name of the output file.  And then, in order to implement group repacking, you can write a command batch file (bat) using other tools, for example, Excel.  But I implemented a full-fledged program, very cumbersome.  It is unlikely that the source code would have earned the attention of readers.  I will describe the structure of the program code. <br><br>  The program is written in C language in the Dev-C ++ development environment with WinAPI elements.  The program has three large auxiliary functions: the function of forming the original avi header, the function of decoding the audio sample and the function of scanning the source file "264" by words.  Words I call a portion of 4 bytes.  It was noted that the size of the headers and contents of all streams is a multiple of four bytes.  The scan function can return five values: 0 - if it is the usual 4 bytes of the video stream for repacking, 1 - if it is the header of the video stream block of the reference frame, 2 - if it is the header of the video stream block of the compressed frame, 4 - if it is ‚ÄúSpoiled‚Äù block to be ignored when repacking.  Very, very rare, but this is met.  The corrupted block (as I called it) is a header of the form "\ 0 \ 0 \ 0 \ 0H264", where "\ 0" is a zero byte.  Blocks of this type of regular repacker ignores.  Of course, the contents of such a block may turn out to be quite working, but I ignore such blocks in order to make my program as close as possible to the standard one. <br><br>  In the main function, in addition to organizing directories, the input file is read by the scan function.  Depending on what this function returns, further actions occur.  If these are the headers of the video streams, then the corresponding headers are formed into the output avi file.  There they are called differently: ‚Äú00db‚Äù is the header of the video stream block of the reference frame, and ‚Äú00dc‚Äù is for the compressed frame.  After the repacking operation (rewriting of words) before the new newly encountered header, the size of the repacked content is calculated and this value is written into the field that immediately follows the header of the stream just processed.  If you encounter an audio stream header while scanning, the header name ‚Äú03wb‚Äù is formed into the output avi file and the audio stream from ADPCM to PCM is decoded simultaneously in the loop while the decoded content is written to the avi file.  Simultaneously with all of the above, the brief information (table of contents) is recorded in the temporary index file ‚Äúindex‚Äù.  The scanning function could not be done, but all written in the main function.  But then the program would have been very cumbersome and almost difficult to read. <br><br>  At the end of the whole operation, when the input file ‚Äú264‚Äù ended, before moving to the new file, the program correctly completes all the operations.  First, certain fields in the avi file header are adjusted, the values ‚Äã‚Äãof which depend on the size and number of streams read, and then the contents of the temporary ‚Äúindex‚Äù file is added to the almost finished avi file, which is then deleted.  After these operations, the output avi file is ready to play. <br><br>  While the program is running, a text visualization takes place on the command line, which displays the current directory, file, as well as the block number of the video stream that falls on the reference frame and the corresponding video time in minutes and seconds.  And if the input file has not an arbitrary name, but the source one (containing the channel number, the date and time of the start of the recording), then a more interactive visualization takes place, based on date-time arithmetic. <br><br>  When testing and debugging the program, the main problems I had when working with audio decoding.  Simple arithmetic worked incorrectly if I, when declaring variables in the decoding function, illiterately set types.  Because of this, some blocks of audio streams were broken, and there were clicks on the ear.  Some not completely clear fields of the header of the source file 264, which I could not guess, turned out to be insensitive to the result.  Unlike the standard program, my program does not throw out the last incomplete flow block from the repack operation.  Although his absence will not play any practical role.  Another regular program, unlike mine, leaves behind a "garbage" in a small amount (this is the contents of the last stream) at the very end of the avi file after the indices.  With all this, the video is played almost equally.  A repacking program performs for the same period of time as the regular program. <br><br>  In conclusion, I will give illustrations showing the structure of the organization of streams in a .264 file (in the WinHex hexadecimal editor) with an example of one of the files and a view of the RiffPad program with the avi file repacked open in it.  This program has greatly simplified the process of studying the structure of an avi file.  It clearly demonstrates the hierarchical structure, shows the byte content of each member of the structure, and even cleverly interprets the contents of the headers as a list of parameters.  The picture, in particular, demonstrates the fact that the contents of the video stream correspond with no changes. <br><br><img src="https://habrastorage.org/webt/fx/vf/4r/fxvf4rhqkxhhbkyy84gqiwuajoq.png"><br><br><img src="https://habrastorage.org/webt/sg/oz/cz/sgozcztohfzjyxep3uw31c6zesi.png"></div><p>Source: <a href="https://habr.com/ru/post/422163/">https://habr.com/ru/post/422163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422151/index.html">Online checks on the federal network through RabbitMQ, 1C and black magic</a></li>
<li><a href="../422153/index.html">NASA announces a competition to convert CO‚ÇÇ into nutrients</a></li>
<li><a href="../422155/index.html">The secret phrase of the auditor</a></li>
<li><a href="../422157/index.html">CPE - payment model for the involved user in mobile retargeting</a></li>
<li><a href="../422161/index.html">We lower the level of connectivity using DI to improve code testability, an example implementation</a></li>
<li><a href="../422165/index.html">Who should Microsoft customers switch to the Dynamics 365 version?</a></li>
<li><a href="../422167/index.html">Digital events in Moscow from September 3 to 9</a></li>
<li><a href="../422169/index.html">What did the Ada Lovelace program actually do?</a></li>
<li><a href="../422171/index.html">As I did the line-interactive UPS. Part 3</a></li>
<li><a href="../422173/index.html">Machine learning is increasingly used in particle physics.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>