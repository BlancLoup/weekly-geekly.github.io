<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multi-shop. Article for beginner web programmers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many interesting technical solutions arise as a result of solving interesting problems. And who invent or create such problems for engineers? The answ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multi-shop. Article for beginner web programmers</h1><div class="post__text post__text-html js-mediator-article">  Many interesting technical solutions arise as a result of solving interesting problems.  And who invent or create such problems for engineers?  The answer is of course the users.  This article is just about one such interesting problem and its solution. <br><br>  So.  In general, the problem, according to the user, looks like the need to create one main online store and several Additional.  The main store has a full database of goods.  The goods of Additional stores are formed by requesting a list of goods from the Main store.  The main store, having received its identifier when requesting from the Additional Store, returns the desired item. <br><br>  Now consider the problem through the eyes of an engineer, given that the base of goods of the Main and Additional Store are on the same server.  We do not know the number of Additional Stores, but it is obvious that the load on the Main Store will be large.  A large number of different goods does not allow us to accurately form the structure of the tables with the goods.  Product properties vary greatly depending on its category.  Summarizing the data, the task for the designer of the Main Store is: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Design the Main Store database so that the product sampling rate is very fast, and the product properties, its attributes, are dynamic.</i> <i><br></i> <a name="habracut"></a><br><h4>  Divide and rule! </h4><br><br>  From "given", there are two entities.  This is the Main Store and Optional.  Let's call them so <br><br>  Primary - PrimaryShop <br>  Additional - SecondaryShop <br><br>  It is also obvious that from the inside of the Additional Store, it will be necessary to refer both to the internal data and to the external data, to the data of the Main Store.  For convenience, we will write the following two functions: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* *    ,            . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@shopId</span></span></span><span class="hljs-comment"> -   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> false | object PrimaryGoods */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrimaryShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($shop = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $primaryshop, $shopId; <span class="hljs-comment"><span class="hljs-comment">/* *  ,          *  ,    ,   *   shopId     *  ,      ,    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($shop) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($shopId)) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"  shopId  "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $shopId = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($shop) ? $shop : $shopId; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Database::Setup(Config::Get(<span class="hljs-string"><span class="hljs-string">"primaryDbHost"</span></span>), Config::Get(<span class="hljs-string"><span class="hljs-string">"primaryDbName"</span></span>), Config::Get(<span class="hljs-string"><span class="hljs-string">"primaryDbUser"</span></span>), Config::Get(<span class="hljs-string"><span class="hljs-string">"primaryDbPass"</span></span>))-&gt;Connect()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($primaryshop) ? $primaryshop : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PrimaryGoods($shopId); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"      "</span></span>); } } <span class="hljs-comment"><span class="hljs-comment">/* *    ,            * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> false | object SecondaryGoods */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SecondaryShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Database::Setup(Config::Get(<span class="hljs-string"><span class="hljs-string">"secondaryDbHost"</span></span>), Config::Get(<span class="hljs-string"><span class="hljs-string">"secondaryDbName"</span></span>), Config::Get(<span class="hljs-string"><span class="hljs-string">"secondaryDbUser"</span></span>), Config::Get(<span class="hljs-string"><span class="hljs-string">"secondaryDbPass"</span></span>))-&gt;Connect()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SecondaryGoods(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">"      "</span></span>); } }</code> </pre> <br><br>  Accordingly, SecondaryGoods and PrimaryGoods classes that implement the methods of working with the goods of the respective stores. <br><br>  And it's all?  Of course not.  These are the wrapper functions.  They do not bring us to the ultimate goal.  Let's try to speculate further.  As a rule, the online store shows the product to the user in two modes.  List view mode and product card view mode.  The frequency of receiving data for the list view mode is obviously very high, much higher than the frequency of receiving data for viewing the item card.  It follows a simple conclusion.  If there is a special table in the Main database, a table with prepared data for displaying them in the product list view mode, the speed of data acquisition will be greater than generating this data by combining several tables into one.  The data for viewing the goods in the card mode are formed in a standard way by combining several tables into one. <br><br>  An example of a query to the main database, by combining several tables into one.  Such a query will a priori be slower than a simple query, without connections. <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--    SELECT * FROM `data_goods` AS `a` LEFT JOIN `data_goods_price` AS `b` ON `b`.`id` = `a`.`priceId` LEFT JOIN `data_goods_images` AS `c` ON `c`.`id` = `a`.`imagesId` LEFT JOIN `data_goods_attr` AS `d` ON `d`.`id` = `a`.`attrId` --  ,   SELECT * FROM `data_goods_short`</span></span></code> </pre><br><br>  To summarize  Appeal to a specific store is carried out through the functions of the wrapper.  To build a page with a list of goods we create a special table specially designed for this purpose. <br><br><h4>  Multi-property </h4><br><br>  How to make product A have the following properties <br><br><ul><li>  Small picture </li><li>  Big picture </li><li>  Dimensions </li><li>  Material </li><li>  Wholesale price </li><li>  Retail price </li></ul><br>  Product B has the following properties. <br><ul><li>  Average picture </li><li>  Big picture </li><li>  Retail price </li><li>  Retail price, special </li></ul><br><br>  There is no possibility in advance to lay all possible properties of the product.  Well, in fact, neither do the same table with empty columns: Col1, Col2, ... ColN. <br><br>  The first thing that comes to mind is to make an additional table reference book.  This table will store a set of possible attributes of the product, depending on the product group.  The process of obtaining a product card is obtained in two stages.  Step one: we get a list of possible attributes.  Stage two: in accordance with this list, we turn to the necessary tables and collect information.  You understand that the process is not fast.  Is he good?  The answer is no. <br><br>  If you look at the contents of the product card in more detail, you can group the properties of the product in two tables.  Let table one, data_goods_images contain a list of all product images, and data_goods_attr table contain additional attributes. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_full`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`categoryId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`shopId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`article`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`intro`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`description`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`categoryId`</span></span> (<span class="hljs-string"><span class="hljs-string">`categoryId`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> (<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`shopId`</span></span> (<span class="hljs-string"><span class="hljs-string">`shopId`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">501</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_images`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`shopId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span> enum(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> (<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`shopId`</span></span> (<span class="hljs-string"><span class="hljs-string">`shopId`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_attr`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span> enum(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`value`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">150</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> (<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8;</code> </pre><br><br>  Notice the type field in the data_goods_images table and data_goods_attr.  This is an ENUM field.  This type can take a value from the list.  Now, having made a request and connecting these three tables in it, we will get all the characteristics of the product. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_full`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">`a`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_images`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">`b`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-string"><span class="hljs-string">`b`</span></span>.<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> = <span class="hljs-string"><span class="hljs-string">`a`</span></span>.<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_attr`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-string"><span class="hljs-string">`c`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-string"><span class="hljs-string">`c`</span></span>.<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> = <span class="hljs-string"><span class="hljs-string">`a`</span></span>.<span class="hljs-string"><span class="hljs-string">`goodsId`</span></span></code> </pre><br><br>  We can, also, obtain any specific properties, separately, without producing connections.  For example, I want to receive only Small pictures, product B. Product identifier, let it be equal to 100 <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_images`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-string"><span class="hljs-string">`type`</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-string"><span class="hljs-string">`goodsId`</span></span> = <span class="hljs-string"><span class="hljs-string">'100'</span></span></code> </pre><br><br>  Now let's go back to the question that was voiced at the beginning of the chapter.  How to make sure that product A has some properties, and product B has others.  In our case, you need to add additional types of product properties to the data_goods_attr table, such as: retail price, wholesale price and retail price, special price.  You can do this with the following command: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`data_goods_attr`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHANGE</span></span> <span class="hljs-string"><span class="hljs-string">`type`</span></span> <span class="hljs-string"><span class="hljs-string">`type`</span></span> ENUM(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">' , '</span></span>)</code> </pre><br><br>  Now add to the database product A and product B (goodsId 100 and goodsId 101) <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--     INSERT INTO `data_goods_full` (`id`, `goodsId`, `categoryId`, `shopId`, `article`, `intro`, `name`, `description`) VALUES (null, '100', '1', '1', '-100', ' ', ' ', ''); --   INSERT INTO `data_goods_images` (`id`, `goodsId`, `shopId`, `type`, `value`) VALUES (null, '100', '1', '1', '', 'small_a.png'), (null, '100', '1', '1', '', 'big_a.png'); --   INSERT INTO `data_goods_attr` (`id`, `goodsId`, `shopId`, `type`, `value`) VALUES (null, '100', '1', '1', '', 'XL'), (null, '100', '1', '1', '', ''), (null, '100', '1', '1', ' ', '100 .'), (null, '100', '1', '1', ' ', '125 .'); --     ,     --     INSERT INTO `data_goods_full` (`id`, `goodsId`, `categoryId`, `shopId`, `article`, `intro`, `name`, `description`) VALUES (null, '101', '1', '1', '-101', ' ', ' ', ''); --   INSERT INTO `data_goods_images` (`id`, `goodsId`, `shopId`, `type`, `value`) VALUES (null, '101', '1', '1', '', 'midle_b.png'), (null, '101', '1', '1', '', 'big_b.png'); --   INSERT INTO `data_goods_attr` (`id`, `goodsId`, `shopId`, `type`, `value`) VALUES (null, '101', '1', '1', ' ', '125 .'), (null, '101', '1', '1', ' , ', '120 .');</span></span></code> </pre><br><br>  Well, now, let's read, all that we brought to the database.  After small <br>  manipulating the result of the query, we get the following: <br><pre> <code class="sql hljs">Array ( [property] =&gt; stdClass Object ( [id] =&gt; 1 [categoryId] =&gt; 1 [article] =&gt; -100 [intro] =&gt;  [name] =&gt;   [text] =&gt; ) [images] =&gt; Array ( [0] =&gt; stdClass Object ( [imageType] =&gt;  [imageValue] =&gt; small_a.png ) [1] =&gt; stdClass Object ( [imageType] =&gt;  [imageValue] =&gt; big_a.png ) ) [attributes] =&gt; Array ( [0] =&gt; stdClass Object ( [attrType] =&gt;  [attrValue] =&gt; XL ) [1] =&gt; stdClass Object ( [attrType] =&gt;  [attrValue] =&gt;  ) [2] =&gt; stdClass Object ( [attrType] =&gt;   [attrValue] =&gt; 100 . ) [3] =&gt; stdClass Object ( [attrType] =&gt;   [attrValue] =&gt; 125 . ) ) ) Array ( [property] =&gt; stdClass Object ( [id] =&gt; 2 [categoryId] =&gt; 1 [article] =&gt; -101 [intro] =&gt;  [name] =&gt;   [text] =&gt; ) [images] =&gt; Array ( [0] =&gt; stdClass Object ( [imageType] =&gt;  [imageValue] =&gt; midle_b.png ) [1] =&gt; stdClass Object ( [imageType] =&gt;  [imageValue] =&gt; big_b.png ) ) [attributes] =&gt; Array ( [0] =&gt; stdClass Object ( [attrType] =&gt;   [attrValue] =&gt; 125 . ) [1] =&gt; stdClass Object ( [attrType] =&gt;  ,  [attrValue] =&gt; 120 . ) ) )</code> </pre> <br><br><h4>  Conclusion </h4><br><br>  In order to work with fields of enum type, delete and add properties, you need to be able to get a list of the values ‚Äã‚Äãof these fields.  You can get this list using the SQL DESCRIBE command.  Below, I will give an example of such a function: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/* *    ,    *  type   images */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImagesSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $query = <span class="hljs-string"><span class="hljs-string">"\n DESCRIBE `data_goods_images` `type`"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result = Database::Exec($query)-&gt;Read(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Type"</span></span>)) { $result = str_replace(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"enum"</span></span>, <span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">"'"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), $result); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result ? explode(<span class="hljs-string"><span class="hljs-string">","</span></span>, $result) : $result; } } <span class="hljs-comment"><span class="hljs-comment">/* *       . * , ..  .. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddImagesSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($type)) { $result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;GetImagesSet(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($result)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { $enum[] = <span class="hljs-string"><span class="hljs-string">"'"</span></span>.$item.<span class="hljs-string"><span class="hljs-string">"'"</span></span>; } $enum = implode(<span class="hljs-string"><span class="hljs-string">","</span></span>, $enum).<span class="hljs-string"><span class="hljs-string">","</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $enum = <span class="hljs-string"><span class="hljs-string">""</span></span>; } $enum = $enum.str_replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, $type); $query = <span class="hljs-string"><span class="hljs-string">"\n ALTER TABLE `d ata_goods_images` CHANGE `type` `type` ENUM("</span></span>.$enum.<span class="hljs-string"><span class="hljs-string">")"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Database::Exec($query)-&gt;Read(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/* *    . * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@example</span></span></span><span class="hljs-comment">: '', '', '' DelImagesSet('') =&gt; '', '' * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> true | flase */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DelImagesSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($type)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GetImagesSet() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($type != $value) { $enum[] = <span class="hljs-string"><span class="hljs-string">"'"</span></span>.$value.<span class="hljs-string"><span class="hljs-string">"'"</span></span>; } } $query = <span class="hljs-string"><span class="hljs-string">"\n ALTER TABLE `data_goods_images` CHANGE `type` `type` ENUM("</span></span>.implode(<span class="hljs-string"><span class="hljs-string">","</span></span>, $enum).<span class="hljs-string"><span class="hljs-string">")"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Database::Exec($query)-&gt;Read(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre><br><br>  You can also download all in one <a href="">file</a> </div><p>Source: <a href="https://habr.com/ru/post/137503/">https://habr.com/ru/post/137503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137497/index.html">Python vs Ruby</a></li>
<li><a href="../137498/index.html">Operation "intermediary" or the delivery of goods from the United States - easier, safer, cheaper</a></li>
<li><a href="../137499/index.html">Ukraine continues attacks on government sites</a></li>
<li><a href="../137500/index.html">Online document converter and not only</a></li>
<li><a href="../137502/index.html">"Virus" attack on the Android Market was a mistake Symantec</a></li>
<li><a href="../137504/index.html">Stop ACTA in Europe February 11</a></li>
<li><a href="../137506/index.html">Video review of Android applications and games - kedDroid</a></li>
<li><a href="../137507/index.html">Free Dropbox account increase by 5 GB</a></li>
<li><a href="../137508/index.html">Hacking VeriSign in 2010</a></li>
<li><a href="../137511/index.html">Write down. Oh please!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>