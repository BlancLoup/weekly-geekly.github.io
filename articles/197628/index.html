<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP + Java, or In-memory cluster now for PHP developers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 

 PHP + Java. Picture taken from here. 

 In this comment to the article entitled ‚ÄúWrite the code every day,‚Äù I said that I would soon show my ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP + Java, or In-memory cluster now for PHP developers</h1><div class="post__text post__text-html js-mediator-article"><h4>  Intro </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/2b8/ab2/97f/2b8ab297f6e4e4a323007ee5d2612c20.jpg" alt="image"><br>  PHP + Java.  Picture taken <a href="http://obviousmag.org/en/archives/2011/12/the_art_that_lies_at_the_froth_of_your_cappuccino.html">from here.</a> <br><br>  In <a href="http://habrahabr.ru/post/219209/">this</a> comment to the article entitled ‚ÄúWrite the code every day,‚Äù I said that I would soon show my project, for which I allocated 1 hour daily (except weekends).  Since recently my work is related to writing distributed Java applications that use in-memory data grid (IMDG) as data storage, my project is associated with this. <br><br>  You can read more about IMDG in my previous articles ( <a href="http://habrahabr.ru/post/126580/">1</a> , <a href="http://habrahabr.ru/post/126973/">2</a> ).  But briefly, this is a cluster distributed storage of objects by keys, which keeps all the data in memory, due to which high data access speed is achieved.  Allows not only to store, but also to process data without removing it from the cluster. <br>  And if each IMDG has its own data processing interface, the data access interface is usually identical to a hash table. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What is this article about </h4><br>  Most IMDGs are written in Java and support APIs for Java, C ++, C #, while the API for web programming languages ‚Äã‚Äã(Python, Ruby, PHP) is not supported, and the protocol for writing clients is very limited.  It is this fact that I consider the main brake on the penetration of IMDG into the masses - the lack of support for the most popular languages. <br><br>  Since IMDG manufacturers do not yet provide support for web languages, web programmers do not have the ability to scale applications as easily as Java server developers have.  Therefore, I decided to do something similar on my own and put it in open source, using IMDG JBoss Infinispan as an open source engine (JBoss, owned by Red Hat, is quite well known among java developers).  My project is called <b>Sproot Grid</b> , while it is available only for PHP, but if the community is interested, I will do the integration with Ruby and Python. <br><br>  In this article I will once again tell you about the in-memory data grid and how to configure, run and use the Sproot Grid. <br><a name="habracut"></a><br><h4>  Why do you need IMDG? </h4><br>  The biggest bottleneck of many high-load projects is the data warehouse, in particular, the relational database.  To combat the shortcomings of traditional databases, 2 approaches are mainly used: <br><br>  1) Caching <br>  <b>advantages</b> : <br><ul><li>  high speed data access </li></ul><br>  <b>cons</b> : <br><ul><li>  real cluster solutions are very rare, basically the user himself has to deal with the distribution of data among servers, and when accessing data, determine the server on which this data rests.  The uniformity of fullness of all cluster nodes in such a system is difficult to achieve. </li><li>  requires a compromise between the relevance of data and access speed, because  the data in the cache may become outdated, and deleting old data from the cache and then caching new ones are additional delays and system load </li><li>  Typically, data is not cached as domain objects that are used in the application, but as BLOBs or strings, i.e.  when using data obtained from the cache, you must first construct the necessary objects </li></ul><br>  2) NoSQL solutions <br>  <b>advantages</b> : <br><ul><li>  good horizontal scalability </li></ul><br>  <b>cons</b> : <br><ul><li>  not so high speed of receiving results in case of disk usage </li><li>  it is almost impossible to ensure the operation of intra-corporate software, which is focused on working with a specific relational database </li></ul><br>  IMDG combines the advantages of both approaches and at the same time has several advantages over the above-mentioned solutions: <br><ol><li>  good horizontal scalability </li><li>  high access speed </li><li>  real clustering (you can put data on any node, you can also request data on any node of the cluster), automatic balancing of data between nodes </li><li>  the cluster knows about all the fields of the object, therefore you can search for objects not only by keys, but also by field values </li><li>  it is possible to create indexes by fields or by their combination </li><li>  when using the read-through and write-behind (or write-through) mechanisms, the data will be synchronized with the database, which will allow other applications (or other application modules) to continue to use the traditional database (MySQL or Mongo - it does not matter) </li><li>  When using the work scheme from the previous paragraph, the problem of updating the data in the cache disappears, since  they will always be there the same as in the database </li></ol><br>  Let's take a closer look at these 2 interesting mechanisms: read-through and write-behind (write-through) <br><br><h5>  read-through </h5><br>  <b>Read-through</b> is a mechanism that allows you to pull data from the database during a query. <br>  For example, you want to get an object from the cache by the key ' <i>key</i> ', and it turns out that there is no object with such a key in the cluster, then this object will be automatically read from the database (or any other persistence storage), then put into the cache, after which will be returned as a response to the request. <br>  If there is no such object in the database, null will be returned to the user. <br>  Naturally, the required sql query, as well as the mapping of the results of a query on an object, lies on the user's shoulders <br><br><h5>  write-behind (write-through) </h5><br>  To optimize the write speed, you can write not to the database, but directly to the cache.  It sounds strange at first, but in practice it relieves the database well and improves the speed of the application. <br>  It looks like this: <br><ol><li>  The user makes a call to <i>cache.put (key, value)</i> , the ' <i>value</i> ' object is stored in the cache by the key ' <i>key</i> ' </li><li>  In the cluster, an event handler for this event is triggered, a sql query is created for writing data to the database and its execution </li><li>  The control is returned to the user. </li></ol><br>  This interaction scheme is called <b>write-through</b> .  It allows you to synchronize updates from the database simultaneously with updates in the cluster.  As you can see, this approach does not speed up the process of writing data, but ensures consistency of data between the cache and the database.  Also with this type of record, the data gets into the cache, which means access to them for reading will still be higher than the query to the database. <br><br>  If simultaneous writing to the database is not a critical condition, then you can use the more popular <b>write-behind</b> mechanism, it allows you to organize a postponed recording to the database (any other stack).  Like that: <br><ol><li>  The user makes a call to <i>cache.put (key, value)</i> , the ' <i>value</i> ' object is cached by the key ' <i>key</i> ' </li><li>  The control is returned to the user. </li><li>  After some time (configurable by the user), a cache entry event handler is triggered </li><li>  The handler collects the entire pack of objects that have been modified since the previous handler‚Äôs triggering. </li><li>  The pack goes to the database to write </li></ol><br>  When using write-behind, the write operation is significantly accelerated, because the user does not wait for the update to reach the database, but simply puts the data into the cache, and all updates of the same object will be merged into one resulting update, while writing to the database in batches, which also has a positive effect on the loading of the database server, <br>  Thus, you can configure your IMDG so that every 3 seconds (either 2 minutes or 50 ms) all data updates are asynchronously sent to the database. <br><br><h4>  What does this have in Sproot Grid? </h4><br>  In the first version, I decided not to immediately implement everything that I mentioned above, since  it would take a lot of time, but I would like to quickly get feedback from users. <br>  So, what is available in Sproot Grid 1.0.0: <br><ol><li>  Horizontal scalability and fair clustering with balancing the amount of data between cluster nodes </li><li>  The ability to store both built-in PHP types and domain objects </li><li>  Ability to build an index on the field and search on this index </li></ol><br><br><h4>  Getting Started </h4><br>  First you need to download the distribution <a href="https://bitbucket.org/aolenev/sproot/downloads">from here</a> and unpack it. <br><br><h6>  Install the necessary software </h6><br>  Since JBoss Infinispan is a Java application, it was necessary to choose the way of interaction between Java and PHP.  Apache Thrift was chosen as such a link (the protocol was developed for serialization and transport between nodes in Cassandra), so in order for Sproot Grid to work on your system, you need to install the following: <br><ul><li>  Java </li><li>  Thrift - installation in production is not required, installation is needed only on the developer machine (see details in the <a href="https://habr.com/ru/post/197628/">Generate code section</a> ).  When deploying to production you only need to copy the .php files of the Thrift library and the java library in the .jar format </li><li>  PHP (if not already installed) </li></ul>  Installation instructions are located <a href="https://bitbucket.org/aolenev/sproot/wiki/Getting%2520Started">on the project wiki.</a> <br><br><h6>  Configuration </h6><br>  The configuration file must be in $ deploymentFolder / sproot-grid / config / definition.xml, where deploymentFolder is the path to the directory where you unpacked the distribution <br><div class="spoiler">  <b class="spoiler_title">Configuration example:</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sproot-config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataTypes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"some\package\User"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user-cache"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"integer"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">indexed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cars"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"array"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"some\package\Car"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"some\package\Car"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"car-cache"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"model"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"isNew"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"boolean"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string-cache"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"array"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"some\package\Car"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cache-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"list-car-cache"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dataTypes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sproot"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">multicast</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">host</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"224.3.7.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12345"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">caches</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user-cache"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">backup-count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">eviction</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">max-objects</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lifespan</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">max-idle-time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">wakeup-interval</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10000"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"car-cache"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">backup-count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string-cache"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">backup-count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"list-car-cache"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">backup-count</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">caches</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"service"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">thrift-port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"34567"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">minThreads</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maxThreads</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"storage-only"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cluster</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sproot-config</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  More information about the configuration can be read <a href="https://bitbucket.org/aolenev/sproot/wiki/Configuration">on the project wiki</a> <br><br>  As you can see from the configuration, for each type of objects we can prescribe the name of the cache (or we can not prescribe if we don‚Äôt want to store such objects in a separate cache).  Cache is a hash table distributed across a cluster; there can be any number of caches in a cluster.  Only objects of the same type can be stored in the same cache. <br>  All caches must be described in the &lt;caches /&gt; section. <br>  The configuration has a separate section for describing the cluster structure and a list of caches that will be stored in it. <br><br>  <b><i>&lt;datatypes /&gt;</i></b> - a description of the types that will be stored in your cluster.  You can use both built-in PHP types and custom ones.  As you can see, for each type of objects we can write the name of the cache (and we can not even write if we don‚Äôt want to store such objects in a separate cache) <br><br>  <b><i>&lt;cluster /&gt;</i></b> - description of the cluster structure and list of caches to be stored in it. <br>  <i>&lt;caches /&gt;</i> describes the caches.  The cache name must be unique; the <i>backup-count</i> parameter determines how many cluster nodes you can lose without losing data.  The more important the <i>backup count is</i> , the more reliable your cluster is, but the more memory it consumes.  You can also configure eviction (automatic removal of objects from the cache), more about this <a href="https://bitbucket.org/aolenev/sproot/wiki/Configuration">on the wiki page</a> <br>  <i>&lt;multicast /&gt;</i> defines the multicast address that will be used to build the cluster.  As it is known, only class D networks are available for multicast (224.0.0.0 - 239.255.255.255) <br>  <i>&lt;nodes /&gt;</i> describes the number and types of cluster nodes.  Now there are only 2 types of nodes: <i>storage-only</i> - is engaged only in storing data and executing internal requests <i>service</i> - not only stores data, but also processes external requests, therefore for nodes of this type, you must specify the port on which requests from PHP clients will be received. <br><a name="StubGenerating"></a><br><h6>  Code generation for integration with your application </h6><br>  To work efficiently, the cluster needs to generate code specific to your application (your domain model) and compile its Java part, since it works faster than accessing objects through reflection.  To generate and compile all the necessary code, you need: <br><pre> <code class="bash hljs"> 1) <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$deploymentFolder</span></span>/sproot-grid/scripts 2) build.sh(or build.cmd)</code> </pre>  where $ deploymentFolder is the directory into which you unpacked the distribution <br>  The code generation should be performed only in case of changing the description of the domain model, i.e.  if your model is stable, then you will have to perform this operation only once, then the generated php source files can be stored in the code repository, and the java part will be compiled into the library.  Those.  You do not need to generate anything 10 times before you appended your application, this is done only 1 time during the development phase. <br>  After the code generation is completed, copy the folder with .php files from $ deploymentFolder / sproot-grid / php / org to the root of your application. <br><br><h6>  Launch </h6><br><pre> <code class="bash hljs"> 1) <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$deploymentFolder</span></span>/sproot-grid/scripts 2) run.sh(run.cmd) nodeId memorySize</code> </pre>  where nodeId is the value of the section id attribute in the configuration file, <br>  memorySize - the amount of memory (in MB or GB) that you want to allocate to the node <br><br>  For example: <br><pre> <code class="bash hljs">run.sh 1 256m</code> </pre>  or <br><pre> <code class="bash hljs">run.cmd 2 2g</code> </pre><br><h6>  Use inside the application </h6><br>  In the code generation step, you got everything you need to integrate with your application.  The only thing left is to copy this code into your application, for this, copy everything from the $ deploymentFolder / sproot-grid / php folder to the root of your application. <br>  Everything!  Now you can use the cluster from your application. <br><div class="spoiler">  <b class="spoiler_title">Code example:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'org/sproot_grid/SprootClient.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'some/package/User.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">org</span></span>\<span class="hljs-title"><span class="hljs-title">sproot_grid</span></span>\<span class="hljs-title"><span class="hljs-title">SprootClient</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">some</span></span>\<span class="hljs-title"><span class="hljs-title">package</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; $client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SprootClient(<span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-number"><span class="hljs-number">12345</span></span>); <span class="hljs-comment"><span class="hljs-comment">//             'service' echo $client -&gt; cacheSize('user-cache'); $user = new User(); $user-&gt;setName('SomeUser'); $user-&gt;setId(1234); $client-&gt;put('user-cache', '1234', $user); echo $client -&gt; cacheSize('user-cache'); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br></div></div><br>  You can find the description of the API <a href="https://bitbucket.org/aolenev/sproot/wiki/Sproot%2520client%2520API">here</a> , but if in brief, the API is now like this: <br><ul><li>  get ($ cacheName, $ key) </li><li>  getAll ($ cacheName, array $ keys) </li><li>  cacheSize ($ cacheName) </li><li>  cacheKeySet ($ cacheName) </li><li>  containsKey ($ cacheName, $ key) </li><li>  search ($ cacheName, $ fieldName, $ searchWord) </li><li>  remove ($ cacheName, $ key) </li><li>  removeAll ($ cacheName, array $ keys) </li><li>  put ($ cacheName, $ key, $ domainObject) </li><li>  putAll ($ cacheName, array $ domainObjects) </li><li>  clearCache ($ cacheName) </li></ul><br><br><h4>  Conclusion </h4><br>  Sproot Grid is published under the MIT license. <br>  <a href="https://bitbucket.org/aolenev/sproot">Sources</a> <br>  <a href="https://bitbucket.org/aolenev/sproot/wiki/Home">Wiki</a> <br>  <a href="https://bitbucket.org/aolenev/sproot/downloads">Distributive</a> </div><p>Source: <a href="https://habr.com/ru/post/197628/">https://habr.com/ru/post/197628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197612/index.html">Another FullHD option by air</a></li>
<li><a href="../197614/index.html">Adaptive English grammar test - learn from personal recommendations with LinguaLeo</a></li>
<li><a href="../197622/index.html">Elektron Octatrack DPS-1 - first impressions</a></li>
<li><a href="../197624/index.html">Backdoor deobfuscation without a single alphanumeric character</a></li>
<li><a href="../197626/index.html">Watson supercomputer trained to diagnose patients and train medical students</a></li>
<li><a href="../197630/index.html">MonoDB vs PostgreSQL performance comparison. Part II: Index</a></li>
<li><a href="../197634/index.html">Habrahabr launches startups support program</a></li>
<li><a href="../197638/index.html">Visual specifications</a></li>
<li><a href="../197642/index.html">IT strategy. To be or not to be</a></li>
<li><a href="../197644/index.html">Amazon offers startups up to $ 15,000 for an easy start under the AWS Activate program.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>