<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram API daemon - we glue successive messages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Write a thought in one message 
 I am one of those people who write thoughts in instant messengers on the same sentence. This creates some inconvenien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram API daemon - we glue successive messages</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/i8/uj/_2/i8uj_2ajwftoci3sf6rg7hcjqf0.jpeg"></div><br><h4>  Write a thought in one message </h4><br>  I am one of those people who write thoughts in instant messengers on the same sentence.  This creates some inconvenience when reading this stream of thought, since successive messages quickly take up free space vertically.  This is especially noticeable in group chats - notifications are disabled and to view the discussion, you have to miss the chat if someone writes in this way. <br><br><h4>  Enough tolerating this! </h4><br>  I am not going to retrain myself - I don‚Äôt consider this a problem of the one who writes, it‚Äôs so convenient for him - to retrain millions of people is more difficult than teaching one program.  Messages must be glued together by the client so that it is <b>convenient for everyone</b> , at least optionally.  I didn‚Äôt wait for this from the Telegram team - so I solved the problem with a small client, the Python daemon, and decided to share the source code with the community. <br>  Details, source code and description under the cut. <br><a name="habracut"></a><br><h4>  How it works </h4><br>  One of the main advantages of Telegram is really <b>fast synchronization</b> between different clients.  The open API allows you to create your clients and many alternatives have already been written.  I see no point in writing a full-fledged client - synchronization allows you to create small services that extend the capabilities of all clients on all platforms at once.  Earlier, I told you how to <a href="https://habr.com/post/348234/">increase the download limit for bot files from 50MB to 1.5GB</a> , create channels and other features not available through the Bot API. <br><br>  On the 24/7 server, an authorized daemon runs that synchronizes with other clients ‚Äî it receives both incoming and outgoing messages that I send from other clients.  If the pause between two consecutive outgoing messages is less than 30s - the first message is edited through the API - the text of the second message is added to it, and the second message is deleted.  Due to fast synchronization, this happens almost instantly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  A small video in the work </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cmwreW_UsuE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  It would also be nice to disable the alert from the same person in the chat if the interval between his messages is small and the messages are not read, but this is not done through the API - so we will wait for it from Telegram developers. <br>  <b>UPD I</b> thought and realized that you can - just mute the chat for a while, if there is a stream of messages from one person, but this should already be done by the recipient. <br><h4>  Inline translator </h4><br>  At the same time I built in a translator - I also think that this should be in the client itself.  It is inconvenient to use inline bots for a number of reasons, but the main one is: <b>I want to get the translated text into the input line, and not send it to chat without editing.</b> <br>  As a rule, you need to remember some word / phrase, and not the whole sentence (often translated crookedly). <br><br>  The only way to synchronize entered text between clients without sending a message is drafts.  Unfortunately, a draft is created when you go from chat to chat list, but still this crutch is more convenient and faster to use the google translator application, copy paste. <br><br>  <b>At the end of the line, add the language code</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vm/oc/hh/vmochhr4i03taijbspms8fojt2g.png"></div><br><br>  <b>Swipe right go to the chat list</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pd/oh/q4/pdohq45uraa45f9rgsrn0jic_co.png"></div><br><br>  <b>Go back - we get the translated string</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/us/ny/nw/usnynwpkzat-gl0houxywwyw-la.png"></div><br><br>  The language of the translated string is determined automatically, google is used for translation. <br><br><div class="spoiler">  <b class="spoiler_title">Supported Languages</b> <div class="spoiler_text"><pre><code class="python hljs">supported_langs = {<span class="hljs-string"><span class="hljs-string">'Afrikaans'</span></span>: <span class="hljs-string"><span class="hljs-string">'af'</span></span>, <span class="hljs-string"><span class="hljs-string">'Irish'</span></span>: <span class="hljs-string"><span class="hljs-string">'ga'</span></span>, <span class="hljs-string"><span class="hljs-string">'Albanian'</span></span>: <span class="hljs-string"><span class="hljs-string">'sq'</span></span>, <span class="hljs-string"><span class="hljs-string">'Italian'</span></span>: <span class="hljs-string"><span class="hljs-string">'it'</span></span>, <span class="hljs-string"><span class="hljs-string">'Arabic'</span></span>: <span class="hljs-string"><span class="hljs-string">'ar'</span></span>, <span class="hljs-string"><span class="hljs-string">'Japanese'</span></span>: <span class="hljs-string"><span class="hljs-string">'ja'</span></span>, <span class="hljs-string"><span class="hljs-string">'Azerbaijani'</span></span>: <span class="hljs-string"><span class="hljs-string">'az'</span></span>, <span class="hljs-string"><span class="hljs-string">'Kannada'</span></span>: <span class="hljs-string"><span class="hljs-string">'kn'</span></span>, <span class="hljs-string"><span class="hljs-string">'Basque'</span></span>: <span class="hljs-string"><span class="hljs-string">'eu'</span></span>, <span class="hljs-string"><span class="hljs-string">'Korean'</span></span>: <span class="hljs-string"><span class="hljs-string">'ko'</span></span>, <span class="hljs-string"><span class="hljs-string">'Bengali'</span></span>: <span class="hljs-string"><span class="hljs-string">'bn'</span></span>, <span class="hljs-string"><span class="hljs-string">'Latin'</span></span>: <span class="hljs-string"><span class="hljs-string">'la'</span></span>, <span class="hljs-string"><span class="hljs-string">'Belarusian'</span></span>: <span class="hljs-string"><span class="hljs-string">'be'</span></span>, <span class="hljs-string"><span class="hljs-string">'Latvian'</span></span>: <span class="hljs-string"><span class="hljs-string">'lv'</span></span>, <span class="hljs-string"><span class="hljs-string">'Bulgarian'</span></span>: <span class="hljs-string"><span class="hljs-string">'bg'</span></span>, <span class="hljs-string"><span class="hljs-string">'Lithuanian'</span></span>: <span class="hljs-string"><span class="hljs-string">'lt'</span></span>, <span class="hljs-string"><span class="hljs-string">'Catalan'</span></span>: <span class="hljs-string"><span class="hljs-string">'ca'</span></span>, <span class="hljs-string"><span class="hljs-string">'Macedonian'</span></span>: <span class="hljs-string"><span class="hljs-string">'mk'</span></span>, <span class="hljs-string"><span class="hljs-string">'Chinese Simplified'</span></span>: <span class="hljs-string"><span class="hljs-string">'zh-CN'</span></span>, <span class="hljs-string"><span class="hljs-string">'Malay'</span></span>: <span class="hljs-string"><span class="hljs-string">'ms'</span></span>, <span class="hljs-string"><span class="hljs-string">'Chinese Traditional'</span></span>: <span class="hljs-string"><span class="hljs-string">'zh-TW'</span></span>, <span class="hljs-string"><span class="hljs-string">'Maltese'</span></span>: <span class="hljs-string"><span class="hljs-string">'mt'</span></span>, <span class="hljs-string"><span class="hljs-string">'Croatian'</span></span>: <span class="hljs-string"><span class="hljs-string">'hr'</span></span>, <span class="hljs-string"><span class="hljs-string">'Norwegian'</span></span>: <span class="hljs-string"><span class="hljs-string">'no'</span></span>, <span class="hljs-string"><span class="hljs-string">'Czech'</span></span>: <span class="hljs-string"><span class="hljs-string">'cs'</span></span>, <span class="hljs-string"><span class="hljs-string">'Persian'</span></span>: <span class="hljs-string"><span class="hljs-string">'fa'</span></span>, <span class="hljs-string"><span class="hljs-string">'Danish'</span></span>: <span class="hljs-string"><span class="hljs-string">'da'</span></span>, <span class="hljs-string"><span class="hljs-string">'Polish'</span></span>: <span class="hljs-string"><span class="hljs-string">'pl'</span></span>, <span class="hljs-string"><span class="hljs-string">'Dutch'</span></span>: <span class="hljs-string"><span class="hljs-string">'nl'</span></span>, <span class="hljs-string"><span class="hljs-string">'Portuguese'</span></span>: <span class="hljs-string"><span class="hljs-string">'pt'</span></span>, <span class="hljs-string"><span class="hljs-string">'English'</span></span>: <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'Romanian'</span></span>: <span class="hljs-string"><span class="hljs-string">'ro'</span></span>, <span class="hljs-string"><span class="hljs-string">'Esperanto'</span></span>: <span class="hljs-string"><span class="hljs-string">'eo'</span></span>, <span class="hljs-string"><span class="hljs-string">'Russian'</span></span>: <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'Estonian'</span></span>: <span class="hljs-string"><span class="hljs-string">'et'</span></span>, <span class="hljs-string"><span class="hljs-string">'Serbian'</span></span>: <span class="hljs-string"><span class="hljs-string">'sr'</span></span>, <span class="hljs-string"><span class="hljs-string">'Filipino'</span></span>: <span class="hljs-string"><span class="hljs-string">'tl'</span></span>, <span class="hljs-string"><span class="hljs-string">'Slovak'</span></span>: <span class="hljs-string"><span class="hljs-string">'sk'</span></span>, <span class="hljs-string"><span class="hljs-string">'Finnish'</span></span>: <span class="hljs-string"><span class="hljs-string">'fi'</span></span>, <span class="hljs-string"><span class="hljs-string">'Slovenian'</span></span>: <span class="hljs-string"><span class="hljs-string">'sl'</span></span>, <span class="hljs-string"><span class="hljs-string">'French'</span></span>: <span class="hljs-string"><span class="hljs-string">'fr'</span></span>, <span class="hljs-string"><span class="hljs-string">'Spanish'</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-string"><span class="hljs-string">'Galician'</span></span>: <span class="hljs-string"><span class="hljs-string">'gl'</span></span>, <span class="hljs-string"><span class="hljs-string">'Swahili'</span></span>: <span class="hljs-string"><span class="hljs-string">'sw'</span></span>, <span class="hljs-string"><span class="hljs-string">'Georgian'</span></span>: <span class="hljs-string"><span class="hljs-string">'ka'</span></span>, <span class="hljs-string"><span class="hljs-string">'Swedish'</span></span>: <span class="hljs-string"><span class="hljs-string">'sv'</span></span>, <span class="hljs-string"><span class="hljs-string">'German'</span></span>: <span class="hljs-string"><span class="hljs-string">'de'</span></span>, <span class="hljs-string"><span class="hljs-string">'Tamil'</span></span>: <span class="hljs-string"><span class="hljs-string">'ta'</span></span>, <span class="hljs-string"><span class="hljs-string">'Greek'</span></span>: <span class="hljs-string"><span class="hljs-string">'el'</span></span>, <span class="hljs-string"><span class="hljs-string">'Telugu'</span></span>: <span class="hljs-string"><span class="hljs-string">'te'</span></span>, <span class="hljs-string"><span class="hljs-string">'Gujarati'</span></span>: <span class="hljs-string"><span class="hljs-string">'gu'</span></span>, <span class="hljs-string"><span class="hljs-string">'Thai'</span></span>: <span class="hljs-string"><span class="hljs-string">'th'</span></span>, <span class="hljs-string"><span class="hljs-string">'Haitian Creole'</span></span>: <span class="hljs-string"><span class="hljs-string">'ht'</span></span>, <span class="hljs-string"><span class="hljs-string">'Turkish'</span></span>: <span class="hljs-string"><span class="hljs-string">'tr'</span></span>, <span class="hljs-string"><span class="hljs-string">'Hebrew'</span></span>: <span class="hljs-string"><span class="hljs-string">'iw'</span></span>, <span class="hljs-string"><span class="hljs-string">'Ukrainian'</span></span>: <span class="hljs-string"><span class="hljs-string">'uk'</span></span>, <span class="hljs-string"><span class="hljs-string">'Hindi'</span></span>: <span class="hljs-string"><span class="hljs-string">'hi'</span></span>, <span class="hljs-string"><span class="hljs-string">'Urdu'</span></span>: <span class="hljs-string"><span class="hljs-string">'ur'</span></span>, <span class="hljs-string"><span class="hljs-string">'Hungarian'</span></span>: <span class="hljs-string"><span class="hljs-string">'hu'</span></span>, <span class="hljs-string"><span class="hljs-string">'Vietnamese'</span></span>: <span class="hljs-string"><span class="hljs-string">'vi'</span></span>, <span class="hljs-string"><span class="hljs-string">'Icelandic'</span></span>: <span class="hljs-string"><span class="hljs-string">'is'</span></span>, <span class="hljs-string"><span class="hljs-string">'Welsh'</span></span>: <span class="hljs-string"><span class="hljs-string">'cy'</span></span>, <span class="hljs-string"><span class="hljs-string">'Indonesian'</span></span>: <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'Yiddish'</span></span>: <span class="hljs-string"><span class="hljs-string">'yi'</span></span>}</code> </pre> <br></div></div><br><h4>  Python AsyncIO Sources </h4><br>  <b><a href="https://github.com/SlavikMIPT/opentfd">Github</a></b> <br>  I also added compiled executable files for linux and windows to the repository ‚Äî you can also run it on your home PC, but for 24/7 work it‚Äôs better to use VDS. <br><br>  The latest version of the <a href="https://telethon.readthedocs.io/">telethon</a> library is used to access the API. <br><br>  If anyone has a desire to improve the project - well. <br><br>  Throw an idea, discuss and ask questions in the comments or in the telegrams in the profile info. </div><p>Source: <a href="https://habr.com/ru/post/419249/">https://habr.com/ru/post/419249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419237/index.html">Some tasks of school mathematics</a></li>
<li><a href="../419241/index.html">Herpes virus causes Alzheimer's syndrome, other heart attack and diabetes viruses</a></li>
<li><a href="../419243/index.html">Numerical analysis of the effective area of ‚Äã‚Äãscattering in a two-dimensional axisymmetric formulation</a></li>
<li><a href="../419245/index.html">AI taught to determine where to first repair the road</a></li>
<li><a href="../419247/index.html">Pixel Studio - mobile pixel art editor</a></li>
<li><a href="../419251/index.html">Broadcast of the third day Slurm: Intensive on Cubernette</a></li>
<li><a href="../419253/index.html">Rome Club Report 2018, Chapter 3.6: ‚ÄúRegenerative Urbanism: Ecopolis‚Äù</a></li>
<li><a href="../419255/index.html">IoT security basics</a></li>
<li><a href="../419257/index.html">India introduced a new draft law on the protection of PD - another analogue of the GDPR?</a></li>
<li><a href="../419259/index.html">Release Rust 1.28</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>