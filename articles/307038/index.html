<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Activity tracking using the phone and MATLAB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Are you a physically active person? Do you count time spent walking or running? Recent studies have shown that nearly 20% of adults use some technolog...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Activity tracking using the phone and MATLAB</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/5e6/e30/7fe/5e6e307fefba45bd8d44cb5767a6668d.png" alt="MATLAB + Android" align="left">  Are you a physically active person?  Do you count time spent walking or running?  Recent studies have shown that nearly 20% of adults use some technology to track physical activity.  Do you own this 20% and analyze your daily activities to get to know yourself better? <br><br>  This post will tell you how to use an Android device paired with MATLAB machine learning algorithms and Statistics and Machine Learning Toolbox to track physical activity in real time. <br><br><h3>  Installation and Setup </h3><br>  We will need: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  a computer with a MATLAB R2014b or older, installed the Android Sensors support package, and the Statistics and Machine Learning Toolbox; </li><li>  Android smartphone with the <a href="http://www.mathworks.com/mobile/index.html">MATLAB Mobile</a> application; </li><li>  Internet connection on the smartphone. </li></ul><br>  Communication between the smartphone and MATLAB is done using the MATLAB Connector, the plug-in can be downloaded from the <a href="http://www.mathworks.com/products/matlab-mobile/features.html">link</a> . <br>  More information about collecting data from smartphones sensors <a href="http://blogs.mathworks.com/community/2014/10/06/acquire-data-from-device-sensors-with-matlab-mobile/">here</a> . <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  Watching someone makes it easy for us to determine what a person is doing, even if we see him for the first time.  We are able to recognize human activity by default.  The brain compares the observed actions with thousands of previously seen and gives the desired match.  Similarly, a computer (telephone) recognizes those actions that it has been taught. <br><br>  Using machine learning algorithms, you can teach a computer to recognize specific human activities, and improve this skill as new data becomes available.  Such recognition, which includes splitting data into separate ‚Äúclasses,‚Äù is called classification.  Another example of classification is the diagnosis of a patient based on the presence of certain symptoms. <br><br>  The classification algorithm for such tasks is applied in two stages: training and detection.  At the training stage, a model is built that sorts the training data into specific categories.  During the discovery phase, new data is bound to already existing categories. <br><br>  In the developed application, the acceleration sensor (accelerometer) of the phone was used, which was used to determine the type of activity.  A K-Nearest Neighbor (KNN) classifier has been selected.  This is a convenient algorithm for such an application, since it quickly detects motion and is very accurate in working with low-dimensional data (a small set of properties).  Based on the majority of the values ‚Äã‚Äãof his K-nearest neighbors in the training data set, he discovers the category to which the point in the new data belongs. <br><br>  The process of recognition of movements occurred in three stages: <br><br><ol><li>  data collection: acceleration values ‚Äã‚Äãin three planes were collected from the accelerometer of the Android device; </li><li>  extraction of properties: for each monitored type of activity, the distinctive properties were extracted and identified from the accelerometer readings; </li><li>  classification of activity: to teach the classifier, properties derived for various activities were used.  Then the classifier was used on the new accelerometer readings to determine what kind of movements occurred. </li></ol><br><h2>  Data collection </h2><br>  Since the detection was carried out by the classifier, for further work he had to learn on a set of previously known data points.  MATLAB Mobile, in combination with the MATLAB Support Package for Android Sensors (MATLAB Support Package for Android Sensors), allows you to collect device accelerometer data and send measurements to a PC in a MATLAB session. <br><br>  After establishing the connection with Android, I created an instance of the ‚Äúmobiledev‚Äù object to record data from the sensors of the device.  Then the accelerometer on the device was turned on, and MATLAB began collecting data. <br><br><pre><code class="matlab hljs">mobileSensor = mobiledev() <span class="hljs-comment"><span class="hljs-comment">% create mobiledev object mobileSensor.AccelerationSensorEnabled = 1; % enable accelerometer mobileSensor.start; % start sending data</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/c79/aee/b38/c79aeeb388344d57afd839c36ddf1b76.png" alt="image"></div><br>  After the last command, I did not move for 10 seconds.  Then he got up and walked for the next 70 seconds.  Then he went to the stairs, went downstairs and ran for about 60 seconds.  After another 70 seconds walked, then climbed the stairs and returned to the office.  In conclusion, I sat down and did not move.  From the accelerometer I received three-dimensional recorded data and visualized it. <br><br><pre> <code class="matlab hljs">[accel, time] = accellog(mobileSensor); <span class="hljs-comment"><span class="hljs-comment">% acquire data from logs plot(time, accel); % plot data</span></span></code> </pre> <br>  The graph below contains data on all actions: immobility, walking, running, climbing and descending from the stairs.  As you can see, they can not be detected simply by looking at the graph.  Therefore, it was necessary to identify and identify those properties that will help recognize each action and distinguish it from others. <br><br><img src="https://habrastorage.org/files/b00/cb4/1f0/b00cb41f0d2e49eba405970c6d4c072d.png" alt="image"><br><br><h2>  Retrieving Properties </h2><br>  Although in the time domain the ‚Äúraw‚Äù accelerometer readings look the same for each type of activity, in fact they contain unique characteristics that can be used to identify different types of movements.  This can be, for example, the maximum value of all data points or the number of data points out of any range.  Such characteristics are called properties. <br><br>  Thanks to these properties, you can make a classification.  You can consider many properties: <br><br><ul><li>  average value, </li><li>  median, </li><li>  dispersion, </li><li>  maximum, </li><li>  minimum, </li><li>  the magnitude of the frequency component, and so on. </li></ul><br>  However, in order to effectively extract them, it is necessary to find such a minimum set of properties that will allow to distinguish different activities and at the same time will not be too resource-intensive. <br><br>  Of all the possible properties, the next six turned out to be the most suitable.  They are labeled "Feature_N": <br><br><ol><li>  Feature_1: Average value of data. </li><li>  Feature_2: The square of the sum of the magnitude of the data is below the 25th <a href="http://dic.academic.ru/dic.nsf/rus_eng_mathematics/9402/%25D0%25BF%25D1%2580%25D0%25BE%25D1%2586%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D0%25BB%25D1%258C">percentile</a> . </li><li>  Feature_3: The squared sum of the magnitude of the data is below the 25th percentile. </li><li>  Feature_4: The peak of the frequency in <a href="http://www.mathworks.com/help/matlab/ref/fft.html">the</a> data <a href="http://www.mathworks.com/help/matlab/ref/fft.html">spectrum</a> on the y-axis is below 5 Hz. </li><li>  Feature_5: The number of peaks in the data spectrum along the Y axis is below 5 Hz. </li><li>  Feature_6: The integral of the data spectrum along the Y axis from 0 to 5 Hz. </li></ol><br>  The data size is the square root of the sum of squares of the acceleration readings along the Y axis and the Z axis. The readings along the X axis can be ignored because they do not differ much for different types of activity - this is due to the position of the phone in your pocket.  From the 5-second sections of the record of each activity, the corresponding six properties were extracted.  The measurement window of 5 seconds is selected because of the length sufficient to record consistent and stable properties.  The length of the window can be varied, remembering that in too long windows (about a minute or more) there is a high probability of error due to a possible change of activity. <br><br>  Having calculated the above properties for each type of activity as part of the learning procedure, the algorithm was given two inputs: properties and the corresponding answer (that is, the activity to which these properties belong).  The variable function is calculated on the basis of ‚Äúraw‚Äù three-dimensional accelerometer measurements while running and determines the size of the above-mentioned properties.  For example: <br><br><pre> <code class="matlab hljs">feature = [<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">7.6</span></span>, <span class="hljs-number"><span class="hljs-number">2.3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>]; activity = <span class="hljs-string"><span class="hljs-string">'running'</span></span>;</code> </pre> <br>  Here, the variable function looks like: [Feature_1, Feature_2, Feature_3, Feature_4, Feature_5, Feature_6].  Each property-activity pair represents 1 point of training data.  You can learn more about how to get these training data points through the MATLAB script recordTrainingData in the attached archive.  The initial accelerometer readings for each type of activity are stored in the MAT file.  To avoid data collection during a change of activity, input requests have been added between each activity.  This ensures that the source data for highlighting the properties of each activity is clean and consistent. <br><br>  To extract properties from source data stored in each MAT file, use extractTrainingFeature from the downloaded archive.  Please note that the initial accelerometer data is sampled at a frequency of about 200 Hz, but the frequency may be significantly less due to the peculiarities of Android operation.  In addition, the sampling rate may change during the measurement, thereby making the data unevenly discrete. <br><br>  To bring the data to a uniform sampling rate, a resampling algorithm has been developed.  The algorithm helped to improve the identification of properties and further classification. <br><br>  In the graph below, a red line with a 'x' indicates non-uniformly discrete source data of the Y-axis of the accelerometer, and a blue line with a 'o' indicates the processed data.  Note that the first three properties from the list above are in the time domain, while the rest are in the frequency domain. <br><br><img src="https://habrastorage.org/files/682/58d/d78/68258dd78d064b449f57a06785baa359.png" alt="image"><br><br>  The following graphs show that the properties of various activities are grouped together (for example, all the red dots on the graph correspond to the properties associated with running).  This nature of the properties (different clusters for different types of activities) allows you to accurately determine the type of activity performed for new accelerometer readings: <br><br><img src="https://habrastorage.org/files/9b8/f43/4f3/9b8f434f3db24f3cad58e5b1e02f72bf.png" alt="image"><br><br><img src="https://habrastorage.org/files/280/08d/fce/28008dfcea0b477b8ddcc36425197ee0.png" alt="image"><br><h2>  Activity classification </h2><br>  Typically, a learning algorithm requires many learning data points to build a reliable recognition model.  So, to train the classifier, we collected more than a thousand data points of each activity.  To begin with, the properties are grouped into an array in the following order - walking, running, resting position, climbing up and down: <br><br><pre> <code class="matlab hljs">data = [featureWalk; featureRun; featureIdle; featureUp; featureDown];</code> </pre><br>  In the code above, featureWalk is an array of six properties with a dimension of 1000 √ó 6.  Properties are calculated on the initial accelerometer data collected during walking.  Similarly, featureRun is an array of 1000 √ó 6 of six properties, calculated on the raw accelerometer data collected during the run, and so on. <br><br>  When the properties for all types of activities were collected in a single data file, it turned out that the properties of running are larger than the properties of walking or immobility.  Because of this, the properties of various types of activity are shifted and affect the ability of the algorithm to accurately determine the type of activity on new data (which can be scaled differently).  Therefore, it is necessary to normalize the data to limit the range of their values ‚Äã‚Äãfrom 0 to 1: <br><br><img src="https://habrastorage.org/files/b38/021/916/b380219165a945e18ab633fc86eee475.png" alt="image"><br><br>  The graph above illustrates the original values ‚Äã‚Äãof Feature_1, calculated for all activities, as well as normalized values.  As you can see, after normalization, the values ‚Äã‚Äãof Feature_1 are between [0, 1].  Similarly, the data of the other five properties were normalized. <br><br>  After normalization and preparation of data for use, it is necessary to determine how the machine learning algorithm responds to the input data array.  The input data and the response to them will then train the algorithm to classify new data. <br>  To build an output response vector, first, whole numbers are assigned for each type of activity: -1, 0, 1, 2, 3 - descend, rest, climb stairs, walk and run, respectively.  Since a response is needed for each set of input properties, a column vector (containing these integers) is created of the same length as the response vector.  So that the detected activity is easily read, the response vector is converted into an <a href="http://www.mathworks.com/help/stats/categorical-arrays.html">array of categories</a> with the values ‚Äã‚Äãof ‚ÄúGoing Downstairs‚Äù, ‚ÄúIdling‚Äù, ‚ÄúClimbing Upstairs‚Äù, ‚ÄúWalking‚Äù, ‚ÄúRunning‚Äù and ‚ÄúTransition‚Äù: <br><br><pre> <code class="matlab hljs">Down = <span class="hljs-number"><span class="hljs-number">-1</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">ones</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(featureDown), <span class="hljs-number"><span class="hljs-number">1</span></span>); Idle = <span class="hljs-built_in"><span class="hljs-built_in">zeros</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(featureIdle), <span class="hljs-number"><span class="hljs-number">1</span></span>); Up = <span class="hljs-built_in"><span class="hljs-built_in">ones</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(featureUp), <span class="hljs-number"><span class="hljs-number">1</span></span>); Walk = <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">ones</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(featureWalk), <span class="hljs-number"><span class="hljs-number">1</span></span>); Run = <span class="hljs-number"><span class="hljs-number">3</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">ones</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(featureRun), <span class="hljs-number"><span class="hljs-number">1</span></span>); responseVector = [Walk; Run; Idle; Up; Down]; <span class="hljs-comment"><span class="hljs-comment">% building the output response vector valueset = [-1:3, -10]; cateName = {'Going downstairs', 'Idling', 'Climbing upstairs', 'Walking', ... 'Running', 'Transition'}; response = categorical(responseVector, valueset, ... cateName); % converting to a categorical array</span></span></code> </pre> <br>  By generating an array of responses above, the K-NN algorithm was trained to create models.  To do this, use the <a href="http://www.mathworks.com/help/stats/fitcknn.html">FITCKNN</a> function from the Statistics and Machine Learning Toolbox;  after several attempts for the application, the value of the property 'NumNeighbors' K equal to 30 was chosen, so it provided the necessary performance and detection accuracy.  Having obtained the model with the help of training data, it must be confirmed on the new data coming from the smartphone. <br><br><pre> <code class="matlab hljs">mdl = fitcknn(data, response); mdl.NumNeighbors = <span class="hljs-number"><span class="hljs-number">30</span></span>;</code> </pre> <br>  To do this, the extractFeatures function was created to calculate the six properties required for classification.  The calculated properties (saved in the new Feature variable) are then used together with the model to recognize activity: the model is trained to distinguish 5 of its types.  A natural question arises: what to do if the detected activity is different from them? <br><br><pre> <code class="matlab hljs">newFeature = [<span class="hljs-number"><span class="hljs-number">0.15</span></span>, <span class="hljs-number"><span class="hljs-number">0.28</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.35</span></span>, <span class="hljs-number"><span class="hljs-number">0.65</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>]; <span class="hljs-comment"><span class="hljs-comment">% features for the new activity result = predict(mdl,newFeature); % predicting the activity</span></span></code> </pre> <br><br>  The detector will continue to classify activity in the current detection window and assign small probabilities for each of the 5 categories.  The same small probabilities can arise when moving from one type of activity to another within one detection window - this will complicate the classification.  In order to avoid such incorrect detection, the predictor is implemented in such a way as to produce a ‚ÄúTransition‚Äù in with a prediction probability less than 95%. <br><br>  The same rule applies when moving from one classified activity to another, for example, from walking (‚ÄúWalking‚Äù) to running (‚ÄúRunning‚Äù).  This is reasonable, because on successive windows, the detection of property values ‚Äã‚Äãin such a transition may be unstable. <br><br>  Below is a graph of the original data collected from the phone within a minute, and recognized actions.  For convenience, the line of recognized activity is below and marked as: <br><br>  x - Walking, * - Running (Running), o - resting states (Idling), ÀÑ - Walking Upstairs, ÀÖ - Walking Downstairs, ‚Ä¢ - Transition: <br><br><img src="https://habrastorage.org/files/e00/060/d08/e00060d08a2549d7884049621d1443dc.png" alt="image"><br><br>  Note that for learning, the machine learning algorithm uses the initial accelerometer data for the various actions performed.  If you use the learning algorithm with ready data from the archive (see the link at the end of the article), then the detection algorithm for the data collected from your phone will most likely not be accurate.  Even if you put the phone, like the author, in the right front pocket of the pants, the algorithm will still not be accurate.  This happens because of the difference in gaits, the dependence of measurements on the height and weight of a particular person. <br><br>  To create an activity detector that accurately identifies your actions, you need to start by collecting several sets of phone accelerometer data for those activities that you want to recognize.  Then, for each dataset, extract the 6 properties listed above using the extractTrainingFeatures training.  After using the extracted properties to train the machine learning algorithm.  Now you can use the resulting algorithm to recognize your new actions. <br><br>  In the post, only one of the many applications of the application obtained is considered.  Such an application can be applied to any other recognition system, for example, for a mobile robot.  You can supplement the application with data from GPS sensors, gyroscopes, magnetometers, to get a more functional tracker. <br><br>  <a href="http://www.mathworks.com/matlabcentral/fileexchange/51079">Sample Code</a> </div><p>Source: <a href="https://habr.com/ru/post/307038/">https://habr.com/ru/post/307038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307024/index.html">Deep Learning - what to do, whom to beat</a></li>
<li><a href="../307026/index.html">Work with Facebook API from UWP applications</a></li>
<li><a href="../307028/index.html">Budget "data center" at Nutanix CE</a></li>
<li><a href="../307032/index.html">Installing any software using WSUS - 2</a></li>
<li><a href="../307034/index.html">Conditional dependency injection in ASP.NET Core. Part 2</a></li>
<li><a href="../307040/index.html">Why OOP is not encapsulation, inheritance and polymorphism, or how I learned not to worry and fell in love with markup</a></li>
<li><a href="../307042/index.html">Five practices for organizing lifelong learning in a team</a></li>
<li><a href="../307044/index.html">PYCONRU-2016: video of all reports and presentations</a></li>
<li><a href="../307046/index.html">The long-awaited check CryEngine V</a></li>
<li><a href="../307048/index.html">Overview of the two courses ‚ÄúMachine Learning‚Äù from Coursera</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>