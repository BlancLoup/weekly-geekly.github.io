<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Remote torrent client (transmission-daemon + firefox plugin + php)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It has long been matured to put a torrent client on a linux home server, and not as easy as possible for remote use. A simple web interface was not en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Remote torrent client (transmission-daemon + firefox plugin + php)</h1><div class="post__text post__text-html js-mediator-article"> It has long been matured to put a torrent client on a linux home server, and not as easy as possible for remote use.  A simple web interface was not enough for this, I wanted something more convenient. <br><br>  After a long search on the Internet, found an interesting thing.  <a href="">A plugin</a> for firefox that allows you to add a torrent file to the download list transmission in 2 clicks with the mouse.  It was decided to try. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Installing the transmission-daemon on the server did not cause any difficulties, since it is in the packages. <br>  Similarly, with the plugin for firelight. <br><br>  Having used this case, a huge minus was immediately discovered: when I tried to download from torrents.ru, I got out an error. <br><br>  It was decided not to despair, but to try to finish it so that torrents.ru could work. <br><br>  Plug-in for firelight - xpi file.  This is just a renamed zip archive.  After unpacking it and sticking to the inside, I found out that he just sends a link to the torrent file transmission, and that one already downloads it.  That is, you need to make some kind of proxy that would download the file itself and give it to the torrent client. <br><br>  On php + wget, this code was quickly tweaked: <br> <code><a href="http://login.torrents.ru/forum/login.php"></a> &lt;?php <br> if(!$_REQUEST['url']) exit(0); <br> $url = trim($_REQUEST['url']); <br> $filename = 'tor.torrent'; //default name <br> <br> if(preg_match("/http:\/\/[\w\.]*torrents.ru/",$url,$mass)){ <br> // torrents.ru!!!! <br> if(preg_match("/^http.*\?t=([0-9]*)$/",$url,$mass)) <br> { <br> $filename = "[torrents.ru].t".$mass[1].".torrent"; <br> } <br> $login = ''; <br> $pass = ''; <br> $cmd_login = "wget -nv --post-data 'login_username=".$login."&amp;login_password=".$pass."&amp;ses_short=1&amp;login=' --save-cookies=tor-cookie login.torrents.ru/forum/login.php --referer=http://torrents.ru/forum/index.php -O ./logintest.html"; <br> $cmd_download = "wget --keep-session-cookies --load-cookies=tor-cookie --save-cookies=tor-cookie ".$url." -O ".$filename; <br> $mime_good = "BitTorrent file"; <br> $cmd_mime = "file -b "; <br> //Try download use old cookies <br> $ret = shell_exec($cmd_download); <br> //Check torrent file <br> if($mime_good != trim(shell_exec($cmd_mime.$filename))){ <br> // download fail, must login <br> $ret = shell_exec($cmd_login); <br> sleep(1); <br> $ret = shell_exec($cmd_download); <br> if($mime_good != trim(shell_exec($cmd_mime.$filename))){ <br> echo "ERROR!!!"; <br> exit(0); <br> } <br> } <br> // torrent file loaded, now we can upload it <br> header( "Content-Type: application/x-bittorrent;" ); <br> header( "Content-Disposition: inline; filename=\"".$filename."\"" ); <br> <br> readfile($filename); <br> <br> unlink($filename); <br> }// if torrents.ru <br> else <br> { <br> // NO torrents.ru <br> $filename = basename($url); <br> header( "Content-Type: application/x-bittorrent;" ); <br> header( "Content-Disposition: inline; filename=\"".$filename."\"" ); <br> <br> readfile($url); <br> } <br> <br> ?&gt;</code> <br> <br>  The algorithm is as follows: <br>  1. If the link is transmitted in the url parameter to torrents.ru then <br>  1.1 Attempting to download a file using saved cookies.  If it failed <br>  1.1.1 Login to torrents.ru using LOGIN and PASSWORD and save the transmitted cookies <br>  1.1.2 Download files with new cookies.  If this did not work out, then exit with shouts of ‚ÄúERROR!‚Äù <br>  1.2 Transferring file headers. <br>  1.3 Transfer the file itself. <br>  2. If the link is not on torrents.ru then <br>  2.1 Transfer headers. <br>  2.2 Download and file transfer. <br><br>  Of course, it was possible not to make a fuss with wget, but to use curl in php, but I am not familiar with curl, but I‚Äôve been working with wget for a long time. <br><br>  It remains only to force the transmission to download torrent files through this proxy. <br>  The solution was very simple.  In the firewall plugin in the content / overlay.js file, you need to replace the addTorrent function with this: <br> <code>addTorrent: function(torrentURL, callback) { <br> autotrans.log(autotrans.strings.getString("extensions.autotrans.adding_url") + ": " + torrentURL); <br> var transURL = autotrans.prefService.getCharPref("extensions.autotrans.url"); <br> torrentURL = torrentURL.replace(/&amp;/g,"%26"); <br> torrentURL = torrentURL.replace(/:\/\//g,"%3A%2F%2F"); <br> torrentURL = torrentURL.replace(/\?/g,"%3F"); <br> torrentURL = torrentURL.replace(/=/g,"%3D"); <br> torrentURL = "http://localhost/torrent.php?url=".concat(torrentURL); <br> autotrans.ajaxToUrl(transURL, autotrans.jsonService.encode({ method: "torrent-add", arguments: { filename: torrentURL } }), callback); <br> },</code> <br> <br>  We assemble the plugin back, import it into firefox, save the php script in the root directory of the web server (the web server should be in the same place as the torrent client) in the torrent.php file and check. <br><br>  Now the plugin works as it should.  But there was one more unpleasant moment.  If you enable the filtering feature to show the Torrent it! Menu, then it stops appearing on the torrents.ru website.  Having stuck a little in the code, you can solve this problem as well.  Just replace the contextMenuVisible function with this: <br> <code>contextMenuVisible: function() { <br> if (autotrans.prefService.getBoolPref("extensions.autotrans.extfilter")) { <br> // Only show context menu item if selected file has torrent extension or mime-type <br> var visible = false; <br> if (gContextMenu.onLink) { <br> /*try { <br> var request = new XMLHttpRequest(); <br> request.open("HEAD", gContextMenu.linkURL, true); <br> request.onreadystatechange = function() { <br> if (request.readyState == 4) { <br> var mime = request.getResponseHeader("Content-Type"); <br> autotrans.showContextMenu(mime == "application/x-bittorrent"); <br> } <br> } <br> request.send(null); <br> } catch (e) { <br> autotrans.log(autotrans.strings.getString("extensions.autotrans.error") + ": " + e); <br> }*/ <br> visible = /\.torrent$/.test(gContextMenu.linkURL); <br> if(!visible ) visible = /\.torrent$/.test(gContextMenu.linkText()); <br> } <br> return visible; <br> } else { <br> return true; <br> } <br> },</code> <br> <br>  In the new implementation, mime-type checking is disabled, and checking on the link text has been added. <br><br>  Now everything works as it should. <br><br>  That's all. <br><br>  For lovers of native clients there is a <a href="http://code.google.com/p/transmisson-remote-gui/">transmisson-remote-gui</a> project, whose interface is very similar to the utorrent interface. </div><p>Source: <a href="https://habr.com/ru/post/79190/">https://habr.com/ru/post/79190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79180/index.html">Viliv N5 - very small netbook</a></li>
<li><a href="../79181/index.html">Formatting dates by RFC-2822 for RSS in ASP-vbscript</a></li>
<li><a href="../79183/index.html">New Year's Twitter-tree</a></li>
<li><a href="../79186/index.html">The netbook from Google will appear in a year</a></li>
<li><a href="../79189/index.html">Realplexor: productive Comet server with API for PHP and Javascript (realtime)</a></li>
<li><a href="../79191/index.html">Bad management vs. curved arms</a></li>
<li><a href="../79192/index.html">Beeline plans to transfer your personal data to collector companies if you owe</a></li>
<li><a href="../79194/index.html">Oh, here you are, habraklovek!</a></li>
<li><a href="../79197/index.html">PuTTY in Linux: how to copy text</a></li>
<li><a href="../79198/index.html">5 tips for developing the design of your application icons for the app store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>