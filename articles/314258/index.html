<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Composition and interfaces</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the world of object-oriented programming, the concept of inheritance has long been criticized. 
 There are a lot of arguments: 


- the child class...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Composition and interfaces</h1><div class="post__text post__text-html js-mediator-article"><h3>  In the world of object-oriented programming, the concept of inheritance has long been criticized. </h3><br><h4>  There are a lot of arguments: </h4><br><ul><li>  the child class inherits all the data and behavior of the parent, which is not always necessary (and when finalizing the parent class, the data and behavior that was not expected at the time of development of the child) fall into the child class; </li><li>  virtual methods are less productive, and if the language allows declaring a non-virtual method, then what to do if the heir needs to block it (you can mark the method with the word new, but polymorphism will not work, and using such an object can lead to unexpected behavior , depending on what type of object the object was given at the time of its use); </li><li>  if the need arises for multiple inheritance, then in most languages ‚Äã‚Äãit is absent, and where there is (C ++), it is considered to be laborious; </li><li>  there are tasks where inheritance cannot help as such - if you need a container of elements (set, array, list) with the same behavior for elements of different types, and you need to provide static typing, then generics will help. </li><li>  etc. </li></ul><br>  An alternative to inheritance is the use of interfaces and composition.  (Interfaces have long been used as an alternative to multiple inheritance, even if inheritance is actively used in the class hierarchy.) <br><br>  The declared advantage of inheritance is the lack of code duplication.  In the subject area, there may be objects with a similar or identical set of properties and methods, but with partially or completely different behavior or mechanisms for implementing this behavior.  And in this case, other mechanisms will have to be used to eliminate duplication of code. <br><br>  And how can you solve this problem (no duplication of code) in the case of composition and interfaces? <br>  This topic is devoted to this article. <br><a name="habracut"></a><br>  Let some interface be declared, and two or more classes that implement this interface.  Some of the code implements the interface, each class is different, and some - the same. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To simplify, we consider a particular variant, when the MethodA method of the interface is implemented for each class differently, and the MethodB method is the same. <br><br>  The first option to eliminate duplication of code that comes to mind is most likely to be a variant of the helper class with static methods that take the necessary variables as arguments, and these methods are called in methodB implementation of different classes, where the necessary values ‚Äã‚Äãare passed to the helper method . <br><br>  The helper class does not need to be implemented as static; you can also make it an instance strategy class ‚Äî in this case, it is better to pass the input data to the strategy constructor, rather than to its methods. <br><br>  I propose to consider how this approach can be implemented on a specific example, using the means of modern languages.  This article will use the C # language.  In the future I plan to write a sequel with examples in Java and Ruby. <br><br>  So, let us in the project need to implement a set of classes that allow us to authorize the user in the system.  The authorization methods will return instances of the entities, which we will call AuthCredentials, and which will contain the authorization / authentication information about the user.  These entities must have ‚Äúbool IsValid ()‚Äù type methods that allow you to check the validity of each AuthCredentials instance. <br><br><h4>  Step 1 </h4><br>  The main idea of ‚Äã‚Äãthe proposed approach to solving the problem discussed above is that we create a set of atomic interfaces ‚Äî various versions of the representation of the AuthCredentials entity, as well as interfaces that are a composition of atomic interfaces.  For each of the interfaces, we create the necessary extension methods for working with interfaces.  Thus, for the implementation of each of their interfaces, a single code will be defined that allows working with any implementation of these interfaces.  The peculiarity of this approach is that extension methods can work only with the properties and methods defined in the interfaces, but not with the internal implementation of the interfaces. <br><br>  Let's create in the Visual Studio Community 2015 a solution (Solution) for the Windows Console Application consisting of four projects: <br><br><ol><li>  HelloExtensions - the console application itself, in which the main code of the example rendered to the library (Class Library) will be called; </li><li>  HelloExtensions.Auth is the main library containing interfaces that allow you to demonstrate the solution of the problem discussed in this article; </li><li>  HelloExtensions.ProjectA.Auth - a library with the implementation of interfaces defined in HelloExtensions.Auth; </li><li>  HelloExtensions.ProjectB.Auth is a library with alternative implementations of the interfaces defined in HelloExtensions.Auth. </li></ol><br><h4>  Step 2 </h4><br>  We define the following interfaces in the HelloExtensions.Auth project.  (Hereinafter, the proposed interfaces are of a demonstration nature; in real projects, the contents of the interfaces are determined by business logic.) <br><br>  ICredentialUser interface - for the case when the user can log in to the system by his login or other identifier (without the possibility of anonymous authorization) and without creating a user session;  in case of successful authorization, the user ID in the database is returned (UserId), otherwise null is returned. <br><br><div class="spoiler">  <b class="spoiler_title">interface ICredentialUser</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICredentialUser</span></span> { Guid? UserId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } }</code> </pre> </div></div><br>  ICredentialToken interface - for the case when the user can log in to the system anonymously;  in case of successful authorization, the session identifier (token) is returned, otherwise null is returned. <br><br><div class="spoiler">  <b class="spoiler_title">interface ICredentialToken</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICredentialToken</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Token { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } }</code> </pre> </div></div><br>  ICredentialInfo interface - for the case of traditional user authorization in the system by login (or other identifier), with the creation of a user session;  The interface is a composition of the ICredentialUser and ICredentialToken interfaces. <br><br><div class="spoiler">  <b class="spoiler_title">interface ICredentialInfo</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICredentialInfo</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialUser</span></span>, <span class="hljs-title"><span class="hljs-title">ICredentialToken</span></span> { } }</code> </pre> </div></div><br>  IEncryptionKey interface - for the case when, upon successful authorization, an encryption key is returned to the system with the help of which the user can encrypt the data before sending it to the system. <br><br><div class="spoiler">  <b class="spoiler_title">interface IEncryptionKey</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IEncryptionKey</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] EncryptionKey { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } }</code> </pre> </div></div><br>  Interface ICredentialInfoEx is a composition of the ICredentialInfo and IEncryptionKey interfaces. <br><br><div class="spoiler">  <b class="spoiler_title">interface ICredentialInfoEx</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICredentialInfoEx</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialInfo</span></span>, <span class="hljs-title"><span class="hljs-title">IEncryptionKey</span></span> { } }</code> </pre> </div></div><br><h4>  Step 2.1 </h4><br>  We define helper classes and other data types in the HelloExtensions.Auth project.  (Hereinafter, the declarations and logic of auxiliary classes have demonstration character, the logic is implemented in the form of stubs. In real projects, auxiliary classes are defined by business logic.) <br><br>  The TokenValidator class provides logic for the validation of a token identifier (for example, validity checks, internal consistency, and the existence of active tokens registered in the system). <br><br><div class="spoiler">  <b class="spoiler_title">class TokenValidator</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TokenValidator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TokenParams</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TokenHeaderSize = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MinTokenSize = TokenHeaderSize + <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MaxTokenSize = TokenHeaderSize + <span class="hljs-number"><span class="hljs-number">256</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTokenBodySize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bodySize = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) bodySize |= token[i] &lt;&lt; i * <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bodySize; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidTokenInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetTokenBodySize(token) != token.Length - TokenParams.TokenHeaderSize) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Additional Token Validation, // for ex., searching token in a Session Cache Manager return true; } public static bool IsValidToken(byte[] token) =&gt; token != null &amp;&amp; token.Length &gt;= TokenParams.MinTokenSize &amp;&amp; token.Length &lt;= TokenParams.MaxTokenSize &amp;&amp; IsValidTokenInternal(token); } }</span></span></code> </pre> </div></div><br>  The IdentifierValidator class provides logic for identifier validation (for example, checking for the validity of a value and the existence of an identifier in the system database). <br><br><div class="spoiler">  <b class="spoiler_title">class IdentifierValidator</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IdentifierValidator</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> check id exists in database private static bool IsIdentidierExists(Guid id) =&gt; true; public static bool IsValidIdentifier(Guid id) =&gt; id != Guid.Empty &amp;&amp; IsIdentidierExists(id); public static bool IsValidIdentifier(Guid? id) =&gt; id.HasValue &amp;&amp; IsValidIdentifier(id.Value); } }</span></span></code> </pre></div></div><br>  Enumeration KeySize is a list of permissible sizes (in bits) of encryption keys, with the definition of an internal value in the form of a key length in bytes. <br><br><div class="spoiler">  <b class="spoiler_title">enum keysize</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> KeySize : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> { KeySize256 = <span class="hljs-number"><span class="hljs-number">32</span></span>, KeySize512 = <span class="hljs-number"><span class="hljs-number">64</span></span>, KeySize1024 = <span class="hljs-number"><span class="hljs-number">128</span></span> } }</code> </pre> </div></div><br>  The KeySizes class is a list of acceptable sizes of encryption keys in the form of a list. <br><br><div class="spoiler">  <b class="spoiler_title">class KeySizes</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.ObjectModel; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">KeySizes</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IReadOnlyList&lt;KeySize&gt; Items { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KeySizes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReadOnlyCollection&lt;KeySize&gt;( (KeySize[])<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(KeySize).GetEnumValues() ); } } }</code> </pre> </div></div><br>  The KeyValidator class provides logic for encryption key validity. <br><br><div class="spoiler">  <b class="spoiler_title">class KeyValidator</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">KeyValidator</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidKeyInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] key</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key.All(item =&gt; item == <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>.MinValue)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key.All(item =&gt; item == <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>.MaxValue)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Additional Key Validation, for ex., checking for known testings values return true; } public static bool IsValidKey(byte[] key) =&gt; key != null &amp;&amp; key.Length &gt; 0 &amp;&amp; KeySizes.Items.Contains((KeySize)key.Length) &amp;&amp; IsValidKeyInternal(key); } }</span></span></code> </pre> </div></div><br><h4>  Step 2.2 </h4><br>  In the HelloExtensions.Auth project, we define the CredentialsExtensions class, which provides extension methods for the interfaces defined above that declare different AuthCredentials structures, depending on the authorization method in the system. <br><br><div class="spoiler">  <b class="spoiler_title">class CredentialsExtensions</b> <div class="spoiler_text"><pre> <code class="hljs javascript">namespace HelloExtensions.Auth { using Interfaces; public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CredentialsExtensions</span></span></span><span class="hljs-class"> </span></span>{ public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> bool IsValid(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ICredentialUser user) =&gt; IdentifierValidator.IsValidIdentifier(user.UserId); public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> bool IsValid(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ICredentialToken token) =&gt; TokenValidator.IsValidToken(token.Token); public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> bool IsValid(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ICredentialInfo info) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ICredentialUser</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">info</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> &amp;&amp; (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ICredentialToken</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">info</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">static</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IsValid</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ICredentialInfoEx info</span></span></span><span class="hljs-function">) =&gt;</span></span> (<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICredentialInfo</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">info</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">public</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">static</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IsValidEx</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ICredentialInfoEx info</span></span></span><span class="hljs-function">) =&gt;</span></span> ((ICredentialInfo)info).IsValid() &amp;&amp; KeyValidator.IsValidKey(info.EncryptionKey); } }</code> </pre></div></div><br>  As you can see, depending on which interface the variable implements, one or another IsValid method will be selected to check the structure of the AuthCredentials: at the compilation stage, the most ‚Äúcomplete‚Äù method will always be selected - for example, for a variable implementing the ICredentialInfo interface, the IsValid method will be selected (this ICredentialInfo info), not IsValid (this ICredentialUser user) or IsValid (this ICredentialToken token). <br><br>  However, not everything is so good yet, and there are nuances: <br><br><ul><li>  The statement about the choice when calling the most "complete" method is valid if the variable is reduced to its original type or the most "complete" interface.  And if a variable of the type that implements the ICredentialInfo interface is brought to the ICredentialUser interface in the code, then the IsValid method (this ICredentialUser user) will be called when IsValid is called, which will lead to incomplete / incorrect verification of the AuthCredentials structure. </li><li>  How correct is the existence of two methods IsValid (this ICredentialInfoEx info) and IsValidEx (this ICredentialInfoEx info) at the same time?  It turns out that incomplete / incorrect verification is possible for the ICredentialInfoEx interface. </li></ul><br>  Thus, in the current version of the implementation of extension methods, there is no ‚Äúpolymorphism‚Äù of interfaces (let's call it so). <br><br>  Therefore, it appears that the interfaces of various variants of the structures AuthCredentials and the class CredentialsExtensions with extension methods need to be rewritten as follows. <br><br>  We implement the empty IAuthCredentials interface, from which the atomic interfaces will inherit (the ‚Äúroot‚Äù interface for all variants of the AuthCredentials structures). <br><br>  (You do not need to redefine the composition interfaces ‚Äî they will automatically inherit IAuthCredentials, nor do you need to redefine such atomic interfaces for which you do not intend to create standalone implementations ‚Äî in our case, this is IEncryptionKey.) <br><br><div class="spoiler">  <b class="spoiler_title">interface IAuthCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAuthCredentials</span></span> { } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface ICredentialUser</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICredentialUser</span></span> : <span class="hljs-title"><span class="hljs-title">IAuthCredentials</span></span> { Guid? UserId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface ICredentialToken</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICredentialToken</span></span> : <span class="hljs-title"><span class="hljs-title">IAuthCredentials</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Token { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } }</code> </pre> </div></div><br>  In the CredentialsExtensions class, we will leave only one open (public) extension method that works with the IAuthCredentials: <br><br><div class="spoiler">  <b class="spoiler_title">class CredentialsExtensions</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; namespace HelloExtensions.Auth { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CredentialsExtensions { private static <span class="hljs-type"><span class="hljs-type">bool</span></span> IsValid(this ICredentialUser <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>) =&gt; IdentifierValidator.IsValidIdentifier(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.UserId); private static <span class="hljs-type"><span class="hljs-type">bool</span></span> IsValid(this ICredentialToken token) =&gt; TokenValidator.IsValidToken(token.Token); private static <span class="hljs-type"><span class="hljs-type">bool</span></span> IsValid(this ICredentialInfo <span class="hljs-keyword"><span class="hljs-keyword">info</span></span>) =&gt; ((ICredentialUser)<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>).IsValid() &amp;&amp; ((ICredentialToken)<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>).IsValid(); private static <span class="hljs-type"><span class="hljs-type">bool</span></span> IsValid(this ICredentialInfoEx <span class="hljs-keyword"><span class="hljs-keyword">info</span></span>) =&gt; ((ICredentialInfo)<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>).IsValid() &amp;&amp; KeyValidator.IsValidKey(<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>.EncryptionKey); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">bool</span></span> IsValid(this IAuthCredentials credentials) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (credentials == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { //throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentNullException(nameof(credentials)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } { var credentialInfoEx = credentials <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ICredentialInfoEx; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (credentialInfoEx != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> credentialInfoEx.IsValid(); } { var credentialInfo = credentials <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ICredentialInfo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (credentialInfo != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> credentialInfo.IsValid(); } { var credentialUser = credentials <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ICredentialUser; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (credentialUser != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> credentialUser.IsValid(); } { var credentialToken = credentials <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ICredentialToken; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (credentialToken != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> credentialToken.IsValid(); } //throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArgumentException( // FormattableString.Invariant( // $"Specified {nameof(IAuthCredentials)} implementation not supported." // ), // nameof(credentials) //); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } }</code> </pre></div></div><br>  As you can see, when calling the IsValid method, checks on which interface the variable implements are now performed not at the compilation stage, but at runtime. <br><br>  Therefore, when implementing the IsValid method (this IAuthCredentials credentials), it is important to perform checks on the implementation of interfaces in the correct sequence (from the most ‚Äúcomplete‚Äù interface to the least ‚Äúcomplete‚Äù) to ensure the validity of the result of checking the AuthCredentials structure. <br><br><h4>  Step 3 </h4><br>  Let's fill in the HelloExtensions.ProjectA.Auth and HelloExtensions.ProjectB.Auth projects with logic that implements the AuthCredentials interfaces from the HelloExtensions.Auth project and the tools for working with the implementations of these interfaces. <br><br>  The general principle of filling projects: <br><br><ol><li>  we define the necessary interfaces that inherit the interfaces from HelloExtensions.Auth and add declarations specific to each of the projects; </li><li>  we create stub implementations of these interfaces; </li><li>  we create an auxiliary infrastructure with stubs, providing the authorization API in a certain system (the infrastructure is created according to the principle - interface, implementation, factory). </li></ol><br><h5>  Project "A" </h5><br>  Interfaces: <br><br><div class="spoiler">  <b class="spoiler_title">interface IXmlSupport</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IXmlSupport</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromXml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xml</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveToXml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface IUserCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IUserCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialInfo</span></span>, <span class="hljs-title"><span class="hljs-title">IXmlSupport</span></span> { } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface IUserCredentialsEx</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IUserCredentialsEx</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialInfoEx</span></span>, <span class="hljs-title"><span class="hljs-title">IXmlSupport</span></span> { } }</code> </pre> </div></div><br>  Interface implementations: <br><br><div class="spoiler">  <b class="spoiler_title">class UserCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth.Entities</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">IUserCredentials</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Guid? UserId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] SessionToken { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] ICredentialToken.Token =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SessionToken; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromXml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xml</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement loading from XML throw new NotImplementedException(); } public virtual string SaveToXml() { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement saving to XML throw new NotImplementedException(); } } }</span></span></code> </pre></div></div><br>  Note: Entity element names may differ from the names defined in the interface;  in this case, it is necessary to implement interface elements explicitly (explicitly), wrapping inside the call to the corresponding element of the entity. <br><br><div class="spoiler">  <b class="spoiler_title">class UserCredentialsEx</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth.Entities</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserCredentialsEx</span></span> : <span class="hljs-title"><span class="hljs-title">UserCredentials</span></span>, <span class="hljs-title"><span class="hljs-title">IUserCredentialsEx</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] EncryptionKey { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromXml</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xml</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement loading from XML throw new NotImplementedException(); } public override string SaveToXml() { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement saving to XML throw new NotImplementedException(); } } }</span></span></code> </pre> </div></div><br>  API infrastructure: <br><br><div class="spoiler">  <b class="spoiler_title">interface IAuthProvider</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAuthProvider</span></span> { <span class="hljs-function"><span class="hljs-function">IUserCredentials </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthorizeUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> login, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> password</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IUserCredentialsEx </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthorizeUserEx</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> login, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> password</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">class AuthProvider</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Entities; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AuthProvider</span></span> : <span class="hljs-title"><span class="hljs-title">IAuthProvider</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement User Authorization public IUserCredentials AuthorizeUser(string login, string password) =&gt; new UserCredentials(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement User Authorization public IUserCredentialsEx AuthorizeUserEx(string login, string password) =&gt; new UserCredentialsEx(); } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">class AuthProviderFactory</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectA.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AuthProviderFactory</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Lazy&lt;IAuthProvider&gt; defaultInstance; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthProviderFactory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { defaultInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lazy&lt;IAuthProvider&gt;(Create); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IAuthProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthProvider(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IAuthProvider Default =&gt; defaultInstance.Value; } }</code> </pre> </div></div><br><h5>  Project "B" </h5><br>  Interfaces: <br><br><div class="spoiler">  <b class="spoiler_title">interface IJsonSupport</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IJsonSupport</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> json</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveToJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface ISimpleUserCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISimpleUserCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialUser</span></span>, <span class="hljs-title"><span class="hljs-title">IJsonSupport</span></span> { } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface IUserCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IUserCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialInfo</span></span>, <span class="hljs-title"><span class="hljs-title">IJsonSupport</span></span> { } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">interface INonRegistrationSessionCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth.Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth.Interfaces</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">INonRegistrationSessionCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">ICredentialToken</span></span>, <span class="hljs-title"><span class="hljs-title">IJsonSupport</span></span> { } }</code> </pre> </div></div><br>  Interface implementations: <br><br><div class="spoiler">  <b class="spoiler_title">class SimpleUserCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth.Entities</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleUserCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">ISimpleUserCredentials</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Guid? UserId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> json</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement loading from JSON throw new NotImplementedException(); } public virtual string SaveToJson() { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement saving to JSON throw new NotImplementedException(); } } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">class UserCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth.Entities</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">SimpleUserCredentials</span></span>, <span class="hljs-title"><span class="hljs-title">IUserCredentials</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Token { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> json</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement loading from JSON throw new NotImplementedException(); } public override string SaveToJson() { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement saving to JSON throw new NotImplementedException(); } } }</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">class NonRegistrationSessionCredentials</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NonRegistrationSessionCredentials</span></span> : <span class="hljs-title"><span class="hljs-title">INonRegistrationSessionCredentials</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Token { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> json</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement loading from JSON throw new NotImplementedException(); } public virtual string SaveToJson() { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement saving to JSON throw new NotImplementedException(); } } }</span></span></code> </pre> </div></div><br>  API infrastructure: <br><br><div class="spoiler">  <b class="spoiler_title">interface IAuthProvider</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAuthProvider</span></span> { <span class="hljs-function"><span class="hljs-function">INonRegistrationSessionCredentials </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthorizeSession</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">ISimpleUserCredentials </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthorizeSimpleUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> login, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> password</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">IUserCredentials </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthorizeUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> login, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> password</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">class AuthProvide</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Security.Cryptography; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Entities; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Interfaces; <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AuthProvider</span></span> : <span class="hljs-title"><span class="hljs-title">IAuthProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TokenParams</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TokenHeaderSize = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TokenBodySize = <span class="hljs-number"><span class="hljs-number">64</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TokenSize = TokenHeaderSize + TokenBodySize; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillTokenHeader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] token</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { token[i] = <span class="hljs-keyword"><span class="hljs-keyword">unchecked</span></span>( (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>)TokenParams.TokenBodySize &gt;&gt; i * <span class="hljs-number"><span class="hljs-number">8</span></span>) ); } <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Put Additional Info into the Token Header } private static void FillTokenBody(byte[] token) { using (var rng = RandomNumberGenerator.Create()) { rng.GetBytes(token, TokenParams.TokenHeaderSize, TokenParams.TokenBodySize); } } private static void StoreToken(byte[] token) { // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement Token Storing in a Session Cache Manager } private static byte[] CreateToken() { byte[] token = new byte[TokenParams.TokenSize]; FillTokenHeader(token); FillTokenBody(token); return token; } public INonRegistrationSessionCredentials AuthorizeSession() { var credentials = new NonRegistrationSessionCredentials() { Token = CreateToken() }; StoreToken(credentials.Token); return credentials; } // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement User Authorization public ISimpleUserCredentials AuthorizeSimpleUser(string login, string password) =&gt; new SimpleUserCredentials(); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement User Authorization public IUserCredentials AuthorizeUser(string login, string password) =&gt; new UserCredentials(); } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">class AuthProviderFactory</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions.ProjectB.Auth</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AuthProviderFactory</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Lazy&lt;IAuthProvider&gt; defaultInstance; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AuthProviderFactory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { defaultInstance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lazy&lt;IAuthProvider&gt;(Create); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IAuthProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthProvider(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IAuthProvider Default =&gt; defaultInstance.Value; } }</code> </pre> </div></div><br><h4>  Step 3.1 </h4><br>  Fill the console application with calls to the authorization provider methods from Project ‚ÄúA‚Äù and Project ‚ÄúB‚Äù projects.  Each of the methods will return variables of some interface inheriting from IAuthCredentials.  For each of the variables, call the IsValid verification method.  Is done. <br><br><div class="spoiler">  <b class="spoiler_title">class program</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> HelloExtensions.Auth; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCredentialsA = ProjectA.Auth.AuthProviderFactory.Default .AuthorizeUser(<span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> authCredentialsAIsValid = authCredentialsA.IsValid(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCredentialsAEx = ProjectA.Auth.AuthProviderFactory.Default .AuthorizeUserEx(<span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> authCredentialsAExIsValid = authCredentialsAEx.IsValid(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCredentialsBSimple = ProjectB.Auth.AuthProviderFactory.Default .AuthorizeSimpleUser(<span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> authCredentialsBSimpleIsValid = authCredentialsBSimple.IsValid(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCredentialsB = ProjectB.Auth.AuthProviderFactory.Default .AuthorizeUser(<span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> authCredentialsBIsValid = authCredentialsB.IsValid(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sessionCredentials = ProjectB.Auth.AuthProviderFactory.Default .AuthorizeSession(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> sessionCredentialsIsValid = sessionCredentials.IsValid(); } } }</code> </pre></div></div><br>  Thus, we have achieved the goal, when for different entities implementing similar functionality (as well as having different functionality from each other), we can implement a single set of methods without copy-paste, which allows us to work with these entities in the same way. <br><br>  This method of using extension methods is suitable both for designing an application from scratch and for refactoring existing code. <br><br>  Separately, it is worth noting why the task in this example is not implemented through classical inheritance: entities in projects ‚ÄúA‚Äù and ‚ÄúB‚Äù implement functionality specific to each project - in the first case, entities can be (un) serialized from / to XML, in the second - from / to JSON. <br><br>  This is a demonstration difference, although it may occur in real projects (in which the differences in the entities may be even greater). <br><br>  In other words, if there is a certain set of entities that intersect in functionality only partially, and this very intersection has a ‚Äúfuzzy character‚Äù (UserId and SessionToken are used somewhere, and EncryptionKey is used somewhere else), then in creating a unified API that works with these entities in the intersection of their functionality, will help extensions methods. <br><br>  The methodology for working with extension methods is proposed in this article. <br><br>  To be continued. <br><br><h4>  Update: </h4><br>  Initially, the article did not mention one thing - the proposed approach is more applicable for cases where the project in different assemblies already have entities (classes) that are similar in functionality, and in top-level assemblies (in client code) work with these entities way, by referring to their properties and carrying out some checks (copy-paste with all the consequences). <br><br>  How is it better to implement the uniformity of work with these entities without refining and refactoring them? <br><br>  In this case, it seems appropriate to declare a set of interfaces (the properties and methods of the interfaces will repeat the existing properties and methods of the classes), and declare that the classes implement these interfaces. <br>  It is possible that some elements of the interface implementation of the classes will need to be declared explicitly by referring to the corresponding elements of the classes if the elements of the classes are called ‚Äúout of tune‚Äù, and class refactoring is impractical. <br><br>  Then we implement a class with extension methods for new interfaces, and in all places of accessing classes, we replace the copy-paste of some work with these classes with a call to one extension method. <br><br>  Thus, the proposed approach is applicable for working with legacy code, when it is necessary to quickly ‚Äúfix‚Äù and implement uniformity of work with a certain set of classes with similar (in a certain section) declarations and functionality. <br><br>  (The question of how such a set of classes could be in the project will be taken out of the brackets.) <br><br>  When developing the project API and class hierarchy from scratch, other approaches should be used. <br>  How can you implement the code without copy-paste, if two or more classes have the same method, but with a slightly different logic, this is a topic for another conversation. <br>  Perhaps this is the topic of a new article. </div><p>Source: <a href="https://habr.com/ru/post/314258/">https://habr.com/ru/post/314258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314248/index.html">PayPal will not come to Ukraine in the next 12 months - NBU</a></li>
<li><a href="../314250/index.html">What makes games funny? Comedy and humor in video games. Part two</a></li>
<li><a href="../314252/index.html">ASP.NET Core: Deploying a web app in Azure App Service using Visual Studio</a></li>
<li><a href="../314254/index.html">Phone number verification using Ruby on rails and Twilio</a></li>
<li><a href="../314256/index.html">Out of range: anomalous communication areas</a></li>
<li><a href="../314260/index.html">Home ad blocker</a></li>
<li><a href="../314262/index.html">DisTalk. If you can't read, it doesn't mean that you can't communicate.</a></li>
<li><a href="../314264/index.html">Localization of indie games in Unity: implicit costs</a></li>
<li><a href="../314266/index.html">Malefactors use 0day vulnerabilities in cyber attacks on users</a></li>
<li><a href="../314268/index.html">How to run Python through SAS?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>