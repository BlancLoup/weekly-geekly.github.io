<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúThe lifetime of a tab can be almost endless‚Äù: Timofey Chaptykov about JS development on VKontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This spring, VKontakte blog wrote "We are ready to start talking about what is behind the facade of the product." We did not miss the opportunity - an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúThe lifetime of a tab can be almost endless‚Äù: Timofey Chaptykov about JS development on VKontakte</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/684/7c7/6b4/6847c76b42ce403f9451a86be632617d.png"><br><br>  This spring, <b>VKontakte</b> blog <a href="https://habrahabr.ru/company/vkontakte/blog/324722/">wrote</a> "We are ready to start talking about what is behind the facade of the product."  We did not miss the opportunity - and on the eve of the JavaScript conference of <b>HolyJS</b> , where VK developer <b>Timofey Chaptykov</b> gave a <a href="https://holyjs-piter.ru/talks/accelerating-server-rendering-of-react-applications/">presentation</a> , asked him a few questions. <br><a name="habracut"></a><br><img src="https://habrastorage.org/web/c66/0d0/489/c660d0489d424dbda70775a6d2875018.jpg" align="left">  <b>- What exactly do you do in the VC?</b> <br><br>  - Mostly I am developing a message section.  But we have a small team, and the responsibility of each developer is quite wide.  And the longer a person works here, the wider it is. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>- Before working in the VC, you lived in Novosibirsk - because of this work and moved?</b>  <b>Recently, a Novosibirsk Java developer <a href="https://habrahabr.ru/company/jugru/blog/325442/">told</a> us that he has a great life in Novosibirsk, and that in a city with JavaScript and frontend, are there many vacancies, is the local JS community developed?</b> <br><br>  - Last year I visited St. Petersburg four times.  At some point I decided that it was easier to move.  Well, to refuse the proposal to work on one of the largest, most complex and mass projects with an extremely demanding audience was difficult. <br><br>  There are a lot of large IT-companies in Novosibirsk that have jobs in web development: Yandex, 2GIS, JetBrains, SberTech, Tinkoff.ru.  So I would say that in Novosibirsk there are guys who can make a complex scalable frontend.  There are several local conferences and meetings, once a year one of the largest IT conferences in Russia is held. <br><br>  <b>- VK has almost 100 million monthly audience.</b>  <b>How does such attendance affect development in general and JS / frontend in particular?</b> <br><br>  - Now all changes are first released for a small percentage of users.  For these users, we collect separate statistics.  It helps us to assess whether the release will affect the load. <br><br>  Sometimes this is not enough.  Some of the features we roll out only at night, if we assume the possibility that the release may affect performance and work under load.  At night, Moscow time, the load is lower, and if we see anomalies in the graphs, we will have time to roll back the changes or release hot fixes before the peak load occurs and there is a risk of service failure. <br><br>  With our load, we cannot afford simple approaches to updating statics.  We can not afford to combine all the scripts into one file and update it with each delay.  If all users come at the same time behind the file, it will be difficult to sustain the load.  One extra request, which will make 100 million users, can lead to disastrous consequences.  Therefore, we version the statics, load dynamically (the page will load the version of statics that is compatible with it), break into small pieces by sections and site features. <br><br>  Some changes we can not make directly.  We cannot turn off the site for several days while the database is being migrated with billions of records. <br><br>  When you have 100 million active users per month, probability theory starts working against you.  The number of experiments such that impossible events become a daily routine.  If the bug is reproduced once per million, this means that this bug will be played many times daily.  It is necessary to work out even the most incredible scenarios in detail. <br><br>  The frontend is affected by the fact that sometimes VKontakte case studies are very different from other sites.  For example, the lifetime of a tab with messages can be almost endless: you open a tab, and it lives for months.  It makes us think more about memory consumption. <br><br>  Sometimes strict performance requirements arise from a large amount of code.  For example, the assembly had to be <a href="https://www.youtube.com/watch%3Fv%3Dqseu-ZaGoes">organized</a> not entirely trivial and mainstream. <br><br>  I think we more often than most developers have to think about data structures, including on the client.  In our kitchen, you often hear conversations about algorithms and data structures than about new libraries and methodologies. <br><br>  On the site, we almost do not use external dependencies.  Technically, each section on the client is a separate JS application.  From shared resources - a system for codesplit and static versioning, working with multilanguage, utilities for working with DOM, server requests, a small shared storage, some reusable solutions for the user interface. <br><br><img src="https://habrastorage.org/web/886/98f/9cb/88698f9cb5f142fc8d88017582083ce4.jpg"><br><br>  <b>- Long ago, when Node.js was a little-known niche solution, VK developer Oleg Illarionov <a href="https://vk.com/wall66748_6469">became</a> its popularizer in Russia.</b>  <b>Do they use Node.js in VK now, when it is more than mainstream?</b> <br><br>  - In most cases, for objective reasons, we cannot use Node.js on the backend ‚Äî too slowly on our volumes.  Therefore, we, like the entire industry, use Node.js to build the frontend.  And there we use the traditional set of tools: Gulp, Webpack, Babel. <br><br>  <b>- Earlier, VKontakte <a href="https://habrahabr.ru/company/vkontakte/blog/214877/">posted</a> its own KPHP developments into open source - and in the case of JS, do the social networks have any significant internal ‚Äúbikes‚Äù that could theoretically be in the open source, or are you mainly using ready-made solutions?</b> <br><br>  - We use very few ready-made solutions in production.  In package.json, in the main repository, only 4 dependencies are declared.  Two of them are polyfills, two are libraries for recording and encoding audio to mp3. <br><br>  Significant domestic bicycles a lot.  But often our solutions are highly specialized, they will not be in demand in the ‚Äúmass‚Äù development sector.  For example, the infrastructure around KPHP has a fairly high entry threshold, its use imposes certain restrictions.  And there are not so many projects on which it would be possible to feel significant benefits from its implementation. <br><br>  Nevertheless, I expect that we will have more open-source software in the field of frontend. <br><br>  <b>‚ÄúThe JS world is often criticized from the perspective of‚Äú in the modern frontend, to write ‚ÄúHello world‚Äù, you need 360 MB of dependencies. ‚Äù</b>  <b>Does it bring inconvenience when working in VC, or is it an insignificant factor in such a large-scale project compared to others?</b> <br><br>  - Well, this is definitely not the main problem that we have to solve =) We have 140 MB of dependencies in node_modules.  In my opinion, one of the most serious technical challenges is the elimination of technical debt and the development of infrastructure for development and testing.  In our realities, we must do this without slowing down the development of new features.  And yet the same team of several dozen developers for all our products. <br><br>  <b>- Your <a href="https://holyjs-piter.ru/talks/accelerating-server-rendering-of-react-applications/">report</a> on HolyJS is called ‚ÄúReact with the speed of light: not quite the usual server rendering.‚Äù</b>  <b>Doesn‚Äôt it prevent you from using React that it was created in Facebook?</b>  <b>:)</b> <br><br>  - Come to the report, there I will tell you that the final decision is not based on React =) <br><br>  I would consider React as a term for an approach rather than as the name of a specific library.  Speaking about React, we usually mean Virtual DOM, declarative rendering, component approach, JSX. <br><br>  In most cases, React can, with minimal effort, be replaced with another library that uses the same principles.  And find some benchmarks that show that the chosen solution works faster under certain circumstances.  =) <br><br>  I like Preact, a tiny 4 KB library that provides all the basic features we are used to in React. <br><br>  React itself is not currently used on the VKontakte site, but there are several of our projects.  For example, <a href="https://vk.com/landings/desktop_messenger">VK Messenger</a> is a desktop application on Electron, written in React. <br><br>  <b>- Thank.</b>  <b>Finally, I would like to clarify because of your ironic tweet about the notification counter: can you briefly explain to anyone who does not face this professionally why this is a difficult task?</b> <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="842533024285777921"></twitter-widget><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  - The counter of notifications is one number that is displayed as a result of the work of a huge number of systems.  And usually these are complex and intricate multi-level systems with caching, asynchronous execution of tasks, queues and calculations that are performed on a huge number of servers.  As a result, failure of any part of any of these systems may result in the user seeing the wrong value on the counter. <br><br>  It seems to me ironic that the complexity of systems in IT is constantly attracting my attention with broken red counters in some applications on my phone. </div><p>Source: <a href="https://habr.com/ru/post/330000/">https://habr.com/ru/post/330000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329990/index.html">New architecture of Android applications - we try in practice</a></li>
<li><a href="../329992/index.html">Article translation: Best Practice for Creating Git Commit from OpenStack</a></li>
<li><a href="../329994/index.html">BI.ZONE Announces CTFzone Presidential Election</a></li>
<li><a href="../329996/index.html">Simple React Router v4 Tutorial</a></li>
<li><a href="../329998/index.html">Quest from EPAM: Five Tasks from .NET Interviews</a></li>
<li><a href="../330002/index.html">Analysis of tasks of the WAF Bypass contest on PHDays VII</a></li>
<li><a href="../330004/index.html">Hard Reverse or features reverse files for PowerPC architecture Big-Endian</a></li>
<li><a href="../330006/index.html">Understanding Array.prototype.reduce () and Recursion Using the Example of Apple Pie</a></li>
<li><a href="../330008/index.html">How not to give the algorithm to sell the bank</a></li>
<li><a href="../330010/index.html">HPE 3PAR StoreServ 9450</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>