<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accident Response: Stretched Cluster vs. DR Site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have two approaches to Disaster Recovery: a ‚Äústretched‚Äù cluster (active-active installation) and a platform with virtual machines turned off (repli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accident Response: Stretched Cluster vs. DR Site</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/vq/4b/8b/vq4b8bziie3zsdalswgid3zjmd8.jpeg"><br><br>  We have two approaches to Disaster Recovery: a ‚Äústretched‚Äù cluster (active-active installation) and a platform with virtual machines turned off (replicas).  They have several snapshot save points. <br><br>  There is a request for disaster recovery, and many of our clients really need it.  Therefore, we began to work out both schemes in the framework of our production. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The methods have pros and cons, now I'll tell you about them. <br><a name="habracut"></a><br><h3>  "Stretched" cluster </h3><br><img src="https://habrastorage.org/webt/oe/au/pz/oeaupzuepknnmkaax9h1gsssvso.png"><br><br>  As you can see, this is the standard history of the metrocluster.  In the pros - almost zero idle, a pause only for the time of launching virtual machines.  Handles this feature - VMware High Availability (HA).  She sees that the hosts are lost, and immediately restarts the VM on the remote site. <br><br>  The launch is done immediately with the storage system that is in the cluster. <br><br>  A geo-distributed cluster storage system is a marketing feature of NetApp.  Other manufacturers have something with a similar name.  In fact, this is a well-thought-out asynchronous replication from one side to the other.  We write to one node in the local network and synchronize it through specialized communication channels with another. <br><br>  In the event of a failure of one of the storage systems, the remaining (on the other site) presents the paths to the disks to the remaining hosts.  VMs that have died are restarted on them.  Everything happens automatically - the data center crashed, everything rebooted, the storage system worked, VMware worked.  The client saw that everything blinked and restarted. <br><br>  The only cache from the VM's RAM may be lost.  But if the database dropped it, then the loss is zero in time. <br><br>  If we lose the connection between the sites, then everything continues to work in its place and, as soon as the connection is restored, it begins to synchronize. <br><br>  Minus - high price.  Because what is actually needed is a double storage system (moreover, it is similar in type, speed and volume of disks of the first storage system on the main site), which cannot be used except as a reserve.  Plus strapping to the storage for the metrocluster, it is FC-bridges, FC-network and so on. <br><br>  We have two data centers, between them FC-bundle on two rays (four lines of dark optics and DWDM).  These are two pieces of iron, each provides 200 Gbps of bandwidth for FC and Ethernet. <br><br><h3>  Alternative with DR </h3><br><img src="https://habrastorage.org/webt/90/zb/pk/90zbpkhak2hyp6hfmmt4afea1mo.png"><br><br>  There is software with an intuitively memorable name - VMware vCloud Availability for Cloud-to-Cloud DR. <br><br>  This is a system for creating an identical VM on a remote site once, relatively speaking, in 15 minutes.  To her, on an insulating tape, the presentation system of all of this is correctly attached to the mechanisms for managing the cloud. <br><br>  That is, VMware Replication technology is in the backend.  In case of a failure, we manually launch the DR plan on the second site, it automatically stops attempts to replicate, then registers the VM with vCloud Director, customizes the IP addresses (so that they do not have to be changed on the VM) and starts the VM in the right order.  In our decision to change the addressing is not necessary, we stretch the network to both data centers. <br><br>  Machines are replicated constantly, but not the entire data center, but only the selected ones - critical processes.  It is replicated once in a while, the minimum interval is 15 minutes (this is an ideal case when everything flies and there is a dedicated replication server and a minimum of changes on the VM).  In practice, you have a copy for half an hour or an hour ago.  If something went wrong, then the data that fell into the interval are lost.  15 minutes is a question for the agent who is collecting the new replication.  Veeam say it can take less than 15 minutes, but in fact it is also longer in practice if you do not use the DSS features.  I have not seen on the industrial machine (not on the test), so it was different. <br><br>  For a long time, NetApp, like many other storage vendors, has SnapMirror technology, which allows you to shift replication work from hypervisors to storage systems, and VMware Replication is able to use it. <br><br>  While the replication service runs, the train goes far.  But it is cheap. <br><br>  Why else is cheap - because you can use any storage system from any side (from different manufacturers, different classes), you do not need to allocate in advance a large amount of disks. <br><br>  It is not necessary to allocate a large disk group, within which the moons are cut.  It just takes a place on the local storage system and is applied upon the fact of recording from the virtual machine.  Due to this, the storage space is optimally managed if it is used for other tasks.  And it is used, since we do not provide this service to all customers. <br><br>  Minus - you need to configure replication at the VM level, that is, to control that everything is correctly configured, that this is the machine, to ensure that the replication passes, that there are no errors.  Create DR-plans for each client, conduct their tests. <br><br>  In the first case, the storage system is taken, conditionally, infrastructurally, almost by sector (more precisely, by facilities).  And here one machine may fall off due to the task falling off due to some software reasons related to the bug at high levels or due to accessibility problems.  This happens a little more often than if you take low levels. <br><br>  In the black - DR stores several points.  You can roll back a few snapshots. <br><br>  Outside of the guest OS you need additional software. <br><br>  In order to prokinit all the necessary networks before Vcloud Director, we need the work of our administrator.  In general, all network connectivity in this variant remains on our administrator.  For a cloud client, this means an application that also takes time. <br><br>  Replication is also configured through the application.  Added VM - you need to send a request that you need to replicate it.  Automatically, it will not get into replication tasks.  Need to pay attention to the admin. <br><br><h3>  Difference </h3><br>  As a result, the price may differ by more than twice.  Replication will multiply the cost of disk space by two or more (two full copies + change history), plus something for the service and reservation of computing resources.  In the case of a metrocluster, the cost of space will be multiplied by two, but the space itself will cost significantly more, plus you need to strictly reserve nodes at a remote site.  That is, computing resources should be multiplied by two, we can not dispose of them for something else. <br><br>  In the case of a metro cluster, we can use only the same types of disks, so that there is a complete mirror.  If part of the disks on the main data center are fast, some are slow at 10 thousand revolutions per minute, then an identical configuration is needed.  In the case of replicas, slower disks are possible on the backup site, and this is cheaper due to storage.  But when switching to a reserve, it will be lower in performance.  That is, if it stores something on the SSD in the main cluster and replicates to regular disks, then storage will be much cheaper at the cost of slowing the infrastructure of the reserve. <br><br>  Right now we are choosing what will be included in an earlier release, so we want to consult: can you briefly tell how you organize your DR platforms and what would you like from them in general as a whole? </div><p>Source: <a href="https://habr.com/ru/post/420971/">https://habr.com/ru/post/420971/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420961/index.html">Recruitment of a new level - using Ethereum</a></li>
<li><a href="../420963/index.html">Business analytics: how to abandon Excel without abandoning it</a></li>
<li><a href="../420965/index.html">The six most useful reports from Frontend Conf 2018</a></li>
<li><a href="../420967/index.html">Helping to swim: how to introduce newcomers to a complex project</a></li>
<li><a href="../420969/index.html">Journal "News of Cosmonautics" ceases to exist</a></li>
<li><a href="../420973/index.html">UFW configuration in Ubuntu Server 16.04 using the example of BigBlueButton</a></li>
<li><a href="../420975/index.html">Do not do this in production.</a></li>
<li><a href="../420977/index.html">Tricks QComboBox + QTreeView</a></li>
<li><a href="../420979/index.html">Redux Basics (Text Tutorial, 2nd Edition)</a></li>
<li><a href="../420981/index.html">‚ÄúI can tell you about the common pain of all iOS developers‚Äù - 10 questions for a programmer, issue 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>