<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manipulate pixels on canvas using Javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will look at image management using Javascript and HTML canvas tags. The article is a translation. Original on phpied.com. 

 Pixel manag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manipulate pixels on canvas using Javascript</h1><div class="post__text post__text-html js-mediator-article">  This article will look at image management using Javascript and HTML canvas tags.  The article is a translation.  <a href="http://www.phpied.com/pixel-manipulation-in-canvas/">Original</a> on phpied.com. <br><a name="habracut"></a><br><h4>  Pixel management </h4><br>  The simplest way to process data from an image is to take each pixel and change the value of one or more of its channels: red, green, blue, and alpha (transparency), for brevity we will call them R, G, B, and A. <br>  Example: change some values, for example, change B and G: <br>  It was rgb (100, 50, 30, 255) will become rgb (100, 30, 50, 255) <br>  Manipulation as such can be represented by the simplest callback function.  For the above example: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [r, b, g, <span class="hljs-number"><span class="hljs-number">255</span></span>]; }</code> </pre> <br><br>  Here we ignore the alpha channel, we do not need it and will be set to 255. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/576/ad7/874/576ad787459fb29dc1e73b8c85db9a38.jpg" alt="image"><br><br>  from the original: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd3/bb2/d72/dd3bb2d7255af465e88212ffbb1d4faf.jpg" alt="image"><br><br>  Suppose we want to change the alpha channel and make the image partially transparent.  Then the function will look like: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b, a, factor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [r, g, b, factor]; }</code> </pre> <br><br>  Here we use the variable factor, with which we will set the transparency of the image.  The value of this variable will be returned as an alpha channel: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/136/afc/f3c/136afcf3c8353acab45dca0b8ff49045.jpg" alt="image"><br><br>  and more complex example.  Here we will additionally specify which part of the image to apply transparency: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b, a, factor, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> total = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.original.data.length; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [r, g, b, factor + <span class="hljs-number"><span class="hljs-number">255</span></span> * (total - i) / total]; }</code> </pre> <br><br>  If we make factor = 111, we get: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51e/f9e/fea/51ef9efea146026a692c935b3d8135c0.jpg" alt="image"><br>  this refers to the object we created that could be seen a little.  It stores in itself some of the necessary information, which can be useful, as a considered example. <br><br><h4>  Canvas </h4><br>  Consider the structure of our canvas.  Let's start with the constructor: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanvasImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, src</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     var context = canvas.getContext('2d'); var i = new Image(); var that = this; i.onload = function(){ canvas.width = i.width; canvas.height = i.height; context.drawImage(i, 0, 0, i.width, i.height); //    that.original = that.getData(); }; i.src = src; //  this.context = context; this.image = i; }</span></span></code> </pre> <br><br>  Use this to pass a link to the canvas element somewhere on the page, as well as the url of the image. <br><br>  The image must be in the same domain where its data is being processed: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transformador = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CanvasImage( $(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>), <span class="hljs-string"><span class="hljs-string">'/wp-content/uploads/2008/05/zlati-nathalie.jpg'</span></span> );</code> </pre> <br><br>  The constructor creates a new Image object, and after loading the image is drawn on the canvas.  Then we save some things for the future, such as the context, the image object, and the original image data.  'this' is the same one to which the pixel handler has access in the example above. <br><br>  Further we use 3 simple methods for setting, obtaining and dumping image data from the canvas: <br><br><pre> <code class="javascript hljs">CanvasImage.prototype.getData = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.getImageData(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.image.width, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.image.height); }; CanvasImage.prototype.setData = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.putImageData(data, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }; CanvasImage.prototype.reset = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.original); }</code> </pre> <br><br>  The brain of all processing is the transform () method.  It handles the callback call of the manipulator by pixels and factor, which is essentially the configuration setting for the manipulator.  Then it goes through all the pixels, passes the value of the rdba channel's olddata to the callback function, and uses the returned values ‚Äã‚Äãas newdata.  At the end of the newdata is written to the canvas. <br><br><pre> <code class="javascript hljs">CanvasImage.prototype.transform = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fn, factor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> olddata = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.original; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldpx = olddata.data; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newdata = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context.createImageData(olddata); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newpx = newdata.data <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> len = newpx.length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; len; i += <span class="hljs-number"><span class="hljs-number">4</span></span>) { res = fn.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, oldpx[i], oldpx[i+<span class="hljs-number"><span class="hljs-number">1</span></span>], oldpx[i+<span class="hljs-number"><span class="hljs-number">2</span></span>], oldpx[i+<span class="hljs-number"><span class="hljs-number">3</span></span>], factor, i); newpx[i] = res[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// r newpx[i+1] = res[1]; // g newpx[i+2] = res[2]; // b newpx[i+3] = res[3]; // a } this.setData(newdata); };</span></span></code> </pre> <br><br>  Pretty simple, isn't it?  The only embarrassing moment should be the increment i + = 4 in the cycle.  Data is returned via getImageData (). Data as an array with 4 elements for each pixel. <br><br>  Suppose the image has only 2 pixels: red and blue, and there is no transparency.  Then the data for this image looks like: <br><br><pre> <code class="javascript hljs">[ <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span> ]</code> </pre> <br><br><h4>  Callback </h4><br>  The following code simply shows the various options for the callback function, and creates a UI to use them.  Consider a few of them: <br><br><h5>  Grayscale </h5><br>  Grayscale is an equal amount of red, blue, green.  The easiest way to achieve this is to calculate the average value: <br>  var agv = (r + g + b) / 3; <br>  That is quite enough.  But there is a secret formula for processing photos with people, it sets a different sensitivity for channels: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> avg = <span class="hljs-number"><span class="hljs-number">0.3</span></span> * r + <span class="hljs-number"><span class="hljs-number">0.59</span></span> * g + <span class="hljs-number"><span class="hljs-number">0.11</span></span> * b; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [avg, avg, avg, <span class="hljs-number"><span class="hljs-number">255</span></span>]; }</code> </pre> <br><br><img src="http://www.phpied.com/files/canvas/grey.jpg" alt="image"><br><br><h5>  Sepia </h5><br>  The simplest option: make a gray version and add a little color to it - an equal amount of rgb for each pixel.  I added 100 red, 50 green, but you can choose other values. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> avg = <span class="hljs-number"><span class="hljs-number">0.3</span></span> * r + <span class="hljs-number"><span class="hljs-number">0.59</span></span> * g + <span class="hljs-number"><span class="hljs-number">0.11</span></span> * b; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [avg + <span class="hljs-number"><span class="hljs-number">100</span></span>, avg + <span class="hljs-number"><span class="hljs-number">50</span></span>, avg, <span class="hljs-number"><span class="hljs-number">255</span></span>]; }</code> </pre> <br><br><img src="http://www.phpied.com/files/canvas/sepia.jpg" alt="image"><br><br>  Here is another option that may be better, but I don‚Äôt really like it: <br><br><img src="http://www.phpied.com/files/canvas/sepia2.jpg" alt="image"><br><br><h5>  Negative </h5><br>  Subtract the value of each channel from 255 to get negative <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-number"><span class="hljs-number">255</span></span> - r, <span class="hljs-number"><span class="hljs-number">255</span></span> - g, <span class="hljs-number"><span class="hljs-number">255</span></span> - b, <span class="hljs-number"><span class="hljs-number">255</span></span>]; }</code> </pre> <br><br><img src="http://www.phpied.com/files/canvas/invert.jpg" alt="image"><br><br><h5>  Noises </h5><br>  Add noise.  This is just fun, take a random value between ‚Äìfactor and factor and add it to each channel: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b, a, factor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rand = (<span class="hljs-number"><span class="hljs-number">0.5</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random()) * factor; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [r + rand, g + rand, b + rand, <span class="hljs-number"><span class="hljs-number">255</span></span>]; }</code> </pre> <br><img src="http://www.phpied.com/files/canvas/noise55.jpg" alt="image"><br><br><h4>  Your turn </h4><br>  The example itself is published by <a href="http://www.phpied.com/files/canvas/pixels.html">reference</a> .  Some of the manipulations are suggested to consider independently, using the source code and imagination. <br>  As a template, we take the following: <br><br><pre> <code class="javascript hljs">transformador.transform(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">r, g, b, a, factor, i</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ... return [r, g, b, a]; });</span></span></code> </pre> <br><br>  Try, for example, to make the image black and white (not grayscale, but black and white, where each pixel is either 0.0.0 or 255.255.255). <br><br>  Or come up with some interesting example. </div><p>Source: <a href="https://habr.com/ru/post/145816/">https://habr.com/ru/post/145816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145811/index.html">Pivot 360 or what solutions we used. Part 1</a></li>
<li><a href="../145812/index.html">QML and QtQuick Webinars: User Interface Paging</a></li>
<li><a href="../145813/index.html">Gentee programming language</a></li>
<li><a href="../145814/index.html">American dream startup LinguaLeo comes true! Runa Capital has invested $ 3,000,000 in a service for learning foreign languages!</a></li>
<li><a href="../145815/index.html">Microsoft is negotiating the purchase of Yammer for a billion dollars</a></li>
<li><a href="../145817/index.html">Folding for JavaScript objects in TextMate</a></li>
<li><a href="../145818/index.html">How to enable new YouTube design</a></li>
<li><a href="../145820/index.html">Rainbow tables at home</a></li>
<li><a href="../145823/index.html">For IE7 users, the online store has introduced a special commission.</a></li>
<li><a href="../145825/index.html">Protect user passwords on your site with Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>