<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web services play poker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr. 

 I am very attracted to sports programming, and I also love poker. So I decided to kill two birds with one stone by running the poker b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web services play poker</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/655/891/e48/655891e488833f9cdc53856ee1c47851.png" alt="image" align="left">  Hello, Habr. <br><br>  I am very attracted to sports programming, and I also love poker.  So I decided to kill two birds with one stone by running the poker bots tournament. <br><br>  Unlike other similar events, the participant's program can be implemented as a web service with which the croupier will communicate via HTTP. <br><br clear="all">  The original idea of ‚Äã‚Äãthe project belongs to my friend (he is not from Habr).  The first time it sounded like this: <br><blockquote>  I believe that there is nothing wrong with bots playing in poker rooms.  Although, maybe, it would be more honest to organize a special poker club where robots would play only with each other.  So I would love to write such a bot.  And you? <br></blockquote>  I do not remember what I said.  It was more interesting for me to make such a service.  Challenge accepted;) <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Engine </h2><br>  The amusing picture just above indicates the main components of the system and their connections with each other.  A separate comment is required for the part related to the poker engine.  I could not find a suitable ready-made engine, so I wrote a small (~ 1000 lines) python-package that implements the logic of the poker croupier and communication with bots.  A simple unix-style interface is added to the package for generating poker hands and conducting them directly. <br><br>  The engine "does not know anything" about the logic of the tournament, the user database, etc.  He acts exclusively in the role of "croupier" and returns the result of his work in the form of XML containing the final state of the distribution. <br><br>  This implementation makes it possible to use the same engine both inside the poker room and on the user's computer during the development / testing of the bot (what I call the SDK).  This ensures that the bot will be in the same conditions on the user's test lab and during a real tournament game, as well as reducing code duplication. <br><br>  The source code of the engine is <a href="https://github.com/robopoker/robopoker">published</a> on GitHab (MIT license).  For use in the form of an SDK for Windows, an exe-file with python-interpreter enabled is built (using <a href="http://www.py2exe.org/">py2exe</a> ).  Under Linux and Mac, the SDK comes in source and uses the interpreter installed (by default) in the operating system. <br><br>  In the current implementation, the engine supports only one version of poker - ‚ÄúTexas hold'em‚Äù with fixed bets.  Judging by <a href="http://en.wikipedia.org/wiki/Holdem">Wikipedia</a> , this is one of the most popular poker games in the world. <br><br>  I did not do the SDK as a web service so that the user could run the system completely locally.  Thus, you can write hundreds of regression tests on the bot and run them very quickly, even after each change.  Moreover, to implement such a scenario, you do not need to patch the sources or write your own interface to the engine - everything works out of the "by design" box. <br><br>  The tests themselves are written easily and pleasantly thanks to the stateless API. <br><br><h2>  API </h2><br>  If I have a choice, I almost always make a stateless API.  In this case, this choice was not so obvious, because  It is necessary to transfer the bot's entire distribution history to the bot (this is the minimum necessary information for making a decision). <br><br>  Currently, this information (I call it the ‚Äústate‚Äù of distribution) is transmitted to the bot in XML format using an HTTP POST request.  In the worst case, this XML can weigh up to 4K.  It‚Äôs a lot or a little to judge you, but this is the price I‚Äôm willing to pay to simplify the bot development process and lower the entry threshold for new members. <br><br>  Development is really quite simple - the participant simply needs to write a program that parses some XML, analyzes the situation described in it and makes a certain decision (pass, support, increase, go all-in, etc.). <br><br>  The XML document schema had to be developed independently. <br><br><h3>  Example </h3><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">game</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">button</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">player</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vbo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"80"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">in_stack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">player</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lenny"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"80"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">in_stack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">player</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">sit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"psycho"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"90"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">in_stack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">posts</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"psycho"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"small_blind"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vbo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"big_blind"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">posts</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">betting</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">round</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preflop"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lenny"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"call"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"psycho"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fold"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vbo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"check"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">round</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">round</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flop"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vbo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"check"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">amount</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">player</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lenny"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"check"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">round</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">round</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"turn"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">round</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"river"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">betting</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">community</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">suit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"H"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"A"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">suit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"H"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">suit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rank</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"T"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">suit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">community</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">game</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This scheme seems to me to be quite simple for a person to understand (including due to easy redundancy, for example, // player / @ stack) and a convenient robot for analysis.  In addition, I plan in the near future to make a JSON version of the scheme - as you like. <br><br>  For the internal presentation of the distribution engine uses an extended version of the scheme, where there is a deck, for each bot its transport is specified (URL, etc.), pocket cards, etc.  The final state of distribution also includes the showdown node, which makes it clear which player won and which cards he had (if he had to open up).  In the current implementation, only the bot author sees the final distribution state when he views the game statistics on the poker room site. <br><br>  All other information is transmitted (in the case of HTTP transport) in separate fields of the POST request.  This is done so that you can write a simple bot without parsing XML at all.  Moreover, such an implementation makes writing tests more convenient - a test bot may not parse XML at all and act, for example, randomly or following a simple algorithm (in the spirit of "check / call any" or "bet / raise good cards"). <br><br>  For this, the ‚Äúcroupier‚Äù also gives the bot a list of actions that it is possible to perform in this situation.  If a bot performs an action that is not in this list, its response is considered as fold, and the response text (usually, this is a trace trace of exceptions) is recorded in the logs on the side of the poker room.  At the moment, I myself am reading these logs and writing to the participant an email if the bot breaks.  Of course, in the very near future this process will be automated;) <br><br><h2>  Tournament </h2><br>  In sports programming contests, the following always upsets me: <br><br><ul><li>  They do not start on time. <br>  For example, last weekend before launching a large project at work. </li><li>  They end at the most interesting moment. <br>  For example, when I came up with a brilliant idea that would make my program well, quite amazing. </li></ul><br>  Therefore, from the very beginning I decided to make the main contest ‚Äúendless‚Äù.  Imagine a real online poker club for people.  You can come there at any time, <strike>throw some money,</strike> sit at the table and have a great time.  You can improve your skills and sit down at tables with higher stakes, or you can just have fun playing ‚Äúcandy wrappers‚Äù in your free time. <br><br>  Of course, I wouldn‚Äôt do something like that right away, only for robots, I wouldn‚Äôt - it would be very disappointing, for example, after six months of development, to realize that the service has a very high entry threshold and I play there in splendid isolation. <br><br>  Therefore, for starters, I launched something like a sandbox - a poker bots tournament that I can join at any time and get an idea of ‚Äã‚Äãthe level of my program compared to other participants. <br><br>  At the beginning of each day, the poker room makes a rating of the participants of the tournament, based on the amount of "money" that they managed to win (or had to lose) for the previous day.  After that, the balance of each user is set to zero and the competition starts from the beginning.  As part of the competition, the poker room tries to ensure that all the bots are constantly playing, and, if possible, with various rivals.  In the current implementation, the following rules are used for this: <br><br><ul><li>  If the bot is free, it immediately sits down at the first available table.  At the same time, priority is given to tables at which the bot has long (or never) sat at the tables with the least number of players. </li><li>  The bot gets up from the table as soon as it loses or plays more than N hands with it.  The last rule applies to equal rivals not playing with each other ad infinitum. </li><li>  The poker room supports the "optimal" number of open tables - so that everyone has enough and there are still places where you can change after the fakap.  This number is linearly dependent on the number of active players. </li></ul><br>  Algorithms that implement these rules (in the diagram this is the ‚ÄúTournament worker‚Äù) work in parallel, asynchronously and completely independently.  This ensures uniformity of the load on the machine and the constancy of the number of hands per unit of time.  Also, this architecture makes the system more scalable. <br><br>  Workers, like the site, are implemented in PHP (I have more experience here than in python) and work with the PostgreSQL database.  To ensure parallel processing of the queue of tables, <a href="http://www.postgresql.org/docs/9.1/interactive/functions-admin.html">pg_try_advisory_lock is</a> used when selecting candidates.  I can not vouch that this method is the most correct, t.ch.  I will be glad to discuss this issue in the comments. <br><br><h2>  Plans </h2><br>  I still do not see the point of putting the source of the poker room in open access - the code turned out not too complicated and too tied to the project.  Instead, I will focus on improving the ‚Äúengine‚Äù (for example, adding support for no-limit poker), implementing the API for ‚Äúlearning‚Äù bots (i.e., to get the results of past games), as well as developing a new type of game in which participants separate API will be able to manage seating at the tables and leave the table as needed.  In general, be able to behave almost like people. <br><br>  Also, I plan to reduce the threshold for entry for beginners (or simply far from the web) programmers - to give the opportunity to develop a bot directly in a browser in a language like CoffeeScript and test it through a special web interface.  It would be great to make some visual editor of the algorithm.  Of course, he does not have to give absolute opportunities, but this will allow even non-programmers to use the service, which is very useful.  At the moment I have no idea how to make such an editor, t.ch.  If you have them, please post in the comments. <br><br>  The project is done "just for fun", t.ch.  The deadlines for the implementation of all these ‚Äúcows‚Äù to publish is useless.  Judging by the git log, I started doing the current implementation in early February.  From this we can draw conclusions about my speed. <br><br>  If the reader is interested in playing, the beta version of the poker room works <a href="http://robopoker.org/">here</a> .  And on youtube, you can watch a <a href="http://www.youtube.com/watch%3Fv%3DIUw23bE2bXY">short video</a> on how to make a simple PHP bot, test it and register it in a tournament. <br><br>  <b>UPD [05.31.2013]</b> The project was frozen a few months after the post was published.  The reason is that in spite of the positive feedback from the community, only a few dozen real users have appeared at the service, and they very quickly stopped updating their solution.  If you would be interested to resume the project, write to me in the LAN, I would be happy to give it in good hands. </div><p>Source: <a href="https://habr.com/ru/post/140602/">https://habr.com/ru/post/140602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140594/index.html">Blur js</a></li>
<li><a href="../140596/index.html">Portion of servers please, or how to start deployment with Opscode Chef</a></li>
<li><a href="../140599/index.html">Oldfag Festival continues - Baldur's Gate will be released on the iPad</a></li>
<li><a href="../140600/index.html">Report on the 5th Kiev Habravstreche</a></li>
<li><a href="../140601/index.html">A brief glossary of basic terms for a start-up community, or 33 trendy words for public interactions</a></li>
<li><a href="../140603/index.html">Frustro: impossible font</a></li>
<li><a href="../140604/index.html">Hitachi Kokusai Electric has developed a new face recognition system.</a></li>
<li><a href="../140605/index.html">Full archive of Einstein's manuscripts</a></li>
<li><a href="../140607/index.html">17 "TFT: floor to table</a></li>
<li><a href="../140609/index.html">Differences in the design of applications iPad and Metro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>