<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Script to monitor the status of hosts on the network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work as an admin and in my area of ‚Äã‚Äãresponsibility there are a number of servers: routers, database servers, terminal servers, etc. And I want to b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Script to monitor the status of hosts on the network</h1><div class="post__text post__text-html js-mediator-article"> I work as an admin and in my area of ‚Äã‚Äãresponsibility there are a number of servers: routers, database servers, terminal servers, etc.  And I want to be aware if some of the servers suddenly disappeared from the network - a link with a remote network fell somewhere, a textbook case with technicals, a mop and cable suddenly happened somewhere, some force majeure happened.  And at the same time I do not want to bother with heavy monitoring systems, like Zabbix. <br><a name="habracut"></a><br>  I want to share with the community my script for timely notification of the missing connection with the servers.  The script is written in Perl and revolves on my desktop in a Debian GNU / Linux environment.  Most likely, no extra sit-ups will be launched in another Linux distribution. <br>  So, the script with comments: <br><pre> <code class="hljs mel">#!/usr/bin/perl #  : use strict; #    . use Net::Ping::External qw(ping); #    ICMP- #  : my $tries = <span class="hljs-number"><span class="hljs-number">3</span></span>; #      my $timeout = <span class="hljs-number"><span class="hljs-number">5</span></span>; #   my $interval = <span class="hljs-number"><span class="hljs-number">5</span></span>; #    # -    .    =&gt;    my %hosts = ( <span class="hljs-string"><span class="hljs-string">"HOST-1"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"10.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"HOST-2"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"10.0.0.2"</span></span> ); # , ,   #   ,       my %state = (); #      <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (my ($name, $ip) = each(%hosts)) { $state{$name} = <span class="hljs-string"><span class="hljs-string">"UP"</span></span>; } #    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> () { #         my @uphosts = (); my @downhosts = (); #        <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (my ($name, $ip) = each(%hosts)) { #      my $cnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; #    ,       <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (my $i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt;= $tries; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ping(hostname =&gt; $ip, timeout =&gt; $timeout)) { $cnt++; } } #      ,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($cnt == <span class="hljs-number"><span class="hljs-number">0</span></span>) { #      ,       ,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($state{$name} eq <span class="hljs-string"><span class="hljs-string">"UP"</span></span>) { $state{$name} = <span class="hljs-string"><span class="hljs-string">"DOWN"</span></span>; push(@downhosts, $name); } #        -   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { #     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($state{$name} eq <span class="hljs-string"><span class="hljs-string">"DOWN"</span></span>) { $state{$name} = <span class="hljs-string"><span class="hljs-string">"UP"</span></span>; push(@uphosts, $name); } } } #  ,   ,      , #    libnotify <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (scalar(@uphosts) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { my $lst = join(<span class="hljs-string"><span class="hljs-string">", "</span></span>, @uphosts); <span class="hljs-string"><span class="hljs-string">`notify-send -u normal NetMon "Hosts becomes up: $lst"`</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (scalar(@downhosts) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { my $lst = join(<span class="hljs-string"><span class="hljs-string">", "</span></span>, @downhosts); <span class="hljs-string"><span class="hljs-string">`notify-send -u critical NetMon "Hosts becomes down: $lst"`</span></span>; } #     sleep($interval * <span class="hljs-number"><span class="hljs-number">60</span></span>); };</code> </pre><br><br>  Now reservations on the script. <br>  Pearl, and specifically Net: Ping has a feature.  If you use the integrated Net :: Ping pearl-barley module with ICMP ping type, you need root privileges.  This is due to the implementation of ICMP ping in this module via RAW sockets, which only root can use.  Therefore, I used Net :: Ping :: External in this script, which implements ping via external calls. <br>  In addition to notifying the administrator with pop-up notifies, you can add, for example, recording information about falls-raises to a text log (yours or via syslog), you can send messages to soap, to jabber, SMS to phone, etc.  Full flight for fantasy. <br>  Until the heap, you can add a check for liveliness of services, such as web, mail, FTP, samba.  But it will already go beyond the bounds of a simple ping baler and will be similar to heavy monitoring systems. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/66142/">https://habr.com/ru/post/66142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66125/index.html">TAG_ADD Plugin</a></li>
<li><a href="../66127/index.html">Sync your bookmarks in Google Chrome</a></li>
<li><a href="../66128/index.html">Suddenly. Fx 3.5.2</a></li>
<li><a href="../66134/index.html">Promo site - to make simple, but impressive</a></li>
<li><a href="../66138/index.html">The fake ATM on DEFCON was clearly set by funny criminals</a></li>
<li><a href="../66145/index.html">One character price per vulnerability</a></li>
<li><a href="../66146/index.html">7 zip icons</a></li>
<li><a href="../66148/index.html">Windows Mobile 6.5 - to the masses. Windows Mobile 7 - for geeks</a></li>
<li><a href="../66149/index.html">User error</a></li>
<li><a href="../66151/index.html">Partitioning tables in mySQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>