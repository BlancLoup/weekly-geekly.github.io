<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use GYP to build a C / C ++ project.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 On Habr√© , the system for generating build scripts and CMake project files has been mentioned several times . The system is quite popul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use GYP to build a C / C ++ project.</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  On Habr√© <a href="http://habrahabr.ru/post/155467/">, the</a> system for generating build scripts and <a href="http://cmake.org/">CMake</a> project files <a href="http://habrahabr.ru/post/155467/">has</a> <a href="http://habrahabr.ru/post/133512/">been</a> mentioned <a href="http://habrahabr.ru/post/155397/">several</a> <a href="http://habrahabr.ru/post/133512/">times</a> .  The system is quite popular and well documented.  Not everyone knows that there is a good alternative to this (certainly wonderful) system.  Yes, this article is about the Generate Your Project (GYP) project. <br><br><h4>  Prehistory </h4><br>  <a href="http://code.google.com/p/gyp/">GYP was</a> developed to build a specific project - the Chrome / Chromium browser.  The decision to develop their own tools caused a lot of controversy, many did not understand (perhaps still do not understand) why reinvent their own ‚Äúbicycle‚Äù.  Nevertheless, GYP has become quite a popular tool, and now it is used outside of the Chromium infrastructure, for example, for assembling V8 and native NodeJS modules. <br><a name="habracut"></a><br><h4>  Similarities with and differences from CMake </h4><br>  The creators of GYP pursued virtually the same goal as the authors of CMake: to implement a cross-platform system that allows describing the build process with high-level language suitable for generating various design files and scripts for build systems.  GYP currently supports <a href="http://www.gnu.org/software/make/">GNU make</a> , <a href="http://www.scons.org/">SCons</a> , <a href="http://martine.github.com/ninja/">Ninja</a> , Eclipse (CDT), VisualStudio, and Xcode. <br><br>  The main differences between GYP and CMake (in my opinion): <br><ul><li>  Much more pleasant and understandable language describing the project structure.  Please note that the GYP file defines the structure, and does not describe the sequence of actions as <i>CMakeLists.txt</i> .  Everything is very intuitive and declarative.  In addition, this format is very convenient for automated processing and analysis. </li><li>  Convenient tools for the composition of projects from individual modules.  A goal declared in a GYP file may declare as a dependency the goals of other GYP files. </li><li>  Tighter integration with IDE features.  GYP allows you to declare properties of goals that will be taken into account, for example, only for VS projects, and ignored for other project files. </li><li>  GYP is implemented in Python and has a fairly compact, structured and readable source code (which is hard for me to say about CMake).  If I, for example, need to implement a generator of a new type of project files (stubs for <a href="http://cedet.sourceforge.net/ede.shtml">EDE</a> , for example), without hesitation I would prefer GYP as the base. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Those who want to learn about the differences between GYP and CMake first-hand can visit the corresponding page on the official <a href="http://code.google.com/p/gyp/wiki/GypVsCMake">Wiki</a> .  You can also find a link to the mailing list with a hot exchange of developers. <br><br><h4>  Installation </h4><br>  Installation will require Python, preferably version 2.6 or higher.  Linux users will most likely not need to install it, Windows users can access <a href="http://www.activestate.com/activepython/downloads">ActivePython</a> or download the distribution from the <a href="http://python.org/download/">official Python website</a> . <br><br>  I prefer to use the latest version of GYP from the <a href="http://gyp.googlecode.com/svn/trunk/">official repository</a> .  To install from source code, go to the source directory and execute the <code>sudo python setup.py install</code> command.  If you do not want to install GYP globally with administrator rights, you can simply add a directory with GYP sources in the PATH environment variable. <br><br>  Popular Linux distributions often have the <code>gyp</code> package in the standard repository (perhaps not the latest version). <br><br>  I also like the approach of the V8 authors who checkout a specific tested version of GYP into the <code>build</code> subdirectory and use this version to generate Makefiles for various platforms. <br><br>  For <i>Emacs</i> users, a <a href="">plugin</a> for editing GYP files may be useful. <br><br>  It so happened that Linux is installed on my machine, so further narration will occur from the point of view of a Linux user who is tolerant of users of other systems and respecting their needs. <br><br><h4>  We assemble a self-contained module </h4><br>  So, it is time to show the tool in action.  I think very few people are interested in demonstration using an example like ‚ÄúHello World‚Äù, so first we will describe the configuration for building some useful module, for example, for the <a href="http://code.google.com/p/googletest/">GTest</a> library (for which the CMake script comes with, so GTest is twice as useful as a sample : a curious reader will be able to evaluate the readability of both specifications and choose the tool that he likes more). <br><br>  Below is a somewhat simplified and trimmed version of the specification <a href="">located in the Chromium repository</a> . <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'targets'</span></span>: [ <span class="hljs-comment"><span class="hljs-comment"># &lt;-   #   { 'target_name': 'gtest', # &lt;-   'cflags': ['-pthread'], # &lt;-   'link_settings': { # &lt;-   'libraries': ['-lpthread'] # &lt;-    }, 'type': 'static_library', # &lt;-  ,   static_library, # shared_library, executable, none 'standalone_static_library': 1, # &lt;-     thin archive #        GYP 'sources': [ # &lt;-    'include/gtest/gtest-death-test.h', 'include/gtest/gtest-message.h', 'include/gtest/gtest-param-test.h', 'include/gtest/gtest-printers.h', 'include/gtest/gtest-spi.h', 'include/gtest/gtest-test-part.h', 'include/gtest/gtest-typed-test.h', 'include/gtest/gtest.h', 'include/gtest/gtest_pred_impl.h', 'include/gtest/internal/gtest-death-test-internal.h', 'include/gtest/internal/gtest-filepath.h', 'include/gtest/internal/gtest-internal.h', 'include/gtest/internal/gtest-linked_ptr.h', 'include/gtest/internal/gtest-param-util-generated.h', 'include/gtest/internal/gtest-param-util.h', 'include/gtest/internal/gtest-port.h', 'include/gtest/internal/gtest-string.h', 'include/gtest/internal/gtest-tuple.h', 'include/gtest/internal/gtest-type-util.h', 'src/gtest-all.cc', 'src/gtest-death-test.cc', 'src/gtest-filepath.cc', 'src/gtest-internal-inl.h', 'src/gtest-port.cc', 'src/gtest-printers.cc', 'src/gtest-test-part.cc', 'src/gtest-typed-test.cc', 'src/gtest.cc', ], 'sources!': [ # &lt;-     , 'src/gtest-all.cc', #      ], #  conditions 'include_dirs': [ # &lt;-      '.', './include', ], 'conditions': [ # &lt;-   ,   ['OS == "linux"', { #     'defines': [ 'GTEST_HAS_RTTI=0', ], 'direct_dependent_settings': { 'defines': [ 'GTEST_HAS_RTTI=0', ], }, }], ['OS=="win" and (MSVS_VERSION=="2012" or MSVS_VERSION=="2012e")', { 'defines': [ '_VARIADIC_MAX=10', ], 'direct_dependent_settings': { 'defines': [ '_VARIADIC_MAX=10', ], }, }], ], 'direct_dependent_settings': { # &lt;- ,     , #   gtest , . .   'defines': [ # &lt;-   'UNIT_TEST', ], 'include_dirs': [ # &lt;-     include  'include', #     , ], #     ,  #  &lt;/path/to/this/gypfile&gt;/include 'msvs_disabled_warnings': [4800], }, }, #   { 'target_name': 'gtest_main', 'type': 'static_library', 'standalone_static_library': 1, 'dependencies': ['gtest'], # &lt;-   ,    #      'sources': [ 'src/gtest_main.cc', ], }, ], }</span></span></code> </pre> <br>  I think this specification will seem quite transparent to many (with the possible exception of the conditional sections). <br><br>  The need to list all the files with the source code is immediately apparent.  This may seem tedious and overly verbose.  GYP does not support the <code>GLOB</code> analog from CMake; moreover, this feature was not consciously realized.  According to the developers, the lack of <code>GLOB</code> reduces the likelihood of errors and increases the "tightness" and reproducibility of assemblies. <br><br>  Header files also need to be included in the source list, otherwise they simply will not be visible when generating Visual Studio projects. <br><br>  To complete the build, just run the following commands: <br><pre> <code class="bash hljs">gyp --depth=. gtest.gyp <span class="hljs-comment"><span class="hljs-comment">#  Makefile make #  make</span></span></code> </pre> <br>  After modifying the <i>gtest.gyp</i> file <i>, the</i> <i>Makefile</i> will be automatically regenerated the next time <code>make</code> started. <br><br>  The artifacts obtained as a result of the assembly can be found in the subdirectories of the <i>out / BUILDTYPE directory</i> , by default it is <i>out / Default</i> . <br><br>  <b>Note</b> : The generator of project files is selected depending on the operating system (msvs for Windows, make for Linux, xcode for Mac) and the environment variable GYP <sub>GENERATORS</sub> , the latter taking precedence.  To start a specific generator (or several at once), you need to execute a command similar to the following: <br><pre> <code class="hljs pgsql">GYP_GENERATORS=make,scons,eclipse gyp <span class="hljs-comment"><span class="hljs-comment">--depth=. gtest.gyp</span></span></code> </pre> <br><br>  Unfortunately, I have problems with the scons and msvs generators under Linux.  I think it is advisable to use the default generator for your platform (nevertheless, the make generator for Mac should work without problems). <br><br><h5>  Variable substitution </h5><br>  Variable expansion in GYP occurs in two phases: at the ‚Äúearly‚Äù phase, the conditions inside the <code>conditions</code> section are calculated, and the variables declared with the quantifier <code>&lt;</code> ;  on ‚Äúlate‚Äù - calculation of conditions of the section <code>target_conditions</code> and variables with the quantifier <code>&gt;</code> , as well as substitution of the output of external commands <br><br>  For most tasks, variable "early" phase. <br><br>  The variables of the early and late phases differ in the direction of the first character at the place of use: <code>&lt;(var)</code> - the early phase (the arrow points to the left, ie, the calculation occurs earlier on the time scale), <code>&gt;(var)</code> - the late phase (the arrow points to the right). <br><br>  Variable values ‚Äã‚Äãcan be calculated in two different contexts: <br><ul><li>  String context ( <code>&lt;(var)</code> , <code>&gt;(var)</code> ) - the value of the variable is substituted as is. </li><li>  List context ( <code>&lt;@(var)</code> , <code>&gt;@(var)</code> ) - the value of a variable is embedded in the list in which it is calculated (such calculation must necessarily occur inside the list). </li></ul><br><br>  An example of using different contexts: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'variables'</span></span>: { <span class="hljs-string"><span class="hljs-string">'component_type'</span></span>: <span class="hljs-string"><span class="hljs-string">'shared_library'</span></span>, <span class="hljs-string"><span class="hljs-string">'public_api_headers'</span></span>: [ <span class="hljs-string"><span class="hljs-string">'include/mylib.h'</span></span>, <span class="hljs-string"><span class="hljs-string">'include/mylib_extra.h'</span></span>, ], <span class="hljs-string"><span class="hljs-string">'private_headers'</span></span>: [ <span class="hljs-string"><span class="hljs-string">'internals.h'</span></span>, ], }, <span class="hljs-string"><span class="hljs-string">'targets'</span></span>: [ { <span class="hljs-string"><span class="hljs-string">'target_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'mylib'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;(component_type)'</span></span>, <span class="hljs-comment"><span class="hljs-comment"># &lt;-   'include_dirs': ['include'], 'sources': [ '&lt;@(public_api_headers)', # &lt;-  public_api_headers '&lt;@(private_headers)', #  private_headers   'src/impl.cc', #   sources ], }, ], }</span></span></code> </pre><br>  Variables whose value is a list can be calculated in string context.  The result of the calculation will be a string consisting of list elements separated by spaces.  Similarly, a variable whose value is a string can be calculated in list context.  In this case a list will be constructed from it, a space will be used as a separator for the elements. <br><br>  Sometimes it is required that the value of a variable be calculated with the help of an external command, for this purpose the constructions <code>&lt;!(cmd)</code> and <code>&lt;!@(cmd)</code> : <br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">'variables'</span></span> : [ <span class="hljs-string"><span class="hljs-string">'foo'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;!(echo Build Date &lt;!(date))'</span></span>, ],</code> </pre> <br>  For variables, you can set a default value, it will be used, unless otherwise the variable is not defined at the place of use.  The default setting syntax is not particularly intuitive: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'variables'</span></span>: { <span class="hljs-string"><span class="hljs-string">'component_type%'</span></span>: <span class="hljs-string"><span class="hljs-string">'shared_library'</span></span>, <span class="hljs-comment"><span class="hljs-comment"># &lt;-  %     #     } #... }</span></span></code> </pre> <br>  It is also possible to refer to variables defined in the external assembly system.  In the case of <code>make</code> you can use the <i>$</i> sign (for example, <code>$(INCLUDES)</code> ).  Unfortunately, the use of such variables makes the assembly less portable. <br><br><h5>  Conditions </h5><br>  The <code>conditions</code> section allows you to declare parts of the configuration, depending on factors external to the module being assembled.  For example, depending on the target operating system or the desired type of component to be assembled (a statically or dynamically linked library), it is required to change the compilation flags or add / exclude files with source code. <br><br>  If a section condition is met, its declarations will be combined with the goal declarations in which the condition is defined (or with all goals declarations if the condition is declared in the <code>target_conditions</code> section). <br><br>  A simple example: <br><br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'target_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'mylib'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'static_library'</span></span>, <span class="hljs-comment"><span class="hljs-comment"># ... 'conditions': [ ['OS=="linux"', { 'sources': ['linux_extra.cc'], # &lt;-    'defines': ['UNIX=1'], # &lt;-   UNIX   1 }], ], }</span></span></code> </pre> <br>  Conditions are calculated by the Python interpreter using the <code>eval()</code> function with the <code>__builtin__</code> dictionary disabled, therefore, they obey the syntax adopted in Python for evaluating Boolean expressions.  For example, several conditions can be combined with the operators <code>and</code> and <code>or</code> .  A list of predefined variables and more detailed examples can be found on the <a href="http://code.google.com/p/gyp/wiki/InputFormatReference">wiki</a> . <br><br><h5>  Include files </h5><br>  In large projects, it is possible that a part of the declarations must be rewritten in each GYP file.  This can be avoided by using a include file mechanism similar to the <code>#include</code> directive.  In GYP, such a mechanism is implemented as a top-level list of <code>includes</code> : <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'includes'</span></span>: [<span class="hljs-string"><span class="hljs-string">'common.gypi'</span></span>, <span class="hljs-string"><span class="hljs-string">'other.gypi'</span></span>], <span class="hljs-comment"><span class="hljs-comment"># ... }</span></span></code> </pre> <br>  Included GYP files usually have the <code>gypi</code> extension and contain declarations of common variables, build configurations, header files, etc.  All these declarations will be combined with the declarations of the GYP file, which will include the gypi file.  Relative paths used inside the include file are calculated relative to the included file, not the including file. <br><br><h5>  <b>Debug</b> and <b>Release</b> : build configurations </h5><br>  Almost always, for debugging the application and for installing it, the customer requires various assembly parameters.  In debug mode, you want to keep access to the characters for working with the debugger, the customer, it is desirable to deliver a compact, optimized version of the application.  In GYP, this need is reflected in the <code>configurations</code> subsection. <br><br>  Add the following lines to our <i>gtest.gyp</i> : <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'target_defaults'</span></span>: { <span class="hljs-string"><span class="hljs-string">'configurations'</span></span>: { <span class="hljs-string"><span class="hljs-string">'Release'</span></span>: { <span class="hljs-string"><span class="hljs-string">'conditions'</span></span>: [ [<span class="hljs-string"><span class="hljs-string">'OS=="linux"'</span></span>, { <span class="hljs-string"><span class="hljs-string">'cflags'</span></span>: [<span class="hljs-string"><span class="hljs-string">'-O2'</span></span>], <span class="hljs-comment"><span class="hljs-comment">#   }], ], }, 'Debug': { 'conditions': [ ['OS=="linux"', { 'cflags': ['-g', '-O0'], #  ,  }], #    ], }, }, }, 'targets': [ # ... ], }</span></span></code> </pre> <br>  Pay attention to the fact that the <code>configurations</code> section should be nested in the <code>target_defaults</code> section.  If you forget about this, then error messages will most likely not follow, but the configuration will not work. <br><br>  To specify a configuration when building with <code>make</code> , it suffices to define the <code>BUILDTYPE</code> parameter.  For debugging, it is also often useful to see the real commands executed by the build system.  The <code>V</code> (verbose) flag is responsible for this: <br><pre> <code class="bash hljs">make BUILDTYPE=Release V=1</code> </pre> <br>  Of course, you can define an arbitrary number of configurations with arbitrary settings. <br><br>  Now the library is great for use in many other projects, it is enough just to refer to it from the specification of a hierarchical project.  The remaining boring work will take on the GYP.  I think this composition should be considered in more detail, since it is very important in practice. <br><br><h4>  We assemble several modules </h4><br>  The convenience of assembling a project from independent modules is one of the main qualities that a good project management system should have, and GYP is excellent in this respect. <br><br>  As the second module, I chose several functions to verify that the input string matches the simplified regular expressions described in the first chapter of the Beautiful Code book (ISBN-10: 0596510047) (an <a href="http://www.cs.princeton.edu/courses/archive/spr09/cos333/beautiful.html">online version of</a> this chapter is also available). <br><br>  The source code and configuration repository is on <a href="https://github.com/roman-kashitsyn/habr/tree/master/GypIntro/examples">GitHub</a> . <br><br>  The <code>examples</code> directory has two subdirectories: <code>gtest-1.6</code> (component for writing unit tests, discussed above) and <code>mini-regex</code> , our micro-library, which needs independent development and testing.  Here is a GYP file for building the <code>libminiregex.a</code> library, depending on the <code>gtest</code> component: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'includes'</span></span>: [<span class="hljs-string"><span class="hljs-string">'../conf.gypi'</span></span>], <span class="hljs-comment"><span class="hljs-comment"># &lt;-   'targets': [ { 'target_name': 'miniregex', 'type': 'static_library', 'include_dirs': ['include'], 'sources': [ 'include/miniregex.hpp', # &lt;-  'src/miniregex.cpp', # &lt;-  ], 'direct_dependent_settings': { 'include_dirs': ['include'], }, }, { 'target_name': 'miniregex_test', 'type': 'executable', # &lt;-   'dependencies': [ '../gtest-1.6/gtest.gyp:gtest', # &lt;-      '../gtest-1.6/gtest.gyp:gtest_main', #   libminiregex,   'miniregex', ], 'sources': [ 'src/test/test_miniregex.cpp', # &lt;-    ], }, ], }</span></span></code> </pre> <br>  The syntax for specifying dependencies declared in other GYP files deserves some explanation.  To specify such a dependency, it is enough to specify the path to the GYP file and specify the name of the target (or asterisk, which means dependence on all the goals of the file) using a colon. <br><br>  <b>Note</b> : it is very important to remember that when building a project consisting of several modules, all modules must define the appropriate configuration ( <code>Debug</code> , <code>Release</code> , etc.).  In the absence of the required configuration, no warnings will be displayed at the design file layout stage, but when attempting to build, mysterious error messages will most likely be displayed. <br><br>  For demonstration purposes, both modules share a common <i>conf.gypi</i> file containing configuration definitions.  This makes sense if the modules need to be stored in one repository.  Nevertheless, it seems to me a good idea to put independent modules suitable for reuse (our two libraries seem to be good for this) in separate repositories and use them through external links (like <code>svn:externals</code> or <code>git submodule</code> ). <br><br>  To build the <code>mini-regex</code> module, go to the <code>examples</code> directory and execute the familiar commands: <br><pre> <code class="bash hljs">gyp --depth=. mini-regex/miniregex.gyp make</code> </pre> <br>  First, the <code>gtest</code> module libraries will be <code>gtest</code> , then the <code>libminiregex.a</code> library, then the <code>libminiregex.a</code> executable file, which can be found in the <i>out / Debug</i> directory, will be built.  If everything is done correctly, when you run this executable file on the console should appear positive green output GTest. <br><br>  So far, we have connected only two modules, but the approach is well scaled, allowing you to assemble module hierarchies without any problems, encapsulating all the details of assembling each of the modules in your own GYP file, and you can assemble each module independently of the others.  A prominent example of such an architecture is the Chromium project. <br><br><h4>  Actions and Rules </h4><br>  Quite often during the assembly you need to perform some action or non-standard conversion. <br><br>  The actions section is used to define one-time <code>actions</code> , and the <code>rules</code> section is used to define transformations.  Rules can be used to build chains of transformations, in the same way as is implemented in GNU make.  Rules can also be thought of as action patterns. <br><br>  As an implementation, we implement the action for installing libraries and header files of the GTest module: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'target_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'install'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-string"><span class="hljs-string">'dependencies'</span></span>: [<span class="hljs-string"><span class="hljs-string">'gtest'</span></span>, <span class="hljs-string"><span class="hljs-string">'gtest_main'</span></span>], <span class="hljs-comment"><span class="hljs-comment"># &lt;-    #   'actions': [ { 'inputs': [], 'outputs': ['$(LIBRARIES)/libgtest.a', '$(LIBRARIES)/libgtest_main.a'], 'action_name': 'copy_libs', 'action': ['cp', '&lt;(PRODUCT_DIR)/libgtest.a', '&lt;(PRODUCT_DIR)/libgtest_main.a', '$(LIBRARIES)'], 'message': 'Copying libraries', }, { 'inputs': [], 'outputs': ['$(INCLUDES)/gtest', '$(INCLUDES)/gtest/internal'], 'action_name': 'copy_headers', 'action': ['cp', '-R', 'include/gtest', '$(INCLUDES)'], 'message': 'Copying header files', } ], }</span></span></code> </pre> <br>  Here external variables are used, it is assumed that the invoked <code>make</code> will receive the <code>INCLUDES</code> and <code>LIBRARIES</code> via the environment or command line arguments: <br><pre> <code class="bash hljs">gyp --depth=. gtest.gyp <span class="hljs-comment"><span class="hljs-comment">#        sudo make install INCLUDES=/usr/include LIBRARIES=/lib64</span></span></code> </pre> <br>  In my project, I use a similar technique to build RPM packages. <br><br>  An example of a rule is the <code>rst2html</code> rule, which I use to compile documentation from the RST format to the HTML format: <br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">'target_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'docs'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>: <span class="hljs-string"><span class="hljs-string">'none'</span></span>, <span class="hljs-string"><span class="hljs-string">'sources'</span></span>: [ <span class="hljs-string"><span class="hljs-string">'doc/Build.rst'</span></span>, <span class="hljs-string"><span class="hljs-string">'doc/Dictionary.rst'</span></span>, <span class="hljs-string"><span class="hljs-string">'doc/README.rst'</span></span>, ], <span class="hljs-string"><span class="hljs-string">'rules'</span></span>: [{ <span class="hljs-string"><span class="hljs-string">'rule_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'rst2html'</span></span>, <span class="hljs-string"><span class="hljs-string">'extension'</span></span>: <span class="hljs-string"><span class="hljs-string">'rst'</span></span>, <span class="hljs-string"><span class="hljs-string">'inputs'</span></span>: [<span class="hljs-string"><span class="hljs-string">'doc/css/code.css'</span></span>], <span class="hljs-string"><span class="hljs-string">'action'</span></span>: [<span class="hljs-string"><span class="hljs-string">'rst2html.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'--stylesheet-path=doc/css/code.css'</span></span>, <span class="hljs-string"><span class="hljs-string">'--embed-stylesheet'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;(RULE_INPUT_PATH)'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;(PRODUCT_DIR)/Doc/&lt;(RULE_INPUT_ROOT).html'</span></span>], <span class="hljs-string"><span class="hljs-string">'outputs'</span></span>: [<span class="hljs-string"><span class="hljs-string">'&lt;(PRODUCT_DIR)/Doc/&lt;(RULE_INPUT_ROOT).html'</span></span>], <span class="hljs-string"><span class="hljs-string">'message'</span></span>: <span class="hljs-string"><span class="hljs-string">'Compiling RST document &lt;(RULE_INPUT_PATH)'</span></span> \ <span class="hljs-string"><span class="hljs-string">'to HTML &lt;(PRODUCT_DIR)/Doc/&lt;(RULE_INPUT_ROOT).html'</span></span>, }], },</code> </pre> <br>  The <code>extension</code> property specifies the extension of files that fall under the rule, and the list of <code>inputs</code> defines files that are additional dependencies (that is, if they change, you must reapply the rule).  The variable <code>RULE_INPUT_PATH</code> bound to the absolute path of the input file of the action <code>RULE_INPUT_ROOT</code> - to the base of the path of the input file (that is, without an extension).  The rest I think should not cause questions. <br><br>  As you can see from the example, the syntax is quite simple, but the compactness leaves much to be desired.  For comparison, this goal could be implemented like the following <code>make</code> code (of course, this is not the code that GYP generates): <br><pre> <code class="bash hljs">BUILDTYPE ?= Debug PRODUCT_DIR ?= out/$(BUILDTYPE) HTML_OUT := $(PRODUCT_DIR)/Doc RST_DOCS := doc/Build.rst doc/Dictionary.rst doc/README.rst HTML_DOCS := $(patsubst doc/%.rst,$(HTML_OUT)/%.html,$(RST_DOCS)) .PHONY: docs docs: $(HTML_DOCS) <span class="hljs-comment"><span class="hljs-comment"># ,   $(HTML_OUT)/%.html: doc/%.rst doc/css/code.css mkdir -p $(HTML_OUT) rst2html.py --stylesheet-path=../doc/css/code.css \ --embed-stylesheet $&lt; $@</span></span></code> </pre> <br>  It can be seen that the syntax for defining GYP rules is somewhat more verbose than the syntax for <code>make</code> , but perhaps more readable for people not experienced in <code>GNU make</code> . <br><br>  Actions and transformations are usually tried to be implemented using cross-platform tools, usually python scripts. <br><br>  A description of the format of the action declaration and predefined variables can be found on the official wiki ( <a href="http://code.google.com/p/gyp/wiki/GypLanguageSpecification">Actions</a> , <a href="http://code.google.com/p/gyp/wiki/GypLanguageSpecification">Rules</a> ). <br><br><h4>  Out of source build </h4><br>  Those readers who tried running GYP under Linux noticed that, in addition to the desired artifacts neatly stacked in the <i>out</i> directory, GYP creates several makefiles (one or two for each target + one main Makefile) that litter the directories with the original code  I would like these intermediate files to be created in the <i>out</i> directory too.  An example of a solution to this problem can be found in the V8 source code.  It is enough to set the gyp <code>--generator-output</code> option and run <code>make</code> from the directory specified by the option: <br><pre> <code class="bash hljs">gyp --depth=. --generator-output=./out gtest.gyp make -C out</code> </pre> <br><h4>  Conclusion </h4><br>  GYP is a fairly convenient alternative to CMake with its own advantages and disadvantages.       ,    GYP   ,    ,          . <br><br>      ,     .          Chromium  V8.   wiki      GYP-,   ,  ,  . ,         . <br><br><h4>  Resources </h4><br><ul><li>  <a href="https://code.google.com/p/gyp/">Project page</a> </li><li> <a href="http://n8.io/converting-a-c-library-to-gyp/">Converting a C library to gyp</a> </li><li> <a href="http://src.chromium.org/viewvc/chrome/trunk/src/">  Chromium</a> </li><li> <a href="https://code.google.com/p/v8/source/browse">  V8</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/171697/">https://habr.com/ru/post/171697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171681/index.html">Automatically saving Cisco device configurations</a></li>
<li><a href="../171683/index.html">CeBIT 2013 - iron, girls and continuous disappointments</a></li>
<li><a href="../171689/index.html">Zotac nettop home server</a></li>
<li><a href="../171691/index.html">CeBIT 2013. Day one. Stands Thermaltake, MSI and Biostar</a></li>
<li><a href="../171693/index.html">Work should be a pleasure</a></li>
<li><a href="../171699/index.html">Useful HTML, CSS and JavaScript techniques</a></li>
<li><a href="../171701/index.html">Search for the user's blocking source in Active Ditectory</a></li>
<li><a href="../171703/index.html">Selenium 2.0 - WebDriver. Impressions, problems and tips on using</a></li>
<li><a href="../171705/index.html">Fujitsu LIFEBOOK UH572 Ultrabook Review</a></li>
<li><a href="../171707/index.html">Story about participating in the contest Intel Accelerate Your Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>