<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search on Drupal 7 with Apache Solr Part 1 - Basic Setup</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to write not just another post ‚Äúhow to screw Solr to Drupal‚Äù, but a series of detailed posts starting from the basic setting and ending with th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search on Drupal 7 with Apache Solr Part 1 - Basic Setup</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/b40/a18/047/b40a1804748810d21d6fdd55d0c96bcc.png"><br>  I want to write not just another post ‚Äúhow to screw Solr to Drupal‚Äù, but a series of detailed posts starting from the basic setting and ending with the facets. <br>  Based on your comments and questions, I am ready to include additional material in the next post. <a name="habracut"></a><br><br>  List of articles: <br><ul><li>  Search on Drupal 7 with Apache Solr Part 1 - Basic Setup </li><li>  <a href="http://habrahabr.ru/post/177509/">Search on Drupal 7 using Apache Solr Part 2 - learn how to customize the index</a> </li><li>  <a href="http://habrahabr.ru/post/178285/">Search on Drupal 7 using Apache Solr Part 3 - learn to add your own fields and options to the index</a> </li><li>  <a href="http://habrahabr.ru/post/180083/">Search on Drupal 7 using Apache Solr Part 4 - faceted filters</a> </li><li>  <a href="http://habrahabr.ru/post/182820/">Search on Drupal 7 using Apache Solr Part 5 - widgets for facet filters</a> </li><li>  <a href="http://habrahabr.ru/post/189840/">Search on Drupal 7 using Apache Solr Part 6 - configure apache solr + tomcat</a> </li><li>  <a href="http://habrahabr.ru/post/213085">Search on Drupal 7 using Apache Solr Part 7 - full-text search in Russian</a> </li></ul><br><br>  Several advantages of searching through Apache Solr over regular Drupal searching: <br><ul><li>  Apache Solr search is much faster and does not load the database server </li><li>  flexible search options </li><li>  the site is easier to scale, you can easily place Apache Solr on a nearby server </li><li>  use of facets (refinement search) </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So in the first part we start with the basic settings. <br><br>  Input parameters: <br>  I am using Ubuntu 10.04 OS <br>  I took Drupal 7.22 as a basis and modules for search search_api and search_api_solr <br>  Apache Solr 3.6.1 Search Server <br><br>  The list of modules that need to be downloaded: search_api, search_api_solr, entity, ctools, views <br><br><h4>  1. Install Apache Solr </h4><br>  Download the server from the <a href="http://lucene.apache.org/solr/">official site</a> <br>  There is a newer version of Apache Solr 4.x, but the schema files in the search_api_solr module are only for the third version, so you should use it. <br><br>  Unpack the downloaded archive into any folder convenient for you. <br>  In my case, this is /home/kainz/applications/apache-solr-3.6.1. To start the server, you need Java.  I have the openjdk-6 package installed, you can choose this or any other that suits you. <br><br>  To start the server, go to the Apache Solr directory in the console, and then in the example (in my case, this is /home/kainz/applications/apache-solr-3.6.1/example) and run the <code>java -jar start.jar</code> . <br>  In the case of a successful launch, you will see a bunch of service information and at the very end of the message: <br>  "2013-04-05 00: 27: 09.845: INFO :: Started SocketConnector@0.0.0.0: 8983" or something similar (depends on the version). <br><br>  If you have problems compatibility of new versions of Apache Solr with Drupal modules, you can download the <a href="">server</a> that I used when writing this manual.  It is already up and running. <br><br><h4>  2. Connect Apache Solr to Drupal </h4><br>  First install the <a href="http://drupal.org/project/search_api">search_api</a> and <a href="http://drupal.org/project/search_api_solr">search_api solr</a> modules. <br><br>  I used <a href="">search_api_solr 7.x-1.0-rc2</a> and <a href="">search_api 7.x-1.4</a> <br><br>  In addition to the modules, you need to install the SolrPHPClient library.  Download it <a href="http://code.google.com/p/solr-php-client/downloads/list">here</a> .  The downloaded library must be placed in the sites / all / libraries / SolrPHPClient folder in your Drupal site. <br><br>  Now you need to go to the search_api_solr module and copy two files from there - schema.xml and solrconfig.xml to the folder with server configs (in my case /home/kainz/applications/apache-solr-3.6.1/example/solr/conf).  These files are needed for Drupal to interact with Apache Solr.  After you copy these files, you must restart the server.  Try to go to <a href="http://localhost/">localhost</a> : 8983 / solr / admin / to make sure that the search server is working. <br><br><h4>  3. Customize the search in Drupal </h4><br>  If you have not yet enabled the search_api and search_api_solr modules, then turn them on and clear the cache. <br>  On the admin / config / search / search_api page you can create two entities - a server and an index. <br>  The server serves as a bridge between Drupal and Apache Solr.  It stores settings for accessing the Apache Solr server. <br>  The index allows you to customize the search in a specific way.  You can create multiple indexes for a single server.  For example, different indexes for different types of nodes. <br><br>  So, let's create the admin / config / search / search_api / add_server server <br><br>  As a class of service, select "Solr service".  If you cannot select a class, then make sure that the SolrPHPClient library is installed in the sites / all / libraries / SolrPHPClient and the search_api_solr module is enabled. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44c/2c9/651/44c2c9651d0ee36f9e50f4c21d6931b7.png"><br><br>  Server data such as host, port, and path are suitable for the default installation.  If the server is configured correctly, after submitting the form you will see an informational message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b90/ac5/90d/b90ac590d31c8fea11016b301ae50b51.png"><br><br>  Now create an index - admin / config / search / search_api / add_index.  Let's call it Node index, as a server, choose the Solr server we created.  Index items immediately is a useful option that allows you to index nodes at the time of creation (if you do not select it, then nodes will be indexed by crown). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a3/ef5/4a2/1a3ef54a252092c105e60a29282c2c56.png"><br><br>  The next step is the selection of fields by which we will search.  For now, we‚Äôll select only the title and save the form.  Now we create a view (view) in order to display the search results - admin / structure / views / add.  Before that, you must include the modules search_api_views, views, views_ui and ctools. <br><br>  For search results there is a special type of views for the views module.  Select your index - Node index and create a view with the display page and customize it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a13/b18/146/a13b1814635a9d4a96ff0a370190c313.png"><br><br>  To do this, add the Title and Body fields for output.  Then we will add the contextual filter ‚ÄúSearch: Fulltext search‚Äù and select the Title field in the settings of this filter.  Thus, the search will occur in the Title field.  In addition to this, let's add another exposed filter so that you can enter search arguments through the form. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/751/39d/fb4/75139dfb4a0b7ee12f2f67311bcd219f.png"><br><br>  Save the view.  We start indexing of nodes, if they are not indexed on this page yet admin / config / search / search_api / index / node_index / status.  I created a couple of node articles in advance. <br><br>  Go to the page / search-results - this is the address I indicated for the display with the page type. <br>  All nodes are displayed now, as the keywords are not specified. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/de0/ea8/919/de0ea8919ec0f109ceb80abe6c3743b8.png"><br><br>  This is how keyword search results look like. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00e/9d5/a24/00e9d5a24c7ea57dd5dec6c010c1123a.png"><br><br><h4>  Conclusion </h4><br>  By default, Apache Solr does not look good in Russian.  To fix this, find the lines in the schema.xml file <br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;filter class="solr.SnowballPorterFilterFactory" language="English" protected="protwords.txt"/&gt; --&gt;</span></span></code> </pre><br>  and replace them with <br><pre> <code class="hljs kotlin"><code class="xml">&lt;filter <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">solr</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SnowballPorterFilterFactory</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">language</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Russian</span></span></span><span class="hljs-class">" </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protected</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">protwords</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">txt</span></span></span><span class="hljs-class">"/&gt; </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">   , </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">   </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">          Apache Solr</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">           .           </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">  .       </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">    .</span></span></span></span></code></code> </pre> <code><code class="xml">&lt;filter class="solr.SnowballPorterFilterFactory" language="Russian" protected="protwords.txt"/&gt;</code> <br> <br>   ,    ,           Apache Solr,            .           ,   .       ,     .</code> </div><p>Source: <a href="https://habr.com/ru/post/175527/">https://habr.com/ru/post/175527/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175511/index.html">Technopark Mail.Ru. Start</a></li>
<li><a href="../175517/index.html">Basics of security of the Android operating system. Core level</a></li>
<li><a href="../175521/index.html">The final version of the specification of super-fast RAM is published.</a></li>
<li><a href="../175523/index.html">ZF2: Get db adapter without using service locator</a></li>
<li><a href="../175525/index.html">PostgreSQL update fixes serious vulnerability</a></li>
<li><a href="../175531/index.html">Microsoft released another set of updates, April 2013</a></li>
<li><a href="../175533/index.html">Quadratic equation? Yes, just spit!</a></li>
<li><a href="../175537/index.html">Visual Studio 2012 Update 2 released</a></li>
<li><a href="../175539/index.html">Bitcoin conquers television screens</a></li>
<li><a href="../175541/index.html">25% of the Danish energy sector in 2013 is wind turbines</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>