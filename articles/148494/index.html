<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Macro magic for combining ad and implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the unpleasant problems is that when making even simple changes, you have to edit the code in several places. For example, if a data field is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Macro magic for combining ad and implementation</h1><div class="post__text post__text-html js-mediator-article">  One of the unpleasant problems is that when making even simple changes, you have to edit the code in several places.  For example, if a data field is added to a class, it must be added to the class declaration, initialized in the constructor (s), and if the copy or comparison operators are redefined, so are they.  This takes time and leads to errors, if you forget about one of the places (it is especially unpleasant to forget to initialize, such errors can live for years, and cause unexpected, hard-to-reproduce problems). <br><a name="habracut"></a><br>  Usually, if a class assumes active modification of fields, then a macro is written that takes the implementation of field actions (initialization, copying, serialization, reflection) onto itself. <br>  As a result, the variable must be registered in only two places - declared in the class and implemented (or registered for later use in the implementation). <br><br>  It turns out something like: <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TData</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Number; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Factor; <span class="hljs-function"><span class="hljs-function">BEGIN_FIELDS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FIELD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Number, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FIELD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Factor, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0f</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> END_FIELDS }</span></span>;</code> </pre> <br>  I do not provide implementation of macros, for example, it can be registration of pointers to data fields, their names and initial values ‚Äã‚Äãfor later use. <br><br>  Another example, simpler.  You need to make a reflection of the enumeration, for example, to associate with the enumeration variant a string of its name.  This is usually done something like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TModelType { Car, Weapon, Human }; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> REFLECT_MODEL_TYPE(mac_value) Register(mac_value, #mac_value); void TModelTypeReflection::RegisterTypes() { REFLECT_MODEL_TYPE(Car) REFLECT_MODEL_TYPE(Weapon) REFLECT_MODEL_TYPE(Human) }</span></span></code> </pre><br>  The <b>TModelTypeReflection declaration</b> and the <b>Register</b> implementation will provide the reader with imagination. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For a long time I was content with this state of affairs.  But recently I thought that you can do better, bypassing the only announcement.  This can be done using all the same macros. <br><br>  For the last example, it would look like this: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DECLARE_MODEL_TYPE(mac_value, mac_next) \ mac_value, \ mac_next \ Register(mac_value, #mac_value); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> END_MODEL_TYPE \ }; void TModelTypeReflection::RegisterTypes() { enum TModelType { DECLARE_MODEL_TYPE(Car, DECLARE_MODEL_TYPE(Weapon, DECLARE_MODEL_TYPE(Human, END_MODEL_TYPE))) }</span></span></code> </pre><br>  The <b>DECLARE_MODEL_TYPE</b> macros <b>are</b> expanded first into the enumeration elements, then the code from <b>END_MODEL_TYPE</b> closes the enumeration block and inserts the function header, then the <b>Register</b> calls for the elements are inserted in the function body, only in reverse order, and finally the curly bracket closes the function block (therefore, it also has ). <br>  Similar code can be written for class fields. <br><br>  It remains only to say about the shortcomings: <br><ul><li>  registration in the reverse order, but if the order is still important, you can take this into account in the <b>Register</b> implementation, for example, add the next field to the top of the list, and not to the end; </li><li>  problems with automatic generation of documentation like DOxygen, they won‚Äôt guess how to deploy macros; </li><li>  the need to add one more closing bracket when <b>END_MODEL_TYPE</b> when adding a field.  Unpleasant disadvantage, because  I still have to edit the code in two places.  A little happy that the preprocessor will not allow to forget about the parenthesis. </li></ul><br>  An alternative solution that allows combining an advertisement with an implementation is the use of a code generator, but this approach also has its drawbacks. </div><p>Source: <a href="https://habr.com/ru/post/148494/">https://habr.com/ru/post/148494/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148488/index.html">Increase web application stack security (LAMP virtualization, step 3/6)</a></li>
<li><a href="../148489/index.html">Increase web application stack security (LAMP virtualization, step 4/6)</a></li>
<li><a href="../148490/index.html">Increase web application stack security (LAMP virtualization, step 5/6)</a></li>
<li><a href="../148491/index.html">Increase web application stack security (LAMP virtualization, step 6/6)</a></li>
<li><a href="../148492/index.html">Interaction of web services through REST</a></li>
<li><a href="../148495/index.html">Play box</a></li>
<li><a href="../148496/index.html">Competition for the best A / V testing</a></li>
<li><a href="../148497/index.html">How does Lytro, or another review</a></li>
<li><a href="../148498/index.html">From junior developer to senior</a></li>
<li><a href="../148500/index.html">Homemade budget sub for movie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>