<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We update the message counter Vkontakte without reloading the page</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I use that social network for several reasons, one of which is the ability to exchange text messages (some of my friends don‚Äôt use messengers on princ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We update the message counter Vkontakte without reloading the page</h1><div class="post__text post__text-html js-mediator-article">  I use that social network for several reasons, one of which is the ability to exchange text messages (some of my friends don‚Äôt use messengers on principle, they have to adjust).  I used to constantly update the page to find out about new messages, not so long ago, Vkontakte had an instant messaging service, but I didn‚Äôt immediately like it and decided to automate the process. <br><br>  In this topic, I will talk about my implementation of the My Messages indicator update mechanism without reloading the page.  Want to know more?  Welcome under the cut! <br><a name="habracut"></a><br><h4>  Theory </h4><br>  The script is implemented using <a href="http://ru.wikipedia.org/wiki/JQuery">jQuery</a> and connects to the site using <a href="http://ru.wikipedia.org/wiki/Greasemonkey">Greasemonkey</a> . <br><br>  To begin with, I will tell the principle of action on the fingers: <br><ul><li>  At a certain interval (for myself, I set 20 seconds) load the page with messages using AJAX </li><li>  Find the number of unread messages </li><li>  If the result of point 2 is zero, then change the text of the link to <i>"My Messages"</i> </li><li>  If the re-result is non-zero, then change the text to <i>‚ÄúMy Messages ( <b>N</b> )‚Äù</i> </li></ul><br><h4>  Practice </h4><br>  In order to embed the script on the page, I, as a Firefox user, used the Greasemonkey plugin.  As far as I know, there is a version of Greasemonkey for Google Chrome, Opera itself is able to execute custom scripts, which is called ‚Äúout of the box‚Äù.  I think that adapting my script for Opera and Chromium is a short and simple affair. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order for Greasemonkey to accept our script, it must meet two criteria: <br><ul><li>  The name of the script should be of the form <i>script_name <b>.user.js</b></i> </li><li>  Before the script body, you need to write a heading, if you still do not know how it should be formed, first read <a href="http://habrahabr.ru/blogs/GreaseMonkey/39214/">this topic.</a> </li></ul><br><br>  Headline for our script: <br><pre><code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/ ==UserScript== /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ @name DynamicVK /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ @namespace vk.com/stryaponoff</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/ @description Makes VK dynamic /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ @author stryaponoff /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ @include *vk.com/</span></span>* <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> @include *vkontakte.ru/* <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> @require <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/ajax.googleapis.com/ajax</span></span><span class="hljs-regexp"><span class="hljs-regexp">/libs/jquery</span></span><span class="hljs-regexp"><span class="hljs-regexp">/1.3/jquery</span></span>.min.js /<span class="hljs-regexp"><span class="hljs-regexp">/ ==/</span></span>UserScript==</code> </pre> <br><br>  Then we specify the time interval for checking messages (in milliseconds): <br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-type"><span class="hljs-type">RefreshInterval</span></span> = <span class="hljs-number"><span class="hljs-number">20000</span></span>;</code> </pre><br><br>  For the first time since I became acquainted with JavaScript, I needed to find the number of occurrences of a substring in a string.  What was my surprise when I did not find the corresponding function in JS.  As a result, the following code was born: <br><pre> <code class="hljs go">function SubStrCount(source, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pos = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">len</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; while ((offset = source.indexOf(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, offset + <span class="hljs-number"><span class="hljs-number">1</span></span>)) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">len</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (offset + <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.length) &gt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { count++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count; }</code> </pre><br>  The principle of operation is as follows - we simply find the character that starts the first occurrence of the substring <i>string</i> in the string <i>source</i> .  Increment counter  Then we repeat the same thing, only for the beginning of the search we take not the first character of the <i>source</i> string, but the next immediately after the occurrence found.  And so on until we go through the whole line. <br><br>  Further the most interesting begins - we write the main function of our script: <br><pre> <code class="hljs ruby">function CheckMail() { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       var mail_href = $(<span class="hljs-string"><span class="hljs-string">'#l_msg a'</span></span>).attr(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   AJAX   $.get(mail_href, function(data) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     var NewMessagesCount = SubStrCount(data, <span class="hljs-string"><span class="hljs-string">'read=\\"0\\"'</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       ,  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewMessagesCount != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    <span class="hljs-string"><span class="hljs-string">"  (N)"</span></span> $(<span class="hljs-string"><span class="hljs-string">'#l_msg a'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'  (&lt;b&gt;'</span></span> + NewMessagesCount + <span class="hljs-string"><span class="hljs-string">'&lt;/b&gt;)'</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-string"><span class="hljs-string">" "</span></span> $(<span class="hljs-string"><span class="hljs-string">'#l_msg a'</span></span>).html(<span class="hljs-string"><span class="hljs-string">' '</span></span>); } }); }</code> </pre><br>  The code that comes in response to an AJAX request contains escaped quotes (in particular, the HTML attribute of interest <code>read="0"</code> turns into <code>read=\"0\"</code> ).  Therefore, to find this text, we need to look for it along with slashes, for which we need, in fact, to ‚Äúscreen screening‚Äù :) We <code>read=\\"0\\"</code> . <br><br>  And finally, we need to call our function at the right moment.  After the page loads, we perform it once and set the call repetition interval (let me remind you, in our case - 20 seconds): <br><pre> <code class="hljs javascript">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ CheckMail(); setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ CheckMail() }, RefreshInterval); });</code> </pre><br>  Too often, refreshing the page should not be done either, even if you are not concerned about the moral side of the issue (if updating too often, you create additional load on the server ‚Äî a kind of mini- <a href="http://ru.wikipedia.org/wiki/DoS-%25D0%25B0%25D1%2582%25D0%25B0%25D0%25BA%25D0%25B0">DoS attack</a> ).  If you exceed a certain limit of too frequent requests, requests from you will simply be temporarily blocked. <br><br><h6>  Full script code </h6><br><pre> <code class="hljs lua">// ==UserScript== // @name DynamicVK // @namespace vk.com/stryaponoff // @description Makes VK dynamic // @author stryaponoff // @include *vk.com/* // @include *vkontakte.ru/* // @<span class="hljs-built_in"><span class="hljs-built_in">require</span></span> http://ajax.googleapis.com/ajax/libs/jquery/<span class="hljs-number"><span class="hljs-number">1.3</span></span>/jquery.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>.js // ==/UserScript== var RefreshInterval = <span class="hljs-number"><span class="hljs-number">20000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SubStrCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source, string)</span></span></span></span> { var pos = <span class="hljs-number"><span class="hljs-number">0</span></span>; var count = <span class="hljs-number"><span class="hljs-number">0</span></span>; var offset = <span class="hljs-number"><span class="hljs-number">0</span></span>; var <span class="hljs-built_in"><span class="hljs-built_in">len</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((offset = source.indexOf(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>, offset + <span class="hljs-number"><span class="hljs-number">1</span></span>)) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">len</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (offset + <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.length) &gt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { count++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckMail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var mail_href = $(<span class="hljs-string"><span class="hljs-string">'#l_msg a'</span></span>).attr(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); $.get(mail_href, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span></span> { var NewMessagesCount = SubStrCount(data, <span class="hljs-string"><span class="hljs-string">'read=\\"0\\"'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewMessagesCount != <span class="hljs-number"><span class="hljs-number">0</span></span>) { $(<span class="hljs-string"><span class="hljs-string">'#l_msg a'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'  (&lt;b&gt;'</span></span> + NewMessagesCount + <span class="hljs-string"><span class="hljs-string">'&lt;/b&gt;)'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'#l_msg a'</span></span>).html(<span class="hljs-string"><span class="hljs-string">' '</span></span>); } }); } $(document).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { CheckMail(); setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { CheckMail() }, RefreshInterval); });</code> </pre><br><h6>  Option script without using jQuery </h6>  (preferred option, because it fixed a lot of errors) <br><pre> <code class="hljs lua">// ==UserScript== // @name DynamicVK // @namespace vk.com/stryaponoff // @description Makes VK dynamic // @author stryaponoff // @include *vk.com/* // @include *vkontakte.ru/* // ==/UserScript== var RefreshInterval = <span class="hljs-number"><span class="hljs-number">20000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckMail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //   AJAX- var XmlHttp = new XMLHttpRequest(); //    var MsgCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; //        XmlHttp.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //    ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (XmlHttp.readyState == <span class="hljs-number"><span class="hljs-number">4</span></span>) { //    ,  ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (XmlHttp.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span> == <span class="hljs-number"><span class="hljs-number">200</span></span>) { //     var RegEx = /messages{count=(.*?)}/; MsgCount = RegEx.exec(XmlHttp.responseText)[<span class="hljs-number"><span class="hljs-number">1</span></span>]; //      //         //          var sidebar; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (document.getElementById(<span class="hljs-string"><span class="hljs-string">'side_bar'</span></span>) == null) { sidebar = document.getElementById(<span class="hljs-string"><span class="hljs-string">'sideBar'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { sidebar = document.getElementById(<span class="hljs-string"><span class="hljs-string">'side_bar'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; sidebar.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'a'</span></span>).length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sidebar.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)[i].href.indexOf(<span class="hljs-string"><span class="hljs-string">'mail.php'</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { //  -    ,  ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MsgCount != <span class="hljs-number"><span class="hljs-number">0</span></span>) { //    <span class="hljs-string"><span class="hljs-string">"  (MsgCount)"</span></span> sidebar.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)[i].innerHTML = <span class="hljs-string"><span class="hljs-string">'  &lt;span&gt;(&lt;b&gt;'</span></span> + MsgCount + <span class="hljs-string"><span class="hljs-string">'&lt;/b&gt;)&lt;/span&gt;'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //    <span class="hljs-string"><span class="hljs-string">" "</span></span> sidebar.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'a'</span></span>)[i].innerHTML = <span class="hljs-string"><span class="hljs-string">' '</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } } } //    XmlHttp.<span class="hljs-built_in"><span class="hljs-built_in">open</span></span>(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'/feed.php'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); XmlHttp.send(<span class="hljs-string"><span class="hljs-string">''</span></span>); } CheckMail(); setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { CheckMail() }, RefreshInterval);</code> </pre><br><h4>  Using </h4><br>  In order to use the script in the browser, simply drag the script file ( <i>dynamicvk.user.js</i> ) into the browser window, the following window should appear: <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/ce/33/ce33b5ba72fa05b1f9f843a6cfffc6d9.png"></a> <br>  All that is required of you is to click <i>‚ÄúInstall‚Äù</i> .  You can start to use :) <br><br><h4>  Conclusion </h4><br>  I hope this topic will be useful to someone other than me.  In principle, the wall, invitations to friends and other pages can be updated in the same way, I just described the principle of operation.  I will be glad to hear constructive criticism and comments about this post, so as not to repeat mistakes in the following publications.  I also thank everyone who raised my karma and made the publication of this post possible.  <b>Thank!</b> <br><br>  If someone has any questions or problems - write, try to figure it out.  Thanks for attention! <br></div><p>Source: <a href="https://habr.com/ru/post/111092/">https://habr.com/ru/post/111092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111080/index.html">Step-by-step description of creating a simple application for Samsung Bada</a></li>
<li><a href="../111081/index.html">Instructions (!) For Android firmware in NAND HD2</a></li>
<li><a href="../111088/index.html">Imaginary friends</a></li>
<li><a href="../111089/index.html">Another way to manage event listeners</a></li>
<li><a href="../111090/index.html">Producers, copyright holders and Mosfilm are afraid of free licenses and trying to stop the "revolutionary" amendments to the Civil Code</a></li>
<li><a href="../111095/index.html">A little more about TDD and unit tests.</a></li>
<li><a href="../111100/index.html">Azure. Debugging applications on the 80th port</a></li>
<li><a href="../111102/index.html">Learning to cook: Spring 3 MVC + Spring Security + Hibernate</a></li>
<li><a href="../111103/index.html">Monoblock for the "difficult" user</a></li>
<li><a href="../111105/index.html">Development using the Model-View-ViewModel design pattern on the example of the Twitter client step by step</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>