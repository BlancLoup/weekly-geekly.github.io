<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Oauth 2 provider in 30 minutes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine that one day you decide to connect oauth2 to your project on ruby ‚Äã‚Äãon rails. Since the authentication of most rails applications is now going...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Oauth 2 provider in 30 minutes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/04061670/1f596785/471f274c/989b34dc.jpg" align="right">  Imagine that one day you decide to connect oauth2 to your project on ruby ‚Äã‚Äãon rails.  Since the authentication of most rails applications is now going through <a href="https://github.com/plataformatec/devise">devise</a> , it would be nice to integrate oauth2 with this gem.  Fortunately, everything came up with us, so <a href="https://github.com/socialcast/devise_oauth2_providable">please</a> meet - <a href="https://github.com/socialcast/devise_oauth2_providable">devise_oauth2_providable</a> .  With this gem, integration and testing of an oauth2 provider takes no more time than going to the store. <br><br><a name="habracut"></a><br>  So let's get started.  Edit the gemfile and add the following line there. <br><br><pre><code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'devise_oauth2_providable'</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Run the bundle as usual.  Next, you need to create a clients label where all the data of oauth clients will be stored.  Fortunately, the developers of the heme made sure that we did not have to write the migration with pens <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateOauth2Schema</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Migration </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">up</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Devise::Oauth2Providable::Schema</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">up</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">down</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Devise::Oauth2Providable::Schema</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">down</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  In the model that you want to enable to authenticate through oauth2, add the following line: <br><br><pre> <code class="ruby hljs">devise <span class="hljs-symbol"><span class="hljs-symbol">:oauth2_providable</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:oauth2_refresh_token_grantable</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:oauth2_authorization_code_grantable</span></span></code> </pre> <br>  That's all.  It remains only to test this thing. <br><br>  For this, too, there is a ready-made thing <a href="https://github.com/aganov/devise-oauth2-provider-client">devise-oauth2-provider-client</a> , written in Sinatra. <br><br>  First, let's create a test client in the Client model: <br><br><pre> <code class="ruby hljs">Client.create( <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Sinatra Client"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:redirect_uri</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://localhost:9393/oauth/callback"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:website</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"http://localhost:9393/"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:identifier</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"120094574673767"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:secret</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"b54dc82476af2814e620b86776c42c0e"</span></span> )</code> </pre> <br>  Then we clone the repository and set the gems that the application asks for using the bundle. <br><br>  Next, go to the client folder, edit the get '/ oauth / callback' method.  There will need to correct the line <br><br><pre> <code class="ruby hljs">access_token.get(<span class="hljs-string"><span class="hljs-string">'/me'</span></span>).body</code> </pre> <br>  And zebenit '/ me', on the page that we give the main application after a successful login.  Let this be the main page for the test: <br><br><pre> <code class="ruby hljs">access_token.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>).body</code> </pre> <br>  We start the server: <br><br><pre> <code class="bash hljs">bundle <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> shotgun</code> </pre> <br>  On port 9393, the Sinatra server starts. <br><br>  We go to the <a href="http://localhost:9393/oauth/start">http: // localhost: 9393 / oauth / start page</a> and if everything was done correctly, we will redirect to the 3000th port with the rail application, we confirm access to Sinatra Client, go back already authorized, and the main page of our rail application is shown to us . </div><p>Source: <a href="https://habr.com/ru/post/126753/">https://habr.com/ru/post/126753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126746/index.html">Chinese Twitter, Weibo's service already has 200 million users</a></li>
<li><a href="../126747/index.html">Readme based development</a></li>
<li><a href="../126748/index.html">About computer understanding of text</a></li>
<li><a href="../126750/index.html">Report on the seventh meeting of the Apple Developers Community</a></li>
<li><a href="../126752/index.html">And again about exoskeleton</a></li>
<li><a href="../126755/index.html">Horse racing</a></li>
<li><a href="../126757/index.html">A miracle happened, a friend saved a friend's life</a></li>
<li><a href="../126758/index.html">Ufa group of users of technology of Google, Ufa GTUG is 1 year old!</a></li>
<li><a href="../126760/index.html">Startup Idea - Urban Freelance</a></li>
<li><a href="../126762/index.html">ASUS EEE Pad Transformer Full Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>