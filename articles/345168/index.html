<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to compromise the workflow system in a few clicks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2018 is already on the threshold. But most bearded vulnerabilities continue to live in developed systems. And despite the fact that OWASP Top-10 2017 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to compromise the workflow system in a few clicks</h1><div class="post__text post__text-html js-mediator-article"><p>  2018 is already on the threshold.  But most bearded vulnerabilities continue to live in developed systems.  And despite the fact that <a href="https://www.owasp.org/images/7/72/OWASP_Top_10-2017_%2528en%2529.pdf.pdf">OWASP Top-10 2017 appeared</a> .  And the priority of certain things has changed a lot.  Still nothing prevents to stumble upon situations that were relevant in <a href="https://www.owasp.org/index.php/Top_10_2010-Main">2010</a> . </p><br><img src="https://habrastorage.org/webt/2w/zh/xd/2wzhxdk9jd1zyj24k_p4bybir-y.gif"><br><p><br>  The story began with a commonplace curiosity about the product of the company in which my friend works.  The product is interesting.  They buy this product very thoughtfully and for price tags with 6 characters.  This company has no bug-bounty official.  But I thought that even if I found something, I would pass it through a friend and pass it on. </p><a name="habracut"></a><br><p>  Find the main product of the company was not difficult.  There is an official site with a demo application.  Climbed up there to watch what was there, simultaneously turning all traffic through a proxy into <a href="https://portswigger.net/burp">Burp Suit</a> . </p><br><p>  Seeing the input field, I immediately wanted to stick xss there.  Stuck banal vector </p><br><pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined">alert(xss);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  And what do you think happened?  Of course it worked! </p><br><img src="https://habrastorage.org/webt/vs/zr/24/vszr24dr188mk2ahnau4lt-nofk.png"><br><p><br>  I searched for possible input fields, and my XSS attack was absolutely everywhere.  And no, I'm lying!  In one place for some reason did not work.  But, having spent some time, I was able to overcome it with another payload vector and a screening bypass.  So, on hand there are at least 8 xss vectors.  It was possible to increase this number several times, but it was very lazy to waste time on bypassing the functionality of the system.  Yes, and it was clear that the problem is complex. </p><br><p>  Already wanted to go look, through a friend, responsible for this disgrace.  But I thought that if everything is so bad with shielding, then maybe there is something else.  Postponed a possible contact later and it is useful to still look. </p><br><p>  In the logs there were hints to suspect the application of the ability to implement a CSRF attack.  That is, there were no CSRF tokens that prevent the possibility of such an attack.  To confirm my concerns, I needed a real example.  And in order to treat my comments as responsibly as possible, I needed an example that shows the maximum damage to the system. </p><br><p>  A few words about CSRF, even though you could google <a href="https://www.owasp.org/index.php/Top_10_2010-A5-Cross-Site_Request_Forgery_(CSRF)">it</a> . </p><br><p>  Imagine that you went to the web client of your bank.  And here they send you a link to "funny cats" in contact.  You put aside the card number of the relative you just wanted to transfer money to, and went to have a look at the seals.  The cats were really funny.  And after that you decided to transfer the relative a little bit of money.  When you return to the next tab of the web client of the bank, you are trying to make a transfer, but you don‚Äôt have enough money.  And in your life you will not guess that your gangsters have surrounded your bank account.  These cats pretended to be funny, while their relatives transferred money to your account to cat food and valerian sellers. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1v/fp/nd/1vfpnd5buwqcwmc5k6t2ckg8n8y.jpeg"></div><br><p>  This is a clumsy example.  And, of course, this will not turn out in any bank.  But this example should help you understand the seriousness of the CSRF vulnerability. </p><br><p>  And now without seals and with details. </p><br><p>  In the application under study there is a simple opportunity to logout.  You can check for user logins through csrf.  You say: what's wrong with that, it's not dangerous!  But this is not a vector of attack.  This is just a test of our theory that our idea works. </p><br><p>  For this we needed to build a test site in our subnet as follows. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://example.com/client/api/logout"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Submit request"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Then we log in with another browser.  We open in this browser a test application with an active login session, and in the second tab is our saytik.  Click on our submit button.  Returning to the previous tab with our test applications, we find that they are no longer logged in. </p><br><p>  Once our example has worked, it means that the probability of 80% will work in other places.  20% I left to the fact that the developers in important places use the means of protection against CSRF attacks.  But this is rare.  Either CSRF tokens are everywhere, or not at all. </p><br><p>  Since our demo site with the application allowed us to log in from the system administrator, I could see what the administrator can do and, most importantly, how he does it.  An interesting find was a password reset by a system user.  He looked like this </p><br><pre> <code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">method</span></span>="POST"&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>="Id" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="1" /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>="newPassword" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="testerok" /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>="confirmPassword" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="testerok" /&gt;</code> </pre> <br><p>  And if it didn‚Äôt bother you that in order to change the password you don‚Äôt need to enter the old password, then you should definitely be confused by the fact that users are sent via ID. </p><br><p>  And then the attack script is something like: </p><br><ul><li>  We send the administrator a message in the system with a link to our page. </li><li>  On our page we place the CSRF code for changing the password to the user. </li><li>  The administrator follows the link. </li><li>  The user has changed the password.  In this case, the administrator does not even understand that something happened. </li></ul><br><p>  Page Code </p><br><pre> <code class="hljs pgsql">&lt;html&gt; &lt;body&gt; &lt;form action="http://example.ru/main/Security/Users/ChangePassword" <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>="POST"&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="hidden" <span class="hljs-type"><span class="hljs-type">name</span></span>="Id" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="5" /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="hidden" <span class="hljs-type"><span class="hljs-type">name</span></span>="newPassword" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="test3" /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="hidden" <span class="hljs-type"><span class="hljs-type">name</span></span>="confirmPassword" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="test3" /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="submit" <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>="Submit request" /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br><p>  All that remains is for us to log in as a user to whom the administrator ‚Äúaccidentally‚Äù set a new password.  By the same example, a case with the creation of a new user in the system works.  You can still hide it and create a super-user!  Under which you can sit in the system and merge a bunch of valuable information about the company - orders, documents, financial information. </p><br><p>  Separately, in this whole story I want to highlight the reaction to the problems.  And the speed of their correction. </p><br><p>  The XSSs responded quickly enough.  There were no questions with them at all.  But with the CSRF, I began to receive the following questions and objections from the responsible person. </p><br><blockquote>  Let's see what the developers say.  In theory, we have an ip session tied, and there should be a few tokens (c) Head of Testing Department </blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z6/tv/4n/z6tv4nvfwe93l00d2qjlacmhx80.gif"></div><br><p>  Only at this moment my eye twitched?  What kind of protection through whitelisted IP can there be, if the admin does everything from his computer.  This is a CSRF chip.  But further more.  Responsible stated the following. </p><br><blockquote>  Bug # 7 I do not understand how to implement it yet (c) Head of Testing Department </blockquote><p>  This is a massive change of passwords to all users of the system.  Then I had to come straight with screenshots and tell why it is not worth leaving this opportunity at all. </p><br><p>  You can go through all the id at once </p><br><img src="https://habrastorage.org/webt/zm/if/g6/zmifg6ockhx5wzscjkvk9wf3o8e.png"><br><p>  Well, to dwell on those who are not interested in us </p><br><img src="https://habrastorage.org/webt/5e/is/kg/5eiskglr2mt6rcu4sr21amdegsg.png"><br><p>  And, to tell the truth, it was sad to receive clarifying questions for such obvious and well-known vulnerabilities. </p><br><p>  After all the correspondences, clarifications, a bunch of time spent, I was notified that I would be paid a reward for a special bugbaunt especially for me.  At the same time, the calculation of this reward remains for me some kind of magic.  Although I was given a formula by which everyone counted. </p><br><p>  All XSS except one were considered duplicates and summed up by a reduction factor.  CSRF on a different coefficient. </p><br><p>  In the end, I got <strong>100 Euro</strong> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sa/st/bd/sastbdgxcsilfpeto_6sim4liyq.png"></div><br><p>  But it's good that I got something at all! </p><br><p>  Due to the ‚Äúinteresting‚Äù user support policy, most customers will remain without these critical updates and patches. </p><br><p>  Just because these customers do not have an annual support subscription.  So in some large company that uses this expensive product, you can still drag off cookies or do something on behalf of the user by slipping a picture of cats.  The customer list is impressive - banks, insurance, industrial holdings ... </p><br><p>  In a sense, 0day turned out (the vulnerability has no fix). </p><br><p>  In my opinion it would be possible to act more intelligent and nobler.  Microsoft still patches release for Windows XP. </p><br><p>  I did not disclose the name of the company and the company's clients for moral and ethical reasons. </p><br><p>  Well, the representatives for the reputation of experiencing. </p><br><p>  <strong>Timeline:</strong> <br>  July 19th - reports were made <br>  August 9 - all reports are confirmed and rewards accrued <br>  August 28 - XSS filtering issues fixed <br>  November 14 - implemented a CSRF correction for customers who have a support subscription </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/345168/">https://habr.com/ru/post/345168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345158/index.html">Simple object DBMS</a></li>
<li><a href="../345160/index.html">Win a trip to the Norwegian office of Vivaldi</a></li>
<li><a href="../345162/index.html">We feed beacon fat herds</a></li>
<li><a href="../345164/index.html">Node.js and JavaScript for server development</a></li>
<li><a href="../345166/index.html">Diagnose and understand the behavior of your application's GPU using GAPID</a></li>
<li><a href="../345172/index.html">Headache from RecyclerView.Adapter - there is a way out</a></li>
<li><a href="../345174/index.html">How I leaked $ 1000 to the promotion of the game and what came out of it</a></li>
<li><a href="../345176/index.html">DataTalks # 8: User Study</a></li>
<li><a href="../345178/index.html">UIKit performance optimization</a></li>
<li><a href="../345180/index.html">Helping food delivery: logo redesign and corporate identity development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>