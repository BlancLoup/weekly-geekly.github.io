<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Extending the functionality of Windows controls with AttachedProperty</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The cornerstone of developing applications for Windows (WPF, SilverLight, WP, WinRT) is the MVVM pattern. Which is based on the concept of data bindin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Extending the functionality of Windows controls with AttachedProperty</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/be1/d72/972/be1d72972aae4b7b9abb3db869e79bb5.jpg"><br><br>  The cornerstone of developing applications for Windows (WPF, SilverLight, WP, WinRT) is the MVVM pattern.  Which is based on the concept of data binding of the view model and user interface, which allows using the declarative UI description through XAML to get rid of codebehind (I did not invent / find the Russian translation) and transfer all the logic of working with the user interface to the view model. <br><br>  Unfortunately, it is physically impossible for the manufacturer to implement all possible functions in the frameworks, and often there is a situation when it is impossible to solve the required task with the available means.  If the problem is simple and one-time, then it is solved quickly in the place of origin, through the codebehind of the submission.  But if the same functionality is needed in many places, you need to implement a convenient solution reuse mechanism. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I was prompted to write this article by the article <a href="http://habrahabr.ru/company/edusty/blog/253635/">"Automatic selection of links in universal Windows applications."</a>  The article found a solution to a specific problem and proposed a working solution.  However, to use it, you need to call code in each codebehind for each text block.  Moreover, if the data suggest a change in the process of work, it is necessary to monitor their change.  In the course of my work, I meet such solutions quite often, they are different in implementation, but they are all distinguished by one constant feature, the complexity of supporting and maintaining the code. <br><a name="habracut"></a><br>  To solve such problems, it is necessary to use attachable properties (AttachedProperty), this technology provides three capabilities necessary for solving the problem: <br><br>  1) Store any value in the context of the control for which it was set <br>  2) Notify on changing property data <br>  3) Be used for declarative binding in XAML <br><br>  We will solve the problem from the example above using the attached property. To do this, create a new static class named RtbEx and add a description of the new AttachedProperty to it: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty TextProperty = DependencyProperty.RegisterAttached(<span class="hljs-string"><span class="hljs-string">"Text"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(RtbEx), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>))); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DependencyObject element, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { element.SetValue(TextProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DependencyObject element</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) element.GetValue(TextProperty); }</code> </pre> <br>  We set the property name to Text and the value type string.  Separately, I will pay attention to the [Set | Get] Text methods they have been added to follow the recommended property declaration pattern and are intended to simplify access to the property value.  Now we can use this property to store the data associated with the control. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someText = ‚ÄúSome Text‚Äù; RtbEx.SetText(richTextBlock, someText); someText = RtbEx.GetText(richTextBlock);</code> </pre><br>  But for the implementation of additional behavior, we need to do the work of parsing the text and forming the RTB content when the property changes. For this, you can define a handler for each property that is called each time the property value changes. <br>  The event handler must be specified in the description of the attached property in the second parameter of the property metadata: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty TextProperty = DependencyProperty.RegisterAttached(<span class="hljs-string"><span class="hljs-string">"Text"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(RtbEx), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>), OnTextChanged));</code> </pre><br>  The property change event handler must be of type PropertyChangedCallback <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTextChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DependencyObject d, DependencyPropertyChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> richTextBlock = d <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> RichTextBlock; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (richTextBlock == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } richTextBlock.Blocks.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = e.NewValue <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(text)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } richTextBlock.Blocks.Add(CreateParagraph(text)); }</code> </pre><br>  The handler is as simple as possible; it determines that it is called for RichTextBlock, clears the data of the control, and if the new value of the property is not an empty string, it fills the control with new data. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Paragraph </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateParagraph</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paragraph = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paragraph(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> splitResult = Regex.Split(text, <span class="hljs-string"><span class="hljs-string">@"(https?://\S+)"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> part <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> splitResult) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (part.StartsWith(<span class="hljs-string"><span class="hljs-string">"http"</span></span>, StringComparison.OrdinalIgnoreCase)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hyperLink = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hyperlink {NavigateUri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(part)}; hyperLink.Inlines.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Run {Text = part}); paragraph.Inlines.Add(hyperLink); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } paragraph.Inlines.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Run {Text = part}); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> paragraph; }</code> </pre><br>  The RTB content generation code is not important in the context of the task and is far from ideal, it simply divides the string into blocks with links and simple text, and then builds the hierarchy of the representation of the RichTextBlock document. <br><br>  The extension thus formed can be used from XAML using ordinary data bindings, without using additional code. <br><br>  To do this, add a namespace containing the extension to the XAML document. <br><br><pre> <code class="xml hljs">xmlns:ex="using:RtbEx.Extensions"</code> </pre><br>  And set the binding using the usual {binding} <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RichTextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ex:RtbEx.Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding SomeText}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br><br>  The use of attachable properties is limited only by your imagination, using them you can implement many convenient extensions that will greatly simplify the development, reuse and support of your code. <br><br>  The test application code is available on Github: <a href="https://github.com/Viacheslav01/RtbEx">https://github.com/Viacheslav01/RtbEx</a> </div><p>Source: <a href="https://habr.com/ru/post/254305/">https://habr.com/ru/post/254305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254291/index.html">Development of a vector editor in JavaScript (part two, with sources)</a></li>
<li><a href="../254293/index.html">IPv6 is fun, part 2</a></li>
<li><a href="../254295/index.html">WMS setup in stock with narrow aisle technology</a></li>
<li><a href="../254297/index.html">The digest of interesting materials for the mobile developer # 96 (on March 23-29)</a></li>
<li><a href="../254299/index.html">New in Wolfram Language: TimelinePlot function for creating timelines</a></li>
<li><a href="../254307/index.html">MailChimp UX Team: Development [part 6 of the book]</a></li>
<li><a href="../254309/index.html">N + 4 useful books</a></li>
<li><a href="../254313/index.html">SQLite. Getting ready for Windows 10 (Universal App Platform)</a></li>
<li><a href="../254315/index.html">Steel manipulator HEXAPOD</a></li>
<li><a href="../254325/index.html">How to cross the border: cross-platform in a mobile application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>