<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>You could not even kill your router? (or FAQ: dir-620 recovery)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi hub! 

 There are many alternative firmware for Dlink routers. After switching to them, problems may arise, namely: the device does not start worki...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>You could not even kill your router? (or FAQ: dir-620 recovery)</h1><div class="post__text post__text-html js-mediator-article">  <b>Hi hub!</b> <br><br>  There are many alternative firmware for Dlink routers.  After switching to them, problems may arise, namely: the device does not start working effectively or simply dies.  If all the same, it was not successful.  This is an instruction for you and only for those <a href="http://dlink.ru/ru/products/5/1357.html">dir-620</a> that are not completely dead.  That is, it boots up, the network adapter of the PC cannot communicate with it via the Ethernet interface. <br><br>  Well, let's get started! <br><a name="habracut"></a><br>  For mime software and a half-dead device, we need a USB-UART (by the way, a very necessary thing on the farm).  We go to <a href="http://easyelectronics.ru/preobrazovatel-usb-uart-na-ftdi-ft232rl.html">easyelectronics</a> and do.  It was certainly possible to buy, but my friend was lying idle. <br>  Unforgettable that you need to bring COM on the router itself. <br><img src="https://habrastorage.org/storage2/d6a/33e/81c/d6a33e81c7c7264af11c04062a12e0ad.jpg"><br>  (I immediately warn you there is no possibility to take a picture of your own) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="">Rename the firmware</a> to habr.bin (you can even call it a tulip, the main thing is to have English letters and not exceed 127 characters) <br>  write addresses on the network <br><ul><li>  Address 10.10.10.3. </li><li>  mask 255.255.255.0 </li><li>  gateway 10.10.10.123 </li></ul><br><img src="https://habrastorage.org/storage2/96e/99d/89a/96e99d89a1a039e8a0a8e46cc0a39fc1.png"><br><br>  And so we consider two options. <br><br>  <b>Option 1</b> <br>  This option is very common to many. <br>  Unfortunately, I didn‚Äôt try so hard, using dir-620 to restore it. <br>  for this we <a href="http://www.putty.org/">swing putty</a> , <a href="http://tftpd32.jounin.net/">tftpd32</a> .  As for tftpd32, I downloaded tftpd64 (we don‚Äôt forget the bit depth of the system). <br><br>  <b>Step 1</b> <br>  We throw the firmware in the folder tftpd64. <br>  We start tftpd64, tab Tftp Server, we click Browes we select the folder where the program lies. <br><img src="https://habrastorage.org/storage2/d64/8f4/ed5/d648f4ed524fee1f269277986364ae2e.png"><br><br>  <b>Step 2</b> <br>  run putty, go to Serial.  Here is <b>COM3</b> (you may have another one, look at the device manager), Speed <b>57600</b> , Flow control: <b>None</b> <br><img src="https://habrastorage.org/storage2/80a/1e4/884/80a1e48847a5df356790260647800dc7.png"><br>  Go to Session, click open. <br><br>  <b>Step 3</b> <br>  We connect USB-UART to COM on the router itself.  I want to warn you after turning on you have 5 seconds to select the desired item, you need to press <b>2</b> . <br>  and turn on the router. <br><br><div class="spoiler">  <b class="spoiler_title">Log</b> <div class="spoiler_text"><h6>  U-Boot 1.1.3 (Feb 9 2010 - 10:44:20) <br><br>  Board: Ralink APSoC DRAM: 32 MB <br>  relocate_code Pointer at: 81fb0000 <br>  flash_protect ON: from 0xBF000000 to 0xBF01D3F3 <br>  flash_protect ON: from 0xBF030000 to 0xBF030FFF <br>  ============================================ <br>  Ralink UBoot Version: 3.3 <br>  - ASIC 3052_MP2 (Port5 &lt;-&gt; None) <br>  DRAM component: 128 Mbits SDR <br>  DRAM bus: 32 bit <br>  Total memory: 32 MBytes <br>  Flash component: NOR Flash <br>  Date: Feb 9 2010 Time: 10: 44: 20 <br>  ============================================ <br>  icache: sets: 256, ways: 4, linesz: 32, total: 32768 <br>  dcache: sets: 128, ways: 4, linesz: 32, total: 16384 <br><br>  ##### The CPU freq = 384 MHZ #### <br><br>  SDRAM bus set to 32 bit <br>  SDRAM size = 32 Mbytes <br><br>  Please choose the operation: <br>  1: Load system code to SDRAM via TFTP. <br>  2: Load system code then write to Flash via TFTP. <br>  3: Boot system code via Flash (default). <br>  4: Entr boot command line interface. <br>  9: Load Boot Loader code then write to Flash via TFTP. </h6><br><br>  <b>After selecting 2: Load system code then write to Flash via TFTP:</b> <br><br><h6>  2: System Load Linux Kernel then write to Flash via TFTP. <br>  Warning !!!  Erase Linux in Flash then burn new one.  Are you sure? (Y / N) </h6><br>  <b>write Y press ENTER</b> <br><h6>  Please Input new ones / or Ctrl-C to discard <br>  Input device IP (10.10.10.123) ==: 10.10.10.123 </h6><br>  <b>press ENTER</b> <br><h6>  Input server IP (10.10.10.3) ==: 10.10.10.3 </h6><br>  <b>press ENTER</b> <br><h6>  Input Linux Kernel filename () ==: </h6><br>  <b>write habr.bin - the file name and press ENTER</b> <br></div></div><br>  after which the firmware should download, the device will reboot already in working condition. <br><br>  but what if putty just simply refuses to go to anyone, and tftpd32 does not work. <br><br>  <b>Option 2</b> <br><br>  you will need <a href="">Terminal v1.9b by Bray</a> and <a href="http://www.winagents.com/en/downloads/download-tftp-server.php">WinAgents TFTP Server Manager</a> (for 30 days off site off-site this time is enough for us) <br><br>  <b>Step 1</b> <br>  We throw the firmware <b>C: \ ProgramData \ WinAgents \ TFTP Server 4 \ TFTPRoot</b> .  We saw a file appeared on the server. <br><img src="https://habrastorage.org/storage2/e2e/024/f98/e2e024f9838b6fde454ed6e52ff00f84.png"><br><br>  <b>Step 2</b> <br>  configure Terminal v1.9b by Bray (port: COM3, Baud rate: 57600) click end.  Turn on the router and see Terminal v1.9b by Bray.  <b>UNFORGETTEN THAT THERE IS 5 SECONDS TO PRESS NUMBER TWO (2)</b> <br><img src="https://habrastorage.org/storage2/5d2/b3d/7c6/5d2b3d7c64c541a83d840f8bf2bc1a0e.png"><br><br><div class="spoiler">  <b class="spoiler_title">Log</b> <div class="spoiler_text"><h6>  U-Boot 1.1.3 (Feb 9 2010 - 10:44:20) <br><br>  Board: Ralink APSoC DRAM: 32 MB <br>  relocate_code Pointer at: 81fb0000 <br>  flash_protect ON: from 0xBF000000 to 0xBF01D3F3 <br>  flash_protect ON: from 0xBF030000 to 0xBF030FFF <br>  ============================================ <br>  Ralink UBoot Version: 3.3 <br>  - ASIC 3052_MP2 (Port5 &lt;-&gt; None) <br>  DRAM component: 128 Mbits SDR <br>  DRAM bus: 32 bit <br>  Total memory: 32 MBytes <br>  Flash component: NOR Flash <br>  Date: Feb 9 2010 Time: 10: 44: 20 <br>  ============================================ <br>  icache: sets: 256, ways: 4, linesz: 32, total: 32768 <br>  dcache: sets: 128, ways: 4, linesz: 32, total: 16384 <br><br>  ##### The CPU freq = 384 MHZ #### <br><br>  SDRAM bus set to 32 bit <br>  SDRAM size = 32 Mbytes <br><br>  Please choose the operation: <br>  1: Load system code to SDRAM via TFTP. <br>  2: Load system code then write to Flash via TFTP. <br>  3: Boot system code via Flash (default). <br>  4: Entr boot command line interface. <br>  9: Load Boot Loader code then write to Flash via TFTP. </h6><br><br>  <b>After selecting 2: Load system code then write to Flash via TFTP to appear:</b> <br><br><h6>  2: System Load Linux Kernel then write to Flash via TFTP. <br>  Warning !!!  Erase Linux in Flash then burn new one.  Are you sure? (Y / N) </h6><br>  <b>write Y press ENTER</b> <br><h6>  Please Input new ones / or Ctrl-C to discard <br>  Input device IP (10.10.10.123) ==: 10.10.10.123 </h6><br>  <b>press ENTER</b> <br><h6>  Input server IP (10.10.10.3) ==: 10.10.10.3 </h6><br>  <b>press ENTER</b> <br><h6>  Input Linux Kernel filename () ==: </h6><br>  <b>write habr.bin - the file name and press ENTER</b> <br><br><h6>  netboot_common, argc = 3 <br><br>  NetTxPacket = 0x81FE5600 <br><br>  KSEG1ADDR (NetTxPacket) = 0xA1FE5600 <br><br>  NetLoop, call eth_halt! <br><br>  NetLoop, call eth_init! <br>  Trying Eth0 (10/100-M) <br><br>  Waitting for RX_DMA_BUSY status Start ... done <br><br>  Header Payload scatter function is Disable !!! <br><br>  ETH_STATE_ACTIVE !!! <br>  Using Eth0 (10/100-M) device <br>  TFTP from server 10.10.10.3;  our IP address is 10.10.10.123 <br>  Filename 'habr.bin'. <br><br>  TIMEOUT_COUNT = 10, Load address: 0x80100000 <br>  Loading: Got ARP REPLY, set server / gtwy eth addr (1c: 6f: 65: eb: c1: 51) <br>  Got it <br>  T # <br>  first block received <br>  ################################################## ############## <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ############### <br>  ################################################## ########## <br>  done <br>  Bytes transferred = 5959680 (5af000 hex) <br>  NetBootFileXferSize = 005af000 <br>  Erase linux kernel block !!! <br>  From 0xBF050000 to 0xBF5FFFFF <br><br>  b_end = BF7FFFFF <br>  Erase Flash from 0xbf050000 to 0xbf5fffff in Bank # 1 <br><br>  erase sector = 12 <br>  sect = 12, s_last = 102, erase poll = 1008817 <br><br>  erase sector = 13 <br>  sect = 13, s_last = 102, erase poll = 984201 <br><br>  erase sector = 14 <br>  * sect = 14, s_last = 102, erase poll = 1007174 <br><br>  erase sector = 15 <br>  sect = 15, s_last = 102, erase poll = 998828 <br><br>  erase sector = 16 </h6><br><br>  blah blah blah <br>  he rebut <br>  blah blah blah <br><br><h6>  start urlfilter <br>  init wans <br>  Intialize wan ... <br>  [17179582.684000] eth2.5: Setting MAC address to 00 0c 43 30 52 89. <br>  Set mac 00: 0C: 43: 30: 52: 89 on iface eth2.5 - OK <br>  Set mtu 1500 on iface eth2.5 - OK <br>  start_wan_link_on_l2 - Up iface eth2.5 <br>  start_ip: dhcp ipv4 <br>  start_wan_link_on_l2 - Iface eth2.5 is up <br>  start_wan_link_on_l2 - Up iface br0 <br>  start_wan_link_on_l2 - iface br0 is not wan, pass it <br>  start ddns <br>  info, udhcp client (v0.9.8) started (iface: eth2.5, connect: 1) <br>  udhcp client (v0.9.8) started (iface: eth2.5, connect: 1) <br>  debug, interface eth2.5 index 9 <br>  debug, interface eth2.5 hwaddr 00: 0c: 43: 30: 52: 89 <br>  debug, interface eth2.5 mtu is 1500 <br><br>  debug, execle'ing / tmp / udhcpc with name deconfig <br>  start services <br>  start_telnet ... <br>  start_printserver ... <br>  init_sysusers ... <br>  debug, Opening raw socket on ifindex 9 <br><br>  Out init_device <br>  init_device: pid_status (WEXITSTATUS) = 0 <br>  Done. <br>  Welcome to <br>  _______ ___ __ ____ _ _ ___ <br>  |  ___ \ |  |  | __ ||  \ |  ||  |  / / <br>  |  |  |  ||  ___ |  | __ __ |  \ |  ||  | / / <br>  |  | ___ |  ||  | ___ |  |  ||  ||  | \ ||  \ <br>  | _______ / | ______ || __ || _ |  \ ____ || _ | \ ___ \ <br><br>  = Building Networks for People = <br><br>  info, Sending discover ... <br>  [17179583.076000] dwc_otg: version 2.72a 24-JUN-2008 <br>  [17179583.080000] DWC_otg: Core Release: 2.66a <br>  [17179583.284000] DWC_otg: Periodic Transfer Interrupt Enhancement - disabled <br>  [17179583.288000] DWC_otg: Multiprocessor Interrupt Enhancement - disabled <br>  [17179583.292000] DWC_otg: Using DMA mode <br>  [17179583.296000] DWC_otg: Device using Buffer DMA mode <br>  [17179583.300000] dwc_otg lm0: DWC OTG Controller <br>  [17179583.304000] dwc_otg lm0: new USB bus registered, assigned bus number 1 <br>  [17179583.308000] dwc_otg lm0: irq 18, io mem 0x00000000 <br>  [17179583.312000] DWC_otg: Init: Port Power?  op_state = 1 <br>  [17179583.316000] DWC_otg: Init: Power Port (0) <br>  [17179583.320000] usb usb1: Product: DWC OTG Controller <br>  [17179583.324000] usb usb1: Manufacturer: Linux 2.6.21 dwc_otg_hcd <br>  [17179583.328000] usb usb1: SerialNumber: lm0 <br>  [17179583.336000] usb usb1: configuration # 1 chosen from 1 choice <br>  [17179583.340000] hub 1-0: 1.0: USB hub found <br>  [17179583.344000] hub 1-0: 1.0: 1 port detected <br>  D-link init done <br>  info, Sending discover ... <br>  info, Sending discover ... <br>  [17179597.196000] br0: topology change detected, propagating <br>  [17179597.200000] br0: port 5 (ra0) entering forwarding state <br>  [17179597.204000] br0: topology change detected, propagating <br>  [17179597.208000] br0: port 4 (eth2.1) entering forwarding state <br>  [17179597.212000] br0: topology change detected, propagating <br>  [17179597.216000] br0: port 3 (eth2.2) entering forwarding state <br>  [17179597.220000] br0: topology change detected, propagating <br>  [17179597.224000] br0: port 2 (eth2.3) entering forwarding state <br>  [17179597.228000] br0: topology change detected, propagating <br>  [17179597.232000] br0: port 1 (eth2.4) entering forwarding state <br>  info, Sending discover ... <br>  info, Sending discover ... <br>  info, Sending discover ... <br></h6><br></div></div><br>  <b>Step 3</b> <br><br>  change addresses on the network, enjoy the router) <br><br><ul><li>  <b>when uploading a file to the router, you will see not only on the terminal but also the server will tell you that the file has left.</b> </li></ul><br><img src="https://habrastorage.org/storage2/44c/576/e47/44c576e4706edcb749d155542676a8d1.png"><br><br><ul><li>  <b>As for Terminal v1.9b by Bray, we enter in the gray fields (by character input)</b> . </li></ul><br><img src="https://habrastorage.org/storage2/5d1/e22/a82/5d1e22a82ef660bd8a17e1cf8e9390bc.png"><br><br>  Well, that's all, good luck to all!  <b>:)</b> </div><p>Source: <a href="https://habr.com/ru/post/192414/">https://habr.com/ru/post/192414/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192402/index.html">Rwpod. 25th edition of the 01 season. Parallel installation of gems via bundler, Memfs, Ember.js 1.0, Flipload.js, etc.</a></li>
<li><a href="../192404/index.html">Yandex, robots and Siberia - as we did a search system for the downloaded image</a></li>
<li><a href="../192408/index.html">-ms-filter generating bugs. Be carefull</a></li>
<li><a href="../192410/index.html">High-speed SSD of new generation</a></li>
<li><a href="../192412/index.html">The new bill provides for fines of up to one million rubles for providers that do not comply with the requirements of the "anti-piracy" law</a></li>
<li><a href="../192416/index.html">What is your home network for you?</a></li>
<li><a href="../192418/index.html">Nokia's most famous / original phones: remember what was</a></li>
<li><a href="../192420/index.html">Why is it interesting for me to study in a Moscow university?</a></li>
<li><a href="../192426/index.html">Very slim and flexible wireless keyboard</a></li>
<li><a href="../192430/index.html">Cellular Test Base Station: What's Inside</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>