<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing OS Inferno New Edition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OUTDATED: This article is outdated; for installation under modern OS, see the new article . 

 Update: Added description of the installation under Win...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing OS Inferno New Edition</h1><div class="post__text post__text-html js-mediator-article">  <b>OUTDATED:</b> This article is outdated; for installation under modern OS, see the <a href="http://habrahabr.ru/post/145922/">new article</a> . <br><br>  <b>Update:</b> Added description of the <a href="https://habr.com/ru/post/42998/">installation under Windows XP SP2</a> . <br>  <b>Update:</b> Added <a href="https://habr.com/ru/post/42998/">installation</a> description <a href="https://habr.com/ru/post/42998/">for Mac OS X 10.4.8 Tiger</a> . <br>  <b>Update:</b> Added <a href="https://habr.com/ru/post/42998/">installation</a> description <a href="https://habr.com/ru/post/42998/">for Mac OS X 10.5.5 Leopard</a> . <br><br><h4>  New edition </h4><br>  Yes, the <a href="http://code.google.com/p/inferno-os/source/checkout">version in svn</a> calls itself that way!  Install, run the browser (Charon) and see for yourself.  (In principle, the latest release is " <a href="http://www.vitanuova.com/inferno/net_download4T.html">Fourth Edition</a> ", but in practice it has long been the same svn - "Fourth Edition" was released around 2004, and now on the offsite site under the guise of "Fourth Edition" svn snapshot from 20071003 is posted.) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The svn version is absolutely stable, and, unlike the Fourth Edition install, it is much easier to update.  It is no less convenient for installation on combat servers or release of your application.  In general, the only drawback is the need to have a subversion and a compiler for building the system, everything else is a plus. <br><br>  So, we put the fresh <a href="http://www.vitanuova.com/inferno/index.html">OS Inferno</a> from SVN, in hosted mode (i.e., in the form of an emulator running under another OS). <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/241/b05/50a/241b0550ac96f7c9aecae800674cee53.png" alt="OS Inferno hosted on Mac OS X"><br><br><h4>  Installation features in different systems </h4><br>  Although Inferno should be installed and work the same on all systems, we all know perfectly well that there are always nuances.  I tested the installation on Hardened Gentoo Linux and on Ubuntu 8.04.  I hope this choice of systems will override most of the nuances of installation in other Linux distributions. <br><br><h5>  Hardened gentoo linux </h5><br>  Gentoo will have no problems with the compiler and .h files, I assure you.  :) But Hardened will add some work.  The fact is that <code>emu</code> can work both in the interpretation mode of the Dis virtual machine bytecode and in the <a href="http://ru.wikipedia.org/wiki/JIT">JIT</a> mode.  And Hardened (more precisely, PaX entering into it) very much does not like code generation on the fly with transfer of control to it.  Therefore, to run <code>emu</code> in JIT mode, you will need to partially disable PaX.  This is done by the <code>paxctl</code> and <code>chpax</code> .  <i>On systems without PaX, these commands are most likely not, and they do not need to be executed.</i>  Another nuance occurs when Trusted Path Execution (TPE) is enabled, but it is usually sufficient to ensure that the rights to the emu directory belong to root.  How to deal with SeLinux - understand yourself.  :) <br><br><h5>  Ubuntu 8.04 </h5><br>  That's what's not here ... uh ... there is nothing here.  :) No Hardened, no subversion, no libraries, no .h files.  We'll have to put: <br><br><pre> apt-get install subversion build-essential 
 apt-get install libx11-dev libxext-dev x11proto-xext-dev
</pre><br>  Perhaps you will need to connect additional repositories, I will not say for sure - I already had them connected to install other applications. <br><br><h4>  Install OS Inferno </h4><br>  The following is the installation from root, to the <code>/usr/local/inferno</code> directory, in <a href="http://habrahabr.ru/post/42829/">full multi-user mode</a> .  Differences when installing from a regular user in <code>~/inferno/</code> I <font color="blue">will mention</font> in the course of the process - basically they boil down to the fact that some commands are meaningless to execute and / or not necessary. <br><br>  The time / traffic / disk space costs are approximately as follows: <ul><li>  <b>archive version of svn</b> takes about <b>30 MB</b> , but it is clear that svn will pump traffic much more </li><li>  the system is <b>completely [re] going</b> to my Core2Duo 6600 in about <b>two minutes</b> </li><li>  in the installed form <b>on the disk,</b> it takes about <b>250 MB</b> </li></ul>  <b>ATTENTION:</b> Inferno strongly dislikes "strange" characters in the names of files and directories.  <u>Including space!</u>  This is not a bug, it is a conscious architectural solution.  Therefore, it is recommended to ensure that the directory where Inferno is placed, and in your home directory inside Inferno, the file names are without characters like ":", "!", "#", Space, etc. <br><br>  <b>We swing.</b>  All commands, unless otherwise stated, are executed as root.  <font color="blue">When installing to your home directory, install INFERNO_ROOT, for example, <code>/home/powerman/inferno</code> .</font>  <font color="blue">And, of course, follow all the commands from a regular user.</font> <br><br><pre> export INFERNO_ROOT = / usr / local / inferno
 svn checkout http://inferno-os.googlecode.com/svn/trunk/ $ INFERNO_ROOT
 cd $ INFERNO_ROOT
</pre><br>  <b>Customize compilation options.</b>  <i>Instead of <code>perl -i -pe</code> you can run your favorite text editor and edit <code>mkconfig</code> pens.</i> <br><br><pre> export PATH = $ INFERNO_ROOT / Linux / 386 / bin: $ PATH
 perl -i -pe 's / ^ ROOT =. * / ROOT = $ ENV {INFERNO_ROOT} / m' mkconfig
 perl -i -pe 's / ^ SYSHOST =. * / SYSHOST = Linux / m' mkconfig
 perl -i -pe 's / ^ OBJTYPE =. * / OBJTYPE = 386 / m' mkconfig
</pre><br>  <b>Putting the system.</b>  <i>Remember, <code>paxctl</code> needed only on systems protected by PaX and only to run in JIT mode.</i> <br><br><pre> sh makemk.sh
 mk nuke
 mk install
 paxctl -psmxe linux / 386 / bin / emu
</pre><br>  <b>Configure emu options.</b>  It is advisable to register this command in <code>~/.bashrc</code> - in order not to pass these parameters every time <code>emu</code> start <code>emu</code> .  (By the way, it is also very desirable to set <code>export PATH=/usr/local/inferno/Linux/386/bin:$PATH</code> in <code>~/.bashrc</code> <code>export PATH=/usr/local/inferno/Linux/386/bin:$PATH</code> - it will be more convenient to run <code>emu</code> and <code>limbo</code> .) Of course, you need to set the size of the Inferno window system not necessarily 1024x768.  In principle, it is more convenient when the size of the Inferno window is less than the resolution of the host OS.  The <code>-c0</code> disables JIT (to enable, simply run <code>emu -c1</code> ).  The fact is that with JIT enabled, it is harder to debug your applications - the debugger does not work, the borders of arrays are less controlled, etc.  And the speed of Inferno and without JIT is more than impressive. <br><br><pre> export EMU = "- r $ INFERNO_ROOT -g1024x768 -c0"
</pre><br>  <b>Configure user inferno.</b>  <font color="blue">When installing to the home directory, these commands do not need to be executed.</font>  The second chown is needed when the TPE is on. <br><br><pre> groupadd inferno
 useradd -m -s / bin / bash -g inferno inferno
 chown -R inferno: inferno $ INFERNO_ROOT
 chown -R root: root $ INFERNO_ROOT / Linux / 386 / bin /
 echo exec $ INFERNO_ROOT / Linux / 386 / bin / emu $ EMU &gt;&gt; ~ inferno / .bashrc
 mv usr usr.skel
 ln -s / home usr
 cp -a usr.skel / inferno / * ~ inferno /
</pre><br>  <b>Update:</b> see the comment on the <a href="https://habr.com/ru/post/42998/">/ tmp configuration</a> . <br><br><h4>  Fonts </h4><br>  In principle, at this point OS Inferno is installed, and it can be used.  But ‚ÄúFourth Edition‚Äù includes additional fonts (B &amp; H Lucida), which, due to licensing restrictions, Google does not allow spreading to svn on code.google.com.  In principle, most applications will work without them.  In addition, they can be replaced with alternative free fonts (they seem to have done so in the <a href="http://code.google.com/p/acme-sac/">Acme SAC</a> project).  But I did not understand this.  Therefore, we now, quickly, extort and install in the temporary directory "Fourth Edition", and extract from it these fonts.  :) <br><br><pre> mkdir / tmp / inferno
 cd / tmp / inferno
 wget http://www.vitanuova.com/dist/4e/20071003/inferno.tgz
 wget http://www.vitanuova.com/dist/4e/20071003/Linux.tgz
 tar xzf inferno.tgz
 tar xzf linux.tgz
 chown -R root: root / tmp / inferno
 chpax -psmxe Linux / 386 / bin / emu
 sh install / Linux-386.sh / tmp / inferno /
 cp -r fonts / {lucida, lucidasans, lucm, pelm, licence} / usr / local / inferno / fonts /
 rm -rf / tmp / inferno
</pre><br><h4>  We are testing </h4><br>  The semicolon at the beginning of the lines is the invitation to Inferno sh.  Finishing work with Inferno - in text mode either Ctrl-D or Ctrl-C, in graphic mode - closing of the Inferno graphic window.  <i>(The graphical environment is started with the <code>wm/wm</code> command.)</i> <br><br>  <b>Log in as user inferno.</b>  <font color="blue">When installing in your home directory, skip this step.</font> <br><br><pre> # su - inferno
 ;  cd
 ;  pwd
 / usr / inferno
 ;  cat / dev / user
 inferno
</pre><br>  <b>Login as a regular user.</b>  The <code>cp</code> command initializes your home directory; you do not need to repeat it in the future before launching Inferno.  The installation of PATH and EMU is also better to register in <code>~/.bashrc</code> .  Then to run Inferno it will be enough to run <code>emu</code> . <br><br><pre> $ cp -r /usr/local/inferno/usr.skel/inferno/* ~ /
 $ export PATH = / usr / local / inferno / Linux / 386 / bin: $ PATH
 $ export EMU = "- r / usr / local / inferno / -g1024x768 -c0"
 $ emu
 ;  cd
 ;  pwd
 / usr / powerman
 ;  cat / dev / user
 powerman
</pre><br><h4>  Initial setting Inferno </h4><br>  When you start <code>emu</code> system is minimally initialized, and then <code>sh</code> run, which executes <code>/lib/sh/profile</code> to further initialize the system.  I usually write to it: <ul><li>  Setting the time zone.  In principle, this can be done once by copying the file, but using <code>bind</code> is more than Infern-ish.  :) </li><li>  Change to the home directory of the current user (by default, the system is in the root directory). </li><li>  If the appropriate files are configured in the user's home directory, continue the system initialization with these files. </li></ul>  So, you write in <b>/ usr / local / inferno / lib / sh / profile</b> : <br><pre> bind / locale / Moscow / locale / timezone
 cd
 load std
 and {ftest -e namespace} {nsbuild}
 and {ftest -e profile} {run profile}
</pre><br>  <font color="blue">When installing to the home directory, this setting ends - there is no point in setting up three authorization entities with a bunch of passwords when working under a single account.</font> <br><br><a name="auth"></a><br><h5>  Configure authorization </h5><br>  First you need to explain what is being configured and why.  Authorization works as follows: the client and the service mutually authenticate each other using certificates based on private / public keys - everything is almost like that of ssh or https.  Almost because they authorize each other really <b>mutually</b> .  To do this, both of them must obtain their certificates from the same CA (certificate authority), which both trust.  So, it is the CA, by issuing or not issuing these certificates, determines whether the client will have access to the service or not. <br><br>  Thus, we need to configure three different systems - an authorization server, a useful service, and a client terminal.  To do this, we can run three independent <code>emu</code> on our machine - from the point of view of Inferno, these will be three different servers on which different applications will run.  Of course, with this option there are some limitations - for example, it is impossible to start two identical network services in different <code>emu</code> - they will have a conflict when trying to open a TCP port.  Well, the files on the disk are shared, of course - but this does not apply to ‚Äúvirtual‚Äù files (a la / proc and / dev in Linux), which are used <i>very</i> actively in Inferno.  So the differences between these three <code>emu</code> is enough for you to perceive them as really different and independent servers. <br><br>  <b>First of all, you need to register the address (hostname or IP) of the authorization server on the client and service machines.</b>  But, since the files they have in our configuration are the same, it is enough to edit one file <b>/ usr / local / inferno / lib / ndb / local</b> (you can enter 127.0.0.1): <br><pre> SIGNER = powerman.name
</pre><br>  <b>Next, run the authorization server.</b>  It will run under the user inferno, and all files with keys and CA certificates will be available only to this user. <br><pre> # su - inferno
 ;  cat / dev / user;  echo
 inferno
</pre><br>  <i>... clear the key database</i> <br><pre> ;  cp / dev / null / keydb / keys;  chmod 600 / keydb / keys
</pre><br>  <i>... we generate the certificate of our CA, on the specified name (any)</i> <br><pre> ;  auth / createsignerkey powerman.name
</pre><br>  <i>... we start the authorization service, and you will need to set a password, which you will need to enter in the future each time you start this service - this is necessary because</i>  <i>keys in files will be encrypted with this password</i> <br><pre> ;  svc / auth
 Key: 
 Confirm key:
</pre><br>  <i>... now we can have real user accounts with passwords on our authorization service, finally :) - one for the user inferno (just to avoid having a third user, they will use the second server to start useful services) and the second for the user powerman (which will use the client terminal on the third server to connect to the useful service on the second server)</i> <br><pre> ;  auth / changelogin inferno
 new account
 secret: 
 confirm: 
 expires [DDMMYYYY / permanent, return = 23102009]: permanent
 change written
 ;  auth / changelogin powerman
 new account
 secret: 
 confirm: 
 expires [DDMMYYYY / permanent, return = 23102009]: permanent
 change written
</pre><br>  <i>... well, and admire the TCP services running on this "server"</i> <br><pre> ;  netstat
 tcp / 0 inferno Announced 0.0.0.0! 6673 ::! 0
 tcp / 1 inferno Announced 0.0.0.0! 6677 ::! 0
 tcp / 2 inferno Announced 0.0.0.0! 6671 ::! 0
 tcp / 3 inferno Announced 0.0.0.0! 6672 ::! 0
 ; 
</pre><br>  <b>We leave the authorization server to work, and run the next <code>emu</code> - with a useful service.</b> <br><pre> # su - inferno
 ;  cat / dev / user;  echo
 inferno
</pre><br>  <i>... ndb / cs is something like a universal resolver, without it you don‚Äôt work with the network in Inferno (there are ndb / dns, but you can not start it in hosted mode and use the host OS dns-resolver)</i> <br><pre> ;  ndb / cs
</pre><br>  <i>... we turn to the authorization service (the first server), log in with our username / password, and receive our certificate from it (this is a one-time operation, provided that the certificate is not expired and the file where the received certificate will not be deleted now will be deleted).</i> <br><pre> ;  getauthinfo default
 use signer [$ SIGNER]: 
 remote user name [inferno]: 
 password: 
 save in file [yes]:
</pre><br>  <i>... now, having a certificate, you can start a useful service - for example, rstyx, which allows you to remotely execute commands on this server - an analog of ssh</i> <br><pre> ;  svc / rstyx
 ;  netstat
 tcp / 0 inferno Announced 0.0.0.0! 6668 ::! 0
 ;
</pre><br>  <b>We leave it to work and run the third <code>emu</code> - terminal user powerman.</b> <br><pre> $ emu
 ;  cat / dev / user;  echo
 powerman
 ;  ndb / cs
 ;  getauthinfo default
 use signer [$ SIGNER]: 
 remote user name [powerman]: 
 password: 
 save in file [yes]: 
</pre><br>  <i>... now we can connect to the second server and execute a command on it.</i>  <i>for example, let's see the list of processes first on this terminal, and then on the second server</i> <br><pre> ;  ps
        1 1 powerman 0: 00.0 release 74K Sh [$ Sys]
        8 7 powerman 0: 00.0 alt 17K Cs
       11 1 powerman 0: 00.0 ready 74K Ps [$ Sys]
 ;  cpu powerman.name ps
        1 1 inferno 0: 00.0 release 83K Bufio [$ Sys]
        8 7 inferno 0: 00.0 alt 17K Cs
       13 1 inferno 0: 00.0 alt 9K Listen
       15 1 inferno 0: 00.0 release 9K Listen [$ Sys]
       22 1 powerman 0: 00.0 ready 1K Ps [$ Sys]
 ;
</pre><br><h4>  System update </h4><br>  Here everything is absolutely trivial: <br><pre> cd / usr / local / inferno
 svn up
 mk install
</pre><br><h4>  What's next? </h4><br>  RTFM.  RTFM.  And again RTFM.  The system is very different from the traditional.  And do not count on reading the documentation - you need to read the source code, the most important thing is there.  :) <br><br>  When there is an understanding of how it works - write to Limbo.  (I do not advise writing sh - it is too slow, which is rather strange, by the way.) Write network services, distributed systems, or full-fledged GUI applications. <br><br>  Good luck!  :) </div><p>Source: <a href="https://habr.com/ru/post/42998/">https://habr.com/ru/post/42998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429970/index.html">Implementing family bookkeeping with Google Sheets, chewing gum and scotch</a></li>
<li><a href="../429972/index.html">The attack on Github Pages with the interception of the site on your domain</a></li>
<li><a href="../429974/index.html">Path Machine: the idea of ‚Äã‚Äãa single algorithm</a></li>
<li><a href="../429976/index.html">The game that turned the story of shooters: Goldeneye 007 for Nintendo 64</a></li>
<li><a href="../429978/index.html">Security agency and "new" technology</a></li>
<li><a href="../429980/index.html">Least squares methods without tears and pain</a></li>
<li><a href="../429982/index.html">O'Reilly's London Velocity Conference: Overview and Slides</a></li>
<li><a href="../429984/index.html">Comparing scripts to collect information about subdomains</a></li>
<li><a href="../429986/index.html">Reddit promotion. How to get traffic?</a></li>
<li><a href="../429988/index.html">HighLoad ++: presentations from Avito speakers, notes, photos and impressions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>