<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DES to J in a hundred lines</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A week of thirty-lead on JS should be diluted with something really crazy. 



 I recommend reading, for example, with this series of articles or this...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DES to J in a hundred lines</h1><div class="post__text post__text-html js-mediator-article">  A week of thirty-lead on JS should be diluted with something really crazy. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa6/c0a/82d/aa6c0a82d0e9c6ed49f080367d529670.png" alt="image"><br><br>  I recommend reading, for example, with <a href="http://habrahabr.ru/post/198052/">this</a> series of articles or <a href="http://jsoftware.com/help/jforc/contents.htm">this</a> book before reading;  language dictionary <a href="http://jsoftware.com/help/dictionary/vocabul.htm">here</a> ;  Nevertheless, I will try to explain in detail my actions (all explanations are hidden under spoilers, so as not to clutter up the article). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you have any questions, suggestions or corrections to the code, welcome to the comments. <br><a name="habracut"></a><br><h4>  What is DES </h4><br>  <a href="http://ru.wikipedia.org/wiki/DES">DES</a> (Data Encryption Standard) is a symmetric encryption algorithm developed by IBM and approved by the US government in 1977 as the official standard (FIPS 46-3). <br><br>  DES is a typical block cipher using a 56-bit key.  The encryption process consists in the initial permutation of the bits of a 64-bit block, sixteen cycles of encryption, and finally, the inverse permutation of the bits. <br><br><h4>  Preparing the soil </h4><br>  DES uses several matrices that should be prepared ahead of time. <br><br><h5>  Initial permutation matrix P </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/5e0/1e6/77d5e01e633dfca54563be8905bec205.png"><br><br>  The pattern is visible with the naked eye: in the upper half of the matrix from top to bottom from right to left are odd numbers from 1 to 63, and each element of the lower half of the matrix is ‚Äã‚Äãone less than the corresponding element of the top.  Take advantage of this. <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  First of all we will make the upper part. <br><pre><code class="vala hljs">|: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre> <br>  The code runs from right to left.  In order: <ul><li>  <code>i.32</code> produces 32 consecutive numbers, starting with zero; </li><li>  <code>+:</code> doubles its operand; </li><li>  <code>&gt;:</code> increases the operand by one; </li><li>  <code>8 4 $</code> converts the operand into an 8x4 matrix; </li><li> <code>|.</code>  inverts the main axis of the matrix, i.e.  rearranges the lines in reverse order; </li><li>  <code>|:</code> transposes the matrix. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Consistently</b> <div class="spoiler_text"><pre> <code class="vala hljs"> i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> |: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre></div></div><br>  Get the bottom half of the matrix costs nothing: <pre> <code class="vala hljs"> &lt;: |: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre><br>  Operator <code>&lt;:</code> decrements operand value by one. <br>  It remains to combine this - here comes the magic of J: <pre> <code class="vala hljs"> (] , &lt;:) |: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span> <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre><br>  The construction of the three verbs is called fork: <br> <code>(fgh) y &lt;-&gt; (fy) g (hy)</code> <br>  Thus, the construction above is equivalent to this: <br><pre> <code class="vala hljs">(] |: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span>) , (&lt;: |: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span>)</code> </pre><br>  The dyad performs the concatenation of arrays, and <code>]</code> simply returns its right operand. <br>  The monadic version <code>,</code> ‚Äústraightens‚Äù the matrix into an array, which we use when we obtain the final formula for the initial permutation matrix: </div></div><br><pre> <code class="vala hljs">P =: , (] , &lt;:) |: |. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> $ &gt;: +: i<span class="hljs-number"><span class="hljs-number">.32</span></span></code> </pre><br><h5>  Reverse Rearrangement Matrix P <sup>-1</sup> </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/90b/777/989/90b777989f8d306665fd4f5202c4707b.png"><br><br>  This matrix is ‚Äã‚Äãrelated to P as follows: the 0th element of P <sup>-1</sup> is 39, the 39th element of P is 0, and so on. <br>  In other words, the elements of the matrix P <sup>-1</sup> are the indices of their indices in the matrix P. It sounds confusing, but this underlies the formula of this matrix. <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  The first step is to use the dyadic fork: <br> <code>x (fgh) y &lt;-&gt; (xfy) g (xhy)</code> <br> <pre> <code class="vala hljs">(i<span class="hljs-number"><span class="hljs-number">.64</span></span>) ([ * =/~) P</code> </pre><br>  The result is a 64x64 matrix, where each row contains its number (say, i) at position P [i], and the remaining elements are filled with zeros. <br>  In addition to the fork, adverbs <code>/</code> and <code>~</code> are used: the first applies a verb to each element of the array, and the second changes the operands in places, so <br> <code>xf~ y &lt;-&gt; yfx</code> <br>  If we write <code>u/ y</code> , where <code>u</code> is a dyadic verb, J will substitute it between all elements of y: <br> <code>+/ 1 2 3 &lt;-&gt; 1 + 2 + 3</code> <br>  Or apply it to our matrix, adding up its lines and getting the final formula: </div></div><br><pre> <code class="vala hljs">iP =: +/ (i<span class="hljs-number"><span class="hljs-number">.64</span></span>) ([ * =/~) P</code> </pre><br><h5>  Matrix initial permutation key G </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/e2d/5e9/949/e2d5e99498c656ac3e622d2fdb95b93e.png"><br><br>  The 7th, 15th, and so on bits are ‚Äúthrown out‚Äù from the key - they serve to control parity. <br>  The pattern in G is not so obvious; nevertheless, it is easy to obtain the matrix G from an 8x8 matrix of consecutive numbers, from which the last column was simply thrown out. <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text"><pre> <code class="vala hljs"> }: |: i. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span></code> </pre><br><ul><li> <code>i. 8 8</code>  <code>i. 8 8</code> instead of an array of numbers immediately creates a matrix of 8x8 consecutive numbers. </li><li>  <code>}:</code> throws out the last element of the array / row of the matrix. </li></ul><br>  Transposing is rather a side effect, but it is in this form that we need the matrix. <br>  Now you need to invert the lines - if you just apply to the result <code>|.</code>  then swap the whole string.  In our case, you need to change the rank of the verb so that it works with each individual line: <br><pre> <code class="vala hljs"> |.<span class="hljs-string"><span class="hljs-string">"1 }: |: i. 8 8 56 48 40 32 24 16 8 0 57 49 41 33 25 17 9 1 58 50 42 34 26 18 10 2 59 51 43 35 27 19 11 3 60 52 44 36 28 20 12 4 61 53 45 37 29 21 13 5 62 54 46 38 30 22 14 6</span></span></code> </pre><br>  <code>"</code> changes the rank of a verb. A rank of 0 means that the verb is applied to each element of the operand, 1 to the row and 2 to the whole matrix. <br>  Save the result in the variable <code>G</code> - it will be more convenient. <br>  It is already clear that the first 28 elements of the matrix are exactly as we need; another 24 can be obtained by inverting the order of the rows.  The remaining four elements could not be gracefully pulled out of me, so just enter them as they are: <br><pre> <code class="vala hljs"> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> $ (<span class="hljs-number"><span class="hljs-number">28</span></span> {. , G), (<span class="hljs-number"><span class="hljs-number">24</span></span> {. , |. G), (<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">62</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br> <code>N {. y</code>  <code>N {. y</code> pulls the first <code>N</code> elements out of <code>y</code> . <br>  Save the result. </div></div><br><pre> <code class="vala hljs">G =: |.<span class="hljs-string"><span class="hljs-string">"1 }: |: i. 8 8 G =: (28 {. , G), (24 {. , |. G), (27 19 11 3)</span></span></code> </pre><br><h5>  KP key permutation matrix </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/640/6a6/0e06406a6bdf443f41589aebc3f51a10.png"><br><br>  Everything is sad here - patterns are not visible, so let's write the matrix as it is. <br><br><h5>  Shift matrix s </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/ceb/be7/aaa/cebbe7aaacd3e8b072809d51b512c45b.png"><br><br>  The first line is the indices, the second is the values.  I will not stop here in detail. <br><pre> <code class="vala hljs">s =:<span class="hljs-number"><span class="hljs-number">1</span></span>, (<span class="hljs-number"><span class="hljs-number">14</span></span> $ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span> $ <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><h5>  Expansion matrix E </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/9ae/1d3/a7e/9ae1d3a7e88f93fc6ebacfe6a09fb7cc.png"><br><br>  This matrix is ‚Äã‚Äãeasily obtained from <code>i. 8 4</code>  <code>i. 8 4</code> : the left column is cyclically shifted down and put to the matrix on the right, the right - move up and put on the left. <br><pre> <code class="vala hljs">E =: |: i. <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> E =: , |: (_1 |. _1 { E) , E , (<span class="hljs-number"><span class="hljs-number">1</span></span> |. <span class="hljs-number"><span class="hljs-number">0</span></span> { E)</code> </pre><br>  Operator <code>x |. y</code>  <code>x |. y</code> performs a cyclic shift of the array. <br><br><h5>  P2 permutation matrix <sub>(yes, there are many permutations in DES)</sub> </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/359/810/da9/359810da94090841bfe8114dcacd7382.png"><br><br>  Here, too, are not visible patterns.  Let's go further. <br><br><h5>  S transformation matrix </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/b79/3b6/ae3/b793b6ae35dd610cd975b86d7f16bd00.png"><br><br>  It is huge, three-dimensional, and there is absolutely no regularity in it either. <br>  We will write down this matrix as it is, and at the same time we will create a couple of verbs so that it will be easier to deal with later. <br><pre> <code class="vala hljs">f =: dyad : <span class="hljs-string"><span class="hljs-string">'|. #: S {~ &lt; x, ((5{y)++:0{y), (+/(2^i.4)*}:}.y)'</span></span> <span class="hljs-string"><span class="hljs-string">" 0 1 fS =: monad : '}. |."</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span> $ <span class="hljs-number"><span class="hljs-number">1</span></span>), (i<span class="hljs-number"><span class="hljs-number">.8</span></span>) f <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> $, y<span class="hljs-string"><span class="hljs-string">' " 2</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  Let's start with the second verb.  This is a monad with rank 2, which converts the matrix into an 8x6 format and gives it the right operand to the first verb.  The left operand is <code>i.8</code> .  Then a row of four units is added to the result, all rows of the matrix are inverted and the first row is deleted. <br><br>  The first verb is a dyad with the rank 0 1 (such a rank in the dyadic verb means that 0 is applied to the left operand and 1 to the right operand).  This verb assumes that the right operand is an array of bits of length 6. The 0th and 5th bits define the row number in S, bits 1 through 4 define the column number, and the left operand represents the number of the submatrix.  All three received numbers are pushed into the box (local analogue of the structure) and are passed to the operator input <code>{</code> - take from array by index.  Operator <code>#:</code> translates the result into a binary numeral system, which is inverted by the next step. <br><br>  This whole saga with inversions and adding-deleting a line of four units is needed to add leading zeros to the result lines: if they are not inverted initially, zeros are added at the end. </div></div><br><h4>  Getting down to business </h4><br>  First, we compile a list of keys that we will use (we assume that the <code>key</code> already defined): <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  First, we translate characters into binary representation by a samopisny monad (there will be no code in the article) and apply the initial key permutation matrix G to the result: <br><pre> <code class="vala hljs">binkey =. chr2bin key prmkey =. G { binkey</code> </pre><br>  Then take the first 28 bits of the result and make a list of the results of the shift: <pre> <code class="vala hljs">C =. (<span class="hljs-number"><span class="hljs-number">28</span></span> {. prmkey) |.~<span class="hljs-string"><span class="hljs-string">"1 0 +/\s</span></span></code> </pre><br>  From the new in this line only adverb <code>\</code> : it applies a verb to each prefix of the operand. <pre> <code class="vala hljs"> s <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> +/\s <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span></code> </pre><br>  Do the same with the last 28 bits: <pre> <code class="vala hljs">D =. (<span class="hljs-number"><span class="hljs-number">28</span></span> }. prmkey) |.~<span class="hljs-string"><span class="hljs-string">"1 0 +/\s</span></span></code> </pre><br> <code>N }. y</code>  <code>N }. y</code> drops the first <code>N</code> elements of <code>y</code> . <br>  Now we need to perform a concatenation of the corresponding strings and apply the KP key permutation matrix to each row of the result: <pre> <code class="vala hljs">K =. KP {<span class="hljs-string"><span class="hljs-string">"1 C ,"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> D</code> </pre></div></div><br><pre> <code class="vala hljs">binkey =. chr2bin key prmkey =. G { binkey C =. (<span class="hljs-number"><span class="hljs-number">28</span></span> {. prmkey) |.~<span class="hljs-string"><span class="hljs-string">"1 0 +/\s D =. (28 }. prmkey) |.~"</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> +/\s K =. KP {<span class="hljs-string"><span class="hljs-string">"1 C ,"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> D</code> </pre><br>  The original 8-byte text is divided into two 32-bit parts: <pre> <code class="vala hljs">bin =. chr2bin plain prm =. P { bin L =. <span class="hljs-number"><span class="hljs-number">32</span></span> {. prm R =. <span class="hljs-number"><span class="hljs-number">32</span></span> }. prm</code> </pre><br>  Now we need to apply each of the keys to the pair L, R as follows: <br><img src="http://upload.wikimedia.org/wikipedia/commons/2/2c/1.PNG" alt="image"><br><br>  To do this, create a recursive monad that accepts a box with three values ‚Äã‚Äãat the input and returns a similar box. <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  <code>&gt;</code> "Opens" the box, returning its contents. <pre> <code class="vala hljs">K =. &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { y L =. &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> { y R =. &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> { y</code> </pre><br>  The f function in the picture above does the following: <br><ol><li>  applies the expansion matrix E to R; </li><li>  adds the result with the modulo 2 key; </li><li>  for each six-bit result block, finds the corresponding four-bit number in the S matrix; </li><li>  applies the permutation matrix P2 to this; </li><li>  adds the result to the L modulo 2; </li></ol>  How fortunate that for paragraph 3 we have a special verb!  All previous is described by a simple line: <pre> <code class="vala hljs">L ~: P2 { , fS (<span class="hljs-number"><span class="hljs-number">0</span></span> { K) ~: E { R</code> </pre></div></div><br><pre> <code class="vala hljs">step =: monad define K =. &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { y L =. &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> { y R =. &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> { y (}. K); R ; L ~: P2 { , fS (<span class="hljs-number"><span class="hljs-number">0</span></span> { K) ~: E { R )</code> </pre><br><br>  And we will call it as many times as we have keys: <pre> <code class="vala hljs">result =. step^:(#K) K; L; R</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  From the new in this line only the union <code>u^:N</code> , which performs the verb u N times, that is, for example, <br> <code>u^:4 y &lt;-&gt; uuuuy</code> </div> </div><br>  Swap L and R again and get the encrypted text. <br><pre> <code class="vala hljs">R =. &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> { result L =. &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> { result bin2chr iP { ,L,R</code> </pre><br><br>  Let us turn everything into a dyad, which accepts a key with the left operand, and a right-hand one with an 8-byte array: <br><div class="spoiler">  <b class="spoiler_title">Long dyad here</b> <div class="spoiler_text"><pre> <code class="vala hljs">encode =: dyad define key =. x binkey =. chr2bin key prmkey =. G { binkey C =. (<span class="hljs-number"><span class="hljs-number">28</span></span> {. prmkey) |.~<span class="hljs-string"><span class="hljs-string">"1 0 +/\s D =. (28 }. prmkey) |.~"</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> +/\s K =. KP {<span class="hljs-string"><span class="hljs-string">"1 C ,"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> D plain =. y bin =. chr2bin plain prm =. P { bin L =. <span class="hljs-number"><span class="hljs-number">32</span></span> {. prm R =. <span class="hljs-number"><span class="hljs-number">32</span></span> }. prm result =. step^:(#K) K; L; R R =. &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> { result L =. &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> { result bin2chr iP { ,L,R )</code> </pre></div></div><br>  Decryption is performed in the same way, with the only difference that the keys are applied in the reverse order. <br><br>  Before applying what we have, you need to prepare the text: <br><br>  in.txt: <br> <code>Lorem ipsum dolor sit amet consectetur adipiscing elit.</code> <br> <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  <code>1!:1</code> reads the contents of the file <pre> <code class="vala hljs">plaintext =: <span class="hljs-number"><span class="hljs-number">1</span></span>!:<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-string"><span class="hljs-string">'in.txt'</span></span></code> </pre><br>  Since the algorithm works with blocks of 8 characters, it is better to fill the tail with spaces, otherwise the text will simply be repeated: <pre> <code class="vala hljs"><span class="hljs-string"><span class="hljs-string">' '</span></span>,~^:(<span class="hljs-number"><span class="hljs-number">8</span></span> - <span class="hljs-number"><span class="hljs-number">8</span></span>| # plaintext) plaintext</code> </pre><br>  And now we will break the text into blocks of 8 characters. <pre> <code class="vala hljs">plaintext =: (<span class="hljs-number"><span class="hljs-number">8</span></span>,~ &gt;. <span class="hljs-number"><span class="hljs-number">8</span></span> %~ #plaintext) $, <span class="hljs-string"><span class="hljs-string">' '</span></span>,~^:(<span class="hljs-number"><span class="hljs-number">8</span></span> - <span class="hljs-number"><span class="hljs-number">8</span></span>| # plaintext) plaintext</code> </pre></div></div><pre> <code class="vala hljs">plaintext =: <span class="hljs-number"><span class="hljs-number">1</span></span>!:<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-string"><span class="hljs-string">'in.txt'</span></span> plaintext =: (<span class="hljs-number"><span class="hljs-number">8</span></span>,~ &gt;. <span class="hljs-number"><span class="hljs-number">8</span></span> %~ #plaintext) $, <span class="hljs-string"><span class="hljs-string">' '</span></span>,~^:(<span class="hljs-number"><span class="hljs-number">8</span></span> - <span class="hljs-number"><span class="hljs-number">8</span></span>| # plaintext) plaintext</code> </pre><br><br>  Let's write the result to the file. <br><div class="spoiler">  <b class="spoiler_title">Explanations</b> <div class="spoiler_text">  <code>1!:21</code> opens the file, <code>1!:22</code> closes, and <code>1!:2</code> writes to the file </div></div><br><pre> <code class="vala hljs">out =: <span class="hljs-number"><span class="hljs-number">1</span></span>!:<span class="hljs-number"><span class="hljs-number">21</span></span> &lt; <span class="hljs-string"><span class="hljs-string">'out.txt'</span></span> (<span class="hljs-string"><span class="hljs-string">'habrhabr'</span></span> encode<span class="hljs-string"><span class="hljs-string">"1 1 plaintext) 1!:2 out 1!:22 out</span></span></code> </pre><br>  out.txt: <br> <code>4acc c8ad 32dd 96a1 ae9c 2fdc 2025 e3d0 968c 97c0 5544 0944 2d20 2069 f943 f0d4 e98d bdea 71f9 c516 8a0a b034 5641 b0b5 53cc 2355 2fb1 4bde</code> <br> <br>  And try to decipher the result. <br><pre> <code class="vala hljs"> cipher =: <span class="hljs-number"><span class="hljs-number">1</span></span>!:<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; <span class="hljs-string"><span class="hljs-string">'out.txt'</span></span> cipher =: (<span class="hljs-number"><span class="hljs-number">8</span></span>,~ &gt;. <span class="hljs-number"><span class="hljs-number">8</span></span> %~ #cipher) $, cipher , <span class="hljs-string"><span class="hljs-string">'habrhabr'</span></span> decode<span class="hljs-string"><span class="hljs-string">"1 1 cipher Lorem ipsum dolor sit amet consectetur adipiscing elit.</span></span></code> </pre><br><br>  The code is entirely on the <a href="http://pastebin.com/2U6UyJ9u">peystbin</a> . <br><br><blockquote>  If you have any questions, suggestions or corrections to the code, welcome to the comments. </blockquote><br>  Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/202822/">https://habr.com/ru/post/202822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202806/index.html">FOSS Sea Conference Program</a></li>
<li><a href="../202808/index.html">Half-Life has turned 15 today.</a></li>
<li><a href="../202810/index.html">WPF> PDF via PDFSharp.Xps: fixing hyperlink output</a></li>
<li><a href="../202818/index.html">Podcasts Devops Deflope - Issue 003</a></li>
<li><a href="../202820/index.html">Cache-Conscious Binary Search</a></li>
<li><a href="../202824/index.html">E-commerce in Universal Analytics</a></li>
<li><a href="../202830/index.html">Flying robotaksi easier to do than unmanned vehicles</a></li>
<li><a href="../202832/index.html">Profiling and debugging Python tools</a></li>
<li><a href="../202836/index.html">Say a word about organic photovoltaics. Part 2</a></li>
<li><a href="../202838/index.html">NX-ecosystem, optics, 2.1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>