<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up a dedicated Source server for Linux, part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Install MetaMod and SourceMod Install MetaMod: Source Install SourceMod 
- Install MetaMod: Source 
- Install SourceMod 
- Autostart game servers 
-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up a dedicated Source server for Linux, part 3</h1><div class="post__text post__text-html js-mediator-article"><ul><li>  Install MetaMod and SourceMod <br><ul><li>  Install MetaMod: Source </li><li>  Install SourceMod </li></ul></li><li>  Autostart game servers </li><li>  Logs <br><ul><li>  Cron logs </li><li>  Steam client logs </li><li>  Web server logs </li><li>  Log SourceMod </li><li>  Game server logs </li><li>  Log server statistics </li></ul></li><li>  Binding to Steam and QuickPlay <br><ul><li>  Server account </li><li>  Quickplay <a name="habracut"></a></li></ul></li></ul><br><h1 id="ustanovka-metamod-i-sourcemod">  Install MetaMod and SourceMod </h1><br><p>  It is time to bring a fresh stream into the process of setting up the coexistence of our servers, namely, add MetaMod and SourceMod. </p><br><h2 id="ustanovka-metamodsource">  Install MetaMod: Source </h2><br><p>  First, install the MetaMod: Source plugin, which does not add any game functions, but only provides the interface between the Source engine, the game and other plugins. </p><br><p>  Homepage - <a href="http://www.metamodsource.net/">http://www.metamodsource.net/</a> </p><br><p>  Download the latest version and unpack the archive. </p><br><pre><code class="bash hljs">$ wget http://cdn.probablyaserver.com/sourcemod/mmsource-1.10.6-linux.tar.gz $ tar -xvzf mmsource-1.10.6-linux.tar.gz -C ~/tf2/tf</code> </pre> <br><p>  In the ~ / tf2 / tf directory, the addons subdirectory will be created (we will install other mods in it), and the metamod directory with a number of files for various Source games, including Team Fortress 2, will be created in it: </p><br><pre> <code class="hljs axapta"> addons/ addons/metamod.vdf ... addons/metamod/bin/metamod<span class="hljs-number"><span class="hljs-number">.2</span></span>.tf2.so addons/metamod/bin/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.so ... addons/metamod/metaplugins.ini</code> </pre> <br><p>  The srcds game server at startup checks the presence of the ~ / tf2 / tf / addons directory, searches for * .vdf files in it, in which the paths to the plug-in libraries should be specified in the "file" parameter.  In our case, just in this file ~ / tf2 / tf / addons / metamod.vdf the MetaMod plugin is connected: Source as "addons / metamod / bin / server" (the path is indicated relative to ~ / tf2 / tf /). </p><br><p>  Now we will install SourceMod and connect it to MetaMod. </p><br><h2 id="ustanovka-sourcemod">  Install SourceMod </h2><br><p>  Homepage - <a href="http://www.sourcemod.net/">http://www.sourcemod.net/</a> </p><br><p>  Go to <a href="http://www.sourcemod.net/downloads.php%3Fbranch%3Dstable">http://www.sourcemod.net/downloads.php?branch=stable</a> , download the latest version for Linux and unpack the archive </p><br><pre> <code class="bash hljs"> $ wget https://sm.alliedmods.net/smdrop/1.8/sourcemod-1.8.0-git5947-linux.tar.gz $ tar -xvzf sourcemod-1.8.0-git5947-linux.tar.gz -C ~/tf2/tf</code> </pre> <br><p>  The sourcemod directory appeared in ~ / tf2 / tf / addons, the sourcemod directory in ~ / tf2 / tf / cfg /, and in <br>  ~ / tf2 / tf / addons / metamod - sourcemod.vdf file. </p><br><pre> <code class="hljs coffeescript"> addons<span class="hljs-regexp"><span class="hljs-regexp">/metamod/sourcemod.vdf addons/sourcemod/</span></span> addons<span class="hljs-regexp"><span class="hljs-regexp">/sourcemod/scripting/</span></span> addons/sourcemod/configs/core.cfg ... cfg/sourcemod/sm_warmode_off.cfg cfg/sourcemod/sm_warmode_on.cfg cfg/sourcemod/sourcemod.cfg</code> </pre> <br><p>  Since a single SourceMod installation <a href="https://wiki.alliedmods.net/Multiple_or_Forked_Servers_(SourceMod)">cannot</a> simultaneously serve several servers, we need to expand by the number of servers.  In the addons directory, we rename sourcemod to sourcemod1 and copy it with all content to sourcemod2, having first run dos2unix for the configuration files for convenience: </p><br><pre> <code class="bash hljs"> $ mv ~/tf2/tf/addons/sourcemod ~/tf2/tf/addons/sourcemod1 $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/tf2/tf/addons/sourcemod1/configs $ dos2unix *.cfg *.ini *.txt $ cp -r ~/tf2/tf/addons/sourcemod1 ~/tf2/tf/addons/sourcemod2</code> </pre> <br><p>  MetaMod finds and connects SourceMod thanks to the file addons / metamod / sourcemod.vdf.  But this file is one, and we need two different ones for each server.  MetaMod has a parameter pointing to the directory (not the file!) With the configuration, so we will create two directories cfg1 and cfg2 and put sourcemod.vdf there, which we will edit. </p><br><pre> <code class="hljs ruby"> $ mkdir ~<span class="hljs-regexp"><span class="hljs-regexp">/tf2/tf</span></span><span class="hljs-regexp"><span class="hljs-regexp">/addons/metamod</span></span><span class="hljs-regexp"><span class="hljs-regexp">/cfg{1,2} $ dos2unix ~/tf</span></span>2/tf/addons/metamod/sourcemod.vdf $ mv ~<span class="hljs-regexp"><span class="hljs-regexp">/tf2/tf</span></span><span class="hljs-regexp"><span class="hljs-regexp">/addons/metamod</span></span><span class="hljs-regexp"><span class="hljs-regexp">/sourcemod.vdf ~/tf</span></span>2/tf/addons/metamod/cfg1/sourcemod.vdf $ cp ~<span class="hljs-regexp"><span class="hljs-regexp">/tf2/tf</span></span><span class="hljs-regexp"><span class="hljs-regexp">/addons/metamod</span></span><span class="hljs-regexp"><span class="hljs-regexp">/cfg1/sourcemod</span></span>.vdf ~<span class="hljs-regexp"><span class="hljs-regexp">/tf2/tf</span></span><span class="hljs-regexp"><span class="hljs-regexp">/addons/metamod</span></span><span class="hljs-regexp"><span class="hljs-regexp">/cfg2/sourcemod</span></span>.vdf</code> </pre> <br><p>  We edit these files, correcting the paths to the SourceMod installations (also relative to ~ / tf2 / tf): </p><br><p>  ~ / tf2 / tf / addons / metamod / cfg1 / sourcemod.vdf: </p><br><div class="spoiler">  <b class="spoiler_title">cfg1 / sourcemod.vdf</b> <div class="spoiler_text"><pre> <code class="hljs json"><span class="hljs-string"><span class="hljs-string">"Metamod Plugin"</span></span> { <span class="hljs-attr"><span class="hljs-attr">"alias"</span></span> <span class="hljs-attr"><span class="hljs-attr">"sourcemod"</span></span> <span class="hljs-attr"><span class="hljs-attr">"file"</span></span> <span class="hljs-attr"><span class="hljs-attr">"addons/sourcemod1/bin/sourcemod_mm"</span></span> }</code> </pre> </div></div><br><p>  ~ / tf2 / tf / addons / metamod / cfg2 / sourcemod.vdf (fix 1 -&gt; 2): </p><br><div class="spoiler">  <b class="spoiler_title">cfg2 / sourcemod.vdf</b> <div class="spoiler_text"><pre> <code class="hljs json"><span class="hljs-string"><span class="hljs-string">"Metamod Plugin"</span></span> { <span class="hljs-attr"><span class="hljs-attr">"alias"</span></span> <span class="hljs-attr"><span class="hljs-attr">"sourcemod"</span></span> <span class="hljs-attr"><span class="hljs-attr">"file"</span></span> <span class="hljs-attr"><span class="hljs-attr">"addons/sourcemod2/bin/sourcemod_mm"</span></span> }</code> </pre> </div></div><br><p>  For convenience, we make symbolic links to directories with settings and logs: </p><br><pre> <code class="bash hljs"> $ ln -s ~/tf2/tf/addons/metamod/cfg1 ~/cfg/mm1 $ ln -s ~/tf2/tf/addons/metamod/cfg2 ~/cfg/mm2 $ ln -s ~/tf2/tf/addons/sourcemod1/configs ~/cfg/sm1 $ ln -s ~/tf2/tf/addons/sourcemod2/configs ~/cfg/sm2 $ ln -s ~/tf2/tf/addons/sourcemod1/logs ~/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/sm1 $ ln -s ~/tf2/tf/addons/sourcemod2/logs ~/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/sm2</code> </pre> <br><p>  You do not need to register any separate commands to start MetaMod - the game server will launch it automatically, but we need to specify various directories to download SourceMod. </p><br><p>  In the file ~ / cfg / autoexec1.cfg for the first server we append to the end: </p><br><div class="spoiler">  <b class="spoiler_title">autoexec1.cfg</b> <div class="spoiler_text"><pre> <code class="hljs sql">//... // <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> SourceMod <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mm_basedir addons/metamod/cfg1</code> </pre> </div></div><br><p>  For the second server in ~ / cfg / autoexec2.cfg it is the same, only instead of "cfg1" -&gt; "cfg2": </p><br><div class="spoiler">  <b class="spoiler_title">autoexec2.cfg</b> <div class="spoiler_text"><pre> <code class="hljs sql">//... // <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> SourceMod <span class="hljs-keyword"><span class="hljs-keyword">instance</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> mm_basedir addons/metamod/cfg2</code> </pre> </div></div><br><p>  Now MetaMod knows where to download SourceMod, but the latter does not know where to get its settings from.  Let's write the paths for each SourceMod.  Unlike MetaMod, the parameters we have to specify as much in the command line to start the server.  Neither in autoexec.cfg, nor in server.cfg they work. </p><br><p>  In the start1.sh and start2.sh start scripts, in the CMDLINE we add: </p><br><div class="spoiler">  <b class="spoiler_title">start1.sh</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">CMDLINE</span></span>=<span class="hljs-string"><span class="hljs-string">"... +sm_basepath addons/sourcemod1 +sm_corecfgfile addons/sourcemod1/configs/core.cfg \ ...</span></span></code> </pre> </div></div><br><p>  This is for the first server.  For the second server it is similar, only instead of "sourcemod1" -&gt; "sourcemod2": </p><br><div class="spoiler">  <b class="spoiler_title">start2.sh</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">CMDLINE</span></span>=<span class="hljs-string"><span class="hljs-string">"... +sm_basepath addons/sourcemod2 +sm_corecfgfile addons/sourcemod2/configs/core.cfg \ ...</span></span></code> </pre> </div></div><br><p>  The sm_corecfgfile parameter is required, since the path to core.cfg is not taken from the sm_basepath, which would be logical to assume. </p><br><p>  To check, you can start the first game server and when it starts up completely, enter it in its console (commands are marked with angle brackets): </p><br><pre> <code class="hljs ruby"> <span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>meta version <span class="hljs-symbol"><span class="hljs-symbol">Metamod:</span></span>Source version <span class="hljs-number"><span class="hljs-number">1.10</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span> Built <span class="hljs-symbol"><span class="hljs-symbol">from:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/github.com/alliedmodders</span></span><span class="hljs-regexp"><span class="hljs-regexp">/metamod-source/commit</span></span><span class="hljs-regexp"><span class="hljs-regexp">/9fed12f Build ID: 946:9fed12f Loaded As: Valve Server Plugin Compiled on: Sep 12 2015 Plugin interface version: 15:14 SourceHook version: 5:5 http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/www.metamodsource.net/</span></span> &gt;&gt;&gt; mm_basedir <span class="hljs-string"><span class="hljs-string">"mm_basedir"</span></span> = <span class="hljs-string"><span class="hljs-string">"addons/metamod/cfg1"</span></span> ( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">. "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addons</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">metamod</span></span></span><span class="hljs-function">" ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">singleplayer</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">-</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Metamod</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Source</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Folder</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;&gt;</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">meta</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Listing</span></span></span><span class="hljs-function"> 4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plugins</span></span></span><span class="hljs-function">: [01] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SourceMod</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.8</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5907</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> by AlliedModders LLC [<span class="hljs-number"><span class="hljs-number">02</span></span>] TF2 Tools (<span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span>) by AlliedModders LLC [<span class="hljs-number"><span class="hljs-number">03</span></span>] SDK Hooks (<span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span>) by AlliedModders LLC [<span class="hljs-number"><span class="hljs-number">04</span></span>] SDK Tools (<span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span>) by AlliedModders LLC &gt;&gt;&gt; meta info <span class="hljs-number"><span class="hljs-number">1</span></span> Plugin <span class="hljs-number"><span class="hljs-number">1</span></span> is running. <span class="hljs-symbol"><span class="hljs-symbol">Name:</span></span> <span class="hljs-string"><span class="hljs-string">"SourceMod"</span></span> by AlliedModders LLC <span class="hljs-symbol"><span class="hljs-symbol">Version:</span></span> <span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Description:</span></span> Extensible administration and scripting system <span class="hljs-symbol"><span class="hljs-symbol">License:</span></span> See LICENSE.txt <span class="hljs-symbol"><span class="hljs-symbol">URL:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/www.sourcemod.net/</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Details:</span></span> API <span class="hljs-number"><span class="hljs-number">015</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">Date:</span></span> Apr <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-symbol"><span class="hljs-symbol">File:</span></span> /home/game/tf2/tf/addons/sourcemod1/bin/sourcemod_mm_i486.so &gt;&gt;&gt; sm_basepath <span class="hljs-string"><span class="hljs-string">"sm_basepath"</span></span> = <span class="hljs-string"><span class="hljs-string">"addons/sourcemod1"</span></span> ( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">. "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addons</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sourcemod</span></span></span><span class="hljs-function">" ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">-</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SourceMod</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">path</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(set via command line)</span></span></span></span> &gt;&gt;&gt; sm_corecfgfile <span class="hljs-string"><span class="hljs-string">"sm_corecfgfile"</span></span> = <span class="hljs-string"><span class="hljs-string">"addons/sourcemod1/configs/core.cfg"</span></span> ( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">. "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addons</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sourcemod</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configs</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">core</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cfg</span></span></span><span class="hljs-function">" ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">-</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SourceMod</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">core</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configuration</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;&gt;</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plugins</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SM</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Listing</span></span></span><span class="hljs-function"> 17 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plugins</span></span></span><span class="hljs-function">: 01 "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Admin</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Menu</span></span></span><span class="hljs-function">" </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.8</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5907</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> by AlliedModders LLC ... <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-string"><span class="hljs-string">"Player Commands"</span></span> (<span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span>) by AlliedModders LLC &gt;&gt;&gt; sm exts list [SM] Displaying <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-symbol"><span class="hljs-symbol">extensions:</span></span> [<span class="hljs-number"><span class="hljs-number">01</span></span>] Automatic Updater (<span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span>): Updates SourceMod gamedata files ... [09] SQLite (<span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5907</span></span>): SQLite Driver</code> </pre> <br><p>  Well, all the paths to directories and files are correct, seventeen standard plug-ins and nine extensions are running.  Later we will analyze who does what, but for now we will continue. </p><br><p>  If, on entering commands, errors of the following type are issued: </p><br><pre> <code class="hljs ruby"> <span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>meta list Listing <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-symbol"><span class="hljs-symbol">plugin:</span></span> [<span class="hljs-number"><span class="hljs-number">01</span></span>] &lt;FAILED&gt; &gt;&gt;&gt; sm_basepath Unknown command <span class="hljs-string"><span class="hljs-string">"sm_basepath"</span></span></code> </pre> <br><p>  That means MetaMod could not download SourceMod.  We must look for what is the matter. </p><br><p>  List of MetaMod console commands: Source - <a href="https://wiki.alliedmods.net/Console_Commands_%2528SourceMM%2529">Console Commands (SourceMM)</a> </p><br><p>  Extensions are located in the ~ / tf2 / tf / addons / sourcemod {1,2} / extensions directory - for all supported games on the Source engine, not just TF2. </p><br><p>  Compiled plugins are located in the ~ / tf2 / tf / addons / sourcemod {1,2} / plugins directory.  If you want to disable any plugin, then you can simply move it to the disabled subdirectory.  The source code for the plugins is in the ~ / tf2 / tf / addons / sourcemod {1,2} / scripting directory.  There is also a compiler and compile.sh script that compiles the sources and places the compiled plugins in the compiled subdirectory, from where they can be transferred to ~ / tf2 / tf / addons / sourcemod {1.2} / plugins - and they will be available for use by SourceMod. </p><br><p>  You can now configure SourceMod for each server by editing the core.cfg files in ~ / tf2 / tf / addons / sourcemod {1,2} / configs.  In our case, we are satisfied with the default settings.  Please note that with this option "DisableAutoUpdate No" the auto update <a href="http://wiki.alliedmods.net/Gamedata_Updating_(SourceMod)">of the</a> SourceMod <a href="http://wiki.alliedmods.net/Gamedata_Updating_(SourceMod)">game data</a> in the ~ / tf2 / tf / addons / sourcemod {1,2} / gamedata directories is enabled. </p><br><p>  It is also possible to set the "LogMode" parameter in the core.cfg of the "game" value - then the logs will not be written to separate files, but to the logs of the game server.  Read more in the section "Logs" </p><br><p>  Other configuration files will be analyzed later. </p><br><p>  However, there is another configuration file - ~ / tf2 / tf / cfg / sourcemod / sourcemod.cfg - it runs every time the cards follow the server.cfg and is common to all SourceMod installations.  Therefore, we leave in sourcemod.cfg only commands common to both servers, and the individual ones are transferred into separate files for each server. </p><br><pre> <code class="bash hljs"> $ dos2unix ~/tf2/tf/cfg/sourcemod/sourcemod.cfg $ cp ~/tf2/tf/cfg/sourcemod/sourcemod.cfg ~/cfg/sourcemod_default.cfg $ ln -s ~/tf2/tf/cfg/sourcemod ~/cfg/sm</code> </pre> <br><p>  We edit ~ / tf2 / tf / cfg / sourcemod / sourcemod.cfg, we traditionally add the output "echo", fix the "sm_show_activity" and set the usual date / time format in "sm_datetime_format". </p><br><div class="spoiler">  <b class="spoiler_title">sourcemod.cfg</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">echo "*** ~/tf2/tf/cfg/sourcemod/sourcemod.cfg" // SourceMod <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> File // This file <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> automatically executed <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> SourceMod every mapchange. // Specifies how <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> activity should be relayed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> users. sm_show_activity <span class="hljs-number"><span class="hljs-number">28</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> datetime formatting rules <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> displaying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> clients. sm_datetime_format "%d %b %Y - %H:%M:%S"</code> </pre> </div></div><br><p>  Everything.  The rest is deleted.  Later, when you want to set your own parameters for servers, you can take them from the saved ~ / cfg / sourcemod_default.cfg and specify them in some server configuration file.  Why you can not leave everything as it is - in the original sourcemod.cfg?  And because it is executed every time there is a change of cards following server {1,2} .cfg - that is, any settings, for example, regarding backup slots, specified in server {1,2} .cfg will be overwritten by default values ‚Äã‚Äãfrom this file.  And we will configure the same backup slots for our servers in different ways. </p><br><blockquote>  When installing SourceMod plug-ins, their configuration files can be automatically created in ~ / tf2 / tf / cfg / sourcemod / and become common to both SourceMod installations.  Actually, there is already a file with settings for the plugin funcommands.smx </blockquote><p>  Also SourceMod by default periodically downloads from its server (update.sourcemod.net) updates of files with game data, which will be reflected in the logs.  Using the example of the first server (~ / tf2 / tf / addons / sourcemod1 / logs /), lines 3,4,5: </p><br><pre> <code class="hljs mel"> L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>: SourceMod <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> session started (<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"L20140321.log"</span></span>) (Version <span class="hljs-string"><span class="hljs-string">"1.5.3"</span></span>) L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>: -------- Mapchange to cp_well -------- L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>: [UPDATER] Successfully updated gamedata <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"sdkhooks.games/engine.csgo.txt"</span></span> L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>: [UPDATER] Successfully updated gamedata <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"sdktools.games/engine.csgo.txt"</span></span> L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>: [UPDATER] Successfully updated gamedata <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"sm-cstrike.games/game.csgo.txt"</span></span> L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>: [UPDATER] SourceMod has been updated, please reload it or restart your server. L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>: SourceMod <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> session started (<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"L20140321.log"</span></span>) (Version <span class="hljs-string"><span class="hljs-string">"1.5.3"</span></span>) L <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">21</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>: -------- Mapchange to cp_well --------</code> </pre> <br><p>  SourceMod documentation - <a href="https://wiki.alliedmods.net/SourceMod_Configuration">setup</a> , <a href="https://wiki.alliedmods.net/Managing_your_Sourcemod_installation">management</a> , small <a href="http://forums.alliedmods.net/showthread.php%3Ft%3D69092">FAQ</a> (eng). </p><br><p>  Since the next Team Fortress 2 updates may break the fragile interaction between the game and SourceMod, it makes sense to keep track of new versions and builds and be updated regularly. </p><br><p>  Continuation with the description of plug-in settings and interactive interaction of players with the server is described in the "SourceMod plug-ins" section, but for now let's move on to setting up the launch of servers. </p><br><h1 id="avtozapusk-igrovyh-serverov">  Autostart game servers </h1><br><p>  Our game servers are already old enough to include them in autorun.  For systems with System V init, you can redo the previously created startup scripts, or use the examples from the <a href="http://wiki.teamfortress.com/wiki/Linux_dedicated_server">TF2 Wiki</a> .  For systems with systemd, like ours, we are doing two service files, plainly called srcds1.service and srcds2.service. </p><br><p>  For reference, to refresh the material: After all the additions (Records, SourceMod), the startup script of the same first ~ / start1.sh server in its complete set should look something like this: </p><br><div class="spoiler">  <b class="spoiler_title">start1.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # #   . #     ,    srcds_run GAMEFOLDER=/home/game/tf2 CMDLINE="+sv_pure 2 -game tf +maxplayers 24 \ -pidfile ${GAMEFOLDER}/tf/srcds1.pid \ -ugcpath ${GAMEFOLDER}/steamapps/workshop1 \ -replay reply1.cfg -replayserverdir server1 \ +exec autoexec1.cfg +servercfgfile server1.cfg \ -port 27015 -steamport 26900 +clientport 27005 +tv_port 27020 -strictportbind \ +sm_basepath addons/sourcemod1 +sm_corecfgfile addons/sourcemod1/configs/core.cfg" #    ${GAMEFOLDER}/srcds_run ${CMDLINE}</span></span></code> </pre> </div></div><br><p>  We have become accustomed to the srcds_run script, so we will continue to use it.  It is only necessary to attend to automatic restart of the game server when executing commands <code>quit</code> , <code>_restart</code> .  Now the script restarts the server only if it ended abnormally with a non-zero exit code, or zero if auto-update is enabled. </p><br><p>  Several options.  The first is that you can simply enable the standard auto update (section "Automatic" in the section "Update servers").  The second is to create a copy of the script with a different name and correct it for the eternal restart of the server (you should not edit the original script - it can be replaced during the upgrade) and use it in the future.  Third, if you plan to update the server yourself, then you can enable auto-update by adding -autoupdate and its two satellite parameters to the launch command line, but using ~ / cfg / tf2_quit, which consists of only one line with the quit command, as an auto-update script that is, in fact, updates will not be checked. </p><br><p>  Knowledge multiplies sadness.  But the choice is yours.  In our case, for the first server, we have not yet specified the criteria for the end of the rounds in the configuration files, and the second server will generally have non-standard maps, it is quite possible that with infinite rounds, so in the autorun we will use the third option - with a dummy autoupdate, and The real update is through the regular launch of the update.sh script in the crontab.  Again, so interesting. </p><br><p>  So, service files.  For convenience, we will use the tmux terminal multiplexer (anyone can use screen instead), which will run the srcds_run script.  The command line parameters passed almost unchanged from the startup scripts that we used before. </p><br><p>  Since the game servers are started on behalf of the game user, then in an amicable way, it would be possible to create startup files in the user's environment, in ~ / .config / systemd / user /.  But this section of the documentation was tested on centos 7, where running systemd in user mode does not function, so we create service files as root. </p><br><p>  We go as root, create the file /etc/systemd/system/srcds1.service for the first server. </p><br><div class="spoiler">  <b class="spoiler_title">srcds1.service</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/systemd/system/srcds1.service # # Team Fortress 2 Source Dedicated Server [Unit] Description=Team Fortress 2 Source Dedicated Server No 1 After=network.target [Service] User=game Group=game WorkingDirectory=/home/game/Steam Type=oneshot RemainAfterExit=yes PIDFile=/home/game/tf2/tf/srcds1.pid ExecStart=/usr/bin/tmux -L socket1 new-session -d '/home/game/tf2/srcds_run \ +sv_pure 2 -game tf +maxplayers 24 \ -pidfile /home/game/tf2/tf/srcds1.pid \ -ugcpath /home/game/tf2/steamapps/workshop1 \ -replay replay1.cfg -replayserverdir server1 \ +exec autoexec1.cfg +servercfgfile server1.cfg \ -port 27015 -steamport 26900 +clientport 27005 +tv_port 27020 -strictportbind \ -autoupdate -steam_dir /home/game/Steam -steamcmd_script /home/game/cfg/tf2_quit \ +sm_basepath addons/sourcemod1 +sm_corecfgfile addons/sourcemod1/configs/core.cfg' ExecStop=/usr/bin/tmux -L socket1 send-keys "quit" Enter ; /usr/bin/sleep 5s ; /usr/bin/tmux -L socket1 kill-session ExecReload=/usr/bin/tmux -L socket1 send-keys "_restart" Enter ExecStopPost=/usr/bin/rm -f /home/game/tf2/tf/srcds1.pid [Install] WantedBy=multi-user.target</span></span></code> </pre> </div></div><br><p>  A small explanation of the parameters ExecStop and ExecReload.  To shut down the server, we send him the rays of love and the <code>quit</code> command to the console, wait a few seconds to complete the work, and, until everything is started again, we beat the session.  A similar mechanism for restarting the server.  If you wish, you can add a warning message to players about the upcoming restart - as it was in the example of one of the update scripts in the appropriate section. </p><br><p>  Copy srcds1.service in srcds2.service, adjust the paths, ports and the name of the tmux socket.  We save.  /etc/systemd/system/srcds2.service: </p><br><div class="spoiler">  <b class="spoiler_title">srcds2.service</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/systemd/system/srcds2.service # # Team Fortress 2 Source Dedicated Server [Unit] Description=Team Fortress 2 Source Dedicated Server No 2 After=network.target [Service] User=game Group=game WorkingDirectory=/home/game/Steam Type=oneshot RemainAfterExit=yes PIDFile=/home/game/tf2/tf/srcds2.pid ExecStart=/usr/bin/tmux -L socket2 new-session -d '/home/game/tf2/srcds_run \ +sv_pure 2 -game tf +maxplayers 24 \ -pidfile /home/game/tf2/tf/srcds2.pid \ -ugcpath /home/game/tf2/steamapps/workshop2 \ -replay replay2.cfg -replayserverdir server2 \ +exec autoexec2.cfg +servercfgfile server2.cfg \ -port 27016 -steamport 26901 +clientport 27006 +tv_port 27021 -strictportbind \ -autoupdate -steam_dir /home/game/Steam -steamcmd_script /home/game/cfg/tf2_quit \ +sm_basepath addons/sourcemod2 +sm_corecfgfile addons/sourcemod2/configs/core.cfg' ExecStop=/usr/bin/tmux -L socket2 send-keys "quit" Enter ; /usr/bin/sleep 5s ; /usr/bin/tmux -L socket2 kill-session ExecReload=/usr/bin/tmux -L socket2 send-keys "_restart" Enter ExecStopPost=/usr/bin/rm -f /home/game/tf2/tf/srcds2.pid [Install] WantedBy=multi-user.target</span></span></code> </pre> </div></div><br><p>  Here we specifically launch two separate copies of tmux, each for its own game server.  One could, of course, get by with sessions inside a single tmux (tmux new-session -d -s tf1 and tmux new-session -d -s tf2), but then this would be an additional point for epic fail - when inadvertent Ctrl-C nailed all our servers. </p><br><p>  Do not forget to create the file ~ / cfg / tf2_quit with the contents: </p><br><div class="spoiler">  <b class="spoiler_title">tf2_quit</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">quit</span></span></code> </pre> </div></div><br><p>  We check that both .service files are writable only for root, then run, turn on: </p><br><pre> <code class="dos hljs"> # systemctl <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> srcds1 # systemctl <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> srcds2 # systemctl enable srcds1 # systemctl enable srcds2</code> </pre> <br><p>  But now we have a stupid situation - the game servers start when our server starts, but the game user cannot control them in standard ways using systemctl (start, stop, reload), although it can quite well be "managed" with Ctrl + C in a tmux session , followed by manual start.  We correct the injustice. </p><br><p>  While we are still root, run <code>visudo</code> , adjust the sudoers file by appending to the end: </p><br><div class="spoiler">  <b class="spoiler_title">sudoers</b> <div class="spoiler_text"><pre> <code class="hljs sql">Defaults:game !requiretty game ALL= NOPASSWD: /usr/bin/systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> srcds1.service, /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> srcds2.service game ALL= NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> srcds1.service, /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> srcds2.service game ALL= NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl reload srcds1.service, /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl reload srcds2.service game ALL= NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> srcds1.service, /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> srcds2.service game ALL= NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> srcds1.service, /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> srcds2.service game ALL= NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> srcds1.service, /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> srcds2.service</code> </pre> </div></div><br><p>  Here we provide the game user with the ability to use sudo, without requesting a password (which he does not have), to execute the start, stop, reload, status commands and for the enable heap enable with disable for the first and second servers.  And the parameter "Defaults: game! Requiretty" will allow us to run sudo from the crontab file.  Optionally, you can add permission to use other commands such as is- * and others. </p><br><p>  Permissions for commands like <code>systemctl edit [--full]</code> will not be granted.  Still, security must be ... safe. </p><br><p>  We leave from under root, we check from under game: </p><br><pre> <code class="bash hljs"> $ sudo -l</code> </pre> <br><pre> <code class="hljs sql"> Matching Defaults entries for game on this host: ... ..., !requiretty User game may run the following commands on this host: (root) NOPASSWD: /usr/bin/systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> srcds1.service, (root) /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> srcds2.service (root) NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> srcds1.service, (root) /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> srcds2.service (root) NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl reload srcds1.service, (root) /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl reload srcds2.service (root) NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> srcds1.service, (root) /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> srcds2.service (root) NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> srcds1.service, (root) /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> srcds2.service (root) NOPASSWD: /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> srcds1.service, (root) /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/systemctl <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> srcds2.service</code> </pre> <br><p>  You can immediately run <code>sudo systemctl status srcds1.service</code> , <code>sudo systemctl status srcds1.service</code> it. </p><br><p>  Commands will need to be entered without reducing the parameters.  That is, sudo systemctl status srcds1.service is normal, but sudo systemctl status srcds1 is no longer a cake. </p><br><p>  If, when manipulating game servers using systemctl, an error of the form "Failed to stop srcds1.service: Interactive authentication required." Is issued  - that means you forgot about sudo :-) </p><br><p>  When everything works, it will be possible to work with server consoles already as a game user, connecting via tmux: </p><br><pre> <code class="hljs ruby"> $ tmux -L socket1 attach $ tmux -L socket2 attach</code> </pre> <br><p>  Disconnect from tmux session - Ctrl + b, d. </p><br><p>  You can set up aliases in ~ / .bash_profile: </p><br><div class="spoiler">  <b class="spoiler_title">.bash_profile</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> tf1=<span class="hljs-string"><span class="hljs-string">"tmux -L socket1 attach"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> tf2=<span class="hljs-string"><span class="hljs-string">"tmux -L socket2 attach"</span></span></code> </pre> </div></div><br><p>  By default, the size of the stored history for tmux is 2,000 lines, but it can be increased, for example, to 10,000 lines by creating a ~ / .tmux.conf file like this: </p><br><div class="spoiler">  <b class="spoiler_title">.tmux.conf</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> -g history-<span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">option</span></span> -g <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-remain-<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span></code> </pre> </div></div><br><p>  The second command does not close the tmux session at the end of the main program, which makes it possible to read its last simple console. </p><br><p>  Move through the history - Ctrl + b, [, and then the usual keys - Up / Down, PgUp / PgDown.  The output from this mode is q. </p><br><h1 id="logi">  Logs </h1><br><p>  Logs we will have a lot and different.  Namely: </p><br><h2 id="logi-cron">  Cron logs </h2><br><p>  We run scripts to check for updates, HLstatsX statistics server, delete obsolete Records through cron, and their output is reflected in / var / log / cron as </p><br><pre> <code class="hljs sql"> Jun 15 12:55:01 server CROND[584]: (game) CMD (cd $HOME/stat/scripts &amp;&amp; ./run_hlstats <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">27500</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) Jun <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> CROND[<span class="hljs-number"><span class="hljs-number">583</span></span>]: (game) CMDOUT (HLstatsX:CE daemon control) Jun <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> CROND[<span class="hljs-number"><span class="hljs-number">583</span></span>]: (game) CMDOUT (<span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://www.hlxce.com) Jun <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> CROND[<span class="hljs-number"><span class="hljs-number">583</span></span>]: (game) CMDOUT (<span class="hljs-comment"><span class="hljs-comment">---------------------------) Jun 15 12:55:01 server CROND[583]: (game) CMDOUT (Daemon is already running on port 27500) Jun 15 12:55:01 server CROND[583]: (game) CMDOUT (Daemon is already running on port 27501) ...</span></span></code> </pre> <br><p>  Since no one can read / var / log / cron except the root user, which is not interesting to him, I would like to give the game user access to the logs of his crontab file.  Of course, for each script at the end of the startup line you can add something like "... &gt;&gt; $ HOME / log / cron.log" but these "logs" will be without time stamps, and indeed, amateur work.  A more cultural variant "... | / usr / bin / logger - tag srcds" doesn‚Äôt change anything - well, there will be messages not in / var / log / cron, but in / var / log / messages, the difference is. </p><br><p>  Therefore, in the rsyslog daemon settings, we will make messages from cron starting with the user name "(game)" redirected to the file /home/game/log/cron.log, which is owned by the game user, and do not go into further processing (in "cron. * / var / log / cron") </p><br><p>  We have rsyslogd version 8.19 installed, and in /etc/rsyslog.conf the <code>$IncludeConfig /etc/rsyslog.d/*.conf</code> /etc/rsyslog.d/*.conf directive is located before the <code>cron.* /var/log/cron</code> rule <code>cron.* /var/log/cron</code> , so we will intercept the messages from our scripts as the root user, the /etc/rsyslog.d/srcds-10-cron.conf file with the contents: </p><br><div class="spoiler">  <b class="spoiler_title">srcds-10-cron.conf</b> <div class="spoiler_text"><pre> <code class="hljs mel"># /etc/rsyslog.d/srcds<span class="hljs-number"><span class="hljs-number">-10</span></span>-cron.conf <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $syslogfacility-<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> == <span class="hljs-string"><span class="hljs-string">"cron"</span></span> and $msg startswith <span class="hljs-string"><span class="hljs-string">" (game)"</span></span> then { action( type = <span class="hljs-string"><span class="hljs-string">"omfile"</span></span> fileOwner = <span class="hljs-string"><span class="hljs-string">"game"</span></span> fileGroup = <span class="hljs-string"><span class="hljs-string">"game"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> = <span class="hljs-string"><span class="hljs-string">"/home/game/log/cron.log"</span></span> ) stop }</code> </pre> </div></div><br><p>     ‚Äî <a href="http://www.rsyslog.com/doc/master/configuration/modules/omfile.html">omfile</a> , <a href="http://www.rsyslog.com/doc/master/configuration/properties.html">properties</a> . </p><br><p>  ,   ok,       . </p><br><pre> <code class="dos hljs"> # rsyslogd -N <span class="hljs-number"><span class="hljs-number">2</span></span> # systemctl restart rsyslog</code> </pre> <br><p>    root,   ,   /etc/logrotate.d/srcds-cron: </p><br><div class="spoiler"> <b class="spoiler_title">srcds-cron</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">#/etc/logrotate.d/srcds-cron /home/game/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/cron.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> { su game game daily dateext maxage <span class="hljs-number"><span class="hljs-number">3</span></span> missingok copytruncate compress notifempty }</code> </pre> </div></div><br><p>  Checking: </p><br><pre> <code class="dos hljs"> # logrotate --debug --force /etc/logrotate.d/srcds-cron</code> </pre> <br><h2 id="logi-klienta-steam">   Steam </h2><br><p>     ~/Steam/logs/.   ,   .     <code>*.previous.txt</code> ,  <code>*.previous.txt</code>  .      , -      ‚Äî         ,        Valve     ‚Äî nobody cares... </p><br><h2 id="logi-veb-servera">  - </h2><br><p>         -, : </p><br><ul><li> Fast Download,   /var/www/fastdl.example.org/log/ </li><li>  (Replay),   /var/www/replay.example.org/log/ </li><li> HLstatsX,   /var/www/stat.example.org/log/ </li></ul><br><p>        /etc/logrotate.d/srcds-nginx, ,       ,       Elasticsearch, Kibana  Logstash ‚Äî   ELK     . </p><br><h2 id="logi-sourcemod">  SourceMod </h2><br><p>      ~/tf2/tf/addons/sourcemod{1,2}/logs.      ~/tf2/tf/addons/sourcemod{1,2}/configs/core.cfg: </p><br><p> <code>Logging on</code> <br>  / </p><br><p> <code>LogMode daily</code> <br>   ‚Äî  (daily),    (map),    (game) ‚Äî     . </p><br><p> <code>DebugSpew no</code> <br>        </p><br><p>  SourceMod   ,      ,       core.cfg  <code>LogMode game</code> ,        , - : </p><br><pre> <code class="hljs pgsql"> L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span>: Executing dedicated <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> config file server1.cfg L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>: server_cvar: "sv_tags" "HLstatsX:CE,cp,increased_maxplayers" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>: tf_server_identity_account_id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> logging <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> registered account L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>: server_cvar: "sv_contact" "game@example.org" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: [UPDATER] Successfully updated gamedata file "core.games/common.games.txt" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: [UPDATER] Successfully updated gamedata file "sdkhooks.games/game.doi.txt" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: [UPDATER] Successfully updated gamedata file "sdkhooks.games/master.games.txt" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: [UPDATER] Successfully updated gamedata file "sdktools.games/game.doi.txt" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: [UPDATER] Successfully updated gamedata file "sdktools.games/master.games.txt" L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: [UPDATER] SourceMod has been updated, please reload it <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> your <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>. L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Steam servers successful. L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Public</span></span> IP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">192.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>. L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: Assigned anonymous gameserver Steam ID [A:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">123456789</span></span>:<span class="hljs-number"><span class="hljs-number">1234</span></span>]. L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span>: VAC secure mode <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> activated. L <span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>: server_cvar: "sm_nextmap" "cp_well"</code> </pre> <br><h2 id="logi-igrovyh-serverov">    </h2><br><p>      ~/log/server{1,2}/.         ,       : </p><br><p> <code>log off</code> <br>   (on)     .      (sv_logfile),    (sv_logecho),   UDP (logaddress_add). </p><br><p> <code>sv_logfile 1</code> <br>      (1),      .          sv_logsdir  sv_logfilename_format. </p><br><p> <code>sv_logsdir logs</code> <br>   .  ,   ~/tf2/tf/logs,            ,   /home/game/log/server1  /home/game/log/server2 . , ,       ,     . </p><br><p> <code>sv_log_onefile 0</code> <br>       (1),       (0), : l0618000.log -&gt; l0618001.log -&gt; l0618002.log‚Ä¶ l0619000.log -&gt; l0619001.log   .       : -,        l0618000.log -&gt; l0619000.log  ; -,      -    log off    log on,      ,   . </p><br><p> <code>sv_logfilecompress 0</code> <br>       ,    gzip    <code>&lt;logfilename&gt;.log.gz</code> .  ,   Linux . ,      "1"    (,   sv_log_onefile = "0"      ),     ,   .gz ,      .   -       ‚Äî "l" vs "L",    Linux: </p><br><pre> <code class="hljs vbscript"> ---- Host_Changelevel ---- Compressing /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server2/L0713019.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server2/L0713019000.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.gz... Success. Removing /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server2/L0713019.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>. Unable <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> remove /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server2/L0713019.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>! Unable <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> remove /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server2/L0713019.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>! <span class="hljs-built_in"><span class="hljs-built_in">Server</span></span> logging data <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> file /home/game/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/server2/L0713020.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> Applying <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> item schema, version <span class="hljs-number"><span class="hljs-number">5</span></span>C0BC93D</code> </pre> <br><p> <code>sv_logfilename_format ""</code> <br>     .     "log on".    ,        <code>l&lt;&gt;&lt;&gt;&lt;000...999&gt;.log</code> ,    ‚Äî <code>&lt;Latin Small Letter L&gt;</code> ,           ,    .    ,     <a href="https://www.google.ru/search%3Fq%3Dstrftime">strftime</a> .  ,   "sv_logfilename_format %Y%m%d"     "20160714.log".       20160714.log -&gt; 20160714_000.log -&gt; 20160714_001.log   . ,     ,    sv_logfilecompress ‚Äî     . </p><br><p> <code>log_verbose_enable 0</code> <br>  (1)   . ,    ( log_verbose_interval)      .   . , ,          ,    . -  <a href="http://geit.uk/blog/player-flow/">http://geit.uk/blog/player-flow/</a> . </p><br><p> <code>log_verbose_interval 3.0</code> <br>     .   ‚Äî  3 . </p><br><p> <code>sv_rcon_log 1</code> <br>   (0),         rcon  (      -).      rcon   HLstatsX,       ,         ,   : </p><br><pre> <code class="hljs cs"> rcon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"192.0.2.0:60533"</span></span>: command <span class="hljs-string"><span class="hljs-string">"status"</span></span> rcon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"192.0.2.0:60533"</span></span>: command <span class="hljs-string"><span class="hljs-string">"hlx_sm_psay "</span></span><span class="hljs-number"><span class="hljs-number">30</span></span><span class="hljs-string"><span class="hljs-string">" 2 "</span></span>Round Over - All actions/frags are ignored &lt;...&gt; rcon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"192.0.2.0:60533"</span></span>: command <span class="hljs-string"><span class="hljs-string">"hlx_sm_psay "</span></span><span class="hljs-number"><span class="hljs-number">30</span></span><span class="hljs-string"><span class="hljs-string">" 1 "</span></span>Red got <span class="hljs-number"><span class="hljs-number">10</span></span> points <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Round Win<span class="hljs-string"><span class="hljs-string">""</span></span> rcon <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"192.0.2.0:60533"</span></span>: command <span class="hljs-string"><span class="hljs-string">"hlx_sm_psay "</span></span><span class="hljs-number"><span class="hljs-number">30</span></span><span class="hljs-string"><span class="hljs-string">" 1 "</span></span>Asuka got <span class="hljs-number"><span class="hljs-number">2</span></span> points (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">025</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kill Assist<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><p> <code>sv_logecho 1</code> <br>     . ,  (0). </p><br><p> <code>sv_logbans 0</code> <br>   (1)       : </p><br><pre> <code class="hljs cs"> L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">13</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>: Addip: <span class="hljs-string"><span class="hljs-string">"&lt;&gt;&lt;&gt;&lt;&gt;"</span></span> was banned <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> IP <span class="hljs-string"><span class="hljs-string">"for 10.00 minutes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">"Console"</span></span> (IP <span class="hljs-string"><span class="hljs-string">"10.1.1.1"</span></span>)</code> </pre> <br><p> <code>logaddress_add</code> <br>  : ,      UDP,     HLstatsX.     192.0.2.0:27500,  ‚Äî 192.0.2.0:27501 </p><br><p> <code>logaddress_del</code> <br>  :   . </p><br><p> <code>logaddress_delall</code> <br>      </p><br><p> <code>developer 0</code> <br>        .   ‚Äî 0 ( ), 1, 2, 3... </p><br><p>         ,         ‚Äî   ,   ,       . </p><br><p>            3.5 ‚Äî 4.0 .   ,  0.5 ‚Äî 0.6 . </p><br><p>     ,        logrotate   copytruncate   ,            ( ,  sv_log_onefile 0).     copytruncate        (  ‚Äî    ,    sv_logflush 1,     ,   ,  )       ,  ,     ,      "Binary file (standard input) matches". </p><br><p>  ,        : </p><br><ol><li><p>  .   .          .      . </p><br></li><li><p> .            "sv_log_onefile 0", "sv_logfilecompress 1"  "sv_logfilename_format %Y%m%d",   crontab <code>find $HOME/log/server{1,2}/*.gz -type f -mtime +30 -delete</code> ,     logrotate. ,  .   ""           ,     ,          ‚Äî   crontab   <code>tmux -L socket1 send-keys "changelevel_next" Enter</code>    . </p><br></li><li> .         , -    ,     rsyslog .  omfile ‚Äî File Output Module       cron,     imfile ‚Äî Text File Input Module. </li></ol><br><p>          . C (- root)  /etc/rsyslog.d/srcds-20-chat.conf: </p><br><div class="spoiler"> <b class="spoiler_title">srcds-20-chat.conf</b> <div class="spoiler_text"><pre> <code class="hljs lua">#/etc/rsyslog.d/srcds<span class="hljs-number"><span class="hljs-number">-20</span></span>-chat.conf module(<span class="hljs-built_in"><span class="hljs-built_in">load</span></span>=<span class="hljs-string"><span class="hljs-string">"imfile"</span></span> mode=<span class="hljs-string"><span class="hljs-string">"inotify"</span></span>) #   *.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>    <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = <span class="hljs-string"><span class="hljs-string">"imfile"</span></span> tag = <span class="hljs-string"><span class="hljs-string">"srcds1:"</span></span> file = <span class="hljs-string"><span class="hljs-string">"/home/game/log/server1/*.log"</span></span> ruleset = <span class="hljs-string"><span class="hljs-string">"chat-1"</span></span> ) # $now -  ,    ,   YYYY-MM-DD template (name=<span class="hljs-string"><span class="hljs-string">"chat1-log-name"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"string"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>=<span class="hljs-string"><span class="hljs-string">"/home/game/log/chat1-%$now%.log"</span></span>) #    (say),  (say_team),  steam id  ip ,    ruleset(name = <span class="hljs-string"><span class="hljs-string">"chat-1"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($msg contains [<span class="hljs-string"><span class="hljs-string">" say "</span></span>, <span class="hljs-string"><span class="hljs-string">" say_team "</span></span>, <span class="hljs-string"><span class="hljs-string">" connected, address "</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> { action( <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = <span class="hljs-string"><span class="hljs-string">"omfile"</span></span> fileOwner = <span class="hljs-string"><span class="hljs-string">"game"</span></span> fileGroup = <span class="hljs-string"><span class="hljs-string">"game"</span></span> dynafile = <span class="hljs-string"><span class="hljs-string">"chat1-log-name"</span></span> ) } }</code> </pre> </div></div><br><p>   ,     : </p><br><pre> <code class="hljs pgsql"> Jul <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> srcds1: L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">23</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>: "Asuka&lt;3&gt;&lt;[U:1:12345678]&gt;&lt;Blue&gt;" say_team "Valar morgh≈´lis" Jul <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> srcds1: L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">23</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>: "Rei&lt;4&gt;&lt;[U:1:09876543]&gt;&lt;Blue&gt;" say "Valar dohaeris, desu"</code> </pre> <br><p>    rsyslogd ‚Äî +,   (),   input,    .        .                   ( <a href="http://www.rsyslog.com/doc/v8-stable/configuration/modules/ommail.html">ommail</a>  rsyslog) </p><br><p>  ,   ok,   . </p><br><pre> <code class="dos hljs"> # rsyslogd -N <span class="hljs-number"><span class="hljs-number">2</span></span> # systemctl restart rsyslog</code> </pre> <br><blockquote>         ,    ( file   input),  ,           input,   rsyslogd.    , ‚Ä¶ . </blockquote><p>     ,     : </p><br><p> <code>con_logfile ""</code> <br>    ,        .       ,    ~/tf2/tf/ ( logs!).     ".log",    .      <code>-consolelog &lt;file&gt;</code> ‚Äî      ,     ‚Äî       :     <code>~/tf2/bin/&lt;file&gt;</code> ,   <code>~/tf2/tf/&lt;file&gt;</code> ,     <code>~/tf2/tf/&lt;file&gt;.log</code> . </p><br><p> <code>con_timestamp 0</code> <br>   (1),         ,    .          ,  <code>+con_timestamp 1 -consolelog &lt;file&gt;</code> ,       . </p><br><p>     ,      ,     logrotate   copytruncate. </p><br><p>       ,   .     - ,         : </p><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: player: <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">72483.898438</span></span>/<span class="hljs-number"><span class="hljs-number">65536.000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SendPropFloat <span class="hljs-string"><span class="hljs-string">'m_flLastDamageTime'</span></span>, clamping. <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: player: <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">72492.539062</span></span>/<span class="hljs-number"><span class="hljs-number">65536.000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SendPropFloat <span class="hljs-string"><span class="hljs-string">'m_flLastDamageTime'</span></span>, clamping. <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: player: <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">72479.742188</span></span>/<span class="hljs-number"><span class="hljs-number">65536.000000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SendPropFloat <span class="hljs-string"><span class="hljs-string">'m_flLastDamageTime'</span></span>, clamping.</code> </pre> <br><p>   ,   ~ 125   ,         ~ 64   , 1.5   ,      "" ,         .    ,    ,       ,  ,    ,     . </p><br><p>     ,  - root  /etc/logrotate.d/srcds-server: </p><br><div class="spoiler"> <b class="spoiler_title">srcds-server</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">#/etc/logrotate.d/srcds-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> /home/game/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/console*.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> { su game game daily dateext rotate <span class="hljs-number"><span class="hljs-number">7</span></span> copytruncate notifempty missingok compress # compresscmd /home/game/logrotate-<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>.sh }</code> </pre> </div></div><br><p>   : </p><br><pre> <code class="dos hljs"> # logrotate --debug --force /etc/logrotate.d/srcds-server</code> </pre> <br><p>     ‚Äî  "compresscmd /home/game/logrotate-filter.sh",   ~/logrotate-filter.sh : </p><br><div class="spoiler"> <b class="spoiler_title">logrotate-filter.sh</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh /bin/grep -v </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">": DataTable warning:"</span></span></span><span class="hljs-meta"> | /bin/gzip -6</span></span></code> </pre> </div></div><br><p>         gzip   ,      grep,  DataTable warning,    gzip, as planned. </p><br><p> ,   ‚Äî       (sv_logecho 1),     (sv_logfile 0)    ,      .      : </p><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> info_particle_system): <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">-1.000000</span></span> / <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>: Attempted <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> job <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> job queue that has already been completed <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> info_particle_system): <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">-1.000000</span></span> / <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>: L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>: "GLaDOS&lt;20&gt;&lt;BOT&gt;&lt;Red&gt;" triggered "player_builtobject" <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>: L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>: "Companion Cube&lt;34&gt;&lt;BOT&gt;&lt;Blue&gt;" killed "GLaDOS&lt;20&gt;&lt;BOT&gt;&lt;Red&gt;" <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> "knife" <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span>: L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">24</span></span>: "AimBot&lt;23&gt;&lt;BOT&gt;&lt;Red&gt;" triggered "domination" against "DeadHead&lt;10&gt;&lt;BOT&gt;&lt;Blue&gt;" <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>: L <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>: "AimBot&lt;23&gt;&lt;BOT&gt;&lt;Red&gt;" triggered "killedobject" (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> "OBJ_SENTRYGUN") <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: info_particle_system: <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">1.000000</span></span>/<span class="hljs-number"><span class="hljs-number">1.000000</span></span>) <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>/<span class="hljs-number"><span class="hljs-number">2016</span></span> - <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>: DataTable <span class="hljs-built_in"><span class="hljs-built_in">warning</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> info_particle_system): <span class="hljs-keyword"><span class="hljs-keyword">Out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>-range <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> (<span class="hljs-number"><span class="hljs-number">-1.000000</span></span> / <span class="hljs-number"><span class="hljs-number">-1.000000</span></span>)</code> </pre> <br><p>   ‚Äî        .     (con_timestamp 0),     .       rsyslog,  ruleset    regex        .    . </p><br><h2 id="logi-servera-statistiki">    </h2><br><p>   HLstatsX    ,      ~/stat/scripts/logs/,        ,    ,     ,   ,   ~/stat/scripts/hlstats.conf  "DebugLevel 0" </p><br><h1 id="privyazka-k-steam-i-quickplay">   Steam  QuickPlay </h1><br><p>          ( 2  7): </p><br><pre> <code class="hljs vhdl"> Setting breakpad minidump AppID = <span class="hljs-number"><span class="hljs-number">232250</span></span> No account token specified; logging into anonymous game server account. (<span class="hljs-keyword"><span class="hljs-keyword">Use</span></span> sv_setsteamaccount <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> login <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a persistent account.) ConVarRef room_type doesn<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> point <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> an existing ConVar Executing dedicated server config <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> server1.cfg ... Connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> game coordinator established. tf_server_identity_account_id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> set; <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> logging into registered account *** ~/cfg/server1.cfg ...</code> </pre> <br><p>   ,      - Valve "" (  ,     ...),      .   ‚Äî  ,      QuickPlay.  . </p><br><h2 id="servernaya-uchyotnaya-zapis">    </h2><br><p>    ,    2014  ‚Äî <a href="https://list.valvesoftware.com/cgi-bin/mailman/private/hlds_announce/2014-February/000863.html">hlds_announce</a> ,    , , <a href="https://www.mail-archive.com/hlds_linux%40list.valvesoftware.com/msg74576.html"></a> .         ‚Äî Counter-Strike: Global Offensive  Team Fortress 2,     .     ,    .  ‚Äî        ,        ,      .    ‚Äî   Valve,         (   CS:GO)   ,   ip  ,    Steam  ,           .   ‚Äî   Steam,      -.       CS:GO, . </p><br><p>     .    Valve  2014         api  <a href="http://steamcommunity.com/dev">http://steamcommunity.com/dev</a> ,      IGameServersService/CreateAccount   .        ,   (XXI   )    <a href="http://steamcommunity.com/dev/managegameservers">http://steamcommunity.com/dev/managegameservers</a> ,    .       .     : </p><br><ul><li>   Steam    . </li><li>   Steam    . </li><li>    Steam      . </li><li>    Steam   ,      . </li><li>     1000   . </li></ul><br><p>      ,     ,   .   Steam,     (.1 ‚Äî ok),     5 USD (.2 ‚Äî ok),       (.3 ‚Äî ok),     Team Fortress 2 (.4 ‚Äî ok).      "Do VAC and Game bans apply to all accounts on a phone number?"  [ ] ( <a href="https://support.steampowered.com/kb_article.php%3Fref%3D8625-WRAH-9030">https://support.steampowered.com/kb_article.php?ref=8625-WRAH-9030</a> ),      ,    .    ,  Steam Guard  : </p><br><p><img src="https://habrastorage.org/files/723/27c/21c/72327c21cec54b95a0d416d13603fea2.png" alt="Game server login token"></p><br><p>     ,     <a href="https://steamcommunity.com/dev/managegameservers">https://steamcommunity.com/dev/managegameservers</a> , ,   ,          . . . </p><br><p><img src="https://habrastorage.org/files/2e9/9cb/ba0/2e99cbba0b434c69acd045b08fd4188a.png" alt="Create game server login token"></p><br><p>   ,       gameserver login token: </p><br><p><img src="https://habrastorage.org/files/069/afe/f80/069afef8063c4adfb52323b18aef8b60.png" alt="New game server login token"></p><br><p>     ~/cfg/autoexec1.cfg: </p><br><div class="spoiler"> <b class="spoiler_title">autoexec1.cfg</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//... // Steam Gameserver Account sv_setsteamaccount 3A820F219B470281C00IDDQD00A4D210</span></span></code> </pre> </div></div><br><p>   ,  ( 2  8): </p><br><pre> <code class="hljs vhdl"> Setting breakpad minidump AppID = <span class="hljs-number"><span class="hljs-number">232250</span></span> Logging into Steam game server account ConVarRef room_type doesn<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> point <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> an existing ConVar Executing dedicated server config <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> server1.cfg ... Connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Steam servers successful. Public IP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">192.0</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>. Assigned persistent gameserver Steam ID [G:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>]. VAC secure mode <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> activated.</code> </pre> <br><p>   "Assigned anonymous gameserver Steam ID [A:1:1724597452:5521]"      Steam ID ‚Äî [G:1:21]. "G" ‚Äî GameServer,    "A" ‚Äî AnonGameServer.  ‚Äî  <a href="https://developer.valvesoftware.com/wiki/SteamID">wiki</a> . </p><br><p>      Team Fortress 2  ,  , ,   ,    .   <code>C:\Program Files\Steam\userdata\&lt; id&gt;\7\remote\</code> .     serverbrowser_hist.vdf,      .       ,        ( 9): </p><br><pre> <code class="hljs objectivec"> <span class="hljs-string"><span class="hljs-string">"Favorites"</span></span> { <span class="hljs-string"><span class="hljs-string">"4"</span></span> { <span class="hljs-string"><span class="hljs-string">"name"</span></span> <span class="hljs-string"><span class="hljs-string">"192.0.2.0:27015"</span></span> <span class="hljs-string"><span class="hljs-string">"address"</span></span> <span class="hljs-string"><span class="hljs-string">"192.0.2.0:27015"</span></span> <span class="hljs-string"><span class="hljs-string">"LastPlayed"</span></span> <span class="hljs-string"><span class="hljs-string">"1476177442"</span></span> <span class="hljs-string"><span class="hljs-string">"appid"</span></span> <span class="hljs-string"><span class="hljs-string">"0"</span></span> <span class="hljs-string"><span class="hljs-string">"accountid"</span></span> <span class="hljs-string"><span class="hljs-string">"21"</span></span> } }</code> </pre> <br><p>  accountid   ,      . </p><br><p>    ,                 "Regenerate token"   ,    . </p><br><p>         : </p><br><pre> <code class="hljs pgsql"> Could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> establish <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Steam servers. (Result = <span class="hljs-number"><span class="hljs-number">106</span></span>) enum_names.cpp (<span class="hljs-number"><span class="hljs-number">136</span></span>) : <span class="hljs-keyword"><span class="hljs-keyword">Assertion</span></span> Failed: Missing String <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> EResult (<span class="hljs-number"><span class="hljs-number">106</span></span>)</code> </pre> <br><p> ,  ,      ‚Äî    ,      .    <a href="http://steamcommunity.com/dev/managegameservers">http://steamcommunity.com/dev/managegameservers</a> ,      .   Steam Web API Key    <a href="https://api.steampowered.com/IGameServersService/GetAccountList/v0001/%3Fkey%3DSteam_Web_API_Key">IGameServersService</a> ‚Äî   login_token   is_expired. </p><br><h2 id="quickplay"> QuickPlay </h2><br><p> UPDATE,     :    the quickplay system is no longer in use for Team Fortress 2. </p><br><p><img src="https://habrastorage.org/files/c84/bde/f78/c84bdef783284936af60f32b3009ec9d.png" alt="quickplay"></p><br><p>      . </p><br><p>          QuickPlay.       ,        <a href="https://support.steampowered.com/kb_article.php%3Fref%3D2825-AFGJ-3513">https://support.steampowered.com/kb_article.php?ref=2825-AFGJ-3513</a> .       ‚Äî    ,  ,        .      ,   ,    .       sv_setsteamaccount   ,  ,         Steam,      ,    ‚Äî   ,    .   Team Fortress 2,     ‚Äî <code>~</code> ,    cl_gameserver_create_identity.    : </p><br><pre> <code class="hljs vbscript"> cl_gameserver_create_identity <span class="hljs-built_in"><span class="hljs-built_in">Request</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> create a game <span class="hljs-built_in"><span class="hljs-built_in">server</span></span> account sent--please wait. Game <span class="hljs-built_in"><span class="hljs-built_in">server</span></span> account created successfully! <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> these convars <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> your game <span class="hljs-built_in"><span class="hljs-built_in">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> have it <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> receive benefits: tf_server_identity_account_id <span class="hljs-number"><span class="hljs-number">284181</span></span> tf_server_identity_token <span class="hljs-string"><span class="hljs-string">"18a&gt;qPosnHYia?a"</span></span></code> </pre> <br><p>         ~/cfg/autoexec1.cfg: </p><br><div class="spoiler"> <b class="spoiler_title">autoexec1.cfg</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//... // QuickPlay tf_server_identity_account_id 284181 tf_server_identity_token "18a&gt;qPosnHYia?a"</span></span></code> </pre> </div></div><br><p>   ,  ( 2, 9, 10): </p><br><pre> <code class="hljs delphi"> Connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> game coordinator established. Received auth challenge; signing into gameserver account... *** ~/cfg/server1.cfg ... Connection <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Steam servers successful. <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> IP <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">192.0</span></span>.<span class="hljs-number"><span class="hljs-number">2.0</span></span>. Assigned persistent gameserver Steam ID [G:<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>]. VAC secure mode <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> activated. Game server authentication: SUCCESS! Standing: Good. Trend: Steady Successfully logged into gameserver account <span class="hljs-number"><span class="hljs-number">284181</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> more information about gameserver accounts, visit https:<span class="hljs-comment"><span class="hljs-comment">//support.steampowered.com/kb_article.php?ref=2825-AFGJ-3513.</span></span></code> </pre> <br><p>  ,  ,      . </p><br><p>       QuickPlay,     autoexec1.cfg   .    tf_server_identity_disable_quickplay 1. </p><br><p>  ,  Valve,  tf_server <em>identity</em>      . </p><br><ul><li> <a href="https://habrahabr.ru/post/312922/"> 1</a> ‚Äî   Steam   Team Fortress 2,  ,  </li><li> <a href="https://habrahabr.ru/post/312928/"> 2</a> ‚Äî  (Replay), SourceTV, Fast Download,  </li><li> <a href="https://habrahabr.ru/post/312936/"> 4</a> ‚Äî   HLstatsX </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/312934/">https://habr.com/ru/post/312934/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312924/index.html">On the specifics of the renewal of domain names in international zones</a></li>
<li><a href="../312926/index.html">Launch i2pd in the Docker container on CentOS 7</a></li>
<li><a href="../312928/index.html">Setting up a dedicated Source server for Linux, part 2</a></li>
<li><a href="../312930/index.html">What is new in licensing Windows Server 2016 and how can you avoid unnecessary expenses?</a></li>
<li><a href="../312932/index.html">Algorithm of reading books on programming</a></li>
<li><a href="../312936/index.html">Setting up a Source Source Server for Linux, Part 4</a></li>
<li><a href="../312940/index.html">Free courses, books and other development materials</a></li>
<li><a href="../312942/index.html">What's new in Swift 3?</a></li>
<li><a href="../312948/index.html">How I created seamless Wi-Fi</a></li>
<li><a href="../312950/index.html">Simplicity criteria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>