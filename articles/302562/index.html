<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to set up two-factor authentication for login and sudo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Security is in fashion, as it should be. We live in a world where data is an incredibly valuable currency that you always risk losing. Therefore, you ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to set up two-factor authentication for login and sudo</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/638/0ea/cdf/6380eacdf2c242c4bf9fde58fb009f1f.png"><br><br>  Security is in fashion, as it should be.  We live in a world where data is an incredibly valuable currency that you always risk losing.  Therefore, you must do everything to make sure that what you keep on servers and desktops is safe.  To do this, administrators and users create incredibly complex passwords, use password managers, etc.  But what if I tell you that you can log in to your servers and Linux desktops in two steps instead of one?  You can do this with Google Authenticator.  Moreover, it is incredibly easy to set up. <br><br>  I'm going to walk you through the process of setting up two-factor authentication for use on login and <i>sudo</i> .  I will demonstrate this on desktop Ubuntu 16.04, but the process also works for the server.  To cope with the two-factor side of things, I will use <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.google.android.apps.authenticator2">Google Authenticator</a> . <br><a name="habracut"></a><br>  There is one very important caveat: once you configure this, you will not be able to log in (or use the <i>sudo command</i> ) without a six-digit code from the authenticator.  One more step is added for you, so if you get a smartphone every time you need to login to your Linux machine (or use <i>sudo</i> ), this is a problem for you, perhaps this method is not for you.  But remember, be that as it may, this extra step brings you an extra layer of protection that would not otherwise exist. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After that, let's do the setup. <br><br><h2>  Installing the necessary components </h2><br>  There are two pieces of this puzzle that should be installed together as a Google Authenticator.  The first is a smartphone app.  Here's how to install it from the Google Play Store: <br><br><ol><li>  Open the Google Play Store on your Android device. </li><li>  Find through the search " <i>google authenticator</i> " </li><li>  Tapnite by name from Google Inc. </li><li>  Tapnite "Install" </li><li>  Tapnite ‚ÄúAccept‚Äù </li><li>  Wait for the installation to complete. </li></ol><br>  Now let's move on to installing the authenticator on your linux machine.  Like this: <br><br><ol><li>  Open terminal window </li><li> Run the <code>sudo apt-get install libpam-google-authenticator</code> </li><li>  Enter your sudo password and press Enter </li><li>  If prompted, type y and press Enter. </li><li>  Wait for the installation to complete. </li></ol><br>  Now it's time to configure the authentication process to work with <i>google-authenticator</i> . <br><br><h2>  Configuration </h2><br>  You need to edit just one file to add two-factor authentication for login and <i>sudo at</i> once.  This is the /etc/pam.d/common-auth file.  Open it and find the line: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">auth</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[success=1 default=ignore]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pam_unix</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.so</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nullok_secure</span></span></code> </pre><br>  Above this line add the following: <br><br><pre> <code class="hljs swift">auth <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> pam_google_authenticator.so</code> </pre><br>  Save and close the file. <br><br>  The next step is to set up <i>google-authenticator</i> for each user in the system (otherwise they will not be able to login).  For example, suppose you have two users on your system: <i>jack</i> and <i>olivia</i> .  First we set it up for <i>jack</i> (suppose this is the account that we worked with all this time). <br><br>  Open a terminal window and run the <code>google-authenticator</code> command.  You will be asked a series of questions (each of which should be answered by y).  Questions such: <br><br><ul><li>  Do you want me to update your "/home/jack/.google_authenticator" file?  (y / n) y </li><li>  Do you want to prohibit multiple uses of the same token?  This limits you to a single entry attempt about once every 30 seconds, but increases the chances of noticing or even preventing a man-in-the-middle attack.  (y / n) y </li><li>  By default, tokens are good for 30 seconds, and in order to compensate for the possible time skews between the client and the server, we provide an additional token before and after the current time.  If you experience problems with poor-quality time synchronization, you can increase the window from its default value of 1:30 minutes, to about 4 minutes.  Want to do this?  (y / n) y </li><li>  If your computer to which you are logged in is not protected from brute force attempts to log in, you can enable the frequency limit for the authentication module.  By default, this limits attackers to no more than 3 attempts to log in every 30 seconds.  Want to enable frequency limiting?  (y / n) y </li></ul><br>  By answering these questions, you will be provided with a secret key, verification code and five emergency scratch codes.  Print out the scratch codes and keep them with you.  These codes can be used if you do not have your smartphone with you (each code can be used only once).  The secret key is what you use to set up your account in the Google Authenticator application, and the verification code is a one-time code that you can use immediately (if necessary). <br><br><h2>  Application setup </h2><br>  You now have a customized user <i>jack</i> .  Before you can configure the <i>olivia</i> user, you need to add an account for <i>jack</i> to the Google Authenticator application.  Open the application and tap the menu button from the main window (three vertical dots in the upper right corner).  Tap ‚ÄúConfigure account‚Äù and then tap ‚ÄúEnter key‚Äù.  In the next window (Image 1), you will enter the 16-digit secret key provided during the <i>google-authenticator</i> application.  Give your account a name (so you remember which account it will be used on) and tap ‚ÄúADD‚Äù. <br><br><img src="https://habrastorage.org/files/d51/1bb/2e6/d511bb2e60fc43b9bf1cfde4fafa01fb.png" width="30%"><br>  <sup><font color="grey">Image 1: Adding a new account to the Google Authenticator app.</font></sup> <br><br>  Now, after adding the account, you will be presented with six-digit keys that will be required each time you login or try to use <i>sudo</i> . <br><br>  Finally, you must set up other accounts in the system.  As I said, we are going to set up an account called <i>olivia</i> .  Like this: <br><br><ol><li>  Open a terminal window </li><li>  Run <code>sudo su olivia</code> </li><li>  Open Google Authenticator on your smartphone </li><li>  Enter the six-digit authentication code (provided by the application) in the terminal window (Figure 2) and press Enter </li><li>  Enter your sudo password and press Enter </li><li>  As a new user, run the <code>google-authenticator</code> command, answer the questions and write down the keys and codes provided. </li></ol><br>  After you have successfully configured the <i>olivia</i> user using the <i>google-authenticator</i> command, add a new account in the Google Authenticator application with the appropriate user information (just as you did for the initial user).  You should now have accounts for both <i>jack</i> and <i>olivia users</i> in the Google Authenticator app. <br><br><img src="https://habrastorage.org/files/e70/034/58b/e7003458beb9415091d3282d59b11600.png"><br>  <sup><font color="grey">Image 2: Enter the six-digit authentication code for <i>sudo</i> .</font></sup> <br><br>  That's all.  Every time you try to log in to your machine (or use <i>sudo</i> ), you will need to provide a six-digit authentication code before you can enter your user password.  Your Linux machine is now much more secure than it was before two-factor authentication.  Although this process may seem troublesome to some, I highly recommend setting it up ... especially for machines with sensitive data. </div><p>Source: <a href="https://habr.com/ru/post/302562/">https://habr.com/ru/post/302562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302550/index.html">IBM introduces the world's first PCM memory with three bits per cell</a></li>
<li><a href="../302552/index.html">Dynamic blur on Android</a></li>
<li><a href="../302554/index.html">Uber founder Travis Kalanik - "a rebel in the elite of Silicon Valley"</a></li>
<li><a href="../302556/index.html">Mastering programming - no problem</a></li>
<li><a href="../302560/index.html">Mars rover Opportunity more than 40 times the planned service life</a></li>
<li><a href="../302566/index.html">Wolfram Technologies: 4th Russian Conference</a></li>
<li><a href="../302568/index.html">Already 2016, and the future does not come. Who is to blame and what to do?</a></li>
<li><a href="../302570/index.html">Write the code as if it would be accompanied by a violent psychopath who knows where you live.</a></li>
<li><a href="../302576/index.html">Tony Robbins seminar review ‚ÄúFree your inner strength‚Äù. Day 2: Turning dreams into reality (part 2)</a></li>
<li><a href="../302580/index.html">How I caught a Wi-Fi printer via OSPF, corporate network on MikroTik part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>