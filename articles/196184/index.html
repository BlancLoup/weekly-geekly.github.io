<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Infrastructure and life cycle of web project development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When the project is small, there are no special problems with it. The task list can be maintained in a text file (TODO), the version control system, b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Infrastructure and life cycle of web project development</h1><div class="post__text post__text-html js-mediator-article">  When the project is small, there are no special problems with it.  The task list can be maintained in a text file (TODO), the version control system, by and large, you can not use it, you can simply copy them (cp / scp / rsync) to the desired directory to put the files on a live server, and you can always look at the errors in the log file.  It would be foolish, for example, for a simple service with two scripts and three visitors per day to raise a full-fledged server configuration management system. <br><br>  With the growth of the project requirements are growing.  It becomes inconvenient to keep dozens of tasks and bugs in a TODO file: I want priorities, comments, links.  There is a need for a version control system, special scripts / systems for code pickup on a server, a monitoring system.  The situation is exacerbated when several people work on the project, and when the project grows to several servers, a full-fledged infrastructure appears (‚Äúa set of interconnected service structures or objects that make up and / or provide the basis for the functioning of the system‚Äù, Wikipedia). <br><br>  Using the example of our <a href="https://calendar.mail.ru/">Mail.ru Calendar</a> service, I want to talk about the typical infrastructure and the life cycle of developing a medium-sized web project in a large Internet company. <br><img src="https://habrastorage.org/storage3/5a8/cb2/809/5a8cb2809f06460c5b59e74262c37376.png"><br><a name="habracut"></a><br>  Any work begins with the formulation of the problem, whether it is a planned feature or an error message. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Project and Task Management </h2><br>  As the ‚ÄúIssue &amp; project tracking‚Äù system, we, at Mail.ru, use <a href="https://www.atlassian.com/software/jira">Atlassian Jira</a> , which is the de facto standard among large organizations.  This is not a complete list of companies using Jira: <a href="http://ru.wikipedia.org/wiki/Atlassian_JIRA">ru.wikipedia.org/wiki/Atlassian_JIRA</a> .  The functionality, flexibility, extensibility and usability of this system are unequal, and I don‚Äôt see an alternative, although according to my information, some of the largest IT companies with thousands of employees successfully (according to their assertions) use <a href="http://www.bugzilla.org/">Bugzilla</a> as a bugtracker. <br><br>  For small teams and projects it is more expedient to use less sophisticated and <i>more free</i> counterparts like the same <a href="http://www.bugzilla.org/">Bugzilla</a> , <a href="http://phabricator.org/">Phabricator</a> or <a href="http://www.redmine.org/">Redmine</a> .  Alternatively, in the case of hosting projects ( <a href="https://github.com/">GitHub</a> , <a href="https://bitbucket.org/">BitBucket</a> and others), you can use the bug tracking systems built into them. <br><blockquote>  <i>At the moment, the project ‚ÄúCalendar‚Äù in Jira contains 1816 tasks, of which 1386 are successfully closed.</i>  <i>About 500 of them were bugs =)</i> </blockquote><br>  After the task has been assigned by the manager, testing specialist, or customer support service, the developer starts working on it.  All project code is in the repository. <br><br><h2>  Version Control System </h2><br>  To date, the most common version control systems are <a href="http://git-scm.com/">Git</a> and <a href="http://mercurial.selenic.com/">Mercurial</a> .  Both have, by and large, a similar functionality (distributed systems), although they differ in details.  Almost all Mail.ru projects have switched to Git (some with SVN, some with CVS), and Calendar is no exception. <br><br>  Our company has several large and powerful servers that have <a href="https://github.com/res0nat0r/gitosis">gitosis</a> installed for hosting git repositories.  Different repositories have different settings, for example, developers will not be able to push Python code into the calendar repository, which does not meet the <a href="http://www.python.org/dev/peps/pep-0008/">PEP8</a> standards (this is followed by a special server hook). <br><br>  All Calendar code (frontend and backend) is stored in one repository.  For a small and medium project, this allows you to quickly deploy the entire project entirely and easily track any changes in the code.  For large and very large projects (such as Mail.ru Mail), it seems more convenient to store client and server code in separate repositories (or even several), although, of course, any approach requires a sensible and reasoned decision. <br><blockquote>  <i>To date, we have 7,175 commits in the Calendar repository, and for all the time about 300 branches have been created.</i>  <i>The size of the entire project is 60 MB.</i> </blockquote><br>  In order to develop a project, you must first run it, for this you need to have the appropriate software and libraries. <br><br><h2>  Development Environment </h2><br>  It is said that every safety rule is written in blood.  In IT companies this, of course, does not reach, but there are strict rules, nonetheless.  For example, in Mail.ru, only system administrators have access to "combat" servers and data from real users.  Developers have access to only test machines with test users, which are not related to ‚Äúlive‚Äù in any way, and all development is carried out only in the test network.  This separation of duties eliminates the most "intelligent" programmers from the temptation to do something "quick fix on the living" and makes them write the code more thoughtfully and efficiently. <br><br>  There are systems that are very difficult, and sometimes impossible to run on one machine, for example, Mail.Ru Mail: to complete the work, it requires a huge number of libraries, demons, scripts and services.  Such projects are launched on several (dozens) virtual servers in the test network, and the developers work with the code running on these machines (vim, emacs, diff, that's all). <br><br>  We were lucky in the Calendar: the whole project is fairly easy to run on the local developer‚Äôs machine and there are no problems with the development.  You can use your favorite editors, IDE and debuggers without tricks, each programmer works with his code and does not affect the work of others.  Of course, we also have virtual servers in the development network, but they are mainly used for testing.  Even more facilitating the work is the fact that everyone in the Calendar prefers to use the MacBook in their work, so the development environment is almost the same for the team members. <br><br>  The server part of the calendar is written in Python, and, of course, we use <a href="http://www.virtualenv.org/">virtualenv</a> when developing and deploying the system, so to install all the libraries you just need to run the command <br><pre>  pip install -r requirements / development.txt </pre><br>  from the cloned repository.  The client (front-end) part uses <a href="https://npmjs.org/">npm</a> and all dependencies are <a href="https://npmjs.org/">installed</a> just as easily and naturally. <br><blockquote>  <i>The calendar currently uses 33 third-party Python libraries.</i> </blockquote><br>  All the necessary software on the Mac is installed from <a href="http://brew.sh/">brew</a> , and for the initial installation of the project on the developer‚Äôs computer, it‚Äôs enough to run <br><pre>  brew install ... </pre><br>  with a list of dependencies.  Of course, one command is not enough and further configuration is required, for example, the initialization of the user and the database in PostgreSQL.  There are some features in installing individual programs (for example, we use patched nginx with our modules), but this does not cause any problems, because everything is described in the documentation system (wiki). <br><br><h2>  Project Documentation </h2><br>  Knowledge is power.  Knowledge is worth sharing with your colleagues, they need to be recorded in order not to forget yourself.  The ideal place to store information is wiki-systems, and in Mail.ru we use <a href="https://www.atlassian.com/software/confluence">Atlassian Confluence</a> as such.  I do not see any particular advantages over other wiki-systems with Confluence (their functionality, in fact, is similar), but it so happened that Atlassian products got accustomed to our company and is popular.  Although there is one virtue: the products of one company are easy to integrate with each other, and in any large company all internal services are somehow connected with each other. <br><br>  We try to document everything related to the development and operation process: how to install this or that software, what configuration is required, what problems you may encounter, on which servers, which services are running and how they communicate with each other. <br><blockquote>  <i>The project Calendar in Confluence has 122 pages of documentation.</i> </blockquote><br>  Any product needs quality control and our Calendar is no exception. <br><br><h2>  Code review </h2><br>  Each developer is faced with errors in the code.  The first step in the fight for quality is code review, this allows you to notice any flaws in the program in time.  Another advantage of code auditing is acquaintance with each commit of at least two programmers: the one who wrote the code and the one who reviewed it (respectively, the responsibility is also divided in half). <br><br>  Atlassian for code review has a smart tool <a href="https://www.atlassian.com/software/crucible">called Crucible</a> , but historically, we use <a href="http://phabricator.org/">Phabricator</a> in the Calendar: an open-source development from Facebook.  The manufacturer has many opportunities, but we use only a part of them, namely, auditing, commenting on the code and viewing the repository online. <br><blockquote>  <i>On average, with every audit of a commit, three or four comments appear.</i> </blockquote><br>  After correction of colleagues' comments, the code passes to the next stages of quality control. <br><br><h2>  Syntax control and testing </h2><br>  Beautiful code is a good code.  Following the code-style rules by all team members allows you to look at any place of the program at a glance, and also allows you to avoid the vast majority of stupid mistakes.  Each push to the calendar repository is checked using <a href="http://www.python.org/dev/peps/pep-0008/">PEP8</a> , <a href="https://launchpad.net/pyflakes">pyflake</a> and <a href="http://www.pylint.org/">pylint</a> . <br><blockquote>  <i>There are no exceptions in the calendar from the pep8 and pyflake rules.</i> </blockquote><br>  Good code is working code.  We love when our programs work, and we don‚Äôt like when they are broken.  Smart people have come up with different types of testing (unit tests, functional, regression testing), and we are happy to use these developments. <br><blockquote>  <i>To date, we have 580 automatic tests in our project.</i> </blockquote><br>  To run various tasks, we use the open-source <a href="http://jenkins-ci.org/">Jenkins CI</a> (Continuous Integration) system, which has three tasks for the calendar: <br><ol><li>  for test branches: syntax control (lint) of the code, running all tests, preparing a code coverage report </li><li>  for the prerelease branch: syntax control (lint) of the code, running all the tests, building the test package (RPM) of the project and distributing it to our prerelease (test) server </li><li>  for the master branch: run tests and build the package (RPM) of the project </li></ol><br>  All tasks are started when the corresponding branch is clicked on the hook in the git repository. <br><blockquote>  <i>Build the project lasts, on average, about five minutes.</i> </blockquote><br>  Automatic testing is good, but the human mind and ingenuity cannot be replaced by a soulless machine.  Live testers come to the rescue.  Each release (and the release of the Calendar project takes place, on average, once every two weeks) is checked on the pre-release server by our testers.  They pay special attention to the new functionality, which was implemented over the past week, as well as to test the critical functionality of the project. <br><br>  The output is one (or several, depending on the project) RPM file, which contains the entire project completely, with virtualenv, all the necessary dependencies (libraries) and files (statics). <br><br>  The release is assembled, tested, tested and ready for display on combat vehicles, which only system administrators have access to. <br><br><h2>  The layout of the project into battle </h2><br>  Admins are smart and lazy people.  If you often have to do routine operations, then why not automate them? <br><br>  Mail.ru has many thousands of servers, each has its own role and its own settings.  We use <a href="https://github.com/puppetlabs/puppet">Puppet</a> to manage server configurations.  Settings for each server group are described in simple files that are in the version control system.  Thus, there is always a history of changes in configuration files with the ability to roll back to any of the previous states.  Only system administrators have access to repositories and the pappet in general. <br><br>  The process of laying out the new iteration on live servers looks like this: admins, if necessary, edit the project configuration files, prescribe the necessary versions of RPM packages and push changes to the repository.  Then Puppet takes care of everything: all configuration files on all servers will be updated, packages are installed and the necessary services are restarted. <br><blockquote>  <i>The layout of the project takes about one minute.</i> </blockquote><br>  The code is decomposed into production, it would seem, you can relax and unwind, but this should not be done.  Testers, of course, are extremely clever and resourceful and sometimes find such errors that the developers didn‚Äôt even suspect, but real users will give a hundred points of handicap to any tester.  You need to be able to monitor the status of the project. <br><br><h2>  Error logging </h2><br>  First of all, we are interested in the so-called "five hundred", that is, critical errors on the server.  If they are (and they are, there is no way out of it), then something went wrong and you need to urgently prepare bug fixes.  How to catch such errors?  You can, of course, write everything to the log, and then with a simple ‚Äúgrep‚Äù (by searching the log file) we will always be aware of the number and type of errors, but there is a better option. <br><br>  The logging system in the Calendar is configured in such a way as to send all errors, exceptions and simply varnings to a special system called <a href="https://github.com/getsentry/sentry">Sentry</a> .  In it, we see not only statistics on errors (when, which errors and how many times have occurred), but also detailed information about these errors: a full traceback (order of function calls) with the value of all variables in the context of each function.  There is also information about the user (email, OS, browser) and request (url, headers, GET and POST parameters).  All browser errors also fall into Sentry, although the information is not so detailed (JavaScript, nothing can be done).  All this makes it easy to localize problems and correct errors as soon as possible. <br><br>  Basically, we write various warnings to Sentry.  For example, in the process of refactoring, before abandoning any function, we always add warning to it, and only in the absence of messages in Sentry, at the next iteration, this function will be permanently removed from the code.  There are, of course, mistakes, and there are a lot of mistakes (‚Äúpacks‚Äù). <br><blockquote>  <i>The Sentry of the Calendar gets, on average, about 100 messages per hour.</i>  <i>Sentry withstands thousands of errors per minute (tested in practice =).</i> </blockquote><br>  Logging is good, but this is not enough, statistics are vital for the project. <br><br><h2>  Statistics and graphs </h2><br>  Everyone loves statistics.  Managers admire it, rejoicing in the increase in the number of hits and users, the developers receive information about the project's ‚Äúhealth‚Äù.  We use <a href="http://graphite.wikidot.com/">Graphite</a> as a system for collecting and storing metrics, as well as <a href="https://github.com/etsy/statsd/">StatsD</a> - a server that processes and aggregates incoming metrics, transferring them for storage to all the same graphite. <br><br>  What are graphics for?  As I said, according to the charts, you can always judge the status of the project: the number of redirects suddenly increased, the average request time to the database doubled, or the number of I / O operations on one of the servers increased.  All this allows you to detect the problem, and the presence of history (charts are stored for months and years) facilitate the analysis of sudden trouble with the project. <br><br>  Graphics help refactor.  It is enough, for example, to add statistic decorators to the functions that caused questions during profiling and to obtain reliable information about the code behavior under load.  After laying out the iteration with edits, you can evaluate their effectiveness, for example, reducing the average operation time of a function ten times (from hundreds to tens and even units of milliseconds) or the number of requests to the database from hundreds (thousands) to units better than any words proves the refactoring. <br><br>  The server performance graphs (we use <a href="https://github.com/BrightcoveOS/Diamond">Diamond</a> for this) allow us to estimate the load in a timely manner and to order additional machines in advance, or to attend to program performance. <br><blockquote>  <i>Every minute about 25 thousand different metrics are written into the graphite of the Calendar.</i> </blockquote><br>  Any project is written not for logs and not for graphs: it is written for people, for our favorite users.  And users are sometimes unhappy with the project. <br><br><h2>  Communication with users </h2><br>  In the Calendar there is a feedback form that people actively use.  These are mostly messages about noticed errors, requests for the implementation of one or another functional, or just words of gratitude for our excellent service.  These letters go to the customer support service (which uses a special system for working with user letters called <a href="http://www.otrs.com/">OTRS</a> ), and are also duplicated to us, that is, the project developers.  This allows you to always be aware of all the problems and respond promptly to them: in difficult cases, we ourselves respond to the people who wrote and together with them solve the difficulties that have arisen. <br><br>  I remember a funny case when one of the users wrote us a letter asking him to add the necessary functionality to the Calendar (if I‚Äôm not mistaken, it was about SMS notifications), and we just finished this task and did it on a live server.  Fifteen minutes after the request, the user received the answer that, they say, we did everything as you requested.  There was no limit to his surprise. <br><blockquote>  <i>We get about ten messages a day.</i>  <i>Half of them are thanks and positive feedback.</i> </blockquote><br><br><h2>  Instead of an afterword </h2><br>  The process of developing a calendar from scratch lasts just a year and a half, and the calendar‚Äôs release took place a little less than a year ago.  The project is young, and we, its developers, are constantly improving its infrastructure.  I'll tell you a little about our plans for the future. <br><br>  I would like to try to use <a href="http://www.vagrantup.com/">Vagrant</a> in the development, it will allow even faster and easier to deploy developer environment.  I'd like to try <a href="http://docs.seleniumhq.org/">Selenium</a> for automatic testing of the project (web version and mobile clients).  For better testing, the new functionality lacks the ability to enable it by criteria, for example, only on company employees or on a certain percentage of users. We want to try the open-source <a href="https://github.com/disqus/gargoyle">Gargoyle</a> project for this.  In the near future, following the example of other Python-projects in our company, our team is going to implement <a href="https://github.com/facebook/arcanist">Arcanist</a> : add-on git to work with Phabricator from the command line in the project repository.  This will simplify the code-review process and simplify development. <br><br>  I tried to go through the whole development process, but touched only a small part of it.  Development of the project is a difficult process, but thanks to all the resources access to which is possible in a large company, it is very interesting and fascinating.  I suggest in the comments to ask questions that interest you, and I will try to answer them. <br><br>  <i>Vladimir Rudnykh,</i> <i><br></i>  <i>Technical Director of the Mail.Ru Calendar.</i> </div><p>Source: <a href="https://habr.com/ru/post/196184/">https://habr.com/ru/post/196184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196162/index.html">Ranking in detail</a></li>
<li><a href="../196164/index.html">Silk Road owner detained, $ 3.6 million seized</a></li>
<li><a href="../196174/index.html">How to make good applications (under Windows 8 and not only)</a></li>
<li><a href="../196176/index.html">Commandments of the IT outsourcer / Service Provider</a></li>
<li><a href="../196182/index.html">10 rules for preparing a model for 3D printing</a></li>
<li><a href="../196190/index.html">Some tips for a less-developer</a></li>
<li><a href="../196192/index.html">Free Iversity courses</a></li>
<li><a href="../196194/index.html">Google is trying to sell software like chocolate bars</a></li>
<li><a href="../196196/index.html">(Almost) all the reports of the Joker 2013 conference</a></li>
<li><a href="../196198/index.html">Report from Silicon Valley. The Silicon Valley Open Doors conference is not a window, but a door to Silicon Valley. Part 1: entrepreneurs, investors, insider and trends</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>