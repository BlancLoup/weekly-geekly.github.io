<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of one poker bot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now the possibility of writing a poker bot is no longer in doubt (there is even a series of articles in the Hacker magazine), but in 2008 everything w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of one poker bot</h1><div class="post__text post__text-html js-mediator-article">  Now the possibility of writing a poker bot is no longer in doubt (there is even a series of articles in the Hacker magazine), but in 2008 everything was not so obvious and all that could be found was a single article in English that described only general ideas never got accustomed to our project.  But even now, few people will share successful stories. <br>  In this article I will describe our experience in developing a bot that was actually tested in real poker rooms and even learned how to play and not lose.  Those who are going to write their bot will find interesting things in the article and ways to make their lives easier.  Who cares - welcome under cat. <br><a name="habracut"></a><br><h4>  How it all began </h4><br>  The idea of ‚Äã‚Äãwriting a bot visited my friend who shared it with me and with my neighbor in the hostel, and the friend himself was also with the hostel. <br>  The roles were divided by the following plan: <br>  ‚Ä¢ Logic Designer (idea author) <br>  ‚Ä¢ Parser Developer (Neighbor) <br>  ‚Ä¢ Developer of eyes and hands (i) <br>  It was decided to write a bot for limit hold'em (the author of the idea at that time was earning some money playing this type of game) <br>  In such a composition and with such roles, we moved into battle.  As a result, we got 3 iterations of development with breaks between them in 3-4 months, which I will try not to forget anything to tell in more detail. <br><br><h4>  Iteration 1 </h4><br>  What a time it was.  Three green students began to think.  We needed tools, initially the choice was this: <br>  ‚Ä¢ C ++ - game logic <br>  ‚Ä¢ VB.Net - Everything Else <br>  But after a few hours of development, we decided to teach C # and began using it instead of BASIC. <br>  Unfortunately, I can‚Äôt tell anything about the brains that were in the DLL in C ++, and no one can (just no one remembers), I only remember that there was a hell in it, in which even the author was confused and sometimes surprised that something accidentally works / does not work. <br>  The poker room we chose for testing had excellent chat rooms from which it was decided to take information to analyze what was happening.  My neighbor took up this analysis. <br>  I needed to learn how to give him a chat on time, it remained to understand when it comes on time. <br>  So, the first questions that needed to be resolved were: <br>  ‚Ä¢ How to find among all windows of system necessary? <br>  ‚Ä¢ How to understand that it's time to go? <br>  ‚Ä¢ How to walk? <br>  ‚Ä¢ How to get a chat? <br>  More detail about solving problems below (there is a feeling that it was in that order that I then solved them). <br><br><h5>  How to understand that it's time to go? </h5><br>  I then heard something about WinApi, but what kind of animal it is and how to teach it - I was not in the know.  Very soon, I learned that by a mysterious handle you can learn a lot about the window and do a lot of things, I also learned that you can watch the window well.  Armed with Spy ++, I plunged into the world of the then simple recognition of the handle by pointing a cross on the window))) <br>  Smoking allowed me to find out what you can ask the color of the dot on the desktop and what the system can say that the mouse clicked the button. <br>  The solution of the problem became obvious: <br>  1. look for points by the color of which you can find out what buttons appeared (i.e. It's time to walk) <br>  2. get the coordinates of the window <br>  3. add to the coordinates of the point to determine <br>  4. constantly make the window active and check the color of the point <br>  5. If the color has become necessary - it's time to go 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  How to get a chat? </h5><br>  Already knowing how to use Spy ++, it was easy to find the handle.  Having smoked again, I understood how to send Ctrl + A, Ctrl + C to the window.  Further by means of C # received the contents of the buffer.  Chat is. <br><br><h5>  How to walk? </h5><br>  While it was determined how to understand that it was time to walk - it became clear how to walk.  Calculate the coordinates of the button, put the cursor on the dot, Send the left mouse click to the system.  It was like. <br><br><h5>  How to find among all windows of system necessary? </h5><br>  This task turned out to be the most difficult - I couldn‚Äôt solve it for a long time until I turned to my teacher (thanks to Chernosvitov AV) for C # / C ++ and he remembered the EnumWindowsProc function or something like that.  Using Spy ++, I looked for the window's features, but in the end this feature turned out to be a header, which by the way can also be obtained from the window handle, after which using EnumChildWindowsProc (enumeration of all child windows) was a chat. <br><br><h5>  Summary of Iteration 1 </h5><br>  After the first iteration, we had a bot who played limit hold'em, knew how to understand that it was time to walk, knew how to walk.  He had some logic.  He could only play alone and completely blocked the computer (due to constant switching to the window before each action) on which he was tested. <br><br><h4>  Iteration 2 </h4><br>  A few months later we decided to write again, to speed up the process, we decided to take the computers into one room and work together there. <br>  During this iteration, it was carried out: <br>  ‚Ä¢ Moving to one language - we moved completely to C #. <br>  ‚Ä¢ Transition to anlim tournaments <br>  ‚Ä¢ Many tables tied <br>  ‚Ä¢ Tried using system hooks to determine if it's time to go. <br>  ‚Ä¢ Improved chat reception <br>  ‚Ä¢ Improved progress mechanism <br><br><h5>  Transition to anlim tournaments </h5><br>  The logic was rewritten in C # and the starting tables for playing tournaments from pokerstrategy.com were used, which made it possible to make reasonably clean and clear logic.  There were also attempts to make a logic configurator (we wanted to sell the bot to the side so that everyone would write their own logic), but we decided that this was utopia and stopped the development of the idea. <br><br><h5>  Many tables screwed </h5><br>  Along with the new transparent logic, the possibility of playing on several tables was added.  Realization of such a possibility was a curve - each table in turn to the fore, checking the color for the need for a move - if it's time to go, then we go.  However, this scheme worked, and it was a victory.  But now the bot blocked the computer completely and tightly. <br><br><h5>  Tried using system hooks to determine if it‚Äôs time to go. </h5><br>  By this time, I was already strong enough to start digging with Windows system hooks.  Since C # does not hang system hooks on the arrival of messages to the window - a project with CodeProject (http://www.codeproject.com/KB/system/WilsonSystemGlobalHooks.aspx) was used, which consists of a DLL and C # logic that runs this DLL and receiving information from her.  Hooks allowed not to do a bunch of switching between windows to determine the progress, but to catch the exact order of messages, after which it was necessary to go, did not work, plus the hooks slowed down the system and eventually refused to hooks. <br><br><h5>  Improved chat reception </h5><br>  During another sleepless night, I watched in Spy ++ the commands that come to the chat, and I saw that certain commands corresponded to the selection and copying of everything.  The code of these commands was recorded, the chat copy was rewritten to use the new commands, then the copying was done completely using WinApi commands. <br><br><h5>  Improved progress mechanism </h5><br>  It turned out that you can send a message to the window, that you clicked on it with the mouse - this allowed us to rewrite the walk to send messages directly to the window about clicks.  Now the cursor could no longer twitch across the screen.  The computer is gradually returning from the bot to the owner =) <br><br><h5>  Results of iteration 2 </h5><br>  After this iteration, a bot played on many tables in tournament hold'em with transparent logic (by the way, the table proposed at PokerStrategy.com is a loser if you follow it completely and not think more).  The bot could already leave a small chance to somehow work the host computer. <br><br><h4>  Iteration 3 </h4><br>  By the third iteration, two of us reached, my neighbor dropped out of the project and his part of the code was rewritten from scratch (it was difficult to maintain someone else's code, especially since it was necessary to significantly develop it).  During the third iteration we reached: <br>  ‚Ä¢ Using a new mechanism for determining the time course <br>  ‚Ä¢ Using the new chat mechanism <br>  ‚Ä¢ Using new logic <br><br><h5>  Using the new mechanism for determining the time course </h5><br>  I still wonder why I didn‚Äôt guess earlier that you can determine the color of a point not only on the desktop, but also in the window specifically.  Having understood this, I rewrote the definitions of the move in a new way.  Now it was not necessary to constantly push the windows to the fore in order to understand that it was time to walk.  Such a mechanism works stably and fails only in one case - when the game table is collapsed into the tray. <br><br><h5>  Using the new chat mechanism </h5><br>  The poker room chat had a class InetnetExplolerClass or something like that.  To this iteration, I found a way to extract text from such objects and code on VB.Net that worked.  The code was rewritten in C # and now getting the chat was without any copying to the buffer and was more stable. <br><br><h5>  Using new logic </h5><br>  It became clear that for tournaments you need an equator and ICM model calculation, and we started trying to get it.  The equator written by my partner could calculate 5000 games per second, while the Equiliator from PokerStrategy.com could have 1500000 on the same configuration - it was a failure and something had to be done about it. <br>  One day, sitting at night, I went to the folder with the files of software PokerStrategy.com (Equiliator, ICM Trainer) and found that they are written on .Net.  I was overjoyed about this and I spent the next 2 days to run this software under my debugging, but in the end we could fully see how to use the libraries of this company and successfully learned how to use them. <br>  As a result, our bot considered its chances of winning before the move, and at the extreme stage of the tournaments used pure ICM, which gave it certain advantages. <br><br><h5>  Results of iteration 3 </h5><br>  As a result, we got a bot that played zero or a very easy plus on microlimites in tournaments on many tables (he played 20 easily) using a lot of mathematics. <br><br><h4>  Results </h4><br>  The next step will be screwing to the bot statistics on players will lead to an improvement in the game. <br>  Unfortunately, at the moment the development is worth and is worth a long time.  We still have a lot of small jambs, which can occur once in many hours and it is very difficult to debug such things. <br><br>  If you have a desire to write your bot - I hope that the solutions we found will allow you to write it faster. </div><p>Source: <a href="https://habr.com/ru/post/127378/">https://habr.com/ru/post/127378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127366/index.html">How mailing infrastructure works</a></li>
<li><a href="../127369/index.html">WikiLeaks: another, unusually large portion of documents</a></li>
<li><a href="../127374/index.html">Automatic Web Development Hosts (FreeBSD)</a></li>
<li><a href="../127375/index.html">Interactive diagram on CSS and HTML</a></li>
<li><a href="../127376/index.html">Experience creating an Ajax application</a></li>
<li><a href="../127382/index.html">SSL certificates for the .google.com domain are forged</a></li>
<li><a href="../127383/index.html">Simply Linux. Fresh release</a></li>
<li><a href="../127384/index.html">No entry for unauthorised people</a></li>
<li><a href="../127385/index.html">Getting started with the Rungine game engine</a></li>
<li><a href="../127386/index.html">How do you pronounce acai? No not like this</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>