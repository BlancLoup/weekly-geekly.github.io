<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple oscilloscope for 1 day</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 Well, I have no money for a normal oscilloscope (and a normal camera). So do not fight much. 
 But there were 500 rubles per screen and a sim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple oscilloscope for 1 day</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  Well, I have no money for a normal oscilloscope (and a normal camera).  So do not fight much. <br>  But there were 500 rubles per screen and a simple 8-bit microcontroller. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/F49fa5aycVM%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhjo_ii1o8IWH8SreRa0NBH7SszMOw" frameborder="0" allowfullscreen=""></iframe><br>  A short description under the cut. <br><a name="habracut"></a><br><br>  It all started with the fact that I had a graphical LCD screen WG12864B from WINSTAR in my hands.  128x64 pixels, monochrome.  I have never worked with them, it was interesting to understand it (I like to dig into datasheets, especially on the Cortex M4 controllers of 1,400 pages). <br><br>  The control turned out to be very simple, it seemed to me easier than the control of character LCD screens.  The main initial difficulty arose only in the fact that the screen is divided into 2 independent parts 64x64, each of which is controlled by its own controller.  I will not write about management, there are a lot of different articles and libraries on the Internet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Duck here.  I brought the picture, I was glad, showed my mother.  What to do next, sort of figured out the screen, then drawing pictures is already boring.  I decided to make an oscilloscope, because I do not have it, and probably will not be there for a long time.  And then I immediately remembered one function of this screen, the "Starting Line of the Display."  It serves as a memory offset, so to speak.  If you store a pixel at the point (0,0) and make a start line, for example, 5, the point will be visible on the screen 5 lines horizontally.  It seemed to me a solution to the problem of image shift instead of redrawing it. <br><br>  I decided that I would move one half of the screen along with the image of the signal, and the second one would show different information: voltage and all that. <br>  The logic is simple.  Erase the line (the old point that wants to crawl to the right when shifting more than 64 points), build the point equivalent to the voltage, move the image 1 pixel to the left.  The effect of the connected points was first thought to be done through the Brezenham algorithm, but then I thought that we were shifting only 1 pixel and the lines would be vertical. <br><br>  Amplitude value is determined by the formula: <br>  <b>amp = 63- (8-bit value from the ADC) shifted by 2 digits to the right;</b> <br><br>  I did all this in an infinite loop, I started it, and ... I did not see anything.  Added a delay of 100ms and got the image that is visible in the video.  When reducing the delay, the image becomes indistinct.  Then I felt sad, because signals with a frequency above 10 Hz become completely indistinguishable.  This is all due to the screen shift method.  If you erase the screen and record information in blocks, rather than pixels, as I did, the image quality will greatly improve and speed up the rendering.  But to do it was, honestly, reluctant, especially in the session.  And I left everything as it is. <br><br>  At the bottom of the screen, I drew a timeline, signed a segment.  The voltage scale had to be done on the lower screen, since it is difficult to make a non-moving scale on the shifting screen, all the more so that it can be seen normally. <br><br>  Here is a picture to make it easier to navigate: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/a5e/665/13c/a5e66513ca511a1aedc30e67bf000778.jpg" alt="image"><br><br>  At the moment we have 3 volts.  Who cares, the sine did on the DAC MK Cortex M4 with a period of slightly more than 3 seconds.  The screen shows that a couple of values ‚Äã‚Äãdid not count at the peak. <br><br>  Doot.  And the place is still left and I added a couple of digital channels.  They work on interruptions and a little bit faster than analog, since it is a bit different way: they displayed the signal from left to right, erased it, displayed it again.  Here you can view the digital signal with a frequency of less than 50 Hertz.  For example, check the performance of some slow interface.  Very slow :) <br><br>  In general, all told.  Suggestions and feedback in the comments.  Just don‚Äôt throw a balagan, better buy me an oscilloscope) <br>  Happiness to all. <br><br>  <b>UPDATE1: Thank you all for the criticism, after the session I will try to take the program and the hardware more seriously, relying on your comments.</b> <br><br>  <b>UPDATE2: Here is the code for the atmel studio for the ATMega168 microcontroller, which contains procedures for working with a graphic screen, the handling of timer interrupts and digital inputs.</b> <br><div class="spoiler">  <b class="spoiler_title">View code</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;avr/io.h&gt; #define F_CPU 8000000 #include &lt;util/delay.h&gt; #include &lt;avr/interrupt.h&gt; #define ClearBit(reg, bit) reg &amp;= (~(1&lt;&lt;(bit))) #define SetBit(reg, bit) reg |= (1&lt;&lt;(bit)) #define nCS1 0 #define nCS2 1 #define NRST 4 #define DI 5 #define E 4 #define RW 5 #define clrcs PORTD|=(1&lt;&lt;nCS1)|(1&lt;&lt;nCS2) #define setcs1 PORTD&amp;=~(1&lt;&lt;nCS1) #define setcs2 PORTD&amp;=~(1&lt;&lt;nCS2) #define sete PORTD|=(1&lt;&lt;E) #define clre PORTD&amp;=~(1&lt;&lt;E) #define setdi PORTC|=(1&lt;&lt;DI) #define clrdi PORTC&amp;=~(1&lt;&lt;DI) #define setrst PORTC&amp;=~(1&lt;&lt;NRST) #define clrrst PORTC|=(1&lt;&lt;NRST) #define setrw PORTD|=(1&lt;&lt;RW) #define clrrw PORTD&amp;=~(1&lt;&lt;RW) void sendbyte(char b) { PORTB=b; sete; _delay_us(1); clre; _delay_us(5); } void SetXY(int x,int y,int c) { char h=PIND; if (c&amp;0x1) setcs1; if (c&amp;0x2) setcs2; clrdi; sendbyte(0xB8+x); sendbyte(0X40+y); PORTD=h; } void initglcd() { _delay_ms(50); clrdi; clrcs; setrst; _delay_us(10); clrrst; setcs1; setcs2; sendbyte(0xC0); sendbyte(0x3F); SetXY(0,0,3); } void sendi(char b,char c) { if (c&amp;0x1) setcs1; if (c&amp;0x2) setcs2; setdi; sendbyte(b); clrdi; clrcs; } unsigned char readbyte(char c) { setdi; setrw; if (c&amp;0x1) setcs1; if (c&amp;0x2) setcs2; DDRB=0x00; _delay_us(1); sete; _delay_us(1); clre; _delay_us(5); sete; _delay_us(1); unsigned char x=PINB; clre; DDRB=0xff; clrcs; clrdi; clrrw; return x; } void clearglcd(char c) { for(int j=0; j&lt;=7;j++){ SetXY(j,0,3); for(int i=0;i&lt;=63;i++)sendi(0x00,c); } SetXY(0,0,3); } void fillglcd(char c) { for(int j=0; j&lt;=7;j++){ SetXY(j,0,3); for(int i=0;i&lt;=63;i++)sendi(0xff,c); } SetXY(0,0,3); } void putpixel(char x, char y) { cli(); if (x&lt;64) { SetXY(y/8,x,1); unsigned char t=readbyte(1); SetXY(y/8,x,1); sendi(t|(1&lt;&lt;(y%8)),1); } else { SetXY(y/8,x-64,2); unsigned char t=readbyte(2); SetXY(y/8,x-64,2); sendi(t|(1&lt;&lt;(y%8)),2); } sei(); } void clearpixel(char x, char y) { cli(); if (x&lt;64) { SetXY(y/8,x,1); unsigned char t=readbyte(1); SetXY(y/8,x,1); sendi(t&amp;(~(1&lt;&lt;(y%8))),1); } else { SetXY(y/8,x-64,2); unsigned char t=readbyte(2); SetXY(y/8,x-64,2); sendi(t&amp;~((1&lt;&lt;(y%8))),2); } sei(); } int ff=63; int hh=0; int asd=0; int asd1=0; int pred=0; int pred1=0; int oldd=63; int oldd1=63; ISR(TIMER0_OVF_vect) { hh++; if (hh==2) { hh=0; if (ff==0) { ff=63; oldd=63; oldd1=63; for(int k=0;k&lt;=63;k++) clearpixel(100,k); for(int k=0;k&lt;=63;k++) clearpixel(101,k); for(int k=0;k&lt;=63;k++) clearpixel(102,k); for(int k=0;k&lt;=63;k++) clearpixel(103,k); for(int k=0;k&lt;=63;k++) clearpixel(104,k); for(int k=0;k&lt;=63;k++) clearpixel(105,k); for(int k=0;k&lt;=63;k++) clearpixel(115,k); for(int k=0;k&lt;=63;k++) clearpixel(116,k); for(int k=0;k&lt;=63;k++) clearpixel(117,k); for(int k=0;k&lt;=63;k++) clearpixel(118,k); for(int k=0;k&lt;=63;k++) clearpixel(119,k); for(int k=0;k&lt;=63;k++) clearpixel(120,k); } else ff--; if (asd==1) { if (pred==0) { if (ff&lt;oldd)for(int k=oldd;k&gt;=ff;k--) putpixel(100,k); putpixel(101,ff); putpixel(102,ff); putpixel(103,ff); putpixel(104,ff); putpixel(105,ff); pred=asd; oldd=ff; } } else { if (pred==1) { if (ff&lt;oldd) for(int k=oldd;k&gt;=ff;k--) putpixel(105,k); putpixel(101,ff); putpixel(102,ff); putpixel(103,ff); putpixel(104,ff); putpixel(100,ff); pred=asd; oldd=ff; } } if (asd1==1) { if (pred1==0) { if (ff&lt;oldd1)for(int k=oldd1;k&gt;=ff;k--) putpixel(115,k); putpixel(116,ff); putpixel(117,ff); putpixel(118,ff); putpixel(119,ff); putpixel(120,ff); pred1=asd1; oldd1=ff; } } else { if (pred1==1) { if (ff&lt;oldd1) for(int k=oldd1;k&gt;=ff;k--) putpixel(120,k); putpixel(116,ff); putpixel(117,ff); putpixel(118,ff); putpixel(119,ff); putpixel(115,ff); pred1=asd1; oldd1=ff; } } } } ISR(INT0_vect) { if (PIND&amp;0x04) { asd=1; } else { asd=0; } } ISR(INT1_vect) { if (PIND&amp;0x08) { asd1=1; } else { asd1=0; } } int main(void) { DDRC=0x3C; DDRD=0x33; DDRB=0xff; PORTD=0x00; initglcd(); clearglcd(1); for (int j=0;j&lt;=127;j++) for(int i=0;i&lt;=63;i++) putpixel(j,i); for (int j=0;j&lt;=127;j++) for(int i=0;i&lt;=63;i++) clearpixel(j,i); ADCSRA|=(1&lt;&lt;ADEN)|(0&lt;&lt;ADIE)|(1&lt;&lt;ADSC)|(1&lt;&lt;ADATE)|(1&lt;&lt;ADPS0); ADMUX=0x60; for(int k=0;k&lt;=63;k++) putpixel(66,k); //OX putpixel(65,56); putpixel(67,56); putpixel(65,46); putpixel(67,46); putpixel(65,36); putpixel(67,36); putpixel(65,26); putpixel(67,26); putpixel(65,16); putpixel(67,16); putpixel(65,6); putpixel(67,6); for(int k=6;k&lt;=56;k++) putpixel(84,k); //OY putpixel(83,56); putpixel(85,56); putpixel(83,46); putpixel(85,46); putpixel(83,36); putpixel(85,36); putpixel(83,26); putpixel(85,26); putpixel(83,16); putpixel(85,16); putpixel(83,6); putpixel(85,6); putpixel(87,56); //0 putpixel(88,57); putpixel(88,55); putpixel(89,57); putpixel(89,55); putpixel(90,57); putpixel(90,55); putpixel(91,56); putpixel(87,46); //1 putpixel(88,46); putpixel(89,46); putpixel(90,46); putpixel(91,46); putpixel(88,47); putpixel(87,36); //2 putpixel(87,37); putpixel(87,35); putpixel(88,35); putpixel(89,35); putpixel(89,36); putpixel(89,37); putpixel(90,37); putpixel(91,37); putpixel(91,36); putpixel(91,35); putpixel(87,27); //3 putpixel(87,26); putpixel(87,25); putpixel(88,25); putpixel(89,25); putpixel(89,26); putpixel(89,27); putpixel(90,25); putpixel(91,25); putpixel(91,26); putpixel(91,27); putpixel(87,17); //4 putpixel(87,15); putpixel(88,17); putpixel(88,15); putpixel(89,17); putpixel(89,15); putpixel(89,16); putpixel(90,15); putpixel(91,15); putpixel(87,6); //5 putpixel(87,7); putpixel(87,5); putpixel(88,7); putpixel(89,5); putpixel(89,6); putpixel(89,7); putpixel(90,5); putpixel(91,7); putpixel(91,6); putpixel(91,5); putpixel(68,53); //1 putpixel(69,53); putpixel(70,53); putpixel(71,53); putpixel(72,53); putpixel(69,54); putpixel(68,48); //s putpixel(68,50); putpixel(68,49); putpixel(69,51); putpixel(70,50); putpixel(70,49); putpixel(71,48); putpixel(72,49); putpixel(72,50); putpixel(72,51); for(int k=0;k&lt;=63;k++) putpixel(95,k); for(int k=0;k&lt;=63;k++) putpixel(94,k); for(int k=0;k&lt;=63;k++) putpixel(111,k); putpixel(110,35); putpixel(112,35); putpixel(110,63); putpixel(112,63); putpixel(110,7); putpixel(112,7); EICRA=0x05; EIMSK=0x03; TIMSK0=0x01; TCCR0B=0x04; sei(); unsigned char i=0; int x=0; int y=0; bool b=0; unsigned char old,news,news2; unsigned char adcc; old=63; while(1){ for(int k=0;k&lt;=63;k++) clearpixel(k,y); for(int k=56;k&gt;=6;k--) clearpixel(80,k); for(int k=56;k&gt;=6;k--) clearpixel(81,k); adcc=ADCH; news=63-adcc*64/255; news2=adcc*50/255; for(int k=56;k&gt;=56-news2;k--) putpixel(80,k); for(int k=56;k&gt;=56-news2;k--) putpixel(81,k); if (news&lt;=old) for(int h=old;h&gt;=news;h--) putpixel(h,y); else for(int h=old;h&lt;=news;h++) putpixel(h,y); old=news; y--; if (++x==4) {PORTC^=0x08; x=0;} if (x%2==1) PORTC^=0x04; if (y&lt;0) y=63; setcs1; sendbyte(0xC0+i); if (i==0) i=63; else i--; _delay_ms(97); } }</span></span></span></span></code> </pre> </div></div></div><p>Source: <a href="https://habr.com/ru/post/165611/">https://habr.com/ru/post/165611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165599/index.html">Meet the BitTorrent client for Google Chrome</a></li>
<li><a href="../165601/index.html">Developing a game of endless racing for iOS using Cocos2D-iphone</a></li>
<li><a href="../165605/index.html">Anonymous asks to recognize DDoS attacks as a legitimate form of protest</a></li>
<li><a href="../165607/index.html">How was stolen half-life 2</a></li>
<li><a href="../165609/index.html">Logic - interesting announcements at CES 2013 and the latest gaming and IT industry news ‚Ññ9</a></li>
<li><a href="../165613/index.html">Familiarity with technology after 25 years in prison</a></li>
<li><a href="../165615/index.html">Web Inspector in Chrome Notifications</a></li>
<li><a href="../165617/index.html">TextTest is a cross-platform python framework for GUI testing and more. Part 1</a></li>
<li><a href="../165619/index.html">EgisTec ES603 - a fingerprint scanner for 500 rubles or we introduce biometric authorization</a></li>
<li><a href="../165621/index.html">Reconstruction of the portrait of Van Gogh</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>