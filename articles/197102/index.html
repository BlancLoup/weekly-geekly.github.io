<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mobile phone integration with corporate IP PBX using Aastra Mobile Client</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to consider an interesting solution from the company Aastra - this is AMC ( Aastra Mobile Client ). 

 AMC is a SIP client for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mobile phone integration with corporate IP PBX using Aastra Mobile Client</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to consider an interesting solution from the company <b>Aastra</b> - this is <b>AMC</b> ( <b>Aastra Mobile Client</b> ). <br><br>  <b>AMC</b> is a SIP client for mobile phones that allows a subscriber to access standard PBX services.  Thanks to this integration, users can make calls from their smartphones directly through the corporate telephone network, using the Internet via Wi-Fi networks or GSM mobile networks (3G / EDGE / GPRS). <br><br>  In addition to classic phone functions, <b>AMC</b> allows you to: exchange instant messages, set presence status, configure intelligent call routing at the lowest cost in a mobile network (MLCR), work in two modes (Dual Mode GSM / Wi-Fi), have the ability to use local SIM Travel Card (Travel SIM) and provides integration with corporate directories. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The AMC</b> client is available for most well-known devices running the mobile OS: Android 2.3 and higher, iOS 6 and higher, BlackBerry RIM 6.0 and 7.0, Symbian. <br><br>  An <b>AMC controller (AMCC)</b> is required for interaction between the <b>AMC</b> and the communication system (PBX <b>)</b> .  AMCC can be either software (deployed in a vmware environment) or hardware (a separate ‚Äúbox‚Äù).  AMCC connects to the telephone station, using B2BUA - a logical element in applications that work with the SIP protocol or through a SIP trunk. <br><br>  The solution from <b>AMC</b> can be easily integrated into any already existing SIP infrastructure, it is enough to have several free SIP accounts on IP-PBXs and organize a SIP trunk in the direction of the AMC controller. <br><br>  <b>AMC</b> is a paid solution, each user in the system must be licensed.  Depending on the required functionality, the appropriate licenses are acquired (for example, Travel SIM enabled, AMC + Basic Mobile Presence and IM, etc.).  Clients installed on smartphones themselves are free and can be downloaded, for example, from Google Play or the App Store. <br><br>  After purchasing licenses, you have access to the AMC portal, through which you configure AMC clients. <br><br><h1>  The principle and features of the AMC </h1><br>  In our demo lab, together with my colleague <a href="http://habrahabr.ru/users/alexand3010/" class="user_link">Alexand3010</a> , a software version of <b>AMCC</b> was deployed (on a virtual machine running <b>vmware ESXi 5.1</b> ).  In addition, we had several IP PBX systems from different vendors, for example: Aastra MX-ONE 5.0 SP3, Aastra 400 v3, Mitel MCD 6.0 / vMCD 6.0, FreePBX Asterisk 11.2.1. <br><br>  A diagram of our laboratory setup is shown in the image below. <br><hr><br><img src="https://habrastorage.org/storage3/e0c/016/946/e0c016946d243fd9b163148376bc77c9.png"><br><hr><br>  As follows from the scheme, all communication devices are behind NAT, on the same subnet - 172.19.19.0/24.  On the router, rules for the translation of IP addresses and the corresponding ports are set. <br><a name="habracut"></a><br>  In order for AMCC to work properly, in the case of its software execution, you must properly configure your boundary firewall, which will correctly translate IP addresses and ports towards AMCC.  This is necessary due to the fact that our controller is software, and it has only one network interface (LAN), unlike the hardware one, where there is also a WAN port.  Due to this, hardware AMCC looks at the Internet (WAN) with one end, and with the other into the local area network (LAN) and deals with all the necessary broadcasting. <br><br>  The list of ports for <u>mandatory broadcast</u> on the firewall, when using AMCC under vmware: <br><ul><li>  448 - for HTTPS callback </li><li>  5061 - TCP for VoIP TLS (cipher) </li><li>  5062 - TCP for normal SIP </li><li>  35000-65000 - UDP for RTP transmission (voice) </li></ul><br><h3>  Now let's take a closer look at how it all works: </h3><br><ol><li>  The user installs a software client (for the corresponding OS) on his mobile device.  On the image - version for OC Android. <br><hr><br><img src="https://habrastorage.org/storage3/75f/550/9e8/75f5509e8735b49db668436b6ac52140.png"><br><hr><br></li><li>  The AMC portal creates a settings profile for AMCC, containing SIP Proxy IP, SIP Proxy Port, CB Server Host, Transport Mode. <br><hr><br><img src="https://habrastorage.org/storage3/8b7/f8b/270/8b7f8b270dd3a10ae7024f2e79017ec7.png"><br><hr><br>  <u>For our case, these settings look like this:</u> <br>  ‚Ä¢ SIP Proxy IP = 195.5.5.5 <br>  ‚Ä¢ SIP Prox Port = 5062 <br>  ‚Ä¢ Transport mode = TCP <br>  ‚Ä¢ CB Server Host = 195.5.5.5 <br></li><li>  In the same place on the AMC portal, subscribers are added, for which the following is indicated: mobile phone number in international format (+ 79XXxxxxxxx), mobile OS, SIP Username, SIP Password.  Next, click <b>Send AMC user account key</b> to send (via SMS or E-mail) the user key for authorization. <br><hr><br><img src="https://habrastorage.org/storage3/53b/14c/982/53b14c982f38f8bff56ad2a49206fa67.png"><br><hr><br></li><li>  On an IP-PBX, we create a SIP trunk in the direction of AMCC and set up several SIP accounts, under which AMC clients will register. </li><li>  On the AMCC (controller) in the <b>Telephony</b> section, specify the necessary parameters. <br><br><ul><li>  External IP address for NAT.  AMCC contains SBC functionality (Session Boarder Controller) and to work correctly with IP-PBX behind NAT, you must specify an external IP address for NAT.  And also enable pinhole to send RTP over NAT. <br><hr><br><img src="https://habrastorage.org/storage3/df2/34c/195/df234c19565d8a190cc979406345905c.png"><br><hr><br></li><li>  Default ports <br><hr><br><img src="https://habrastorage.org/storage3/488/131/150/4881311501e57faf6f1e1a16c338a630.png"><br><hr><br></li><li>  Dialing rules profile (for basic settings does not affect anything) <br><hr><br><img src="https://habrastorage.org/storage3/5d5/494/295/5d5494295fcea467d1af3461b9467271.png"><br><hr><br></li><li>  Devices (PBX) to be contacted by AMCC. <br>  In our cases, the list of paired devices is quite impressive, because  tested the possibility of integration with the equipment of different vendors. <br><hr><br><img src="https://habrastorage.org/storage3/3e4/95a/2ba/3e495a2baa71c0c704773097b5cb0f4c.png"><br><hr><br></li><li>  SIP settings for communicating with PBX <br><hr><br><img src="https://habrastorage.org/storage3/56f/f3e/ca0/56ff3eca049e86ab9977d63a1e1fc055.png"><br><hr><br></li><li>  SIP trunk settings <br><hr><br><img src="https://habrastorage.org/storage3/c5e/0fa/cdb/c5e0facdb4110b8a3650be26006c94a2.png"><br><hr><br></li><li>  The settings for registering sip accounts on PBX, where PBX Number is the sip number on the PBX, PBX Password is the password for registration, respectively.  Sip numbers <br><hr><br><img src="https://habrastorage.org/storage3/b88/60e/045/b8860e045d3316aaed3e495c6591bdfe.png"><br><hr><br></li><li>  Matching user accounts in AMCC and PBX <br><hr><br><img src="https://habrastorage.org/storage3/318/c98/e3f/318c98e3f9f2548a3f112f95e8efe46d.png"><br><hr><br></li><li>  Linking a mobile number to an AMCC account <br><hr><br><img src="https://habrastorage.org/storage3/696/c82/95f/696c8295f0af89a4e0fc6758c529dc86.png"><br><hr><br></li></ul><br></li><li>  Now we check in the <b>Diagnostics ‚Üí FMC</b> section if AMCC sees our PBX and the corresponding SIP registrations <br><hr><br><img src="https://habrastorage.org/storage3/39e/b28/a0c/39eb28a0c0a5557dd5f457e775f2d783.png"><br><hr><br></li><li>  Through the installed, on a mobile device, AMC client, we try to log in to the system (you must have access to the Internet via Wi-Fi or 3G).  To do this (in Android) on the main screen, press the function key and get into the settings menu, press the function key again and select <b>Download configuration</b> .  We are asked to enter the <b>AMC user account key</b> (we received it by SMS or email) and a mobile phone number (which was listed on the portal). <br><hr><br><img src="https://habrastorage.org/storage3/51c/af4/08e/51caf408edfd1a20e0d1f2632254c811.png"><br><hr><br><img src="https://habrastorage.org/storage3/6cb/956/086/6cb95608621efaac67289a32fff8f1c6.png"><br><hr><br>  After successful registration, our AMC client became a subscriber of a corporate IP-PBX, he was assigned an internal number, which was set earlier in step 4 <br><hr><br><img src="https://habrastorage.org/storage3/6db/dc0/d69/6dbdc0d69bef989bf5b85282491305ec.png"><br><hr><br>  To be able to make calls via the mobile Internet, you need to specify <b>VoIP over 3G</b> in the settings <br><hr><br><img src="https://habrastorage.org/storage3/52c/35d/402/52c35d402d77d975081c03f98965d5ba.png"><br><hr><br>  An interesting feature was discovered when launching the AMC client on the <b>iPhone 4</b> smartphone.  When entering registration data (phone number and access code) on the AMC client software keyboard (for iOS), there was no <b>‚Äú+‚Äù</b> sign to enter the number in the international format.  Instead, it was necessary to enter <b>"00"</b> .  What is a mistake or conceived, could not figure out. <br><hr><br><img src="https://habrastorage.org/storage3/3a7/3c5/8f0/3a73c58f05914a203437a5aa76fa7a71.jpg"><br><hr><br></li></ol><br>  In the following publications, we will look at how <b>AMC</b> implements such functions as: Callback, Instant Messaging (instant messaging service), and Presens (setting presence status). </div><p>Source: <a href="https://habr.com/ru/post/197102/">https://habr.com/ru/post/197102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197086/index.html">Habrahabr entered the registry of banned sites</a></li>
<li><a href="../197088/index.html">Developing for Linux from Windows via sshd: setting Far and NetBox</a></li>
<li><a href="../197094/index.html">Let's get acquainted!</a></li>
<li><a href="../197096/index.html">I2P: Transparent access from any browser</a></li>
<li><a href="../197098/index.html">As always, quieter than water, lower than grass - the FreeBSD 9.2 release</a></li>
<li><a href="../197104/index.html">Development of the client part of the game for Windows 8</a></li>
<li><a href="../197106/index.html">Catching the Internet in a remote village using a 3G antenna</a></li>
<li><a href="../197108/index.html">Launch Synology on ESXi</a></li>
<li><a href="../197110/index.html">Tree mapping in qml</a></li>
<li><a href="../197122/index.html">Online LaTeX Editor Papeeria: Results of the Year and New Year's Gifts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>