<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience of using LoRaWAN in the AMR system in a real urban environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article presents the results of the trial operation of the commercial apartment-based energy metering system (hereinafter ASKUE) in real urban co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience of using LoRaWAN in the AMR system in a real urban environment</h1><div class="post__text post__text-html js-mediator-article">  This article presents the results of the trial operation of the commercial apartment-based energy metering system (hereinafter ASKUE) in real urban conditions on the basis of LoRaWAN domestic equipment. <br><br>  Since 2010, our company has been developing commercial and technical accounting systems in the housing and utilities sector.  We have long and successfully used the "classic" communication channels and equipment to create accounting systems.  One of the landmark projects of the company was the creation of the largest at the time of the Russian Federation system of commercial building and apartment accounting for 1,200 apartment buildings in the city of Saransk in 2014. <br><br>  At the beginning of 2017, we began to actively explore LPWAN and IoT technologies.  One of the directions of IoT development is ultra low power radio modems, which allows IoT devices to operate autonomously from battery power for several years and transmit data over relatively long distances.  The main technologies in this area are LoRaWAN and NB-IoT.  And if the NB-IoT standard is still at the stage of pilot coverage areas for cellular operators, then LoRaWAN equipment is already mass-produced and deployed in Russia.  It is with LoRaWAN that we decided to carry out a trial operation and, in the case of successful tests, implement this technology. <br><a name="habracut"></a><br>  What did we like about LoRaWAN technology? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Firstly, 10 times greater than the declared radio transmission distance compared with other wireless technologies used for telemetry (RF433, ZigBee, Z-Wave), which in practice reduces the number of base stations. </li><li>  Secondly, the technology allows installing low-power radio modems powered from a battery on metering devices and sensors, while the battery life of the devices will be 5-10 years.  For example, apartment water meters have always been a problem for us when connecting.  In the case of LoRaWAN, it is possible to organize data collection in the bathroom of an apartment without spoiling the repair, without summing up the signal and supply lines.  Moreover, the battery, in the case of LoRaWAN, will suffice until the next replacement of the metering device. </li><li>  Thirdly, the use of its own base stations and unlicensed frequencies.  There is no payment for data transmission, in contrast to the use of GSM and its NB-IoT incarnation. </li></ul><br><h2>  Problem statement and description of test accounting system </h2><br>  So, we wanted to test the operation of LoRaWAN equipment.  In a sense, we were lucky to meet our colleagues from the Vega Absolute Novosibirsk company at the IoT conference right away.  Having a little studied the solutions available at the beginning of 2017, we realized that either Western equipment is available, or what Vega Absolute does and several startups.  The equipment "Vega Absolute" was selected and the tasks of trial operation were formulated.  We decided to hold it in the city of Penza. <br><br>  We used: <br><br><ul><li>  SI-13-485 modems for RS485 operation in the ‚Äútransparent channel‚Äù mode; </li><li>  Modems with pulse counters Vega SI-11; </li><li>  Base station Vega BS-1; </li></ul><br>  <b>Tasks of trial operation were formulated as follows:</b> <b><br></b> <br><br><ol><li>  To conduct information exchange tests with a ‚Äúrunning‚Äù electricity metering device via RS-485 through the SI-13-485 radio modem, to study the features of the survey; </li><li>  Build a metering system with residential electricity and water metering devices and conduct long-term trial operation in urban environments. </li></ol><br>  The accounting system architecture looked like this: <br><br><img src="https://habrastorage.org/webt/tn/re/nm/tnrenmq9f0rqoeorbfg5iuc9pe4.png"><br><br><h2>  Information exchange with the electric meter Mercury-206 via RS-485 through a "transparent communication channel" </h2><br>  The following stand was used for testing: <br><ul><li>  ASKUE server that connects to the LoRaWAN IOT Vega Server; </li><li>  Channel-forming equipment of base station (BS) LoRaWAN - Modem SI-13-485; </li><li>  Electric meter Mercury-206 PLNO (connection via RS485). </li></ul><br><img src="https://habrastorage.org/webt/xs/v7/sc/xsv7sc4uzxrhb9dm2ugbkcpoeym.png"><br><br>  To organize a transparent communication channel, a special software was installed and configured on the test bench, which organizes a ‚Äútransparent channel‚Äù of communication with a device connected via the LoRaWAN radio channel.  The analysis of traffic showed that the exchange with the device is very slow, as a rule, the response of the device comes with a delay of 11 seconds.  With such a delay, the final polling period of the instrument very much depends on the number of polled metering device parameters, this is due to the features of the LoRaWAN exchange protocol (how many metering device parameters can be obtained in one request) and the need to read historical data from the metering archive. <br><br>  Thus, when reading 15 operational parameters from the Mercury-206 device, the average update period averaged 70 seconds, but the final polling period strongly depends on the selected set of parameters (tags) and in the worst case, the 15 tags polling period was 160 seconds. <br><br>  When reading historical data, the time for obtaining the daily active energy archive at one metering point at a tariff was 11 seconds, the speed of obtaining a power profile was 48 half-hours every 70 seconds. <br><br>  Additionally, to analyze the stability of the exchange, a long run for the 3rd day was organized, during which a continuous survey of the parameters of the connected meter was performed in order to identify possible problems.  As a result, there were problems with the survey and we were recommended to conduct the survey much less frequently.  As a result, the device parameters polling by the driver was set to poll once every 1 hour and worked for 5 days.  During the period of such a run, a relatively stable relationship was observed (approximately 0 - 3 breaks per day).  At the same time, during the run time a one-time receipt of incorrect data was recorded for one parameter.  Most likely, this was due to the confusion of the device response packets (in the exchange protocol Mercury 206 there is no possibility of validating the response packet). <br><br>  <b>The following conclusions can be drawn from the test results:</b> <br><br><ol><li>  Considering the large communication channel delays, information exchange with the devices should be conducted infrequently; the tested technology of polling via the transparent channel and with standard protocols of PU exchange is not applicable for dispatching tasks. </li><li>  When setting up reading archives, it is not recommended to interrogate from the device archives involving a large amount of data (power profiles, etc.). </li></ol><br>  In addition, based on our experience with the protocols of other metering devices, the observed delays in the ‚Äútransparent channel‚Äù of the LoRaWAN - RS-485 communication may make it impossible to read archives from some other types of devices (heat meters TEM-106, TEM-104, reading power profiles with Mercury 230 and some others). <br><br>  <i>These tests gave theoretically expected results and clearly showed why IOT devices move away from the classical request-response mode for AMR systems and go to the polling mode on the ‚Äúsmart‚Äù counter and initiating sending data from the control panel to the server on a schedule or event.</i> <br><br><h2>  Tests of data acquisition system with metering devices with pulse output </h2><br>  The experiment was conducted on objects of the city of Penza.  The objectives of the experiment were: <br><br><ol><li>  Determination of the actual coverage of one base station in urban environments and in open areas (suburbs) </li><li>  Checking the signal level inside apartment buildings in the coverage area (the influence of walls and partitions on the signal level); </li><li>  Selection of the antenna and installation site of the antenna of the base station, determination of the influence of the antenna on the coverage and signal level. </li></ol><br><h3>  First stage.  Checked outdoor coverage with a 4.5 dBi antenna </h3><br>  Our implementation department installed a base station Vega BS-1 and a 4.5 dBi antenna, which, at that time, was bundled with a BS.  Conducted preliminary testing of outdoor coverage.  The map below shows the results of our first test: successful reception of the BS signal is marked green, not red. <br><br><img src="https://habrastorage.org/webt/2k/cx/3m/2kcx3mdy9wch7vynp9y0kkoqsum.jpeg"><br><br>  <i>Conclusions: The coverage area with a complete antenna is far from the maximum for LoRaWAN and, in our case, was 2 km.</i>  <i>It became clear that we must carefully approach the installation of the base station, the declared 10 km without a good antenna and minimal radio planning, even in open areas, cannot be obtained.</i> <br><br><h3>  Second phase.  Checked coverage area inside buildings with 4.5 dBi antenna </h3><br>  At the same BS installation, it was decided to immediately test the operation of the Vega SI-11 pulse counter inside a residential building at a distance of 422 meters from the BS.  Accounting points were inside a residential building, on the 1st floor.  We were expecting something else, but tests showed that there was no reception signal! <br><br>  Contact those.  support Vega, updated software, but the connection was not possible to establish.  Conducted an analysis of the results and re-tested in the proposed installation sites of the devices.  Finally, it was possible to receive the transmission of packets from the place not closed by the capital wall from the direction to the BS.  As a result, it was possible to get a positive result and the transfer of packets was successful.  In addition, we placed the SI-11 directly on the first floor of the same house, on the roof of which the BS was installed, the transfer of packets was also successful (although it is not recommended to place modems under the BS). <br><br><img src="https://habrastorage.org/webt/2p/bk/0e/2pbk0ene-bzz6naef2cxywy9z7o.png"><br><br>  <i>Conclusions on the results of the second stage: you can use the existing solution when collecting data in the same MCD, on which the BS is installed, as well as in the MCD and objects located within a radius of 300-400 m from the BS installation site, but in each case preliminary testing of radio coverage .</i>  <i>In addition, it is not recommended to install modems beyond the main wall more than 500 mm towards the BS.</i> <br><br>  The results were clearly below our expectations, we consulted with Vega experts and now came to the obvious conclusion: we need a good BS antenna with high gain, we need to correctly mount the BS away from the BS of cellular operators and other interference, correctly place it on the roof and repeat the tests. <br><br><h3>  Third stage test with 10 dBi antenna </h3><br>  We installed a new 10 dBi antenna for the Moscow company Radial at 868 MHz, and the BS installation site is on the roof of a 12-story house.  Unfortunately, ‚Äúlife has made adjustments‚Äù and we were allowed to install the antenna and the BS on the roof of the house at the end of those.  construction of the building only in this way: <br><br><img src="https://habrastorage.org/webt/bv/u7/sv/bvu7sv8sexqrmyqj5j64r-h04qa.png"><br><br>  On the other hand, the direction to the metering points in the tested houses did not overlap this tech.  by building  Next, we conducted a test for communication range in the city outside the premises.  Modems used in the emulation mode of sending pulses, without connecting the PU.  At a distance of 6 km from the BS, the packages were successful, thus, the maximum distance that we managed to get outdoors was 6 km .: <br><br><img src="https://habrastorage.org/webt/k6/3k/ir/k63kirwufubybd1sdxy1zlqbjyi.png"><br><br>  <i>Thus, we can expect the passage of a signal from modems located, for example, in the private sector, at a distance of up to 5-6 km from the base station with a 10 dBi antenna placed on the roof of a 10-12 storey MCD.</i> <br><br><h3>  Long-term testing and packet passing statistics </h3><br>  Then we conducted a long-term test with the collection of statistics on the passage of packets of SI-11 impulse counters with PU Mercury.  The test involved 4 metering points (679m, 422m, 243m, 126m from the BS), shown below: <br><br><img src="https://habrastorage.org/webt/c6/ge/0u/c6ge0ucfhmv95dhwxi5g38ojwg4.png"><br><br>  Note that at a point at a distance of 422 m behind the main wall of 600 mm, in which there was no connection with a 4.5 dBi antenna before, a connection appeared with a 10 dBi antenna, but with losses of 10% of packets.  Thus, within a radius of about 700 m, the signal level is quite high (RSSI ~ 115), which allows you to install modems in this area inside the MCD and reliably transmit data. <br><br>  The photo below shows a typical installation location of the metering device on the staircase in the floor shield for EE metering devices to which the modem is connected: <br><br><img src="https://habrastorage.org/webt/de/__/gi/de__gi6gaapjyixjoyc0eg37g9o.png"><br><br>  Data display from the metering device Energomera CE101 in the system.  Data transmission is carried out via the SI-11-1 Modem.  The graph shows data on active energy (D, H): <br><br><img src="https://habrastorage.org/webt/f8/un/qj/f8unqj3uktttvcjts2o5ramc-jy.png"><br><br>  During the period of the primary tests, lasting 144 hours, with the transfer of packets once per hour in February 2018, the following statistics on data transmission were obtained: <br><br><ul><li>  the number of successfully received packets is 132 out of 144, which is 91.6%; </li><li>  the number of unsuccessful attempts is 12, of which by errors: </li><li>  TOO_LARGE_GW_PING_ERR (too big ping to BS) - 8 pcs .; </li><li>  LATENCY_ERR (BS server delay) - 4 pcs. </li></ul><br>  If you look at the statistics for a longer period of time from 02/21/2018 through 03/18/2018, 142 packets of 624 ~ 23% were lost with the default modem settings.  In this regard, the modem parameter ‚ÄúNumber of packet repetitions‚Äù has been increased to 5 (that is, the modem will send the packet many times until it receives a confirmation from the base station).  As a result, it was possible to almost completely eliminate packet loss.  We believe that this parameter should be set from 3 to 5, depending on the requirements for battery consumption. <br><br><h2>  Testing the discharge rate of the built-in battery of pulse counters LoRaWAN SI-11 </h2><br>  Within three months, the built-in power supply elements of the SI-11 modems were tested: <br><br>  Testing period: 03/19/2018 - 06/07/2018 (almost 3 months): <br><br><ol><li>  Testing conditions: modems are installed in panels on the landing MKD, constant positive temperature (according to data from the temperature sensor inside the modem from +26 to +29 gr. ); </li><li>  Poll frequency: SI-11 No. 383336384B368A0F - 1 time per hour, SI-11 No. 3530373550376114 - once every 6 hours. </li></ol><br>  The table with the data on the remaining battery charge: <br><br><img src="https://habrastorage.org/webt/g1/kb/cq/g1kbcqe67kgpbrzfoi1tjjxyyg0.png"><br><br>  <i>Conclusions: considering the results obtained, we can estimate the operating time in similar conditions up to 100% of the battery discharge:</i> <i><br><br></i> <ul><li>  <i>when interviewed 1 time per hour - 45 months or 3.7 years</i> </li><li>  <i>during the survey 1 time per 6 hours - 135 months or 11.2 years</i> </li></ul><br><h2>  General conclusions on the test results </h2><br>  Technology "working".  Equipment for the summer of 2018 is already commercially available in the range and domestic production.  The technology should be applied taking into account its features: <br><br><ol><li>  LoRaWAN equipment works reliably within a radius of 1 km from the BS inside buildings and up to 5-6 km outdoors if it is ‚Äúproperly prepared‚Äù; </li><li>  works well with devices specially designed for LoRaWAN, and does not work well (slowly) in RS-485 transparent channel mode due to large channel delays; </li><li>  requires competent BS installation, however, like any radio communication equipment.  Proper placement of the BS and a good antenna is the key to success; </li><li>  The stated 6-10 years of battery life are quite achievable with the correct setting of the frequency of data collection. </li><li>  The technology is ideal for installation inside apartments for metering cold water and hot water, as well as EE, but there is an alternative in the form of a PLC </li></ol></div><p>Source: <a href="https://habr.com/ru/post/419665/">https://habr.com/ru/post/419665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419655/index.html">Music in the apartment. Embedding</a></li>
<li><a href="../419657/index.html">As for a flock of drones developed collective intelligence</a></li>
<li><a href="../419659/index.html">Where Hollywood portrays hackers correctly, and where - mistakenly</a></li>
<li><a href="../419661/index.html">Making a radio station from GTA: San Andreas</a></li>
<li><a href="../419663/index.html">Governmental organizations lure the creators of ultra-low RN with contracts, bonuses and simplified bureaucracy</a></li>
<li><a href="../419667/index.html">Selection of useful materials on Azure. Part 1 - Books</a></li>
<li><a href="../419671/index.html">Restrictions that need to be violated or how we accelerated the functional tests three times</a></li>
<li><a href="../419673/index.html">Early Universe 6. The Dynamics of a Homogeneous Expanding Universe, Part 2</a></li>
<li><a href="../419675/index.html">Review of per minute rental of electric scooters in Moscow, summer 2018</a></li>
<li><a href="../419677/index.html">How to sniff HTTPS traffic on an iOS device</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>