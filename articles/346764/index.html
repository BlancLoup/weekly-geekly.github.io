<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>January fixing holes in the .NET Framework and Core</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Exactly by the end of the New Year holidays in Russia, on January 9th, Microsoft released updates correcting CVE-2018-0786 and CVE-2018-0764 . They re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>January fixing holes in the .NET Framework and Core</h1><div class="post__text post__text-html js-mediator-article"><p>  Exactly by the end of the New Year holidays in Russia, on January 9th, Microsoft released updates correcting <a href="https://github.com/dotnet/announcements/issues/51">CVE-2018-0786</a> and <a href="https://github.com/dotnet/announcements/issues/52">CVE-2018-0764</a> .  They repaired it so that they broke it somewhere else.  In this short post we will once again remember what it is and what we should do now. </p><br><p>  To illustrate this habrapos, I tried to draw a sieve.  As you can see, I did not succeed.  Unfortunately, making a sieve in a code is much easier than portraying it, for the first time picking up a graphic tablet. </p><br><img src="https://habrastorage.org/webt/sx/v1/4o/sxv14ojroonigrgz4o8bce334yo.png"><a name="habracut"></a><br><h1 id="ya-tozhe-pod-ugrozoy">  Am I also under threat? </h1><br><p>  If you are using the .NET Framework, you need to make sure that you have version 4.7.1 installed, and Windows installed the <a href="https://blogs.msdn.microsoft.com/dotnet/2018/01/09/net-framework-january-2018-security-and-quality-rollup/">.NET Framework</a> update <a href="https://blogs.msdn.microsoft.com/dotnet/2018/01/09/net-framework-january-2018-security-and-quality-rollup/">January 2018 Security and Quality Rollup</a> ( <a href="https://support.microsoft.com/en-us/help/4055002">KB4055002</a> ).  Or, at a minimum, <a href="https://support.microsoft.com/en-us/help/4054183/description-of-the-security-only-update-for-net-framework-4-6-4-6-1-4">Security-Only Update</a> ( <a href="https://support.microsoft.com/en-us/help/4054183">KB4054183</a> ). <br>  If this is not the case, you have problems. </p><br><p>  You can check the version of the .NET Framework itself using <a href="https://docs.microsoft.com/ru-ru/dotnet/framework/migration-guide/how-to-determine-which-versions-are-installed">the link instructions</a> .  In order not to check each time with your hands, there is a <a href="https://stackoverflow.com/questions/3487265/powershell-script-to-return-versions-of-net-framework-on-a-machine">script for Power Shell</a> . </p><br><p> If you are using .NET Core, then you need to go to the file system and see which version of runtime is installed.  If there is no directory <code>1.0.9</code> , <code>1.1.6</code> or <code>2.0.5</code> , then you have a problem! </p><br><p>  Where to see: </p><br><table><tbody><tr><td align="left">  Windows </td><td align="left">  C: \ Program Files \ dotnet \ shared \ Microsoft.NETCore.App \ </td></tr><tr><td align="left">  macOS </td><td align="left">  /usr/local/share/dotnet/shared/Microsoft.NETCore.App/ </td></tr><tr><td align="left">  GNU / Linux </td><td align="left">  /usr/share/dotnet/shared/Microsoft.NETCore.App/ </td></tr></tbody></table><br><p>  Exact list of vulnerable .NET Core versions: </p><br><table><thead><tr><th align="center">  Runtime version </th><th align="center">  Fixed in version </th></tr></thead><tbody><tr><td align="left">  1.0.0, 1.0.1, 1.0.2, 1.0.3, 1.0.4, 1.0.5, 1.0.7, 1.0.8 </td><td align="left">  1.0.9 </td></tr><tr><td align="left">  1.1.0, 1.1.1, 1.1.2, 1.1.4, 1.1.5 </td><td align="left">  1.1.6 </td></tr><tr><td align="left">  2.0.0, 2.0.3, 2.0.4 </td><td align="left">  2.0.5 </td></tr></tbody></table><br><h2 id="chto-delat">  What to do? </h2><br><p>  Developers will have to update the .NET Framework to 4.7.1 and update Windows <a href="https://blogs.msdn.microsoft.com/dotnet/2018/01/09/net-framework-january-2018-security-and-quality-rollup/">with the latest updates</a> .  Not on all versions of Windows this update works well (read the article to the end). </p><br><p>  The .NET Core SDK must be upgraded to version <code>2.1.4</code> or <code>1.1.7</code> .  Sysadmins need to update .NET Core to version <code>1.0.9</code> , <code>1.1.6</code> or <code>2.0.5</code> . </p><br><p>  <a href="https://docs.microsoft.com/en-us/dotnet/core/deploying/">Self-contained</a> applications will have to be rebuilt; in other cases, runtime update and the SDK are sufficient. </p><br><h1 id="cve-2018-0764-denial-of-service-when-parsing-xml-documents">  CVE-2018-0764: Denial of Service when parsing XML documents </h1><br><h2 id="oficialnye-ssylki">  Official links </h2><br><ul><li>  <a href="https://github.com/dotnet/announcements/issues/52">Github: .NET Foundation</a> </li><li>  <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3DCVE-2018-0764">Common Vulnerabilities and Exposures Database</a> </li></ul><br><h1 id="chto-sluchilos">  What happened? </h1><br><p>  .NET Framework and Core poorly parse XML, using what a hacker can do with a DDOS attack on your application. </p><br><p>  In the update it was fixed.  Exploits are not <em>publicly</em> distributed. </p><br><hr><br><h1 id="cve-2018-0786-security-feature-bypass-in-x509-certificate-validation">  CVE-2018-0786: Security Feature Bypass in X509 Certificate Validation </h1><br><h2 id="oficialnye-ssylki-1">  Official links </h2><br><ul><li>  <a href="https://github.com/dotnet/announcements/issues/51">Github: .NET Foundation</a> </li><li>  <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3DCVE-2018-0764">Common Vulnerabilities and Exposures Database</a> </li></ul><br><h2 id="chto-sluchilos-1">  What happened? </h2><br><p>  In the public versions of the .NET Framework and Core, there is a vulnerability that allows a hacker to slip a certificate marked invalid for a particular use, and nevertheless use it for this purpose.  This allows you to ignore Enhanced Key Usage. </p><br><p>  In the update it was fixed.  Exploits are not <em>publicly</em> distributed. </p><br><h1 id="nuzhno-li-obnovlyat-pakety">  Do I need to upgrade packages? </h1><br><p>  The <code>Microsoft.NETCore.UniversalWindowsPlatform</code> package is vulnerable. <br>  The package version is listed along with its corresponding .NET Native version. </p><br><table><thead><tr><th align="center">  NuGet / .NET Native </th><th align="center">  Fixed in version </th></tr></thead><tbody><tr><td align="left">  5.2. * / 1.4. * </td><td align="left">  5.2.4 </td></tr><tr><td align="left">  5.3. * / 1.6. * </td><td align="left">  5.3.5 </td></tr><tr><td align="left">  5.4. * / 1.7. * </td><td align="left">  5.4.2 </td></tr><tr><td align="left">  6.0. * / 2.0. * </td><td align="left">  6.0.6 </td></tr></tbody></table><br><h2 id="kak-pochinit-moyo-prilozhenie-esli-ya-ispolzuyu-net-core">  How to repair my application if I use .NET Core? </h2><br><p>  For this bug, the type of application is important: </p><br><ul><li>  Ordinary </li><li>  <a href="https://docs.microsoft.com/en-us/dotnet/core/deploying/">Self-contained</a> </li><li>  Native </li></ul><br><p>  Regular applications can be repaired by simply installing the correct version of the SDK or runtime you are running on.  Download <a href="">here</a> . </p><br><p>  Self-contained applications will have to be rebuilt with the newly updated SDK and redone. </p><br><p>  Next, let's talk about native applications.  It is necessary to process it again with the native compiler of the updated SDK and re-allocate the result in the Windows Store. </p><br><p>  MS recommends upgrading UWP applications to the latest minor version of the <code>Microsoft.NETCore.UniversalWindowsPlatform</code> NuGet package so that you can rebuild the application and understand that it has not collapsed.  You can, of course, update immediately and to a more recent major version, but this is not necessary - an update is issued for all major versions that have been affected by the bug. </p><br><p>  Regardless of whether you updated your NuGet-packages, all applications filled in to the store after January 9th will be automatically repaired right during the uploading to the store. </p><br><p>  If you do not update your application in the store, it will still be automatically processed and sent via Windows Update over the coming weeks.  Anyone who hasn't disabled auto-updates will get an updated version without the need for someone to manually intervene.  But for sideloaded applications, you will have to update the NuGet packages yourself, rebuild them and deliver them to users. </p><br><h1 id="obnovleniya-slomayut-windows-7-i-windows-server-pri-ispolzovanii-net-framework">  Updates will break Windows 7 and Windows Server using the .NET Framework </h1><br><p>  According to <a href="https://github.com/Microsoft/dotnet/issues/599">this still open bug</a> , the patch not only treats, but also disables it.  The problem only occurs when using Windows 7 Service Pack 1 and Windows Server 2008 R2 Service Pack 1. </p><br><p>  It is enough to install updates or the .NET Framework 4.7.1, as WPF applications requesting the fallback font (or a character not included in the current font) fall off with the following error: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.TypeInitializationException ‚ÄúFileFormatException: <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> FontFamily element <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> FontFamilyCollection that matches <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> OS <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> greater: Win7SP1‚Äù. <span class="hljs-keyword"><span class="hljs-keyword">Inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exception</span></span> originates <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: CompositeFontParser</code> </pre> <br><p>  The problem is that the installer incorrectly handles the interaction of the update installer (.NET Framework January 2018 Rollup - KB4055002) and the already installed .NET Framework 4.7.1.  The Rollup installer accidentally overwrites the GlobalUserInterface.CompositeFont file that came with version 4.7.1, causing WPF applications to fall. </p><br><p>  There are three solutions. </p><br><h2 id="sposob-pervyy-udalit-yanvarskie-obnovleniya">  Method one: remove the January updates </h2><br><p>  You need to remove: "January. NET Framework Security and Quality Rollup ( <a href="https://support.microsoft.com/en-us/help/4055002">KB4055002</a> )". </p><br><p>  And instead install: "January .NET Framework Security-Only Update ( <a href="https://support.microsoft.com/en-us/help/4054183">KB4054183</a> )". </p><br><p>  To do this, you need to perform the following steps: </p><br><ol><li>  Control Panel ‚Üí Windows Update ‚Üí View update history </li><li>  In the "Review your update history" list, find and select "Security Update for Microsoft .NET Framework 4.6, 4.6.1, 4.6.2, 4.7, 4.7.1 (KB4055002)".  Click Uninstall. </li><li>  When asked whether or not to delete - agree. </li><li>  Be sure to restart the computer if you are asked to. </li><li>  Download and install the security patch of the version you need: <br><ul><li>  <a href="">Only for the .NET Framework 4.6, 4.6.1, 4.6.2, 4.7, and 4.7.1 for Windows 7 SP1 and Windows Server 2008 R2 SP1 for x86 systems (KB4054183)</a> </li><li>  <a href="">Only for the .NET Framework 4.6, 4.6.1, 4.6.2, 4.7, and 4.7.1 on Windows 7 SP1 and Windows Server 2008 R2 SP1 for x64 systems (KB4055269)</a> </li></ul></li><li>  Do everything you are asked for, and in the end - be sure to restart the computer. </li></ol><br><h2 id="sposob-vtoroy-udalit-net-framework-471-ustanovit-net-framework-47">  Method two: uninstall .NET Framework 4.7.1, install .NET Framework 4.7 </h2><br><ol><li>  Control Panel ‚Üí Programs and Features </li><li>  In the "Uninstall or change a program" list, highlight "Microsoft .NET Framework 4.7.1" and click Uninstall / Change. <br><img src="https://habrastorage.org/getpro/habr/post_images/717/d90/441/717d90441e2c0e0c8379d104000cf96f.png"></li><li>  Select "Remove .NET Framework 4.7.1 from this computer", and click Next. <br><img src="https://habrastorage.org/getpro/habr/post_images/e72/685/73d/e7268573ddac2d0b29e245b7f9f1427e.png"></li><li>  Click continue and wait for deletion. </li><li>  Click Finish when the removal is complete. <br><img src="https://habrastorage.org/getpro/habr/post_images/d4a/96e/510/d4a96e510a736d0617ad151f049d1af6.png"></li><li>  Be sure to restart the computer if you are asked to. </li><li>  Install <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D55170">.NET Framework 4.7</a> . </li></ol><br><h2 id="sposob-tretiy-zamenite-globaluserinterfacecompositefont-na-pravilnyy-fayl">  Method three: replace <code>GlobalUserInterface.CompositeFont</code> with the correct file </h2><br><ol><li>  Download <a href="https://dotnetbinaries.blob.core.windows.net/kbassets/KB4074906/GlobalUserInterface.CompositeFont">GlobalUserInterface.CompositeFont</a> (for Windows 7, the standard installation path is <code>%USERPROFILE%\Downloads</code> ) </li><li>  Open <code>cmd</code> , go to <code>%windir%\Microsoft.NET\Framework\v4.0.30319\WPF\Fonts</code> and run: <br>  <code>xcopy /y %USERPROFILE%\Downloads\GlobalUserInterface.CompositeFont</code> . <br>  (or just copy the GlobalUserInterface.Composite file to this place) </li><li>  Open <code>cmd</code> , go to <code>%windir%\Microsoft.NET\Framework64\v4.0.30319\WPF\Fonts</code> and run: <br>  <code>xcopy /y %USERPROFILE%\Downloads\GlobalUserInterface.CompositeFont</code> . <br>  (or again use the copy-paste file in Explorer). </li><li>  Restart the WPF application. </li><li>  If it still does not work, restart the computer and restart the WPF application again. </li></ol><br><h1 id="rezyume">  Summary </h1><br><p>  Even very good and quality projects contain mistakes.  In order not to be trapped, you need to be updated in time, <a href="https://blogs.msdn.microsoft.com/dotnet">read official news</a> and study current trends at <a href="https://dotnext-piter.ru/">conferences like DotNext</a> , of course.  Salvation of the drowning is the work of the drowning! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346764/">https://habr.com/ru/post/346764/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346754/index.html">The book "React and Redux: functional web development"</a></li>
<li><a href="../346756/index.html">How far the unmanned vehicle will reach? Ask a question to an Intel expert</a></li>
<li><a href="../346758/index.html">Burn after reading. We make one-time links to naked Nginx</a></li>
<li><a href="../346760/index.html">TeamLead - our all: the most popular reports from HighLoad ++ 2017. Part 1</a></li>
<li><a href="../346762/index.html">The magic of the word "blockchain" and other materials in our collection</a></li>
<li><a href="../346766/index.html">Recognizing motion gestures on Android using Tensorflow</a></li>
<li><a href="../346768/index.html">Two-factor authentication for Cisco Meraki Client VPN using Token2 TOTPRadius</a></li>
<li><a href="../346770/index.html">Undocumented CSS Techniques</a></li>
<li><a href="../346772/index.html">Using the KOMPAS-3D API ‚Üí Lesson 6 ‚Üí Saving a document in various formats</a></li>
<li><a href="../346774/index.html">JavaScript exceeded everyone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>