<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix 3.4: Macros in time intervals</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. We continue to cover the innovations of Zabbix 3.4. Today we will talk about the use of macros in the update intervals and other time periods. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix 3.4: Macros in time intervals</h1><div class="post__text post__text-html js-mediator-article"><p>  Hey.  We continue to cover the innovations of Zabbix 3.4.  Today we will talk about the use of macros in the update intervals and other time periods. </p><br><p><img src="https://habrastorage.org/webt/aq/cr/wy/aqcrwymaj5v4qyqteu-ijficb-8.png"></p><a name="habracut"></a><br><h1 id="paru-slov-o-makrosah">  A few words about macros </h1><br><p>  <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/macros/usermacros">User macros</a> are a long-established mechanism used in Zabbix everywhere and giving the monitoring system the flexibility it needs.  In essence, these are variables that you can assign with a global level of visibility, pattern or host.  The use of macros is strongly encouraged and recommended, for example, in templates, which makes them customizable in other environments and other users. <br>  User macros look like this, you probably already met them: </p><br><pre><code class="hljs perl">{$MACRO}</code> </pre> <br><h1 id="intervaly-obnovleniya-i-hraneniya-istorii">  Interval update and storage history </h1><br><p>  Zabbix allows you to flexibly customize the time for polling metrics: each metric can have its own interval. </p><br><p><img src="https://habrastorage.org/webt/10/_c/fc/10_cfcwspbnout7u_5ritpyz9ok.png"></p><br><p>  Updates for each metric can also be "flexible" (see <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/items/item/custom_intervals">User intervals</a> ), and therefore take place on a specific schedule ("once a day at night" or "at 9:00 am on weekdays"). </p><br><p>  Similarly, we can determine the storage time of history and trends for each data element separately. </p><br><p>  This subtlety of tuning is not always needed, so the use of macros gives a couple of new ideas for setting up these parameters. </p><br><h1 id="varianty-ispolzovaniya">  Use cases </h1><br><h3 id="intervaly-obnovleniya-i-dlitelnost-hraneniya-sobrannyh-dannyh">  Update intervals and storage duration of the collected data </h3><br><p>  First, the metric update intervals (both regular and custom intervals), which are discussed above, now support custom macros.  Secondly, you can use macros in the history and trend storage intervals.  In the end, it looks like this: </p><br><p><img src="https://habrastorage.org/webt/ka/up/hw/kauphwlrtbd1wvabaxsfrph-t4m.png"></p><br><p>  Simply set the values ‚Äã‚Äãof these macros globally, and then reassign at the template or host level, if necessary: </p><br><p><img src="https://habrastorage.org/webt/cu/n8/sz/cun8sz3chzhzojwlvlcuatybbbe.png"></p><br><p>  In general, for <em>update intervals,</em> you can create a small global set of macros, which are then used by default for all new <em>data items</em> , depending on their type and importance.  For example: </p><br><p><img src="https://habrastorage.org/webt/hi/7n/wp/hi7nwphwm8eixzchct95pox86_m.png"></p><br><p>  This will allow you not to spend time thinking each time, ‚Äúdo I want to collect this metric once 60 or once every 61 seconds? Or maybe once every 5 minutes will be enough?‚Äù, But just use the rules adopted on your server and the draft to collect and store items data recorded in global macros.  Although, perhaps, this option is not suitable for everyone :) </p><br><h3 id="v-nizkourovnevom-obnaruzhenii">  In low level detection </h3><br><p>  <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/macros/usermacros">Macro context is</a> also supported, which can be very useful, for example, with <a href="https://www.zabbix.com/documentation/3.4/ru/manual/discovery/low_level_discovery">LLD</a> . <br>  Imagine that we collect network interface traffic on multiple devices.  In order not to load Zabbix, we would like to do this as follows: </p><br><ul><li>  Key interfaces, trunks and other uplinks - take data once every 1 minute, store <em>history for</em> 30 days, and <em>trends for</em> 1 year. </li><li>  other interfaces - to poll every 5 minutes, to store the <em>history for</em> 3 days, and <em>trends for</em> 1 month. </li></ul><br><p>  First, let's define global macros {$ DELAY_IF}, {$ HISTORY_IF}, {$ TREND_IF}: </p><br><p><img src="https://habrastorage.org/webt/gy/fm/gi/gyfmgitpt3yfuqrqwdnzczg5cqu.png"></p><br><p>  Then we use them in the prototype of the data element of the interface, but already with the context (in this case, it will be the name of the interface ifName): </p><br><p><img src="https://habrastorage.org/webt/rv/xg/u6/rvxgu66crsx6breo0rtdkaftcn4.png"></p><br><p>  Already at the host level, we indicate the new value of the macro with the context for the key interface (for example, take Gi0 / 0.114): </p><br><p><img src="https://habrastorage.org/webt/sp/7p/ho/sp7phoa3k4gsaqiz7cqpfqmsnhq.png"></p><br><p>  Now let's look at the refresh rate and retention time for various interfaces in the ‚ÄúLatest Data‚Äù.  As you can see, our very important Gi0 / 0.114 now has its own rules for storage and collection: </p><br><p><img src="https://habrastorage.org/webt/3p/vk/np/3pvknpnzch9w0x0sit_8ubnnsri.png"></p><br><p>  If we want to change the total interval or increase the frequency of polling or the storage time of another interface - we just need to reassign the macros at the host level.  There is no need to change the template, prototype and wait for detection - everything will apply immediately.  In fact, even write access to the template is not required. </p><br><h3 id="gde-esche">  Where else? </h3><br><p>  And macros can now be used in other situations where it was necessary to specify the time or period.  For example, in the actions: </p><br><p><img src="https://habrastorage.org/webt/qb/i0/7i/qbi07ie3gljqji_w7lbiufjpqby.png"></p><br><p>  or, via the macro, specify the availability time of the engineer for automatic notifications: </p><br><p><img src="https://habrastorage.org/webt/bj/os/oh/bjosohoe4pqosihnma-eptqfmg0.png"></p><br><p>  The exact list of places where macros can be used can be found <a href="https://www.zabbix.com/documentation/3.4/manual/appendix/macros/supported_by_location_user">here</a> . </p><br><h1 id="v-itoge">  Eventually </h1><br><p>  New macro features in 3.4 open up a couple of good opportunities: on the one hand, for more fine-tuning (for LLD), and on the other hand, for centralizing and managing the polling time and storage.  And by the way, in the time intervals there appeared support for the suffixes s, m, h, d, w - a trifle, but conveniently :) </p><br><p>  See you! </p><br><p>  <strong>PS</strong> Article is also available in our <a href="http://blog.zabbix.com/using-macros-for-time-periods-management/">blog</a> in English. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/344492/">https://habr.com/ru/post/344492/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344482/index.html">Intel AI Academy - New Year's gift for all developers of AI</a></li>
<li><a href="../344484/index.html">Click, trade, deposit. Our online tools for corporate clients</a></li>
<li><a href="../344486/index.html">Parcel - a very fast bandler that does not require configuration.</a></li>
<li><a href="../344488/index.html">Monitoring Trassir Servers</a></li>
<li><a href="../344490/index.html">Let's drive a mammoth into a hole: how to make a presentation so that you can be heard and remembered</a></li>
<li><a href="../344494/index.html">Do not succumb to HYIP, or why the price of Bitcoin does not reflect its real value.</a></li>
<li><a href="../344496/index.html">New spyware StrongPity2 replaced FinFisher in a cyber espionage campaign with the possible participation of an Internet provider</a></li>
<li><a href="../344498/index.html">PHP dependency management</a></li>
<li><a href="../344502/index.html">TypeScript basics for developing Angular applications</a></li>
<li><a href="../344504/index.html">Avito iOS Winter Edition - video, photos, slides, reviews</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>