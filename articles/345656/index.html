<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We try q-learning to taste, the story in three parts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a short note on the implementation of the q-learning algorithm for managing an agent in a stochastic environment. The first part of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We try q-learning to taste, the story in three parts</h1><div class="post__text post__text-html js-mediator-article">  This article is a short note on the implementation of the q-learning algorithm for managing an agent in a stochastic environment.  The first part of the article will be devoted to creating an environment for carrying out simulations - mini-games on the nxn field, in which the agent must hold out for a long time at a distance from opponents moving randomly.  The task of the opponents, respectively, to overtake him.  Points are awarded for each move made by the agent in the simulation.  The second part of the article will cover the basics of the q-learning algorithm and its implementation.  In the third part, we will try to change the parameters that determine the perception of the environment by the agent.  Let us analyze the influence of these parameters on the performance of his game.  I specifically shifted the emphasis towards using a minimum number of third-party modules.  The goal is to touch the essence of the algorithm, to touch it, so to speak.  For implementation we will use only "pure" python 3. <br><br><img src="https://habrastorage.org/webt/vq/3p/we/vq3pweivudxkrs174pjfyblkz1o.png"><br><a name="habracut"></a><br><h2>  Part 1. Creating the environment </h2><br>  The medium in which the agent operates is represented by a two-dimensional field of size n.  This is how it looks like: <br><br><img src="https://habrastorage.org/webt/qg/rz/ga/qgrzga4p-7ff8zbtaa2ikvly9nu.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here the unit is represented by the agent, the deuce is marked with the opponent  Now we turn directly to the code.  Variables that describe the environment: field size, agent, list of opponents. <br><br><div class="spoiler">  <b class="spoiler_title">environment class</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">W</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,n)</span></span></span><span class="hljs-function">:</span></span> self.n=n self.P=P(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,n) self.ens=[EN(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,n),EN(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,n),EN(<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,n)]</code> </pre> <br></div></div><br>  Typical actor: agent or adversary. <br><br><div class="spoiler">  <b class="spoiler_title">actor class</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">un</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> self.x = x self.y = y <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.x, self.y</code> </pre> <br></div></div><br>  Agent description. <br><div class="spoiler">  <b class="spoiler_title">agent class</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(un)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y,n)</span></span></span><span class="hljs-function">:</span></span> self.n=n un.__init__(self,x,y)</code> </pre> <br></div></div><br>  The strategy of the agent, while empty. <br><br><div class="spoiler">  <b class="spoiler_title">agent strategy method</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">strtg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br></div></div><br>  Each of the participants in the simulation can make a move in any direction, including diagonally, the actor can also not move at all.  The set of allowed movements on the example of the enemy: <br><br><img src="https://habrastorage.org/webt/_z/or/u3/_zoru301wup_vguipugrztozg1c.png"><br><br>  Thanks to the diagonal movements, the enemy always has the opportunity to overtake the agent, no matter how hard he tries to leave.  This provides a finite number of simulation moves for any degree of agent training.  Let's write its possible actions with the validation of the offset.  The method takes the change in the coordinates of the agent and updates its position <br><br><div class="spoiler">  <b class="spoiler_title">agent's move method</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> dx,dy=self.strtg() a=self.x+dx b=self.y+dy expr=((<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=a&lt;self.n) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=b&lt;self.n)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> expr: self.x=a self.y=b</code> </pre> <br></div></div><br>  Description of the enemy. <br><br><div class="spoiler">  <b class="spoiler_title">adversary class</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EN</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(un)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y,n)</span></span></span><span class="hljs-function">:</span></span> self.n=n un.__init__(self,x,y)</code> </pre> <br></div></div><br>  Moving an adversary with offset validation.  The method does not exit the cycle until the condition of the course validity is satisfied. <br><br><div class="spoiler">  <b class="spoiler_title">opponent's move method</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> expr=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> expr: a=self.x+random.choice([<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>]) b=self.y+random.choice([<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>]) expr=((<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=a&lt;self.n) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=b&lt;self.n)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> expr: self.x=a self.y=b</code> </pre> <br></div></div><br>  One step simulation.  Update the position of the enemy and the agent. <br><br><div class="spoiler">  <b class="spoiler_title">environment method, unfolds the next step of the simulation</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: i.move() self.P.move()</code> </pre> <br></div></div><br>  Visualization of the work of the simulation. <br><br><div class="spoiler">  <b class="spoiler_title">environment method, field drawing and position of actors</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>*<span class="hljs-number"><span class="hljs-number">100</span></span>) px,py=self.P.getxy() self.wmap=list([[<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.n)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.n)]) self.wmap[py][px]=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() self.wmap[ey][ex]=<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.wmap: print(i)</code> </pre> <br></div></div><br>  Simulation, the main stages: <br><br>  1. Registration of coordinates of actors. <br>  2. Check the achievement of conditions for the completion of the simulation. <br>  3. Start the update cycle of the simulation. <br>  - Drawing environment. <br>  - Update simulation state. <br>  - Registration of coordinates of actors. <br>  - Check the achievement of conditions for the completion of the simulation. <br>  4. Drawing the environment. <br><br><div class="spoiler">  <b class="spoiler_title">environment method, simulation sequence playback</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> px,py=self.P.getxy() bl=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() bl=bl <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (px,py)!=(ex,ey) iter=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> bl: time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) wr.pr() self.step() px,py=self.P.getxy() bl=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() bl=bl <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (px,py)!=(ex,ey) print((px,py),(ex,ey)) print(<span class="hljs-string"><span class="hljs-string">'___'</span></span>) iter=iter+<span class="hljs-number"><span class="hljs-number">1</span></span> print(iter)</code> </pre> <br></div></div><br>  Initialization of the environment and launch. <br><br><div class="spoiler">  <b class="spoiler_title">launch simulation</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__==<span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: wr=W(<span class="hljs-number"><span class="hljs-number">7</span></span>) wr.play() wr.pr()</code> </pre> <br></div></div><br><h2>  Part 2. Agent training </h2><br>  The q-learning method is based on the introduction of the Q function, reflecting the value of each possible agent action a for the current state s, in which the simulation is now located.  Or short: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.002ex" height="2.66ex" viewBox="0 -832 3014.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="791" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="1181" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="1650" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="2095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="2625" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> Q (s, a) </script></p><br><br>  This function sets the agent's assessment of the reward that he can receive by performing a certain action in a certain course.  It also includes an assessment of what rewards an agent can receive in the future.  The learning process is an iterative refinement of the value of the function Q on each move of the agent.  The first step is to determine the value of the reward that the agent will receive this turn.  Write it variable <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>r</mi><mi>t</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.875ex" height="1.817ex" viewBox="0 -520.7 807.1 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="638" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>r</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> r_t </script>  .  Next, we define the maximum expected reward on subsequent turns: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.211ex" height="2.66ex" viewBox="0 -832 6979.6 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="1128" y="0"></use><g transform="translate(1658,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="2704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="3496" y="0"></use><g transform="translate(3885,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="5615" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="6060" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="6590" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> \ max_ {a} Q (s_ {t + 1}, a) </script></p><br><br>  Now it is necessary to decide that the agent has great value: immediate rewards or future ones.  This problem is resolved by an additional factor in the component evaluation of subsequent awards.  As a result, the value of the function Q predicted by the agent at this step should be as close as possible to the value: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.933ex" height="2.66ex" viewBox="0 -832 14610.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="638" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="1029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-67" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="2760" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="3290" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="4168" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="5047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-63" x="5826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-64" x="6260" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6F" x="6783" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="7269" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="7880" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="8759" y="0"></use><g transform="translate(9288,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="10335" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="11126" y="0"></use><g transform="translate(11516,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="13245" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="13691" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="14220" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mtext>&nbsp;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> r_t + \ gamma \ cdot \ max_ {a} Q (s_ {t + 1}, a) </script></p><br><br>  Thus, the agent‚Äôs prediction error of the Q function value for the current move is written as follows: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>D</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>q</mi><mo>=</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2212;</mo><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="55.947ex" height="2.66ex" viewBox="0 -832 24088.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-44" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-65" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6C" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="1843" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="2205" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-71" x="2734" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-3D" x="3472" y="0"></use><g transform="translate(4529,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="5558" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-67" x="6809" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="7289" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="7819" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="8697" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="9576" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-63" x="10355" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-64" x="10789" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6F" x="11312" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="11798" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="12409" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="13288" y="0"></use><g transform="translate(13817,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="14864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="15656" y="0"></use><g transform="translate(16045,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="17775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="18220" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="18749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2212" x="19361" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="20362" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="21153" y="0"></use><g transform="translate(21543,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="22368" y="0"></use><g transform="translate(22813,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="23698" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>D</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>q</mi><mo>=</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mtext>&nbsp;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>‚àí</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> \ Delta q = r_t + \ gamma \ cdot \ max_ {a} Q (s_ {t + 1}, a) -Q (s_t, a_t) </script></p><br><br>  We introduce a coefficient that will regulate the learning speed of the agent.  Then the formula for the iterative calculation of the function Q has the form: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>D</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>q</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="45.881ex" height="2.66ex" viewBox="0 -832 19754.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="791" y="0"></use><g transform="translate(1181,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="2910" y="0"></use><g transform="translate(3355,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="0" y="0"></use><g transform="translate(529,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="5145" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-3D" x="5812" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="6868" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="7660" y="0"></use><g transform="translate(8049,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="8874" y="0"></use><g transform="translate(9320,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="10205" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="10816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="12067" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6C" x="12597" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-70" x="12895" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-68" x="13399" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="13975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-63" x="14755" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-64" x="15188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6F" x="15712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="16197" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-44" x="16809" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-65" x="17637" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6C" x="18104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="18402" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="18764" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-71" x="19293" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>D</mi><mi>e</mi><mi>l</mi><mi>t</mi><mi>a</mi><mi>q</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> Q (s_ {t + 1}, a_ {t + 1}) = Q (s_t, a_t) + \ alpha \ cdot \ Delta q </script></p><br><br>  The general formula for the iterative calculation of the function Q: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2212;</mo><mi>Q</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="85.697ex" height="2.66ex" viewBox="0 -832 36897.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="791" y="0"></use><g transform="translate(1181,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="2910" y="0"></use><g transform="translate(3355,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="0" y="0"></use><g transform="translate(529,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="5145" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-3D" x="5812" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="6868" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="7660" y="0"></use><g transform="translate(8049,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="8874" y="0"></use><g transform="translate(9320,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="10205" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="10816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="12067" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6C" x="12597" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-70" x="12895" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-68" x="13399" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="13975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-63" x="14755" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-64" x="15188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6F" x="15712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="16197" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="16559" y="0"></use><g transform="translate(16948,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="17977" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-67" x="19228" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="19709" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="20238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="21117" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="21995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-63" x="22775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-64" x="23208" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6F" x="23732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="24217" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-6D" x="24829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="25707" y="0"></use><g transform="translate(26237,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="27284" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="28075" y="0"></use><g transform="translate(28465,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2B" x="361" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-31" x="1140" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="30194" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="30639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="31169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2212" x="31780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-51" x="32781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-28" x="33573" y="0"></use><g transform="translate(33962,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-2C" x="34787" y="0"></use><g transform="translate(35232,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMATHI-74" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="36118" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/345656/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj44ElC_V5oSOAq8iff5tMMq3dkTQ#MJMAIN-29" x="36507" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mo stretchy="false">(</mo><msub><mi>r</mi><mi>t</mi></msub><mo>+</mo><mtext>&nbsp;</mtext><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>‚àí</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><msub><mi>a</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> Q (s_ {t + 1}, a_ {t + 1}) = Q (s_t, a_t) + \ alpha \ cdot (r_t + \ gamma \ cdot \ max_ {a} Q (s_ {t + 1}, a ) -Q (s_t, a_t)) </script></p><br><br>  Let us single out the main features that will make up the description of the environment from the point of view of the agent.  The more extensive the set of parameters, the more accurate its response to changes in the environment.  At the same time, the size of the state space can significantly affect the speed of learning. <br><br><div class="spoiler">  <b class="spoiler_title">agent method, signs describing the state of the environment</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_features</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> features=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: <span class="hljs-comment"><span class="hljs-comment">#800-1400 ex,ey=i.getxy() features.append(ex) features.append(ey) features.append(x) features.append(y) return features</span></span></code> </pre> <br></div></div><br>  Creating a class Q model.  The variable gamma is the attenuation coefficient, which allows leveling the contribution of subsequent awards.  The alpha variable is the coefficient of the model learning speed.  The state variable is a dictionary of model states. <br><div class="spoiler">  <b class="spoiler_title">class Q model</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Q</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.gamma=<span class="hljs-number"><span class="hljs-number">0.95</span></span> self.alpha=<span class="hljs-number"><span class="hljs-number">0.05</span></span> self.state={}</code> </pre> <br></div></div><br>  We'll get the agent status on this turn. <br><br><div class="spoiler">  <b class="spoiler_title">Q model method, on request, gets agent status</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_wp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,plr)</span></span></span><span class="hljs-function">:</span></span> self.plr=plr</code> </pre> <br></div></div><br>  We train the model. <br><br><div class="spoiler">  <b class="spoiler_title">Q model method, one stage model training</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,silent=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.plr.prev_state=self.plr.curr_state[:<span class="hljs-number"><span class="hljs-number">-2</span></span>]+(self.plr.dx,self.plr.dy) self.plr.curr_state=tuple(self.plr.get_features(self.plr.x,self.plr.y))+( self.plr.dx,self.plr.dy) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> silent: print(self.plr.prev_state) print(self.plr.curr_state) r=self.plr.reward <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.plr.prev_state <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.state: self.state[self.plr.prev_state]=<span class="hljs-number"><span class="hljs-number">0</span></span> nvec=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.plr.actions: cstate=self.plr.curr_state[:<span class="hljs-number"><span class="hljs-number">-2</span></span>]+(i[<span class="hljs-number"><span class="hljs-number">0</span></span>],i[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cstate <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.state: self.state[cstate]=<span class="hljs-number"><span class="hljs-number">0</span></span> nvec.append(self.state[cstate]) nvec=max(nvec) self.state[self.plr.prev_state]=self.state[self.plr.prev_state]+self.alpha*(-self.state[self.plr.prev_state]+r+self.gamma*nvec)</code> </pre> <br></div></div><br>  The method of obtaining awards.  Agent is awarded a reward for continuing the simulation.  The penalty is credited for colliding with the enemy. <br><br><div class="spoiler">  <b class="spoiler_title">environment method</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_reward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,end_bool)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> end_bool: self.P.reward=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.P.reward=<span class="hljs-number"><span class="hljs-number">-1</span></span></code> </pre> <br></div></div><br>  Agent strategy  Produces the best value selection from the model state dictionary.  Agent class added variable eps, introducing an element of randomness when choosing a move.  This is done to study the adjacent possible actions in this state. <br><br><div class="spoiler">  <b class="spoiler_title">agent method, next move selection</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">strtg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> random.random()&lt;self.eps: act=random.choice(self.actions) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: name1=tuple(self.get_features(self.x,self.y)) best=[(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>),float(<span class="hljs-string"><span class="hljs-string">'-inf'</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.actions: namea=name1+(i[<span class="hljs-number"><span class="hljs-number">0</span></span>],i[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> namea <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.QM.state: self.QM.state[namea]=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> best[<span class="hljs-number"><span class="hljs-number">1</span></span>]&lt;self.QM.state[namea]: best=[i,self.QM.state[namea]] act=best[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> act</code> </pre> <br></div></div><br>  Let us show what the agent managed to learn with the complete transfer of information about the simulation state (absolute coordinates of the agent, absolute coordinates of the enemy): <br><br><div class="spoiler">  <b class="spoiler_title">the result of the algorithm (gifka ~ 1Mb)</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u6/um/3q/u6um3qykqygci2q5a1bxafqpjde.gif"><br></div></div><br><h2>  Part 3. We vary the parameters reflecting the state of the environment for the agent </h2><br>  To begin, consider the situation when the agent does not receive any information about the environment at all. <br><br><div class="spoiler">  <b class="spoiler_title">features 1</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_features</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> features=[] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> features</code> </pre> <br></div></div><br>  As a result of the work of such an algorithm, the agent gains an average of 40-75 points per simulation.  Training schedule: <br><br><img src="https://habrastorage.org/webt/by/gn/f0/bygnf0f8v4jnes6xzwimgjzvreq.png"><br><br>  Add a data agent.  First of all, you need to know how far the enemy is.  We calculate this using the Euclidean distance.  It is also important to have an idea how close the agent is to the edge. <br><br><div class="spoiler">  <b class="spoiler_title">features 2</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_features</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> features=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() dx=abs(x-ex) dy=abs(y-ey) l=hypot(dx,dy) features.append(l) to_brdr=min(x,y,self.n<span class="hljs-number"><span class="hljs-number">-1</span></span>-x,self.n<span class="hljs-number"><span class="hljs-number">-1</span></span>-y) features.append(to_brdr) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> features</code> </pre> <br></div></div><br>  Accounting for this information raises the agent's bottom figures by 20 points per simulation and its average score becomes between 60-100 points.  Although the response to changes in the environment has improved, we still lose the lion‚Äôs share of the necessary data.  So, the agent still does not know which way to move in order to break the distance with the enemy or move away from the edge of the edge.  Training schedule: <br><br><img src="https://habrastorage.org/webt/02/r0/og/02r0og-v-mofewifzfrkzqfe_sw.png"><br><br>  The next step is to add to the agent the knowledge of which side the enemy is located from, and also whether the agent is on the edge of the field or not. <br><br><div class="spoiler">  <b class="spoiler_title">features 3</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_features</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> features=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() features.append(x-ex) features.append(y-ey) <span class="hljs-comment"><span class="hljs-comment"># if near wall x &amp; y. if x==0: features.append(-1) elif x==self.n-1: features.append(1) else: features.append(0) if y==0: features.append(-1) elif y==self.n-1: features.append(1) else: features.append(0) return features</span></span></code> </pre> <br></div></div><br>  Such a set of variables immediately raises the average number of points to 400-800.  Training schedule: <br><br><img src="https://habrastorage.org/webt/y_/sb/ur/y_sbur_mfidtbow9uffihsqzh18.png"><br><br>  Finally, give the algorithm all the available information about the environment.  Namely: the absolute coordinates of the agent and the enemy. <br><br><div class="spoiler">  <b class="spoiler_title">features 4</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_features</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> features=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() features.append(ex) features.append(ey) features.append(x) features.append(y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> features</code> </pre> <br></div></div><br>  This set of parameters allows the agent to score 800-1400 points on test simulations.  Training schedule: <br><br><img src="https://habrastorage.org/webt/af/jk/x5/afjkx56af2so5g0gebbh0_z1syc.png"><br><br>  So, we reviewed the operation of the q-learning algorithm.  Having twisted the parameters that are responsible for the perception of the environment by the agent, they clearly saw how an adequate transfer of information and taking all aspects into account when describing the environment affects the effectiveness of its actions.  However, a complete description of the environment has a downside.  Namely, the explosive growth of the space of states with increasing amount of information transmitted to the agent.  To get around this problem, algorithms have been developed that approximate the state space, for example, the DQN algorithm. <br><br>  Useful links: <br><br>  <a href="https://habrahabr.ru/post/274597/">habrahabr.ru/post/274597</a> <br>  <a href="http://ai.berkeley.edu/reinforcement.html">ai.berkeley.edu/reinforcement.html</a> <br><br>  Full program code: <br><br><div class="spoiler">  <b class="spoiler_title">1. Basic environment model (from part 1)</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">W</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,n)</span></span></span><span class="hljs-function">:</span></span> self.n=n self.P=P(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,n) self.ens=[EN(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,n),EN(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,n),EN(<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,n)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: i.move() self.P.move() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>*<span class="hljs-number"><span class="hljs-number">100</span></span>) px,py=self.P.getxy() self.wmap=list([[<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.n)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.n)]) self.wmap[py][px]=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() self.wmap[ey][ex]=<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.wmap: print(i) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> px,py=self.P.getxy() bl=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() bl=bl <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (px,py)!=(ex,ey) iter=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> bl: time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) wr.pr() self.step() px,py=self.P.getxy() bl=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.ens: ex,ey=i.getxy() bl=bl <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (px,py)!=(ex,ey) print((px,py),(ex,ey)) print(<span class="hljs-string"><span class="hljs-string">'___'</span></span>) iter=iter+<span class="hljs-number"><span class="hljs-number">1</span></span> print(iter) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">un</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> self.x = x self.y = y <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.x, self.y <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(un)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y,n)</span></span></span><span class="hljs-function">:</span></span> self.n=n un.__init__(self,x,y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">strtg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> dx,dy=self.strtg() a=self.x+dx b=self.y+dy expr=((<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=a&lt;self.n) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=b&lt;self.n)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> expr: self.x=a self.y=b <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EN</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(un)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y,n)</span></span></span><span class="hljs-function">:</span></span> self.n=n un.__init__(self,x,y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> expr=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> expr: a=self.x+random.choice([<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>]) b=self.y+random.choice([<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>]) expr=((<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=a&lt;self.n) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>&lt;=b&lt;self.n)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> expr: self.x=a self.y=b <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__==<span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: wr=W(<span class="hljs-number"><span class="hljs-number">7</span></span>) wr.play() wr.pr()</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">2. Environment model with agent training for 500 + 1500 simulations</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hypot,pi,cos,sin,sqrt,exp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> plot_epoch <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Q</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.gamma=<span class="hljs-number"><span class="hljs-number">0.95</span></span> self.alpha=<span class="hljs-number"><span class="hljs-number">0.05</span></span> self.state={} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_wp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,plr)</span></span></span><span class="hljs-function">:</span></span> self.plr=plr <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,silent=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.plr.prev_state=self.plr.curr_state[:<span class="hljs-number"><span class="hljs-number">-2</span></span>]+(self.plr.dx,self.plr.dy) self.plr.curr_state=tuple(self.plr.get_features(self.plr.x,self.plr.y))+(self.plr.dx,self.plr.dy) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> silent: print(self.plr.prev_state) print(self.plr.curr_state) r=self.plr.reward <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.plr.prev_state <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.state: self.state[self.plr.prev_state]=<span class="hljs-number"><span class="hljs-number">0</span></span> nvec=[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.plr.actions: cstate=self.plr.curr_state[:<span class="hljs-number"><span class="hljs-number">-2</span></span>]+(i[<span class="hljs-number"><span class="hljs-number">0</span></span>],i[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cstate <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.state: self.state[cstate]=<span class="hljs-number"><span class="hljs-number">0</span></span> nvec.append(self.state[cstate]) nvec=max(nvec) self.state[self.plr.prev_state]=self.state[self.plr.prev_state]+self.alpha*( -self.state[self.plr.prev_state]+r+self.gamma*nvec) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">un</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> self.x = x self.y = y self.actions=[(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>),(<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>),(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>),(<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>),(<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>),(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.x, self.y <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">P</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(un)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y,n,ens,QM,wrld)</span></span></span><span class="hljs-function">:</span></span> self.wrld=wrld self.QM=QM self.ens=ens self.n=n self.dx=<span class="hljs-number"><span class="hljs-number">0</span></span> self.dy=<span class="hljs-number"><span class="hljs-number">0</span></span> self.eps=<span class="hljs-number"><span class="hljs-number">0.95</span></span> self.prev_state=tuple(self.get_features(x,y))+(self.dx,self.dy) self.curr_state=tuple(self.get_features(x,y))+(self.dx,self.dy) un.__init__(self,x,y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_features</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,x,y)</span></span></span><span class="hljs-function">:</span></span> features=[] <span class="hljs-comment"><span class="hljs-comment"># for i in self.ens: #80-100 # ex,ey=i.getxy() # dx=abs(x-ex) # dy=abs(y-ey) # l=hypot(dx,dy) # features.append(l) # to_brdr=min(x,y,self.n-1-x,self.n-1-y) # features.append(to_brdr) for i in self.ens: #800-1400 ex,ey=i.getxy() features.append(ex) features.append(ey) features.append(x) features.append(y) # for i in self.ens: #800-1400 # ex,ey=i.getxy() # features.append(x-ex) # features.append(y-ey) # features.append(self.n-1-x) # features.append(self.n-1-y) # for i in self.ens: #400-800 # ex,ey=i.getxy() # features.append(x-ex) # features.append(y-ey) # # if near wall x &amp; y. # if x==0: # features.append(-1) # elif x==self.n-1: # features.append(1) # else: # features.append(0) # if y==0: # features.append(-1) # elif y==self.n-1: # features.append(1) # else: # features.append(0) # features=[] #40-80 return features def strtg(self): if random.random()&lt;self.eps: act=random.choice(self.actions) else: name1=tuple(self.get_features(self.x,self.y)) best=[(0,0),float('-inf')] for i in self.actions: namea=name1+(i[0],i[1]) if namea not in self.QM.state: self.QM.state[namea]=0 if best[1]&lt;self.QM.state[namea]: best=[i,self.QM.state[namea]] act=best[0] return act def move(self): self.dx,self.dy=self.strtg() a=self.x+self.dx b=self.y+self.dy expr=((0&lt;=a&lt;self.n) and (0&lt;=b&lt;self.n)) if expr: self.x=a self.y=b class EN(un): def __init__(self,x,y,n): self.n=n un.__init__(self,x,y) def move(self): expr=False cou=0 while not expr: act=random.choice(self.actions) a=self.x+act[0] b=self.y+act[1] expr=((0&lt;=a&lt;self.n) and (0&lt;=b&lt;self.n)) if expr: self.x=a self.y=b class W: def __init__(self,n,QModel): self.ens=[EN(n-2,n-2,n)]#,EN(n-2,n-1,n),EN(n-1,n-2,n),EN(n-1,n-1,n)] self.P=P(1,1,n,self.ens,QModel,self) self.n=n self.QM=QModel self.QM.get_wp(self.P) def step(self): self.P.move() for i in self.ens: i.move() def pr(self,silent=1): """print map""" #print('\n'*100) px,py=self.P.getxy() self.wmap=list([[0 for i in range(self.n)] for j in range(self.n)]) self.wmap[py][px]=1 for i in self.ens: ex,ey=i.getxy() self.wmap[ey][ex]=2 if not silent: for i in self.wmap: print(i) def is_finished(self): px,py=self.P.getxy() end_bool=True for i in self.ens: ex,ey=i.getxy() end_bool=end_bool and ((px,py)!=(ex,ey)) return end_bool def get_reward(self,end_bool): if end_bool: self.P.reward=1 else: self.P.reward=-1 def play(self,silent=1,silent_run=1): end_bool=self.is_finished() iter=0 while end_bool: self.pr(silent) self.step() end_bool=self.is_finished() self.get_reward(end_bool) if silent_run: self.QM.run_model(silent) if not silent: print('___') time.sleep(0.1) iter=iter+1 return iter QModel=Q() plot=plot_epoch.epoch_graph() for i in range(500): wr=W(5,QModel) wr.P.eps=0.90 iter=wr.play(1) wr.pr(1) plot.plt_virt_game(W,QModel) for i in range(1500): wr=W(5,QModel) #print(len(QModel.state)) wr.P.eps=0.2 iter=wr.play(1) wr.pr(1) plot.plt_virt_game(W,QModel) plot.plot_graph() print('___') for i in range(10): wr=W(5,QModel) wr.P.eps=0.0 iter=wr.play(0) wr.pr(0)</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">3. Plotting module (plot_epoch.py).</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">epoch_graph</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.it=<span class="hljs-number"><span class="hljs-number">0</span></span> self.iter=[] self.number=[] self.iter_aver=[] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plt_append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,iter)</span></span></span><span class="hljs-function">:</span></span> self.it=self.it+<span class="hljs-number"><span class="hljs-number">1</span></span> self.iter.append(iter) self.number.append(self.it) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.iter)&gt;<span class="hljs-number"><span class="hljs-number">100</span></span>: self.iter_aver.append(sum(self.iter[<span class="hljs-number"><span class="hljs-number">-100</span></span>:])/<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.iter_aver.append(sum(self.iter)/len(self.iter)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plt_virt_game</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,W,QModel)</span></span></span><span class="hljs-function">:</span></span> wr=W(<span class="hljs-number"><span class="hljs-number">5</span></span>,QModel) wr.P.eps=<span class="hljs-number"><span class="hljs-number">0.0</span></span> iter=wr.play(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) self.plt_append(iter) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plot_graph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> plt.plot(self.number,self.iter_aver) plt.xlabel(<span class="hljs-string"><span class="hljs-string">'n_epoch'</span></span>) plt.ylabel(<span class="hljs-string"><span class="hljs-string">'aver. score'</span></span>) plt.show()</code> </pre> <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/345656/">https://habr.com/ru/post/345656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345646/index.html">"Hack us to be beautiful"</a></li>
<li><a href="../345648/index.html">SOC for beginners. 3 myths about automation and artificial intelligence in the Security Operations Center</a></li>
<li><a href="../345650/index.html">Achieving Maximum Performance Fast Fourier Transform Based on Data Management</a></li>
<li><a href="../345652/index.html">PostgreSQL News Digest</a></li>
<li><a href="../345654/index.html">Happy semi-final stories about the automation of test schemes</a></li>
<li><a href="../345658/index.html">Why does it seem to me that students are learning OOP wrong</a></li>
<li><a href="../345660/index.html">Magic CharSequence</a></li>
<li><a href="../345662/index.html">How to replace HR-a with a robot?</a></li>
<li><a href="../345664/index.html">Data mining in R</a></li>
<li><a href="../345666/index.html">My first job</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>