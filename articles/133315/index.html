<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic start of unit tests for C</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I use C for scientific calculations. And in this case, it is worth thinking hard, but do you really need C? 

 The C language is only needed if your c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic start of unit tests for C</h1><div class="post__text post__text-html js-mediator-article">  I use C for scientific calculations.  And in this case, it is worth thinking hard, but do you really need C? <br><br>  The C language is only needed if your calculations are very critical for performance or access to hardware.  In all other cases, I highly recommend high-level languages ‚Äã‚Äãlike <a href="http://ru.wikipedia.org/wiki/Ruby">Ruby</a> or <a href="http://ru.wikipedia.org/wiki/Python">Python</a> (almost the standard language for scientific calculations, a lot of scientific packages of various kinds from mathematics to biology) or, better, scientific packages like <a href="http://www.sagemath.org/ru/">Sage</a> (add-on python with the ability to the use of symbolic calculations and a lot more, as well as the ability to connect other mathematics packages, if there are not enough Sage capabilities, right inside the Sage program; by the way, Sage was <a href="http://habrahabr.ru/blogs/hpodcasts/94772/">written</a> in Habr√©). <br><br>  For Python, if performance is important and you are not ready to lick C-code to perfection, there is <a href="http://ru.wikipedia.org/wiki/Cython">Cython</a> (whose authors are also authors of Sage), which compiles almost Python code into C-code, achieving very high performance rates. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So at this stage I urge you once again: think before using C for scientific or other calculations!  Otherwise, let's go! <br><br>  So, you still decided to use C. In this case, you need to organize a working test environment, namely: <br><ul><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Unit testing</a> </li><li>  Automatic start of tests when changing code </li></ul><br><a name="habracut"></a><br>  Because what is the scientific calculation, if the code that implements it is not tested properly?  Well, this is just besides the fact that with testing the development runs much faster.  But in order for the speed to be really high, you need an automatic test run. <br><br>  On the topic of choosing a framework for unit testing, there is a <a href="http://stackoverflow.com/questions/65820/unit-testing-c-code">powerful thread on Stackoverflow</a> , a <a href="http://habrahabr.ru/blogs/testing/69160/">post on Habr√©</a> , a <a href="http://en.wikipedia.org/wiki/List_of_unit_testing_frameworks">comparison of unit testing frameworks on Wikipedia pages</a> and even an <a href="http://blog.objectmentor.com/articles/2008/02/04/unit-testing-c-and-c-with-ruby-and-rspec">rspec for testing code in C and C ++</a> (I didn‚Äôt get started). <br><br>  Of all this variety, the <a href="http://ru.wikipedia.org/wiki/Google_C%252B%252B_Testing_Framework">Google Testing Framework</a> seemed the most pleasant to me (they also <a href="http://habrahabr.ru/blogs/cpp/119090/">wrote</a> about it on Habr√©). <br><br>  The only thing that, when working with him, as a person who is not very experienced in testing C language, there were a number of problems (for example, how in Ubuntu to compile and run the damn human test ?!).  This question is almost never properly covered, except for ‚Äúput gtest in the project folder and follow the instructions from the README‚Äù, which, of course, is far from human, or to the instructions for older Ubuntu (older than 11.10) that do not fit Oneiric Ocelot. <br><br>  The result of all my moans was the following simple text: installation on Ubuntu 11.10 comes down to <code>sudo apt-get install libgtest-dev</code> (or <code>yaourt -S gtest</code> in ArchLinux).  Then in your my_app_test.cpp file you need to write something like: <br><pre> <code class="hljs mel">#include <span class="hljs-string"><span class="hljs-string">"gtest/gtest.h"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> add(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value1, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value2) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (value1 + value2); } TEST (AddTest, PositiveNos) { EXPECT_EQ (<span class="hljs-number"><span class="hljs-number">16</span></span>, add(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>)); }</code> </pre><br>  Where AddTest is the name of the test group, and PositiveNos is the name of the test.  EXPECT_EQ, as is almost obvious from the name, checks the value of two expressions for equality.  Analogue <code>assert 16 == 8+8</code> .  However, ASSERT_TRUE is also <a href="http://code.google.com/p/googletest-translations/wiki/GoogleTestPrimerRussian">in the arsenal</a> . <br><br>  Everything, the test is ready.  Of course, in real life you have to do <code>#include "my_app.h"</code> , but in the example we‚Äôll get by with what we have. <br><br>  Running a test is the execution of the following <code>g++ my_app_test.cpp -lgtest_main <b>-lgtest</b> -pthread &amp;&amp; ./a.out</code> . <br><br>  More information in Russian can be found in the <a href="http://code.google.com/p/googletest-translations/wiki/GoogleTestPrimerRussian">official textbook</a> . <br><br>  I will illustrate the unsuccessful test run (red) <br><br><img src="https://habrastorage.org/storage1/bd74f776/4e145810/626fd47f/c6d8ef53.png"><br><br>  And successful (green) <br><br><img src="https://habrastorage.org/storage1/5f0f9dc4/86282a42/41a518a6/163aecd3.png"><br><br>  Testing is adjusted, now we need to adjust the automatic run of tests after changing the code.  Otherwise, the message of this approach with unit-tests simply will not work. <br><br>  For this we will use the <a href="https://github.com/mynyml/watchr">watchr</a> tool (popular in the Ruby environment).  In order for everything to be beautiful and nice notifications were displayed, you need the libnotify library installed (for everything to be absolutely beautiful, you need to push the .watchr_images / <a href="">failed.png</a> and .watchr_images / <a href="">passed.png</a> files into the project folder). <br><br>  We put ruby ‚Äã‚Äã(needed for watchr) and libnotify: <code>sudo apt-get install ruby libnotify4</code> , and then install the watchr: <code>sudo gem install watchr</code> . <br><br>  Take the watchr file <a href="https://gist.github.com/8f84f0361cfb3b216f83">from here</a> .  I will give the text of the script: <br><pre> <code class="ruby hljs">ENV[<span class="hljs-string"><span class="hljs-string">"WATCHR"</span></span>] = <span class="hljs-string"><span class="hljs-string">"1"</span></span> system <span class="hljs-string"><span class="hljs-string">'clear'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cmd)</span></span></span></span> puts(cmd) system(cmd) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">growl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(result)</span></span></span></span> message = result ? <span class="hljs-string"><span class="hljs-string">"OK"</span></span> : <span class="hljs-string"><span class="hljs-string">"FAILED"</span></span> growlnotify = <span class="hljs-string"><span class="hljs-string">`which notify-send`</span></span>.chomp title = <span class="hljs-string"><span class="hljs-string">"Watchr Test Results"</span></span> image = (result) ? <span class="hljs-string"><span class="hljs-string">".watchr_images/passed.png"</span></span> : <span class="hljs-string"><span class="hljs-string">".watchr_images/failed.png"</span></span> options = <span class="hljs-string"><span class="hljs-string">%("</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{title}</span></span></span><span class="hljs-string">" "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{message}</span></span></span><span class="hljs-string">" -i </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{File.expand_path(image)}</span></span></span><span class="hljs-string">)</span></span> system <span class="hljs-string"><span class="hljs-string">%(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{growlnotify}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{options}</span></span></span><span class="hljs-string"> &amp;)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> watch( <span class="hljs-string"><span class="hljs-string">'(.+)(\.c|_test\.cpp|\.h)$'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|md|</span></span> result = run(<span class="hljs-string"><span class="hljs-string">"g++ </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{md[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">_test.cpp </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{md[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">.c -lgtest_main -lgtest -pthread -o </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{md[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">_test &amp;&amp; ./</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{md[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">_test"</span></span>) growl result puts (<span class="hljs-string"><span class="hljs-string">"\n\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  The script is launched by a simple <code>watchr watchr.rb</code> : <code>watchr watchr.rb</code> . </div><p>Source: <a href="https://habr.com/ru/post/133315/">https://habr.com/ru/post/133315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133308/index.html">Small devices with big problems</a></li>
<li><a href="../133309/index.html">Habrarebest in Kiev</a></li>
<li><a href="../133311/index.html">Planning poker in their own colors</a></li>
<li><a href="../133312/index.html">Database Migrations - Library Overview and Usage</a></li>
<li><a href="../133314/index.html">Thoughts after visiting a venture fair</a></li>
<li><a href="../133316/index.html">Training course. Creating the Entity Framework data model for an ASP.NET MVC application</a></li>
<li><a href="../133317/index.html">Conscience is the best controller</a></li>
<li><a href="../133318/index.html">Market packaging startups on their own experience</a></li>
<li><a href="../133319/index.html">Conference ADD-3 convenes speakers</a></li>
<li><a href="../133321/index.html">Arrangement of points over onmousewheel and a little about onion soup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>