<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I have been rewriting my cryptocurrency with PHP for Go for 8 months. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The 2nd part of the story, which began with a text message from Kati "Do not call and do not write me more !!!!" 

 The first part is here . For those...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I have been rewriting my cryptocurrency with PHP for Go for 8 months. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/912/ce1/f48/912ce1f48a75415fb529d933668ed3bd.jpeg"><br><br>  The 2nd part of the story, which began with a text message from Kati "Do not call and do not write me more !!!!" <br><a name="habracut"></a><br>  The first part is <a href="http://habrahabr.ru/company/dcoin/blog/272695/">here</a> .  For those who are too lazy to read, I will give a summary: <br><br>  4.5 years ago I had the imprudence to start writing my cryptocurrency in a completely inappropriate language for this business - in PHP.  As a result, of course, I wrote (I am stubborn), but it turned out to be a crutch on a crutch and that it worked at all was just some kind of magic. <br>  I just want to warn you, I‚Äôm a self-taught programmer and I write code, to say the least, imperfectly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It all started with the fact that I broke up with a girl named Katya and on the same day (April 4, 2015) decided to study Go and rewrite my cryptocurrency.  For those who are interested in what's up with Katya, I made spoilers, but who are not interested, just do not pay attention to Katya <br><br><div class="spoiler">  <b class="spoiler_title">For those who did not read the 1st part about Katya</b> <div class="spoiler_text">  I'll tell you first how it all began.  I met her on the Internet on a dating site in early 2015.  Fell in love almost immediately.  It hurt outwardly she was in my taste.  We walked in the park, joked, laughed, made fun, it became cold, we did not want to part.  He called me to watch cartoons.  We got into a taxi, we arrived.  Turned on "Three heroes: Knight's move", a very funny cartoon, lay on the bed, laughing to tears. <br><br>  Late evening, I am sure that Katya will stay overnight.  But for some reason she began to repeat that she needed to go home.  I said I wanted to feed her breakfast in bed.  Agree that tomorrow morning she will arrive for breakfast.  Called a taxi, she left.  I fell asleep happy because  I found a beautiful girl with whom it is fun and interesting.  The next day, a text message came from her ‚ÄúHello.  What are you doing?".  I remember my feelings, because I wrote a girl who I really like, it was kayfovo.  And soon we were to meet with her again ... <br><br>  That day we never met.  And the next one too.  I do not know what was going on in her head, but she constantly endured dating.  Not even congratulated on February 23. <br>  I decided to shake it up somehow.  Wrote Kate sms-ku: "I will soon, of course, grab" <br>  She replied: "in a sense?" <br>  I: ‚ÄúOops, not there‚Äù <br>  She: "that means how" <br>  She got jealous.  A day later offered to meet, she agreed. <br><br>  After analyzing her behavior and, a little googling, I came across the book ‚ÄúNew rules.  Secrets of a successful relationship for modern girls " <br>  During the evening I read and understood that for some reason she fell in love with herself using the advice from this book. <br></div></div><br>  A total of 8 months: the application runs on Win ( <a href="">64/32</a> ), OSX (64/32), Linux (64/32), FreeBSD (64/32), <a href="">Android</a> , <a href="http://dcoin.club/ru/ios.html">IOS</a> (it will be cool if someone throws on the App Store ). <br>  General code ~ 73k lines, code for different OS somewhere a few hundred lines. <br>  40k - processing / generation of blocks / tr-y, 17.5k - controllers for the interface, 15.5k - templates <br>  PostgreSQL, SQLite, MySQL are supported. <br><br>  Those who will test my creation, I warn you - there may be bugs, and if you have time, write about them, please, at <a href="">darwin@dcoin.club</a> or in a personal on Habr√©.  Suggestions and advice are also welcome. <br><br>  In the first part, I talked about how a web server operates in dcoin. <br><br>  In this article I will describe how I use the <a href="https://golang.org/pkg/html/template/">html / template</a> <br><br><h3>  Templates </h3><br>  To generate HTML pages in Go there is a very convenient package - html / template.  The easiest way to understand how it works is to experiment with <a href="https://play.golang.org/p/_3lNVlNSi8">this example</a> .  As a rule, the templates are stored in separate html files, but in the examples on play.golang.org, for clarity, the templates are inserted into the go-code. <br><br>  Most of the information on the templates I received from <a href="http://gohugo.io/templates/go-templates/">gohugo.io/templates/go-templates</a> <br><br>  My templates are <a href="https://github.com/c-darwin/dcoin-go/tree/master/static/templates">here</a> .  Each template begins with the definition of its name {{define "templateName"}}, and ends with {{end}} <br><br>  Controllers that use templates get html code through the function <a href="">makeTemplate</a> .  In it, I pass the name of the html file, the name of the template (which is specified in {{define}}), parameters. <br><br><pre><code class="go hljs">TemplateStr, err := makeTemplate(<span class="hljs-string"><span class="hljs-string">"template_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"templateName"</span></span>, &amp;tplPage{ Alert: c.Alert, Lang: c.Lang, TxType: txType, TxTypeId: txTypeId})</code> </pre> <br>  The set of bytes received in TemplateStr is transferred to <a href="">content.go</a> and as a result, the browser gets the generated html-page <br><br>  In the makeTemplate for all templates, I include additional templates, such as signatures.html, alert_success.html.  And also, add custom functions (FuncMap), which are used to process data in templates. <br><br><div class="spoiler">  <b class="spoiler_title">About Katya</b> <div class="spoiler_text">  On the second date, we just walked, chatted.  All was good.  About my sms-ku "I will soon, of course grab" she, to my happiness, did not say anything. <br>  I was not bothered by the question of the book on which she seemed to me to fall in love with me.  I did not dare to ask directly.  I wondered what he was reading.  She named some authors.  When asked about books on psychology, she replied that she reads for herself. <br>  It was cold.  I walked to the house.  We agreed the other day to go to the rink. <br></div></div><br><h3>  Inclusions in templates </h3><br>  To include another template in the template you need to use the {{{template "signatures" construct  }}.  The dot at the end says that you need to process all the parameters in the signatures template; without a dot, the parameters will not be processed.  I add signatures to almost all templates, here‚Äôs an example <br><br><h3>  Options </h3><br>  Comparison  I will cite several examples at once to show how simple it is: <br><pre> <code class="go hljs">{{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> not .UserID}} &lt;span&gt;&lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> .UserID}} &lt;span&gt; &lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> eq .UserID <span class="hljs-number"><span class="hljs-number">0</span></span>}} &lt;span&gt;UserID == <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ne .UserID <span class="hljs-number"><span class="hljs-number">0</span></span>}} &lt;span&gt;UserID != <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lt .UserID <span class="hljs-number"><span class="hljs-number">0</span></span>}} &lt;span&gt;UserID &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> le .UserID <span class="hljs-number"><span class="hljs-number">0</span></span>}} &lt;span&gt;UserID &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> gt .UserID <span class="hljs-number"><span class="hljs-number">0</span></span>}} &lt;span&gt;UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/span&gt; {{end}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ge .UserID <span class="hljs-number"><span class="hljs-number">0</span></span>}} &lt;span&gt;UserID &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>&lt;/span&gt; {{end}}</code> </pre><br>  {{.Lang.pool} - Lang is a map.  Those.  through the point we get the value, which has the key ‚Äúpool‚Äù <br><br><div class="spoiler">  <b class="spoiler_title">About Katya</b> <div class="spoiler_text">  About a week I did not write and did not call her.  I decided to check if she would call first.  It was kapets how difficult it was, suffered, but waited for her call, I wanted her to break the rules from the book. <br>  In the end, gave up.  I wrote to her, called to the cinema.  She said that today can not, because  is moving.  From the help with the move refused. <br><br>  I'll run a little ahead and say that after the same sms-ki "Do not call and do not write me more !!!!", I in the VC lured to my side her girlfriend, with whom she lived for 2 years, so that she helped me to return Kate .  So, her girlfriend, said that the whole week, when I did not call, Kate was very worried and was waiting for a call from me.  She also said that after the first date, Katya literally glowed with joy.  She also added that she did not read any book on seduction. <br></div></div><br><h3>  User Functions </h3><br>  The html-code in the variables needs to be disassembled.  To do this, add a function: <br><br><pre> <code class="go hljs">funcMap := template.FuncMap{ <span class="hljs-string"><span class="hljs-string">"noescape"</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HTML</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template.HTML(s) }, }</code> </pre><br>  All user functions are collected in <a href="">my makeTemplate</a> .  Use this: <br><br><pre> <code class="go hljs">{{noescape .Lang.htmlText}}</code> </pre><br><div class="spoiler">  <b class="spoiler_title">About Katya</b> <div class="spoiler_text">  March 8th was near.  Katya still did not want to meet with me.  And I really wanted to congratulate her on the holiday.  In the end, I put the question squarely.  Either we meet on the 8th of March, or I will not call her again.  We agreed to celebrate the holiday with me. <br><br>  I bought her favorite flowers, wine, etc. I wanted to spend the whole day with her, but for dinner she was not ready yet, in an hour, too, and after two.  To my surprise, by six o'clock she finally got ready.  I called her a taxi. </div></div><br><h3>  Range </h3><br>  To disassemble any map used Range.  Here is an example taken <a href="https://github.com/c-darwin/dcoin-go/blob/master/static/templates/change_geolocation.html">from here</a> : <br><br><pre> <code class="go hljs">{{<span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $k, $country := .Countries}} &lt;option value=<span class="hljs-string"><span class="hljs-string">'{{$k}}'</span></span> {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> eq $k $.MyCountry}} selected {{end}}&gt;{{$country}}&lt;/option&gt; {{end}}</code> </pre><br>  From the code, probably, it is clear what is happening.  But I want to pay special attention to $ .MyCountry.  If you do not add $, then access to the .MyCountry parameter will not be.  At first, I often forgot about it and thought for a long time what was wrong.  Outside of range, access to MyCountry is again obtained through {{.MyCountry}} <br><br><div class="spoiler">  <b class="spoiler_title">About Katya</b> <div class="spoiler_text">  Arrived, handed flowers, gifts.  Opened a bottle of wine.  She saw my old PHP sources on one of the monitors.  She asked - "What is it?".  I told her about the blockchain, about how Dcoin, thanks to the natural desire of people to make a profit (‚Äúnot getting up from the couch‚Äù), will be able to capture the minds of millions, smoothly replacing conventional currencies with decentralized ones, then the issue will stop and we will have a new world with transparent financial system.  Katya did not understand anything.  Then they watched a movie, kissed.  Suddenly the wine ran out, I asked if she wanted more, she said she wanted.  I went to the store. <br></div></div><br><h3>  Variables </h3><br>  In templates, you can create your own variables.  Here is an example taken <a href="https://github.com/c-darwin/dcoin-go/blob/master/static/templates/cf_page_preview.html">from here</a> : <br><br><pre> <code class="go hljs">{{<span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $i, $pageType := .PagesArray}} {{$counter := <span class="hljs-string"><span class="hljs-string">""</span></span>}} {{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> eq $pageType <span class="hljs-string"><span class="hljs-string">"funders"</span></span>}} {{$counter := <span class="hljs-string"><span class="hljs-string">" &lt;span class='count h6 bg-grey-dark white'&gt;{{$.ProjectCountFunders}}&lt;/span&gt;"</span></span>}} {{<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> eq $pageType <span class="hljs-string"><span class="hljs-string">"comments"</span></span>}} {{$counter := <span class="hljs-string"><span class="hljs-string">" &lt;span class='count h6 bg-grey-dark white'&gt;{{$.ProjectCountComments}}&lt;/span&gt;"</span></span>}} {{end}} {{$counter}} {{end}}</code> </pre><br>  In this example, a new $ counter variable is created, which is assigned a value, depending on the condition, and its result is displayed below. <br><br><h3>  and / or </h3><br>  The logic of work and / or turned out to be somewhat unusual for me. <br>  Examples: <br><br><pre> <code class="go hljs">{{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> and (eq .Start <span class="hljs-number"><span class="hljs-number">1</span></span>) (ne .BlockId <span class="hljs-number"><span class="hljs-number">1</span></span>) (gt .UserId <span class="hljs-number"><span class="hljs-number">0</span></span>)}}</code> </pre><br>  If .Start == 1 and .BlockId! = 1 and .UserId&gt; 0 <br><br><pre> <code class="go hljs">{{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> or (eq .Start <span class="hljs-number"><span class="hljs-number">1</span></span>) (ne .BlockId <span class="hljs-number"><span class="hljs-number">1</span></span>) (gt .UserId <span class="hljs-number"><span class="hljs-number">0</span></span>)}}</code> </pre><br>  If .Start == 1 or .BlockId! = 1 or .UserId&gt; 0 <br><br><h3>  Js code </h3><br>  Another problem took me quite a lot of time.  If you need to generate some js-code in the controller, for example: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x=<span class="hljs-string"><span class="hljs-string">"1"</span></span>;</code> </pre><br>  Then, when outputting it in the template via {{.SomeJSCode}} we get <br><br><pre> <code class="go hljs"><span class="hljs-string"><span class="hljs-string">"var x=\"1\";"</span></span></code> </pre><br><h4>  Solution 1 </h4><br>  noescape will not help here.  You need to add a new custom function: <br><br><pre> <code class="go hljs"><span class="hljs-string"><span class="hljs-string">"js"</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JS</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template.JS(s) },</code> </pre><br>  And in the template use {{js .SomeJSCode}} <br><br><h4>  Solution 2 </h4><br>  In the controller, use the template.JS type.  Before converting the variable string: template.JS (SomeJsStringVariable).  In the template itself, in this case you need to output {{.SomeJSCode}} <br><br><div class="spoiler">  <b class="spoiler_title">About Katya</b> <div class="spoiler_text">  Returned, finished the wine.  Got massage oil.  I had a massage for about an hour (the other day I specially studied <a href="https://www.youtube.com/watch%3Fv%3DLO83ozF302I">this video here</a> ).  The massage smoothly translated into something more intimate, as a result of which she experienced a sharp release of endorphins, and immediately after that she said that she wanted to sleep.  ‚ÄúWhat the fuck?‚Äù I thought.  In general, we went to bed. <br>  Continued in the next part. <br></div></div><br><h3>  Conclusion </h3><br>  In the following articles, I will talk about the database, smooth application termination via signals, blockchain block processing, GO encryption and JS decryption, how I changed gomobile a little, adding notifications and background work for IOS and Android applications. </div><p>Source: <a href="https://habr.com/ru/post/273333/">https://habr.com/ru/post/273333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273323/index.html">Vivaldi Beta 2 browser release</a></li>
<li><a href="../273325/index.html">Santa Claus asks a question. Contest for Intel Blog Readers</a></li>
<li><a href="../273327/index.html">"War and Peace" - the test of time</a></li>
<li><a href="../273329/index.html">5 brightest scams with WhatsApp in 2015</a></li>
<li><a href="../273331/index.html">Comparative analysis of C # and C ++ languages</a></li>
<li><a href="../273335/index.html">Lectures Technopark. Master class "20 mistakes in creating an IT-company"</a></li>
<li><a href="../273337/index.html">Detection of insider trading: Algorithms for identifying and patterns of illegal transactions</a></li>
<li><a href="../273339/index.html">Windows 10 Digest. November-December 2015</a></li>
<li><a href="../273341/index.html">How to choose a programming language?</a></li>
<li><a href="../273345/index.html">ScaleIO Testing Experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>