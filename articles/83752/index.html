<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Expensive GPRS / EDGE roaming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, soon the winter will end ... Warm spring days will come, you will want to immediately get out into nature, but it is better to go somewhere to r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Expensive GPRS / EDGE roaming</h1><div class="post__text post__text-html js-mediator-article">  Well, soon the winter will end ... Warm spring days will come, you will want to immediately get out into nature, but it is better to go somewhere to rest ... to warmer places ... stop, and what to take with you on the road - your faithful laptop?  But I am going to rest from work ... and I will take my reliable communicator ... <br>  I think many people are familiar with this situation, when going abroad, you don‚Äôt feel like taking a laptop, and you want to keep in touch with the outside world / corporate office.  Therefore, one of the ways out of this situation is to take a communicator, and as an access to the network use one of the packet data transmission technologies - GPRS / EDGE. <br><br><a name="habracut"></a><br><h4>  Intro </h4><br>  In my memory, several bright stories are still fresh, similar to <a href="http://habrahabr.ru/blogs/Fake/50613/">this one</a> , from the ‚Äúhappy‚Äù owners of the very popular communicators of one apple company, who received quite substantial bills for using packet data transmission from abroad. <br><br>  We will not go into details, though this is just another duck, just accept, purely hypothetically, that such facts could have taken place ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, such coincidences of circumstances led me to write this little note. <br><br>  So ... Why do roaming users receive such terrible bills for using package services, why do operators have such ‚Äúspace‚Äù tariffs for data transfer in roaming ?!  And all this for the download of several megabytes? <br><br>  For example, data on tariffs for using packet data (GPRS / EDGE) in roaming for three large Ukrainian operators: <br><table><tbody><tr><td>  # </td><td>  Volume of downloaded data, kB </td><td>  Cost, $ USD </td></tr><tr><td>  OpSoN 1 </td><td>  100 </td><td>  1.5 </td></tr><tr><td>  OpSoN 2 </td><td>  100 </td><td>  1.25 </td></tr><tr><td>  OpSoN 3 </td><td>  95 </td><td>  1.1 </td></tr></tbody></table><br>  Let's see, how does the packet data transfer in roaming.  We assume that we use GPRS / EDGE. <br><br>  In this case, the integral part involved in the transfer of data will be <a href="http://ru.wikipedia.org/wiki/SGSN">SGSN</a> and <a href="http://ru.wikipedia.org/wiki/GGSN">GGSN</a> , both in the guest network and in your home network.  To simplify the task, we will assume that the subscriber: <br><ul><li>  already registered with the packet network (passed the GPRS Attach or Combi Attach * procedure) </li><li>  has in settings on MS correct, allowed APN ** </li><li>  connected himself / him to ‚Äúconnected‚Äù roaming services (tags in the profile on the HLR) </li><li>  forgot to disconnect / decided to use packet data services <br><blockquote>  * - more details about these procedures can be found in the article: <a href="http://habrahabr.ru/blogs/telecom/81385/">‚ÄúInside GPRS.</a>  <a href="http://habrahabr.ru/blogs/telecom/81385/">Part 2"</a> <br>  ** - for more details on using APN, please read the article: <a href="http://habrahabr.ru/blogs/telecom/79505/">‚ÄúIt doesn‚Äôt matter who you are ... it‚Äôs important what kind of APN you have‚Äù</a> </blockquote></li></ul><br>  We will also consider two options: when a user requests access to a network accessible only from his HPLMN ‚Äî for example, VPN access to a corporate intranet and when the user simply requests access to the internet. <br><br>  Yes ... one more important moment, we will assume that our ‚Äúhome‚Äù operator has roaming agreements with the operator, from the guest network of which we will receive the packet data service. <br><br><h4>  Standart roaming GPRS / EDGE access </h4><br>  The generally accepted PDP Context'a activation scheme for a subscriber located in the guest network is shown in the diagram below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c49/5c5/b19/c495c5b197d0a451bc8cabecf88e8f22.jpg" alt="image"></div><br><br>  Let's look at the basic procedures that occur when the PDP Context is activated for a roaming subscriber.  As you can see from the scheme, for the organization of access from the intranet of our home network, the guest SGSN is used, which performs authentication and authorization procedures, resolves the requested APN, and then establishes the GTP tunnel to our home network GGSN.  A similar procedure will also be the case if the roaming user wants to simply go on the internet. <br><br><h4>  Procedures flow diagram </h4><br>  A simplified diagram of the main procedures shown in the previous diagram is presented below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75a/de2/828/75ade28283f7f17fadbab1f5fdb5e3e7.jpg" width="200" alt="image"></div><br><ol><li>  MS requests GPRS access from the guest SGSN'a, transmitting the <a href="http://ru.wikipedia.org/wiki/APN">APN</a> in the PDP Context activation request.  At this stage I want to emphasize that for roaming users, SGSN will automatically add the <a href="http://ru.wikipedia.org/wiki/MNC">MNC</a> and <a href="http://ru.wikipedia.org/wiki/MCC">MCC</a> to the requested APN, based on the <a href="http://ru.wikipedia.org/wiki/IMSI">IMSI of the</a> subscriber and form a complete request of the form: <i>mega.fast.internet.mnc006.mcc255.gprs</i> , for APN - mega.fast.internet . </li><li>  The local (guest) DNS server checks (resolves) the APN, because  If the SGSN has added the MCC and MNC of the user's home network to the requested APN, then the guest DNS does not ‚Äúknow‚Äù anything about this zone - the mnc006.mcc255.gprs zone (for example, a certain virtual operator for Ukraine), and redirect the request to a higher level DSN server. </li><li>  The guest DNS server sends a request for rezolv to a higher level DNS server (DNS in the <a href="http://en.wikipedia.org/wiki/GPRS_Roaming_Exchange"><b>GRX</b></a> zone <a href="http://en.wikipedia.org/wiki/GPRS_Roaming_Exchange"><b>(en)</b></a> - GPRS Roaming eXchange), if it is connected to this network. </li><li>  The root DNS in the GRX zone, ‚Äúknows‚Äù that the DNS server in the user's home network is engaged in the maintenance of the mnc006.mcc255 zone and sends a request to it. </li><li>  The guest SGSN receives the GGSN'a IP address, which serves the requested APN in the user's home network. </li><li>  The guest SGSN forwards the request for PDP Context activation to the home GGSN. </li><li>  The home GGSN accepts the request and sets up a GTP tunnel. </li></ol><br> <a href=""><img src="http://s13.radikal.ru/i186/1002/62/3fa57c51f1f6.jpg" alt="image" align="right"></a> <br>  We see that, in order to be able to use GPRS services in roaming, it is necessary, ultimately, for the networks of operators to be interconnected in some way.  The simplest method of such connections is the direct connection of each operator with each other, but of course this method is not reliable and absolutely not economically acceptable. <br><br>  Therefore, the <b>GRX</b> global network (GPRS Roaming eXchange) was organized, which allows to unite operators all over the world, and with it appeared providers connecting large operators to this network. <br><br>  The arrangements for connecting operators to the GRX network are advertised as expanding the coverage of GPRS services in roaming. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/197/cb5/26c/197cb526c4ac7224e63df1a7e95a170d.jpg" width="200" alt="image"></div><br>  After establishing a session with a home GGSN, we are interested in the way, there is not a samurai :) but billing data from the operator‚Äôs guest network to our home network.  As is known, billing data can accumulate at one of the network elements - SGSN or GGSN *, and then the operator should take them and form settlement operations on the CG [Charging Gataway] **.  Moreover, in the case of roaming subscribers, a guest SGSN can collect CDR records, and then the foreign operator can transmit this data to the home operator, due to roaming arrangements. <br><blockquote>  * - most often, CDR records still accumulate on the SGSN side, since  GGSN billing data collection requires a more complex implementation and is not particularly popular with operators. <br>  ** - basically, this article deals with post-paid subscribers (contract subscribers), for which settlement operations are carried out in offline mode, therefore, billing data (CDR records) must be collected for such subscribers, and then the contract obligations are calculated .  There are still pre-paid subscribers (prepaid service subscribers), for whom settlement transactions are carried out online, using CAP protocols, and so on.  IN [Intellegent Network] platforms.  Billing schemes for pre-paid subscribers practically do not depend on the location of the subscriber (guest or home network), so their consideration is not included in this article, but the flaws of the described scheme for providing access to the network for roaming subscribers in the same way Providing access to the network for prepaid subscribers who are roaming. </blockquote><br>  We continue our reasoning ... <br>  As you can see from the general PDP Context activation scheme above, the GTP tunnel ‚Äústretches‚Äù from abroad directly to our home network, to our home GGSN, which gives us access to the internet network.  What makes the home operator to use such an inefficient connection scheme? <br><br>  The reasons can actually be several: <br><ul><li>  A roaming subscriber requests access to a corporate intranet, or to a specific LAN_over_GPRS, access to which is only through the home GGSN. </li><li>  Our home operator ‚Äúdoes not trust‚Äù its roaming partner and prefers to collect billing data on its GGSN. </li></ul><br>  But based on what we already know ... the operators mainly use the scheme of collecting CDR records on the SGSN itself, i.e.  in the case of a roaming subscriber, this will be a guest SGSN + again, basically roaming subscribers will request easy access to the internet network, which in principle also has a guest GGSN. <br><br>  Let's discuss how you can simplify the existing ‚Äúinefficient‚Äù scheme and reduce the tariffs for using packet data in roaming ... <br><br><h4>  Alternative roaming GPRS / EDGE access </h4><br>  If the roaming subscriber needs only an Internet connection, and in most cases it is, then there is an alternative PDP Context'a activation scheme, which has its own nuances, but allows the subscriber to reduce the cost of packet data transmission in roaming: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7b2/dc0/b8b/7b2dc0b8bf95a3c6bb84ed4ddf731037.png" width="200" alt="image"></a> </div><br><br>  The main procedures for this scheme are presented below: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1a2/221/4d7/1a22214d7cb17d884b28b70537aa190e.png" width="200" alt="image"></a> </div><br><ol><li>  The MS requests GPRS access by transmitting the APN to the guest SGSN in the PDP Context activation request.  At the same time, the guest SGSN has the functionality configured to ‚Äúreplace‚Äù the requested subscriber's APN - Override of roaming APN (in combination with the use of DEFAPN functionality);  on APN, designed specifically for roaming subscribers who are requesting access to the Internet. </li><li>  The guest SGSN sends a request to the local DNS server (from the already changed APN in the request) to determine the guest GGSN, which will serve the roaming subscriber. </li><li>  The guest DNS server returns the GGNS'a IP address (or several GGSNs), which serves roaming subscribers. </li><li>  The guest SGSN sends a PDP context activation request to the local GGSN. </li><li>  Guest GGNS accepts the request and sets up a GTP tunnel, giving the subscriber access to the network. </li></ol><br>  We see that the scheme in this case becomes much simpler, but it has its own <br><br>  <i>requirements</i> : <br><ul><li>  for guest subscribers of the roaming partner, so-called functionality should be configured on SGSN.  <b><i>Default APN</i></b> in conjunction with the rewrite setting requested by the APN ( <b><i>Override of roaming APN</i></b> ), which will replace the APN requested in the PDP Context activation request and will provide the user with easy access to the internet and will be charged as if the subscriber used packet services in your home network. </li><li>  in the user profile on the HLR, the ‚Äúallowed‚Äù APN field must be ‚Äú*‚Äù, allowing you to use any valid APN in the operator‚Äôs network. </li><li>  The user profile on the <a href="http://ru.wikipedia.org/wiki/HLR">HLR</a> 's should be allowed to use VPLMN - the parameter "vplmn allowed -&gt; yes". </li><li>  in the guest SGSN, for PLMN roaming subscribers, the use of guest PLMN should be allowed - the ‚Äúvplmn allowed -&gt; yes‚Äù parameter. </li><li>  In addition to roaming agreements with the guest operator, the home operator must have certain agreements with Internet service providers through which the guest GGSN (guest operator) has access to the internet network, or negotiate settlements with its roaming partner on its subscribers. </li></ul><br>  and <i>restrictions</i> : <br><ul><li>  Our optimal scheme for providing access to the internet for roaming subscribers will not allow the subscriber to access the network (VPN access to intranet / LAN_over_GPRS) available only through the home GGSN. </li><li>  The solution is also not acceptable if the home operator uses the billing data collection scheme from its home GGSN for roaming subscribers. </li></ul><br><h4>  Summary </h4><br>  Be careful when using packet data abroad, as  Most operators use the first subscriber connection scheme via the ‚Äúhome‚Äù GGSN, which, in the case of ‚Äúnormal‚Äù access to the internet network, is not efficient, but financially beneficial for the operator.  Accordingly, the tariffs for packet data in roaming leave much to be desired.  An alternative abroad, IMHO, I see the use of free Wi-Fi access points, or the purchase of a roaming <a href="http://ru.wikipedia.org/wiki/SIM-%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D0%25B0">SIM</a> card for access to the network using GPRS / EDGE. <br><br>  <b><i>A small assistant:</i></b> <br><br>  <b>APN</b> - Access Point Name <br>  <b>CDR</b> - Call Detail Record <br>  <b>CAMEL</b> - Customized Applications for Mobile Enhanced Logic <br>  <b>CAP</b> - CAMEL Application Part <br>  <b>GTP</b> - GPRS Tunneling Protocol <br>  <b>HGGSN</b> - Home GGSN <br>  <b>HPLMN</b> - Home PLMN <br>  <b>HSGSN</b> - Home SGSN <br>  <b>MS</b> - Mobile Station <br>  <b>PDP</b> - Packet Data Protocol <br>  <b>PLMN</b> - Public Land Mobile Network <br>  <b>VGGSN</b> - Visiting GGSN <br>  <b>VPLMN</b> - Visited PLMN <br>  <b>VSGSN</b> - Visiting SGSN <br>  <b>WAP</b> - Wireless Application Protocol <br></div><p>Source: <a href="https://habr.com/ru/post/83752/">https://habr.com/ru/post/83752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83746/index.html">Author SauceKit arrested</a></li>
<li><a href="../83747/index.html">Poll: Russian-speaking community of MMORPG players</a></li>
<li><a href="../83748/index.html">Envato which is ‚ÄúMust Have‚Äù for everyone</a></li>
<li><a href="../83749/index.html">Habraohrana and culture of speech</a></li>
<li><a href="../83750/index.html">Cyrket now tracks and Windows Mobile</a></li>
<li><a href="../83753/index.html">Test compiled by Intel Compiler on AMD system. ‚ÄúBefore‚Äù and ‚Äúafter‚Äù patch</a></li>
<li><a href="../83755/index.html">"Goodline" writes off money for failed calls - tourists, be careful!</a></li>
<li><a href="../83756/index.html">STDIO plugins or how to combine incompatible</a></li>
<li><a href="../83758/index.html">(photo) report of the Baltic Competition</a></li>
<li><a href="../83759/index.html">Support each other - give 2 AdWords coupons in good hands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>