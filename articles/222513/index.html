<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to turn off pictures and scripts in letters, and at the same time be safe. History from Yandex. Mail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I want to talk about how we did it so that Yandex.Mail does not need to include the display of pictures in each letter, as many places have to d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to turn off pictures and scripts in letters, and at the same time be safe. History from Yandex. Mail</h1><div class="post__text post__text-html js-mediator-article">  Today I want to talk about how we did it so that Yandex.Mail does not need to include the display of pictures in each letter, as many places have to do, and in general - how we provide protection when displaying the text of the letter.  What is not such an obvious thing as it may seem. <br><br>  Our users receive about one hundred million emails per day and about thirty million read through the web interface.  This is a huge field of activity for intruders, so we have built a multi-level protection. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/222513/"><img src="https://habrastorage.org/getpro/habr/post_images/32e/f02/08b/32ef0208bff30f323d8aa6bb96aec8b9.jpg" width="800"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Emails are scanned for spam, phishing, viruses, malicious content and links.  Under the cut, we will tell you about what protection mechanisms pass the letters before being displayed in the user web interface. <br><a name="habracut"></a><br><h4>  Spam Defense </h4><br>  More than 90% of all e-mails on modern Internet are adware or malicious spam.  Spam Defense effectively prevents attempts to send spam, including unsolicited mailings, which not only offer you to buy something, but try to actively attack you personally or your computer.  There are several attack vectors here.  The most common are phishing and malware distribution: viruses, trojans, bots. <br><br>  Daily Spamooborona stops 50-70 thousand phishing emails per day.  Phishers try to attack both Yandex accounts directly, and use addresses on Yandex to try to steal accounts on other services.  Interestingly, very frequent attacks on accounts in online games and game stores, such as World of Tanks or Steam. <br><br>  We analyze the texts of letters, as well as use technologies such as <a href="http://ru.wikipedia.org/wiki/DMARC">DMARC</a> to identify and combat phishing emails. <br><br><h4>  Antivirus </h4><br>  The next level of protection is the good old antivirus.  In 2014, real live computer viruses in the form of executable files are emailed quite rarely.  We see no more than a few thousand such letters per day.  However, each such file is potentially very dangerous, so it is vital for us to prevent our users' computers from becoming infected.  In this we have been helped for many years by Dr.  Web, whose server antivirus we run on a fairly large cluster of thirty machines in the full scan mode of all incoming emails. <br><br><h4>  The second phase of antiphishing </h4><br>  Spam Defense filters emails when they arrive at our incoming mail reception server (MXs).  An important and understandable disadvantage of such a regime is that sometimes the threat becomes widespread, and we already have good signs to detect it after a certain number of such malicious emails have been received into user boxes.  For such situations, we have another level of checks that is performed when each particular letter is displayed in the Yandex.Mail web interface. <br><br>  Immediately before sending the letter to the screen to the user, its text is scanned for a match with a short list of strings and regular expressions.  An important feature of this list is that it can be edited instantly, which is very important in the case of an attack that occurs right now.  Every second, Yandex.Mail accepts up to several tens of thousands of letters and the delays inevitably associated with updating large databases are very harmful here. <br><br><h4>  Sanitizer </h4><br>  Modern email is HTML.  As we, advocates and observers of purity of standards, did not resist progress, users made their choice.  Alas, this also means that all the richness of expressive means that is now available in HTML, turns into the need to very carefully scan the markup and prevent attempts to use "active" elements to attack web mail users.  HTML was developed without taking into account situations where one document is safely embedded inside another, and this is exactly what needs to be done when displaying an HTML letter in the web interface (that is, in fact, inside another HTML page).  We simply called this component a sanitizer.  It parses HTML at the level of characters, rather than element objects, since many attacks on web interfaces use markup that is not valid from the point of view of standards of the language to bypass the simplest checks.  Now HTML is no longer a single language, but a whole family, and the sanitizer separately is able to parse the CSS description language within certain elements and attributes.  The result of the work of the sanitizer is a simplified text of the letter, which can be safely inserted into another HTML page and not be afraid that any script will be executed, which will be available to the entire DOM of the web interface or that the styles from this internal block will suddenly affect the elements beyond. <br><br><h4>  Letter display </h4><br>  For quite some time now, the Yandex.Mail web interface has been working only using the secure HTTPS protocol.  In addition to fully encrypting the traffic between our servers and the user's browser, we also use an additional secure cookie to authenticate requests that is not available without encryption.  Thanks to her, even if your provider stole your authorization while you were without encryption, but you watched the Yandex Poster in a logged state or simply visited any site that uses the Yandex.Metrica counter, it will not be able to get into your mailbox.  To do this, he will need an additional cookie, which can be obtained only by decrypting HTTPS traffic. <br><br><h4>  Check for viral links with untwisted shortened links </h4><br>  We do not dwell on this and continue to protect our users even after the letter is already displayed on the screen and can be read.  The most dangerous emails try to take the user out of the Yandex.Mail protected interface to the outside and already there do something bad with it.  Therefore, at the time of the click to any external link in the letter, one more step is triggered - checking the link in the database of malicious links of a large Yandex web anti-virus.  We have already <a href="http://habrahabr.ru/company/yandex/blog/195408/">written a</a> little about this before, but it would be appropriate to repeat that our web antivirus constantly ‚Äúindexes‚Äù (just like the Yandex.Search spider robot) millions of pages on the Internet in search of viruses and other malicious programs and makes up the most complete and relevant world map of infected internet.  Even if you are reading an old letter containing a link that was absolutely safe yesterday, but today already leads to an infected page, we will warn you about it and make efforts to avoid infection. </div><p>Source: <a href="https://habr.com/ru/post/222513/">https://habr.com/ru/post/222513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222501/index.html">Installing and configuring Windows Server 2012 R2 Essentials</a></li>
<li><a href="../222503/index.html">‚ÄúLevada‚Äù: only 5% of Russian citizens consider restricting information on the Internet unacceptable. Our alternative survey</a></li>
<li><a href="../222505/index.html">Announced a course on managing storage systems EMC VNX</a></li>
<li><a href="../222509/index.html">New to the Cisco UCS Server Family</a></li>
<li><a href="../222511/index.html">How Munich translated 15,000 Windows PCs to Linux</a></li>
<li><a href="../222515/index.html">Google Chrome extension to improve search quality</a></li>
<li><a href="../222517/index.html">Postgraduate study in France, personal experience</a></li>
<li><a href="../222519/index.html">Pool of constants</a></li>
<li><a href="../222521/index.html">Axure tutorial videos</a></li>
<li><a href="../222523/index.html">Parse and calculate MS Excel formulas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>