<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Talk about PyQt4 - Secondary seating</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Welcome! 
 Last time, we discussed how to write your PyQt4 application based on the logic generated by the pyuic4 file. As is often the case - after w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Talk about PyQt4 - Secondary seating</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/blogs/python/75323/"><img src="http://pic.ipicture.ru/uploads/091115/4ko4vStT55.jpg" alt="image" align="left"></a> <br><h4>  Welcome! </h4><br>  <a href="http://habrahabr.ru/blogs/python/75226/">Last time,</a> we discussed how to write your PyQt4 application based on the logic generated by the <b>pyuic4</b> file.  As is often the case - after writing the topic, I received many interesting and, most importantly, informative comments explaining why in some cases I am right and in others wrong. <br>  The most curious thing is that the discussion is interesting both for pythonists and for C ++ adherents, because in this case the difference is small, mostly only minor things in the syntax.  All this is because PyQt4, in its essence, is a simple wrapper around sishnyh Qt-classes, preserving all the names and methods.  So, here's a cup of tea or coffee for you, get comfortable, let's start our conversation. <br><a name="habracut"></a><br><h4>  Right off the bat </h4><br>  So, we write window application.  The emphasis here is on the word " <i>window</i> ", which means that we have a user-friendly interface that allows the end user to appreciate the beauty of clicking on buttons.  Thus, we use the console for debugging and catching errors.  But why the console to the user who already has a beautiful window?  Here you can choose what to do for convenience - keep a log of work (this method just loves Microsoft, collecting all the most interesting logs and asking whether to send a report on the application's work) or redirect the console output to the widget on the form to see what have a deal.  And if the first is done fairly easily: <br><blockquote><code><a href="http://s-c.me/3793/s"></a> <a href="http://s-c.me/3793/h"></a> <font color="black">Copy Source | Copy HTML <font color="#0000ff">import</font> sys <font color="#696969">#         </font> <b>sys</b> .stdout = <b>open</b> ( <font color="#008000">"log.txt"</font> , <font color="#008000">"a+"</font> ) <b>sys</b> .stderr = <b>open</b> ( <font color="#008000">"errors.txt"</font> , <font color="#008000">"a+"</font> )</font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/3793/s"></a> <a href="http://s-c.me/3793/h"></a> Copy Source | Copy HTML <font color="#0000ff">import</font> sys <font color="#696969">#         </font> <b>sys</b> .stdout = <b>open</b> ( <font color="#008000">"log.txt"</font> , <font color="#008000">"a+"</font> ) <b>sys</b> .stderr = <b>open</b> ( <font color="#008000">"errors.txt"</font> , <font color="#008000">"a+"</font> )</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/3793/s"></a> <a href="http://s-c.me/3793/h"></a> Copy Source | Copy HTML <font color="#0000ff">import</font> sys #          <b>sys</b> .stdout = <b>open</b> ( <font color="#008000">"log.txt"</font> , <font color="#008000">"a+"</font> ) <b>sys</b> .stderr = <b>open</b> ( <font color="#008000">"errors.txt"</font> , <font color="#008000">"a+"</font> )</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/3793/s"></a> <a href="http://s-c.me/3793/h"></a> Copy Source | Copy HTML <font color="#0000ff">import</font> sys <font color="#696969">#         </font> <b>sys</b> .stdout = <b>open</b> ( <font color="#008000">"log.txt"</font> , <font color="#008000">"a+"</font> ) <b>sys</b> .stderr = <b>open</b> ( <font color="#008000">"errors.txt"</font> , <font color="#008000">"a+"</font> )</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/3793/s"></a> <a href="http://s-c.me/3793/h"></a> Copy Source | Copy HTML <font color="#0000ff">import</font> sys <font color="#696969">#         </font> <b>sys</b> .stdout = <b>open</b> ( <font color="#008000">"log.txt"</font> , <font color="#008000">"a+"</font> ) <b>sys</b> .stderr = <b>open</b> ( <font color="#008000">"errors.txt"</font> , <font color="#008000">"a+"</font> )</font></code> </li> </ol></blockquote><br>  then with the second, many questions arise.  Actually the otgadka is hidden just in this example.  What we have?  File-like object that allows the addition of lines to the end.  This is done, as far as we remember from working with files in Python, using the <b>write ()</b> method.  So let's make an object with the <b>write ()</b> method and pass the output widget as a parameter! <br><blockquote> <code><a href="http://s-c.me/3794/s"></a> <a href="http://s-c.me/3794/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">class</font> <font color="#cc6633">Logger</font> (object): </li><li>  <font color="#0000ff">def __init__</font> (self, output): </li><li>  <b>self</b> .output = output </li><li></li><li>  <font color="#0000ff">def</font> <font color="#cc6633">write</font> (self, string): </li><li>  <font color="#0000ff">if not</font> (string == <font color="#008000">"\ n"</font> ): </li><li>  trstring = QtGui.QApplication.translate ( <font color="#008000">"MainWindow"</font> , <b>string</b> .strip (), None, QtGui.QApplication.UnicodeUTF8) </li><li>  <b>self</b> .output.append (trstring) </li></ol></blockquote><br>  at the same time, it is often necessary to cut off all unnecessary from the line and make a check on the carriage transfer character so that half of the log is not occupied by empty lines. <br>  Now, in order to redirect the console output to the widget, we need to register it in the window class and link it to the standard output via the logger class: <br><blockquote> <code><a href="http://s-c.me/3796/s"></a> <a href="http://s-c.me/3796/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <b>self</b> .logText = QtGui.QTextEdit (MainWindow) </li><li>  <font color="#696969"># give the widget the read-only property</font> </li><li>  <b>self</b> .logText.setReadOnly (True) </li><li>  <font color="#696969"># make the vertical scroll bar visible always, in my opinion, it is more convenient</font> </li><li>  <b>self</b> .logText.setVerticalScrollBarPolicy (QtCore.Qt.ScrollBarAlwaysOn) </li><li>  <font color="#696969"># initial message</font> </li><li>  <b>self</b> .logText.append ( <font color="#008000">"Log started"</font> ) </li><li>  <font color="#696969"># you can both redirect everything to one widget, or separate errors and</font> </li><li>  <font color="#696969"># standard output</font> </li><li>  <b>self</b> .logger = Logger ( <b>self</b> .logText) </li><li>  <b>self</b> .errors = Logger ( <b>self</b> .logText) </li><li>  <b>sys</b> .stdout = <b>self</b> .logger </li><li>  <b>sys</b> .stderr = <b>self</b> .errors </li></ol></blockquote><br>  Now we can write to the log in two ways - either (in the window class) using <b>self.logger.write ()</b> , or simply using <b>print</b> .  Thus, having made a beautiful error output with <b>try-except</b> 'ah, we see everything right in the window.  There is still a big plus is the very separation of Python-logic with Qt logic - the form hangs in a separate thread and when errors in external functions the application does not end, but the error immediately falls into the log.  And yes, it‚Äôs worth a little more to talk about. <br><br><h4>  A little bit about streams </h4><br>  I think you have repeatedly noticed that if you register a function that requires a lot of time and resources to execute, the form will ‚Äúhang‚Äù and you will not receive any data on the status of the function.  I myself faced this when I wanted to make a consistent output of the values ‚Äã‚Äãreturned from the functions to the list on the form.  The solution is obvious - to use threads.  And before us there will be a choice - to use threads with Python-logic or Qt streams?  Personally, in this case, I prefer the second - less hassle in some aspects. <br>  In order for us to be beautiful, we must again create another class with inheritance from Qt-shnogo.  And what to do, such a "class logic" :) There are pros and cons, but now this is not about that. <br><blockquote> <code><a href="http://s-c.me/3797/s"></a> <a href="http://s-c.me/3797/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">class</font> <font color="#cc6633">myQThread</font> (QtCore.QThread): </li><li>  <font color="#0000ff">def __init__</font> (self, output): </li><li>  QtCore.QThread.  <font color="#0000ff">__init__</font> (self) </li><li>  <b>self</b> .output = output </li><li></li><li>  <font color="#0000ff">def</font> <font color="#cc6633">run</font> (self): </li><li>  some_big_function_with_output () </li></ol></blockquote><br>  As you can see, at first we initialize the Qt-shnogo class stream (I also added an output object to the constructor parameters - this could be the very widget on the form).  Then we override the standard <b>run ()</b> method, which contains exactly what the thread should do.  This function or functions can be connected even from external modules - in this case it does not matter.  Its output in this case can and should be done through the <b>output</b> passed to the function using the <b>append ()</b> method.  You can, for greater beauty, add a progress bar or another visualizer so that the user can see that the stream is working. <br>  And how do we know that the thread has completed its work?  To do this, we will create one small hack - we will create a slot for the signal handler from the stream, but we will not use <b>connect</b> , but use the decorator: <br><blockquote> <code><a href="http://s-c.me/3798/s"></a> <a href="http://s-c.me/3798/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#ff9c00">@ QtCore.pyqtSignature ("")</font> </li><li>  <font color="#0000ff">def</font> <font color="#cc6633">threadFinished</font> (self): </li><li>  <b>self</b> .logger.write ( <font color="#008000">"Feed completed!"</font> ) </li></ol></blockquote><br>  Yes, you understood correctly, it is written in the form class, and when the <b>threadFinished ()</b> signal is generated, the program informs us about it.  These are the pies. <br><br>  Actually, work with streams, slots and signals could be considered in more detail - but for starters, that's enough.  I hope you enjoyed our little tea party, before the connection!  Write comments :) </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/75323/">https://habr.com/ru/post/75323/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../75316/index.html">I see through you, and you naively believe that you are completely safe.</a></li>
<li><a href="../75319/index.html">MP3 search Vkontakte in your browser</a></li>
<li><a href="../75320/index.html">Bugs in the installers. And where are they not?</a></li>
<li><a href="../75321/index.html">It is strange that on Habr√© there is no flea market!? Habralaholki?</a></li>
<li><a href="../75322/index.html">CMS Award 2009 Results</a></li>
<li><a href="../75325/index.html">The court found Psystar guilty</a></li>
<li><a href="../75326/index.html">Yandeks.Pochta: Consumer satisfaction survey. Poll</a></li>
<li><a href="../75327/index.html">Platform 2010 from the inside. Part 1</a></li>
<li><a href="../75328/index.html">Guess crowd behavior</a></li>
<li><a href="../75329/index.html">IT outsourcing: on the other side of the barricades</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>