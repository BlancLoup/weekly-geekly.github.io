<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JDK concurrent package</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The memory model that currently exists in Java guarantees the expected order of execution of multi-threaded code, in the absence of this code in the r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JDK concurrent package</h1><div class="post__text post__text-html js-mediator-article"> The memory model that currently exists in Java guarantees the expected order of execution of multi-threaded code, in the absence of this code in the race races.  And in order to protect your code from racing, various ways to synchronize and exchange data between them have been invented. <br><br>  The <code>java.util.concurrent</code> package, which is part of the HotSpot JDK, provides the following tools for writing multi-threaded code: <br><ul><li>  Atomic </li><li>  Locks </li><li>  Collections </li><li>  Synchronization points </li><li>  Executors </li><li>  Accumulators _jdk 1.8_ </li></ul><br><a name="habracut"></a><br><h5>  Atomic </h5><br>  In the child package <code>java.util.concurrent.atomic</code> there is a set of classes for atomic work with primitive types.  The contract of these classes guarantees the execution of the <code>compare-and-set</code> operation for "1 unit of processor time".  When you set a new value for this variable, you also pass in its old value (optimistic locking approach).  If the value of the variable is different from the expected one since the method was called, the result will be <code>false</code> . <br><br>  For example, take two arrays of <code>long</code> variables <code>[1,2,3,4,5]</code> and <code>[-1,-2,-3,-4,-5]</code> .  Each of the threads will be sequentially iterated over the array and sum the elements into a single variable.  The code ( <i>groovy</i> ) with pessimistic blocking looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> monitor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object() <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Summer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Callable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>[] <span class="hljs-function"><span class="hljs-function">data Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ data.each { <span class="hljs-keyword"><span class="hljs-keyword">synchronized</span></span> (Sum.monitor) { println(<span class="hljs-string"><span class="hljs-string">"${Thread.currentThread().name}: add ${it} to ${Sum.sum}"</span></span>) Sum.sum += it } } } } Executors.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">2</span></span>).invokeAll([ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Summer(data: [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Summer(data: [-<span class="hljs-number"><span class="hljs-number">1</span></span>,-<span class="hljs-number"><span class="hljs-number">2</span></span>,-<span class="hljs-number"><span class="hljs-number">3</span></span>,-<span class="hljs-number"><span class="hljs-number">4</span></span>,-<span class="hljs-number"><span class="hljs-number">5</span></span>]) ]) print(<span class="hljs-string"><span class="hljs-string">"Sum: ${Sum.sum}"</span></span>)</code> </pre><br><br>  The output will be expected: <br><br><pre> <code class="hljs pgsql">pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> Sum: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><br>  However, this approach has significant performance disadvantages.  In this case, the useless work for us, takes more resources than useful: <br><ul><li>  attempt to block the monitor </li><li>  flow blocking </li><li>  unlock monitor </li><li>  thread unlocking </li></ul><br><br>  Consider using <code>AtomicLong</code> to implement optimistic locking when calculating the same amount: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> AtomicLong sum = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomicLong(<span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Summer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Callable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>[] <span class="hljs-function"><span class="hljs-function">data Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ data.each { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> localSum = Sum.sum.get() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Sum.sum.compareAndSet(localSum, localSum + it)) { println(<span class="hljs-string"><span class="hljs-string">"${Thread.currentThread().name}: add ${it} to ${Sum.sum}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { println(<span class="hljs-string"><span class="hljs-string">"[MISS!] ${Thread.currentThread().name}: add ${it} to ${Sum.sum}"</span></span>) } } } } } Executors.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">2</span></span>).invokeAll([ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Summer(data: [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>]), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Summer(data: [-<span class="hljs-number"><span class="hljs-number">1</span></span>,-<span class="hljs-number"><span class="hljs-number">2</span></span>,-<span class="hljs-number"><span class="hljs-number">3</span></span>,-<span class="hljs-number"><span class="hljs-number">4</span></span>,-<span class="hljs-number"><span class="hljs-number">5</span></span>]) ]) print(<span class="hljs-string"><span class="hljs-string">"Sum: ${Sum.sum}"</span></span>)</code> </pre><br><br>  As can be seen from the results of the ‚Äúerroneous‚Äù attempts, there were not so many: <br><br><pre> <code class="hljs pgsql">[MISS!] pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-3</span></span> [MISS!] pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-3</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-6</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-5</span></span> [MISS!] pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-5</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-7</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-7</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-9</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">-5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-9</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">-5</span></span> pool<span class="hljs-number"><span class="hljs-number">-1</span></span>-thread<span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> Sum: <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><br>  When deciding to use an optimistic lock, it is important that the action with the variable being modified does not take a lot of time.  The longer this action is, the more often erroneous <code>compare-and-set</code> will occur, and the more often it will be necessary to perform this action again. <br><br>  Based on the <code>compare-and-set</code> , a non-blocking read lock can also be implemented.  In this case, the atomic variable will store the version of the object being processed.  Having obtained the value of the version before the calculations, we can verify it after the calculation.  Normal <code>read-write</code> locks take effect only if the version check fails. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transaction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> debit } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class"> </span></span>{ AtomicLong version = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomicLong() ReadWriteLock readWriteLock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ReentrantReadWriteLock() List&lt;Transaction&gt; transactions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Transaction&gt;() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Account account)</span></span></span><span class="hljs-function"> </span></span>{ ReentrantReadWriteLock.<span class="hljs-function"><span class="hljs-function">ReadLock locked </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> balance = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> version = account.version.get() account.transactions.each {balance += it.debit} <span class="hljs-comment"><span class="hljs-comment">//volatile write for JMM if (account.version.compareAndSet(version, version)) { if (locked) {locked.unlock()} return balance } else { locked = account.readWriteLock.readLock() } } } void modifyTransaction(Account account, int position, long newDebit) { def writeLock = account.readWriteLock.writeLock() account.version.incrementAndGet() account.transactions[position].debit = newDebit writeLock.unlock() }</span></span></code> </pre><br><br><h5>  Locks </h5><br><h6>  Reentrant lock </h6><br>  Unlike syncronized locks, <code>ReentrantLock</code> allows <code>ReentrantLock</code> to more <code>ReentrantLock</code> choose the moments of removing and receiving locks, since  uses regular java calls.  Also <code>ReentrantLock</code> allows you to get information about the current state of the lock, allows you to "wait" for a lock for a certain time.  Supports proper recursive retrieval and release of blocking for a single thread.  If you need honest locks (which take priority when capturing the monitor) - <code>ReentrantLock</code> also equipped with this mechanism. <br><br>  Although the <code>syncronized</code> and <code>ReentrantLock</code> locks are very similar, the implementation at the JVM level is quite different. <br>  Without going into details JMM: use <code>ReentrantLock</code> instead of the <code>ReentrantLock</code> provided syncronized lock is only worth it if you very often have a battle of threads for the monitor.  In the case when only one stream gets into the syncronized method __, the performance of <code>ReentrantLock</code> inferior to the JVM locking mechanism. <br><br><h6>  ReentrantReWriteLock </h6><br>  Complements the properties of <code>ReentrantLock</code> ability to lock multiple read and write locks.  A write lock can be ‚Äúomitted‚Äù before a read lock, if necessary. <br><br><h6>  StampedLock _jdk 1.8_ </h6><br>  Implements optimistic and pessimistic read-write locks with the possibility of further increasing or decreasing them.  Optimistic locking is implemented through the ‚Äústamp‚Äù of the lock ( <i>javadoc</i> ): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distanceFromOriginV1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// A read-only method long stamp; if ((stamp = sl.tryOptimisticRead()) != 0L) { // optimistic double currentX = x; double currentY = y; if (sl.validate(stamp)) return Math.sqrt(currentX * currentX + currentY * currentY); } stamp = sl.readLock(); // fall back to read lock try { double currentX = x; double currentY = y; return Math.sqrt(currentX * currentX + currentY * currentY); } finally { sl.unlockRead(stamp); } }</span></span></code> </pre><br><br><h5>  Collections </h5><br><h6>  ArrayBlockingQueue </h6><br>  Honest queue to send a message from one thread to another.  Supports blocking ( <code>put()</code> <code>take()</code> ) and nonblocking ( <code>offer()</code> <code>pool()</code> ) methods.  Disable null values.  Queue capacity must be specified at creation. <br><br><h6>  Concurrenthashmap </h6><br>  Key-value structure based on the <code>hash</code> function.  There are no locks for reading.  When recording, only part of the map (segment) is blocked.  The number of segments is limited to the closest to <code>concurrencyLevel</code> degree 2. <br><br><h6>  ConcurrentSkipListMap </h6><br>  Balanced multi-threaded key-value structure (O (log n)).  The search is based on a list with gaps.  The card must be able to compare keys. <br><br><h6>  ConcurrentSkipListSet </h6><br>  <code>ConcurrentSkipListMap</code> with no values. <br><br><h6>  CopyOnWriteArrayList </h6><br>  Blocking for writing, not blocking for reading list.  Any modification creates a new instance of the array in memory. <br><br><h6>  CopyOnWriteArraySet </h6><br>  <code>CopyOnWriteArrayList</code> without values. <br><br><h6>  Delayquayue </h6><br>  <code>PriorityBlockingQueue</code> allowing to receive an item only after a certain delay (the delay is announced through the <code>Delayed</code> object interface).  <code>DelayQueue</code> can be used to implement the scheduler.  Queue capacity is not fixed. <br><br><h6>  LinkedBlockingDeque </h6><br>  Bidirectional <code>BlockingQueue</code> based on coherence (cache-miss &amp; cache coherence overhead).  Queue capacity is not fixed. <br><br><h6>  LinkedBlockingQueue </h6><br>  Unidirectional <code>BlockingQueue</code> based on coherence (cache-miss &amp; cache coherence overhead).  Queue capacity is not fixed. <br><br><h6>  LinkedTransferQueue </h6><br>  Unidirectional `BlockingQueue` based on coherence (cache-miss &amp; cache coherence overhead).  Queue capacity is not fixed.  This queue allows you to expect the item to be ‚Äúpicked up‚Äù by the handler. <br><br><h6>  PriorityBlockingQueue </h6><br>  A unidirectional `BlockingQueue` that allows prioritization of messages (by comparing elements).  Disable null values. <br><br><h6>  SynchronousQueue </h6><br>  A unidirectional `BlockingQueue` that implements <code>transfer()</code> logic for <code>put()</code> methods. <br><br><h5>  Synchronization points </h5><br><h6>  CountDownLatch </h6><br>  Barrier ( <code>await()</code> ), waiting for a specific (or more) number of <code>countDown()</code> calls.  Barrier status cannot be reset. <br><br><h6>  CyclicBarrier </h6><br>  Barrier ( <code>await()</code> ), waiting for a specific number of <code>await()</code> calls by other threads.  When the number of threads reaches the specified option, an optional callback will be called and the lock will be removed.  The barrier resets its state to the initial state when the waiting threads are released and can be reused. <br><br><h6>  Exchanger </h6><br>  Barrier (`exchange ()`) to synchronize two threads.  At the time of synchronization, volatile transfer of objects between threads is possible. <br><br><h6>  Phaser </h6><br>  An extension of `CyclicBarrier`, allowing you to register and delete participants for each cycle of the barrier. <br><br><h6>  Semaphore </h6><br>  A barrier allowing only a specified number of streams to capture the monitor.  In fact, the `Lock` functionality extends the ability to be in a block to several threads. <br><br><h5>  Executors </h5><br><br>  <code>ExecutorService</code> came to replace <code>new Thread(runnable)</code> to simplify work with threads.  <code>ExecutorService</code> helps to reuse freed threads, organize queues from tasks for a thread pool, subscribe to the result of the task.  Instead of the <code>Runnable</code> interface, the pool uses the <code>Callable</code> interface (it can return the result and throw errors). <br><br><pre> <code class="java hljs">ExecutorService pool = Executors.newFixedThreadPool(<span class="hljs-number"><span class="hljs-number">4</span></span>) Future future = pool.submit(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Callable() { <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ println(<span class="hljs-string"><span class="hljs-string">"In thread"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"From thread"</span></span> } }) println(<span class="hljs-string"><span class="hljs-string">"From main"</span></span>) println(future.get()) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { pool.submit(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Callable() { <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException() } }).get() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ExecutionException e) {println(<span class="hljs-string"><span class="hljs-string">"Got it: ${e.cause}"</span></span>)} pool.shutdown()</code> </pre><br><br>  The <code>invokeAll</code> method returns control to the calling thread only upon completion of all tasks.  The <code>invokeAny</code> method returns the result of the first successfully completed task, canceling all subsequent ones. <br><br><h6>  ThreadPoolExecutor </h6><br>  Thread pool with the ability to specify the working and maximum number of threads in the pool, the queue for tasks. <br><br><h6>  ScheduledThreadPoolExecutor </h6><br>  Extends the functionality of <code>ThreadPoolExecutor</code> ability to perform tasks deferred or regularly. <br><br><h6>  ThreadPoolExecutor </h6><br>  Lighter thread pool for self-replicating tasks.  The pool expects calls for fork () `and` join () `methods on child tasks in the parent. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LNode</span></span></span><span class="hljs-class"> </span></span>{ List&lt;LNode&gt; childs = [] def object } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Finder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecursiveTask</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LNode</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">LNode node Object expect </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> LNode </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node?.object?.equals(expect)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> node } node?.childs?.collect { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Finder(node: it, expect: expect).fork() }?.collect { it.join() }?.find { it != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> } } } ForkJoinPool es = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ForkJoinPool() def invoke = es.invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Finder( node: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LNode( childs: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LNode(object: <span class="hljs-string"><span class="hljs-string">"ivalid"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LNode( object: <span class="hljs-string"><span class="hljs-string">"ivalid"</span></span>, childs: [<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LNode(object: <span class="hljs-string"><span class="hljs-string">"test"</span></span>)] ) ] ), expect: <span class="hljs-string"><span class="hljs-string">"test"</span></span> )) print(<span class="hljs-string"><span class="hljs-string">"${invoke?.object}"</span></span>)</code> </pre><br><br><h6>  Accumulators _jdk 1.8_ </h6><br>  Accumulators allow you to perform primitive operations (sum / search for the maximum value) on numeric elements in a multithreaded environment without using CAS. </div><p>Source: <a href="https://habr.com/ru/post/187854/">https://habr.com/ru/post/187854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187836/index.html">New Brief: Samsung Announced New Exynos 5 Octa Processor - Exynos 5420</a></li>
<li><a href="../187844/index.html">CowboyD: demonizing Cowboy, the embedded web server for Erlang</a></li>
<li><a href="../187846/index.html">Moscow MySQL User Group meeting on August 2nd at Yandex office</a></li>
<li><a href="../187848/index.html">Cloud News Digest (July 14 - 21, 2013)</a></li>
<li><a href="../187850/index.html">The international network of provider independent data centers DataHouse</a></li>
<li><a href="../187858/index.html">Single window mode, or the main error "Microsoft"</a></li>
<li><a href="../187860/index.html">The New Deal on Udacity: ‚ÄúDesigning the Usual Things‚Äù by Donald Norman</a></li>
<li><a href="../187864/index.html">Scientists are developing a snare robot for firefighters</a></li>
<li><a href="../187866/index.html">How intelligence works (a single algorithm for discernment and generalization)</a></li>
<li><a href="../187868/index.html">IE11 preview for Windows 7, updates for modern.ie, 25% discount for Parallels for Mac</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>