<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsim RSS LostFilm with grep and transfer to download via wget</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I got tired of manually browsing LostFilm for new episodes and I decided to automate this process. The fact is that many BitTorrent clients have ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsim RSS LostFilm with grep and transfer to download via wget</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2ad/fb7/c99/2adfb7c99b5bf6371d681f71eb955db8.jpg" alt="RSS feed"><br>  Once I got tired of manually browsing <a href="http://www.lostfilm.tv/">LostFilm</a> for new episodes and I decided to automate this process.  The fact is that many <b>BitTorrent</b> clients have in their settings the so-called tracking folders (wach directory).  As soon as a new torrent file appears in this folder, the <b>BitTorrent</b> client immediately starts downloading it.  The usual practice, for example, is to create such a folder and open access to it for writing via <b>FTP</b> .  Now, all we need is to automate the downloading of a torrent file upon the release of a new episode in the specified folder for their further automatic download.  How to do exactly that I will now show. <br><a name="habracut"></a><br>  <i>For reference</i> , the tracking folders in <a href="http://www.transmissionbt.com/">Transmission</a> are set with options ( <code>watch-dir-enabled</code> and <code>watch-dir</code> ), and in <a href="http://libtorrent.rakshasa.no/">rTorrent</a> you need to add the following line to the configuration file: <br> <code>schedule = watch_directory,5,5,load_start=./watch/*.torrent</code> <br> <br><h5>  Point one </h5><br>  So, first of all we need to get an <a href="">RSS feed</a> from <b>LostFilm</b> 'a.  To do this, use the <code>wget</code> command: <br><br> <code>wget -qO - http://www.lostfilm.tv/rssdd.xml</code> <br> <br>  here: the " <code>-q</code> " option tells wget not to display information about their work, i.e.  " <i>be quiet</i> "; <br>  " <code>-O -</code> " causes the loaded tape to be output not to a file, but to the standard output stream.  This is done so that the data obtained can be passed down a pipeline to the input of the grep filter. <br><br><h5>  Second point </h5><br>  Now we need to select all links to torrent files from the resulting tape.  To do this, we will ask grep to look for substrings using the following regular expression: <code>'http.*torrent'</code> .  Here the point symbol means ‚Äúany character‚Äù and the asterisk means ‚Äúrepeat any number of times‚Äù.  Those.  we will find all entries starting with ‚Äúhttp‚Äù and ending with ‚Äútorrent‚Äù which will be links to torrent files.  The team itself looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>grep -ioe 'http.*torrent'</code> <br> <br>  where " <code>-i</code> " is case-insensitive search, <br>  " <code>-o</code> " - select only the matched part of the substring (done to filter the tags that surround the link), <br>  " <code>-e</code> " - search by regular expression <br><br><h5>  Point three </h5><br>  After we have found all the links to the torrent files, we need to select only those that are interesting to us.  For example, I like the series <i>Lost, House MD, Lie to Me</i> and <i>Spartacus</i> .  On their example, I will show how to filter.  All links to torrent files in LostFilm RSS feed are: <br><br> <code>http://lostfilm.tv/download.php/2030/The.Oscars.The.Red.Carpet.2010.rus.LostFilm.TV.torrent</code> <br> <br>  Thus, to highlight the titles of the series I am interested in, I used the following regular expression: <code>'[0-9]{4}/(lost|house|lie|spartacus)'</code> .  It searches for 4 digits in a row ("[0-9] {4}", where the number of repetitions is given in curly braces), followed by a slash, and then one of the four choices by series name (" <code>(lost|house|lie|spartacus)</code> ", where the character" | "is read as OR).  But, for the grep command, service characters need to be escaped with "\".  Total, we have: <br><br> <code>grep -ie '[0-9]\{4\}/\(lost\|house\|lie\|spartacus\)'</code> <br> <br><h5>  Point four </h5><br>  Now we only have links to the torrent files of the series we are interested in.  Now we have to upload them to the tracking folder of our torrent client.  But, the fact is that without authorization, <b>LostFilm</b> will not allow you to download files.  In order to be able to download files, you need to send cookies with the authorization information along with the <b>GET</b> request.  Fortunately, the <code>wget</code> team can load <code>cookies</code> from the specified file.  Look at the <code>wget</code> call: <br><br> <code>wget -nc -qi - -P ~/.config/watch_dir --load-cookies=~/.config/cookies.txt</code> <br> <br>  where the option " <code>-nc</code> " tells the command not to reload files if we already have them on the disk, <br>  " <code>-q</code> " - option above, indicates the command " <i>to be quiet</i> ", <br>  " <code>-i -</code> " - get a list of files to load from standard input, <br>  " <code>-P ~/.config/watch_dir</code> " - an indication of our tracking folder where files will be downloaded, <br>  " <code>--load-cookies=~/.config/cookies.txt</code> " - use cookies from the specified file. <br><br>  the file with <code>cookies</code> has the following format: <br><br> <code>.lostfilm.tv TRUE / FALSE 2147483643 pass &lt; &gt; <br> .lostfilm.tv TRUE / FALSE 2147483643 uid &lt; &gt;</code> <br> <br>  <b>I draw attention</b> to the fact that neither the password nor the uid is <b>not transmitted in the clear</b> !  Their values ‚Äã‚Äãcan be seen by opening the window for viewing cookies in your browser, or, for example, use the <a href="https://addons.mozilla.org/ru/firefox/addon/66579">plugin</a> for <a href="http://www.firefox.com/">FireFox</a> to export all cookies to a file which should be <code>wget'</code> to <code>wget'</code> . <br><br><h5>  Last item </h5><br>  and now all together: <br><br> <code>wget -qO - http://www.lostfilm.tv/rssdd.xml | grep -ioe 'http.*torrent' | grep -ie '[0-9]\{4\}/\(lost\|house\|lie\|spartacus\)' | wget -nc -qi - -P ~/.config/watch_dir --load-cookies=~/.config/cookies.txt</code> <br> <br><h5>  The final point :) </h5><br>  Well, now, for final automation, let's write all this in <code>cron</code> : <br><br> <code>*/15 * * * * wget -qO - http://www.lostfilm.tv/rssdd.xml | grep -ioe 'http.*torrent' | grep -ie '[0-9]\{4\}/\(lost\|house\|lie\|spartacus\)' | wget -nc -qi - -P ~/.config/watch_dir --load-cookies=~/.config/cookies.txt &gt; /dev/null 2&gt;&amp;1</code> <br> <br>  where " <code>&gt; /dev/null 2&gt;&amp;1</code> " suppresses the output of the command and thus does not force <code>cron</code> generate you an email with the output of commands. <br><br>  <b>UPD</b> .  Added a <a href="http://habrahabr.ru/blogs/p2p/87166/">continuation of the</a> article where the issue with RSS feeds that have no direct links to torrent files is being considered. <br><br>  <b>UPD2.</b>  The comments rightly noted that in this implementation, access to the server occurs every time, even if there is no new data on it. <br><br>  So, habrochelok <a href="https://habrahabr.ru/users/nebulosa/" class="user_link">Nebulosa</a> suggested in his <a href="http://habrahabr.ru/blogs/p2p/87042/">commentary</a> "checking for the existence of files so that wget does not pull the server every time", <br><br>  and <a href="https://habrahabr.ru/users/guria/" class="user_link">Guria</a> , at the same time, <a href="http://habrahabr.ru/blogs/p2p/87042/">recommends</a> ‚Äúin order not to parse and load the same thing, and why the server should not be wasted, write the value of the Last-Modified header and transmit it in the If-Modified-Since header.  Also the server can support ETag. ‚Äù <br><br>  <b>UPD3</b> .  If there are difficulties with the transfer of cookies, you can use another way.  To do this, replace the last <code>wget</code> command in the pipeline with the following: <br><br> <code>wget -nc -qi - -P ~/ --header "Cookie: uid=***; pass=***"</code> </div><p>Source: <a href="https://habr.com/ru/post/87042/">https://habr.com/ru/post/87042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../87028/index.html">Thunderbird 3.1 Beta 1 released</a></li>
<li><a href="../87033/index.html">Drill with Shell</a></li>
<li><a href="../87034/index.html">Hard drive is dead - now it works like a clock</a></li>
<li><a href="../87035/index.html">Manual testing process: What would we do to automate this?</a></li>
<li><a href="../87039/index.html">A little bit about the architecture of the ARM7TDMI processors</a></li>
<li><a href="../87043/index.html">Cisco CRS-3 will allow all Chinese to start video chat at the same time</a></li>
<li><a href="../87045/index.html">When a programmer is bored with programming</a></li>
<li><a href="../87046/index.html">Reading PDF files on PocketBook 302 e-book</a></li>
<li><a href="../87047/index.html">Siberian Internet Week will be held in Novosibirsk March 15-21</a></li>
<li><a href="../87048/index.html">Children with disabilities in North Ossetia were given Macs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>