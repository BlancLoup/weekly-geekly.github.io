<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backup VM ESXi with Bareos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing a series of publications about backup capabilities with Bareos. This article is about backup VM ESXi using Bareos. 

 Previous posts: "Back...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backup VM ESXi with Bareos</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/simnetworks/blog/315402/"><img src="https://habrastorage.org/files/7d3/b10/9c0/7d3b109c0d414157a34058adb80a1e8d.jpg"></a> <br><br>  Continuing a series of publications about backup capabilities with Bareos.  This article is about backup VM ESXi using Bareos. <br><br>  Previous posts: <a href="https://habrahabr.ru/company/simnetworks/blog/313124/">"Backup using Open Source Solution - Bareos"</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      VMware ESXi virtual machines are often backed up by tools like Veeam or the ghettovcb script.  In this article, we will look at how to backup a virtual machine using Bareos 16.2, namely, we will use one of the plugins that allows you to extend the functionality of Bareos - vmware-plugin.  In the 16th version, the location of the configuration files was changed, now each resource (pool, client, job, etc.) was distributed in its directories, multilingual added for the web UI, the MySQL plugin was improved, more detailed documentation can be viewed <a href="https://www.bareos.org/en/news/bareos-16-2-release-candidate-248.html">here</a> . <br><a name="habracut"></a><br>  For this example, we have ESXi 6.0 (the Evaluation license is enough for the plugin to work) and the server under CentOS 7, on which Bareos will be installed. <br><br>  Add a repository: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">wget</span></span> http://download.bareos.org/bareos/release/16.2/CentOS_7/bareos.repo -O /etc/yum.repos.d/bareos.repo</code> </pre> <br>  Install the necessary components: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -y bareos-<span class="hljs-keyword"><span class="hljs-keyword">client</span></span> bareos-<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>-tools bareos-filedaemon bareos-<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>-postgresql bareos bareos-bconsole bareos-<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>-common bareos-<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span> bareos-director bareos-common</code> </pre> <br>  Install the database: <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> -y postgresql-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> postgresql-contrib</code> </pre> <br>  After installation we will execute: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># postgresql-setup initdb</span></span></code> </pre> <br>  Run the database preparation scripts installed with Bareos: <br><br><pre> <code class="hljs swift">su postgres -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /usr/lib/bareos/scripts/create_bareos_database su postgres -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /usr/lib/bareos/scripts/make_bareos_tables su postgres -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /usr/lib/bareos/scripts/grant_bareos_privileges</code> </pre> <br>  More information about the installation and description of the components, as well as a description of the main directives can be found <a href="https://habrahabr.ru/company/simnetworks/blog/313124/">here.</a> <br><br><div class="spoiler">  <b class="spoiler_title">The list of directories in the 16th version looks like this:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">/bareos-dir-export /bareos-dir.d /catalog /client /console /counter /director /fileset /job /jobdefs /messages /pool /profile /schedule /<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span> /bareos-fd.d /client /director /messages /bareos-sd.d /autochanger /device /director /messages /ndmp /<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span> /tray-monitor.d /client /director /<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span> bconsole.conf</code> </pre><br></div></div><br>  Each subdirectory has its own configuration file, which is responsible for the resource corresponding to the directory name. <br><br>  Before making any settings, you must make sure that all the requirements for the operation of the VMware plugin are met.  The official list of requirements can be viewed <a href="http://doc.bareos.org/master/html/bareos-manual-main-reference.html">here</a> . <br><br>  You need to install all the dependencies before installing the plugin. <br>  Add one of the EPEL repositories, because  we will need some packages for further installation: <br><br><pre> <code class="hljs cmake">rpm -ivh yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python-pip yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python-wheel pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> --upgrade pip pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> pyvmomi yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python-pyvmomi     : yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> bareos-vmware-plugin</code> </pre> <br>  It is imperative that the VM on ESXi supports and is enabled by CBT (Changed Block Tracking).  On the VMware website it is indicated how this option is enabled, however there is an easier way - using a script.  The script itself is called vmware_cbt_tool and can be taken on GitHub. <br><br>  After downloading to the BareOS server, and going to the script directory, you need to do the following: <br><br><pre> <code class="hljs sql">./vmware_cbt_tool.py -s 172.17.10.1 -u bakuser -p kJo@<span class="hljs-comment"><span class="hljs-comment">#!a -d ha-datacenter -f / -v ubuntu --info</span></span></code> </pre> <br>  By options: <br><blockquote>  -s - server address <br>  -u - user on ESXi (specially brought bakuser user) <br>  -p - his password <br>  -d - the name of our "datacenter" in ESXi, by default "ha-datacenter" <br>  -f - folder with our VM, default root <br>  -v - the name of the VM itself <br>  --info - shows us the current CBT settings for the VM </blockquote><br><img src="https://habrastorage.org/files/fb0/306/f52/fb0306f52e50470dab5cb6c01e5ba2f5.png"><br><br>  Having executed the command, you should see: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu CBT supported: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu CBT enabled: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  That is, CBT is supported, but is not currently enabled, so we‚Äôll include the --enablecbt option at the end of the command using the same script. <br><br><pre> <code class="hljs sql">./vmware_cbt_tool.py -s 172.17.10.1 -u bakuser -p kJo@<span class="hljs-comment"><span class="hljs-comment">#!a -d ha-datacenter -f / -v ubuntu --enablecbt</span></span></code> </pre> <br>  As a result, we will see the following: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu CBT supported: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu CBT enabled: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu trying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> CBT now <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu trying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> remove a <span class="hljs-keyword"><span class="hljs-keyword">snapshot</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> activate CBT <span class="hljs-keyword"><span class="hljs-keyword">INFO</span></span>: VM ubuntu successfully created <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> removed <span class="hljs-keyword"><span class="hljs-keyword">snapshot</span></span></code> </pre> <br>  CBT successfully enabled. <br><br>  Now you need to go to the settings of the BareOS, you can also follow the official documentation. <br><br>  Here is the contents of the configs: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/client/bareos-fd.conf Client { <span class="hljs-type"><span class="hljs-type">Name</span></span> = vmware #    localhost Address = localhost <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "wai2Aux0" } /etc/bareos/bareos-dir.d/director/bareos-dir.conf Director { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "bareos-dir" QueryFile = "/usr/lib/bareos/scripts/query.sql" Maximum Concurrent Jobs = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "wai2Aux0" Messages = Standard Auditing = yes }</code> </pre><br>  The next file in this example is one of the most important, since  it specifies the options for the plugin <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/fileset/SelfTest.conf FileSet { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "vm-ubuntu" <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">Options</span></span> { signature = MD5 Compression = GZIP } Plugin = "python:module_path=/usr/lib64/bareos/plugins/vmware_plugin:module_name=bareos-fd-vmware:dc=ha-datacenter:folder=/:vmname=ubuntu:vcserver=172.17.10.1:vcuser=bakuser:vcpass=kJo@#!a" } }</code> </pre><br><blockquote>  python: module_path = / usr / lib64 / bareos / plugins / vmware_plugin - specify where the plugin is located <br>  module_name = bareos-fd-vmware - specify its name <br>  dc - datacenter name in ESXi <br>  folder - folder with VM, default root <br>  vmname is the name of the virtual machine <br>  vcserver - server address <br>  vcuser - user login specially created for work with backup <br>  vcpass - his password </blockquote><br><div class="spoiler">  <b class="spoiler_title">Job Description for backup:</b> <div class="spoiler_text"><pre> <code class="hljs sql">/etc/bareos/bareos-dir.d/job/<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span>-bareos-fd.conf Job { <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> = <span class="hljs-string"><span class="hljs-string">"vm-ubuntu-backup-job"</span></span> JobDefs = <span class="hljs-string"><span class="hljs-string">"DefaultJob"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Client</span></span> = <span class="hljs-string"><span class="hljs-string">"vmware"</span></span> } /etc/bareos/bareos-dir.d/jobdefs/DefaultJob.conf JobDefs { <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> = <span class="hljs-string"><span class="hljs-string">"DefaultJob"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> = Incremental FileSet = <span class="hljs-string"><span class="hljs-string">"vm-ubuntu"</span></span> Schedule = <span class="hljs-string"><span class="hljs-string">"WeeklyCycle"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span> = bareos-sd Messages = Standard Pool = Incremental <span class="hljs-keyword"><span class="hljs-keyword">Priority</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span> Write Bootstrap = <span class="hljs-string"><span class="hljs-string">"/var/lib/bareos/%c.bsr"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> Pool = <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> Differential <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> Pool = Differential Incremental <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> Pool = Incremental }</code> </pre><br></div></div><br>  Job Description for Recovery: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/job/RestoreFiles.conf Job { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "RestoreFiles" <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Restore Client = vmware FileSet = "vm-ubuntu" Storage = bareos-sd Pool = Incremental Messages = Standard <span class="hljs-keyword"><span class="hljs-keyword">Where</span></span> = /tmp/ }</code> </pre><br>  Setting alerts: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/messages/Standard.conf Messages { <span class="hljs-type"><span class="hljs-type">Name</span></span> = Standard #     email mailcommand = "/usr/bin/bsmtp -h localhost -f \"\(Bareos\) \&lt;%r\&gt;\" -s \"Bareos: Intervention needed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> %j\" %r" <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> = root@localhost = mount #      mail = <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>@testdomain.com = alert,error,fatal,terminate, !skipped #       console = <span class="hljs-keyword"><span class="hljs-keyword">all</span></span>, !skipped, !saved # ,     , ..  append = "/var/log/bareos/bareos.log" = <span class="hljs-keyword"><span class="hljs-keyword">all</span></span>, !skipped #      catalog = <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> }</code> </pre><br>  The type of letter that comes will be displayed for clarity later. <br><br>  Pool Description: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/pool/<span class="hljs-keyword"><span class="hljs-keyword">Full</span></span>.conf Pool { <span class="hljs-type"><span class="hljs-type">Name</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> Pool <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Backup Recycle = yes AutoPrune = yes Volume Retention = <span class="hljs-number"><span class="hljs-number">365</span></span> days Maximum Volume Bytes = <span class="hljs-number"><span class="hljs-number">50</span></span>G Maximum Volumes = <span class="hljs-number"><span class="hljs-number">100</span></span> Label <span class="hljs-keyword"><span class="hljs-keyword">Format</span></span> = "Full-" } /etc/bareos/bareos-dir.d/pool/Incremental.conf Pool { <span class="hljs-type"><span class="hljs-type">Name</span></span> = Incremental Pool <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Backup Recycle = yes AutoPrune = yes Volume Retention = <span class="hljs-number"><span class="hljs-number">30</span></span> days Maximum Volume Bytes = <span class="hljs-number"><span class="hljs-number">1</span></span>G Maximum Volumes = <span class="hljs-number"><span class="hljs-number">100</span></span> Label <span class="hljs-keyword"><span class="hljs-keyword">Format</span></span> = "Incremental-" }</code> </pre><br>  We will not give the example of the Differential pool, since  even though it is listed in JobDefs, we will not use it. <br><br>  Schedule setting: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/schedule/WeeklyCycle.conf Schedule { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "WeeklyCycle" #    <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>    Run = <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> at <span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> #    <span class="hljs-number"><span class="hljs-number">31</span></span>         Run = <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-31</span></span> at <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> #  <span class="hljs-number"><span class="hljs-number">2</span></span>  <span class="hljs-number"><span class="hljs-number">31</span></span>   <span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>  <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>    Run = Incremental <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-31</span></span> at <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> Run = Incremental <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-31</span></span> at <span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> Run = Incremental <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-31</span></span> at <span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> }</code> </pre><br>  Description of the connection to the inventory: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-dir.d/<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>/File.conf <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span> { <span class="hljs-type"><span class="hljs-type">Name</span></span> = bareos-sd Address = localhost <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "wai2Aux0" Device = FileStorage Media <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = File }</code> </pre><br>  The settings for the inventory itself: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-sd.d/device/FileStorage.conf Device { <span class="hljs-type"><span class="hljs-type">Name</span></span> = FileStorage Media <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = File Archive Device = /opt/backup LabelMedia = yes; Random <span class="hljs-keyword"><span class="hljs-keyword">Access</span></span> = yes; AutomaticMount = yes; RemovableMedia = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span>; AlwaysOpen = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span>; }</code> </pre><br>  Parameters for connecting the store to the director: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-sd.d/director/bareos-dir.conf Director { <span class="hljs-type"><span class="hljs-type">Name</span></span> = bareos-dir <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "wai2Aux0" }</code> </pre><br>  Used alert options: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-sd.d/messages/Standard.conf Messages { <span class="hljs-type"><span class="hljs-type">Name</span></span> = Standard Director = bareos-dir = <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> } /etc/bareos/bareos-sd.d/<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>/bareos-sd.conf <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span> { <span class="hljs-type"><span class="hljs-type">Name</span></span> = bareos-sd Maximum Concurrent Jobs = <span class="hljs-number"><span class="hljs-number">20</span></span> }</code> </pre><br>  It is imperative that the server connects the plug-in, this is done in the following config: <br><br><pre> <code class="hljs objectivec">/etc/bareos/bareos-fd.d/client/myself.conf Client { Name = vmware Maximum Concurrent Jobs = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-meta"><span class="hljs-meta">#   Plugin Directory = /usr/lib64/bareos/plugins Plugin Names = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"python"</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br>  Connection to director: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-fd.d/director/bareos-dir.conf Director { <span class="hljs-type"><span class="hljs-type">Name</span></span> = bareos-dir <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "wai2Aux0" }</code> </pre><br>  Type of alerts sent to the director: <br><br><pre> <code class="hljs pgsql">/etc/bareos/bareos-fd.d/messages/Standard.conf Messages { <span class="hljs-type"><span class="hljs-type">Name</span></span> = Standard Director = bareos-dir = <span class="hljs-keyword"><span class="hljs-keyword">all</span></span>, !skipped, !restored }</code> </pre><br>  Forcibly in manual mode, perform a backup, for this we log in to bconsole <br><br><pre> <code class="hljs pgsql">*run Automatically selected Catalog: MyCatalog <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> Catalog "MyCatalog" A job <span class="hljs-type"><span class="hljs-type">name</span></span> must be specified. The defined Job resources are: <span class="hljs-number"><span class="hljs-number">1</span></span>: RestoreFiles <span class="hljs-number"><span class="hljs-number">2</span></span>: vm-ubuntu-backup-job <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> Job resource (<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>): <span class="hljs-number"><span class="hljs-number">2</span></span> Run Backup job JobName: vm-ubuntu-backup-job <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>: Incremental Client: vmware <span class="hljs-keyword"><span class="hljs-keyword">Format</span></span>: Native FileSet: vm-ubuntu Pool: Incremental (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Job IncPool override) <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span>: bareos-sd (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Job resource) <span class="hljs-keyword"><span class="hljs-keyword">When</span></span>: <span class="hljs-number"><span class="hljs-number">2016</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-14</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span> Priority: <span class="hljs-number"><span class="hljs-number">10</span></span> OK <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run? (yes/mod/<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>): yes</code> </pre><br>  With the message command, we can observe what is happening with the task, we see that the process started successfully: <br><br><pre> <code class="hljs sql">14-Nov 07:22 vmware JobId 66: python-fd: Starting <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> /VMS/ha-datacenter/ubuntu/[datastore1] ubuntu/ubuntu.vmdk_cbt.json <span class="hljs-number"><span class="hljs-number">14</span></span>-Nov <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> vmware JobId <span class="hljs-number"><span class="hljs-number">66</span></span>: python-fd: <span class="hljs-keyword"><span class="hljs-keyword">Starting</span></span> <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> /VMS/ha-datacenter/ubuntu/[datastore1] ubuntu/ubuntu.vmdk</code> </pre> <br>  During the execution of the task on the ESXi side, you can observe that in the message output console there will be corresponding notifications that the virtual machine disk is being accessed, and the temporary snapshot is deleted at the end. <br><br><img src="https://habrastorage.org/files/f9d/e81/714/f9de817147574fe99273d1ed14e3f294.png"><br><br><div class="spoiler">  <b class="spoiler_title">The incoming message looks like this:</b> <div class="spoiler_text"><pre> <code class="hljs sql">13-Nov 22:47 bareos-dir JobId 36: No prior Full <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> Job <span class="hljs-built_in"><span class="hljs-built_in">record</span></span> found. <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> bareos-dir JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> suitable <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> catalog. Doing <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span> backup. <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> bareos-dir JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> JobId <span class="hljs-number"><span class="hljs-number">36</span></span>, Job=vm-ubuntu-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span>-job<span class="hljs-number"><span class="hljs-number">.2016</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>_22<span class="hljs-number"><span class="hljs-number">.47</span></span><span class="hljs-number"><span class="hljs-number">.47</span></span>_04 <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> bareos-dir JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> Device <span class="hljs-string"><span class="hljs-string">"FileStorage"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> write. <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> bareos-sd JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: Volume <span class="hljs-string"><span class="hljs-string">"Full-0001"</span></span> previously written, moving <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> data. <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> bareos-sd JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: Ready <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> append <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Volume <span class="hljs-string"><span class="hljs-string">"Full-0001"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span>=<span class="hljs-number"><span class="hljs-number">583849836</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> vmware JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: python-fd: <span class="hljs-keyword"><span class="hljs-keyword">Starting</span></span> <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> /VMS/ha-datacenter/ubuntu/[datastore1] ubuntu/ubuntu.vmdk_cbt.json <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> vmware JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: python-fd: <span class="hljs-keyword"><span class="hljs-keyword">Starting</span></span> <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> /VMS/ha-datacenter/ubuntu/[datastore1] ubuntu/ubuntu.vmdk <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span> bareos-sd JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: Elapsed <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">04</span></span>:<span class="hljs-number"><span class="hljs-number">01</span></span>, Transfer rate=<span class="hljs-number"><span class="hljs-number">2.072</span></span> M <span class="hljs-keyword"><span class="hljs-keyword">Bytes</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">second</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span> bareos-dir JobId <span class="hljs-number"><span class="hljs-number">36</span></span>: Bareos bareos-dir <span class="hljs-number"><span class="hljs-number">16.2</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> (<span class="hljs-number"><span class="hljs-number">01</span></span>Jul16): <span class="hljs-keyword"><span class="hljs-keyword">Build</span></span> OS: x86_64-redhat-linux-gnu redhat CentOS Linux <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> <span class="hljs-number"><span class="hljs-number">7.0</span></span><span class="hljs-number"><span class="hljs-number">.1406</span></span> (Core) JobId: <span class="hljs-number"><span class="hljs-number">36</span></span> Job: vm-ubuntu-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span>-job<span class="hljs-number"><span class="hljs-number">.2016</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span>_22<span class="hljs-number"><span class="hljs-number">.47</span></span><span class="hljs-number"><span class="hljs-number">.47</span></span>_04 <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> (upgraded <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Incremental) <span class="hljs-keyword"><span class="hljs-keyword">Client</span></span>: <span class="hljs-string"><span class="hljs-string">"vmware"</span></span> <span class="hljs-number"><span class="hljs-number">16.2</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> (<span class="hljs-number"><span class="hljs-number">01</span></span>Jul16) x86_64-redhat-linux-gnu,redhat,CentOS Linux <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> <span class="hljs-number"><span class="hljs-number">7.0</span></span><span class="hljs-number"><span class="hljs-number">.1406</span></span> (Core) ,CentOS_7,x86_64 FileSet: <span class="hljs-string"><span class="hljs-string">"vm-ubuntu"</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-13</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> Pool: <span class="hljs-string"><span class="hljs-string">"Full"</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Job FullPool override) <span class="hljs-keyword"><span class="hljs-keyword">Catalog</span></span>: <span class="hljs-string"><span class="hljs-string">"MyCatalog"</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Client</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span>: <span class="hljs-string"><span class="hljs-string">"bareos-sd"</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Job <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span>) Scheduled <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov<span class="hljs-number"><span class="hljs-number">-2016</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov<span class="hljs-number"><span class="hljs-number">-2016</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">13</span></span>-Nov<span class="hljs-number"><span class="hljs-number">-2016</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span> Elapsed <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> mins <span class="hljs-number"><span class="hljs-number">1</span></span> sec <span class="hljs-keyword"><span class="hljs-keyword">Priority</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> FD Files Written: <span class="hljs-number"><span class="hljs-number">2</span></span> SD Files Written: <span class="hljs-number"><span class="hljs-number">2</span></span> FD <span class="hljs-keyword"><span class="hljs-keyword">Bytes</span></span> Written: <span class="hljs-number"><span class="hljs-number">499</span></span>,<span class="hljs-number"><span class="hljs-number">525</span></span>,<span class="hljs-number"><span class="hljs-number">599</span></span> (<span class="hljs-number"><span class="hljs-number">499.5</span></span> MB) SD <span class="hljs-keyword"><span class="hljs-keyword">Bytes</span></span> Written: <span class="hljs-number"><span class="hljs-number">499</span></span>,<span class="hljs-number"><span class="hljs-number">527</span></span>,<span class="hljs-number"><span class="hljs-number">168</span></span> (<span class="hljs-number"><span class="hljs-number">499.5</span></span> MB) Rate: <span class="hljs-number"><span class="hljs-number">2072.7</span></span> KB/s Software Compression: <span class="hljs-number"><span class="hljs-number">73.1</span></span> % (gzip) VSS: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Encryption: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Accurate: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Volume <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>(s): <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span><span class="hljs-number"><span class="hljs-number">-0001</span></span> Volume <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> Volume <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>: <span class="hljs-number"><span class="hljs-number">1479067525</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Last</span></span> Volume <span class="hljs-keyword"><span class="hljs-keyword">Bytes</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">083</span></span>,<span class="hljs-number"><span class="hljs-number">996</span></span>,<span class="hljs-number"><span class="hljs-number">610</span></span> (<span class="hljs-number"><span class="hljs-number">1.083</span></span> GB) Non-fatal FD <span class="hljs-keyword"><span class="hljs-keyword">errors</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> SD <span class="hljs-keyword"><span class="hljs-keyword">Errors</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> FD termination <span class="hljs-keyword"><span class="hljs-keyword">status</span></span>: OK SD termination <span class="hljs-keyword"><span class="hljs-keyword">status</span></span>: OK Termination: <span class="hljs-keyword"><span class="hljs-keyword">Backup</span></span> OK</code> </pre><br></div></div><br>  As you can see, the message indicates a successful backup, the type of backup Full, recorded 499.5 Mb (on the ESXi side, the vmdk file takes 560 M).  In the FileSet settings, we set the gzip compression type, which is also visible in the Software Compression line in this message. <br><br>  The error message will look like this.  In this example, as we can see, the error was modeled, if we did not activate the CBT mode for the VM, which we included in the previous steps using a special script. <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">14</span></span>-Nov <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span> vmware JobId <span class="hljs-number"><span class="hljs-number">39</span></span>: Fatal error: python-fd: Error VM VMBitrix5<span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> CBT enabled <span class="hljs-number"><span class="hljs-number">14</span></span>-Nov <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span> vmware JobId <span class="hljs-number"><span class="hljs-number">39</span></span>: Fatal error: fd_plugins.c:<span class="hljs-number"><span class="hljs-number">654</span></span> Command plugin "python:module_path=/usr/lib64/bareos/plugins/vmware_plugin:module_name=bareos-fd-vmware:dc=ha-datacenter:folder=/:vmname=VMBitrix5.1.8:vcserver=172.17.10.1:vcuser=bakuser:vcpass=kJo@#!a" requested, but <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> loaded. <span class="hljs-number"><span class="hljs-number">14</span></span>-Nov <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span> bareos-dir JobId <span class="hljs-number"><span class="hljs-number">39</span></span>: Error: Bareos bareos-dir <span class="hljs-number"><span class="hljs-number">16.2</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> (<span class="hljs-number"><span class="hljs-number">01</span></span>Jul16): Build OS: x86_64-redhat-linux-gnu redhat CentOS Linux <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> <span class="hljs-number"><span class="hljs-number">7.0</span></span><span class="hljs-number"><span class="hljs-number">.1406</span></span> (Core) JobId: <span class="hljs-number"><span class="hljs-number">39</span></span> Job: vm-bitrix-backup-job<span class="hljs-number"><span class="hljs-number">.2016</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-14</span></span>_01<span class="hljs-number"><span class="hljs-number">.17</span></span><span class="hljs-number"><span class="hljs-number">.51</span></span>_04 Backup <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> (upgraded <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Incremental) Client: "vmware" <span class="hljs-number"><span class="hljs-number">16.2</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span> (<span class="hljs-number"><span class="hljs-number">01</span></span>Jul16) x86_64-redhat-linux-gnu,redhat,CentOS Linux <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> <span class="hljs-number"><span class="hljs-number">7.0</span></span><span class="hljs-number"><span class="hljs-number">.1406</span></span> (Core) ,CentOS_7,x86_64 FileSet: "vm-bitrix-fileset" <span class="hljs-number"><span class="hljs-number">2016</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span><span class="hljs-number"><span class="hljs-number">-14</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span> Pool: "vm-bitrix-Full" (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Job FullPool override) Catalog: "MyCatalog" (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Client resource) <span class="hljs-keyword"><span class="hljs-keyword">Storage</span></span>: "bareos-sd" (<span class="hljs-keyword"><span class="hljs-keyword">From</span></span> Job resource) Scheduled <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span>-Nov<span class="hljs-number"><span class="hljs-number">-2016</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span>-Nov<span class="hljs-number"><span class="hljs-number">-2016</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span>-Nov<span class="hljs-number"><span class="hljs-number">-2016</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> Elapsed <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> sec Priority: <span class="hljs-number"><span class="hljs-number">10</span></span> FD Files Written: <span class="hljs-number"><span class="hljs-number">0</span></span> SD Files Written: <span class="hljs-number"><span class="hljs-number">0</span></span> FD Bytes Written: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> B) SD Bytes Written: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> B) Rate: <span class="hljs-number"><span class="hljs-number">0.0</span></span> KB/s Software Compression: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> VSS: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Encryption: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Accurate: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Volume <span class="hljs-type"><span class="hljs-type">name</span></span>(s): Volume <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span> Id: <span class="hljs-number"><span class="hljs-number">12</span></span> Volume <span class="hljs-keyword"><span class="hljs-keyword">Session</span></span> <span class="hljs-type"><span class="hljs-type">Time</span></span>: <span class="hljs-number"><span class="hljs-number">1479067525</span></span> Last Volume Bytes: <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> B) Non-fatal FD errors: <span class="hljs-number"><span class="hljs-number">1</span></span> SD Errors: <span class="hljs-number"><span class="hljs-number">0</span></span> FD termination status: Fatal Error SD termination status: Canceled Termination: *** Backup Error ***</code> </pre><br></div></div><br>  In accordance with our schedule in the directive Schedule {} director directive, 3 incremental backups were to be executed during the day (the last one in the Full backup list was made manually).  In bconsole, the ‚Äústatus dir‚Äù command allows you to see how much the size of incremental backups differs from the full backup: <br><br><img src="https://habrastorage.org/files/7d5/1d1/ece/7d51d1ecee744eb59fe08bf171014c70.png"><br><br>  As for the recovery, it can be performed immediately to the ESXi host, which is performed by default, but for this the virtual machine itself must be turned off.  Or you can restore to a server with BareOS.  Consider both options. <br><br><div class="spoiler">  <b class="spoiler_title">When restoring locally to a server with BareOS.</b>  <b class="spoiler_title">Go to bconsole:</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">*restore Automatically selected Catalog: MyCatalog Using Catalog <span class="hljs-string"><span class="hljs-string">"MyCatalog"</span></span> First you <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> one <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more JobIds that contain files <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be restored. You will be presented several methods <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> specifying the JobIds. <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> you will be allowed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> which files from those JobIds are <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be restored. <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> the JobIds, you have the following choices: <span class="hljs-number"><span class="hljs-number">1</span></span>: List last <span class="hljs-number"><span class="hljs-number">20</span></span> Jobs run <span class="hljs-number"><span class="hljs-number">2</span></span>: List Jobs where a given <span class="hljs-keyword"><span class="hljs-keyword">File</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> saved <span class="hljs-number"><span class="hljs-number">3</span></span>: Enter list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> comma separated JobIds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: Enter SQL list command <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> the most recent backup <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a client <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> backup <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a client before a specified <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: Enter a list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> files <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> restore <span class="hljs-number"><span class="hljs-number">8</span></span>: Enter a list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> files <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> restore before a specified <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>: Find the JobIds <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the most recent backup <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a client <span class="hljs-number"><span class="hljs-number">10</span></span>: Find the JobIds <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a backup <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a client before a specified <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>: Enter a list <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> directories <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> restore <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> found JobIds <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> full restore <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a specified Job date <span class="hljs-number"><span class="hljs-number">13</span></span>: Cancel <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> item: (<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span>): <span class="hljs-number"><span class="hljs-number">3</span></span> Enter JobId(s), comma separated, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> restore: <span class="hljs-number"><span class="hljs-number">66</span></span> Building directory tree <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> JobId(s) <span class="hljs-number"><span class="hljs-number">66</span></span> ... <span class="hljs-number"><span class="hljs-number">1</span></span> files inserted into the tree. You are now entering <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> selection mode where you add (mark) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> remove (unmark) files <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be restored. No files are initially added, unless you used the <span class="hljs-string"><span class="hljs-string">"all"</span></span> keyword <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the command <span class="hljs-literal"><span class="hljs-literal">line</span></span>. Enter <span class="hljs-string"><span class="hljs-string">"done"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> leave this mode. cwd <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>: / $ ls VMS/ $ mark * <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> marked. $ done Defined Clients: <span class="hljs-number"><span class="hljs-number">1</span></span>: vmware ... <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> the Client (<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">4</span></span>): <span class="hljs-number"><span class="hljs-number">1</span></span> Using Catalog <span class="hljs-string"><span class="hljs-string">"MyCatalog"</span></span> Client <span class="hljs-string"><span class="hljs-string">"bareos-fd"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. Automatically selected Client: vmware Restore Client <span class="hljs-string"><span class="hljs-string">"bareos-fd"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found. Automatically selected Client: vmware Run Restore job JobName: RestoreFiles Bootstrap: /var/lib/bareos/bareos-dir.restore.<span class="hljs-number"><span class="hljs-number">1</span></span>.bsr Where: /tmp/ Replace: Always FileSet: vm-ubuntu Backup Client: bareos-fd Restore Client: vmware Format: Native Storage: bareos-sd <span class="hljs-keyword"><span class="hljs-keyword">When</span></span>: <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">11</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span> Catalog: MyCatalog Priority: <span class="hljs-number"><span class="hljs-number">10</span></span> Plugin Options: *None* OK <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run? (yes/<span class="hljs-keyword"><span class="hljs-keyword">mod</span></span>/no): <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> Parameters <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> modify: <span class="hljs-number"><span class="hljs-number">1</span></span>: Level <span class="hljs-number"><span class="hljs-number">2</span></span>: Storage <span class="hljs-number"><span class="hljs-number">3</span></span>: Job <span class="hljs-number"><span class="hljs-number">4</span></span>: FileSet <span class="hljs-number"><span class="hljs-number">5</span></span>: Restore Client <span class="hljs-number"><span class="hljs-number">6</span></span>: Backup Format <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">When</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: Priority <span class="hljs-number"><span class="hljs-number">9</span></span>: Bootstrap <span class="hljs-number"><span class="hljs-number">10</span></span>: Where <span class="hljs-number"><span class="hljs-number">11</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">File</span></span> Relocation <span class="hljs-number"><span class="hljs-number">12</span></span>: Replace <span class="hljs-number"><span class="hljs-number">13</span></span>: JobId <span class="hljs-number"><span class="hljs-number">14</span></span>: Plugin Options <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> modify (<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span>): <span class="hljs-number"><span class="hljs-number">14</span></span> Please enter Plugin Options <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>: python:localvmdk=yes Run Restore job JobName: RestoreFiles Bootstrap: /var/lib/bareos/bareos-dir.restore.<span class="hljs-number"><span class="hljs-number">1</span></span>.bsr Where: /tmp/ Replace: Always FileSet: vm-ubuntu Backup Client: vmware Restore Client: vmware Format: Native Storage: bareos-sd <span class="hljs-keyword"><span class="hljs-keyword">When</span></span>: <span class="hljs-number"><span class="hljs-number">2016</span></span>-<span class="hljs-number"><span class="hljs-number">11</span></span>-<span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>:<span class="hljs-number"><span class="hljs-number">57</span></span> Catalog: MyCatalog Priority: <span class="hljs-number"><span class="hljs-number">10</span></span> Plugin Options: python:localvmdk=yes OK <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run? (yes/<span class="hljs-keyword"><span class="hljs-keyword">mod</span></span>/no): yes</code> </pre><br></div></div><br>  After that, you can go to the / tmp folder and see the restored vmdk file. <br><br><pre> <code class="hljs mel">cd /tmp/<span class="hljs-string"><span class="hljs-string">" [datastore1] ubuntu"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> ubuntu.vmdk</code> </pre><br>  Restoring directly to ESXi does not require making any edits before performing restore, but as stated earlier, you need to shut down the virtual machine before this, otherwise an error will occur: <br><br><pre> <code class="hljs vbscript">JobId <span class="hljs-number"><span class="hljs-number">80</span></span>: Fatal <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>: python-fd: <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> VM VMBitrix5<span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span> must be poweredOff <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> restore, but <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> poweredOn</code> </pre><br>  As a test, it is enough to create a couple of test files on the virtual machine, run Job on the backup.  Delete these files, turn off the machine, and restore via the restore command without making edits as in the previous example, as a rule, deleted files will be in the same place. <br><br>  Now consider the possibility of adding a backup for another VM, its name is ‚ÄúVMBitrix5.1.8‚Äù <br><br>  <b>Important!</b>  First, you need to connect the plug-ins for working with VMware in the settings of the director in the /etc/bareos/bareos-dir.d/director/bareos-dir.conf file, otherwise when connecting additional tasks for VM backup, you will receive an error about an unloaded plug-in: <br><br>  <b>Example:</b> <br><br><pre> <code class="hljs vbscript">JobId <span class="hljs-number"><span class="hljs-number">41</span></span>: Fatal <span class="hljs-keyword"><span class="hljs-keyword">error</span></span>: fd_plugins.c:<span class="hljs-number"><span class="hljs-number">654</span></span> Command plugin <span class="hljs-string"><span class="hljs-string">"python:module_path=/usr/lib64/bareos/plugins/vmware_plugin:module_name=bareos-fd-vmware:dc=ha-datacenter:folder=/:vmname="</span></span> requested, but <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> loaded</code> </pre><br>  Now the /etc/bareos/bareos-dir.d/director/bareos-dir.conf file should look like this: <br><br><pre> <code class="hljs pgsql">Director { # define myself <span class="hljs-type"><span class="hljs-type">Name</span></span> = "bareos-dir" QueryFile = "/usr/lib/bareos/scripts/query.sql" Maximum Concurrent Jobs = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> = "wai2Aux0" # Console <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> Messages = Standard Auditing = yes Plugin Directory = /usr/lib64/bareos/plugins Plugin Names = "python" }</code> </pre><br>  As you can see the lines below and connected the plugin: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Plugin</span></span> Directory = /usr/lib64/bareos/plugins Plugin Names = <span class="hljs-string"><span class="hljs-string">"python"</span></span></code> </pre><br>  Next, we proceed to editing the FileSet {} directive for backup of the second virtual machine <br><br><pre> <code class="hljs dos">/etc/bareos/bareos-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>.d/fileset/SelfTest.conf</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">After adding new lines for VMBitrix5.1.8 virtual machine backup, the file looks like this:</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">FileSet</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">Name</span></span> = <span class="hljs-string"><span class="hljs-string">"vm-ubuntu"</span></span> Include { <span class="hljs-section"><span class="hljs-section">Options</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">signature</span></span> = MD5 Compression = GZIP } Plugin = <span class="hljs-string"><span class="hljs-string">"python:module_path=/usr/lib64/bareos/plugins/vmware_plugin:module_name=bareos-fd-vmware:dc=ha-datacenter:folder=/:vmname=ubuntu:vcserver=172.17.10.1:vcuser=bakuser:vcpass=qLpE1QQv"</span></span> } } FileSet { <span class="hljs-attribute"><span class="hljs-attribute">Name</span></span> = <span class="hljs-string"><span class="hljs-string">"vm-bitrix"</span></span> Include { <span class="hljs-section"><span class="hljs-section">Options</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">signature</span></span> = MD5 Compression = GZIP } Plugin = <span class="hljs-string"><span class="hljs-string">"python:module_path=/usr/lib64/bareos/plugins/vmware_plugin:module_name=bareos-fd-vmware:dc=ha-datacenter:folder=/:vmname=VMBitrix5.1.8:vcserver=172.17.10.1:vcuser=bakuser:vcpass=kJo@#!a"</span></span> } }</code> </pre><br></div></div><br>  Moving on to adding a new Job for the backup of a new VM, create a file backup-bareos-bitrix.conf in the /etc/bareos/bareos-dir.d/job directory.  In this file we will write the parameters for the new Job (the group and the owner of all created files should be ‚Äúbareos‚Äù): <br><br><pre> <code class="hljs pgsql">Job { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "vm-bitrix-backup-job" Client = "vmware" <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Backup <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> = Incremental FileSet = "vm-bitrix" Schedule = "WeeklyCycle" Storage = bareos-sd Messages = Standard Pool = vm-bitrix-Incremental Priority = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Write</span></span> Bootstrap = "/var/lib/bareos/%c.bsr" <span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> Backup Pool = vm-bitrix-<span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> Incremental Backup Pool = vm-bitrix-Incremental }</code> </pre><br>  You also need to create a job to restore if necessary for the second VMBitrix5.1.8 virtual machine.  Create a file /etc/bareos/bareos-dir.d/job/restorefiles-vm-bitrix.conf. <br><br>  Its contents are: <br><br><pre> <code class="hljs pgsql">Job { <span class="hljs-type"><span class="hljs-type">Name</span></span> = "restorefiles-vm-bitrix" <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Restore Client = vmware FileSet = "vm-bitrix" Storage = bareos-sd Pool = vm-bitrix-Incremental Messages = Standard <span class="hljs-keyword"><span class="hljs-keyword">Where</span></span> = /tmp/ }</code> </pre><br>  Be sure to follow the correspondences between FileSet and Pool. <br><br>  As you can see, it is also necessary to create new pools.  Go to the /etc/bareos/bareos-dir.d/pool directory <br><br>  Create two files Full-vm-bitrix.conf and Incremental-vm-bitrix.conf.  Here is the content of each: <br><br><pre> <code class="hljs pgsql"># cat /etc/bareos/bareos-dir.d/pool/<span class="hljs-keyword"><span class="hljs-keyword">Full</span></span>-vm-bitrix.conf Pool { <span class="hljs-type"><span class="hljs-type">Name</span></span> = vm-bitrix-<span class="hljs-keyword"><span class="hljs-keyword">Full</span></span> Pool <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Backup Recycle = yes AutoPrune = yes Volume Retention = <span class="hljs-number"><span class="hljs-number">365</span></span> days Maximum Volume Bytes = <span class="hljs-number"><span class="hljs-number">50</span></span>G Maximum Volumes = <span class="hljs-number"><span class="hljs-number">100</span></span> Label <span class="hljs-keyword"><span class="hljs-keyword">Format</span></span> = "Full-vm-bitrix-" } # cat /etc/bareos/bareos-dir.d/pool/Incremental-vm-bitrix.conf Pool { <span class="hljs-type"><span class="hljs-type">Name</span></span> = vm-bitrix-Incremental Pool <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = Backup Recycle = yes AutoPrune = yes Volume Retention = <span class="hljs-number"><span class="hljs-number">30</span></span> days Maximum Volume Bytes = <span class="hljs-number"><span class="hljs-number">1</span></span>G Maximum Volumes = <span class="hljs-number"><span class="hljs-number">100</span></span> Label <span class="hljs-keyword"><span class="hljs-keyword">Format</span></span> = "Incremental-vm-bitrix-" }</code> </pre><br>  Again, as in the previous steps, you need to activate CBT for the second VM via the vmware_cbt_tool script <br><br>  After making any changes to the config, it is necessary to restart the services: <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> bareos-fd systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> bareos-dir</code> </pre><br>  If there are no errors, you can go back to the bconsole console and see the added jobs for the new VM <br><br>  New Job List: <br><br><img src="https://habrastorage.org/files/9bf/002/2c0/9bf0022c098d4d4585c81e7da00b706a.png"><br><br>  Run a new task: <br><br><img src="https://habrastorage.org/files/1a1/8b7/dda/1a18b7ddaca74bc4bb82557d007e4414.png"><br><br>  Partial output of the ‚Äústatus dir‚Äù command after a successful backup: <br><br><img src="https://habrastorage.org/files/fc4/ea9/43c/fc4ea943cbfa4f3a8c6f0a330abbe376.png"><br><br>  As for the recovery of the second virtual machine, it is no different from the recovery example of the first one.  Adding additional tasks for backup of additional VM is similar to adding a task for backup of the second VM. <br><br> <a href="https://www.sim-networks.com/protected-cloud%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink"><img src="https://habrastorage.org/files/c2e/22e/3bd/c2e22e3bd22c4a0985f83c601d0394f4.png"></a> <br><br><hr><br>  <a href="https://www.sim-networks.com/protected-cloud%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink">SIM-CLOUD - Fail-safe cloud in Germany</a> <br><br>  <a href="https://www.sim-networks.com/dedicated-custom%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink">Dedicated servers in reliable data centers in Germany!</a> <br>  Any configuration, quick build and free installation </div><p>Source: <a href="https://habr.com/ru/post/315402/">https://habr.com/ru/post/315402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315388/index.html">Hacker Record: Albert Gonzalez. 20 years in prison and 170 million stolen credit cards</a></li>
<li><a href="../315390/index.html">Dispel the myths that the founders do not respond with their property on debts LLC</a></li>
<li><a href="../315392/index.html">Development of dynamic REST services on document-oriented DB Bagri</a></li>
<li><a href="../315394/index.html">Even in an IT company, personal qualities and interpersonal skills are an integral part of the team player.</a></li>
<li><a href="../315400/index.html">Constantly invest in your education</a></li>
<li><a href="../315404/index.html">We invite you to a meeting with practitioners defenders of ASU-TP</a></li>
<li><a href="../315406/index.html">Implementing a pull-down interface in an iOS application</a></li>
<li><a href="../315408/index.html">Zvooq filed a lawsuit for $ 29 million to the ‚Äúlargest Russian public corporation‚Äù - ‚ÄúYandex‚Äù</a></li>
<li><a href="../315410/index.html">Bilateral data binding with ECMAScript-2015 without proxy</a></li>
<li><a href="../315414/index.html">Pro web client 1C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>