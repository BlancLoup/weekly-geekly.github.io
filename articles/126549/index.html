<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a banned information flow. 257 threads</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the first article in a series of articles on creating prohibited information flows (PIs). The ideas of organizing these PIs are not invented h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a banned information flow. 257 threads</h1><div class="post__text post__text-html js-mediator-article">  This is the first article in a series of articles on creating prohibited information flows (PIs).  The ideas of organizing these PIs are not invented here or by me.  I was only able to implement utilities that demonstrate these vulnerabilities for educational purposes. <br><br>  In this article I will talk about the organization of the information flow, based on the change by one of the applications of its state of the survey by another application of the state of the first.  With this model of interaction, one listener may have several listeners.  In future articles, both the interaction environments of the programs and the information exchange algorithms will be different. <a name="habracut"></a><br><br>  So, to the code!  First we need an array with the identifiers of an additional 256 threads.  Until threads are created, identifiers are made equal to zero. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_THREADS 256 pthread_t threads[MAX_THREADS];</span></span></code> </pre> <br>  Let's declare a couple of variables in which we will store information about the current number of threads and the necessary number of threads in the next step: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> todayThreads = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tomorrowThreads = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  Now look at the function to which all newly created threads will be sent: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">funcParallel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> threadIndex = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)p; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { usleep(<span class="hljs-number"><span class="hljs-number">200</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (threadIndex + <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; tomorrowThreads) { pthread_exit(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } } }</code> </pre> <br>  Now we will build a function that makes the number of running threads equal to the given one: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeNumThreads</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num)</span></span></span><span class="hljs-function"> </span></span>{ tomorrowThreads = num; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tomorrowThreads &gt; todayThreads) { <span class="hljs-comment"><span class="hljs-comment">// Creating new threads for (int i = todayThreads; i &lt; tomorrowThreads; i++) pthread_create(threads+i, NULL, funcParallel, (void*)i); } else if (tomorrowThreads &lt; todayThreads) { void * status; // Waiting for killing threads pthread_join(threads[tomorrowThreads], &amp;status); } todayThreads = tomorrowThreads; }</span></span></code> </pre> <br>  Now let's do the main function.  Let, when launching a program without a parameter, the program will be the transferor and tell us its process identifier.  And when started with a parameter, it reads the identifier of the process of the sending program from the parameter and tries to receive data from it.  In other words, first run without parameters, see the PID.  We launch the second copy of the program with the parameter equal to the PID seen. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argv[])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pid = getpid(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc == <span class="hljs-number"><span class="hljs-number">1</span></span>) { runSender(pid); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc == <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"%d"</span></span>, &amp;pid); runReceiver(pid); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Usage: unichat [PID]\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Examples: unichat\n"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">" unichat 2790\n"</span></span>); } }</code> </pre> <br>  Now we will look at the code of the transmitting function <i>runSender ()</i> .  It prints the PID, then reading one character from the standard input stream, changes the number of threads to the number equal to the code of the character read, waits 1000 microseconds, makes the number of threads equal to zero and waits again. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runSender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Sender PID = %d\n"</span></span>, pid); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch = getchar(); changeNumThreads(ch); usleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>); changeNumThreads(<span class="hljs-number"><span class="hljs-number">0</span></span>); usleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>); } }</code> </pre> <br>  It remains to see the code of the receiving party.  It is somewhat more complicated.  It monitors the number of threads in a particular application and remembers the maximum amount encountered.  As soon as the number of threads becomes 0 (without taking into account the main thread) - it prints a symbol, the code of which is equal to the maximum seen value of threads.  After printing, the memorized maximum number of threads is reset. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runReceiver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Receive from PID = %d\n"</span></span>, pid); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> line[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> filename[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>(filename, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(filename), <span class="hljs-string"><span class="hljs-string">"/proc/%d/status"</span></span>, pid); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxThreads = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> threads = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { usleep(<span class="hljs-number"><span class="hljs-number">200</span></span>); FILE * f = fopen(filename, <span class="hljs-string"><span class="hljs-string">"rt"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't open file %s, error: %d!\n"</span></span>, filename, errno); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!feof(f)) { <span class="hljs-built_in"><span class="hljs-built_in">fscanf</span></span>(f, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, line); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (feof(f)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(line, <span class="hljs-string"><span class="hljs-string">"Threads:"</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fscanf</span></span>(f, <span class="hljs-string"><span class="hljs-string">"%d"</span></span>, &amp;threads); threads--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((threads == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (maxThreads != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%c"</span></span>, maxThreads); fflush(<span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span>); maxThreads = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (threads &gt; maxThreads) maxThreads = threads; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } fclose(f); } }</code> </pre> <br>  <i>So here's what happens:</i> <br>  1. Run the program without parameters <br>  2. See the number on the screen, for example <b>1234</b> <br>  3. Run the program with the parameter <b>1234</b> <br>  4. In the first program, press the 'a' button <br>  5. The number of threads in the process of <b>1234</b> becomes 'a' + 1 = 98 <br>  6. The host program observes an increase in the number of threads (this is recorded in the file / proc / <b>1234</b> / status) <br>  7. The host records a maximum value of 98 <br>  8. Transmission program kills all threads except the main one) <br>  9. The receiving program fixes the number of threads = 1 (main) <br>  10. The host program prints the symbol with the code 98-1 = 97 = 'a'. <br><br>  Findings: <br>  Thus, there is a transfer of data from a process with <i>a</i> higher level of secrecy to a process with a lower level of secrecy.  The ability to exchange is based on the ability of one process to track the state of another process without any restrictions on the level of secrecy. </div><p>Source: <a href="https://habr.com/ru/post/126549/">https://habr.com/ru/post/126549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126541/index.html">Using thermal scanners to steal PIN codes</a></li>
<li><a href="../126542/index.html">The history of the creation of a network game on the ZX Spectrum</a></li>
<li><a href="../126543/index.html">Future Lisp</a></li>
<li><a href="../126546/index.html">Learn Ruby The Hard Way</a></li>
<li><a href="../126548/index.html">Admission to the department of information security in Moscow State Technical University named after NE Bauman through the program ‚ÄúStep into the Future. Moscow"</a></li>
<li><a href="../126551/index.html">CBS or a simplified view of styling and writing scripts in your projects</a></li>
<li><a href="../126552/index.html">Books about motivation: read between the lines</a></li>
<li><a href="../126554/index.html">Bulk import of panels from the module</a></li>
<li><a href="../126556/index.html">JodaTime - learn materiel, or the importance of nouns</a></li>
<li><a href="../126557/index.html">Infographics: Linux before and now</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>