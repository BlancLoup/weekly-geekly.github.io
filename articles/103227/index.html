<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming Pololu 3pi on Ubuntu / Debian, for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You just purchased a robot from Pololu and use Linux Ubuntu or Debian as the operating system, then this article is for you. First of all, the article...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming Pololu 3pi on Ubuntu / Debian, for beginners</h1><div class="post__text post__text-html js-mediator-article"><img src="http://taba.ru/id9/file/1344" alt="image">  You just purchased a robot from Pololu and use Linux Ubuntu or Debian as the operating system, then this article is for you.  First of all, the article is intended for beginners who decide to try themselves in robotics. <br><br>  To begin with, they brought me a similar robot, or rather Pololu 3pi, and I began to study what kind of animal it is.  From the store, a demo program was stitched into it, with which it was possible to check all the functions of the device.  And he knew how to flash LEDs, rotate engines, play a classic melody through his buzzer, display text on a two-line display of 8 characters per line and finally recognize black areas under the sensors on the bottom of the device (for example, black tracks on a white background). which can move). <br><a name="habracut"></a><br>  After studying the functionality of the device, the following thought arose: "But let's write our program into it."  And then the next question was how to do it on Linux Ubuntu.  The official site <a href="http://www.pololu.com/">www.pololu.com</a> , foreign forums and the study of the sources of downloaded libraries helped a lot in this issue. <br>  Now briefly tell you how and what to do to write your program to this device.  Immediately I will clarify that for programming Pololu, besides the device itself, a special programmer with a USB interface is needed to connect to a computer.  I used PGM03A - a wonderful and inexpensive programmer for microcontrollers based on AVR, including our ATMega328P. <br>  We will write programs in C, but you can also write in C ++, for this you need to use the appropriate compiler and libraries.  To begin with, we put the compiler, additional libraries and utilities using the ‚Äúsudo apt-get install‚Äù: <br><br>  gcc-avr - source code compiler in the machine code of AVR controllers, if you are writing in C ++ you need to install the appropriate compiler and libraries; <br>  avr-libs - AVR libraries for the C language; <br>  avra - the assembler, is necessary as a part of AVR-GCC for receiving the assembler code; <br>  binutils-avr - additional utilities for building programs; <br>  avrdude is a utility for recording the assembled binary hex file through the programmer in the AVR controllers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      These are all the libraries that are needed to build and write binary hex files to the AVR controller.  Now you need to collect and write to the controller the simplest program. <br>  For example, consider the following code written in C, it will cycle on and off the red Pololu 3 pi LED.  The example was taken from the official site <a href="http://www.pololu.com/">www.pololu.com</a> and will work correctly only with an ATMega328P microcontroller. <br><br> <code>#define F_CPU 20000000UL // Baby Orangutan frequency (20MHz) <br> #include <br> #include <br> void delayms( uint16_t millis ) { <br> while ( millis ) { <br> _delay_ms( 1 ); <br> millis--; <br> } <br> } <br> <br> int main( void ) { <br> DDRD |= 1 &lt;&lt; DDD1; // set LED pin PD1 to output <br> while ( 1 ) { <br> PORTD &amp;= ~( 1 &lt;&lt; PORTD1 ); // LED off <br> delayms( 900 ); // delay 900 ms <br> PORTD |= 1 &lt;&lt; PORTD1; // LED on <br> delayms( 100 ); // delay 100 ms <br> } <br> return 0; <br> } <br></code> <br>  This code snippet needs to be placed in the BlinkLed.c file.  The file extension "* .c" says that we have the source code written in the C language. Now we compile the file into machine code, for this we go to the working directory with the BlinkLed.c file and execute the following command: <br><br> <code>$ avr-gcc -g -Wall -mcall-prologues -mmcu=atmega328p -Os -c -o BlinkLed.o BlinkLed.c <br></code> <br>  And at the output we get the file BlinkLed.o with the object code.  An object code is an executable code with some interspersions of additional information for the linker, for example, a symbol table.  At this step, your program has already been assembled, it remains to combine it with other object modules of the linker (if you use them) and collect a binary file with the extension * .hex, the data of which we will write to the microprocessor.  In the console, you need to run the following commands: <br><br> <code>$ avr-gcc -g -Wall -mcall-prologues -mmcu=atmega328p -Os BlinkLed.o -Wl,-gc-sections -lpololu_atmega328p -Wl,-relax -o BlinkLed.obj <br> $ avr-objcopy -R .eeprom -O ihex BlinkLed.obj BlinkLed.hex <br></code> <br>  A file BlinkLed.hex appeared in the directory with commands for the ATMega328P microcontroller, which now need to be flashed into it.  But first you need to know in which device to send commands.  To do this, we need to connect a programmer to the computer and find new devices in the / dev directory.  In my case, 2 new devices appeared: / dev / ttyACM0 and / dev / ttyACM1.  Now we connect the microcontroller to the programmer and execute the command for the corresponding device (the device must be turned on and the batteries must be enough for the duration of the firmware process): <br> <code>$ avrdude -c avrispv2 -p m328p -P /dev/ttyACM0 -e <br> <br>     . <br> avrdude: AVR device initialized and ready to accept instructions <br> Reading | |||||||||||||||||||||||||||||||||||||||||||||| | 100% 0.01s <br> avrdude: Device signature = 0x1e654f <br> avrdude: erasing chip <br> avrdude: safemode: Fuses OK <br> avrdude done. Thank you. <br></code> <br>  If you saw the response from the device, then the connection test actually passed and now you can safely flash our prepared instructions.  Perform in the console: <br><br> <code>$ avrdude -p m328p -c avrisp2 -P /dev/ttyACM0 -U flash:w:BlinkLed.hex <br></code> <br>  After a few seconds, the instructions in the device will be successfully flashed, the controller will automatically restart and you will see how Pololu 3pi actively winks at you with its LED.  To automate the process of building an application, you can write a Makefile. <br>  We learned how to flash the microcontroller from the source code written in C, now for more comfortable work with the device, you need to connect the Pololu library, which already has low-level operations for controlling the components of the robot.  We download the latest version of the library from the official website <a href="http://www.pololu.com/">www.pololu.com</a> , at the time of this writing, the library is available at <a href="http://www.pololu.com/docs/0J20/3">www.pololu.com/docs/0J20/3</a> . <br><br> <code><a href=""></a> $ wget www.pololu.com/file/download/libpololu-avr-100607.zip?file_id=0J381 <br></code> <br>  Unpack: <br><br> <code>$ unzip libpololu-avr-yymmdd.zip,  ¬´yymmdd¬ª      . <br></code> <br>  Go to the root directory with the unpacked library and execute the "make" command to build the packages.  After assembly, it remains to put it, but then a couple of surprises awaited me.  First you need to open the file "Makefile", find 2 lines: <br><br> <code># LIB := /usr/lib/avr/lib <br> # INCLUDE_POLOLU := /usr/lib/avr/include <br></code> <br>  And uncomment them, check the existence of directories on your system and change them if necessary.  After that, you can run the ‚Äúsudo make install‚Äù command to install the library.  At the same time, packages with the extension ‚Äú* .a‚Äù for different versions of microcontrollers should be copied to ‚Äú/ usr / lib / avr / lib‚Äù and to the ‚Äú/ usr / lib / avr / include‚Äù header files ‚Äúpopolu / *. H‚Äù for connection required library functionality. <br>  There was a second surprise waiting for me, the header files were copied to the directory specified in ‚ÄúNCLUDE_POLOLU‚Äù, that is, to ‚Äú/ usr / lib / avr / include‚Äù, although they are searched in the directory ‚Äú/ usr / lib / avr / include / pololu‚Äù.  The problem was solved by creating the ‚Äú/ usr / lib / avr / include / pololu‚Äù directory and re-copying all the ‚Äúpololu / *. H‚Äù files into it. <br>  Finally, we will write another small program to secure the material, using the Pololu library.  To do this, we will connect the library at the beginning of the program file by writing such a line "#include &lt;pololu / 3pi.h&gt;".  Below I place the code with comments, which must be placed in the file "MyRobot.c".  As you can see, the code turned out to be less, but we used much more functionality: <br><br> <code>#include &lt;pololu/3pi.h&gt; //  Pololu <br> #include &lt;stdlib.h&gt; //      <br> int main() <br> { <br> print("Hello :)"); //    <br> lcd_goto_xy(0,1); //      <br> int val; <br> while(1) <br> { <br> green_led(0); //    <br> red_led(0); //    <br> val = random()%3; //     {0,1,2} <br> if(val == 0) { <br> green_led(1); //    <br> red_led(1); //    <br> } <br> delay_ms(1000); // 1  <br> } <br> } <br></code> <br>  To automatically build and flash the program, we will create a special Makefile in which you need to place the following text, all indents should be saved as 1 tab from the beginning of the line: <br><br><pre> DEVICE = atmega328p
 AVRDUDE_DEVICE = m328p
 CFLAGS = -g -Wall -mcall-prologues -mmcu = $ (DEVICE) -Os
 CC = avr-gcc
 OBJ2HEX = avr-objcopy 
 LDFLAGS = -Wl, -gc-sections -lpololu _ $ (DEVICE) -Wl, -relax
 PORT = / dev / ttyACM0
 AVRDUDE = avrdude
 TARGET = MyRobot
 all: $ (TARGET) .hex
 clean:
	 rm -f * .o * .hex * .obj * .hex
 % .hex:% .obj
	 $ (OBJ2HEX) -R .eeprom -O ihex $ &lt;$ @
 % .obj:% .o
	 $ (CC) $ (CFLAGS) $ &lt;$ (LDFLAGS) -o $ @
 install: $ (TARGET) .hex
 	 $ (AVRDUDE) -p $ (AVRDUDE_DEVICE) -c avrisp2 -P $ (PORT) -U flash: w: $ (TARGET) .hex
</pre><br><br>  Now, to build the program, just type the ‚Äúmake‚Äù command, and for flashing it to the device, respectively, ‚Äúmake install‚Äù. <br>  It is time to go through numerous examples that you find in the unpacked library files, and already compiled hex files are in the same place, if you suddenly have problems with the compiler.  As an IDE for writing C source code, I use NetBeans with the C / C ++ plugin installed. <br><br>  Thanks for attention.  I would be grateful if you report inaccuracies and errors in the article. </div><p>Source: <a href="https://habr.com/ru/post/103227/">https://habr.com/ru/post/103227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../103216/index.html">ViewPad 7, a new tablet from ViewSonic</a></li>
<li><a href="../103218/index.html">Asterisk for home</a></li>
<li><a href="../103220/index.html">SWRUS-KIEV 2010: Internet business to be discussed on September 25, 26 near Kiev</a></li>
<li><a href="../103221/index.html">Understand Objective C: Calling Methods</a></li>
<li><a href="../103223/index.html">We build, or we will wait?</a></li>
<li><a href="../103228/index.html">Criticism Yes Lectures ‚Ññ2 "Diary entries¬ª (Yota)</a></li>
<li><a href="../103229/index.html">Bioinformatics in St. Petersburg</a></li>
<li><a href="../103233/index.html">Turn your idea into a business</a></li>
<li><a href="../103234/index.html">Social networks of Russia - free classmates</a></li>
<li><a href="../103235/index.html">Greplin: personal search for all social services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>