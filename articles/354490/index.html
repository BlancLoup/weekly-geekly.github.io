<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configure VPN server (GRE / IPSec StrongSwan, OSPF Quagga)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Who would have thought that deploying some of the company's servers at Amazon was a bad idea. 

 As a result, the task is to make an additional VPN tu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configure VPN server (GRE / IPSec StrongSwan, OSPF Quagga)</h1><div class="post__text post__text-html js-mediator-article">  Who would have thought that deploying some of the company's servers at Amazon was a bad idea. <br><br>  As a result, the task is to make an additional VPN tunnel between Amazon and infrastructure in the Russian Federation. <br><br><img src="https://habrastorage.org/webt/tl/se/cb/tlsecb-sfqcahuzmnrdil0uhwye.png" alt="image"><br><a name="habracut"></a><br>  In addition to a simple how-to describe a few features in the configuration that can be encountered. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li><h2>  Configuring firewall and routing </h2><br>  We buy a VPS hoster from an <i>as</i> yet unblocked for an amount equivalent to 10,000 Mongolian MNT per month, we put CentOS 7, we include packet forwarding <br><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> net.ipv4.ip_forward=1 &gt;&gt;/etc/sysctl.d/ipv4.forward.enable.conf sysctl -a</code> </pre> <br>  Add in the firewall rules for receiving IPsec packets <br><br><pre> <code class="bash hljs">firewall-cmd --zone=dmz --permanent --add-rich-rule=<span class="hljs-string"><span class="hljs-string">'rule protocol value="esp" accept'</span></span> firewall-cmd --zone=dmz --permanent --add-port=500/udp firewall-cmd --zone=dmz --permanent --add-port=4500/udp firewall-cmd --permanent --add-service=<span class="hljs-string"><span class="hljs-string">"ipsec"</span></span> firewall-cmd --reload firewall-cmd --list-all</code> </pre> <br></li><li><h2>  StrongSwan setup </h2><br>  Install the IPsec StrongSwan daemon: <br><br><pre> <code class="bash hljs">yum install -y epel-release yum install -y strongswan</code> </pre><br>  Making the preliminary settings in <b>/etc/strongswan.d/charon.conf</b> : <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">charon</span></span> { <span class="hljs-comment"><span class="hljs-comment">#     Cisco IKEv2 make_before_break = yes #      install_routes = no }</span></span></code> </pre> <br>  Setting Strongswan can be done in two ways. <br><br><ul><li><h3>  The old way using the strongswan daemon is already quite well described: </h3><br>  configuration file <br><br>  <b>/etc/strongswan/ipsec.conf</b> <br><br>  File with passwords and certificates: <br><br>  <b>/etc/ipsec.secrets</b> <br><br>  Stop Service: <br><br><pre> <code class="bash hljs">systemctl stop strongswan</code> </pre> <br></li><li><h3>  A new way using the charon daemon, which appeared in version 5.2.0: </h3><br>  The whole configuration is stored in <b>/etc/strongswan/swanctl/swanctl.conf</b> <br><br>  Consider two options for setting up the <b>charon</b> daemon: <br><br><ol><li><h4>  Same authentication and encryption settings for everyone.  Let's make only PSK different: </h4><br><pre> <code class="hljs pgsql">connections { ToWorld { local_addrs = <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> version = <span class="hljs-number"><span class="hljs-number">1</span></span> proposals = aes256-sha1-modp1536 reauth_time = <span class="hljs-number"><span class="hljs-number">1440</span></span>m <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> { auth = psk } remote { auth = psk } children { ToWorld<span class="hljs-number"><span class="hljs-number">-1</span></span> { local_ts = dynamic[gre] remote_ts = dynamic[gre] mode = transport esp_proposals = aes128-sha1-modp1536 rekey_time = <span class="hljs-number"><span class="hljs-number">60</span></span>m start_action = trap dpd_action = <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> } } } } secrets { ike-<span class="hljs-keyword"><span class="hljs-keyword">To</span></span><span class="hljs-number"><span class="hljs-number">-2951</span></span> { id = <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> secret = "etokto2ttakoimohnatenkyi" } ike-<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>-CSR1000V { id = <span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> secret = "zdorovkakzhiznkasampro100klass" } }</code> </pre> <br></li><li><h4>  Individual authentication and encryption settings: </h4><br><pre> <code class="hljs pgsql">connections { To2951 { encap = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> remote_addrs = <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> version = <span class="hljs-number"><span class="hljs-number">1</span></span> proposals = aes256-sha1-modp1536 reauth_time = <span class="hljs-number"><span class="hljs-number">1440</span></span>m fragmentation = yes <span class="hljs-keyword"><span class="hljs-keyword">local</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> { auth = psk id = <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> } remote<span class="hljs-number"><span class="hljs-number">-1</span></span> { auth = psk } children { To2951<span class="hljs-number"><span class="hljs-number">-1</span></span> { local_ts = <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span>[gre] remote_ts = <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span>[gre] mode = transport esp_proposals = aes128-sha1-modp1536 rekey_time = <span class="hljs-number"><span class="hljs-number">60</span></span>m start_action = <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> dpd_action = <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> } } } ToCSR1000V { encap = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> remote_addrs = <span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> version = <span class="hljs-number"><span class="hljs-number">1</span></span> proposals = aes256-sha1-modp1536 reauth_time = <span class="hljs-number"><span class="hljs-number">1440</span></span>m fragmentation = yes <span class="hljs-keyword"><span class="hljs-keyword">local</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> { auth = psk id = <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> } remote<span class="hljs-number"><span class="hljs-number">-1</span></span> { auth = psk } children { ToCSR1000V<span class="hljs-number"><span class="hljs-number">-1</span></span> { local_ts = <span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span>[gre] remote_ts = <span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span>[gre] mode = transport esp_proposals = aes128-sha1-modp1536 rekey_time = <span class="hljs-number"><span class="hljs-number">60</span></span>m start_action = <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> dpd_action = <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> } } } } secrets { ike-<span class="hljs-keyword"><span class="hljs-keyword">To</span></span><span class="hljs-number"><span class="hljs-number">-2951</span></span> { id<span class="hljs-number"><span class="hljs-number">-1</span></span> = <span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> secret = "etokto2ttakoimohnatenkyi" } ike-<span class="hljs-keyword"><span class="hljs-keyword">To</span></span>-CSR1000V { id<span class="hljs-number"><span class="hljs-number">-1</span></span> = <span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> secret = "zdorovkakzhiznkasampro100klass" } }</code> </pre></li></ol></li></ul><br>  Turn on the service <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> strongswan-swanctl sudo systemctl start strongswan-swanctl</code> </pre><br></li><li><h2>  Lifting Tunnels with Cisco Routers </h2><br><ul><li><h3>  We configure GRE tunnels in CentOS </h3><br>  Create <code>/etc/sysconfig/network-scripts/ifcfg-Tunnel13</code> <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">NAME</span></span>=Tunnel13 DEVICE=Tunnel13 ONBOOT=yes STARTMODE=onboot BOOTPROTO=<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span>=GRE PEER_OUTER_IPADDR=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> PEER_INNER_IPADDR=<span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.130</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> MY_INNER_IPADDR=<span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.130</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> MY_OUTER_IPADDR=<span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-type"><span class="hljs-type">ZONE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">trusted</span></span> TTL=<span class="hljs-number"><span class="hljs-number">30</span></span> MTU=<span class="hljs-number"><span class="hljs-number">1400</span></span></code> </pre><br>  Create <code>/etc/sysconfig/network-scripts/ifcfg-Tunnel23</code> <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">NAME</span></span>=Tunnel23 DEVICE=Tunnel23 ONBOOT=yes STARTMODE=onboot BOOTPROTO=<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span>=GRE PEER_OUTER_IPADDR=<span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> PEER_INNER_IPADDR=<span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.230</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> MY_INNER_IPADDR=<span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.230</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> MY_OUTER_IPADDR=<span class="hljs-number"><span class="hljs-number">10.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-type"><span class="hljs-type">ZONE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">trusted</span></span> TTL=<span class="hljs-number"><span class="hljs-number">30</span></span> MTU=<span class="hljs-number"><span class="hljs-number">1400</span></span></code> </pre><br>  There are a couple of features in configuring GRE interfaces. <br><br>  The first is to reduce the MTU for correct packet passing. <br><br>  The second is to specify TTL, this will be needed in the future when we configure OSPF.  If this is not done, OSPF packets will arrive at the remote host with a TTL of one (due to GRE over IPsec), remaining unanswered.  Accordingly, the devices will hang in the INIT / DROTHER state, we will not wait for connectivity.  However, the correct ICMP responses can be confusing. <br><br>  We lift interfaces <br><br><pre> <code class="bash hljs">ifup Tunnel13 ifup Tunnel23</code> </pre><br></li><li><h3>  We create the tunnel on Cisco 2951 </h3><br><pre> <code class="python hljs">crypto keyring StrongSwanKeyring pre-shared-key address <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> key etokto2ttakoimohnatenkyi crypto isakmp policy <span class="hljs-number"><span class="hljs-number">60</span></span> encr aes <span class="hljs-number"><span class="hljs-number">256</span></span> authentication pre-share group <span class="hljs-number"><span class="hljs-number">5</span></span> crypto isakmp identity address crypto isakmp profile StrongSwanIsakmpProfile keyring StrongSwanKeyring match identity address <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> crypto ipsec transform-set StrongSwanTransformSet esp-aes esp-sha-hmac mode transport crypto ipsec profile StrongSwanIpsecProfile set transform-set StrongSwanTransformSet set pfs group5 set isakmp-profile StrongSwanIsakmpProfile interface Tunnel13 ip address <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.130</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> tunnel source GigabitEthernet2 tunnel destination <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> tunnel protection ipsec profile StrongSwanIpsecProfile</code> </pre><br></li><li><h3>  Create a tunnel on the Cisco CSR1000V </h3><br><pre> <code class="python hljs">crypto keyring StrongSwanKeyring pre-shared-key address <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> key etokto2ttakoimohnatenkyi crypto isakmp policy <span class="hljs-number"><span class="hljs-number">60</span></span> encr aes <span class="hljs-number"><span class="hljs-number">256</span></span> authentication pre-share group <span class="hljs-number"><span class="hljs-number">5</span></span> crypto isakmp identity address crypto isakmp profile StrongSwanIsakmpProfile keyring StrongSwanKeyring match identity address <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> crypto ipsec transform-set StrongSwanTransformSet esp-aes esp-sha-hmac mode transport crypto ipsec profile StrongSwanIpsecProfile set transform-set StrongSwanTransformSet set pfs group5 set isakmp-profile StrongSwanIsakmpProfile interface Tunnel23 ip address <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.230</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> tunnel source GigabitEthernet2 tunnel destination <span class="hljs-number"><span class="hljs-number">3.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> tunnel protection ipsec profile StrongSwanIpsecProfile</code> </pre> <br></li></ul><br>  We check that the tunnels have risen, encryption is working. <br><br>  On CentOS <br><br><pre> <code class="bash hljs">strongswan statusall</code> </pre> <br>  On cisco <br><br><pre> <code class="bash hljs">show crypto session detail</code> </pre> <br></li><li><h2>  Configure Dynamic Routing on Quagga </h2><br>  If you are using OSPF-based dynamic routing, then the next step would be to raise the OSPF daemon on CentOS, setting up new tunnels as a backup route. <br><br><ul><li><h3>  Configure OSPF on CentOS </h3><br>  As a daemon, install Quagga: <br><br><pre> <code class="bash hljs">yum install -y quagga</code> </pre> <br>  Create the daemon configuration file <code>/etc/quagga/zebra.conf</code> <br><br><pre> <code class="bash hljs">hostname StrongSwanServer <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> file /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/quagga/quagga.log ! interface Tunnel13 ip address 172.16.130.1/30 ! interface Tunnel23 ip address 172.16.230.1/30 !</code> </pre><br>  The weight of the path can be adjusted with the cost or bandwidth parameters, setting them on the desired interfaces. <br><br>  Set rights and enable service <br><br><pre> <code class="bash hljs">chown quagga:quaggavt /etc/quagga/zebra.conf systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> zebra.service systemctl start zebra.service</code> </pre> <br>  Create the daemon configuration file <code>/etc/quagga/ospfd.conf</code> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">log</span></span> file /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/quagga/ospfd.log ! router ospf ospf router-id 10.3.3.1 passive-interface default no passive-interface Tunnel13 no passive-interface Tunnel23 network 172.16.130.0/30 area 0.0.0.0 network 172.16.230.0/30 area 0.0.0.0</code> </pre> <br>  Set rights and enable service <br><br><pre> <code class="bash hljs">chown quagga:quaggavt /etc/quagga/ospfd.conf systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> ospfd.service systemctl start ospfd.service</code> </pre> <br>  Then we can launch the vtysh terminal and work with Quagga in a cis-like interface, for example: <br><br><pre> <code class="bash hljs">vtysh show running-config</code> </pre> <br></li><li><h3>  Configure OSPF on a Cisco 2951 </h3><br><pre> <code class="python hljs">router ospf <span class="hljs-number"><span class="hljs-number">1</span></span> passive-interface default no passive-interface Tunnel12 no passive-interface Tunnel13 no passive-interface GigabitEthernet1 network <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span> network <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.120</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span> network <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.130</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br></li><li><h3>  Configure OSPF on Cisco CSR1000V </h3><br><pre> <code class="python hljs"> router ospf <span class="hljs-number"><span class="hljs-number">1</span></span> passive-interface default no passive-interface Tunnel12 no passive-interface Tunnel23 no passive-interface GigabitEthernet1 network <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span> network <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.120</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span> network <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.230</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> area <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br></li></ul><br>  Check the visibility of neighbors and the routes that came to CentOS: <br><br><pre> <code class="python hljs">vtysh show ospf neighbor show ip ospf route</code> </pre><br>  and on Cisco: <br><br><pre> <code class="python hljs">show ospf neighbor show ip ospf route</code> </pre> <br></li><li><h2>  What remains to be seen </h2><br>  I described the easiest option.  Of course, you configure key exchange using <a href="https://habr.com/post/250859/">IKE v2, certificate authorization</a> , add additional filtering to the firewall by address, make OSPF with authorization and, with a large number of routers, split into area, change the values ‚Äã‚Äãof hello-interval and dead-interval to interfaces. <br><br>  I would be happy to advice in the comments, and information about typos - in a personal.  Thanks for attention. <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/354490/">https://habr.com/ru/post/354490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354478/index.html">When computers were people ...</a></li>
<li><a href="../354480/index.html">Bobaos - KNX TP / UART, Raspberry Pi and Apple HomeKit</a></li>
<li><a href="../354484/index.html">Block the entire Internet, or a monkey with a grenade</a></li>
<li><a href="../354486/index.html">Apache Kafka - my summary</a></li>
<li><a href="../354488/index.html">As an entrepreneur to submit reports on the simplified taxation system</a></li>
<li><a href="../354492/index.html">How to develop a system that recognizes a person by keyboard writing</a></li>
<li><a href="../354494/index.html">GDPR on the nose - stop panic and begin to escape</a></li>
<li><a href="../354498/index.html">HOPE X. Conference "Breaking the elevator: from the basement to the penthouse." Part 2. "Security Systems"</a></li>
<li><a href="../354500/index.html">Badoo geolocation testing: bumps, stones, crutches and selfie stick</a></li>
<li><a href="../354502/index.html">The insides of the protocol, which browsers transmit voice and video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>