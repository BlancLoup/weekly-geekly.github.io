<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RGB lamp</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reflecting on a gift for a girl on March 8, I remembered the project of an RGB LED lamp, which was decided to be implemented. Especially since everyth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RGB lamp</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/56/27/562788536563f1923950335040134c12.jpg" alt="image"><br><br>  Reflecting on a gift for a girl on March 8, I remembered the project of an RGB LED lamp, which was decided to be implemented.  Especially since everything needed for this was at hand.  But to make the gift more interesting, I added control using an optical IR sensor, which made the original handling of the lamp and also did not spoil the design with the buttons. <br><a name="habracut"></a><br><habracut><br><br><img src="https://habrastorage.org/storage2/59b/9e8/630/59b9e8630499f3dfaac84d69973c0f01.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The RGB LED is essentially 3 LEDs of different colors in a single package.  In my case, a LED with a common anode and with 3 cathodes, one for each diode, although the designations on the diode are reversed. <br><br>  To get the different colors of the glow of our LED, each diode must be turned on using PWM 'a (pulse-width modulation), otherwise the LEDs will be lit to the maximum, which ultimately will give us a white color. <br><br>  PWM is a pulse signal of constant frequency and variable duty cycle.  By setting the duty cycle, you can change the average voltage at the PWM output, as a result, the brightness of a specific LED will change.  In our case, the PWM frequency will be 1kHz.  To generate a PWM signal of variable duty cycle, we need a microcontroller. <br><br><img src="https://habrastorage.org/storage/habraeffect/b8/43/b8432c8670918b0383034ba074138019.png" alt="image"><br><br>  Optical sensor - consists of an IR LED and an IR receiver.  The IR LED and the receiver will be directed upwards, when you hold your hand over the sensor, the light will be reflected by hand and will be accepted by the receiver.  Since the RGB LED has a strong parasitic infrared radiation, it is necessary to protect the sensor from false alarms.  To solve this problem, use the receiver TSOP1738.  It provides for triggering only on a modulated signal at a carrier frequency of 38 kHz, but if the modulation pulses go continuously for more than 1 second, the receiver recognizes them as interference and will not react to them.  It was experimentally revealed that in order for the receiver not to cut the signal, it must be interrupted every 100ms for 20 ms. <br><br>  The LED should be about the same signal. <br><img src="https://habrastorage.org/storage/habraeffect/05/9a/059a58f14404b8ee3359ccd16d99229b.jpg" alt="image"><br><br>  A microcontroller (mk) is a chip designed to control electronic devices.  To implement the control, it is necessary to write a program and flash it in a micron with the help of a programmer.  In the final version of the device, I used the ATMEGA8 micron, and for the first experiments I took the ATMEGA32, since for him I had a debug board on which everything could be quickly assembled. <br><br><img src="https://habrastorage.org/storage/habraeffect/4e/e4/4ee45c2e023d8d25a6856aaa8adf8e78.JPG" alt="image"><br><br>  In ATMEGA8 - there are 3 timer / counters, their essence is that they can count clock cycles with a selected frequency, which depends on the clocking frequency u.  When a certain value is reached, an interrupt occurs, according to which the interrupt code will be executed. <br><br>  Timer / Counter 0 <br>  This timer is 8 bit, which means that it can count up to 255 cycles, after which it will be reset.  This timer does not have a hardware PWM generator, it will be used for program modulation for the IR LED. <br><br>  Timer / Counter 1 <br>  Timer / counter 1 - 16 bit, it counts up to 65,535 cycles.  He has 2 hardware PWM generator, which will be used to control 2 of 3 diodes. <br><br>  Timer / Counter 2 <br>  It is also 8 bit and has 1 PWM generator that will drive the 3rd diode. <br><br>  As a programmer, I used USB programmer <a href="http://easyelectronics.ru/usb-programmator-avr-usbasp.html">USBAsp</a> <br>  To assemble it you need to flash one micron, so there are simpler options that really require <a href="http://myrobot.ru/stepbystep/mc_programmer.php">LPT</a> or <a href="http://easyelectronics.ru/avr-shag-pervyj-programmator.html">COM</a> ports. <br><br><br>  I wrote the program in C using CodeVisionAVR and ImageCraft7.  First of all, you need to set the timers 1 and 2 to PWM mode at 1 kHz.  Then set the timer interrupt 0, with sufficient frequency to process the interrupt code, in my case the interrupt call frequency was 148 kHz.  It is also necessary to establish an interrupt from an external source, it is necessary to respond to the receiver signal. <br><br>  Upon interruption from the receiver to indicate the operation, the LED will flash with white light for 100 ms, and add 1 to the mode variable, in the main loop a certain mode will turn on depending on the variable.  The mode change is implemented in a cycle by changing the duty ratio with a delay at each iteration. <br><br><h4>  Assembly </h4><br>  First of all, the schematic diagram. <br><img src="https://habrastorage.org/storage/habraeffect/9d/65/9d65e9ffb87ccf8f3d9bce4a6f3ea347.JPG" alt="image"><br><br>  Power is supplied from the power supply, the output voltage is 5 volts, the current is 1A. <br><br>  I spread a fee in the program Sprint Layout 5 <br><img src="https://habrastorage.org/storage/habraeffect/72/2a/722a7c46e7093d45744510d0e6ac5768.JPG" alt="image"><br><br>  The board is divided into the main and optical sensor board.  This is done so that the sensor can be conveniently positioned, the blue line on the main board is a jumper, the other blue and black lines are wires. <br><br>  Made by <a href="http://easyelectronics.ru/sozdanie-pechatnoj-platy-metodom-lazernogo-utyuga.html">laser iron</a> . <br>  I note that it is better to use an iron with a steam generator, thanks to a couple of paper it is easier to move away from the board. <br><br>  The board in the center in the final device was not used. <br><img src="https://habrastorage.org/storage/habraeffect/c5/26/c52687d628ede81c8f493543024d802f.JPG" alt="image"><br><br>  Preliminary assembly. <br><img src="https://habrastorage.org/storage/habraeffect/ea/87/ea8785acb46ce26d94e65322069ce1ca.JPG" alt="image"><br><br>  Lamp <br><img src="https://habrastorage.org/storage/habraeffect/b9/b0/b9b057a5e982285e0301e507d180dffd.JPG" alt="image"><br><br>  In the collection <br><img src="https://habrastorage.org/storage2/f8d/acd/c0d/f8dacdc0d84b5c9e098b0ea251c4e1cf.jpg"><br><br>  Since the glass itself turned out to be almost mirror inside, we had to isolate the receiver and the infrared LED with emery paper and foil, but it would be necessary to isolate it anyway, otherwise the illumination will be.  The radiator is obligatory for installation, the diode will warm up very much and without a radiator just overheat, besides, in my firmware the diode works at 70% of maximum power.  In the white light mode, the temperature rose to 53 degrees for an hour and did not rise any more, which is quite acceptable. <br><br>  Final result <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Q8E2Hu1_24g%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhiIUayzbZishUfjFp_ZPBUpxEqnlw" frameborder="0" allowfullscreen=""></iframe><br><br>  To implement the plan it took the following: <br><br><ul><li>  RGB LED, I took a power of 3 watts. </li><li>  ATMEGA 8 microcontroller - for others you will have to modify the firmware. </li><li>  ATMEGA 8 socket </li><li>  IR receiver - for example TSOP1736 </li><li>  IR LED, for example FYL 3014ir </li><li>  3 transistors BC337 </li><li>  0.1 ŒºF capacitor </li><li>  Resistors: </li><li>  10 ohm - 2 pieces </li><li>  3 ohms - 1 piece </li><li>  1 Kom - 1 piece </li><li>  10Kom - 1 pieces </li><li>  330 ohms - 1 piece </li><li>  4,7Kom - 3 pieces </li><li>  AVR programmer </li><li>  The power supply unit is pulse - the output voltage is 5 volts, the current is 1A. </li><li>  Actually the lamp itself </li><li>  Wires, PCB, radiator, thermal grease, etc. </li></ul><br><br>  Some definitions were taken from wikipedia. <br><br>  <a href="http://ge.tt/3JrPuZH/v/1%3Fc">Source, firmware and layout file.</a> <br><br>  <b>Upd</b> : If you want to build a lamp for this post, then do not forget to look at the sources, fuses micron are stitched at 8 MHz.  Since the micron is clocked from the internal resonator, and its error is quite high and can be 10%, you will most likely need to adjust the modulation of the IR LED in the TCNT0 = 0xCA line;  that its frequency coincides with the frequency of the receiver.  Archive layout file for Sprint Layout 5.0. </habracut></div><p>Source: <a href="https://habr.com/ru/post/116085/">https://habr.com/ru/post/116085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116079/index.html">For the first time in Russian: Nicolas Carr. Does Google make us dumber?</a></li>
<li><a href="../116080/index.html">China strengthens electronic communications censorship</a></li>
<li><a href="../116082/index.html">Prevent Recursion and Lazy Computing in Java</a></li>
<li><a href="../116083/index.html">The DVFU ROV Team 2010</a></li>
<li><a href="../116084/index.html">Fake certificates for popular sites</a></li>
<li><a href="../116087/index.html">We collect package for Solaris from sorts</a></li>
<li><a href="../116088/index.html">Unity 3d Tank Tutorial: Chassis (Lesson 2. Tracked chassis)</a></li>
<li><a href="../116090/index.html">Mike Tyson will cure patients with gambling addiction</a></li>
<li><a href="../116091/index.html">Geolocation service inmile.com</a></li>
<li><a href="../116092/index.html">Bear Ballet and Artificial Intelligence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>