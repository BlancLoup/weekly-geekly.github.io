<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Yandeks.Pochta began to understand what you need</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few minutes ago, Yandex.Mail announced a new approach to reading and writing letters. We believe that modern mail should be much smarter than it is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Yandeks.Pochta began to understand what you need</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e1c/4f2/75e/e1c4f275efb76d296c6ae9e305e32910.gif" width="1" height="1">  A few minutes ago, Yandex.Mail announced a new approach to reading and writing letters.  We believe that modern mail should be much smarter than it is now.  She must understand what is written and immediately help to respond to it.  It‚Äôs also better to let your users do something together.  A little more about the new features can be found in our <a href="">press release</a> .  In this post we want to tell how one of the most important innovations announced today works. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/184788/"><img src="https://habrastorage.org/getpro/habr/post_images/626/ed0/233/626ed02335cade3487c1c2081ca44b81.png" width="600" height="279" alt="Yandex. Mail can remind of events"></a> <br><br><h4>  What exactly did we do </h4><br>  What if the mail starts doing the routine work for you regarding the content of the letter?  For example, it will help not to forget about an important event, will remind you of the upcoming departure to the sea, will give the necessary links and useful information.  My colleagues from the linguistics department used a very special technology that we hope will change the idea of ‚Äã‚Äãwhat e-mail is. <br><a name="habracut"></a><br>  This technology allows you to automatically apply special algorithms to the content of the letter and extract certain facts from it in the form of a structure understandable to the computer.  Thanks to her, Yandex.Mail can now provide you with more contextual information related to your letter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, if the letter contains invitations to any event and indicates exactly where it will take place, we will show this place on the map and help you not to get lost. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c6/c35/7de/6c6c357debd2333b3830ecc092fca06d.png" width="600" height="388" alt="Reminder of the event in Yandex.Mail"><br><br><h4>  What technologies are behind the scenes </h4><br>  So, you have received a letter from a friend, where he is calling you to an interesting conference or to the cinema.  From a computer point of view, this text is nothing more than a set of bytes.  But a person can highlight key objects and images in the text. <br><br>  The processing of a letter in Yandex.Mail begins at the moment it is received and saved (we call this process ‚Äúlaying‚Äù).  <a href="">Spam Defense</a> uses heuristic algorithms for checking and determines which type it may be: an electronic ticket for a plane, a letter from a social network, a letter from a person, or so on. <br><br>  Depending on which type the letter will be assigned to, the text at the time of viewing - in terms of extracting facts, it is called a document - is sent for retrieval to a particular processor.  Factors are simple and fast (for example, simple regular expressions) and quite complex. <br><br>  Many methods that allow a machine to understand a text in natural language and algorithms implementing this possibility are part of a more general task of extracting information.  Yandex.Mail retrieves event invitations using <a href="http://api.yandex.ru/tomita">the Tomita parser</a> , which is based on the <a href="http://en.wikipedia.org/wiki/Masaru_Tomita">Masaru Tomita</a> algorithm.  Access to it was open at the end of 2012. <br><br>  Tomita's parser itself is a tool for writing context-free grammars.  With its help, any person can describe a set of templates by which text will be structured.  The parser works on the basis of keywords dictionaries and rules written by linguists.  Dictionaries can be quite large. <br><br><h4>  How events are recognized in the letter </h4><br>  Consider the work of the parser by example.  You receive a letter containing the following text: <br><br>  <i>"On November 21, 2013, the Tenth Conference on Typology and Grammar for Young Researchers will be held at the Institute of Linguistic Studies of the Russian Academy of Sciences (St. Petersburg)."</i> <br><br>  In Tomita there is evidence of which words may be the ‚Äúpeaks‚Äù of the invitation.  For example, the verb "invite", "pass", "take place" - here there is a form of the verb "pass."  The "top" has a set of components that must be filled.  To get an event, the sentence, in addition to the verb itself, must contain the name of the event and its date.  In the case of the verb "pass", the name of the event must be the subject, in other contexts it can be expressed by other syntactic roles.  For example, the verb ‚Äúinvite‚Äù requires that an event be expressed by an addition (to invite to a conference, invite to visit). <br><br>  In addition to the date and title, the event may contain a place and time.  Organizations and addresses are distinguished by grammar in internal structure and in dictionaries.  For example, if the title contains the keyword ‚Äúinstitution, bank, hotel‚Äù, then these keywords with dependent words will be extracted as a company.  In the example above, the ‚ÄúInstitute of Linguistic Studies of the RAS‚Äù is extracted. <br><br>  The block with information about the event is displayed in the Yandex.Mail interface at the moment of opening the letter in the noticeable top of the page.  With this arrangement, the time to extract the facts is critical - it is impossible to significantly increase the waiting time of the user.  It must be admitted that it was not at the first attempt that we managed to achieve sufficient performance.  The volume of the parser‚Äôs own knowledge of the Russian language together with dictionaries takes about 1 GB.  Every second about 1000 letters are shown in Yandex.Mail, and for each of them it is necessary to select facts and transfer them to the frontend for display.  Despite the active use of client side caching, the number of retrieval requests remained too large to be able to meet the agreed time. <br><br>  Algorithms Tomits process the text sequentially.  Therefore, the larger the document itself, the more time is needed to process it.  Therefore, in order to speed it up, we split the text into several parts and each of them is processed separately in a parallel stream.  Moreover, we break the text along the boundaries of sentences - thus the probability of losing important information is reduced.  The response rate has grown, but the computing resources of the existing cluster were not enough to handle this data flow. <br><br>  Of course, it was possible to increase the number of machines involved in extracting the facts, but we decided to put a preliminary filter in front of Tomita, which determines whether there can be an event in the document or not.  In the latter case, the text does not need to be sent to a full extract.  Moreover, we deliberately picked up such a regexp, which gives probably more false positives.  The number of requests to the parser decreased by half, and we were able to unload the machines and free up resources for other tasks. <br><br>  Events are contained in 3.5% of letters and every day we extract information from more than a million events.  Now in our case there are about 500 templates, another 3,500 are on the way, which will help us to drastically improve the accuracy of work. <br><br><h4>  How to parry e-tickets </h4><br>  Some time after the retrieval of events was launched, we thought that we could help Yandex.Mail users and in a special way show the information that is in each electronic ticket.  For example, you can report destinations without going into a letter, additionally highlight an electronic ticket in the list of letters, or, for example, show the weather in the city of arrival. <br><br>  For tickets consisting of simple text, we used the same Tomita parser, but most of the letters from booking systems and airlines contain html markup and almost do not contain natural language.  Tomita works poorly in such conditions, so we took the technology as the basis, which showed itself remarkably well in Yandex.Market.  We use the html markup of the document as an xml tree of tags and build templates for different senders.  Before parsing the tree, we additionally process the document and bring it to a correct xml view. <br><br>  For these patterns, which are mainly composed of regular expressions and xpath, we select the necessary information and form the answer.  It is not always possible to isolate an element of the tree so that it contains only the necessary part of the information ‚Äî about a third of the cases, the element contains a sentence with key information.  So we remembered Tomita again and created a set of grammars to parse such sentences. <br><br>  After extracting the basic information about the ticket from the letter, we update it in Yandex. Schedules, which always contain the most current information about flights.  Based on this information, we supplement the ticket with data from other services: weather, exchange rates, links to the airport and electronic check-in. <br><br><h4>  And what about privacy? </h4><br>  Habr's audience like no other knows that in every mail every letter is parsed by dozens of different scripts.  Spam defense is so arranged - its job is to automatically analyze the letters and make decisions about whether or not the message is moved to spam. <br><br>  The same is with Tomita.  We have provided several levels of protection so you can be calm: the text is analyzed only by the machine - without any human intervention.  Only statistical information about the request is saved in the system logs: the runtime, the type and number of facts found, as well as the number of fields that could be determined.  The text of the letter itself is transmitted to extract the facts in an impersonal form - without technical headings, without specifying the sender and recipient. <br><br>  In the initial training of the system and the preparation of grammars, human participation is indispensable - this is a painstaking process in which linguists are engaged.  For him, we use texts from open sources, for example, comments on LiveJournal or social networks.  If there are not enough examples, we ask our employees to send examples of suitable letters for training and writing grammars.  So we did in the case of air tickets.  In addition, we have compiled the top 30 air ticket makers and trained Mail to work with them.  You can look at how innovations in the Post look like <a href="http://ya.cc/newmail">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/184788/">https://habr.com/ru/post/184788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184770/index.html">Where is my post office? - search post office DoubleGis index</a></li>
<li><a href="../184772/index.html">USB flash drive Leef Bridge with micro USB connectors</a></li>
<li><a href="../184778/index.html">Richard Stallman and Aaron Schwartz taken to the Internet Hall of Fame</a></li>
<li><a href="../184780/index.html">Samsung Galaxy S4 and HTC One are available for order on Google Play</a></li>
<li><a href="../184786/index.html">How do you make a living,% username%?</a></li>
<li><a href="../184790/index.html">PocketBook has released a new 5-inch reader with "electronic ink"</a></li>
<li><a href="../184792/index.html">Ukrainian police seized VKontakte caching servers in a third-party investigation</a></li>
<li><a href="../184794/index.html">ARM Wrestling</a></li>
<li><a href="../184796/index.html">Luminol chemiluminescence / what's inside the ‚Äúglowing sticks‚Äù?</a></li>
<li><a href="../184800/index.html">Entertaining C ++: Compile Time Counter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>