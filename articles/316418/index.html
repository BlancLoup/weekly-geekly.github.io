<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We search and analyze errors in the Orchard CMS code.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Orchard is a free, open source content management system that is part of the open source ASP.NET project gallery of the non-profit Outercurve Foundati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We search and analyze errors in the Orchard CMS code.</h1><div class="post__text post__text-html js-mediator-article">  Orchard is a free, open source content management system that is part of the open source ASP.NET project gallery of the non-profit Outercurve Foundation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/083/625/b69/083625b69b89979350245888d8bc98d0.png" alt="Picture 4"></div><br>  For us, the developers of the PVS-Studio static analyzer, this is another opportunity to test an interesting project, tell people (and developers including) about errors found and, in turn, test our analyzer again.  Today we will talk about errors found in the project Orchard CMS. <br><a name="habracut"></a><br><h2>  About Orchard CMS </h2><br>  The project description is taken from the <a href="http://orchardproject.ru/about-orchard">site</a> . <br><br>  The Orchard CMS project was announced in March 2010 with the release of the first beta version of the project.  The creators of Orchard CMS set a goal to build a content management system on a new successful ASP.NET MVC framework that would meet the following requirements: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Open free and free project, depending on community requests; </li><li>  Fast engine with a modular architecture and all the necessary means of CMS; </li><li>  A publicly accessible online gallery of modules, themes, and other extension components from the community; </li><li>  High quality typography, attention to layout and page layout; </li><li>  Emphasis on creating a convenient and functional administration panel; </li><li>  Rapid deployment of the system on the workplace and easy publishing to the server. </li></ol><br>  Initially, Orchard and its source codes were licensed on the basis of a free license MS-PL, but, with the release of the first public version, the project changed the license to a simpler and more common New BSD License. <br><br>  Four preliminary versions were released during the year, until Orchard CMS reached version 1.0.  All this time, the developers kept in touch with the community, accepting suggestions, taking into account comments and correcting errors found.  To publish the source code and collect user feedback, the project was launched on the open source project codeplex.com at <a href="http://orchard.codeplex.com/">orchard.codeplex.com</a> . <br><br>  Today you can find extensive documentation on all aspects of the use of Orchard CMS, you can participate in the discussion of the project on the forums, you can send a report about the error found on the bugtracker, you can download the latest project source codes and binary builds. <br><br>  In addition to the developer page, the official project website was launched at <a href="http://www.orchardproject.net/">http://www.orchardproject.net/</a> , which today contains all the supporting documentation necessary for working with Orchard CMS.  In addition, the official website contains a gallery of modules and other components created by the community to expand the functionality of Orchard CMS. <br><br><h2>  Test results </h2><br>  All source files (3,739 pieces) with the <i>.cs</i> extension participated in the check.  In total, they contained 214,564 lines of code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/531/3c8/af0/5313c8af0ae6ce27fca394adc1640fec.png" alt="Picture 5"></div><br>  Following the audit, 137 warnings were received.  If we look in more detail, then at the first (high) level, 39 warnings were received.  28 of them clearly indicated problem areas or errors.  At the second level (average), 60 warnings were received.  In my subjective opinion, 31 warnings correctly pointed out the places with errors or typographical errors.  We will not consider the third (low) level of warnings, as these are warnings with a low level of confidence and, as a rule, among them there are a lot of false positives or there are warnings that are not relevant for many types of projects. <br><br>  So, we proceed to the consideration of the most interesting of the errors found.  In more detail, the authors of the project will be able to study the errors by requesting a temporary license from us and performing the verification themselves. <br><br>  As I understand it, the Orchard CMS developers are already using ReSharper in their work on the project.  I draw this conclusion based on: <br><br>  ¬ª <a href="https://github.com/OrchardCMS/Orchard-Harvest-Website/blob/master/src/Orchard.4.5.resharper">Https://github.com/OrchardCMS/Orchard-Harvest-Website/blob/master/src/Orchard.4.5.resharper</a> <br><br>  We do not like the idea of ‚Äã‚Äãcomparing ReSharper and PVS-Studio, since these are tools of different types.  But, as you can see, using ReSharper does not prevent us from finding real errors in the code. <br><br><h3>  Infinite recursion </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d3/856/d61/3d3856d61467b4a3c810721eea4d2c7b.png" alt="Picture 9"></div><br>  <a href="http://www.viva64.com/ru/w/V3110/">V3110</a> Possible infinite recursion inside 'ReturnTypeCustomAttributes' property.  ContentItemAlteration.cs 121 <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> ICustomAttributeProvider ReturnTypeCustomAttributes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ReturnTypeCustomAttributes; } }</code> </pre> <br>  Opens a list of errors we have a fairly common typo, which, when getting the value of the property <i>ReturnTypeCustomAttributes,</i> will lead to an infinite recursion and, as a result, to throw out a <i>StackOverflow</i> exception, which in turn will lead to a program crash.  Most likely, the programmer wanted to return the <i>_dynamicMethod</i> object from the property of the same field, then the correct version would look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> ICustomAttributeProvider ReturnTypeCustomAttributes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dynamicMethod.ReturnTypeCustomAttributes; } }</code> </pre> <br>  And here is another typo, which will lead to an infinite recursion, and, as a consequence, the release of the StackOverflow exception. <br><br>  V3110 Possible infinite recursion inside 'IsDefined' method.  ContentItemAlteration.cs 101 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsDefined</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type attributeType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inherit</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsDefined(attributeType, inherit); }</code> </pre> <br>  In this case, the <i>IsDefined</i> method calls itself.  I think that here the programmer also wanted to call the same-named method on the <i>_dynamicMethod</i> object.  Then the correct version would look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsDefined</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type attributeType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inherit</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _dynamicMethod.IsDefined(attributeType, inherit); }</code> </pre> <br><h3>  When in the minute is not always 60 seconds </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a9/979/8d1/1a99798d107eb121a33bf7a3a18db334.png" alt="Picture 8"></div><br>  <a href="http://www.viva64.com/ru/w/V3118/">V3118</a> Seconds component of TimeSpan is used, which does not represent the full time interval.  Possibly 'TotalSeconds' value was intended instead.  AssetUploader.cs 182 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IBackgroundTask.Sweep() { .... <span class="hljs-comment"><span class="hljs-comment">// Don't flood the database with progress updates; // Limit it to every 5 seconds. if ((_clock.UtcNow - lastUpdateUtc).Seconds &gt;= 5) { .... } }</span></span></code> </pre> <br>  Another fairly common typo, arising from the not quite obvious implementation of the <i>TimeSpan</i> type.  From the commentary it is clear that this method should block the database request if less than 5 seconds have passed since the previous request.  But the programmer, apparently, did not know that the <i>Seconds</i> property of an object of type <i>TimeSpan</i> does not return the total number of seconds in a given time interval, but the residual number of seconds. <br><br>  For example, if we have a time interval of 1 minute and 4 seconds long, the call to the <i>Seconds</i> method will return us only 4 seconds.  If you need to return the total number of seconds, you must use the <i>TotalSeconds</i> property.  For this example, it will be 64 seconds. <br><br>  The correct version would look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> IBackgroundTask.Sweep() { .... <span class="hljs-comment"><span class="hljs-comment">// Don't flood the database with progress updates; // Limit it to every 5 seconds. if ((_clock.UtcNow - lastUpdateUtc).TotalSeconds &gt;= 5) // &lt;= { .... } }</span></span></code> </pre> <br><h3>  Missing enumeration value when checking via switch </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a38/549/91d/a3854991d9b84b5ce05bc6c5f534552e.png" alt="Picture 1"></div><br>  <a href="http://www.viva64.com/ru/w/V3002/">V3002 Enum</a> : Byte.  InfosetFieldIndexingHandler.cs 65 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TypeCode { Empty = <span class="hljs-number"><span class="hljs-number">0</span></span>, Object = <span class="hljs-number"><span class="hljs-number">1</span></span>, DBNull = <span class="hljs-number"><span class="hljs-number">2</span></span>, Boolean = <span class="hljs-number"><span class="hljs-number">3</span></span>, Char = <span class="hljs-number"><span class="hljs-number">4</span></span>, SByte = <span class="hljs-number"><span class="hljs-number">5</span></span>, Byte = <span class="hljs-number"><span class="hljs-number">6</span></span>, Int16 = <span class="hljs-number"><span class="hljs-number">7</span></span>, UInt16 = <span class="hljs-number"><span class="hljs-number">8</span></span>, Int32 = <span class="hljs-number"><span class="hljs-number">9</span></span>, UInt32 = <span class="hljs-number"><span class="hljs-number">10</span></span>, Int64 = <span class="hljs-number"><span class="hljs-number">11</span></span>, UInt64 = <span class="hljs-number"><span class="hljs-number">12</span></span>, Single = <span class="hljs-number"><span class="hljs-number">13</span></span>, Double = <span class="hljs-number"><span class="hljs-number">14</span></span>, Decimal = <span class="hljs-number"><span class="hljs-number">15</span></span>, DateTime = <span class="hljs-number"><span class="hljs-number">16</span></span>, String = <span class="hljs-number"><span class="hljs-number">18</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InfosetFieldIndexingHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> typeCode = Type.GetTypeCode(t); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (typeCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Empty: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Object: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.DBNull: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.String: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Char: .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Boolean: .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.SByte: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Int16: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.UInt16: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Int32: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.UInt32: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Int64: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.UInt64: .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Single: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Double: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.Decimal: .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TypeCode.DateTime: .... <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  This piece of code is quite cumbersome, so it is difficult to immediately notice the error.  In this case, there is an enumeration <i>TypeCode</i> and a method <i>InfosetFieldIndexingHandler,</i> in which it is checked to which of the elements of the enumeration the <i>typeCode</i> variable <i>belongs</i> .  In this case, the programmer who wrote this code most likely forgot about one small element called <i>Byte</i> , but added it to his fellow <i>SByte</i> .  Because of this error, <i>Byte</i> processing will be ignored.  It would be easier to avoid this error if the programmer added a <i>default</i> block in which an exception about an unprocessed enumeration element is thrown. <br><br><h3>  No return value processing from Except method </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96e/107/0e9/96e1070e90c066dea5f414ce1a0c7d20.png" alt="Picture 2"></div><br>  <a href="http://www.viva64.com/ru/w/V3010/">V3010</a> The return value of the 'Except' is required to be utilized.  AdminController.cs 140 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Preview</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> themeId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> returnUrl</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_extensionManager.AvailableExtensions() .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alreadyEnabledFeatures = GetEnabledFeatures(); .... alreadyEnabledFeatures.Except(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { themeId }); <span class="hljs-comment"><span class="hljs-comment">// &lt;= TempData[AlreadyEnabledFeatures] = alreadyEnabledFeatures; } .... }</span></span></code> </pre> <br>  As you know, the <i>Except</i> method excludes from the collection for which it was called, elements of another collection.  But the programmer, apparently, did not know, or did not pay attention to the fact that the result of the work of this method returns a new collection.  The correct version would look like this: <br><br><pre> <code class="cs hljs">alreadyEnabledFeatures = alreadyEnabledFeatures.Except(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { themeId });</code> </pre> <br><h3>  The substring method does not accept a negative value. </h3><br>  <a href="http://www.viva64.com/ru/w/V3057/">V3057</a> The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  ContentIdentity.cs 139 <br><br><pre> <code class="cs hljs">.... GetIdentityKeyValue(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indexOfEquals = identityEntry.IndexOf(<span class="hljs-string"><span class="hljs-string">"="</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexOfEquals &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = identityEntry.Substring(<span class="hljs-number"><span class="hljs-number">1</span></span>, indexOfEquals - <span class="hljs-number"><span class="hljs-number">1</span></span>); .... }</code> </pre> <br>  Notice the check for the <i>indexOfEquals</i> variable.  The check protects against the case if the value of the variable is negative.  But there is no protection against zero. <br><br>  If the '=' character is at the very beginning, an exception will be thrown, since the second argument of the <i>Substring ()</i> method will have a negative value of -1. <br><br>  Similar errors were also found, which separately does not make sense to consider separately: <br><br><ul><li>  V3057 The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  CommandParametersParser.cs 18 </li><li>  V3057 The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  CommandStep.cs 73 </li></ul><br><h3>  The priority of operations in the expression </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51b/777/337/51b7773370ab1c2656027ad26bbd06ae.png" alt="Picture 10"></div><br>  <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> Expression 'localPart.Name + "."  + localField.Name + "."  + storageName 'is always not null.  ContentFieldProperties.cs 56 <br><br><pre> <code class="cs hljs">localPart.Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + localField.Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + storageName ?? <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br>  In this case, the programmer most likely thought that the operator <i>??</i>  checks only the <i>storageName</i> variable for <i>null</i> , and if so, then an empty string will be added to the expression instead.  But since the <i>+</i> operator has a higher priority, the whole expression will be checked for <i>null</i> .  It is also worth noting that if we add <i>null</i> to the line, we will get the same line without changes.  Thus, in this case, you can safely discard this test as unnecessary and misleading.  The corrected version could look like this: <br><br><pre> <code class="cs hljs">localPart.Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + localField.Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + storageName</code> </pre> <br>  The analyzer also found another similar error: <br><br><pre> <code class="hljs vhdl">V3022 Expression <span class="hljs-symbol"><span class="hljs-symbol">'localPart</span></span>.Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + localField.Name + <span class="hljs-string"><span class="hljs-string">"."</span></span> + storageName' <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> always <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>. ContentFieldsSortCriteria.cs <span class="hljs-number"><span class="hljs-number">53</span></span></code> </pre> <br><h3>  Verification is always false </h3><br>  <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> Expression 'i == 4' is always false.  WebHost.cs 162 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clean</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Try to delete temporary files for up to ~1.2 seconds. for (int i = 0; i &lt; 4; i++) { Log("Waiting 300msec before trying to delete ...."); Thread.Sleep(300); if (TryDeleteTempFiles(i == 4)) { Log("Successfully deleted all ...."); break; } } }</span></span></code> </pre> <br>  It can be seen that the loop iterator <i>i</i> will always have a value in the range from 0 to 3, but despite this, the programmer inside the loop body boldly checks whether the iterator has a value of 4. This test will never be performed, but without knowing the true purpose of this segment code, it's hard for me to say how dangerous this error is in the scope of the project. <br><br>  The analyzer has also found a number of similar errors.  They all say that the test will always be either true or false. <br><br><ul><li>  V3022 Expression 'result == null' is always false.  ContentFieldDriver.cs 175 </li><li>  V3022 Expression 'String.IsNullOrWhiteSpace (url)' is always true.  GalleryController.cs 93 </li><li>  V3022 Expression '_smtpSettings.Host! = Null' is always true.  SmtpMessageChannel.cs 143 </li><li>  V3022 Expression 'loop' is always false.  IndexingTaskExecutor.cs 270 </li><li>  V3022 Expression 'Convert.ToString (Shape.Value)' is always not null.  EditorShapes.cs 372 </li><li>  V3022 Expression 'ModelState.IsValid' is always true.  RecycleBinController.cs 81 </li><li>  V3022 Expression 'previousXml! = Null' is always true.  ContentDefinitionEventHandler.cs 104 </li><li>  V3022 Expression 'previousXml! = Null' is always true.  ContentDefinitionEventHandler.cs 134 </li><li>  V3022 Expression 'layoutId! = Null' is always true.  ProjectionElementDriver.cs 120 </li></ul><br><h3>  Using a class member before checking an object for null </h3><br>  <a href="http://www.viva64.com/ru/w/V3027/">V3027</a> The variable "x.Container" was used in the same logical expression.  ContainerService.cs 130 <br><br><pre> <code class="cs hljs">query.Where(x =&gt; (x.Container.Id == containerId || x.Container == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) &amp;&amp; ids.Contains(x.Id));</code> </pre> <br>  As can be seen from the code above (we are interested in 2 and 3 lines), the programmer first checks the reference to the <i>Id</i> property of the container, and only then checks the container for <i>null</i> .  The correct option would be to first check for <i>null</i> , and only then access the elements of the container. <br><br>  The following case is similar to the previous one.  Try to find the error here yourself. <br><br>  <a href="http://www.viva64.com/ru/w/V3095/">V3095</a> The 'Delegate' object was used against it.  Check lines: 37, 40. SerializableDelegate.cs 37 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ISerializable.GetObjectData( SerializationInfo info, StreamingContext context) { info.AddValue(<span class="hljs-string"><span class="hljs-string">"delegateType"</span></span>, Delegate.GetType()); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (.... &amp;&amp; Delegate != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... } }</code> </pre> <br>  The analyzer found 2 more similar errors that are similar to the one described above, so I will not cite them. <br><br><ul><li>  V3095 The 'Delegate' object was used against it.  Check lines: 37, 40. SerializableDelegate.cs 37 </li><li>  V3095 The 'widget' object was used against it.  Check lines: 81, 93. TagsWidgetCommands.cs 81 </li></ul><br><h2>  Conclusion </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ac/9ee/a50/5ac9eea504ac9abbec1b21642c54a995.png" alt="Picture 3"></div><br>  In this project, there were other errors, typos, shortcomings.  But they did not seem interesting to me to describe them in the article.  Orchard CMS developers can easily find all the shortcomings using the <a href="http://www.viva64.com/">PVS-Studio</a> tool.  You can also look for errors in your projects using the static analyzer proposed above. <br><br>  I want to remind you that the main advantage of static analysis is its regular use.  Download and check one-time code - this is not serious.  For example, programmers watch the compiler warnings regularly, rather than turning them on every 3 years before one of the releases.  With regular use, a static analyzer will save a lot of time searching for typos and errors. <br><br>  <b>PS</b> For those who missed the news, I want to remind you that PVS-Studio is now able to integrate with <b>SonarQube</b> .  An article on this topic: "We <a href="http://www.viva64.com/ru/b/0452/">control the quality of the code using the platform SonarQube</a> ". <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0456/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Ivan Kishchenko.  <a href="http://www.viva64.com/en/b/0456/">Analysis of bugs in Orchard CMS</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/316418/">https://habr.com/ru/post/316418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316406/index.html">"Great leveler" or a way to solve the problem of leveling</a></li>
<li><a href="../316408/index.html">As I recalled the school geometry course</a></li>
<li><a href="../316412/index.html">Remote backup of VMware cloud resources via self-service portal</a></li>
<li><a href="../316414/index.html">Grep all you can</a></li>
<li><a href="../316416/index.html">Global objects and their habitats</a></li>
<li><a href="../316420/index.html">CTFzone write-ups - Shall I reverse it?</a></li>
<li><a href="../316422/index.html">8 tools for creating personal or business chat bot</a></li>
<li><a href="../316426/index.html">Quick Guide how to become a Google Certified Associate Android Developer</a></li>
<li><a href="../316428/index.html">Demo database for PostgreSQL</a></li>
<li><a href="../316430/index.html">The implementation of the protocol MIL-STD-1553 on STM32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>