<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recovering deleted data using Scalpel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every person in life has a situation like rm -rf on the folder where it should not have been done. Backup is good, but what if there aren't any? For L...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recovering deleted data using Scalpel</h1><div class="post__text post__text-html js-mediator-article">  Every person in life has a situation like rm -rf on the folder where it should not have been done.  Backup is good, but what if there aren't any?  For Linux systems, there is the Scalpel utility, which allows you to recover deleted files by specified patterns, including the use of regular expressions. <br><a name="habracut"></a><br>  Scalpel is a fork of the Foremost project (from version 0.69), which began its history in 2005.  It has its own <a href="https://github.com/sleuthkit/scalpel">github</a> repository and is faster in data recovery and efficiency than Foremost.  Speaking about the difference between these two projects, we can say that Foremost released after version 0.69 has new semantic data recovery techniques.  For example, when recovering JPEG files, the header of this file is used to calculate the corresponding image body, when Scalpel simply takes the data between the specified completion signatures and the beginning of the image file.  Thus, it can be said that Foremost can more accurately recover lost data when Scalpel does this much faster. <br><br>  Scalpel features: <br><br><ol><li>  Recovery independent of file system </li><li>  Setting the minimum and maximum sizes of the file being restored </li><li>  Multithreading on multicore systems </li><li>  Asynchronous I / O operations that give a boost when searching by pattern </li><li>  Using TRE regular expressions to search at the beginning and end of a file </li><li>  The ability to recover from nested data structures </li><li>  GPUs have the option of using a GPU, which is available only for Linux and requires the pre-installed NVIDIA CUDA SDK and minor modifications of the source code (regular expression searches do not work with the GPU) </li></ol><br>  Scalpel is usually available among the packages of the corresponding Linux distribution, but you can also collect it from the raw by taking it from the github <a href="https://github.com/sleuthkit/scalpel">repository</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The application is configured in the /etc/scalpel/scalpel.conf file, where the corresponding file search patterns are specified.  In it you can see ready-made presets for searching, for example, by images or doc files.  To recover lost data, uncomment the appropriate templates and run the application. <br><br>  If the file does not contain the template of the desired file, or for example you are looking for a particular xml format, then it becomes necessary to create your own template, which is described like the rules presented below. <br><table><tbody><tr><th>  Type </th><th>  Case sensitive </th><th>  Size range </th><th>  Header </th><th>  Footer </th><th>  Search option </th></tr><tr><td>  avi </td><td>  y </td><td>  50,000,000 </td><td>  RIFF ???? AVI </td><td></td><td></td></tr><tr><td>  doc </td><td>  y </td><td>  10,000,000 </td><td>  \ xd0 \ xcf \ x11 \ xe0 \ xa1 \ xb1 \ x1a \ xe1 \ x00 \ x00 </td><td>  \ xd0 \ xcf \ x11 \ xe0 \ xa1 \ xb1 \ x1a \ xe1 \ x00 \ x00 </td><td>  NEXT </td></tr><tr><td>  pdf </td><td>  y </td><td>  500,000 </td><td>  % PDF </td><td>  % EOF \ x0d </td><td>  REVERSE </td></tr><tr><td>  pdf </td><td>  y </td><td>  500,000 </td><td>  % PDF </td><td>  % EOF \ x0a </td><td>  REVERSE </td></tr><tr><td>  tex </td><td>  y </td><td>  300: 50,000 </td><td>  /%.{1,20}\.tex/ </td><td>  /%.{1,20}\.tex\sEnd/ </td><td></td></tr><tr><td>  php </td><td>  y </td><td>  100,000 </td><td>  &lt;? php </td><td>  ?&gt; </td><td>  REVERSE </td></tr></tbody></table>  Briefly about the columns <br><br><ul><li>  <b>Type</b> - matters only in the context of the program; it has nothing to do with the files being restored and will be used only when displaying the log and the name of the directories in the recovered data.  You can not specify, in this case, just put NONE </li><li>  <b>Case sensitive</b> - whether to take into account the register when searching for a given pattern </li><li>  <b>Size range</b> - if just a number is indicated, then the maximum size of the file to be searched for; if through a colon, then min: max file size </li><li>  <b>Header</b> , <b>Footer</b> - search patterns for the beginning and end of the file.  TRE regular expressions are allowed.  The \ s character is used as a space, you can also use hexadecimal and octal representation of the data you are looking for, for example \ x [0-f] [0-f] or \ [0-3] [0-7] [0-7] </li></ul><br>  It is important to note that the values ‚Äã‚Äãfor the last field of the Search option are: <br><br><ul><li>  <b>REVERSE</b> - this parameter should be used if several final patterns can be used in the file.  For example, PDF files or PHP, in which there may be several scripts framed in &lt;? Php ...?&gt; </li><li>  <b>NEXT</b> - is used when you need to get data between the beginning and the first completion of the file, if the end of the file is not detected then an area with the size specified in the size field will be taken </li><li>  <b>FORWARD_NEXT</b> is a standard behavior and its indication is optional.  In this variant, a strict check of the template takes place, and if the beginning of the file is found and its completion is not found in the specified memory size, this section is excluded from the search results, unless the -b option is specified when the program is started, then the section of the specified size will be taken with the corresponding start , and the log of the application [audit.txt] will be written about the truncated file (chop column) </li></ul><br>  <i>The note</i> <br>  In case you need to use the question mark "?"  as the required value in the header or end of the file, then you need to override the wildcard symbol, which is the question mark.  To do this, at the beginning of the configuration file write <br><blockquote>  wildcard s </blockquote>  Where S is the new designation of the wildcard symbol in the search expression, or use the hexadecimal representation of this symbol, which is equivalent to \ 0x3f or \ 063 <br><br><h6>  <strong>And now practice</strong> </h6><br>  Suppose we deleted files that are described by templates in the table above.  Let's write these templates into the configuration file (the tab character is used as the column separation) /etc/scalpel/scalpel.conf and launch the recovery (I prepared an image with the data for recovery in advance) <br><br><pre><code class="hljs vbscript">root# scalpel MyDrive.img -o recover Written by Golden G. Richard III, based <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Foremost <span class="hljs-number"><span class="hljs-number">0.69</span></span>. Opening target <span class="hljs-string"><span class="hljs-string">"/home/username/Documents/repair_files/test/MyDrive.img"</span></span> Image file pass <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">2.</span></span> MyDrive.img: <span class="hljs-number"><span class="hljs-number">100.0</span></span>% |*****************************************************| <span class="hljs-number"><span class="hljs-number">500.0</span></span> MB <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ETA Allocating work queues... Work queues allocation complete. Building carve lists... Carve lists built. Workload: avi <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> header <span class="hljs-string"><span class="hljs-string">"\x52\x49\x46\x46\x3f\x3f\x3f\x3f\x41\x56\x49"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> footer <span class="hljs-string"><span class="hljs-string">""</span></span> --&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> files doc <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> header <span class="hljs-string"><span class="hljs-string">"\xd0\xcf\x11\xe0\xa1\xb1\x1a\xe1\x00\x00"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> footer <span class="hljs-string"><span class="hljs-string">"\xd0\xcf\x11\xe0\xa1\xb1\x1a\xe1\x00\x00"</span></span> --&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> files pdf <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> header <span class="hljs-string"><span class="hljs-string">"\x25\x50\x44\x46"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> footer <span class="hljs-string"><span class="hljs-string">"\x25\x45\x4f\x46\x0d"</span></span> --&gt; <span class="hljs-number"><span class="hljs-number">33</span></span> files pdf <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> header <span class="hljs-string"><span class="hljs-string">"\x25\x50\x44\x46"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> footer <span class="hljs-string"><span class="hljs-string">"\x25\x45\x4f\x46\x0a"</span></span> --&gt; <span class="hljs-number"><span class="hljs-number">19</span></span> files php <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> header <span class="hljs-string"><span class="hljs-string">"\x3c\x3f\x70\x68\x70"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> footer <span class="hljs-string"><span class="hljs-string">"\x3f\x3e"</span></span> --&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> files Carving files from image. Image file pass <span class="hljs-number"><span class="hljs-number">2</span></span>/<span class="hljs-number"><span class="hljs-number">2.</span></span> MyDrive.img: <span class="hljs-number"><span class="hljs-number">100.0</span></span>% *****************************************************| <span class="hljs-number"><span class="hljs-number">500.0</span></span> MB <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ETA Processing of image file complete. Cleaning up... Done. Scalpel <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> done, files carved = <span class="hljs-number"><span class="hljs-number">63</span></span>, elapsed = <span class="hljs-number"><span class="hljs-number">6</span></span> seconds.</code> </pre> <br>  After completion of the execution in the resulting folder, we find the files found and audit.txt which will contain brief information about the files found, like the one shown below. <br><br><pre> <code class="hljs pgsql">Scalpel <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">1.60</span></span> audit file Started at Wed Jan <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">2015</span></span> Command <span class="hljs-type"><span class="hljs-type">line</span></span>: scalpel MyDrive.img -o recover Output directory: /home/username/Documents/repair_files/test/recover <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> file: /etc/scalpel/scalpel.conf Opening target "/home/username/Documents/repair_files/test/MyDrive.img" The <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> files were carved: File <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> Chop Length Extracted <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> <span class="hljs-number"><span class="hljs-number">00000003.</span></span>pdf <span class="hljs-number"><span class="hljs-number">549888</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-number"><span class="hljs-number">4162</span></span> MyDrive.img <span class="hljs-number"><span class="hljs-number">00000055.</span></span>php <span class="hljs-number"><span class="hljs-number">1227776</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-number"><span class="hljs-number">99954</span></span> MyDrive.img <span class="hljs-number"><span class="hljs-number">00000001.</span></span>doc <span class="hljs-number"><span class="hljs-number">8916992</span></span> YES <span class="hljs-number"><span class="hljs-number">10000000</span></span> MyDrive.img</code> </pre><br>  Also note some of the available options. <br>  -p if this option is used, the files will not be restored, but an audit file will be created in which you can see which files will be restored <br>  -q with this option, scalpel will scan only the beginning of each cluster of a given size and search for the corresponding beginning of the desired file. <br>  -v verbose mode <br>  -o specify the directory where the result of the data recovery will be put <br><br>  All successful data recovery! <br><br><hr><br>  useful links <br><ol><li>  <a href="https://github.com/sleuthkit/scalpel">Github Scalpel repository</a> </li><li>  <a href="http://www.ccse.kfupm.edu.sa/~ahmadsm/coe589-122/naseer2013-scalpel.pdf">Scalpel: A Frugal, High Performance File Carver.</a>  <a href="http://www.ccse.kfupm.edu.sa/~ahmadsm/coe589-122/naseer2013-scalpel.pdf">Golden R. Richard III, Vassil Roussev</a> </li><li>  <a href="http://www.sans.org/reading-room/whitepapers/forensics/data-carving-concepts-32969">SANS Institute InfoSec reading room: data carving concepts</a> </li><li>  <a href="http://laurikari.net/tre/documentation/regex-syntax/">TRE Regex Syntax</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/247421/">https://habr.com/ru/post/247421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247405/index.html">Approaches to the creation of a scripting language for the description of board games</a></li>
<li><a href="../247409/index.html">Potential Android Telegram Vulnerability</a></li>
<li><a href="../247413/index.html">Pulp Fiction Weekend - Microsoft Press Free Books</a></li>
<li><a href="../247415/index.html">Marxico - markdown editor for Evernote</a></li>
<li><a href="../247419/index.html">Beautiful Fall: Gravity CSS3 Animation</a></li>
<li><a href="../247423/index.html">Creating a 3D scanner from a webcam, laser, and a handful of radio components</a></li>
<li><a href="../247425/index.html">Build ICO file with icons in PNG format using FASM</a></li>
<li><a href="../247429/index.html">The digest of interesting, top and fatal materials from the world of Habr for 2014</a></li>
<li><a href="../247431/index.html">NFV network function virtualization</a></li>
<li><a href="../247433/index.html">Continuing to shred CLR: .Net object pool outside SOH / LOH heaps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>