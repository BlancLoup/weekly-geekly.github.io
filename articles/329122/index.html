<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to build a voice bot: speech recognition, speech synthesis and NLP in a few lines of code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We regularly write about voice bots and automatics of incoming and outgoing calls. Confirmation of delivery, orders, guessing and auto-response to the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to build a voice bot: speech recognition, speech synthesis and NLP in a few lines of code</h1><div class="post__text post__text-html js-mediator-article">  We regularly write about voice bots and automatics of incoming and outgoing calls.  Confirmation of delivery, orders, guessing and auto-response to the client while we connect with the company - this is the whole story.  In the comments I reasonably noticed that I talk a lot about bots, but I‚Äôm showing a little.  It is easy to fix!  The Hackathon S7 in Gorky Park is in full swing, 50 teams have prototypes of various interesting features - and I have the opportunity to try to keep within the least possible number of lines of code.  The minimalism in the examples is cool. <br><a name="habracut"></a><br><h1>  How it will work </h1><br>  For the demonstration, I will do the simplest case: chat about the weather with the help of the famous speech <b>engine</b> , <b>api.ai</b> , recently bought by google.  In response to an arbitrary request, this service returns json with the result of ‚Äúunderstanding‚Äù this request.  If there is something similar to a weather query, you can use openweathermap to get a text description, for example, ‚Äúcloudy‚Äù.  Like now outside the windows of coworking.  But I hope it will be fine by the middle of the day! <br><br>  And the Voximplant platform will provide for renting a phone number, receiving a call, recognizing the user's speech and synthesizing an answer.  One of our key features is JavaScript, which runs in our cloud in parallel with the call.  And not just executed, but in real time.  Plus, from this JavaScript, you can make HTTP requests to other services, so we don‚Äôt need Backend as such: we will do everything in the same cloud that processes the call.  That the user had as little as possible delays between his speech and answer.  We have a bot, not a turn-based strategy with asterisk? <br><br><h1>  Step 1: get the phone number and answer the incoming call </h1><br>  I have a good introduction to Voximplant, but it is <a href="http://voximplant.com/blog/step-by-step-call-center-tutorial-part-1/">in English</a> .  Good for our customers around the world, but not very good for a tutorial article on Habr√©, so I‚Äôll allow myself a brief retelling.  After registering <a href="https://manage.voximplant.com/">in the admin panel</a> , go to the scripts section and create a new script: the same JavaScript code that will be executed in the cloud.  The simplest scenario will answer the call, synthesize ‚Äúhello, user‚Äù and hang up.  Here is his code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="oembed"><script type="text/javascript" src="https://gist.github.com/764e446c32ff599fa74b0217ed115f6d.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist47892804" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-scenario-1-js" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-scenario-1-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-scenario-1-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">VoxEngine</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">AppEvents</span>.<span class="pl-smi">CallAlerting</span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-scenario-1-js-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">var</span> inc <span class="pl-k">=</span> <span class="pl-smi">e</span>.<span class="pl-smi">call</span>; <span class="pl-c"><span class="pl-c">//</span>     'e'</span></td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-scenario-1-js-LC3" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">inc</span>.<span class="pl-en">answer</span>(); <span class="pl-c"><span class="pl-c">//</span>    ,     </span></td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-scenario-1-js-LC4" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">inc</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">Connected</span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) { <span class="pl-c"><span class="pl-c">//</span>    </span></td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-scenario-1-js-LC5" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">inc</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>, <span class="pl-pds">"</span></span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>); <span class="pl-c"><span class="pl-c">//</span>  </span></td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-scenario-1-js-LC6" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">inc</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-scenario-1-js-LC7" class="blob-code blob-code-inner js-file-line">      <span class="pl-smi">VoxEngine</span>.<span class="pl-c1">terminate</span>(); <span class="pl-c"><span class="pl-c">//</span>    JavaScript </span></td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-scenario-1-js-LC8" class="blob-code blob-code-inner js-file-line">    });</td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-scenario-1-js-LC9" class="blob-code blob-code-inner js-file-line">  });</td>
      </tr>
      <tr>
        <td id="file-scenario-1-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-scenario-1-js-LC10" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">scenario-1.js</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br>  To organize the code and instruct when and what to do, we have ‚Äúapplications‚Äù and ‚Äúrules‚Äù.  Go to the application section, create a new one, add a rule with a default dot-asterisk mask (which means ‚Äúfor calls to any numbers.‚Äù In our example, we will use the rented number and calls will obviously come ‚Äúto this number.‚Äù But in general case, the call can come from both other telephony and web sdk - for such cases, the rules help distribute them without doing extra if in the scripts) and assign the rule to the created JavaScript script for this rule. <br><br>  What else do you need to call the number?  Right, number.  They are rented in the numbers section, buy.  <b>Important</b> : ‚Äúreal numbers‚Äù is a switch.  If you click on it, the interface switches to the technical mode of virtual numbers for debugging.  A number in Gotham City can be bought for 1 cent.  Calls to such numbers go through a single access number and extension. <br><br>  Having rented a number, go to the section ‚ÄúMy phone numbers‚Äù from the top menu and connect the created application to the number.  Everything, you can call and check.  By the way, if during the tests the starting balance is over, you can <b>write to me in PM</b> and I will replenish.  Habr is first of all a community; we should support our own people. <br><br><h1>  Step two: try to understand the caller </h1><br>  A little later, I'll show you how to start recognizing from JavaScript Voximplant and get text instead of voice.  But for now let's imagine that it already exists and we need to ‚Äúunderstand‚Äù what the user said.  To do this, we register at <a href="https://api.ai/">api.ai</a> , connect a Google account, go to the ‚Äúprebuild agents‚Äù section and add a brain to the project that can talk about the weather.  Well, how to "talk."  Answer simple questions.  After that, in the left menu, select the created project and click on the gear icon in the same place.  In the opened project settings window, we are interested in the ‚ÄúClient access token‚Äù - we will be able to send requests using it.  For example, this is how weather in Moscow is recognized: <br><br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/bff84176c5e3c7aacaefc9a1190c747e.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist47893503" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-get-weather-example-sh" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-shell ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-get-weather-example-sh-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-get-weather-example-sh-LC1" class="blob-code blob-code-inner js-file-line">curl \</td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-get-weather-example-sh-LC2" class="blob-code blob-code-inner js-file-line">  -H <span class="pl-s"><span class="pl-pds">"</span>Authorization: bearer a42ee31de39c43f8b31a291397473e4b<span class="pl-pds">"</span></span> \</td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-get-weather-example-sh-LC3" class="blob-code blob-code-inner js-file-line">  -H <span class="pl-s"><span class="pl-pds">"</span>Content-Type: application/json; charset=utf-8<span class="pl-pds">"</span></span> \</td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-get-weather-example-sh-LC4" class="blob-code blob-code-inner js-file-line">  https://api.api.ai/v1/query \</td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-get-weather-example-sh-LC5" class="blob-code blob-code-inner js-file-line">  --data @- <span class="pl-s"><span class="pl-k">&lt;&lt;</span><span class="pl-k">EOT</span></span></td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-get-weather-example-sh-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-s">  {</span></td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-get-weather-example-sh-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    query: "   ",</span></td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-get-weather-example-sh-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    lang: ru,</span></td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-get-weather-example-sh-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-s">    sessionId: 1</span></td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-get-weather-example-sh-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-s">  }</span></td>
      </tr>
      <tr>
        <td id="file-get-weather-example-sh-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-get-weather-example-sh-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-s">  EOT</span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">get-weather-example.sh</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br>  In response, you get a rather big json, hidden under the spoiler.  The most valuable thing in the key is <b>result</b> , where you can check the topic in <b>action</b> , and in <b>address</b> and <b>city</b> , where you are interested in the weather.  Please note that this is a <b>very</b> simple demo, and to the question ‚Äúwhat is the weather outside the window‚Äù you will receive the address ‚Äúoutside the window‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><div class="oembed"><script type="text/javascript" src="https://gist.github.com/638069c5130552f7efd26db78eed87a6.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist47893601" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-weather-response-json" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-json ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-weather-response-json-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-weather-response-json-LC1" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-weather-response-json-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>4e936c5b-8432-48e4-9d82-dd5996d0049d<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-weather-response-json-LC3" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>timestamp<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>2017-05-21T05:06:13.051Z<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-weather-response-json-LC4" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>lang<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ru<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-weather-response-json-LC5" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>result<span class="pl-pds">"</span></span>: {</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-weather-response-json-LC6" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>source<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agent<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-weather-response-json-LC7" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>resolvedQuery<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>   <span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-weather-response-json-LC8" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>speech<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-weather-response-json-LC9" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>action<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>weather<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-weather-response-json-LC10" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>parameters<span class="pl-pds">"</span></span>: {</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-weather-response-json-LC11" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>address<span class="pl-pds">"</span></span>: {</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-weather-response-json-LC12" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>city<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-weather-response-json-LC13" class="blob-code blob-code-inner js-file-line">      },</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-weather-response-json-LC14" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>date-time<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-weather-response-json-LC15" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>unit<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-weather-response-json-LC16" class="blob-code blob-code-inner js-file-line">    },</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-weather-response-json-LC17" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>metadata<span class="pl-pds">"</span></span>: {</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-weather-response-json-LC18" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>inputContexts<span class="pl-pds">"</span></span>: [],</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-weather-response-json-LC19" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>outputContexts<span class="pl-pds">"</span></span>: [],</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-weather-response-json-LC20" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>intentName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>weather<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-weather-response-json-LC21" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>intentId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>f1b75ecb-a35f-4a26-88fb-5a8049b92b02<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-weather-response-json-LC22" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>webhookUsed<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-weather-response-json-LC23" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>webhookForSlotFillingUsed<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-weather-response-json-LC24" class="blob-code blob-code-inner js-file-line">      <span class="pl-s"><span class="pl-pds">"</span>contexts<span class="pl-pds">"</span></span>: [</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-weather-response-json-LC25" class="blob-code blob-code-inner js-file-line">        <span class="pl-s"><span class="pl-pds">"</span>weather<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-weather-response-json-LC26" class="blob-code blob-code-inner js-file-line">      ]</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-weather-response-json-LC27" class="blob-code blob-code-inner js-file-line">    },</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-weather-response-json-LC28" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>score<span class="pl-pds">"</span></span>: <span class="pl-c1">0.95</span></td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-weather-response-json-LC29" class="blob-code blob-code-inner js-file-line">  },</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-weather-response-json-LC30" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>status<span class="pl-pds">"</span></span>: {</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-weather-response-json-LC31" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>: <span class="pl-c1">200</span>,</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-weather-response-json-LC32" class="blob-code blob-code-inner js-file-line">    <span class="pl-s"><span class="pl-pds">"</span>errorType<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>success<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-weather-response-json-LC33" class="blob-code blob-code-inner js-file-line">  },</td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-weather-response-json-LC34" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>sessionId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span></td>
      </tr>
      <tr>
        <td id="file-weather-response-json-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-weather-response-json-LC35" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">weather-response.json</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br></div></div><br><br><h1>  Step three: find out the weather on Mars </h1><br>  Having received the city for which the caller wants to know the weather (or information about what the caller says is not about the weather at all), you can find out the weather itself.  Apishki for this million, for the demonstration, I will use the first <b>openweathermap.org</b> that came <b>across</b> , where you can register and get the key api.  Please note that the key does not start working immediately.  An example of a request that will return the weather in Moscow: <br><br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/fd4d507a6897e3937c25a5d8a96e2838.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist47893915" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-get-weather-response-sh" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-shell ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-get-weather-response-sh-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-get-weather-response-sh-LC1" class="blob-code blob-code-inner js-file-line">curl <span class="pl-s"><span class="pl-pds">"</span>http://api.openweathermap.org/data/2.5/weather?q=&amp;lang=ru&amp;appid=3bb8d31acec1fa4b5c0a23f07169a0fd<span class="pl-pds">"</span></span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">get-weather-response.sh</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br>  In response, we receive json in the same way, in which there is a <b>description</b> field ready for pronouncing.  In Moscow it is now overcast: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><div class="oembed"><script type="text/javascript" src="https://gist.github.com/632edba2f18d2ea3b8e33ab1d8843de4.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist47893991" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-get-weather-response-json" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-json ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-get-weather-response-json-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-get-weather-response-json-LC1" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-get-weather-response-json-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>coord<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>lon<span class="pl-pds">"</span></span>:<span class="pl-c1">37.62</span>, <span class="pl-s"><span class="pl-pds">"</span>lat<span class="pl-pds">"</span></span>:<span class="pl-c1">55.75</span>},</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-get-weather-response-json-LC3" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>weather<span class="pl-pds">"</span></span>: [</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-get-weather-response-json-LC4" class="blob-code blob-code-inner js-file-line">    {<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>:<span class="pl-c1">804</span>,<span class="pl-s"><span class="pl-pds">"</span>main<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>Clouds<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>icon<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>04d<span class="pl-pds">"</span></span>}</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-get-weather-response-json-LC5" class="blob-code blob-code-inner js-file-line">  ],</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-get-weather-response-json-LC6" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>base<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>stations<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-get-weather-response-json-LC7" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>main<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>temp<span class="pl-pds">"</span></span>:<span class="pl-c1">283.9</span>,<span class="pl-s"><span class="pl-pds">"</span>pressure<span class="pl-pds">"</span></span>:<span class="pl-c1">1010</span>,<span class="pl-s"><span class="pl-pds">"</span>humidity<span class="pl-pds">"</span></span>:<span class="pl-c1">66</span>,<span class="pl-s"><span class="pl-pds">"</span>temp_min<span class="pl-pds">"</span></span>:<span class="pl-c1">283.15</span>,<span class="pl-s"><span class="pl-pds">"</span>temp_max<span class="pl-pds">"</span></span>:<span class="pl-c1">284.15</span>},</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-get-weather-response-json-LC8" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>visibility<span class="pl-pds">"</span></span>: <span class="pl-c1">10000</span>,</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-get-weather-response-json-LC9" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>wind<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>speed<span class="pl-pds">"</span></span>:<span class="pl-c1">7</span>,<span class="pl-s"><span class="pl-pds">"</span>deg<span class="pl-pds">"</span></span>:<span class="pl-c1">10</span>},</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-get-weather-response-json-LC10" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>clouds<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>all<span class="pl-pds">"</span></span>:<span class="pl-c1">90</span>},</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-get-weather-response-json-LC11" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>dt<span class="pl-pds">"</span></span>: <span class="pl-c1">1495359000</span>,</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-get-weather-response-json-LC12" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>sys<span class="pl-pds">"</span></span>: {<span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>:<span class="pl-c1">1</span>,<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>:<span class="pl-c1">7323</span>,<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>:<span class="pl-c1">0.0024</span>,<span class="pl-s"><span class="pl-pds">"</span>country<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>RU<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>sunrise<span class="pl-pds">"</span></span>:<span class="pl-c1">1495328828</span>,<span class="pl-s"><span class="pl-pds">"</span>sunset<span class="pl-pds">"</span></span>:<span class="pl-c1">1495388778</span>},</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-get-weather-response-json-LC13" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-c1">524901</span>,</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-get-weather-response-json-LC14" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Moscow<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-get-weather-response-json-LC15" class="blob-code blob-code-inner js-file-line">  <span class="pl-s"><span class="pl-pds">"</span>cod<span class="pl-pds">"</span></span>: <span class="pl-c1">200</span></td>
      </tr>
      <tr>
        <td id="file-get-weather-response-json-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-get-weather-response-json-LC16" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">get-weather-response.json</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div><br></div></div><br><br><h1>  The last step: we put everything together </h1><br>  All that is left is to enable streaming recognition in Voximplant JavaScript scripts (we already <a href="https://habrahabr.ru/company/Voximplant/blog/310684/">wrote</a> about it), wait for the question from the user, make a request to NLP, get the name of the city, then make a request to the weather service, get a description of the weather and synthesize it into a call.  It will take less than a second for the user, and all this will provide this code: <br><br><div class="oembed"><script type="text/javascript" src="https://gist.github.com/52cd5f3098aea31d31da9a52f599492c.js"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-6a0c0e7fc2e433191d469ef5051df9f8.css"><div id="gist47999044" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-habr-weather-bot-329122-js" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-javascript ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-habr-weather-bot-329122-js-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-habr-weather-bot-329122-js-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">require</span>(<span class="pl-smi">Modules</span>.<span class="pl-c1">ASR</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-habr-weather-bot-329122-js-LC2" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-habr-weather-bot-329122-js-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">VoxEngine</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">AppEvents</span>.<span class="pl-smi">CallAlerting</span>, <span class="pl-k">function</span> (<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-habr-weather-bot-329122-js-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-habr-weather-bot-329122-js-LC5" class="blob-code blob-code-inner js-file-line">  mycall <span class="pl-k">=</span> <span class="pl-smi">e</span>.<span class="pl-smi">call</span>;</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-habr-weather-bot-329122-js-LC6" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">mycall</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">Connected</span>, handleCallConnected);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-habr-weather-bot-329122-js-LC7" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">mycall</span>.<span class="pl-en">answer</span>();</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-habr-weather-bot-329122-js-LC8" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-habr-weather-bot-329122-js-LC9" class="blob-code blob-code-inner js-file-line">});</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-habr-weather-bot-329122-js-LC10" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-habr-weather-bot-329122-js-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">handleCallConnected</span>() {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-habr-weather-bot-329122-js-LC12" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-habr-weather-bot-329122-js-LC13" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">mycall</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>,  ! ,       .<span class="pl-pds">"</span></span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>); </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-habr-weather-bot-329122-js-LC14" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-habr-weather-bot-329122-js-LC15" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">mycall</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, <span class="pl-k">function</span> <span class="pl-en">onWelcomeFinished</span>() {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-habr-weather-bot-329122-js-LC16" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">mycall</span>.<span class="pl-en">sendMediaTo</span>(myasr);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-habr-weather-bot-329122-js-LC17" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">mycall</span>.<span class="pl-c1">removeEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, onWelcomeFinished);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-habr-weather-bot-329122-js-LC18" class="blob-code blob-code-inner js-file-line">  });</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-habr-weather-bot-329122-js-LC19" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-habr-weather-bot-329122-js-LC20" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">mycall</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">Disconnected</span>, <span class="pl-smi">VoxEngine</span>.<span class="pl-smi">terminate</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-habr-weather-bot-329122-js-LC21" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-habr-weather-bot-329122-js-LC22" class="blob-code blob-code-inner js-file-line">  myasr <span class="pl-k">=</span> <span class="pl-smi">VoxEngine</span>.<span class="pl-en">createASR</span>({</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-habr-weather-bot-329122-js-LC23" class="blob-code blob-code-inner js-file-line">    lang<span class="pl-k">:</span> <span class="pl-smi">ASRLanguage</span>.<span class="pl-c1">RUSSIAN_RU</span></td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-habr-weather-bot-329122-js-LC24" class="blob-code blob-code-inner js-file-line">  });</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-habr-weather-bot-329122-js-LC25" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-habr-weather-bot-329122-js-LC26" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">myasr</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">ASREvents</span>.<span class="pl-smi">Result</span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-habr-weather-bot-329122-js-LC27" class="blob-code blob-code-inner js-file-line">    <span class="pl-en">recognitionEnded</span>();</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-habr-weather-bot-329122-js-LC28" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">var</span> userSpeech <span class="pl-k">=</span> <span class="pl-smi">e</span>.<span class="pl-c1">text</span>;</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-habr-weather-bot-329122-js-LC29" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Net</span>.<span class="pl-en">httpRequest</span>(<span class="pl-s"><span class="pl-pds">"</span>https://api.api.ai/v1/query<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-habr-weather-bot-329122-js-LC30" class="blob-code blob-code-inner js-file-line">      res <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(<span class="pl-smi">e</span>.<span class="pl-c1">text</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-habr-weather-bot-329122-js-LC31" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">res</span>.<span class="pl-smi">result</span> <span class="pl-k">||</span> <span class="pl-smi">res</span>.<span class="pl-smi">result</span>.<span class="pl-c1">action</span> <span class="pl-k">!==</span> <span class="pl-s"><span class="pl-pds">"</span>weather<span class="pl-pds">"</span></span>){</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-habr-weather-bot-329122-js-LC32" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">mycall</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>-   .    .<span class="pl-pds">"</span></span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-habr-weather-bot-329122-js-LC33" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">mycall</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, firstPlaybackFinished);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-habr-weather-bot-329122-js-LC34" class="blob-code blob-code-inner js-file-line">      }</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-habr-weather-bot-329122-js-LC35" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">else</span> <span class="pl-k">if</span> (<span class="pl-k">!</span><span class="pl-smi">res</span>.<span class="pl-smi">result</span>.<span class="pl-smi">parameters</span> <span class="pl-k">||</span> <span class="pl-k">!</span><span class="pl-smi">res</span>.<span class="pl-smi">result</span>.<span class="pl-smi">parameters</span>.<span class="pl-smi">address</span> <span class="pl-k">||</span> <span class="pl-k">!</span><span class="pl-smi">res</span>.<span class="pl-smi">result</span>.<span class="pl-smi">parameters</span>.<span class="pl-smi">address</span>.<span class="pl-smi">city</span> ){</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-habr-weather-bot-329122-js-LC36" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">mycall</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>      .<span class="pl-pds">"</span></span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-habr-weather-bot-329122-js-LC37" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">mycall</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, firstPlaybackFinished);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-habr-weather-bot-329122-js-LC38" class="blob-code blob-code-inner js-file-line">      }</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-habr-weather-bot-329122-js-LC39" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">else</span> {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-habr-weather-bot-329122-js-LC40" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">var</span> city <span class="pl-k">=</span> <span class="pl-smi">res</span>.<span class="pl-smi">result</span>.<span class="pl-smi">parameters</span>.<span class="pl-smi">address</span>.<span class="pl-smi">city</span>;</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-habr-weather-bot-329122-js-LC41" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Net</span>.<span class="pl-en">httpRequest</span>(<span class="pl-s"><span class="pl-pds">"</span>http://api.openweathermap.org/data/2.5/weather?q=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> city <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>&amp;lang=ru&amp;appid=a9fa46a8d49e57dbb4ba2d60cb934782<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-habr-weather-bot-329122-js-LC42" class="blob-code blob-code-inner js-file-line">          <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-habr-weather-bot-329122-js-LC43" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> weather <span class="pl-k">=</span> <span class="pl-smi">e</span>.<span class="pl-c1">text</span>;</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-habr-weather-bot-329122-js-LC44" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">var</span> weatherDescription <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(weather);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-habr-weather-bot-329122-js-LC45" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">mycall</span>.<span class="pl-en">say</span>(<span class="pl-s"><span class="pl-pds">"</span>   <span class="pl-pds">"</span></span> <span class="pl-k">+</span> city <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> - <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">weatherDescription</span>.<span class="pl-smi">weather</span>[<span class="pl-c1">0</span>].<span class="pl-c1">description</span>, <span class="pl-smi">Language</span>.<span class="pl-c1">RU_RUSSIAN_FEMALE</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-habr-weather-bot-329122-js-LC46" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">mycall</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>, <span class="pl-k">function</span>() {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-habr-weather-bot-329122-js-LC47" class="blob-code blob-code-inner js-file-line">              <span class="pl-smi">VoxEngine</span>.<span class="pl-c1">terminate</span>();</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-habr-weather-bot-329122-js-LC48" class="blob-code blob-code-inner js-file-line">            });</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-habr-weather-bot-329122-js-LC49" class="blob-code blob-code-inner js-file-line">          });</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-habr-weather-bot-329122-js-LC50" class="blob-code blob-code-inner js-file-line">      }</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-habr-weather-bot-329122-js-LC51" class="blob-code blob-code-inner js-file-line">    }, </td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-habr-weather-bot-329122-js-LC52" class="blob-code blob-code-inner js-file-line">    { headers<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">"</span>Authorization: bearer 732ae2b69fbf4da3a885714630b47d67<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-habr-weather-bot-329122-js-LC53" class="blob-code blob-code-inner js-file-line">                <span class="pl-s"><span class="pl-pds">"</span>Content-Type: application/json; charset=utf-8<span class="pl-pds">"</span></span>],</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-habr-weather-bot-329122-js-LC54" class="blob-code blob-code-inner js-file-line">      method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>POST<span class="pl-pds">"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-habr-weather-bot-329122-js-LC55" class="blob-code blob-code-inner js-file-line">      postData<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>{'query': '<span class="pl-pds">"</span></span> <span class="pl-k">+</span> userSpeech <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>', 'lang': 'ru', 'sessionId': '1'}<span class="pl-pds">"</span></span> });</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-habr-weather-bot-329122-js-LC56" class="blob-code blob-code-inner js-file-line">  });</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-habr-weather-bot-329122-js-LC57" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-habr-weather-bot-329122-js-LC58" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-habr-weather-bot-329122-js-LC59" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">recognitionEnded</span>() {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-habr-weather-bot-329122-js-LC60" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">myasr</span>.<span class="pl-c1">stop</span>();</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-habr-weather-bot-329122-js-LC61" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-habr-weather-bot-329122-js-LC62" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-habr-weather-bot-329122-js-LC63" class="blob-code blob-code-inner js-file-line"><span class="pl-k">function</span> <span class="pl-en">firstPlaybackFinished</span>(<span class="pl-smi">e</span>) {</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-habr-weather-bot-329122-js-LC64" class="blob-code blob-code-inner js-file-line">  <span class="pl-smi">mycall</span>.<span class="pl-c1">removeEventListener</span>(<span class="pl-smi">CallEvents</span>.<span class="pl-smi">PlaybackFinished</span>);</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-habr-weather-bot-329122-js-LC65" class="blob-code blob-code-inner js-file-line">  <span class="pl-en">handleCallConnected</span>();</td>
      </tr>
      <tr>
        <td id="file-habr-weather-bot-329122-js-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-habr-weather-bot-329122-js-LC66" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="" style="float:right">view raw</a>
        <a href="">habr--weather-bot-329122.js</a>
        hosted with ‚ù§ by <a href="">GitHub</a>
      </div>
    </div>
</div>
</div></div><p>Source: <a href="https://habr.com/ru/post/329122/">https://habr.com/ru/post/329122/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329106/index.html">Fluent Design (not) shifting paradigms</a></li>
<li><a href="../329108/index.html">7 ways to display video from an RTSP IP camera on a webpage and 2 in a mobile application</a></li>
<li><a href="../329110/index.html">Terminology. Fight against complexity</a></li>
<li><a href="../329118/index.html">3CX technical support responds: how to get the credentials of the 3CX user portal and how to change the FQDN of the PBX server</a></li>
<li><a href="../329120/index.html">[Java Archeology] Context-dependent inlayning of traces in Java</a></li>
<li><a href="../329124/index.html">New life utility</a></li>
<li><a href="../329128/index.html">Another logging system, now on ElasticSearch, Logstash, Kibana and Prometheus</a></li>
<li><a href="../329130/index.html">The digest of interesting materials for Mobile Developer # 204 (May 15-21)</a></li>
<li><a href="../329132/index.html">Big data for big science. Lecture in Yandex</a></li>
<li><a href="../329134/index.html">Palmistry UX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>