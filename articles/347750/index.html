<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn OpenGL. Lesson 4.6 - Cubic cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cubic cards 
 Until now, we have had to use only two-dimensional textures, however, OpenGL supports many more texture types. And in this lesson we wil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn OpenGL. Lesson 4.6 - Cubic cards</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c9e/9b2/a3b/c9e9b2a3baf749ab8e2b385c6d93d966.png" alt="Ogl3" align="left" width="300"><h1>  Cubic cards </h1><br>  Until now, we have had to use only two-dimensional textures, however, OpenGL supports many more texture types.  And in this lesson we will look at the type of texture map, in fact, a combination of several separate textures - this is a <i>cubemap</i> . <br><br>  A cubic map, in fact, is one texture object containing 6 separate two-dimensional textures, each of which corresponds to the side of a textured cube.  Why can such a cube come in handy?  Why stitch six separate textures into one map instead of using separate texture objects?  The bottom line is that samples from a cubic map can be made using the direction vector. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  Part 1. Start <br><br><ol><li>  <a href="https://habrahabr.ru/post/310790/">Opengl</a> </li><li>  <a href="https://habrahabr.ru/post/311198/">Creating a window</a> </li><li>  <a href="https://habrahabr.ru/post/311234/">Hello window</a> </li><li>  <a href="https://habrahabr.ru/post/311808/">Hello triangle</a> </li><li>  <a href="https://habrahabr.ru/post/313380/">Shaders</a> </li><li>  <a href="https://habrahabr.ru/post/315294/">Textures</a> </li><li>  <a href="https://habrahabr.ru/post/319144/">Transformations</a> </li><li>  <a href="https://habrahabr.ru/post/324968/">Coordinate systems</a> </li><li>  <a href="https://habrahabr.ru/post/327604/">Camera</a> </li></ol><br>  Part 2. Basic lighting 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/329592/">Colors</a> </li><li>  <a href="https://habrahabr.ru/post/333932/">Lighting Basics</a> </li><li>  <a href="https://habrahabr.ru/post/336166/">Materials</a> </li><li>  <a href="https://habrahabr.ru/post/337550/">Texture Cards</a> </li><li>  <a href="https://habrahabr.ru/post/337642/">Sources of light</a> </li><li>  <a href="https://habrahabr.ru/post/338254/">Multiple light sources</a> </li></ol><br>  Part 3. Loading 3D Models <br><br><ol><li>  <a href="https://habrahabr.ru/post/338436/">Assimp library</a> </li><li>  <a href="https://habrahabr.ru/post/338436/">Mesh mesh class</a> </li><li>  <a href="https://habrahabr.ru/post/338998/">Model class</a> </li></ol><br>  Part 4. OpenGL advanced features <br><br><ol><li>  <a href="https://habrahabr.ru/post/342610/">Depth test</a> </li><li>  <a href="https://habrahabr.ru/post/344238/">Stencil test</a> </li><li>  <a href="https://habrahabr.ru/post/343096/">Mixing colors</a> </li><li>  <a href="https://habrahabr.ru/post/346964/">Face clipping</a> </li><li>  <a href="https://habrahabr.ru/post/347354/">Frame buffer</a> </li></ol></div></div><br>  Imagine a single cube (a cube with sides of 1x1x1 units) from the center of which the direction vector comes out.  A texture sample from a cubic map with the orange direction vector inside would look like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kk/sd/xf/kksdxf7kfvzoab4g--uizediw48.png"></div><br><blockquote>  The length of the direction vector is not important.  OpenGL is enough to know the direction to conduct the correct final sample from the texture. <br></blockquote><br>  If we imagine the shape of the cube on which the cubic map is stretched, then it turns out that the direction vector indicating the sample area looks similar to the interpolated coordinates of the cube vertices.  With this in mind, we can make samples from the map using the data of the coordinates of the cube, it is only necessary that the cube itself remains symmetrically located relative to the origin.  In this case, the texture coordinates of the cube vertices can be taken equal to the position vectors of the cube vertices.  As a result, the texture coordinates correctly refer to the textures of individual faces of the cube. <br><br><h3>  Create a cubic map </h3><br>  A cubic map, like any other texture object, is created according to the already familiar rules: we create the texture object directly and link it to a suitable texture target ( <i>texture target</i> ) before performing any operations on the texture.  In our case, the anchor point is <i>GL_TEXTURE_CUBE_MAP</i> : <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> textureID; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;textureID); glBindTexture(GL_TEXTURE_CUBE_MAP, textureID);</code> </pre> <br>  Since the cubic card is a combination of six separate texture images, we will have to make six calls to <i>glTexImage2D</i> with a set of parameters similar to those used in previous lessons.  This time, however, in each call, the value of the texture target parameter will take one of the special values ‚Äã‚Äãassociated with each face of the cube map.  In fact, we are reporting OpenGL for which of the faces we are creating a texture image.  And so six times: one <i>glTexImage2D</i> on each side. <br><br>  Since there are only six faces, OpenGL has six special texture targets, specifically responsible for creating textures for all faces of a cube map: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wa/tn/tu/watntua9zg3nyrbkjdyjpvipkg0.png"></div><br>  Often, the enumeration elements (enum) of OpenGL have numeric values ‚Äã‚Äãthat vary linearly.  In the case of the listed elements, this is also true.  This will allow us to easily initialize textures for all faces using a simple loop that starts with a texture target of <i>GL_TEXTURE_CUBE_MAP_POSITIVE_X</i> and with each pass simply increases the value of the target by 1: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width, height, nrChannels; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *data; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(GLuint i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; textures_faces.size(); i++) { data = stbi_load(textures_faces[i].c_str(), &amp;width, &amp;height, &amp;nrChannels, <span class="hljs-number"><span class="hljs-number">0</span></span>); glTexImage2D( GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, width, height, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, GL_UNSIGNED_BYTE, data ); }</code> </pre> <br>  Here we use a vector called <i>textured_faces</i> , which contains the paths to all the texture files needed to define a cubic map in the order corresponding to the order of identifiers of faces from the table.  This will create textures for each of the faces of the currently linked cube map. <br><br>  A cubic map texture object has all the same properties as any texture, so it doesn‚Äôt hurt to set up texture filtering and repeating modes: <br><br><pre> <code class="cpp hljs">glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);</code> </pre> <br>  Do not be surprised at the unfamiliar <i>GL_TEXTURE_WRAP_R</i> parameter - it just adjusts the repetition mode on the third texture coordinate (a-z coordinate for positions).  We use the <i>GL_CLAMP_TO_EDGE</i> repetition <i>mode</i> , because texture coordinates that are exactly between two edges can lead to the lack of a correct sample (due to some hardware limitations).  This selected repetition mode allows you to return a value from the texture boundary, even in cases of samples between the edges of the map. <br><br>  Before rendering objects using a cubic map, we must specify the used texture unit and bind the cubic map.  Everything is exactly the same as in the cases with 2D textures. <br><br>  In the fragment shader code, you will have to change the sampler type to <i>samplerCube</i> , since in the texture function we will pass a three-dimensional vector of texture coordinates instead of a two-dimensional one.  An example of a shader code using a cubic map below: <br><br><pre> <code class="cpp hljs">in vec3 textureDir; <span class="hljs-comment"><span class="hljs-comment">//  ,      uniform samplerCube cubemap; //     void main() { FragColor = texture(cubemap, textureDir); }</span></span></code> </pre> <br>  Well, all this is entertaining, but for now it seems useless.  Do not rush to conclusions, some wonderful effects are very easy to implement using cubic cards.  One of them is the creation of a skybox. <br><br><h2>  Skybox </h2><br>  A skybox is a huge cube that encloses the entire current scene, which is textured by six images of the surrounding scene environment and creates for the player the illusion that the scene in which he is located is much more than it actually is.  Usually skyboxes in games are realized using images of mountains, a cloudy or night sky - all this, I think, is familiar to you.  For example, a skybox with a night sky texture from the third part of TES: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/r1/z4/ocr1z4d_0inahxpoynf6vlnf3po.jpeg"></div><br>  I think you have already guessed that the cubic cards simply ask themselves to be used here: we have a cube with six edges and the need to correctly texture it in accordance with the edge.  In the previous screenshot, only a few images of the night sky gave the player the effect of being in a huge universe, although in reality he is a prisoner of a tiny cube. <br><br>  There are enough resources in the network where you can find texture sets prepared for skyboxes.  For example, <a href="http://www.custommapmakers.org/skyboxes.php">here</a> and <a href="http://www.humus.name/index.php%3Fpage%3DTextures">here</a> they are enough for many experiments.  Often, the skybox textures laid out on the network follow the following presentation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n4/yo/ed/n4yoedxykkjzx-5xtn7nmc--ofy.png"></div><br>  If you fold the image along the boundaries (bending the edges ‚Äúbehind the screen‚Äù), then a completely ottuksturirovanny cube will be released, inside which a feeling of large space is created.  Some resources follow this texture layout, so you will need to cut six textures for individual faces.  But, in most cases, they are laid out with a set of six separate images. <br><br>  <a href="">Here</a> in good resolution you can download the texture for the skybox, which we will use in the lesson. <br><br><h3>  Skybox download </h3><br>  Since a skybox is represented as a cubic map, the loading process is not much different from what was already mentioned in the lesson.  The following function is used for loading. It accepts a vector with six paths to texture files: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadCubemap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; faces)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> textureID; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;textureID); glBindTexture(GL_TEXTURE_CUBE_MAP, textureID); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width, height, nrChannels; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; faces.size(); i++) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *data = stbi_load(faces[i].c_str(), &amp;width, &amp;height, &amp;nrChannels, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data) { glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, width, height, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, GL_UNSIGNED_BYTE, data ); stbi_image_free(data); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Cubemap texture failed to load at path: "</span></span> &lt;&lt; faces[i] &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; stbi_image_free(data); } } glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textureID; }</code> </pre> <br>  The function code should not be a surprise.  This is all the same code for working with a cubic card that was shown in the previous section, but put together in one function. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; faces; { <span class="hljs-string"><span class="hljs-string">"right.jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"left.jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"top.jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"bottom.jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"front.jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"back.jpg"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cubemapTexture = loadCubemap(faces);</code> </pre> <br>  Before calling the function itself, it is necessary to fill in the vector with the paths to the texture files, and in the order corresponding to the order of descriptions of the elements of the OpenGL enumeration describing the order of the faces of the cube map. <br><br><h3>  Skybox display </h3><br>  Since we cannot do without a cube object, we will need new VAO, VBO and an array of vertices, which can be downloaded <a href="https://learnopengl.com/code_viewer.php%3Fcode%3Dadvanced/cubemaps_skybox_data">here</a> . <br><br>  Samples from the cube map used to cover a three-dimensional cube can be made using the coordinates on the cube itself.  When a cube is symmetric about the origin, then each of the coordinates of its vertices also specifies the direction vector from the origin.  And this direction vector is used to select from the texture at the point corresponding to the top of the cube.  As a result, we don‚Äôt even have to pass texture coordinates to the shader! <br>  For the render you will need a new set of shaders, quite simple.  The vertex shader is trivial, only one vertex attribute is used, without texture coordinates: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#version 330 core layout (location = 0) in vec3 aPos; out vec3 TexCoords; uniform mat4 projection; uniform mat4 view; void main() { TexCoords = aPos; gl_Position = projection * view * vec4(aPos, 1.0); }</span></span></code> </pre> <br>  The interesting point here is that we reassign the input coordinates of the cube to a variable containing the texture coordinates for the fragment shader.  The fragment shader uses them for sampling with the <i>samplerCube</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#version 330 core out vec4 FragColor; in vec3 TexCoords; uniform samplerCube skybox; void main() { FragColor = texture(skybox, TexCoords); }</span></span></code> </pre> <br>  And this shader is pretty simple.  We take the transmitted coordinates of the vertices of the cube as texture coordinates and make a selection from the cube map. <br><br>  The render also does not contain anything tricky: we bind the cubic map as the current texture and the <i>skybox</i> sampler immediately receives the necessary data.  We will produce the skybox output first of all the objects in the scene, and also disable the depth test.  This ensures that the skybox will always be on the background of other objects. <br><br><pre> <code class="cpp hljs">glDepthMask(GL_FALSE); skyboxShader.use(); <span class="hljs-comment"><span class="hljs-comment">// ...      glBindVertexArray(skyboxVAO); glBindTexture(GL_TEXTURE_CUBE_MAP, cubemapTexture); glDrawArrays(GL_TRIANGLES, 0, 36); glDepthMask(GL_TRUE); // ...   </span></span></code> </pre> <br>  If you try to start the program right now, you will encounter the following problem.  In theory, we would like the skybox object to remain positioned symmetrically relative to the player‚Äôs position, no matter how far he moves - only there you can create the illusion that the environment depicted on the skybox is really huge.  But the view matrix that we use applies a complete set of transformations: rotation, scaling, and movement.  So if a player moves, the skybox also moves!  In order for the player‚Äôs actions not to affect the skybox, we would have to remove the movement information from the view matrix. <br><br>  Perhaps you will recall the <a href="https://learnopengl.com/Lighting/Basic-Lighting">introductory lesson</a> on lighting and the fact that we were able to get rid of information about the movement in 4x4 matrices by simply extracting the 3x3 submatrix.  You can repeat this trick by simply casting the dimensionality of the species matrix first to 3x3, then back to 4x4: <br><br><pre> <code class="cpp hljs">glm::mat4 view = glm::mat4(glm::mat3(camera.GetViewMatrix()));</code> </pre> <br>  The data on the offset will be removed, but the data of the other transformations will remain, which will allow the player to look normally around. <br><br>  As a result, we get a picture that conveys the feeling of large space due to the skybox.  Having flown near the container you will feel this sense of scale, which rather adds realism to the whole scene: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zf/m0/g5/zfm0g5wzijyzdsgltw-9ttfikk4.png"></div><br>  Try different texture selections and appreciate the effect they have on the sensations from the scene. <br><br><h3>  Skybox render optimization </h3><br>  As noted, the skybox is rendered in front of all the other objects in the scene.  Works with a bang, but not too economically on resources.  Judge for yourself: when outputting in advance, we will have to execute a fragmentary shader for all pixels of the screen, although in the final scene only some of them will remain visible, and most could be discarded using an early depth test, saving us valuable resources. <br><br>  So, for efficiency reasons, the skybox should be displayed last.  In this case, the depth buffer will be filled with the depth values ‚Äã‚Äãof all the objects in the scene, and the skybox will only be displayed where the early depth test was successful, saving us the challenges of the fragment shader.  But there is a catch: most likely nothing will get into the frame at all, since the skybox is just a 1x1x1 cube and it will fail most of the depth tests.  It is also impossible to disable the depth test before rendering, because the skybox will simply be displayed over the stage.  You need to force the depth buffer to believe that the depth of the entire skybox is 1, so that the depth test fails if there is another object in front of the skybox. <br><br>  In the lesson on <a href="https://learnopengl.com/Getting-started/Coordinate-Systems">coordinate systems,</a> we mentioned that the perspective division is made after the execution of the vertex shader and produces the division of the <i>xyz</i> components of the vector <i>gl_Positions</i> by the value of the component <i>w</i> .  Also, from the <a href="https://learnopengl.com/Advanced-OpenGL/Depth-testing">depth test,</a> we know that the component <i>z</i> obtained after dividing is equal to the depth of the given vertex.  Using this information, we can set the <i>z</i> component of the vector <i>gl_Positions</i> to be the component <i>w</i> , which, after perspective division, will give us a depth value everywhere equal to 1: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TexCoords = aPos; vec4 pos = projection * view * vec4(aPos, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); gl_Position = pos.xyww; }</code> </pre> <br>  As a result, in the normalized coordinates of the device, the vertex will always have a component <i>z</i> = 1, which is the maximum value in the depth buffer.  And the skybox will be displayed only in areas of the screen where there are no other objects (only here the depth test will be passed, because at other points the skybox overlaps something). <br><br>  However, we need to change the type of the depth function to <i>GL_LEQUAL</i> instead of the standard <i>GL_LESS</i> .  The cleaned depth buffer is filled with the default value of 1, as a result, it is necessary to ensure that the skybox passes the test for depth values ‚Äã‚Äãnot strictly smaller than those stored in the buffer, but less or equal. <br><br>  The code using this optimization can be found <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/4.advanced_opengl/6.1.cubemaps_skybox/cubemaps_skybox.cpp">here</a> . <br><br><h2>  Environment mapping </h2><br>  So, a cubic map contains information about the surroundings of the scene, projected into one texture object.  Such an object can be useful not only for the manufacture of skyboxes.  Using a cubic map with a surrounding texture, you can simulate the reflective or refractive properties of objects.  Such techniques that use cubic maps are called environment mapping techniques and the most widely known of them: imitation of reflection and refraction. <br><br><h3>  Reflection </h3><br>  Reflection is the property of an object to display the surrounding space, i.e.  Depending on the angle of observation, the object acquires colors that are more or less identical to those of the environment.  The mirror is a perfect example: it reflects the environment depending on the direction of the observer‚Äôs gaze. <br><br>  The basics of physics of reflections are not too complicated.  The following image shows how to find the reflection vector and use it to sample from a cubic map: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zh/8k/qy/zh8kqygbo4rsdrygvia3z1uzw0c.png"></div><br>  Reflection vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>R</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.932ex" height="2.419ex" viewBox="0 -780.1 7290 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="1398" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6E" x="1865" y="0"></use></g><g transform="translate(4870,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-52" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>R</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-1"> \ color {green} {\ bar {R}} </script>  is based on the direction of sight <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>I</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.163ex" height="2.419ex" viewBox="0 -780.1 6528.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-79" x="1461" y="0"></use></g><g transform="translate(4363,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-49" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>I</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ color {gray} {\ bar {I}} </script>  relative to the normal vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mi>e</mi><mi>d</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.853ex" height="2.057ex" viewBox="0 -780.1 6395 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="451" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-64" x="918" y="0"></use></g><g transform="translate(3846,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-4E" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mi>e</mi><mi>d</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ color {red} {\ bar {N}} </script>  .  Direct calculation can be carried out using the built-in GLSL <i>reflect ()</i> function.  The resulting vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>R</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.932ex" height="2.419ex" viewBox="0 -780.1 7290 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="1398" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6E" x="1865" y="0"></use></g><g transform="translate(4870,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-52" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>R</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-4"> \ color {green} {\ bar {R}} </script>  then it can be used as a direction vector for sampling a reflected color value from a cube map.  As a result, the object will look as if it reflects the skybox surrounding it. <br><br>  Since the skybox in our scene has already been prepared, the creation of reflections is not very difficult.  Slightly modify the fragment shader used by the container to give it reflective properties: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#version 330 core out vec4 FragColor; in vec3 Normal; in vec3 Position; uniform vec3 cameraPos; uniform samplerCube skybox; void main() { vec3 I = normalize(Position - cameraPos); vec3 R = reflect(I, normalize(Normal)); FragColor = vec4(texture(skybox, R).rgb, 1.0); }</span></span></code> </pre> <br>  First, we calculate the direction vector of the camera (glance) <i>I</i> and use it to calculate the reflection vector <i>R</i> , which is used for sampling from the cube map.  We again use the interpolated <i>Normal</i> and <i>Position</i> values, so we have to clarify the vertex shader as well: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#version 330 core layout (location = 0) in vec3 aPos; layout (location = 1) in vec3 aNormal; out vec3 Normal; out vec3 Position; uniform mat4 model; uniform mat4 view; uniform mat4 projection; void main() { Normal = mat3(transpose(inverse(model))) * aNormal; Position = vec3(model * vec4(aPos, 1.0)); gl_Position = projection * view * model * vec4(aPos, 1.0); }</span></span></code> </pre> <br>  Since  normals are used again, their transformation requires the return of the use of the matrix of normals.  <i>Position</i> vector contains world coordinates of a vertex.  It will be used in the fragment shader to calculate the gaz direction vector. <br><br>  Due to the presence of the normals, you will have to update the <a href="https://learnopengl.com/code_viewer.php%3Fcode%3Dlighting/basic_lighting_vertex_data">vertex data array</a> used as well as update the code associated with the configuration of the vertex attribute pointers.  Also, do not forget to set the cameraPos <i>uniform</i> for each iteration of the render. <br><br>  Before the withdrawal of the container, you should bind the object of the cubic map: <br><br><pre> <code class="cpp hljs">glBindVertexArray(cubeVAO); glBindTexture(GL_TEXTURE_CUBE_MAP, skyboxTexture); glDrawArrays(GL_TRIANGLES, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">36</span></span>);</code> </pre> <br>  As a result of the program, we get a cube, leading as a perfect mirror, reflecting the whole environment. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w2/le/zu/w2lezuv4ywwybt9d0ojiktf6xni.png"></div><br>  The source code is <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/4.advanced_opengl/6.2.cubemaps_environment_mapping/cubemaps_environment_mapping.cpp">here</a> . <br><br>  When a similar special effect is assigned to an entire object, it looks like it is made of highly reflective material like polished steel or chrome.  If you load a nanosuit model from a lesson on <a href="https://learnopengl.com/Model-Loading/Model">model loading</a> , then the whole suit will look all-metal: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ke/e_/4h/kee_4hbumaynrwovu6fcn7bud04.png"></div><br>  It looks awesome, but in reality it is rarely what object is completely mirrored.  But you can put in the use of a reflection map that will add a bit more detail to the models.  Like diffuse and specular maps, this type of map is a regular texture, the selection of which determines the degree of specular reflection for the fragment.  With their help, you can specify areas of the model that have a mirror image and its intensity.  In the exercises for this lesson, you will be offered the task of adding a reflection map to the model loader developed earlier. <br><br><h3>  Refraction </h3><br>  Another form of displaying the environment is refraction, which is somewhat similar to reflection.  Refraction is a change in the direction of movement of a beam of light caused by its transition through the interface between two media.  It is refraction that gives the effect of changing the direction of light in liquid media, which is easily noticeable if you submerge half of the hand. <br><br>  Refraction is described <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD_%25D0%25A1%25D0%25BD%25D0%25B5%25D0%25BB%25D0%25BB%25D0%25B8%25D1%2583%25D1%2581%25D0%25B0">by Snell's law</a> , in combination with a cubic map that looks like the following: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/iw/jp/ea/iwjpeamqbk_ij6ccgxwgmt_5tds.png"></div><br>  Again, we have a vector of observation <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>I</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.163ex" height="2.419ex" viewBox="0 -780.1 6528.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-79" x="1461" y="0"></use></g><g transform="translate(4363,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-49" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>a</mi><mi>y</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>I</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5"> \ color {gray} {\ bar {I}} </script>  normal vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mi>e</mi><mi>d</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.853ex" height="2.057ex" viewBox="0 -780.1 6395 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="451" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-64" x="918" y="0"></use></g><g transform="translate(3846,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-4E" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mi>e</mi><mi>d</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ color {red} {\ bar {N}} </script>  and the final refraction vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>R</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.932ex" height="2.419ex" viewBox="0 -780.1 7290 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="1398" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6E" x="1865" y="0"></use></g><g transform="translate(4870,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-52" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>R</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-7"> \ color {green} {\ bar {R}} </script>  .  As can be seen, the direction of the gaze vector is distorted due to refraction.  And it is the modified vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>R</mi></mrow></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="16.932ex" height="2.419ex" viewBox="0 -780.1 7290 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6C" x="1169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6F" x="1467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1953" y="0"></use><g transform="translate(2404,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="932" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-65" x="1398" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-6E" x="1865" y="0"></use></g><g transform="translate(4870,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-62" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-61" x="679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-72" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/347750/&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiY5ill2JSUCl53sFt6oZ8efMyjSA#MJMATHI-52" x="1660" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>R</mi></mrow></mrow></math></span></span><script type="math/tex" id="MathJax-Element-8"> \ color {green} {\ bar {R}} </script>  will be used to sample from the cube map. <br><br>  The refraction vector is easy to calculate using another GLSL built-in function - <i>refract ()</i> , which takes the normal vector, the gaze direction vector and the ratio of the refractive indices of the adjacent materials. <br><br>  The refractive index determines the degree of deviation of the direction of the beam of light that follows through the material.  Each substance has its own coefficient, here are a few examples: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/am/jc/h1/amjch1j0_ih77akchtyh3iemlf0.png"></div><br>  The data from the table are used to calculate the relationship between the refractive indices of the materials through which the light passes.  In our case, the beam passes from the air into the glass (we will agree that our container is glass), so the ratio is 1 / 1.52 = 0.658. <br><br>  The cubic map is already attached to us, the vertex data, including the normals, are loaded, and the camera position is transferred to the corresponding uniforms.  It only remains to change the fragment shader: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ratio = <span class="hljs-number"><span class="hljs-number">1.00</span></span> / <span class="hljs-number"><span class="hljs-number">1.52</span></span>; vec3 I = normalize(Position - cameraPos); vec3 R = refract(I, normalize(Normal), ratio); FragColor = vec4(texture(skybox, R).rgb, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); }</code> </pre> <br>  By changing the values ‚Äã‚Äãof the refractive indices, you can create completely different visual effects.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When launching the application, unfortunately, we are not waiting for a particularly impressive picture, since the glass cube does not emphasize the refractive effect too much and just looks like a cubic magnifying glass. </font><font style="vertical-align: inherit;">Another thing, if you use the nanosuit model - it becomes immediately clear that the object is made of a substance like glass:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ow/5s/r3/ow5sr3-ymbr1krijoaxrudv-pfs.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It can be imagined that with the help of masterly application of lighting, reflection, refraction and transformation of the peaks, a very impressive simulation of the water surface can be achieved. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, it is worth noting that for physically reliable results we will need to simulate the second refraction as the beam exits from the back side of the object. </font><font style="vertical-align: inherit;">But for simple scenes, even a simplified refraction, taking into account only one side of the object, is quite enough.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Changing Environment Maps </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this lesson, we learned to use a combination of several images to create a skybox, which, although it looks great, does not take into account the possible presence of moving objects in the scene. Now it is imperceptible, since there is a single object in the scene. But if there is a reflecting object in the scene, surrounded by other objects, we would see only a reflection of the skybox, as if there were no other objects.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using off-screen frame buffers, it is possible to create a new cubic scene map from the point of standing of the reflecting object by rendering the scene in six directions. Such a dynamically created cubic map could be used to create realistic reflective or refracting surfaces in which other objects are visible. This technique is called the dynamic display of the environment, since we are preparing new cube maps, including the whole environment, right on the fly, in the rendering process.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The approach is wonderful, but with a significant drawback - the need for a sixfold rendering of the entire scene for each object using a cubic environment map. </font><font style="vertical-align: inherit;">This is a very significant blow to the performance of any application. </font><font style="vertical-align: inherit;">Modern applications are trying to make the most of static skyboxes and pre-calculated cubic maps, where possible, for an approximate implementation of the dynamic display of the environment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despite the fact that dynamic mapping is a great technique, you have to use a lot of tweaks and resourceful hacks to apply it in an application without significant performance drawdown.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Exercises </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try adding a reflection map to the model uploader created in the </font></font><a href="https://learnopengl.com/Model-Loading/Assimp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appropriate tutorial</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">These models of nanosuit, including the very texture of the reflection map, can be downloaded </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">I will note a few points:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assimp obviously doesn‚Äôt like reflection maps in most of the model formats, so we‚Äôll cheat a bit - we‚Äôll store the reflection map as a background light map. </font><font style="vertical-align: inherit;">Loading the map, respectively, will have to be performed with the transfer of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aiTextureType_AMBIENT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> texture </font><i><font style="vertical-align: inherit;">type</font></i><font style="vertical-align: inherit;"> in the material loading procedure.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A reflection map hastily created from a specular gloss map. </font><font style="vertical-align: inherit;">Therefore, in some places it is not well superimposed on the model.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Since the model loader already uses three texture units in the shader, you will have to use the fourth unit to bind the cube map, since the sample is taken from the same shader. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If everything is done correctly, the result will be as follows: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/sd/ro/jdsdrocqvrtqpd4by4g-xigr6ea.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the translator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth noting that when working with scans for skyboxes, you can run into significant orientation confusion, especially when naming textures by face names (‚Äúleft‚Äù, ‚Äúright‚Äù, ...), and not along axes directions (+ X - positiveX, posX; -X - negativeX, negX, ...). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a consequence of the fact that the specification of the expansion of cubic maps is rather ancient and goes to the specification of Pixar's RenderMan, where the cubic map uses a left-handed coordinate system and the cube itself collapses as if the observer were in the center. The very same OpenGL, as we remember, uses the right-handed coordinate system.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will have to recollect this either if the scan of the texture of interest does not match the one described here, or if there is a need to align the ‚Äúsides‚Äù of the cubic map relative to the world coordinates, as if it was collapsed with the observer inside. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the ‚Äúcross‚Äù of the ‚Äúcross‚Äù in the ‚ÄúSkybox‚Äù section, the front edge is considered as such from the point of view of the observer who is outside the cube, looking directly at him. In the code, it is loaded into the target corresponding to the positive semi-axis Z (in world coordinates). In the application, however, it turns out that from the inside of the cube we see an image mirrored along the X axis relative to what is depicted on the texture. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The author himself gives a link to </font></font><a href="http://www.custommapmakers.org/skyboxes.php"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the site where the scan used does not match the one shown in the lesson. </font><font style="vertical-align: inherit;">To bring them into line, you have to swap the right and left panels, turn the top panel clockwise by 90 ¬∞, and the bottom panel counterclockwise. </font></font><br><br><img src="https://habrastorage.org/webt/a6/l-/yz/a6l-yz2ondsbo3ldit5gl6d5gko.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sweeps from this </font></font><a href="http://www.humus.name/index.php%3Fpage%3DTextures"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site are</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> signed in accordance with the directions of the axes, and not the names of the faces. </font><font style="vertical-align: inherit;">All that is required is to rename the files in accordance with the local table. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Understanding the essence is easier in action - in the assembled application. </font><font style="vertical-align: inherit;">Sign images of cutting the skybox with the intended parties (out of curiosity, you can add texture axes) and see in the application how this will actually turn out.</font></font><br><br>  <b>PS</b> : We have a <a href="https://t.me/joinchat/Cpb05A46UPpMWdNVVCb4Vg">telegram-konf</a> to coordinate transfers.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If there is a desire to fit into the cycle, then you are welcome! </font></font></div><p>Source: <a href="https://habr.com/ru/post/347750/">https://habr.com/ru/post/347750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347738/index.html">Mobile devices from the inside. What is GPT?</a></li>
<li><a href="../347740/index.html">Front End Developer Checklist</a></li>
<li><a href="../347744/index.html">How to package a dependent library in obr when developing a plugin for Jira</a></li>
<li><a href="../347746/index.html">Chromium: memory leaks</a></li>
<li><a href="../347748/index.html">Object in a case or Optional in Java 8 and Java 9. Part 3: ‚ÄúWhat's added in Java 9‚Äù</a></li>
<li><a href="../347752/index.html">Spring AOP. Little question from the interview</a></li>
<li><a href="../347754/index.html">JavaScript proxy: beautiful and useful</a></li>
<li><a href="../347756/index.html">SuperJob IT meetup. Work with business requirements at different project scales</a></li>
<li><a href="../347758/index.html">Nonrandom chance, or Attack on PRNG in .NET</a></li>
<li><a href="../347760/index.html">And so it will do ... or how the data of 14 million Russians were in my hands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>