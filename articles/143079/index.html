<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What the .git directory hides from us</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So I was lucky to get acquainted with git. I repent, using Subversion, I knew how to do what I needed in IDEA or TortoiseSVN, but I didn‚Äôt even know w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What the .git directory hides from us</h1><div class="post__text post__text-html js-mediator-article">  So I was lucky to get acquainted with git.  I repent, using Subversion, I knew how to do what I needed in IDEA or TortoiseSVN, but I didn‚Äôt even know what was going on behind the scenes.  In this case, I decided to approach git more responsibly and carefully examine it before use.  Now I know which commands I should use to carry out my plans, but I don‚Äôt know how to do this in IDEA or TortoiseSVN. <br>  But I decided to go even further and find out what is happening in the .git directory itself.  It turned out to be so interesting and simple that I decided to share this with you. <a name="habracut"></a><br><br>  This is what git looks like after the git init command. <br><br><img src="https://habrastorage.org/storage2/6a9/f1a/b4e/6a9f1ab4e5581f550c76bfa1c3004d1b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is not all that you can see, as with further work other files and directories will appear.  For example, it looks like .git on my working draft. <br><br><img src="https://habrastorage.org/storage2/c61/010/c93/c61010c93bbb95c9857724c6d4891f8d.png"><br><br>  I will not describe the purpose of each file, but will highlight the main points. <br><br>  The most important elements are objects, refs, HEAD, index.  In order to understand what it is and what they eat, we will create several files, a directory, and add them to our repository. <br><br><h4>  Objects </h4><br>  Initially, the objects directory contains empty pack and info subdirectories and no files. <br><br>  Create a file in the working directory test.txt with the contents of the "test file version 1". <br><pre><code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'test file version 1'</span></span> &gt; test.txt</code> </pre> <br>  Add this file to the index. <br><pre> <code class="bash hljs">$ git add test.txt</code> </pre><br>  Now let's see what has changed in our repository. <br><pre> <code class="bash hljs">$ find .git/objects .git/objects/27/703ec79a98c1d097d5b1cd320befffa376e826</code> </pre><br>  A file has been added to the objects directory.  It should be noted that all files in this directory are git objects of a certain type. <br>  Let's look at the contents and type of this object using the cat-file command. <br><pre> <code class="bash hljs">$ git cat-file -p 2770 <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> file version 1 $ git cat-file -t 2770 blob</code> </pre><br>  This object is of type blob.  This is the initial presentation of data in Git - one file per storage unit with a name, which is calculated as the SHA1 hash of the content and the title of the object.  The first two SHA characters define a subdirectory of the file, the remaining 38 - the name.  This object simply stores a snapshot of the contents of the test.txt file. <br><br>  Further we see that the index file has appeared.  This is a binary file containing a list of indexed files and associated blob objects. <br><pre> <code class="bash hljs">$ git ls-files --stage 100644 27703ec79a98c1d097d5b1cd320befffa376e826 0 test.txt</code> </pre><br>  That is, the index contains all the necessary information for creating a tree object on a subsequent commit.  A tree object is another type of object in git.  A little later we will meet with him. <br>  Now add the new directory and the file new / new.txt <br><pre> <code class="bash hljs">$ mkdir new $ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"new file"</span></span> &gt; new/new.txt $ git add . $ find .git/objects -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f .git/objects/27/703ec79a98c1d097d5b1cd320befffa376e826 .git/objects/fa/49b077972391ad58037050f2a75f74e3671e92</code> </pre><br>  Let's find out the type of the new object and its contents. <br><pre> <code class="bash hljs">$ git cat-file -p fa49 new file $ git cat-file -t fa49 blob</code> </pre><br>  And look again at the index. <br><pre> <code class="bash hljs">$ git ls-files --stage 100644 fa49b077972391ad58037050f2a75f74e3671e92 0 new/new.txt 100644 27703ec79a98c1d097d5b1cd320befffa376e826 0 test.txt</code> </pre><br>  And now all this zakommitim. <br><pre> <code class="bash hljs">$ git commit -m <span class="hljs-string"><span class="hljs-string">"first commit"</span></span> [master (root-commit) cae1990] first commit 2 files changed, 2 insertions(+), 0 deletions(-) create mode 100644 new/new.txt create mode 100644 test.txt</code> </pre><br>  Now our repository contains 5 objects. <br><pre> <code class="bash hljs">$ find .git/objects -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f .git/objects/27/703ec79a98c1d097d5b1cd320befffa376e826 .git/objects/49/66bf4e5c88c5f9d149b45bb2f3099644701d93 .git/objects/ca/e19909974ee9e64f5787fe4ee89b9b8fe94ccf .git/objects/eb/85079ce7fd354ffc630f4a8e2991196cb3807f .git/objects/fa/49b077972391ad58037050f2a75f74e3671e92</code> </pre><br>  Added three more files.  Let's see what these files are. <br><pre> <code class="bash hljs">$ git cat-file -t 4966 tree $ git cat-file -p 4966 040000 tree eb85079ce7fd354ffc630f4a8e2991196cb3807f new 100644 blob 27703ec79a98c1d097d5b1cd320befffa376e826 test.txt $ git cat-file -t eb85 tree $ git cat-file -p eb85 100644 blob fa49b077972391ad58037050f2a75f74e3671e92 new.txt</code> </pre><br>  This is another type of git object - a tree object.  An object of this type contains one or more records pointing to another tree or to a blob object. <br>  Finally, the last object type is the commit object. <br><pre> <code class="bash hljs">$ git cat-file -p cae1 tree 4966bf4e5c88c5f9d149b45bb2f3099644701d93 author Ivan Ivanov &lt;i_ivanov@adam.net&gt; 1335783964 +0300 committer Ivan Ivanov &lt;i_ivanov@adam.net&gt; 1335783964 +0300 first commit</code> </pre><br>  We see the top-level tree I mentioned earlier, the name of the author and the committer and the commit message. <br>  Let's make a new change (in test.txt we change the text to ‚Äútest file version 2‚Äù) and commit it.  In addition to the link to the tree, there was also a link to the previous commit. <br><pre> <code class="bash hljs">$ git cat-file -p b303 tree 42e998096f18d4249dc00ec89eaaadc44a8bf3cb parent cae19909974ee9e64f5787fe4ee89b9b8fe94ccf author Ivan Ivanov &lt;i_ivanov@adam.net&gt; 1335786789 +0300 committer Ivan Ivanov &lt;i_ivanov@adam.net&gt; 1335786789 +0300 second commit</code> </pre><br><br>  To make everything fall into place, draw a graph of objects <br><img src="https://habrastorage.org/storage2/783/2fe/483/7832fe483b9e2b40d5bc87178155dc7d.png"><br><br><h4>  Links </h4><br>  In git, a link is a pointer file with a simple name that contains the value of the SHA-1 hash.  These files are located in the directory .git / refs / <br><pre> <code class="bash hljs">$ find .git/refs .git/refs .git/refs/heads .git/refs/heads/master .git/refs/tags</code> </pre><br>  Since we have only one master branch, the link is also only one, which indicates the last commit. <br>  Let's make a brunch release pointing to the first commit. <br><pre> <code class="bash hljs">$ git branch release cae1990 $ find .git/refs .git/refs .git/refs/heads .git/refs/heads/master .git/refs/heads/release .git/refs/tags $ cat .git/refs/heads/release cae19909974ee9e64f5787fe4ee89b9b8fe94ccfa</code> </pre><br>  That's basically what a branch in git is - a simple pointer to a particular commit. <br>  Let's see more clearly <br><img src="https://habrastorage.org/storage2/49b/d71/b27/49bd71b27eb2c92abb08ea1399452ef2.png"><br><br><h4>  HEAD </h4><br>  This file contains a link not to the hash, but to the current branch. <br><pre> <code class="bash hljs">$ cat .git/HEAD ref: refs/heads/master</code> </pre><br>  If you move to another branch, then the content of this file will change. <br><pre> <code class="bash hljs">$ git co release Switched to branch <span class="hljs-string"><span class="hljs-string">'release'</span></span> $ cat .git/HEAD ref: refs/heads/release</code> </pre><br><br><h4>  Instead of the total </h4><br>  And there are more tags, deleted links, the info directory and many many tasty things. </div><p>Source: <a href="https://habr.com/ru/post/143079/">https://habr.com/ru/post/143079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143073/index.html">Escape from the data center: how we transferred the site to another data center in an emergency order</a></li>
<li><a href="../143075/index.html">Siri on the protection of a stolen iPhone</a></li>
<li><a href="../143076/index.html">UK court closed access to The Pirate Bay</a></li>
<li><a href="../143077/index.html">My first Android project, my first Android customer</a></li>
<li><a href="../143078/index.html">Symantec: religious sites have more viruses than porn sites</a></li>
<li><a href="../143080/index.html">Santa Claus task and practical logistics</a></li>
<li><a href="../143081/index.html">Do your children aged 3 to 12 have a tablet computer?</a></li>
<li><a href="../143082/index.html">Standalone Last.fm scrobbler</a></li>
<li><a href="../143083/index.html">Save memory with UKSM</a></li>
<li><a href="../143085/index.html">Free library for integration of 1C and Asterisk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>