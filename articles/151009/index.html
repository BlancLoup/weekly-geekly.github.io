<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I made friends with Unity3D and F #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I became more and more interested in functional programming, and when choosing a language before me, I chose among two languages ‚Äã‚ÄãI really ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I made friends with Unity3D and F #</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/c5b/015/a2f/c5b015a2ff38be3eb814821840f5e76d.jpg"><br><p>  Recently, I became more and more interested in functional programming, and when choosing a language before me, I chose among two languages ‚Äã‚ÄãI really liked - <a href="http://ru.wikipedia.org/wiki/Haskell">Haskell</a> and <a href="http://ru.wikipedia.org/wiki/FSharp">F #</a> . <br>  In F #, I was seduced by the fact that it can be compiled into an MSIL build, which makes it possible to use the F # class libraries in other Microsoft .Net languages, and also that it can use them.  Everything else, I am also a beginning Unity3D developer, and a thought came to my mind: if I compiled into MSIL, can I use F # scripts in Unity?  Googling gave the answer: humanly it is impossible.  You can create a class library, put in the project links to the UnityEngine.dll library, compile and import as an <a href="http://docs.unity3d.com/Documentation/Manual/AssetImportandCreation.html">asset</a> , and then add Mono-behaviour components directly from the library, but this is not very convenient, agree.  However, after going through Google, Reflection and <a href="http://docs.unity3d.com/Documentation/ScriptReference/">Help on Unity</a> , I still managed to bring (but not repeat exactly) the work with F # scripts inside the editor to the form in which the work with scripts in the built-in languages ‚Äã‚Äãis performed.  Details - under habrakat. </p><br><a name="habracut"></a><br><habracut><br><h1>  Part zero </h1><br>  I admit that I did something wrong (and most likely it is), and there may be both gross and not very much mistakes (nevertheless, I will be glad to know about them or how to do something other action is better / more beautiful).  There may also be the <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD_%25D0%259C%25D1%2591%25D1%2580%25D1%2584%25D0%25B8">effect of a telemaster</a> and you simply won‚Äôt get those errors / glitches that I describe in this article.  I simply describe my actions and observations.  Please treat with understanding.  In the end, that's what I'm starting to learn, make mistakes and correct them! <br><br>  <i>Special thanks to the Habrahabr moderators for putting a <b>randomly</b> sent, but not ready for publication topic, at my request, in drafts.</i>  <i>From now on, I will be more careful.</i> <br><br><h1>  Part one <br>  How it looks out of the box </h1><br>  That is, how it looks without any buns.  I will use the already compiled library with one simple script. Here it is: <br>  (here and below Haskell highlighting is used, but know that this is F #) <br><pre><code class="haskell hljs">//<span class="hljs-type"><span class="hljs-type">Please</span></span>, don't try to change namespace namespace <span class="hljs-type"><span class="hljs-type">Assembly_FSharp_vs</span></span> open <span class="hljs-type"><span class="hljs-type">UnityEngine</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> public </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SphereMoving</span></span></span><span class="hljs-class"> () = inherit </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MonoBehaviour</span></span></span><span class="hljs-class">() member public this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Start</span></span></span><span class="hljs-class"> () = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Debug</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Log</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialized</span></span></span><span class="hljs-class">") member public this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Update</span></span></span><span class="hljs-class">() = let mutable newpos:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Vector3</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Vector3</span></span></span><span class="hljs-class">.zero newpos.x &lt;- </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Mathf</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Sin</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Time</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">time</span></span></span><span class="hljs-class">) newpos.y &lt;- </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Mathf</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cos</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Time</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">time</span></span></span><span class="hljs-class">) this.transform.position &lt;- newpos</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This script was originally created by the means of my <a href="http://docs.unity3d.com/Documentation/Components/gui-ExtendingEditor.html">Editor</a> - script.  This also determines the presence of a comment and an explicit namespace (I will tell you more about its role below), I just changed it a little. <br>  After compiling the library and importing it into the project, we get the following result: <br><br><img src="http://clip2net.com/clip/m81328/1346789968-clip-20kb.png"><br><br>  This is what I meant when I talk about the inconvenience at the beginning of the article ‚Äî you will either have to create several libraries and keep them in different places (in order to create at least some sort of order) or try to find something in a long list if the project will grow. <br><br>  As the attentive <s>anonymus</s> habraiser has already noticed, it was not without crutches - you have to <a href="http://bash.im/quote/406821">put</a> the FSharp.Core.dll library next to <strong>each one</strong> , smash me thunder, <strong>EACH</strong> library, so that it is imported without a <a href="http://answers.unity3d.com/questions/23450/mono-and-missing-types-using-external-library.html">System.TypeLoadException being</a> thrown by the compiler. <br>  And to be precise, not only FSharp.Core.dll, but ALL dependencies libraries, which the Unity compiler <a href="http://forum.unity3d.com/threads/105760-Runtime-crash-System.TypeLoadException">cannot resolve</a> conflicts on <a href="http://forum.unity3d.com/threads/105760-Runtime-crash-System.TypeLoadException">its own</a> .  Here it becomes obvious that the game with F # is not worth the trouble, and writing something under Unity3d is acceptable except from <a href="http://lurkmore.to/%25D0%259B%25D1%2583%25D0%25BB%25D0%25B7">animal curiosity</a> , and even then in not very large volumes. <br><br>  The obvious solution here is to use such an Editor-script, which would be able to collect all the F # source in a heap and send them straight to the compiler.  At an opportune moment, some time before the events described, in the vastness of the <a href="http://www.habrahabr.ru/">immense</a> I had met <a href="http://habrahabr.ru/post/110999/">this</a> article, which became the starting point in my research. <br><br>  I would not in the description of the next part to somehow delve into the wilds, if not two BUT: <br>  1. The System.CodeDom.Compiler.CodeDomProvider class cannot provide a compiler for F #. <br>  2. <strong>All</strong> classes from the System.CodeDom.Compiler namespace are simply ‚Äúinvisible‚Äù to the Unity compiler.  Even if there is a link in the project and Visual Studio says that everything is in order, then the compiler will simply show a big and thick log in which he will tell and show that it is impossible to do this and that he doesn‚Äôt even dream about the contents of System.CodeDom.Compiler .  Even if you connect a library that in one way or another refers to System.CodeDom.Compiler, the compiler will still strongly disagree with you - in the log you will receive a message similar to this: <br><br> <code>Internal compiler error. See the console log for more information. output was: <br> Unhandled Exception: System.TypeLoadException: Could not load type 'System.CodeDom.Compiler.CompilerResults' from assembly 'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</code> <br> <br>  The story would have ended if not for one thing: classes from this namespace can be found in an assembly already in progress by simply iterating over the collection of assemblies available in the current domain and outputting all types of names to the log, which means you can use Reflection to create Objects and methods call (by the way, Reflection will later throw a fly in the ointment, and I will explain where, but below). <br><br><h1>  Part two <br>  The Taming of the Shrew <br>  We receive and operate CodeDomProvider for F # </h1><br>  But if the second "BUT" can still be circumvented, then what about the first? <br>  <a href="http://fsharppowerpack.codeplex.com/">F # Power Pack</a> which was found in the process of googling, which, I think, will be useful to anyone who somehow uses F #.  At this step, I was pushed by a throw-in of the <strong>ConfigurationErrorsException</strong> exception by the <a href="http://msdn.microsoft.com/en-us/library/6yzxs14d.aspx">CodeDomProvider.CreateProvider</a> method when called with arguments (alternately) ‚ÄúFSharp‚Äù (just as CodeDomProvider is created for C # - the argument ‚ÄúCSharp‚Äù) and ‚ÄúF #‚Äù (maybe skipped over?). <br><br>  F # Power Pack and provides the coveted Microsoft.FSharp.Compiler.CodeDom.FSharpCodeProvider, which has almost no differences in use compared to the usual CodeDomProvider from the System.CodeDom.Compiler namespace. <br><br>  It would seem that things are easy - connect and use, but there are some pitfalls here as well: <br>  1. Due to the fact that this library is not included in the .Net Framework package, it should be put into the project. <br>  2. FSharpCodeProvider itself refers to the types from System.CodeDom.Compiler and therefore it is possible to get a persistent <strong>System.TypeLoadException</strong> at compilation, and Studio IntelliSense will not lead with a nose. <br>  By Chaos‚Äôs will, I did just that, and so I did everything using Reflection and <a href="http://msdn.microsoft.com/en-us/library/system.activator.aspx">Activator</a> .  Perhaps, after all, I somewhere made a mistake, but it is already too late to change something.  It should also be noted that the library I originally wrote for this purpose (for all the same F # volume), which I did not bring to mind, was compiled without such tricks (that is, I did not have to run methods in FSharpCodeProvider through Reflection), but had all the same problems with the long-suffering namespace System.CodeDom.Compiler, which was solved (again) through Reflection.  Who is curious, can get acquainted with a short paste <a href="http://pastebin.com/AVXwUwzJ">here</a> . <br><br><div class="spoiler">  <b class="spoiler_title">And why the author did not add the library on F #?</b> <div class="spoiler_text">  And because I was going to write in F # not only the code that would be able to compile and compile everything, but also the code of the Editor-scripts.  But here one interesting detail was revealed - Editor-classes on F # send Unity3D editor to unconditional knockout.  No error messages, no pop-ups, kindly <a href="">offering to send error data</a> (along with all your project and your comments) to the engine developers, neither the hung process, nor MessageBox.  Nothing!  Emptiness.  This behavior is usually observed when the stack overflows or errors in some Unmanaged libraries, which was detected with the help of <a href="http://ru.wikipedia.org/wiki/OllyDbg">OllyDbg</a> , but, alas, I now need it a little less than anything and only download it in order to try (!) to elicit the cause of the fall was corny laziness. <br>  For the curious, I provide the <a href="http://pastebin.com/Lek1Rf6W">paste</a> with the code of the Editor-class on F #.  <strong>ATTENTION!</strong>  It is possible that after adding a library with this class, what happens as a result of the compilation will fall into the Library directory, from where it will be problematic to erase it, as a result of which you will get a persistent ‚Äúneotkryvak‚Äù (due to the editor‚Äôs failure due to the Editor-class curve) when you try to turn on the editor.  It is necessary to delete the Library folder, which usually entails the most severe <a href="http://clip2net.com/s/2gMZz">consequences</a> .  I warned. </div></div><br>  Returning to our CodeDomProvider, I remind you that a lot is being done through Reflection.  And here is the promised fly in the <a href="http://bash.im/quote/407307">footsteps of statistics</a> - when I try to get the type (!) System.CodeDom.Compiler.CompilerParameters with the help of Activator, I get the exception <a href="http://msdn.microsoft.com/en-us/library/aa310409(v%3Dvs.71).aspx"><strong>NotSupportedException</strong></a> due to " <em><strong>the type being created does not derive from MarshalByRefObject</strong></em> ", which is quite sad, because you still need to set the compiler parameters.  To do this, you have to act not too elegantly - you need to find the System.dll in the assembly collection in the current domain and get the type we need from the assembly: <br><br><pre> <code class="cs hljs">IEnumerator asmEnum = System.AppDomain.CurrentDomain.GetAssemblies().GetEnumerator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (asmEnum.MoveNext()) { Assembly asm = asmEnum.Current <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Assembly; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (asm.FullName.Contains(<span class="hljs-string"><span class="hljs-string">"System, V"</span></span>)) { comparamtype = asm.GetType(<span class="hljs-string"><span class="hljs-string">"System.CodeDom.Compiler.CompilerParameters"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (asm.FullName.Contains(<span class="hljs-string"><span class="hljs-string">"FSharp.Compiler.CodeDom"</span></span>)) { compilertype = asm.GetType(<span class="hljs-string"><span class="hljs-string">"Microsoft.FSharp.Compiler.CodeDom.FSharpCodeProvider"</span></span>); } }</code> </pre><br>  But getting an instance of both CompilerParameters and FSharpCodeProvider is easy: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> _params = System.Activator.CreateInstance(comparamtype, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"System"</span></span>, <span class="hljs-string"><span class="hljs-string">"System.Core"</span></span>, UenginePath } }); comparamtype.GetProperty(<span class="hljs-string"><span class="hljs-string">"IncludeDebugInformation"</span></span>).SetValue(_params, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { }); comparamtype.GetProperty(<span class="hljs-string"><span class="hljs-string">"OutputAssembly"</span></span>).SetValue(_params, <span class="hljs-string"><span class="hljs-string">@"Assets/Assembly/Assebly-FSharp-vs.dll"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { }); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> compiler = System.Activator.CreateInstance(compilertype);</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Important note</b> <div class="spoiler_text">  I should note that in the same way you can compile C # scripts from asset packages (so-called AssetBundle).  The fact is that in the bundle all the scripts are in the form of TextAssets.  Given this fact, their use is problematic.  However, using CodeDomProvider they can be compiled and used. </div></div><br>  An instance of CompilerParameters is created with only three necessary dependencies (yes, this is a minus, which will be corrected later, but this will be enough for compilation) as an argument.  The third member of the array returns a property that collects the full path to the UnityEngine.dll library and looks like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UenginePath { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UnityEditor.EditorApplication.applicationContentsPath + <span class="hljs-string"><span class="hljs-string">"/Managed/UnityEngine.dll"</span></span>; } }</code> </pre><br><br>  Things are easy - to collect a list of files and send to the mercy of the compiler.  But here there is one more nuance, the explanations for which I first give this screenshot: <br><br><img src="http://clip2net.com/clip/m81328/1346805661-clip-25kb.jpg" alt="image"><br><br>  "Something is not so," thought Stirlitz.  And I thought correctly - I showed a screenshot of the project, which already uses the resulting Editor-script.  Nor do I run ahead.  I had to do this so that the essence of further actions was clear.  And it is this: in order to click on the Script element, it is the asset that is highlighted, and not the script in the library, you need to create associations such as &lt;=&gt; asset, and therefore there is no point in adding the script to the list of scripts for compiling, if not imported.  In order to check this, you need to use AssetDatabase.  At the same time, ‚Äúis located in the Assets! = Folder is imported into assets‚Äù.  But this will all be a little later.  What was required to be obtained at this step has already been done - we have obtained and prepared for use instances of the compiler and its parameters. <br><br><div class="spoiler">  <b class="spoiler_title">Speaking of icons</b> <div class="spoiler_text">  It should be added that the F # script icon will not always be the same as mine.  Why?  From the help from the help of the <a href="http://docs.unity3d.com/Documentation/ScriptReference/EditorGUIUtility.ObjectContent.html">EditorGUIUtility.ObjectContent</a> method (which is called inside the UnityEditor.DoObjectField method, or rather one of its overloads, which draws a window based on the value of the current Event.Current.type), there is little to understand, but it seems that the editor first tries to find an icon in the cache, then get the icon from the system and only then assigns the icon to DefaultAsset, if the appropriate icon is not found. <br></div></div><br><br><h1>  Part three <br>  From the gun on the sparrows. Drag &amp; Drop and naughty inspector </h1><br>  It is very handy to add components to the object by dragging it.  But the fact is that by showing the screenshot I did not tell the whole truth - the editor did not understand that what he highlights is still a script.  Unrecognized assets (for example, a file with an unknown extension, just like our .fs script) are imported with the UnityEngine.DefaultAsset type (which seems to be Internal, therefore it is not available in the Editor script, but this doesn‚Äôt bother us at all).  But since it is impossible (in any case, I did not find a way) to directly obtain an asset object from its location (you can do just the <a href="http://docs.unity3d.com/Documentation/ScriptReference/AssetDatabase.GetAssetPath.html">opposite</a> ), I had to, figuratively speaking, <a href="http://lurkmore.to/Do_a_Barrel_Roll">make a barrel</a> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] _files = Directory.GetFiles(<span class="hljs-string"><span class="hljs-string">"Assets/"</span></span>, <span class="hljs-string"><span class="hljs-string">"*.fs"</span></span>); typenameToObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, UnityEngine.Object&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _files) { UnityEngine.Object o = AssetDatabase.LoadAssetAtPath(file, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(UnityEngine.Object)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CollectCompileDeploy.typenameToObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { CollectCompileDeploy.typenameToObject.Add(o.name, o); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre><br><br>  This is exactly what we need - from the list of paths to the .fs files, I get a list of assets under which they were imported.  Such assets have one feature that manifested itself when creating a <a href="http://docs.unity3d.com/Documentation/ScriptReference/Editor.html">CustomInstector</a> 'for F # scripts, namely: UnityEngine.DefaultAsset is loaded into AssetDatabase <b>only</b> after selecting in the inspector window or another action with them.  Therefore, they are loaded here manually using the path obtained using Directory.GetFiles. <br>  CustomInspector for assets F # scripts is purely cosmetic and looks like this: <br><br><img src="http://clip2net.com/clip/m81328/1346808251-clip-16kb.png" alt="image" align="left">  Assuming that the UnityEngine.DefaultAsset type is not available in the Editor script, you must create a CustomEditor for UnityEngine.Object and check whether the given UnityEngine.Object is an .fs file, and not, for example, a prefab or texture, and then the contents of the file are read. to display the code (which, by the way, can be selected and copied and even edited, but the result will not be specifically saved). <br>  The code for this CustomInspector is: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">CustomEditor(typeof(UnityEngine.Object))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FSharpScriptInspector</span></span> : <span class="hljs-title"><span class="hljs-title">Editor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SerializedProperty test; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> text; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Repaint(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnInspectorGUI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GUI.enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!AssetDatabase.GetAssetPath(Selection.activeObject).EndsWith(<span class="hljs-string"><span class="hljs-string">".fs"</span></span>)) { DrawDefaultInspector(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StreamReader sr = File.OpenText(AssetDatabase.GetAssetPath(Selection.activeObject)); text = sr.ReadToEnd(); sr.Close(); } GUILayout.Label(<span class="hljs-string"><span class="hljs-string">"Imported F# script"</span></span>); EditorGUILayout.TextArea(text); } } }</code> </pre><br><br>  The attribute parameter CustomEditor indicates the type for which we want to create a CustomInspector.  Because  the overwhelming majority of Unity3D types inherit from UnityEngine.Object (including assets), then we cannot allow what should be drawn <b>only</b> for .fs scripts in the inspector window, drawn for all assets.  To do this, we obtain the path to the asset through AssetDatabase.GetAssetPath and check the extension.  Special attention is given to the DrawDefaultInspector method.  As the name suggests, this method involves drawing a default inspector. <br>  To implement this D &amp; D, you need to track events, the last of which can always be obtained from the <a href="http://docs.unity3d.com/Documentation/ScriptReference/Event-current.html">Event.current</a> property, and which always returns one of <a href="http://docs.unity3d.com/Documentation/ScriptReference/EventType.html">these values</a> .  The Draw &amp; Drop we need is returned by the property when we drag an object in the inspector window. But you can add script objects only to game objects, so you need a CustomInspector to track these D &amp; D events on the game object inspector.  Oddly enough, but for the implementation of this there are already two options: <br>  1. Use CustomInspector for the UnityEngine.GameObject class <br>  2. Use CustomInspector for the UnityEngine.Transform class <div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  <a href="http://docs.unity3d.com/Documentation/ScriptReference/Transform.html">UnityEngine.Transform</a> specifies the transformation of the object - its position, rotation, scale.  He is <b>at all</b> , without exception, <b>gameplay</b> </div></div><img src="http://clip2net.com/clip/m81328/1346693625-clip-5kb.png" alt="image" align="right">  The second is preferable.  And in the picture on the right you can see why. <br>  That's a bit of a headache from using the DrawDefaultInspector.  After all, I only needed to catch events, but the fact is that CustomInspector has to draw something!  Or call DrawDefaultInspector, but in the screenshot you can see what it led to. <br>  But all is not lost.  The window is quite simple and it is not difficult to restore it.  It is enough to create three fields for the <a href="http://docs.unity3d.com/Documentation/ScriptReference/Vector3.html">Vector3</a> structure: <br>  1. To rotate an object in the form of an <a href="http://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25B3%25D0%25BB%25D1%258B_%25D0%25AD%25D0%25B9%25D0%25BB%25D0%25B5%25D1%2580%25D0%25B0">Euler angle</a> <br>  2. For object position <br>  3. For the scale of the object <br>  The angle value from the Eulerian value to the <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B2%25D0%25B0%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B8%25D0%25BE%25D0%25BD">quaternion is</a> translated by the <a href="http://docs.unity3d.com/Documentation/ScriptReference/Quaternion.Euler.html">Quaternion.Euler</a> method. <br>  The code for this CustomInspector is: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; [CustomEditor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(UnityEngine.Transform))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentCI</span></span> : <span class="hljs-title"><span class="hljs-title">Editor</span></span> { Vector3 position; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Repaint(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnInspectorGUI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { EditorGUILayout.BeginVertical(); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).localRotation = Quaternion.Euler(EditorGUILayout.Vector3Field(<span class="hljs-string"><span class="hljs-string">"Local Rotation"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).localRotation.eulerAngles)); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).localPosition = EditorGUILayout.Vector3Field(<span class="hljs-string"><span class="hljs-string">"Local Position"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).localPosition); (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).localScale = EditorGUILayout.Vector3Field(<span class="hljs-string"><span class="hljs-string">"Local Scale"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).localScale); EditorGUILayout.EndVertical(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Event.current.type == EventType.DragPerform) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AssetDatabase.GetAssetPath(DragAndDrop.objectReferences[<span class="hljs-number"><span class="hljs-number">0</span></span>]).EndsWith(<span class="hljs-string"><span class="hljs-string">".fs"</span></span>)) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Transform).gameObject.AddComponent(DragAndDrop.objectReferences[<span class="hljs-number"><span class="hljs-number">0</span></span>].name); } } } }</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">And what about UnityEngine.GameObject?</b> <div class="spoiler_text">  And if you use UnityEngine.GameObject as the target type, it turns out to be porridge in general - ComboBoxes become normal input fields, and the layer mask should already be entered as an integer (instead of ComboBoxes with CheckBoxs inside) <br></div></div><br>  Carefully looking at the code you can see one not quite clear detail - which component is added at the Drop event? <br>  One of the <a href="http://docs.unity3d.com/Documentation/ScriptReference/GameObject.AddComponent.html">GameObject.AddComponent</a> overloads takes the name of the <b>script</b> as an argument, although in fact it is the name of the type, and the required namespace in which this script is located is determined on the fly. <br><br><div class="spoiler">  <b class="spoiler_title">More about namespaces</b> <div class="spoiler_text">  As promised, the explanation for all the confusion around the namespace: <a href="http://docs.unity3d.com/Documentation/ScriptReference/index.Writing_Scripts_in_Csharp_26_Boo.html">Based on the documentation, it</a> is not possible to explicitly specify the namespace (in any case, for C #).  But while working with F # at the self-made library level, I noticed such a detail: the namespace and class name can be anything.  Those.  The familiar, probably to all, Unity3D users error <a href="http://lmgtfy.com/%3Fq%3DScript%2Bfile%2Bname%2Bdoes%2Bnot%2Bmatch%2Bthe%2Bname%2Bof%2Bthe%2Bclass%2B">Script file name does not</a> appear in the F # script.  You can create several classes - the heirs of MonoBehaviour in one file.  But there is one caveat - they will be available <b>only</b> from libraries (if done in the way I did).  In this case, the use of the namespace does not go away - the compiler requires an explicit indication of the namespace or module.  In the event of failure to comply with the requirements in cold blood, throws an error <a href="http://stackoverflow.com/questions/2680078/error-in-mono-compiler-files-in-libraries-or-multiple-file-applications-must-be">FS0222</a> . </div></div><br>  Now D &amp; D for scripts is ready.  Only now it will not look too elegant.  In order to make the inspector window <a href="">like this</a> , I will have to create a CustomInspector for each F # script.  Inspector code (using the SphereMoving class as an example): <br>  (VisualStudio's automatic formatting is used, but in fact the code is created without any formatting and indentation, because it was not calculated that this result will be read by someone) <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; [CustomEditor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Assembly_FSharp_vs.SphereMoving))] [CanEditMultipleObjects] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ins_SphereMoving</span></span> : <span class="hljs-title"><span class="hljs-title">Editor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SerializedProperty prop1; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;SerializedProperty&gt; props; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;SerializedProperty&gt;(); System.Reflection.FieldInfo[] fields = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Assembly_FSharp_vs.SphereMoving).GetFields(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (System.Reflection.FieldInfo field <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fields) { SerializedProperty mp = serializedObject.FindProperty(field.Name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mp != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { props.Add(mp); } } Repaint(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnInspectorGUI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UnityEditor.EditorApplication.isCompiling) { EditorGUILayout.LabelField(<span class="hljs-string"><span class="hljs-string">"Can't show anything during compilation"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//I don't want to live on this scope anymore! return; } try { EditorGUILayout.ObjectField("Script", CollectCompileDeploy.typenameToObject.ContainsKey("SphereMoving") ? CollectCompileDeploy.typenameToObject["SphereMoving"] : null, typeof(UnityEngine.Object), false); EditorGUILayout.BeginVertical(); foreach (SerializedProperty p in props) { EditorGUILayout.PropertyField(p); EditorGUILayout.Space(); } this.serializedObject.ApplyModifiedProperties(); EditorGUILayout.EndVertical(); } catch { } } }</span></span></code> </pre><br><br>  When I started talking about the inspector, I did not specify one important detail - the Unity3D inspector classes save the values ‚Äã‚Äãentered in the inspector window using the <a href="http://docs.unity3d.com/Documentation/ScriptReference/SerializedObject.html">SerializedObject</a> and <a href="http://docs.unity3d.com/Documentation/ScriptReference/SerializedProperty.html">SerializedProperty</a> classes and there is no need to save these values ‚Äã‚Äãon my own.  As you can see <a href="http://docs.unity3d.com/Documentation/ScriptReference/SerializedObject.GetIterator.html">from the help</a> you can get <br>  an iterator for these most SerializedProperty, but I still do not understand how to use this construct correctly, and as a result I got such a mess: <br><br><div style="text-align:center;"><img src="http://clip2net.com/clip/m81328/1346840941-clip-21kb.png" alt="1346840941-clip-21kb"></div><br><br>  But sometimes it was worse. <br>  Why is this happening and what have I done wrong?  And the dog knows it.  Therefore - again Reflection and getting the names of all the fields and then getting SerializedProperty using the <a href="http://docs.unity3d.com/Documentation/ScriptReference/SerializedObject.FindProperty.html">SerializedObject.FindProperty</a> method.  The <a href="http://docs.unity3d.com/Documentation/ScriptReference/CanEditMultipleObjects.html">CanEditMultipleObjects</a> attribute <a href="http://docs.unity3d.com/Documentation/ScriptReference/CanEditMultipleObjects.html">is</a> required so that the inspector can be displayed for several identical scripts that are on the same object, here it is not necessary, but I will leave it for any case.  It is also worth noting that I specifically added the Script field which is an ObjectField, and to which you need to send the UnityEngine.DefaultAsset object, which is our imported .fs file.  After that, when you click on this field, the .fs file will be highlighted, and not the script inside the library. <br>  So, the result looks like this: <br><br><img src="http://habrastorage.org/storage2/672/b97/3fd/672b973fd647766596f7e8fbddb42002.jpg"><br><br>  Looking at this picture, an attentive reader exclaims: <a href="http://lib.web-malina.com/getbook.php%3Fbid%3D1405%26page%3D8">what a marvel in my garden?</a> <br>  Yes, that's not all. <br><br><h1>  Part four <br>  Further - deeper.  Extend the menu, create scripts and update the Visual Studio solution file. </h1><br><br><img src="http://mlpchan.net/chat/src/1344913733648.jpg" alt="image" align="left"><br>  Further, in order to bring the work with F # scripts closer to working with C # / Boo / UnityScript, you need to add the ‚ÄúF # Script‚Äù item in the ‚ÄúAsets-&gt; Create‚Äù menu and context menu, and add the generation of the project file and include the project in the file decisions (about this below).  ,        <br> Assets-&gt;Create,      : <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">MenuItem(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Assets/Create/F# script"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateFS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = AssetDatabase.GetAssetPath(Selection.activeObject); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> addNum = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Selection.activeInstanceID &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { path=<span class="hljs-string"><span class="hljs-string">"Assets"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (path.Contains(<span class="hljs-string"><span class="hljs-string">"."</span></span>)) { path =Directory.GetParent(path).ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (File.Exists(path + <span class="hljs-string"><span class="hljs-string">"/NewBehaviourScript"</span></span> + addNum.ToString() + <span class="hljs-string"><span class="hljs-string">".fs"</span></span>)) { addNum = addNum == <span class="hljs-string"><span class="hljs-string">""</span></span> ? (<span class="hljs-number"><span class="hljs-number">1</span></span>).ToString() : (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(addNum) + <span class="hljs-number"><span class="hljs-number">1</span></span>).ToString(); } path = path + <span class="hljs-string"><span class="hljs-string">"/NewBehaviourScript"</span></span> + addNum.ToString() + <span class="hljs-string"><span class="hljs-string">".fs"</span></span>; StreamWriter sw = File.CreateText(path); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">"//Please, don't try to change namespace"</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">"namespace Assembly_FSharp_vs"</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">"type public "</span></span> + <span class="hljs-string"><span class="hljs-string">"NewBehaviourScript"</span></span> + addNum.ToString() + <span class="hljs-string"><span class="hljs-string">" () ="</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">" inherit UnityEngine.MonoBehaviour()"</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">" [&lt;DefaultValue&gt;] val mutable showdown1 : UnityEngine.Vector3"</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">" [&lt;DefaultValue&gt;] val mutable showdown2 : UnityEngine.Vector3"</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">" [&lt;DefaultValue&gt;] val mutable showdown3: int"</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">" member public this.Start () = UnityEngine.Debug.Log(\"initialized\")"</span></span>); sw.Flush(); sw.Close(); AssetDatabase.LoadAssetAtPath(path,Type.GetType(<span class="hljs-string"><span class="hljs-string">"UnityEngine.DefaultAsset,UnityEngine"</span></span>)); AssetDatabase.Refresh(ImportAssetOptions.ForceSynchronousImport); }</code> </pre><br><img src="http://habrastorage.org/storage2/e3b/4b9/3c7/e3b4b93c7a1f9da607a3277aa11d1f87.jpg" align="right">  <a href="http://docs.unity3d.com/Documentation/ScriptReference/MenuItem.html">MenuItem</a>   ,     ,   ,     ,      .     .  ( <a href="http://docs.unity3d.com/Documentation/ScriptReference/Selection-activeObject.html">Selection.activeObject</a> )    ,   ,         (   ,      )            ( ,    ,     ,   .  ,  ,   Unity3d,    ?). ,      <a href="http://docs.unity3d.com/Documentation/ScriptReference/Selection-activeInstanceID.html">activeInstanceID</a> ,     ,    .    ,  activeInstanceID  .  ,    ,   activeInstanceID  .  ,        ,      Assets(     ). ,  ,   ,      NewBehaviourScript[\d]*\.fs,        ,      F# ,        ,    ,       : <br><pre> <code class="haskell hljs">//<span class="hljs-type"><span class="hljs-type">Please</span></span>, don't try to change namespace namespace <span class="hljs-type"><span class="hljs-type">Assembly_FSharp_vs</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> public </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NewBehaviourScript1</span></span></span><span class="hljs-class"> () = inherit </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MonoBehaviour</span></span></span><span class="hljs-class">() [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DefaultValue</span></span></span><span class="hljs-class">&gt;] val mutable showdown1 : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Vector3</span></span></span><span class="hljs-class"> [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DefaultValue</span></span></span><span class="hljs-class">&gt;] val mutable showdown2 : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Vector3</span></span></span><span class="hljs-class"> [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DefaultValue</span></span></span><span class="hljs-class">&gt;] val mutable showdown3: int member public this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Start</span></span></span><span class="hljs-class"> () = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnityEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Debug</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Log</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialized</span></span></span><span class="hljs-class">")</span></span></code> </pre><br>    ‚Äî     ,    !     .fs          Visual Studio,       ,    ,    ,   ,    IDE (,     UnityEngine  ). ,     : <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ToolsVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DefaultTargets</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Build"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/developer/msbuild/2003"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" '$(Configuration)' == '' "</span></span></span><span class="hljs-tag">&gt;</span></span>Debug<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Platform</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" '$(Platform)' == '' "</span></span></span><span class="hljs-tag">&gt;</span></span>AnyCPU<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Platform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductVersion</span></span></span><span class="hljs-tag">&gt;</span></span>8.0.30703<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProductVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SchemaVersion</span></span></span><span class="hljs-tag">&gt;</span></span>2.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SchemaVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProjectGuid</span></span></span><span class="hljs-tag">&gt;</span></span>{ACFBFD03-C456-E983-5028-ACC6C3ACEA62}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ProjectGuid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span>Library<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RootNamespace</span></span></span><span class="hljs-tag">&gt;</span></span>Assembly_FSharp_vs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RootNamespace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AssemblyName</span></span></span><span class="hljs-tag">&gt;</span></span>Assembly_FSharp_vs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AssemblyName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFrameworkVersion</span></span></span><span class="hljs-tag">&gt;</span></span>v4.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFrameworkVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span>Assembly-FSharp-vs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugSymbols</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugSymbols</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugType</span></span></span><span class="hljs-tag">&gt;</span></span>full<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Optimize</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Optimize</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tailcalls</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tailcalls</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputPath</span></span></span><span class="hljs-tag">&gt;</span></span>bin\Debug\<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputPath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefineConstants</span></span></span><span class="hljs-tag">&gt;</span></span>DEBUG;TRACE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefineConstants</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WarningLevel</span></span></span><span class="hljs-tag">&gt;</span></span>3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WarningLevel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DocumentationFile</span></span></span><span class="hljs-tag">&gt;</span></span>bin\Debug\Assembly_FSharp_vs.XML<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DocumentationFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugType</span></span></span><span class="hljs-tag">&gt;</span></span>pdbonly<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Optimize</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Optimize</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tailcalls</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Tailcalls</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputPath</span></span></span><span class="hljs-tag">&gt;</span></span>bin\Release\<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputPath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefineConstants</span></span></span><span class="hljs-tag">&gt;</span></span>TRACE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefineConstants</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WarningLevel</span></span></span><span class="hljs-tag">&gt;</span></span>3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WarningLevel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DocumentationFile</span></span></span><span class="hljs-tag">&gt;</span></span>bin\Release\Assembly_FSharp_vs.XML<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DocumentationFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mscorlib"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FSharp.Core"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Core"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System.Numerics"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"D:/Program Files/Unity3.5/Editor/Data/Managed/UnityEngine.dll"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Compile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Assets/NewBehaviourScript.fs"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Compile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Assets/SphereMoving.fs"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Project</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildExtensionsPath32)\FSharp\1.0\Microsoft.FSharp.Targets"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!Exists('$(MSBuildBinPath)\Microsoft.Build.Tasks.v4.0.dll')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Project</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildExtensionsPath32)\..\Microsoft F#\v4.0\Microsoft.FSharp.Targets"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" Exists('$(MSBuildBinPath)\Microsoft.Build.Tasks.v4.0.dll')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- To modify your build process, add your task inside one of the targets below and uncomment it. Other similar extension points exist, see Microsoft.Common.targets. &lt;Target Name="BeforeBuild"&gt; &lt;/Target&gt; &lt;Target Name="AfterBuild"&gt; &lt;/Target&gt; --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br><img src="http://habrastorage.org/storage2/2ba/52a/d20/2ba52ad20ea6b1fe7ff0c41e0e438b26.jpg" align="left">   ,  XML ‚Äî       .      Assembly-CSharp-vs.csproj.  ,   ,     (csproj  C#  fsproj  F#). ,    ‚Äî     (ReferenceInclude)      (CompileInclude).      ,     . .‚Ä¶          XML,         .    ProjectGUID.       . <br clear="left"><p>       UnityEditor.VisualStudioIntegration.SolutionGuidGenerator (     ,   " SolutionGUIDGenerator Unity3d" ( )   1 ,    <a href="http://pastebin.com/tY9BVkTt"></a> . </p> ,   ,  <a href="http://lurkmore.to/3,5_%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25BD%25D0%25B8%25D0%25BC%25D1%2583%25D1%2581%25D0%25B0"> </a>  ).      GUID   ,   .   ‚Äî     . ,  ,     ,    ( )   : <br><br><pre> <code class="xml hljs">Project("ACFBFD03-C456-E983-5028-ACC6C3ACEA62") = ".\FSharp-csharp", "Assembly-FSharp-vs.fsproj", "{9512B9D0-6FAE-8F85-778C-B28C5421520D}" EndProject</code> </pre><br><br>   ‚Äî  GUID  .   ‚Äî  GUID  . <br>      ,       ¬´F#-&gt;Update soltuion file¬ª. <br> ,      : <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> xmlSourceFileDataEnter = <span class="hljs-string"><span class="hljs-string">"&lt;Compile Include=\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> xlmSourceFileDataEnding = <span class="hljs-string"><span class="hljs-string">"\" /&gt;"</span></span>; [MenuItem(<span class="hljs-string"><span class="hljs-string">"F#/Update solution file"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSolution</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(File.Exists(<span class="hljs-string"><span class="hljs-string">"Assembly-FSharp-vs.fsproj"</span></span>)) { File.Delete(<span class="hljs-string"><span class="hljs-string">"Assembly-FSharp-vs.fsproj"</span></span>); } StreamWriter sw = File.CreateText(<span class="hljs-string"><span class="hljs-string">"Assembly-FSharp-vs.fsproj"</span></span>); sw.WriteLine(xmlEnterData); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (UnityEngine.Object file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> typenameToObject.Values) { sw.Write(xmlSourceFileDataEnter); sw.Write(AssetDatabase.GetAssetPath(file)); sw.WriteLine(xlmSourceFileDataEnding); } sw.WriteLine(xmlFinishData); sw.Flush(); sw.Close(); sw.Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] slnfiles = Directory.GetFiles(<span class="hljs-string"><span class="hljs-string">"."</span></span>,<span class="hljs-string"><span class="hljs-string">"*-csharp.sln"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (slnfiles != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; slnfiles.Length&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { StreamReader sr = File.OpenText(slnfiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]); List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; lines = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!sr.EndOfStream) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> readenLine = sr.ReadLine(); lines.Add(readenLine); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readenLine.Contains(<span class="hljs-string"><span class="hljs-string">"Assembly-FSharp-vs.fsproj"</span></span>)) { sr.Close(); sr.Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } sr.Close(); sr.Dispose(); sw = File.CreateText(slnfiles[<span class="hljs-number"><span class="hljs-number">0</span></span>]); List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;.Enumerator linesEnum = lines.GetEnumerator(); linesEnum.MoveNext(); sw.WriteLine(linesEnum.Current); linesEnum.MoveNext(); sw.WriteLine(linesEnum.Current); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> slinname = slnfiles[<span class="hljs-number"><span class="hljs-number">0</span></span>].Remove(slnfiles[<span class="hljs-number"><span class="hljs-number">0</span></span>].LastIndexOf(<span class="hljs-string"><span class="hljs-string">".sln"</span></span>)); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">"Project(\""</span></span> + UnityEditor.VisualStudioIntegration.SolutionGuidGenerator.GuidForProject(<span class="hljs-string"><span class="hljs-string">"Assembly-FSharp-vs"</span></span>) + <span class="hljs-string"><span class="hljs-string">"\") = \""</span></span> + slinname + <span class="hljs-string"><span class="hljs-string">"\", \"Assembly-FSharp-vs.fsproj\", \"{"</span></span>+UnityEditor.VisualStudioIntegration.SolutionGuidGenerator.GuidForSolution(slinname)+<span class="hljs-string"><span class="hljs-string">"}\""</span></span>); sw.WriteLine(<span class="hljs-string"><span class="hljs-string">"EndProject"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (linesEnum.MoveNext()) { sw.WriteLine(linesEnum.Current); } sw.Flush(); sw.Close(); sw.Dispose(); } }</code> </pre><br><br><img src="http://habrastorage.org/storage2/8f0/3b8/401/8f03b84017809441a2c7036018b6ff5b.jpg" align="right">  xmlEnterData  xmlFinishData  ,    ¬´Compile Include¬ª    . <br>    UnityEngine    ,     GUID .       ¬´Update solution file¬ª‚Ä¶ <br>    ,     ¬´Manual rebuild¬ª.    ,     F#  ,          ,       ,              .   ,   ,      ,   UnityEngine.Object,     .   ,   ,   Unity   ,      ,    .   ,       ,       F#  . <br>     - ,   -  .         ProgressBar': <br><br><img src="http://habrastorage.org/storage2/c3d/41c/780/c3d41c780a9b8d3ec92c9b9dbf3a0dac.jpg"><br><br><div class="spoiler"> <b class="spoiler_title">  ,   ?</b> <div class="spoiler_text"><img src="http://habrastorage.org/storage2/209/ac1/1ba/209ac11baa3ba7441d97f5a205dbc559.jpg"><br>          UnityEngine.Object   .              . </div></div><br>       ,         .       <a href="http://docs.unity3d.com/Documentation/ScriptReference/index.Coroutines_26_Yield.html"></a> ,     ,    Unity3d <a href="http://answers.unity3d.com/questions/20761/coroutine-in-editor.html"></a>   .     ,       . <br><br> PS   <a href="http://docs.unity3d.com/Documentation/ScriptReference/ExecuteInEditMode.html">ExecuteInEditMode</a>  MonoBehaviour    ( <a href="http://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.Update.html">Monobehaviour.Update</a> )       - ,      .   ,    Edit-time     unity script,      C#, ? <br><br><h1>  Part five <br>   Edit-time    </h1><br><br><img src="http://habrastorage.org/storage2/b3b/93f/a85/b3b93fa85ea85c6c759a296aa90ebd3e.jpg" align="left">        ,     ,     ,            .   ,        ,    <a href="http://docs.unity3d.com/Documentation/Manual/RunningEditorCodeOnLaunch.html">InitializeOnLoad</a> (    <a href="http://docs.unity3d.com/Documentation/ScriptReference/30_search.html%3Fq%3DInitializeOnLoad">     </a> ). ,    ,    ,  ,    <a href="http://msdn.microsoft.com/ru-ru/library/k9x6w0hc(v%3Dvs.90).aspx"> </a>    .         CustomInspector'      ,           . <br> , .    ,     ,      ,   - ,    yield-,         .              ,  , -     yield- -  .         ,       : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UniversalEnumerator</span></span> : <span class="hljs-title"><span class="hljs-title">IEnumerator</span></span> { List&lt;Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt; allCodeFrames = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;&gt;(); IEnumerator codeEnum; Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; finishAction = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; FinishAction { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> finishAction; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { finishAction = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; code</span></span></span><span class="hljs-function">)</span></span> { allCodeFrames.Add(code); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _Finalize() { codeEnum = allCodeFrames.GetEnumerator(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Current { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> codeEnum.Current; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> res = codeEnum.MoveNext(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res) { (codeEnum.Current <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;)(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FinishAction != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FinishAction()!=<span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { codeEnum = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; allCodeFrames.Clear(); FinishAction = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre><br><br>  ,  Add     <a href="http://msdn.microsoft.com/en-us/library/bb549151.aspx">Func</a>     .   MoveNext      _Finalize    codeEnum.Current. FinishAction ‚Äî   ,   ,     .       ,    False,    ,       (   ,      ,     ).      <a href="http://docs.unity3d.com/Documentation/ScriptReference/EditorApplication-update.html">UpdateLoop</a>        .          InitializeOnLoad: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> UniversalEnumerator currentRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CollectCompileDeploy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { UnityEditor.EditorApplication.update += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EditorApplication.CallbackFunction(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!currentRoutine.MoveNext()) { currentRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }); Initialize(); }</code> </pre><br><br>      Recompile           UniversalEnumerator. <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CompilationState { GATHER =<span class="hljs-number"><span class="hljs-number">1</span></span>, COMPIL, VALIDATION, SOLUTION, DONE, NONE } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> UniversalEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Recompile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { UniversalEnumerator myEnum = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UniversalEnumerator(); _current = CompilationState.GATHER; CompilationProgressWindow.Init(); myEnum.Add(() =&gt; { files.Clear(); ReassingTypes(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> exitall = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; myEnum.Add(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(<span class="hljs-string"><span class="hljs-string">"Assets/Assembly/Assembly-FSharp-vs.dll"</span></span>)) { AssetDatabase.DeleteAsset(<span class="hljs-string"><span class="hljs-string">"Assets/Assembly/Assembly-FSharp-vs.dll"</span></span>); File.Delete(<span class="hljs-string"><span class="hljs-string">"Assets/Assembly/Assembly-FSharp-vs.dll"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (files.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"seems like no any F# file here.terminating"</span></span>); _current = CompilationState.NONE; exitall = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); System.Type comparamtype = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; System.Type compilertype = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; myEnum.Add(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exitall) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } UniversalEnumerator bufferedRoutine = currentRoutine; UniversalEnumerator nroutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UniversalEnumerator(); IEnumerator asmEnum = System.AppDomain.CurrentDomain.GetAssemblies().GetEnumerator(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (asmEnum.MoveNext()) { Assembly asm = asmEnum.Current <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Assembly; nroutine.Add(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (asm.FullName.Contains(<span class="hljs-string"><span class="hljs-string">"System, V"</span></span>)) { comparamtype = asm.GetType(<span class="hljs-string"><span class="hljs-string">"System.CodeDom.Compiler.CompilerParameters"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (asm.FullName.Contains(<span class="hljs-string"><span class="hljs-string">"FSharp.Compiler.CodeDom"</span></span>)) { compilertype = asm.GetType(<span class="hljs-string"><span class="hljs-string">"Microsoft.FSharp.Compiler.CodeDom.FSharpCodeProvider"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); } nroutine.FinishAction = () =&gt; { currentRoutine = bufferedRoutine; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); }; nroutine._Finalize(); currentRoutine = nroutine; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); myEnum.Add(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exitall) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } UnityEditor.EditorApplication.LockReloadAssemblies(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> _params = System.Activator.CreateInstance(comparamtype, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"System"</span></span>, <span class="hljs-string"><span class="hljs-string">"System.Core"</span></span>, UenginePath } }); comparamtype.GetProperty(<span class="hljs-string"><span class="hljs-string">"IncludeDebugInformation"</span></span>).SetValue(_params, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { }); comparamtype.GetProperty(<span class="hljs-string"><span class="hljs-string">"OutputAssembly"</span></span>).SetValue(_params, <span class="hljs-string"><span class="hljs-string">@"Assets/Assembly/Assebly-FSharp-vs.dll"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { }); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> compiler = System.Activator.CreateInstance(compilertype); List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; __fls = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(UnityEngine.Object asset <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> typenameToObject.Values) { __fls.Add(AssetDatabase.GetAssetPath(asset)); } _current = CompilationState.COMPIL; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> _output = compilertype.GetMethod(<span class="hljs-string"><span class="hljs-string">"CompileAssemblyFromFile"</span></span>).Invoke(compiler, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { _params, __fls.ToArray() }); compiled = _output.GetType().GetProperty(<span class="hljs-string"><span class="hljs-string">"CompiledAssembly"</span></span>).GetValue(_output, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { }) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Assembly; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _output.GetType().GetProperty(<span class="hljs-string"><span class="hljs-string">"Output"</span></span>).GetValue(_output, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { }) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> System.Collections.Specialized.StringCollection) { Debug.Log(message); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> error </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_output.GetType(</span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProperty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Errors"</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_output, new </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] { }</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">as</span></span></span><span class="hljs-function"> System.Collections.CollectionBase))</span></span> { Debug.LogError(error); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (compiled != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _current = CompilationState.VALIDATION; UniversalEnumerator bufferedRoutine = currentRoutine; UniversalEnumerator nroutine = ValidateInspectors(); nroutine.Add(() =&gt; { _current = CompilationState.SOLUTION; UpdateSolution(); _current = CompilationState.DONE; CompilationProgressWindow.Remove(); AssetDatabase.Refresh(ImportAssetOptions.ForceUpdate); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); nroutine._Finalize(); nroutine.FinishAction = () =&gt; { currentRoutine = bufferedRoutine; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); }; currentRoutine = nroutine; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogError(<span class="hljs-string"><span class="hljs-string">"compiled assembly is still not visible!"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { } UnityEditor.EditorApplication.UnlockReloadAssemblies(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); myEnum._Finalize(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> myEnum; }</code> </pre></div></div><br>           . <br>   .    : <br><br><pre> <code class="cs hljs">UniversalEnumerator bufferedRoutine = currentRoutine; UniversalEnumerator nroutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UniversalEnumerator(); nroutine.Add(() =&gt; { <span class="hljs-comment"><span class="hljs-comment">//  . return null; }); nroutine.FinishAction = () =&gt; { currentRoutine = bufferedRoutine; return new object(); }; nroutine._Finalize(); currentRoutine = nroutine;</span></span></code> </pre><br>          UniversalEnumerator,    currentRoutine        UniversalEnumerator,       FinishAction. new object()   ,  MoveNext   false,     FinishAction  ,    ,   EditorUpdateLoop  MoveNext    ,     false,   currentRoutine   null.         -  UniversalRoutine, ,   ,  . <br><br><div class="spoiler"> <b class="spoiler_title">   ?</b> <div class="spoiler_text">         : <br> 1. ..  Mono,    <a href="http://msdn.microsoft.com/en-us/library/system.threading.thread.isbackground.aspx">IsBackground</a>  .         ,     . <br> 2.           :    Thread.Abort          Unity3D    : -     <b></b>   .       ‚Äî   .       ‚Äî      (Debug.Log,  ) ‚Ä¶   , ..    ,     .   ,     . <br>          <a href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.aspx"></a> ,   . <br></div></div><br><br>     enum' CompilationState,           .        _current: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CompilationState __current = CompilationState.NONE; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CompilationState _current { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CollectCompileDeploy.__current; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { CollectCompileDeploy.__current = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CompilationProgressWindow.me != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { CompilationProgressWindow.me.Repaint(); } } }</code> </pre><br><br>  , CompilationProgressWindow ‚Äî    ,     <a href="http://docs.unity3d.com/Documentation/ScriptReference/EditorWindow.html">EditorWindow</a> .  Repaint   ,   - ,    ,   .    ‚Äî  . <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">    : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Runtime.InteropServices; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CompilationProgressWindow</span></span> : <span class="hljs-title"><span class="hljs-title">EditorWindow</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CompilationProgressWindow me; [StructLayout(LayoutKind.Sequential)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> WndRect { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Left; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Top; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Right; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Bottom; } <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR &amp;&amp; UNITY_STANDALONE_WIN [DllImport("user32.dll")] static extern IntPtr GetForegroundWindow(); [DllImport("user32.dll", SetLastError = true)] static extern bool GetWindowRect(IntPtr hWnd, out WndRect rect); public static Vector2 GetWNDSize() { WndRect r = new WndRect(); GetWindowRect(GetForegroundWindow(), out r); return new Vector2(r.Right - r.Left, r.Bottom - r.Top); ; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> public static Vector2 GetWNDSize() { return Vector2.zero; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> public static void Init() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (me == null) { Vector2 mainWND = GetWNDSize(); CompilationProgressWindow window = (CompilationProgressWindow)EditorWindow.GetWindow(typeof(CompilationProgressWindow), true, "F# Compilation progress", true); window.position = new Rect(mainWND.x/2-200, mainWND.y / 2 - 50, 400, 100); window.title = "F# compilation progress"; window.Focus(); me = window; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { me.Focus(); } } void OnGUI() { string msg = ""; switch (CollectCompileDeploy._current) { case CollectCompileDeploy.CompilationState.GATHER: msg = "Gathering data"; break; case CollectCompileDeploy.CompilationState.NONE: this.Close(); break; case CollectCompileDeploy.CompilationState.COMPIL: msg = "Compiling F# assembly"; break; case CollectCompileDeploy.CompilationState.DONE: msg = "Done! Wait for assembly import and enjoy"; break; case CollectCompileDeploy.CompilationState.SOLUTION: msg = "Preparing solution files for usage"; break; case CollectCompileDeploy.CompilationState.VALIDATION: msg = "Validating editor scripts"; break; } EditorGUI.ProgressBar(new Rect(0, 0, 400, 100), ((float)CollectCompileDeploy._current) / 5f, msg); } public void OnLostFocus() { this.Focus(); } public static void Remove() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (me != null) { me.Close(); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { } } }</span></span></code> </pre><br>     switch,       .     GetWNDSize.  <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms633505(v%3Dvs.85).aspx">GetForegroundWindow</a>      <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.process.getcurrentprocess.aspx">System.Diagnostics.Process.GetCurrentProcess</a>  <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.process.mainwindowtitle.aspx">MainWindowTitle</a>  null,     <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms633519(v%3Dvs.85).aspx">GetWindowRect</a>  ,   <a href="http://msdn.microsoft.com/en-us/library/system.diagnostics.process.mainwindowhandle.aspx">MainWindowHandle</a> ,          (0,0).  ,      .   ,    ,       ,     ,   - ,      ()     . ,        ,   -          Apple,      ,       ,    .   Unity3D     .     ,     . ,     ,  <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D1%258E%25D0%25BD%25D1%2585%25D0%25B3%25D0%25B0%25D1%2583%25D0%25B7%25D0%25B5%25D0%25BD,_%25D0%2598%25D0%25B5%25D1%2580%25D0%25BE%25D0%25BD%25D0%25B8%25D0%25BC_%25D0%259A%25D0%25B0%25D1%2580%25D0%25BB_%25D0%25A4%25D1%2580%25D0%25B8%25D0%25B4%25D1%2580%25D0%25B8%25D1%2585_%25D1%2584%25D0%25BE%25D0%25BD">  </a>  CollectCompileDeploy._current   CompilationState.NONE. <br></div></div><br><h1>   <br>  </h1><br>    .            UnityPackage   <a href="https://docs.google.com/open%3Fid%3D0B5TyXWrk7AsnT0RMazVHOHUwY1E"> </a> .             (    ¬´ ¬ª?). <br><div class="spoiler"> <b class="spoiler_title">3  </b> <div class="spoiler_text"><img src="http://habrastorage.org/storage2/bfa/fc9/451/bfafc94511f7eb6327f0a4b5d9812487.jpg"><br><br><img src="http://habrastorage.org/storage2/0f5/f14/2d8/0f5f142d86f9631827a4bf26ded00739.jpg"><br><br><img src="http://habrastorage.org/storage2/e87/c92/2af/e87c922afbdf1be0e3a77abc147d7995.jpg"><br><br></div></div><br> PS      F#      .          .  ,                . <br><br> <b>UPD1</b> :     ,     <a href="http://www.sendspace.com/file/hqdrj6">   </a> ( Flash ‚Äî    <a href="http://clip2net.com/s/2hcpz"> </a> ).   UnityPackage .  <a href="https://habrahabr.ru/users/gnoblin/" class="user_link">gnoblin</a> '               Android. <br><br> <b>UPD2</b> :    Google Docs </habracut></div><p>Source: <a href="https://habr.com/ru/post/151009/">https://habr.com/ru/post/151009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151002/index.html">Do you buy software for your iOS / Android device?</a></li>
<li><a href="../151003/index.html">Holo Android Settings</a></li>
<li><a href="../151005/index.html">On the creation of personal ratings. Like IMHO.net</a></li>
<li><a href="../151006/index.html">Single Sign-On for SalesForce</a></li>
<li><a href="../151008/index.html">Lazarus as it is</a></li>
<li><a href="../151010/index.html">Career Programmer, or Cracking Coding Interview</a></li>
<li><a href="../151011/index.html">Raises telephony from scratch: Asterisk, FreePBX, GSM Gateway on Huawei E173 in Debian</a></li>
<li><a href="../151014/index.html">Saltarelle: open source C # - JavaScript compiler</a></li>
<li><a href="../151016/index.html">Nokia Lumia 920: rescue in the snow</a></li>
<li><a href="../151017/index.html">How to make the game special?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>