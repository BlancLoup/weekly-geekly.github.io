<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Storage systems: how to choose?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A project of any complexity, whatever one may say, is faced with the task of storing data. Different systems can be such storage: Block storage, File ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Storage systems: how to choose?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c59/1d9/86e/c591d986e7cd4e3e9d2d1e95e4769991.jpg" alt="image" align="left">  A project of any complexity, whatever one may say, is faced with the task of storing data.  Different systems can be such storage: Block storage, File storage, Object storage and Key-value storage.  In any sane project, before purchasing a storage solution, tests are carried out to check certain parameters in certain conditions.  Remembering how many good projects, made by properly growing hands, pierced that we forgot about scalability, we decided to figure it out: <br><br><ul><li>  What characteristics of Block storage and File storage need to be taken into account if you want the storage system to grow following it as the project grows </li><li>  Why software fault tolerance is more reliable and cheaper than hardware level </li><li>  How to conduct testing to compare "apples with apples" </li><li>  How to get an order of magnitude more / less IOPS, changing only one parameter </li></ul><br>  During testing, we used RAID ‚Äì systems and <a href="http://habrahabr.ru/company/parallels/blog/162381/">Parallels Cloud Storage (PStorage)</a> distributed storage system.  PStorage is part of the <a href="http://habrahabr.ru/company/parallels/blog/169927/">Parallels Cloud Server</a> product. <br><a name="habracut"></a><br><br>  Let's start with the fact that we define the main characteristics that you need to pay attention to when choosing a storage system.  They will determine the structure of the post. <br><ol><li>  fault tolerance </li><li>  Data recovery speed </li><li>  Performance matching your requests. </li><li>  Data consistency </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <b>fault tolerance</b> </h3><br>  The most important property of a data storage system is that the system is designed to SAVE data without any compromises, that is, to ensure maximum availability and in no case lose even a small part of them.  For some reason, many people think about performance, price, but little attention is paid to data storage reliability. <br><br>  To ensure resiliency in the event of a failure, there is a single technique - redundancy.  The question is at what level is the reservation applied.  With some rough simplification, we can say that there are two levels: Hardware and Software. <br><br><img width="200" height="196" src="https://habrastorage.org/getpro/habr/post_images/4c9/4c0/3df/4c94c03df28bcf1b28affe26fec72658.jpg" alt="image" align="left">  Hardware-level redundancy has long proven itself in Enterprise systems.  SAN / NAS boxes have double redundancy of all modules (two or even three power supplies, a pair of ‚Äúbrain‚Äù boards) and store data simultaneously on several disks inside one box.  Personally, I metaphorically imagine this as a very safe mug: as reliable as possible to keep the liquid inside, with thick walls and always with two handles in case one of them breaks. <br><br><img width="200" height="156" src="https://habrastorage.org/getpro/habr/post_images/7ea/53e/ee3/7ea53eee3c00aafe06d1b8f47d21d5b2.jpg" alt="image" align="right">  Redundancy at the Software level is only beginning to penetrate Enterprise systems, but every year it eats away a larger and larger piece from HW solutions.  The principle here is simple.  Such systems do not rely on the reliability of iron.  They consider that it is a priori unreliable, and solve backup tasks at the software level, creating copies (replicas) of data and storing them on physically different hardware.  Continuing the analogy with cups, this is when there are several completely ordinary cups, and you poured tea in both, suddenly one breaks. <br><br>  Thus, SW solutions do not require expensive equipment, as a rule, are more profitable, but at the same time provide exactly the same fault tolerance, albeit at a different level.  They are also easier to optimize, for example, to spread data to different sites, perform balancing, change the level of fault tolerance, scale linearly as the cluster grows. <br><br>  I'll tell you how the issue of reservations is solved by the example of Parallels Cloud Storage (PStorage).  PStorage is not tied to any hardware vendor and is capable of running on completely ordinary machines, right up to desktop PCs.  We do not trust hardware, so the PStorage architecture is designed to lose the entire physical server (and not just a single disk).  All data in Parallels Cloud Storage is stored in multiple copies (replicas).  However, PStorage never stores more than one copy on a physical server / rack / room (as you wish).  We recommend storing 3 copies of the data in order to be protected from simultaneous failure of two servers / racks at once. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85c/ebd/929/85cebd92905a798f860973ffcee92f58.png" alt="image"><br>  <i>Comment: The figure shows an example of a cluster storing data in two copies.</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/01a/bc1/962/01abc196221f5e16be8c97ae2d6428a3.png" alt="image"><br><br><br><br><h3>  <b>Data recovery speed</b> </h3><br>  What happens if one of the disks fails? <br><br>  To begin, consider the usual HW RAID1 (mirror) of two drives.  In the event of a single disk crash, RAID continues to work with the remaining one, waiting for the moment when the failed disk is replaced.  Those.  RAID is vulnerable at this time: the remaining disk stores a single copy of the data.  One of our clients had a case when they carried out repairs in their data center and sawed metal.  The chips flew directly to the working servers, and within a few hours the disks in them began to fly out one by one.  Then the system was organized on a conventional RAID, and as a result, the provider lost some of the data. <br><br>  How long the system is in a vulnerable state depends on the recovery time.  This dependence is described by the following formula: <br><blockquote>  <b>MTTDL ~ = 1 / T ^ 2 * </b> , where <b>T</b> is the recovery time, and the mean time to data loss ( <b>MTTDL</b> ) is the average time to data loss, <b>C</b> is a certain coefficient. </blockquote>  So, the faster the system recovers the required number of copies of data, the less likely it is to lose data.  Here we even omit the fact that the administrator needs to replace a dead disk with a new one to start the HW RAID recovery process, and this also takes time, especially if you need to order a disk. <br><br>  For RAID1, recovery time is the time it takes for a RAID controller to transfer data from a working disk to a new one.  As you can easily guess, the copy speed will be equal to the read / write speed of the HDD, that is, approximately 100 MB / s, if the RAID controller is not at all loaded.  And if at this time the RAID controller is loaded from the outside, then the speed will be several times lower.  A thoughtful reader will perform similar calculations for RAID10, RAID5, RAID6 and come to the conclusion that any HW RAID is restored at a speed not exceeding the speed of one disk. <br><br>  SAN / NAS systems almost always use the same approach as normal RAID.  They group disks and collect RAID from them.  Actually, the recovery rate is the same. <br><br>  At the software level there are much more possibilities for optimization.  For example, in PStorage, data is distributed throughout the cluster and across all disks in the cluster, and in the event of a failure of one of the disks, replication begins automatically.  There is no need to wait for the administrator to replace the disk.  In addition, all cluster disks are involved in replication, so the speed of data recovery is much higher.  We wrote data to the cluster, disconnected one server from the cluster and measured the time during which the cluster would restore the missing number of replicas.  The graph shows the result for a cluster of 7/14/21 physical nodes with two SATA 1TB drives.  Cluster compiled on 1GB network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d4/817/c73/4d4817c738fe861593e3c292858e4b9d.png" alt="image"><br><br>  If you use a 10Gbit network, then the speed will be even higher. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d6/c81/6b0/6d6c816b0c886b47385daa48b434d4cf.png" alt="image"><br><br>  <i>Comment: There is no error in the fact that on a 1Gbit network, the cluster recovery speed from 21 servers is almost gigabytes per second.</i>  <i>The fact is that the data stored in Parallels Cloud Storage is distributed across cluster disks (a certain stripe across the cluster), so we can simultaneously copy data from different disks to different ones.</i>  <i>That is, there is no single point of ownership of the data, which could be the bottleneck of the test.</i> <br><br>  The full test script can be found <a href="http://sp.parallels.com/fileadmin/media/hcap/pcs/documents/PCloudStorage_Performance_Results_WP_EN_Ltr_02192013_web.pdf">in this document,</a> if you wish, you can repeat it yourself. <br><br><br><br><h3>  <b>How to test performance correctly - tips</b> </h3><br>  Based on our experience in testing storage systems, I would highlight the basic rules: <br><ol><li>  <b>It is necessary to "determine the Wishlist."</b>  What exactly you want to get from the system and how much.  Our clients in most cases use Parallels Cloud Storage to build a high availability cluster for virtual machines and containers.  That is, each of the cluster machines simultaneously provides both storage and executes virtual machines.  Thus, the cluster does not require a dedicated external ‚Äúdata storage‚Äù.  In terms of performance, this means that the cluster receives the load from each server.  Therefore, in the example, we will always load the cluster in parallel from all physical servers in the cluster. </li><li>  <b>No need to use well compressible data templates.</b>  Many HDDs / SSDs, storage systems, and virtual machines sometimes have special Low-level optimizations for processing zero data.  In such situations, it is easy to see that writing zeros to a disk is somewhat faster than writing random data.  A typical example of such an error is the well-known test: <br><pre><code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/zero of=/dev/sda size=1M</code> </pre>  It is better to use random data when testing.  At the same time, the generation of this data should not affect the test itself.  Those.  it is better to generate random data in advance, for example in a file.  Otherwise, the test will be limited to the generation of data, as in the following example: <br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/random of=/dev/sda size=1M</code> </pre></li><li>  <b>Consider the distance between components that are spaced apart.</b>  Naturally, communication between distributed components may contain delays.  It is worth remembering this possible bottleneck with loads.  Especially network latency and network bandwidth. </li><li>  <b>Take at least a minute to conduct the test.</b>  The test time should be long. </li><li>  <b>Perform one test several times to smooth out deviations.</b> </li><li>  <b>Use a large amount of data for the workload (working set).</b>  Working set is a very important parameter, as it greatly affects performance.  That he can change the test result dozens of times.  For example, with the Adaptec 71605 RAID controller, random I / O on a 512M file shows 100K iops, and on a 2GB file it shows only 3K IOPS.  The difference in performance is 30 times due to the RAID-cache (hit and not hit in the cache, depending on the volume of the load).  If you are going to work with data larger than the cache size of your storage system (in this example, 512M), then use just such volumes.  For virtual machines, we use 16GB. </li><li>  And of course, <b>always compare only "apples with apples."</b>  It is necessary to compare systems with the same fault tolerance on the same hardware.  For example, you cannot compare RAID0 with PStorage, since PStorage provides fault tolerance when drives / servers are being sent out, but RAID0 does not.  Correctly in this case will compare RAID1 / 6/10 with PStorage. </li></ol><br>  Below are the test results for the described methodology.  We compare the performance of the local RAID1 (‚Äú <b>host RAID 1</b> ‚Äù) with the PStorage cluster (‚Äú <b>PCS</b> ‚Äù).  Those "apples with apples".  It should be noted that it is necessary to compare systems with the same level of redundancy.  PStorage in these tests stored information in two copies (replicas = 2) instead of the recommended three, so that the level of fault tolerance is the same for both systems.  Otherwise, the comparison would be dishonest: PStorage (replicas = 3) allows you to lose 2 any drives / servers at the same time, when RAID1 of 2 drives is only 1. We use the same hardware for all tests: 1,10,21 identical physical servers with two 1TB SATA disks, 1Gbit network, core i5 CPU, 16GB RAM.  If the cluster consists of 21 servers, then its performance is compared with the total performance of 21 local RAID.  The load was made in 16 threads on each physical node at the same time.  Each node had a working set of 16GB, that is, for example, for the RANDOM 4K test as a whole, on a cluster, the loaders randomly walked through 336GB of data.  The load time is 1 minute, each test was carried out 3 times. <br><br>  The <b>PCS + SSD</b> columns show the performance of the same cluster, but with SSD caching.  PStorage has a built-in ability to use local SSDs for write-journaling, read-caching, which allows several times the performance of local rotating disks.  Also, SSD drives can be used to create a separate layer (tier) with higher performance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe9/bc5/fe5/fe9bc5fe5d68e650e03aaff3168430e1.png" alt="image"><br><br><br><h3>  <b>findings</b> </h3><br>  Briefly summarized: <br><ol><li>  Choosing the type of backup, we tend to "software level".  Software level provides more opportunities for optimization and reduces the requirements for hardware and reduce the cost of the system as a whole. </li><li>  We carry out tests under certain conditions (see our tips) </li><li>  We pay attention to the speed of recovery - a very important parameter, which, with insufficient efficiency, can simply destroy some of the business. </li></ol><br>  You can also test our own solution, especially since we give it to do it for free.  At least, on our own tests, Parallels Cloud Storage shows the fastest data recovery in the event of a disk loss (more than in RAID systems, including SAN) and performance is at least as good as local RAID, and with SSD caching - and higher. <br><br>  On the consistency of the data we plan to talk more in a separate post. <br><br><br><h3>  <b>How to try Parallels Cloud Storage</b> </h3><br>  The official product page <a href="http://sp.parallels.com/products/pcs/cloud-storage/">here</a> .  To try for free, fill out the <a href="http://sp.parallels.com/ru/products/pcs/how-to-buy/">form</a> . <br>  Also <a href="https://openvz.org/Parallels_Cloud_Storage">PStorage is available for the OpenVZ project</a> . <br>  You can read about how PCS works in FastVPS <a href="http://habrahabr.ru/company/parallels/blog/190524">in this post</a> . <br>  What your tests, pros and cons show - we can discuss in detail in the comments. </div><p>Source: <a href="https://habr.com/ru/post/239381/">https://habr.com/ru/post/239381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239369/index.html">Dummy about Dummies and one exciting journey into the depths of Excel. Long-awaited RegExp in tables</a></li>
<li><a href="../239373/index.html">Pitfalls of responsive web design</a></li>
<li><a href="../239375/index.html">New solutions to the old problem</a></li>
<li><a href="../239377/index.html">The best gift is a book. We make a beautiful cover</a></li>
<li><a href="../239379/index.html">Study: internal threats in large companies turned out to be more dangerous than viruses</a></li>
<li><a href="../239385/index.html">YouTrack 6.0, distinct and flexible. What can a new tracker?</a></li>
<li><a href="../239387/index.html">Testing embedded systems</a></li>
<li><a href="../239393/index.html">Hewlett-Packard is divided into two companies</a></li>
<li><a href="../239395/index.html">Vulnerability Yandex money or how to recover a payment password</a></li>
<li><a href="../239397/index.html">PL / SQL via dblink</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>