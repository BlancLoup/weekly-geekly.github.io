<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home weather station on esp8266 + aqara-xiaomi, part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all. 

 A year and a half has passed since I published my first article about my Home Weather Station project. During this time, I received n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Home weather station on esp8266 + aqara-xiaomi, part 2</h1><div class="post__text post__text-html js-mediator-article">  Hello to all. <br><br>  A year and a half has passed since I published my first <a href="https://geektimes.ru/post/276878/"><b>article</b></a> about my Home Weather Station project.  During this time, I received numerous reviews from readers about the functionality and security of the system, as well as corrected a decent number of bugs that showed up when installing and deploying the system from other users (thanks to the most active users - <a href="https://geektimes.ru/users/hzxio/" class="user_link">HzXiO</a> , <a href="https://geektimes.ru/users/enjoyneering/" class="user_link">enjoyneering</a> , <a href="https://geektimes.ru/users/dimitriy16/" class="user_link">dimitriy16</a> ). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yf/6d/lr/yf6dlrttupylpm3trhqi1bjfleg.jpeg" alt="KDPV" width="400"></div><br>  KDPV. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But this is all the lyrics, it's time to work! <br><a name="habracut"></a><br>  So, what has been done in the new version of the system. <br><br>  Iron part (on esp8266): <br><br><ul><li>  The system code has been completely rewritten: now the OOP is widely used to work with sensors and displays in order to simplify the addition of new sensors as much as possible and to make the code understandable and structured </li><li>  Considered wishes regarding system security </li><li>  Simplified module setup pages </li><li>  Removed dependencies on RTC </li></ul><br>  Server part (php + mysql): <br><br><ul><li>  Changed chart drawing algorithm - Kalman filter is used </li><li>  Each user of the system now sees only its own modules. </li><li>  You can give your names to the sensors, control their visibility on the pages. </li><li>  Added the ability to view data from temperature-humidity sensors manufactured by Aqara-Xiaomi. </li></ul><br>  I want to dwell on the most interesting tasks that had to be solved. <br><br>  1. The program in the form of a footcloth of 1000+ lines of code has become completely unreadable, it became too difficult to navigate in this code, it became too difficult and time consuming to check and debug changes.  Therefore, the code was rewritten - basic interfaces appeared, declaring standard methods for working with sensors and displays, their heirs appeared, implementing logic specific to specific models, as well as factories responsible for creating the necessary classes. <br><br>  I will show by example: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> sensorsCount 2 int sensorTypes[sensorsCount] = {SENSOR_DHT22, SENSOR_DHT22}; int sensorPins[sensorsCount] = {2, 0}; SensorEntity** sensorEntities; SensorOutputData* outputDatas;</span></span></code> </pre> <br>  Here it is announced that we have two sensors of the DHT22 type, connected to pins 2 and 0, and also arrays are declared for the wrapper classes above the sensors, and for the array of data obtained from them. <br><br><pre> <code class="cpp hljs">DisplayEntity display = DisplayEntity(DISPLAY_LCD_I2C);</code> </pre><br>  The display used is declared the same way - its type is set. <br><br>  The initialization of sensors and display occurs in the setup method: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupSensors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ outputDatas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SensorOutputData[sensorsCount]; sensorEntities = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SensorEntity*[sensorsCount]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; sensorsCount; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sensorType = sensorTypes[i]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pin = sensorPins[i]; SensorEntity* entity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SensorEntity(sensorType); entity-&gt;setup(pin); sensorEntities[i] = entity; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupDisplay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ DisplayConfig displayConfig = DisplayConfig(); displayConfig.address = <span class="hljs-number"><span class="hljs-number">0x27</span></span>; displayConfig.rows = <span class="hljs-number"><span class="hljs-number">2</span></span>; displayConfig.cols = <span class="hljs-number"><span class="hljs-number">16</span></span>; displayConfig.sda = <span class="hljs-number"><span class="hljs-number">4</span></span>; displayConfig.scl = <span class="hljs-number"><span class="hljs-number">5</span></span>; displayConfig.printSensorTitle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; display.setup(displayConfig); display.clear(); }</code> </pre><br>  At each measurement cycle, data is received from the sensors and transferred to the display for display: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestSensorValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; sensorsCount; i++) { SensorEntity* entity = sensorEntities[i]; SensorOutputData sensorData = entity-&gt;getData(); sensorData.sensorOrder = i; outputDatas[i] = sensorData; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderSensorValues</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; sensorsCount; i++) { SensorOutputData sensorData = outputDatas[i]; display.printData(sensorData); } }</code> </pre><br>  Actually, these small pieces of code - and could be the whole program, if not working with Wi-Fi or creating an access point on esp8266 to configure the modules. <br>  As you can see, if the user needs to change the sensor used, or connect a new display, it will be very simple: you just need to register their types, and change the pin configuration. <br><br>  If you need to add a new type of sensor or display, then you should create a descendant from the base class, and redefine the methods for obtaining data and drawing them. <br><br>  2. Changes in security - now the access point created by the module has the password specified in the config when the module is flashed - no one else can connect to the module without the user's knowledge. <br><br>  3. When drawing graphs on the site, the Kalman filter is now used to remove the bounce of values. <br><br>  4. Now it is possible to control the visibility and names of the sensors on the modules - this can be done on the settings page of each module on the site. <br><br>  5. The main feature added in this weather station revision is support for working with Aqara sensors for the Xiaomi smart home ecosystem. <br><br>  To realize this opportunity, you will need: the gateway of the smart home, translated into developer mode, and the actual temperature and humidity sensors themselves.  Sensors should be connected to the gateway through the MiHome application, then, the application and the great Chinese clouds can be forgotten: data exchange will take place within the local network, which you should put in the guest segment without Internet access at all. <br><br>  In order to receive data transmitted between sensors and a gateway in the local network, I use Malinka in my project, on which the module written on nodejs is running.  The module listens to multicast messages transmitted on the network, parses them to find the necessary sensors, since all data is transmitted in JSON format, and after searching for sensors, it extracts data on temperature and humidity from messages. <br><br>  The data obtained in this way is sent to the site specified in the configuration file for further display and storage. <br><br>  I will give the code of the module and the config - see under the cat: <br><br><div class="spoiler">  <b class="spoiler_title">Module and config on nodejs</b> <div class="spoiler_text">  Module: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> request = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"request"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./config'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dgram = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'dgram'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> serverPort = config.serverPort; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> serverSocket = dgram.createSocket(<span class="hljs-string"><span class="hljs-string">'udp4'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> multicastAddress = config.multicastAddress; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> multicastPort = config.multicastPort; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sensorDelay = config.sensorDelay; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sidToAddress = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sidToPort = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gatewayAddress; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSensorData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sensorId, temperature, humidity, gatewayAddress</span></span></span><span class="hljs-function">) </span></span>{ request({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: config.addDataUrl, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">qs</span></span>: { <span class="hljs-attr"><span class="hljs-attr">isaqara</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleid</span></span>: sensorId, <span class="hljs-attr"><span class="hljs-attr">modulename</span></span>: sensorId, <span class="hljs-attr"><span class="hljs-attr">code</span></span>: config.validationCode, <span class="hljs-attr"><span class="hljs-attr">temperature1</span></span>: temperature, <span class="hljs-attr"><span class="hljs-attr">humidity1</span></span>: humidity, <span class="hljs-attr"><span class="hljs-attr">ip</span></span>: gatewayAddress, <span class="hljs-attr"><span class="hljs-attr">mac</span></span>: sensorId, <span class="hljs-attr"><span class="hljs-attr">delay</span></span>: sensorDelay } }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error, response, body</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error); } } ); } serverSocket.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg, rinfo</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Received \x1b[33m%s\x1b[0m (%d bytes) from client \x1b[36m%s:%d\x1b[0m.'</span></span>, msg, msg.length, rinfo.address, rinfo.port); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> json; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { json = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(msg); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'\x1b[31mUnexpected message: %s\x1b[0m.'</span></span>, msg); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = json[<span class="hljs-string"><span class="hljs-string">'cmd'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd === <span class="hljs-string"><span class="hljs-string">'iam'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> address = json[<span class="hljs-string"><span class="hljs-string">'ip'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> port = json[<span class="hljs-string"><span class="hljs-string">'port'</span></span>]; gatewayAddress = address; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> command = { <span class="hljs-attr"><span class="hljs-attr">cmd</span></span>: <span class="hljs-string"><span class="hljs-string">"get_id_list"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmdString = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(command); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer(cmdString); serverSocket.send(message, <span class="hljs-number"><span class="hljs-number">0</span></span>, cmdString.length, port, address); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Requesting devices list...'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd === <span class="hljs-string"><span class="hljs-string">'get_id_list_ack'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(json[<span class="hljs-string"><span class="hljs-string">'data'</span></span>]); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Received devices list: %d device(s) connected.'</span></span>, data.length); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sid = data[index]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> command = { <span class="hljs-attr"><span class="hljs-attr">cmd</span></span>: <span class="hljs-string"><span class="hljs-string">"read"</span></span>, <span class="hljs-attr"><span class="hljs-attr">sid</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>(sid) }; sidToAddress[sid] = rinfo.address; sidToPort[sid] = rinfo.port; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmdString = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(command); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> message = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer(cmdString); serverSocket.send(message, <span class="hljs-number"><span class="hljs-number">0</span></span>, cmdString.length, rinfo.port, rinfo.address); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Sending \x1b[33m%s\x1b[0m to \x1b[36m%s:%d\x1b[0m.'</span></span>, cmdString, rinfo.address, rinfo.port); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd === <span class="hljs-string"><span class="hljs-string">'read_ack'</span></span> || cmd === <span class="hljs-string"><span class="hljs-string">'report'</span></span> || cmd === <span class="hljs-string"><span class="hljs-string">'heartbeat'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> model = json[<span class="hljs-string"><span class="hljs-string">'model'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(json[<span class="hljs-string"><span class="hljs-string">'data'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (model === <span class="hljs-string"><span class="hljs-string">'sensor_ht'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temperature = data[<span class="hljs-string"><span class="hljs-string">'temperature'</span></span>] ? data[<span class="hljs-string"><span class="hljs-string">'temperature'</span></span>] / <span class="hljs-number"><span class="hljs-number">100.0</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> humidity = data[<span class="hljs-string"><span class="hljs-string">'humidity'</span></span>] ? data[<span class="hljs-string"><span class="hljs-string">'humidity'</span></span>] / <span class="hljs-number"><span class="hljs-number">100.0</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sensorId = json[<span class="hljs-string"><span class="hljs-string">"short_id"</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Received data from sensor \x1b[31m%s\x1b[0m (sensorId: %s) data: temperature %d, humidity %d."</span></span>, json[<span class="hljs-string"><span class="hljs-string">'sid'</span></span>], sensorId, temperature, humidity); sendSensorData(sensorId, temperature, humidity, gatewayAddress); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Sending sensor data to \x1b[36m%s\x1b[0m.'</span></span>, config.addDataUrl); } } }); <span class="hljs-comment"><span class="hljs-comment">// err - Error object, https://nodejs.org/api/errors.html serverSocket.on('error', function (err) { console.log('Error, message - %s, stack - %s.', err.message, err.stack); }); serverSocket.on('listening', function () { console.log('Starting a UDP server, listening on port %d.', serverPort); serverSocket.addMembership(multicastAddress); }) console.log('Starting Aqara daemon...'); serverSocket.bind(serverPort); function sendWhois() { var command = { cmd: "whois" }; var cmdString = JSON.stringify(command); var message = new Buffer(cmdString); serverSocket.send(message, 0, cmdString.length, multicastPort, multicastAddress); console.log('Sending WhoIs request to a multicast address \x1b[36m%s:%d\x1b[0m.', multicastAddress, multicastPort); } sendWhois(); setInterval(function () { console.log('Requesting data...'); sendWhois(); }, sensorDelay * 1000);</span></span></code> </pre><br><br>  Config: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = { <span class="hljs-attr"><span class="hljs-attr">validationCode</span></span>: <span class="hljs-string"><span class="hljs-string">"0000000000000000"</span></span>, <span class="hljs-attr"><span class="hljs-attr">addDataUrl</span></span>: <span class="hljs-string"><span class="hljs-string">"http://weatherhub.ru/aqara.php"</span></span>, <span class="hljs-attr"><span class="hljs-attr">serverPort</span></span>: <span class="hljs-number"><span class="hljs-number">9898</span></span>, <span class="hljs-attr"><span class="hljs-attr">multicastAddress</span></span>: <span class="hljs-string"><span class="hljs-string">'224.0.0.50'</span></span>, <span class="hljs-attr"><span class="hljs-attr">multicastPort</span></span>: <span class="hljs-number"><span class="hljs-number">4321</span></span>, <span class="hljs-attr"><span class="hljs-attr">sensorDelay</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span> }; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = config;</code> </pre><br></div></div><br>  To run the module on Malinka - the nodejs sensor.js command is used <br>  How to automate the launch of the module at the start of Malinki - until you decide, probably someone will tell in the comments how to make it easier and more beautiful. <br><br>  Type of data received from the Malinka console: <br><br><div class="spoiler">  <b class="spoiler_title">Received data</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">root@raspberrypi:/home/nodejs<span class="hljs-meta"><span class="hljs-meta"># nodejs sensor.js Starting Aqara daemon... Sending WhoIs request to a multicast address 224.0.0.50:4321. Starting a UDP server, listening on port 9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"iam"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"port"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"9898"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"f0b429cc178e"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gateway"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ip"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"192.168.1.112"</span></span></span><span class="hljs-meta">} (87 bytes) from client 192.168.1.112:4321. Requesting devices list... Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"get_id_list_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"f0b429cc178e"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"GVke0tYsRZ5zlXWc"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"[\"</span></span></span><span class="hljs-meta">158d00015b2f98\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d0001560c23\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d00013eccc6\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d000153db73\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d000127883b\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d0001581523\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d0001101d54\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"]"</span></span></span><span class="hljs-meta">} (217 bytes) from client 192.168.1.112:9898. Received devices list: 7 device(s) connected. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00015b2f98"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001560c23"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00013eccc6"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000153db73"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000127883b"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001581523"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001101d54"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sensor_ht"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00015b2f98"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:20046,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":2975,\"</span></span></span><span class="hljs-meta">temperature\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">2297\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">humidity\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">4190\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (153 bytes) from client 192.168.1.112:9898. Received data from sensor 158d00015b2f98 (sensorId: 20046) data: temperature 22.97, humidity 41.9. Sending sensor data to http://weatherhub.ru/aqara.php. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"motion"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001560c23"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:41212,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3075}"</span></span></span><span class="hljs-meta">} (103 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"switch"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00013eccc6"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:4019,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3042}"</span></span></span><span class="hljs-meta">} (102 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"magnet"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000153db73"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:4914,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3015,\"</span></span></span><span class="hljs-meta">status\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">unknown\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (125 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"plug"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000127883b"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:52305,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3600,\"</span></span></span><span class="hljs-meta">status\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">unknown\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">inuse\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">0\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (140 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sensor_ht"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001581523"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:52585,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3035,\"</span></span></span><span class="hljs-meta">temperature\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">2287\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">humidity\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">4340\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (153 bytes) from client 192.168.1.112:9898. Received data from sensor 158d0001581523 (sensorId: 52585) data: temperature 22.87, humidity 43.4. Sending sensor data to http://weatherhub.ru/aqara.php. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"switch"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001101d54"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:3344,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3032}"</span></span></span><span class="hljs-meta">} (102 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"heartbeat"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gateway"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"f0b429cc178e"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"0"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"oypMd4l87xHIR6oP"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">ip\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">192.168.1.112\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (136 bytes) from client 192.168.1.112:4321.</span></span></code> ", "sid": "f0b429cc178e", "token": "GVke0tYsRZ5zlXWc", "data": "[\" 158d00015b2f98 \ ", \" 158d0001560c23 \ ", \" 158d00013eccc6 \ ", <code class="hljs objectivec">root@raspberrypi:/home/nodejs<span class="hljs-meta"><span class="hljs-meta"># nodejs sensor.js Starting Aqara daemon... Sending WhoIs request to a multicast address 224.0.0.50:4321. Starting a UDP server, listening on port 9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"iam"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"port"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"9898"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"f0b429cc178e"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gateway"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ip"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"192.168.1.112"</span></span></span><span class="hljs-meta">} (87 bytes) from client 192.168.1.112:4321. Requesting devices list... Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"get_id_list_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"f0b429cc178e"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"GVke0tYsRZ5zlXWc"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"[\"</span></span></span><span class="hljs-meta">158d00015b2f98\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d0001560c23\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d00013eccc6\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d000153db73\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d000127883b\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d0001581523\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">158d0001101d54\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"]"</span></span></span><span class="hljs-meta">} (217 bytes) from client 192.168.1.112:9898. Received devices list: 7 device(s) connected. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00015b2f98"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001560c23"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00013eccc6"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000153db73"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000127883b"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001581523"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Sending {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001101d54"</span></span></span><span class="hljs-meta">} to 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sensor_ht"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00015b2f98"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:20046,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":2975,\"</span></span></span><span class="hljs-meta">temperature\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">2297\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">humidity\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">4190\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (153 bytes) from client 192.168.1.112:9898. Received data from sensor 158d00015b2f98 (sensorId: 20046) data: temperature 22.97, humidity 41.9. Sending sensor data to http://weatherhub.ru/aqara.php. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"motion"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001560c23"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:41212,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3075}"</span></span></span><span class="hljs-meta">} (103 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"switch"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d00013eccc6"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:4019,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3042}"</span></span></span><span class="hljs-meta">} (102 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"magnet"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000153db73"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:4914,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3015,\"</span></span></span><span class="hljs-meta">status\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">unknown\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (125 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"plug"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d000127883b"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:52305,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3600,\"</span></span></span><span class="hljs-meta">status\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">unknown\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">inuse\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">0\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (140 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sensor_ht"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001581523"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:52585,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3035,\"</span></span></span><span class="hljs-meta">temperature\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">2287\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">humidity\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">4340\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (153 bytes) from client 192.168.1.112:9898. Received data from sensor 158d0001581523 (sensorId: 52585) data: temperature 22.87, humidity 43.4. Sending sensor data to http://weatherhub.ru/aqara.php. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read_ack"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"switch"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"158d0001101d54"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:3344,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">voltage\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":3032}"</span></span></span><span class="hljs-meta">} (102 bytes) from client 192.168.1.112:9898. Received {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmd"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"heartbeat"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gateway"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sid"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"f0b429cc178e"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"short_id"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"0"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"oypMd4l87xHIR6oP"</span></span></span><span class="hljs-meta">,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"data"</span></span></span><span class="hljs-meta">:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">ip\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">192.168.1.112\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}"</span></span></span><span class="hljs-meta">} (136 bytes) from client 192.168.1.112:4321.</span></span></code> </pre><br></div></div><br>  As you can see from the output, there are two sensors on the network, with identifiers 52585 and 20046. The data from them is sent to the server specified in the config (http://weatherhub.ru) - where the site itself and the database for storing data are picked up. <br><br>  After launching the module, connecting sensors, and launching the website, new sensors can be immediately seen on the Settings page: <br><br><img src="https://habrastorage.org/webt/ji/wu/hv/jiwuhv3eqdgulrz6gr0ebdokfvu.png"><br><br>  Using the Module Parameters button, we select active sensors (in our case, these are Temperature 1 and Humidity 1), save the data, and go to the Main, where we can see the received data: <br><br><img src="https://habrastorage.org/webt/oo/pg/w0/oopgw08iie2lidu5rvsduhnqyoc.png"><br><br>  On the Data page, you can view the data from a table: <br><br><img src="https://habrastorage.org/webt/76/-9/ho/76-9ho0dp-bahtk7zq1jxqilkb4.png"><br><br>  On the Charts page are charts for which you can choose the display period: <br><br><img src="https://habrastorage.org/webt/rp/ru/uj/rpruuj85dpnrasv59wso7gxtqbc.png"><br><br>  The site is running as a single user, without authorization.  Therefore, the displayed data is available to all.  When authorization is enabled, each user receives a unique validation code, which will need to be specified either in the firmware for the controller or in the nodejs module. <br><br>  All weather station code is available on Github: <a href="https://github.com/aproschenko-dev/WeatherHub">github.com/aproschenko-dev/WeatherHub</a> <br><br>  Further development that I see: <br><br><ul><li>  The ability to display data in a graphical form, in the form of a scale </li><li>  Adding the most common models to the standard set of supported sensors - bme280, bmp280 and others </li><li>  CO2 Sensor Support - MHT-Z19 </li></ul><br>  From readers, I would like to hear in the comments criticism of the case, suggestions for the system, and - what would be most valuable - personal experience of deploying and using the system, including with the Aqara sensors, which have become quite inexpensive. <br><br>  I am sure that when deploying and launching a meteorological station, many questions may arise - I am ready to give answers to them, and following the results - write a detailed manual on the system. </div><p>Source: <a href="https://habr.com/ru/post/370999/">https://habr.com/ru/post/370999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../370985/index.html">IoT - Philosophy of Education</a></li>
<li><a href="../370987/index.html">Operating system vulnerabilities. Part II</a></li>
<li><a href="../370993/index.html">An agent investigating the Silk Road case went to jail for stealing the bitcoins of The Terrible Pirate Roberts</a></li>
<li><a href="../370995/index.html">Apple is going to release augmented reality glasses. Why is the future behind AR</a></li>
<li><a href="../370997/index.html">Six months of imprisonment: synchronism, circadian rhythms and sleep disorders</a></li>
<li><a href="../371001/index.html">Chinese crowdfunding, or hidden dragon</a></li>
<li><a href="../371003/index.html">Skype 4.3 everything. Now for sure</a></li>
<li><a href="../371009/index.html">Errors in conversational English that can (and should) be allowed</a></li>
<li><a href="../371011/index.html">Operating system vulnerabilities. Part IV</a></li>
<li><a href="../371013/index.html">Fisker patents solid-state lithium batteries for future electric vehicles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>