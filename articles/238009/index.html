<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>I was asked to hack the program at the interview. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of the second part of the publication ‚ÄúI was asked to hack the program at an interview . ‚Äù The original text can be found here ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>I was asked to hack the program at the interview. Part 2</h1><div class="post__text post__text-html js-mediator-article">  <i>This is a translation of the second part of the publication <a href="http://habrahabr.ru/post/237469">‚ÄúI was asked to hack the program at an interview</a> . <a href="http://habrahabr.ru/post/237469">‚Äù</a></i>  <i>The original text can be found <a href="http://erenyagdiran.github.io/I-was-just-asked-to-crack-a-program-Part-2/">here</a> .</i> <br><br><h4>  Foreword </h4><br>  Hi guys.  If you do not know what ‚ÄúPart 2‚Äù means, please read <a href="http://habrahabr.ru/post/237469">Part 1</a> . <br>  To begin, I would like to thank everyone who read the first part, because in the end I received a lot of excellent feedback. <br><br>  I would also like to eliminate some misunderstandings: <br><ol><li>  I no longer work for this company, I moved to Barcelona; </li><li>  I passed this interview almost a year ago; </li><li>  I hacked programs in the cloud ($ 5 tariff, yes, you guessed the company), so I do not think that using <b>root @</b> 'a is a problem - I can recreate a new environment in a couple of seconds.  As a result, I still switched to user <b>eren @</b> , since gdb did not accept root-init files. </li><li>  Do not forget to read the end of the article - you will love it! </li></ol><br><h4>  Go </h4><br>  This time we will work not with the door, but with a <b>nuclear rocket</b> . <br><a name="habracut"></a><br><pre><code class="bash hljs">eren@lisa:~$ ./CrackTheNuke *** NUKE CONTROL SYSTEM *** PASSWORD: giveMeNuke *** ACCESS DENIED *** PASSWORD: iwantanexplosion *** ACCESS DENIED *** PASSWORD: knockknockitsme *** ACCESS DENIED *** *** SYSTEM LOCKED *** *** SHUTTING DOWN *** eren@lisa:~$</code> </pre> <br>  I will dump the entire binaries with <i>intel asm</i> syntax as a sample: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">eren@lisa:~$ objdump -M intel -D CrackTheNuke &gt; staticDis eren@lisa:~$</code> </pre><br><br>  We will need this file later.  If you look at the <i>staticDis</i> file, you can find a complete dump with <i>intel</i> 's syntax. <br><br>  Let's try something else this time: for starters, I will start the process, and then I will hook on it to the debugger. <br><br><pre> <code class="bash hljs">eren@lisa:~$ ./CrackTheNuke *** NUKE CONTROL SYSTEM *** PASSWORD:</code> </pre><br><br>  Now we can switch to another shell and start a debugger from it: <br><br><pre> <code class="bash hljs">eren@lisa:~$ ps aux | grep Crack eren 4741 0.0 0.0 1724 252 pts/0 S+ 14:54 0:00 ./CrackTheNuke eren 4845 0.0 0.1 7832 832 pts/1 S+ 14:56 0:00 grep Crack eren@lisa:~$ gdb --pid 4741 GNU gdb (GDB) 7.4.1-debian Copyright (C) 2012 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt; This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type <span class="hljs-string"><span class="hljs-string">"show copying"</span></span> and <span class="hljs-string"><span class="hljs-string">"show warranty"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> details. This GDB was configured as <span class="hljs-string"><span class="hljs-string">"x86_64-linux-gnu"</span></span>. For bug reporting instructions, please see: &lt;http://www.gnu.org/software/gdb/bugs/&gt;. Catchpoint 1 (syscall <span class="hljs-string"><span class="hljs-string">'ptrace'</span></span> [26]) Attaching to process 4741 Reading symbols from /home/eren/CrackTheNuke...(no debugging symbols found)...<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Reading symbols from /lib32/libc.so.6...(no debugging symbols found)...<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Loaded symbols <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /lib32/libc.so.6 Reading symbols from /lib/ld-linux.so.2...(no debugging symbols found)...<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. Loaded symbols <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /lib/ld-linux.so.2 0xf7726430 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> __kernel_vsyscall () =&gt; 0xf7726430 &lt;__kernel_vsyscall+16&gt;: 5d pop ebp (gdb)</code> </pre><br><br>  Now you can enter any 16 characters in the previous window and return here.  We are now in the <i>scanf</i> function, which rests in the <i>glibc</i> library ( <i>crackme</i> will call scanf 16 times, but we will save some time here). <br><br>  In gdb you can type <i><b>si</b></i> (abbr. From <i>single step</i> ).  Enter <i>si</i> until you reach the address: <b>0x80495ed</b> .  Or you can simply enter the command: <code>b * 0x80495ed</code> and press <code></code> to get to the desired address. <br><br>  In any case, we are now in place: <br><br><pre> <code class="bash hljs">0x80495ed &lt;main+195&gt;:</code> </pre><br><br>  Here we can see the comparison operation: <br><br><pre> <code class="bash hljs">0x80495ed &lt;main+195&gt;: cmp DWORD PTR [esp+0x1c],0x0</code> </pre><br><br>  In gdb, you can enter: <code>p/x $esp</code> to view the contents of <i>$ esp</i> . <br>  You can also do some calculations using registers and addresses: <code>p/x $esp+0x1c</code> .  Alternatively, view the contents of the address after the renaming: <code>p/x *0xff811bac</code> . <br><br>  Here you can enter <i><u>si</u></i> , which will lead us to the moment when <i>crackme has</i> received our 16 characters and expects a line ending character <i>\ n</i> . <br><br>  I advise you to put a breakpoint at <b>0x804962d</b> : <code>b * 0x804962d</code> , if you do not want to wait long and painfully. <br><br>  And now the fun begins: <br><br><pre> <code class="bash hljs">=&gt; 0x804962d &lt;main+259&gt;: push eax 0x804962e &lt;main+260&gt;: push ebx 0x804962f &lt;main+261&gt;: rdtsc 0x8049631 &lt;main+263&gt;: and eax,0xfffff 0x8049636 &lt;main+268&gt;: <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> eax,eax 0x8049638 &lt;main+270&gt;: je 0x8049646 &lt;g99&gt; 0x804963a &lt;main+272&gt;: xor ebx,0xe 0x804963d &lt;main+275&gt;: add ebx,0xe 0x8049640 &lt;main+278&gt;: sub ebx,0xe 0x8049643 &lt;main+281&gt;: dec eax</code> </pre><br><br>  Have you ever <a href="https://ru.wikipedia.org/wiki/Rdtsc">heard of rdtsc</a> instructions?  Its main task is counting the number of processor cycles.  After calling <i>rdtsc, the</i> TSC counter will be placed in the <i>edx</i> and <i>eax</i> registers: <br><br><pre> <code class="bash hljs">0x8049636 &lt;main+268&gt;: <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> eax,eax 0x8049638 &lt;main+270&gt;: je 0x8049646 &lt;g99&gt;</code> </pre><br><br>  The same on C would look something like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(eax == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-number"><span class="hljs-number">0x8049646</span></span> }</code> </pre><br><br>  Since <i>eax is</i> not 0, we‚Äôll continue to dig.  As you most likely noticed, the code below is full trash: we add <i>0xe</i> to <i>ebx</i> , and then we subtract it.  Looks like they are trying to confuse us. <br><br><pre> <code class="bash hljs">xor ebx,0xe add ebx,0xe sub ebx,0xe dec eax</code> </pre><br><br>  While <i>eax</i> is 0, we continue this cycle. <br>  Set breakpoint: <code>b * 0x8049646</code> and press <i>c</i> . <br>  Ok, nothing interesting - go ahead. <br><br><pre> <code class="bash hljs">=&gt; 0x80494db &lt;nkc1qpE2L6f6AyqaendA&gt;: push ebp 0x80494dc &lt;nkc1qpE2L6f6AyqaendA+1&gt;: mov ebp,esp 0x80494de &lt;nkc1qpE2L6f6AyqaendA+3&gt;: sub esp,0x14 0x80494e1 &lt;nkc1qpE2L6f6AyqaendA+6&gt;: mov DWORD PTR [ebp-0x4],0x0 0x80494e8 &lt;nkc1qpE2L6f6AyqaendA+13&gt;: mov DWORD PTR [esp],0x0 0x80494ef &lt;nkc1qpE2L6f6AyqaendA+20&gt;: call 0x804944b &lt;qEWL8Jl0zdpmTbwhziDv&gt; 0x80494f4 &lt;nkc1qpE2L6f6AyqaendA+25&gt;: mov eax,DWORD PTR [ebp+0x8] 0x80494f7 &lt;nkc1qpE2L6f6AyqaendA+28&gt;: mov DWORD PTR [esp],eax 0x80494fa &lt;nkc1qpE2L6f6AyqaendA+31&gt;: call 0x8048604 &lt;fjDKIzPtGuE8ZdfSL8vq&gt; 0x80494ff &lt;nkc1qpE2L6f6AyqaendA+36&gt;: mov DWORD PTR [esp],0x2 0x8049506 &lt;nkc1qpE2L6f6AyqaendA+43&gt;: call 0x804944b &lt;qEWL8Jl0zdpmTbwhziDv&gt; 0x804950b &lt;nkc1qpE2L6f6AyqaendA+48&gt;: mov eax,DWORD PTR [ebp+0x8] 0x804950e &lt;nkc1qpE2L6f6AyqaendA+51&gt;: mov DWORD PTR [esp],eax 0x8049511 &lt;nkc1qpE2L6f6AyqaendA+54&gt;: call 0x8048ab1 &lt;W0ElBw5Smo9TPiWOeK8c&gt; 0x8049516 &lt;nkc1qpE2L6f6AyqaendA+59&gt;: mov DWORD PTR [ebp-0x4],eax 0x8049519 &lt;nkc1qpE2L6f6AyqaendA+62&gt;: mov DWORD PTR [esp],0x1 0x8049520 &lt;nkc1qpE2L6f6AyqaendA+69&gt;: call 0x804944b &lt;qEWL8Jl0zdpmTbwhziDv&gt; 0x8049525 &lt;nkc1qpE2L6f6AyqaendA+74&gt;: mov eax,DWORD PTR [ebp-0x4] 0x8049528 &lt;nkc1qpE2L6f6AyqaendA+77&gt;: leave 0x8049529 &lt;nkc1qpE2L6f6AyqaendA+78&gt;: ret</code> </pre><br>  <code>nkc1qpE2L6f6AyqaendA</code> - this function is the basis of the whole process. <br><br>  Let's try to investigate all the functions that <i>nkc1qpE2L6f6AyqaendA</i> refers <i>to</i> : <i>qEWL8Jl0zdpmTbwhziDv</i> , <i>fjDKIzPtGuE8ZdfSL8vq</i> and <i>W0ElBw5Smo9TPiWOeK8c</i> : <br><br><pre> <code class="bash hljs">(gdb) x/10i qEWL8Jl0zdpmTbwhziDv 0x804944b &lt;qEWL8Jl0zdpmTbwhziDv&gt;: push ebp 0x804944c &lt;qEWL8Jl0zdpmTbwhziDv+1&gt;: mov ebp,esp 0x804944e &lt;qEWL8Jl0zdpmTbwhziDv+3&gt;: mov eax,DWORD PTR [ebp+0x8] 0x8049451 &lt;qEWL8Jl0zdpmTbwhziDv+6&gt;: cmp eax,0x0 0x8049454 &lt;qEWL8Jl0zdpmTbwhziDv+9&gt;: je 0x80494b9 &lt;hzdhp&gt; 0x8049456 &lt;qEWL8Jl0zdpmTbwhziDv+11&gt;: cmp eax,0x1 0x8049459 &lt;qEWL8Jl0zdpmTbwhziDv+14&gt;: je 0x8049499 &lt;qEWL8Jl0zdpmTbwhziDv+78&gt; 0x804945b &lt;qEWL8Jl0zdpmTbwhziDv+16&gt;: call 0x8047b71 0x8049460 &lt;qEWL8Jl0zdpmTbwhziDv+21&gt;: add DWORD PTR [eax+0x48604bf],0x5eb9008 0x804946a &lt;qEWL8Jl0zdpmTbwhziDv+31&gt;: add DWORD PTR [eax-0x4608ea13],0x8048ab1 (gdb) x/10i fjDKIzPtGuE8ZdfSL8vq 0x8048604 &lt;fjDKIzPtGuE8ZdfSL8vq&gt;: call 0xb027:0xaf72c78c 0x804860b &lt;fjDKIzPtGuE8ZdfSL8vq+7&gt;: cmp esi,DWORD PTR ds:0xe4dfbbf1 0x8048611 &lt;fjDKIzPtGuE8ZdfSL8vq+13&gt;: (bad) 0x8048612 &lt;fjDKIzPtGuE8ZdfSL8vq+14&gt;: and al,BYTE PTR [ebp+edi*2-0x8] 0x8048616 &lt;fjDKIzPtGuE8ZdfSL8vq+18&gt;: push ebx 0x8048617 &lt;fjDKIzPtGuE8ZdfSL8vq+19&gt;: push esi 0x8048618 &lt;fjDKIzPtGuE8ZdfSL8vq+20&gt;: inc edx 0x8048619 &lt;fjDKIzPtGuE8ZdfSL8vq+21&gt;: mov WORD PTR [ebp+0x76],ss 0x804861c &lt;fjDKIzPtGuE8ZdfSL8vq+24&gt;: xchg edx,eax 0x804861d &lt;fjDKIzPtGuE8ZdfSL8vq+25&gt;: mov al,ds:0x45fd3fbb (gd (gdb) x/10i W0ElBw5Smo9TPiWOeK8c 0x8048ab1 &lt;W0ElBw5Smo9TPiWOeK8c&gt;: call 0xb023:0x1c72c78c 0x8048ab8 &lt;W0ElBw5Smo9TPiWOeK8c+7&gt;: cmp esi,DWORD PTR ds:0xe4dfbbf1 0x8048abe &lt;W0ElBw5Smo9TPiWOeK8c+13&gt;: jmp 0xf86e358 0x8048ac3 &lt;W0ElBw5Smo9TPiWOeK8c+18&gt;: xchg ax,ax 0x8048ac5 &lt;W0ElBw5Smo9TPiWOeK8c+20&gt;: out dx,eax 0x8048ac6 &lt;W0ElBw5Smo9TPiWOeK8c+21&gt;: dec ebp 0x8048ac7 &lt;W0ElBw5Smo9TPiWOeK8c+22&gt;: xchg edi,eax 0x8048ac8 &lt;W0ElBw5Smo9TPiWOeK8c+23&gt;: popa 0x8048ac9 &lt;W0ElBw5Smo9TPiWOeK8c+24&gt;: <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> DWORD PTR [ecx-0x7e],esp 0x8048acc &lt;W0ElBw5Smo9TPiWOeK8c+27&gt;: <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> DWORD PTR [edi],esi</code> </pre><br><br>  The <code>qEWL8Jl0zdpmTbwhziDv -&gt; fjDKIzPtGuE8ZdfSL8vq -&gt; qEWL8Jl0zdpmTbwhziDv -&gt; W0ElBw5Smo9TPiWOeK8c -&gt; qEWL8Jl0zdpmTbwhziDv</code> as follows: <code>qEWL8Jl0zdpmTbwhziDv -&gt; fjDKIzPtGuE8ZdfSL8vq -&gt; qEWL8Jl0zdpmTbwhziDv -&gt; W0ElBw5Smo9TPiWOeK8c -&gt; qEWL8Jl0zdpmTbwhziDv</code> . <br><br>  After reviewing the first 10 lines of each function, could you find something unusual?  Look carefully at the first lines of <i>fjDKIzPtGuE8ZdfSL8vq</i> and <i>W0ElBw5Smo9TPiWOeK8c</i> , they are absolutely meaningless. <br><br>  I have never in my life (from a translator: in the original: <i>life :)</i> - most likely referring to a well-known mobile operator) did not meet with anything like this: <code>call 0xb023:0x1c72c78c</code> .  And the thing is that both of these functions are encrypted and <i>gdb</i> tried to disassemble them. <br><br>  So, <i>qEWL8Jl0zdpmTbwhziDv</i> is engaged in deciphering functions (therefore, it is its call that it faces). <br><br>  I will try to change the program execution algorithm, replacing the encrypted functions with their decrypted matches, and <i>remove the qEWL8Jl0zdpmTbwhziDv</i> call. <br><br>  Based on this, the new algorithm will look like this: <code>fjDKIzPtGuE8ZdfSL8vq -&gt; W0ElBw5Smo9TPiWOeK8c</code> - that's all. <br><br><h4>  Dead End 1. Start </h4><br>  Working on this <i>crackme</i> , I tried to disable the <i>TimeStampCounter</i> or somehow control it.  In this case, <i>rdtsc is</i> used to check the time interval between the execution of instructions.  Accordingly, if you try to run the program through <i>gdb</i> , then this interval will be much longer than the same, but during normal operation of the code.  Therefore, I tried to find a way to control the <i>tsc</i> counter, but, unfortunately, it is controlled by a processor - and therefore I cannot do anything from under the OS. <br>  But still, I tried to write a module for the kernel that would knock down the counter, setting its value to 0: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;linux/module.h&gt; // included for all kernel modules #include &lt;linux/kernel.h&gt; // included for KERN_INFO #include &lt;linux/init.h&gt; // included for __init and __exit macros #include &lt;linux/kthread.h&gt; // for threads #include &lt;linux/sched.h&gt; // for task_struct #include &lt;linux/time.h&gt; // for using jiffies #include &lt;linux/timer.h&gt; MODULE_LICENSE("GPL"); MODULE_AUTHOR("m00dy"); MODULE_DESCRIPTION("A Fake rdtsc emulation"); static struct task_struct *thread1; int thread_fn(){ uint32_t hi,lo; unsigned long j0,j1; int delay = HZ / 250; hi=0; lo=0xb; printk(KERN_INFO "In thread1"); j0 = jiffies; j1 = j0 + delay; asm volatile("wrmsr"::"c"(0x10),"a"(lo),"d"(hi)); while(1){ if(time_before(jiffies,j1)) schedule(); else { j1 = jiffies + delay; asm volatile("wrmsr"::"c"(0x10),"a"(lo),"d"(hi)); } } } static int __init hello_init(void) { char our_thread[8]="thread1"; printk(KERN_INFO "in init"); thread1 = kthread_create(thread_fn,NULL,our_thread); if((thread1)) { printk(KERN_INFO "in if"); wake_up_process(thread1); } return 0; } static void __exit hello_cleanup(void) { printk(KERN_INFO "Fake RDTSC end \n"); } module_init(hello_init); module_exit(hello_cleanup);=</span></span></span></span></code> </pre><br><br>  Unfortunately, this method did not work the way I needed, and I continued searching. <br><br><h4>  Dead End 1. End </h4><br>  I had an idea to stop the program at the moment when both functions will be in the decoded state.  For example, <i>0x8048ab0</i> is a very good place, since this is the end of the function <i>fjDKIzPtGuE8ZdfSL8vq</i> . <br><br>  Let's open <i>.gdbinit</i> and write: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> disassembly-flavor intel <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> disassemble-next-line on handle SIGTRAP noprint pass nostop b * 0x8048ab0</code> </pre><br><br>  Restart the <i>crackme</i> and <i>hook on</i> <i>gdb</i> again.  Enter 16 characters and press <i>c</i> . <br><br><pre> <code class="bash hljs">=&gt; 0xf7706430 &lt;__kernel_vsyscall+16&gt;: 5d pop ebp (gdb) c Continuing. Program received signal SIGSEGV, Segmentation fault. 0x08048ab1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> W0ElBw5Smo9TPiWOeK8c () =&gt; 0x08048ab1 &lt;W0ElBw5Smo9TPiWOeK8c+0&gt;: 9a 8c c7 72 1c 23 b0 call 0xb023:0x1c72c78c (gdb) x/10i fjDKIzPtGuE8ZdfSL8vq 0x8048604 &lt;fjDKIzPtGuE8ZdfSL8vq&gt;: push ebp 0x8048605 &lt;fjDKIzPtGuE8ZdfSL8vq+1&gt;: mov ebp,esp 0x8048607 &lt;fjDKIzPtGuE8ZdfSL8vq+3&gt;: call 0x8047b08 0x804860c &lt;fjDKIzPtGuE8ZdfSL8vq+8&gt;: xor eax,0x20ec8390 0x8048611 &lt;fjDKIzPtGuE8ZdfSL8vq+13&gt;: call 0x8047b08 0x8048616 &lt;fjDKIzPtGuE8ZdfSL8vq+18&gt;: xor eax,0x32ff45c6 0x804861b &lt;fjDKIzPtGuE8ZdfSL8vq+23&gt;: call 0x8047b08 0x8048620 &lt;fjDKIzPtGuE8ZdfSL8vq+28&gt;: xor eax,0xdafe45c6 0x8048625 &lt;fjDKIzPtGuE8ZdfSL8vq+33&gt;: call 0x8047b08 0x804862a &lt;fjDKIzPtGuE8ZdfSL8vq+38&gt;: xor eax,0xdbfd45c6 (gdb)</code> </pre><br><br>  Voila  Now we have a clean function <i>fjDKIzPtGuE8ZdfSL8vq</i> .  But we still have a problem with the <i>gdb</i> - <i>false assembly</i> (available in English <a href="http://www.stonedcoder.org/~kd/lib/14-61-1-PB.pdf">here</a> ). <br><br>  Let's save our function to a temporary file (parameters: filename, starting_address and ending_address): <br><br><pre> <code class="bash hljs">dump ihex memory fjDKIzPtGuE8ZdfSL8vq_dump 0x8048604 0x8048ab0</code> </pre><br><br>  Now we will do the same for the second function - we set breakpoint at the address: <i>0x08048e14</i> and create a dump: <br><br><pre> <code class="bash hljs">dump ihex memory W0ElBw5Smo9TPiWOeK8c_dump W0ElBw5Smo9TPiWOeK8c g999+3</code> </pre><br><br>  Now that we have both functions, let's try changing the program execution algorithm.  To do this, clear the .gdbinit file and set a breakpoint: <i>0x80494db</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> disassembly-flavor intel <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> disassemble-next-line on <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> * 0x80494ef commands <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(<span class="hljs-variable"><span class="hljs-variable">$eip</span></span>) = 0x80494f4 <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span> end <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> * 0x80494fa commands restore fjDKIzPtGuE8ZdfSL8vq_dump restore W0ElBw5Smo9TPiWOeK8c_dump <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span> end <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> * 0x08049506 commands <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(<span class="hljs-variable"><span class="hljs-variable">$eip</span></span>) = 0x804950b <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span> end <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> * 0x8049520 commands <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>(<span class="hljs-variable"><span class="hljs-variable">$eip</span></span>) = 0x8049525 <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span> end</code> </pre><br><br>  Well, now that we have changed the algorithm, everything is quite simple.  Follow the instructions described in the first part of this article. <br><br>  The characters we have entered are correlated (XOR) with some constants, after which the result is checked for correctness: <code>Inputs ^ FirstConstants == SecondConstants</code> , respectively: <code>Inputs = SecondConstants ^ FirstConstants</code> <br><br>  And here is our key generator: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python firstConst = [0x32,0xda,0xdb,0x1,0xf3,0x77,0x4c,0x57,0xbe,0x49,0xec,0x5f,0xab,0x7f,0xed,0x9f] secondConst = [0x0d,0xef,0xf1,0x4d,0xb6,0x4c,0x69,0x20,0xf9,0x20,0xdd,0x7c,0xda,0x3b,0xc9,0xaf] ret ="" for x in range(16): ret+=chr(firstConst[x] ^ secondConst[x]) print ret</span></span></code> </pre><br><br>  Let's go check: <br><br><pre> <code class="bash hljs">eren@lisa:~$ ./CrackTheNuke *** NUKE CONTROL SYSTEM *** PASSWORD: ?5*LE;%wGi1<span class="hljs-comment"><span class="hljs-comment">#qD$0 *** ACCESS GRANTED *** *** THE NUKE STOPPED *** eren@lisa:~$</span></span></code> </pre><br><br>  Everything is working. <br><br><h4>  Conclusion </h4><br>  I would also like to tell you what happened after I was hired.  On the very first day of my new job, they decided to change my department (I still can not understand why this company considers itself the best of the best in Turkey). <br><br>  After that, I became a <i>J2ee</i> developer.  I had to use <i>eclipse</i> , <i>svn,</i> and even an operating system called <i>Windows *</i> .  But, as it turned out later, this was not the worst.  Later they made me write <i>css</i> ... <br><br>  But now I live in Barcelona and I have a wonderful life. </div><p>Source: <a href="https://habr.com/ru/post/238009/">https://habr.com/ru/post/238009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237999/index.html">Andrey Romanenko at September Moscow Tech Meetup</a></li>
<li><a href="../238001/index.html">JavaScript Path Search Algorithms</a></li>
<li><a href="../238003/index.html">Startup Guide, Part 5: Moby Dick - The Theory Of Big Companies</a></li>
<li><a href="../238005/index.html">Technology iBeacon as an innovation in retail!?</a></li>
<li><a href="../238007/index.html">Generator of functional parsers on JavaScript (with transducers)</a></li>
<li><a href="../238011/index.html">Why everyone suddenly began to bend their smartphones and upload photos to the Internet</a></li>
<li><a href="../238017/index.html">What's new in Laravel 5?</a></li>
<li><a href="../238019/index.html">Microsoft has released an update for the time zones of Russia</a></li>
<li><a href="../238021/index.html">CVE-2014-6271, CVE-2014-7169: remote code execution in bash</a></li>
<li><a href="../238023/index.html">The Internet of things in Russia and the world: what integrators think and what awaits the market</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>