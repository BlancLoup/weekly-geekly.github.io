<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making life easier 2 (Postgresql + asp.net)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Just over a year ago, there was the task of writing a web application working with Postgresql database. To my regret, there was no standard adapter fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making life easier 2 (Postgresql + asp.net)</h1><div class="post__text post__text-html js-mediator-article">  Just over a year ago, there was the task of writing a web application working with Postgresql database.  To my regret, there was no standard adapter for working with the PostgreSQL database, and with the fact that it was found on the Internet (free) it was impossible to work. <br>  As a result, it was decided to do with the <a href="http://pgfoundry.org/projects/npgsql"><b>Npgsql</b></a> library. <br>  How to work with this library, there is documentation and many examples on the Internet.  Immediately after starting work with her, I did not like the fact that I needed to write a lot of the same type of code.  To facilitate the work, an additional layer was created in the form of a separate class for working with the database through this library. <br><br>  Features: <br>  1. connection data is taken from the web.config file <br>  2. there is an opportunity to work with multiple connections.  (for example, if a project has a modular system, and each module only works with its own scheme) <br><a name="habracut"></a><br><br>  sample part from web.config <br><pre><code class="cs hljs">&lt;appSettings&gt; &lt;!--    --&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"ProviderName"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"PostgreSQL"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"DataBase"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"DataBaseName"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"Port"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"80"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"Host"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"DataBaseHost"</span></span> /&gt; &lt;!--        --&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"UserName0"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"UserNameCore"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"Password0"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"PasswordCore"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"Schema0"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"SchemaCore"</span></span> /&gt; &lt;!--      <span class="hljs-number"><span class="hljs-number">1</span></span>   --&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"UserName1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"UserNameModule1"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"Password1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"PasswordModule1"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> key=<span class="hljs-string"><span class="hljs-string">"Schema1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-string"><span class="hljs-string">"SchemaModule1"</span></span> /&gt; &lt;/appSettings&gt;</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      in a separate class, you can also declare constants, for further convenience <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mkCore = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mkModule1 = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><br>  public methods of the WRKDataBase class <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WRKDataBase</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> module</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//   public bool Connected() // ,         public NpgsqlConnection CreateConnection() //     public DbCommand CreateCommand(string SQLString) // "" private bool RepairCommand(DbCommand Command, string SQLString) //  "" ,       public void AddCommandParam(ref DbCommand Command, string Param_name, object Param_value, DbType Type) //   "" public void AddCommandParamNull(ref DbCommand Command, string Param_name) //     NULL public bool CommandExecute(string SQLString="") //  sql  public bool CommandExecute(DbCommand Command) //  "" public DbDataReader CreateReader(string SQLString) // ""  sql  public DbDataReader CreateReader(DbCommand Command) //  ""  "" public DbDataAdapter CreateDataAdapter(string SQLString) //  "",  SQL  public bool UpdateAdapter(ref DbDataAdapter dbDataAdapter, DataSet dataSet) //   ""  "" public void AddCommandToAdapter( DbDataAdapter datadapter, DbCommand Command, string action ) // "" "" public bool CreateDataSet(DataSet Dataset, string SQLString) //     sql  public bool FillDataSet(ref DataSet dataSet, string SQLString, string datasetTableName) //  ""  sql  public void Dispose() //  </span></span></span></span></code> </pre><br>  in SQL queries, the names of tables, views, functions, etc.  need to be wrapped in "~", for example <br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ~<span class="hljs-keyword"><span class="hljs-keyword">years</span></span>~</code> </pre><br><br>  then it will be enough to connect to the system core <br><pre> <code class="cs hljs"> WRKDataBase wrkDataBase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WRKDataBase(<span class="hljs-string"><span class="hljs-string">""</span></span>.mkCore);</code> </pre><br><br>  for work, however, we are not already using a DataSource, but an ObjectDataSource.  ( <a href="http://msdn.microsoft.com/ru-ru/library/system.web.ui.webcontrols.objectdatasource(v%3Dvs.110).aspx">Description of ObjectDataSource on msdn</a> ) <br><br>  <b>Example:</b> <br>  object description class <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">sYear</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> god { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> naimen { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sYear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDataRecord rec</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rec[<span class="hljs-string"><span class="hljs-string">"god"</span></span>] != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { god = rec[<span class="hljs-string"><span class="hljs-string">"god"</span></span>].ToString(); }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rec[<span class="hljs-string"><span class="hljs-string">"naimen"</span></span>] != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { naimen = rec[<span class="hljs-string"><span class="hljs-string">"naimen"</span></span>].ToString(); }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sYear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pgod, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pnaimen</span></span></span><span class="hljs-function">)</span></span> { god = pgod; naimen = pnaimen; } }</code> </pre><br><br>  class of work with the database <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">sYearDB</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;sYear&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectListYear</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { WRKDataBase wrkDataBase; wrkDataBase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WRKDataBase(<span class="hljs-string"><span class="hljs-string">""</span></span>.mkModule1); List&lt;sYear&gt; ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;sYear&gt;(); ret.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> sYear(<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rdr = wrkDataBase.CreateReader(<span class="hljs-string"><span class="hljs-string">"Select god, god as naimen from ~vyear~ order by god"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (rdr.Read()) ret.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> sYear(rdr)); rdr.Close(); wrkDataBase.Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br><br>  Datasource: <br><pre> <code class="cs hljs"> &lt;asp:ObjectDataSource ID=<span class="hljs-string"><span class="hljs-string">"dsYear"</span></span> runat=<span class="hljs-string"><span class="hljs-string">"server"</span></span> SelectMethod=<span class="hljs-string"><span class="hljs-string">"SelectListYear"</span></span> TypeName=<span class="hljs-string"><span class="hljs-string">"DBNameSpace.sYearDB"</span></span> DataObjectTypeName=<span class="hljs-string"><span class="hljs-string">"DBNameSpace.sYear"</span></span>&gt; &lt;/asp:ObjectDataSource&gt;</code> </pre><br><br>  UPD: Promised <a href="https://drive.google.com/file/d/0B7UkW-c0QHB6bnQ5QXJWZFEyeVk/edit%3Fusp%3Dsharing">class reference</a> </div><p>Source: <a href="https://habr.com/ru/post/215999/">https://habr.com/ru/post/215999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215977/index.html">COOLRF: Available Thin Buttons for Smart Home</a></li>
<li><a href="../215983/index.html">Diagnosing Namespaces in OpenStack Neutron</a></li>
<li><a href="../215985/index.html">Python-digest # 18. News, interesting projects, articles and interviews [March 9, 2014 - March 16, 2014]</a></li>
<li><a href="../215991/index.html">Œª-calculus. Part Two: Practice</a></li>
<li><a href="../215993/index.html">Impressions of the Chinese warez-scene</a></li>
<li><a href="../216001/index.html">We ask Vkontakte remind pro dumplings</a></li>
<li><a href="../216003/index.html">SpeedReader - Qt library for speed reading</a></li>
<li><a href="../216005/index.html">Internet technology excellence or one life offline - a look from the past</a></li>
<li><a href="../216007/index.html">QEverCloud: Evernote SDK for Qt</a></li>
<li><a href="../216011/index.html">Smartwatch Sony Smartwatch 2 SW2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>