<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making Hyperboria hotspot. Allowance for picking the router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to tell you how to flash on an OpenWrt router and install cjdns there. In truth, the study of the intricacies of this busin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making Hyperboria hotspot. Allowance for picking the router</h1><div class="post__text post__text-html js-mediator-article"> In this article I will try to tell you how to flash on an OpenWrt router and install cjdns there.  In truth, the study of the intricacies of this business took me a lot of time and nerves.  Mainly because a lot of things in OpenWrt are underdocumented, and I had to search a lot in forums and think things through.  I think this is the case when the best documentation is the source.  So I will try to write this article as I would like to read at the very beginning of this journey. <br><a name="habracut"></a><br><br>  So the first thing to do is go to the OpenWrt website and see the list of supported devices: <a href="http://wiki.openwrt.org/toh/start">wiki.openwrt.org/toh/start</a> <br>  If you did not find your piece of iron, do not be upset. <code><a href="http://kamikaze.openwrt.org/docs/openwrt.html"></a>      OpenWrt   ,   : kamikaze.openwrt.org/docs/openwrt.html#x1-540002.3</code>  <code><a href="http://kamikaze.openwrt.org/docs/openwrt.html"></a>      OpenWrt   ,   : kamikaze.openwrt.org/docs/openwrt.html#x1-540002.3</code> Although, you first need to somehow pull the kernel sources from the manufacturer. <br><br>  Now a little theory.  OpenWrt uses two file systems to store rootfs: SquashFS and JJFS2.  It is also possible to connect others, but more on that later. <br>  SquashFS is a compressed static file system.  It is what is actually sewn.  Due to its static nature, compression is better in it. <br>  JJFS2 is a compressed dynamic file system in which file changes are written.  It is mounted as if on top of SquashFS using the Linux Overlayfs kernel feature.  It appeared since kernel version 3.11. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Environment for the assembly of OpenWRT can be downloaded in 4 versions. <br><ul><li>  OpenWrt Buildroot is a kind of Frankenstein monster, written in make, which itself downloads the sources of everything you need, it patches all of this, assembles the cross compiler itself, builds packages and images for firmware.  Fork <a href="http://buildroot.org/">Buildroot</a> About the format of these makefiles.  Here it is enough to quote the <a href="http://wiki.openwrt.org/ru/doc/devel/packages">documentation</a> : <br>  ‚ÄúLooking at the Makefile from any package, you hardly recognize the usual Makefile in it.  This can be described as blatant neglect and abuse of the traditional make format, however, converting the package's Makefile to an object-oriented template simplified the entire process of porting applications. ‚Äù </li><li>  OpenWrt Image Builder is the same, but it loads already compiled packages and builds an image from them. </li><li>  OpenWrt SDK is the same, but the set of programs for cross-compiling is already assembled and it can no longer be assembled images.  Designed to build individual packages. </li><li>  OpenWrt based Toolchain is an already compiled cross-compilation program, torn from Openwrt Buildroot. </li></ul><br>  The last three can be compiled from the OpenWrt Buildroot. <br><br>  As mentioned above, in SquashFS, compression is better, so we have more chances to fit all that we need by assembling the firmware ourselves than by downloading the finished image and delivering the right package.  For those who are going to put the finished minimum firmware, <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/">here are the</a> builds from the developers.  They are sorted by architecture (target column in the list of supported equipment) and by memory type (nand and all the others), the file names include the name of the router.  Firmware containing the name "sysupgrade" designed for flashing means already installed OpenWrt.  Containing the "factory" can feed the web form factory firmware.  Do not confuse. <br><br><h4>  We proceed to the assembly. </h4><br><br>  <b>Attention!</b>  The build <b>should not be</b> from the superuser or fakeroot. <br><br>  To get started, download buildroot.  <a href="https://dev.openwrt.org/wiki/GetSource">There</a> is a list of branches and commands for downloading them.  We will build Attitude Adjust stable: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://git.openwrt.org/12.09/openwrt.git</code> </pre><br>  Repositories with beta, beta2, rc1 and rc2, apparently, no, but sorry, because the package compiled for stable on the beta did not, just cursed that the kernel git commit id was not the one needed (although the versions were the same). <br><br>  Next, following the <a href="">instructions</a> , we add to the list of places from which the source code "repository" with cjdns will be loaded. <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./openwrt cp feeds.conf.default feeds.conf</code> </pre><br>  Add a line to the feeds.conf file <br><pre> <code class="hljs objectivec">src-git cjdns git:<span class="hljs-comment"><span class="hljs-comment">//github.com/cjdelisle/cjdns-openwrt.git</span></span></code> </pre><br>  Next, load the source of all packages: <br><pre> <code class="bash hljs">./scripts/feeds update -a ./scripts/feeds install -a</code> </pre><br>  Now run <br><pre> <code class="bash hljs">make menuconfig</code> </pre><br>  and customize everything you need. <br><img src="https://habrastorage.org/getpro/habr/post_images/923/bf4/c46/923bf4c461e0a9cbc467607f51b57323.png"><br><br>  Select "Target System" (the one listed in the <a href="http://wiki.openwrt.org/toh/start">list of supported devices</a> next to the name of your router), Subtarget (if the router does not have NAND permanent memory, feel free to choose Generic), "Target Profile" (look for the name of the router we will build under).  In Target Images, you usually don‚Äôt need to change anything.  Select the space. <br><br>  At this stage, all the necessary drivers have already been noted (thanks to the "Target Profile").  Then we go through the rest of the branches and choose the packages we need (It‚Äôs for us. In theory, it will work this way).  Search here is not provided, so we will look like this: <br><pre> <code class="bash hljs">find ./feeds/ -name nano</code> </pre><br>  Fortunately, most packages are sorted into sections.  Although they may be located in ./package and then you will not find them in this way.  In the output, we see ./feeds/packages/utils/nano, which means that we need to look for the nano in the "Utilities" section.  For complete confidence, you can read the makefile pact.  For nano, this is ./feeds/packages/utils/nano/Makefile.  In it we see the following fragment: <br><pre> <code class="hljs go">define Package/nano SUBMENU:=Editors SECTION:=utils CATEGORY:=Utilities TITLE:=An enhanced clone of the Pico text editor URL:=http:<span class="hljs-comment"><span class="hljs-comment">//www.nano-editor.org/ MAINTAINER:=Bernhard Loos &lt;bernhardloos@googlemail.com&gt; DEPENDS:=+libncurses endef</span></span></code> </pre><br>  ‚ÄúCATEGORY‚Äù is the name of the section, ‚ÄúSUBMENU‚Äù is the name of the subsection.  By the way, this record may not be one.  The fact is that several different packages can be assembled from one source set. <br><br>  <b>UPD:</b> Habrapamer <a href="https://habrahabr.ru/users/klirichek/" class="user_link">klirichek</a> suggested that there is a search here.  To enter it, you need to press "/" in menuconfig. <br><img src="https://habrastorage.org/getpro/habr/post_images/961/9ed/f61/9619edf61db0a94a69509d1e574a80a9.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/db3/36d/d8d/db336dd8db904b358bed86a7a178fafc.png"><br>  We get a list of objects whose name includes the entered query, with a full description and location in the menu. <br><br>  So, the packages that we may need. <br><ul><li>  nano - so you don't have to edit configs using vi or cat / echo </li><li>  htop - process viewer </li><li>  iftop - a program for tracking network activity (who, with whom, on which port, at what speed) </li><li>  tcpdump - well, where can I go without it? </li><li>  kmod-usb-storage - kernel module for connecting usb external storage media </li><li>  kmod-usb-storage-extras - a kernel module for connecting some exotic external usb storage devices (for example, a card reader) </li><li>  block-mount is a set of scripts for automatic mounting by / etc / fstab.  For automounting filesystems according to config files in uci format (more on this later), the mount from busybox is enough, but the swap is not automatically mounted without them. </li><li>  swap-utils - required to mount swap </li><li>  All sorts of file system drivers.  You can find it in ‚ÄúKernel modules‚Äù -&gt; ‚ÄúFilesystems‚Äù </li><li>  shadow-groopadd, shadow-groupdel, shadow-groupmod, shadow-groups, shadow-passwd, shadow-su, shadow-useradd, shadow-userdel, shadow-usermod - a set of utilities for managing users and groups.  You can usually do without them. </li><li>  ip, iw, iptables, ip6tables - for manual network configuration </li><li>  bind-dig - dns <b>client</b> </li></ul><br>  It should be noted that everything may not fit.  In this case, the image for the router will not be assembled, but the packages will be assembled.  The package can be noted so that it is assembled, but is not included in the image.  To do this, press the m key. <br><br>  And now I will talk about one bug that prevents the installation of cjdns.  In cjdns dependencies, there is a package with the wonderful name nacl.  It is used when building other packages, but it does not build a binary package from it.  At the same time, it appears in the dependencies of the binary package cjdns.  As a result, in order to install an already assembled package with cjdns, you first need to install the nacl package that does not exist in the assembled form. <br><br>  Now how to get around it.  Open ./openwrt/feeds/cjdns/cjdns/Makefile in a text editor, find this snippet: <br><pre> <code class="hljs go">define Package/cjdns SECTION:=net CATEGORY:=Network SUBMENU:=Routing and Redirection TITLE:=Experimental self configuring routing protocol. DEPENDS:=+kmod-tun +kmod-ipv6 +libnl +nacl +libpthread MAINTAINER:=cjd -- #cjdns on irc.efnet.org endef</code> </pre><br>  and remove from "DEPENDS" "+ nacl".  It should work like this: <br><pre> <code class="hljs go">define Package/cjdns SECTION:=net CATEGORY:=Network SUBMENU:=Routing and Redirection TITLE:=Experimental self configuring routing protocol. DEPENDS:=+kmod-tun +kmod-ipv6 +libnl +libpthread MAINTAINER:=cjd -- #cjdns on irc.efnet.org endef</code> </pre><br>  In menuconfig we find nacl (in the ‚ÄúLibraries‚Äù section) and set it to <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> make <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> free <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <ul><li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> </li><li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> </ul> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> src/gz &lt; &gt; &lt;url &gt; <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file:////// <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> mount /dev/sda1 /mnt <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> uci commit fstab <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </h4> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br>   ,  '' ''       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</b></code> <div class="spoiler_text"> <ol><li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> <li> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </li> </ol> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </div></div> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> <pre> <code class="hljs lua"><code><code class="bash">. <br> <br>   nacl : <br> make <span class="hljs-built_in"><span class="hljs-built_in">package</span></span>/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network .      tl-mr3220 v1<span class="hljs-number"><span class="hljs-number">.2</span></span>: <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'loopback'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'lo'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.0.0.0'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0 radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch option name <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option reset <span class="hljs-string"><span class="hljs-string">'1'</span></span> option enable_vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> switch_vlan option device <span class="hljs-string"><span class="hljs-string">'eth0'</span></span> option vlan <span class="hljs-string"><span class="hljs-string">'1'</span></span> option ports <span class="hljs-string"><span class="hljs-string">'0 1 2 3 4'</span></span></code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: <span class="hljs-string"><span class="hljs-string">"Network"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"Routing and Redirection"</span></span>-&gt;<span class="hljs-string"><span class="hljs-string">"cjdns"</span></span>. <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  <span class="hljs-string"><span class="hljs-string">"   "</span></span> opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk opkg install /tmp/hiawatha_7<span class="hljs-number"><span class="hljs-number">.7</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b><span class="hljs-built_in"><span class="hljs-built_in">remove</span></span></b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/<span class="hljs-number"><span class="hljs-number">12.09</span></span>/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/fstab.         : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled <span class="hljs-number"><span class="hljs-number">1</span></span> option enabled_fsck <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      <span class="hljs-string"><span class="hljs-string">"device"</span></span>   <span class="hljs-string"><span class="hljs-string">"uuid"</span></span> , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled <span class="hljs-number"><span class="hljs-number">1</span></span></code> <br>   .     swap.  linux      swap  ,    ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> (    ?) ,     ,   swap. ,   <span class="hljs-string"><span class="hljs-string">" "</span></span> -  .        -  . <span class="hljs-number"><span class="hljs-number">512</span></span> MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/wireless     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-iface option device radio0 option mode adhoc option ssid hype option bssid <span class="hljs-number"><span class="hljs-number">66</span></span>:<span class="hljs-number"><span class="hljs-number">77</span></span>:<span class="hljs-number"><span class="hljs-number">55</span></span>:<span class="hljs-number"><span class="hljs-number">88</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:aa option disabled <span class="hljs-number"><span class="hljs-number">0</span></span></code> <br>  <span class="hljs-string"><span class="hljs-string">"device"</span></span>    <span class="hljs-string"><span class="hljs-string">""</span></span>,    <span class="hljs-string"><span class="hljs-string">"wifi-device"</span></span>.     : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> wifi-device <span class="hljs-string"><span class="hljs-string">'radio0'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'mac80211'</span></span> option macaddr <span class="hljs-string"><span class="hljs-string">'ab:cd:ef:ab:cd:ef'</span></span> option hwmode <span class="hljs-string"><span class="hljs-string">'11ng'</span></span> option htmode <span class="hljs-string"><span class="hljs-string">'HT40+'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'SHORT-GI-40'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'TX-STBC'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'RX-STBC1'</span></span> list ht_capab <span class="hljs-string"><span class="hljs-string">'DSSS_CCK-40'</span></span> option channel <span class="hljs-string"><span class="hljs-string">'auto'</span></span> option txpower <span class="hljs-string"><span class="hljs-string">'18'</span></span> option country <span class="hljs-string"><span class="hljs-string">'RU'</span></span></code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/network.   interface   <span class="hljs-string"><span class="hljs-string">"type"</span></span>   <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>  : <br> <code><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> interface <span class="hljs-string"><span class="hljs-string">'lan'</span></span> option <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-string"><span class="hljs-string">'bridge'</span></span> option proto <span class="hljs-string"><span class="hljs-string">'static'</span></span> option netmask <span class="hljs-string"><span class="hljs-string">'255.255.255.0'</span></span> option _orig_ifname <span class="hljs-string"><span class="hljs-string">'eth0, radio0.network1'</span></span> option _orig_bridge <span class="hljs-string"><span class="hljs-string">'true'</span></span> option ifname <span class="hljs-string"><span class="hljs-string">'eth0 wlan0'</span></span> option ipaddr <span class="hljs-string"><span class="hljs-string">'192.168.5.1'</span></span> option gateway <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span> option broadcast <span class="hljs-string"><span class="hljs-string">'192.168.5.255'</span></span> option dns <span class="hljs-string"><span class="hljs-string">'192.168.5.2'</span></span></code> <br>       <span class="hljs-string"><span class="hljs-string">"_orig_ifname"</span></span> <span class="hljs-string"><span class="hljs-string">"radio0.network1"</span></span>,   <span class="hljs-string"><span class="hljs-string">"ifname"</span></span> - <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span> <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> <span class="hljs-string"><span class="hljs-string">"ETHInterface"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>: <span class="hljs-string"><span class="hljs-string">"wlan0"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, }, { <span class="hljs-string"><span class="hljs-string">"bind"</span></span>:<span class="hljs-string"><span class="hljs-string">"br-lan"</span></span>, <span class="hljs-string"><span class="hljs-string">"beacon"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=<span class="hljs-number"><span class="hljs-number">93</span></span> STOP=<span class="hljs-number"><span class="hljs-number">51</span></span> start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . <span class="hljs-string"><span class="hljs-string">"start()"</span></span> -  ,    -. <span class="hljs-string"><span class="hljs-string">"stop()"</span></span> -  .  ,   ,        ,    ,    ,      . -,    cjdns    <span class="hljs-string"><span class="hljs-string">"pidFile"</span></span>,        <span class="hljs-string"><span class="hljs-string">"master"</span></span>,      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span></b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git <br>     ,    .</code></code> </pre> <code><code class="bash">. <br> <br>   nacl : <br> make package/nacl/compile</code> <br>      - mate-terminal, ,   tmux.    ,    ,  ,  . <br> <br>   .     ,       . ,          .  ,  - ,          . ,         tl-mr3220,               <a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">serial hack adapter</a> ,    . <br>    .  OpenWrt  <s></s>    UCI,   .   ,     . ,   ,   <a href="http://wiki.openwrt.org/ru/doc/uci"></a> ,       .  ,      /etc/config/. <br>   -  ,     ,  ,    Buildroot    files      . ,         ./files/etc/config/network .      tl-mr3220 v1.2: <br> <code>config interface 'loopback' option ifname 'lo' option proto 'static' option ipaddr '127.0.0.1' option netmask '255.0.0.0' config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0 radio0.network1' option _orig_bridge 'true' option ifname 'eth0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2' config switch option name 'eth0' option reset '1' option enable_vlan '1' config switch_vlan option device 'eth0' option vlan '1' option ports '0 1 2 3 4'</code> <br> <br>     ,    OpenWrt   .    _orig_ifname  _orig_bridge  ,   . ,    ,            ,  , , -   . <br> <br>    cjdns.    ,     menuconfig: "Network"-&gt;"Routing and Redirection"-&gt;"cjdns". <br> <br> ,   : <br> <code>make</code> <br> <br>       ./bin,   target- (    ).  ,       ./bin/ar71xx,    ./bin/ar71xx/packages/.    ./bin/ar71xx/openwrt-ar71xx-generic-rootfs.tar.gz (    target)  ,      . <br> <br>   . <br>    , openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin     .      ,     ,     : <b>       wi-fi!</b> <br> <br>      OpenWrt. <br> <br>   ssh, ,    : <br> <code>free</code> <br>         tmpfs. <br>    /etc/sysupgrade.conf.        ,     (   jffs2).    #.        ,      . <br>   /tmp   (  tmpfs): <br> <code>scp ./bin/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin root@192.168.5.1:/tmp</code> <br>   .      : <br> <code>cd /tmp md5sum openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br>       . <br> <br>    : <br> <code>sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-sysupgrade.bin</code> <br> <br>    ,   .   ssh    passwd   root. <br> <br>       ,       .        ,     ,    . <br> <br>  . <br>  OpenWrt      <a href="https://code.google.com/p/opkg/">opkg</a> . : <br> <b>update</b> -     .    /tmp/opkg-lists/snapshots,   /tmp  tmpfs.  ,    -        . <b>upgrade</b> -   ,    ,  ,  .        trunc.       ,  .         (     kmod-).  "   " opkg   . <b>install</b>   ,    url  : <br> <code class="bash">opkg install hiawatha opkg install http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/hiawatha_7.7-2_ar71xx.ipk opkg install /tmp/hiawatha_7.7-2_ar71xx.ipk</code> <b>configure</b> -   ,  .  ,      . <b>remove</b> -  . <b>list</b> -  . <b>list-installed</b> -  —ñ . <br>    : <a href="http://wiki.openwrt.org/doc/techref/opkg">wiki.openwrt.org/doc/techref/opkg</a> <br>   ,   /etc/opkg.conf     <br> <code>src/gz &lt; &gt; &lt;url &gt;</code> <br> : <br> <code>src/gz attitude_adjustment http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/packages</code> <br>   ,   ,   <br> <code>src/gz local file://////</code> <br> ,   ,   apt-get,  ,      https.  https, ,  ,         downloads.openwrt.org. ,   ,  , ,  ,  - . <br> <br>      ( ). <br>      .        ext4. ,     ,       . ,    /dev   .  ,   . <br> ,  : <br> <code>mount /dev/sda1 /mnt</code> <br>   ,  ,   .  <br> <code>rm -rf /mnt/* tar -C /overlay -cvf - . | tar -C /mnt -xf - #   overlay</code> <br>   tar,   -?  ,    .      <a href="http://wiki.openwrt.org/doc/howto/extroot">wiki.openwrt.org/doc/howto/extroot#installation1</a> . <br> ,    /etc/config/fstab.         : <br> <code>config mount option target /overlay option device /dev/sda1 # option uuid &lt;uuid&gt; option fstype ext4 option options rw,sync option enabled 1 option enabled_fsck 0</code> <br>     ,  <br> <code>uci commit fstab</code> <br>  -   uuid,          usb.      "device"   "uuid" , , uuid . <br>    : <a href="http://wiki.openwrt.org/doc/uci/fstab">wiki.openwrt.org/doc/uci/fstab#mounting.filesystem</a> <br> <br>  swap. <br>   ,       : <br> <code>config swap option device /dev/sda2 # option uuid &lt;uuid&gt; option enabled 1</code> <br>   .     swap.  linux      swap  ,    ,     " " (    ?) ,     ,   swap. ,   " " -  .        -  . 512 MiB, ,    ! <br>      swap     free. <br>     <i>uci commit</i> . <br> <br> C cjdns (     squashfs). <br>     scp  /tmp       opkg.    cjdns.       .     ,   ETHInterface    br-lan  eth0. <br> <br>  wi-fi   ad-hoc. <br>  /etc/config/wireless     : <br> <code>config wifi-iface option device radio0 option mode adhoc option ssid hype option bssid 66:77:55:88:44:aa option disabled 0</code> <br>  "device"    "",    "wifi-device".     : <br> <code>config wifi-device 'radio0' option type 'mac80211' option macaddr 'ab:cd:ef:ab:cd:ef' option hwmode '11ng' option htmode 'HT40+' list ht_capab 'SHORT-GI-40' list ht_capab 'TX-STBC' list ht_capab 'RX-STBC1' list ht_capab 'DSSS_CCK-40' option channel 'auto' option txpower '18' option country 'RU'</code> <br>    .            .     <i>uci commit wireless ; /etc/init.d/wireless restart</i>     ,    .     ,    <i>disabled</i>  1. <br>  ,       bridge    .  ,     : <br> <code>iw dev &lt;/code&gt;    : &lt;source&gt; brctl show</code> <br>   ad-hoc     ,   /etc/config/network.   interface   "type"   "bridge"  : <br> <code>config interface 'lan' option type 'bridge' option proto 'static' option netmask '255.255.255.0' option _orig_ifname 'eth0, radio0.network1' option _orig_bridge 'true' option ifname 'eth0 wlan0' option ipaddr '192.168.5.1' option gateway '192.168.5.2' option broadcast '192.168.5.255' option dns '192.168.5.2'</code> <br>       "_orig_ifname" "radio0.network1",   "ifname" - "wlan0" <br> <br>       cjdns.  ETHInterface, ,    : <br> <code> "ETHInterface": [ { "bind": "wlan0", "beacon": 2, }, { "bind":"br-lan", "beacon": 2 } ]</code> <br>    ,   , -,    cjdroute .  ,       ,   - . <br> <br>   . <br>       /etc/init.d/ .   /etc/init.d/cjdns : <br> <code class="bash">#!/bin/sh /etc/rc.common START=93 STOP=51 start() { cjdroute &lt; /etc/cjdroute.conf } stop() { killall cjdroute }</code> <br> $START  $STOP         . "start()" -  ,    -. "stop()" -  .  ,   ,        ,    ,    ,      . -,    cjdns    "pidFile",        "master",      OpenWrt. <br>    <br> <code>chmod u+rwx /etc/init.d/cjdns /etc/init.d/cjdns enable</code> <br>      OpenWrt   : <a href="http://wiki.openwrt.org/doc/techref/initscripts">wiki.openwrt.org/doc/techref/initscripts</a> <br> <br> , , .  ,         ! <br> <br> UPD:  cjdns     <a href="https://github.com/cjdelisle/cjdns-openwrt"> </a>      README.md  ,     <a href="https://github.com/seattlemeshnet/meshbox">   </a> . <br> <br> UPD2:       . <br> <b class="spoiler_title">  ,  '' ''</b>       uci. , , ,     json-uci,   LUA,     ,  ,  -   ,     .        -      .  cjdroute    .   ,     crashey.   init-   ,      trunc.      . ,        todo. <br> <br>     ,  , ,  .        . <br>   -   ,      Makefile    init-.      ,   ,   .  : <a href="https://github.com/DinoAsm/cjdns-openwrt-tiny">github.com/DinoAsm/cjdns-openwrt-tiny</a> <br>  ,   feeds.conf  : <br> <code>src-git cjdns_tiny https://github.com/DinoAsm/cjdns-openwrt-tiny.git</code> <br>     ,    .</code> </div><p>Source: <a href="https://habr.com/ru/post/202536/">https://habr.com/ru/post/202536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202524/index.html">How to invest $ 100,000 in your own karma (part 2)</a></li>
<li><a href="../202526/index.html">How does Forex work and is it needed?</a></li>
<li><a href="../202528/index.html">Search for various variants of transliteration of Russian texts (full name) in Latin for samples in MySQL</a></li>
<li><a href="../202530/index.html">Tiny Arkanoid in JavaScript (30 lines of code)</a></li>
<li><a href="../202534/index.html">Problems of transition to middle managers</a></li>
<li><a href="../202538/index.html">Dual Standards for Account Encryption</a></li>
<li><a href="../202540/index.html">Love in pixels or what is Love2d</a></li>
<li><a href="../202544/index.html">KUB-Pico / 220 Socket Controller from Technotronics</a></li>
<li><a href="../202548/index.html">New mitigation mechanisms in Windows 8.1</a></li>
<li><a href="../202550/index.html">Shopping list</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>