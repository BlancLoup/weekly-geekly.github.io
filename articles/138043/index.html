<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Networks for the smallest. Part two. Switching</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All issues  8. Networks for the smallest. Part Eight BGP and IP SLA 
 7. Networks for the smallest. Part Seven. VPN 
 6. Networks for the smallest. Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Networks for the smallest. Part two. Switching</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">All issues</b> <div class="spoiler_text">  <a href="http://linkmeup.ru/blog/65.html">8. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/65.html">Part Eight</a>  <a href="http://linkmeup.ru/blog/65.html">BGP and IP SLA</a> <br>  <a href="http://linkmeup.ru/blog/50.html">7. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/50.html">Part Seven.</a>  <a href="http://linkmeup.ru/blog/50.html">VPN</a> <br>  <a href="http://linkmeup.ru/blog/33.html">6. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/33.html">Part six.</a>  <a href="http://linkmeup.ru/blog/33.html">Dynamic routing</a> <br>  <a href="http://linkmeup.ru/blog/16.html">5. Networks for the smallest: Part Five.</a>  <a href="http://linkmeup.ru/blog/16.html">NAT and ACL</a> <br>  <a href="http://linkmeup.ru/blog/15.html">4. Networks for the smallest: Part Four.</a>  <a href="http://linkmeup.ru/blog/15.html">STP</a> <br>  <a href="http://linkmeup.ru/blog/14.html">3. Networks for the smallest: Part Three.</a>  <a href="http://linkmeup.ru/blog/14.html">Static routing</a> <br>  <a href="http://linkmeup.ru/blog/13.html">2. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/13.html">Part two.</a>  <a href="http://linkmeup.ru/blog/13.html">Switching</a> <br>  <a href="http://linkmeup.ru/blog/12.html">1. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/12.html">Part one.</a>  <a href="http://linkmeup.ru/blog/12.html">Connection to the equipment cisco</a> <br>  <a href="http://linkmeup.ru/blog/11.html">0. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/11.html">Part zero.</a>  <a href="http://linkmeup.ru/blog/11.html">Planning</a> <br></div></div><br><br>  After a boring story about connecting to cats, we proceed to the network configuration.  This time the topics will be complicated for beginners, beaten for old people.  However, network aksakals hardly manage to learn something new from this cycle.  So today: <br>  a) gently absorb the theory of switches, the levels of the network model, the concept of encapsulation and headers (do not worry - it's not time), <br>  b) we collect the network planned in the zero part of the cycle, <br>  c) configure VLANs, deal with access and trunk ports and tagged Ethernet frames, <br>  d) correlate current knowledge with the TCP / IP protocol stack and the OSI model (yes, we will finally touch it). <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OtY-Z6_PDpU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before you turn to practice, we strongly recommend that you read the zero part, where we have planned and recorded everything. <br><br><a name="habracut"></a><h3>  Theory </h3><br><br>  First you need to determine the definitions and determine the terminology.  At the beginning of this journey there may be difficulties, despite the mountains of Wikipedia and the breaking of technical articles. <br>  Consider the most common terms, because what is a switch and a router, you, first of all, imagine, secondly, along the way more than once we will touch them.  So, moved: <br>  <b>SKS</b> - structured cable system - you will find this definition in any Yandex.  In fact, these are all wires, sockets, patch panels and patch cords, that is, roughly speaking, this is the physics of your network in a narrow sense, broadly it is a combination of networks: LAN, telephone networks, video surveillance systems and so on.  This is a separate, very <a href="http://ockc.ru/">large</a> and sometimes <a href="http://forum.ixbt.com/topic.cgi%3Fid%3D86:21">complex</a> layer of knowledge and technology, which has no intersection with the setting at all, so we will not turn to it anymore.  We have introduced this term for the most part so that the reader feels different from the following. <br>  <b>LAN</b> = Local Computing Network = LAN = Local Area Network.  The relevance of the word ‚ÄúComputational‚Äù can now be questioned, just as in the word computer.  Still, speaking of modern networks and devices, we no longer keep in mind the term ‚Äúcomputations‚Äù, despite the fact that the deep essence has remained unchanged.  In this regard, the term bourgeois is more universal and gives a simpler idea of ‚Äã‚Äãits meaning. <br>  So, the local network - as a first approximation - is the network of your organization.  Here, for example, we serve the network of the company ‚ÄúLift mi Ap‚Äù with two offices, and so the networks of these two offices will be the local network. <br>  In the second approximation, a local network is a network that is managed by a single network administrator.  That is, for example, you are responsible for the regional segment of the provider's network, in this case, your regional network with all subnets will be local, while the superior network and networks of other areas no longer exist, since other people are already responsible for them.  Generally speaking, this is already the MAN - Metropolian Area Network - a city level network.  But to some extent the concept of LAN and even more so VLAN can be applied to it. <br>  From the point of view of me, as a subscriber of this provider, my local network is all that is up to my home router.  Intuitively, probably, everyone understands what is being said. <br>  It is with local area networks that we will deal in the next issues. <br><br>  And the last thing I would like to note in connection with the LAN is IP addressing. <br>  You all know that when you turn on a home Wi-Fi router on your network, it usually gives you an IP address, like 192.168.1.x.  Why exactly 192.168 at the beginning? <br><br>  The fact is that all IP addresses are divided into private (private, it‚Äôs internal, ‚Äúgray‚Äù, local), and public.  Public ones are used on the Internet, each address is unique, their distribution is controlled by the Internet Assigned Numbers Authority ( <a href="http://www.iana.org/">IANA)</a> organization. <br><br>  Private are used to address the hosts (well, strictly speaking, not the hosts, but the interfaces) within the LAN, no one controls their distribution.  Three ranges of addresses were assigned to them (one from each class): <br><br>  <b>10.0.0.0 - 10.255.255.255</b> <br>  <b>172.16.0.0 - 172.31.255.255</b> <br>  <b>192.168.0.0 - 192.168.255.255</b> <br><br><blockquote>  An important point with regards to the "address classes", this was somehow written on <a href="http://habrahabr.ru/blogs/sysadm/129664/">Habr√©: the</a> address classes no longer exist.  Later we will talk about addressing in detail, but for now the recommendation is this: forget about the existence of address classes, so as not to be confused at the interview or in the conversation. </blockquote><br><br>  These are the addresses you can use on your private network.  They can easily be repeated (and repeated) in different local networks, and they do not go beyond it.  The private address is private, therefore any packet with an address from the ranges indicated above that reached the provider will be discarded. <br><br>  If you go back to our old <a href="">scheme,</a> you will see that for our network we have selected private addresses from the range 172.16.0.0 - 172.31.255.255. <br>  You can read about IP addresses in detail <a href="http://citforum.ru/nets/ip/glava_3.shtml">here</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B0%25D1%2581%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_IP-%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B5%25D1%2581">here</a> . <br>  All providers and in the internal network of any large organization use these <i>gray</i> subnets.  Unless you are a state university, which once had a network of several thousand public addresses: Kemerovo State University, for example, is not perplexed by NAT and other nonsense - white IP are distributed to all computers of the university network. <br><br>  <b>Broadcast domain</b> is a network area in which broadcast messages are exchanged, and devices can send each other messages directly, without the involvement of the router. <br>  What are we talking about here?  Well, for example, sent your computer a broadcast request to the network in search of a DHCP server.  This <i>frame</i> (the same <i>frame</i> ) is addressed to all devices and has the recipient's MAC address FF: FF: FF: FF: FF: FF.  First, it gets to the switch, from which its copies are sent to all ports.  Then a part gets to other computers, a part goes to neighboring switches, someone comes to the router, and one copy is received by a DHCP server.  And here is the part of the network within which these frames can live and is called the broadcast domain.  And they end their lives on end hosts (computers, servers) or on routers that drop them if they are not intended for them: <br><img src="https://habrastorage.org/getpro/habr/post_images/76c/836/ff6/76c836ff6e824c5e1ad1922c110b1b46.gif" alt="Broadcast Example"><br>  If there are VLANs on the switch, they also share broadcast domains, because the packet between them must pass through the router, which will discard the broadcast messages.  Thus, a single VLAN is one broadcast domain. <br><img src="https://habrastorage.org/getpro/habr/post_images/71b/45c/643/71b45c64373218d8222d2e1fa6162ad3.gif" alt="Broadcast with VLANs Example"><br><br>  Once again: we have three ways to distinguish between broadcast domains: <br>  1) Put the router and spread the hosts on different subnets, <br>  2) Divide the network with VLANs, <br>  3) Break the cable. <br><br>  Well, the very tin, which is often avoided by beginners: <a href="http://en.wikipedia.org/wiki/OSI_model">OSI</a> .  Open System Interconnection.  Generally in a nutshell, so that the brain does not litter in one session.  This model is called the reference, because in the real world it did not come to implementation.  But she is perfect, so engineers and administrators screw this word everywhere. <br>  It is based on 7 whales of the network hierarchy: 7 levels.  Today we‚Äôll touch the bottom two: the <b>first - the physical</b> - is the presentation of information in the form of signals, frankly, bits.  The task of this level is to generate an electrical, optical or radio signal, transmit it on Wednesday and receive it.  This includes all physics: interfaces, cables, antennas, media converters (media converters), repeaters, old hubs.  In general, low-level work.  This is the first level of the OSI model and TCP / IP stack. <br>  <b>The second channel</b> .  Switches work at this level.  The device ID here is the <a href="http://ru.wikipedia.org/wiki/MAC-%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B5%25D1%2581">MAC address</a> .  Each node (computer, router, laptop, IP phone, any Wi-Fi client) has this unique address that uniquely identifies the device on the local network.  In theory, MAC addresses should not be repeated at all, but in practice, however, this happens and within one broadcast domain can lead to problems that are difficult to detect. <br>  The most famous protocol of this layer is Ethernet.  Data at this level is transmitted in chunks, each of which is called an Ethernet frame (it is also an Ethernet frame, it is a data link layer <a href="http://en.wikipedia.org/wiki/Protocol_data_unit">PDU</a> ).  What is he like? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/17d/aba/ab8/17dabaab8df0cc8ef7cf904322f15f7a.png"><pre><code class="bash hljs">*    ,     *</code> </pre> <br><br>  <i>Payload</i> is payload - network layer data that is embedded ( <i>encapsulated</i> ) in a frame.  <i>MAC Header (Header)</i> - this service information channel (second) level.  The most important elements for us so far are the source MAC-address (the address of the sender of the frame) and the Destination MAC-address (the address of the receiver of the frame). <br><br>  The third level - network (IP, ARP) <br>  Fourth - transport (TCP, UDP, ICMP) <br>  From the fifth to the seventh, session, view, and application (in the TCP / IP stack they do not differ and are simply called application. Protocols such as HTTP, FTP, telnet, and many others work on it) <br><blockquote>  The <a href="http://en.wikipedia.org/wiki/OSI_model">English Wikipedia</a> states that ICMP refers to level 3, which is a controversial point. <br></blockquote><br><br>  Today we focus on the 1st and 2nd levels, especially on the second.  We will touch the third and fourth in the following releases. <br><br><a name="Ethernet_conception"></a><br>  Now let's trace the hard path of the frame. <br>  The network quiescent state is utopia. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/17e/31e/70f/17e31e70f22d7d5b725dea62008da6b9.jpg"><br><br>  You are trying to ping, for example, the address of a neighboring computer with the <b>ping 192.168.1.118</b> command.  The data of this application is shown in purple box. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a3/dca/b98/4a3dcab98d4c67322ef5b631b5a87533.jpg"><br><br>  <a href="http://ru.wikipedia.org/wiki/ICMP">ICMP</a> is responsible for this.  Information from the application is encapsulated in it - this means that a header with service information of the 4th level is added to the data of the 5th level. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7b/dff/454/f7bdff454e14f2a19e2af08974f33bbf.jpg"><br><br>  Its data is packed (encapsulated) into IP packets, where the header contains the IP address of the recipient (192.168.1.118) and the IP address of the sender ‚Äî logical addresses. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/28e/b99/244/28eb99244ffcb32f091eec8cca6b0933.jpg"><br><br>  And then all this is encapsulated into Ethernet frames with the MAC addresses of the sender and receiver, the physical addresses. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a01/6cc/afd/a016ccafd998fe772fa06d324783047b.jpg"><br><br>  When framing in the header, the source MAC address is the address of your computer, and the destination address (destinantion) will be the MAC address of the computer that owns the IP address 192.168.1.118 (let's talk about the mechanisms of this conversion next time).  That is, if you could photograph a frame, then you would see all this data in a section, so to speak. <br><br>  Actually, there is nothing simpler: you start some kind of traffic analyzer, for example, the wonderful <a href="http://www.wireshark.org/">Wireshark</a> and <a href="http://www.ethereal.com/">Ethereal</a> , on your computer and ping another host.  Here is a picture you can contemplate: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/521/99a/699/52199a6992491f873bba4c55ff6e76c7.png" alt="Dump"><br><br>  You can do this right now by reading these lines, simply by installing and running a traffic analyzer. <br><br>  Lastly, your computer's network card splits the frame into bits and sends them to the cable. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/83d/c2f/514/83dc2f51419b5eeb7ee589290912b9ba.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/5d9/30d/02d/5d930d02d3f066c4ee6426b17ff0cc51.jpg"><br><br>  The switch from the incoming bits collects the initial frame <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c5/984/c6e/8c5984c6ecf47caa9d18c30ef7eb6c4a.jpg"><br><br>  Then the intellectual work begins: the recipient's address is extracted from the header, the MAC address table is shaken for a match, and as soon as it is found, the frame is sent to the specified port without any changes.  If there is no address yet or the broadcast frame has arrived, then it is sent to all ports, except where it came from. <br><br>  If the address of the sender in the table has not yet been, then at this moment the switch will add it. <br>  Naturally, the frame is again transmitted in the form of bits - this is the law of electronics, and you should just always keep this in mind. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d9/30d/02d/5d930d02d3f066c4ee6426b17ff0cc51.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/9fd/e22/ea7/9fde22ea7b8b225d4bf4ca580f1e1f01.jpg"><br><br>  The final host, receiving a stream of bits, collects a frame from them, still assuming that it is intended for it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f20/da7/f25/f20da7f25024998e075cddec43e2ed18.jpg"><br><br>  Next, it compares the recipient's MAC address with its own and, if they match, the second-level header is discarded, and the IP data is transmitted to the higher-level protocol for processing.  If the addresses do not match, then the frame is discarded along with all the contents. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fcf/ef6/7d3/fcfef67d3d72a93558d4e716492f2dec.jpg"><br>  Next, compare the IP address of the recipient and this device.  If they match, the network layer header is discarded, and data is transmitted to the transport layer (ICMP). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe0/b26/f75/fe0b26f757776925aad6ef5cd6bfac28.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/f1c/a8b/6fc/f1ca8b6fc3171f3562faf394f42c504e.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/6cb/579/e19/6cb579e190b46eff609f4983f07e843d.jpg"><br><br>  The final host processed the ICMP request (echo-request) and is ready to send an ICMP reply (echo-reply) to your computer with the address 192.168.1.131 and then steps 1-3 are repeated for the new frame <br><br>  What we have written so far is the principle of operation of any switch.  So do even simple longs for 300 rubles. <br><br><h4>  VLAN </h4><br>  And now, colleagues, give us a final breakthrough: add more VLANs here. <br><br>  Only managed switches are already working with them. <br>  Recall that vlans are needed to separate networks.  Accordingly, a certain identifier appears, which marks the traffic of different subnets on the switch. <br>  Speaking of VLANs, they often use the 802.1q spell.  This is a standard that describes how a frame is labeled / tagged.  You should not be afraid of this cipher.  Also, for example, Wi-Fi is described by the 802.11n standard, and the authentication protocol is 802.1x.  We have to face this in the future, so put it in your non-volatile memory. <br><br>  What exactly happens in the switching kitchen? <br>  Another field is added to the frame after the Source MAC address, very roughly speaking, containing the VLAN number.  The length allocated for the Vlan number is 12 bits, which means that the maximum number of Vlans is 4096. We want to draw the attention of young engineers to such details.  The fact is that in our cycle, due to objective reasons, we cannot tell everything, but such questions, firstly, are often asked at interviews, and secondly, you just need to know. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61d/646/350/61d646350d44d3e8c1a52d9d86ee4d11.png" alt="Ethernet frame with 802.1q field">  <i>The frames of the first vlan are usually not tagged - he is a native vlan.</i> <br><br>  Each switch now makes a decision based on this tag (or its absence). <br>  Another column with the VLAN'a number is added to the MAC address table, and when searching for the MAC address / port pair, the frame tag will now be compared with the VLAN number in the table. <br><br>  There are two types of ports: <br>  1. <i>Access port</i> - access port - end nodes are connected to it, as a rule.  The traffic between this port and the device is untagged.  Each access port is assigned a specific VLAN, sometimes this parameter is called a PVID.  All traffic coming to this port from the end device receives the label of this vlan, and outgoing traffic leaves without a label. <br><br>  2. <i>Trunk port</i> .  This port has two main uses - a line between two switches or from the switch to the router.  Inside such a line, popularly called, which is logical, a trunk, the traffic of several vlans is transmitted.  Of course, here the traffic is already tagged, so that the receiving party can distinguish the frame that goes to the accounting department from the frame intended for the IT department.  A whole range of vlans is attached to the trunk port. <br>  In addition, there is the aforementioned <i>native vlan</i> .  The traffic of this vlan is not tagged even on a trunk, by default it is the 1st vlan and by default it is allowed.  You can override these parameters. <br>  It is needed for compatibility with devices unfamiliar with 802.1q encapsulation.  For example, you need to transfer 3 vlans via a Wi-Fi bridge, and one of them is a management vlan.  If Wi-Fi-modules do not understand the 802.1q standard, then you can manage them only if you configure this vlan as native vlan on both sides. <br><br>  What happens on the network with vlans? <br><br>  1) So, from your computer with an IP address, for example, 192.168.1.131, a packet is sent to another computer on your network.  This packet is encapsulated in a frame, and so far no one knows anything about vlans, so the frame leaves, as it is, to the nearest switch. <br>  2) On the switch, this port is marked as a member, for example, the 2nd VLAN by the command <br><br><pre> <code class="bash hljs">Switch0<span class="hljs-comment"><span class="hljs-comment">#interface fa0/1 Switch0(config)#description ‚ÄúI am using simple frames‚Äù Switch0(config-if)#switchport mode access Switch0(config-if)#switchport access vlan 2</span></span></code> </pre><br><br>  This means that any frame that arrives on this interface is automatically tagged: a ribbon with a VLAN number is hung on it.  In this case with number 2. <br>  Next, the switch searches in its MAC address table among the ports that belong to the 2nd vlan, the port to which the device with the destination MAC address is connected. <br>  3) If the recipient is connected to the same access port, the ribbon is unlinked from the frame, and the frame is sent to this same port as it was originally.  That is, the recipient also does not need to know about the existence of vlans. <br>  4) If the required port is a trunk port, then the ribbon remains on it. <br><br><pre> <code class="bash hljs">Switch(config)<span class="hljs-comment"><span class="hljs-comment">#interface fa0/2 Switch(config-if)#description ‚ÄúI am using tagged frames‚Äù Switch(config-if)#switchport mode trunk</span></span></code> </pre><br><br>  Let's try to draw an analogy with the real world.  You and a friend, for example, tourist packages, and fly to rest savages plane Ethernet Airlines Airlines.  But on the way you quarreled, and therefore, when at the airport of destination, you are asked which hotel to take you to, you answer ‚ÄúHorns‚Äù, and your friend says ‚ÄúHoof‚Äù.  And right after that, you are encapsulated in different car-shots: you are in a taxi with the tag ‚ÄúTaxi Park‚Äú On Horns ‚Äù, and your friend with his cargo in KAMAZ with the tag‚Äú Transport company ‚ÄúIn the hoof‚Äù.  Now you can‚Äôt go to the bus lanes, but to your friend under signs prohibiting the passage of trucks. <br>  So, two hotels are the MAC address of destination, and the route restrictions are the ports of other vlans. <br>  Wandering along the streets, you have nothing to worry about as an IP packet - the frame-car will take you to your destination, and, roughly speaking, depending on the tag, at each intersection you will decide how to go further. <br><br><h4>  FAQ: </h4><br>  <b>Q:</b> What happens if a tagged frame arrives at the access port? <br>  <b>A:</b> He will be dropped. <br><br>  <b>Q:</b> What happens if an untagged frame arrives on the trunk port? <br>  <b>A:</b> It will be placed in the Native VLAN.  By default it is the 1st VLAN.  But you can change it with the command <b>switchport trunk native vlan 2</b> <br>  In this case, all frames marked with the 2nd vlan will go untagged to this port, and untagged frames coming to this interface will be marked with the second vlan. <br>  Frames tagged with other vlans will remain unchanged, passing through such a port. <br><br>  <b>Q:</b> Can end nodes (computers, laptops, tablets, phones) send tagged frames and connect them to trunk ports accordingly? <br>  <b>A:</b> Yes, you can.  If the network card and software support the 802.1q standard, then the node can work with tagged frames. <br><br>  <b>Q:</b> What will happen to tagged frames if they fall on a regular unmanaged switch or other device that does not understand the 802.1q standard? <br>  <b>A:</b> Since when adding a tag, the frame header does not change, all devices of the second level without the support of this standard cope with the switching of such a frame.  Therefore, for example, if you want to organize a channel through a Wi-Fi bridge, this will not prevent you from forwarding several vlans in a trunk through it. <br><br><h3>  Practice.  Network configuration ‚ÄúElevator mi Up‚Äù </h3><br>  Well, finally turn to the setting.  Viva la praktis! <br><br>  We will have such a network: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4a/bda/627/d4abda627ff50d59b7a81d8710230329.png"><br><br>  Recall how we planned it: <br><ul><li>  <a href="http://habrahabr.ru/blogs/sysadm/134892/">VLAN</a> </li><li>  <a href="http://habrahabr.ru/blogs/sysadm/134892/">IP plan</a> </li><li>  <a href="http://habrahabr.ru/blogs/sysadm/134892/">switching plan</a> </li></ul><br>  We advise you to open them on an additional tab, because we will go there periodically. <br><br>  We could now rush to immediately set up everything in order: completely one device, then another.  But it will not be, perhaps, an understanding of the meaning of processes. <br><br><h5>  Access ports (access) </h5><br>  Therefore, let's start with a simple one: configure two ports on msk-arbat-asw3 as access for vlan 101 (PTW): <br><br><pre> <code class="bash hljs">msk-arbat-asw3(config)<span class="hljs-comment"><span class="hljs-comment">#interface FastEthernet0/1 msk-arbat-asw3(config-if)#description PTO msk-arbat-asw3(config-if)#switchport mode access msk-arbat-asw3(config-if)#switchport access vlan 101 % Access VLAN does not exist. Creating vlan 101 msk-arbat-asw3(config)#interface FastEthernet0/2 msk-arbat-asw3(config-if)#description PTO msk-arbat-asw3(config-if)#switchport access vlan 101 msk-arbat-asw3(config-if)switchport mode access</span></span></code> </pre><br><br>  <i>All settings are done immediately in accordance with the plan.</i> <br><br>  Notice that the switch swears at the lack of a vlan?  Here you have to be careful.  Some software versions work somewhat illogical. <br>  Even if you do not create it, the settings will be applied and at debugging at first glance everything will be fine, but there will be no connection.  And the cunning is that the phrase <b>Creating vlan 101</b> does not mean that this same vlan will be created.  Therefore, we go to the global configuration mode and create it (and at the same time all other Vlans needed on this switch): <br><br><pre> <code class="bash hljs">msk-arbat-asw3&gt;<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> msk-arbat-asw3<span class="hljs-comment"><span class="hljs-comment">#configure terminal msk-arbat-asw3(config)#vlan 2 msk-arbat-asw3(config-vlan)#name Management msk-arbat-asw3(config-vlan)#vlan 3 msk-arbat-asw3(config-vlan)#name Servers msk-arbat-asw3(config-vlan)#vlan 101 msk-arbat-asw3(config-vlan)#name PTO msk-arbat-asw3(config-vlan)#vlan 102 msk-arbat-asw3(config-vlan)#name FEO msk-arbat-asw3(config-vlan)#vlan 103 msk-arbat-asw3(config-vlan)#name Accounting msk-arbat-asw3(config-vlan)#vlan 104 msk-arbat-asw3(config-vlan)#name Other</span></span></code> </pre><br><br>  Now connect the computers to ports FE0 / 1 and FE0 / 2, configure the addresses 172.16.3.2 and 172.16.3.3 with the subnet mask 255.255.255.0 and the gateway 172.16.3.1 and check the connection: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26b/8c7/b3f/26b8c7b3fc688250b27e378788ea3b06.png"><br><br>  After this happens, we configure the port FE0 / 16 as access for the 104th vlan (network of other users): <br><br><pre> <code class="bash hljs">msk-arbat-asw3(config)<span class="hljs-comment"><span class="hljs-comment">#interface FastEthernet0/16 msk-arbat-asw3(config-if)#description Other msk-arbat-asw3(config-if)#switchport access vlan 104 msk-arbat-asw3(config-if)switchport mode access</span></span></code> </pre><br><br>  Connect a computer to it and configure the address from the same subnet as the VET, for example, 172.16.3.5 with the mask 255.255.255.0. <br>  If you now try to ping this address, then you should not get it - the computers are in different vlans and are isolated from each other: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7c/df4/429/b7cdf4429151de3b3b1bd176a1dfd395.png"><br><br>  That is, again what is happening?  From your computer comes to the 1st port a broadcast request: ‚ÄúWho is 172.16.3.5‚Äù, because the computer itself does not yet know the recipient's MAC address.  The frame that carries this request is marked as belonging to the 101st VLAN in accordance with the port on which it arrived.  And further, to find out where the computer is located 172.16.3.5, the frame is sent to all member ports of the 101st VLAN.  And among them there is no FE0 / 16 port, therefore, naturally, this address is considered unreachable, which leads to the ‚ÄúRequest timed out‚Äù response. <br><br>  <i><b>Attention!</b></i>  <i>If a device with that IP is still in this VLAN, then it will not be the same Other laptop and at the same time they will not conflict with each other, since they are logically in different broadcast domains.</i> <br><br><h5>  Trunk ports (trunk) </h5><br>  So, the gates have opened for you, now you have to create a corridor - a trunk between three switches: msk-arbat-asw3, msk-arbat-dsw1 and msk-rubl-asw1. <br><br>  The uplink port on msk-arbat-asw3 is GE1 / 1.  Well, since we still need to forward all the vlans, we will do it now, that is, in addition to 101 and 104, we will write 2, 102 and 103: <br><br><pre> <code class="bash hljs">msk-arbat-asw3(config)<span class="hljs-comment"><span class="hljs-comment">#interface GigabitEthernet1/1 msk-arbat-asw3(config-if)#description msk-arbat-dsw1 msk-arbat-asw3(config-if)#switchport trunk allowed vlan 2,101-104 msk-arbat-asw3(config-if)#switchport mode trunk</span></span></code> </pre><br><br>  In fact, on the interface, the <b>#switchport mode trunk</b> command is enough to have tagged frames of all vlans go through this port, because by default the trunk port lets everything through.  But we are engineers, not enikeyschiki.  Where have you seen that unlimited running behind our back?  Therefore, only what we allow passes through us.  As soon as you give the <b>switchport trunk allowed vlan 101</b> command, no vlan will pass through the port, except for 101 (VLAN 1 runs by default and untagged). <br><br>  <i><b>Attention!</b></i>  <i>If you want to add another vlan to the trunk port, then you need to use the following command syntax:</i> <i><br><br></i> <pre> <i><code class="bash hljs">msk-arbat-dsw1(config-if)<span class="hljs-comment"><span class="hljs-comment">#switchport trunk allowed vlan add 105</span></span></code></i> </pre> <i><br><br></i>  <i>Otherwise (by writing <b>switchport trunk allowed vlan 105</b> ) you will erase all the old permissions and add the new 105th vlan.</i>  <i>And it‚Äôs good if you don‚Äôt lose access to this switch.</i>  <i>But for a simple connection, you still get the fifth number)</i> <i><br></i> <br><br>  Go to msk-arbat-dsw1.  On it it is necessary to create all the ports and configure two ports: <br>  GE1 / 2 towards msk-arbat-asw3 <br>  FE0 / 1 towards msk-rubl-asw1: <br><br><pre> <code class="bash hljs">msk-arbat-dsw1(config)<span class="hljs-comment"><span class="hljs-comment">#interface GigabitEthernet1/2 msk-arbat-dsw1(config-if)#description msk-arbat-asw3 msk-arbat-dsw1(config-if)#switchport trunk allowed vlan 2,101-104 msk-arbat-dsw1(config-if)#switchport mode trunk msk-arbat-dsw1(config)#interface FastEthernet0/1 msk-arbat-dsw1(config-if)#description msk-rubl-asw1 msk-arbat-dsw1(config-if)#switchport trunk allowed vlan 2,101,104 msk-arbat-dsw1(config-if)#switchport mode trunk</span></span></code> </pre><br><br>  Well, let's configure, of course, the ports on msk-rubl-asw1: <br><br><pre> <code class="bash hljs">msk-rubl-asw1(config)interface FastEthernet0/24 msk-rubl-asw1(config-if)switchport trunk allowed vlan 2,101,104 msk-rubl-asw1(config-if)switchport mode trunk msk-rubl-asw1(config)<span class="hljs-comment"><span class="hljs-comment">#int FastEthernet0/1 msk-rubl-asw1(config-if)#description PTO msk-rubl-asw1(config-if)#switchport mode access msk-rubl-asw1(config-if)#switchport access vlan 101 % Access VLAN does not exist. Creating vlan 101</span></span></code> </pre><br><br>  Again, you need to configure Vlana.  And note that there are no messages when configuring trunk ports. <br><br>  If you have configured everything correctly (which is not in doubt), then from the first port, msk-rubl-asw1, you will see the PTO computers connected to msk-arbat-asw3. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c59/b7e/e82/c59b7ee82bde7be2f2d4f8112b5ce4af.png"><br><br>  For confidence, we will also check the 104th vlan.  Through the trunk, we have already delivered it here. <br><br><pre> <code class="bash hljs">msk-rubl-asw1(config)<span class="hljs-comment"><span class="hljs-comment">#interface FastEthernet 0/16 msk-rubl-asw1(config-if)#switchport mode access msk-rubl-asw1(config-if)#switchport access vlan 104</span></span></code> </pre><br><br>  We connect the computer to the 16th port and configure the IP address 172.16.6.3 with the mask 255.255.255.0 and the gateway 172.16.6.1 on it.  And change the IP address of the laptop on the Arbat to 172.16.6.2 with the same mask and gateway. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5da/f85/d83/5daf85d830574693dc7aef82a42956d9.png"><h6>  Control network </h6><br>  Configure the IP address to manage. <br>  In our labs they will not be needed, because we configure the device through the RT window.  But in real life it is vital for you. <br>  To do this, we create a virtual interface and specify the number of the vlan of interest to us.  And further we work with it, as with the most usual physical interface. <br><br>  <b>msk-arbat-dsw1:</b> <br><br><pre> <code class="bash hljs">msk-arbat-dsw1(config)<span class="hljs-comment"><span class="hljs-comment">#interface vlan 2 msk-arbat-dsw1(config-if)#description Management msk-arbat-dsw1(config-if)#ip address 172.16.1.2 255.255.255.0</span></span></code> </pre><br><br>  <b>msk-arbat-asw3:</b> <br><br><pre> <code class="bash hljs">msk-arbat-asw3(config)<span class="hljs-comment"><span class="hljs-comment">#interface vlan 2 msk-arbat-asw3(config-if)#description Management msk-arbat-asw3(config-if)#ip address 172.16.1.5 255.255.255.0</span></span></code> </pre><br><br>  With msk-arbat-asw3, we launch ping to msk-arbat-dsw1: <br><br><pre> <code class="bash hljs">msk-arbat-asw3<span class="hljs-comment"><span class="hljs-comment">#ping 172.16.1.2 Type escape sequence to abort. Sending 5, 100-byte ICMP Echos to 172.16.1.2, timeout is 2 seconds: ..!!! Success rate is 60 percent (3/5), round-trip min/avg/max = 4/4/4 ms</span></span></code> </pre><br><br>  The first couple of packets can be lost to the work of the <a href="http://xgu.ru/wiki/ARP">ARP</a> protocol: determining the correspondence IP address - MAC address.  At the same time, the MAC address, port and Vlan number are added to the switch table. <br>  Independently configure the management network IP addresses on the other switches and check their availability <br><br>  Actually, that's all the magic.  Often the whole setup is reduced to this kind of action, if you are not working in a provider.  On the other hand, if you work in an ISP, you probably don‚Äôt need to explain such things. <br>  If you want to know more about this, read: <a href="http://xgu.ru/wiki/VTP">VTP</a> , <a href="http://www.hilik.org.ua/q-in-q-%25D0%25BD%25D0%25B0%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B9%25D0%25BA%25D0%25B0-%25D0%25B2-cisco-catalyst-3750/">QinQ</a> , <a href="http://etherealmind.com/cisco-ios-vlan-1002-reserved-1005-purpose-function/">reserved VLAN numbers</a> <br><br>  Another small tool that can slightly increase the usability: banner.  This is the announcement that the tsiska will show before authorization to the device. <br><br><pre> <code class="bash hljs">Switch(config)<span class="hljs-comment"><span class="hljs-comment">#banner motd q Enter TEXT message. End with the character 'q'. It is just banner. q Switch(config)#</span></span></code> </pre><br>  After motd, you specify the character that will signal that the line is finished.  In this example, we put ‚Äúq‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3d/76b/746/c3d76b7468956a93b510ce21cb8405a1.png"><blockquote>  Regarding the content of the banner.  There is such a legend: the hacker broke into the network, broke something \ stole it, was caught, and was acquitted and released at the court.  Why?  But because on the border router (between the Internet and the internal network), the word ‚ÄúWelcome‚Äù was written in the banner.  ‚ÄúWell, if they ask, I went in‚Äù)).  Therefore, it is considered good practice to write something like ‚ÄúAccess denied!‚Äù In the banner. </blockquote><br><br>  To organize knowledge of the items will analyze what you need to do: <br><br>  1) Configure the hostname.  This will help you in the future on a real network to quickly navigate where you are. <br><pre> <code class="bash hljs">Switch(config)<span class="hljs-comment"><span class="hljs-comment">#hostname HOSTNAME</span></span></code> </pre><br><br>  2) Create all vlana and give them a name <br><pre> <code class="bash hljs">Switch(config)<span class="hljs-comment"><span class="hljs-comment">#vlan VLAN-NUMBER Switch(config-vlan)#name NAME-OF-VLAN</span></span></code> </pre><br><br>  3) Configure all access ports and give them a name <br><pre> <code class="bash hljs">Switch(config-if)<span class="hljs-comment"><span class="hljs-comment">#description DESCRIPTION-OF-INTERFACE Switch(config-if)#switchport mode access Switch(config-if)#switchport access vlan VLAN-NUMBER</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is sometimes convenient to configure interfaces in batches: </font></font><br><br><pre> <code class="bash hljs">msk-arbat-asw3(config)<span class="hljs-comment"><span class="hljs-comment">#interface range fastEthernet 0/6 ‚Äî 10 msk-arbat-asw3(config-if-range)#description FEO msk-arbat-asw3(config-if-range)#switchport mode access msk-arbat-asw3(config-if-range)#switchport access vlan 102</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4) Configure all trunk ports and give them a name: </font></font><br><pre> <code class="bash hljs">Switch(config-if)<span class="hljs-comment"><span class="hljs-comment">#description DESCRIPTION-OF-INTERFACE Switch(config-if)#switchport mode trunk Switch(config-if)#switchport trunk allowed vlan VLAN-NUMBERS</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do not forget to persist:</font></font></b> <br><pre> <code class="bash hljs">Switch<span class="hljs-comment"><span class="hljs-comment">#copy running-config startup-config</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total: what have we achieved? </font><font style="vertical-align: inherit;">All devices on the same subnet see each other, but do not see devices from the other. </font><font style="vertical-align: inherit;">In the next issue we are dealing with this issue, and also turn to static routing and L3 switches. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, this lesson can be completed. </font><font style="vertical-align: inherit;">In the video you can once again see how the vlans are configured. </font><font style="vertical-align: inherit;">As a homework set up vlany on switches for servers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here you can download the configuration of all devices: </font></font><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lift-me-Up_Configuration.zip</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And our project RT: </font></font><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lift-me-UP_v2-VLANs.pkt</font></font></a> <br><br>  <b>PS</b> <br> <i> :   ,   native vlan    .   cisco    . <br> ,       msk-rubl-asw1   101-       . <br>   , ,     ,    cisco           ,      STP         .  101-       ,     , 101-      msk-rubl-asw1.</i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Once again we want to note that with all our desire we will not be able to cover all the nuances and subtleties, therefore we do not set ourselves such a task. </font><font style="vertical-align: inherit;">Things like the principle of constructing a MAC address, the values ‚Äã‚Äãof the Ether Type field, or why you need a CRC at the end of the frame, you have to study yourself. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanks to the co-author of this cycle, hagravchaninin </font></font><a href="https://habrahabr.ru/users/thegluck/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thegluck</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the provision of additional materials I want to thank </font></font><a href="http://xgu.ru/wiki/%25D0%259A%25D0%25B0%25D1%2582%25D0%25B5%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F:%25D0%2590%25D0%25B2%25D1%2582%25D0%25BE%25D1%2580_%25D0%259D%25D0%25B0%25D1%2582%25D0%25B0%25D1%2588%25D0%25B0_%25D0%25A1%25D0%25B0%25D0%25BC%25D0%25BE%25D0%25B9%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BA%25D0%25BE"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Natasha Samoylenko</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Readers who do not have a register for Habr√©, but having questions, as before, can concentrate them in </font></font><a href="http://eucariot.livejournal.com/60869.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LiveJournal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div><p>Source: <a href="https://habr.com/ru/post/138043/">https://habr.com/ru/post/138043/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138033/index.html">Experts from Zvelo Labs found a vulnerability in Google Wallet</a></li>
<li><a href="../138035/index.html">Google creates its own home media system</a></li>
<li><a href="../138037/index.html">A closer look at mobile interface templates</a></li>
<li><a href="../138039/index.html">Reddwarf on the example of the online game "Stone-Scissors-Paper": Client</a></li>
<li><a href="../138042/index.html">Project ‚ÄúSolve for X‚Äù: a new way to increase the range of radio communications is presented</a></li>
<li><a href="../138044/index.html">Modernization of industrial infrared station, or how to do it initially. Part 1</a></li>
<li><a href="../138045/index.html">Pure CSS tabs from IE6 + (reincarnation of one solution)</a></li>
<li><a href="../138047/index.html">Chrome (dev) implements future JavaScript features</a></li>
<li><a href="../138048/index.html">LeechCraft 0.5 released</a></li>
<li><a href="../138049/index.html">Multilateral exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>