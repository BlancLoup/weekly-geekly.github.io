<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to test non-public methods in .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you like to cover code with tests? Do you like the pleasant warm feeling of security that comes with passing tests? 

 Well done! 

 Real professio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to test non-public methods in .NET</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/670/e47/5f1/670e475f1be9466cdfd105c6434f2551.jpg" alt="image" align="left">  Do you like to cover code with tests?  Do you like the pleasant warm feeling of security that comes with passing tests? <br><br>  Well done! <br><br>  Real professionals do not rely on chance, they <s>lay straws in advance and</s> keep everything under control. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Want to inside, for the public interface, too, everything was covered in tests? <br><br><a name="habracut"></a><br><br>  As always, there are several ways.  There are better, there are easier.  Go! <br><br><h5>  1. Making the method public </h5><br><br>  No private method - no problem.  You can even write a comment to the method <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// For tests only. Do not use directly.</span></span></code> </pre> <br><br>  <b>Pros:</b> very simple. <br>  <b>Minuses: the</b> interface is littered, encapsulation suffers. <br><br><h5>  2. Making the method internal </h5><br><br>  That is, we change the access modifier from <code>private</code> to <code>internal</code> .  The comment from the first method will also fit here.  It turns out a method that is available from anywhere within the assembly. <br><br>  And test it as?  Simply.  You need to add the <a href="http://msdn.microsoft.com/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx">InternalsVisibleTo</a> attribute to the assembly.  This attribute will give the test assembly access to all internal methods and properties of the assembly under test. <br><br>  Do not forget that the functioning of the <code>InternalsVisibleTo</code> attribute requires that both assemblies (testing and tested) be <a href="http://msdn.microsoft.com/library/xc31ft41(v%3Dvs.110).aspx">signed with a strong name</a> at the same time, or not signed at the same time. <br><br>  <b>Pros:</b> simply enough, there remains control over who has access to the interiors of the assembly. <br>  <b>Minuses: the</b> interface is still clogged, encapsulation still suffers, additional conditions appear (see above about signing), the attribute remains in the release build. <br><br><h5>  3. Making the method protected </h5><br><br>  Instead of the <code>private</code> modifier, the method should acquire the <code>protected</code> modifier.  In the test build, you will need to make an inheritor from the class under test and - voila!  - access to the method obtained. <br><br>  <b>Pros:</b> simple enough, there is some control over who has access to the method. <br>  <b>Minuses: the</b> interface is still clogged, encapsulation still suffers, the method is available to anyone who wishes to inherit it, a class with this method cannot be marked closed for inheritance (sealed). <br><br><h5>  4. Use PrivateObject </h5><br><br>  This class provides the <a href="http://msdn.microsoft.com/en-us/library/hh694602.aspx">Visual Studio Unit Testing Framework</a> , so if a project uses NUnit or something else, then this method will not work. <br><br>  With <code>PrivateObject</code> everything is simple.  There is a class for testing: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ClassToTest</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> field; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrintField</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Console.WriteLine(field); } }</code> </pre><br><br>  There is a testing class: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">TestClass</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestClass</span></span> { [TestMethod] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestPrivateMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ClassToTest testedClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassToTest(); PrivateObject privateObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PrivateObject(testedClass); privateObject.SetField(<span class="hljs-string"><span class="hljs-string">"field"</span></span>, <span class="hljs-string"><span class="hljs-string">"Don't panic"</span></span>); privateObject.Invoke(<span class="hljs-string"><span class="hljs-string">"PrintField"</span></span>); } }</code> </pre><br><br>  After executing the test in the console, the string will <code>Don't panic</code> .  Always good advice, right? <br><br>  <b>Pros: you</b> do not need to change the existing code, quite simply. <br>  <b>Disadvantages:</b> applicable only to the Visual Studio Unit Testing Framework, when renaming fields and methods, the tests will start to fall. <br><br><h5>  5. Reflection will help us </h5><br><br>  The code will be longer than in the previous method, but you can live. <br><br>  Again, there is a class for testing: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ClassToTest</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> field; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PrintField</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Console.WriteLine(field); } }</code> </pre><br><br>  In the test you need to write the following: <br><br><pre> <code class="cs hljs">ClassToTest obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassToTest(); Type t = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ClassToTest); FieldInfo f = t.GetField(<span class="hljs-string"><span class="hljs-string">"field"</span></span>, BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.Public); f.SetValue(obj, <span class="hljs-string"><span class="hljs-string">"Don't panic"</span></span>); t.InvokeMember(<span class="hljs-string"><span class="hljs-string">"PrintField"</span></span>, BindingFlags.InvokeMethod | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, obj, <span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre><br><br>  Good advice should appear in the console again. <br><br>  The above code can be used in any tests.  Though for NUnit, at least for the Visual Studio Unit Testing Framework, at least for any other testing environment. <br><br>  <b>Pros:</b> there is no need to change the existing code, quite simply, applicable to any testing environment. <br>  <b>Minuses:</b> without the auxiliary class in the tests there will be kilometers of the repeating code, when renaming the fields and methods, the tests will start to fall. <br><br><h5>  Instead of conclusion </h5><br><br>  Now that you know how to test non-public methods, it's time to think: should we test them? <br><br>  Arguments for": <br><ul><li>  Non-public methods may contain complex logic that is worth checking. </li><li>  Sometimes using private methods in tests can reduce the amount of code needed to create test data. </li><li>  In general, you need to test everything.  The more lines of code covered in tests, the better. </li></ul><br><br>  Arguments against": <br><ul><li>  You need to test the behavior, not the implementation.  So, you only need to test the class interface (only public methods and properties). </li><li>  Tests for private methods interfere with refactoring code, and refactoring code is no less important than testing. </li><li>  If the method is private, then it is not just that.  This means that you don‚Äôt need to touch it. </li></ul><br><br>  Personally, I play for the team "against."  I think that you only need to test public methods and properties. </div><p>Source: <a href="https://habr.com/ru/post/224733/">https://habr.com/ru/post/224733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224717/index.html">The earlier the departure - the less delay</a></li>
<li><a href="../224719/index.html">How to improve user activity segmentation. Yandex Workshop</a></li>
<li><a href="../224723/index.html">Million dollars for inflation theory</a></li>
<li><a href="../224727/index.html">How programmers look for differences</a></li>
<li><a href="../224731/index.html">We expand the service of building routes OSRM</a></li>
<li><a href="../224737/index.html">Training with super-human speed</a></li>
<li><a href="../224739/index.html">Creating an electronic component model for Proteus on Lua</a></li>
<li><a href="../224743/index.html">Deep disappointment or the First Hakaton of the Moscow Government</a></li>
<li><a href="../224747/index.html">Samsung launches the industry's first 3D V-NAND flash memory with 32 layers of memory cells.</a></li>
<li><a href="../224749/index.html">Ideas and opportunities for the development of electronics in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>