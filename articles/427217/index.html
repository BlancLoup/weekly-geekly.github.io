<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Performance Analysis of WSGI Servers: Part Two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a translation of Kevin Goldberg‚Äôs ‚ÄúA Performance Analysis of Python WSGI Servers: Part 2‚Äù dzone.com/articles/a-performance-analysis-of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Performance Analysis of WSGI Servers: Part Two</h1><div class="post__text post__text-html js-mediator-article">  <i>This article is a translation of Kevin Goldberg‚Äôs ‚ÄúA Performance Analysis of Python WSGI Servers: Part 2‚Äù <a href="https://dzone.com/articles/a-performance-analysis-of-python-wsgi-servers-part">dzone.com/articles/a-performance-analysis-of-python-wsgi-servers-part</a> with minor additions from the translator.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eee/5ee/9d4/eee5ee9d43f8a092b0c299c5e12bd661.jpg" alt="image"><br><br><h2>  Introduction </h2><br>  In the <a href="https://habr.com/post/426957/">first part of</a> this series, you met <b>WSGI</b> and the six most popular servers in the opinion of the author of <b>WSGI</b> .  In this section, you will be shown the result of analyzing the performance of these servers.  For this purpose, a special test sandbox was created. <br><a name="habracut"></a><br><h2>  Contestants </h2><br>  Due to lack of time, the study was limited to six WSGI servers.  All code with start-up instructions for this project is <a href="https://github.com/omedhabib/WSGI_Benchmarks">posted on GitHub</a> .  Perhaps over time, the project will expand and performance analyzes will be presented for other WSGI servers.  But while we are talking about six servers: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <b>Bjoern</b> describes itself as a ‚Äúsuper fast WSGI server‚Äù and boasts that it is ‚Äúthe fastest, smallest and easiest WSGI server‚Äù.  We have created a <a href="https://gist.github.com/omedhabib/c3c8ff74ec3993740e80d7235251e73a">small application</a> that uses most of the library's default settings. </li><li>  <b>CherryPy</b> is an extremely popular and stable framework and WSGI server.  This <a href="https://gist.github.com/omedhabib/1c6bd85bd83cc065c41f8a428865963f">small script was</a> used to serve our sample application via <b>CherryPy</b> . </li><li>  <b>Gunicorn</b> was inspired by Ruby's <b>Unicorn</b> server (hence the name).  He modestly asserts that he is "just implemented, easy to use and quite fast."  Unlike <b>Bjoern</b> and <b>CherryPy</b> , <b>Gunicorn</b> is a standalone server.  We created it using <a href="https://gist.github.com/omedhabib/8de8a5a7739726a0ab142a0f85295135">this command</a> .  The WORKER_COUNT parameter was set to twice the number of available processor cores, plus one.  This was done based on recommendations from the <a href="http://docs.gunicorn.org/en/stable/settings.html">Gunicorn documentation</a> . </li><li>  <b>Meinheld</b> is a high-performance WSGI-compatible web server that claims to be lightweight.  Based on the example specified on the server site, we created <a href="https://gist.github.com/omedhabib/d638e213af0f843580e5ca7724005ac6">our application</a> . </li><li>  <b>mod_wsgi is</b> created by the same creator as <b>mod_python</b> .  Like <b>mod_python</b> , it is available only for Apache.  However, it includes a tool called <b>mod_wsgi express</b> , which creates the smallest possible Apache instance.  We configured and used <b>mod_wsgi express</b> with <a href="https://gist.github.com/omedhabib/8f0e6f7d0103780d3f6f0f73108a86b2">this command</a> .  To comply with <b>Gunicorn</b> , we configured <b>mod_wsgi</b> so that we can create workers twice as large as the processor cores. </li><li>  <b>uWSGI</b> is a full-featured application server.  As a rule, <b>uWSGI</b> interfaces with a proxy server (for example: Nginx).  However, in order to better evaluate the performance of each server, we tried to use only bare servers and <a href="https://gist.github.com/omedhabib/0e61685d14cd019622c02817034f26e3">created two workers</a> for each available processor core. </li></ol><br><h2>  Benchmark </h2><br>  To make the test as objective as possible, a <a href="https://habr.com/post/309556/">Docker</a> container was created to isolate the server being tested from the rest of the system.  Also, the use of the Docker container ensured that each launch starts from a clean slate. <br><br><h3>  Server: </h3><br><ul><li>  Isolated in a Docker container. </li><li>  2 processor cores are allocated. </li><li>  Container RAM was limited to 512 MB. </li></ul><br><h3>  Testing: </h3><br><ul><li>  <a href="https://github.com/wg/wrk">wrk</a> , a modern HTTP benchmarking tool, ran tests. </li><li>  Servers were tested in random order with an increase in the number of simultaneous connections in the range from 100 to 10,000. </li><li>  <b>wrk</b> was limited to two CPU cores not used by Docker. </li><li>  Each test lasted 30 seconds and was repeated 4 times. </li></ul><br><h3>  Metrics: </h3><br><ul><li>  The average number of persistent requests, errors, and delays was provided by <b>wrk</b> . </li><li>  Docker‚Äôs built-in monitoring showed levels of CPU and RAM usage. </li><li>  The highest and lowest readings were discarded, and the remaining values ‚Äã‚Äãwere averaged. </li><li>  For the curious, we sent the full script to <a href="">GitHub</a> . </li></ul><br><h2>  results </h2><br>  All initial performance indicators <a href="https://github.com/omedhabib/WSGI_Benchmarks/tree/master/round1">were included in the project repository</a> , and a consolidated <a href="">CSV file was</a> also provided.  Also for visualization were created graphics in the environment of <a href="https://docs.google.com/spreadsheets/d/1HVNNOIbZZOmFs9BHM9PmB9Ngf3hpPqMeiBYjJTWs3xY/pubhtml">Google-doc</a> . <br><br><h3>  RPS dependence on the number of simultaneous connections </h3><br>  This graph shows the average number of simultaneous requests;  The higher the number, the better. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e09/5b5/cc4/e095b5cc4e7e7455183ddd0a50d64250.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a5/666/b22/6a5666b22ae59edff617647a06bfa7b4.png" alt="image"><br><br><ul><li>  Bjoern: The clear winner. </li><li>  CherryPy: Despite being written in pure Python, he was the best performer. </li><li>  Meinheld: Excellent performance, given the scarce container resources. </li><li>  mod_wsgi: Not the fastest, but the performance was consistent and adequate. </li><li>  Gunicorn: Good performance at lower loads, but there is a struggle with a large number of connections. </li><li>  uWSGI: Disappointed with poor results. </li></ul><br>  <b>WINNER: Bjoern</b> <br><br><h4>  Bjoern </h4><br>  By the number of persistent requests, <b>Bjoern</b> is an obvious winner.  However, given that the numbers are much higher than those of competitors, we are a bit skeptical.  We are not sure that <b>Bjoern is</b> really so stunningly fast.  At first we tested the servers alphabetically, and we thought that <b>Bjoern</b> had an unfair advantage.  However, even after starting the servers in random order of the server and re-testing the result remained the same. <br><br><h4>  uWSGI </h4><br>  We were disappointed with the weak <b>uWSGI</b> results.  We expected him to be in the lead.  During testing, we noticed that the <b>uWSGI</b> logs were typing on the screen, and we initially explained the lack of performance by the extra work that the server was doing.  However, even after the ‚Äú <b>--disable-logging</b> ‚Äù option is added, <b>uWSGI</b> is still the slowest server. <br><br>  As mentioned in the <b>uWSGI</b> manual, it usually interfaces with a proxy server, such as Nginx.  However, we are not sure that this can explain such a big difference. <br><br><h3>  Delay </h3><br>  The delay is the amount of time elapsed between the request and its response.  Lower numbers are better. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e03/5c2/6b0/e035c26b0593b256add7d8ce564913ae.png" alt="image"><br><br><ul><li>  CherryPy: Well coped with the load. </li><li>  Bjoern: In general, low latency, but works better with fewer simultaneous connections. </li><li>  Gunicorn: good and consistent. </li><li>  mod_wsgi: Average performance, even with a large number of simultaneous connections. </li><li>  Meinheld: Overall, acceptable performance. </li><li>  uWSGI: uWSGI again in last place. </li></ul><br>  <b>WINNER: CherryPy</b> <br><br><h3>  RAM usage </h3><br>  This metric shows the memory requirements and the ‚Äúlightness‚Äù of each server.  Lower numbers are better. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a38/138/59b/a3813859b6d73db89c186759941add94.png" alt="image"><br><br><ul><li>  Bjoern: Extremely light.  Uses only 9 MB of RAM to handle 10,000 simultaneous requests. </li><li>  Meinheld: Same as <b>Bjoern</b> . </li><li>  Gunicorn: Skillfully copes with high loads with barely noticeable memory consumption. </li><li>  CherryPy: Initially, I needed a small amount of RAM, but its use rapidly increased with increasing load. </li><li>  mod_wsgi: At lower levels, it was one of the most intense in memory, but remained fairly consistent. </li><li>  uWSGI: Obviously, the version of the problem we are testing is with the amount of memory consumed. </li></ul><br>  <b>WINNERS: Bjoern and Meinheld</b> <br><br><h3>  Number of mistakes </h3><br>  An error occurs when the server crashes, interrupts, or expires.  The lower the better. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/282/e05/371/282e0537118fd5d98f4284ed084bd427.png" alt="image"><br><br>  For each server, we calculated the ratio of the total ratio of requests to errors: <br><br><ul><li>  CherryPy: error rate around 0, even with a high number of connections. </li><li>  Bjoern: Errors were encountered, but this was offset by the number of requests processed. </li><li>  mod_wsgi: Works well with an acceptable error rate of 6%. </li><li>  Gunicorn: Works with a 9 percent error rate. </li><li>  uWSGI: Given the low number of requests that he served, he ended up with a 34 percent error rate. </li><li>  Meinheld: Fell at higher loads, throwing out over 10,000 errors during the most demanding test. </li></ul><br>  <b>WINNER: CherryPy</b> <br><br><h3>  CPU use </h3><br>  High CPU utilization is not good or bad if the server is working well.  However, this gives some interesting information about the server.  Since two CPU cores were used, the maximum possible use is 200 percent. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73c/cf7/87f/73ccf787f03745d453ceaa5f4310a921.png" alt="image"><br><br><ul><li>  Bjoern: single-threaded server, as evidenced by its consistent use on a 100% CPU. </li><li>  CherryPy: multi-threaded, but stuck at 150 percent.  This may be due to <a href="https://habr.com/post/84629/">GIL Python</a> . </li><li>  Gunicorn: uses multiple processes with full utilization of CPU resources at lower levels. </li><li> Meinheld: single-threaded server using CPU resources like Bjoern. </li><li>  mod_wsgi: Multithreaded server using all CPU cores for all measurements </li><li>  uWSGI: very low CPU utilization.  Consumption of resources of the CPU does not exceed 50 percent.  This is one of the proofs that uWSGI is not configured correctly. </li></ul><br>  <b>WINNER: No, because this is more likely an observation of behavior than a comparison of performance.</b> <br><br><h2>  Conclusion </h2><br>  Summarize!  Here are some general ideas that can be gleaned from the results of each server: <br><br><ul><li>  Bjoern: It justifies itself as a ‚Äúsuper-fast, ultra-lightweight WSGI server.‚Äù </li><li>  CherryPy: High performance, low memory consumption and a small number of errors.  Not bad for pure python. </li><li>  Gunicorn: Good server for average loads. </li><li>  Meinheld: Works well and requires minimal resources.  However, struggling with higher loads. </li><li>  mod_wsgi: Integrates into Apache and works great. </li><li>  uWSGI: Very disappointed.  Either we have incorrectly configured <b>uWSGI</b> , or the version we installed has basic errors. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/427217/">https://habr.com/ru/post/427217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427205/index.html">Habrakvest in honor of the 20th anniversary of the Mail.Ru Group: winners and answers</a></li>
<li><a href="../427207/index.html">Rockstar employees defended the company after criticizing 100-hour work weeks.</a></li>
<li><a href="../427209/index.html">GeoPuzzle - collect the world in pieces</a></li>
<li><a href="../427211/index.html">Electron is a flash for desktop</a></li>
<li><a href="../427215/index.html">You need to grow up to microservices, and not start with them</a></li>
<li><a href="../427219/index.html">Useless deferred non-blocking messaging in MPI: light analytics and tutorial for those who are a little "in the subject"</a></li>
<li><a href="../427221/index.html">What I realized on the way to my dream of artificial intelligence</a></li>
<li><a href="../427223/index.html">What are the responsibilities of the lead developer</a></li>
<li><a href="../427225/index.html">Oracle Database 18c XE Released</a></li>
<li><a href="../427227/index.html">How we made a board game with a remote control - Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>