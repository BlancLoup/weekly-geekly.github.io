<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fight for a smooth display in the video surveillance system: find jerks and neutralize</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is natural that with the development of a product, attention to its quality also increases. And not only in terms of functioning, but also in relat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fight for a smooth display in the video surveillance system: find jerks and neutralize</h1><div class="post__text post__text-html js-mediator-article">  It is natural that with the development of a product, attention to its quality also increases.  And not only in terms of functioning, but also in relation to user aesthetics. <br><br>  A few years and versions ago, we were faced with a poor quality video display in Macroscop.  There were "jerks", because of which suffered the smoothness of the display, which ultimately worsened the overall visual perception. <br><br>  When the user sees that the image is not ‚Äútwitching‚Äù on the screen, he doesn‚Äôt care much what causes this.  The reasons for this may be many, since the video system consists of many components, and software is just one of them.  But we had to do everything so that Macroscop, for its part, displays as smoothly as possible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And for this, developers needed to clearly understand the task with measurable requirements, and for the quality group, to have an assessment tool.  In this article, we will describe which metric we use to measure smoothness and with the help of which tool we evaluate it. <br><br>  #spoiler <br><img src="https://habrastorage.org/webt/nt/q1/im/ntq1imgdh1bdwwkoaj7xmjq_di4.jpeg"><br><a name="habracut"></a><br>  So, how to determine whether the video is smoothly displayed or not smoothly? <br><br>  What immediately comes to mind?  - compare what we see in the client application with the ‚Äúnative‚Äù display of the ip-camera. <br><br>  And the <b>first decision</b> is an assessment by a group of experts: we select several people, show them the video and ask to rate it for jerks. <br><br>  This is a head-on decision.  To a certain extent, effective, but very time consuming and too subjective for practical use.  Gathering experts every time a quality group receives a regular prototype from developers is completely inappropriate. <br><br>  Instead of a subjective assessment of ‚Äúlike-dislike‚Äù, it was necessary to find a criterion of smoothness or the expected behavior of the product, which can be fixed. <br><br>  This criterion was formulated as follows: <i>for a smooth display, it is enough that each frame is displayed on the monitor screen.</i> <br><br>  In accordance with it, a <b>second solution</b> appeared.  A new method of measuring ‚Äúnon-floating‚Äù consisted of the following: creating and displaying a video clip with a sequence of numbers (each digit in the part of the frame reserved for it) or a stopwatch, shooting the displayed video on the IP camera, running it through the Macroscop, displaying it again and again shooting using another camera (smartphone camera, go pro, etc.). <br><br>  <i>Expectation.</i>  The resulting video is parsed frame by frame: we count the number of delayed or missing frames (numbers) and see how many jerks there were.  The way is laborious (try to frame video with a standard 25 fps frequency for an IP camera frame by frame! It‚Äôs almost 1500 frames per minute), but it would seem to be objective. <br><br>  <i>Reality.</i>  In practice, everything turned out not quite.  A standard ip camera delivers a stream with a frequency of ~ 25fps, a monitor of ~ 60fps, a smartphone camera ~ 30fps.  It turned out that, besides the frame rates are not multiple, the cameras and monitors do not work synchronously.  Therefore, sometimes at the time of reading the video of any of the cameras on the monitor there was a frame change.  As a result, it was ‚Äúsmeared‚Äù and the figure on the image was impossible to disassemble. <br>  Thus, the second method also did not fit. <br><br>  There were other options for capturing or collecting statistics by the client application itself, which displays the video stream, but we also discarded them.  I wanted to evaluate only the external component - exactly what the user sees, for which the whole system is a ‚Äúblack box‚Äù. <br><br>  The result of our search was a <b>hardware solution</b> - a stand based on a microcontroller. <br><br><img src="https://habrastorage.org/webt/q2/pt/x_/q2ptx_xilvkoo1ci65ib1xzi1qg.jpeg"><br><br>  It includes a canvas with 12 LEDs, which captures the video camera, and a canvas with 12 photosensors, which are superimposed on the monitor, which displays the video stream from this camera, and capture light signals.  The entire device is placed in a light-tight box to eliminate the influence of external light sources. <br><br><img src="https://habrastorage.org/webt/qy/yb/8j/qyyb8jxocos9l00-aznh1quveie.jpeg"><br><br>  The device displays a specific sequence of patterns on the LEDs, reads the result and writes it into a separate line of the report. <br><br>  LEDs display a specific pattern of light signals with a certain frequency.  For example, for a camera with a frequency of 25 fps, the change occurred once in 1 frame or 40 ms (the pattern lights up for 20 ms, extinguishes for 20 ms, then the next one lights up, etc.) <br><br>  We expected the camera to capture exactly what the eye sees, or even its own photo sensors of the stand.  Here's how, according to our expectations, the fixed sequence of 8 patterns should look like: <br><br><img src="https://habrastorage.org/webt/yn/mv/zr/ynmvzr-zdlmp4madnsxxbdnwtna.jpeg"><br><br>  Each time the LEDs reproduced the same sequence of signals, but in the reports this sequence was sometimes broken: there were frames that should not be (the LEDs from two adjacent patterns were active on them). <br><br>  We experimented with different IP video cameras and it turned out that 25 fps camera with progressive scan gave the clearest footage (unlike, for example, the 50 fps version with interlaced scan), while it minimally violated the frame sequence during transmission over the network. <br><br>  Anyway, we were not able to get rid of artifacts completely - some frames came late or merged with others, but in fact it was not jerky. <br><br><img src="https://habrastorage.org/webt/ie/pb/o_/iepbo__bmoazkykihya9x9hts6c.jpeg"><br><br>  The Kotelnikov theorem came to the rescue, according to which a reference frequency of at least 2f is required to reconstruct an analog signal of frequency f.  That is, to restore the signal from the LEDs in our case can only be reliably for a frequency of 12.5 fps, which corresponds to 80ms. <br><br>  <b>As a result</b> <br><br>  As a result, the hardware solution we implemented made it possible to fix jerks corresponding to frame delays of 80ms and above, which significantly worsen the perception of the displayed video. <br><br>  The method is effective, solves the problem of detecting jerks, and also thanks to automation, it requires minimal time and effort of the quality group.  To date, we regularly apply it to the regression testing of each new release. <br><br>  As a result (although having spent a lot of time) for the subjective criteria of smoothness / non-smoothness, we obtained a completely objective method of measurement.  The assembled stand made it possible to quickly assess the smoothness of the display for any parameters of the system (different network bandwidth, different performance of the equipment for processing and display).  In addition, it does not have a binding to the Macroscop application, so with its help we are testing both desktop, mobile and web clients. </div><p>Source: <a href="https://habr.com/ru/post/353920/">https://habr.com/ru/post/353920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353910/index.html">Professional or life skills: what is more important in the IT industry today and in the future (survey results)</a></li>
<li><a href="../353912/index.html">Another tool to check your npm dependencies is wtfwith</a></li>
<li><a href="../353914/index.html">Sometimes the answer is not "42"</a></li>
<li><a href="../353916/index.html">Features of games that had to be abandoned - developer analysis</a></li>
<li><a href="../353918/index.html">Concept: logo for Yekaterinburg from "Log machines"</a></li>
<li><a href="../353924/index.html">9 Tips to Improve React Application Code Quality</a></li>
<li><a href="../353926/index.html">The most terrible mistakes that make DS. Meeting at Avito's office on April 24</a></li>
<li><a href="../353928/index.html">"Calendar of the tester" for April. Metrics in QA service</a></li>
<li><a href="../353930/index.html">How to move from BuddyBuild to GitLab CI in 4 hours</a></li>
<li><a href="../353932/index.html">Information Retrieval Course at the Winter Pushchino School: we teach high school students to create search engines</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>