<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are testing the capabilities of ARKit. Create a game with augmented reality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At WWDC 2017, Apple announced the ARKit - SDK for working with augmented reality. Thanks to him, the threshold of entry into this technology has becom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are testing the capabilities of ARKit. Create a game with augmented reality</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/404/0ea/70c/4040ea70c27441259c8e5ffe5beba137.png" alt="image"></p><br><p>  At WWDC 2017, Apple announced the ARKit - SDK for working with augmented reality.  Thanks to him, the threshold of entry into this technology has become much lower.  You can expect a large number of high-quality games and applications. <a name="habracut"></a></p><br><p>  If you watched Keynote, then you probably already delighted with what he saw.  The game world, which Apple engineers were able to deploy on a regular table with ARKit, can not leave indifferent even the most sophisticated gamers.  It was not just a prototype, but a well-working technology that was really worked on.  This is easily seen by running a few demos or trying to bring something virtual to our world. </p><br><p>  Forced to upset happy owners of iPhone 6 and below.  On these devices all these charms of life will be unavailable.  To use all the key functions of ARKit, an A9 or higher processor is required.  Apple, of course, will give curtailed access to functionality, but that‚Äôs not at all. </p><br><h2 id="dopolnennaya-realnost">  Augmented Reality </h2><br><p>  Augmented reality (augmented reality, AR) is a virtual environment that is superimposed on the real world to make it more expressive, informative, or just for fun.  The term, presumably, <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2580%25D0%25B5%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">was proposed by Boeing researcher Thomas Codell</a> in 1990.  Even then, the first examples of devices using this technology began to appear.  For the first time, augmented reality <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2580%25D0%25B5%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">was implemented on electronic helmets of pilots</a> to display information about the flight and the radar. </p><br><p>  I would like to ask what everyone has been doing for almost 20 years and why this technology has received large-scale development only now.  Everything is extremely simple.  The emergence of good cameras in phones, sensors and the development of computer vision technologies made this possible. </p><br><p>  What can be done useful and what to expect in the near future on the shelves of the AppStore?  In fact, everything is limited only by the imagination of the developers.  It is safe to name several industries where AR will revolutionize with the release of the new Apple framework: </p><br><ul><li>  Game industry; </li><li>  Architecture; </li><li>  Film industry. </li></ul><br><h2 id="vozmozhnosti-arkit">  ARKit features </h2><br><p>  ARKit is not a Harry Potter wand, but a tool that can intelligently process a large amount of data received from the device.  Thanks to the camera and motion sensors, the framework tracks movement, finds surfaces, and determines the light intensity.  After analyzing the data, we get a concrete idea of ‚Äã‚Äãthe surrounding world in the form of intersection points, the coordinates of the surfaces and the position of the camera in space. </p><br><p>  The core task of ARKit is World Tracking to create a virtual model of the real world.  The framework recognizes the features of video frames, tracks changes in their position and compares this information with data from motion sensors.  The result is a virtual model of the real world.  A separate feature is the recognition of flat horizontal surfaces.  ARKit finds the plane and reports on their location and size. </p><br><p>  Tracking the outside world requires an analysis of the image received from the camera.  To achieve the best result, you need good lighting. </p><br><p> The basis of ARKit are <code>ARSCNView</code> and <code>ARSKView</code> .  They are used to display live video and render 3D and 2D images.  As everyone guessed, these are the heirs from <code>SCNView</code> and <code>SKView</code> .  Therefore, ARKit does not introduce any incredible features in the display of data.  These are all the same engines for working with 2D and 3D graphics, with which everyone is already familiar.  Therefore, the threshold of entry into this technology will be quite low.  Apple is famous for its love for its technologies and products, but despite this, the ARKit developers made support for Unity and the Unreal Engine.  This will positively affect the number of high-quality applications that will appear in the near future. </p><br><p>  <code>ARSCNView</code> and <code>ARSKView</code> contain the heart of ARKit - <code>ARSession</code> .  It is this class that contains everything you need to work with augmented reality.  To start the <code>ARSession</code> you need to transfer the configuration of the session. </p><br><p>  The type of configuration determines the style and quality of work of the AR, which can be achieved: </p><br><ul><li>  On devices with an A9 processor or newer, you can use <code>ARWorldTrackingSessionConfiguration</code> .  It is this configuration that makes it possible to take advantage of all the power of the new framework.  A model of the surrounding world in virtual reality will be created for you and information about the planes in the field of view of the camera will be provided.  This will help position the virtual objects with maximum accuracy. </li><li>  On other devices that support ARKit, only <code>ARSessionConfiguration</code> will be available.  The base class provides only information about the movement of the device in space, but does not build virtual models.  This will not give the desired effect and will not allow to enjoy all the quality of the new technology.  You will not be able to capture virtual objects relative to objects in the real world. </li></ul><br><p>  After selecting the type of configuration, you need to create an instance of it, configure it and start the session: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewWillAppear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animated: Bool)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewWillAppear(animated) <span class="hljs-comment"><span class="hljs-comment">// Create a session configuration let configuration = ARWorldTrackingSessionConfiguration() // Run the view's session sceneView.session.run(configuration) }</span></span></code> </pre> <br><p>  It is important to remember that ARKit consumes quite a lot of energy for calculations.  If the View with content is not currently displayed on the screen, then it makes sense to pause the session for this time using <code>session.pause()</code> . </p><br><p>  After starting the session, you can start working with virtual content.  If you want ARKit to recognize planes, do not forget to set the <code>planeDetection</code> value of the configuration to <code>horizontal</code> .  Initially, recognition of horizontal surfaces is disabled.  Let's hope that in the future it will be possible to find vertical surfaces, but so far only horizontal ones. </p><br><p>  The method of obtaining information about the environment depends on what kind of data display you will use <code>ARSCNView</code> , <code>ARSKView</code> or <code>Metal</code> .  The unit of information that ARKit provides is <code>ARAnchor</code> .  If you have surface recognition enabled, you will encounter the subclass <code>ARPlaneAnchor</code> .  It contains information about the planes found.  Thanks to these anchors it is possible to navigate in space.  In case of using Metal, you will have to manually render.  Then you can subscribe to updates using the <code>ARSessionDelegate</code> delegate from the <code>ARSession</code> class, and receive anchors from the session.  If you use one of the Apple engines to render objects, then you can use the more convenient delegates <code>ARSCNViewDelegate</code> or <code>ARSKViewDelegate</code> . </p><br><p>  At first glance, everything is quite simple.  Almost all the hard work is done by <code>ARSession</code> .  Let's try to make a test application. </p><br><h2 id="testiruem-vozmozhnosti-arkit">  We test the capabilities of ARKit </h2><br><p>  Augmented reality is now all associated with the game Pok√©mon GO, which blew up the gaming industry market.  Let's try to do something similar. </p><br><p>  To create a test application, we will use <code>ARSCNView</code> to create and render 3D models.  Our game will consist of 2 stages.  First, we will set targets in the room, and then try to hit them all as quickly as possible.  The game is rather primitive, but it will demonstrate the simplicity of creating games with augmented reality. </p><br><p>  To begin with, we stretch the entire ViewController <code>ARSCNView</code> and create an IBOutlet.  Further we will work with it, as with usual <code>SCNView</code> .  Make the initial setup.  Let's make the controller a delegate of the contacts of the physical world and display statistics.  Set the session start and pause when the controller appears and is hidden. </p><br><pre> <code class="hljs pgsql">override func viewDidLoad() { super.viewDidLoad() sceneView.scene.physicsWorld.contactDelegate = self // <span class="hljs-keyword"><span class="hljs-keyword">Show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">statistics</span></span> such <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fps <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">timing</span></span> information sceneView.showsStatistics = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } override func viewWillAppear(_ animated: <span class="hljs-type"><span class="hljs-type">Bool</span></span>) { super.viewWillAppear(animated) // <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> let <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> = ARSessionConfiguration.isSupported ? ARWorldTrackingSessionConfiguration() : ARSessionConfiguration() // Run the <span class="hljs-keyword"><span class="hljs-keyword">view</span></span><span class="hljs-string"><span class="hljs-string">'s session sceneView.session.run(configuration) } override func viewWillDisappear(_ animated: Bool) { super.viewWillDisappear(animated) // Pause the view'</span></span>s <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> sceneView.<span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.pause() }</code> </pre> <br><p>  The choice of session configuration depends on the model of the device on which the application was launched.  It is imperative to do this check.  Otherwise, in case of an incorrect configuration, the session will send an error and the game will not start at all. </p><br><p>  ARKit is so simple that we will no longer use any of its settings.  The only thing that is needed is the location of the camera in the space of the virtual world.  The rest is a matter of technology and a bit of SceneKit. </p><br><p>  We will not describe here the processing of clicks or scoring.  This is not so important, and you can see it yourself in the DEMO presented at the end of the article. </p><br><p>  Our game contains two models of objects: the ball, which we will shoot, and the flying Touch Instinct logos.  To add these models to the screen, you need to create them using <code>SCNNode</code> . </p><br><p>  What you need to create a physical object: </p><br><ul><li>  set a shape of a certain size; </li><li>  create a shape with physical properties to control contacts with other objects; </li><li>  create a physical body to describe the behavior of an object in contact; </li><li>  set the texture. </li></ul><br><p>  An example of the implementation of the classes of the cartridge in the form of a ball and a logo in the form of a cube with the necessary textures. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ARBullet</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SCNNode</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> arKitBox = <span class="hljs-type"><span class="hljs-type">SCNSphere</span></span>(radius: <span class="hljs-number"><span class="hljs-number">0.025</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.geometry = arKitBox <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> shape = <span class="hljs-type"><span class="hljs-type">SCNPhysicsShape</span></span>(geometry: arKitBox, options: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody = <span class="hljs-type"><span class="hljs-type">SCNPhysicsBody</span></span>(type: .<span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>, shape: shape) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody?.isAffectedByGravity = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody?.categoryBitMask = <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>.arBullets.rawValue <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody?.contactTestBitMask = <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>.logos.rawValue <span class="hljs-comment"><span class="hljs-comment">// add texture let material = SCNMaterial() material.diffuse.contents = UIImage(named: "art.scnassets/ARKit_logo.png") self.geometry?.materials = [material] } required init?(coder aDecoder: NSCoder) { fatalError("init(coder:) has not been implemented") } }</span></span></code> </pre> <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logo</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SCNNode</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logo = <span class="hljs-type"><span class="hljs-type">SCNBox</span></span>(width: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, height: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, length: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, chamferRadius: <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.geometry = logo <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> shape = <span class="hljs-type"><span class="hljs-type">SCNPhysicsShape</span></span>(geometry: logo, options: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody = <span class="hljs-type"><span class="hljs-type">SCNPhysicsBody</span></span>(type: .<span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>, shape: shape) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody?.isAffectedByGravity = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody?.categoryBitMask = <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>.logos.rawValue <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.physicsBody?.contactTestBitMask = <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>.arBullets.rawValue <span class="hljs-comment"><span class="hljs-comment">// add texture let material = SCNMaterial() material.diffuse.contents = UIImage(named: "art.scnassets/logo-mobile.png") self.geometry?.materials = Array(repeating: material, count: 6) } required init?(coder aDecoder: NSCoder) { fatalError("init(coder:) has not been implemented") } }</span></span></code> </pre> <br><p>  I want to draw attention to the CollisionCategory.  This structure is used to determine the type of object in contact. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CollisionCategory</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OptionSet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rawValue: <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> arBullets = <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>(rawValue: <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logos = <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>(rawValue: <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre> <br><p>  This is the standard tactic for determining contact.  The <code>categoryBitMask</code> property sets the mask for a specific object, and <code>contactTestBitMask</code> sets up all contacts that are interesting to us and about which we want to receive notifications. </p><br><p>  Since we started talking about contact processing, let's see how it looks in the controller.  In <code>viewDidLoad</code> we have already subscribed to the contact events of the physical world.  It remains to implement one function. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SCNPhysicsContactDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">physicsWorld</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> world: SCNPhysicsWorld, didBegin contact: SCNPhysicsContact)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nodeABitMask = contact.nodeA.physicsBody?.categoryBitMask, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nodeBBitMask = contact.nodeB.physicsBody?.categoryBitMask, nodeABitMask &amp; nodeBBitMask == <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>.logos.rawValue &amp; <span class="hljs-type"><span class="hljs-type">CollisionCategory</span></span>.arBullets.rawValue <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } contact.nodeB.removeFromParentNode() logoCount -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> logoCount == <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.async { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.stopGame() } } <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.asyncAfter(deadline: .now() + <span class="hljs-number"><span class="hljs-number">0.5</span></span>, execute: { contact.nodeA.removeFromParentNode() }) } }</code> </pre> <br><p>  The most interesting is the first verification that it was the collision of the cartridge and the target in the form of a cube that occurred.  It is based on a bit mask.  It is very convenient and eliminates a lot of other checks. </p><br><p>  In a collision, we reduce the counter of the remaining logos and remove both objects.  The second object is removed with a slight delay to render the collision. </p><br><p>  The two main gaming features are target addition and shot.  Adding occurs at a short distance from the screen in the direction to which the camera is directed.  We simply create an already configured cube object, add it to the scene and set up its location relative to the camera in space. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addLogo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentFrame = sceneView.session.currentFrame <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logo = <span class="hljs-type"><span class="hljs-type">Logo</span></span>() sceneView.scene.rootNode.addChildNode(logo) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> translation = matrix_identity_float4x4 translation.columns.<span class="hljs-number"><span class="hljs-number">3</span></span>.z = -<span class="hljs-number"><span class="hljs-number">1</span></span> logo.simdTransform = matrix_multiply(currentFrame.camera.transform, translation) logoCount += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> logoCount == <span class="hljs-type"><span class="hljs-type">ViewController</span></span>.logoMaxCount { startGame() } }</code> </pre> <br><p>  When fired, we also create a ball object.  Add it to the scene.  But now we need not only to add it, but also to accelerate it.  To do this, we determine the position in the middle of the screen and attach acceleration by applying force in the right direction. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shoot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> arBullet = <span class="hljs-type"><span class="hljs-type">ARBullet</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (direction, position) = cameraVector arBullet.position = position arBullet.physicsBody?.applyForce(direction, asImpulse: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) sceneView.scene.rootNode.addChildNode(arBullet) }</code> </pre> <br><p>  So in just a couple of dozen lines, we created a simple game. </p><br><h2 id="buduschee-nastupit-v-sentyabre">  The future will come in September </h2><br><p>  As you can see, Apple did their best.  Thanks to the new ARKit framework, creating applications with augmented reality is as easy as making an application with multiple controllers.  At the same time you do not need to worry about the beautiful scenery.  This technology will precisely change our understanding of mobile applications. </p><br><p>  Download the new Xcode 9, and create applications that add to our world of virtual magic.  The future is here.  Well, or will be here closer to September, after the next presentation of Apple. </p><br><h2 id="demo-proekt">  Demo project </h2><br><p>  <a href="https://github.com/TouchInstinct/ARKitTestDemo">Download in Touch Instinct repository</a> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/k4p6M8brsfU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/331078/">https://habr.com/ru/post/331078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331064/index.html">RESTful API: we do everything wrong</a></li>
<li><a href="../331066/index.html">Edge computing will replace cloud computing?</a></li>
<li><a href="../331070/index.html">‚ÄúColleagues, everything has fallen!‚Äù What can go wrong on the meta-search site and what to do about it? Part 1</a></li>
<li><a href="../331072/index.html">How to patch KÃ∂DÃ∂EÃ∂ TCP stack under FreeBSD</a></li>
<li><a href="../331074/index.html">Report from Moscow Data Science Meetup May 31</a></li>
<li><a href="../331080/index.html">Why connect under attack to DDoS neutralization service is too late</a></li>
<li><a href="../331082/index.html">Frequencies and network capacity - everything you wanted to ask</a></li>
<li><a href="../331086/index.html">What can go wrong on the meta-search site and what to do about it? Part 2</a></li>
<li><a href="../331088/index.html">Reduce the use of Redux code with React Apollo</a></li>
<li><a href="../331090/index.html">Shallow immersion or data recovery from the hard drive after flooding the office</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>