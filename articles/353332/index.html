<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Own validations of fields for Rules in one class</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Validation of input data is deservedly one of the most important rules in the entire IT field. If you narrow the scope of activities before the develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Own validations of fields for Rules in one class</h1><div class="post__text post__text-html js-mediator-article">  Validation of input data is deservedly one of the most important rules in the entire IT field.  If you narrow the scope of activities before the development of websites, we will focus mainly on the validation of data from forms. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/211/7c6/eda/2117c6eda4597a890baaeb503e3dcee2.jpg" alt="image"><br><br>  I don‚Äôt think that many developers like to check the input data and do it quite thoroughly, so modern frameworks such as <b>Yii 2</b> provide <b>rules ()</b> for models and Validator classes, which, although they don‚Äôt eliminate this routine, at a minimum, make this process less tedious. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In modern <b>Yii 2</b> documentation and other sources, I did not find a living example of how to make all of my own validation rules be kept in one place and it would be convenient to use them if you are interested in solving this problem, welcome under cat. <br><a name="habracut"></a><br><h3>  A little bit about yourself </h3><br>  I can‚Äôt call myself a sophisticated programmer in OOP; moreover, I‚Äôm far from the formal levels of Middle developer and now I‚Äôll rather be at the Junior stage.  I started my path as a web developer in 2007 (I was 15 at the time), did everything on my knee, absorbing tons of literature, but in 2010 I successfully ‚Äúmerged‚Äù when I entered the university for a specialty that did not intersect with development and programming as a whole and returned to the field only six months ago.  In order to more accurately express the degree of my experience, every time I look at my code a week later, I think, <a href="http://www.bash.org/%3F6824">‚ÄúWhat the hell did this programmer write?‚Äù</a> Therefore, the situation is not excluded that you find this article meaningless or too superficial, or more sadly incorrect. <br><br><h3>  The essence of the problem </h3><br>  For everyday needs and standard tasks out-of-the-box, <b>Yii 2.0 *</b> is enough, but when it comes to more scrupulous work of validators and usability, we will encounter some difficulties that contradict various principles, including <b>DRY</b> , and in general they can look like <br><br><div class="spoiler">  <b class="spoiler_title">extremely ugly</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> , <span class="hljs-string"><span class="hljs-string">'price'</span></span>, <span class="hljs-string"><span class="hljs-string">'phone'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'required'</span></span> ] , [[<span class="hljs-string"><span class="hljs-string">'phone'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($attribute, $params, $validator)</span></span></span><span class="hljs-function"> </span></span>{ $pattern = <span class="hljs-string"><span class="hljs-string">"/^[8|+7]922\d{7}$/uism"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match($pattern, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addError($attribute, <span class="hljs-string"><span class="hljs-string">'     !'</span></span>); $region = Yii::$app-&gt;newRegions-&gt;addRegionByPhone( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute ); Yii::$app-&gt;log-&gt;write(<span class="hljs-string"><span class="hljs-string">"    : "</span></span> . $region); } }], [[<span class="hljs-string"><span class="hljs-string">'price'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($attribute, $params, $validator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_numeric(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute) || (float) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addError($attribute, <span class="hljs-string"><span class="hljs-string">'  '</span></span>); }], [[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($attribute, $params, $validator)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addError($attribute, <span class="hljs-string"><span class="hljs-string">'    '</span></span>); }], [ [ <span class="hljs-string"><span class="hljs-string">'vendor_code'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'string'</span></span> , <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    25  255 .'</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Currencies::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Products::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ] ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> , [ [ <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Units::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; User::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> ] , ]; }</code> </pre> <br></div></div><br>  Of course, all closures can be replaced by <br><br><div class="spoiler">  <b class="spoiler_title">callback functions</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> , <span class="hljs-string"><span class="hljs-string">'price'</span></span>, <span class="hljs-string"><span class="hljs-string">'phone'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'required'</span></span> ] , [[<span class="hljs-string"><span class="hljs-string">'phone'</span></span>], <span class="hljs-string"><span class="hljs-string">"phoneValidator"</span></span>], [[<span class="hljs-string"><span class="hljs-string">'price'</span></span>], <span class="hljs-string"><span class="hljs-string">"priceValidator"</span></span>], [[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>], <span class="hljs-string"><span class="hljs-string">"quantityValidator"</span></span>], [ [ <span class="hljs-string"><span class="hljs-string">'vendor_code'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'string'</span></span> , <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    25  255 .'</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Currencies::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Products::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ] ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> , [ [ <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Units::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; User::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> ] , ]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phoneValidator</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($attribute, $params, $validator)</span></span></span><span class="hljs-function"> </span></span>{ $pattern = <span class="hljs-string"><span class="hljs-string">"/^[8|+7]922\d{7}$/uism"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match($pattern, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addError($attribute, <span class="hljs-string"><span class="hljs-string">'     !'</span></span>); $region = Yii::$app-&gt;newRegions-&gt;addRegionByPhone( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute ); Yii::$app-&gt;log-&gt;write(<span class="hljs-string"><span class="hljs-string">"    : "</span></span> . $region); } } ...</code> </pre><br></div></div><br>  The <b>rules</b> method will look cleaner, but it still clutters the model code with additional validation methods.  For this case, the developers of <b>Yii 2.0 *</b> allow us to add Validator classes, <br><br><div class="spoiler">  <b class="spoiler_title">thereby, we can remove the 'unnecessary' validation methods from the Model itself.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> , <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> , <span class="hljs-string"><span class="hljs-string">'price'</span></span>, <span class="hljs-string"><span class="hljs-string">'phone'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'required'</span></span> ] , [[<span class="hljs-string"><span class="hljs-string">'phone'</span></span>], PhoneValidator::className()], [[<span class="hljs-string"><span class="hljs-string">'price'</span></span>], PriceValidator::className()], [[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>], QuantityValidator::className()], [ [ <span class="hljs-string"><span class="hljs-string">'vendor_code'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'string'</span></span> , <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    25  255 .'</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Currencies::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'currency_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Products::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ] ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> , [ [ <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; Units::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'unit_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] , [ [ <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> ] , <span class="hljs-string"><span class="hljs-string">'exist'</span></span> , <span class="hljs-string"><span class="hljs-string">'skipOnError'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> , <span class="hljs-string"><span class="hljs-string">'targetClass'</span></span> =&gt; User::className() , <span class="hljs-string"><span class="hljs-string">'targetAttribute'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span> ], <span class="hljs-string"><span class="hljs-string">'message'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> ] , ]; }</code> </pre> <br></div></div><br>  This example would seem better than the previous one.  Yes, we do not litter the Model with validation methods, however we litter any of the project‚Äôs folders. <br><br><div class="spoiler">  <b class="spoiler_title">additional files</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/2d1/4fc/a99/2d14fca99fefad180f61f3bbfc6bb3b6.jpg" alt="image"><br></div></div><br>  In itself, ‚Äúcluttering up‚Äù folders is not so critical at first glance, but working with them is inconvenient ... These classes have only 3 methods: <b>validateValue, ClientValidateAttribute, getClientOptions</b> , the last 2 can be adequately used only if you are going to use only the ‚Äúboxed‚Äù functionality.  But after all, I would like for me to have a convenient way to update / maintain the validation of a dozen models, without jumping on dozens (and maybe hundreds) of files. <br><br>  Both of the above examples can be found in the official documentation of Yii and hundreds of other sources.  However, I have nowhere found an example of how to organize validation differently. <br><br><h3>  Any, but still decision </h3><br>  In more detail, I began to study the OOP example 2 months ago, when around the middle of the book of <a href="https://www.google.ru/search%3Fq%3D%25D1%2581%25D1%2582%25D0%25B8%25D0%25B2%2B%25D0%25BC%25D0%25B0%25D0%25BA%25D0%25BA%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B5%25D0%25BB%25D0%25BB%2B%25D1%2581%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2580%25D1%2588%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9%2B%25D0%25BA%25D0%25BE%25D0%25B4%26oq%3D%25D1%2581%25D1%2582%25D0%25B8%25D0%25B2%2B%25D0%25BC%25D0%25B0%25D0%25BA%25D0%25BA%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B5%25D0%25BB%26aqs%3Dchrome.2.69i57j0l5.4885j1j7%26sourceid%3Dchrome%26ie%3DUTF-8">Steve,</a> I realized that I don‚Äôt understand anything in the PLO and need to be rehabilitated, I began to study everything that comes handy.  It would seem that I know a lot, but at the same time niche, nevertheless, each following week opened my eyes to what I had studied in the previous one. <br><br>  By the same principle, I became acquainted with the <b>Traits</b> .  I once read the documentation on the <a href="http://php.net/manual/ru/language.oop5.traits.php">official PHP site</a> .  It seems to understand what is at stake.  But, as it turned out, I did not understand how, where and why to use them.  Only when I encountered the problem of ‚Äúcomfort‚Äù over the current project, I began to look for solutions and remembered those very ‚Äúclasses that I don‚Äôt understand how to use‚Äù. <br><br><div class="spoiler">  <b class="spoiler_title">The solution itself looks like this</b> <div class="spoiler_text"><pre> <code class="php hljs">CustomValidator.php <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">traits</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Yii</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> CustomValidator { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">traitPhone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($attribute, $params, $validator )</span></span></span><span class="hljs-function"> </span></span>{ $pattern = <span class="hljs-string"><span class="hljs-string">"/^[8|+7]922\d{7}$/uism"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match($pattern, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addError($attribute, <span class="hljs-string"><span class="hljs-string">'     !'</span></span>); $region = Yii::$app-&gt;newRegions-&gt;addRegionByPhone( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$attribute ); Yii::$app-&gt;log-&gt;write(<span class="hljs-string"><span class="hljs-string">"    : "</span></span> . $region); } } } ProductOffers.php <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">common</span></span>\<span class="hljs-title"><span class="hljs-title">traits</span></span>\<span class="hljs-title"><span class="hljs-title">CustomValidator</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductOffers</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">db</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">CustomValidator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ .... [[<span class="hljs-string"><span class="hljs-string">'phone'</span></span>], <span class="hljs-string"><span class="hljs-string">'traitPhone'</span></span>], .... ]; }</code> </pre><br></div></div><br>  In other words, all the methods of our own validation are located in one single <b>Trait</b> , and we use these methods in the models themselves.  To avoid permanent duplication <b>use CustomValidator;</b>  it is possible to call it immediately in the parent of the models <b>\ yii \ db \ ActiveRecord</b> (IMHO such an introduction to the Yii base code is valid) <br><br>  Personally, I think this decision is more elegant than those in the documentation: <br><ol><li>  We do not change the engine -&gt; there will be no problems with updating <i>(after all, you could just add the necessary methods to the Model class itself (but of course we never do this)</i> </li><li>  You can change all error naming and implementation in one file </li><li>  Using the <b>trait</b> prefix for the methods, we immediately let the developer know what it is about. </li><li>  You can even go to all serious and use the <b>rules ()</b> methods through the treyt, thus - the only thing that needs to be changed in the models is to add <b>use CustomTrait;</b>  and remove the basic <b>rules</b> method, and in the third place, determine which rules to use </li></ol><br><h3>  Afterword </h3><br>  Of course, I do not impose my opinion, and I am more than sure that I can be mistaken in many points, so my first experience of publishing on Habr√© will tell me in any case where I am right and where it is not, and the comments will help to understand in more detail the reasons for those or other consequences. </div><p>Source: <a href="https://habr.com/ru/post/353332/">https://habr.com/ru/post/353332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353318/index.html">State space in problems of designing optimal control systems</a></li>
<li><a href="../353320/index.html">Vulnerability found in Vesta CP hosting control panel</a></li>
<li><a href="../353322/index.html">Visualizing Process Connections in Linux</a></li>
<li><a href="../353324/index.html">How is information security operational management center (SOC-center) built today?</a></li>
<li><a href="../353328/index.html">How to use getDerivedStateFromProps in React 16.3 (py subtitles)</a></li>
<li><a href="../353334/index.html">How to use the geodata analysis to predict the number of emergency calls in different parts of the city?</a></li>
<li><a href="../353336/index.html">5 Differences technical product manager from business-oriented PM</a></li>
<li><a href="../353338/index.html">Binary tree numbering</a></li>
<li><a href="../353340/index.html">How to create a startup empire without selling your freedom</a></li>
<li><a href="../353342/index.html">How I learn Agile practices and values</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>