<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Free SMS sending from your megaphone number using a python script</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is it for? 
 It is worth considering two levels of using this feature: 


1. The usual, household need to send a relatively long message (unless ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Free SMS sending from your megaphone number using a python script</h1><div class="post__text post__text-html js-mediator-article"><h4>  What is it for? </h4><br>  It is worth considering two levels of using this feature: <br><ol><li>  The usual, household need to send a relatively long message (unless of course you have the same typing speed on the phone as on the computer) </li><li>  Unusual, geeky need to receive mailing information where there is no computer, mixed with unwillingness to pay extra money for delivering this information </li></ol><br><h6>  Normal application </h6><br>  So, for sure, many were faced with a situation when it is necessary to write a relatively long SMS message: <br><ul><li>  copy someone the information you need </li><li>  describe in detail any details of the meeting, when your interlocutor does not have the opportunity to talk </li><li>  well, or trite to write something in the spirit of those most sins-sms-ok: 3 </li></ul><br><h6>  Unusual use </h6><br>  Here, use options are limited only by your imagination and skills to parse the necessary information flows, for example: <br><ul><li>  weather forecast </li><li>  rss feed headers </li><li>  twitter tape </li><li>  your server load data </li><li>  ????? </li><li>  PROFIT! </li></ul><br><a name="habracut"></a><br><h4>  Select service to send </h4><br>  <b><i>Immediately I hasten to warn you that initially everything was done for myself, so the decision is tied to the Moscow megaphone, but for other regions the megaphone also has similar services, I hope for other operators.</i></b> <br><br>  Obviously, for domestic use it is extremely necessary to send messages from your own number and without advertising, so the service <a href="http://sendsms.megafon.ru/">sendsms.megafon.ru</a> does not fit, the more you need to enter a captcha, and how to show it in the console?  And if you also like <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D0%25B4%25D1%2580%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25B1%25D1%2583%25D1%2584%25D0%25B5%25D1%2580">framebuffer</a> , how do I love him?  And if you take into account the recent <a href="http://habrahabr.ru/blogs/infosecurity/124387/">incident</a> with prompted SMS? <br><br>  Fortunately, the megaphone has <a href="https://www.serviceguide.megafonmoscow.ru/">a Service-Guide subscribers self-service system</a> , which I used for these purposes for quite a long time, and there are other useful functions there, and https security inspires some confidence. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Relatively recently, when entering the service guide, they stopped offering to introduce captcha, which made me think about using this site for my ‚Äúdirty‚Äù purposes. <br><br>  <i>Just in case, I will answer those who are wondering why to write a console script instead of entering the site and pressing three buttons: ‚Äúenter‚Äù ‚Üí ‚Äúmenu: sending sms‚Äù ‚Üí ‚Äúitem: sending sms‚Äù:</i> <i><br></i> <ul><li>  I would like to have a direct link to the sending form </li><li>  javascript is not enabled by default in text browsers. </li><li>  The script can be used not only for normal use, but also to automate the distribution. </li></ul><br><h4>  Service Guide Site Analysis </h4><br>  Go to <a href="https://www.serviceguide.megafonmoscow.ru/">the service guide page</a> and see the following: <br><ul><li>  how to get, change, recover password </li><li>  special remarks for users of the tariff megaphone Internet </li><li>  how to get a link to a Java application Service Guide for your phone </li></ul><br>  The last point seemed to me very attractive, especially since the traffic promised not to charge, but, unfortunately, it was not possible to install my relatively old Samsung SGH-E200 phone due to the large volume of the application (I didn‚Äôt throw out the extra files either). <br><br>  We proceed to the analysis of the form of entry to the site.  I use Mozilla Firefox and <a href="http://getfirebug.com/">Firebug</a> , Google Chrome has its own toolkit for this purpose. <br><br>  Open the "Console" tab, turn on the display of AJAX requests, click the "Do not clear" button (so that when you redirect the page, these same requests are not stuck) and try to access the site. <br>  POST request: <br> <code><a href="https://www.serviceguide.megafonmoscow.ru/ps/scc/php/check.php%3FCHANNEL%3DWWW%26LOGIN%3D%25D0%25B2%25D0%25B0%25D1%2588_%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25B8%25D0%25BD%26PASSWORD%3D%25D0%25B2%25D0%25B0%25D1%2588_%25D0%25BF%25D0%25B0%25D1%2580%25D0%25BE%25D0%25BB%25D1%258C"></a> www.serviceguide.megafonmoscow.ru/ps/scc/php/check.php?CHANNEL=WWW&amp;LOGIN=_&amp;PASSWORD=_</code> <br>  Answer: <br> <code>&lt;SESSION_ID&gt;AAAAkljkLFJ9JKJk3fowmcoOW3fds&lt;/SESSION_ID&gt; <br> &lt;LANG_ID&gt;1&lt;/LANG_ID&gt; <br> &lt;AUTH_MODE&gt;U&lt;/AUTH_MODE&gt;</code> <br> <br>  It seems everything is clear, we easily get SESSION_ID. <br><br><h4>  Script writing </h4><br>  The attentive reader will notice that another POST request must be executed when redirecting: <br> <code><a href="https://www.serviceguide.megafonmoscow.ru/SCWWW/ACCOUNT_INFO%3FCHANNEL%3DWWW%26P_USER_LANG_ID%3D1%26SESSION_ID%3DAAAAkljkLFJ9JKJk3fowmcoOW3fds"></a> www.serviceguide.megafonmoscow.ru/SCWWW/ACCOUNT_INFO?CHANNEL=WWW&amp;P_USER_LANG_ID=1&amp;SESSION_ID=AAAAkljkLFJ9JKJk3fowmcoOW3fds</code> <br>  Here the answer is much more complicated: <br>  ... <br>  &lt;text-phrase xmlns: xalan = " <a href="http://xml.apache.org/xalan">xml.apache.org/xalan</a> " id = "js-dict-form"&gt; &lt;/ text-phrase&gt; <br>  ... <br>  I didn‚Äôt have much desire to parse this format, so I used the xpath and python-lxml that I already know (this is a good <a href="http://habrahabr.ru/blogs/python/114788/">example of use</a> ). <br><br><h6>  Suppose we get the data on the balance on the account: </h6><br>  <b>The code is intentionally written without checking for correct execution so as not to clutter the post with a bunch of try-except.</b> <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import urllib from lxml import etree from StringIO import StringIO def get_root(url, params): params = urllib.urlencode(params) raw_response = urllib.urlopen(url, params).read() parser = etree.HTMLParser() tree = etree.parse(StringIO(raw_response), parser) root = tree.getroot() return root login='  ' password=' ' login_url="https://www.serviceguide.megafonmoscow.ru/ps/scc/php/check.php?" login_params={'CHANNEL':'WWW', 'LOGIN':login, 'PASSWORD':password} login_root=get_root(login_url,login_params) session_id = login_root.find(".//session_id").text lang_id = login_root.find(".//lang_id").text print 'session_id=',session_id account_info_url="https://www.serviceguide.megafonmoscow.ru/SCWWW/ACCOUNT_INFO?" account_info_params={'CHANNEL':'WWW', 'P_USER_LANG_ID':lang_id, 'SESSION_ID':session_id} account_info_root=get_root(account_info_url,account_info_params) balance=account_info_root.find(".//div[@class='balance_good td_def']").text print balance</span></span></code> </pre> <br><br><h6>  Now we proceed directly to sending SMS: </h6><br><br> <code>#     <s></s> </code> <br> <pre> <code class="python hljs">prefix=<span class="hljs-string"><span class="hljs-string">'926'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'prefix='</span></span>, prefix addr=raw_input(<span class="hljs-string"><span class="hljs-string">'number (7 digits: 1234567): '</span></span>) msg=raw_input(<span class="hljs-string"><span class="hljs-string">'message: '</span></span>) msg=msg.decode(<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>).encode(<span class="hljs-string"><span class="hljs-string">'cp1251'</span></span>) sms_url=<span class="hljs-string"><span class="hljs-string">"https://www.serviceguide.megafonmoscow.ru/SCWWW/SUBS_SEND_SMS_ACTION?"</span></span> sms_params={<span class="hljs-string"><span class="hljs-string">'CUR_SUBS_MSISDN'</span></span>: login, <span class="hljs-string"><span class="hljs-string">'prefix'</span></span>: prefix, <span class="hljs-string"><span class="hljs-string">'addr'</span></span>: addr, <span class="hljs-string"><span class="hljs-string">'CHANNEL'</span></span>: <span class="hljs-string"><span class="hljs-string">'WWW'</span></span>, <span class="hljs-string"><span class="hljs-string">'SESSION_ID'</span></span>: session_id, <span class="hljs-string"><span class="hljs-string">'SUBSCRIBER_MSISDN'</span></span>: login, <span class="hljs-string"><span class="hljs-string">'MSISDN_TO'</span></span>: prefix+addr, <span class="hljs-string"><span class="hljs-string">'P_USER_LANG_ID'</span></span>: lang_id, <span class="hljs-string"><span class="hljs-string">'MESSAGE'</span></span>: msg} sms_root=get_root(sms_url,sms_params) divs=sms_root.findall(<span class="hljs-string"><span class="hljs-string">".//div"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> div <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> divs: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> div.text.strip()</code> </pre> <br><br><h6>  Well, it would be nice to log out: </h6><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#        logout_params={'CHANNEL':'WWW', 'CUR_SUBS_MSISDN':login, 'P_USER_LANG_ID':lang_id, 'SESSION_ID':session_id, 'SUBSCRIBER_MSISDN':login} logout_url="https://www.serviceguide.megafonmoscow.ru/SCWWW/CLOSE_SESSION?" logout_root=get_root(logout_url,logout_params) logout_result = etree.tostring(logout_root, pretty_print=True, method="html") print logout_result</span></span></code> </pre> <br><br>  It is easy to write scripts that will send you (or someone else) sms with the information you need: twitter tape, rss, weather forecast and so on.  Tying it to the schedule or any events is also not difficult. <br><br><h4>  Summarizing </h4><br>  Of course, many of the techniques used in the script snippets are not examples of good code.  It may be worth using an ssl connection instead of a simple urllib.urlopen ().  It is possible that you should not completely translate the page into an etree object, but try to deal with xmlns: xalan.  But one of the goals of the article is to show that there is a convenient way to send SMS without typing it on the telephone keypad, and also to provide a tool for automatic SMS messages with sending information. <br><br>  There are plans to write an article about a script for console viewing the number of tickets for trains from the Russian Railways site.  In principle, it is easy to make a connection between these two scripts: send an SMS notification that the tickets you need have appeared. <br><br>  <b>UPD:</b> <br>  Thanks for the valuable comments, a brief summary: <br><ul><li>  In some regions, sending SMS via the service guide is paid, be careful </li><li>  Some places require captcha input, maybe somewhere it can not be removed, somewhere you can use these tricks: <br><ul><li>  "Setting service guide" -&gt; "Automatic access systems" - some captcha removes </li><li>  change user agent to iphone / androids and go to the service guide - redirects to another page where there is no captcha </li></ul></li></ul><br>  Comparison of shipping methods: <br><table><tbody><tr><th>  Way </th><th>  Cost of </th><th>  room </th><th>  Note </th></tr><tr><td>  Service Guide </td><td>  Is free </td><td>  Your </td><td>  Not for all regions for free, but in some places more captcha remained </td></tr><tr><td>  <a href="http://moscow.megafon.ru/services/communicate/sms_.html">SMS +</a> </td><td>  2 rub / day </td><td>  Your </td><td>  No more than 70 sms per day, but there are other useful services </td></tr><tr><td>  <a href="http://habrahabr.ru/blogs/php/115037/">PHP-library for Megafon SOAP API</a> </td><td>  Depends on your fare </td><td>  Your </td><td>  Thanks for the <a href="https://habrahabr.ru/users/synchrone/" class="user_link">synchrone</a> library </td></tr><tr><td>  GSM-modem </td><td>  Depends on your fare </td><td>  Your </td><td>  For fans of Arduino <a href="http://jt5.ru/shields/cosmo-gsm/">link</a> from <a href="https://habrahabr.ru/users/prometheus/" class="user_link">Prometheus</a> </td></tr><tr><td>  Via mail server </td><td>  Is free </td><td>  Other </td><td>  Not used, information from the <a href="https://habr.com/ru/post/124457/">words</a> <a href="https://habrahabr.ru/users/interrupt_controller/" class="user_link">interrupt_controller</a> </td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/124457/">https://habr.com/ru/post/124457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124448/index.html">How do we equip OSM?</a></li>
<li><a href="../124450/index.html">Throwing Trojans under the guise of invoice</a></li>
<li><a href="../124451/index.html">How not to lose money, wanting to save. Online shopping rules from abroad</a></li>
<li><a href="../124454/index.html">Meeting of system administrators 2011 (Oryol region)</a></li>
<li><a href="../124456/index.html">Data on operations from Privat24 hit the network</a></li>
<li><a href="../124458/index.html">Analysis of the SBR (freelance) in the framework of the CEDC</a></li>
<li><a href="../124460/index.html">Geek Picnic: August 6, St. Petersburg, New Holland Island</a></li>
<li><a href="../124462/index.html">Usability testing step by step or HCD design evaluation</a></li>
<li><a href="../124463/index.html">Dell wants to use Hangout for customer service</a></li>
<li><a href="../124464/index.html">Analysis of SMS texts of Megafon users</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>