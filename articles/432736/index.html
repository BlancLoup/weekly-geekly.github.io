<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Devops, JUnit5 and microservice testing: a subjective view of Moscow ‚ÄúHeisenbag‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On December 6-7, the fifth Heisenbag conference took place in Moscow. 
 Her slogan is ‚ÄúTesting. Not only for testers! ‚Äù, And for two years of regularl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Devops, JUnit5 and microservice testing: a subjective view of Moscow ‚ÄúHeisenbag‚Äù</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/yy/ey/ao/yyeyao2gdkf5rkv4vqbkhwdnic8.jpeg"><br><br>  On December 6-7, the fifth Heisenbag conference took place in Moscow. <br>  Her slogan is ‚ÄúTesting.  Not only for testers! ‚Äù, And for two years of regularly visiting Heisenbagov, I (formerly a Java developer, now a technical leader in a small company that never worked in QA) managed to learn a lot in testing and implement a lot in our team.  I want to share a subjective review of the reports I remembered this time. <br><a name="habracut"></a><br>  <b>Disclaimer.</b>  Of course, this is only a small fraction (8 out of 30) of reports selected based on my personal preferences.  Almost all of these reports are somehow related to Java and there is not a single one about front-end and mobile development.  In some places I allow myself a polemic with the speaker.  If you are interested in a more complete and neutral review, according to tradition, it should appear in the <a href="https://habr.com/company/jugru/blog/">blog of the organizers</a> .  But, perhaps, it will be interesting to someone to find out exactly about those reports, which were not visited. <br><br>  <i>Photos in the article - from the <a href="https://twitter.com/HeisenbugConf">official twitter of the</a> conference.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Baruch Sadogursky.  We have DevOps.  Let's fire all testers </h3><br><img src="https://habrastorage.org/webt/ht/my/tt/htmyttor7b0ij-jr5dx4ydosj0w.jpeg"><br>  <i>(The photo shows excitement when distributing <a href="https://liquidsoftware.com/">Liquid Software</a> books by Baruch)</i> <br><br>  Those who are engaged in Java and attend conferences of the JUGRU Group, Baruh Sadogursky need no introduction.  However, on "Heisenbag" he spoke for the first time <br><br>  In a nutshell - it was a review report about the main ideas of DevOps.  The need of the audience for such reports is preserved, since the question ‚Äúgive a definition of DevOps‚Äù to the people in the hall still answers first of all ‚Äúthis is such a person ...‚Äù <br><br>  But even those who have already learned something about this topic will be very interested to learn about the research of the association DORA <a href="https://devops-research.com/">devops-research.com</a> , which received the percentages of the varieties of manual work in teams with different productivity.  And about the curve connecting the speed of delivery and quality (at some point the speed decreases, because we need time to ‚Äútest better‚Äù, but as the team develops, the correlation becomes straightforward): <br><br><img src="https://habrastorage.org/webt/fw/8v/8o/fw8v8ocre1tvccsgnwvihwc7eaw.png" width="400"><br><br>  Although the title of the report was provocative, and in the schedule, the report was marked with the category ‚Äúwill burn‚Äù, its content, in my opinion, was quite mainstream.  It was, of course, not about the dismissal of testers in terms of Devops-transformation, but about changing the nature of the work of testers.  <a href="https://www.youtube.com/watch%3Fv%3DsbPbzQvTsmU">Alan Paige</a> and Nikolai Alimenkov talked a lot about these things a year ago.  Both the changing roles and the ‚Äúhorizontal‚Äù development of ‚ÄúT-shaped skills‚Äù a year ago were discussed at the round table ‚Äú <a href="https://www.youtube.com/watch%3Fv%3DR6jj709erH0">what the tester should know in 2018</a> ‚Äù. <br><br>  ‚ÄúOf course, if you do not want to change, there will be work for you too, even if not so interesting.  There is still a job for those who want to maintain systems written in COBOL in the 70s, ‚ÄùBaruch sneered. <br><br><h3>  Artyom Eroshenko.  Need to do a project refactoring?  Have an IDEA! </h3><br><img src="https://habrastorage.org/webt/nz/i0/hm/nzi0hmxhws-r45ww43c8bl8lsr0.jpeg"><br><br>  Artyom to the participants of Heisenbag is familiar from the reports on the Allure reporting system (for example, <a href="https://youtu.be/RK8U0vWZ-RE">here is his report</a> on the Allure capabilities from the previous Heisenbag in St. Petersburg in 2018).  Allure itself was born in the context of projects with thousands, tens of thousands and even more than a hundred thousand tests and is designed to simplify the interaction between developers and testers.  It has the ability to link tests with external resources such as ticketing systems and commits in the version control system.  In our micro-team, while the score went by just a few dozen tests, we coped well with standard means.  But as the number of tests in one of the products reached 700 and, in general, the task was to create high-quality reports for customers, I began to look towards Allure. <br><br>  However, this report was not about Allure, although about him too. <br><br>  Artyom convinced the public that writing plug-ins to IntelliJ IDEA is a simple and exciting activity.  For what this may be required?  To automate mass code modification.  For example, to translate a large number of source codes from JUnit4 to JUnit5.  Or from using Allure 1 to Allure 2. Or to automate tagging on tests with communication with the ticketing system. <br><br>  Those who work with IDEA know what tricks she can do with code (for example, automatically translate code using for-loops into code using Java Streams and back, well, or instantly translate Java to Kotlin).  The more interesting it was to look at how the veil of secrecy over code transformations in IDEA opens, we are invited to take part in this and create our own plug-ins for our unique needs.  Next time, when I need to do something with a large code base, I‚Äôll remember about this report and see how it can be automated with the help of a samopisny plug-in in IDEA. <br><br><h3>  Kirill Merkushev.  Java project and Reactor - what about tests? </h3><br><img src="https://habrastorage.org/webt/35/u5/ze/35u5zepym4if2dyz-hwev3e0_mg.jpeg"><br><br>  This report, it seems to me, could well be held at the Joker or JPoint Java conferences.  Cyril talked about how he uses the <a href="https://projectreactor.io/">projectreactor.io</a> framework in microservice architecture with a single event log (Kafka), a little about the essence of coding on ‚Äúreactive streams‚Äù, including how to use applications with this framework to be debugged and tested. <br><br>  Life is also pushing our team to use architecture with a single event log, and we are also looking at Kafka.  True, for streaming event handling, we experiment with the Kafka Streams API (where, I think, more things like stateful processing are implemented out of the box transparently to the developer) rather than Reactor.  However, as always happens with new technologies, the "rake" and "pitfalls" are not known in advance.  Therefore, it was important to listen to the story of a specialist already working with technology. <br><br><h3>  Leonid Rudenko.  Selenoid Cluster Management with Terraform </h3><br><img src="https://habrastorage.org/webt/6h/xu/s8/6hxus8uek7c3xoztsywkvfwlqlq.jpeg"><br><br>  If the previous report was a reminder of the JPoint conference, then this one is definitely <a href="https://devoops.ru/">DevOops</a> .  Leonid talked about how to raise and configure a Selenoid cluster using Terraform specifications.  The fact that Selenoid itself <a href="https://www.youtube.com/watch%3Fv%3DYqcQ5Mg44DU">was a report</a> at last year's Heisenbag is a feature-rich distributed system that works as an elastic service and allows you to run a large number of Selenium tests in various browsers.  Like any system that requires deployment on multiple machines, it is difficult to manually install Selenoid.  Here modern Configuration-as-Code systems come to the rescue. <br><br>  Leonid made a rather detailed overview of Terraform‚Äôs capabilities ‚Äî a system that was probably unfamiliar to most of the audience, but is generally well known to DevOps-automatizers (for example, at the Devoops-2018 conference there was <a href="https://devoops.ru/2018/spb/talks/41rspqwszymqeqgs2ai6wm/">an excellent report by</a> Anton Babenko on Terraform).  Next, it was shown using Terraform scripts to describe the parameters of docker containers with Selenoid for each of the machines in the cluster and the parameters themselves of the virtual machines of the cluster. <br><br>  Although the specific case considered by Leonid is certainly capable of facilitating the task of deploying Selenoid, I do not agree with the speaker in everything.  In fact, it uses Terraform for two different tasks: creating resources and configuring them.  And this leads to the fact that Leonid is forced to run Terraform once to create virtual machines and once more for each of the virtual machines to raise docker containers on them.  In my opinion, Terraform, a well-performing resource creation task, does not solve the configuration task very well.  It was possible to avoid duplication of terraform-projects and their multiple launch using special configuration systems, for example, Ansible, or other solutions. <br><br>  But in general, as an ‚Äúeducational program‚Äù for testers in the field of Infrastructure as Code, this report is very useful. <br><br>
<h3>  Andrei Markelov.  Elegant integration testing of a microservice zoo using TestContainers and JUnit 5 using the example of a global SMS platform </h3><br><img src="https://habrastorage.org/webt/rk/3d/mo/rk3dmodcrkabye2qc8mdl_vskws.jpeg"><br><br>  And again about microservices!  This time, the conversation was about how to perform tests that require the launch and interaction of several services at the same time.  JUnit5 with its <a href="https://www.youtube.com/watch%3Fv%3DDAszLeWMsqU">Extension System</a> and the well-known (and beautiful) TestContainers framework were proposed as the basis for the solution (see, for example, <a href="https://www.youtube.com/watch%3Fv%3DGazYkGBamnE">last year‚Äôs report by Sergey Egorov</a> ). <br><br>  If you are writing something in Java and still do not know what TestContainers is, I urgently recommend learning.  TestContainers allows, using Docker technology, directly in the test code to raise real databases and other services, connect them over the network and, as a result, perform integration testing in an environment that is created at the time of the tests start and is destroyed immediately after it.  At the same time, everything works directly from Java code, connects as a Maven-dependency, and does not require installation of anything but Docker on the developer‚Äôs / CI server machine.  We ourselves have been using TestContainers for over a year now. <br><br>  Andrei showed a rather impressive example of how to configure test environment for end-to-end tests using JUnit5 Extensions, own annotations and TestContainers.  For example, inscribing an annotation (conditional code) over your test <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Billing</span></span> <span class="hljs-meta"><span class="hljs-meta">@Messaging</span></span></code> </pre> <br>  we can, relatively speaking, write <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">systemIsDoingRightThings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BillingService b, MessagingService m)</span></span></span><span class="hljs-function"> </span></span>{...}</code> </pre><br>  In the parameters of which will be transferred Java-interfaces through which you can communicate with real services raised (imperceptibly for the developer of the test) in containers. <br><br>  These examples look very elegant.  For me, as an active user of TestContainers and JUnit 5, they are understandable and relatively easy to implement. <br><br>  But in general, with this approach, the big question remains that is associated with the fact that the method of configuring the test and production systems are fundamentally different. <br><br>  To make quick releases in production, without fear of breaking everything, you can only if in the process of end-to-end testing not only the whole system was tested, but also the way of its configuration.  If we repeatedly launched the system deployment script during the development and testing process, we would have no doubt that this script will work even when launched in production.  The role of the code that configures the test environment in the example of Andrew perform annotations.  But in production we lay out the system with the help of a completely different code - Ansible, Kubernetes, anything - not involved in any way with similar testing of the system.  And this limits these tests, which are not entirely end-to-end. <br><br><h3>  Andrey Glazkov.  Testing systems with external dependencies: problems, solutions, Mountebank </h3><br><img src="https://habrastorage.org/webt/rc/u5/pm/rcu5pm2i_wcdfacaaglje5bcqmy.jpeg"><br><br>  For those for whom the topic of this report is relevant, I highly recommend also to see the <a href="https://www.youtube.com/watch%3Fv%3DePvrXUCeAr8">bright report by Andrey Solntsev</a> on the fundamental approach to testing systems dependent on external services.  Solntsev very convincingly speaks of the need to use the mocks of external systems for comprehensive testing.  And Andrei Glazkov in his report describes one of the systems for such mocking - Mountebank, written in NodeJS. <br><br>  Mountebank can be raised as a server and ‚Äútrained‚Äù in answering requests over the network in a way similar to how we, when writing unit tests, ‚Äúteach‚Äù moki interfaces.  With the only difference that it is a mock network service.  A curious case of using Mountebank is the ability to use it as a proxy - sending part of the requests to the real external system. <br><br>  It should be noted here that I would recommend to Java developers (and Andrew in the discussion area agreed with this) also look towards the WireMock library, which was created in Java and can run in a embedded mode, i.e., directly from the tests without installing - or services on the developer's machine or CI-server (although it can work as a standalone server).  Like Mountebank, WireMock supports proxying mode.  We have a little positive experience using WireMock. <br><br>  The advantage of Mountebank, however, is the support of lower-level protocols (WireMock works only for HTTP) and the opportunity to work in the ‚Äúzoo‚Äù of different technologies (for Mountebank there are libraries for different languages). <br><br><h3>  Kirill Tolkachev.  Test and cry with Spring Boot Test </h3><br><img src="https://habrastorage.org/webt/k0/zu/tc/k0zutcg8ntbu0_a4suehr0lsqww.jpeg"><br><br>  And again Java, microservices and JUnit 5. Kirill is another well-known Java-community Joker and JPoint conference speaker, speaking for the first time at Heisenbag. <br><br>  This report is a modified version of last year's report " <a href="https://www.youtube.com/watch%3Fv%3D7mZqJShu_3c">The Curse of Spring Test</a> ", with examples modified under JUnit5 and Spring Boot 2. Various practical problems related to configuring Spring Boot tests in component / microservice tests are considered in depth.  For example, I was impressed with the example of using an empty <code>@SpringBootConfiguration StopConfiguration</code> in the right place in the source tree to stop the process of scanning configurations, as well as the ability to use <code>@MockBean</code> and <code>@SpyBean</code> instead of mocks.  Like the other reports of Kirill and Yevgeny Borisov, this is material to which it makes sense to return in the process of practical use of the Spring Framework. <br><br><h3>  Andrey Karpov.  What can static analyzers, what programmers and testers can't </h3><br><img src="https://habrastorage.org/webt/ze/xw/5b/zexw5bvquuivqfswlpzhocrx4pe.jpeg"><br><br>  Static code analysis is a useful thing.  According to the canons of Continuous Delivery, it should be the very first phase of the delivery pipeline, screening out the code with problems that can be detected by ‚Äúreading‚Äù the code.  Static analysis is good because it is fast (much faster than executing tests), as well as cheap (it does not require additional efforts from the team in the form of writing tests: all the checks are already written by the authors of the analyzer). <br><br>  Andrei Karpov, one of the founders of the PVS-Studio project (Habra, who is well-known to his <a href="https://habr.com/company/pvs-studio/">blog by</a> readers), built a report on examples of what bugs when analyzing the code of known products were found using PVS-Studio.  PVS Studio itself is a polyglot product, it supports C, C ++, C # and, most recently, Java. <br><br>  Despite the fact that the examples given were interesting and the benefits of static analysis of them are obvious, in my opinion, Andrei‚Äôs report had flaws. <br><br>  Firstly, the report was built solely on consideration of the PVS-Studio product (for which, according to the speaker, ‚Äúthe average price tag is $ 10,000‚Äù).  But it was worth mentioning that, in fact, in many languages ‚Äã‚Äãthere are many advanced static analysis systems OpenSource.  In Java alone, free Checkstyle and SpotBugs (the heir to the frozen FindBugs project), as well as the IntelliJ IDEA analyzer, which can be run separately from the IDE and get a report, has made tremendous progress. <br><br>  Secondly, speaking about static analysis, it seems to me that it is always worth mentioning the fundamental limitations of this method.  Not everyone was at the university the theory of algorithms and are familiar with the "problem of stopping", for example. <br><br>  And finally, the problems of introducing static analysis into the existing code base were not affected at all, which still stops many people from regularly using analyzers on projects.  For example, we drove the analyzer on a large legacy project and found 100,500 Vorning.  There is no time and effort to fix them right on the spot, and there is a risk of massively changing something in the code.  What to do with it, how to make static analysis work as a quality gate?  In the discussion area, this problem was discussed with Andrey, but this question was not considered in the report itself. <br><br>  In general, I wish Andrey and his team success.  Their product is interesting and the idea to occupy a niche in this area is very brave. <br><br><h3>  *** </h3><br>  Perhaps I will not say anything about the final keyouts of the first and second days: they were both author shows that you just need to watch.  To talk about them is the same as retelling words, for example, a rock band performance. <br><br>  In my report a <a href="https://habr.com/post/344346/">year ago,</a> I tried to convey the general atmosphere of the conference and talked about what was happening in the discussion areas, at lunch and at a party, so I will not repeat. <br><br>  In conclusion, I would like to thank the organizers for another great conference.  As far as I understood, the interest in the conference somewhat exceeded expectations, there was some overbooking and not even enough souvenirs for everyone.  But definitely everyone had more important things: interesting reports, space for discussion, food and drinks.  I look forward to new meetings! </div><p>Source: <a href="https://habr.com/ru/post/432736/">https://habr.com/ru/post/432736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432726/index.html">Processor Design (CPU Design) RAM Machine</a></li>
<li><a href="../432728/index.html">Vulnerability in the API API reveals 52.5 million private data.</a></li>
<li><a href="../432730/index.html">MQTT, smart home, ESP-8266 and Plug & Play</a></li>
<li><a href="../432732/index.html">My experience in implementing 1C (part 1. Introduction)</a></li>
<li><a href="../432734/index.html">Twisted in the clouds: prospects for development and the reverse side of cloud-services</a></li>
<li><a href="../432740/index.html">"CMS" based on Google Spreadsheets for static sites</a></li>
<li><a href="../432742/index.html">Corporate time trouble</a></li>
<li><a href="../432744/index.html">DWDM: the solution is cheaper than the carrier by 30-50% (Enterprise class)</a></li>
<li><a href="../432746/index.html">For three days in reanimation or what is wrong with the Work-Life Balance section on Mobius'18?</a></li>
<li><a href="../432748/index.html">Kubernetes tips & tricks: on node allocation and web application loads</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>