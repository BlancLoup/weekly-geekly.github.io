<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Algorithm for organizing logical volumes in the Windows OS environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The JavaScript code prototype surely outperforms the basic DISKPART.EXE system utility in solving the problem of streamlining logical volumes. 

 An a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Algorithm for organizing logical volumes in the Windows OS environment</h1><div class="post__text post__text-html js-mediator-article">  The JavaScript code prototype surely outperforms the basic DISKPART.EXE system utility in solving the problem of streamlining logical volumes. <br><br>  An algorithm is described whose implementation in JavaScript prototype code confidently ahead of the time required for solving the problem is the DISKPART.EXE system reference utility.  The principles on which the algorithm is based are described.  A possible explanation, but not proof, is given to why DISKPART.EXE is slower than JavaScript code.  Contest results are given in various editions of Windows, including Windows 10 RTM TH1.  Described as changes made in various editions of Windows 10 forced several times to rework the algorithm in order to increase its reliability, although at the cost of some loss of speed. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  Logical volumes underlie any OS.  As long as there are no logical volumes, the system simply has nowhere to place.  Preparing a logical volume involves allocating space on a physical storage device (that is, creating a data volume, Storage # Volume, often not quite correctly referred to as a Partition, Partition), and then creating a file system within which the components of any OS reside.  The following is an algorithm for solving the problem of ordering a logical volume in relation to Windows, but the full description of the algorithm hosted on GitHub is compared with other operating systems. <br><br><h4>  Principles on which the described algorithm is based </h4><br>  The basic algorithm described here is based on two principles: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. The use of "natural sorting" on a unique, "genetic" property acquired by objects-children from objects-parents. <br><br>  2. Calculation of the ‚Äúaddress‚Äù of an object, carrier of detailed information about an object that is one level from the parent, based on the ‚Äúgenetic code‚Äù of the parent object. <br><br>  Each object, one level from the parent, acquires a number of unique properties that distinguish it from other objects generated by the same parent, such as: date and time of birth, unique character identifier, unique numeric identifier, symbolic, generic name, technical characteristics related to the volume of stored data, etc. <br><br>  In order to avoid collisions, if two devices with absolutely identical identifiers assigned by equipment manufacturers appear in the system, each such identifier when the device first appears in the system is tied with a ‚Äútag with a number‚Äù. <br><br><h4>  Identification of storage devices by equipment manufacturers and operating systems </h4><br>  Manufacturers that produce hard drives, flash drives, DVD and CD drives of different subclasses (internal, external, virtual, read only, read and write, with a choice of storage media), Tape Drives, Floppy drives. <br><br>  Manufacturers of equipment (Manufactures), endow their products with a unique, non-destructible and existing since the release for the lifetime, identifier.  The identifier, called in the system "PnPDeviceID", is represented by a rather long text string, divided into subgroups by the symbol "&amp;".  The subgroups contain the name of the manufacturer, the name of the specific product, the version number, the class of the product, and more. <br><br>  As soon as any of the storage devices was first recognized by a specific operating system, the corresponding device (with one exception) acquires another unique, substantially shorter and strictly formalized identifier called the GUID.  The GUID is 42 ASCII characters of which 6 characters are service characters.  In this connection, only 32 hex characters are immediately significant, immediately converted by the system into an 8-byte number, QWORD, according to a certain algorithm.  These eight-byte numbers using the system hashing algorithm are further used for ‚Äúdirect access‚Äù to the corresponding objects and for the ordering of objects by creating enums. <br><br>  An exception.  At least one of the storage devices that is not assigned a GUID is the device class with the generic name ‚ÄúDVD-ROM‚Äù, served in the Windows environment of any editions and editions by the driver ‚Äúcdrom‚Äù, HKLM \ SYSTEM \ CurrentControlClass \ Services \ cdrom \ Enum . <br><br>  For such devices, the OS-assigned PnPDeviceID is the only device identifier in the system. <br><br><h4>  Resolution of collisions in the Windows environment </h4><br>  Windows does exactly the same thing as babysitters in maternity hospitals, tying a tag to a newborn's hand: the OS also assigns a tag with a number to the identifier from the manufacturer in case the OS has to recognize and assign another similar device to PnPDeviceID manufacturer.  This "tag with the number" is assigned through the standard delimiter "&amp;" last. Thus, it is guaranteed that there will never be two devices in the system with exactly the same PnPDeviceID. <br><br>  PnPDeviceID is created absolutely for all data storage devices that were first recognized by the system.  But for all devices other than ‚ÄúDVD-ROM‚Äù, as mentioned above, the system also creates a GUID.  How, in this case, do the GUIDs differ for two devices with exactly the same identifiers from the manufacturer, where does the tag with the number in the GUID hang?  The ‚Äútag with the number‚Äù is the last two hex characters of the first GUID field.  A more detailed explanation will be given below when comparing the program reports in the environment 8.1 and Windows 10 RTM TH1. <br><br><h4>  Additional unique properties of storage devices </h4><br>  For logical volumes: <br><br>  <em>Volume Serial Number, SerialNumber</em> .  Assigned to the OS absolutely all devices logical volumes, including even virtual "DVD-ROM".  The serial number is represented by 8 hexadecimal characters.  There are possible collisions in this field that cannot be eliminated, and the system does not attempt to do this, since there is no need for that.  The serial number "00000000" is acquired by all logical volumes that have been fully encrypted (Encrypted) in one way or another, and the system cannot read the serial number of the volume until the volume is mounted with the decoding code.  Thus, 8 zeros in the SerialNumber field of a logical volume confidently indicate that this volume is encrypted. <br><br>  For storage devices: <br><br>  <em>Serial number of the device, SerialNumber</em> .  It is assigned by the device manufacturer.  8 hex characters.  It is stored in the system even for devices, the only logical volume on which was encrypted in one way or another. <br><br>  <em>Signature drive, Signature</em> .  It is assigned by the device manufacturer.  8 hex characters. <br>  All OSs block the display in the disk signature system if Gpt-formatted partitions are located on the disk.  This is undoubtedly a system trick, which allows, without using low-level disk I / O operations, by the presence or absence of a disk signature, determine the Style (Format) of formatting partitions on the disk: Mbr / Gpt.  Very elegantly, this is demonstrated in the disk properties stored in HKLM \ HARDWARE \ DESCRIPTION \ System \ MultifunctionAdapter \ 0 \ DiskController \ 0 \ DiskPeripheral, where the property "Identifier" = "9cb5ff90-00000000-A" is stored.  8 zeros, undoubtedly specially recorded by the OS in place of the real disk signature, indicate that the partitions on the disk have the Gpt formatting style. <br><br><h4>  Run results running on different versions of Windows </h4><br><table><tbody><tr><td>  Windows 10 RTM TH1 Build 10240 <br></td></tr><tr><td>  N <br></td><td>  EnumDevicesAndVolumes.wsf <br></td><td>  DISKPART.EXE <br></td></tr><tr><td>  one <br></td><td>  2.140 <br></td><td>  6.235 <br></td></tr><tr><td>  2 <br></td><td>  1.452 <br></td><td>  2.936 <br></td></tr><tr><td>  3 <br></td><td>  2.530 <br></td><td>  2.953 <br></td></tr><tr><td>  four <br></td><td>  2.541 <br></td><td>  2.867 <br></td></tr><tr><td>  five <br></td><td>  1.448 <br></td><td>  2.905 <br></td></tr></tbody></table><br><br><table><tbody><tr><td>  Windows 8.1 Build 9600 <br></td></tr><tr><td>  N <br></td><td>  EnumDevicesAndVolumes.wsf <br></td><td>  DISKPART.EXE <br></td></tr><tr><td>  one <br></td><td>  1.243 <br></td><td>  5.274 <br></td></tr><tr><td>  2 <br></td><td>  1.222 <br></td><td>  2.558 <br></td></tr><tr><td>  3 <br></td><td>  1.218 <br></td><td>  1.289 <br></td></tr><tr><td>  four <br></td><td>  1.200 <br></td><td>  1.379 <br></td></tr><tr><td>  five <br></td><td>  1.379 <br></td><td>  1.425 <br></td></tr></tbody></table><br><br><table><tbody><tr><td>  Windows 7 SP1 Build 7601 <br></td></tr><tr><td>  N <br></td><td>  EnumDevicesAndVolumes.wsf <br></td><td>  DISKPART.EXE <br></td></tr><tr><td>  one <br></td><td>  1.406 <br></td><td>  11.913 <br></td></tr><tr><td>  2 <br></td><td>  1.319 <br></td><td>  2.130 <br></td></tr><tr><td>  3 <br></td><td>  1.338 <br></td><td>  2.662 <br></td></tr><tr><td>  four <br></td><td>  1.310 <br></td><td>  2.788 <br></td></tr><tr><td>  five <br></td><td>  1.287 <br></td><td>  2.698 <br></td></tr></tbody></table><br><br>  A small JavaScript code, WhoIsFaster.js, sequentially launched for execution (WShell.Exec) command lines corresponding to the execution of EnumDevicesAndVolumes.wsf and DISKPART.EXE.  During the execution of both programs, the lines that were output by the programs on StdOut were read and the lines read were buffered in order to measure the CPU execution time with the utmost precision.  Measurements were made with an accuracy of milliseconds and seconds and milliseconds appear everywhere in the tables. <br><br>  Unfortunately, these figures do not only reflect CPU time: EnumDevicesAndVolumes.wsf, after completing its main work and outputting all reports, created in the current directory also the input file used in the command line to launch DISKPART.EXE.  So, the time spent on disk I / O should be added to the CPU time used by both programs.  Since the write time on the disc is obviously longer than the read time, DISKPART.EXE has some advantage over this parameter. <br><br><h4>  Hardware platform </h4><br>  Thinkpad R500, 2.4Gz, 8 Gb RAM, ATI Mobility Radeon HD 3400, 1650x1080, two internal drives.  The first, main, four sections.  The second, two sections. <br><br><h4>  Applications installed on different versions of Windows </h4><br><br>  Windows 7 Enterprise Evaluation.  Installed only Total Commander and Free Javascript Editor.  The same programs are installed in other systems. <br><br>  Windows 8.1: MS Office 2013, Acronis True Image 2015, Acronis Disk Director 12, a pair of AOMEI programs for creating backups and for partition maintenance.  Only those applications that list their own driver filters that create enumerations in HKLM \ SYSTEM \ CurrentControlSet \ Services are listed. <br><br>  Windows 10: starting with Technical Preview Build 10049, when it became possible to update Windows 8.1 without losing the installed application programs and their settings, the current 8.1 version was updated.  In the future, Windows 10 has undergone updates with all officially released assemblies, and therefore the composition of the application software in the 9600 and 10240 environments is completely the same. <br><br><h4>  Interpretation of results </h4><br>  Competitive results in the environments of all three editions of Windows are quite close.  We can only note that in the Windows 10 environment, the speed of the prototype code is more affected by parallel-running browsers with a large number of open pages, MS Office 2013 Word, which automatically starts the synchronization service with OneDrive, than in previous editions.  Therefore, the "competition" has always been held on an equal footing, immediately after the launch of Windows. <br><br>  How can we explain the significantly lower speed of DISKPART.EXE in comparison with the interpreted code EnumDevicesAndVolumes.wsf in the Windows 8.1 environment?  There is only one, unsubstantiated explanation.  As already mentioned, for all storage devices and data volumes and logical volumes created on them, the system uses QWORD keys (8 bytes) to work with hash tables. <br><br>  For the same purpose, the described algorithm uses only the Field Field 1 GUID, which is converted by the system into a QWORD.  There is not enough knowledge and data to assess the dependence of the access speed to the system hash table, but it appears that this dependence is non-linear and, at best, inversely proportional to N * log (N), where N is the key length in bits or bytes.  Thus, it is the short keys used by the described algorithm that can explain the lag of DISKPART.EXE. <br><br>  Before the advent of Windows 10 RTM TH1 Build 10240, the competitive results in the environment of various assemblies only slightly differed from those in environment 8.1.  However, in the build environment 10240, the key enumeration algorithm was fundamentally changed <br>  HKU \ SID \ Software \ Microsoft \ Windows \ CurrentVersion \ Explorer \ MountPoints2 \ CPC \ Volume: if starting from 7601 and ending with 10166 ‚Äúchildren went families,‚Äù that is, all logical volumes created on the same physical disk strictly followed one after another in ascending order of displacement from the beginning of the disk, then the ‚Äúnatural‚Äù ordering of logical volumes in which the volumes are listed strictly in the order of their mounting in the system was introduced for the first time in environment 10240.  This change was supposed to speed up the system with logical volumes.  DISKPART.EXE does not seem to use this enumeration yet and still pushes the devices serviced by the cdrom driver into the first rows. <br><br><h4>  Visual presentation of the results of solving the problem </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/22e/b0d/91f/22eb0d91f30cf9848328b18dc3472912.png"><br>  <i>Picture 1</i> <br><br>  It is this output of the information about logical volumes by the program DISKPART.EXE that was the ‚Äútask to follow‚Äù and the creation of a fast solution algorithm.  The pictures 2 and 3 below are one of the many reports created by EnumDevicesAndVolumes.wsf.  These are the shortest reports created by EnumDevicesAndVolumes.wsf.  Nevertheless, even this report contains more information than the above DISKPART report and does not contain meaningless information, as in the Status column: it is natural that all volumes are healthy, otherwise they would have to deal with their treatment, rather than competitions in solving the problem. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/791/b33/e64/791b33e644aa2cb7639c7a2b7d5a07f0.png"><br>  <i>Figure 2</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc3/72c/50c/fc372c50ca3bfa6d799b119177590ac9.png"><br>  <i>Figure 3</i> <br><br>  Figure 2 presents a brief report of EnumDevicesAndVolumes.wsf in the Windows 8.1 environment, and a very similar Figure 3 presents a similar report in the Windows 10 RTM TH1 environment.  The difference is found only in the values ‚Äã‚Äãof the F1 fields: pay attention to ‚Äú714ce4NN‚Äù and you will notice that only the last two characters provide DevGUID.F1 distinction for different Mbr-formatted disks, SD-card and partitions of the first of two Gpt-formatted VHDs.  Moreover, different VolGUID.F1, corresponding to sections on Mbr-formatted disks, have the same format.  But in Windows 10, where, as already mentioned, the VolumeGUID creation algorithms were changed, ‚Äú714ce4NN‚Äù was assigned to only two volumes, one on the first disk, the System Reserved label and one on the second disk, the TOSH-MK1646GSX label.  A more detailed analysis of the detection of ‚Äúgenetic kinship‚Äù of various GUIDs, the EnumDevicesAndVolumes.wsf JS script, presents in a specially crafted report created by the ShowResemblanse () method. <br><br><h4>  Concluding remarks to the first part of the publication </h4><br>  I will explain the use of ‚ÄúWindows Registry‚Äù instead of ‚ÄúSystem Registry‚Äù by the fact that in my view the Russian word ‚Äúregistry‚Äù is similar to ‚Äúbarn book‚Äù and calls it ‚Äúflat file‚Äù, and not a hierarchical database, which is Windows Registry. <br><br>  Why the ‚Äúprototype code‚Äù?  Initially, in imitation of DISKPART.EXE, it was planned to write the FAD code, ‚ÄúFast And Dirty‚Äù, but life and Microsoft were first forced to remove the word Fast, and then I decided to make the code cleaner and more suitable for fast rewriting in C, C ++, C #.  But still, the code remains a PROTOTYPE in the sense that it does not provide any functionality with respect to objects placed by the code in three collections. <br><br>  In the second part, it is planned to describe the four steps of the algorithm, the first three of which strictly follow the two principles proclaimed at the beginning of this publication.  Each of the first three steps begins with the reading of some enumeration, continues with the extraction of detailed properties from some ‚Äúgarbage can‚Äù and ends with the placement of detailed objects endowed with all the necessary properties in the corresponding collection. <br><br>  However, those who wish can, without waiting for the second part, see and download EnumDevicesAndVolumes.wsf, WhoIsFaster.js by the link: <br><br>  <a href="https://github.com/sysprg-46/EnumerateDevicesAndVolumesWin/tree/master">https://github.com/sysprg-46/EnumerateDevicesAndVolumesWin/tree/master</a> <br><br>  There are also full descriptions in Russian in the DOCX and PDF formats, as well as screenshots present ‚Äúlong‚Äù competitive cycles, 10-15 runs each in Windows 7, Windows 8.1 and Windows 10 environments. </div><p>Source: <a href="https://habr.com/ru/post/264019/">https://habr.com/ru/post/264019/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264009/index.html">Message Formatting for Yii :: t ()</a></li>
<li><a href="../264011/index.html">Microservices Q & A</a></li>
<li><a href="../264013/index.html">Antivirus # 2: Hacking BitDefender and Serious Symantec Vulnerabilities</a></li>
<li><a href="../264015/index.html">Sell ‚Äã‚ÄãSide Platform</a></li>
<li><a href="../264017/index.html">Fighting bad URIs, spammers and php shells is a personal experience</a></li>
<li><a href="../264021/index.html">How to transfer a project of 9 million lines of code to a 64-bit platform?</a></li>
<li><a href="../264023/index.html">Increased battery life in Android M</a></li>
<li><a href="../264025/index.html">We are flashing the Upvel UR-313N4G router on OpenWRT</a></li>
<li><a href="../264029/index.html">A game for the little ones is a simple idea that is not a shame to include in the resume</a></li>
<li><a href="../264031/index.html">AccelEpi, or How EPAM Helped in Testing Drugs for Epilepsy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>