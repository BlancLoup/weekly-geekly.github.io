<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMPP Specification Guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Various services that use SMS notifications or SMS authorization are gaining popularity every day, because it is really very convenient from the point...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMPP Specification Guide</h1><div class="post__text post__text-html js-mediator-article">  Various services that use SMS notifications or SMS authorization are gaining popularity every day, because  it is really very convenient from the point of view of the user and quite safe from the point of view of the developers.  Most companies that provide SMS mailing services offer their APIs to implement the sending process (usually HTTP-based), but everyone has a standard connection option - the SMPP protocol.  My experience with users of the SMPP protocol shows that they have quite a lot of difficulties.  The reason for this (in my opinion) is the thoughtless use of ready-made libraries and, as a result, a complete misunderstanding of what is happening ‚Äúunder the hood‚Äù. <br><br>  In this article I will describe one of the most frequently asked questions from clients - ‚ÄúHow to read the text of the incoming message?  I found an on-line decoder, but it shows an abracadabra. ‚Äù  The fact is that some services have not only the ability to send messages, but also receive response messages to them.  However, the algorithm described by me is applicable to any action in the SMPP protocol, since  in fact, it is an instruction for protocol specification. <br><a name="habracut"></a><br><h4>  Parsing an incoming message without using any SMPP software </h4><br>  We will need: <br><br><ul><li>  SMPP Protocol Specification v3.4 </li><li>  Wireshark </li><li>  Notebook </li><li>  Browser </li></ul> <br>  I will not describe the process of getting the cap file itself (dump) SMPP exchange, because  There are already many articles on this topic (for example, <a href="http://habrahabr.ru/company/pentestit/blog/204274/">this one</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The general procedure for exchanging packets in SMPP is as follows: <br><br><img src="https://habrastorage.org/files/4e1/3f2/211/4e13f2211ee74cc4bb5feaf0f4cf77ba.PNG"><br><br>  As can be seen in the case of an incoming message, we are interested in the package deliver_sm.  The package type is determined by the command_id field, which in the case of deliver_sm is 0x00000005 (clause 5.1.2.1 in the specification). <br><br>  As a result, the filter in wireshark looks like this: <br><br> <code>smpp.command_id == 0x00000005 <br></code> <br><br>  After you have found a packet by filter, copy its contents in HEX format: <br><br><img src="https://habrastorage.org/files/1d6/a9c/c80/1d6a9cc803dd4a238ae55d6f99b87c6e.png"><br><br>  The final line to be decoded is: <br><br> <code>00000048000000050000000000000003000101636F6F6E6F6C616E642E727500010137393132333435363738390000000000000000 <br> 0800000424000c043f044004380432043504424 <br></code> <br><br>  The item describing the format of the package deliver_sm, in the specification, is 4.6.1 ‚ÄúDELIVER_SM‚Äù Syntax.  At this point there is a table in which each field of the packet is signed: <br><br><img src="https://habrastorage.org/files/cee/a0c/210/ceea0c2103854473b2ef4a5e64b4a3b7.png"><br><br><h5>  Let's start parsing the package. </h5><br>  The first field of the packet, <b>command_length,</b> is 4 octets in size (size octets column) and type Integer.  This means that from the beginning of our HEX line you need to count 4 x 2 = 8 characters. <br><br><div class="spoiler">  <b class="spoiler_title">Why multiply by 2?</b> <div class="spoiler_text">  We copied the string in hexadecimal format which encodes one octet (byte) in two characters. <br></div></div><br> <code>00 00 00 48 000000050000000000000003000101636F6F6...</code> <br> <br>  (HEX) <i>00000048</i> -&gt; (DEC) 72 octets or 144 characters - the length of the entire SMPP packet. <br><br>  The next <b>command_id</b> field is the same as 4 octets and Integer. <br><br> <code>00000048 00 00 00 05 0000000000000003000101636F6F6...</code> <br> <br>  Let's convert to a readable view: 00000005 = deliver_sm <br><br><img src="https://habrastorage.org/files/72d/3d0/03f/72d3d003f1a443feb5b4ed94044698df.PNG"><br><br>  The <b>command_status</b> and <b>sequence_number</b> fields also have 4 octets of each.  Where to look at their values, I guess you already guess. <br><br> <code>0000004800000005 00 00 00 00 00 00 00 03 000101636F6F6...</code> <br> <br>  The <b>service_type</b> field may contain a maximum of 6 octets and is of type <b>C-Octet String</b> .  Paragraph 3.1 of the SMPP PDU - Type Definitions states: <br><br><blockquote>  C-Octet String ASCII characters terminated with the NULL character </blockquote><br>  In other words, this is a sequence of ASCII zero octet characters as a field termination character.  Those.  This field can contain a maximum of 6 characters, but it can be less - the end of this field is designated HEX 00. In this particular example, we immediately see 00 - the field does not contain any value. <br><br> <code>00000048000000050000000000000003 00 0101636F6F6...</code> <br> <br>  If this column were filled, then it can be decrypted using a table of ASCII characters. <br><br>  Skip the next 2 fields <b>source_addr_ton</b> and <b>source_addr_npi</b> , since  how to decrypt them is already clear and analyze another field with the type C-Octet String - source_addr. <br><br>  <b>Source_addr</b> may contain a maximum of 21 octets, but in this case it consists of 13 octets including the zero octet which means the end of the field: <br><br>  63 6F 6F 6E 6F 6C 61 6E 64 2E 72 75 <i>00</i> <br><br>  In the search engine, we make the query ‚Äúascii table‚Äù and begin to decipher: <br><br><img src="https://habrastorage.org/files/adc/317/bf0/adc317bf074e432ab93acf56fc7a452f.png"><br><br>  63 = c <br>  6F = o <br>  6F = o <br>  6E = n <br>  6F = o <br>  6C = l <br>  61 = a <br>  6E = n <br>  64 = d <br><br>  And so on until the characters 00. <br><br>  I also skip the rest of the fields - there are many of them and their definition is no different from the one described above.  Let's go to the <b>data_coding</b> field, without the value of this field, we will not be able to read the message text. <br><br>  I separated all the fields in the HEX example line, and the data_coding field was in bold and this is what happened: <br>  00000047; 00000005; 00000000; 00000003; 00; 01; 01; 373932393937333630333000; 01; 01; 373932333235303039353900; 00; 00; 00; 00; 00; 00; 00; <br>  <b>08</b> ; 00; 0424; 000c; 043f04400438043204350442 <br><br>  Clause 5.2.19 of the specification indicates that the encoding is UCS2 (ISO / IEC-10646).  (HEX) 08 -&gt; (BIN) 00001000 -&gt; UCS2 (ISO / IEC-10646): <br><br><img src="https://habrastorage.org/files/1af/410/34b/1af41034bc9b4b74b814f3ab6cf5412f.PNG"><br><br>  We are looking for a symbol table for: "ucs2 code chart" <br><br>  043f04400438043204350442 <br><br>  Select the first 2 octets of the text ‚Äú043f‚Äù and search for them on the page. <br><br><img src="https://habrastorage.org/files/f1c/14a/747/f1c14a74782843ccb7e3d3f7368659ba.png"><br><br>  We continue to allocate 2 octets and search for: <br>  [p] 0440 CYRILLIC SMALL LETTER ER <br>  [and] 0438 CYRILLIC SMALL LETTER I <br>  [in] 0432 CYRILLIC SMALL LETTER VE <br>  [e] 0435 CYRILLIC SMALL LETTER IE <br>  [t] 0442 CYRILLIC SMALL LETTER TE <br><br>  At this parsing package is over.  I hope that the description was clear and fairly complete.  In general, if you managed to realize how to read the message, then send it will not be any difficulty.  Several fields will change. <br><br>  Read the specifications - almost everything is already written there. </div><p>Source: <a href="https://habr.com/ru/post/267991/">https://habr.com/ru/post/267991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267981/index.html">Cloud Security</a></li>
<li><a href="../267983/index.html">WinRAR critical vulnerability</a></li>
<li><a href="../267985/index.html">PBX 3CX for hosting - change the rules of the game</a></li>
<li><a href="../267987/index.html">Windows 10 through 10. Issue # 3. Using Cortana to interact with users</a></li>
<li><a href="../267989/index.html">Li-ion battery: another step towards savings</a></li>
<li><a href="../267995/index.html">Webix 3.0 - New, Purple</a></li>
<li><a href="../267997/index.html">DaData.ru turns guides into addresses and knows all the kids in the sky</a></li>
<li><a href="../268003/index.html">Elasticweb is the most democratic shared hosting</a></li>
<li><a href="../268005/index.html">Sonic Pi music programming language, All-Russian programming contest and volunteer meeting this Friday</a></li>
<li><a href="../268007/index.html">Linux botnet organizes DDoS attacks with 150 Gbps traffic and higher</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>