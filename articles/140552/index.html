<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Networks for the smallest. Part Three Static routing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The boy said to his mother: "I want to eat." Mom sent him to dad. 
 The boy said to dad: "I want to eat." Dad sent him to mom. 
 The boy said to his m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Networks for the smallest. Part Three Static routing</h1><div class="post__text post__text-html js-mediator-article">  <i>The boy said to his mother: "I want to eat."</i>  <i>Mom sent him to dad.</i> <i><br></i>  <i>The boy said to dad: "I want to eat."</i>  <i>Dad sent him to mom.</i> <i><br></i>  <i>The boy said to his mother: "I want to eat."</i>  <i>Mom sent him to dad.</i> <i><br></i>  <i>And so the boy ran, until at one moment he fell.</i> <i><br></i>  <i>What happened to the boy?</i>  <i>TTL is over.</i> <br><br><div class="spoiler">  <b class="spoiler_title">All issues</b> <div class="spoiler_text">  <a href="http://linkmeup.ru/blog/65.html">8. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/65.html">Part Eight</a>  <a href="http://linkmeup.ru/blog/65.html">BGP and IP SLA</a> <br>  <a href="http://linkmeup.ru/blog/50.html">7. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/50.html">Part Seven.</a>  <a href="http://linkmeup.ru/blog/50.html">VPN</a> <br>  <a href="http://linkmeup.ru/blog/33.html">6. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/33.html">Part six.</a>  <a href="http://linkmeup.ru/blog/33.html">Dynamic routing</a> <br>  <a href="http://linkmeup.ru/blog/16.html">5. Networks for the smallest: Part Five.</a>  <a href="http://linkmeup.ru/blog/16.html">NAT and ACL</a> <br>  <a href="http://linkmeup.ru/blog/15.html">4. Networks for the smallest: Part Four.</a>  <a href="http://linkmeup.ru/blog/15.html">STP</a> <br>  <a href="http://linkmeup.ru/blog/14.html">3. Networks for the smallest: Part Three.</a>  <a href="http://linkmeup.ru/blog/14.html">Static routing</a> <br>  <a href="http://linkmeup.ru/blog/13.html">2. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/13.html">Part two.</a>  <a href="http://linkmeup.ru/blog/13.html">Switching</a> <br>  <a href="http://linkmeup.ru/blog/12.html">1. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/12.html">Part one.</a>  <a href="http://linkmeup.ru/blog/12.html">Connection to the equipment cisco</a> <br>  <a href="http://linkmeup.ru/blog/11.html">0. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/11.html">Part zero.</a>  <a href="http://linkmeup.ru/blog/11.html">Planning</a> <br></div></div><br><br>  So, a turning point in the history of the company ‚ÄúLift me Up‚Äù.  The management understands that the company producing elevators, traveling only upward, will not withstand the struggle in a highly competitive market.  It is necessary to expand the business.  It was decided to purchase two plants: in St. Petersburg and Kemerovo. <br>  We urgently need to organize communications to new offices, and your local network has not even earned yet. <br>  Today: <br>  1. We configure routing between vlans in our network (InterVlan routing) <br>  2. We are trying to deal with the processes occurring in the network, and what is happening with the data. <br>  3. We plan network expansion (IP addresses, vlana, switching tables) <br>  4. We configure static routing and understand how it works. <br>  5. Use the L3 switch as a gateway 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Content: <br><ul><li>  <a href="https://habr.com/ru/post/140552/">InterVlan Routing</a> </li><li>  <a href="https://habr.com/ru/post/140552/">Expansion planning</a> </li><li>  <a href="https://habr.com/ru/post/140552/">... IP plan</a> </li><li>  <a href="https://habr.com/ru/post/140552/">Routing Principles</a> </li><li>  <a href="https://habr.com/ru/post/140552/">Customization</a> </li><li>  <a href="https://habr.com/ru/post/140552/">... Moscow.</a>  <a href="https://habr.com/ru/post/140552/">Arbat</a> <br></li><li>  <a href="https://habr.com/ru/post/140552/">... Provider</a> <br></li><li>  <a href="https://habr.com/ru/post/140552/">‚Ä¶ St. Petersburg.</a>  <a href="https://habr.com/ru/post/140552/">Vasilyevsky Island</a> <br></li><li>  <a href="https://habr.com/ru/post/140552/">‚Ä¶ St. Petersburg.</a>  <a href="https://habr.com/ru/post/140552/">Lakes</a> <br></li><li>  <a href="https://habr.com/ru/post/140552/">... Kemerovo.</a>  <a href="https://habr.com/ru/post/140552/">Red hill</a> <br></li><li>  <a href="https://habr.com/ru/post/140552/">Additionally</a> </li><li>  <a href="https://habr.com/ru/post/140552/">Release materials</a> </li></ul><br><a name="IVR"></a><h1>  InterVlan Routing </h1><br>  A bit of practice for rejuvenation. <br>  The <a href="http://habrahabr.ru/blogs/sysadm/138043/">last</a> time we configured our local network switches.  At the moment, devices of different vlan do not see each other.  That is, in fact, FEI and VET, for example, are located in completely different networks and are not connected with each other.  Similarly, the server network exists by itself.  It would be necessary to correct this annoying nuisance. <br>  In our Moscow network, we will use the cisco 2811 router for routing between vlans. In other words, it will terminate vlans.  The frames here end their lives: IP packets are extracted from them, and the data link layer headers are discarded. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2bb/164/d77/2bb164d779a2736f8f407f1c2094bfb9.png"><br><br>  The process of configuring the router is very simple: <br><br>  0) First we finish with the msk-arbat-dsw1 switch.  On it we need to configure the trunk port in the direction of the router, which we did not do last time. <br><blockquote>  msk-arbat-dsw1 (config) #interface FastEthernet0 / 24 <br>  msk-arbat-dsw1 (config-if) # description msk-arbat-gw1 <br>  msk-arbat-dsw1 (config-if) # switchport trunk allowed vlan 2-3,101-104 <br>  msk-arbat-dsw1 (config-if) # switchport mode trunk <br></blockquote><br><br>  1) We assign the name of the router with the command <b>hostname</b> , and in order to develop a good tone, it is necessary to mention that it is better to set the time on the device immediately.  This will help you to correctly identify entries in the logs. <br><blockquote>  Router0 # clock set 12:34:56 7 august 2012 <br>  Router0 # conf t <br>  Router0 (config) #hostname msk-arbat-gw1 <br></blockquote><br>  It is desirable to distribute time to network devices via NTP (any tsiska can be made an NTP server, by the way) <br><br>  2) Next, go to the interface configuration mode, turned into our local network and turn it on, since by default it is in the Administratively down state. <br><blockquote>  msk-arbat-gw1 (config) #interface fastEthernet 0/0 <br>  msk-arbat-gw1 (config-if) #no shutdown <br></blockquote><br>  3) Create a virtual interface, or else it is called a subinterface or another sub-interface. <br><blockquote>  msk-arbat-gw1 (config) #interface fa0 / 0.2 <br>  msk-arbat-gw1 (config-if) #description Management <br></blockquote><br>  The logic here is simple.  First, we specify in the usual way the physical interface to which the necessary network is connected, and after the dot we put some unique identifier of this virtual interface.  For convenience, usually the subinterface number is made similar to the vlan that it terminates. <br><br>  4) Now let's recall the <a href="">802.1q</a> standard, which describes frame tagging with a vlan tag.  The next command indicates that the frames originating from this virtual interface will be marked with the tag of the 2nd vlan.  And the frames entering on the physical interface FastEthernet0 / 0 with the tag of this vlan will be accepted by the virtual interface FastEthernet0 / 0.2. <br><blockquote>  msk-arbat-gw1 (config-if) #encapsulation dot1Q 2 <br></blockquote><br><br>  5) Well, as on a regular physical L3 interface, we define an IP address.  This address will be the default gateway for all devices in this vlan. <br><blockquote>  msk-arbat-gw1 (config-if) #ip address 172.16.1.1 255.255.255.0 <br></blockquote><br>  Similarly, we configure, for example, the 101st vlan: <br><blockquote>  msk-arbat-gw1 (config) #interface FastEthernet0 / 0.101 <br>  msk-arbat-gw1 (config-if) #description PTO <br>  msk-arbat-gw1 (config-if) #encapsulation dot1Q 101 <br>  msk-arbat-gw1 (config-if) #ip address 172.16.3.1 255.255.255.0 <br></blockquote><br>  and now make sure that we see the control network from the computer from the PTO network: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e5/6d0/e84/7e56d0e849b42bb2b1467617eb20fdb5.png"><br><br>  It works and is fine, configure all the other interfaces for now.  Problems with this should arise. <br><br><h2>  The physics and logic of the interlaced routing process </h2><br>  What happens at this time with your data? <br><br>  We reasoned <a href="http://habrahabr.ru/blogs/sysadm/138043/">last time</a> what happens if you try to connect to a device from the same subnet that you are on. <br>  By the same subnet we understand the following. <br>  For example, the following is configured on your computer: <br>  IP: 172.16.3.2 <br>  Mask: 255.255.255.0 <br>  GW: 172.16.3.1 <br><br>  All devices whose addresses will be in the range 172.16.3.1-172.16.3.254 with the same mask as you will be members of your subnet.  What happens to the data if you send it to a device with an address in this range? <br>  Repeat this with some additions. <br>  To send data, they must be packed into an Ethernet frame, in the header of which the MAC address of the remote device must be inserted.  But where to get it? <br>  To do this, your computer sends a broadcast ARP request.  As the IP address of the destination node in the IP packet with this request will be placed the address of the desired host.  The network card when encapsulating indicates the MAC address of FF: FF: FF: FF: FF: FF - this means that the frame is intended for all devices.  Then it goes to the nearest switch and copies are sent to all ports of our vlan (well, except, of course, the port from which the frame was received).  Recipients see that the request is broadcast and they may be the desired host, so they extract the data from the frame.  All those devices that do not have the IP address specified in the ARP request simply ignore the request, but the real receiver device will respond to it and send its MAC address to the original sender.  The sender (in this case, our computer) places the received MAC into its IP-and-MAC-address correspondence table, aka ARP cache.  How the ARP cache looks like on your computer right now, you can see with the help of the <b>arp -a</b> command <br><img src="https://habrastorage.org/getpro/habr/post_images/ac7/294/1ff/ac72941ff4c73df73990aadd5b151737.png"><br><br>  Then your payload is packaged in an IP packet, where the recipient is the address that you specified in the command / application, then in the Ethernet frame, in the header of which the MAC address received by the ARP request is placed.  Next, the frame is sent to the switch, which, according to its table of MAC addresses, decides which port to forward it to. <br><br>  But what happens if you try to reach the device in another vlan?  An ARP request will not return anything, because the broadcast L2 messages end on the router (that is, within the broadcast L2 domain), the desired network is behind it, and the switch will not allow frames from one vlan to another.  And for this you need a default gateway (default gateway) on your computer. <br>  That is, if the recipient device is on your own subnet, the frame is simply sent to the port with the MAC address of the final recipient.  If the message is addressed to any other subnet, then the frame is sent to the default gateway, so the router‚Äôs MAC address will be substituted as the destination MAC address. <br><br>  We follow the course of events. <br><br>  1) A PC with the address 172.16.3.2/24 wants to send data to the computer with the address 172.16.4.5. <br><img src="https://habrastorage.org/getpro/habr/post_images/2d0/033/20c/2d003320cb994944b0c8f8d9d5e62605.png"><br>  He sees that the address is from a different subnet, therefore, the data must go to the default gateway.  But in this case, the PC needs the gateway MAC address.  The PC checks its ARP cache in order to match the gateway's IP address ‚Äî the MAC address does not find the one needed. <br><img src="https://habrastorage.org/getpro/habr/post_images/8d3/239/6b3/8d32396b326cc92521831937425c7789.png"><br><br>  2) The PC sends a broadcast ARP request to the local network.  ARP request structure: <br>  - at the data link layer as a recipient - broadcast address (FF: FF: FF: FF: FF: FF), as sender - the MAC address of the interface of the device trying to figure out the IP <br>  - on the network - the actual ARP request, it contains information about what IP and who is looking for. <br><img src="https://habrastorage.org/getpro/habr/post_images/375/3d6/b60/3753d6b6059c7a2c2682f67b80d3aae0.png"><br><br>  3) The switch that received the frame sends its copies to all ports of this vlan (the one that owns the original host), in addition to where it came from. <br><br>  4) All devices, having received this frame and, seeing that it is a broadcast, assume that it is addressed to them. <br><br>  5) Having unpacked the frame, all the hosts, except for the router, see that the ARP request does not have their address.  And the router sends a <a href="http://eucariot.livejournal.com/62043.html">unicast</a> ARP reply with its MAC address. <br><br>  6) The original host receives an ARP reply, now it has the MAC address of the gateway.  It forms a packet from the data that it needs to send to 172.16.4.5.  <b>As the <i>MAC address of the</i> recipient, the PC sets the gateway address.</b>  <b>In this case <i>, the</i> recipient's <i>IP address</i> in the packet remains 172.16.4.5</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3f/d60/32d/c3fd6032d401b99a9b7813d533a481a0.png"><br><br>  7) The frame is sent to the network, the switches deliver it to the router. <br><br>  8) On the router, in accordance with the label of the vlan, the frame is received by a specific subinterface.  <b>Data link level recline</b> . <br><br>  9) From the header of an IP packet, the router learns the destination address, and from its routing table it sees that it is located in a directly connected network on a certain subinterface (in our case FE0 / 0.102). <br><blockquote>  C 172.16.0.0/24 is directly connected, FastEthernet0 / 0.3 <br>  C 172.16.1.0/24 is directly connected, FastEthernet0 / 0.2 <br>  C 172.16.2.16/30 is directly connected, FastEthernet0 / 1.5 <br>  C 172.16.3.0/24 is directly connected, FastEthernet0 / 0.101 <br>  C 172.16.4.0/24 is directly connected, FastEthernet0 / 0.102 <br>  C 172.16.5.0/24 is directly connected, FastEthernet0 / 0.103 <br>  C 172.16.6.0/24 is directly connected, FastEthernet0 / 0.104 <br></blockquote><br><br>  10) The router sends an ARP request from this subinterface ‚Äî it learns the recipient's MAC address. <br><br>  11) The original IP packet, without <b>changing, is</b> encapsulated in a <b>new frame</b> , with: <br><br>  - as the source MAC address, the gateway interface address is specified <br>  - source IP address ‚Äî address of the original host (in our case, 172.16.3.2) <br>  - the destination host's address is specified as the destination MAC address <br>  - Recipient's IP address ‚Äî destination host address (in our case, 172.16.4.5) <br><br>  and sent to the network from the FastEthernet0 / 0.102 subinterface, while receiving the label of the 102th vlan. <br><br>  12) A frame is delivered by switches to the destination host. <br><br><a name="Planning"></a><h1>  Expansion planning </h1><br>  Now turn to planning.  In the zero part, we have already touched on this topic, but then it was only about two offices in Moscow, but now the network is growing. <br><br>  It will be like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af4/e44/31d/af4e4431de72d1388f7eb7d969233d1d.png"><br><br>  That is, two points are added in St. Petersburg: a small office on Vasilyevsky Island and the plant itself in Ozerki - and one in Kemerovo in the area of ‚Äã‚ÄãKrasnaya Gorka. <br><br>  For simplicity, we will have one provider ‚ÄúBalagan Telecom‚Äù, which on favorable terms will provide us with L2VPN to both points. <br>  In one of the next issues, we will open the topic of various connection options in colors.  In the meantime, in brief: L2VPN is, very roughly, when the provider provides you with a vlan from point to point (for simplicity, you can imagine that they are included in one switch). <br><br>  A few words should be said about IP addressing and subnetting. <br>  In the zero part, we have already touched upon the issues of planning, I must say very casually. <br>  In general, in any more or less large company there should be a certain regulation - a set of rules, following which you distribute IP addresses everywhere.  Our network is now growing and developing it is very important. <br><br>  Well, for example, let's say that for offices in other cities it will be like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1de/48d/876/1de48d8766ff53a13091cfb61951f2b9.png"><br><br>  This is a very simplified procedure, but now, in any case, we know for sure that the gateway will always have the 1st address, until the 12th we will issue switches and all wi-fi-points, and we will look for all servers in the 172.16.x range .13-172.16..23.  Of course, to your liking you can refine the rules up to the address of each server, add to it the rule for generating device names, domain names, access lists policies, etc. <br>  The more precisely you formulate the rules and the more strictly you will monitor their implementation, the easier it is to understand the network structure, solve problems, adapt to the situation <s>and punish those responsible</s> . <br>  This is approximately like a password memorization scheme: when you have a certain rule of their formation, you do not need to keep in mind several dozen difficult-to-remember passwords, you can always calculate them. <br>  That's the same here.  I once worked in a medium-sized holding and knew that if I came to an office somewhere in a village forgotten by cows, then there exactly xyz1 is a tsiska, xyz2 is a distribution set of the pro-switch, and xyz101 is a computer of the chief accountant from which it is necessary to give access to any contour-extern.  Another question is that it is necessary to check this further, because local ITshniki can sometimes do such a thing that you wash with tears through laughter. <br><blockquote>  It was the case of the boy who decided to manage all the access to the Internet himself (I usually did this on the router).  I installed a proxy server, accidentally raised a NAT on it and tugged the local network traffic there, registering it as a default gateway on all machines, and then I understood for 20 minutes how it works: they all work and we don‚Äôt see them. <br></blockquote><br><br><a name="IP-Plan"></a><h2>  IP plan </h2><br>  Now we would be very helpful to make an IP plan.  We will proceed from the fact that at all three points we will use a standard network with a 24-bit mask (255.255.255.0) This means that there may be 254 devices in them. <br><br>  Why is this so?  And how do you understand all these subnet masks?  In the framework of one article we will not be able to tell this, otherwise it will turn out to be long, like the deck of the Titanic, and tangled, like the Odessa catacombs.  We highly recommend to get acquainted with such concepts as IP-address, subnet mask, their binary representation and CIDR (Classless InterDomain Routing) independently.  We will further only argue the choice of a specific network size.  Anyway, full understanding will come only with practice. <br>  In general, this topic is very well covered in this article: <a href="http://habrahabr.ru/post/129664/">http://habrahabr.ru/post/129664/</a> <br><br><br>  At the moment (recall the <a href="http://habrahabr.ru/blogs/sysadm/134892/">zero issue</a> ) we have used addresses 172.16.0.0-172.16.6.255 in Moscow.  Suppose that the network can still increase here, for example, an office will appear on the Sparrow Hills and reserve another subnet to 172.16.15.0/24 inclusive. <br>  All these addresses: 172.16.0.0-172.16.15.255 - can be described as: 172.16.0.0/20.  This network (with the prefix / 20) will be the so-called <i>supernetwork</i> , and the operation of merging subnetworks in the supernetwork is called <i>summing up</i> subnetworks (summing up routes, to be exact, route summarization) <br><br>  Very intuitive <a href="http://www.ispreview.ru/ipcalc.html">IP calculator</a> .  I occasionally use it even now, although with time comes an intuitive and logical understanding of the correspondence between the mask length and the network boundaries. <br><br>  Now turn to Peter.  At the moment in this beautiful city we have 2 points and on each of them there are subnets / 24.  Let's say it will be 172.16.16.0/24 and 172.16.17.0/24.  We reserve addresses 172.16.18.0-172.16.23.255 for possible network expansion. <br><br>  172.16.16.0-172.16.23.255 can be combined into 172.16.16.0/21 - in general, it is on this basis that we leave this range in reserve. <br><br>  In Kemerovo, it makes no sense for us to keep such huge reserves / 21, as in St. Petersburg (2048 addresses or 8 subnets / 24), or even more / 20, as in Moscow (4096 or 16 subnets / 24).  But 1024 addresses and 4 subnets / 24, which corresponds to the mask / 22 is quite rational. <br><br>  Thus, we will have the network 172.16.24.0/22 ‚Äã‚Äã(addresses 172.16.24.0-172.16.27.255) for Kemerovo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8d7/a14/be3/8d7a14be3f5b96701cabae6b9634fc03.png"><br><br>  One should note here: in general, it is not necessary to make such a reserve, and what we have reserved can be used anywhere in the network.  There is no taboo on this.  However, in large networks, this is exactly what is recommended and this is connected with the amount of information in the routing tables. <br>  You see, the thing is: if you have several consecutive subnets scattered across different ends of the network, then each of them has one entry in the routing table of each router.  If at the same time you suddenly use only static routing, then it is still a tremendous job of setting up and tracking the correctness of the setting. <br>  And if they all go in a row, then you can summarize several small subnets into one large one. <br>  Let us explain by the example of St. Petersburg.  When configuring static routing, we could do this: <br><blockquote>  ip route 172.16.16.0 255.255.255.0 172.16.2.2 <br>  ip route 172.16.17.0 255.255.255.0 172.16.2.2 <br>  ip route 172.16.18.0 255.255.255.0 172.16.2.2 <br>  ‚Ä¶‚Ä¶ <br>  ip route 172.16.23.0 255.255.255.0 172.16.2.2 <br></blockquote><br><br>  These are 8 teams and 8 records in the table.  But at the same time, a packet arriving at the router to any of the 172.16.16.0/21 networks in any case will be sent to the device with the address 172.16.2.2. <br>  Instead, we do this: <br><blockquote>  ip route 172.16.16.0 255.255.248.0 172.16.2.2 <br></blockquote><br>  And instead of eight possible comparisons there will be only one. <br>  For modern devices, neither in terms of processor time nor memory usage is no longer a significant burden, however, such planning is considered to be good tone rules and in the end it‚Äôs easier for you to figure it out. <br>  But, hand on heart, such planning is the exception rather than the rule: one way or another, route fragmentation with the growth of the network is inevitable. <br><br>  Now a few more words about the <i>‚Äúlink‚Äù</i> networks.  In the environment of network administrators, the so-called network point-to-point (Point-to-Point) between the two routers. <br>  Here again in the example of Peter.  Two routers (in Moscow and Petersburg) are connected to each other by a direct link (it doesn't matter that the provider has hundreds of switches and routers - for us it is just a lan).  That is, besides these 2 devices, there will be no others here.  We know that for sure.  In any case, the interfaces of both devices (facing each other) need to be configured with IP addresses.  And we definitely have no reason to assign a network / 24 on this site with 254 available addresses, because 252 in this case will be lost in vain.  In this case, there is a great way out - classless IP addressing. <br><br>  Why is it classless?  If you remember, then in the zero part we talked about three classes of subnetworks: A, B and C. In theory, only you could use them when planning the network.  Classless Inter-Domain Routing ( <a href="http://mannix.ru/poleznoe/besklassovaya-adresaciya-cidr.html">CIDR</a> ) allows for very flexible use of IP address space. <br><br>  We just take the network with the smallest mask possible - 30 (255.255.255.252) - this is a network with 4 addresses.  Why can't we take the network with an even narrower mask?  Well, for obvious reasons, 32 (255.255.255.255) is generally one single address, network 31 (255.255.255.254) is already 2 addresses, but one of them (the first) is the network address, and the second (the last) is a broadcast address.  As a result, we have nothing left for the addresses of the hosts.  Therefore, we take a mask of 30 with 4 addresses and then just 2 addresses remain on our two routers. <br><br>  Generally speaking, the narrowest mask for subnets in cisco is / 31.  Under certain conditions they can be used on PtP links. <br>  As for the mask / 32, such subnets, which are the only one host, are used to assign addresses to Loopback interfaces. <br><br><br>  That is what we will do.  For this, in fact, in the zero part we left the network 172.16.2.0/24 - we will split it into small grids / 30.  In total, they will turn out 64 pieces, respectively, you can assign them to 64 <i>links</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b0/831/9f8/6b08319f866a79765a9024cce7ff69db.png"><br><br>  Here we did the same as in the previous case: we made a small reserve for Peter, and a reserve for Kemerovo.  In general, the reserve is always very good about whatever we say.  ;) <br><br><a name="Principle"></a><h1>  Routing Principles </h1><br><br>  Before starting the configuration, you should decide on what routing is needed at all. <br>  Consider this network: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a4a/cdc/085/a4acdc085b0f89119dd4e1ffc94b7af9.jpg"><br><br>  For example from PC1 - 172.16.3.2 I want to connect via telnet to the L3 switch with the address 172.16.17.1. <br>  How does my computer know what to do?  Where to send data? <br><br>  1) As you already know, if the recipient address is from a different subnet, then the data must be sent to the default gateway. <br><br>  2) According to the scheme already known to you, the computer uses the ARP request to retrieve the MAC address of the router. <br><br>  3) Next, it forms a frame with a packet encapsulated in it and sends it to the port.  After the frame is sent, the computer is already on the drum, what happens to it further. <br><br>  4) At the same time, the frame itself first gets to the switch, where its fate is decided according to the table of MAC addresses.  And then reaches the router RT1. <br><br>  5) Since the router restricts the broadcast domain - here the life of this frame ends.  Tsisk simply discards the header of the data link layer - it is no longer useful - it extracts an IP packet from it. <br><br>  6) Now the router must decide what to do with it next.  Of course, send it to some kind of your own interface.  But which one? <br>  To do this, there is a routing table, which is on any router.  To find out what is currently in our routing table, you can use the <b>show ip route</b> command: <br><blockquote>  172.16.0.0/16 is variably subnetted, 10 subnets, 3 masks <br>  C 172.16.3.0/24 is directly connected, FastEthernet0 / 0.101 <br>  C 172.16.2.0/30 is directly connected, FastEthernet0 / 1.4 <br>  S 172.16.17.0/24 [1/0] via 172.16.2.2 <br></blockquote><br>  Each line in it is a way to get to a particular network. <br>  For example, if a packet is addressed to the network 172.16.17.0/24, then the data must be sent to the device with the address 172.16.2.2. <br>  The routing table is formed from: <br>  - directly connected networks (directly connected) are networks that start directly on it.  In the example 172.16.3.0/24 and 172.16.2.0/30.  In the table, they are denoted by the letter <b>C</b> <br>  - static routes are those that you manually <b>entered using the ip route</b> command.  Denoted by the letter <b>s</b> <br>  - routes obtained using dynamic routing protocols (OSPF, EIGRP, RIP, and others). <br><br>  7) So, the data to the network 172.16.17.0 (and we want to connect to the device 172.16.17.1) should be sent to the next hop - the next hop, which is the router 172.16.2.2.  Moreover, from the routing table it can be seen that the next hop is located behind the interface FE0 / 1.4 (subnet 172.16.2.0/30). <br><br>  8) If there is no MAC address in the ARP cache of the tsiska, then you need to run the ARP request again to find out the MAC address of the device with the IP address 172.16.2.2.  RT1 sends a broadcast frame from port FE0 / 1.4.  In this broadcast domain we have two devices, and accordingly only one recipient.  RT2 receives an ARP request, discards the Ethernet header and, realizing from the ARP protocol data that the address it belongs to, sends an ARP reply with its MAC address. <br><br>  9) The initial IP packet arriving at RT1 <b>does not change</b> , it is encapsulated in a <b>completely new frame</b> and sent to port FE0 / 1.4, while receiving the label of the 4th vlan. <br><br>  10) Completely similar actions occur on the next router.  And on the next and next (if they were), until the packet reaches the last one, to which the necessary network is connected. <br><br> 11)   ,      ,     , ,         . <br><br>                     .  ,           ‚Äî      . <br><br><a name="Configuration"></a><h1>  </h1><br>      ?     ,         -.     ,      .        L2VPN,           ,       . <br>  ,            ,        .   ,     , , 2912  754.  ,   ,      . <br><br><a name="Arbat"></a><h3>  Moscow.  </h3><br>        ,   ‚Äî FE0/0 ‚Äî     ,   (FE0/1)           . <br>       -.   -   4  5-  . IP-    IP-. <br><blockquote> msk-arbat-gw1(config)#interface FastEthernet 0/1.4 <br> msk-arbat-gw1(config-subif)#description Saint-Petersburg <br> msk-arbat-gw1(config-subif)#encapsulation dot1Q 4 <br> msk-arbat-gw1(config-subif)#ip address 172.16.2.1 255.255.255.252 <br><br> msk-arbat-gw1(config)#interface FastEthernet 0/1.5 <br> msk-arbat-gw1(config-subif)#description Kemerovo <br> msk-arbat-gw1(config-subif)#encapsulation dot1Q 5 <br> msk-arbat-gw1(config-subif)#ip address 172.16.2.17 255.255.255.252 <br></blockquote><br><br><a name="Provider"></a><h3>  </h3><br> ,       .     ,              . <br><br>   :                  .    <u></u> ,    3      ‚Äî     ,    MPLS-   . <br><br>  ‚Äú ‚Äù: <br><blockquote> Switch(config)#vlan 4 <br> Switch(config-vlan)#vlan 5 <br> Switch(config)#interface fa0/1 <br> Switch(config-if)#switchport mode trunk <br> Switch(config-if)#switchport trunk allowed vlan 4-5 <br> Switch(config-if)#exit <br> Switch(config)#int fa0/2 <br> Switch(config-if)#switchport trunk allowed vlan 4 <br> Switch(config-if)#int fa0/3 <br> Switch(config-if)#switchport trunk allowed vlan 5 <br></blockquote><br><br><a name="vsl"></a><h3>  St. Petersburg.  Vasilyevsky Island </h3><br>     spb-vsl-gw1.     2 ,      :   .    FastEthernet-     WIC  . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/012/8f2/8aa/0128f28aace6bd81d06bdd574f5920d2.png"><br><br>       ,             . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b7/d35/12c/7b7d3512c7cdcb8d96e64ffc80b1b152.png"><br><br>            . <br> FastEthernet ‚Äî    (Ethernet, Fastethernet, GigabitEthernet, POS, Serial  ) <br> x/y/zw=Slot/Sub-slot/Interface.Sub-interface. <br><br>         ‚Äî   ,   .  ,         . <br>     ,       : <br><blockquote> spb-vsl-gw1(config)interface FastEthernet1/0.4 <br> spb-vsl-gw1(config-if)description Moscow <br> spb-vsl-gw1(config-if)encapsulation dot1Q 4 <br> spb-vsl-gw1(config-if)ip address 172.16.2.2 255.255.255.252 <br></blockquote><br>    : <br><blockquote> spb-vsl-gw1(config)#int fa0/0 <br> spb-vsl-gw1(config-if)#description LAN <br> spb-vsl-gw1(config-if)#ip address 172.16.16.1 255.255.255.0 <br></blockquote><br><br>   .  msk-arbat-gw1     172.16.2.2: <br><blockquote> msk-arbat-gw1#ping 172.16.2.2 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.2.2, timeout is 2 seconds: <br>  !!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 2/7/13 ms <br></blockquote><br>      172.16.16.1: <br><blockquote> msk-arbat-gw1#ping 172.16.16.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.16.1, timeout is 2 seconds: <br>  ... <br> Success rate is 0 percent (0/5) <br></blockquote><br>  ,     ,   : <br><blockquote> msk-arbat-gw1#sh ip route <br><br> Gateway of last resort is not set <br><br> 172.16.0.0/16 is variably subnetted, 8 subnets, 2 masks <br> C 172.16.0.0/24 is directly connected, FastEthernet0/0.3 <br> C 172.16.1.0/24 is directly connected, FastEthernet0/0.2 <br> C 172.16.2.0/30 is directly connected, FastEthernet0/1.4 <br> C 172.16.3.0/24 is directly connected, FastEthernet0/0.101 <br> C 172.16.4.0/24 is directly connected, FastEthernet0/0.102 <br> C 172.16.5.0/24 is directly connected, FastEthernet0/0.103 <br> C 172.16.6.0/24 is directly connected, FastEthernet0/0.104 <br></blockquote><br>   : <br><blockquote> msk-arbat-gw1(config)#ip route 172.16.16.0 255.255.255.0 172.16.2.2 <br><br> msk-arbat-gw1#sh ip route <br> Codes: C ‚Äî connected, S ‚Äî static, I ‚Äî IGRP, R ‚Äî RIP, M ‚Äî mobile, B ‚Äî BGP <br> D ‚Äî EIGRP, EX ‚Äî EIGRP external, O ‚Äî OSPF, IA ‚Äî OSPF inter area <br> N1 ‚Äî OSPF NSSA external type 1, N2 ‚Äî OSPF NSSA external type 2 <br> E1 ‚Äî OSPF external type 1, E2 ‚Äî OSPF external type 2, E ‚Äî EGP <br> i ‚Äî IS-IS, L1 ‚Äî IS-IS level-1, L2 ‚Äî IS-IS level-2, ia ‚Äî IS-IS inter area <br> * ‚Äî candidate default, U ‚Äî per-user static route, o ‚Äî ODR <br> P ‚Äî periodic downloaded static route <br><br> Gateway of last resort is not set <br><br> 172.16.0.0/16 is variably subnetted, 9 subnets, 2 masks <br> C 172.16.0.0/24 is directly connected, FastEthernet0/0.3 <br> C 172.16.1.0/24 is directly connected, FastEthernet0/0.2 <br> C 172.16.2.0/30 is directly connected, FastEthernet0/1.4 <br> C 172.16.2.16/30 is directly connected, FastEthernet0/1.5 <br> C 172.16.3.0/24 is directly connected, FastEthernet0/0.101 <br> C 172.16.4.0/24 is directly connected, FastEthernet0/0.102 <br> C 172.16.5.0/24 is directly connected, FastEthernet0/0.103 <br> C 172.16.6.0/24 is directly connected, FastEthernet0/0.104 <br> S 172.16.16.0/24 [1/0] via 172.16.2.2 <br></blockquote><br>   : <br><blockquote> msk-arbat-gw1#ping 172.16.16.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.16.1, timeout is 2 seconds: <br>  !!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 4/10/24 ms <br></blockquote><br> ,    ‚Äî ,     : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/486/8b5/785/4868b578505d9807fa7c4c4f46964488.png"><br><br>   ?! <br>  ,    ‚Äî    172.16.3.1,    ‚Äî   172.16.2.2.   ,  spb-vsl-gw1,  ,    172.16.16.1  .        172.16.3.3,    172.16.3.0    .  ,    ,   ‚Äî . <br><blockquote> spb-vsl-gw1#sh ip route <br><br> Gateway of last resort is not set <br><br> 172.16.0.0/16 is variably subnetted, 2 subnets, 2 masks <br> C 172.16.2.0/30 is directly connected, FastEthernet1/0.4 <br> C 172.16.16.0/24 is directly connected, FastEthernet0/0 <br></blockquote><br><br> ,  ,  ,  msk-arbat-gw1  172.16.16.1  ?   172.16.3.1  172.16.3.2?  It's simple. <br>     ,    ‚Äî 172.16.2.2,     172.16.2.1    ,         IP- ,   172.16.3.1.    spb-vsl-gw1,   ,    ,   echo-reply.    IP-,       172.16.2.1,  172.16.2.0/30 ‚Äî    spb-vsl-gw1 ,       .     172.16.2.0/30  ,   172.16.3.0/24 . <br><br>         spb-vsl-gw1    172.16.3.0,         .     ,   ,     ‚Äî    . <br>    ,           ‚Äî  .    ‚Äî ,   .          ,         . <br>     ?    ‚Äî   ,       ‚Äî  .    .   ,   ,      ,     ,   ‚Äî         ,   ,       ‚Äî   ,         .     ,    ‚Äî   . <br>   : <br><blockquote> spb-vsl-gw1(config)#ip route 0.0.0.0 0.0.0.0 172.16.2.1 <br></blockquote><br>   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/558/0df/9ef/5580df9ef237a1345041528a126be8b1.png"><br><br>            ,         . <br><br><a name="ozerki"></a><h3>  St. Petersburg.  Lakes </h3><br>   .    L3-. ,          (,      ,    ). <br>         . -,           ,    .  ,  L3-    ,  L2-    . ,      , .      . <br><br>     ,  : <br><blockquote> spb-vsl-gw1(config)interface fa1/1 <br> spb-vsl-gw1(config-if)#description Ozerki <br> spb-vsl-gw1(config-if)#ip address 172.16.2.5 255.255.255.252 <br></blockquote><br>        172.16.17.0/24,      : <br><blockquote> spb-vsl-gw1(config)#ip route 172.16.17.0 255.255.255.0 172.16.2.6 <br></blockquote><br>      ,         ‚Äî 172.16.2.6 <br><br>     : <br><br>       fa1/1       24-  3560  . <br>     L3-    L2,     ‚Äú‚Äù ,      .         L3-,   .       IP-: <br><blockquote> Switch(config)#hostname spb-ozerki-gw1 <br> spb-ozerki-gw1(config)#interface fa0/24 <br> spb-ozerki-gw1(config-if)#no switchport <br> spb-ozerki-gw1(config-if)#ip address 172.16.2.6 255.255.255.252 <br></blockquote><br>  : <br><blockquote> spb-ozerki-gw1#ping 172.16.2.5 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.2.5, timeout is 2 seconds: <br> .!!! <br> Success rate is 80 percent (4/5), round-trip min/avg/max = 1/18/61 ms <br></blockquote><br>    . ,  Cisco           1- , ,   2-: <br><blockquote> spb-ozerki-gw1(config)#vlan 2 <br> spb-ozerki-gw1(config-vlan)#name LAN <br> spb-ozerki-gw1(config-vlan)#exit <br> spb-ozerki-gw1(config)#interface vlan 2 <br> spb-ozerki-gw1(config-if)#description LAN <br> spb-ozerki-gw1(config-if)#ip address 172.16.17.1 255.255.255.0 <br> spb-ozerki-gw1(config)#interface fastEthernet 0/1 <br> spb-ozerki-gw1(config-if)#description Pupkin <br> spb-ozerki-gw1(config-if)#switchport mode access <br> spb-ozerki-gw1(config-if)#switchport access vlan 2 <br></blockquote><br>           172.16.17.1 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/970/6b3/068/9706b3068ba251876e96ff605a784c45.png"><br><br>       ,     : <br><blockquote> spb-ozerki-gw1(config)#ip routing <br></blockquote><br>      . <br><br>   ,        : <br><blockquote> spb-ozerki-gw1(config)#ip route 0.0.0.0 0.0.0.0 172.16.2.5 <br></blockquote><br>   spb-vsl-gw1 : <br><blockquote> spb-ozerki-gw1#ping 172.16.16.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.16.1, timeout is 2 seconds: <br>  !!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 3/50/234 ms <br></blockquote><br><br>    : <br><blockquote> spb-ozerki-gw1#ping 172.16.3.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.3.1, timeout is 2 seconds: <br>  ... <br> Success rate is 0 percent (0/5) <br></blockquote><br>      .          traceroute: <br><blockquote> spb-ozerki-gw1#traceroute 172.16.3.1 <br>  Type escape sequence to abort. <br> Tracing the route to 172.16.3.1 <br><br> 1 172.16.2.5 4 msec 2 msec 5 msec <br>  2 * * * <br> 3 * * * <br> 4 * <br></blockquote><br>  ,   spb-vsl-gw1  ,   .  ,  ,       172.16.2.5       (,        ,  )      : <br><blockquote> msk-arbat-gw1#sh ip rou <br><br> Gateway of last resort is not set <br><br> 172.16.0.0/16 is variably subnetted, 9 subnets, 2 masks <br> C 172.16.0.0/24 is directly connected, FastEthernet0/0.3 <br> C 172.16.1.0/24 is directly connected, FastEthernet0/0.2 <br> C 172.16.2.0/30 is directly connected, FastEthernet0/1.4 <br> C 172.16.2.16/30 is directly connected, FastEthernet0/1.5 <br> C 172.16.3.0/24 is directly connected, FastEthernet0/0.101 <br> C 172.16.4.0/24 is directly connected, FastEthernet0/0.102 <br> C 172.16.5.0/24 is directly connected, FastEthernet0/0.103 <br> C 172.16.6.0/24 is directly connected, FastEthernet0/0.104 <br> S 172.16.16.0/24 [1/0] via 172.16.2.2 <br></blockquote><br>     172.16.17.0/24 .    ,    ,   ,    172.16.16.0/21    ,   ,         ,    : <br><blockquote> msk-arbat-gw1(config)#no ip route 172.16.16.0 255.255.255.0 172.16.2.2 <br> msk-arbat-gw1(config)#ip route 172.16.16.0 255.255.248.0 172.16.2.2 <br></blockquote><br><br>  Checking: <br><blockquote> msk-arbat-gw1#ping 172.16.17.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.17.1, timeout is 2 seconds: <br>  !!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 4/10/18 ms <br></blockquote><br><br>        ,   spb-ozerki-gw1     -: <br><blockquote> spb-ozerki-gw1#ping 172.16.3.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.3.1, timeout is 2 seconds: <br>  ... <br> Success rate is 0 percent (0/5) <br></blockquote><br>   ,    -   172.16.17.1: <br><blockquote> spb-ozerki-gw1#ping <br> Protocol [ip]: <br> Target IP address: 172.16.3.1 <br> Repeat count [5]: <br> Datagram size [100]: <br> Timeout in seconds [2]: <br> Extended commands [n]: y <br> Source address or interface: ping172.16.17.1 <br> % Invalid source <br> Source address or interface: 172.16.17.1 <br> Type of service [0]: <br> Set DF bit in IP header? [no]: <br> Validate reply data? [no]: <br> Data pattern [0xABCD]: <br> Loose, Strict, Record, Timestamp, Verbose[none]: <br> Sweep range of sizes [n]: <br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.3.1, timeout is 2 seconds: <br> Packet sent with a source address of 172.16.17.1 <br>  !!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 5/9/14 ms <br></blockquote><br>     172.16.17.26  : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edb/460/e0b/edb460e0b523d0efd2b798849795b45b.png"><br><br>  How so? ,   ,    ‚Äî   . <br><br>   ,  msk-arbat-gw1   172.16.17.0/24 ,   172.16.2.4/30 .    172.16.2.6 ‚Äî      ( ,    IP-)      .     . <br><blockquote> msk-arbat-gw1(config)#ip route 172.16.2.4 255.255.255.252 172.16.2.2 <br><br> spb-ozerki-gw1#ping 172.16.3.1 <br><br>  Type escape sequence to abort. <br> Sending 5, 100-byte ICMP Echos to 172.16.3.1, timeout is 2 seconds: <br>  !!! <br> Success rate is 100 percent (5/5), round-trip min/avg/max = 7/62/269 ms <br></blockquote><br>   :             172.16.3.0/24   ,    ?    .     ? <br><blockquote> spb-vsl-gw1(config)#ip route 172.16.3.0 255.255.255.0 172.16.2.6 <br></blockquote><br><br>      , -,       .  172.16.3.0/24  172.16.16.0/21     : <br>    spb-ozerki-gw1   172.16.3.0      spb-vsl-gw1,  : ‚Äú172.16.3.0/24   172.16.2.6‚Äù,    spb-ozerki-gw1,  : ‚Äú172.16.3.0/24   172.16.2.5‚Äù   .    -,       TTL. <br>   ,       TTL  IP-,    255,   1.    ,     0,   <i></i> ,  ,  ,  . <br>      ‚Äî         ,      . <br> ,  Ethernet       ,      ,    ,    ‚Äî     (      \ STP-     ). <br><br>  ,       172.16.17.0   172.16.3.1,   IP-     ,      ,           254 . <br> ,       ,      ,     255 .       .       -  . <br><br><a name="kmr"></a><h3> .   </h3><br>     ‚Äî    (router on a stick). <br><br>    : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ca/aad/1f6/9caaad1f64b0a24c5c0abfc4ad0e74e7.png"><br><br>                  ,  .  ,  ,    (          ). <br><br>   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f58/e8e/aa1/f58e8eaa142cfb46e070b2871037a9b9.png"><br><br>         .  UpLink-     5-  : <br><blockquote> Switch(config)#hostname kmr-gorka-sw1 <br> kmr-gorka-sw1(config)#vlan 5 <br> kmr-gorka-sw1(config-vlan)#name Moscow <br><br> kmr-gorka-sw1(config)#int fa0/24 <br> kmr-gorka-sw1(config-if)#description Moscow <br> kmr-gorka-sw1(config-if)#switchport mode trunk <br> kmr-gorka-sw1(config-if)#switchport trunk allowed vlan 5 <br></blockquote><br>        vlan 2   ,           ‚Äî         ,    .    :    , , 2- ,         ,       . <br><blockquote> kmr-gorka-sw1(config)#vlan 2 <br> kmr-gorka-sw1(config-vlan)#name LAN <br> kmr-gorka-sw1(config)#int fa0/1 <br> kmr-gorka-sw1(config-if)#description syn_generalnogo <br> kmr-gorka-sw1(config-if)#switchport mode access <br> kmr-gorka-sw1(config-if)#switchport access vlan 2 <br></blockquote><br><br>    ,  5-      ,  2- ‚Äî . <br><blockquote> kmr-gorka-sw1(config)#int fa0/23 <br> kmr-gorka-sw1(config-if)#description kmr-gorka-gw1 <br> kmr-gorka-sw1(config-if)#switchport mode trunk <br> kmr-gorka-sw1(config-if)#switchport trunk allowed vlan 2,5 <br></blockquote><br><br>  : <br><blockquote> Router(config)#hostname kmr-gorka-gw1 <br> kmr-gorka-gw1(config)#int fa0/0.5 <br> kmr-gorka-gw1(config-subif)#description Moscow <br> kmr-gorka-gw1(config-subif)#encapsulation dot1Q 5 <br> kmr-gorka-gw1(config-subif)#ip address 172.16.2.18 255.255.255.252 <br><br> kmr-gorka-gw1(config)#int fa0/0 <br> kmr-gorka-gw1(config-if)#no sh <br><br> kmr-gorka-gw1(config)#int fa0/0.2 <br> kmr-gorka-gw1(config-subif)#description LAN <br> kmr-gorka-gw1(config-subif)#encapsulation dot1Q 2 <br> kmr-gorka-gw1(config-subif)#ip address 172.16.24.1 255.255.255.0 <br></blockquote><br><br> ,            . <br><br><a name="annex"></a><h1>  Additionally </h1><br>  ,             : <br><blockquote> traceroute <br></blockquote><br>  and <br><blockquote> show ip route <br></blockquote><br>    ,   ,   .      , : <br><blockquote> msk-arbat-gw1#sh ip route 172.16.17.0 <br> Routing entry for 172.16.16.0/21 <br> Known via ¬´static¬ª, distance 1, metric 0 <br> Routing Descriptor Blocks: <br> * 172.16.2.2 <br> Route metric is 0, traffic share count is 1 <br></blockquote><br>  Although there is no separate entry in the routing table for subnet 172.16.17.0, the router will show you which next hop. <br><br>  And I would also like to repeat the most important things: <br><br>  - When a data block hits the router, the Ethernet header is completely discarded and a completely new frame is formed when sending.  But the IP packet remains unchanged. <br><br>  - Each router in the case of static routing decides on the fate of the packet solely on its own and does not know anything about other people's tables. <br><br>  - The search in the table does NOT go to the first matching entry, but until the most exact match is found (the narrowest mask).  For example, if your routing table looks like this: <br><blockquote>  172.16.0.0/16 is variably subnetted, 6 subnets, 3 masks <br>  S 172.16.0.0/16 [1/0] via 172.16.2.22 <br>  C 172.16.2.20/30 is directly connected, FastEthernet0 / 0 <br>  C 172.16.2.24/30 is directly connected, FastEthernet0 / 0.2 <br>  C 172.16.2.28/30 is directly connected, FastEthernet0 / 0.3 <br>  S 172.16.10.0/24 [1/0] via 172.16.2.26 <br>  S 172.16.10.4/30 [1/0] via 172.16.2.30 <br></blockquote><br>  And you transfer the data to 172.16.10.5, it will not follow the route through 172.16.2.22 or 172.16.2.26, but will choose the narrowest mask (the longest) / 30 through 172.16.2.30. <br><br>  - If no record in the routing table matches the recipient's IP address and the default route is not configured (gateway of last resort), the packet will simply be dropped. <br><br>  At this first acquaintance with the routing can be completed.  It seems to us that the reader himself sees how many difficulties await him here, can suggest how much work he will have if the network grows to several dozen routers.  But it must be said that in the modern world static routing is not something that is not used, of course, there is room for it, but in the vast majority of networks that are larger than the district pioneer net, dynamic routing protocols are implemented.  Among them are OSPF, EIGRP, IS-IS, RIP, to which we will dedicate a separate release and, most likely, not one.  But setting up static routing greatly helps your overall understanding of routing. <br><br>  As an independent task, try setting up routing between Moscow and Kemerovo and answering the question why devices do not respond from the control network. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/d48/23c/082d4823c9eea0ff4aefa3ba51febf8d.png"><a name="materials"></a><h1>  Release materials </h1><br>  <a href="https://docs.google.com/spreadsheet/ccc%3Fkey%3D0AooexOHebRpTdHgxWTZtbWNrT3JkR3NmX2pBZ25xTGc">New IP plan, switching plans for each point and time limit</a> <br>  <a href="">RT file with lab</a> <br>  <a href="https://docs.google.com/document/d/1fzWkfA8cQiDocK6yBKTRVtpwxyuM330L5PR9lB8wnZ0/edit">Device configuration</a> <br><br>  We apologize for the giant sheets, the video, too, is getting longer and more unbearable each time.  Next time we will try to be more compact. <br><br>  All interested, but unregistered are invited to talk in the <a href="http://eucariot.livejournal.com/62941.html">LiveJournal</a> . <br>  For the preparation of the article, many thanks to my co-author of <a href="https://habrahabr.ru/users/thegluck/" class="user_link">thegluck</a> and my wife for the lion's patience. <br><br>
<h6><pre> <code class="bash hljs">  :    ,         ,       .         ,  ,  .        ,     .  ,   ,        .</code> </pre> </h6></div><p>Source: <a href="https://habr.com/ru/post/140552/">https://habr.com/ru/post/140552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140546/index.html">Webinar: Where does automation start?</a></li>
<li><a href="../140547/index.html">Are the sites of Biglion and Amazon twins?</a></li>
<li><a href="../140548/index.html">Russia joins ISOC</a></li>
<li><a href="../140549/index.html">Pricing strategies for new gTLDs</a></li>
<li><a href="../140551/index.html">Manual PaintCAD Graphic Editor</a></li>
<li><a href="../140554/index.html">Manage wheelchair and PC using language</a></li>
<li><a href="../140555/index.html">Recommended Systems: SVD and Basic Predictors</a></li>
<li><a href="../140556/index.html">Was the economy littered? Let's defragment it!</a></li>
<li><a href="../140557/index.html">GCC-4.7 release</a></li>
<li><a href="../140559/index.html">Reserved domains in the zone. XXX receive 1.3 million hits per day</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>