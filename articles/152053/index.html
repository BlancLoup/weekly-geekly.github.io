<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Black Box vs White Box in system administration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to draw the attention of fellow system administrators, as well as those who hire them, to two diametrically opposed approaches to system ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Black Box vs White Box in system administration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/3bf/a4d/298/3bfa4d29875539367d992aa8857fa088.jpg" alt="image"><br><br>  I would like to draw the attention of fellow system administrators, as well as those who hire them, to two diametrically opposed approaches to system administration.  It seems to me that understanding the difference between these approaches can significantly reduce the mutual disappointment of both parties. <br><br>  It seems to be nothing new, but in the almost 15 years that I have been associated with this topic, I have witnessed so many times problems, misunderstandings and even conflicts related to misunderstanding or unwillingness to understand the difference between these two approaches, it seems that it‚Äôs worth raising the topic once again .  If you are a sysadmin and at work you are not at ease or if you are a manager who hires a sysadmin - perhaps this article is for you. <br><a name="habracut"></a><br>  <b>I will deliberately exaggerate a little in order to make the difference a little more visual.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Black Box Administration </h5><br>  Under <b>Black Box</b> administration (analogy with a black opaque tightly closed box, with buttons and light bulbs) I understand the situation when there is a certain system, there are instructions for its operation, some set of tricks, questions and answers in Google.  But there is no information about how the system works; we don‚Äôt know (or don‚Äôt want to know) what is inside of it, how it works, what is inside with what and how it interacts.  Yes, it does not matter: if it is operated in regular conditions, we just know how to use it and what to expect.  A set of commands / actions leading to the results we need is described in advance and it does not matter to us how the system does it, we just ‚Äúorder‚Äù and get the result.  Or, if figuratively, it is described in advance (or found by typing, that is, by experiment), which button should be pressed in order for the desired combination of light bulbs to light up. <br><br>  Accordingly, administration in this case is reduced, firstly, to the support of standard operating conditions under which the system behaves as specified, and, secondly, to ‚Äúpressing the right buttons‚Äù at the request of clients / users.  This is done strictly according to the well-known knowledge of which button turns on a light bulb, variations are not only unwelcome, but even contraindicated, because the other way can give unexpected side effects, bring the system out of normal mode to a state that is not described in the documentation, and then do to fix the situation - is unknown. <br><br>  If something went wrong and the system stopped working as it should, the first thing to be done is finding what is wrong with the operating conditions, what is different from how it was when it worked and how to get it back, how to ‚Äúput out all the lights‚Äù and return the system in the original state of the state.  If this does not help, google the ‚Äúsecret combinations of buttons‚Äù from the experts and try them all in a row to decrease the similarity of the described situation until the cherished light comes on or the system returns to the state known to us.  If this does not help - a dead end.  Either rollback to backups, or contact support (if the system has one) or replace (reinstall) the system. <br><br>  It is worth noting that there is a certain number of systems for which such an approach is the only possible one.  For example, in cases when the device of the system is a commercial secret of its manufacturer and the possibility of studying its device is strongly limited by contractual obligations and the internal rules of the company.  Or in the case of huge complex systems with complex internal relationships, the support of different components of which is carried out by different departments that do not have access to information and have no right to do anything outside their area of ‚Äã‚Äãresponsibility.  In addition, there are many cases where this approach is simply more appropriate.  For example, Windu is often easier to reinstall than to understand what's broken in its depths. <br><br><h5>  White box </h5><br>  Accordingly, <b>White Box</b> is when the box is transparent.  We have the opportunity to see (and also understand) how the system works.  In this scenario, the instruction is secondary, it allows you to understand how the system is supposed to be used and how it is arranged, but does not limit us to this.  There is an understanding of how the system works and, as a result, how it will behave in different conditions, including those not described in the documentation. <br><br>  After <b>some time has been spent studying the</b> system, there is an understanding why it is necessary to press the buttons in exactly this sequence and why the system should be operated in such conditions.  The same actions can be done in different ways, if this leads to the desired result, because we can predict possible side effects in advance, and therefore we can choose the most effective way for the current task.  If something went wrong - we can see what it was and how it broke, which gear it wedged.  We can consciously return the system to its original state or change that and only that factor that prevents the system from working normally.  That is, to move from the internal state and needs of the system, and not from the available documentation / experience. <br><br>  In this situation, the ability to solve problems increases many times, the ‚Äúdeadlock‚Äù is reached much longer and less, the system can be operated more fully and flexibly, more efficiently.  But, this approach requires mastering, digesting and keeping in the head an order of magnitude greater amount of information, which is much longer and more difficult. <br><br>  This approach is also the only available.  For example, when the system is an internal development of a company that is constantly in development, changing, supplementing.  Therefore, no one knows what to expect from it, and the documentation is often missing.  In this case, situations will regularly appear that it is simply impossible to solve in a reasonable time without understanding how the system is arranged and not being able to ‚Äúdig into its gears‚Äù. <br><br><h5>  The essence of the problem </h5><br>  From my personal experience, I can say that most system administrators feel more comfortable (and also more efficient) in one of these two approaches, and, accordingly, not at ease when there is a need to work within the other part most of the time. approach. <br><br>  Consider both options on a real (slightly <b>simplified</b> , so as not to waste time on insignificant but time-consuming details) life example. <br><br>  A certain site works on 2 8-core machines with 8 GB of memory.  Apache2 + PHP + MySQL + memcache.  During peak hours, the system periodically began to slow down terribly and the site itself responded with delays of 10-30 seconds or did not respond at all. <br><br><h6>  To begin with, the problem was considered on the Black Box approach. </h6><br>  On both servers, the top command showed that there is almost no free memory, load average is around 20, swap is actively used and the system does not crawl out of iowait.  Restarting apache returned everything to normal.  After that, apron was restarted to cron once an hour and safely forgot about the problem for another six months ... <br><br>  What exactly happened and why it happened - the rest is unknown, the actual problem was ‚Äúthe site slows down and does not open‚Äù, the problem is solved, the site no longer slows down.  Diagnostics - 3 minutes, the solution - another 5 minutes.  That is, in less than 10 minutes, the problem was resolved, knowing almost nothing about why the problem appeared.  There is no certainty that this will help for a long time and that this is generally a solution, but (!) <b>10 minutes and in fact the site works again</b> without problems for almost half a year. <br><br>  After six months, the problem began to appear again despite the hourly restart of the Apache.  They began to reduce the restart of the restart, complaints began to appear that the connection to the site sometimes just breaks off, the page turns out to be underloaded.  That is, the solution itself began to create new problems. <br><br><h6>  Further, the same system began to be considered in more detail.  Like White Box. </h6><br>  I will omit the details of the process, as a result of which the system was studied almost under a microscope, I will immediately dwell on the conclusions.  It revealed: <br><ul><li>  Different requests to the server take up a very different amount of memory, there is a small number of requests that eat up to 200 megabytes, but the main mass consumes no more than 5-10.  At the same time, php memory frees, but apache does not free memory within one child, it keeps with itself, so that if needed it already exists.  As a result, we get that sooner or later at least one heavy request will pass through each child, as a result of which the Apache will ‚Äúsave up‚Äù memory for the future much more than most subsequent requests will need. </li><li>  The number of ‚Äúbabies‚Äù of the Apache is quite a large 250 pieces, which, with their smooth ‚Äúfattening‚Äù up to 200MB, smoothly but inevitably leads to the consumption of memory much more than is available in the system.  The system starts to swap, everything starts to work slower, requests are processed more slowly, and they do the same, which leads to a greater number of simultaneous requests, which leads to the fact that all 250 Apache kids are actively involved and have a queue of requests and all are actively ‚Äúfattening‚Äù and swapping . </li><li>  In addition, this growing snowball was somewhat accelerated by a certain amount of long-polling requests constantly hanging on the background and, as a result, keeping additional Apache‚Äôs children busy, which didn‚Äôt allow the Apache‚Äôs unnecessary processes to complete due to ‚Äútoo many unused children‚Äù. </li></ul><br>  The solution was as follows (taking into account the specifics of the project, which is not described here): <br><br><ul><li>  they put nginx at the entrance, it doesn‚Äôt get fat on the number of requests and the queue. </li><li>  Nginx, by the match url, sent heavy requests to a separate apache instance with mod-fpm, thereby eliminating the problem of ‚Äúlocked up‚Äù memory at the root, allowing a maximum of 25 parallel processes and only 5 spare processes (max spare childs). </li><li>  The ‚Äúlight‚Äù requests went to the usual apache, which stopped ‚Äúgetting fat‚Äù, but just in case, they still put a maximum of 1000 requests on the child, so that if something suddenly happened, it would still be released from time to time. </li><li>  Long polling, with the support of programmers, generally sent a small server node.js which for every client proxy requests to the Apache every second, after looking at whether there is a flag about ‚Äúfresh data‚Äù in memcache and ‚Äúskipping con‚Äù if nothing fresh appeared.  These requests are very light, for Apache, they are no longer long-polling and occur only when there really is new data - these query requests fly by in microseconds and are not even noticeable, practically do not occupy apache-children. </li><li>  In addition (thanks to pinba), the scripts themselves were slightly corrected, some of them after that began to eat less and work faster. </li></ul><br>  As a result, during peak hours, no more than 25-30 light Apaches are working at the same time, 5-10 heavier individual php through mod_fpm, node.js moves a little, occupying no more than 2-5 apache processes simultaneously on its micro queries.  Nginx queue, if suddenly formed, keeps it lightly without straining, while the processor consumes almost nothing, because it does nothing, only proxies and, thanks to its architecture, with the maintenance of several hundred simultaneous sessions, has no difficulties at all.  In addition, nginx buffers the responses of Apache and already slowly slowly gives them to the client, which allows apache to get rid of the request faster. <br><br>  As a result, the average load average on the servers in the ‚Äúrush hour‚Äù walks around 0.2-0.5.  Memory consumption is about 2-3GB for all processes.  The remaining memory is cache.  Swap is not used.  The response time now does not change at rush hour and has become approximately equal to the same as in quiet time (when there are only 2-3 clients on the site). <br>  The number of clients that the site can serve without having problems with the load has increased by about 10 times (then already begin the difficulties with the database). <br><br>  That is, the problem is solved again, but this time with a huge margin and clearly knowing what to expect and how long it will work without problems.  Everything is reasonable, thoughtful, balanced.  <b>Solution time - 2 weeks ...</b> <br><br><h5>  Results </h5><br>  At the risk of getting the title of ‚ÄúCaptain of Evidence‚Äù, I will move on to the consequences of such a ‚Äúseparation‚Äù: <br><br><ol><li>  It is necessary to estimate what type of system should be serviced at your company before selecting a sysadmin.  Black-Box-guru in the case of complex self-made ever-changing systems is unlikely to be as useful as a white-box-guru, and is unlikely to be satisfied with its work.  White-box-guru in the case of stable, well-established systems that it is undesirable to ‚Äúclimb inside‚Äù will not find a place at all and most likely will work only formally, doing all their free time with their own personal projects and experiments.  Well, or will constantly try to "redo everything here correctly, and not as it is now." </li><li>  A sysadmin should ‚Äúunderstand himself‚Äù, which approach is closer to his heart, and choose a job with this understanding in mind. </li><li>  Black-box-guru solves problems very quickly, just as quickly able to take on maintenance new well-documented and widely used systems.  Results are stable and predictable.  He prefers to solve problems in the same type and predictably (and often this is a huge plus, especially when working in a team), but not always optimally. </li><li>  White-box-guru spends considerable time studying the system, but then it gives much more efficient solutions.  Able to solve more complex tasks and those for which the ‚Äúdeadlock‚Äù state of the black-box-guru has come, but not so quickly and not so much.  At the same time, it is practically useless at fast ‚Äúextinguishing fires‚Äù, because instead of just restarting quickly, apache will consider what is happening ‚Äúhot on the heels‚Äù and study the state of the system in its unhealthy state ‚Äúwhile it‚Äôs visible‚Äù. </li><li>  A large company cannot do without a team with admins of both types: while one quickly ‚Äúextinguishes the fire‚Äù, that is, they make the system work at least somehow, others calmly understand the roots of the problems and make them never repeat.  And these second ones should not be forced to do what the first is doing well, and vice versa - nothing good will come of it. </li><li>  The most valuable, but also the rarest shots are those who can work successfully on both approaches, but they also prefer (more comfortable) one more approach. </li></ol><br><br>  When choosing a worker or job, remember these few points and you may save time, money and nerves.  That's probably all on this topic.  Thanks to those who read it.  :) </div><p>Source: <a href="https://habr.com/ru/post/152053/">https://habr.com/ru/post/152053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152047/index.html">What sports do you do, habrauzer?</a></li>
<li><a href="../152048/index.html">JavaScript - useful materials</a></li>
<li><a href="../152050/index.html">How it's assembed - Robotic machine. Step one</a></li>
<li><a href="../152051/index.html">Bundle Transformer 1.6.2 released or what has changed in six months?</a></li>
<li><a href="../152052/index.html">Manually flash AVR</a></li>
<li><a href="../152055/index.html">How to improve the look of 3 good old articles in the footer?</a></li>
<li><a href="../152056/index.html">Breaking the BIOS: Enable VT-x Virtualization Support on Acer Aspire One Netbook</a></li>
<li><a href="../152058/index.html">Dark prospects for the development of Russian Internet censorship</a></li>
<li><a href="../152059/index.html">Articles excluded from the Wikipedia section in Russian, may they appear to the world in Russian-language wikiprojects</a></li>
<li><a href="../152060/index.html">MOD Live - experience to use</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>