<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL query for PHP (Version 0.2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Made changes to its class implementation for generating SQL queries in comparison with the previous version . However, before writing about them, I wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL query for PHP (Version 0.2)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/03b/d27/c10/03bd27c108a1475f89ec88b976faaf4b.png" alt="image"><br><br>  Made changes to its class implementation for generating SQL queries in comparison with the <a href="https://habrahabr.ru/post/320718/">previous version</a> .  However, before writing about them, I wanted to immediately clarify some of the issues that, in my opinion, were not disclosed in the first post: <br><a name="habracut"></a><br><ol><li>  This is not just another QueryBuilder.  Although the syntax looks similar, but in fact it works differently.  QueryBuilder is usually executed in Runtime.  My code first needs to be compiled and the already compiled version should be launched for execution.  In particular, the code from the image will be compiled into the following PHP code: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($__query58)) { $__query58 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ML\SQL\Query( <span class="hljs-string"><span class="hljs-string">'0cfd84f430c39bb567ef7cd28bf36054'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'server'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'***'</span></span>, <span class="hljs-string"><span class="hljs-string">'database'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'***'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'***'</span></span>, <span class="hljs-string"><span class="hljs-string">'pass'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'***'</span></span>, <span class="hljs-string"><span class="hljs-string">'prefix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ms-'</span></span>, <span class="hljs-string"><span class="hljs-string">'codepage'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'utf8'</span></span> ) ); } $__query58-&gt;sql = <span class="hljs-string"><span class="hljs-string">' SELECT `profile`.`iduser` AS `profile.iduser`,`user`.`name` AS `user.name` FROM `ms-Users-Profile` AS `profile`LEFT OUTER JOIN `ms-Users-User` AS `user` ON `user`.`id`=`profile`.`iduser` WHERE (`profile`.`net`=\'VK\' OR `profile`.`net`=\'OK\') AND `user`.`sex`=\'M\''</span></span>; $rows = $__query58-&gt;rows();</code> </pre> <br>  When using variables as field names or values, they will be inserted into the query through calls to special functions that will eliminate SQL injection. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  For what it is needed: I plan to make my ORM (by itself with blackjack and whores) and PHPSQL will be an abstract layer for working with the database.  It is planned to write requests in the form of: <br><br><pre> <code class="php hljs">select(id)-&gt;from(Users\User)-&gt;where(sex == <span class="hljs-string"><span class="hljs-string">'M'</span></span>);</code> </pre> <br>  Which will then compile to PHP code with intermediate compilation in PHPSQL. <br><br></li><li>  No, this approach to compiling files will not slow down the work.  It is enough to do this once when you first access the file, and then cache the compiled version and continue to work with it.  You can also do this once when installing / updating the engine through the console.  In this case, it does not matter to us how long the compilation takes, the main thing is that the final file works quickly. <br><br></li><li>  Yes, such an approach can really create problems in debugging.  Because due to the generated code, if an error occurs in the code, the line number of the error will correspond to the new compiled file, and not the one in which you typed this code. At the moment I have not yet figured out how to get around this.  If you have any ideas, voice them. <br><br></li><li>  Yes, I am aware that "instead of inventing my bicycle, I would rather use something cool, such as Doctrine | Eloquent | another option."  But I went my own way because 1) I find it interesting 2) I like it. <br><br></li><li>  Why did not put it on gibhab: because this class uses functions from my other libraries, which in turn require more libraries and in general it all takes 17 mb of source code for which there is no help.  In this case, some of the libraries use one / two unpretentious functions.  At the moment, I see no reason to refactor in order to bring this functionality into a separate small folder for general access.  There will be interest - lay out. </li></ol><br>  Well, now for the changes: <br><br><ul><li>  The most basic innovation is that in the new edition all constant strings are interpreted as field names.  Those.  now instead of field (net) == 'VK' you can write net == 'VK'.  For field names with a dash in the name, you can use the execution statement in back quotes: `net-soc` == 'VK'.  The field function remains, it can be used if the field name, for example, is in a variable: field ($ fieldname). <br><br></li><li>  Functions of the form _And, _Or have disappeared.  Now in the condition you need to use the operators &amp;&amp; and || instead.  Those.  it used to be _Or (field (net) == value ('VK'), field (net) == value ('OK')), in the new edition net == 'VK' ||  net == 'OK' <br><br></li><li>  Added support for JOIN queries (on the start image just an example of it). <br><br></li><li>  Added a low-level Query method that allows you to create any queries, <br>  which cannot be done using specialized functions.  In essence, this is just a simple query formation using string concatenation.  However, in the method, you can use special functions that allow you to exclude SQL injections. <br><br></li><li>  The field function has expanded.  You can now write in the form field ([&lt;table alias name&gt;,] &lt;field name&gt;) [-&gt; as (&lt;field alias name&gt;)] <br><br></li><li>  Support sorting, grouping, aggregation conditions </li></ul><br>  For those who are interested, the test <a href="http://phpsql.shasoft.com/">site for compiling code</a> is located at the same address.  If you find any error, write in the comments.  So far this is version 0.2, so errors are very likely. <br><br>  UPD: Apparently, 90% of the commentators mastered only the title and the picture under it, and immediately began to write a comment in the style of ‚Äúyour bike is shit, write to xxx / yyy / zzz‚Äù.  Although specifically for such <b>paragraph 5</b> was written. <br><br>  UPD2: Added commands INSERT, UPDATE, DELETE.  Also in the SELECT command added offset () and limit ().  So now you can do your ORM. <br><br>  UPD2.1: Added COUNT method in SELECT.  If you specify a variable in it, then the total number of records will be returned to it without taking into account the LIMIT command.  The request itself will also be executed.  This is for paginators done. </div><p>Source: <a href="https://habr.com/ru/post/327160/">https://habr.com/ru/post/327160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327146/index.html">YiiConf 2017, Moscow, June 16</a></li>
<li><a href="../327148/index.html">A simple reminder in Telegram</a></li>
<li><a href="../327150/index.html">Setting up Zabbix 3.2 on Ubuntu Server 16.04 LTS</a></li>
<li><a href="../327152/index.html">Mikrotik L2TP / IPSec for NAT: ipsec, error failed to pre-process ph2 packet</a></li>
<li><a href="../327158/index.html">7 Barriers to Implementing Flexible Methodologies in Large Organizations</a></li>
<li><a href="../327162/index.html">Detect and track multiple objects in a video stream on an FPGA</a></li>
<li><a href="../327164/index.html">Genres and settings of mobile games - statistics for April 2017</a></li>
<li><a href="../327166/index.html">Fast roaming (802.11r) on a Lede-based WiFi network (aka OpenWRT)</a></li>
<li><a href="../327168/index.html">Autonumber in four languages. Part 2</a></li>
<li><a href="../327170/index.html">Yii2-advanced: Flexible configuration of Yii2 RBAC (roles, permissions, rules)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>