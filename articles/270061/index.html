<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The evolution of automatic testing in 1C: Enterprise</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Before the release of the new version of the xUnitFor1C testing framework, quite a bit remains, which means it's time to tell about the work done and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The evolution of automatic testing in 1C: Enterprise</h1><div class="post__text post__text-html js-mediator-article">  Before the release of the new version of the xUnitFor1C testing framework, quite a bit remains, which means it's time to tell about the work done and what the users expect. <br><br>  The release will turn out really major, there are a lot of changes, and they are global.  But first things first. <br><br><h4>  Why all the sawing? </h4><br>  As far as I understand, at the time when the project was just born, the main goal was to understand how unit testing could be in demand in 1C environment.  It is clear that to think over and select the levels of abstractions at the stage of prototyping is not very promising.  The prototype does not have the elasticity of this code.  A prototype is an experiment whose results need to be thrown away. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then the development flag passed from one enthusiast to another, while the basic architecture remained the same.  With the increasing popularity of the product and the realization that I would like to receive, it has become increasingly difficult to make changes. <br><br>  I like Alan Cooper's metaphor: <br><blockquote>  Creating a large program can be compared to building a brick column.  This pillar consists of a thousand bricks laid one upon another.  A pillar can be built only if bricks are laid with great precision.  Any deviation will cause the bricks to fall.  If the brick with the number 998 can deflect by five millimeters, the pillar will probably be able to withstand a thousand bricks, but if the deviation is on the 5th brick, the pillar will never be higher than three dozen. </blockquote><br><a name="habracut"></a><br>  The architecture that existed from the prototype was a deviation on the 5th brick, which did not allow us to add the new functionality that we wanted so much - testing in the BDD style, in particular, the use of Gherkin.  There is an opinion that you need to choose one thing.  Either TDD or BDD.  Having worked on the principles of flexible testing, I realized that modular and scenario tests should not be opposed in any way, they are an excellent complement to each other! <br><br>  Here is the flexible testing matrix: <br><br><img src="https://habrastorage.org/files/51a/ccd/2e2/51accd2e278441c29c2f6e92bb129f39.jpg" alt="image"><br><br>  Unit tests refer to quadrant 1 ‚Äî low-level tests.  Designed for the design of loosely coupled, flexible, tested architecture.  They perform for the developer the same role as the climber safety cable.  At the same time, they are quite cheap in development and maintenance. <br><br>  Scenario tests refer to quadrant 2 ‚Äî higher level tests.  We need to make sure that we correctly understand what needs to be done.  This is a bridge between business and development, the ability to speak the same language.  Excellent documentation that will never become obsolete.  However, they are more expensive to build and more fragile. <br><br>  For me, so wonderful synergy.  I believe that to create high-quality software you need to use both approaches together!  Combined tests of both types provide excellent protection against regression. <br><br><blockquote>  I‚Äôll run a little ahead and say that the BDD-style testing has not yet been implemented on the new engine, but the foundation has been fully prepared.  Scenario testing is the next step. </blockquote><br><h4>  Architecture </h4><br>  It is completely redesigned.  The tool has become much more flexible and easier to develop.  Now this is not processing with 8.5k lines of code, now it is the core with the plugin system.  Yes, there is no error, in 1C you can make a framework that will be expanded with plugins. <br><br>  External processing, located in the ‚ÄúPlugins‚Äù folder and implementing the following basic interface, act as plug-ins: <br><pre><code class="1c hljs"><span class="hljs-comment"><span class="hljs-comment">// { Plugin interface  ()   =  ; .("", .); .("", ().); .("", ().);   ();  // } Plugin interface</span></span></code> </pre> <br>  The appeal to the plugin is by identifier, for example: <br><pre> <code class="1c hljs"> = .(<span class="hljs-string"><span class="hljs-string">""</span></span>);</code> </pre><br>  The kernel can now be roughly expressed as a single function: <br> <code> = (); <br></code> <br>  A reasonable question arises: ‚ÄúWhat kind of canonical test tree and test result?‚Äù. <br><br><img src="https://habrastorage.org/files/36c/88b/ab6/36c88bab628048dc8be1c2b0d1e06aab.jpg" alt="image"><br><br>  The canonical test tree allows us to build a universal ‚Äúlaunch‚Äù of test methods.  It is a tree data structure.  It consists of nodes of the following types: <br><ul><li>  container - serves for grouping purposes and may have subordinate nodes.  Also for the container, you can specify the processing mode of the child nodes: <br><ul><li>  random order traversal - needed for unit tests, guarantees the independence of the tests from each other and allows you to find any side effects; </li><li>  strict bypass order - needed for scenario tests, all child nodes will be processed in a strict order.  In addition, containers of this type have the ‚Äúcontext‚Äù property, which has child elements for read and write access. </li></ul><br></li><li>  element is essentially test method metadata that allows you to create a context and call a test method.  It has the following basic properties: <br><ul><li>  Path - a string that allows you to create an instance of the object, which you can call a test method; </li><li>  MethodName - the actual name of the test method to be executed; </li><li>  Parameters - an array of parameters passed to the test method.  The number and types of parameters must match the signature of the test method.  Required for parameterized tests. </li></ul><br></li></ul><br>  The canonical test result is very similar to the test tree with the difference that it contains additional information about the results of the execution: <br><ul><li>  For containers: <br><ul><li>  The state is the result of the aggregation of the states of the child nodes; </li><li>  Statistics - the total number of tests in the container, the number of broken tests, the number of unrealized tests, the total execution time in ms. </li></ul><br></li><li>  For items: <br><ul><li>  Condition - not executed / passed / not implemented / broken; </li><li>  Lead time; </li><li>  Message - contains the exception text if the test is broken. </li></ul><br></li></ul><br><h4>  Where do canonical trees come from with tests and how does this contribute to universalization? </h4><br>  Building a tree with tests deals with a special type of plug-in ‚ÄúLoader‚Äù.  Typical scenario of working with loaders: <br><ol><li>  The user selects the Loader, which he wants to use; </li><li>  Next, the path to search for test scripts is determined (possibly interactive).  In this case, the path is just a certain string that the selected loader can correctly interpret.  For example, it can be a file system path or a path in the configuration metadata tree or ... anything; </li><li>  A test path is searched for the selected path; </li><li>  According to the found scenarios, a test tree for the kernel is formed, while in the paths at the leaves of the tree some lines are indicated (similar to paragraph 2) that the selected loader can correctly interpret; </li><li>  When tests are being performed, the kernel will contact the appropriate loader to resolve paths on the leaves of the tree. </li></ol><br>  Loader API: <br><br>  <i>The function Select PathInteractively (Current Path = "")</i> is a client method for interactively choosing a path for loading tests; <br><br>  <i>The Load function (Context-Core, Path)</i> - search for test scenarios and building the canonical test tree; <br><br>  <i>The function GetContextPo Path (ContextNucleus, Path)</i> - receiving test context on the transmitted path. <br><br>  Currently, 3 basic loaders are implemented: <br><ul><li>  File Loader - unit test loader from epf files.  It uses file system paths as paths; </li><li>  Directory Loader - built on top of the file uploader.  As a path to search takes the path to the directory of the file system.  For the rest, relies entirely on the file uploader; </li><li>  Loader From Subsystem Configurations - uses the configuration metadata tree as a string representation as paths.  For example, ‚ÄúMetadata. Processing. Test_ Processing.‚Äù  The test processing API borrows a file downloader. </li></ul><br><blockquote>  In the near future, the creation of a BDD Downloader that will work with the Gherkin feature files. </blockquote><br><h4>  And what to do with the canonical test results? </h4><br>  After the kernel has processed the test tree into the test result, it passes it to another special type of the Report Generator plugin. <br><br>  Report generators transform canonical test results into any other representation.  For example, now implemented: <br><ul><li>  Report Generator MXL - moxel-format of the report, which is now used in interactive work with the tool; </li><li>  Report GeneratorJUnitXML is a junit.xml report that is used in continuous integration (CI). </li></ul><br>  Report Generator API: <br><br>  <i>The Create Report function (Context Core, Test Results)</i> - generation of a report in the format proposed by the plugin.  Test results are passed to the plugin in canonical for the kernel format; <br><br>  <i>The Show (Report) procedure</i> is a client method for interactively displaying a generated report.  The plug-in itself determines exactly how the report generated by it should be issued to the user; <br><br>  <i>Export Procedure (Report, Full Path of the File)</i> - saves the report on the specified path, mainly used for CI purposes. <br><br><h4>  Goodies </h4><br>  All sorts of "useful" have a type of plug-in "Utility".  As a rule, perform a library or service function.  For example, a library of statements in the style of BDD is a plugin called ‚ÄúBDD statements‚Äù, which I wrote about in my last article.  ‚ÄúSerializer MXL‚Äù is a service plugin that serializes database data into moxel-format and back. <br><br><h4>  Afterword </h4><br>  Before the mainstream development, the source code is available by <a href="https://github.com/xDrivenDevelopment/xUnitFor1C/tree/develop_v4_reborn">reference</a> . <br><br>  Now it can be argued that the framework has grown from ‚Äújust a unit testing tool‚Äù to ‚Äúa tool that allows you to cover almost all possible types of automatic testing‚Äù.  It is modular, clearly divided into layers, can be easily refined and expanded.  It seems the current name has ceased to transmit the purpose of the product.  Maybe it's time to change the name?  If you have a good idea for a title, feel free to share. </div><p>Source: <a href="https://habr.com/ru/post/270061/">https://habr.com/ru/post/270061/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270051/index.html">We work with Xamarin: development experience on two projects</a></li>
<li><a href="../270053/index.html">Do not cos from development on Cach√©</a></li>
<li><a href="../270055/index.html">Another methodology: Stakhanov</a></li>
<li><a href="../270057/index.html">Technical interviews: tips</a></li>
<li><a href="../270059/index.html">Highload to Java: what you need to remember</a></li>
<li><a href="../270063/index.html">JSON in Swift 2.0 without anesthesia</a></li>
<li><a href="../270065/index.html">Exploit a million. We have a winner</a></li>
<li><a href="../270069/index.html">Buffers and binary input and output in Perl6</a></li>
<li><a href="../270071/index.html">Sorting an array without using conditional statements</a></li>
<li><a href="../270073/index.html">Protection in-App Purchase iOS from the server with the help of the server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>