<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing a RESTful Table in the Atlassian User Interface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is it all about? 


 For those who are not in the topic at all: Atlassian , known for its workflow solutions (primarily JIRA and Confluence, but ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing a RESTful Table in the Atlassian User Interface</h1><div class="post__text post__text-html js-mediator-article"><h3 id="o-chyom-eto-voobsche">  What is it all about? </h3><br><p>  For those who are not in the topic at all: <a href="https://www.atlassian.com/">Atlassian</a> , known for its workflow solutions (primarily JIRA and Confluence, but probably any IT specialist can easily name a few more), also has an SDK for developing plug-ins for these products.  Among the tools available to developers as part of this SDK, there is a subsystem for developing web interfaces Atlassian User Interface (AUI).  And among the features of AUI is the so-called RESTful Table - a ready-made solution for implementing an interactive table, all changes in which are saved in real time on the server side using a set of REST services. </p><br><p>  I recently needed to write such a table - before that I didn‚Äôt have to do this, so I turned to the current (AUI 7.6.2) version of the <a href="https://docs.atlassian.com/aui/7.6.2/docs/restful-table.html">official manual</a> , but found that it was not enough.  I had to get information - on the forums and in the source code of the AUI itself, since the latter <a href="https://bitbucket.org/atlassian/aui">are available</a> (and, by the way, also contain a good example of a working RESTful table, but, unfortunately, not having detailed comments).  I didn‚Äôt find the missing leadership gaps in the network, and I wanted to put together what I had to dig in to facilitate a similar task to others, and perhaps to myself in the future.  Building on work, of course, still follows the official manual, but this text is likely to be useful as an addition ... in any case, until it is updated. </p><a name="habracut"></a><br><h3 id="produkty-i-versii">  Products and Versions </h3><br><p>  When working, I used: </p><br><ul><li>  Java 8 </li><li>  Atlassian Plugin SDK 6.3.6 (in particular, did the builds with the Maven 3.2.1 instance included in it) </li><li>  JIRA 7.7.0 Core (the plugin was written under JIRA and tested exclusively on this version) </li></ul><br><h3 id="postanovka-zadachi">  Formulation of the problem </h3><br><p>  So, I need to have a page with a table somewhere in JIRA that allows you to add / delete rows, change the contents of existing ones and change rows in places.  Any change in the content of the table should be synchronously recorded in the storage on the server side - as a rule, this is a database or other non-volatile solution, but since I am interested in the table and its interaction with the server side, I will limit myself to storage in memory - this will allow me to get previously saved data, re-entering the page with the table, but not saving it when the server is disconnected or, for example, reinstalling the plugin. </p><br><h3 id="podgotovka">  Training </h3><br><p>  I‚Äôll first create a plugin for JIRA that contains one new page (let it be a servlet module that paints a page in Apache Velocity format), an empty JS script triggered by opening this page (and most of the magic will happen in it) and leading to this page link in the JIRA header.  I will not dwell on this in detail - in principle, these are trivial operations;  In any case, a working example code <a href="https://bitbucket.org/bboogwin/atlassian-examples/">is available on Bitbucket</a> . </p><br><h3 id="realizaciya-frontend">  Implementation: frontend </h3><br><p>  I will try to act on the official leadership of Atlassian.  First of all, add the usual HTML table to the page, which will become my RESTful table </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"event-rt"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  ... in the JS script web-resource module in the plug-in descriptor (atlassian-plugin.xml) - dependency on the corresponding library: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"events-restful-table-script"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"events-restful-table-script"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"download"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"events-restful-table.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">location</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/js/events-restful-table.js"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>com.atlassian.auiplugin:ajs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>com.atlassian.auiplugin:aui-experimental-restfultable<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-resource</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  ... and in the script itself - the creation of a minimal RESTful table with one string parameter based on the existing table: </p><br><pre> <code class="javascript hljs">AJS.$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AJS.RestfulTable({ <span class="hljs-attr"><span class="hljs-attr">autoFocus</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">el</span></span>: jQuery(<span class="hljs-string"><span class="hljs-string">"#event-rt"</span></span>), <span class="hljs-attr"><span class="hljs-attr">allowReorder</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">resources</span></span>: { <span class="hljs-attr"><span class="hljs-attr">all</span></span>: <span class="hljs-string"><span class="hljs-string">"rest/evt-restful-table/1.0/events-restful-table/all"</span></span>, <span class="hljs-attr"><span class="hljs-attr">self</span></span>: <span class="hljs-string"><span class="hljs-string">"rest/evt-restful-table/1.0/events-restful-table/self"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">columns</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-attr"><span class="hljs-attr">header</span></span>: <span class="hljs-string"><span class="hljs-string">"Event name"</span></span> } ] }); });</code> </pre> <br><p>  Done - by assembling the plugin, you can make sure that the page does have a new table that allows you to add lines with the desired content, then edit them, delete and swap places.  On the server side, these changes, of course, have not yet been recorded. </p><br><h3 id="realizaciya-backend">  Implementation: backend </h3><br><p>  This is what I'll do now.  According to the manual, one REST resource is required, which provides all the data stored in the system for the table model, and another (or more precisely not one resource, but their set), which allows performing CRUD operations with one specific instance of the model.  Suppose that in this case it will be implemented as one common controller class and data model class: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Consumes</span></span>({MediaType.APPLICATION_JSON}) <span class="hljs-meta"><span class="hljs-meta">@Produces</span></span>({MediaType.APPLICATION_JSON}) <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/events-restful-table/"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestfulTableController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;RestfulTableRowModel&gt; storage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-meta"><span class="hljs-meta">@GET</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/all"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllEvents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.ok(storage.stream() .sorted(Comparator.comparing(RestfulTableRowModel::getId).reversed()) .collect(Collectors.toList())).build(); } <span class="hljs-meta"><span class="hljs-meta">@GET</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/self/{id}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String id) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.ok(findInStorage(id)).build(); } <span class="hljs-meta"><span class="hljs-meta">@PUT</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/self/{id}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String id, RestfulTableRowModel update) </span></span>{ RestfulTableRowModel model = findInStorage(id); Optional.ofNullable(update.getName()).ifPresent(model::setName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.ok(model).build(); } <span class="hljs-meta"><span class="hljs-meta">@POST</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/self"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestfulTableRowModel model)</span></span></span><span class="hljs-function"> </span></span>{ model.setId(generateNewId()); storage.add(model); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.ok(model).build(); } <span class="hljs-meta"><span class="hljs-meta">@DELETE</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/self/{id}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String id) </span></span>{ storage.remove(findInStorage(id)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.ok().build(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> RestfulTableRowModel </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findInStorage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storage.stream() .filter(item -&gt; item.getId() == Long.valueOf(id)) .findAny() .orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateNewId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storage.stream() .mapToLong(RestfulTableRowModel::getId) .max().orElse(<span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestfulTableRowModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@XmlElement</span></span>(name = <span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; <span class="hljs-meta"><span class="hljs-meta">@XmlElement</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } }</code> </pre> <br><p>  The corresponding rest module in the plugin descriptor: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Events RESTful Table Resource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"events-restful-table-resource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/evt-restful-table"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  In the REST resource code, note the following points: </p><br><ul><li>  the REST resource methods that create and update an entry in the repository also return the resulting object of this entry as part of the response ‚Äî in general, this is a well-established practice;  the problem is that nothing forces me to do this if I don‚Äôt know about this practice.  Without this, the table will not work correctly; </li><li>  when editing a record in the table, the values ‚Äã‚Äãof only the modified fields get to the server, null is used instead of the others, so I have to check their presence before writing new values ‚Äã‚Äãto the record object in the repository.  Empty values ‚Äã‚Äãcome to the server as empty lines, not null, so there is no problem to distinguish the absence of a change from a new empty value in the case of string fields - but in the case of a primitive type field, difficulties may arise; </li><li>  as part of a record class, there is an id field - it is not reflected in any way in the table, but it is used to identify records;  The id is generated by the server and then returned to the client as part of the object of the created vault entry.  Important: the id must be such that its Javascript representation results in a boolean true rather than false ‚Äî in particular, 0 is not valid; </li><li>  records on the server are sorted (in this case by id) - this, of course, is not necessary, but for any practical task, it is most likely needed.  Notice that the order is inverted with respect to the natural one ‚Äî thanks to this, it is possible to preserve when you re-output (say, reloading the page) the order of records that arose directly when adding records to the table;  however, the table has the "createPosition" option, which allows adding new records to the bottom rather than the top, as in this example, and in this case, such an inversion is not necessary. </li></ul><br><p>  Collecting plugin ... surprise!  REST resources have been added to the system, as you can see on the plugin management page, but they don‚Äôt want to save the data.  Having opened the browser console, it is easy to establish the reason: REST resources return a 404 error, that is, they are not available at the addresses used.  In the addresses, in fact, the problem: the browser accesses the address of the form "&lt;your_JIRA&gt; /plugins/servlet/rest/evt-restful-table/1.0/events-restful-table/", but the resources are located at the addresses of the form &lt;your_JIRA &gt; /rest/evt-restful-table/1.0/events-restful-table/ "(you can verify this with, for example, the <a href="https://marketplace.atlassian.com/plugins/com.atlassian.labs.rest-api-browser">Atlassian REST API Browser</a> plugin).  The actual paths used by the table for requests are constructed based on the address of the current page (for example, if you compile the path to the servlet that paints your page, the paths for the requests will change accordingly).  However, the situation will change if I start the path with a slash ("/"): in this case, the full path to the resources is made up of the host name and the specified path to the resource.  The reasons for this phenomenon, I understand, frankly, lazy;  there is a suspicion that the point here is the peculiarities of the work, not even the AUI, but the underlying Backbone.js.  Either way, just adding a slash to the beginning of each path is not enough, unless your JIRA has a base URL that matches the host name.  The universal solution will be accessible (and also starting with a slash) context path: <br></p><pre> <code class="javascript hljs">resources: { <span class="hljs-attr"><span class="hljs-attr">all</span></span>: AJS.contextPath() + <span class="hljs-string"><span class="hljs-string">"/rest/evt-restful-table/1.0/events-restful-table/all"</span></span>, <span class="hljs-attr"><span class="hljs-attr">self</span></span>: AJS.contextPath() + <span class="hljs-string"><span class="hljs-string">"/rest/evt-restful-table/1.0/events-restful-table/self"</span></span> },</code> </pre> <br><p>  Another solution is also possible: create the full URLs rather than relative URLs from the base URL of the application and the paths to the REST resources: </p><br><pre> <code class="javascript hljs">resources: { <span class="hljs-attr"><span class="hljs-attr">all</span></span>: AJS.params.baseURL + <span class="hljs-string"><span class="hljs-string">"/rest/evt-restful-table/1.0/events-restful-table/all"</span></span>, <span class="hljs-attr"><span class="hljs-attr">self</span></span>: AJS.params.baseURL + <span class="hljs-string"><span class="hljs-string">"/rest/evt-restful-table/1.0/events-restful-table/self"</span></span> },</code> </pre> <br><p>  Such URLs are used without additional conversions, which is also quite suitable for me. </p><br><p>  I collect the plugin again, indicating the appropriate path.  Now the records in the table are regularly created, edited and deleted.  It seems that everything works ... yes?  Not really. </p><br><h3 id="peremeschenie-strok">  Moving rows </h3><br><p>  The table should also support Drag &amp; Drop rows (there is a setting that allows you to disable it, but I did not use it).  Now, if you try dragging one of the lines somewhere, it will work ... but after reloading the page, the lines will be in the same position.  In order for the change in the position of the string to be reflected on the server, another REST resource not mentioned in the manual is needed - move, which receives information about the movement details.  It expects to receive an object with two parameters: after - the path to the REST resource of the data element corresponding to the line below which I place my drag and drop position while dragging, and position - the description of the new position of the element using one of the four constants: First, Last, Earlier or Later (in fact, however, the current implementation of the RESTful table uses only First ... but the processing should still be implemented for all four).  Only one of two fields can be initialized.  For clarity, I made the Java model fields string, although this is not the most convenient solution. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@XmlAccessorType</span></span>(XmlAccessType.FIELD) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MoveInfo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@XmlElement</span></span>(name = <span class="hljs-string"><span class="hljs-string">"position"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String position; <span class="hljs-meta"><span class="hljs-meta">@XmlElement</span></span>(name = <span class="hljs-string"><span class="hljs-string">"after"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String after; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String position)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.position = position; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAfter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> after; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAfter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String after)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.after = after; } }</code> </pre> <br><p>  And here is the actual method that implements my REST resource: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@POST</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/self/{id}/move"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String idString, MoveInfo moveInfo) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> oldId = Long.valueOf(idString); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> newId; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveInfo.getAfter() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { String[] afterPathParts = moveInfo.getAfter().split(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> afterId = Long.valueOf(afterPathParts[afterPathParts.length - <span class="hljs-number"><span class="hljs-number">1</span></span>]); newId = afterId &gt; oldId ? afterId - <span class="hljs-number"><span class="hljs-number">1</span></span> : afterId; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveInfo.getPosition() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (moveInfo.getPosition()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"First"</span></span>: newId = getLastId(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Last"</span></span>: newId = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Earlier"</span></span>: newId = oldId &lt; getLastId() ? oldId + <span class="hljs-number"><span class="hljs-number">1</span></span> : oldId; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Later"</span></span>: newId = oldId &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ? oldId - <span class="hljs-number"><span class="hljs-number">1</span></span> : oldId; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Unknown position type!"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Invalid move data!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newId &gt; oldId) { storage.stream() .filter(entry -&gt; entry.getId() &lt;= newId &amp;&amp; entry.getId() &gt;= oldId) .forEach(entry -&gt; entry.setId(entry.getId() == oldId ? newId : entry.getId() - <span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newId &lt; oldId) { storage.stream() .filter(entry -&gt; entry.getId() &gt;= newId &amp;&amp; entry.getId() &lt;= oldId) .forEach(entry -&gt; entry.setId(entry.getId() == oldId ? newId : entry.getId() + <span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.ok().build(); }</code> </pre> <br><p>  Please note: it is relevant specifically for the method of sorting elements in the table, which in this case is applied.  To sort in the reverse order, this method will have to be changed. </p><br><p>  The method, as you can see, does not return anything meaningful to the browser (although it may), but in general the result of the transfer request needs to be processed (when it is returned, the REORDER_SUCCESS event not mentioned in the manual will fall, for which you should subscribe) models of the moved rows of the table will keep the old id (automatic updates, alas, they did not deliver), and this will mean that the data in the browser and on the server are out of sync, so further work with interactive table elements will not lead to anything good.  Therefore, in this case (although, generally, it is rather uneconomical), the easiest way is not to try to return data about changes from the server and push them to the right places, but simply get the table to retrieve and redraw all the data again.  All you have to do manually is to delete the old contents of the tbody table: </p><br><pre> <code class="javascript hljs">AJS.$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ AJS.TableExample = {}; AJS.TableExample.table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AJS.RestfulTable({ <span class="hljs-comment"><span class="hljs-comment">// ... }); AJS.$(document).bind(AJS.RestfulTable.Events.REORDER_SUCCESS, function () { AJS.TableExample.table.$tbody.empty(); AJS.TableExample.table.fetchInitialResources(); });</span></span></code> </pre> <br><p>  Now that's it! </p><br><h3 id="drugie-tipy-poley">  Other field types </h3><br><p>  My table is fully functional, but there is little use for it ‚Äî in fact, it‚Äôs just a list of strings.  You can, of course, add more string fields, but, most likely, in the real table you want to see not only the rows, but also something else - for example, dates, checkboxes, combo boxes ... For example, I will add the date - other fields are created in general, similarly . </p><br><p>  To add a non-standard view field to the table, I will need to provide it with a custom view for creating, editing and reading, respectively, in the row being created, edited and inactive.  To create and edit a date, I use aui-date-picker, since this is an AUI, and for an inactive line, the usual span is enough: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-attr"><span class="hljs-attr">header</span></span>: <span class="hljs-string"><span class="hljs-string">"Event date"</span></span>, <span class="hljs-attr"><span class="hljs-attr">createView</span></span>: AJS.RestfulTable.CustomCreateView.extend({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $field = AJS.$(<span class="hljs-string"><span class="hljs-string">'&lt;input type="date" class="text aui-date-picker" name="date" /&gt;'</span></span>); $field.datePicker({<span class="hljs-string"><span class="hljs-string">'overrideBrowserDefault'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $field; } }), <span class="hljs-attr"><span class="hljs-attr">editView</span></span>: AJS.RestfulTable.CustomEditView.extend({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $field = AJS.$(<span class="hljs-string"><span class="hljs-string">'&lt;input type="date" class="text aui-date-picker" name="date"&gt;'</span></span>); $field.datePicker({<span class="hljs-string"><span class="hljs-string">'overrideBrowserDefault'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_.isUndefined(self.value)) { $field.val(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(self.value).print(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $field; } }), <span class="hljs-attr"><span class="hljs-attr">readView</span></span>: AJS.RestfulTable.CustomReadView.extend({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val = (!_.isUndefined(self.value)) ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(self.value).print(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d"</span></span>) : <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;span data-field-name="date"&gt;'</span></span> + (val ? val : <span class="hljs-string"><span class="hljs-string">''</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/span&gt;'</span></span>; } }) }</code> </pre> <br><p>  Accordingly, I will update the java-class data model: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@XmlElement</span></span>(name = <span class="hljs-string"><span class="hljs-string">"date"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Date date; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Date </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.date = date; }</code> </pre> <br><p>  ... and add date handling to the update method: </p><br><pre> <code class="java hljs">Optional.ofNullable(update.getDate()).ifPresent(model::setDate);</code> </pre> <br><p>  Done - a new field of the desired type has appeared in the table. </p><br><p>  I will be glad to clarify and supplement. </p><p></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/354740/">https://habr.com/ru/post/354740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354728/index.html">Own asynchronous tcp-server in 15 minutes with detailed analysis</a></li>
<li><a href="../354730/index.html">We reanimate the Nintendo Switch and PlayStation gaming service after locks on the RKN</a></li>
<li><a href="../354732/index.html">Developing a simple deep learning model for predicting stock prices using TensorFlow</a></li>
<li><a href="../354736/index.html">How to work as an IT manager and why your boss doesn't have to be Steve Jobs</a></li>
<li><a href="../354738/index.html">Municipal Moira or What affects the career of an official</a></li>
<li><a href="../354742/index.html">PHP could get better</a></li>
<li><a href="../354744/index.html">Protection against easy DDoS'a</a></li>
<li><a href="../354748/index.html">CPU Cache Myths About Programmers Believe</a></li>
<li><a href="../354750/index.html">Do not write too much</a></li>
<li><a href="../354752/index.html">Flask Mega-Tutorial, Part XXII: Background Tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>