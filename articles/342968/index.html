<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Torskel - simplify the routine in Tornado</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I often have to do small servers on tornado. In some projects, you need support for working with redis, in some you don‚Äôt. In others, you need to rend...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Torskel - simplify the routine in Tornado</h1><div class="post__text post__text-html js-mediator-article">  I often have to do small servers on tornado.  In some projects, you need support for working with redis, in some you don‚Äôt.  In others, you need to render ReactJS.  And all need logging.  For a start, I picked up a local pypi repository, collected my work in a python package and enjoyed my life.  It was enough to install the package, import classes from it, follow it and happily saw the code further. <br><br>  And then there was a thought - and not to share their work with people?  So I present to you the torskel package. <br><a name="habracut"></a><br>  At once I will make a reservation that he is friends only with Python 3.5+ since it uses async / await at all. <br><br>  This is a tornado wrapper that allows you to get basic functionality out of the box: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Installing the library - pip install torskel <br><br><h2>  Asynchronous work with Redis </h2><br>  Disabled by default, to enable, you must set the use_redis option to True and make <code>pip install aioredis</code> <br><br>  Usage example: <br><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torskel.torskel_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TorskelServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torskel.torskel_handler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TorskelHandler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tornado.web <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornado.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> options options.define(<span class="hljs-string"><span class="hljs-string">'use_redis'</span></span>, default=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, help=<span class="hljs-string"><span class="hljs-string">'use redis'</span></span>, type=bool) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RedisApplication</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TorskelServer)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, handlers, **settings)</span></span></span><span class="hljs-function">:</span></span> super().__init__(handlers, **settings) self.greeting = <span class="hljs-string"><span class="hljs-string">'Hello redis!'</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RedisHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TorskelHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> my_key = self.get_hash_str(<span class="hljs-string"><span class="hljs-string">'my_key'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.set_redis_exp_val(my_key, self.application.greeting, <span class="hljs-number"><span class="hljs-number">3000</span></span>, convert_to_json=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.get_redis_val(my_key, from_json=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.write(res) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.del_redis_val(my_key) self.finish() redis_app = RedisApplication(handlers=[(<span class="hljs-string"><span class="hljs-string">r"/"</span></span>, RedisHandler)]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: redis_app.listen(<span class="hljs-number"><span class="hljs-number">8888</span></span>) loop = asyncio.get_event_loop() redis_app.init_with_loop(loop) loop.run_forever() tornado.ioloop.IOLoop.instance().start()</code> </pre><br>  The list of available options with default values: <br><br>  Determines whether to use radishes at all <br><br><pre> <code class="hljs pgsql">use_redis=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br>  Default connection via socket file <br><br><pre> <code class="hljs pgsql">use_redis_socket=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Create a pool of connections - minimum 5, maximum 10 <br><br><pre> <code class="hljs">redis_min_con=5 redis_max_con=10</code> </pre> <br>  How to get to the radish? <br><br><pre> <code class="hljs cs">redis_host=<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span> redis_port=<span class="hljs-number"><span class="hljs-number">6379</span></span> redis_socket=<span class="hljs-string"><span class="hljs-string">'/var/run/redis/redis.sock'</span></span></code> </pre> <br>  Configure authorization <br><br><pre> <code class="hljs 1c">redis_psw=''  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  redis_db=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><h2>  We send a log on mail </h2><br>  Configured with the following options: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define(<span class="hljs-string"><span class="hljs-string">'use_mail_logging'</span></span>, default=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, help=<span class="hljs-string"><span class="hljs-string">'SMTP log handler'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=<span class="hljs-type"><span class="hljs-type">bool</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define("log_mail_subj", default=<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=str) <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define("log_mail_from", default=<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=str) <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define("log_mail_to", default=[], <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=list) <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define("log_mail_host", default=<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=str) <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define("log_mail_user", default=<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=str) <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>.define("log_mail_psw", default=<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=str)</code> </pre> <br>  I think there is no need for special explanations, the names of the options speak for themselves. <br><br><h2>  Http requests </h2><br>  Just a wrapper over a standard Tornad AsyncHttpClient <br><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tornado.web <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torskel.torskel_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TorskelServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torskel.torskel_handler i mport TorskelHandler <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloHttpHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TorskelHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> self.http_request_get(<span class="hljs-string"><span class="hljs-string">'http://example.com'</span></span>) self.write(res) self.finish() hello_http_app = TorskelServer(handlers=[(<span class="hljs-string"><span class="hljs-string">r"/"</span></span>, HelloHttpHandler)]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: hello_http_app.listen(<span class="hljs-number"><span class="hljs-number">8888</span></span>) tornado.ioloop.IOLoop.instance().start()</code> </pre><br><h2>  ReactJS support </h2><br>  Enabled by use_reactjs option.  You also need to make pip install jinja2. Here we will need a set of js-developer, npm, webpack / gulp and other babels. <br><br>  Render occurs function <code>react_render</code> .  It is assumed that your html template, you connect the script with the line <br><br><pre>  &lt;script src = "{{assets ['main'] ['js']}}"&gt; &lt;/ script&gt; </pre><br>  This moment is rather thin and in the future I plan to finalize it. <br><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tornado.web <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornado.web <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tornado.options <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> options, define <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torskel.torskel_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TorskelServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torskel.torskel_handler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TorskelHandler settings = {} options.define(<span class="hljs-string"><span class="hljs-string">'use_reactjs'</span></span>, default=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, help=<span class="hljs-string"><span class="hljs-string">'use reactjs'</span></span>, type=bool) options.define(<span class="hljs-string"><span class="hljs-string">"react_assets_file"</span></span>, default=<span class="hljs-string"><span class="hljs-string">'webpack-assets.json'</span></span>, type=str) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TorskelHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.react_render(<span class="hljs-string"><span class="hljs-string">'index.html'</span></span>) self.finish() handlers = [ url(<span class="hljs-string"><span class="hljs-string">r"/"</span></span>, MainHandler, name=<span class="hljs-string"><span class="hljs-string">"IndexPage"</span></span>), ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelloReactApplication</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TorskelServer)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, handlers, **settings)</span></span></span><span class="hljs-function">:</span></span> super().__init__(handlers, **settings) hello_react = HelloReactApplication(handlers, root_dir=os.path.dirname(__file__), **settings) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: hello_react.listen(options.port) tornado.ioloop.IOLoop.current().start()</code> </pre><br>  This is still the alpha version of the library.  The plans still add support for creating pools of connections to various databases. <br><br>  PS <br><br>  Github link <br>  <a href="https://github.com/frostspb/torskel">github.com/frostspb/torskel</a> </div><p>Source: <a href="https://habr.com/ru/post/342968/">https://habr.com/ru/post/342968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342956/index.html">Designing APIs in Java. SOA-based application development using JAX-WS and JAX-RS technologies</a></li>
<li><a href="../342960/index.html">Welcome to the Atlassian Meetup December 12</a></li>
<li><a href="../342962/index.html">BPM in the company: let them decide the processes</a></li>
<li><a href="../342964/index.html">Optimize frontend. Part 2. We repair tree-shaking in the project on webpack</a></li>
<li><a href="../342966/index.html">What rules of English do our foreign colleagues violate? Part 2</a></li>
<li><a href="../342970/index.html">Exonum 0.3 - what we have improved in the new version of the framework for the development of blockchains</a></li>
<li><a href="../342974/index.html">How to make your blockchain. Part 1 - Build, Store, Sync, Display, Mining, and Proof</a></li>
<li><a href="../342976/index.html">10 obvious steps to prepare the infrastructure of an online store for Black Friday</a></li>
<li><a href="../342978/index.html">From searching to examining documents in network balls and file dumps</a></li>
<li><a href="../342982/index.html">Conan: dependency manager for C / C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>