<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multi-armed bandits: model dynamic Gamma-Poisson</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time we looked at the general formulation of the multi-armed gang problem, discussed why this might be necessary, and led to a very simple but ef...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multi-armed bandits: model dynamic Gamma-Poisson</h1><div class="post__text post__text-html js-mediator-article">  Last time we <a href="http://habrahabr.ru/company/surfingbird/blog/168611/">looked at the general formulation</a> of the multi-armed gang problem, discussed why this might be necessary, and led to a very simple but effective algorithm.  Today I will talk about another model that is effective in situations where the expected revenues from gangsters change over time, and the number and composition of the ‚Äúpens‚Äù can change - about the dynamic gamma-Poisson model. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/b3d/1dc/b12/b3d1dcb128e3584e864e0bbfd619fb4b.jpg"></div><br><a name="habracut"></a><br><br>  This model refers to the so-called <i>online models of recommendations</i> .  Setting a task here is different from offline models (which include the main methods of collaborative filtering - the method of nearest neighbors, SVD and their variants, etc.) in that the main goal of online recommendations is to ‚Äúcatch‚Äù changes in the popularity of certain products as soon as possible. .  Since, as a rule, there is not enough data so that such changes can be tracked by collaborative filtering methods, online methods usually combine data on the ratings of all users, without engaging in personalized recommendations.  Moreover, there are often situations when the system cannot provide reasonable recommendations on the method of collaborative filtering (new user, user who has insufficient nearest neighbors, etc.);  in such situations, recommender systems also often issue recommendations based on their online components (see also the recent <a href="http://habrahabr.ru/company/surfingbird/blog/168733/">post by Vasily Leksin</a> on the cold start task - we will continue that series too).  As a good overview of the various methods of online recommendations, I can recommend <a href="http://pages.cs.wisc.edu/~beechung/kdd10-tutorial/3-RecommenderProblems-Online.pdf">this presentation</a> ;  however, these are slides, not text, and everything is very briefly stated there, so it is better to use it as a source of keywords and links. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And for the purposes of this post, we will imagine such a situation (I already mentioned it in the previous series).  Let us be a portal, make money by placing ads, and as enticing content, we need to post news announcements that users will want to follow (and see even more tasty ads).  Below is a typical image showing the (normalized) click-through ratio (CTR) of several news on the Yahoo home page;  it can be seen that the changes occur fairly quickly, and these changes are significant: the news quickly ‚Äúrotten‚Äù, and it is impossible to react to this by recounting the collaborative filtering system once a day. <br><br><img src="https://habrastorage.org/storage2/597/d69/714/597d69714e3883c77c3de01eb4399e3a.png"><br>  (real news sample <a href="http://pages.cs.wisc.edu/~beechung/kdd10-tutorial/3-RecommenderProblems-Online.pdf">from Yahoo home page</a> ) <br><br>  Formally speaking, we have a set of products / sites;  we now want to evaluate the CTR of each of them separately, independently, therefore in the future we will work with one of them.  We fix the time period <i>t</i> (small) and we will count the impressions (total number of experiments) and clicks (marks like or other desired outcomes) during time <i>t</i> .  Suppose we have shown the site <i>n <sub>t</sub></i> times during the period <i>t</i> and obtained the rating <i>r <sub>t</sub></i> ( <i>r <sub>t</sub></i> is an integer less than <i>n <sub>t</sub></i> ).  Then we are given a sequence at each time <i>t</i> <img src="https://habrastorage.org/getpro/habr/post_images/6aa/44d/d82/6aa44dd8286e400e3d24405dfc444479.png">  , and we want to predict <i>p <sub>t + 1</sub></i> , the share of successful impressions (CTR) at time <i>t + 1</i> . <br><br>  Here are the first natural ideas: <br><ul><li>  sort by current <img src="https://habrastorage.org/getpro/habr/post_images/aff/bcf/a56/affbcfa56c47be4eda0947c2d5d23667.png">  ;  this sorting will really respond quickly, but most likely will react <i>too</i> quickly, i.e.  will be extremely unstable: random fluctuations will have a disproportionately strong effect; </li><li>  sort by total average <img src="http://mathurl.com/awhd7ko.png">  ;  such an approach will have reverse problems - it will very slowly react to changes, and the ‚Äúrotten‚Äù news that has long been left in the top; </li><li>  sort by the average calculated by the sliding window <img src="http://mathurl.com/cadn2jc.png">  ;  this is quite a reasonable heuristic, but here we do not get estimates for the variance <i>p <sub>t + 1</sub></i> , and also cannot adjust to the different rate of change in different ‚Äúpens‚Äù. </li></ul><br><br>  To solve this problem, it is proposed to use the so-called <i>dynamic Gamma ‚Äì Poisson model</i> (dynamic gamma-Poisson model, DGP).  The probabilistic assumptions of DGP are: <br><ul><li><img src="http://mathurl.com/ad2ufd8.png">  (for fixed <i>n <sub>t</sub></i> and <i>p <sub>t, we</sub></i> get <i>r <sub>t</sub></i> distributed over the Poisson distribution); </li><li><img src="http://mathurl.com/bcnsft5.png">  where <img src="https://habrastorage.org/getpro/habr/post_images/8f5/8a9/37c/8f58a937cdd793b1c3f86699bfa6aace.png">  (average success rate <i>p <sub>t</sub></i> <br>  changes not too fast, but by multiplying by a random variable Œµ <sub>t</sub> , which has a gamma distribution around the unit); </li><li>  Model parameters are distribution parameters. <img src="http://mathurl.com/bvemo2j.png">  , <br>  as well as the parameter Œ∑, which shows how ‚Äúsmoothly‚Äù <i>p <sub>t</sub></i> can change;  accordingly, the task is to evaluate the parameters of the posterior distribution <br><img src="http://mathurl.com/czyxw4o.png"></li></ul><br><br>  After a lot of mathematical torment (which I will omit here), a very simple iterative algorithm is obtained for recalculating the parameters of this model (in fact, the specific form of the distributions was chosen just to get it: the gamma distribution is a <a href="http://en.wikipedia.org/wiki/Conjugate_prior">conjugate a priori distribution</a> for the Poisson distribution).  Suppose that at the previous step <i>t-1</i> we obtained a certain estimate Œº <sub>t</sub> , œÉ <sub>t</sub> for the parameters of the model: <br><img src="http://mathurl.com/cjl2luz.png"><br>  and then received a new point (measurements for the new period of time) <i>n <sub>t</sub></i> , <i>r <sub>t</sub></i> .  Denote <img src="http://mathurl.com/cmnp53y.png">  (effective sample size).  Then we first refine the estimates Œº <sub>t</sub> , œÉ <sub>t</sub> : <br><img src="https://habrastorage.org/getpro/habr/post_images/cfc/647/88c/cfc64788c82bb86c2bca3c7e14225105.png"><br>  and then generate a new prediction for <img src="https://habrastorage.org/getpro/habr/post_images/d73/ffd/0a9/d73ffd0a91341f91d4b5f36ba80f13f3.png">  : <br><img src="http://mathurl.com/d5dew59.png"><br><br>  As a result, we will maintain a pair of numbers for each product (each handle). <img src="http://mathurl.com/amxj323.png">  which will change after each time period.  A list of top products can be generated simply by ordering them by <img src="http://mathurl.com/aomwuy4.png">  (but <img src="http://mathurl.com/csehmux.png">  it is impossible to forget all the same - the variance is needed to recalculate the average later  The approximate behavior of this model on a piece of data from the Yahoo! home page.  shown in the figure below - it looks good. <br><br><img src="https://habrastorage.org/storage2/a9a/865/b5e/a9a865b5e969b860594317eb4eb845e8.png"><br>  (part of a news sample with predictions of the DGP model) <br><br>  Further improvement of this model is due to choosing good prior distributions (good Œº <sub>0</sub> and œÉ <sub>0</sub> ) for new pens - this is very important, because new products (for example, fresh news) need to be quickly put into operation, and firstly data about them not much (the very cold start).  A good estimate of the a priori distribution is obtained from the negative binomial distribution - suppose that we have in the database <i>N</i> historical records ( <i>N</i> other sites) for which the indicators are known <img src="https://habrastorage.org/getpro/habr/post_images/caa/d65/9a9/caad659a97efb7e50f9085852efde886.png">  and <img src="https://habrastorage.org/getpro/habr/post_images/b66/bac/6f7/b66bac6f71790e3e84b645cfe40fd013.png">  (the number of impressions and successful impressions for the first period of time);  we want to get the estimate Œº <sub>0</sub> and œÉ <sub>0</sub> for a new, unknown site, which should approximate well the expected <i>r <sub>1</sub></i> and <i>n <sub>1</sub></i> for the new site.  Again, I omit the math, and the answer is - it should be considered as <br><img src="https://habrastorage.org/getpro/habr/post_images/7fb/013/33f/7fb01333f291cf216b53ecfb4f6bbea0.png"><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/d17/cac/c64/d17cacc649ce2a9d02b6467aab638037.png">  - gamma function.  It is possible to maximize with a gradient lift - from a point we move towards the gradient, i.e.  vectors of private derivatives. <br><br>  Uff.  This installation turned out to be noticeably more ‚Äúmathematical‚Äù than the previous one.  However, if you do not understand the probabilistic inference that occurred above, do not despair - the output, as before, is a simple algorithm that is very easy to implement and that has a sufficiently clear probabilistic rationale (reasonable assumptions in the model).  It can be used in all situations of ‚Äúgangster‚Äù tasks, where you need to quickly respond to changes.  For example, in the same example with A / B testing, which I cited <a href="http://habrahabr.ru/company/surfingbird/blog/168611/">last time</a> , it may well be that the behavior or needs of users change over time, and I want to adjust what you are testing to the current situation.  And for us in Surfingbird, the DGP model is an important model for displaying pages whose popularity can quickly change with time (the same ‚Äúnews‚Äù category, for example);  so we quickly understand when the trend of popularity begins to fade. <br><br>  Next time we will probably talk about some completely different topic;  in addition, stay tuned for a cold start cycle in recommender systems.  To new texts! </div><p>Source: <a href="https://habr.com/ru/post/169573/">https://habr.com/ru/post/169573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169561/index.html">Interactive story of Apple on Fifth Avenue in Unity3D</a></li>
<li><a href="../169563/index.html">HabraReader - easy to read Habrahabr on iOS devices</a></li>
<li><a href="../169565/index.html">Briefly about the new: Samsung launches low-cost touch phones of the REX series</a></li>
<li><a href="../169569/index.html">Kharkiv Ciklum .NET Saturday for real men</a></li>
<li><a href="../169571/index.html">Bees vs. Honey: How Nival put books on Flibusta</a></li>
<li><a href="../169577/index.html">Visual editing of data on the page, using HTML as a data store</a></li>
<li><a href="../169579/index.html">Multivarka - smart pan or "not brought to mind" gadget</a></li>
<li><a href="../169581/index.html">Samsung will leave with Android this year.</a></li>
<li><a href="../169589/index.html">Surface Windows 8 Pro overview and comparison with RT</a></li>
<li><a href="../169591/index.html">Elastix communication with Panasonic TDE 200 and SIPGW16 v SIP card</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>