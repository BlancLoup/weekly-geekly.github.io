<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Persistence 
 Links to all parts: 
 Part 1. Getting Initial Access 
 Part 2. Execution 
 Part 3. Persistence 
 Part 4. Privilege Escalation 
 Part 5. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 3</h1><div class="post__text post__text-html js-mediator-article"><h1>  <a href="https://attack.mitre.org/tactics/TA0003/">Persistence</a> </h1><br>  <b>Links to all parts:</b> <br>  <a href="https://habr.com/post/423405/">Part 1. Getting Initial Access</a> <br>  <a href="https://habr.com/post/424027/">Part 2. Execution</a> <br>  <a href="https://habr.com/post/425177/">Part 3. Persistence</a> <br>  <a href="https://habr.com/post/428602/">Part 4. Privilege Escalation</a> <br>  <a href="https://habr.com/post/432624/">Part 5. Defense Evasion</a> <br>  <a href="https://habr.com/post/433566/">Part 6. Obtaining Credential Access</a> <br>  <a href="https://habr.com/ru/post/436350/">Part 7. Discovery</a> <br>  <a href="https://habr.com/ru/post/439026/">Part 8. Lateral Movement (Lateral Movement)</a> <br><br>  The main task of securing access is to ensure the continuity of the presence in the attacked system, because access can be lost due to restarting the attacked system, loss of credentials or blocking remote access tools due to attack detection. <br><a name="habracut"></a><br>  <i>The author is not responsible for the possible consequences of the application of the information contained in the article, and also apologizes for any inaccuracies in some formulations and terms.</i>  <i>The published information is a free recount of the content of <a href="https://attack.mitre.org/wiki/Main_Page">MITER ATT &amp; CK</a> .</i> <br><br>  Methods to ensure consistency in the system can be divided into 3 categories: <br><ul><li>  Unauthorized creation of accounts or theft of existing credentials; </li><li>  Hidden installation and launch of remote access tools; </li><li>  Making changes to the configuration of the attacked system, with the help of which numerous launching of malicious code becomes possible.  Malicious code can be automatically launched each time the system boots or each user logs into the system, starts modified or malicious services, starts certain programs by the user, starts system or third-party software update processes. </li></ul><br>  The following are the access hardening techniques offered by ATT &amp; CK. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  <a href="https://attack.mitre.org/wiki/Technique/T1156">Modifying the ~ / .bash_profile and ~ / .bashrc Files</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Attackers can insert code into the ~ / .bash_profile and ~ / .bashrc files ( <i>designed to create a user environment in the OS</i> ) that will be executed when the user logs in or starts a new shell.  The ~ / .bash_profile file is executed when a user logs on to the system, ~ / .bashrc is executed when shells are opened interactively.  When a user logs in (locally or remotely, for example via SSH) using the username and password ~ ‚Äã‚Äã/ .bash_profile is executed before the user prompt is returned.  After that, every time a new shell is opened, ~ / .bashrc is executed. <br>  In macOS, Terminal.app is a little different in that it launches the login shell by default each time the terminal window is opened, thereby calling ~ / .bash_profile each time. <br><br>  <i>Security Tips:</i> Granting permissions to modify the ~ / .bash_profile and ~ / .bashrc files only for authorized administrators. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1015">Modifying the executable files of applications "special features Windows" (Accessibility Features)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> "special features" applications (screen magnifier, on-screen keyboard, etc.) can be launched using keyboard shortcuts before the user logs into the system.  An attacker can spoof the startup files of these programs or change the way they are launched and open the command console or get a backdoor without logging in. <br><ul><li>  <i>C: \ Windows \ System32 \ sethc.exe</i> - runs 5 times by pressing the Shift key; </li><li>  <i>C: \ Windows \ System32 \ utilman.exe</i> - launched by pressing the Win + U combination. </li></ul><br>  In WinXP and later versions, sethc.exe and utilman.exe can be replaced, for example, with cmd.exe, and later, when you press the necessary cmd.exe key combination, start up before entering Windows with System privileges. <br>  In Vista and later versions, you need to change the registry key that configures cmd.exe or another program as a debugger, for example, for ultiman.exe.  After editing the registry and pressing the desired key combination on the login screen or when connecting to the host via RDP, cmd.exe will execute with System privileges. <br>  There are also Windows programs that can be used when implementing this attack technique: <br><ul><li>  C: \ Windows \ System32 \ osk.exe; </li><li>  C: \ Windows \ System32 \ Magnify.exe; </li><li>  C: \ Windows \ System32 \ Narrator.exe; </li><li>  C: \ Windows \ System32 \ DisplaySwitch.exe; </li><li>  C: \ Windows \ System32 \ AtBroker.exe. </li></ul><br><br>  <i>Security Recommendations:</i> Configure the launch of the mandatory network authentication of remote users before creating an RDP session and displaying the login screen ( <i>enabled by default in Windows Vista and later versions</i> ).  Use Remote Desktop Gateway to manage connections and RDP security settings. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1182">Key modification AppCert DLLs</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> The DLLs specified in the AppCertDLLs key value are loaded into each process that calls commonly used API functions: <i>CreateProcess, CreateProcessAsUser, CreateProcessWithLoginW, CreateProcessWithTokenW, WinExec</i> .  The value of the AppCertDLLs key can be abused by triggering the loading of a malicious DLL and running certain processes.  AppCertDLLs is stored in the following registry key: <br>  <i>HKEY_LOCAL_MACHINE \ System \ CurrentControlSet \ Control \ Session Manager</i> . <br><br>  <i>Security</i> Tips <i>:</i> Use all sorts of tools to block potentially dangerous software and download unknown DLLs, such as AppLocker and DeviceGuard. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1103">Key modification AppInit DLLs</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description: The</i> DLLs specified in the AppInit_DLLs key value are loaded into each process that loads user32.dll.  In practice, this is almost every program. <br>  AppInit_DLLs is stored in the following registry keys: <br><ul><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Microsoft \ Windows NT \ CurrentVersion \ Windows;</i> </li><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Wow6432Node \ Microsoft \ Windows NT \ CurrentVersion \ Windows.</i> </li></ul><br>  The value of the AppInit_DLLs key can be abused to exceed privileges by loading malicious DLLs and running certain processes.  AppInit_DLLs functionality is disabled in Windows 8 and later versions when secure boot is activated. <br><br>  <i>Security Tips:</i> Consider using OS no earlier than Windows 8 and enabling secure boot.  Use all sorts of tools to block potentially dangerous software and download unknown DLL libraries, such as AppLocker and DeviceGuard. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1138">Abuse of Application Compatibility Subsystem (Application Shimming)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> <i>Microsoft Windows Application Compatibility Infrastructure / Framework is</i> designed to ensure software compatibility with Windows updates and OS code changes.  The compatibility system uses the so-called shim (‚Äúshims‚Äù) - libraries that act as a buffer between the program and the OS.  Using the shim cache, the system determines whether it is necessary to use shim pads (stored in the form of a database of the .sdb type).  The .sdb files store various procedures for intercepting application code, processing it, and further redirecting to the OS.  The list of all shims installed by the installer (sdbinst.exe) is stored by default in: <br><ul><li>  <i>% WINDIR% \ AppPatch \ sysmain.sdb</i> ; </li><li>  <i>HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ AppCompatFlags \ InstalledSDB</i> . </li></ul><br>  Custom shim bases are stored in: <br><ul><li>  <i>% WINDIR% \ AppPatch [64] \ Custom;</i> </li><li>  <i>HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ AppCompatFlags \ Custom</i> . </li></ul><br>  To ensure protection in user mode, the possibility of changing the OS kernel using shim pads is excluded, and administrator rights are required to install them.  However, some shim pads can be used to bypass User Account Control (UAC), DLL injection, disable <a href="">Data Execution Prevention</a> and <a href="https://docs.microsoft.com/ru-ru/windows/desktop/Debug/structured-exception-handling">Srtucture Exception Handling</a> , as well as intercept memory addresses.  The use of shim-pads by an attacker allows you to elevate privileges, install backdoors, disable OS protection, such as Windows Defender. <br><br>  Security Tips <i>:</i> There are not many ways to prevent Application shiming.  Disabling application compatibility is not recommended to avoid OS stability issues.  Microsoft has released <a href="https://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D46804">KB3045645</a> , which will remove the "auto-elevate" flag in the sdbinst.exe file to prevent the use of a shim system to bypass UAC. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1131">Modifying Windows Authentication Package Components</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description: The</i> Windows Authentification Pack DLLs are loaded by the Local Security Authority (LSA) process at system startup and provide support for multiple login processes and multiple OS security protocols.  Malicious users can use the LSA autorun mechanism by placing a link to a binary file in the following registry key: <br>  <i>HKLM \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ Authentication Packages: [target binary]</i> . <br>  The [target binary] will be launched by the system when the <i>Authentication Pack is</i> loaded. <br><br>  <i>Security Tips:</i> In Windows 8.1, Windows Server 2012 R2 and later versions of LSA, you can make it work as a secure process (PPL) using the registry key: <br>  <i>HKLM \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ RunAsPPL = DWORD: 00000001</i> , <br>  which requires that all DLLs loaded by LSA be signed with a Microsoft digital certificate. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1197">Creating BITS Jobs (BITS Jobs)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> <i>Windows Background Intelligent Transfer Service (BITS)</i> is an asynchronous file transfer mechanism through the Component Object Model (COM) using low bandwidth.  BITS is usually used by update programs, instant messengers and other applications that prefer to run in the background without interrupting the work of other network applications.  File transfer tasks are represented as BITS tasks that contain a queue of one or more file operations.  The interface for creating and managing BITS tasks is available in the PowerShell and BITSAdmin tool.  Attackers can use BITS to download, run, and clean up after running the malicious code.  BITS tasks are stored autonomously in the BITS database, and no new files or registry entries are created in the system, BITS is often allowed by the firewall.  Using BITS tasks, you can gain a foothold in the system by creating lengthy tasks (90 days by default) or by calling an arbitrary program after completing a BITS task or an error (including after restarting the OS). <br><br>  <i>Protection recommendations:</i> BITS is a standard OS functionality, the use of which is difficult to distinguish from malicious activity, therefore, the protection vector should be aimed at preventing the attacker from launching tools at the beginning of the attack chain.  A complete disabling of BITS can lead to the termination of updating legitimate software, but you can consider limiting access to the BITS interface for specific users and access groups, you can also limit the lifetime of BITS tasks, which is set by changing the following keys: <br><ul><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Policies \ Microsoft \ Windows \ BITS \ JobInactivityTimeout;</i> </li><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Policies \ Microsoft \ Windows \ BITS \ MaxDownloadTime</i> . </li></ul><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1067">Bootkits</a> </h3><br>  <i>System:</i> Linux, Windows <br>  <i>Rights:</i> Administrator, system <br>  <i>Description:</i> Bootkit is a form of malware that can change the boot sectors of a hard disk, including Master Boot Record (MBR) and Volume Boot Record (VBR).  Malefactors can use Bootkit for fixing in systems at the level below OS.  MBR - section of the hard disk, which is loaded immediately after the completion of the hardware initialization Bios.  An attacker who has access to overwrite the MBR can replace the OS bootloader code with a malicious one.  VBR is the hard disk partition that receives the boot process control from the MBR.  By analogy with the MBR rewrite option, an attacker can run malicious code during the system boot phase. <br><br>  <i>Security Tips:</i> Use MBR and VBR integrity controls.  Application of Trusted Platform Module (TPM) and Secure Boot. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1176">Browser Extensions (Browser Extensions)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> As a rule, plug-ins have all the access and rights that a browser can get.  Malicious plugins can be installed by downloading malicious applications disguised as legitimate programs by using social engineering techniques, phishing, or an attacker who has already compromised the system.  Malicious plugins can in the background open websites, steal information that a user enters in a browser, including credentials, as installers of remote administration tools (RAT) and pinning in the system. <br><br>  <i>Security Tips:</i> Install plugins from trusted sources only.  Control of installed plugins using group policy.  Prevent plug-in installation by regular users.  Inventory and monitoring of installed plugins. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1042">Modify File Association Settings</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, administrator, system <br>  <i>Description:</i> Attackers can modify file associations to launch arbitrary commands.  The choice of associating files with applications is stored in the Windows registry and can be edited by users, administrators, and programs that have access to the registry.  Applications can modify associations to call arbitrary programs.  The system association settings are stored in the registry: <i>HKEY_CLASSES_ROOT \. [Extension]</i> , for example, <i>HKEY_CLASSES_ROOT \ .txt</i> .  The various commands are listed as subsections: <i>HKEY_CLASSES_ROOT \ [handler] \ shell \ [action] \ [command]</i> , for example: <br><ul><li>  <i>HKEY_CLASSES_ROOT \ txtfile \ shell \ open \ [command];</i> </li><li>  <i>HKEY_CLASSES_ROOT \ txtfile \ shell \ print \ [command];</i> </li><li>  <i>HKEY_CLASSES_ROOT \ txtfile \ shell \ printto \ [command];</i> </li></ul><br>  where <i>[command]</i> is a command that will be executed when opening a file with the specified extension. <br><br>  <i>Security Tips:</i> Follow <i><a href="https://msdn.microsoft.com/en-us/library/cc144156.aspx">Microsoft</a></i> 's file association <i><a href="https://msdn.microsoft.com/en-us/library/cc144156.aspx">recommendations</a></i> .  Use all sorts of blocking tools for potentially dangerous software, such as AppLocker and DeviceGuard. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1109">Component Firmware</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> System <br>  <i>Description:</i> Some attackers can use complex tools to compromise computer components and install malicious firmware on them, which will run malicious code outside the operating system or even the main system firmware (Bios).  The technique is the firmware of computer components that do not have a built-in system for checking the integrity of, for example, hard drives.  A device with malicious firmware can provide constant access to the attacked system despite failures and overwriting of the hard disk.  The technique is designed to overcome software protection and integrity control. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1122">Interception of links and links Component Object Model Hijacking</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> <i>Microsoft Component Object Model (COM)</i> is a technology for creating software based on interacting object components, each of which can be used in many programs simultaneously.  Attackers can use COM to insert malicious code that can be executed instead of legitimate via the capture of COM links and connections.  To intercept a COM object, you must replace the reference to the legitimate system component in the Windows registry.  If you further call this component, the malicious code will be executed. <br><br>  <i>Protection recommendations:</i> Preventive measures to prevent this attack are not recommended, as COM objects are part of the OS and software installed in the system.  Locking changes to COM objects can affect the stability of the operating system and software.  It is recommended to direct the protection vector to block malware and potentially dangerous software. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1136">Create Account</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> Intruders who have received sufficient access can create local or domain accounts for further consolidation in the system.  Network user commands can also be used to create accounts. <br><br>  <i>Security recommendations:</i> The use of multifactor authentication.  Configure security settings on important servers, configure access controls, firewalls.  Prevent the use of a domain administrator account to perform daily operations during which an attacker can obtain account information.  Attackers who have created accounts in the system can only get limited access to the network if access levels are properly blocked.  Accounts may be required only to secure access to a separate system. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1038">DLL search interception (DLL Search Order Hijacking)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description: The</i> technique is to exploit the vulnerabilities of the application's search algorithm for the DLL files they need to work ( <a href="https://technet.microsoft.com/ru-ru/library/security/2269637.aspx">MSA2269637</a> ).  Often, the DLL search directory is the working directory of the program, so attackers can replace the original DLL with a malicious one with the same file name. <br>  Remote attacks on DLL search can be carried out when the program installs its current directory in a remote directory, for example, a network share.  Also, attackers can directly change the way the DLL is searched and loaded by replacing the .manifest or .local files that describe the DLL search parameters.  If the attacked program works with high privileges, then the malicious DLL loaded by it will also be executed with high rights.  In this case, the technique can be used to elevate privileges from the user to the administrator or System. <br><br>  Security Tips: Disable remote boot DLL (enabled by default in Windows Server 2012+ and is available with updates for XP + and Server 2003+).  Enable the secure search mode of the DLL, which will limit the search directories to directories such as <i>% SYSTEMROOT%</i> before performing a DLL search in the current application directory. <br>  Enable Secure Search DLL: <br>  <i>Computer Configuration&gt; [Policies]&gt; Administrative Templates&gt; MSS (Legacy): MSS: (SafeDllSearchMode) Enable Safe DLL search mode.</i> <br>  Corresponding registry key: <br>  <i>HKLM \ SYSTEM \ CurrentControlSet \ Control \ Session Manager \ SafeDLLSearchMode.</i> <br>  Consider the feasibility of auditing the protected system to eliminate DLL weaknesses using tools such as the PowerUP module in PowerSploit.  Do not forget about blocking malicious and potentially dangerous software, as well as the implementation of <a href="https://docs.microsoft.com/ru-ru/windows/desktop/Dlls/dynamic-link-library-security">Microsoft recommendations</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1157">Dylib Hijacking interception</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User <br>  <i>Description: The</i> technique is based on the <a href="https://s3.amazonaws.com/s3.synack.com/canSecW.pdf">vulnerabilities of dylib dynamic library search algorithms on macOS and OS X.</a>  The bottom line is the definition of dylib, which loads the attacked application and the subsequent placement of the malicious version of dylib with the same name in the working directory of the application.  This will cause the dylib application to load, which is located in the working directory of the program.  In this case, the malicious Dylib will be executed with the access rights of the attacked application. <br><br>  Security Tips <i>:</i> Prevent users from writing files to dylib search directories.  Vulnerability <a href="https://objective-see.com/products/dhs.html">auditing</a> with Objective-See <a href="https://objective-see.com/products/dhs.html">Dylib Hijacking Scanner</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1133">External Remote Services</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can use an organization‚Äôs external remote services, such as VPN, Citrix, and WinRM, to secure themselves within the attacked network.  Access to services can be carried out with the help of valid accounts obtained using the technician redirecting users to false sites (pharming), or at the stage of network compromise. <br><br>  <i>Security recommendations:</i> Restricting access to remote services using centrally managed switches, using VPN.  Prohibit direct remote access to the internal network through the use of proxies, gateways and firewalls.  Disable services that can be used remotely, for example, WinRM.  The use of two-factor authentication.  Monitoring the activity of using remote services outside working hours. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1044">Lack of permissions at the file system level (File System Permissions Weakness)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> The essence of the technique lies in the substitution of executable files that are automatically launched by various processes (for example, when the OS boots up or at a certain time, in case the rights to executable files are configured incorrectly).  After the substitution, the malicious file will be launched with the rights of the process, so if the process has a higher level of access, the attacker will be able to escalate the privileges.  As part of this technique, attackers may attempt to manipulate the binary files of Windows services. <br>  Another type of attack is associated with deficiencies in the algorithms of self-extracting installers.  During the installation process, installers often unpack various useful files, including .dll and .exe, into the% TEMP% directory, and they may not set the appropriate permissions to restrict access to the unpacked files, which allows attackers to swap files and as a result, increase privileges or bypass account control, because  Some installers are run with extended permissions. <br><br>  <i>Security Tips:</i> Restricting account rights so that only administrators can manage services and interact with the binary files used by the services.  Disabling elevation of privileges for standard users in UAC.  UAC settings are stored in the following registry key: <br><ul><li>  <i>[HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Policies \ System]</i> . </li></ul><br>  To automatically reject requests for elevation of privileges, you need to add a key: <br><ul><li>  <i>"ConsentPromptBehaviorUser" = dword: 00000000.</i> </li></ul><br>  To control the work of installers, you need to add a key: <br><ul><li>  <i>"EnableInstallerDetection" = dword: 00000001</i> , which will require you to enter a password to install programs. </li></ul><br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1158">Hidden files and folders (Hidden Files and Directories)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can use the ability to hide files and folders, so as not to attract the attention of users.  In Windows, users can hide files using the attrib command.  It is enough to specify the attribute + h &lt;file name&gt; to hide the file or "+ s" to mark the file as system.  By adding the "/ S" parameter, the attrib utility will apply the changes recursively.  In Linux / Mac, users can hide files and folders simply by typing a "." At the beginning of the file name.  After this, the files and folders will be hidden from the Finder application and such as the ‚Äúls‚Äù utility.  In macOS, files can be marked with the UF_HIDDEN flag, which will turn on the prohibition of their visibility in Finder.app, but will not prohibit seeing hidden files in Terminal.app.  Many applications create hidden files and folders so as not to clutter up the user's workspace.  For example, SSH utilities create a hidden .ssh folder that stores a list of known hosts and user keys. <br><br>  <i>Protection recommendations:</i> Preventing the use of this technique is difficult due to the fact that file hiding is a regular feature of the OS. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1179">Interception of Windows API function calls (Hooking)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Windows API functions are usually stored in DLLs.  The hooking technique is to redirect calls to API functions through: <br><ul><li>  Hook-procedures - built-in OS procedures that execute code when calling various events, for example, pressing keys or moving a mouse; </li><li>  Modifications of the address table (IAT), in which the pointers to the API functions are stored.  This will allow to ‚Äúdeceive‚Äù the attacked application by forcing it to launch the malicious function; </li><li>  Directly changing the function (splicing), during which the first 5 bytes of the function are changed, instead of which the transition to a malicious or other function defined by the attacker is inserted. </li></ul><br>  Like injections, attackers can use hooking to execute malicious code, disguise its execution, access the memory of the attacked process, and elevate privileges.  Attackers can capture API calls that include parameters containing authentication data.  Hooking is usually used by rootkits to hide malicious activity in the system. <br><br>  <i>Protection recommendations:</i> Interception of events in the OS is part of the normal operation of the system, so any restriction of this functionality may adversely affect the stability of legitimate applications, such as antivirus software.  Efforts to prevent interception techniques need to be focused on the earlier stages of the attack chain.  You can detect malicious hooking activity by monitoring calls to the SetWindowsHookEx and SetWinEventHook functions, using rootkit detectors, analyzing anomalous process behavior. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1062">Hypervisor</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description: A</i> hypervisor can be compromised by an attacker and have rootkits hidden from guest systems. <br>  <i>Security</i> Best Practices <i>:</i> Prevent attackers from accessing privileged user accounts necessary to install and configure the hypervisor. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1183">IFEO injection (Image File Execution Options Injection)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> The Image File Execution Options (IFEO) mechanism allows you to run, instead of a program, its debugger, previously specified by the developer in the registry: <br><ul><li>  <i>HKLM \ Software \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options / [executable]</i> </li><li>  <i>HKLM \ SOFTWARE \ Wow6432Node \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options \ [executable]</i> , where <i>[executable]</i> is the binary executable of the debugger. </li></ul><br>  Like injections, the value of <i>[executable]</i> can be abused by running arbitrary code to elevate privileges or gain a foothold in the system.  Malicious programs can use IFEO to bypass protection by registering debuggers that redirect and reject various system and security applications. <br><br>  <i>Protection recommendations: The</i> described technique is based on the abuse of standard OS development tools, so any restrictions may cause instability in the operation of legitimate software, for example, security applications.  Efforts to prevent the use of IFEO injections need to be focused on earlier stages of the attack chain.  You can detect such an attack by monitoring processes with the flags <i>Debug_process</i> and <i>Debug_only_this_process</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1215">Extensions and loadable kernel modules (Kernel Modules and Extensions)</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> Root <br>  <i>Description:</i> Loadable kernel modules (LKM) are special programs that can be loaded and unloaded from the kernel without the need for a full system reboot.  For example, device drivers are LKM.  Attackers can load malicious LKM using different rootkits.  As a rule, such rootkits disrupt themselves, files, processes, network activity, falsify audit logs, provide backdoors.  Like LKM in macOS, there are so-called KEXTs that are loaded and unloaded by the kextload and kextunload commands. <br><br>  Security tips <i>:</i> Use Linux rootkit detection tools: rkhunter, chrootkit.  Restrict access to the root account, which is required to load modules into the kernel.  Use the SELinux forced access control system. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1161">Modification of the LC_LOAD_DYLIB Addition header in Mach-O files (LC_LOAD_DYLIB Addition)</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mach-O files contain a series of headers that are used to perform certain operations when loading a binary file. </font><font style="vertical-align: inherit;">The LC_LOAD_DYLIB header in Mach-O binaries tells the OS which dylib libraries to load. </font><font style="vertical-align: inherit;">Header changes will invalidate the digital signature, however, an attacker can remove the LC_CODE_SIGNATURE command from a binary file and the system will not check the signature for correctness during its loading. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All binaries must be signed with the correct Apple Developer IDs, and white lists of applications are compiled using known hashes.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1177"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Local Security Authority Drivers (LSASS Driver)</font></font></a> </h3><br>  <i>System:</i> Windows <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Administrator, system </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Local Security Authority (LSA) is a Windows subsystem that provides user authentication. LSA includes several dynamic interconnected DLLs that are executed in the LSASS.exe process. Attackers can attack LSASS.exe by replacing or adding illegitimate LSA drivers and then executing arbitrary code. The technique is implemented in the Pasam and Wingbird malware, which ‚Äúthrow‚Äù modified DLLs used when loading LSASS. In this case, the malicious code is executed before an illegitimate DLL causes a crash and a subsequent crash of the LSASS service. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In Windows 8.1 and Server 2012 R2, enable LSA security by activating the specified key:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ RunAsPPL = dword: 00000001.</font></font></i> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This protection ensures that downloadable LSA plugins and drivers are digitally signed by Microsoft. </font><font style="vertical-align: inherit;">In Windows 10 and Server 16, enable </font></font><a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/credential-guard/credential-guard-manage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Defender Credential Guard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to run lsass.exe in an isolated virtual environment. </font><font style="vertical-align: inherit;">In order to reduce the risk of loading malicious libraries into lsass.exe, enable the safe DLL search mode:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ System \ CurrentControlSet \ Control \ Session Manager \ SafeDllSearchMode.</font></font></i> </li></ul><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1159"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch Agents (Launch Agent)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS</font></font><br>  <i>Rights:</i> User, Administrator <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: The</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> technique is the abuse of the functionality of creating and launching Launch Agent by users - autorun services at the user level. </font><font style="vertical-align: inherit;">When each user logs on, launchd loads the Launcher settings from * .plist files. </font><font style="vertical-align: inherit;">Plist files have an XML structure and contain instructions that tell launchd which executable files and when to launch. </font><font style="vertical-align: inherit;">Plist files can be found in the following directories:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ System / Library / LaunchAgents;</font></font></i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Library / LauncAgents;</font></font></i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ Home / Library / LaunchAgents.</font></font></i> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attackers can also disguise the names of malicious Startup Agents using legitimate program names. </font><font style="vertical-align: inherit;">For example, the Komplex Trojan creates a startup agent: $ HOME / Library / LaunchAgents / com.apple.updates.plist. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using Group Policy, configure a restriction for users to create Launch Agents. </font><font style="vertical-align: inherit;">Creating Startup Agents involves loading or creating plist files to disk, so concentrate protection efforts in the earlier stages of the attack.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1160"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch Daemon</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS</font></font><br>  <i>Rights:</i> Administrator <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: The</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> technique involves the attacker changing the parameters of the services of the system launch level - Launch Daemon, specified in the plist files. </font><font style="vertical-align: inherit;">When booting the system, the Launchd process loads the parameters of services (daemons) from plist files located in the following directories:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / System / Library / LaunchDeamons; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / Library / LaunchDeamons. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launch Daemon can be created with administrator privileges, but will run under the root account, so an attacker can implement privilege escalation. </font><font style="vertical-align: inherit;">The permissions of the plist files must be root: while, however, the script or program specified in it may have less strict permissions. </font><font style="vertical-align: inherit;">Therefore, an attacker can modify the executable files specified in the plist, and thus modify the current system services to be fixed in the system or privilege escalation. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tips </font><i><font style="vertical-align: inherit;">:</font></i><font style="vertical-align: inherit;"> Limit user privileges so that only authorized administrators can create a Launch Daemon. </font><font style="vertical-align: inherit;">Consider monitoring the creation of plist files on your system using applications such as KnockKnock.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1152"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Launchctl Utility</font></font></a> </h3> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Launchctl is a utility for managing Launchd service. With Launchctl, you can manage system and user services (LaunchDeamons and LaunchAgents), as well as execute commands and programs. Launchctl supports command line subcommands, interactive or redirected from standard input: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launchctl submit -l [labelname] - / Path / to / thing / to / execute '' arg "'' 'arg"' '' arg ".</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Starting and restarting services and daemons, attackers can execute code and even bypass the white list if the launchctl is an allowed process, however loading, unloading and reloading services and daemons may require elevated privileges.</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Restricting user rights to create Launch Agents and launch Launch Deamons through group policy. </font><font style="vertical-align: inherit;">Using the KnockKnock app, you can discover programs that use launchctl to manage Launch Agents and Launch Deamons.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1168"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Local Task Scheduling</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Privileges:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator, root </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can create tasks in the attacked systems for unauthorized launch of programs when the system boots or on a schedule. </font><font style="vertical-align: inherit;">On Linux and Apple systems, several methods for scheduling periodic background tasks are supported: cron, at, launchd. </font><font style="vertical-align: inherit;">Unlike Windows Task Scheduler, task scheduling on Linux systems cannot be performed remotely, except for using remote sessions like SSH. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restricting user rights to create scheduled tasks, blocking system utilities and other software that can be used to schedule tasks.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1162"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login Items</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Privileges:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In order to secure the system, attackers can configure their own autorun code using login items (user-defined settings for autorun applications at each login). Login Items created using the Service Management Framework are not displayed in the system settings and can only be deleted through the application in which they were created. Users can manage only those Login Item, which are displayed in the system settings. Such Login Item settings are stored in a plist file in the user directory: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ / Library / Preferences / com.apple.loginitems.plist.</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Applications that are part of the Login Item, at startup, can display windows visible to the user, but you can hide them using the ‚ÄúHide‚Äù option. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restrict user rights to create a Login Item. </font><font style="vertical-align: inherit;">It is worth noting that holding down the shift key while logging in prohibits the automatic launch of applications. </font><font style="vertical-align: inherit;">Monitor the Login Item settings ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System Settings ‚Üí Users and Groups ‚Üí Login Items</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1037"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logon Scripts</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In order to consolidate the system, an attacker can use the ability to create new or modify existing logon scripts ‚Äî scripts that run whenever a particular user or group of users logs on to the system. If an attacker has access to the logon script on a Windows domain controller, he can modify it to execute code in all systems of the domain in order to ‚Äúlateral movement‚Äù over the network. Depending on the permissions for accessing the logon script files (usually such scripts are stored in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\ [DC] \ NETLOGON \</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), an attacker may need local or administrative credentials. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On Mac, logon scripts ( </font></font><a href="https://support.apple.com/de-de/HT2420"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login / Logout Hook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), unlike Login Items, which run in the context of a user, can be run as root. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restricting the rights of administrators to create logon scripts. </font><font style="vertical-align: inherit;">Identification and blocking of potentially dangerous software that can be used to modify login scripts.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1031"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifying Existing Services (Modify Existing Service)</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In order to repeatedly launch malicious code in the system, an attacker can change the configuration of existing services using system utilities or tools for interacting with the Windows API. </font><font style="vertical-align: inherit;">Attackers can intentionally damage or kill a service for later invoking a modified program or service recovery command. </font><font style="vertical-align: inherit;">Using existing services is one of the masquerading techniques that makes it difficult to detect malicious activity. </font><font style="vertical-align: inherit;">Information about the configuration of Windows services, including the path to the programs and commands to start and restore the service, is stored in the registry:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ services</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The configuration of services can be changed using the sc.exe and Reg console utilities. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restricting user and group privileges to change service configurations, giving rights only to authorized administrators. </font><font style="vertical-align: inherit;">Blocking potentially dangerous software. </font><font style="vertical-align: inherit;">You can use the Sysinternals Autoruns utility to examine changes in system services in order to identify attempts to secure an attacker in the system.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1128"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netsh helper utilities (Netsh Helper DLL) utilities</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can execute code using the built-in console utility Netsh, which allows you to load auxiliary DLLs to expand functionality: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh&gt; add helper [DLL Path]</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Information about registered libraries used by netsh is stored in the registry: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ NetSh</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Some corporate VPN clients and network utilities can use netsh.exe, running it on behalf of System, in such a situation, an attacker can register or modify an auxiliary DLL to be executed when the netsh VPN client uses. Tools for implementing this type of attack are included in </font></font><a href="https://cobaltstrike.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CobaltStrike</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (framework for conducting penetration tests).</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Blocking potentially dangerous software using tools such as AppLocker.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New Services (New Service)</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Name access to the system, attackers can create new services and configure their automatic start. </font><font style="vertical-align: inherit;">The service name can be masked using names specific to the operating system. </font><font style="vertical-align: inherit;">Services can be created with administrator privileges, but run as System. </font><font style="vertical-align: inherit;">Services can be created from the command line, using remote access tools with interaction functions with the Windows API or using standard Windows management tools and PowerShell. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tips </font><i><font style="vertical-align: inherit;">:</font></i><font style="vertical-align: inherit;"> Restrict the rights of users to create new services so that only authorized administrators can do this. </font><font style="vertical-align: inherit;">Use AppLocker and </font></font><a href="https://technet.microsoft.com/en-us/library/2008.06.srp.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Software Restriction Policy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1137"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autostart in office applications (Office Application Startup)</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Some mechanisms of MS Office can be used to execute code when launching office applications and, as a result, to ensure that the attackers are consistent in the system: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä¢ Embedding malicious VBA macros into the basic Office templates. Word uses the Normal.dotm template: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C: \ Users \ [Username] \ AppData \ Roaming \ Microsoft \ Templates \ Normal.dotm</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Excel, there is no default template, but you can add it manually, and it will automatically load: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C: \ Users \ [Username] \ AppData \ Roaming \ Microsoft \ Excel \ XLSTART \ Personal.xls</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An attack can only be launched if the " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run all macros</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><font style="vertical-align: inherit;">option is enabled </font><font style="vertical-align: inherit;">in the Office Security Control Center:</font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_CURRENT_USER \ Software \ Microsoft \ Office \ [Version] \ [Application] \ Security \ VBAWarnings: 1;</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Placing a reference to a DLL in the Office test section in the Windows registry causes the specified DLL to be executed each time the Office application is launched: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_CURRENT_USER \ Software \ Microsoft \ Office Test \ Special \ Perf \ [Default]: [Specify the path to the DLL];</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Add an add-in to the Office application with malicious code that will be executed when the attacked application is launched. </font><a href="https://docs.microsoft.com/ru-ru/deployoffice/security/plan-security-settings-for-vba-macros-in-office"><i><font style="vertical-align: inherit;">Security Tips</font></i></a></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Follow </font></font><a href="https://docs.microsoft.com/ru-ru/deployoffice/security/plan-security-settings-for-vba-macros-in-office"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft's Guidelines for Setting Macro Security Settings.</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To prevent the Office Test mechanism from operating, create the specified key in the registry and set read-only permissions on it to prevent access to it without administrator rights. </font><font style="vertical-align: inherit;">If possible, disable Office add-ons, if they are needed, then follow the </font></font><a href="https://docs.microsoft.com/ru-ru/office/dev/add-ins/concepts/privacy-and-security"><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft recommendations</font></font></i></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> when organizing their work.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1034"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Path Interception</font></font></a> </h3><br>  <i>System:</i> Windows <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rights:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator, system </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: The</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> technique for intercepting a path consists of placing the executable file in a directory from which the application will launch it instead of the target file. </font><font style="vertical-align: inherit;">The attacker can use the following methods:</font></font><br><ul><li>  .                , , <i>C:\Program Files\service.exe</i> ,       <i>C:\Program.exe</i> ,  Windows         . </li><li>    .    PATH  <i>C:\example</i>  <i>c:\Windows\System32</i>    <i>C:\example\net.exe</i> ,     net,   <i>C:\example\net.exe</i> ,   <i>c:\Windows\System32\net.exe</i> . </li><li>    (Search order hijacking).        , Windows,  ,        ,      . ,  ¬´example.exe¬ª    cmd.exe      net use.       example.exe  net.exe       <i>c:\Windows\System32\net.exe</i> .  ,     net.com     net.exe,  Windows  net.com     ,     PATHEXT. </li></ul><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The interception of the file search order is also used to execute a DLL using the </font></font><a href="https://attack.mitre.org/wiki/Technique/T1038"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search Hijacking DLL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> technique </font><font style="vertical-align: inherit;">. </font></font></i> <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security Tips:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Highlight the paths specified in the configuration files, scripts, PATH variable, service settings and shortcuts. </font><font style="vertical-align: inherit;">Remember to search for executable files and use only full paths. </font><font style="vertical-align: inherit;">Clean up the old registry keys left over from the remote software so that there are no keys in the registry pointing to non-existent files. </font><font style="vertical-align: inherit;">Set a ban on users to write to the root directory of C: \ and Windows system directories, restrict write permissions to directories with executable files.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1150"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modifying Plist Files (Plist Modification)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rights:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can modify plist files, specifying in them their own code for its execution in the context of another user. </font><font style="vertical-align: inherit;">The plist property files located in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ Library / Preferences</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> run with elevated privileges, and plist from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ / Library / Preferences</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> run with user privileges. </font><font style="vertical-align: inherit;">Security Tips </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prevent plist files from being modified by making them read-only.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1205"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port knocking</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can use the Port Knocking methods to hide the open ports that they use to connect to the system. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Security</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tips </font><i><font style="vertical-align: inherit;">:</font></i><font style="vertical-align: inherit;"> Using stateful firewalls can prevent some Port Knocking options from being implemented.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1013"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port Monitors modification in Print Manager (Port Monitors)</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: The</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attacker can organize the execution of an arbitrary DLL on behalf of the System each time Windows is started using the misuse of the Print Manager settings (Spoolsv.exe). To interact with printing devices, Spoolsv.exe uses the so-called port monitors (port monitor), which are DLLs with which low-level commands are sent to printing devices via LAN, USB, LPT, or COM interfaces. The above DLLs are stored in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C: \ windows \ system32</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and are registered in the registry: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Print \ Monitors</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port Monitor can be installed using the AddMonitor API function or directly by editing the above registry key. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arrange blocking of potentially dangerous software and use application launch control tools. </font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1163"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rc.common</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rights:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> root </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: An</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attacker can add </font><font style="vertical-align: inherit;">code to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/rc.common</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">that will be executed each time the system is started as root. </font><font style="vertical-align: inherit;">Rc.common is a script that runs during OC loading, is the predecessor of Launch Agents and Launh Deamons. </font><font style="vertical-align: inherit;">This is an outdated autorun technology, but it is still supported on macOS and OS X. </font><font style="vertical-align: inherit;">Security tips </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Restrict user privileges to edit the rc.common file.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1164"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Re-launch applications (Re-opened Applications)</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> On systems starting with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OS X 10.7 (Lion)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an attacker can organize the execution of a malicious file every time the OS is rebooted. </font><font style="vertical-align: inherit;">The technique is based on the abuse of the function of restarting applications after the system is rebooted. </font><font style="vertical-align: inherit;">The user can use the tools built into the GUI to tell the system which applications need to be restarted in case of an OS restart. </font><font style="vertical-align: inherit;">These settings are stored in plist files:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ / Library / Preferences / com.apple.loginwindow.plist;</font></font></i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">~ / Library / Preferences / ByHost / com.apple.loginwindows. *. Plist.</font></font></i> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An attacker can modify the above files to execute malicious code every time the system is rebooted. </font><i><font style="vertical-align: inherit;">Security Tips </font></i></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The application restart feature can be disabled using the console command: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defaults write -g ApplePersistence -bool no</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, holding the shift key while loading prevents the application from starting automatically.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1108"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Redundant Access</font></font></a> </h3><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows, Linux, macOS </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permissions:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User, Administrator, System </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attackers can simultaneously use several remote access tools with different control protocols in order to diversify detection risks. So, if one of the remote access tools is detected and blocked, but the protecting party has not identified all the attacker's tools, then the remote access to the attacked network will still be preserved. Attackers can also attempt to gain access to valid accounts of remote corporate services, such as VPN, to gain alternative access to the system in the event of blocking the main tools of remote access. Using a web shell is also one of the methods of remote access to the network through a web server. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitor the presence and blocking the launch of known remote access tools on your network (AmmyAdmin, Radmin, RemotePC, VNC, etc.), use the application launch control tools and blocking potentially dangerous software. </font><font style="vertical-align: inherit;">Implementing IDS and IPS systems that identify specific malware using signatures will reduce the likelihood of a successful attack, but over time, attackers will modify their tools to change the signature and, as a result, bypass IDS and IPS systems.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1060"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autorun using the Run Keys key and the Startup folder (Registry Run Keys / Start Folder)</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description: An</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attacker can add a "run key (run keys)" in the Windows registry or a link to the Startup folder to launch a malicious file when a user logs on. </font><font style="vertical-align: inherit;">The program will run with the rights of the current user. </font><font style="vertical-align: inherit;">Attackers can disguise the launch keys in the registry so that they look like part of legitimate programs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run keys are stored in the following registry keys:</font></font><br><ul><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_CURRENT_USER \ Software \ Microsoft \ Windows \ CurrentVersion \ Run;</font></font></i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_CURRENT_USER \ Software \ Microsoft \ Windows \ CurrentVersion \ RunOnce;</font></font></i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Run;</font></font></i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ RunOnce.</font></font></i> </li></ul><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection recommendations:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Identification and blocking of potentially dangerous software, monitoring changes in the ‚ÄúStartup‚Äù folder and the above registry keys.</font></font><br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1198"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP and Trust Provider Capture (SIP and Trust Provider Hijacking)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://specterops.io/assets/resources/SpecterOps_Subverting_Trust_in_Windows.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subverting Trust in Windows</font></font></a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Attackers can modify the components of the signing architecture and verification of the digital signature of a Windows code in order to bypass the launch control tools that allow only signed code to be run. To create, sign, and verify the signature of files of various formats, Windows uses the so-called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subject Interface Package (SIP)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äîthe software specifications that are unique for each file type, which ensure interaction between the API functions that initiate the creation, calculation and verification of signatures and directly files. The validity of the signature is confirmed by the so-called </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trust Provider</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - these are the software components of the operating system that carry out various procedures related to the calculation and verification of digital signatures.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Popular attack methods: </font></font><br><ul><li> Modifying the <i>DLL</i> and <i>FuncName keys</i> in the <i>CryptSIPDllGetSignedDataMsg</i> section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Cryptography \ OID \ EncodingType 0 \ CryptSIPDllGetSignedDataMsg \ [SIP_GUID]</i> . <br>  It is executed with the purpose of replacing a DLL library that provides the <i>CryptSIPDllGetSignedDataMSG</i> function, which returns a coded digital certificate from a signed file.  A dummy function can always return a previously known valid signature value (for example, a Microsoft signature for executable system files) when using a modified SIP.  The attacker may attempt to apply one valid signature to all files, however, this will most likely lead to the signature being invalid, since the hash returned by the function will not match the hash calculated from the file. </li><li>  Modification of <i>DLL</i> and <i>FuncName keys</i> in the section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Cryptography \ OID \ EncodingType 0 \ CryptSIPDllVerifyIndirectData / [SIP_GUID]</i> . <br>  It is executed with the purpose of replacing the DLL library that provides the <i>CryptSIPDllVerifyIndirectData</i> function, which <i>checks the</i> hash calculated from the file with the hash specified in the digital signature and returns the result of the verification (True / False).  Thus, an attacker can ensure the successful verification of any file using a modified SIP.  The above key values ‚Äã‚Äãcan redirect to a suitable function from an existing library, thus eliminating the need to create a new DLL file on disk. </li><li>  Modification of <i>DLL</i> and <i>FuncName keys</i> in the section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Cryptography \ Providers \ Trust \ FinalPolicy / [Trust Provider GUID]</i> . <br>  It is executed with the purpose of replacing the DLL library that provides the FinalPolicy function for a certain Trust Provider, which decodes, analyzes the signature and makes a decision about trust.  By analogy with CryptSIPDllVerifyIndirectData, the value of the above keys can be redirected to an already existing DLL library. </li></ul><br>  <i>It is important to note that the described attack on the Windows trust mechanism can be accomplished with the help of the Search Order Hijacking DLL.</i> <br><br>  <i>Security recommendations:</i> Make sure that the users of the protected system cannot change the registry keys related to the SIP and Trust Provider components.  Consider removing unnecessary and obsolete SIPs.  Use all sorts of tools to block the download of malicious DLL, for example, AppLocker and DeviceGuard built into Windows. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1053">Scheduled Task</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> Utilities such as at, schtasks and Windows Task Scheduler can be used to schedule the launch of programs and scripts that will be executed at a specific date and time.  The task can be scheduled on the remote system, provided that RPC is used for authentication, and printer and file sharing is enabled.  Scheduling tasks on a remote system requires administrative rights.  An attacker can use remote code execution to gain System privileges or to launch a process under a specific account. <br><br>  <i>Security Tips:</i> Restricting user privileges.  The use of tools, such as the PowerUP module in PowerSploit, which can be used to find weaknesses in the permissions of scheduled tasks.  Disable the ability to launch tasks on behalf of System, disable the <i>Allow server operators to schedule tasks</i> option in the security policy, and enable the <i>User Rights Assignment: Increase scheduling priority</i> option. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1180">Screen saver (screensaver)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can use screen saver settings to launch malware after a certain period of user inactivity. <br>  The Windows Screensaver application (scrnsave.exe) is located in <i>C: \ Windows \ System32</i> , along with other screensavers included in the base OS build.  An attacker can manipulate screen saver settings in the <i>HKEY_CURRENT_USER \ Control Panel \ Desktop</i> registry <i>key</i> : <br><ul><li>  SCRNSAVE.EXE - specify the path to the malicious executable file; </li><li>  ScreenSaveActivr - set the value to "1" to activate the screensaver; </li><li>  ScreenSaverISSecure - set the value to ‚Äú0‚Äù so that the system does not require a password to unlock the Windows desktop after disabling the screensaver; </li><li>  ScreenSaverTimeout - set a period of inactivity before launching the screensaver. </li></ul><br><br>  <i>Security</i> Tips <i>:</i> Block the ability to run * .scr files from non-standard locations.  Manage screen saver settings by using Group Policy, which prohibits local screen saver settings. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1101">Security Support Provider (SPP)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> Attackers can customize the execution of malicious code every time the system is booted or the AddSecurityPackage API function is called by adding a dummy security support provider (SSP) to the Local Security Authority (LSA) configuration.  SSP are software modules (DLLs) containing one or more authentication and cryptography schemes that are loaded into the LSASS process at system startup.  SPP DLLs have access to encrypted and open text passwords stored in Windows.  SPP configuration is stored in two registry keys: <br><ul><li>  <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ Security Packages</i> ; </li><li>  <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ OSConfig \ Security Packages</i> . </li></ul><br>  <i>Protection recommendations:</i> In Windows 8.1, Windows Server R2 and later OS versions, you must activate LSA protected mode (Process Protect Light - PPL), in which all SPP dll files must be signed with a Microsoft digital signature: <br>  <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Lsa \ RunAsPPL = dword: 00000001</i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1058">Service Registry Permissions Weakness Weakness</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> If user and group permissions allow you to change key values ‚Äã‚Äãin the Windows registry that store service settings, then attackers can directly modify the keys that store the paths to the service startup executable files or use various service management tools ‚Äî sc.exe, PowerShell, or Reg.  Attackers can also change the parameters associated with the failure of services, for example, FailureCommand, indicating the command that will be executed in case of failure or deliberate damage to the service.  Service settings are stored in <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ services</i> . <br><br>  <i>Security recommendations:</i> Make sure that the users of the protected system cannot change the keys in the registry that store the parameters of the system components.  Use various means of blocking potentially dangerous software, for example, Windows AppLocker. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1023">Shortcut Modification</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Attackers can create new shortcuts and symbolic links disguised as legitimate programs or modify the paths in existing shortcuts so that their tools are launched instead of the original application. <br><br>  <i>Security</i> Tips <i>:</i> Restrict the rights of users and groups, such as Administrators, to create symbolic links using GPO: <br>  <i>Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; Create symbolic links.</i> <br>  Use tools to block potentially dangerous software and Software Restriction Policy. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1165">Startup Items</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> Administrator <br>  <i>Description: The</i> attacker can use the outdated, but still working in macOS Sierra, application autorun mechanism using StartupItems to configure the launch of its code as root during the OS boot.  StartupItems is the directory in <i>/ Library / Startupitems</i> , the command script and the StartupParameters.plist properties file.  The script and the properties file should be at the top of the hierarchy: <i>/ Library / Startupitems / [MyStartupItem]</i> . <br><br>  <i>Security</i> Tips <i>:</i> Since the StartupItems mechanism is outdated, prohibiting entries in the <i>/ Library / Startupitems / directory</i> will prevent the creation of startup items. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1019">System Firmware (System Firmware)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Particularly sophisticated attackers can modify or reflash Bios, UIFI, or UFI in order to ensure that it is possible to install malicious firmware updates and fix them on the system. <br><br>  <i>Protection recommendations:</i> Direct the protection vector to prevent an attacker from accessing privileged accounts that are necessary to implement the described technique.  Consider the necessity and possibility of using the protected <i>Trusted Platform Module (TPM) system</i> .  Consider the need to use external tools to monitor and analyze the security of system firmware, for example, the <a href="https://github.com/chipsec/chipsec"><i>CHIPSEC Framework</i></a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1209">Providers of time (Time Providers)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Attackers can register a malicious DLL as a Time Provider (Time Provider), which will be executed when the system is started or when the Windows Time Server configuration (W32Time) is changed.  The time provider settings are stored in the registry: <br>  <i>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ services \ W32Time \ TimeProviders</i> . <br>  To register a time provider, administrative rights will be required, but it will be executed in the context of the local service account. <br><br>  Security Tips <i>:</i> Consider using GPO to configure blocking changes to W32Time settings.  Use all sorts of tools to block the download of malicious DLL, for example, AppLocker and DeviceGuard built into Windows. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1154">Trap Team</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> The trap command is used to protect the script from interruptions ( <i>ctrl + c, ctrl + d, ctrl + z</i> , etc.).  If the script receives an interrupt signal specified in the arguments of the trap command, then it processes the interrupt signal itself, and the command shell will not process such a signal.  Attackers can use trap to register code that will be executed when the shell receives certain interrupt signals. <br><br>  <i>Protection recommendations:</i> The use of this technique is difficult to prevent, because the attacker uses regular operating system mechanisms.  The protection vector should be directed to the prevention of malicious actions at earlier stages of an attack, for example, at the delivery stage or the creation of a malicious file in the system. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1078">Valid Accounts (Valid Accounts)</a> </h3><br>  <i>Description:</i> Attackers can steal credentials of a particular user or service account using access credentials technician, capture credentials in the process of exploration using social engineering.  Compromised credentials can be used to bypass access control systems and gain access to remote systems and external services such as VPN, OWA, remote desktop, or gain elevated privileges in certain systems and network areas.  If the script is successfully implemented, attackers can abandon malicious programs to make their detection more difficult.  Also, attackers can create accounts using predefined names and passwords to save backup access in case of unsuccessful attempts to use other means. <br><br>  <i>Security Recommendations:</i> Apply password policy, follow recommendations for designing and administering a corporate network to limit the use of privileged accounts at all administrative levels.  Regular checks of domain and local accounts and their rights in order to identify those that may allow an attacker to gain broad access.  Monitoring account activity using SIEM systems. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1100">Web shell</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Description: An</i> attacker can use the Web Shell as an access gateway to your network or redundant access to the system being attacked, as a backup mechanism for securing in case of detection and blocking of the main access channels to the attacked environment. <br><br>  <i>Protection recommendations:</i> Ensure that your external web servers are updated regularly and do not have known vulnerabilities that allow attackers to upload a file or script to the server and then execute it.  Check that the permissions of the accounts and groups with server management rights do not match the internal network accounts that can be used to log on to the web server, launch the web shell, or pin to the web server.  Web Shell is hard to detect because  they do not initiate connections and their server part may be small and harmless, for example, the PHP version of the China Chopper Web shell looks like a line: <br>  <i>[? php <a href="https://habr.com/ru/users/eval/" class="user_link">eval</a> ($ _POST ['password']);]</i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1084">Windows Management Instrumentation Event Subscription</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> WMI Event Subscription is a functionality that allows the administrator to configure the receipt of event notifications (Events), including those that occurred on remote systems, with the subsequent automatic execution of any actions (script launch, application, etc.).  Attackers, in order to consolidate the system, can abuse the above described functionality, setting up a subscription to such events as the system clock time or computer time, followed by the execution of code when this event occurs. <br><br>  <i>Security Recommendations:</i> Make sure that only administrator accounts have remote connection rights to WMI, and that the protected system does not match the system administrator accounts with other privileged accounts.  Disabling WMI can cause system instability, therefore, requires a preliminary assessment of possible negative consequences. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1004">Winlogon helper dll</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  Description: By modifying the registry settings of auxiliary DLL used by Winlogon.exe, an attacker can ensure that malicious DLLs are repeatedly executed to be fixed to the system.  Winlogon settings are stored in sections: <br><ul><li>  ‚Ä¢ <i>HKEY_CURRENT_USER \ Software \ Microsoft \ Windows NT \ CurrentVersion \ Winlogon</i> </li><li>  ‚Ä¢ <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Winlogon</i> </li></ul><br>  Several vulnerable subsections are known: <br><ul><li>  <i>Winlogon \ Notify</i> - specifies the DLL that handles Windows events </li><li>  <i>Winlogon \ Userinit</i> - points to the userinit.exe file, the user initialization program that is executed when the user logs in; </li><li>  <i>Winlogon \ Shell</i> - points to the file explorer.exe, the system shell that runs when a user logs on. </li></ul><br>  <i>Security Tips:</i> Ensure that only authorized administrators can change Winlogon settings.  Use all sorts of tools to block the download of malicious DLLs and potentially dangerous programs, for example, built-in Windows AppLocker and DeviceGuard. </div><p>Source: <a href="https://habr.com/ru/post/425177/">https://habr.com/ru/post/425177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425167/index.html">Dialects of English: how to understand the interlocutor, without breaking his brain</a></li>
<li><a href="../425169/index.html">Stop for a moment! Meet normcore marketing</a></li>
<li><a href="../425171/index.html">Solid technology: it's time to rebuild the web</a></li>
<li><a href="../425173/index.html">Full amnesty. Putin introduced a bill on the partial decriminalization of article 282 on extremism on the Internet</a></li>
<li><a href="../425175/index.html">A little bit about sound cards with OPL2 / 3 FM synthesizers for PC ...</a></li>
<li><a href="../425179/index.html">YouTube stars are starting to burn at work: "the attractiveness of the most interesting of the works faded"</a></li>
<li><a href="../425181/index.html">Frankie Zapata for The Verge: ‚ÄúTurbo-jet fuel will help melt reinforced concrete skepticism‚Äù</a></li>
<li><a href="../425187/index.html">Intel PAC with FPGA Stratix 10 SX - an accelerator for large tasks</a></li>
<li><a href="../425191/index.html">Fastware</a></li>
<li><a href="../425195/index.html">Black, white and gray lists on guard of enterprise security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>