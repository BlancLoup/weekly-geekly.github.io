<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determining network topology at OSI levels 2/3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the important technologies of any serious network monitoring system is the method of detecting network element connections at the 2nd and 3rd l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determining network topology at OSI levels 2/3</h1><div class="post__text post__text-html js-mediator-article">  One of the important technologies of any serious network monitoring system is the method of detecting network element connections at the 2nd and 3rd level of the OSI model. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8e0/6fb/c07/8e06fbc07fec4de782afaae1146b3962.png"></div><br><br>  From the point of view of algorithms, this task is one of the most interesting ones we encountered during the development of our system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We decided to share our experience a bit, so you can imagine how a beautiful graph of connections between nodes appears on the dashboards of your monitoring system. <br><a name="habracut"></a><br>  Network topology is a way of describing network configuration, the layout and connections of network devices.  We will consider a TCP / IP network based on three types of network devices: switches, routers, and end stations.  We will also assume that network devices, switches and routers provide an open interface for polling via SNMP. <br><br>  To describe the topology, it is convenient to consider the OSI model of the network as a multi-storey building which is based on the foundation - this is the physical level, and the floors form a channel and network level, each subsequent level builds on the building and thus ensures the integrity and functionality of the whole structure.  The task of the entire building is to provide its inhabitants, that is, various applications, with communication with each other. <br><br>  Network Manager implements a search algorithm for communications between heterogeneous devices, supporting various network topology configuration protocols, Spanning Tree Protocol (STP), Link Layer Discovery Protocol (LLDP) and Cisco Discovery Protocol (CDP).  The software system architecture allows you to implement support for new protocols to detect both links at the 2nd and 3rd level of the OSI model, as well as any other logical connections between elements of the IT infrastructure. <br><br>  At the data link layer, communications between devices are called second layer communications (or L2 communications).  They can be specified by specifying a port pair of two directly connected switches, or a switch and an end station, or a switch and a router. <br><br>  Switches support a dynamic forwarding table (AFT, address forwarding table), which stores the corresponding MAC address of the node to the switch port.  This information is available through dynamic tables accessible via SNMP in the switch's BRIDGE-MIB ( <i>dot1dBasePortTable</i> , <i>dot1dTpFdbTable</i> ). <br><br>  We will say that the switch sees this network device on this port if its dynamic forwarding table contains an entry that indicates to forward the datagrams intended for this network device through this port. <br><br>  For a switch with BRIDGE-MIB database support, you can <i>read dot1dBasePortTable</i> , determine the correspondence between the interface number and the port number, and the available interfaces are determined by the MIB-II database ( <i>ifTable</i> table).  This allows us to consider data on 2nd and 3rd level links in a unified way. <br><br>  To store intermediate results in Network Manager, a topological database is used, which provides a common interface for working with the network graph and its specializations intended for work at the channel and network layers. <br><br>  Automatic determination of the network topology is divided into two phases: data collection and their subsequent analysis.  Data from network devices is collected in a topological database, using SNMP queries to network databases of network devices, and the types of devices and their network interfaces are determined. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ea3/61c/8f7/ea361c8f7f5548b28b1564e2c27a15ce.png"></div><br><br>  At the second stage, the available data is analyzed using the selected protocols for determining the network topology; for the implementation of the algorithms, the Internet-accessible articles 1, 2 and 5 are used. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b1d/476/f0b/b1d476f0bc144786baa3efbd6035f264.png"></div><br><br>  The difficulty in determining the heterogeneous network topology is that the switch forwarding tables are dynamic, they store the MAC address of the destination address and the corresponding port for some limited time specified in the device configuration and generally, at the time of the study, not all network devices exchanged datagrams and as a result routers may not have complete information about all available network devices and their connections.  In addition, many corporate networks have unmanaged switches, and some switches may not be connected to the monitoring system or incorrectly support the necessary SNMP MIBs.  However, if there is a network device visible on all network switches, then incomplete forwarding tables can unambiguously restore the network configuration (3). <br><br>  Network heterogeneity also affects the interpretation of data received from switches that support LLDP and CDP protocols, because their proper operation requires that all nearby network devices support either LLDP or CDP protocol.  As a result, the information obtained from these protocols only makes it possible to conclude that the two data network devices see each other on certain ports, but it does not make it possible to directly identify them as the nearest ‚Äúneighbors‚Äù. <br><br>  The search algorithm for the heterogeneous network topology, implemented in AggreGate Network Manager, primarily determines the connections between the switches.  The general essence of the algorithm can be described as follows: <br><br>  Consider two switches "A" and "B", located on the same subnet.  If switch ‚ÄúA‚Äù sees switch ‚ÄúB‚Äù on port ‚Äúa‚Äù, and switch ‚ÄúB‚Äù sees switch ‚ÄúA‚Äù on port ‚ÄúB‚Äù and there is no other network device in their tables that is simultaneously visible on ports ‚Äúa‚Äù and ‚Äú b ", then switches" A "and" B "are connected directly to the data link layer (see 1, 3 and 5).  After finding the connection, we remove the corresponding interfaces from the cache of the forwarding tables and continue the analysis of the information remaining in the tables, gradually finding the remaining connections using the exception method. <br><br>  At the next stage, possible connections between switches and end stations are determined.  To do this, search for the nearest switch is used: if the switch sees the end station on this port and it sees another switch on the same port, then, in the absence of network hubs, the switch cannot be the closest one (see 4).  On the other hand, if the switch on the port under study sees only one end station, then this switch and the station are the nearest neighbors in our network. <br><br>  With the topology of the IP-level (L3) things are much easier.  Layer 3 links are quite easily determined by the routing tables ( <i>ipRouteTable</i> ), also accessible via SNMP. <br><br>  Understanding that the versatility of our product will force us to deal with various types of topology in the future, we have designed the visual component ‚Äúgraph of topology‚Äù so that it can work with arbitrary tables containing descriptions of nodes and edges of the topology graph.  And, as usual, with the availability of a tool, new applications were quickly found for him: <br><br><ul><li>  Route Topology EIGRP, OSPF, BPG, etc. </li><li>  Visualize paths in the MPLS cloud </li><li>  SDH / PDH topology </li><li>  Visualize links between hypervisors and virtual machines running on them </li><li>  Manually added parent-child links between nodes </li><li>  Graph of the dependence of IT service components on infrastructure elements </li></ul><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b62/31e/e25/b6231ee251a44dad92a69fe1601356b8.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0ee/c9c/05a/0eec9c05adb14c4ba0f5d843d369905c.png"></div><br><br>  All technologies described in this article have been tested and implemented in our <a href="http://aggregate.tibbo.com/ru/solutions/network_management.html">AggreGate Network Manager</a> product.  The operation of communication definition algorithms in conditions of insufficient data (not all switches and routers are connected via SNMP, incorrect support of necessary MIBs, etc.) is far from trivial, so we continue to improve them to this day. <br><br>  What to read on: <br><br><ol><li>  <a href="http%253A%252F%252Fieeexplore.ieee.org%252Fxpls%252Fabs_all.jsp%253Farnumber%253D1306489">Topology Discovery in Heterogeneous IP Networks: The NetInventory System</a> .  Y.Breitbart, M.Garofalakis, B.Jai, C.Martin, R.Rastogi, and A.Silberschatz IEEE / ACM TRANSACTIONS ON NETWORKING, VOL.  12, NO.  3, JUNE 2004 </li><li>  <a href="http%253A%252F%252Fw3.tmit.bme.hu%252Fcourses%252Fonlab%252Flibrary%252Fpapers%252Fstott02pathdisco.pdf%26ei%3DZWtVVYXQLIqssgGkooDQAQ%26usg%3DAFQjCNFWl21_3XxgE3teJ5tEoGzc-ucD1Q%26sig2%3D1u3TxSyEjcHc2_tMt4Pd3g%26bvm%3Dbv.93564037,d.bGg%26cad%3Drjt">Layer-2 Path Discovery Using Spanning Tree MIBs</a> .  David T. Stott, Avaya Labs Research, Avaya Inc., Basking Ridge, NJ, Tech.  Rep </li><li> <a href="https%253A%252F%252Fwww.kent.edu%252Fsites%252Fdefault%252Ffiles%252FTR-KSU-CS-2007-03.pdf%26ei%3DF2xVVabeJMGasgHiqYGgAQ%26usg%3DAFQjCNHvo4jN3f7myLeuc9Y1fGGtDZjmpw%26sig2%3DX4bWr9qXFzU9afs13BXWdg%26bvm%3Dbv.93564037,d.bGg%26cad%3Drjt">Finding Ethernet-Type Network Topology is Not Easy</a> .  H. Gobjuka, Y. Breitbart, Technical Report: TR-KSU-CS-2007-03, Kent State University, 2007. </li><li>  <a href="http://www.mathnet.ru/php/archive.phtml%3Fwshow%3Dpaper%26jrnid%3Dvmp%26paperid%3D272%26option_lang%3Drus">Automatic detection and description of the network infrastructure of supercomputers</a> .  V. Voevodin, K. Stefanov, Computational Methods and Programming.  2014. T. 15 </li><li>  <a href="http%253A%252F%252Fieeexplore.ieee.org%252Fxpls%252Fabs_all.jsp%253Farnumber%253D4897254">IP Network Topology Discovery Using SNMP</a> .  Suman Pandey, Mi-Jung Choi, Sung-Joo Lee, James W. Hong, Dept.  of Computer Science and Engineering, POSTECH, Korea </li></ol></div><p>Source: <a href="https://habr.com/ru/post/257911/">https://habr.com/ru/post/257911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257897/index.html">That's the point, sailed! We learn to work with floating-point numbers and develop an alternative with fixed decimal precision.</a></li>
<li><a href="../257899/index.html">Revelations metaprogrammer. We program the code at compile time, use C ++ templates for non-template solutions.</a></li>
<li><a href="../257903/index.html">Introduction to functional programming in Python</a></li>
<li><a href="../257905/index.html">Travel SIM + cloud PBX and new approaches to the IP-PBX interface</a></li>
<li><a href="../257909/index.html">Sergey Borisyuk: ‚ÄúThe most important thing in startups is the focus‚Äù</a></li>
<li><a href="../257913/index.html">As I wrote a Docker container launch audit on Go</a></li>
<li><a href="../257915/index.html">How to use progressive improvement for the layout of letters</a></li>
<li><a href="../257917/index.html">What gives the translation of the description and keywords for the mobile application. The results of a big experiment</a></li>
<li><a href="../257919/index.html">Need for speed: Optimization of the trading terminal performance</a></li>
<li><a href="../257921/index.html">Open Document Document Generator (ODF) on Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>