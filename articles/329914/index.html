<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do i make backups. DBMS FireBird</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The trouble came from not having waited ... The client had a cashier process, so it could not withdraw the process through the Task Manager. Workplace...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do i make backups. DBMS FireBird</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c7/2be/6b9/6c72be6b9ba7d9a68c34718248ac1ee6.png" alt="image"></div><br>  The trouble came from not having waited ... The client had a cashier process, so it could not withdraw the process through the Task Manager.  Workplace "Cashier" - at the same time the server of the entire system. <br><br>  The client decided to reset via the button. <br><br>  As a result, DB died.  FireBird 2.5 <br><a name="habracut"></a><br>  Backups were not configured, so the latest version of the database, which happened to be on my screw, was minus 8 days.  Raised in a quick way with her.  But the essence is further. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How to make backups for FireBird. <br><br>  I wrote a script that, when it is launched, backs up a database with the name BaseDanna_30_05_2017_23_07_51.fbk <br><br><pre><code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "currentTime=%<span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>: =<span class="hljs-number"><span class="hljs-number">0</span></span>%" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> now=<span class="hljs-variable"><span class="hljs-variable">%date:~-4%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%date:~3,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%date:~0,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%currentTime:~0,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%currentTime:~3,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%currentTime:~6,2%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> user=SYSDBA <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> password=masterkey <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> database_name=PARKDB.FDB <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> backup_name=Backup\PARKDB <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ext=.fbk <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> backup_filename=<span class="hljs-variable"><span class="hljs-variable">%backup_name%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%now%</span></span><span class="hljs-variable"><span class="hljs-variable">%ext%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">%backup_filename%</span></span> nbackup -U <span class="hljs-variable"><span class="hljs-variable">%user%</span></span> -P <span class="hljs-variable"><span class="hljs-variable">%password%</span></span> -B <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-variable"><span class="hljs-variable">%database_name%</span></span> <span class="hljs-variable"><span class="hljs-variable">%backup_filename%</span></span></code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-variable"><span class="hljs-variable">%date:~3,2%</span></span></code> </pre> <br>  This means taking from the result date (this is a Windows system function), 2 characters, starting at position 3 in a line.  Normal% date% = 05/31/2017 <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> "currentTime=%<span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>: =<span class="hljs-number"><span class="hljs-number">0</span></span>%"</code> </pre> <br>  It means taking time, considering 0, when the clock is less than 10, that is, without this command, we are in the execution of commands: <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> now=<span class="hljs-variable"><span class="hljs-variable">%date:~-4%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%date:~3,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%date:~0,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%currentTime:~0,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%currentTime:~3,2%</span></span>_<span class="hljs-variable"><span class="hljs-variable">%currentTime:~6,2%</span></span></code> </pre><br>  would get that now = 2017_05_31_ 0_44_33, and the file name would look like this: Backup \ PARKDB_2017_05_31_ 0_44_33.fbk.  The space is not very visible, but it is not acceptable in the file name for nbackup, the date and time are taken from the current system time.  It‚Äôs kind of told :) Next, to keep the script running constantly, I added a task to the Windows task scheduler, it runs my script every 4 hours and a new database is created, then I learned how to create tasks in the task scheduler via the command line: <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> script_name=e:\SoftBuild\Parking\DB\DB_Backup.bat <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> task_name=LotParkingBackup SCHTASKS /Create /SC DAILY /TN <span class="hljs-variable"><span class="hljs-variable">%task_name%</span></span> /TR <span class="hljs-variable"><span class="hljs-variable">%script_name%</span></span> /HRESULT /F /RI <span class="hljs-number"><span class="hljs-number">240</span></span> /DU <span class="hljs-number"><span class="hljs-number">24</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> /v1</code> </pre><br>  Details of the parameters can be found in the help.  SCHTASKS / Create /? <br><br>  Then I added a script to the installer that does what I just described and starts from the installer: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NextButtonClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CurPageID: Integer)</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ServerHost, ServerPort, DBFileName, FBDirPath: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; ResultCode, ErrorCode: Integer; UDFFrom, UDFTo, ReaderPort: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; RegistryTaskFile, DBDirPath, BackupScriptPath, RegistryFileName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> CurPageID = SettingsPage.ID <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ServerHost := SettingsPage.Values[<span class="hljs-number"><span class="hljs-number">0</span></span>]; ServerPort := SettingsPage.Values[<span class="hljs-number"><span class="hljs-number">1</span></span>]; DBFileName := SettingsPage.Values[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> IsComponentSelected(cDB) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> DBDirPath := Copy(DBFileName, <span class="hljs-number"><span class="hljs-number">1</span></span>, Pos(<span class="hljs-string"><span class="hljs-string">'PARKDB.FDB'</span></span>, DBFileName) - <span class="hljs-number"><span class="hljs-number">1</span></span>); BackupScriptPath := DBDirPath + <span class="hljs-string"><span class="hljs-string">'DB_Backup.bat'</span></span> RegistryTaskFile := <span class="hljs-string"><span class="hljs-string">'@echo off'</span></span> + <span class="hljs-string"><span class="hljs-string">#13#10</span></span> + <span class="hljs-string"><span class="hljs-string">'set script_name='</span></span> + BackupScriptPath + <span class="hljs-string"><span class="hljs-string">#13#10</span></span> + <span class="hljs-string"><span class="hljs-string">'set task_name=LotParkingBackup'</span></span> + <span class="hljs-string"><span class="hljs-string">#13#10</span></span> + <span class="hljs-string"><span class="hljs-string">'SCHTASKS /Create /SC DAILY /TN %task_name% /TR %script_name% /HRESULT /F /RI 240 /DU 24:00 /v1'</span></span> + <span class="hljs-string"><span class="hljs-string">#13#10</span></span>; RegistryFileName := DBDirPath + <span class="hljs-string"><span class="hljs-string">'DB_RegistryBackup.bat'</span></span>; SaveStringToFile(RegistryFileName, RegistryTaskFile, False); Exec(ExpandConstant(RegistryFileName), <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, SW_SHOW, ewWaitUntilTerminated, ResultCode); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Now I have a script that makes a backup copy, and a script that registers the task, then I learned to delete the task from the scheduler, again from the command line: <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> task_name=LotParkingBackup SCHTASKS /DELETE /TN <span class="hljs-variable"><span class="hljs-variable">%task_name%</span></span> /F</code> </pre><br>  And added to the installer.  that if we do the removal of the Parking program, then we need to run a script that deletes the task from the Scheduler: <br><br><pre> <code class="delphi hljs">[UninstallRun] Filename: "<span class="hljs-comment"><span class="hljs-comment">{app}</span></span>\DB\DB_DeleteTask.bat"; WorkingDir: "<span class="hljs-comment"><span class="hljs-comment">{app}</span></span>\DB\"; Flags: runhidden waituntilterminated; Components: DB</code> </pre><br>  As a result, we have a backup every 4 hours, and if we do UnInstall, then everything is clean :) <br><br>  <a href="http://programmingmindstream.blogspot.com/2017/05/1356-firebird.html">Original.</a> </div><p>Source: <a href="https://habr.com/ru/post/329914/">https://habr.com/ru/post/329914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329902/index.html">Routers, attack vectors and other adventures of Shurik</a></li>
<li><a href="../329904/index.html">How to use a token to make a Windows domain safer? Part 2</a></li>
<li><a href="../329906/index.html">I want to break free. What and how to learn to escape from 1C</a></li>
<li><a href="../329908/index.html">Visual Studio Mobile Center: Deploy mobile software using Microsoft devops pipeline</a></li>
<li><a href="../329910/index.html">Analysis of changes in the game</a></li>
<li><a href="../329916/index.html">5 sources about algorithmic design, if you just started to be interested in them</a></li>
<li><a href="../329918/index.html">Native EcmaScript modules: new features and differences from webpack</a></li>
<li><a href="../329920/index.html">Multistage backup storage for the smallest</a></li>
<li><a href="../329922/index.html">The science of neural networks. Live</a></li>
<li><a href="../329924/index.html">Hibernate + jsp with servlet support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>