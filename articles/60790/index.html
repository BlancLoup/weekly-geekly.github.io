<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program Windows 7: Taskbar. Part 8 - IconicThumbnail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I talked about how you can influence the preview windows in the Windows 7 taskbar. Then we displayed only that part of the window that is mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program Windows 7: Taskbar. Part 8 - IconicThumbnail</h1><div class="post__text post__text-html js-mediator-article">  Recently, I talked about how you can influence the preview windows in the Windows 7 taskbar. Then we displayed only that part of the window that is most important to the user.  Nevertheless, in certain situations it may be much more useful to display not part of the window, but a completely different picture showing the state of the application. <a name="habracut"></a><br><br>  For example, Windows Live Messanger takes advantage of this opportunity.  If we hover the mouse over the WLM icon, it will display the current user's avatar in a pop-up window. <br><br><div style="text-align:center;"><img src="http://blogs.gotdotnet.ru/personal/sergun/content/binary/WindowsLiveWriter/Windows7Taskbar.8ThumbnailClip_A017/image_6c34b435-8afe-4a4c-8f17-538e120b2db8.png"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's look at this feature of the Windows 7 taskbar. To implement this behavior, the SetIconicThumbnail method exists in the .NET Interop Sample Library.  It is with its help that we can easily and simply create our own preview for our window.  However, before we start using it, we must enable this behavior using the EnableCustomWindowPreview method.  Otherwise, when executing the SetIconicThumbnail method, we will get a corresponding exception.  This can be done directly in the form designer. <br><br> <code>public Form1() <br> { <br> InitializeComponent(); <br> WindowsFormsExtensions.EnableCustomWindowPreview(this); <br> }</code> <br> <br>  It should be said that the size of the image that we want to display in the preview is limited.  This is logical, because  imagine what it would be like if the preview could be 1024x768 in size.  These dimensions are limited to 200x120.  The image may be smaller than this size, in which case the preview window itself will also be reduced.  If the image is larger than this size, an exception will be generated. <br><br>  In the parameters of the SetIconicThumbnail method, a link is sent to the current form and the image (Bitmap) to be displayed.  Our task is to generate this bitmap.  And in this case, our hands are completely untied - we can generate anything we want.  This may be a snapshot of the window, with some additional text on top.  This may be some kind of own picture containing information.  This may be a text with some statistics.  It all depends on your imagination. <br><br>  In the demo application, I will generate an image that displays the status of the application with text and graphically, as well as a small snapshot of the window.  For this, I will create a Bitmap of the sizes I need and fill it with a background.  After that I will draw there a state image and a snapshot of the window.  Then I will write the state text on this image and transfer the result to the SetIconicThumbnail method. <br><br> <code>private static void SetState(Form form, string stateText, Image stateImage) <br> { <br> // blank image <br> var preview = new Bitmap(200, 120); <br> var g = Graphics.FromImage(preview); <br> // fill background <br> g.DrawImage(Images.background, 0, 0); <br> // file image of state <br> if (stateImage != null) <br> { <br> g.DrawImage(stateImage.GetThumbnailImage(100, 100, null, IntPtr.Zero), 100, 10); <br> } <br> // fill image of form <br> g.DrawImage(GetFormImage(form, 50, 60), 10, 10); <br> // draw text <br> g.DrawString(stateText, new Font("Verdana", 18), Brushes.White, 10, 70); <br> // setting thumbnail <br> WindowsFormsExtensions.SetIconicThumbnail(form, preview); <br> }</code> <br> <br>  As you can see, the code is rather concise.  As a result, we can see a window with the following preview. <br><br><div style="text-align:center;"><img src="http://blogs.gotdotnet.ru/personal/sergun/content/binary/WindowsLiveWriter/Windows7Taskbar.8ThumbnailClip_A017/image_2e1a272a-5eb1-40bd-82b1-eb2ff62d6aba.png"></div><br><br>  Interestingly, our application can change this state in the background itself.  At the same time, if the mouse is on the application icon and the preview is currently displayed, then the image change in the pop-up window occurs smoothly, without any side effects.  So, for example, I can create a timer in the handler of which I can change the state at regular intervals. <br><br> <code>private readonly string[] _stateTexts = new[] { "Deleting..", "Wireless", "Security", "Stop", "Help", "O'kay", "Playing", "Login", "Warning", "Showcase", "Search", "Processing..", "Locked", "Error", "Refreshing.." }; <br> private readonly Bitmap[] _stateImages = new[] { Images._104, Images._110, Images._111, Images._112, Images._113, Images._114, Images._120, Images._125, Images._129, Images._134, Images._17, Images._25, Images._41, Images._50, Images._52 }; <br> private int _currentIndex = 0; <br> private void timer1_Tick(object sender, EventArgs e) <br> { <br> if (_currentIndex + 1 &gt;= _stateImages.Length) <br> { <br> _currentIndex = 0; <br> } <br> else <br> { <br> _currentIndex++; <br> } <br> SetState(this, _stateTexts[_currentIndex], _stateImages[_currentIndex]); <br> }</code> <br> <br><div style="text-align:center;"><img src="http://blogs.gotdotnet.ru/personal/sergun/content/binary/WindowsLiveWriter/Windows7Taskbar.8ThumbnailClip_A017/image_d43cbee6-04c3-4088-8174-862250fb6982.png"></div><br><br><div style="text-align:center;"><img src="http://blogs.gotdotnet.ru/personal/sergun/content/binary/WindowsLiveWriter/Windows7Taskbar.8ThumbnailClip_A017/image_f81165d3-25e3-44b2-b1e2-f1f94d2e4dd8.png"></div><br><br><div style="text-align:center;"><img src="http://blogs.gotdotnet.ru/personal/sergun/content/binary/WindowsLiveWriter/Windows7Taskbar.8ThumbnailClip_A017/image_71165c88-f895-431a-a3e6-355bdcf3e3f2.png"></div><br><br>  In this case, the preview window of our application will change dynamically, and the user can monitor this state easily and conveniently. <br><br>  Demo application: <br>  <a href="http%253A%252F%252Fblogs.gotdotnet.ru%252Fpersonal%252Fsergun%252Fcontent%252Fbinary%252FWindowsLiveWriter%252FWindows7Taskbar.8ThumbnailClip_A017%252FTaskbar-IconicThumbnail.zip">Taskbar-IconicThumbnail.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/60790/">https://habr.com/ru/post/60790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../60780/index.html">Excursion to nic.lv - continuation of the topic of ‚Äúdomain theft‚Äù</a></li>
<li><a href="../60782/index.html">Face Detection on Java is easy!</a></li>
<li><a href="../60785/index.html">Idea: Content Management System for a software product</a></li>
<li><a href="../60788/index.html">We program Windows 7: Taskbar. Part 7 - ThumbnailClip</a></li>
<li><a href="../60789/index.html">The inaccessibility of foreign Internet resources from Corbina</a></li>
<li><a href="../60791/index.html">We program Windows 7: Taskbar. Part 9 - PeekBitmap</a></li>
<li><a href="../60792/index.html">We program Windows 7: Taskbar. Part 10 (final) - JumpLists</a></li>
<li><a href="../60793/index.html">Reflections on the mobile phone market</a></li>
<li><a href="../60796/index.html">Google Wave - watch video</a></li>
<li><a href="../60803/index.html">Push mi, boom boom, touch mi ... Ajax Push Engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>