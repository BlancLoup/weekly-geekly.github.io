<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Component UI architecture in iOS application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 My name is Valera, and for two years now I've been developing an iOS application as part of the Badoo team. One of our priorities is easi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Component UI architecture in iOS application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/x8/bs/so/x8bsso8hy3rdfn3ostzyohesvyc.jpeg"><br><br>  Hi, Habr! <br><br>  My name is Valera, and for two years now I've been developing an iOS application as part of the Badoo team.  One of our priorities is easily maintainable code.  Because of the large number of new features that come into our hands every week, we first need to think about the architecture of the application, otherwise it will be extremely difficult to add a new feature to the product without breaking existing ones.  Obviously, this also applies to the implementation of the user interface (UI), regardless of whether it is done using code, Xcode (XIB) or a mixed approach.  In this article I will describe some of the UI implementation techniques that allow us to simplify the development of the user interface, making it flexible and convenient for testing.  There is also an <a href="https://badootech.badoo.com/ios-ui-development-in-badoo-592d76dc5b37">English</a> version of this article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Before you begin ... </h2><br>  I will consider the methods of implementing the user interface on the example of an application written in Swift.  The application by clicking on the button shows a list of friends. <br><br>  It consists of three parts: <br><br><ol><li>  <b>Components</b> - custom UI-components, that is, code related only to the user interface. </li><li>  <b>Demo application</b> - demo view models and other user interface entities that have only UI dependencies. </li><li>  <b>The real application</b> is view models and other entities that may contain specific dependencies and logic. </li></ol><br>  Why such a separation?  I will answer this question below, but for now check out the user interface of our application: <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/vt/gl/nrvtglcxbhadi2ag4ohcuazdhqk.gif" height="600"></div><br>  This is a pop-up view with content on top of another full-screen view.  It's simple. <br><br>  The full source code of the project is available on <a href="https://github.com/chupakabr/ios-ui-techniques-example">GitHub</a> . <br><br>  Before delving into the UI code, I want to introduce you to the Observable helper class used here.  Its interface looks like this: <br><br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> closure: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> old: T, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> new: T)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">ObserverProtocol</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observeNewAndCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> closure: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> new: T)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">ObserverProtocol</span></span></code> </pre> <br>  It simply notifies all previously signed observers about the changes, so this is a kind of alternative to KVO (key-value observing) or, if you will, reactive programming.  Here is an example of use: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.observers.append(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel.items.observe { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (_, newItems) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.state = newItems.isEmpty ? .zeroCase(type: .empty) : .normal   <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.collectionView.reloadSections(IndexSet(integer: <span class="hljs-number"><span class="hljs-number">0</span></span>)) })</code> </pre> <br>  The controller subscribes to changes in the <code>self.viewModel.items</code> property, and when a change occurs, the handler executes the business logic.  For example, it updates the view state and reloads the collection view with new elements. <br><br>  You will see more usage examples below. <br><br><h2>  Techniques </h2><br>  In this section, I will talk about four UI development techniques that are used in Badoo: <br><br>  1. The implementation of the user interface in the code. <br><br>  2. Using layout anchors. <br><br>  3. Components - divide and conquer. <br><br>  4. Separation of user interface and logic. <br><br><h3>  # 1: UI implementation in code </h3><br>  In Badoo, most of the user interest is implemented in the code.  Why don't we use XIBs or storyboards?  Fair question.  The main reason is the convenience of maintaining the code for a team of medium size, namely <br><br><ul><li>  clearly visible changes in the code, which means that there is no need to analyze the XML storyboard / XIB file in order to find the changes made by a colleague; <br></li><li>  version control systems (for example, Git) are much easier to work with code than with the "heavy" XLM-files, especially during minor conflicts;  It also takes into account that the contents of the XIB / storyboard files change each time they are saved, even if the interface has not changed (although I heard that this problem was fixed in Xcode 9); <br></li><li>  It may be difficult to change and maintain certain properties in Interface Builder (IB), for example, the properties of CALayer during the process of releasing its child views (layout subviews), which can lead to several sources of truth for the view state; <br></li><li>  Interface Builder is not the fastest tool, and sometimes it is much faster to work directly with the code. <br></li></ul><br>  Take a look at the following controller (FriendsListViewController): <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> backgroundColor: <span class="hljs-type"><span class="hljs-type">UIColor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cornerRadius: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> infoView: <span class="hljs-type"><span class="hljs-type">FriendsListView!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewModel: <span class="hljs-type"><span class="hljs-type">FriendsListViewModelProtocol</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewConfig: <span class="hljs-type"><span class="hljs-type">ViewConfig</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(viewModel: <span class="hljs-type"><span class="hljs-type">FriendsListViewModelProtocol</span></span>, viewConfig: <span class="hljs-type"><span class="hljs-type">ViewConfig</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel = viewModel <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewConfig = viewConfig <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(nibName: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>?(coder aDecoder: <span class="hljs-type"><span class="hljs-type">NSCoder</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"init(coder:) has not been implemented"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setupContainerView() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupContainerView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.backgroundColor = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewConfig.backgroundColor <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> infoView = <span class="hljs-type"><span class="hljs-type">FriendsListView</span></span>( frame: .zero, viewModel: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel, viewConfig: .defaultConfig) infoView.backgroundColor = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewConfig.backgroundColor <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(infoView) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.infoView = infoView infoView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal"><span class="hljs-literal">false</span></span> infoView.leadingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.leadingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.trailingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.trailingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.topAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.topAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.bottomAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bottomAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶. }</span></span></code> </pre> <br>  This example shows that you can create a view controller only by providing the view model and view configuration.  You can read more about the view models, that is, the MVVM design pattern (Model-View-ViewModel) <a href="https://medium.com/ios-os-x-development/ios-architecture-patterns-ecba4c38de52">here</a> .  Since the view configuration is a simple structural entity (defining entity) that defines the layout (layout) and view style, namely, indents, sizes, colors, fonts, etc., I consider it appropriate to provide a standard configuration like this: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListViewController</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewConfig</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> defaultConfig: <span class="hljs-type"><span class="hljs-type">FriendsListViewController</span></span>.<span class="hljs-type"><span class="hljs-type">ViewConfig</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">FriendsListViewController</span></span>.<span class="hljs-type"><span class="hljs-type">ViewConfig</span></span>(backgroundColor: .white,                                                   cornerRadius: <span class="hljs-number"><span class="hljs-number">16</span></span>)   } }</code> </pre> <br>  All view initialization occurs in the <code>setupContainerView</code> method, which is called only once from viewDidLoad at the moment when the view is already created and loaded but not yet drawn on the screen, that is, all necessary elements (subviews) are simply added to the view hierarchy, and then markup is applied (layout) and styles. <br><br>  Here is what the view controller now looks like: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListPresenter</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FriendsListPresenterProtocol {   // ‚Ä¶   func presentFriendsList</span></span></span></span>(from presentingViewController: UIViewController) {       let controller = Class.createFriendsListViewController( presentingViewController: presentingViewController,           headerViewModel: self.headerViewModel,           contentViewModel: self.contentViewModel)       controller.modalPresentationStyle = .overCurrentContext       controller.modalTransitionStyle = .crossDissolve       presentingViewController.present(controller, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: nil)   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createFriendsListViewController</span></span></span></span>( presentingViewController: UIViewController, headerViewModel: FriendsListHeaderViewModelProtocol,       contentViewModel: FriendsListContentViewModelProtocol) -&gt; FriendsListContainerViewController {      let dismissViewControllerBlock: VoidBlock = { [weak presentingViewController] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>           presentingViewController?.dismiss(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: nil)       }       let infoViewModel = FriendsListViewModel( headerViewModel: headerViewModel,           contentViewModel: contentViewModel)       let containerViewModel = FriendsListContainerViewModel(onOutsideContentTapAction: dismissViewControllerBlock)       let friendsListViewController = FriendsListViewController( viewModel: infoViewModel, viewConfig: .defaultConfig)       let controller = FriendsListContainerViewController( contentViewController: friendsListViewController,           viewModel: containerViewModel,           viewConfig: .defaultConfig)       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> controller   } }</code> </pre> <br>  You can see a clear <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BE%25D1%2582%25D0%25B2%25D0%25B5%25D1%2582%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">division of responsibility</a> , and this concept is not much more difficult than calling segue on a storyboard. <br><br>  Creating a view controller is quite simple, considering that we have its model and you can simply use the standard view configuration: <br><br><pre> <code class="hljs lisp">let friendsListViewController = FriendsListViewController( <span class="hljs-name"><span class="hljs-name">viewModel</span></span>: infoViewModel, viewConfig: .defaultConfig)</code> </pre><br><h3>  # 2: Using layout anchors </h3><br>  Here is the layout code: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(infoView) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.infoView = infoView infoView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal"><span class="hljs-literal">false</span></span> infoView.leadingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.leadingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.trailingAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.trailingAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.topAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.topAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> infoView.bottomAnchor.constraint(equalTo: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.bottomAnchor).isActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br>  Simply put, this code places the <code>infoView</code> inside the parent view (superview), at coordinates (0, 0) relative to the original size of the superview. <br><br>  Why do we use layout anchors?  It's quick and easy.  Of course, you can set the UIView.frame manually and count all positions and sizes on the fly, but sometimes this can turn into too confusing and / or cumbersome code. <br><br>  You can also use a text format for markup, as described <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/ProgrammaticallyCreatingConstraints.html">here</a> , but this often leads to errors, since the format must be strictly followed, and Xcode does not check the markup text at the stage of writing / compiling the code, and you cannot use the Safe Area Layout Guide: <br><br><pre> <code class="hljs perl">NSLayoutConstraint.constraints( withVisualFormat: <span class="hljs-string"><span class="hljs-string">"V:|-(\(topSpace))-[headerView(headerHeight@200)]-[collectionView(collectionViewHeight@990)]|"</span></span>,   options: [],   metrics: metrics,   views: views)</code> </pre><br>  It's pretty easy to make a mistake or typo in the text line defining the markup, isn't it? <br><br><h3>  # 3: Components - divide and conquer </h3><br>  Our sample user interface is divided into components, each of which performs one specific function, no more. <br><br>  For example: <br><br><ol><li>  <code>FriendsListHeaderView</code> - displays information about friends and the "Close" button. </li><li>  <code>FriendsListContentView</code> - displays a list of friends with clickable cells, the content is dynamically loaded when it reaches the end of the list. </li><li>  <code>FriendsListView</code> is a container for the two previous views. </li></ol><br>  As mentioned earlier, we at Badoo love the <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D0%25B5%25D0%25B4%25D0%25B8%25D0%25BD%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25BE%25D1%2582%25D0%25B2%25D0%25B5%25D1%2582%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">principle of sole responsibility</a> , where each component is responsible for a separate function.  This helps not only in the process of bugfixing (which, perhaps, is not the most interesting part of the work of an iOS developer), but also during the development of a new functional, because such an approach significantly expands the possibilities of re-using code in the future. <br><br><h3>  # 4: Separation of user interface and logic </h3><br>  And last but not least, the separation of the user interface and logic.  A technique that can save time and nerves to your team.  In the literal sense: a separate project under the user interface and a separate one - under the business logic. <br><br>  Let's return to our example.  As you remember, the essence of the presentation (presenter) looks like this: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presentFriendsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from presentingViewController: UIViewController)</span></span></span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = <span class="hljs-type"><span class="hljs-type">Class</span></span>.createFriendsListViewController( presentingViewController: presentingViewController,       headerViewModel: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.headerViewModel,       contentViewModel: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.contentViewModel)   controller.modalPresentationStyle = .overCurrentContext   controller.modalTransitionStyle = .crossDissolve   presentingViewController.present(controller, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre> <br>  You need to provide only view models of the title and content.  The rest is hidden inside the above implementation of UI components. <br><br>  The protocol for the header view model is: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> }   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> }   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCount: <span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> }   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onCloseAction: <span class="hljs-type"><span class="hljs-type">VoidBlock?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> } }</code> </pre> <br>  Now imagine that you are adding visual tests for the UI ‚Äî it's as easy as passing stub models for UI components. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderDemoViewModel</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"ic_friends_count"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span> = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"ic_close_cross"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friendsCount: <span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt;   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onCloseAction: <span class="hljs-type"><span class="hljs-type">VoidBlock?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() {       <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> friendsCountString = <span class="hljs-string"><span class="hljs-string">"\(Int.random(min: 1, max: 5000))"</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.friendsCount = <span class="hljs-type"><span class="hljs-type">Observable</span></span>(friendsCountString)   } }</code> </pre> <br>  Looks easy, right?  Now we want to add business logic to the components of our application, which may require data providers, data models, and so on: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModel</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FriendsListHeaderViewModelProtocol</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> friendsCount: <span class="hljs-type"><span class="hljs-type">Observable</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt; = <span class="hljs-type"><span class="hljs-type">Observable</span></span>(<span class="hljs-string"><span class="hljs-string">"0"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onCloseAction: <span class="hljs-type"><span class="hljs-type">VoidBlock?</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataProvider: <span class="hljs-type"><span class="hljs-type">FriendsListDataProviderProtocol</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observers: [<span class="hljs-type"><span class="hljs-type">ObserverProtocol</span></span>] = []   <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(dataProvider: <span class="hljs-type"><span class="hljs-type">FriendsListDataProviderProtocol</span></span>,        friendsCountIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>,        closeButtonIcon: <span class="hljs-type"><span class="hljs-type">UIImage?</span></span>) {       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dataProvider = dataProvider       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.friendsCountIcon = friendsCountIcon       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.closeButtonIcon = closeButtonIcon       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setupDataObservers()   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupDataObservers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.observers.append(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dataProvider.totalItemsCount.observeNewAndCall { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] (newCount) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.friendsCount.value = <span class="hljs-string"><span class="hljs-string">"\(newCount)"</span></span>       })   } }</code> </pre> <br>  What could be easier?  Just implement the data provider - and more! <br><br>  Implementing the content model looks a bit more complicated, but sharing responsibility still makes life a lot easier.  Here is an example of how you can instantiate and display a list of friends at the touch of a button: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presentRealFriendsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> avatarPlaceholderImage = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"avatar-placeholder"</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> itemFactory = <span class="hljs-type"><span class="hljs-type">FriendsListItemFactory</span></span>(avatarPlaceholderImage: avatarPlaceholderImage)   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataProvider = <span class="hljs-type"><span class="hljs-type">FriendsListDataProvider</span></span>(itemFactory: itemFactory)   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewModelFactory = <span class="hljs-type"><span class="hljs-type">FriendsListViewModelFactory</span></span>(dataProvider: dataProvider)   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> headerViewModel = viewModelFactory.makeHeaderViewModel()   headerViewModel.onCloseAction = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.dismiss(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)   }   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> contentViewModel = viewModelFactory.makeContentViewModel()   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> presenter = <span class="hljs-type"><span class="hljs-type">FriendsListPresenter</span></span>( headerViewModel: headerViewModel,       contentViewModel: contentViewModel)   presenter.presentFriendsList(from: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) }</code> </pre> <br>  This technique helps to isolate the user interface from business logic.  Moreover, it allows you to cover the entire UI with visual tests, passing test data to the components!  Therefore, the separation of the user interface and the associated business logic is crucial to the success of the project, whether it is a startup or a finished product. <br><br><h2>  Conclusion </h2><br>  Of course, these are just some of the techniques used in Badoo, and they are not a universal solution for all possible cases.  Therefore, use them, pre-assessing whether they are suitable for you and your projects. <br><br>  There are other techniques, for example, XIB-configurable UI components using Interface Builder (described in <a href="https://medium.com/%40chevtaev/2527be1a0c19">our</a> other <a href="https://medium.com/%40chevtaev/2527be1a0c19">article</a> ), but for various reasons they are not used in Badoo.  Remember that everyone has his own opinion and vision of the overall picture, so in order to develop a successful project, it is necessary to come to a consensus in a team and choose the approach that is most suitable for most scenarios. <br><br>  May the Swift be with you! <br><br>  Sources <br><br><ul><li>  The full code of the project <a href="https://github.com/chupakabr/ios-ui-techniques-example">on GitHub</a> <br></li><li>  <a href="https://badootech.badoo.com/ios-ui-development-in-badoo-592d76dc5b37">English version of this article</a> <br></li><li>  <a href="https://medium.com/%40chevtaev/2527be1a0c19">Creating custom UI components</a> <br></li><li>  <a href="https://medium.com/ios-os-x-development/ios-architecture-patterns-ecba4c38de52">Architectural iOS Templates</a> <br></li><li>  <a href="https://medium.com/%40johnsundell/modelling-state-in-swift-3751a4acb8f3">Swift state modeling</a> <br></li><li>  <a href="https://medium.com/%40vinodhswamy/solid-principles-in-swift-7dc2b793fd68">SOLID principles in Swift</a> <br></li><li>  <a href="https://developer.apple.com/documentation/uikit/nslayoutanchor">NSLayoutAnchor</a> <br></li><li>  <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/ProgrammaticallyCreatingConstraints.html">Software constraint creation</a> <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/421559/">https://habr.com/ru/post/421559/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421549/index.html">We write technical documentation: a guide for the layman</a></li>
<li><a href="../421551/index.html">Mastering Vuex - from Zero to Hero</a></li>
<li><a href="../421553/index.html">We share technological content: collected all our materials on one site</a></li>
<li><a href="../421555/index.html">Project wideNES - go beyond the NES screen</a></li>
<li><a href="../421557/index.html">Open lesson "Asynchronous programming in Java"</a></li>
<li><a href="../421561/index.html">12 questions about scooters that are not ashamed to ask</a></li>
<li><a href="../421563/index.html">You may have to sit differently to get rid of back pain.</a></li>
<li><a href="../421565/index.html">How rude humanoid robots can fool you</a></li>
<li><a href="../421567/index.html">Discussion: Unusual portable acoustics - sports car, retro radio and "audio boots"</a></li>
<li><a href="../421569/index.html">The most important from Gamescom 2018 - Nvidia RTX, Cyberpunk 2077, Metro Exodus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>