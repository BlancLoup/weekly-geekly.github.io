<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cambot - Robot Photographer on Raspberry Pi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last year, the Raspberry Pi minicomputer fell into my hands. Since I never encountered Linux, it lay for a long time without movement in a desk drawer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cambot - Robot Photographer on Raspberry Pi</h1><div class="post__text post__text-html js-mediator-article">  Last year, the Raspberry Pi minicomputer fell into my hands.  Since  I never encountered Linux, it lay for a long time without movement in a desk drawer, but finally it did ... One of the last experiments I did with it was to make a robot of a photographer - a web-driven interface of a self-propelled platform video and photography. <br>  Tasks for the robot: <br><ul><li>  WiFi control </li><li>  Moving back and forth, turning left and right </li><li>  Shooting video in the process of movement and transfer it to the control computer </li><li>  Capture high resolution photos on a command from a control computer and transfer this image to a web interface. </li></ul><br><img src="https://habrastorage.org/storage2/4cc/0fe/1d1/4cc0fe1d12198c18fb0af0c33d7e813c.png"><br><br><a name="habracut"></a><br>  Of course, the robot is taken simply as an example of the web interface.  You can control and much less exotic devices - curtains, light, heaters ... Ie  from Raspberry Pi you can, for example, build a smart home controller with a web interface. <br><br>  To build the interface, I used <a href="https://code.google.com/p/webiopi/">webiopi</a> , because  it allows you to start the project very quickly with zero knowledge of php, apache, etc.  programs. <br>  What you need to know to repeat the project: <br><ul><li>  python (The level of knowledge depends on the complexity of the planned algorithm) </li><li>  HTML </li><li>  javascript jquery </li><li>  Well, you need to be able to solder, to collect the Raspirobot board. </li></ul><br>  Now let's continue.  First, a few words about webiopi: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  WebIOPi is a complete framework for working with I / O ports Raspberry Pi </h4><br>  WebIOPi allows you to monitor the status and control all GPIO ports locally or remotely, from a browser or any application. <br>  Opportunities: <br>  ‚Ä¢ REST API via HTTP and CoAP with multicast support <br>  ‚Ä¢ Server written in Python <br>  ‚Ä¢ Work with GPIO, Serial, I2C, SPI, 1-Wire <br>  ‚Ä¢ Built-in support for more than 30 devices, including DAC, ADC, sensors ... <br>  ‚Ä¢ Compatible with Python 2 and 3 <br>  ‚Ä¢ Excellent adaptability to the needs of users. <br>  ‚Ä¢ Password protection <br>  ‚Ä¢ Many examples <br><br><h4>  Install WebIOPi </h4><br>  To install, you need to install Python, 2.7 or 3.2 on Raspberry Pi.  The installation is performed by four commands from the terminal, locally or remotely: <br><pre><code class="bash hljs">$ wget http://webiopi.googlecode.com/files/WebIOPi-0.6.0.tar.gz $ tar xvzf WebIOPi-0.6.0.tar.gz $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> WebIOPi-0.6.0 $ sudo ./setup.sh</code> </pre> <br>  Now you can run webiopi on the command line: <br><pre> <code class="bash hljs">$ sudo webiopi [-h] [-c config] [-l <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>] [-s script] [-d] [port] Options: -h, --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span> Display this <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> -c, --config file Load config from file -l, --<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> file Log to file -s, --script file Load script from file -d, --debug Enable DEBUG Arguments: port Port to <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> the HTTP Server</code> </pre><br>  True, the webiopi server and the state of the GPIO ports will be lost once you finish the script with the command Ctrl-C or close the terminal window.  Therefore, it is worth running webiopi as a service: <br><pre> <code class="bash hljs">$ sudo /etc/init.d/webiopi start  $ sudo /etc/init.d/webiopi stop</code> </pre><br>  If you want webiopi to start automatically when RPI boots, you can use the following command: <br><pre> <code class="bash hljs">$ sudo update-rc.d webiopi defaults</code> </pre><br><br><h4>  We try </h4><br>  Now on the local network, you can dial http: // [IP]: 8000 on any computer and access the RPI web interface.  [IP] should be replaced with IP Raspberry Pi.  The default login is ‚Äúwebiopi‚Äù and the password is ‚Äúraspberry‚Äù.  <b>True, the author of the program says that the code does not work in all browsers.</b>  <b>I recommend using Chrome.</b> <br>  This is, for example, the interface for all I / O ports: <br><img src="https://habrastorage.org/storage2/d3d/ab3/c6b/d3dab3c6b5ccabcab84e15a889c5b03d.png"><br>  You can set the mode of operation of any legs, and set the value at the output. <br><br><h4>  WebCamBot - robot ‚Äìphoto </h4><br>  The project is based on the <a href="http://trouch.com/2013/03/04/webiopi-in-the-magpi-cambot-tutorial/">Cambot</a> project with some modifications.  The driver of the motors was not assembled on a breadboard, but on the Raspirobot board, the software was adapted for this board, and web buttons were added to control the webcam.  On the Raspirobot board, the linear controller is replaced with a pulse controller. <br><br>  Four RPIs are used to control the motors connected to the Raspirobot board.  Their purpose is as follows: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Left motor GPIOs LEFT_GO_PIN = 17 #PWM   LEFT_DIR_PIN = 4 #  # Right motor GPIOs RIGHT_GO_PIN = 10 #PWM RIGHT_DIR_PIN = 25 # </span></span></code> </pre><br><br>  The webcam works in two modes - streaming video with the minimum resolution using the mjpg-streamer program and photographing with the maximum resolution.  The mode is selected by running one of the scripts: stream.sh, stream_stop.sh, photo.sh. <br><br>  You probably know how to control the webcam using mjpg-streamer and fswebcam, so I will not comment on the contents of the script. <br>  Photographing script: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh fswebcam -d /dev/video0 -p MJPEG -r 640x480 --jpeg 95 --shadow --title "cambot" --subtitle "Front camera" --info "" --save /usr/share/webiopi/htdocs/app/Raspirobot/ph.jpg -q</span></span></code> </pre><br><br>  Script enable webcams: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh STREAMER=mjpg_streamer DEVICE=/dev/video0 RESOLUTION=160x120 #320x240 FRAMERATE=25 HTTP_PORT=8001 # check for existing webcam device if [ ! -e "/dev/video0" ]; then echo "stream.sh: Error - NO /dev/video0 device" 2&gt;&amp;1 | logger exit 2 fi PLUGINPATH=/home/pi/mjpg-streamer-r63 "$PLUGINPATH/$STREAMER" -i "$PLUGINPATH/input_uvc.so -n -d $DEVICE -r $RESOLUTION -f $FRAMERATE" -o "$PLUGINPATH/output_http.so -n -p $HTTP_PORT" -b</span></span></code> </pre><br><br>  Camera shutdown script: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh kill -9 `pidof mjpg_streamer`</span></span></code> </pre><br><br><h4>  Web interface </h4><br>  Writing a web-interface for WebIOPi is extremely simplified.  In fact, after loading the page using the function call from javascript webiopi, you need to create controls that call macros written in Python and stored on the RPI.  Then the controls need to be added to the HTML code of the page using jQuery.  This is done as follows: <br><pre> <code class="javascript hljs">button = webiopi().createButton(<span class="hljs-string"><span class="hljs-string">"bt_up"</span></span>, <span class="hljs-string"><span class="hljs-string">"/\\"</span></span>, go_forward, stop); <span class="hljs-comment"><span class="hljs-comment">//    id bt_up,  /\,   go_forward $("#up").append(button); //    div  id=up</span></span></code> </pre><br>  The go_forward function looks like this: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">go_forward</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ webiopi().callMacro(<span class="hljs-string"><span class="hljs-string">"go_forward"</span></span>); }</code> </pre><br>  those.  it simply calls the go_forward macro. <br><br>  Since it is not always convenient to press the interface buttons with a mouse, you can duplicate keyboard controls: <br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).keydown(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(e.which) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>:turn_left(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//key Arroy left case 38:go_forward(); break; // key Arroy up case 39:turn_right(); break; //key Arroy right case 40:go_backward(); break; //key Arroy down case 32:stop(); break; //key Space case 75:camera(); break; ..//key K case 80:photo(); break; // key P } });</span></span></code> </pre><br><br>  Video and photos in the interface are loaded into the corresponding div after the macro is executed: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">camera</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#vid"</span></span>).html(<span class="hljs-string"><span class="hljs-string">''</span></span>); webiopi().callMacro(<span class="hljs-string"><span class="hljs-string">"camera"</span></span>); $(<span class="hljs-string"><span class="hljs-string">"#vid"</span></span>).html(<span class="hljs-string"><span class="hljs-string">'&lt;img width="320" height="240" src="http://raspberrypi.local:8001/?action=stream"&gt;'</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">photo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#ph"</span></span>).html(<span class="hljs-string"><span class="hljs-string">''</span></span>); webiopi().callMacro(<span class="hljs-string"><span class="hljs-string">"photo"</span></span>); $(<span class="hljs-string"><span class="hljs-string">"#ph"</span></span>).html(<span class="hljs-string"><span class="hljs-string">'&lt;img src="Raspirobot/ph.jpg"&gt;'</span></span>); }</code> </pre><br><br><h4>  Configuring WebIOPi </h4><br>  The configuration file is located in the <b>/ etc / webiopi /</b> folder <br>  It consists of several blocks like windows ini files, first of all of interest is the block describing macros: <br><pre> <code class="bash hljs">[SCRIPTS] <span class="hljs-comment"><span class="hljs-comment"># Load custom scripts syntax : # name = sourcefile # each sourcefile may have setup, loop and destroy functions and macros cambot =/usr/share/webiopi/htdocs/app/Raspirobot/cambot.py</span></span></code> </pre><br><br>  In this block, you must add a line in the <b>name = sourcefile format</b> with a python script containing macros. <br>  And the second block of interest is server configuration.  In it you can set the port number on which the server will work, the path to the file with a password and the root directory for the server. <br><pre> <code class="bash hljs">[HTTP] <span class="hljs-comment"><span class="hljs-comment"># HTTP Server configuration enabled = true port = 8000 # File containing sha256(base64("user:password")) # Use webiopi-passwd command to generate it passwd-file = /etc/webiopi/passwd # Use doc-root to change default HTML and resource files location #doc-root = /home/pi/webiopi/examples/scripts/macros # Use welcome-file to change the default "Welcome" file #welcome-file = index.html</span></span></code> </pre><br><br><h4>  Python Script Writing </h4><br>  For WebIOPi, the script must contain the setup and destroy functions that will be called when the server is started and turned off.  Typically, these functions determine the mode of operation and the state of the I / O ports. <br>  Functions that should be available in the web interface should be preceded by the identifier @ webiopi.macro.  For example, this is the description of the go_forward function, which causes the robot to move forward: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@webiopi.macro def go_forward(): left_forward() right_forward()</span></span></code> </pre><br>  To control the webcam, use the call command, which calls the corresponding script: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">camera_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> return_code = call(<span class="hljs-string"><span class="hljs-string">"/usr/share/webiopi/htdocs/app/Raspirobot/stream.sh"</span></span>, shell=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br><br>  As a result, I got the following interface: <br><img src="https://habrastorage.org/storage2/4cc/0fe/1d1/4cc0fe1d12198c18fb0af0c33d7e813c.png"><br><br><h4>  Debug Application </h4><br>  If the page on the server with your application does not open, most likely there is an error in the script code.  To localize it, you need to run a written script (in my case, for example, with the <b>sudo python ./cambot.py command</b> and look at the errors and warnings that came out. You should also look at the errors in the webiopi log file located in the <b>/ var /</b> folder <b>log / webiopi</b> <br>  If the page loads, but there is no reaction to clicking on the interface elements - it is worth looking at errors in javascript. <br><br><h4>  Video - the work of the robot </h4><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ueci6U2N4ec%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253&amp;usg=ALkJrhieYAwj93wXi9z0KExWy0NXCJyBcg" frameborder="0" allowfullscreen=""></iframe><br><br>  Complete source code can be downloaded <a href="">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/181930/">https://habr.com/ru/post/181930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181912/index.html">ChibiOS: Lightweight RTOS</a></li>
<li><a href="../181914/index.html">Working with class variables of the heir class in the base class</a></li>
<li><a href="../181922/index.html">Public discussion of the GOST project on digitized audio data compression</a></li>
<li><a href="../181924/index.html">FeatureBranch</a></li>
<li><a href="../181928/index.html">How does Yandex.Mail for domains work?</a></li>
<li><a href="../181932/index.html">Review of possible problems when installing Ubuntu second system on SSD</a></li>
<li><a href="../181934/index.html">We bring Skype icons to the general style of the system.</a></li>
<li><a href="../181936/index.html">Non-standard way to get unavailable information on iOS</a></li>
<li><a href="../181940/index.html">Disappeared icons from the OS X taskbar.</a></li>
<li><a href="../181942/index.html">AWS Route53: DNS Failover Now Supports Elastic Load Balancer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>