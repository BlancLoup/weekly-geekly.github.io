<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Logreplica: collecting logs from the entire cluster into a single point in real time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue to share useful utilities that I use in various projects. This time it will be about logreplica - a simple tool that allows you to organize...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Logreplica: collecting logs from the entire cluster into a single point in real time</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/512/342/d06/512342d06e4d3958c2bd8ae222e29407.jpg" align="left">  I continue to share useful utilities that I use in various projects.  This time it will be about <a href="http://dklab.ru/lib/dklab_logreplica/">logreplica</a> - a simple tool that allows you to organize a <i>reliable</i> transfer of logs from different servers of the cluster to a single machine with large disks ‚Äúin real time‚Äù.  This is very convenient if you want to monitor or analyze logs from the entire cluster centrally, as if they were written directly to a single machine. <br><br>  We can say that logreplica was conceived as a more convenient and reliable way to collect logs in a central place, rather than using the syslog / syslog-ng settings. <br><br>  The advantage of logreplica is in its simplicity of configuration: you only set up the ‚Äúmask‚Äù of the names of the log files and specify the addresses of the source machines, and later the logs corresponding to the mask automatically and on the fly add up to the central machine (including - Sources of new log files appear, unknown at the time of launch logreplica).  When adding a new machine on it, you do not need to tweak anything: it is enough to include its name in the config file. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  <b>Config example /etc/dklab_logreplica.conf</b> <br><br><pre> # What is the directory logs to?
 destination = / var / log / cluster

 # Skip these log files prefixes while storing to destination directory.
 skip_destination_prefixes = / var / log: / var / lib / pgsql / data / logs

 # Path to internal state directory (may not change).
 scoreboard = /var/run/dklab_logreplica.scoreboard

 # Time interval to log growth checks.
 delay = 0.25

 # Default user to connect to remote hosts.
 user = root

 # Files
 [files]
 / var / log / {messages, maillog}
 / var / log / httpd / * _ log

 # What hosts to connect to gather logs from.
 [hosts]
 first = machine1.example.com
 second=nobody@machine2.example.com
</pre></blockquote><br><h3>  How to install and configure logreplica </h3><br>  On source machines, you do not need to configure anything: they immediately appear in the system after being written into the central config file.  So, several dozens of servers can be freely connected to logreplica without configuration: all settings are located in a single <nobr>/etc/dklab_logreplica.conf</nobr> file. <br><ol><li>  Select the server on which all logs will be added;  copy <a href="">the logreplica distribution</a> to <nobr>/ opt / dklab_logreplica /</nobr> . </li><li>  Copy the dklab_logreplica.init init script to <nobr>/etc/init.d</nobr> and configure its autorun when the machine boots (see <nobr>chkconfig</nobr> , <nobr>update-rc.d</nobr> and other Linux utilities). </li><li>  Copy the default <nobr>dklab_log replica.conf.sample</nobr> config to <nobr>/etc/dklab_logreplica.conf</nobr> and change it according to your system: <ul><li>  set the machines from which logs will be collected; </li><li>  specify the mask names of the log files to be monitored; </li><li>  specify the directory where logs will be copied in real time. </li></ul></li><li>  Create a private + public key using <nobr>ssh-keygen -t rsa</nobr> .  Spread the public key on the machines from which the logs will be downloaded: <nobr>ssh-copy-id root @ machine-to-be-pulled</nobr> .  As a result, you should get password-free access from the log server to all source machines, otherwise logreplica will not work. <br></li><li>  Now run <nobr>/etc/init.d/dklab_logreplica start</nobr> - and logreplica will start tracking changes in the log files on the source machines and add the data to the destination directory. </li></ol>  The logreplica daemon can reestablish communication with source machines if it suddenly disappears due to network problems.  In this case, all data that has accumulated in the logs during idle time will be transferred, so nothing will be lost.  Also logreplica tracks the rotation of the logs on the source machines and correctly processes it. <br><br><h3>  Problems solved by logreplica </h3><br>  Suppose there are several physical or virtual machines in the cluster that perform various tasks (for example, SQL server, web-frontend, balancer, mail server, etc.).  Sometimes you want to have logs from all these machines in a single place - for example, to read various statistics or simply conveniently (even if using tail -f) to monitor what is happening in the entire system. <br><br>  Of course, you can configure syslog or syslog-ng to transfer all logs over the network to the central log server, however, if you do this, you will encounter a number of inconveniences: <br><ol><li>  In the case of temporary interruptions of communication between machines (this happens, unfortunately, more often than we would like) pieces of logs can be lost, so you will sometimes lose data. </li><li>  In practice, it is rather difficult to maintain the syslog or syslog-ng configuration synchronized with the real state of affairs in the cluster: new machines can be added, a set of log files can be changed, and so on. </li><li>  Not all services support logging to syslog (for example, apache and nginx write them directly to files to minimize latency).  So you have to use named pipes to transfer data to syslog, which means configs and dependencies will grow and grow. </li><li>  Often you want to replicate the log files to the central machine according to the mask, rather than rigidly specifying the name of the log file.  Syslog and syslog-ng cannot do this. </li><li>  Finally, in practice, it is very convenient to store logs not only on the central machine, but also on the machine where they are created (a narrower ‚Äúrotation window‚Äù can be configured on the source machine).  So your syslog and syslog-ng configs grow again ... </li></ol>  The logreplica utility was created in order to solve all these problems.  In general, logs are simply ‚Äúmagically‚Äù and in real-time on a central machine, without any changes in the settings of services and remote machines. <br><br>  Links: <a href="http://dklab.ru/lib/dklab_logreplica/">logreplica on dklab.ru</a> , <a href="https://github.com/DmitryKoterov/dklab_logreplica">logreplica on GitHub</a> .  Write in the comments if you know analogs or have a different vision of the problem described. </div><p>Source: <a href="https://habr.com/ru/post/126470/">https://habr.com/ru/post/126470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126463/index.html">HTC launched a service to unlock the bootloader in Sensation</a></li>
<li><a href="../126465/index.html">PlayStation on GamesCom</a></li>
<li><a href="../126466/index.html">American scientists have developed micro robots</a></li>
<li><a href="../126467/index.html">Foursquare and Skype will be in Playstation Vita</a></li>
<li><a href="../126469/index.html">Moscow GTUG - Crystallization</a></li>
<li><a href="../126471/index.html">Events bubbling and events capturing</a></li>
<li><a href="../126475/index.html">Tablet Archos 101, disadvantages and how to deal with them</a></li>
<li><a href="../126476/index.html">How to make trash benefit?</a></li>
<li><a href="../126478/index.html">At the end of this year, the era of website intervention in the browser context menu via HTML5 will come.</a></li>
<li><a href="../126480/index.html">Rapid application development using the Greendroid library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>