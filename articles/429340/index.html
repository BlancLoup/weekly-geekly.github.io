<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Think twice before using Helm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Helm without HYIP. Sober look 


 Helm is a package manager for Kubernetes. 


 At first glance, not bad. This tool greatly simplifies the process of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Think twice before using Helm</h1><div class="post__text post__text-html js-mediator-article"><h2 id="helm-bez-haypa-trezvyy-vzglyad">  Helm without HYIP.  Sober look </h2><br><p>  Helm is a package manager for Kubernetes. </p><br><p>  At first glance, not bad.  This tool greatly simplifies the process of release, but sometimes it can also bring trouble, nothing can be done! <br><img src="https://habrastorage.org/getpro/habr/post_images/ea5/838/7c3/ea58387c334867eaf565c18ab1093571.png" alt="image"></p><a name="habracut"></a><br><p>  Helm was recently officially recognized by the top- <a href="https://twitter.com/CloudNativeFdn">level</a> project <a href="https://twitter.com/CloudNativeFdn">@CloudNativeFdn</a> , it is widely used by the community.  This says a lot, but I would like to briefly talk about the unpleasant moments associated with this package manager. </p><br><h3 id="v-chem-istinnaya-cennost-helm">  What is the true value of Helm? </h3><br><p>  I still cannot answer this question with confidence.  Helm does not provide any special features.  What benefits does Tiller (server side) bring? </p><br><p>  Many Helm charts are far from perfect, and additional efforts are needed to use them in the Kubernetes cluster.  For example, they lack RBAC, resource limits and network policies.  Just to take and set the Helm chart in binary form - without thinking about how it will work - will not work. </p><br><p>  It is not enough to extol Helm by giving the simplest examples.  You explain why he is so good - especially from the point of view of a secure multi-tenant working environment. </p><br><blockquote>  Words are empty.  You will show me the code! <br>  ‚ÄîLynus Torvalds </blockquote><br><h3 id="dopolnitelnyy-uroven-avtorizacii-i-kontrolya-dostupa">  Additional level of authorization and access control </h3><br><p>  I remember someone comparing Tiller with a ‚Äúhuge sudo server‚Äù.  In my opinion, this is just another level of authorization, which at the same time requires additional TLS certificates, but does not provide opportunities for access control.  Why not use the Kubernetes API and the existing security model with auditing and RBAC support? </p><br><h3 id="perehvalennyy-instrument-dlya-obrabotki-shablonov">  A laudable pattern processing tool? </h3><br><p> The point is that the configuration from the <code>values.yaml</code> file is used for processing and static analysis of the Go template files, and then the processed Kuberentes manifest is used with the corresponding metadata stored in ConfigMap. </p><br><p>  And you can use a few simple commands: </p><br><pre> <code class="hljs pgsql">$ # render go-<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> files <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> golang <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> python script $ kubectl apply <span class="hljs-comment"><span class="hljs-comment">--dry-run -f . $ kubectl apply -f .</span></span></code> </pre><br><p>  I noticed that developers usually used one <code>values.yaml</code> file on a Wednesday or even got it from <code>values.yaml.tmpl</code> before using it. </p><br><p>  This does not make sense when working with Kubernetes secrets, which are often encrypted and have several versions in the repository.  To circumvent this limitation, you need to use the helm-secrets plugin or the <code>--set key=value</code> command.  In any case, another level of difficulty is added. </p><br><h3 id="helm-kak-instrument-upravleniya-zhiznennym-ciklom-infrastruktury">  Helm as an infrastructure lifecycle management tool </h3><br><p>  Forget it.  This is not possible, especially if we are talking about the main components of Kubernetes, such as kube-dns, a supplier of CNI, cluster autoscaler, etc.  The life cycles of these components are different, and Helm does not fit into them. </p><br><p>  My experience with Helm shows that this tool is great for simple deployments on Kubernetes basic resources, which are easy to use from scratch and do not involve a complicated release process. </p><br><p>  Unfortunately, Helm does not cope with more complex and frequent deployments including Namespace, RBAC, NetworkPolicy, ResourceQuota and PodSecurityPolicy. </p><br><p>  I understand that Helm fans may not like my words, but such is the reality. </p><br><h3 id="sostoyanie-helm">  Helm Condition </h3><br><blockquote>  The Tiller server stores information in ConfigMap files inside Kubernetes.  It does not need its own database. </blockquote><p>  Unfortunately, the ConfigMap size cannot exceed <strong>1 MB</strong> due to the <a href="">limitations of etcd</a> . </p><br><p>  I hope someone will come up with a way to improve the ConfigMap storage driver to compress the serialized version before moving it to storage.  However, this way, I think, the real problem will not be solved anyway. </p><br><h3 id="sluchaynye-sboi-i-obrabotka-oshibok">  Random failures and error handling </h3><br><p>  For me, the biggest problem with Helm is its insecurity. </p><br><h3 id="error-upgrade-failed-foo-has-no-deployed-releases">  Error: UPGRADE FAILED: "foo" has no deployed releases </h3><br><p>  This, IMHO, is one of the most annoying problems of Helm. </p><br><p>  If the first version could not be created, each subsequent attempt will fail with an error indicating that the update cannot be updated from an unknown state. </p><br><p>  The following change insertion request ‚Äúfixes‚Äù the error by adding the <code>--force</code> flag, which in fact simply masks the problem by running the <code>helm delete &amp; helm install ‚Äîreplace</code> command. </p><br><p>  However, in most cases, you will have to do a full purge release. </p><br><pre> <code class="hljs pgsql">helm <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-comment"><span class="hljs-comment">--purge $RELEASE_NAME</span></span></code> </pre> <br><h3 id="error-release-foo-failed-timed-out-waiting-for-the-condition">  Error: release foo failed: timed out </h3><br><p>  If there is no ServiceAccount or RBAC does not allow the creation of a specific resource, Helm will return the following error message: </p><br><pre> <code class="hljs sql">Error: <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">failed</span></span>: timed <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the condition</code> </pre> <br><p>  Unfortunately, the root cause of this error cannot be seen: </p><br><pre> <code class="hljs cs">kubectl -n foo <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> events --sort-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>=<span class="hljs-string"><span class="hljs-string">'{.lastTimestamp}'</span></span></code> </pre> <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> creating: pods <span class="hljs-string"><span class="hljs-string">"foo-5467744958"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> forbidden: <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> looking up service account foo/foo: serviceaccount <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found</code> </pre> <br><h3 id="feyly-na-rovnom-meste">  Feil out of the blue </h3><br><p>  In the most neglected cases, Helm gives an error, without doing anything at all.  For example, sometimes it does not update resource limits. </p><br><h3 id="helm-init-zapuskaet-tiller-s-odnoy-kopiey-a-ne-v-konfiguracii-ha">  helm init runs the tiller with one copy and not in the HA configuration </h3><br><p>  Tiller does not assume high availability by default, and the request to enable changes by <a href="https://github.com/helm/helm/issues/2334">reference</a> is still open. </p><br><p>  One day this will lead to <a href="https://engineering.saltside.se/our-first-kubernetes-outage-c6b9249cfd3a">downtime</a> ... </p><br><h3 id="helm-3-operatory-buduschee">  Helm 3?  Operators?  Future? </h3><br><p>  In the next version of Helm, some promising features will be added: </p><br><ul><li>  single-service architecture without separation into client and server.  No more tiller; </li><li>  built-in Lua engine for writing scripts; </li><li>  DevOps workflow based on power up requests and a new Helm Controller project. </li></ul><br><p>  For more information, see <a href="">the Helm 3 Project Proposals</a> . </p><br><p>  I really like the idea of ‚Äã‚Äãarchitecture without Tiller, but the Lua-based scripts raise doubts, because they can complicate the charts. </p><br><p>  I noticed that recently <a href="https://coreos.com/blog/introducing-operator-framework">operators</a> are gaining popularity, which are much more suitable for Kubernetes than the Helm charts. </p><br><p>  I really hope that the community will soon deal with the problems of Helm (with our help, of course), but for the time being I will try to use this tool as little as possible. </p><br><p>  Understand correctly: this article is my personal opinion, to which I have come, creating a hybrid cloud platform for deployments based on Kubernetes. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/429340/">https://habr.com/ru/post/429340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429328/index.html">Software module for digitizing damaged documents</a></li>
<li><a href="../429330/index.html">Myths and legends of Agile - from the Pharaohs to the present day</a></li>
<li><a href="../429332/index.html">Self-made laser installation "Lightsaber" - as it were, part 1</a></li>
<li><a href="../429336/index.html">Driver and device communication using the _HID method of ACPI using the example of a GPIO Lynxpoint controller</a></li>
<li><a href="../429338/index.html">Android Storage: Internal, External, Removable. Part 1/3</a></li>
<li><a href="../429342/index.html">Angular 6+ complete dependency deployment guide. providedIn vs providers: []</a></li>
<li><a href="../429344/index.html">Weekend Reading: Audio Tuning and Speaker Design Materials</a></li>
<li><a href="../429346/index.html">To the magistracy without exams: a new direction "Big data" at the Olympiad "I am a professional"</a></li>
<li><a href="../429348/index.html">Why in the future Agile will not be needed</a></li>
<li><a href="../429350/index.html">The market for cable and wire products for offshore wind energy will reach 14 billion pounds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>