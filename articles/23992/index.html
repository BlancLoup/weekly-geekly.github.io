<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Drupal 6.x and OpenID</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CMS Drupal from version 6 has got integrated support for OpenID . But many scold this decision for two reasons: 

- It does not allow to log in to the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Drupal 6.x and OpenID</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://drupal.org/">CMS Drupal</a> from version 6 has got integrated support for <a href="http://ru.wikipedia.org/wiki/Openid">OpenID</a> .  But many scold this decision for two reasons: <ul><li>  It does not allow to log in to the site without creating an account.  That is, using OpenID as a digital signature, for example for comments, becomes impossible. </li><li>  When trying to log in using OpenID, the system often gives the error "invalid characters found in the login", or requires you to enter an email. </li></ul>  The first problem is still unsolvable - it only comes to my mind to write a special module for this case. <br>  But the solution to the second problem turned out to be quite simple, although it was not described anywhere else. <br><br><a name="habracut"></a>  What is the reason for this strange behavior of Drupal?  The fact is that when you try to log in using OpenID, the engine creates a full-fledged user account, taking as information provided by the OpenID provider.  But many sites firstly don‚Äôt give the login in its pure form, but the full address of the user‚Äôs page (for example, <a href="http://xn--c1akhkc.livejournal.com/">login.livejournal.com</a> , instead of just login), in which, of course, there are characters invalid for the Drupal username;  and secondly, they do not provide information about the user's e-mail, which is necessary for creating an account in Drupal. <br><br>  The first part of the problem is solved by a <a href="http://drupal.org/files/issues/openid-sanitize-username-216101-30.patch">patch</a> from the official site of the project (versions appear on <a href="http://drupal.org/node/216101">the discussion page</a> ).  Not only that now invalid characters are automatically deleted, so the address is also analyzed to determine what the user login is.  Thanks to the people from the community. <br>  The second part is also solved easily: you just need to generate a fake address for the user and then Drupal will consider that everything is in order.  This is not the best solution because it conflicts with email confirmations, etc.  (the address is fake), but it makes life easier for users - no extra steps when trying to login. <br>  To do this, change the part of the line from openid.module: <br>  <em>$ form_state ['values'] ['mail'] = (! empty ($ response ['openid.sreg.email']))?</em>  <em>$ response ['openid.sreg.email']: '';</em>  (version after patch application) <br>  or <em>$ form_state ['values'] ['mail'] = (empty ($ response ['openid.sreg.email']))?</em>  <em>'': $ response ['openid.sreg.email'];</em>  (version before applying the patch) <br>  change to <br>  <em>$ form_state ['values'] ['mail'] = (! empty ($ response ['openid.sreg.email']))?</em>  <em>$ response ['openid.sreg.email']: $ form_state ['values'] ['name']. '@ nomail';</em> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now, if the server has not sent the user's e-mail, then the field will be filled with the address of the ‚Äúuser_name @ nomail‚Äù type. <br><br>  I understand and respect the idea of ‚Äã‚Äãdevelopers that an OpenID login should create a valid Drupal account, but the situations are different - for some, their solution may not be suitable. <br>  Upd: I found a place where I once read the <a href="http://www.solargate.ru/avtorizaciya-po-openid-v-drupal-5-x">algorithm for treating the second problem</a> (I relied on it) for Drupal 5.x - there is even a ready-made patch.  I highly recommend the blog <a href="http://www.solargate.ru/">‚ÄúSolarWind Gate.</a>  <a href="http://www.solargate.ru/">Notes geek "</a> </div><p>Source: <a href="https://habr.com/ru/post/23992/">https://habr.com/ru/post/23992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239907/index.html">Tesla D: Two engines, four-wheel drive, acceleration to 100 km / h in 3.2 seconds</a></li>
<li><a href="../23991/index.html">Velvet Revolver started searching for a new vocalist via the Internet</a></li>
<li><a href="../239913/index.html">‚ÄúWild‚Äù tourism as the highest gradation of the traveler, or for whom Tourista.me was created</a></li>
<li><a href="../239915/index.html">Table of virtual methods and safety</a></li>
<li><a href="../239919/index.html">How we developed our first application on Xamarin.Forms and what came of it</a></li>
<li><a href="../239921/index.html">Trial versions of applications will appear on Google Play Store</a></li>
<li><a href="../239925/index.html">W for Wikipedia</a></li>
<li><a href="../239927/index.html">News from the world of Node: Node 0.11.14, svgexport, node-webkitgtk, Nightmare, Prototypes, node-libpq and node-pg-native</a></li>
<li><a href="../23993/index.html">The first stage of the Android Developers Challenge is over.</a></li>
<li><a href="../239931/index.html">Amazon opens first physical store in New York</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>