<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DNS failure with registrar R01 and some fatal accidents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, one of the oldest registrars R01 announced a failure in the DNS . 
 In this regard, I want to tell you a small instructive story about how it a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DNS failure with registrar R01 and some fatal accidents</h1><div class="post__text post__text-html js-mediator-article">  Today, one of the oldest registrars R01 <a href="http://r01.ru/about/news/detail.php%3FID%3D4548">announced a failure in the DNS</a> . <br>  In this regard, I want to tell you a small instructive story about how it almost killed our company. <br><br>  By the nature of the activity, we are the saas-analytics for the web.  Our primary weapon is a javascript file that collects statistics.  The file is distributed to many sites of our users, so we must ensure its impeccable stability, the inaccessibility of our site should not affect the sites of our clients.  And we spent a lot of effort to ensure complete stability: put the script in a great powerful CDN, made your domain to abstract this CDN (so that you can change the CDN at any time if it fails or becomes too expensive).  But they did not take into account one little thing: the DNS server was at the registrar. <br><a name="habracut"></a><br>  The failure of DNS in R01 was that all domains resolved into one specific IP address, which showed HTTP requests for the usual "parking" page of the domain with advertising.  Either did not show anything, because this IP had a spontaneous DoS attack from all the people who tried to go to the usual sites that kept the DNS from R01.  But not in our case.  <b>The server responds with requests from /somescript.js script</b> .  And not just a script, but dynamically generated, like this: <br><br>  <i>var redir_url = 'http: // domain that was resolved to the fatal IP /';</i> <i><br></i>  <i>if (window! = top) {</i> <i><br></i>  <i>top.location.href = redir_url;</i> <i><br></i>  <i>} else {</i> <i><br></i>  <i>window.location = redir_url;</i> <i><br></i>  <i>}</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The script cut off the request parameters (still on the server) and made a redirect to the base domain.  All our users who connected analytics, instead of our script on their sites, got someone else who launched a redirect from their site to the left page. <br><br>  Partially it saved us only that almost all the time the server that responded by that IP was under DDoS due to the number of requests to it, which is why, for the overwhelming majority of users, requests to our script fell off by timeout (if the script was unavailable , of course, do not affect other people's sites).  But those fractions of a percent that were ‚Äúlucky‚Äù to receive a response from the server received a redirect. <br><br>  The fatal confluence of circumstances, as often happens, nearly cost us 2 years of project work.  Just unavailable DNS;  available DNS, which sends requests to an unavailable server;  available DNS + available server, but which does not respond to script requests by the script;  all previous, but a script that does not redirect - it would all help to avoid a catastrophic effect on the sites of our users.  I don‚Äôt know if we will be able to get out after such a blow to our service, but many customers, of course, have noticed complaints from their users about incomprehensible redirects.  Yes, and we did not hide, immediately conducted an email-list with a request to disable our service until the DNS cache is updated around the world. <br><br>  The moral of the story is simple: it is impossible to foresee everything, and even such reliable and familiar things as a DNS server cannot be trusted. <br><br>  It was extremely difficult to foresee such a situation: too much was not in our favor.  Of course, we will change the DNS provider, and even put our servers, if it is more reliable.  But it can break and DNS, and CDN, anything.  The only thing that can be done to minimize the chance to fly as much as we do: make sure that the best, most reliable possible solution is used at <b>every</b> point of your system.  Even if it is the choice of a DNS server or registrar. </div><p>Source: <a href="https://habr.com/ru/post/232363/">https://habr.com/ru/post/232363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../232351/index.html">VKApp Treatment for iPhone</a></li>
<li><a href="../232353/index.html">Social engineering in practice: ‚Äúphysical access‚Äù to Kevin Mitnick‚Äôs private conference</a></li>
<li><a href="../232357/index.html">Android Tablet instead of Auto Radio</a></li>
<li><a href="../232359/index.html">Scan mail. Has Google gone too far?</a></li>
<li><a href="../232361/index.html">Distributed computing: some theory</a></li>
<li><a href="../232367/index.html">A selection of backend libraries</a></li>
<li><a href="../232369/index.html">Why there are no simple solutions that it is better to buy servers or optimize code</a></li>
<li><a href="../232381/index.html">In the wake of Spring Pet Clinic. Maven / Spring Context / Spring Test / Spring ORM / Spring Data JPA</a></li>
<li><a href="../232383/index.html">Meeting the comet today</a></li>
<li><a href="../232385/index.html">URI - tricky about simple (Part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>