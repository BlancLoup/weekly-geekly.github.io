<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GWT, Java 8 and Future</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 
 I think many of you know about the release of Java 8, and what innovations it brings. Unfortunately, the latest version of GWT (2.6.0) at ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GWT, Java 8 and Future</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br>  I think many of you know about the release of Java 8, and what innovations it brings.  Unfortunately, the latest version of GWT (2.6.0) at the moment still does not support lambda and default-methods in interfaces.  Since the GWT framework is quite in demand, many often have to deal with the development on it, I was eager to try writing on GWT using newly added features in the language. <br><a name="habracut"></a><br>  This article will discuss how to add support for Java 8 features in GWT, as well as about what, in fact, all this is needed - for example, using Future.  If you have ever worked with GWT, then imagine all the disadvantages and inconveniences associated with callbacks when accessing the server.  While in the javascript world many have been using Future / Promise for a long time, and in some languages ‚Äã‚Äãthis concept is built into the standard library, GWT still uses callbacks in any methods of interaction between the client and the server, be it RemoTeServiceServlet, RPC-Dispatch or RequestFactory. <br>  So let's get started. <br><br><h4>  Collect GWT </h4><br>  After a brief search, an <a href="https://github.com/WeTheInternet/gwt-sandbox/releases/tag/Java8%252BJsInterop">experimental fork of the GWT</a> was found.  It claims pretty tolerable support for Java 8 (with the exception of the JRE Emulation Library).  In fact, this was not quite true.  The jdt-core version that is used in this fork is quite old and is not able to properly cast types.  It was necessary to raise the version to 3.9.5, it was necessary to edit a little bit (only some signatures of the methods were changed). <br><ul><li>  So, take the gwt source <a href="">from here</a> and gwt-tools <a href="">from here</a> . </li><li>  After cloning, you need to set the environment variable <code>GWT_TOOLS=path/to/gwt-tools.</code> </li><li>  Next, go to the GWT source directory and run ant-build. </li></ul><br>  Done, the gwt-dev.jar, gwt-user.jar, gwt-codeserver.jar libraries appeared in the gwt-sandbox / build / lib directory. <br><br><h4>  Rule RestyGWT </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For our example, we will use the modified <a href="http://restygwt.fusesource.org/">RestyGWT</a> library. <br>  <a href="https://github.com/jet-black/resty-gwt">Here</a> is a Future RestyGWT. <br><br>  Now instead of <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServerRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodCallback&lt;Void&gt; callback)</span></span></span></span>;</code> </pre><br>  interaction with the server will look like this: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Future&lt;Void&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeServerRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br><br>  I found the implementation of Future in Scala to be very attractive, and I wanted to do something similar.  Here's what happened: <br><div class="spoiler">  <b class="spoiler_title">Interface</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onComplete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;Try&lt;T&gt;&gt; consumer)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;Throwable&gt; errorHandler, Consumer&lt;T&gt; successHandler)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;T&gt; consumer)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;R&gt; <span class="hljs-function"><span class="hljs-function">Future&lt;R&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Function&lt;T, R&gt; function)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;R&gt; <span class="hljs-function"><span class="hljs-function">Future&lt;R&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flatMap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Function&lt;T, Future&lt;R&gt;&gt; function)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FutureImpl</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Consumer&lt;Try&lt;T&gt;&gt;&gt; completeFunctions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Option&lt;Try&lt;T&gt;&gt; result = Option.getEmpty(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FutureImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onComplete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;Try&lt;T&gt;&gt; consumer)</span></span></span><span class="hljs-function"> </span></span>{ result.forEach(consumer::accept); completeFunctions.add(consumer); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;Throwable&gt; errorHandler, Consumer&lt;T&gt; successHandler)</span></span></span><span class="hljs-function"> </span></span>{ onComplete((result) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.isSuccess()) successHandler.accept(result.get()); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> errorHandler.accept(result.getCause()); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completeWithResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Try&lt;T&gt; result)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.result = Option.create(result); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Consumer&lt;Try&lt;T&gt;&gt; completeFunction : completeFunctions) { completeFunction.accept(result); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completeWithSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T result)</span></span></span><span class="hljs-function"> </span></span>{ completeWithResult(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Success&lt;T&gt;(result)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">completeWithFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable ex)</span></span></span><span class="hljs-function"> </span></span>{ completeWithResult(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Failure&lt;T&gt;(ex)); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forEach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Consumer&lt;T&gt; consumer)</span></span></span><span class="hljs-function"> </span></span>{ onComplete((result) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.isSuccess()) { consumer.accept(result.get()); } }); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;R&gt; <span class="hljs-function"><span class="hljs-function">Future&lt;R&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">map</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Function&lt;T, R&gt; function)</span></span></span><span class="hljs-function"> </span></span>{ FutureImpl&lt;R&gt; future = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FutureImpl&lt;R&gt;(); onComplete((result) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.isSuccess()) { future.completeWithSuccess(function.apply(result.get())); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;R&gt; <span class="hljs-function"><span class="hljs-function">FutureImpl&lt;R&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flatMap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Function&lt;T, Future&lt;R&gt;&gt; function)</span></span></span><span class="hljs-function"> </span></span>{ FutureImpl&lt;R&gt; mapped = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FutureImpl&lt;R&gt;(); onComplete((result) -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.isSuccess()) { Future&lt;R&gt; f = function.apply(result.get()); f.onComplete(mapped::completeWithResult); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapped; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.get().get(); } }</code> </pre><br></div></div><br><br><h4>  Using </h4><br>  What have we done all this for?  I will try to explain what is called "on the fingers." <br>  Suppose we have a service for getting a list of countries and regions: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"../service"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Consumes</span></span>(MediaType.APPLICATION_JSON) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallbackCountryService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RestService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/countires/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCountries</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodCallback&lt;List&lt;Country&gt;&gt; callback)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@GET</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"/regions/{countryId}/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRegions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"countryId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Integer countryId, MethodCallback&lt;List&lt;Region&gt;&gt; callback)</span></span>; }</code> </pre><br><br>  Here are some examples of using this service with and without Future: <br><ol><li>  The simplest example.  We want to take a list of countries and display it in our View: <br>  Without Future: <br><br><pre> <code class="java hljs">countryService.getCountries(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodCallback&lt;List&lt;Country&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, Throwable exception)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, List&lt;Country&gt; response)</span></span></span><span class="hljs-function"> </span></span>{ view.displayCountries(response); } });</code> </pre><br><br>  With Future: <br><br><pre> <code class="java hljs">countryService.getCountries().forEach(view::displayCountries);</code> </pre><br>  The forEach method is a kind of onSuccess callback.  That is, if successful, the displayCountries method on the View will be called. <br><br></li><li>  The example is more complicated.  Suppose we need to handle an exception and display it. <br>  Without Future: <br><br><pre> <code class="java hljs">countryService.getCountries(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodCallback&lt;List&lt;Country&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, Throwable exception)</span></span></span><span class="hljs-function"> </span></span>{ view.displayError(exception.getMessage()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, List&lt;Country&gt; response)</span></span></span><span class="hljs-function"> </span></span>{ view.displayCountries(response); } });</code> </pre><br><br>  With Future: <br><br><pre> <code class="java hljs">countryService.getCountries().handle(t -&gt; view.displayError(t.getMessage()), view::displayCountries);</code> </pre><br>  We pass two functions to the <code>Future.handle</code> method.  One is responsible for handling the error, the second is responsible for handling successful execution with the result. <br><br></li><li>  We need to take the first country from the list and display a list of regions for it: <br>  Without Future: <br><br><pre> <code class="java hljs">countryService.getCountries(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodCallback&lt;List&lt;Country&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, Throwable exception)</span></span></span><span class="hljs-function"> </span></span>{ view.displayError(exception.getMessage()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, List&lt;Country&gt; response)</span></span></span><span class="hljs-function"> </span></span>{ countryService.getRegions(response.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getId(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodCallback&lt;List&lt;Region&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, Throwable exception)</span></span></span><span class="hljs-function"> </span></span>{ view.displayError(exception.getMessage()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSuccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Method method, List&lt;Region&gt; response)</span></span></span><span class="hljs-function"> </span></span>{ view.displayRegions(response); } }); } });</code> </pre><br>  Using Future: <br><br><pre> <code class="java hljs">countryService.getCountries() .map(countries -&gt; countries.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getId()) .flatMap(countryService::getRegions) .handle(err -&gt; view.displayError(err.getMessage()), view::displayRegions);</code> </pre><br>  First we convert <code><code>Future&lt;List&gt;  Future,    countryId   .   Future   . , ,  . <br> <br> <br>       . <br>      Future   .     . <br> <br>     : <br> <br></code></code> <code><code>Future&lt;List&gt;  Future,    countryId   .   Future   . , ,  . <br> <br></code> <br>       . <br>      Future   .     . <br> <br>     : <br> <br></code> <pre> <code class="java hljs">Future&lt;List&lt;Future&lt;List&lt;Region&gt;&gt;&gt;&gt; regionFutures = countryService.getCountries() .map( countries -&gt; countries.map(country -&gt; countryService.getRegions(country.getId())) );</code> </pre><br>  Here we get a list of Future of all regions. <br><br>  In the next transformation you need to bring <pre> <code class="java hljs">List&lt;Future&gt;  Future&lt;List&gt;.    Future  ,   Future    . <br> <br> Future&lt;Future&lt;List&lt;List&lt;Region&gt;&gt;&gt;&gt; regions = regionFutures.map(FutureUtils::toFutureOfList);</code> </pre><br><br>  And finally, we give <pre> <code class="java hljs">Future&lt;Future&gt;  Future,         : <br> <br> FutureUtils .flatten(regions) .map(ListUtils::flatten) .handle(err -&gt; view.displayError(err.getMessage()), view::displayRegions());</code> </pre><br><br>  The disadvantage of the last example is that it is quite difficult to understand it to a person who did not participate in the writing of this code.  However, the decision was quite compact and has the right to exist. <br><br><br><br>  PS For those who want to try Java 8 in GWT, a <a href="https://github.com/jet-black/gwt-java8-demo">demo project has been</a> prepared with examples from the article.  The project is mavenesirovan, you can run through mvn jetty: run-exploded. <br><br>  It should be understood that it is better not to use all the libraries provided in real projects.  Future support in RestyGWT is quite raw, not yet tested, and so far it does not know how to work, for example, with JSONP requests.  Support for default interfaces and lambda works fairly confidently, although compilation does not always work when using lambdas in static methods. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/218731/">https://habr.com/ru/post/218731/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218713/index.html">Heartbleed OpenSSL Vulnerability Reference</a></li>
<li><a href="../218721/index.html">Microsoft Surface Pro 2, what I would like to know before buying</a></li>
<li><a href="../218725/index.html">Problems with ishop.qiwi.ru</a></li>
<li><a href="../218727/index.html">Club of anonymous programmers, or why only a psycho can become a real programmer</a></li>
<li><a href="../218729/index.html">Strongly Typed SignalSpy to Test Qt Applications</a></li>
<li><a href="../218733/index.html">We write REST API on Vert.x. Part 1: Setting Up the Environment</a></li>
<li><a href="../218735/index.html">Experience of using ESPD</a></li>
<li><a href="../218737/index.html">QlikView. Create your first application? ...</a></li>
<li><a href="../218739/index.html">What if there is no Android device at hand? Review of Android emulators</a></li>
<li><a href="../218741/index.html">RabbitMQ monitoring in Zabbix and hidden features of Zabbix key</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>