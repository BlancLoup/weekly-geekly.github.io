<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we did automate the translation to 29 locales: build the zoo into a coherent system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Acronis is an international company with a major R & D in Russia, but our main language is English. Regional products have their own languages, and th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we did automate the translation to 29 locales: build the zoo into a coherent system</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/68b/440/b27/68b440b27ecf4f12ba7facd75870a5d6.png"></div><br>  Acronis is an international company with a major R &amp; D in Russia, but our main language is English.  Regional products have their own languages, and there are quite a lot of them.  Site languages ‚Äã‚Äãare even more than software languages. <br><br>  Therefore, we have made such a system on Drupal, and not without distortions: <br><br><ul><li>  The master text in English (US) appears.  He rolls on all sites as a "golden" image. </li><li>  If there is a direct translation into the locale, it is used. </li><li>  If there is no direct translation into the locale language, but there is a translation into the language of inheritance, the text in the language of inheritance is used. </li></ul><br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ed9/37e/199/ed937e1997534e62b7708875a47b0aed.png"></div><br>  <b>That is, in Mexico (where they speak the language derived from Spanish), the chain will be:</b> check Mexican;  if not, take Spanish;  if not - put the US English.  In the UK, the sequence is shorter: classical English, then American English.  In this case, the price is inherited along a different path: first, the local one is checked, then the American one is taken, and not the European one. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second important thing is to break all whole pages into chunks and tokens in order to ensure the dependence of variables (prices, date formats, product names, individual button names, and so on).  Perversions were needed, because out of the box Drupal was doing everything where ‚Äúwooden‚Äù and simpler. <br><br><h2>  Introductory information </h2><br>  A lot of content, transparent, but not a short editing process, review of translations and proofing.  About 30 people editing the site.  Only one Drupal 7 instance. Different content on locales - special offers, discounts, currencies and its format, as well as the availability of products and pages depending on certain conditions.  Interesting, right? <br><br><img src="https://habrastorage.org/files/36c/d5c/270/36cd5c270df045a0a739e58f87760f15.png"><br><br><h2>  While someone is writing code, content is born. </h2><br>  Perhaps it should be, but it does not always happen, right?  To be honest, we have everything in a very orderly and streamlined manner. <br><br><ul><li>  We start from the base language (English) and it is on it that we form translatable strings, the contents of fields, and pictures. </li><li>  This content in the process of posting on the site is adjusted, passes the primary review and becomes the starting point for further action. </li><li>  At the exit we have completely finished pages, in layout, with content in English.  It should be noted that this work is divided into 2 processes: simple placement of text in the Drupal interface and layout, writing JavaScript code and template files containing translatable strings using the D (t) Drupal function. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/aef/06e/32a/aef06e32a5a345c395c11b24c61d2b46.png"></div><br><h2>  How to translate? </h2><br>  As you know, in Drupal 7 there are only two options to translate content: make a full copy of <s>any</s> entity or translate fields.  The first is a more ‚Äúnuclear‚Äù, but less flexible and frankly overloaded method using the <b>locale</b> module.  We took the second path - Entity Translation, so that in the <b>node</b> table we do not have as many records as we <s>could have</s> . <br><br><h2>  It was not good right away </h2><br><ul><li>  We experienced a huge number of incredible adventures to find random, strange and sometimes frightening bugs in Entity Translation. </li><li>  We found such a <s>beautiful and neat</s> code that we were forced to become morally more stable. </li><li>  All this is <s>very fast and stable</s> and works well under load. </li><li>  Uploading translations was <s>very convenient</s> . </li><li>  Like all boxed systems, Drupal 7 was initially not very convenient and pleasant, but its flexibility gave us a chance. </li></ul><br><h2>  Finally built ... </h2><br>  We tried very hard to do everything so that our colleagues could translate taxonomy terms, and the taxonomy term reference widgets knew how to display localized term headings.  We managed to teach Drupal to bypass the whole chain of candidate languages ‚Äã‚Äãfor translation in different situations exactly the way we want it.  We also managed to make a very accurate and extensible system for processing currency formats with its own separate inheritance mechanism.  We have several of our own Entity-types, which are also well managed, translated in the same style.  We managed to make a flexible menu functionality, the functionality of which went very far beyond the ‚Äúnode /‚Äù limits. <br><br><img src="https://habrastorage.org/files/24e/48f/c09/24e48fc098e24509935f5596c0172c58.png"><br><br>  We <s>rewrote a little</s> modified the famous Translation Management Tool project and taught it <s>tricks to</s> translate all our entities, process our own tokens, upload translations of cases to the XLIFF with dependencies, as well as a couple of tricks. <br><br>  We also had to write our own options for hiding / showing entities for the required locales, which can correctly return access to the material at the request stage (approximately as it is organized in the access system), which made this option ‚Äúpass-through‚Äù to the menu itself - links to hidden Pages disappear from the menu for the desired locale.  The ‚Äúhidden‚Äù pages were followed by their own <b>delivery callback</b> , in order not to give 403 customers indiscriminately. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/def/c93/413/defc93413a3946ddae2a484790ad3455.png"></div><br><h2>  Token it! </h2><br>  It so happened that we liked to use tokens.  Changes are good, and we thought up to put tokens, for example, in templates or body parts of pages.  Tokens, as a rule, are entities of another, our own type - Template.  This allowed us to organize ourselves, develop a standard for the name and arrangement of these tokens and not be afraid of changes.  To remove or change the phone on 20 pages for 1 locale?  - Easy!  Remove some of the options from the offer in Australia?  - Of course! <br><br><img src="https://habrastorage.org/files/a91/526/e08/a91526e08ced49edb33ff04476e50ff1.png"><br><br>  We implemented our tokens to set up the correct URLs in the content with our own algorithm, aimed to always return the localized link to the client, even if there is a redirect from the specified page, and the link itself no longer exists. <br><br><img src="https://habrastorage.org/files/ac9/cc0/3eb/ac9cc03ebc9c490ab7245bcd6a5e9603.png"><br><br><h2>  The most important thing is localization </h2><br>  And everything we talked about for this moment.  Our localization team from Moscow is able to perfectly interact with Drupal.  We went to just that - the process became almost parallel.  The guys create tasks to upload data from all the fields of the selected pages, indicating which language is required to translate, and take XLIFF files to start their work.  The translators themselves into rare languages ‚Äã‚Äãare usually remote employees or agencies with native speakers, so the upload is simply transferred outside.  There it is translated, it is again pushed into the software of our translators, and from there, after verification, it is imported into Drupal, where new translations are automatically created for each Entity and the values ‚Äã‚Äãof the translatable fields are added.  It remains to send a link to the translated version of the page to the regional manager. <br><br><h2>  Conclusion </h2><br>  We have a very good experience in working with a multilingual and highly complex structure within one instance of the system.  We are stable with Zero Downtime, update site releases.  We deliberately did not break the site into a whole mass of small sites, because this is indeed more correct, at least in terms of service.  An important point of our conclusion is that we managed to achieve all the successes listed above without hacking the core Drupal. </div><p>Source: <a href="https://habr.com/ru/post/312312/">https://habr.com/ru/post/312312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312302/index.html">We sit on a Java-hardcore: Free broadcast of the track Joker 2016 without cuts</a></li>
<li><a href="../312304/index.html">Sell ‚Äã‚Äãlike Amazon: 7 examples of automating personal trigger e-mails that you can run today</a></li>
<li><a href="../312306/index.html">10G Switching for SMB: Extreme Summit Switch X620 Series</a></li>
<li><a href="../312308/index.html">Dive into the blockchain technology: Fast and secure transactions</a></li>
<li><a href="../312310/index.html">How we built our mini data center. Part 1 - Colocation</a></li>
<li><a href="../312314/index.html">The preliminary program of the MBLTdev 16 mobile developers conference has been published.</a></li>
<li><a href="../312316/index.html">Several versions of PHP on a Windows machine</a></li>
<li><a href="../312318/index.html">Create a game for WebGL using Unity 5 and JavaScript</a></li>
<li><a href="../312320/index.html">Data serialization or communication dialectics: simple serialization</a></li>
<li><a href="../312322/index.html">Development of modules for Magento 1.x - big guide + video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>