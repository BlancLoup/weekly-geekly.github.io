<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SSP - Own lossless image compression algorithm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Finally, it became possible to publish the algorithm I developed once. The algorithm was developed for an automatic screenshots program. For convenien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SSP - Own lossless image compression algorithm</h1><div class="post__text post__text-html js-mediator-article">  Finally, it became possible to publish the algorithm I developed once.  The algorithm was developed for an automatic screenshots program.  For convenience, further descriptions of it will call it - SSP (sciner screenshot packer).  SSP can be fairly compared with PNG, so in the article I will make comparisons with it. <br><br>  The algorithm has two modes of compression: <br><ol><li>  lossless - in which, the image after decompression will be restored to within a bit; </li><li> with losses - which does not reduce the quality of the picture, just in it just before compression, the image is translated to the <a href="http://en.wikipedia.org/wiki/YCbCr">YcbCr</a> palette <br>  Only by changing the palette can significantly improve compression.  I use the following factors: <br> <code>cY = 0.30078125 * R + 0.5859375 * G + 0.11328125 * B <br> cCb = -0.171875 * R - 0.33984375 * G + 0.51171875 * B + 128 <br> cCr = 0.51171875 * R - 0.4296875 * G - 0.08203125 * B + 128</code> </li> </ol><a name="habracut"></a>  If you try to compress the test image - <br><img src="https://habrastorage.org/getpro/habr/post_images/2e9/809/78f/2e980978f4c98ad58415fb2b5e050302.png" alt="image"><br>  We obtain the following results: <br>  183 960 - The size of the original PNG file <br>  155 932 - SSP (compression occurs in 0.2 seconds) <br>  122 593 - SSP (lossy, lossy) <br><br>  Very interesting results are obtained by compressing the next image. <br>  <a href="">www.libpng.org/pub/png/img_png/16million-pschmidt.png</a> <br>  59852 - PNG <br>  1428 - SSP 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The algorithm contains the following steps: <br><ol><li>  The image is decoded into an RGB array; </li><li>  If the lossy mode is selected, then recoding into the YcbCr palette is performed; </li><li>  The image is filtered by <a href="http://www.w3.org/TR/PNG-Filters.html">Paeth</a> filter (prediction of the value by a simple linear function); </li><li>  Removing duplicate pixels is not a particularly complicated way: <br><blockquote>  <font color="#FF8000">For</font> i <font color="#008000">=</font> <font color="#FF0000">4</font> <font color="#FF8000">To</font> <font color="#0600FF">UBound</font> <font color="#000000">(</font> ByteArray <font color="#000000">)</font> <font color="#FF8000">Step</font> <font color="#FF0000">4</font> &lt;br/&gt; <br>  R <font color="#008000">=</font> ByteArray <font color="#000000">(</font> i <font color="#008000">+</font> <font color="#FF0000">0</font> <font color="#000000">)</font> &lt;br/&gt; <br>  g <font color="#008000">=</font> ByteArray <font color="#000000">(</font> i <font color="#008000">+</font> <font color="#FF0000">1</font> <font color="#000000">)</font> &lt;br/&gt; <br>  b <font color="#008000">=</font> ByteArray <font color="#000000">(</font> i <font color="#008000">+</font> <font color="#FF0000">2</font> <font color="#000000">)</font> &lt;br/&gt; <br>  <font color="#0600FF">If</font> <font color="#804040">Not</font> <font color="#000000">(</font> lR <font color="#008000">=</font> R <font color="#804040">And</font> Lg <font color="#008000">=</font> g <font color="#804040">And</font> lB <font color="#008000">=</font> b <font color="#000000">)</font> Or <font color="#000000">(</font> Cnt&gt; <font color="#008000">=</font> MAX_ITERATE <font color="#000000">)</font> <font color="#FF8000">Then</font> &lt;br/&gt; <br>  <font color="#0600FF">If</font> Cnt <font color="#008000">=</font> MAX_ITERATE <font color="#FF8000">Then</font> Cnt <font color="#008000">=</font> <font color="#FF0000">0</font> &lt;br/&gt; <br>  ByteArray <font color="#000000">(</font> pos <font color="#008000">+</font> <font color="#FF0000">0</font> <font color="#000000">)</font> <font color="#008000">=</font> lR &lt;br/&gt; <br>  ByteArray <font color="#000000">(</font> pos <font color="#008000">+</font> <font color="#FF0000">1</font> <font color="#000000">)</font> <font color="#008000">=</font> Lg &lt;br/&gt; <br>  ByteArray <font color="#000000">(</font> pos <font color="#008000">+</font> <font color="#FF0000">2</font> <font color="#000000">)</font> <font color="#008000">=</font> lB &lt;br/&gt; <br>  ByteArray <font color="#000000">(</font> pos <font color="#008000">+</font> <font color="#FF0000">3</font> <font color="#000000">)</font> <font color="#008000">=</font> Cnt &lt;br/&gt; <br>  lR <font color="#008000">=</font> R &lt;br/&gt; <br>  Lg <font color="#008000">=</font> g &lt;br/&gt; <br>  lB <font color="#008000">=</font> b &lt;br/&gt; <br>  pos <font color="#008000">=</font> pos <font color="#008000">+</font> <font color="#FF0000">4</font> &lt;br/&gt; <br>  Cnt <font color="#008000">=</font> <font color="#FF0000">1</font> &lt;br/&gt; <br>  <font color="#FF8000">Else</font> &lt;br/&gt; <br>  Cnt <font color="#008000">=</font> cnt <font color="#008000">+</font> <font color="#FF0000">1</font> &lt;br/&gt; <br>  <font color="#0600FF">End</font> <font color="#0600FF">If</font> &lt;br/&gt; <br>  <font color="#FF8000">Next</font> </blockquote></li><li>  <a href="http://ru.wikipedia.org/wiki/BWT">BWT</a> coding (Burrows-Wheeler transform), namely, the best implementation in the world ‚Äî Archon, by Dmitry Malyshev; </li><li>  Next comes my function, which removes the most frequently used byte from the received after the previous step and builds the bitmap of the positions from which this byte was removed.  This stage is run 3 times (experimentally selected value); <blockquote><br>  <font color="#0600FF">Dim</font> i <font color="#FF8000">as</font> <font color="#FF0000">long</font> <br>  <font color="#0600FF">Dim</font> iCnt <font color="#FF8000">as</font> <font color="#FF0000">long</font> <br>  <font color="#0600FF">Dim</font> SizeStream <font color="#000000">(</font> <font color="#000000">)</font> <font color="#FF8000">As</font> <font color="#FF0000">Byte</font> <br>  <font color="#0600FF">Dim</font> NewStream <font color="#000000">(</font> <font color="#000000">)</font> <font color="#FF8000">As</font> <font color="#FF0000">Byte</font> <br>  <font color="#0600FF">Dim</font> SizeLength <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> SizeLengthReal <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> NewLength <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> NewLengthReal <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> BitPos <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> size <font color="#FF8000">as</font> <font color="#FF0000">long</font> <br>  <font color="#0600FF">Dim</font> Freq <font color="#000000">(</font> <font color="#FF0000">255</font> <font color="#000000">)</font> <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> freqChar <font color="#FF8000">as</font> byte <br>  <font color="#0600FF">Dim</font> freqcount <font color="#FF8000">as</font> <font color="#FF0000">long</font> <br>  <font color="#0600FF">Dim</font> curChar <font color="#FF8000">as</font> <font color="#FF0000">long</font> <br>  <font color="#0600FF">Dim</font> NewCount <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> AddChar <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> LastChar <font color="#FF8000">As</font> <font color="#FF0000">Long</font> <br>  <font color="#0600FF">Dim</font> <font color="#804040">BitOr</font> <font color="#000000">(</font> <font color="#FF0000">7</font> <font color="#000000">)</font> <font color="#FF8000">As</font> <font color="#FF0000">Byte</font> <br><br>  size <font color="#008000">=</font> <font color="#0600FF">UBound</font> <font color="#000000">(</font> bts <font color="#000000">)</font> <font color="#008000">+</font> <font color="#FF0000">1</font> <br><br>  SizeLengthReal <font color="#008000">=</font> <font color="#FF0000">1024</font> <br>  <font color="#0600FF">ReDim</font> SizeStream <font color="#000000">(</font> SizeLengthReal <font color="#000000">)</font> <br><br>  NewLengthReal <font color="#008000">=</font> <font color="#FF0000">1024</font> <br>  <font color="#0600FF">ReDim</font> NewStream <font color="#000000">(</font> NewLengthReal <font color="#000000">)</font> <br><br>  <font color="#FF8000">For</font> i <font color="#008000">=</font> <font color="#FF0000">0</font> <font color="#FF8000">To</font> <font color="#FF0000">7</font> <br>  <font color="#804040">BitOr</font> <font color="#000000">(</font> i <font color="#000000">)</font> <font color="#008000">=</font> <font color="#000000">(</font> <font color="#FF0000">2</font> <font color="#008000">^</font> i <font color="#000000">)</font> <br>  <font color="#FF8000">Next</font> <br><br>  <font color="#FF8000">For</font> i <font color="#008000">=</font> <font color="#FF0000">0</font> <font color="#FF8000">To</font> size <font color="#008000">-</font> <font color="#FF0000">1</font> <br>  CurChar <font color="#008000">=</font> bts <font color="#000000">(</font> i <font color="#000000">)</font> <br>  Freq <font color="#000000">(</font> CurChar <font color="#000000">)</font> <font color="#008000">=</font> Freq <font color="#000000">(</font> CurChar <font color="#000000">)</font> <font color="#008000">+</font> <font color="#FF0000">1</font> <br>  <font color="#FF8000">Next</font> <br><br>  <font color="#FF8000">For</font> i <font color="#008000">=</font> <font color="#FF0000">0</font> <font color="#FF8000">To</font> <font color="#FF0000">255</font> <br>  <font color="#0600FF">If</font> Freq <font color="#000000">(</font> i <font color="#000000">)</font> &gt; FreqCount <font color="#FF8000">Then</font> <br>  FreqCount <font color="#008000">=</font> Freq <font color="#000000">(</font> i <font color="#000000">)</font> <br>  FreqChar <font color="#008000">=</font> i <br>  <font color="#0600FF">End</font> <font color="#0600FF">if</font> <br>  <font color="#FF8000">Next</font> <br><br>  <font color="#FF8000">For</font> i <font color="#008000">=</font> <font color="#FF0000">0</font> <font color="#FF8000">To</font> size <font color="#008000">-</font> <font color="#FF0000">1</font> <br><br>  CurChar <font color="#008000">=</font> bts <font color="#000000">(</font> i <font color="#000000">)</font> <br><br>  <font color="#0600FF">If</font> <font color="#000000">(</font> CurChar &lt;&gt; FreqChar <font color="#000000">)</font> <font color="#FF8000">Then</font> <br>  AddChar <font color="#008000">=</font> AddChar Or <font color="#804040">BitOr</font> <font color="#000000">(</font> BitPos <font color="#000000">)</font> <br>  <font color="#0600FF">End</font> <font color="#0600FF">if</font> <br><br>  BitPos <font color="#008000">=</font> BitPos <font color="#008000">+</font> <font color="#FF0000">1</font> <br>  <font color="#0600FF">If</font> BitPos <font color="#008000">=</font> <font color="#FF0000">8</font> <font color="#FF8000">Then</font> <br>  SizeStream <font color="#000000">(</font> SizeLength <font color="#000000">)</font> <font color="#008000">=</font> AddChar <br>  <font color="#0600FF">If</font> SizeLength <font color="#008000">+</font> <font color="#FF0000">10</font> &gt; SizeLengthReal <font color="#FF8000">Then</font> <br>  SizeLengthReal <font color="#008000">=</font> SizeLengthReal <font color="#008000">*</font> <font color="#FF0000">2</font> <br>  <font color="#0600FF">ReDim</font> Preserve SizeStream <font color="#000000">(</font> SizeLengthReal <font color="#000000">)</font> <br>  <font color="#0600FF">End</font> <font color="#0600FF">if</font> <br>  SizeLength <font color="#008000">=</font> SizeLength <font color="#008000">+</font> <font color="#FF0000">1</font> <br>  BitPos <font color="#008000">=</font> <font color="#FF0000">0</font> <br>  AddChar <font color="#008000">=</font> <font color="#FF0000">0</font> <br>  <font color="#0600FF">End</font> <font color="#0600FF">if</font> <br><br>  <font color="#0600FF">If</font> <font color="#000000">(</font> CurChar &lt;&gt; FreqChar <font color="#000000">)</font> <font color="#FF8000">Then</font> <br>  NewStream <font color="#000000">(</font> NewLength <font color="#000000">)</font> <font color="#008000">=</font> CurChar <br>  <font color="#0600FF">If</font> NewLength <font color="#008000">+</font> <font color="#FF0000">10</font> &gt; NewLengthReal <font color="#FF8000">Then</font> <br>  NewLengthReal <font color="#008000">=</font> NewLengthReal <font color="#008000">*</font> <font color="#FF0000">2</font> <br>  <font color="#0600FF">ReDim</font> Preserve NewStream <font color="#000000">(</font> NewLengthReal <font color="#000000">)</font> <br>  <font color="#0600FF">End</font> <font color="#0600FF">if</font> <br>  NewLength <font color="#008000">=</font> NewLength <font color="#008000">+</font> <font color="#FF0000">1</font> <br>  <font color="#0600FF">End</font> <font color="#0600FF">if</font> <br>  LastChar <font color="#008000">=</font> CurChar <br><br>  <font color="#FF8000">Next</font> <br><br>  <font color="#008080">'***</font> <br>  <font color="#008080">'If AddChar &lt;&gt; 0 Then</font> <br>  SizeStream <font color="#000000">(</font> SizeLength <font color="#000000">)</font> <font color="#008000">=</font> AddChar <br>  SizeLength <font color="#008000">=</font> SizeLength <font color="#008000">+</font> <font color="#FF0000">1</font> <br>  <font color="#008080">'End If</font> <br><br>  <font color="#0600FF">ReDim</font> Preserve bts <font color="#000000">(</font> <font color="#000000">(</font> SizeLength <font color="#008000">+</font> NewLength <font color="#008000">+</font> <font color="#FF0000">4</font> <font color="#008000">+</font> <font color="#FF0000">1</font> <font color="#008000">+</font> <font color="#FF0000">4</font> <font color="#000000">)</font> <font color="#000000">)</font> <br><br>  <font color="#0600FF">Call</font> CopyMemory <font color="#000000">(</font> bts <font color="#000000">(</font> <font color="#FF0000">0</font> <font color="#000000">)</font> , FreqChar, <font color="#FF0000">1</font> <font color="#000000">)</font> <br>  <font color="#0600FF">Call</font> CopyMemory <font color="#000000">(</font> bts <font color="#000000">(</font> <font color="#FF0000">1</font> <font color="#000000">)</font> , size, <font color="#FF0000">4</font> <font color="#000000">)</font> <br>  <font color="#0600FF">Call</font> CopyMemory <font color="#000000">(</font> bts <font color="#000000">(</font> <font color="#FF0000">5</font> <font color="#000000">)</font> , SizeLength, <font color="#FF0000">4</font> <font color="#000000">)</font> <br>  <font color="#0600FF">Call</font> CopyMemory <font color="#000000">(</font> bts <font color="#000000">(</font> <font color="#FF0000">9</font> <font color="#000000">)</font> , SizeStream <font color="#000000">(</font> <font color="#FF0000">0</font> <font color="#000000">)</font> , SizeLength <font color="#000000">)</font> <br>  <font color="#0600FF">Call</font> CopyMemory <font color="#000000">(</font> bts <font color="#000000">(</font> <font color="#FF0000">9</font> <font color="#008000">+</font> SizeLength <font color="#000000">)</font> , NewStream <font color="#000000">(</font> <font color="#FF0000">0</font> <font color="#000000">)</font> , NewLength <font color="#000000">)</font> <br><br>  Erase SizeStream, NewStream <br></blockquote></li><li>  And the final stage can be compressed by any universal algorithm (Huffman, arithmetic, zip).  I prefer to compress Lzma. </li></ol>  Download the compressor for play, you can here - <a href="http://www.sendspace.com/file/nv2suu">http://www.sendspace.com/file/nv2suu</a> <br><br>  In addition to this algorithm, the bins also have a Jpeg implemented in their own way, as well as an algorithm for wave compression of images with losses like Jpeg2000. </div><p>Source: <a href="https://habr.com/ru/post/113668/">https://habr.com/ru/post/113668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../11366/index.html">The first program to combat poor-quality SEO</a></li>
<li><a href="../113660/index.html">The Japanese announced the simplest emergency phone</a></li>
<li><a href="../113661/index.html">Is it practical to use the prefix increment operator ++ it for iterators instead of postfix it ++</a></li>
<li><a href="../113662/index.html">FPse for android - the first release of the new PlayStation emulator</a></li>
<li><a href="../113663/index.html">Extend log4net. Competitive Logging</a></li>
<li><a href="../113670/index.html">BUNKER DataCenter - Radiation Threat Canceled</a></li>
<li><a href="../113671/index.html">Presented tablet Galaxy Tab 2</a></li>
<li><a href="../113672/index.html">We work with jQuery Templates. Part Three, jQuery Templates Plus</a></li>
<li><a href="../113673/index.html">Personal account of the Beeline Internet (Corbin) and intrusive surveys</a></li>
<li><a href="../113674/index.html">RubyConf 2010: the present and the future of Ruby (II)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>