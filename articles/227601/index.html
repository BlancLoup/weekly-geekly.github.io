<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating audio plug-ins, part 10</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All posts series: 
 Part 1. Introduction and setup 
 Part 2. Learning Code 
 Part 3. VST and AU 
 Part 4. Digital Distortion 
 Part 5. Presets and GUI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating audio plug-ins, part 10</h1><div class="post__text post__text-html js-mediator-article">  All posts series: <br>  <a href="http://habrahabr.ru/post/224911/">Part 1. Introduction and setup</a> <br>  <a href="http://habrahabr.ru/post/225019/">Part 2. Learning Code</a> <br>  <a href="http://habrahabr.ru/post/225457/">Part 3. VST and AU</a> <br>  <a href="http://habrahabr.ru/post/225751/">Part 4. Digital Distortion</a> <br>  <a href="http://habrahabr.ru/post/225755/">Part 5. Presets and GUI</a> <br>  <a href="http://habrahabr.ru/post/226439/">Part 6. Signal synthesis</a> <br>  <a href="http://habrahabr.ru/post/226573/">Part 7. Receiving MIDI Messages</a> <br>  <a href="http://habrahabr.ru/post/226823/">Part 8. Virtual Keyboard</a> <br>  <a href="http://habrahabr.ru/post/227475/">Part 9. Envelopes</a> <br>  <a href="http://habrahabr.ru/post/227601/">Part 10. Refinement GUI</a> <br>  <a href="http://habrahabr.ru/post/227791/">Part 11. Filter</a> <br>  <a href="http://habrahabr.ru/post/227827/">Part 12. Low-frequency oscillator</a> <br>  <a href="http://habrahabr.ru/post/228267/">Part 13. Redesign</a> <br>  <a href="http://habrahabr.ru/post/231513/">Part 14. Polyphony 1</a> <br>  <a href="http://habrahabr.ru/post/231923/">Part 15. Polyphony 2</a> <br>  <a href="http://habrahabr.ru/post/232153/">Part 16. Antialiasing</a> <br><hr><br><br>  Let's add some controls so that you can change the parameters of the envelope and the waveform.  Here is the result we want to get ( <a href="">from here</a> you can download the layered TIFF): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b38/9d5/72c/b389d572c31ccc1bde54fb246ff28a16.png"><br><a name="habracut"></a><br>  Download and drop the following files into the project: <br>  <a href="">bg.png</a> <br>  <a href="">knob.png</a> (file author - <a href="http://www.kvraudio.com/forum/viewtopic.php%3Fp%3D3075317">Bootsie</a> ) <br>  <a href="">waveform.png</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As always, append links and IDs in <i>resource.h</i> : <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Unique IDs for each image resource. #define BG_ID 101 #define WHITE_KEY_ID 102 #define BLACK_KEY_ID 103 #define WAVEFORM_ID 104 #define KNOB_ID 105 // Image resource locations for this plug. #define BG_FN "resources/img/bg.png" #define WHITE_KEY_FN "resources/img/whitekey.png" #define BLACK_KEY_FN "resources/img/blackkey.png" #define WAVEFORM_FN "resources/img/waveform.png" #define KNOB_FN "resources/img/knob.png"</span></span></code> </pre> <br><br>  And we change the height of the window to match the size of the background image: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GUI_HEIGHT 296</span></span></code> </pre><br><br>  Make changes to the <i>Synthesis.rc header</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"resource.h"</span></span></span><span class="hljs-meta"> BG_ID PNG BG_FN WHITE_KEY_ID PNG WHITE_KEY_FN BLACK_KEY_ID PNG BLACK_KEY_FN WAVEFORM_ID PNG WAVEFORM_FN KNOB_ID PNG KNOB_FN</span></span></code> </pre><br><br>  Now we need to add the parameters for the waveform and the envelope generator stages.  <code>EParams</code> in <code>EParams</code> <i>Synthesis.cpp</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EParams { mWaveform = <span class="hljs-number"><span class="hljs-number">0</span></span>, mAttack, mDecay, mSustain, mRelease, kNumParams };</code> </pre><br><br>  The virtual keyboard needs to be moved down: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ELayout { kWidth = GUI_WIDTH, kHeight = GUI_HEIGHT, kKeybX = <span class="hljs-number"><span class="hljs-number">1</span></span>, kKeybY = <span class="hljs-number"><span class="hljs-number">230</span></span> };</code> </pre><br><br>  In <i>Oscillator.h,</i> you need to add an <code>OscillatorMode</code> with a total number of modes: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> OscillatorMode { OSCILLATOR_MODE_SINE = <span class="hljs-number"><span class="hljs-number">0</span></span>, OSCILLATOR_MODE_SAW, OSCILLATOR_MODE_SQUARE, OSCILLATOR_MODE_TRIANGLE, kNumOscillatorModes };</code> </pre><br><br>  In the initialization list, we indicate the sine as the default waveform: <br><br><pre> <code class="cpp hljs">Oscillator() : mOscillatorMode(OSCILLATOR_MODE_SINE), <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre><br><br>  GUI assembly is carried out in the constructor.  Add these lines immediately before <code>AttachGraphics(pGraphics)</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Waveform switch GetParam(mWaveform)-&gt;InitEnum("Waveform", OSCILLATOR_MODE_SINE, kNumOscillatorModes); GetParam(mWaveform)-&gt;SetDisplayText(0, "Sine"); // Needed for VST3, thanks plunntic IBitmap waveformBitmap = pGraphics-&gt;LoadIBitmap(WAVEFORM_ID, WAVEFORM_FN, 4); pGraphics-&gt;AttachControl(new ISwitchControl(this, 24, 53, mWaveform, &amp;waveformBitmap)); // Knob bitmap for ADSR IBitmap knobBitmap = pGraphics-&gt;LoadIBitmap(KNOB_ID, KNOB_FN, 64); // Attack knob: GetParam(mAttack)-&gt;InitDouble("Attack", 0.01, 0.01, 10.0, 0.001); GetParam(mAttack)-&gt;SetShape(3); pGraphics-&gt;AttachControl(new IKnobMultiControl(this, 95, 34, mAttack, &amp;knobBitmap)); // Decay knob: GetParam(mDecay)-&gt;InitDouble("Decay", 0.5, 0.01, 15.0, 0.001); GetParam(mDecay)-&gt;SetShape(3); pGraphics-&gt;AttachControl(new IKnobMultiControl(this, 177, 34, mDecay, &amp;knobBitmap)); // Sustain knob: GetParam(mSustain)-&gt;InitDouble("Sustain", 0.1, 0.001, 1.0, 0.001); GetParam(mSustain)-&gt;SetShape(2); pGraphics-&gt;AttachControl(new IKnobMultiControl(this, 259, 34, mSustain, &amp;knobBitmap)); // Release knob: GetParam(mRelease)-&gt;InitDouble("Release", 1.0, 0.001, 15.0, 0.001); GetParam(mRelease)-&gt;SetShape(3); pGraphics-&gt;AttachControl(new IKnobMultiControl(this, 341, 34, mRelease, &amp;knobBitmap));</span></span></code> </pre><br><br>  First we create an <code>Enum</code> <code>mWaveform</code> parameter.  By default, its value is <code>OSCILLATOR_MODE_SINE</code> , and it can have total <code>kNumOscillatorModes</code> values.  Then, we load <i>waveform.png</i> .  Here <code>4</code> denotes the number of frames, as we know.  One could use <code>kNumOscillatorModes</code> , which is now also equal to four.  But if we add new waveforms and do not change the <i>waveform.png</i> , then everything will crawl.  However, this could serve as a reminder that you need to update the image. <br>  Then we create the <code>ISwitchControl</code> , pass the coordinates and bind to the <code>mWaveform</code> parameter. <br>  We load one <i>knob.png</i> file and use it for all four <code>IKnobMultiControls</code> . <br>  We set <code>SetShape</code> so that the handles are more sensitive at small values ‚Äã‚Äãand coarser at large values.  The default values ‚Äã‚Äãare the same as in the <code>EnvelopeGenerator</code> constructor.  But you can choose any other minimum and maximum values. <br><br><h2>  Handling value changes </h2><br><br>  As you remember, the reaction to user change of parameters is prescribed in the <code>OnParamChange</code> function in the main <i>.cpp</i> project file: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Synthesis::OnParamChange(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> paramIdx) { <span class="hljs-function"><span class="hljs-function">IMutexLock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(paramIdx) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mWaveform: mOscillator.setMode(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;OscillatorMode&gt;(GetParam(mWaveform)-&gt;Int())); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mAttack: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mDecay: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mSustain: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> mRelease: mEnvelopeGenerator.setStageValue(<span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;EnvelopeGenerator::EnvelopeStage&gt;(paramIdx), GetParam(paramIdx)-&gt;Value()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><br>  When <code>mWaveform</code> value of type <code>int</code> <a href="http://habrahabr.ru/post/106294/">converted</a> to the type <code>OscillatorMode</code> . <br>  As you can see, all parameters of the envelope have one line.  If we compare <code>EParams</code> and <code>EnvelopeStage enums</code> , we see that both there and there, the <i>Attack, Decay, Sustain</i> and <i>Release</i> stages correspond to the values <code>1</code> , <code>2</code> , <code>3</code> and <code>4</code> .  Therefore, <code>static_cast&lt;EnvelopeGenerator::EnvelopeStage&gt;(paramIdx)</code> gives the variable envelope stage <code>EnvelopeStage</code> , and <code>GetParam(paramIdx)-&gt;Value()</code> gives the value of variable stage.  Therefore, we can simply call <code>setStageValue</code> with these two arguments.  Only this function has not been written yet.  Add the <code>EnvelopeGenerator</code> to the <code>public</code> class: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStageValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EnvelopeStage stage, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span></span>;</code> </pre><br><br>  Imagine for a moment that this function would be a simple setter: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// This won't be enough: void EnvelopeGenerator::setStageValue(EnvelopeStage stage, double value) { stageValue[stage] = value; }</span></span></code> </pre><br><br>  What if you change the <code>stageValue[ENVELOPE_STAGE_ATTACK]</code> at the attack stage?  Such an implementation does not cause <code>calculateMultiplier</code> and does not recalculate <code>nextStageSampleIndex</code> .  The generator will use the new values ‚Äã‚Äãonly the next time it finds itself at this stage.  The same with SUSTAIN: I would like to be able to hold a note and simultaneously look for the right level. <br>  Such implementation is inconvenient, and such a plugin would look absolutely unprofessional. <br>  The generator should immediately update the parameters of the current stage when the corresponding knob is spinning.  So, you need to call <code>calculateMultiplier</code> with a new time argument and calculate the new value of <code>nextStageSampleIndex</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> EnvelopeGenerator::setStageValue(EnvelopeStage stage, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value) { stageValue[stage] = value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stage == currentStage) { <span class="hljs-comment"><span class="hljs-comment">// Re-calculate the multiplier and nextStageSampleIndex if(currentStage == ENVELOPE_STAGE_ATTACK || currentStage == ENVELOPE_STAGE_DECAY || currentStage == ENVELOPE_STAGE_RELEASE) { double nextLevelValue; switch (currentStage) { case ENVELOPE_STAGE_ATTACK: nextLevelValue = 1.0; break; case ENVELOPE_STAGE_DECAY: nextLevelValue = fmax(stageValue[ENVELOPE_STAGE_SUSTAIN], minimumLevel); break; case ENVELOPE_STAGE_RELEASE: nextLevelValue = minimumLevel; break; default: break; } // How far the generator is into the current stage: double currentStageProcess = (currentSampleIndex + 0.0) / nextStageSampleIndex; // How much of the current stage is left: double remainingStageProcess = 1.0 - currentStageProcess; unsigned long long samplesUntilNextStage = remainingStageProcess * value * sampleRate; nextStageSampleIndex = currentSampleIndex + samplesUntilNextStage; calculateMultiplier(currentLevel, nextLevelValue, samplesUntilNextStage); } else if(currentStage == ENVELOPE_STAGE_SUSTAIN) { currentLevel = value; } } }</span></span></code> </pre><br><br>  The nested <code>if</code> checks if the generator is at the stage limited by the <code>nextStageSampleIndex</code> parameter (ATTACK, DECAY or RELEASE).  <code>nextLevelValue</code> is the signal level in the next stage that the envelope is aiming for.  Its value is set in the same way as in the <code>enterStage</code> function.  The most interesting thing after the <code>switch</code> : at any current stage the generator should work in accordance with the new values ‚Äã‚Äãfor the rest of this stage.  For this, the current stage is divided into the past and the remaining parts.  First, it is calculated how far in time the generator is already inside the stage.  For example, <code>0.1</code> means that 10% is passed.  <code>RemainingStageProcess</code> reflects, accordingly, how much is left.  Now you need to calculate <code>samplesUntilNextStage</code> and update <code>nextStageSampleIndex</code> .  And the most important thing is to call <code>calculateMultiplier</code> to go from the <code>currentLevel</code> level to the <code>nextLevelValue</code> for the <code>samplesUntilNextStage</code> samples. <br>  C SUSTAIN is simple: update <code>currentLevel</code> . <br><br>  Such implementation covers <i>almost</i> all possible cases.  It remains to figure out when the generator is in DECAY, and the value of SUSTAIN changes.  Now it‚Äôs done in such a way that the level drops to the old value, and when the recession stage ends, the level will jump to the new one.  To avoid this, add <code>setStageValue</code> to the end: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentStage == ENVELOPE_STAGE_DECAY &amp;&amp; stage == ENVELOPE_STAGE_SUSTAIN) { <span class="hljs-comment"><span class="hljs-comment">// We have to decay to a different sustain value than before. // Re-calculate multiplier: unsigned long long samplesUntilNextStage = nextStageSampleIndex - currentSampleIndex; calculateMultiplier(currentLevel, fmax(stageValue[ENVELOPE_STAGE_SUSTAIN], minimumLevel), samplesUntilNextStage); }</span></span></code> </pre><br><br>  Now there will be a smooth transition to the new level.  Here we do not change the <code>nextStageSampleIndex</code> , <code>nextStageSampleIndex</code> it does not depend on <i>Sustain</i> . <br>  Launch the plugin, click on the waveforms and twist the knobs - all changes should immediately be reflected in the sound. <br><br><h2>  Performance improvement </h2><br><br>  Take a look at this part of <code>ProcessDoubleReplacing</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> velocity = mMIDIReceiver.getLastVelocity(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (velocity &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { mOscillator.setFrequency(mMIDIReceiver.getLastFrequency()); mOscillator.setMuted(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { mOscillator.setMuted(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre><br><br>  Remember we decided not to reset the <code>mLastVelocity</code> receiver's <code>mLastVelocity</code> ?  This means that after the first note, <code>mOscillator</code> will generate a wave even when no note sounds.  Modify the <code>for</code> loop as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nFrames; ++i) { mMIDIReceiver.advance(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> velocity = mMIDIReceiver.getLastVelocity(); mOscillator.setFrequency(mMIDIReceiver.getLastFrequency()); leftOutput[i] = rightOutput[i] = mOscillator.nextSample() * mEnvelopeGenerator.nextSample() * velocity / <span class="hljs-number"><span class="hljs-number">127.0</span></span>; }</code> </pre><br><br>  Logically, the oscillator should generate a wave when <code>mEnvelopeGenerator.currentStage</code> not equal to <code>ENVELOPE_STAGE_OFF</code> .  It means that you need to turn off generation somewhere in <code>mEnvelopeGenerator.enterStage</code> .  For the reasons that we discussed in the previous post, we will not call anything directly from here, but will use the signals and slots again.  Before defining a class in <i>EnvelopeGenerator.h,</i> add a couple of lines: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"GallantSignal.h"</span></span></span><span class="hljs-meta"> using Gallant::Signal0;</span></span></code> </pre><br><br>  Then add a couple of signals to the <code>public</code> : <br><br><pre> <code class="cpp hljs">Signal0&lt;&gt; beganEnvelopeCycle; Signal0&lt;&gt; finishedEnvelopeCycle;</code> </pre><br><br>  At the very beginning of <code>enterStage</code> in <i>EnvelopeGenerator.cpp</i> add: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentStage == newStage) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentStage == ENVELOPE_STAGE_OFF) { beganEnvelopeCycle(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newStage == ENVELOPE_STAGE_OFF) { finishedEnvelopeCycle(); }</code> </pre><br><br>  The first <code>if</code> for the generator not to loop at the same stage.  The meaning of the other two is as follows: <br><ul><li>  Exiting the OFF stage means the start of a new cycle. </li><li>  Entering OFF means end of cycle </li></ul><br><br>  Now let's write a reaction to <code>Signal</code> .  Add the following <code>private</code> functions to <i>Synthesis.h</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeganEnvelopeCycle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mOscillator.setMuted(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFinishedEnvelopeCycle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mOscillator.setMuted(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre><br><br>  When the envelope cycle begins, we let the oscillator generate a wave.  When it ends - drown it. <br>  At the end of the constructor in <i>Synthesis.cpp,</i> connect the signals to the slots: <br><br><pre> <code class="cpp hljs">mEnvelopeGenerator.beganEnvelopeCycle.Connect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, &amp;Synthesis::onBeganEnvelopeCycle); mEnvelopeGenerator.finishedEnvelopeCycle.Connect(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, &amp;Synthesis::onFinishedEnvelopeCycle);</code> </pre><br><br>  That's all!  At startup, everything should work.  In REAPER, when you click Cmd + Alt + P (on Mac) or Ctrl + Alt + P (on Windows), a performance monitor will appear: <br><br><br><br>  The total track load per processor is highlighted in red.  When the note starts to sound, this value should increase, and when it finally subsides, fall, since the oscillator no longer calculates the samples for nothing. <br><br>  Now we have a completely acceptable envelope generator. <br>  <a href="">From here</a> you can download the code. <br><br>  Next time we will create an equally important component of the synthesizer: the filter! <br><br>  Original article: <br>  <a href="http://martin-finke.de/blog/articles/audio-plugins-012-envelopes-gui/">martin-finke.de/blog/articles/audio-plugins-012-envelopes-gui</a> </div><p>Source: <a href="https://habr.com/ru/post/227601/">https://habr.com/ru/post/227601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227595/index.html">5 lessons for developers of highly loaded systems</a></li>
<li><a href="../227597/index.html">OpenColorIO and Krita: processing and drawing HDR images</a></li>
<li><a href="../227599/index.html">Creating a clone method for LXC containers</a></li>
<li><a href="../2276/index.html">Search and advertising work better in tandem</a></li>
<li><a href="../22760/index.html">Canada Search and Job Tips: Web Developers, IT Professionals, and General</a></li>
<li><a href="../227603/index.html">Google I / O 2014: online translation in Russian</a></li>
<li><a href="../227605/index.html">Google I / O 2014. Day One</a></li>
<li><a href="../227607/index.html">Facebook: ‚ÄúOur data centers make the world a better place‚Äù</a></li>
<li><a href="../227609/index.html">Alexander Day - a humble great inventor</a></li>
<li><a href="../22761/index.html">10 CSS frameworks and what it is</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>