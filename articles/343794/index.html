<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross-platform IoT: Troubleshooting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Earlier, we looked at the Azure IoT CLI and the IoT Center Browser, which are designed to control the center, devices, as well as send and r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross-platform IoT: Troubleshooting</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  Earlier, we looked at the Azure IoT CLI and the IoT Center Browser, which are designed to control the center, devices, as well as send and receive messages.  In this post we will discuss a troubleshooting program that provides additional support and features for the IoT Center.  Look under the cat! <br><br><img src="https://habrastorage.org/webt/tm/wz/4x/tmwz4xks3vxfhfvgn4707rhpvbu.jpeg"><a name="habracut"></a><br><br><blockquote><h2>  Cycle of articles "Cross-platform IoT" </h2><br>  1. <a href="https://habrahabr.ru/company/microsoft/blog/333530/">Cross-platform IoT: Using Azure CLI and Azure IoT Hub</a> <br>  2. <a href="https://habrahabr.ru/company/microsoft/blog/343802/">Cross-platform IoT: Device Operations</a> <br>  3. <a href="https://habrahabr.ru/company/microsoft/blog/343794/">Cross-platform IoT: Troubleshooting</a> <br></blockquote><br><h2>  What is the diagnostic program for? </h2><br>  There are situations when something goes wrong and you are trying to determine the cause.  The hardest thing is usually with a network connection, whether it is blocking the port with a firewall or not enough bandwidth.  And the result is one - an unstable connection.  Since monitoring operations for the IoT Center is provided through the Azure Management Portal, as well as the IoT Center endpoint, a thorough study of logs and crash dumps can take valuable time and require more than one support request to open.  <a href="https://github.com/Azure/iothub-diagnostics">The IoT Center Diagnostic Program</a> is a recent addition to the IoT Center Toolkit.  This is an effective communications test utility that provides initial data on potential failures in case the IoT center is not functioning properly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The tool is also written in node.js and is an open source software (MIT) solution.  To install the tool on your equipment, run the following command in the terminal: <br><br><pre><code class="cs hljs">npm install -g iothub-diagnostics</code> </pre> <br>  Running the diagnostic tool is quite simple, all you need is the connection string of your IoT center.  No other options or commands are provided. <br><br>  Judging by the results of my tests, the tool requires permission <code>iothubowner</code> .  I did not try to apply it with all policies, you can probably restrict access or use policies with a lower level of rights. <br><br><pre> <code class="cs hljs">iothub-diagnostics <span class="hljs-string"><span class="hljs-string">"HostName=youriothub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=="</span></span></code> </pre> <br>  Once the connection is established, the tool starts to perform a series of tests: <br><br><ol><li>  First, network tests are performed to verify DNS resolution, the program checks the connection with the URL to make sure that an Internet connection is possible.  At the moment, pingURL is linked to <code><a href="http://www.microsoft.com/">http://www.microsoft.com</a></code> .  The code provides an indication of your DNS or address, so that you can make the settings at your discretion. </li><li>  Next, it checks the availability of ports and the requirements of TLS encryption.  In this case, the tests also include a check of communication over HTTPS (443), by default httpsRequestUrl is tied to <code><a href="http://www.microsoft.com/">https://www.microsoft.com</a></code> . </li><li>  The last stage of verification is performed in the very center: a temporary device is first registered, and then the D2C connections (devices to the cloud) and C2D (clouds to the device) are tested using all supported protocols: (HTTPS (443), AMQP (5672 and 5671) and MQTT (1833 and 8883)). </li></ol><br>  The result obtained at the end of the test should look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.193</span></span>Z - info: ******************************************* <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.196</span></span>Z - info: * Executing the Microsoft IOT Trace tool. * <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.196</span></span>Z - info: ******************************************* <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.197</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.198</span></span>Z - info: --- Executing network tests --- <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.222</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.223</span></span>Z - info: Starting DNS resolution <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> host <span class="hljs-string"><span class="hljs-string">'www.microsoft.com'</span></span>... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.254</span></span>Z - info: --&gt; Successfully resolved DNS to <span class="hljs-number"><span class="hljs-number">23.204</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span><span class="hljs-number"><span class="hljs-number">.152</span></span>. <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.255</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.255</span></span>Z - info: Pinging IPV4 address <span class="hljs-string"><span class="hljs-string">'23.204.149.152'</span></span>... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.291</span></span>Z - info: --&gt; Successfully pinged <span class="hljs-number"><span class="hljs-number">23.204</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span><span class="hljs-number"><span class="hljs-number">.152</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.291</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.291</span></span>Z - info: Sending https request to <span class="hljs-string"><span class="hljs-string">'https://www.microsoft.com/'</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.444</span></span>Z - info: --&gt; Completed https request <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.445</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">51.445</span></span>Z - info: --- Executing IOT Hub tests --- <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">54.731</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">54.732</span></span>Z - info: Starting AMQP Test... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">59.141</span></span>Z - info: --&gt; Successfully ran AMQP test. <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">59.142</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">59.142</span></span>Z - info: Starting AMQP-WS Test... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">03.460</span></span>Z - info: --&gt; Successfully ran AMQP-WS test. <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">03.466</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">03.466</span></span>Z - info: Starting HTTPS Test... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">08.036</span></span>Z - info: --&gt; Successfully ran HTTPS test. <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">08.059</span></span>Z - info: <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">08.060</span></span>Z - info: Starting Mqtt Test... <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>T07:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">11.828</span></span>Z - info: --&gt; Successfully ran Mqtt test.</code> </pre> <br>  In the event of an error during testing, the corresponding exception will be recorded in a log and displayed on the screen. <br><br>  In general, the diagnostic tool is a great, small program to quickly scan your environment for common connectivity issues and device operations.  Note that this tool does not support network monitoring or tracing for IoT Center servers.  It is designed to connect clients and test basic IoT operations. <br><br>  Of course, you can add additional functions and reporting tools to it, which allows you to get more information about the types of tests conducted.  I would like the tool to be integrated into the CI / CD channel, and the tests of the basic operations have been extended with the help of our own development tests. </div><p>Source: <a href="https://habr.com/ru/post/343794/">https://habr.com/ru/post/343794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343782/index.html">Two years of successful use of Edition-Based Redefiniton in Oracle databases</a></li>
<li><a href="../343784/index.html">C ++ crashes in WebAssembly on different browsers</a></li>
<li><a href="../343788/index.html">Patties in go</a></li>
<li><a href="../343790/index.html">Configuring Authentication in SAP Netweaver AS Java (Part 3 of 3)</a></li>
<li><a href="../343792/index.html">Digital events in Moscow from December 4 to 10</a></li>
<li><a href="../343796/index.html">How to quickly design a site using CSS Grid</a></li>
<li><a href="../343798/index.html">Basics of regular expressions in javascript</a></li>
<li><a href="../343800/index.html">Probabilistic interpretation of classical machine learning models</a></li>
<li><a href="../343802/index.html">Cross-platform IoT: Device Operations</a></li>
<li><a href="../343804/index.html">A bit about the .NET Framework and .NET Core [plus useful links]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>