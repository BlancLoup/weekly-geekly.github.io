<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mechanical watches in the environment of a smart home</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! No, well, of course, not entirely mechanical. Electromechanical. One of the implementations of radio exchange of information within the so-c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mechanical watches in the environment of a smart home</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/834/a20/e84/834a20e8491dee1ca42799be5143c39f.png" align="left"><br>  Good day!  No, well, of course, not entirely mechanical.  Electromechanical.  One of the implementations of radio exchange of information within the so-called environment will be considered.  "Smart home", namely the exchange of information about the exact time.  Also, the idea of ‚Äã‚Äãcontrolling an analog clock without the participation of a person is stated. <a name="habracut"></a><br>  In the last <a href="http://habrahabr.ru/post/162877/">article,</a> we talked about collecting information about the temperature in the street via a radio channel using a radio module based on the NRF24L01 +.  Continuing the development of the infrastructure of the ‚Äúsmart home‚Äù, it was decided to implement the exchange of information about the exact time. <br>  Good people gave a <a href="http://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B0%25D1%2581%25D1%258B">secondary watch</a> "Strela" - they are on KDPV.  The solenoid with the drive was ruthlessly amputated, instead of them the stepper motor from the printer and the microcontroller msp430g2553 with the NRF24L01 + radio module were installed. <br>  The question of the initial determination of the position of the arrows was solved in the following way.  Under the hands of the dial, 2 IR optocouplers were installed so that both sensors worked when the hands were at 6:00.  One sensor is in the corner of the number two tw, the second above the quality mark.  Sensors (circled in the picture) work on reflection, and the inside of the arrows is glossy: <br><img src="https://habrastorage.org/storage2/1e1/2f7/27e/1e12f727e5302ecfed927a59e1ab13e0.jpg"><br>  When initialization occurs, so-called.  parking  The microcontroller turns the arrows until both sensors are closed.  After that, accepting the starting point as 6:00, the time request is made over the radio channel from the controller of the ‚Äúsmart home‚Äù, and when a response is received, the position of the arrows is adjusted according to the exact time.  In the process of working, the watch with a certain periodicity makes a request for time (in my case, once a minute).  In order to avoid collisions in the radio channel, if there are several such clocks in the house, each individual clock has a unique identifier, the value of which in seconds determines the delay in the request from the time the new minute arrives. <br>  Here is the wrong side of the watch: <br><img src="https://habrastorage.org/storage2/02e/b49/43f/02eb4943f86bb83be2f64c091f574bfd.jpg"><br>  The hardware of the ‚Äúsmart home‚Äù has recently moved from the laptop + FreeBSD9 to TP-Link TL-WR703N + <a href="http://wiki.openwrt.org/ru/toh/tp-link/tl-wr703n">OpenWRT</a> .  It runs the ntpd internal time synchronization daemon.  Communication with the ‚Äúsmart home‚Äù equipment takes place via the UART, to which the NRF24L01 + radio module is connected via the msp430g2553 microcontroller: <br><img src="https://habrastorage.org/storage2/ee3/15b/b30/ee315bb30eb6fd3c79291fc162b6bc11.jpg"><br>  The controller itself is written in PERL and communicates with the UART via the Device :: SerialPort module. <br>  The second connector on the controller board is planned for an additional NRF module designed to control actuators (lights, security sensors, blinds, and other automation).  Exchange through it will take place on another frequency channel using encryption (if your hands reach). <br><br>  Project sources for CCS5 and clock for ProfiCAD in picture (save and unpack winrar): <br><img src="https://habrastorage.org/storage2/66c/f70/ca6/66cf70ca63cccd45be81355ac9bc3895.jpg"><br>  UPD: Barley daemon code on the controller. <br><img src="https://habrastorage.org/storage2/fbc/44f/e11/fbc44fe1185d1969ab901d147531781b.jpg"><br><br>  Installation video on power up - on monitor tail of control controller log. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/zBr_s3VMIX8%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700258&amp;usg=ALkJrhjwPZL1QHpu57BMALcMaEyQz7KT2g" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/180535/">https://habr.com/ru/post/180535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180513/index.html">Wonderful introduction to programming</a></li>
<li><a href="../180515/index.html">Voice control in Android applications</a></li>
<li><a href="../180517/index.html">Why develop electronic meeting minutes for Sharepoint 2013</a></li>
<li><a href="../180523/index.html">Dennis Ritchie's first C compiler - on Github</a></li>
<li><a href="../180525/index.html">RiSCiSO - another group of scenery, hit by the FBI</a></li>
<li><a href="../180537/index.html">Overview of data center network architectures</a></li>
<li><a href="../180539/index.html">Unobtrusive authorization</a></li>
<li><a href="../180541/index.html">Videos of the summer analytical festival 2010-2012</a></li>
<li><a href="../180549/index.html">Runet in pictures. Issue 3. Runet Giants - or in which online stores are Russians bought?</a></li>
<li><a href="../180551/index.html">About ratings: Hu from hu in the market of digital analytics?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>