<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making an HTML5 Quest: Using the MVC Pattern in Construct 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we talked about creating an application for learning English idioms, during which we decided to change the format of the appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making an HTML5 Quest: Using the MVC Pattern in Construct 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ff7/d06/dc2/ff7d06dc2ee440ffa2abe607ab350d7c.jpg"><br><br>  In the <a href="http://habrahabr.ru/company/learzing/blog/234621/">previous article,</a> we talked about creating an application for learning English idioms, during which we decided to change the format of the application and turn around.  We decided to apply our <a href="http://habrahabr.ru/company/learzing/blog/226483/">reasoning about online education</a> and add a much more game component.  There was a question about the tool for developing the game. <br><br>  With this article we open the cycle of posts about the development of the first game for our educational platform <a href="http://learzing.com/">Learzing</a> .  The first "screenshot" of the game is higher, and soon we will announce the first version of the game. <br><a name="habracut"></a><br>  Working according to lean startup methodology (more about it in articles about the <a href="http://habrahabr.ru/company/learzing/blog/219879/">team</a> and <a href="http://habrahabr.ru/company/learzing/blog/215863/">business model</a> ), we need to regularly test our product by interested users in it and get feedback from them.  The easiest way to test on the web version (without losing cross-platform), you also need the game to work on any modern device.  The combination of HTML5 + JavaScript perfectly meets these requirements. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The tool for developing HTML5 games <a href="https://www.scirra.com/construct2">Construct 2</a> seemed like a great choice when starting to develop a new game.  A huge community, an active forum, building games for various platforms, <a href="https://www.scirra.com/manual/15/sdk">JavaScript SDK</a> with a stable interface and a sufficient set of functions, open source game engine, plug-ins from Construct 2 developers (as well as communities and developers of commercial plug-ins), stability, regular free updates and no subscription (~ 135 dollars per license). <br><br>  In the top HTML5-game engines Construct 2 ranks <a href="http://html5gameengine.com/">first</a> .  The site is declared 1.5 million downloads.  Perhaps such popularity is associated not only with the quality of the engine, but also with the widespread use of WYSIWYG editors.  In them lies the problem that we solve in the article. <br><br><h1>  Visual programming language Construct 2 </h1><img src="https://habrastorage.org/files/5d0/f1a/fe7/5d0f1afe722a44ceba2f3a9d5b478b0a.jpg"><br>  <i>Sample code in the visual programming language Construct 2</i> <br><br>  To describe the logic of the game in Construct 2 uses an unusual visual programming language.  Let's start with how the program is executed.  Recall what a <a href="http://gameprogrammingpatterns.com/game-loop.html">game loop pattern is</a> .  The code that we ‚Äúput‚Äù in the editor is executed at each iteration of the game cycle after the user input processing stage.  That is, at each step of game time emulation (and evaluation of the state of game objects), the Construct 2 engine executes all the program designs. <br><br>  The language has variables and constants, cycles and functions implemented through events, conditional operators and the events themselves, and even the scopes of variables.  This is almost a set of standard structural PL.  C is successfully used in the development of complex projects (such as the Linux kernel).  The capabilities of the YAP Construct 2 could be enough for our game, if not: <br><br><ul><li>  Lack of structures (in terms of C).  You cannot combine data to describe an entity; you work only with string and numeric variables. </li><li>  Bulky visual code. </li><li>  Weak applicability of established practices from generally accepted PLs - IDE support, architectural patterns, modularity, refactoring, etc. </li></ul><br>  Having experimented with Construct 2, I realized that it is convenient for developing simple games, but is not suitable for complex games.  For development we needed a much more powerful language.  We decided to use Construct 2 and found a way to write JavaScript code using plug-ins to Construct 2. <br><br><h1>  Construct 2 Plugin Architecture </h1><img src="https://habrastorage.org/files/4c2/8e5/be9/4c28e5be9a8549cfae8e1eabb2e64f2e.jpg"><br>  <i>Architecture of Construct 2 plug-ins using some standard plug-ins and their interfaces to visual PL</i> <br><br>  The basic component of the execution time of the Construct 2 game is represented by the file c2runtime.js, which we can see after the project is built.  c2runtime is engaged in modeling time, calculating collisions, creating / destroying objects, executing the visual code of the game, implements the JavaScript SDK interfaces, etc. <br><br>  JavaScript SDK defines the notion of a plugin.  A plug-in is, as it is not difficult to guess, a JavaScript component that implements additional functionality available from the Construct 2 visual code. Each plug-in, except for the standard description (name, version, site URL, etc.), defines the set of functions it provides and events.  The JavaScript code of the plug-in handles calls from the visual code of the game, and also has the ability to send events to the visual code. <br><br>  Even the basic Construct 2 objects, such as Sprite, Text and many others, are implemented as open source plug-ins.  From the point of view of architecture, this approach of developers looks competent.  Compact core, to which plug-ins are connected, each of which implements its strictly limited functionality that complements the functions of the core.  All kernel interactions are performed through the standard JavaScript SDK interface. <br><br><h1>  Solving a problem with MVC </h1><img src="https://habrastorage.org/files/51f/7c3/328/51f7c3328de5443282890f918953f18b.jpg"><br>  <i>MVC pattern</i> <br><br>  The visual programming language Construct 2 is not well suited for describing complex logic.  But it could describe a simple view level logic of the <a href="http://en.wikipedia.org/wiki/Model%25E2%2580%2593view%25E2%2580%2593controller">MVC pattern</a> , and implement all the complex logic in JavaScript at the model and controller levels. <br><br>  To begin, let us highlight what services are necessary for the view level for the functioning of the game.  Services written in JavaScript contain all the complex logic and state.  According to MVC, they become the model level.  Next, create controllers that provide access to the model to the view level.  Interfaces to the JavaScript code in Construct 2 are plug-ins, so each controller is implemented as a Construct 2 plug-in. Thus, we get all the MVC components in the Construct 2 game and have the ability to write code of arbitrary complexity. <br><br>  Now our game contains 15 Construct 2 plugins. Each of them provides a set of services for the visual part of the game.  For example, a plugin for recording a game, playing it, working with persistent storage, a plugin for recording player's progress on a level, etc.  The solution presented for the Construct 2 problem does not look simple.  But apart from the ability to write in JavaScript, we received the MVC approach bonuses: strict separation of the UI code from the main logic and the state of the application. <br><br><h1>  Total </h1>  Approximately 70-80% of the code of our project is at the model level and is written in cross-platform JavaScript.  If you need to change the game engine, we need to rewrite less than 30% of the product code.  With the successful development of the project, it is likely that it will be rewritten to Unity, as in a much more mature and expensive technology. <br><br>  Ahead you will find a lot of interesting things about the technical aspects of the development of HTML5 games and engines that run both in browsers and in the form of native applications.  Stay with us, soon we will announce the first version of the game. <br><br><h1>  Poll </h1>  We invite all developers to help us create a game for learning English idioms and slang - spend a few minutes and complete a short <a href="https://docs.google.com/forms/d/1dpol8Q1a2lipH5uK3U0AK4E0hTIdwMZxiFn7abHEBCo/viewform">survey</a> that will affect our development. <br><br>  First of all, we would like to start from the wishes and needs of users (that is, you), and only then from our own ideas.  All survey participants will receive early access to our application. <br><br><h1>  All articles of the series </h1><ol><li>  <a href="http://habrahabr.ru/company/learzing/blog/226483/">Startup step by step: the future of online education</a> </li><li>  <a href="http://habrahabr.ru/company/learzing/blog/219879/">Startup step by step: team and mentors</a> </li><li>  <a href="http://habrahabr.ru/company/learzing/blog/215863/">Startup step by step: first business model</a> </li><li>  <a href="http://habrahabr.ru/company/learzing/blog/232483/">How we made the educational platform: first design, landing page and logo</a> </li><li>  <a href="http://habrahabr.ru/company/learzing/blog/234621/">How we made the educational platform: the first application</a> </li><li>  <a href="http://habrahabr.ru/company/learzing/blog/236793/">Making an HTML5 Quest: Using the MVC Pattern in Construct 2</a> </li><li>  <a href="http://habrahabr.ru/company/learzing/blog/239545/">Making an HTML5 quest: creating a character and basic animation</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/236793/">https://habr.com/ru/post/236793/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236783/index.html">Canada Start-up Visa Program VS Ukrainian Entrepreneurs</a></li>
<li><a href="../236785/index.html">Principles of writing code</a></li>
<li><a href="../236787/index.html">Surrealism on javascript. NodeJS Development Tips</a></li>
<li><a href="../236789/index.html">140 characters each: American online stores can trade on Twitter</a></li>
<li><a href="../236791/index.html">Create skeleton animations in the Spriter</a></li>
<li><a href="../236795/index.html">Intersection of PVS-Studio and Cppcheck</a></li>
<li><a href="../236797/index.html">The new life of the old storage system - the magic iron Violin to speed up arrays</a></li>
<li><a href="../236799/index.html">Life imitation: our e-friends</a></li>
<li><a href="../236801/index.html">A series of 24 laboratory work on the development, testing and lifecycle management software for Visual Studio 2013</a></li>
<li><a href="../236805/index.html">Debugging and optimization of gstreamer scripts using live streaming as an example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>