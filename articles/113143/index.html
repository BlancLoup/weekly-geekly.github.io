<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Malware for GNU / Linux and the fight against it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I read this topic in Habr√© : ‚ÄúTrojan.winlock began to spread through LiveJournal . ‚Äù In principle, nothing fundamentally new, and of course, as always...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Malware for GNU / Linux and the fight against it</h1><div class="post__text post__text-html js-mediator-article">  I read this topic <a href="http://habrahabr.ru/blogs/infosecurity/113091/">in Habr√©</a> : <a href="http://habrahabr.ru/blogs/infosecurity/113091/">‚ÄúTrojan.winlock began to spread through LiveJournal</a> . <a href="http://habrahabr.ru/blogs/infosecurity/113091/">‚Äù</a>  In principle, nothing fundamentally new, and of course, as always, the comments are full of messages like ‚ÄúAnd in linux / mac / freebsd / plan9 there is no such thing, and Windows users of the SSZB‚Äù, from which small holivars begin.  Here, I want <s>to start a new holivar to</s> share thoughts and find out who thinks what, find out as much as possible the existence of malware in GNU / Linux and think about what to do about it. <br><a name="habracut"></a><br><h4>  Problems </h4><br>  Software for GNU / Linux, like software for any other OS, contains vulnerabilities and nothing can be done about it.  Not long ago, I came across news about a vulnerability found in some player or library with codecs (I don‚Äôt remember exactly, it doesn‚Äôt matter).  The vulnerability allowed to execute arbitrary code when processing a specially crafted file.  Yes, that go far, you can take for example Flash though it does not matter. <br><br>  Suppose we have a terribly vulnerable player, when opening a special file, arbitrary code is executed in it.  What can such a code do?  If there are no vulnerabilities in the kernel (or in other important components) that allow elevation of rights, then it can only foul within the home directory.  But after all, it‚Äôs in the home directory that‚Äôs the most valuable (yes, I remember about backups).  Those.  it is possible to spoil / delete user files, make a botnet from a brave warrior‚Äôs user‚Äôs computer, merge valuable information (passwords, documents, etc.).  To spoil the rest of the system, to harm other users, to make a serious LinLock (which will not just be removed) will not work. <br><br>  Can the code stay in the system?  Let / home be mounted with the noexec option, but the attacker can still use scripts.  Nothing prevents malicious code from creating the file ~ / .config / long / path / hard / to / find / zlovred.py and adding its autorun to the .profile.  And you can also register the malware in ~ / .config / autostart, and maybe somewhere else, I think that you can find the places. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Those.  You can spoil once in your home directory, you can also register in autostart and spoil often, for example on flash drives.  Speaking of flash drives.  Suppose the vulnerability is not in the player, but in the library, which, among other things, is used by some thumbnailer to create thumbnails of video files.  The user inserts a USB flash drive, opens it with a nautilus, nautilus launches an auxiliary process for creating a preview ... Everything is malicious in the system, i.e.  And you do not need to click anywhere, put in a flash drive - got a virus. <br>  If I missed something or did not take into account, then please comment.  If the above doesn‚Äôt work out, what will prevent the user from spoiling a happy life through a vulnerability in Flash when entering an enemy website? <br><br>  Yes, Linux is not so common, there is a zoo of distros and a virus writer will have to take into account a bunch of nuances, but if you want, then you can.  Now Linux is not very popular, what will happen when <s>IT comes in</s> popularity?  Botnet owners will refuse to increase their number due to the fact that for Linux to create a malware is more difficult?  I do not think so. <br><br><h4>  What to do? </h4><br>  Antivirus for Linux?  No way! <br><br>  All programs should work with minimal privileges.  User privileges from which the program is running are redundant.  Yes, it was already invented long before me, I just want to state my thoughts on how this could work. <br><br>  What does the player need (can)?  All he has to do is read the files, write to ~ / .config / player, open the URL, if he can.  All the rest is not needed, or rather nizyaaaaa (in the voice of Polunin).  Flash is even less, just a network and some ~ / .config / adobe / flash (or where is it?).  It may take several more directories, for example for temporary files, but this is clearly limited. <br><br>  So what to do?  Forced access control already exists - SELinux and AppArmor.  Just as it seems to me, they would not hurt to modify.  For example, AppArmor (with SELinux is superficially familiar ... Maybe everything is already good there?), There for each application that needs to be trimmed, you need to write a special config and put it in /etc/apparmor.d/.  It seems to me that this approach is not flexible enough (as far as I know, SELinux is also not flexible).  There is a lack of the possibility of creating such profiles ‚Äúon the fly‚Äù, without the superuser's rights.  Namely: <br><ol><li>  Interface for creating an application security profile from the application itself <br></li><li>  Interface to run the application with the specified profile <br></li><li>  The ability to assign privileges to an application for editing profiles of other applications on the fly, i.e.  profile changes already applied <br></li><li>  Profile templates, changes in the format of executable files, it is possible to change packages <br><br></li></ol><br>  For example, that same holey player starts.  First of all, the player process through a special API uses a restrictive profile for itself.  Those.  The developer of the player must clearly add to it the corresponding code with the list of rights required by the application.  Something like "you can read all the files, you can write to your config, everything else is impossible."  Those.  This method is for conscious developers who know that their application may contain bugs and want to restrict the system from the actions of its program.  Or the corresponding code can be added within the framework of any distribution kit.  Yes, it will be necessary to edit the code, but there will not be many changes.  Thus, the rights can be reduced, but not increased (as is the case in AppArmor), besides this mechanism should allow only a single application of the profile, i.e.  if the application is hacked, then nothing will be changed.  Such a security profile can be applied immediately after launching, or not immediately, for example, before application, the application can read / write some files that are no longer needed in future work. <br>  When to use a profile decides the developer. <br><br>  Not all applications can be applied in this way, for example, there will be a problem with closed-source applications.  In addition, a situation may arise when, depending on the launch context, different profiles need to be applied.  That‚Äôs what mechanism number two is required for.  Using it, an application can launch another application with an indication of a profile.  In my opinion, the most suitable example is the browser and plugins.  Flash, java-applets, Silverlight and other plug-ins at startup receive security profiles that restrict their rights.  Let Flash be three times full of holes, let it be ActionScript API for access to the file system, he can not do anything. <br><br>  Everything seems to be good, i.e.  Most applications can be limited in this way.  But with some there may be difficulties.  What to do with applications that potentially need to read / write any file. <br>  The browser needs the ability to save downloadable files.  You can limit it to a separate ~ / Downloads directory, but this will be security to the detriment of convenience.  Any editor in principle needs the ability to read and write any file.  In this case, we will help point number three.  The dialogs for opening and saving files need to be transferred to separate processes, and in, for example, / etc / apparmor / trusted_programs, you can state that / usr / bin / gtk-open-dialog and / usr / bin / gtk-save-dialog can change on the fly "Profiles of other already running applications (for example, via / proc / [pid] / aa_profile).  Naturally, you can edit the application profiles of only the same user, from which the special programs themselves are running (open and save dialogs). <br>  The browser starts up, a profile is applied to it that restricts everything and everyone.  When the browser needs to save the downloaded file, it will launch gtk-save-dialog (naturally, kde will need its own gizmo).  The user explicitly chooses the name of the file to save.  Gtk-save-dialog will add a corresponding exception to the profile of the browser process and return the file name to the browser.  Thus, the application will be able to read and write only those files that the user explicitly authorized.  The application can be prohibited to read the directories themselves, so that it is not possible to get a list of files (although, getting the list of files is safe enough, I think).  You can do the same with office programs (and many others).  Let all macros and other unsafe things be resolved in a word processor, it will be impossible to spoil anything, except the office documents themselves, and then only those that are already open at the moment.  For the user, everything will remain as it was, the same programs, the same dialogs, nothing new, no inconvenience.  For a programmer, you can also do without changes, all the same call the function of displaying the dialog box.  It will only be necessary to tweak the widget libraries (Gtk, Qt, ...) <br><br>  Stay fourth.  Why is it needed?  We need it to safely launch applications from unverified sources.  That's when it <s>comes</s> GNU / Linux will become more popular and there will be a lot of applications for it, that's when the fourth point is needed.  As a rule, in GNU / Linux applications from trusted sources - repositories, but there are situations when you need to install an application from an unverified source.  The fourth point is the following: the system contains templates for security profiles, they are standard;  The executable file contains the name / id of the profile.  When you start the application, a profile is applied, if the application does not contain an id / profile name or if it requires potentially dangerous rights, then a warning is displayed to the user.  Thus, the user will be able to download and run a large number of applications from unverified sources, of course, system applications do not belong here, since  they will need many potentially dangerous privileges.  Every little thing, such as games, small utilities, screensavers, etc.  it will be possible to launch it safely, while if the application does not require any special rights, then the user may not be notified at all (‚ÄúDownloaded from <a href="http://www.zlovredi.ru/">www.zlovredi.ru</a> . Are you sure you want to run the executable file from an unverified source?‚Äù), but immediately run.  Why are templates and names / id profiles, and not just security profiles directly in executable files?  Because, then a parser will be needed, which will check the profile and issue a conclusion about its security, and this time at startup, besides, an attack on the kernel is eliminated through the security profile from an unchecked source (you never know what they have written ... and the core will have DoS) .  All this, as far as I can tell, is reminiscent of working with applications for mobile devices. <br><br><h4>  Why did I write this? </h4><br>  I just stated my thoughts and it is interesting for me to discuss the topic of security in GNU / Linux, which I propose to do in the comments.  Of course, I did not describe anything fundamentally new, but some of the ideas described here have never met me (for example, making open and save dialogs to other processes), maybe this will really be a useful idea.  Why I did not rush to write patches for the kernel, and wrote a topic on the habr?  Unfortunately, my knowledge of C, and even more so the kernel, leaves much to be desired.  In addition, there is an idea to discuss the ideas presented, and perhaps write about it on the Ubuntu Brainstorm (I wrote a couple of lines on this subject, but they were almost ignored, maybe because I have English so-so, and maybe nobody needs it. Find a link - add here) or a similar resource. <br><br>  PS I'm not sure that I chose the appropriate blog for writing this topic.  If he has no place here, then I will bear it. <br><br>  <b>[update 1]</b> <br>  A small addition 1: <br>  What I am describing here is additions to the existing AppArmor.  The API for creating a profile from the application itself is not a replacement for AppArmor profiles that now exist in text files, but an add-on. <br>  It seems to me that it can be useful in some cases: <br>  - One application will wash work with different profiles depending on use, i.e.  differently curtail the rights to yourself. <br>  - It will be possible to trim the rights not immediately after launch, but a little later. <br>  For example, I worked a completely checked and polished code section that needs more rights, then the application does not need rights and they are cut off. <br>  Those.  This is a supplement that adds flexibility, not replacement. <br><br>  A small addition 2: <br>  Rights can always only be reduced.  Only in paragraph 3 can you allow something that was prohibited. <br>  Allow can only privileged program and only another process already running. <br>  Above all described in detail, read again. <br><br>  Small addition 3: <br>  As in the case of classic AppArmor, this system of rights will be less priority than the classical system of rights.  Those.  if something is impossible to the user himself, then it cannot be for all applications, regardless of their profiles. <br><br>  <b>[update 2]</b> <br>  It turns out that something similar is being developed in Mac OS X. <br>  <a href="http://techjournal.318.com/security/a-brief-introduction-to-mac-os-x-sandbox-technology/">techjournal.318.com/security/a-brief-introduction-to-mac-os-x-sandbox-technology</a> <br>  <a href="http://developer.apple.com/library/ios/">developer.apple.com/library/ios/#DOCUMENTATION/Security/Conceptual/Security_Overview/Security_Services/Security_Services.html</a> <br>  Thanks <a href="http://habrahabr.ru/users/int80h/" class="user_link">int80h</a> 'u for the links. <br>  By the way, there is an opportunity to restrict the rights from the application itself through a special API, as described by me and what they write in the comments ‚Äúdon't need nafig‚Äù. <br><br>  Interestingly, is there something similar for Windows? </div><p>Source: <a href="https://habr.com/ru/post/113143/">https://habr.com/ru/post/113143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113138/index.html">The development of events in Egypt. "Day of wires"</a></li>
<li><a href="../113139/index.html">SAS in SAAS format: plus minus</a></li>
<li><a href="../113140/index.html">Designing a computer case in CATIA V6</a></li>
<li><a href="../113141/index.html">DreamPlug - PC for lovers of miniature gadgets</a></li>
<li><a href="../113142/index.html">Accelerated solution of the issue for 50 rubles from FirstVDS</a></li>
<li><a href="../113144/index.html">History of ABBYY Lingvo. How it all began</a></li>
<li><a href="../113145/index.html">Java Logging: A Nightmare Story</a></li>
<li><a href="../113146/index.html">Audiko Ringtones for Android</a></li>
<li><a href="../113148/index.html">From the "South-West" to Cambridge. Winter Business School from InCube</a></li>
<li><a href="../113149/index.html">Brainfuckers are spotted among JavaScript developers.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>