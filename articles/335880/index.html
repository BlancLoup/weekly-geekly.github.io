<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nodebackup - saving data from containers (docker) and the rest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a story about a self-written bike, which I tried to fulfill the chief covenant of the system administrator - so that everything worked, but I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nodebackup - saving data from containers (docker) and the rest</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/e20/29b/f5b/e2029bf5b2944eae93408230462d5c93.png"><br><br>  This is a story about a self-written bike, which I tried to fulfill the chief covenant of the system administrator - so that everything worked, but I did not do anything.  ) </p><a name="habracut"></a><br><h2 id="nekotoroe-vstuplenie">  Some intro </h2><br><p>  <strong>IMPORTANT</strong> - the information here is somewhat outdated, the general description remains unchanged, but some things in the configuration have changed, I therefore advise you to immediately look at the <a href="https://github.com/aditosoftware/nodebackup">githaba</a> . </p><br><p>  We have been at the company for several years (two years for sure) going all the way to Linus, more precisely to containers.  The program itself, which is developed in the company, can also work under Linux, so there are no special problems and the path has been predetermined. </p><br><p>  In principle, we only have AD, FileServer and a number of other test servers. </p><br><p>  Even at the beginning when containers appeared, the question arose how to save them, then there were some scripts, but you had to do a lot with your hands and with the increase in the number of containers it became annoying.  Therefore, I wrote a program so that you can save containers, data from servers (Windows and Linux).  This was my first program I wrote in node.js and it was accordingly good, but it worked.  A few months later I found an error, but could not fix it, and since I had already learned a bit about node.js, it was decided to rewrite everything to async / await, and so a second version appeared, about which I want to write. </p><br><h2 id="realizaciya">  Implementation </h2><br><p>  As I wrote above, nodebackup can only store data.  Under the hood, <a href="http://duplicity.nongnu.org/">duplicity</a> works <a href="http://duplicity.nongnu.org/">there</a> .  Nodebackup only prepares data so that duplicity can feed it. </p><br><h3 id="kak-eto-rabotaet">  How it works </h3><br><p>  The picture above describes everything well (I hope I did it myself))), but I will repeat it in words. <br>  There are four components - starter, exec, client, server, and they can all be on the same, or on different servers, there can also be many clients. </p><br><p>  <strong>Starter</strong> is actually nodebackup, you can put it wherever node.js is.  He works for me in a container (I'll write about it later) <br>  <strong>Exec</strong> - starter connects to this server and already executes all commands from it.  Made for the case, if you need for example to do a save from the Internet to the network, then you can put this part in the DMZ, we have it spinning on the backup server. <br>  <strong>Client</strong> - in fact, this is a server from which saving is removed, it can be linux, windows or a docker host. <br>  <strong>Server</strong> is where the data is stored. </p><br><p>  On Starter, there is a configuration that says that such a Server makes save for those clients and the configuration for the Client has already been written what to do with it.  If Client is a docker host, then Labels are read from each container that says what to do with this container. </p><br><h3 id="konfiguraciya">  Configuration </h3><br><p><img src="https://habrastorage.org/web/0f2/d80/5c5/0f2d805c590a4603b5dfeea8f2697e6d.png"></p><br><p>  So, we have a server where nodebackup is installed (this is a starter), for this you just need to install node.js&gt; v6.5 and for example, three servers - windows fileserver (winserver), linux (freepbx), docker host (dockerhost1) and everything this is saved on backup2. </p><br><p>  <strong>backup2</strong> - performs the role of Exec / Server and to work on it you need to install cifs, duplicy, sshfs.  Cifs is needed in order to mount smb, sshfs for mounting data from the freepbx server and duplicity to save it all. </p><br><p>  Also, clients need an input via ssh key in the case of linux or the docker of the host. </p><br><p>  Actually this is the whole setup on the servers, now you need to create a configuration for nodebackup, so that it knows what to do. </p><br><p>  So, create a file config.yaml, should be located in the nodebackup folder. </p><br><p>  First part for nodebackup </p><br><pre><code class="hljs pgsql">starter: sshkey: id_rsa <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>: <span class="hljs-type"><span class="hljs-type">path</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre> <br><p>  id_rsa is the ssh key, in this case it is in the same folder. </p><br><p>  Further part for server backup (in this case, this is backup2) </p><br><pre> <code class="hljs vhdl">backupserver: backup2: passphrase: PASSPHRASE-<span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span>-DUPLICITY HOST: backup2.example.com USER: admin2 <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: '<span class="hljs-number"><span class="hljs-number">22</span></span>' prerun: '[<span class="hljs-string"><span class="hljs-string">"echo prerun1"</span></span>, <span class="hljs-string"><span class="hljs-string">"echo prerun2"</span></span>, <span class="hljs-string"><span class="hljs-string">"echo prerun3"</span></span>]' #postrun: '[<span class="hljs-string"><span class="hljs-string">"echo postrun1"</span></span>,<span class="hljs-string"><span class="hljs-string">"echo postrun2"</span></span>,<span class="hljs-string"><span class="hljs-string">"echo postrun3"</span></span>]' backuppath: /backup duplicityarchiv: /backup/duplicityarchiv backuppartsize: <span class="hljs-number"><span class="hljs-number">2048</span></span> tmpdir: /backup/backuptemp backupfor: '[<span class="hljs-string"><span class="hljs-string">"winserver"</span></span>, <span class="hljs-string"><span class="hljs-string">"freepbx"</span></span>, <span class="hljs-string"><span class="hljs-string">"dockerhost1"</span></span>]'</code> </pre> <br><p>  passphrare - password to save, it is used for all clients that are saved to the server <br>  prerun, postrun - commands that are respectively executed before and after backup <br>  backuppath is where backups are stored. <br>  duplicityarchiv - optional, duplicity saves data for itself, quite a lot of them, if you do not set the option, then this is all stored in /home/user/.config/duplicity <br>  backuppartsize - the backup is broken into pieces of 2048 MB, here you can write your own something. <br>  backupfor - client names are written here, the configuration for them will be described below. </p><br><p>  Now part for clients, first winserver </p><br><pre> <code class="hljs vhdl">clientserver: backup2: HOST: backup2.example.com USER: admin2 <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: '<span class="hljs-number"><span class="hljs-number">22</span></span>' sftpServer: sudo: <span class="hljs-literal"><span class="hljs-literal">true</span></span> path: /usr/lib/sftp-server winserver: HOST: <span class="hljs-string"><span class="hljs-string">"windows.example.com"</span></span> SMB: SET: <span class="hljs-string"><span class="hljs-string">"true"</span></span> PATH: <span class="hljs-string"><span class="hljs-string">"d$"</span></span> PASS: <span class="hljs-string"><span class="hljs-string">"userpass"</span></span> DOMAIN: <span class="hljs-string"><span class="hljs-string">"example.com"</span></span> USER: <span class="hljs-string"><span class="hljs-string">"backupservice"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: <span class="hljs-number"><span class="hljs-number">22</span></span> backup: /cygdrive/d include: '[<span class="hljs-string"><span class="hljs-string">"usershare"</span></span>, <span class="hljs-string"><span class="hljs-string">"publicshare"</span></span>, <span class="hljs-string"><span class="hljs-string">"Gesch√§ftsleitung"</span></span>]' exclude: '[<span class="hljs-string"><span class="hljs-string">"publicshare/Softwarepool"</span></span>, <span class="hljs-string"><span class="hljs-string">"**"</span></span>]' confprefixes: '[<span class="hljs-string"><span class="hljs-string">"asynchronous-upload"</span></span>, <span class="hljs-string"><span class="hljs-string">"allow-source-mismatch"</span></span>]'</code> </pre> <br><p>  There is some error here, since the program was written, mainly for Linux, then there are some artifacts left from the configuration that cannot be erased anyway - this is PORT, backup. <br>  SMB is the actual settings for samba, how it will work with the server if it is not in the domain I do not know <br>  include, exclude - this is where the path from SMB / PATH is taken and include is attached to it and the exclude is removed accordingly. <br>  confprefixes - here you can add options from duplicity, all this is in its documentation. </p><br><p>  Add a server with Linux, where you need to save only a folder, well, or several. </p><br><pre> <code class="hljs cs"> freepbx: HOST: <span class="hljs-string"><span class="hljs-string">"freepbx.example.com"</span></span> USER: root PORT: <span class="hljs-string"><span class="hljs-string">'22'</span></span> nextfullbackup: <span class="hljs-number"><span class="hljs-number">1</span></span>M noffullbackup: <span class="hljs-number"><span class="hljs-number">2</span></span> backup: /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/asterisk/backup/taeglich prerun: <span class="hljs-string"><span class="hljs-string">'["mv /var/spool/asterisk/backup/taeglich/*.tgz /var/spool/asterisk/backup/taeglich/backup.tgz"]'</span></span> postrun: <span class="hljs-string"><span class="hljs-string">'["rm -Rf /var/spool/asterisk/backup/taeglich/backup.tgz"]'</span></span> confprefixes: <span class="hljs-string"><span class="hljs-string">'["asynchronous-upload"]'</span></span></code> </pre> <br><p>  nextfullbackup - says how much incremental backups can be made before a new full backup is made. <br>  noffullbackup - the number of backups (number of fullbackups) <br>  prerun, postrun - commands that run before and after backup </p><br><p>  Now the most important part is the backup of the containers. <br>  Start configuration from config.yaml </p><br><pre> <code class="hljs lua"> dockerhost1: HOST: dockerHostN010912m.example.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> USER: docker PORT: <span class="hljs-number"><span class="hljs-number">22</span></span> docker: <span class="hljs-string"><span class="hljs-string">'true'</span></span> sftpServer: sudo: <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>: /usr/lib/sftp-server</code> </pre> <br><p>  docker - true says this is a docker host <br>  sftpServer - if you do not have root, but there is a user with sudo (without a password), then you need to clean it up, this is what it looks like in ubuntu </p><br><p>  After the program sees that it is a docker host, it reads container information from the docker.sock (/var/run/docker.sock) and looks at each <a href="https://docs.docker.com/engine/userguide/labels-custom-metadata/">Labels</a> , if it finds the necessary ones, then a backup is made. <br>  This is part of docker-compose.yaml, in which labels are registered, they are similar to the configuration from the part about clients </p><br><pre> <code class="hljs swift"> labels: prerun: '[<span class="hljs-string"><span class="hljs-string">"echoc prerun1"</span></span>, <span class="hljs-string"><span class="hljs-string">"echo prerun2"</span></span>]' postrun: '[<span class="hljs-string"><span class="hljs-string">"echo postrun1"</span></span>,<span class="hljs-string"><span class="hljs-string">"echo postrun2"</span></span>]' nextfullbackup: <span class="hljs-string"><span class="hljs-string">"1M"</span></span> noffullbackup: <span class="hljs-string"><span class="hljs-string">"2"</span></span> backup: <span class="hljs-string"><span class="hljs-string">"/a/data/backup-new-test"</span></span> strategy: <span class="hljs-string"><span class="hljs-string">"off"</span></span> confprefixes: '[<span class="hljs-string"><span class="hljs-string">"allow-source-mismatch"</span></span>]' name: <span class="hljs-string"><span class="hljs-string">"backup-new-test"</span></span> processes: '[<span class="hljs-string"><span class="hljs-string">"httpd"</span></span>]' failovercustom: <span class="hljs-string"><span class="hljs-string">"echo 'failover ####################'"</span></span> passphrase: <span class="hljs-string"><span class="hljs-string">"+++++containerPASS#######"</span></span></code> </pre> <br><p>  prerun, postrun - they are executed not in the container, but on the docker host. <br>  strategy is an option that describes whether to turn off the container for backup or not.  <strong>IMPORTANT:</strong> This will also turn off the link containers. <br>  name - optional, this will be the name of the folder on the backup server, if there is nothing here, then just take the name of the container. <br>  The processes are from the monitoring topic and got here by accident. <br>  failovercustom - optional, if an error occurred during the backup, then this command is executed, if this option is not present, then just "docker start CONTAINER + LINKS" <br>  passphrase - you can register for each container separately, or globally for the entire docker of the host.  The priority is the container, then the docker host. </p><br><div class="spoiler">  <b class="spoiler_title">config.yaml</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">starter: sshkey: id_rsa log: path: log backupserver: backup2: passphrase: PASSPHRASE-<span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span>-DUPLICITY HOST: backup2.example.com USER: admin2 <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: '<span class="hljs-number"><span class="hljs-number">22</span></span>' prerun: '[<span class="hljs-string"><span class="hljs-string">"echo prerun1"</span></span>, <span class="hljs-string"><span class="hljs-string">"echo prerun2"</span></span>, <span class="hljs-string"><span class="hljs-string">"echo prerun3"</span></span>]' #postrun: '[<span class="hljs-string"><span class="hljs-string">"echo postrun1"</span></span>,<span class="hljs-string"><span class="hljs-string">"echo postrun2"</span></span>,<span class="hljs-string"><span class="hljs-string">"echo postrun3"</span></span>]' backuppath: /backup duplicityarchiv: /backup/duplicityarchiv backuppartsize: <span class="hljs-number"><span class="hljs-number">2048</span></span> tmpdir: /backup/backuptemp backupfor: '[<span class="hljs-string"><span class="hljs-string">"winserver"</span></span>, <span class="hljs-string"><span class="hljs-string">"freepbx"</span></span>, <span class="hljs-string"><span class="hljs-string">"dockerhost1"</span></span>]' clientserver: backup2: HOST: backup2.example.com USER: admin2 <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: '<span class="hljs-number"><span class="hljs-number">22</span></span>' sftpServer: sudo: <span class="hljs-literal"><span class="hljs-literal">true</span></span> path: /usr/lib/sftp-server server2: HOST: <span class="hljs-string"><span class="hljs-string">"windows.example.com"</span></span> SMB: SET: <span class="hljs-string"><span class="hljs-string">"true"</span></span> PATH: <span class="hljs-string"><span class="hljs-string">"d$"</span></span> PASS: <span class="hljs-string"><span class="hljs-string">"userpass"</span></span> DOMAIN: <span class="hljs-string"><span class="hljs-string">"example.com"</span></span> USER: <span class="hljs-string"><span class="hljs-string">"backupservice"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: <span class="hljs-number"><span class="hljs-number">22</span></span> backup: /cygdrive/d include: '[<span class="hljs-string"><span class="hljs-string">"usershare"</span></span>, <span class="hljs-string"><span class="hljs-string">"publicshare"</span></span>, <span class="hljs-string"><span class="hljs-string">"Gesch√§ftsleitung"</span></span>]' exclude: '[<span class="hljs-string"><span class="hljs-string">"publicshare/Softwarepool"</span></span>, <span class="hljs-string"><span class="hljs-string">"**"</span></span>]' confprefixes: '[<span class="hljs-string"><span class="hljs-string">"asynchronous-upload"</span></span>, <span class="hljs-string"><span class="hljs-string">"allow-source-mismatch"</span></span>]' freepbx: HOST: <span class="hljs-string"><span class="hljs-string">"freepbx.example.com"</span></span> USER: root <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: '<span class="hljs-number"><span class="hljs-number">22</span></span>' nextfullbackup: <span class="hljs-number"><span class="hljs-number">1</span></span>M noffullbackup: <span class="hljs-number"><span class="hljs-number">2</span></span> backup: /var/spool/asterisk/backup/taeglich prerun: '[<span class="hljs-string"><span class="hljs-string">"mv /var/spool/asterisk/backup/taeglich/*.tgz /var/spool/asterisk/backup/taeglich/backup.tgz"</span></span>]' postrun: '[<span class="hljs-string"><span class="hljs-string">"rm -Rf /var/spool/asterisk/backup/taeglich/backup.tgz"</span></span>]' confprefixes: '[<span class="hljs-string"><span class="hljs-string">"asynchronous-upload"</span></span>]' dockerhost1: HOST: dockerHostN010912m.example.local USER: docker <span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>: <span class="hljs-number"><span class="hljs-number">22</span></span> docker: <span class="hljs-symbol"><span class="hljs-symbol">'true</span></span>' sftpServer: sudo: <span class="hljs-literal"><span class="hljs-literal">true</span></span> path: /usr/lib/sftp-server</code> </pre> </div></div><br><p>  In principle, correctly setting the settings you can do a lot of different things. <br>  Another example for a container.  We have one container with a large database, where I don‚Äôt want to wait for the database to be copied so that it is fast, we turn off the container, take a snapshot, turn on the container, do a backup from the snapshot and erase it later, here‚Äôs the configuration for the container </p><br><pre> <code class="hljs swift"> labels: nextfullbackup: <span class="hljs-string"><span class="hljs-string">"1M"</span></span> noffullbackup: <span class="hljs-string"><span class="hljs-string">"2"</span></span> backup: <span class="hljs-string"><span class="hljs-string">"/cephrbd/mariadb-intern-prod/snapshot"</span></span> prerun: '[<span class="hljs-string"><span class="hljs-string">"sudo docker stop adito4internproddb_mariadb-dev_1 adito4internproddb_mariadb_1"</span></span>,<span class="hljs-string"><span class="hljs-string">"sudo btrfs subvolume snapshot -r /cephrbd/mariadb-intern-prod /cephrbd/mariadb-intern-prod/snapshot"</span></span>,<span class="hljs-string"><span class="hljs-string">"sudo docker start adito4internproddb_mariadb-dev_1 adito4internproddb_mariadb_1"</span></span>]' postrun: '[<span class="hljs-string"><span class="hljs-string">"sudo btrfs subvolume delete /cephrbd/mariadb-intern-prod/snapshot"</span></span>]' strategy: <span class="hljs-string"><span class="hljs-string">"on"</span></span></code> </pre> <br><p>  Of course, it may also be necessary to save a folder from the server and the same server is the docker host, this also works. </p><br><p>  In one config.yaml there can be many backup servers and also many clients.  We have for example several servers at Hetzner and they are also registered in the config.yaml </p><br><h3 id="start">  Start </h3><br><p>  Now that we have config.yaml, we can make a backup. <br>  Command list </p><br><pre> <code class="bash hljs">/nodebackup <span class="hljs-comment"><span class="hljs-comment"># node BackupExecV3.js -h Usage: BackupExecV3 [options] Options: -h, --help output usage information -V, --version output the version number -b, --backup start backup -e, --exec [exec] server, which start backup job -t, --target [target] single server for backup -s, --server [server] backup server -d, --debug debug to console -f, --debugfile debug to file -r, --restore starte restore -c, --pathcustom [pathcustom] path to restore data (custom path) -o, --overwrite overwrite existing folder by recovery -p, --pathdefault [pathdefault] default path from config.yml -m, --time [time] backup from [time] -i, --verify verify all backups on a backup server Info: Read README.md for more info Backup: Backup: sudo ./BackupExecV3 -b -e backup2 -s backup2 Single backup: sudo ./BackupExecV3 -b -e backup2 -s backup2 -t freepbx Recovery: Backup to original path: sudo ./BackupExecV3.js -r -t backup-new-test -s backup2 -p freepbx -o Backup to custom path: sudo ./BackupExecV3.js -r -t backup-new-test -s backup2 -c freepbx:/tmp/newFolder Backup to custom path: sudo ./BackupExecV3.js -r -t backup-new-test -s backup2 -c freepbx:/tmp/newFolder -o -m (2D|1W|10s|50m)</span></span></code> </pre> <br><h4 id="primer-1">  Example 1 </h4><br><p>  Make a backup: </p><br><pre> <code class="bash hljs">node BackupExecV3.js -b -e backup2 -s backup2 -d/f</code> </pre> <br><p>  See the program in config.yaml and determine which servers should be saved.  After which a backup is made. </p><br><h4 id="primer-2">  Example 2 </h4><br><p>  We make a backup of a separate server or container </p><br><pre> <code class="bash hljs">node BackupExecV3.js -b -e backup -s bacup2 -t CONTAINERNAME -d/f</code> </pre> <br><h3 id="eschyo-nemnogo-uproschaem">  We simplify a little more </h3><br><p>  In order not to install nodebackup manually, I made an image for the docker ( <a href="https://hub.docker.com/r/adito/nodebackup/">here</a> ) </p><br><p>  This container needs to be fed three files - config.yaml, crontab.tmp and ssh key <br>  docker-compose.yaml </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">nodebackup:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> adito/nodebackup <span class="hljs-symbol"><span class="hljs-symbol">hostname:</span></span> nodebackup <span class="hljs-symbol"><span class="hljs-symbol">environment:</span></span> - SSMTP_SENDER_ADDRESS=no-reply@example.com - SSMTP_MAIL_SERVER=mail.example.com - SSMTP_HOST=nodebackup.example.com <span class="hljs-symbol"><span class="hljs-symbol">volumes:</span></span> - ./config/config.<span class="hljs-symbol"><span class="hljs-symbol">yml:</span></span>/nodebackup/config.<span class="hljs-symbol"><span class="hljs-symbol">yml:</span></span>ro - ./config/<span class="hljs-symbol"><span class="hljs-symbol">id_rsa:</span></span>/nodebackup/<span class="hljs-symbol"><span class="hljs-symbol">id_rsa:</span></span>ro - ./config/crontab.<span class="hljs-symbol"><span class="hljs-symbol">tmp:</span></span>/crontab.<span class="hljs-symbol"><span class="hljs-symbol">tmp:</span></span>ro - <span class="hljs-regexp"><span class="hljs-regexp">/etc/timezone</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/etc/timezone</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ro</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/etc/localtime</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/etc/localtime</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ro</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/a/data</span></span><span class="hljs-regexp"><span class="hljs-regexp">/nodebackup/log</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/a/data/log</span></span> <span class="hljs-symbol"><span class="hljs-symbol">restart:</span></span> always</code> </pre> <br><p>  crontab.tmp </p><br><pre> <code class="bash hljs">MAILTO=admin@example.com NODE_PATH=/usr/lib/nodejs:/usr/lib/node_modules:/usr/share/javascript <span class="hljs-comment"><span class="hljs-comment"># mh dom mon dow command 0 22 * * * node /nodebackup/BackupExecV3.js -b -s backup2 -e backup2 -f 0 22 * * * node /nodebackup/BackupExecV3.js -b -s hetznerdocker -e hetznerdocker -f 0 22 * * * node /nodebackup/BackupExecV3.js -b -s hetznerdocker2 -e hetznerdocker2 -f 0 22 * * * node /nodebackup/BackupExecV3.js -b -s hetznerdocker3 -e hetznerdocker3 -f 0 22 * * * node /nodebackup/BackupExecV3.js -b -s hetznerdocker4 -e hetznerdocker4 -f 0 22 * * * node /nodebackup/BackupExecV3.js -b -s hetznerdocker5 -e hetznerdocker5 -f</span></span></code> </pre> <br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  I don‚Äôt know how the rest do it, I was a little googled, but I didn‚Äôt find anything good on this topic, it might not even be very correct, but everything was very simplified. </p><br><p>  In the readme, there are other examples written on the githaba for recovery and verification, but I didn‚Äôt give them here, because everything seems to be there, the main thing is to create the correct configuration - config.yaml. </p><br><p>  I wrote it for two reasons. </p><br><ol><li>  We are slowly thinking of switching to kubernetes and there in my opinion it will be the wrong decision.  Maybe someone will tell in the comments the right decision. </li><li>  I did everything for quite a while and wrote, and I would like other people to use it. </li></ol><br><h4 id="ssylki">  Links </h4><br><ol><li>  <a href="https://github.com/aditosoftware/nodebackup">Nodebackup</a> </li><li>  <a href="https://hub.docker.com/r/adito/nodebackup/">Nodebackup container</a> </li><li>  <a href="http://duplicity.nongnu.org/">Duplicity</a> </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/335880/">https://habr.com/ru/post/335880/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335870/index.html">What is DNSBL and how can you not get there</a></li>
<li><a href="../335872/index.html">HAProxy as LoadBalan—Åer for RDP truss. Reliable solution for $ 0</a></li>
<li><a href="../335874/index.html">How we migrated from InboxSDK to Gmail.js</a></li>
<li><a href="../335876/index.html">Traveling over the hill and back: how not to get a job abroad</a></li>
<li><a href="../335878/index.html">Pragmatic functional programming</a></li>
<li><a href="../335882/index.html">Counting the number of links to an entry in the table via Foreign Keys</a></li>
<li><a href="../335884/index.html">New application for solving the problem P vs. NP</a></li>
<li><a href="../335886/index.html">Built-in buttons in Telegram Bot API</a></li>
<li><a href="../335890/index.html">‚ÄúTo each according to a quantum‚Äù: Will quantum computing become a commercial product?</a></li>
<li><a href="../335892/index.html">Show your passport. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>