<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Improving Redgate SQL Search: Some Development Points</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I love and use the Redgate utilities, including the free Redgate SQL Search, when working in the SQL Server Management Studio. 
 Everything would be f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Improving Redgate SQL Search: Some Development Points</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/85e/ac2/364/85eac2364a474820e8d46f1ef96e5b75.png" align="right"><br>  I love and use the <a href="http://www.red-gate.com/products/sql-development/">Redgate</a> utilities, including the free <a href="http://www.red-gate.com/products/sql-development/sql-search/">Redgate SQL Search,</a> when working in the SQL Server Management Studio. <br>  Everything would be fine, but I still dreamed of a sane tool that would allow you to create your own folders in the object tree and put labels / procedures in them. <br>  At one point, such a one appeared - <a href="http://www.sqltreeo.com/wp/">SQLTreeO</a> , but then I came across a problem - SQLSearch does not search in the folders it created. <br><br><a name="habracut"></a><br><br>  Actually, the small addin for the addin started with this - <a href="http://www.facebook.com/SQLSearchExtender">SQLSearch Extender</a> .  Further - more, once such a binge went, then why not add as much functionality as Redgate is not in a hurry to implement the <a href="http://redgate.uservoice.com/forums/101149-sql-search-feature-suggestions">wishes of users</a> . <br>  What is added to the SQLSearch functionality (settings in Tools -&gt; SQL Search Extender menu): <br><ul><li>  Search in folders created by SQLTreeO </li><li>  <a href="http://msdn.microsoft.com/en-us/library/az24scfc.aspx">Regexp</a> search </li><li>  Code highlighting and line numbering, navigation through entries </li><li>  Shows table and CLR UDF scripts </li><li>  Filter to exclude from searches by object name (for example, sp_MS%,% __ temp, etc.) </li><li>  <a href="http://www.facebook.com/SQLSearchExtender/info">... all sorts of extra chips</a> </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, notes on the development. <br>  The API for Microsoft SSMS does not advertise, the following articles helped a lot at the start - <br>  <a href="http://jcooney.net/post/2007/11/26/The-Black-Art-of-Writing-a-SQL-Server-Management-Studio-2005-Add-In.aspx">SQL Server Management Studio 2005 Add In</a> and <a href="http://sqlblog.com/blogs/jonathan_kehayias/archive/2009/08/22/sql-2008-r2-breaks-ssms-addins.aspx">SQL 2008r2 breaks ssms addins</a> <br><br>  Almost all that is necessary for happiness, these articles are told, I will note a few points <br><br><h4>  The moment 1. We catch window SQLSearch. </h4><br>  Since we have practically no information initially, we hang the handler on Connect.OnCmdUIContextChanged and recall WinAPI EnumChildWindows.  With deep inner satisfaction, we find that within the desired window lies the heir from UserControl, then by type and name ( <a href="http://hawkeye.codeplex.com/">Hawkeye</a> to help) we find the elements we need.  Further we do everything that it is necessary for us with the interface. <br><br><h4>  The moment 2. Search in folders SQLTreeO </h4><br>  The idea is simple - after running the SQLSearch search, we look at the element selected in the Object Explorer and, if its name does not match the one we need, then we go up to the server node level and run through the folders. <br><br><h4>  The moment 3. Syntax highlighting. </h4><br>  Scripts SQLSearch displays in standard RichEdit.  I really wanted to cover it from above with the editor from the studio itself (a <a href="http://go4answers.webhost4life.com/Example/vspackage-core-editor-contained-65772.aspx">random link</a> for keywords), it almost worked out, but I didn‚Äôt have the patience to investigate and eliminate all sorts of minor troubles. <br>  As a result, I took the path of least resistance, hiding it behind my RichEdit and remembering the existence of Microsoft.SqlServer.SqlParser.Parser and, for speed, forming <a href="http://www.biblioscape.com/rtf15_spec.htm">RTF</a> handles. <br><br><h4>  Moment 4. I want a beautiful icon in the Tools menu! </h4><br>  No matter how funny it is, but if this is done without problems in the drop-down context menus, in this case I did not find the information, I had to tinker - go to System.Windows.Forms.AxHost, IPictureDisp and conjure with masks. <br><br><h4>  Moment 5. I want to search regexp'ami! </h4><br>  At first, I was saddened, because I did not see a way to do this without modifying SQLSearch itself, but then a solution was found. <br>  SQLSearch for caching data uses SQLite and .NET wrapper for it <a href="http://system.data.sqlite.org/">System.Data.SQLite</a> , the library is actually loaded at the moment when we start the search.  But since we are in the same domain and catch the window before the search begins, we can quickly load our SQLite library.  Download the System.Data.SQLite sources, make sure that the version number and key match the one used by SQLSearch itself, and modify the System.Data.SQLite.SQLiteCommand, catching sql queries and modifying the ones you need. <br>  Implementing the search itself with regexps was easy - just implement a class in your library, marking it with the SQLiteFunction attribute - <a href="http://sqlite.phxsoftware.com/forums/p/348/8657.aspx">SQLite REGEXP function</a> , after which we can write all sorts of things like <code>select * from table where text REGEXP '.*GOOD\Z'</code> <br><br>  The same hack helped remove the limit on the maximum number of search results - SQLSearch limits the output to 150 results. <br><br><h4>  The moment 6. Reception of scripts of objects. </h4><br>  It's simple - helps Microsoft.SqlServer.Management.Smo <br><br>  In the plans, just4fun, I want to decompile and show the CLR UDF source files using the related <a href="http://www.reflector.net/">.NET Reflector</a> , but for now there are problems related to the fact that <br><ul><li>  addin itself should use a version of the .NET Framework no older than 3.5 (SSMS requirement), and .NET Reflector should not use 4.0 under.  (we go around through COM ...) </li><li>  it is impossible to call a COM object written under .NET from .NET (it costs ...) </li><li>  and after all this was defeated and worked in the test version, when launched from SSMS, it drops from COM error 8004003. </li></ul><br><br>  Written under MS Visual Studio 2010, .NET framework 3.5 and tested under Microsoft SQL Server Management Studio 10.0.1600.22 (SQL Server 2008R2) <br><br>  The source itself is not yet spread, but the library is not closed by anything, the amount of code is small and, if there is a reflector, anyone can see the implementation. <br><br><h4>  References: </h4><br>  <a href="http://bit.ly/HCw722">Download</a> <br>  The page <a href="http://www.facebook.com/SQLSearchExtender">SQLSearchExtender</a> on the side of the book <br>  "Discussion" on the <a href="http://forum.sqltreeo.com/viewtopic.php%3Ff%3D5%26t%3D92%26sid%3D4c737e9c0fa087b5bd6d1308fb8087a4">SQLTreeO</a> forum <br><br>  <b>Upd 2012.06.27</b> <br>  Fixed crash under SSMS v.10.50. * <br><br>  In the meantime, the point is, on the Redgate site, SQLSearch has been updated from version 1.1.4.3 to 1.1.6.1 and <b>[FIXED], the</b> <s>hack with SQLite substitution on the fly now does not work.</s> <s><br></s>  <s>It helps to copy x: \ Program Files (x86) \ SQLSearch2SQLTreeO \ SQLite.Interop.dll and x: \ Program Files (x86) \ SQLSearch2SQLTreeO \ System.Data.SQLite.dll to "x: \ ProgramData \ Red Gate \ SQL Search \ Active "and" x: \ ProgramData \ Red Gate \ SQL Search \ Source ".</s>  <s>Here is such a bad luck, I will understand.</s> </div><p>Source: <a href="https://habr.com/ru/post/146539/">https://habr.com/ru/post/146539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146534/index.html">Do not be afraid of small business</a></li>
<li><a href="../146535/index.html">The Private Cloud Center has been updated on TechNet</a></li>
<li><a href="../146536/index.html">3D-simulator data center with reference to the monitoring</a></li>
<li><a href="../146537/index.html">Code Review Open Source Projects</a></li>
<li><a href="../146538/index.html">Mini reverse engineering and modification of Windows Phone applications</a></li>
<li><a href="../146540/index.html">What is Digital Venturis 466 capable of?</a></li>
<li><a href="../146541/index.html">Installing the Nvidia CUDA toolkit on Ubuntu 12.04 x86_64</a></li>
<li><a href="../146542/index.html">165 terabytes of satellite photos will be added to the Bing cards</a></li>
<li><a href="../146543/index.html">Summer. Windows 8. Application Excellence Labs</a></li>
<li><a href="../146544/index.html">AAAA batteries of 9V crown</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>