<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>reboot with web-interface or trigger: simple and cheap synchronization of processes through a locked read ()</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often, admin and web-based programming tasks require synchronization between different components of the system, for example, a webmord accepts a comm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>reboot with web-interface or trigger: simple and cheap synchronization of processes through a locked read ()</h1><div class="post__text post__text-html js-mediator-article">  Often, admin and web-based programming tasks require synchronization between different components of the system, for example, a webmord accepts a command to perform some action, it is desirable to perform this action as early as possible, but the web interface itself cannot firewall or routing table simply because root authority is required).  I usually solved it in an ugly and inefficient way - the web interface wrote a command to some special file, and another shell script (working as root) looped through the file once every few seconds, and if there are commands, I processed them. <br><br>  In this post I will describe a simple way that: <br><ul><li>  no programming required - only unix-way system building from small bricks </li><li>  it doesn‚Äôt wipe a lot of resources (you don‚Äôt need to waste a file, and the program itself weighs much less shell) </li><li>  triggered instantly </li></ul><br><br><a name="habracut"></a><br>  The solution is peeped in qmail's source.  The standard read () operation is blocked if there is no read data (except for the case when you specifically set non-blocking options for the socket).  read () + fifo files solve the problem.  The handler must read the data from the fifo file.  While it is empty - it will simply go to sleep and will not create a load.  And as soon as the data appears, read () is completed, and processing code can be executed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To do this, "on the knee" was written a simple program from the <a href="">trigger</a> .  When launched, it listens to the file specified by it, and when data appears in it, it immediately calls the command specified in the parameters (from the user from whom the trigger is running, and not from the user who ‚Äúpulled the trigger‚Äù) <br><br> <code>xenon@dot:~/trigger-1.0$ ./trigger /tmp/myfifo ./prog.sh <br> fifo: /tmp/myfifo, program: ./prog.sh <br> file /tmp/myfifo doesn't exists, create it <br> created fifo /tmp/myfifo <br> xenon@dot:~/trigger-1.0$ chmod a+w /tmp/myfifo <br> xenon@dot:~/trigger-1.0$ pidof trigger <br> 8552 <br></code> <br>  The program started (by the daemon), created the FIFO file myfifo and when the data appears in it, it will launch the program prog.sh.  With the second command, we allowed everyone to write in the FIFO, but, of course, you can configure it more carefully (for example, allow recording for group members and assign the group www-data). <br><br>  The prog.sh script itself is very simple in our case - it simply writes the start time to the log: <br> <code>xenon@dot:~/trigger-1.0$ cat prog.sh <br> #!/bin/sh <br> <br> echo `date` started, ui: `whoami` &gt;&gt; program.log <br></code> <br><br>  Naturally, in your case, you need to replace it with your script that will do the work. <br><br>  Now check: <br> <code>www-data@dot:/tmp$ id <br> uid=33(www-data) gid=33(www-data) =33(www-data) <br> www-data@dot:/tmp$ echo &gt; /tmp/myfifo <br> www-data@dot:/tmp$ echo &gt; /tmp/myfifo <br> www-data@dot:/tmp$ echo &gt; /tmp/myfifo <br> www-data@dot:/tmp$ exit <br></code> <br><br>  Look what happened: <br> <code>xenon@dot:~/trigger-1.0$ cat program.log <br> . . 1 20:47:47 NOVST 2011 started, ui: xenon <br> . . 1 20:47:48 NOVST 2011 started, ui: xenon <br> . . 1 20:47:49 NOVST 2011 started, ui: xenon <br></code> <br><br>  As you can see, the script started at the same second as the command was sent.  Voila! <br><br>  The trigger itself weighs only 12Kb, and the blocked read () doesn‚Äôt particularly load the system and works instantly. <br><br>  Now you can easily stick the web interface to system operations (reboot the machine, restart the service, add rules to iptables, etc.).  Naturally, we believe that the untrusted code from the web server group does not work, and access to the web interface will be password protected via https and only from the local network.  You have a trigger, so now it's easier to shoot your foot.  :-) </div><p>Source: <a href="https://habr.com/ru/post/78870/">https://habr.com/ru/post/78870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../78863/index.html">Auto Debug Tool</a></li>
<li><a href="../78864/index.html">50 resources in the style of "Hand Drawing" sets of icons, brushes, textures and fonts</a></li>
<li><a href="../78866/index.html">DDoS'erov began to catch</a></li>
<li><a href="../78867/index.html">How do you think?</a></li>
<li><a href="../78868/index.html">Wishmaster</a></li>
<li><a href="../78871/index.html">‚ÄúHeavenly delight‚Äù: is one person enough?</a></li>
<li><a href="../78872/index.html">Shake indemnity insurance company</a></li>
<li><a href="../78875/index.html">Racing simulator for $ 200,000</a></li>
<li><a href="../78876/index.html">Start in Garage in St. Petersburg</a></li>
<li><a href="../78880/index.html">Video from OpenSQL Camp o MySQL and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>