<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Docker implementation for a small project in Production</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is dedicated to everyone who still thinks, and should I bother with this technology having a small virtual machine on one of the well-kno...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Docker implementation for a small project in Production</h1><div class="post__text post__text-html js-mediator-article"><img src="http://i0.wp.com/www.berezins.com/wp-content/uploads/CotW-CoreOS-Docker.jpg?resize=1000%2C703" alt="image"><br><br>  This article is dedicated to everyone who still thinks, and should I bother with this technology having a small virtual machine on one of the well-known hosters and what will it give me in the end. <br>  Those who are interested are welcome under cat. <a name="habracut"></a><br><br>  I hasten to note that this article is not a complete guide to action, but merely describes one of the possible scenarios for deploying your own server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I have extensive experience working with various hosting providers, I can choose a site for both large and small projects, I know the pros and cons of some sites and I have my own opinion.  Since this is an informative article and not an advertising article, we will not operate with the final site names.  And we will set only several conditions: <br><br><ol><li>  The latest development version of the OS, without any unnecessary components, the latest version of Docker, how to install it is described in detail in the <a href="https://www.docker.com/products/overview">documentation</a> . <br><br></li><li>  Another great way is to use an OS created specifically for containers, for example <a href="https://coreos.com/docs/">CoreOS</a> </li></ol><br>  I will dwell in more detail on option number 2, since I chose it for myself.  Initially, I chose between RancherOS and CoreOS, but during the first period of operation I found many flaws, problems and inconveniences, and then decided to abandon its use.  For those who are interested in what kind of OS, he can easily cope with Google and look for information about it.  In short, this is fork, but CoreOS but the only system services are Docker containers.  In general, they are quite similar, each has its own features.  But the lack of good documentation for me, the lack of good documentation, the ability to perform a number of settings via cloud-config and a couple more moments of utilization of memory and system resources became a disadvantage of the rancher.  Not to mention the fact that the file system structure is cleared to its original state except for the / opt and / home folders.  Also, one of the drawbacks of this distribution was that by default, like all Linux distributions, it is set to the UTC time zone, but there was no way to change this in the console after installation, and you had to completely change the console to any supported one, for example CentOS or Ubuntu, which is not very convenient, takes extra time and disk space.  Also, the initialization commands from cliud-config and user-config are executed only in the context of our console.  Therefore specific.  Everything is fine with CoreOS, you can do this: <br><br><pre><code class="bash hljs">cp /usr/share/zoneinfo/Europe/Moscow /etc/localtime</code> </pre> <br>  And after forwarding these settings in any of our containers.  Another problem was the creation of a start-up script, which Rancher should execute after installation, the script was successfully created, but not executed.  Although the rights were established correctly.  As far as working with it, a lot of minor issues arose, in consequence of which it was decided to abandon its use.  And choose CoreOS, which by the way out of the box supports clustering, which is not the case at all in RancherOS.  In addition, CoreOS can work with Docker containers as well as with its own Rocket (rkt), which is of course a plus.  Another feature of CoreOS is auto updates, which it requests very often, and if it is received, it will restart all of it completely, of course, it is fixable at the installation stage or in the user configuration file, but the developers themselves recommend not to change this value and allow the OS to reboot when you have a cluster, and services automatically migrate to the nodes it is not so critical, but if you have 1 server, then perhaps this feature will be critical to service downtime in a few minutes.  Although to be honest, the download is very fast. <br><br>  In general, both installation options have no differences, except that one OS is so minimalistic that it does not even have a package manager.  But no one forbids deploying containers on the usual distribution.  I did not want to have any extra software on the host machine, and I believe that I can install any utilities or programs in the container I need, which I can remove at any time without violating the integrity of the OS itself. <br><br>  First, install CoreOS on our server, if your operator allows you to download this image.  Initially, you need to create a cloud-config.yml configuration file in YAML format: <br><br><pre> <code class="hljs dos">#cloud-config hostname:    #        write_files: - <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>: /etc/systemd/timesyncd.conf content: | [<span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>] NTP=<span class="hljs-number"><span class="hljs-number">0</span></span>.ru.pool.ntp.org <span class="hljs-number"><span class="hljs-number">1</span></span>.ru.pool.ntp.org #     sshd write_files: - <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>: /etc/ssh/sshd_config permissions: <span class="hljs-number"><span class="hljs-number">0600</span></span> owner: root:root content: | #   . UsePrivilegeSeparation sandbox Subsystem sftp internal-sftp PermitRootLogin yes PasswordAuthentication no ChallengeResponseAuthentication no Port    PrintLastLog yes PrintMotd yes SyslogFacility AUTHPRIV RSAAuthentication yes PubkeyAuthentication yes PermitEmptyPasswords no UseDNS no UsePAM yes coreos: units: #     - name: <span class="hljs-number"><span class="hljs-number">10</span></span>-static.network runtime: true content: | [Match] Name=     [Network] DNS=<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span> DNS=<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span> Address=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">100</span></span>.<span class="hljs-number"><span class="hljs-number">100</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> Gateway=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">100</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DHCP=no #       Europe/Moscow - name: settimezone.service command: <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> content: | [Service] ExecStart=/usr/bin/timedatectl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-timezone Europe/Moscow RemainAfterExit=yes <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span>=oneshot #    sshd     - name: sshd.socket command: restart runtime: true content: | [Socket] ListenStream=    FreeBind=true Accept=yes #  ,         syslog   - name: journalctl-output.service command: <span class="hljs-built_in"><span class="hljs-built_in">start</span></span> content: | [Service] <span class="hljs-built_in"><span class="hljs-built_in">Type</span></span>=simple Restart=always TimeoutStartSec=<span class="hljs-number"><span class="hljs-number">60</span></span> RestartSec=<span class="hljs-number"><span class="hljs-number">60</span></span> ExecStart=/usr/bin/bash -c '/usr/bin/journalctl -o short -f | /usr/bin/ncat _ ' ExecStop= [Install] WantedBy=multi-user.target ssh_authorized_keys: -   ,          </code> </pre> <br>  I deliberately do not configure the user, and other parameters, since I have brought the minimum configuration so that your server can work to accept connections safely and be ready to launch the necessary containers. <br><br>  For those who do not have a network, after booting from the CoreOS installation disk, you can configure the networks manually: <br><br><pre> <code class="bash hljs">sudo ifconfig _ add _ip sudo route add -net 0.0.0.0/0 _ sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> nameserver 8.8.8.8 &gt; /etc/resolv.conf</code> </pre> <br>  The first line will assign our address to our map, the second will prescribe the route to all networks through this map, and the third line will register the DNS server to us, unfortunately in the base image the resolv.conf file does not even have links to the Google server, and without this line at the installation stage we get an error. <br><br>  In order to make it easier for us to upload an arbitrarily large config to our server, we can make a small adjustment. <br><br><ol><li>  Change password to user core with <code>sudo passwd core</code> ; </li><li>  Connect to the server via ssh; </li><li>  Make a copy-paste config after the <code>vi cloud-config.yml</code> . </li></ol><br>  Next, perform the installation command: <br><br><pre> <code class="bash hljs">sudo coreos-install -d /dev/sda -c cloud-config.yml</code> </pre> <br>  Where we tell the system to install on the first disk, it will make the partitioning of volumes, and the configuration file to take this one.  By the way, you can switch the installation branch, by default Stable goes but I did not do that. <br><br>  After installation we reboot, and our system is ready for use of Docker containers, and I can describe what and how I use in the next part, if it is interesting. <br><br>  Please do not kick much, this is my first article on Habre) Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/320316/">https://habr.com/ru/post/320316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320304/index.html">RGB color model history</a></li>
<li><a href="../320306/index.html">Async / await is a step back for javascript?</a></li>
<li><a href="../320308/index.html">It's time to play fair, Microsoft</a></li>
<li><a href="../320310/index.html">JunOS update on EX4500 switches in VirtualChassis - what could go wrong? Part 2</a></li>
<li><a href="../320314/index.html">Technotrack: from college to leading IT-companies</a></li>
<li><a href="../320318/index.html">Seven excellent site accelerators for Linux and Unix</a></li>
<li><a href="../320320/index.html">How is the League of Legends frame rendered?</a></li>
<li><a href="../320322/index.html">How to make localization for the Japanese market</a></li>
<li><a href="../320324/index.html">Wonderful sketches of the game Super Mario Bros</a></li>
<li><a href="../320326/index.html">All the best from Lean Startup methodology, and how testers live with it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>