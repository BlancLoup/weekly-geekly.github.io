<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of convenient organization of split (A / B) testing on the server side</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habravchane! 
 I would like to share with you some experience of organizing split testing on a project with which I had to work, I also as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of convenient organization of split (A / B) testing on the server side</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear habravchane! <br>  I would like to share with you some experience of organizing split testing on a project with which I had to work, I also ask you not to judge strictly, since this is my first article and you should not expect a really huge profit. <br>  As we all know, split (A / B) testing on the site is an experimental approach with the aim of increasing the conversion of a process on a resource by displaying different content to different groups of users. <br><a name="habracut"></a><br>  The goal of the task was to organize a fairly complex testing of different content options (both static and dynamic), with possible unlimited number of experiments and options on each resource page.  After some analysis of the existing ready-made solutions to the task, we managed to find several options - these were GWO (no longer exists as a separate service, integrated into GA), a solution based on <a href="http_split_clients_module.html">nginx</a> and <a href="http://visualwebsiteoptimizer.com/">Visual Website Optimizer</a> .  But not one of them did not fit for a number of reasons: external services transfer rendering to the client side, which can be very uncomfortable with complex tests, and nginx is far from everywhere, plus developers do not always have access to the web server configuration and also have a problem smearing logic.  Because I made the decision to implement my <s>bike</s> option, based on the example of the implementation of the nginx module. <br>  I also didn‚Äôt like the standard implementation tips (the remainder of making the last digit of the client‚Äôs IP address, etc.), so I decided to use checksums from the test key to determine the options to use absolutely any alphanumeric key, to create a huge number of options testing with any percentage.  The choice of the hash function fell on <a href="http://en.wikipedia.org/wiki/MurmurHash">MurmurHash2</a> , since it is characterized by a very good distribution and, what to hide, is used for hashing in the nginx module.  The project I'm working on is implemented in php, I recommend using <a href="https://sites.google.com/site/nonunnet/php/php_murmurhash">this</a> extension to implement the hash function. <br>  Now let's touch on the implementation.  To determine the value of the test variant for a specific experiment, I implemented the SplitTestModel class, using it as a singleton: <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SplitTestModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{...} <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $key )</span></span></span></span>{...} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSplitVariantByExperiment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $experimentName )</span></span></span></span>{...} }</code> </pre> <br>  I carried out the information about each experiment to the config, which is, in my implementation, an array of the form: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Experiment1'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Variant1'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-string"><span class="hljs-string">'Variant2'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">50</span></span> ), <span class="hljs-string"><span class="hljs-string">'Experiment2'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Variant1'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-string"><span class="hljs-string">'Variant2'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-string"><span class="hljs-string">'Variant3'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'Variant4'</span></span> =&gt; * ) );</code> </pre><br>  Where the top level key is the name of the experiment, the enclosed keys are the names of the options, and the corresponding values ‚Äã‚Äãare the percentage of impressions, '*' means all remaining percentages. <br>  As it may have already become clear, the key is hashed using MurmurHash2.  In the example given in the first experiment, with hash values ‚Äã‚Äãfrom 0 to 50% of the maximum possible hash value, the user will receive a variant value equal to 'Variant1', from 50% of the maximum possible value up to 100% - respectively the value of 'Variant2'. <br>  The convenience of the method lies in the fact that now, anywhere in the code, for a specific user we can get its variant values ‚Äã‚Äãfor any of the experiments and, depending on the variant, give this or that content to any client of any part of the page.  Usage example: <br><pre> <code class="php hljs">$variant1 = SplitTestModel::getInstance($user_id)-&gt;getSplitVariantByExperiment(<span class="hljs-string"><span class="hljs-string">'experiment1'</span></span>); $variant2 = SplitTestModel::getInstance($remote_addr)-&gt;getSplitVariantByExperiment(<span class="hljs-string"><span class="hljs-string">'experiment2'</span></span>);</code> </pre><br>  Everything is extremely simple! <br>  Thank you very much for your attention, and once again I will ask you not to judge strictly.  If anyone would be interested to gladly send the source code of the class. <br><br>  UPD: <br>  <a href="https://github.com/Jackson88/SplitTestModel">reference</a> to class implementation on github </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/169777/">https://habr.com/ru/post/169777/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169765/index.html">How did regular expressions appear</a></li>
<li><a href="../169767/index.html">Modification of Android applications from beginner and for beginners</a></li>
<li><a href="../169771/index.html">Solving problems on determining a fake coin by weighing</a></li>
<li><a href="../169773/index.html">PayOnline in Silicon Valley - or how we studied at Founders Bootcamp Silicon Valley</a></li>
<li><a href="../169775/index.html">Making audio calls from web and mobile clients (RTMP, RTMFP, WebRTC)</a></li>
<li><a href="../169779/index.html">PyCon for students</a></li>
<li><a href="../169783/index.html">Logical levels of training and psychotherapy</a></li>
<li><a href="../169785/index.html">Examples of generating and sending Email using Cach√© DBMS</a></li>
<li><a href="../169789/index.html">Yandex.Money introduced one-time SMS passwords</a></li>
<li><a href="../169791/index.html">MSc in Technical University Munich</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>