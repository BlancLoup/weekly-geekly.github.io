<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apache 2 under supervision. Monitoring the system load web server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apache 2 monitored 

 Introduction 

 Already written many posts on the Internet, on monitoring the Apache web server. When entering phrases like ‚Äúloa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apache 2 under supervision. Monitoring the system load web server</h1><div class="post__text post__text-html js-mediator-article"><h4>  Apache 2 monitored </h4><br><br><h5>  Introduction </h5><br><br>  Already written many posts on the Internet, on monitoring the Apache web server.  When entering phrases like ‚Äúload monitoring apache‚Äù in the Google search bar, the search results point to the most useful mod_status module.  And also about the even greater usefulness of this module in combination with perl-extensions.  And if you also patch these perl extensions a little bit, then generally a super system is obtained.  But having set up such a system - the system administrator does not usually stop at this, he already needs a load history for the server as a whole, then for each host, and then with the accuracy of the script.  And so it was possible to compare, and how it used to be, and how now the load is distributed. <br>  And here the module for the Apache web server - <b>mod_performance</b> can come to the <b>rescue</b> . <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  And so, we proceed to the consideration </h5><br><br>  What this module is.  This is a common Apache 2.x module for Linux.  From the <a href="http://lexvit.dn.ua/articles/%3Fart_id%3Dmod_performance117_mht201104302312">documentation</a> for it: <br><ul><li>  the module is designed to collect and accumulate statistics on the use of resources (CPU and memory, script execution time) by the Apache 2.2 web server; </li><li>  The module allows you to analyze the collected data. </li></ul><br>  What does all of this mean?  And the fact that it allows you to keep track of how many resources consumed by the incoming web server request.  Each time saving the following information: <br><ol><li>  virtual host that received the request; </li><li>  the file that is requested; </li><li>  Request URI; </li><li>  CPU load in%; </li><li>  memory usage in%; </li><li>  request processing time. </li></ol><br>  And the accumulated statistics allows you to analyze.  SQLite is used as a database for saving and analysis. <br>  As a resource utilization analyzer, not a scoreboard is used, as in mod_status and perl extensions, but glibtop. <br>  The module allows you to track absolutely all requests, as well as specific ones, filtered by the rule using regular expressions.  More precisely, it will be said that the module ALWAYS processes only those requests that match the filter containing the regular expression. <br><br><h5>  How to view accumulated data </h5><br><br>  The module provides two interfaces for viewing and analyzing data: 1) global;  2) the so-called per-host. <br>  Each interface is attached to the handler: <br><br>  <i>user-status - per-host</i> <i><br></i>  <i>performance-status - global</i> <br><br>  Access to interfaces is configured as in the mod_status module, ie: <br><br><pre> &lt;Location / perf-status&gt;
     Order allow, deny
     SetHandler performance-status
     Allow from 1.1.1.1
 &lt;/ Location&gt;
</pre><br><br>  The global interface allows you to view and analyze the accumulated data on all virtual hosts, while the per-host interface displays and analyzes only the information on the host to which the interface is attached, for example, if you call the host <a href="http://test.test.test/user-status">test.test.test / user-status</a> , then all output statistics will only concern this host.  Statistics for other hosts will not be displayed. <br><br>  The global module management interface looks like the one below: <br><img src="http://i20.fastpic.ru/big/2011/0505/63/1932686639b7e8aac2a057532d279a63.jpg" alt="Mod_performance main form"><br><br>  In the main form, in the picture you can see the fields: <br>  <b>Mode</b> - data display mode. <br>  <b>Period</b> - days, the period for displaying or analyzing data, starting from the beginning of the current day. <br>  <b>Period begin</b> - the beginning of the period specified in the format YYYY-MM-DD hh: mm: ss. <br>  <b>Period end</b> - the end of the period specified in the format YYYY-MM-DD hh: mm: ss. <br>  If Period begin is set, Period end - in this case data limited by these parameters are displayed, and the Period field is ignored.  Otherwise, the analyzed area is set by the Period parameter. <br>  <b>Hostname (SQL)</b> - filter, output data only on the specified host.  Call syntax is similar to the like construct in SQL.  Those.  if you specify "% test", then all hosts that end in "test" will be selected. <br>  <b>Script name (SQL)</b> is similar to the previous parameter, only the name of the script being called is analyzed. <br>  <b>URI (SQL)</b> is similar to the previous parameter, only the request URI is analyzed. <br>  <b>Graph Mode (Y / N)</b> - display graphics or text. <br><br>  The approximate data output looks like this: <br><img src="http://i20.fastpic.ru/big/2011/0505/ba/74d8d487fbf1faf4057b7cfc9cde51ba.jpg" alt="Text output of accumulated information"><br><br>  The host shown in the example in the picture is absolutely test, if it coincides with the real one - I apologize. <br>  A graphic display mode is shown in the figure below: <br><img src="http://i20.fastpic.ru/big/2011/0505/34/87aedd233ba5f245147c5547a81d5434.jpg" alt="Graphic output"><br><br><h5>  Analysis Modes </h5><br><br>  <b>Show output without analytics</b> - display the collected information without analysis, filtered by host, script and URI (graphic and text mode). <br>  <b>Maximal% CPU</b> - display only entries with the maximum value of% CPU (including filtering). <br>  <b>Maximal memory%</b> - display only records with the maximum value of% memory (including filtering). <br>  <b>Maximal execution request time</b> - display the most long-running script. <br>  <b>Host requests statistics</b> ‚Äî show statistics of calls to hosts with sorting in descending order (in% of the total, including filters). <br>  <b>Execution history screen (use Period begin)</b> - allows you to calculate a list of running queries for a specified time. <br>  <b>Number of requests per domain</b> - show statistics of calls to hosts with sorting in descending order (not in percents but in numbers). <br>  <b>Average usage per host</b> ‚Äî print the average server load by each host (% CPU sum,% MEMORY sum, script execution amount, average CPU% for a period, average memory usage%, average script execution time). <br>  I will not go into details and leave some modes without attention. <br><br><h5>  How to install the module </h5><br><br>  Here I give an example installation for rpm-systems.  All actions must be performed under the root user. <br>  1) install the necessary packages for the assembly: <br><br><pre>  yum install httpd-devel apr-devel libgtop2-devel sqlite-devel gd-devel </pre><br><br>  2) create a temporary paku for source codes: <br><br><pre>  mkdir ~ / my_tmp
 cd ~ / my_tmp </pre><br><br>  3) download the source code of the module and unpack the archive and go to the unpacked folder: <br><br><pre>  wget http://lexvit.dn.ua/utils/getfile.php?file_name=mod_performance_tar201104233487.gz -O mod_performance.tar.gz
 tar zxvf mod_performance.tar.gz
 cd mod_performance / </pre><br><br>  4) we assemble the module: <br><br><pre>  make </pre><br><br>  5) warning not to pay attention.  The main thing is that there is no error.  If everything is ok, then: <br><br><pre>  make install </pre><br>  or <br><pre>  cp .libs / mod_performance.so &lt;path to copy&gt; </pre><br><br><h5>  Configuring Apache </h5><br><br>  The configuration will be performed for the standard Apache installation, that is, the modules are located in the / etc / httpd / modules directory, the /etc/httpd/conf.d/ directory exists and it is connected to /ect/httpd/conf/httpd.conf. <br>  1) create a module configuration file: <br><br><pre>  touch /etc/httpd/conf.d/mod_performance.conf </pre><br><br>  2) insert into it: <br><br><pre> LoadModule performance_module modules / mod_performance.so

 &lt;IfModule mod_performance.c&gt;
 PerformanceHistory 5
 PerformanceEnabled On
 PerformanceMaxThreads 80
 PerformanceScript \ .php
 PerformanceStackSize 1
 PerformanceUseCanonical On

 &lt;Location / admin-status&gt;
 Order allow, deny
 SetHandler performance-status
 Allow from 1.1.1.1
 &lt;/ Location&gt;
 &lt;/ IfModule&gt;
</pre><br><br>  3) save the file and restart Apache: <br><br><pre>  service httpd restart </pre><br><br>  The configuration file serves only as an example.  All parameters must be selected for a specific server. <br>  The above module configuration allows you to track requests for php scripts. <br>  A description of all configuration parameters can be found in the module documentation. <br><br>  <u>Attention, currently, the module cannot track requests for Apache + mod_fcgid, Apache + mod_cgid server configurations or configurations, where the request is processed by a separate daemon.</u> <br><br>  This completes the module review. </div><p>Source: <a href="https://habr.com/ru/post/119011/">https://habr.com/ru/post/119011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119006/index.html">Russian startups in the field of e-government gather on May 13 for Feedback - Gov 2.0</a></li>
<li><a href="../119007/index.html">Seven Tester Rules</a></li>
<li><a href="../119008/index.html">Offline way to store password</a></li>
<li><a href="../119009/index.html">Optimize PNG and JPEG without losing quality. Part 1</a></li>
<li><a href="../119010/index.html">Schedule of articles on Habr√© (for any week)</a></li>
<li><a href="../119013/index.html">Project refactoring in SVN using ANT</a></li>
<li><a href="../119016/index.html">Exceptions and myths about them</a></li>
<li><a href="../119017/index.html">And once again about the responsibility</a></li>
<li><a href="../119019/index.html">Notepad service Springpad is now offline</a></li>
<li><a href="../119020/index.html">We distribute free invitations to the presentation of the flagship smartphone Samsung Galaxy S II</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>