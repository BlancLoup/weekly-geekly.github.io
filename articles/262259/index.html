<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a room motion detector on the Arduino and MATLAB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this example, a simple motion detector will be created, based on a photoresistor and an Arduino . Controlled by the Arduino Support Package for MAT...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a room motion detector on the Arduino and MATLAB</h1><div class="post__text post__text-html js-mediator-article"><p>  In this example, a simple <b>motion detector</b> will be created, based on a <b>photoresistor</b> and an <b>Arduino</b> .  Controlled by the Arduino Support Package for <b>MATLAB</b> . </p><br> <a href="http://habrahabr.ru/post/262259/"><img src="https://habrastorage.org/files/ebd/d3c/32a/ebdd3c32ad36475ab8db32a80a126e07.png"></a> <a name="habracut"></a><br><h2>  Introduction </h2><br><br><p>  A photoresistor is a variable resistor that reacts to the intensity of the incident light, therefore, the motion detector will detect only the movement that causes changes in illumination. </p><br><br><p>  A control program written in MATLAB will use commands from the Support Package to read the voltage from the Arduino pins.  Voltage values ‚Äã‚Äãwill be loaded directly into MATLAB, with reference to time.  This data will be plotted and analyzed in real time for motion detection. </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  The code uses a combination of algorithms for motion detection, but there are many other machine learning and data analysis algorithms that can be used in similar projects. </p><br><br><p>  While the motion detector is running, the MATLAB program stores all voltage readings along with the corresponding time stamps.  This allows the user to process the complete data set in MATLAB after the recording is completed.  The following article presents the results of the analysis of several such records and algorithms. </p><br><br><p>  What is needed? </p><br><ul><li>  Arduino or equivalent </li><li>  USB cable </li><li>  1 photoresistor </li><li>  10 kŒ© resistor </li><li>  Wires (MGTF 0.2 should be enough) </li><li>  Small breadboard </li></ul><br><br><h2>  Task 1 - Connect Arduino to MATLAB </h2><br><p>  To connect Arduino to MATLAB, you need to install the MATLAB support package for Arduino.  This support package is available for MATLAB, starting with the release of R2014a (current R2015a) and higher, and is installed using the installer of support packages.  This installer can be opened from the MATLAB ribbon (Add-Ons -&gt; Get Hardware Support Packages) or from the command line using the supportPackageInstaller command.  After installing the support package, you can connect Arduino. </p><br><p>  Procedure </p><br><ol><li>  Connect the Arduino to your computer using a USB cable. </li><li>  In MATLAB, initialize an Arduino object: </li></ol><br><pre><code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% Inputs: Port ID (from your computer), Arduino board type myArduino = arduino('COM4','uno');</span></span></code> </pre> <br><br><h2>  Task 2 - Check MATLAB-Arduino Connection </h2><br><p>  Most Arduino boards or clones have a built-in LED at pin 13. If your board has a LED, you can test the connection by simply flashing them. </p><br><p>  If there is no built-in LED, you can connect one in series to a resistor between the digital output (for example, 13) and GND (see electrical diagram below). </p><br><p>  The resistor value will be different for the LED color, but for the red and yellow LEDs, a 330 Ohm resistor should be sufficient.  When the LED is connected, to check it is necessary to execute the code below (we blink the LED 5 times). </p><br><img src="https://habrastorage.org/files/da0/6d5/aeb/da06d5aeb2164452bb083154036a65d9.png"><br><img src="https://habrastorage.org/files/1eb/bcc/dbb/1ebbccdbb3a54aae984b943f7f8bf52c.png"><br><br><h2>  Task 3 - Build the Scheme </h2><br><p>  It is important that, like all resistors, the photoresistor has no orientation - no need to worry about the direction of the current flowing through it.  First, you need to create a simple voltage divider using a photoresistor: </p><br><ol><li>  On a breadboard, connect a photoresistor and a 10kŒ© resistor in series. </li><li>  Connect the free output of a 10 kŒ© resistor to the GND Arduino output. </li><li>  Connect the free output of the photoresistor to the output 5V Arduino. </li></ol><br><p>  To measure the voltage between the photoresistor and 10 kOhm resistor, you need to connect this point in the circuit to the analog output of the Arduino using a wire.  This bundle will work as a potentiometer. </p><br><img src="https://habrastorage.org/files/39e/821/d2f/39e821d2f0e34741ab8372ea8cf01429.png"><br><br><h2>  Task 4 - Checking the circuit and photoresistor </h2><br><p>  The next step is to check the circuit in order to make sure that the photoresistor responds correctly to changing illumination. </p><br><p>  The script below shows how to set up an Arduino and get voltage readings from a photoresistor via an analog Arduino pin. </p><br><p>  Try to cover the photoresistor or turn on / off the light in the room when the script is running to see how the photoresistor reacts to changes in light. </p><br><img src="https://habrastorage.org/files/75e/fef/ca9/75efefca963a4a1695e9686aea713af6.png"><br><img src="https://habrastorage.org/files/4e0/80d/33a/4e080d33aa494f56bf8308d3b86d28e2.png"><br><div class="spoiler">  <b class="spoiler_title">The principle of operation of photoresistors with MATLAB</b> <div class="spoiler_text"><p>  A photoresistor is a variable resistance resistor that responds to the intensity of the incident light.  The brighter the light, the lower the resistance of the photoresistor.  A simple voltage divider, in the form of a series connection of a photoresistor and a resistor with constant resistance, will convert the changes in the resistance of the circuit into measured voltage drops.  MATLAB is used to read the voltage from the analog output of the Arduino.  When the voltage value is written to MATLAB, the program can correlate each voltage value with the corresponding light level.  Even simple photoresistors can be very sensitive, providing reading of the full voltage range (0-5 V) from the analog output of the Arduino.  MATLAB reads these voltages with rounding to the nearest 0.0049 volts, because the analog signal is converted to a 10-bit digital signal: </p><br><img src="https://habrastorage.org/files/f5a/208/09e/f5a20809ea884c90876503bc532ce46c.png"><br><br></div></div><br><br><h2>  Task 5 - Calibration of Motion Detection Algorithm </h2><br><p>  Since the photoresistor has a high sensitivity, motion detection algorithms will require calibration, which will depend on the ambient lighting conditions and the scenario of using the motion detector.  Software light levels must also be adjusted for the desired sensitivity. </p><br><p>  The MATLAB code for motion detection (Run_Motion_Detector.m) uses three types of calculations in real time to determine that the current voltage value corresponds to movement. </p><br><p>  Each calculation is a simple way to quantify variability within a small data window.  Each result of the calculation is compared with the corresponding threshold, to determine whether this change indicates movement.  If any of the results exceeds the corresponding variable threshold value, the current voltage value is referred to as motion. </p><br><p>  Threshold variables are directly related to the sensitivity of the motion detector and must be calibrated for each specific situation. </p><br><p>  Total implemented 3 methods: </p><br><ol><li>  The standard deviation method ‚Äî calculates the standard deviation of all points within the data window using <strong>std</strong> <strong>(</strong> <strong>voltages</strong> <strong>)</strong> .  This is the basic calculation of the difference between the voltage readings. </li><li>  Difference method - calculates the sum of absolute values ‚Äã‚Äãof differences between successive points using <strong>sum (</strong> <strong>abs (</strong> <strong>diff (</strong> <strong>voltages)))</strong> .  This is the calculation of the net change between consecutive data points in the data window. </li><li>  The Slope method calculates the most suitable linear trend (slope) for the data window.  Required as voltage readings, the same time counts. </li></ol><br><p>  For a descriptive analysis of the lighting conditions, the getLightingCondition function qualitatively describes the light intensity at each voltage reading. </p><br><p>  This function must also be calibrated and extended accordingly to describe the level of illumination at the site of your motion detector. </p><br><br><h2>  Task 6 - Handling Recorded Data </h2><br><p>  Many motion sensors are only intended to detect movement in real time, as they are designed to automate a specific task.  This is a very common type of motion detector used in automatic doors at airports and shops, or by motion-activated switches in office buildings. </p><br><p>  The motion detector created using MATLAB, built in this example, can not only detect movement in real time, but also record and collect sensor readings throughout the entire recording session. </p><br><p>  The Run_Motion_Detector function automatically saves the raw values ‚Äã‚Äãof analog voltages and the time-cutoffs of the variables analogVoltage and sensorTime in the MATLAB basic workspace. </p><br><p>  After saving to MATLAB, this data can be transferred to the Analyze_Motion_Detector_Data function to implement and compare various motion detection algorithms.  The figure below shows the results of the three motion detection algorithms applied to the complete data set. </p><br><p>  Red data markers are characterized as movement in all three ways.  It is significant that some movements are detected only by the Slope method (shown by green markers), while other movement is detected only by the standard deviation method and / or the difference method (shown by blue markers). </p><br><p>  Using a combination of these three methods to determine motion, a motion detector implemented in MATLAB can create a complete motion record. </p><br><img src="https://habrastorage.org/files/01d/8ad/afe/01d8adafe50d46348d3d95b9891c30c7.png"><br><img src="https://habrastorage.org/files/21e/9d4/a34/21e9d4a344e74c229382c00b27f95a1a.png"><br><br><h2>  Task 7 - Motion Classification </h2><br><p>  Using MATLAB for data processing, it is easy to select motion events and characterize each according to several calculated parameters. </p><br><p>  Some simple parameters that can be calculated include: </p><br><ul><li>  light level before the motion event occurred </li><li>  light level after movement </li><li>  Average illumination during the motion event </li><li>  Total time for motion event </li></ul><br><p>  The Categorize_Motion_Events function calculates these four parameters for each motion event and uses them to qualitatively describe motion records. </p><br><p>  Descriptions are used to create tick marks on a voltage chart.  Motion marks consist of three characters and are located above the motion event. </p><br><ol><li>  The first symbol - plus, minus, or the equal sign indicates an increase in illumination intensity (+), a decrease (-), or immutability (=) in the vicinity of a motion event. </li><li>  The next character is a letter denoting a certain type of movement. Movement types with the corresponding letters are listed below. <br><ul><li>  G: Continuous movement (change of lighting occurs for more than 20 seconds) </li><li>  E: Extended motion (change of lighting occurs within a few seconds) </li><li>  M: Significant change in illumination (changes in illumination dramatically around the event) </li><li>  C: Combination (change in light during and around the event) </li><li>  L: change in light (slight change in light around event) </li><li>  T: Temporary movement (no significant changes in light around the event) </li></ul><br></li><li>  The third sign (if specified) shows how the mean value of the light intensity during each motion event is related to the previous and next light intensities, using the same plus, minus, and equal signs as for the first character. </li></ol><br><p>  If you want to track specific types of motion, you can tighten the restrictions to get a more accurate classification, or use the MATLAB machine learning methods to program an automatically tuned motion detector. </p><br><img src="https://habrastorage.org/files/1d1/e55/2dd/1d1e552dd9cd4470a1519eea5db3c403.png"><br><img src="https://habrastorage.org/files/94e/e1b/561/94ee1b561feb4e4abb836e2790d00309.png"><br><br><h2>  Practical use: Monitoring activity in the lobby </h2><br><p>  Since the motion detector is sensitive to changes in light, it will work best when the movement you want to track corresponds to a sharp increase or a sharp decrease in light. </p><br><p>  One of the scenarios that works well for detecting people is to locate a motion detector in a corridor on a well-lit wall or next to a light source.  When people pass through the corridor, there will be a sharp drop in voltage when their shadows fall on the photoresistor. </p><br><p>  The graph below shows the data collected by the motion detector in the lobby.  Motion events are classified using the version of the Categorize_Motion_Events function, which has been specially modified to analyze data collected in the lobby. </p><br><p>  Motion events classified as lighting changes (M or L) can be dropped as they most likely do not indicate people passing through the hall. </p><br><p>  This leaves nine events that seem to indicate the passage of people.  Further analysis can be performed to calculate a person‚Äôs speed while walking or how many people were in a group, studying the length of a motion event. </p><br><img src="https://habrastorage.org/files/73f/b0b/d05/73fb0bd05e664b91baf5648d415f4bba.png"><br><img src="https://habrastorage.org/files/bf9/1bf/6c0/bf91bf6c04c24a9899b1bfa92f4a549f.png"><br><br><h2>  Conclusion </h2><br><p>  With Arduino, a simple motion detector was created, MATLAB was used to calibrate the detector and classify motion. <br>  Practical application: practice on cats to hone their algorithm and then transfer to a more serious component base. </p><br><br><h2>  Article Materials </h2><br><ul><li>  <a href="http://www.mathworks.com/hardware-support/arduino-matlab.html">Arduino Support Package</a> </li><li>  <a href="http://www.mathworks.com/matlabcentral/fileexchange/47605-creating-a-motion-detector-using-an-arduino--a-photoresistor-and-matlab">Program code</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/262259/">https://habr.com/ru/post/262259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262249/index.html">How Microsoft is friends with Arduino and other companies because of IoT</a></li>
<li><a href="../262251/index.html">A bit about protecting web session identifiers</a></li>
<li><a href="../262253/index.html">Intel IoT Roadshow, the second "pancake" Edison</a></li>
<li><a href="../262255/index.html">The first 90nm product from Micron under the microscope - 16 Mibit SRAM</a></li>
<li><a href="../262257/index.html">SSDs have slack</a></li>
<li><a href="../262263/index.html">The magic of tensor algebra: Part 7 - The final rotation of a rigid body. Rotation tensor properties and method for calculating it</a></li>
<li><a href="../262265/index.html">Apps from Google Play specialize in stealing Facebook credentials</a></li>
<li><a href="../262267/index.html">How neural networks draw pictures</a></li>
<li><a href="../262269/index.html">ERP on SKALA-R - we are testing the performance of the SAP and Oracle Database bundles</a></li>
<li><a href="../262271/index.html">A simple method for extracting relationships and facts from text.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>