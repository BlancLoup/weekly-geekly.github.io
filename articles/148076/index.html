<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Entertaining functional programming in Ruby</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article focuses on a pointless journey through Ruby's degenerate form in an effort to learn more about functional programming, simplicity, and so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Entertaining functional programming in Ruby</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage2/3b9/bde/121/3b9bde1215e18beda55ea1cef62ba2fc.png"><br>  This article focuses on a pointless journey through Ruby's degenerate form in an effort to learn more about functional programming, simplicity, and software interface design. <br><br>  Suppose that the only way to represent a code is a lambda expression, and the only available data structure is an array: <br><br><pre><code class="ruby hljs">square = -&gt;(x) { x * x } square.(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; 16 person = ["Dave",:male] print_person = -&gt;((name,gender)) { puts "#{name} is a #{gender}" } print_person.(person)</span></span></code> </pre> <br>  These are the very basics of functional programming: functions are the only thing we have.  Let's try to write something more similar to real code in the same style.  Let's see how far we can go without much suffering. <br><a name="habracut"></a><br>  Suppose we want to work with a database containing information about people, and someone has provided us with several functions for interacting with the internal repository.  We want to add user interface and input validation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here is how we will contact the repository: <br><br><pre> <code class="ruby hljs">insert_person.(name,birthdate,gender) <span class="hljs-comment"><span class="hljs-comment"># =&gt;  id update_person.(new_name,new_birthdate,new_gender,id) delete_person.(id) fetch_person.(id) # =&gt;  ,       </span></span></code> </pre><br>  First, we need to be able to add a person to the database.  In this case, the input data must pass the test.  We will extract this data from the standard input stream (assuming that <code>gets</code> and <code>puts</code> are built-in functions and work as expected): <br><br><pre> <code class="ruby hljs">puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets</code> </pre><br><br>  We need a function to validate the data and add it to the database.  How can she look like?  It should take the attributes of a person and return either <code>id</code> if the validation and insertion was successful, or an error message if something went wrong.  Since we have no exceptions, no hash tables (only arrays), we will have to think creatively. <br><br>  Let's agree that in our application, all business logic methods return an array of two elements: the first element is the value of the function when it is successfully completed, and the second element is a string with an error message.  The presence or absence of a value ( <code>nil</code> ) in one of the cells of the array indicates the success or failure of the operation. <br><br>  Now that we know what needs to be taken and what needs to be returned, let's start writing the function itself: <br><br><pre> <code class="ruby hljs">add_person = -&gt;(name,birthdate,gender) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Name is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(name) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Birthdate is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(birthdate) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(gender) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender must be 'male' or 'female'"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> gender != <span class="hljs-string"><span class="hljs-string">'male'</span></span> &amp;&amp; gender != <span class="hljs-string"><span class="hljs-string">'female'</span></span> id = insert_person.(name,birthdate,gender) [[name,birthdate,gender,id],<span class="hljs-literal"><span class="hljs-literal">nil</span></span>] }</code> </pre><br>  If you do not know what <code>String()</code> , then this function returns an empty string if the value <code>nil</code> passed to it. <br><br>  We want to use this function in a loop until the user provides valid data, like this: <br><br><pre> <code class="ruby hljs">invalid = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> invalid puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets result = add_person.(name,birthdate,gender) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> puts <span class="hljs-string"><span class="hljs-string">"Successfully added person </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{result[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">][</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span> invalid = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> puts <span class="hljs-string"><span class="hljs-string">"Problem: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{result[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Of course, we did not say that cycles cannot be used :) But suppose that we do not have them. <br><br><h4>  Loops are just functions (called recursively) </h4><br>  To loop, we simply wrap our code in a function and call it recursively until we get the desired result. <br><br><pre> <code class="ruby hljs">get_new_person = -&gt; { puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets result = add_person.(name,birthdate,gender) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> puts <span class="hljs-string"><span class="hljs-string">"Successfully added person </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{result[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">][</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span> result[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> puts <span class="hljs-string"><span class="hljs-string">"Problem: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{result[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span> get_new_person.() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> } person = get_new_person.()</code> </pre><br>  We can assume that in our code there will be a lot of checks like <code>if result[1] == nil</code> , so let's wrap them in a function.  The great thing about functions is that they allow you to reuse the structure, not the logic.  The structure here is an error check and a call to one of two functions for success or failure. <br><br><pre> <code class="ruby hljs">handle_result = -&gt;(result,on_success,on_error) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> on_success.(result[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> on_error.(result[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }</code> </pre><br>  Now the <code>get_new_person</code> function uses a more abstract way to handle errors: <br><br><pre> <code class="ruby hljs">get_new_person = -&gt; { puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets.chomp result = add_person.(name,birthdate,gender) handle_result.(result, -&gt;((id,name,birthdate,gender)) { puts <span class="hljs-string"><span class="hljs-string">"Successfully added person </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{id}</span></span></span><span class="hljs-string">"</span></span> [id,name,birthdate,gender,id] }, -&gt;(error_message) { puts <span class="hljs-string"><span class="hljs-string">"Problem: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{error_message}</span></span></span><span class="hljs-string">"</span></span> get_new_person.() } ) } person = get_new_person.()</code> </pre><br>  Note that using <code>handle_result</code> allows <code>handle_result</code> to explicitly name variables instead of using array indexing.  Now we can not only use the friendly name <code>error_message</code> , but also ‚Äúsplit‚Äù the array into parts and use it as separate function parameters using the syntax of the form <code>((id,name,birthdate,gender))</code> . <br><br>  So far so good.  This code may look a little weird, but it is not wordy or confusing. <br><br><h4>  More functions - cleaner code </h4><br>  It may seem unusual that nowhere in our code there was a formal definition of the data structure for our ‚Äúperson‚Äù.  We just have an array, and we agreed that the first element is the name, the second is the date of birth, etc. The idea is quite simple, but let's imagine that we need to add a new field: the title.  What happens to our code if we try to do this? <br><br>  The database now provides new versions of <code>insert_person</code> and <code>update_person</code> : <br><br><pre> <code class="ruby hljs">insert_person.(name,birthdate,gender,title) update_person.(name,birthdate,gender,title,id)</code> </pre><br>  Change the <code>add_person</code> method: <br><br><pre> <code class="ruby hljs">add_person = -&gt;(name,birthdate,gender,title) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Name is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(name) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Birthdate is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(birthdate) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(gender) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender must be 'male' or 'female'"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> gender != <span class="hljs-string"><span class="hljs-string">'male'</span></span> &amp;&amp; gender != <span class="hljs-string"><span class="hljs-string">'female'</span></span> id = insert_person.(name,birthdate,gender,title) [[name,birthdate,gender,title,id],<span class="hljs-literal"><span class="hljs-literal">nil</span></span>] }</code> </pre><br>  Since we are using a new field, we need to update and <code>get_new_person</code> .  Khm: <br><br><pre> <code class="ruby hljs">get_new_person = -&gt; { puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Title?"</span></span> title = gets.chomp result = add_person.(name,birthdate,gender,title) handle_result.(result, -&gt;((name,birthdate,gender,title,id)) { puts <span class="hljs-string"><span class="hljs-string">"Successfully added person </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{id}</span></span></span><span class="hljs-string">"</span></span> [id,name,birthdate,gender,title,id] }, -&gt;(error_message) { puts <span class="hljs-string"><span class="hljs-string">"Problem: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{error_message}</span></span></span><span class="hljs-string">"</span></span> get_new_person.() } ) }</code> </pre><br>  This shows the whole point of the strong connectivity of the application components.  <code>get_new_person</code> does not have to worry about specific fields at all.  The function should simply read them and then transfer them to <code>add_person</code> .  Let's see how we can fix this if we move the code into several new functions: <br><br><pre> <code class="ruby hljs">read_person_from_user = -&gt; { puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Title?"</span></span> title = gets.chomp [name,birthdate,gender,title] } person_id = -&gt;(*<span class="hljs-number"><span class="hljs-number">_</span></span>,id) { id } get_new_person = -&gt; { handle_result.(add_person.(*read_person_from_user.()) -&gt;(person) { puts <span class="hljs-string"><span class="hljs-string">"Successfully added person </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{person_id.(person)}</span></span></span><span class="hljs-string">"</span></span> person }, -&gt;(error_message) { puts <span class="hljs-string"><span class="hljs-string">"Problem: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{error_message}</span></span></span><span class="hljs-string">"</span></span> get_new_person.() } ) }</code> </pre><br>  Now information about how we store data about a person is hidden in two functions: <code>read_person_from_user</code> and <code>person_id</code> .  Now we don‚Äôt need to change <code>get_new_person</code> if we want to add more fields to the record. <br><br>  If you are concerned about <code>*</code> in the code, here is a brief explanation: <code>*</code> allows you to give an array for the list of arguments and vice versa.  In <code>person_id</code> we use the parameter list <code>*_, id</code> , which tells Ruby to put all the arguments, except the last, into the <code>_</code> array (we are not interested in this array, therefore this name), and put the last one into the <code>id</code> variable.  This only works in Ruby 1.9;  in 1.8 only with the last argument you can use the syntax <code>*</code> .  Then when we call <code>add_person</code> , we use <code>*</code> with the result <code>read_person_from_user</code> .  Since <code>read_person_from_user</code> returns an array, we want to use this array as a list of arguments, since <code>add_person</code> accepts explicit arguments.  That is what it does <code>*</code> .  Fine! <br><br>  If you go back to the code, you can note that <code>read_person_from_user</code> and <code>person_id</code> still quite strongly interconnected.  They both know how we store data.  Moreover, if we added new features for processing data from our database, we would have to use functions that also know about the internal structure of the array. <br><br>  We need some kind of data structure. <br><br><h4>  Data structures are just functions. </h4><br>  In normal Ruby, we would have already organized a class or at least <code>Hash</code> by this point, but we cannot use them.  Can we make a real data structure with only functions available?  It turns out yes, we can, if we create a function that considers its first argument as an attribute of the data structure: <br><br><pre> <code class="ruby hljs">new_person = -&gt;(name,birthdate,gender,title,id=<span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -&gt;(attribute) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> birthdate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gender <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } dave = new_person.(<span class="hljs-string"><span class="hljs-string">"Dave"</span></span>,<span class="hljs-string"><span class="hljs-string">"06-01-1974"</span></span>,<span class="hljs-string"><span class="hljs-string">"male"</span></span>,<span class="hljs-string"><span class="hljs-string">"Baron"</span></span>) puts dave.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; "Dave" puts dave.(:gender) # =&gt; "male"</span></span></code> </pre><br>  <code>new_person</code> acts as a constructor, but instead of returning an object (which we don‚Äôt have), it returns a function that, when invoked, can return us the values ‚Äã‚Äãof various attributes of a particular entry. <br><br>  Compare with the implementation of the same behavior using the class: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthdate</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gender</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthdate</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gender</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">=</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthdate</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthdate</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gender</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gender</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dave</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dave</span></span></span><span class="hljs-class">","06-01-1974","</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">male</span></span></span><span class="hljs-class">","</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Baron</span></span></span><span class="hljs-class">") </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dave</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dave</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gender</span></span></span></span></code> </pre><br>  Interesting.  The size of these pieces of code is about the same, but the version with the class uses <i>special constructions</i> .  Special constructions are essentially the magic that a programming language provides.  In order to understand this code, you need to know: <br><br><ul><li>  what does <code>class</code> mean </li><li>  that calling <code>new</code> with the class name calls the <code>initialize</code> method </li><li>  what is the method </li><li>  that <code>@</code> before the variable name makes it a private class instance variable </li><li>  the difference between a class and its instance </li><li>  what does <code>attr_reader</code> </li></ul><br>  To understand the functional version, all you need to know is: <br><br><ul><li>  how to define a function </li><li>  how to call a function </li></ul><br>  As I said, it seems interesting to me.  We have two ways to do essentially the same thing, but one of them requires much more specialized knowledge from you than the other. <br><br>  Well, now we have a real data structure.  Let's change our code so that it works with it, not with arrays: <br><br><pre> <code class="ruby hljs">read_person_from_user = -&gt; { puts <span class="hljs-string"><span class="hljs-string">"Name?"</span></span> name = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Birthdate?"</span></span> birthdate = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Gender?"</span></span> gender = gets.chomp puts <span class="hljs-string"><span class="hljs-string">"Title?"</span></span> title = gets.chomp new_person.(name,birthdate,gender,title) } add_person = -&gt;(person) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Name is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Birthdate is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender must be 'male' or 'female'"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'male'</span></span> &amp;&amp; person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'female'</span></span> id = insert_person.(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>)) [new_person.(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>),id),<span class="hljs-literal"><span class="hljs-literal">nil</span></span>] } get_new_person = -&gt; { handle_result.(add_person.(read_person_from_user.()), -&gt;(person) { puts <span class="hljs-string"><span class="hljs-string">"Successfully added person </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{person.(</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:id</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span> person }, -&gt;(error_message) { puts <span class="hljs-string"><span class="hljs-string">"Problem: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{error_message}</span></span></span><span class="hljs-string">"</span></span> get_new_person.() } ) }</code> </pre><br>  <code>add_person</code> now looks less beautiful because of the syntax for obtaining an attribute, but now we can easily add new fields, preserving the structure of the program. <br><br><h4>  Object orientation is only a function. </h4><br>  We can also make derived fields.  Suppose we want to add a greeting to the user who indicated the title.  We can make this an attribute: <br><br><pre> <code class="ruby hljs">new_person = -&gt;(name,birthdate,gender,title,id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -&gt;(attribute) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> birthdate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gender <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:salutation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(title) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title + <span class="hljs-string"><span class="hljs-string">" "</span></span> + name <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br>  Damn, yes, we can add the most real <i>methods</i> in OOP-style, if you want: <br><br><pre> <code class="ruby hljs">new_person = -&gt;(name,birthdate,gender,title,id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -&gt;(attribute) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> birthdate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gender <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:salutation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(title) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title + <span class="hljs-string"><span class="hljs-string">" "</span></span> + name <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:update</span></span> update_person.(name,birthdate,gender,title,id) <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:destroy</span></span> delete_person.(id) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } some_person.(<span class="hljs-symbol"><span class="hljs-symbol">:update</span></span>) some_person.(<span class="hljs-symbol"><span class="hljs-symbol">:destroy</span></span>)</code> </pre><br>  While we are talking about OOP, let's add inheritance!  Suppose we have an employee who is a person, but still has his own employee number: <br><br><pre> <code class="ruby hljs">new_employee = -&gt;(name,birthdate,gender,title,employee_id_number,id) { person = new_person.(name,birthdate,gender,title,id) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -&gt;(attribute) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee_id_number <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:employee_id_number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> person.(attribute) } }</code> </pre><br>  We created classes, objects, and inheritance on functions alone in a few lines of code. <br><br>  In a sense, an object in an object-oriented language is a set of functions that have access to a common set of data.  It is easy to see why adding an object system to a functional language is considered trivial for those who understand functional languages.  This is much easier than adding functions to an object-oriented language! <br><br>  Although the syntax for accessing attributes is not very nice, the absence of classes does not cause me terrible suffering.  Classes look more like syntactic sugar than some serious concept. <br><br>  However, problems may arise with changing data.  See how verbose the <code>add_person</code> function <code>add_person</code> .  She calls <code>insert_person</code> to put a record in the database and gets the ID back.  Then we need to create a completely new record in order to just set the ID.  In a classic OOP, we would simply write <code>person.id = id</code> . <br><br>  Is the ability to change the state advantage of this design?  I would say that the compactness of this design is its main advantage, and the fact that it is the variability of the object that makes the structure compact is just an accident.  Only if we use a system with an extreme lack of memory and terrible garbage collection, can we be concerned about the creation of new objects.  We really will be annoyed by the useless creation of new and new objects from scratch.  But since we already know how to add functions to, uh, our function, let's try to implement this compact syntax: <br><br><pre> <code class="ruby hljs">new_person = -&gt;(name,birthdate,gender,title,id=<span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -&gt;(attribute,*args) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> birthdate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gender <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:salutation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(title) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title + <span class="hljs-string"><span class="hljs-string">" "</span></span> + name <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> attribute == <span class="hljs-symbol"><span class="hljs-symbol">:with_id</span></span> <span class="hljs-comment"><span class="hljs-comment"># &lt;=== return new_person.(name,birthdate,gender,title,args[0]) end nil } }</span></span></code> </pre><br>  Now <code>add_person</code> even simpler: <br><br><pre> <code class="ruby hljs">add_person = -&gt;(person) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Name is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Birthdate is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender must be 'male' or 'female'"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'male'</span></span> &amp;&amp; person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'female'</span></span> id = insert_person.(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>),person.(<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>)) [new_person.(<span class="hljs-symbol"><span class="hljs-symbol">:with_id</span></span>,id),<span class="hljs-literal"><span class="hljs-literal">nil</span></span>] <span class="hljs-comment"><span class="hljs-comment"># &lt;==== }</span></span></code> </pre><br><br>  It looks, of course, not as clean as <code>person.id = id</code> , but it looks decent enough to be readable.  The code from it became only better. <br><br><h4>  Namespaces are only functions. </h4><br>  What I really miss is namespaces.  If you have ever programmed in C, you probably know how the code becomes littered with functions with complex prefixes in order to avoid name clashes.  Of course, we could do something similar here, but it would be much more pleasant to have the correct namespaces, such as those provided by modules in Ruby or object literals in JavaScript.  I would like to do this without adding new language features.  The simplest way is to implement something like a display.  We can already access the explicit attributes of the data structure, so now it‚Äôs enough to come up with a more general way to do this. <br><br>  At the moment, the only data structure we have is an array.  We do not have array methods, because we do not have classes. <br><br>  Ruby arrays are actually tuples, and the most common operation we can do on them is data retrieval.  For example: <br><br><pre> <code class="ruby hljs">first = -&gt;((f,*rest)) { f } <span class="hljs-comment"><span class="hljs-comment"># or should I name this car? :) rest = -&gt;((f,*rest)) { rest }</span></span></code> </pre><br>  We can model a display as a list, treating it as a list with three elements: a key, a value, and the remainder of the display.  Let's avoid the "OOP-style" and leave only the pure "functional": <br><br><pre> <code class="ruby hljs">empty_map = [] add = -&gt;(map,key,value) { [key,value,map] } get = -&gt;(map,key) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> map == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> map[<span class="hljs-number"><span class="hljs-number">0</span></span>] == key <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get.(map[<span class="hljs-number"><span class="hljs-number">2</span></span>],key) }</code> </pre><br>  Example of use: <br><br><pre> <code class="ruby hljs">map = add.(empty_map,<span class="hljs-symbol"><span class="hljs-symbol">:foo</span></span>,<span class="hljs-symbol"><span class="hljs-symbol">:bar</span></span>) map = add.(map,<span class="hljs-symbol"><span class="hljs-symbol">:baz</span></span>,<span class="hljs-symbol"><span class="hljs-symbol">:quux</span></span>) get.(map,<span class="hljs-symbol"><span class="hljs-symbol">:foo</span></span>) <span class="hljs-comment"><span class="hljs-comment"># =&gt; :bar get.(map,:baz) # =&gt; :quux get.(map,:blah) # =&gt; nil</span></span></code> </pre><br>  This is enough to implement namespaces: <br><br><pre> <code class="ruby hljs">people = add.(empty_map ,<span class="hljs-symbol"><span class="hljs-symbol">:insert</span></span> ,insert_person) people = add.(people ,<span class="hljs-symbol"><span class="hljs-symbol">:update</span></span> ,update_person) people = add.(people ,<span class="hljs-symbol"><span class="hljs-symbol">:delete</span></span> ,delete_person) people = add.(people ,<span class="hljs-symbol"><span class="hljs-symbol">:fetch</span></span> ,fetch_person) people = add.(people ,<span class="hljs-symbol"><span class="hljs-symbol">:new</span></span> ,new_person) add_person = -&gt;(person) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Name is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Birthdate is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender must be 'male' or 'female'"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'male'</span></span> &amp;&amp; person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'female'</span></span> id = get(people,<span class="hljs-symbol"><span class="hljs-symbol">:insert</span></span>).(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>), person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>), person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>), person.(<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>)) [get(people,<span class="hljs-symbol"><span class="hljs-symbol">:new</span></span>).(<span class="hljs-symbol"><span class="hljs-symbol">:with_id</span></span>,id),<span class="hljs-literal"><span class="hljs-literal">nil</span></span>] }</code> </pre><br>  <code>new_person</code> course, we could replace the implementation of <code>new_person</code> map, but it‚Äôs more convenient to have an explicit list of attributes that we support, so leave <code>new_person</code> as is. <br><br>  Last focus.  <code>include</code> is a great Ruby feature that allows modules to be inserted into the current scope so as not to use explicit namespace resolution.  Can we do it here?  Close: <br><br><pre> <code class="ruby hljs">include_namespace = -&gt;(namespace,code) { code.(-&gt;(key) { get(namespace,key) }) } add_person = -&gt;(person) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Name is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Birthdate is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender is required"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> String(person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>)) == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"Gender must be 'male' or 'female'"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'male'</span></span> &amp;&amp; person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>) != <span class="hljs-string"><span class="hljs-string">'female'</span></span> include_namespace(people, -&gt;(<span class="hljs-number"><span class="hljs-number">_</span></span>) { id = <span class="hljs-number"><span class="hljs-number">_</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">:insert</span></span>).(person.(<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span>), person.(<span class="hljs-symbol"><span class="hljs-symbol">:birthdate</span></span>), person.(<span class="hljs-symbol"><span class="hljs-symbol">:gender</span></span>), person.(<span class="hljs-symbol"><span class="hljs-symbol">:title</span></span>)) [<span class="hljs-number"><span class="hljs-number">_</span></span>(<span class="hljs-symbol"><span class="hljs-symbol">:new</span></span>).(<span class="hljs-symbol"><span class="hljs-symbol">:with_id</span></span>,id),<span class="hljs-literal"><span class="hljs-literal">nil</span></span>] } }</code> </pre><br>  Well, this may be too much, but it is still interesting to use <code>include</code> only to print less, when we can achieve the same behavior simply by using functions. <br><br><h4>  What have we learned? </h4><br>  Using just a few basic language constructs, we were able to make a new programming language.  We can create real data types, namespaces, and we can even use OOP without explicit support for it with language constructs.  And we can do it in about the same amount of code as if we only used the built-in Ruby tools.  The syntax is a <i>bit</i> more verbose than in normal Ruby, but still not <i>so</i> bad.  We could even write real code using this ‚Äútruncated‚Äù version of Ruby.  And it would not look absolutely terrible. <br><br>  Will it help in everyday work?  I think this is a lesson in simplicity.  Ruby is overloaded with highly specialized constructs, complex syntax and metaprogramming, but we managed to accomplish a lot without even using classes!  Maybe your problem can be solved in a simpler way?  Maybe you should just rely on the most obvious parts of the language, rather than trying to use all the "coolest features"? </div><p>Source: <a href="https://habr.com/ru/post/148076/">https://habr.com/ru/post/148076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148068/index.html">How I inserted Java 7 into a running application, and what I had to invent for a C runtime</a></li>
<li><a href="../148070/index.html">Travel to Antarctica on Street View</a></li>
<li><a href="../148072/index.html">HTC HD2 received unofficial firmware Android 4.1 Jelly Bean</a></li>
<li><a href="../148074/index.html">Competition to the day of the sysadmin</a></li>
<li><a href="../148075/index.html">Google Chrome and LEGO</a></li>
<li><a href="../148077/index.html">Increase web application stack security (LAMP virtualization, step 2/6)</a></li>
<li><a href="../148078/index.html">Windows 8 will be released October 26</a></li>
<li><a href="../148083/index.html">Court: Apple must publicly admit that the Galaxy Tab does not copy the iPad</a></li>
<li><a href="../148084/index.html">July habraeracheta (DC)</a></li>
<li><a href="../148086/index.html">VK Offline - E-mail client and address book based on the data of your VK profiles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>