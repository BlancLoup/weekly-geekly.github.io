<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Did not put favicon on the site - get double traffic from Chrome</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the first time in five years of website development, I faced a very unexpected problem that cost me many hours of searching, nerves and hair on my...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Did not put favicon on the site - get double traffic from Chrome</h1><div class="post__text post__text-html js-mediator-article">  For the first time in five years of website development, I faced a very unexpected problem that cost me many hours of searching, nerves and hair on my head.  Suddenly, I discovered that on a new site, which I am currently developing on localhost, INSERT queries are being duplicated to the database.  I send one comment through the form, and two are inserted into the base.  If you do not know how this problem is connected with Chrome, favicon.ico and ModRewrite, then welcome under cat. <br><a name="habracut"></a><br><h3>  No, this is not a double vision </h3><br>  Of course, the first thing that came to mind was that somewhere in the script a database query was ‚Äúdoubled‚Äù.  For example, such a ‚Äúschool mistake‚Äù: <br><br><pre><code class="php hljs">$query = <span class="hljs-string"><span class="hljs-string">"INSERT INTO table VALUES(...)"</span></span>; $result = mysqli-&gt;query($query); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result = mysqli-&gt;query($query)) { ... }</code> </pre> <br>  I check one hundred thousand times - no.  The code is all right.  So the browser for some reason sends the data twice.  I generate a simple test script with an increment of the session variable and - yes!  Instead of increasing by one, the browser stubbornly shows an increase in the variable by two.  I try instead of Chrome Safari - there is no such problem.  Next comes the search for incorrectly working javascripts, browser extensions, but to no avail.  Search on the Internet gave similar advice.  Many programmers in a similar situation introduced a check for uniqueness and cut off duplicate posts.  But the bug does not eliminate this decision and I decided not to stop and find the reason for this behavior. <br><br>  Finally, the reason was found.  And since I found the solution with difficulty, on the English-speaking developer branch, I want to share it here.  Everything is simple - there are two culprits: Google Chrome (and browsers derived from it) and Apache's mod_rewrite. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  The essence of the problem </h3><br>  It's simple.  The peculiarity of browsers built on the Crome platform is that they search for the favicon.ico file for each site.  And if it is not, then they will still persistently look for him.  With each page refresh, a separate request to the server.  And the majority of .htaccess files in Apache have the lines: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span></span></span> <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !-f RewriteRule . /index.php</code> </pre> <br>  Guided by this rule, when receiving a request from the browser to a non-existent favicon.ico, Apache dutifully redirects it to the index.php file and the script runs twice.  Of course, in most cases, full-fledged web applications have a check for uniqueness and do not miss repeated requests.  And sites in most cases have a file favicon.ico.  But nevertheless time there is such a problem, it means you can describe the methods of solution. <br><br><h3>  Solution options </h3><br>  The first solution is the simplest: get on the website favicon.ico.  Chrome will find it and calm down. <br>  The second solution is to slightly modify the .htaccess file on the server.  My mod_rewrite rule block for all projects will now look like this: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_rewrite.c&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteBase / RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !-f # Next line is to solve the Chrome and favicon.ico file issue. # Without it browser sends two requests to script. RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !favicon.ico # RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !-d RewriteRule . /index.php<span class="hljs-meta"><span class="hljs-meta"> [L] &lt;/IfModule&gt;</span></span></code> </pre><br><h3>  Did not put a favicon?  Get double traffic from Chrome </h3><br>  If you think about it, then the statement is true, because instead of giving the ‚Äústatic‚Äù, the server will launch a web application, which at best will return to the browser instead of the icon a dynamically generated 404 page.  And in the worst case, the launch of the main page of the site will completely work.  It turns out that without installing an icon on the site (for example, on one popular blog engine), the developer doubles the load on the server from Google Chrome users. <br><br>  That's all.  I hope this information is useful to someone and will save time. </div><p>Source: <a href="https://habr.com/ru/post/309436/">https://habr.com/ru/post/309436/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309426/index.html">The role of content in website promotion and customer acquisition</a></li>
<li><a href="../309428/index.html">We write a simple web page parser</a></li>
<li><a href="../309430/index.html">30 lightweight javascript plugins and libraries</a></li>
<li><a href="../309432/index.html">Partner Workshop "1C" - Open Sunday</a></li>
<li><a href="../309434/index.html">Agile negotiations</a></li>
<li><a href="../309438/index.html">Panoramic overview: How to evaluate employee performance</a></li>
<li><a href="../309440/index.html">Not all programming languages ‚Äã‚Äãare equally useful.</a></li>
<li><a href="../309442/index.html">Umbrella monitoring: periscope for business</a></li>
<li><a href="../309444/index.html">Analytics for game designers and producers. Part I</a></li>
<li><a href="../309446/index.html">View requests to the apache web server in real time</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>