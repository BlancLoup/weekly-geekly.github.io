<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino in the coffee machine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A little abstracting from the simple brewing of tea, I will show an example of one of my projects on the Arduino. Before that, I had the experience of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino in the coffee machine</h1><div class="post__text post__text-html js-mediator-article">  A little abstracting from the simple brewing of tea, I will show an example of one of my projects on the Arduino.  Before that, I had the experience of Hello World on this platform, and of technical education, coupled with the ACS. <a name="habracut"></a><br><br><img src="https://habrastorage.org/storage2/5b6/949/221/5b6949221543c49851f0d680e50e3c21.jpg"><br><br>  So.  In a certain spherical vacuum there is a coffee machine.  Old enough model, but very reliable.  Prepares instant coffee drinks (nut, vanilla), different variations of coffee + cream + chocolate + sugar, instant tea.  The automatic machine in view of its age has quite a few functions for the owner, leaving all his strength only for buyers.  Machine can: <br>  - to take money; <br>  - prepare the selected drink; <br>  - issue change; <br>  - take care of yourself (boil water, maintain its level). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, like any machine, he knows how to take money and not to give anything in return.  It depends on the mood, the position of the moon in the starry sky, and of the power surges. <br><br>  As the owner of the machine, I was not satisfied with its other functions, or rather their absence.  After the first month of ownership, the following desires appeared: <br>  - Remote notification of the stop of the machine; <br>  - sales statistics for each drink; <br>  - the functions of free sales "for their"; <br>  - function of automatic washing; <br>  - chips. <br><br>  I'll start in order. <br><br><h4>  The technical part of this solution </h4><br>  Arduino Nano (freeduino nano) + MAX232-adapter + Serial GSM modem + optocouplers + small things <br>  The modem can be controlled by the usual AT commands via the com port.  In Arduino, there is only one com-port that is used for programming (tied to a USB adapter).  What would be the process of the firmware was convenient and without unnecessary movements - will not touch this port.  The solution is quite simple - Software Serial is the ability to create a port on any two Arduin digital legs.  Together with the adapter on the MAX232 chip, we get a full-fledged port to which external devices can be connected. <br>  The whole scheme is assembled on a breadboard with a regular soldering on the reverse side.  The technology of the laser iron has not yet been applied, since this is the first project and in the course of change the purpose of the legs and outlets. <br><br><img src="https://habrastorage.org/storage2/e5e/2bf/30d/e5e2bf30d6b10776cf0b6b908fb0f304.jpg"><br><br><h4>  1. Remote notification of the machine stop </h4><br>  The machine itself is able to keep track of some abnormal situations (overflow of the drain tank, lack of clean water, banknote jam, coin sticking in the coin acceptor).  One of the listed reasons is enough for the machine to completely stop selling and go to the astral (until the owner of the machine has solved these problems). <br><br>  If you approach the machine every day (for free coffee :), and check all possible causes of a future stop, then this is enough.  But we aim Arduino on this place! <br><br>  The first part - Arduino should read the status of the status LEDs of the machine.  According to their values, send SMS to the specified number with a description of the problem.  In addition, send an SMS about the reboot of the machine (in the event of a power failure) - so as to be aware. <br><br>  To do this, connect through the optocoupler.  It is necessary for the galvanic isolation of the circuit of the automaton and the sensitive brains of our arduin.  We will not go into physics, I will say that this is the simplest and most reliable solution for connecting to an unfamiliar circuit.  Given the fact that we do not even have the concept of an automaton.  All the necessary outputs of the machine are punched with a multimer and the necessary diode wires are located. <br><br><h4>  2. sales statistics for each drink </h4><br>  In the machine there are 11 buttons for each drink option.  I want to know which drink is popular.  Well, how much we earned per day :) Actually, the latter is very interesting for the machine owner :) We will not take tax into account, therefore we keep records in simple Excel + formulas. <br><br>  Each button has an LED indicator.  When preparing a drink, this indicator is lit during cooking.  On all 11 indicators we hang up the optocouplers and get them at the inputs to the Arduino.  In addition, there is a readiness indicator of the drink (while it is burning - the drink is prepared and it is not recommended to take out a glass :).  Both analog inputs and digital inputs were used (it is enough to track the appearance of power supply to them).  Of course, you can complicate the scheme (shift registers), but this is our first project. <br><br>  How to remove statistics: at any time, call the machine with a previously hammered into the firmware number.  When you receive a call, the machine resets the call and in response sends an SMS with the number of sales of each button.  The length of the messages makes it possible to write only in the form: 1 = 10.2 = 3.3 = 1 ..., and even for inserting into the history of sales it is more convenient than the names of drinks. <br><br><h4>  3. free sales "for their" </h4><br>  The machine is in a friendly room and the rent is not paid, but in return free drinks are provided.  Unfortunately, Arduin‚Äôs free legs ended before this idea, and it was not possible to bring it to the end.  Therefore, the issuance is made by opening the machine with a key and pressing the cherished button for free sale (the standard function of the machine is that all beverage selection buttons are activated for one attempt).  But there is a great idea to make the issuance of drinks on season tickets and one-time coupons - through a barcode scanner (the usual model on the com-port).  Although Habr√© had a great article - use the brains of an <a href="http://habrahabr.ru/blogs/DIY/128972/">ordinary optical mouse</a> as a reader.  I will try to implement one of these options in the second version of the Automaton. <br><br>  Another idea - a small variation of statistics removal - when you receive a call from a certain number - to include a free sale.  But not in this version ... <br><br><h4>  4. automatic flushing </h4><br>  As with any dishes - automatic requires attention and periodic cleaning (dried coffee with sugar - even that glue).  Unfortunately, it‚Äôs not always possible to appear every day (and withdraw money :), it was necessary to set up an automatic flushing function.  There is such a function in the machine, but it is launched by pressing a special button on the remote.  Therefore, we connected to the console and, through the relay, press the button when necessary.  I have an automatic flush every night after collecting statistics.  Previously, the flushing was after an hour of inactivity after the last sale, but the water quickly ended and had to abandon this frequency. <br><br><h4>  5. chips </h4><br>  I wanted to add interactivity to the machine.  For example, a signal about the readiness of the drink.  The piezo element from the starting set of Arduinschik is great for this idea - said, done!  I plan to add another highlight of the beverage dispensing window after readiness. <br><br><h4>  The first version is ready! </h4><br>  Since the project is purely amateur and for myself, I don‚Äôt see the point of sharing the source code.  Many suggested putting the production on stream, but this is just a hobby - and I do not intend to break away from the main work. <br><br>  Already, I am preparing for the second version of the machine - or rather, for the complete replacement of standard brains with an Arduino + computer - both for larger functions and for convenience (online statistics, cash monitoring, webcam, SMS payment).  A similar implementation has already been carried out on a nearby snack machine (chips-bar-cola), in just a couple of days I will publish a description of this project. <br><br>  Passing question to readers - would you like to see an interactive machine that, after the drink was ready, would ask you - ‚Äúhow do you like coffee?‚Äù And, if you wish, you could upload a photo to a fan club on facebook / facebook / twitter?  The implementation is simple - voice playback of a sound file through a computer, the ‚ÄúPHOTO‚Äù button on the machine panel and a webcam. <br><br><h5>  and for dessert - umm coffee </h5><br><br><img src="https://habrastorage.org/storage2/0f3/256/ec1/0f3256ec1ab5dae506e71701db0eff2a.jpg"></div><p>Source: <a href="https://habr.com/ru/post/132619/">https://habr.com/ru/post/132619/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132609/index.html">Background script execution in PHP without crontab</a></li>
<li><a href="../132611/index.html">Javascript to pdf</a></li>
<li><a href="../132614/index.html">Shared directory on a Linux machine, v2</a></li>
<li><a href="../132615/index.html">Copyright and 3D printing</a></li>
<li><a href="../132617/index.html">Naive young man in the face of the IT paradox</a></li>
<li><a href="../132620/index.html">Electronic bear pillow helps to stop snoring</a></li>
<li><a href="../132622/index.html">Siri communication protocol hacked</a></li>
<li><a href="../132623/index.html">Linux Mint 12 "Lisa" RC Released</a></li>
<li><a href="../132624/index.html">As we did "3D photos"</a></li>
<li><a href="../132625/index.html">Video Controller DEPO Race ReVision. Video wall of 24 ultra-high resolution panels</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>