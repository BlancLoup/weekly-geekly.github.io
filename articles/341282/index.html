<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Analytics API for a marketer on a practical example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! Based on the implementation of one of the tasks for analyzing traffic sources, I decided to write an article-instruction for marketers. This is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Analytics API for a marketer on a practical example</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/1b/cj/2a/1bcj2azbp34u6nhflaeklythhke.png"><br>  Hello!  Based on the implementation of one of the tasks for analyzing traffic sources, I decided to write an article-instruction for marketers.  This is the case when marketers cannot do without the Google Analytics API.  The article is written for the benefit of web developers, so that marketers are not distracted by "any garbage." <br><br>  We get acquainted with technology on a practical example.  Go! <br><br><h2>  Task </h2><br>  There are about 150,000 users who are registered on the site.  It is necessary to understand from which sources 1500 users who bought the product in October originally came. <br>  To attract leads, a freemium model is used, the sales cycle can be up to 1 year. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From the advanced settings, at the stage of integration of Google Analytics, we connected the <a href="https://support.google.com/analytics/answer/3123666%3Fhl%3Dru">UserID</a> and duplicated its value in <a href="https://support.google.com/analytics/answer/2709828%3Fhl%3Dru">Custom Dimension 1</a> (Scope: User) so that you can interact with the UserID in the reports. <a name="habracut"></a><br><br><h2>  Decision </h2><br><h3>  Algorithm </h3><br>  To determine the first source you need: <br><br><ol><li>  Open <a href="https://ga-dev-tools.appspot.com/query-explorer/">Query Explorer</a> service. </li><li>  Sign in, select Account, Property and View. </li><li>  To make a report: <br><ul><li>  <b>end-date</b> : user registration date + 5 days (with a reserve just in case) </li><li>  <b>start-date</b> : user registration date -25 days (with a margin, the user could make interactions with the site before registration) </li><li>  <b>metrics</b> : ga: sessions </li><li>  <b>dimensions</b> : <br><br>  ga: sourceMedium - source / channel <br>  ga: dateHourMinute - time, includes the date, hour, and minute. </li><li>  <b>sort</b> : ga: dateHourMinute - so that the very first session is displayed in the first line. </li><li>  <b>filters</b> : ga: dimension1 == 158384 - user ID. </li></ul></li><li>  It should be something like this: <br><br><img src="https://habrastorage.org/webt/rx/wy/wx/rxwywx3obnlhbowrhpskaswejva.png"><br></li><li>  Run the query by clicking on <b>Run Query</b> . </li></ol><br><h3>  Result </h3><br>  After the execution of the request, a table should appear with the results: <br><br><img src="https://habrastorage.org/webt/ah/6u/3d/ah6u3dz1tnnhfmoa4_0gfxgcgd8.png"><br><br>  Those.  we see that in a given period before registration, the first session was from the source of yandex / organic. <br><br>  For one user done.  But how to assemble for 1500, automation? <br><br><h3>  Automation <br></h3><br>  Under the table with the results of the query, there are 2 text fields: <br>  <b>Direct link to this Report</b> and <b>API Query URI</b> . <br><br>  We are interested in the second field with the tick ‚Äú <b>Include current access_token ...</b> ‚Äù. <br><br>  The content of the field is like this: <br><br><pre><code class="hljs perl">https:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.googleapis.com/analytics/v3/data/ga?ids=ga%3A118898472&amp;start-date=<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">10</span></span>-<span class="hljs-number"><span class="hljs-number">01</span></span>&amp;end-date=<span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">10</span></span>-<span class="hljs-number"><span class="hljs-number">26</span></span>&amp;metrics=ga%3Asessions&amp;dimensions=ga%3AsourceMedium%2Cga%3AdateHourMinute&amp;<span class="hljs-keyword"><span class="hljs-keyword">sort</span></span>=ga%3AdateHourMinute&amp;filters=ga%3Adimension1%3D%3D158384&amp;access_token=ya29.Gl30BMgGpR89kexsBJS8VMIWimIEghKVHubx9iQH7RljCyQNLjX2LLBQ9AyCCRW9K0TjfJEvwe6qY3SIRKbkm8idMZjdygbN647O7JUgXqcGyDt5b63Y2FjDbeQabfA</code> </pre> <br>  If we open the link in the browser, we will see the result of executing the request in JSON format: <br><br><img src="https://habrastorage.org/webt/jk/az/sq/jkazsqqlnsiubzjkvzq8nczschi.png"><br><br>  Those.  Substituting in the query url data dimension1, start-date, end-date - we can get this information for each of the users. <br><br><h4>  User data file </h4><br>  I made a regular txt file that contains lines of the form (UserID start-date end-date): <br><br><pre> <code class="hljs">123456 2017-10-01 2017-10-26 123457 2017-10-02 2017-10-27</code> </pre><br>  You can prepare start-date and end-date easily - via Excel or Google Spreadsheets: <br><br>  <b>start-date:</b> <br>  = date (year (B2), month (B2), day (B2) -25) <br><br>  <b>end-date:</b> <br>  = date (year (B2), month (B2), day (B2) +5) <br><br>  Where B2 is the cell with the date of user registration. <br><br><h4>  Making a script </h4><br>  I chose Python as my language, simply because I am currently studying it. <br><br>  Algorithm of the script: <br><br><ol><li>  Open the file with information about users. </li><li>  Each of the lines of the file is divided by ‚Äútabulation‚Äù. </li><li>  We substitute the separated data from the string into the Query String, which we obtained when working with the Query Explorer. </li><li>  We get information on this link. </li><li>  Convert the response text to JSON so that you can interact with it. </li><li>  We make backup answers for each of the users, which will be saved in users /% userID% .txt </li><li>  Let's try to cycle through the ‚Äúrows‚Äù section. <br><ul><li>  If it works, write to the UserID screen and Source / Medium. </li><li>  If it does not work out, we write just the UserID. </li></ul></li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'users_regs.txt'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f: value = line.split(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>) source = <span class="hljs-string"><span class="hljs-string">'https://www.googleapis.com/analytics/v3/data/ga?ids=ga%3A118898472&amp;start-date='</span></span> + value[<span class="hljs-number"><span class="hljs-number">1</span></span>] +<span class="hljs-string"><span class="hljs-string">'&amp;end-date='</span></span> + value[<span class="hljs-number"><span class="hljs-number">2</span></span>].strip(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) +<span class="hljs-string"><span class="hljs-string">'&amp;metrics=ga%3Asessions&amp;dimensions=ga%3AsourceMedium%2Cga%3AdateHourMinute&amp;sort=ga%3AdateHourMinute&amp;filters=ga%3Adimension1%3D%3D'</span></span> + value[<span class="hljs-number"><span class="hljs-number">0</span></span>] +<span class="hljs-string"><span class="hljs-string">'&amp;access_token=ya29.Gl3wBOWAecjWj4GgW0Gj920Sx2SBtVBkCHZjOsPNu6MWnN1XnsNwwzVzPVBcdVwDf_7lWJd0mege38pP1PSNvc9aBA7wbndUn-h6vqS5bbbEhSOKHp4cjQvVSQiN5R4'</span></span> r = requests.get(source) l = json.loads(r.text) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'users/'</span></span> + value[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-string"><span class="hljs-string">'.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> outfile: json.dump(l, outfile) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l[<span class="hljs-string"><span class="hljs-string">"rows"</span></span>]: print(value[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">" "</span></span> + row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(value[<span class="hljs-number"><span class="hljs-number">0</span></span>])</code> metrics = ga% 3Asessions &amp; dimensions = ga% 3AsourceMedium% 2Cga% 3AdateHourMinute &amp; sort = ga% 3AdateHourMinute &amp; filters = ga% 3Adimension1% 3D% 3D' + value [ <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'users_regs.txt'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f: value = line.split(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>) source = <span class="hljs-string"><span class="hljs-string">'https://www.googleapis.com/analytics/v3/data/ga?ids=ga%3A118898472&amp;start-date='</span></span> + value[<span class="hljs-number"><span class="hljs-number">1</span></span>] +<span class="hljs-string"><span class="hljs-string">'&amp;end-date='</span></span> + value[<span class="hljs-number"><span class="hljs-number">2</span></span>].strip(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) +<span class="hljs-string"><span class="hljs-string">'&amp;metrics=ga%3Asessions&amp;dimensions=ga%3AsourceMedium%2Cga%3AdateHourMinute&amp;sort=ga%3AdateHourMinute&amp;filters=ga%3Adimension1%3D%3D'</span></span> + value[<span class="hljs-number"><span class="hljs-number">0</span></span>] +<span class="hljs-string"><span class="hljs-string">'&amp;access_token=ya29.Gl3wBOWAecjWj4GgW0Gj920Sx2SBtVBkCHZjOsPNu6MWnN1XnsNwwzVzPVBcdVwDf_7lWJd0mege38pP1PSNvc9aBA7wbndUn-h6vqS5bbbEhSOKHp4cjQvVSQiN5R4'</span></span> r = requests.get(source) l = json.loads(r.text) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'users/'</span></span> + value[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-string"><span class="hljs-string">'.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> outfile: json.dump(l, outfile) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l[<span class="hljs-string"><span class="hljs-string">"rows"</span></span>]: print(value[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">" "</span></span> + row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(value[<span class="hljs-number"><span class="hljs-number">0</span></span>])</code> h6vqS5bbbEhSOKHp4cjQvVSQiN5R4' <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'users_regs.txt'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> f: value = line.split(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>) source = <span class="hljs-string"><span class="hljs-string">'https://www.googleapis.com/analytics/v3/data/ga?ids=ga%3A118898472&amp;start-date='</span></span> + value[<span class="hljs-number"><span class="hljs-number">1</span></span>] +<span class="hljs-string"><span class="hljs-string">'&amp;end-date='</span></span> + value[<span class="hljs-number"><span class="hljs-number">2</span></span>].strip(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) +<span class="hljs-string"><span class="hljs-string">'&amp;metrics=ga%3Asessions&amp;dimensions=ga%3AsourceMedium%2Cga%3AdateHourMinute&amp;sort=ga%3AdateHourMinute&amp;filters=ga%3Adimension1%3D%3D'</span></span> + value[<span class="hljs-number"><span class="hljs-number">0</span></span>] +<span class="hljs-string"><span class="hljs-string">'&amp;access_token=ya29.Gl3wBOWAecjWj4GgW0Gj920Sx2SBtVBkCHZjOsPNu6MWnN1XnsNwwzVzPVBcdVwDf_7lWJd0mege38pP1PSNvc9aBA7wbndUn-h6vqS5bbbEhSOKHp4cjQvVSQiN5R4'</span></span> r = requests.get(source) l = json.loads(r.text) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'users/'</span></span> + value[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-string"><span class="hljs-string">'.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> outfile: json.dump(l, outfile) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> l[<span class="hljs-string"><span class="hljs-string">"rows"</span></span>]: print(value[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">" "</span></span> + row[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(value[<span class="hljs-number"><span class="hljs-number">0</span></span>])</code> </pre><br>  The script file called ga.py. <br><br>  Run the script via the command line, enjoy the result: <br><br><img src="https://habrastorage.org/webt/uh/o7/eq/uho7eqgi_qk8gh92rlv7-hdgxm0.png"><br><br>  The results of the script execution will be displayed in the terminal, you can simply copy them for further processing. <br><br>  The script is presented for example, you can independently save the results into a single file or database. <br><br>  If you will work with a large amount of data - once per hour you will have to generate a new token (open the Query Explorer again and click Run Query) and substitute it in the Query String in your script. <br><br>  Successes! <br><br><h2>  Reader Bonuses </h2><br><h3>  Online Courses </h3><br>  We give free access to three months of learning English through our online courses.  To do this, simply follow the <a href="https://www.englishdom.com/myprofile/purchases/xabra3/%3Futm_medium%3Dpr%26utm_source%3Dhabra%26utm_campaign%3Dgoogle_api301017">link</a> until December 31, 2017. <br><br><h3>  Individually by Skype </h3><br>  We will be glad to see you at the individual lessons of the course ‚ÄúEnglish for IT-specialists‚Äù. <br>  Take a <a href="https://www.englishdom.com/it-course/%3Futm_medium%3Dpr%26utm_source%3Dhabra%26utm_campaign%3Dgoogle_api301017">free introductory lesson</a> and get a comprehensive feedback on your level of knowledge, then choose a teacher and a training program for yourself to your liking! </div><p>Source: <a href="https://habr.com/ru/post/341282/">https://habr.com/ru/post/341282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341272/index.html">Created the first molecular computer based on synthetic polymers</a></li>
<li><a href="../341274/index.html">Graylog2 incremental setup</a></li>
<li><a href="../341276/index.html">Safety Issues of Smart Energy</a></li>
<li><a href="../341278/index.html">What is good (and bad) Typescript: experience of UI-developers</a></li>
<li><a href="../341280/index.html">Shutdown PC anywhere in the world (JAVA)</a></li>
<li><a href="../341288/index.html">‚ÄúSometimes you have to look into the Spark code‚Äù: Alexander Morozov (SEMrush) about using Scala, Spark and ClickHouse</a></li>
<li><a href="../341294/index.html">Monitoring system, are you sure that it works?</a></li>
<li><a href="../341296/index.html">An extraordinary charge: how we have automated the park</a></li>
<li><a href="../341298/index.html">Listen to traffic and increase the loyalty of bank customers: myth or reality</a></li>
<li><a href="../341300/index.html">Extreme Networks is making Network Fabrics a reality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>