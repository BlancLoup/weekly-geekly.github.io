<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building Android applications step by step, part three</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first and second parts of the article, we created an application for working with Github, implemented Dagger 2 and covered the unit code with t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building Android applications step by step, part three</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ddd/981/4fe/ddd9814fe65645ffaa655874a6fd9dc0.jpg"><br><br>  In the <a href="https://habrahabr.ru/company/rambler-co/blog/275943/">first</a> and <a href="https://habrahabr.ru/company/rambler-co/blog/277343/">second parts of the</a> article, we created an application for working with Github, implemented Dagger 2 and covered the unit code with tests.  In the final part, we will write integration and functional tests, consider the TDD technique and write with its application a new functionality, as well as tell you what to read next. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Full content</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/275943/">Introduction</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/275943/">Step 1. Simple architecture</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/275943/">Step 2. Complicated architecture</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/277343/">Step 3. Dependency Injection</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/277343/">Step 4. Unit Testing</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/279799/">Step 5. Integration Testing</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/279799/">Step 6. Functional testing</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/279799/">Step 7. TDD</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/279799/">Step 8. What's next?</a> </li><li>  <a href="https://habrahabr.ru/company/rambler-co/blog/279799/">Conclusion</a> </li></ul><br></div></div><br><h4>  Introduction </h4><br>  In the first part of the article, we in two stages created a simple application for working with github.  The architecture of the application was divided into two parts: simple and complex.  In the second part, we implemented Dagger 2 and covered the unit code with tests using Robolectric, Mockito, MockWebServer and JaCoCo. <br><br><div class="spoiler">  <b class="spoiler_title">Conditional application scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/e08/de8/101/e08de8101f3b486b9c7f556126dea55e.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Class diagram</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/4e0/9f7/802/4e09f78028274958819a59445c3065fd.png"></a> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Test coverage</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/1c5/86b/69a/1c586b69aa204d818e39e5ba22920b33.PNG"></a> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Component Interaction Scheme</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/files/da6/d2c/ca8/da6d2cca88424fc2a7aa930a3de2cc8b.png"></a> <br></div></div><br>  All sources can be found on <a href="https://github.com/andrey7mel/android-step-by-step">Github.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="31"></a><h4>  Step 5. Integration Testing </h4><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Integration testing (Integration testing)</a> - one of the phases of software testing, in which individual software modules are combined and tested in a group. <br>  There are 3 approaches to integration testing: <br><br>  <b>Bottom Up Integration</b> <br>  All low-level modules, procedures, or functions are aggregated and then tested.  After that, the next level of modules is collected for integration testing.  This approach is considered useful if all or practically all modules of the developed level are ready.  Also, this approach helps to determine the level of readiness of the application by the results of testing. <br><br>  <b>Top Down Integration</b> <br>  First, all high-level modules are tested, and low-level ones are gradually added one by one.  All modules of the lower level are simulated with plugs with similar functionality, then as they become ready, they are replaced with real active components.  So we are testing from top to bottom. <br><br>  <b>Big Bang ("Big Bang" Integration)</b> <br>  All or almost all developed modules come together as a complete system or its main part, and then integration testing is carried out.  This approach is very good for saving time. <br><br>  Since we have all the modules ready, we will use the <b>bottom-up</b> approach. <br><br><h5>  Iterative approach </h5><br>  We will use an iterative approach, that is, we will connect the modules one by one, bottom to top.  First we check the bundle api + model, then api + model + mapper + presenter, then the general bundle api + model mapper + presenter + view <br><br><h5>  Negative and positive scenario </h5><br>  For integration tests, we need to consider 2 response scripts from the server: a normal response and an error.  Depending on this, the behavior of the components changes.  Before each test, we can configure the response from the server (MockWebServer) and check the results. <br><br>  Scheme of the integration test (api + model): <br><br><img src="https://habrastorage.org/files/ba1/a99/92b/ba1a9992b45b4b4381233fa613cc7650.png"><br><br>  An example of an integration test (api + model), we check the interaction of the Retrfofit module and ModelImpl: <br><br><div class="spoiler">  <b class="spoiler_title">Integration test sample</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetRepoList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TestSubscriber&lt;List&lt;RepositoryDTO&gt;&gt; testSubscriber = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestSubscriber&lt;&gt;(); model.getRepoList(TestConst.TEST_OWNER).subscribe(testSubscriber); testSubscriber.assertNoErrors(); testSubscriber.assertValueCount(<span class="hljs-number"><span class="hljs-number">1</span></span>); List&lt;RepositoryDTO&gt; actual = testSubscriber.getOnNextEvents().get(<span class="hljs-number"><span class="hljs-number">0</span></span>); assertEquals(<span class="hljs-number"><span class="hljs-number">7</span></span>, actual.size()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Android-Rate"</span></span>, actual.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getName()); assertEquals(<span class="hljs-string"><span class="hljs-string">"andrey7mel/Android-Rate"</span></span>, actual.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getFullName()); assertEquals(<span class="hljs-number"><span class="hljs-number">26314692</span></span>, actual.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getId()); }</code> </pre> <br></div></div><br>  Scheme of the integration test (api + model + mapper + presenter): <br><br><img src="https://habrastorage.org/files/2b6/3f8/ffb/2b63f8ffb2734ed4bbf231088fcb71ee.png"><br><br><div class="spoiler">  <b class="spoiler_title">An example of an integration test (api + model + mapper + presenter)</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLoadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); repoInfoPresenter.onStop(); verify(mockView).showBranches(branchList); verify(mockView).showContributors(contributorList); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLoadDataWithError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setErrorAnswerWebServer(); repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); repoInfoPresenter.onStop(); verify(mockView, times(<span class="hljs-number"><span class="hljs-number">2</span></span>)).showError(TestConst.ERROR_RESPONSE_500); }</code> </pre> <br></div></div><br>  As a result, we get a complete check of the interaction of all modules with each other, from the bottom up.  If somewhere modules will interact incorrectly, we will quickly see it through tests. <br><br><a name="32"></a><h4>  Step 6. Functional testing </h4><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Functional testing</a> is the testing of software in order to verify the feasibility of functional requirements, that is, the ability of the software in certain conditions to solve the tasks needed by users.  Functional requirements determine what exactly the software does, what tasks it solves. <br><br>  As part of our Android application, we will check the operation of the application from the user's point of view.  First, let's create a custom application map: <br><br><div class="spoiler">  <b class="spoiler_title">Application Map</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1fb/311/940/1fb31194056440bf86bfebb90685d567.png"><br></div></div><br>  We make the necessary test cases: <br><ul><li>  Open the application, check the visibility of all elements. </li><li>  Enter test user, click Search <br><ul><li>  Data received - get a list of repositories, check data mapping </li><li>  Data not received - check error display. </li></ul></li><li>  Go to the second screen, check the correctness of the display of the user name and the name of the repository. <br><ul><li>  Get lists of brunches and distributors, check data mapping </li><li>  Which of the lists is not received (two tests), check the display of the received list, the error display </li><li>  Both lists are not received, check the error display </li></ul></li></ul><br>  For testing, we will use Espresso.  As well as for other tests, we isolate the application from the Internet using mocks and json files prepared in advance.  Dagger 2 and component substitution will help us in this: <br><br><div class="spoiler">  <b class="spoiler_title">MockTestRunner and TestApp Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockTestRunner</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AndroidJUnitRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Application </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newApplication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ClassLoader cl, String className, Context context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InstantiationException, IllegalAccessException, ClassNotFoundException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newApplication( cl, TestApp.class.getName(), context); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> TestComponent </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DaggerTestComponent.builder().build(); } }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Sample Espresso Tests</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetUserRepo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ apiConfig.setCorrectAnswer(); onView(withId(R.id.edit_text)).perform(clearText()); onView(withId(R.id.edit_text)).perform(typeText(TestConst.TEST_OWNER)); onView(withId(R.id.button_search)).perform(click()); onView(withId(R.id.recycler_view)).check(EspressoTools.hasItemsCount(<span class="hljs-number"><span class="hljs-number">7</span></span>)); onView(withId(R.id.recycler_view)).check(EspressoTools.hasViewWithTextAtPosition(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"Android-Rate"</span></span>)); onView(withId(R.id.recycler_view)).check(EspressoTools.hasViewWithTextAtPosition(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"android-simple-architecture"</span></span>)); onView(withId(R.id.recycler_view)).check(EspressoTools.hasViewWithTextAtPosition(<span class="hljs-number"><span class="hljs-number">2</span></span>, TestConst.TEST_REPO)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetUserRepoError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ apiConfig.setErrorAnswer(); onView(withId(R.id.edit_text)).perform(clearText()); onView(withId(R.id.edit_text)).perform(typeText(TestConst.TEST_OWNER)); onView(withId(R.id.button_search)).perform(click()); onView(allOf(withId(android.support.design.R.id.snackbar_text), withText(TestConst.TEST_ERROR))) .check(matches(isDisplayed())); onView(withId(R.id.recycler_view)).check(EspressoTools.hasItemsCount(<span class="hljs-number"><span class="hljs-number">0</span></span>)); }</code> </pre> </div></div><br>  Similarly, we write the rest of the tests for test cases. <br>  Having finished working with Espresso, we will completely cover the application with modular, integration and functional tests. <br><br><a name="33"></a><h4>  Step 7. TDD </h4><br><br><img src="https://habrastorage.org/files/66e/106/862/66e1068626044e29ae6075d9c113b3f5.png"><br><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Development through testing</a> (Test-driven development) is a software development technique that defines development through writing tests. <br><br>  In essence, you need to perform three simple repeating steps: <br>  - Write a test for the new functionality that needs to be added; <br>  - Write the code that will pass the test; <br>  - To refactor new and old code. <br><br>  If the TDD abbreviation is not familiar to you, we recommend reading the <a href="https://habrahabr.ru/company/rambler-co/blog/263087/">article from our colleagues from the iOS department</a> or the <a href="https://habrahabr.ru/hub/tdd/">article from the TDD hub</a> . <br><br>  There are 3 laws TDD: <br><br><ul><li>  Production code is not written before there is an idle test for it; </li><li>  No more unit test code is written than enough for its error. </li><li>  No more production code is written than enough to pass the current non-working test. </li></ul><br>  For example, create a progress bar that will show downloads from the Internet.  It should appear when data loading occurs and disappear when data is loaded or an error has occurred.  All development will be conducted on TDD. <br><br>  The development of this functionality will affect presenters and fragments, mappers and the date layer remain unchanged. <br><br><h5>  Presenters </h5><br>  Let's start with a list of repositories.  First of all, let's add interfaces: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RepoListView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showRepoList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Repository&gt; list)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showEmptyList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startRepoInfoFragment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Repository repository)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//New void showLoading(); void hideLoading(); }</span></span></code> </pre><br><h6>  First stage. </h6><br>  First, we write a test that verifies that in the case of normal loading, the showLoading method was called on the fragment: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ repoListPresenter.onSearchButtonClick(); verify(mockView).showLoading(); }</code> </pre><br>  As soon as we receive a non-working test, we write the code that will pass it: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSearchButtonClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String name = view.getUserName(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TextUtils.isEmpty(name)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; view.showLoading(); <span class="hljs-comment"><span class="hljs-comment">// --- some code --- }</span></span></code> </pre><br>  There is nothing to refactor. <br><br>  This is where the first iteration of TDD development is over.  We got a new functionality and test for it. <br><br><h6>  Second phase. </h6><br>  Let's write a test that verifies that after the normal loading, the fragment's hideLoading method was called: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ repoListPresenter.onSearchButtonClick(); verify(mockView).hideLoading(); }</code> </pre><br><br>  We write the code that will pass the test: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//-- view.showLoading(); Subscription subscription = model.getRepoList(name) .map(repoListMapper) .subscribe(new Observer&lt;List&lt;Repository&gt;&gt;() { @Override public void onCompleted() { view.hideLoading(); } @Override public void onError(Throwable e) { view.showError(e.getMessage()); } @Override public void onNext(List&lt;Repository&gt; list) { if (list != null &amp;&amp; !list.isEmpty()) { repoList = list; view.showRepoList(list); } else { view.showEmptyList(); } } });</span></span></code> </pre><br>  Refactoring is not required. <br><br><h6>  The third and fourth stages. </h6><br>  Now we will write tests that verify that when an error occurred, the necessary methods were correctly called. <br><br><div class="spoiler">  <b class="spoiler_title">Error handling tests</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowLoadingOnError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoList(TestConst.TEST_OWNER); repoListPresenter.onSearchButtonClick(); verify(mockView).showLoading(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideLoadingOnError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoList(TestConst.TEST_OWNER); repoListPresenter.onSearchButtonClick(); verify(mockView).hideLoading(); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Error handling code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//-- @Override public void onError(Throwable e) { view.showError(e.getMessage()); view.hideLoading(); } //--</span></span></code> </pre> <br></div></div><br>  Refactoring is not required.  Work with Repo List Presenter is completed, now we will go to Repo Info Presenter. <br><br><h5>  Repo Info Presenter </h5><br>  Similar to the previous step, we write tests and code for correct data loading. <br><br><div class="spoiler">  <b class="spoiler_title">Tests for correct data loading</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); verify(mockView).showLoading(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); verify(mockView).hideLoading(); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Code for correct data loading</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String owner = repository.getOwnerName(); String name = repository.getRepoName(); view.showLoading(); Subscription subscriptionBranches = model.getRepoBranches(owner, name) .map(branchesMapper) .subscribe(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observer&lt;List&lt;Branch&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hideInfoLoadingState(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ view.showError(e.getMessage()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Branch&gt; list)</span></span></span><span class="hljs-function"> </span></span>{ branchList = list; view.showBranches(list); } }); addSubscription(subscriptionBranches); Subscription subscriptionContributors = model.getRepoContributors(owner, name) .map(contributorsMapper) .subscribe(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observer&lt;List&lt;Contributor&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hideInfoLoadingState(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ view.showError(e.getMessage()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Contributor&gt; list)</span></span></span><span class="hljs-function"> </span></span>{ contributorList = list; view.showContributors(list); } }); addSubscription(subscriptionContributors); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideInfoLoadingState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ countCompletedSubscription++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countCompletedSubscription == COUNT_SUBSCRIPTION) { view.hideLoading(); countCompletedSubscription = <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br></div></div><br>  Refactoring. <br>  As you can see, the same code is used for two presenters (show and hide the download indicator, show an error).  You need to bring it to the common base class BasePresenter.  We take out the showLoadingState () hideLoadingState () and showError (Throwable e) methods in BasePresenter <br><br><div class="spoiler">  <b class="spoiler_title">BasePresenter Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showLoadingState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ getView().showLoadingState(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideLoadingState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ getView().hideLoadingState(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ getView().showError(e.getMessage()); }</code> </pre><br></div></div><br>  Refactor RepoInfoPresenter and verify that all tests pass.  Do not forget to refactor RepoListPresenter to work with the base class. <br><br>  Next, we write the tests first, and then the code for handling errors at boot time (for RepoInfoPresenter). <br><br><div class="spoiler">  <b class="spoiler_title">Error Handling Tests</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowLoadingOnError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoContributors(TestConst.TEST_OWNER, TestConst.TEST_REPO); doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoBranches(TestConst.TEST_OWNER, TestConst.TEST_REPO); repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); verify(mockView).showLoading(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideLoadingOnError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoContributors(TestConst.TEST_OWNER, TestConst.TEST_REPO); doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoBranches(TestConst.TEST_OWNER, TestConst.TEST_REPO); repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); verify(mockView).hideLoading(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowLoadingOnErrorBranches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoBranches(TestConst.TEST_OWNER, TestConst.TEST_REPO); repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); verify(mockView).showLoading(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideLoadingOnErrorBranches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ doAnswer(invocation -&gt; Observable.error(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Throwable(TestConst.TEST_ERROR))) .when(model) .getRepoBranches(TestConst.TEST_OWNER, TestConst.TEST_REPO); repoInfoPresenter.onCreateView(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); verify(mockView).hideLoading(); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Error handling code at boot time</b> <div class="spoiler_text"><pre> <code class="java hljs">showLoadingState(); Subscription subscriptionBranches = model.getRepoBranches(owner, name) .map(branchesMapper) .subscribe(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observer&lt;List&lt;Branch&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hideInfoLoadingState(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ hideInfoLoadingState(); showError(e); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Branch&gt; list)</span></span></span><span class="hljs-function"> </span></span>{ branchList = list; view.showBranches(list); } }); addSubscription(subscriptionBranches); Subscription subscriptionContributors = model.getRepoContributors(owner, name) .map(contributorsMapper) .subscribe(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observer&lt;List&lt;Contributor&gt;&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hideInfoLoadingState(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Throwable e)</span></span></span><span class="hljs-function"> </span></span>{ hideInfoLoadingState(); showError(e); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Contributor&gt; list)</span></span></span><span class="hljs-function"> </span></span>{ contributorList = list; view.showContributors(list); } });</code> </pre> <br></div></div><br><br>  At the development of presenters completed.  Go to the fragments. <br><br><h5>  Fragments </h5><br>  The progress bar, as a common element, will lie in the activity, the fragments will call the showProgressBar () and hideProgressBar () methods on the activity, which will show or hide the progress bar.  To work with activity, use the ActivityCallback interface.  From the experience of presenters, we can immediately guess that we will need a common base class - BaseFragment.  It will contain the logic of interaction with the activity. <br><br>  First, we write tests, and then the code, for the interaction of the basic fragment with the activity: <br><br><div class="spoiler">  <b class="spoiler_title">Base Fragment Tests</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testAttachActivityCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ assertNotNull(baseFragment.activityCallback); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowLoadingState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ baseFragment.showLoading(); verify(activity).showProgressBar(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideLoadingState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ baseFragment.hideLoading(); verify(activity).hideProgressBar(); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Base Fragment Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAttach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Activity activity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAttach(activity); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { activityCallback = (ActivityCallback) activity; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ClassCastException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassCastException(activity.toString() + <span class="hljs-string"><span class="hljs-string">" must implement activityCallback"</span></span>); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ activityCallback.showProgressBar(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideLoading</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ activityCallback.hideProgressBar(); }</code> </pre> <br></div></div><br>  Refactoring is not required, go to activity. <br><br><h5>  Acitivity </h5><br>  The final step is to implement the Activity interface.  We will change the visibility (setVisibility) of the progressBar depending on the command.  In tests, you need to check that progressBar is found and the work of the showProgressBar and hideProgressBar methods. <br><br>  First we write the tests: <br><br><div class="spoiler">  <b class="spoiler_title">Activity Tests</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHaveProgressBar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ assertNotNull(progressBar); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testShowProgressBar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mainActivity.showProgressBar(); verify(progressBar).setVisibility(View.VISIBLE); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHideProgressBar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ mainActivity.hideProgressBar(); verify(progressBar).setVisibility(View.INVISIBLE); }</code> </pre> <br></div></div><br>  Then we write the code: <br><br><div class="spoiler">  <b class="spoiler_title">Activity code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bind</span></span>(R.id.toolbar_progress_bar) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> ProgressBar progressBar; <span class="hljs-comment"><span class="hljs-comment">//---- some code ---- @Override public void showProgressBar() { progressBar.setVisibility(View.VISIBLE); } @Override public void hideProgressBar() { progressBar.setVisibility(View.INVISIBLE); }</span></span></code> </pre> <br></div></div><br><br>  Everything is rather trivial, refactoring is not required. <br><br>  This concludes the development of the progress bar using TDD technology. <br><br><a name="34"></a><h4>  Step 8. What's next? </h4><br>  After examining TDD and developing a load map, we‚Äôll finish the development of the application.  For further development I recommend reading the following articles: <br><br>  <b>Android Clean Architecture</b> <br>  <a href="http://fernandocejas.com/2014/09/03/architecting-android-the-clean-way/">Android Clean Architecture</a> is a famous article from Fernando Cejas, based on <a href="http://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html">Uncle Bob's Clean Architecture</a> .  It discusses the interaction between 3 layers Presentation Layer, Domain Layer and Data Layer.  There is a <a href="https://habrahabr.ru/post/250659/">transfer to habrahabr.</a> <br><br>  <b>VIPER</b> <br>  VIPER (View, Interactor, Presenter, Entity and Routing) is becoming more and more popular, you can get acquainted with it in the article <a href="https://habrahabr.ru/company/rambler-co/blog/277003/">Android VIPER on jet propulsion</a> from <a href="https://habrahabr.ru/users/vikkos/" class="user_link">VikkoS</a> .  The basic principles of VIPER are covered <a href="https://habrahabr.ru/company/rambler-co/blog/273949/">in articles and reports of our colleagues from the iOS department.</a> <br><br>  <b>Mosby</b> <br>  Mosby is a popular library for creating MVP applications.  It contains all the main interfaces and base classes.  Website: <a href="http://hannesdorfmann.com/mosby/">http://hannesdorfmann.com/mosby/</a> Github: <a href="https://github.com/sockeqwe/mosby">https://github.com/sockeqwe/mosby</a> <br><br>  <b>Android Application Architecture</b> <br>  A good article about the architecture of the <a href="https://labs.ribot.co.uk/android-application-architecture-8b6e34acda65">Ribot team - Android Application Architecture</a> .  We consider the migration from AsyncTask to RxJava.  Most recently there was a <a href="https://habrahabr.ru/post/278815/">transfer to habrahabr.</a> <br><br>  <b>Android Development Culture Document</b> <br>  <a href="http://artemzin.com/blog/android-development-culture-the-document-qualitymatters/">Android Development Culture Document #qualitymatters by</a> <a href="https://habrahabr.ru/users/artem_zin/" class="user_link">Artem_zin</a> .  Excellent article and demo project from Artem Zinnatullin.  The article discusses 8 principles for the development of android applications, all supported by an <a href="https://github.com/artem-zinnatullin/qualitymatters">example on Github.</a> <br><br><a name="35"></a><h4>  Conclusion </h4><br>  In this series of articles we went through all the stages of application development.  We started with a simple MVP-based architecture, complicating it as we add new features.  We used modern libraries: RxJava and RxAndroid for reactive programming and getting rid of callbacks, Retrofit for convenient work with the network, Butterknife for quick and easy search of the view.  Dagger 2 managed all dependencies and provided us with invaluable support when writing tests.  We wrote the tests ourselves using jUnit, Robolectric, Mockito and MockWebServer.  And Espresso saved our testers from the pain of regression testing. <br><br>  We completely covered our project with tests.  Unit tests check each component in isolation, integration tests check their overall interaction, and functional tests look at all this from the user‚Äôs side.  With the further change of the program, we can not be afraid (well, or almost not to be afraid) that we will break some components, and that something will fall off, and the bugs will crawl into the release.  Thanks to TDD, most of our code will be covered with tests (there is no test, there is no code).  There will be no problem of partial coverage or ‚Äúthe code was written, but there was no time left for tests‚Äù. <br><br>  All project code is available on <a href="https://github.com/andrey7mel/android-step-by-step">Github (https://github.com/andrey7mel/android-step-by-step)</a> <br>  I hope you enjoyed this series of articles and it turned out to be useful, thank you for your attention! </div><p>Source: <a href="https://habr.com/ru/post/279799/">https://habr.com/ru/post/279799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279787/index.html">The main threats to site security</a></li>
<li><a href="../279789/index.html">Game development digest</a></li>
<li><a href="../279791/index.html">We go around the antivirus with ten lines of code</a></li>
<li><a href="../279793/index.html">April 8 - learn everything about the Microsoft Azure cloud in one cloudy day</a></li>
<li><a href="../279797/index.html">How to use parquet and not slip</a></li>
<li><a href="../279801/index.html">IBM transferred almost 44,000 lines of code to the open-source blockchain project to the Hyperledger Project</a></li>
<li><a href="../279803/index.html">We select valid mobile numbers of VK friends in Python</a></li>
<li><a href="../279805/index.html">Checking the source code of the game engine Serious Engine v.1.10 for the anniversary of the shooter Serious Sam</a></li>
<li><a href="../279807/index.html">Record of the webinar "Managing Server and Personal Security in Kerio Connect"</a></li>
<li><a href="../279809/index.html">Douglas Engelbart: "The Mother of All Demos". Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>