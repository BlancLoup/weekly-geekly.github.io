<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring the activity of VK groups. We process data on VKScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Faced the task of monitoring the activity of users of a well-known social network. My task was to collect data on the number of users who are online i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring the activity of VK groups. We process data on VKScript</h1><div class="post__text post__text-html js-mediator-article">  Faced the task of monitoring the activity of users of a well-known social network.  My task was to collect data on the number of users who are online in a particular group or community. <br><a name="habracut"></a><br><h5>  Instruments </h5><br>  Since I myself am engaged in web development, the tools I used were such <br><ul><li>  PHP 5 (Zend Framework) </li><li>  VK API </li><li>  Cron </li></ul><br>  I will explain my choice - Vk API - the fact is that you can get the number of users online without an API, and send a search page for users with community filter and tags online, but I chose not to bother with authorization and parsing tags, but to use the program interface. <br><br><h5>  Architecture </h5><br>  Implementation can be divided into 2 parts.  The first is a script that finds the number of users online on the group id and writes it to the database.  The second is the admin panel, which allows you to add new groups for monitoring and view statistics on already added groups. <br>  In order for the statistics to be relevant, it is necessary to monitor the state of the group at the current time as often as possible.  The script is worth hanging in Cron, let him call us every 5 minutes. <br><br><h5>  Vk API Overview </h5><br>  If everything is more or less clear with the admin area, then with the statistics collection script it‚Äôs not quite.  After reviewing the methods provided by the API, I come to the first solution. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  First decision (incorrect) </h6><br>  Using the <b>groups.getMembers</b> , <b>users.get</b> methods, <b>we</b> get a list of group members and their status - online or offline.  Next, count how many users are online.  It's simple.  However, the apparent simplicity in the result brings a number of problems. <br>  It would be nice if you have small groups (up to 1000 people).  Otherwise, we rest on the limitations of the API - only 1000 users can be obtained at a time.  That to us this restriction - it is possible to cause a method in a cycle, but no.  Making API calls is allowed no more than 3 requests per second. <br>  <i>Calculate the approximate number of requests that will be needed.</i>  <i>Take the community habrahabr Vk.</i>  <i>It has more than 40,000 users, so we need ~ 40 requests to get community members and 40 requests - their status.</i> <br>  We are going to look for a new solution. <br><br><h6>  The second decision (true) </h6><br>  We find out in documentation the <b>execute</b> method <br><blockquote>  A universal method that allows you to run a sequence of other methods, saving and filtering intermediate results. </blockquote><br>  It accepts as input a line with code written in so-called VKScript (similar to javascript).  The only problem is that the imputed documentation on this method and the language itself is missing.  Probably a solution has been found, so you can delve into the study of the Vk and VKScript APIs in particular. <br><br><h5>  Work with API </h5><br>  We download class for work with API, offered by developers.  I only brought it to a more acceptable view so that it fits into the coding style used in the Zend Framework. <br><div class="spoiler">  <b class="spoiler_title">Class api</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vkapi_Model_Api</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_accessToken = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_apiUrl = <span class="hljs-string"><span class="hljs-string">'https://api.vk.com/method/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($accessToken)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_accessToken = $accessToken; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($method, $params = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $params[<span class="hljs-string"><span class="hljs-string">'access_token'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_accessToken; $query = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_apiUrl. $method . <span class="hljs-string"><span class="hljs-string">'?'</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_params($params); $responseStr = file_get_contents($query); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_string($responseStr)){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } $responseObj = json_decode($responseStr); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $responseObj; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_params</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params)</span></span></span><span class="hljs-function"> </span></span>{ $pice = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($params <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $k=&gt;$v) { $pice[] = $k.<span class="hljs-string"><span class="hljs-string">'='</span></span>.urlencode($v); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> implode(<span class="hljs-string"><span class="hljs-string">'&amp;'</span></span>,$pice); } }</code> </pre> </div></div><br>  I will not describe authentication and authorization, since it is implemented through OAuth, there is a lot of information in runet, and also on the VK API page. <br><br>  Perform a test call to the API - get the first 20 posts in the group habrahabr <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wallsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//....... $api = new Vkapi_Model_Api($accessToken); $response = $api-&gt;api('wall.get',array('owner_id' =&gt; '-20629724')); $this-&gt;view-&gt;walls = $response-&gt;response; }</span></span></code> </pre><br><img src="http://www.habrastorage.com/images/wallsget.png" alt="image"><br><br>  Now we will do the same, only through the <b>execute</b> method <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wallsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//....... $api = new Vkapi_Model_Api($accessToken); $code = " var walls = API.wall.get({ owner_id : -20629724 }); return walls; "; $response = $api-&gt;api('execute',array('code' =&gt; $code )); $this-&gt;view-&gt;walls = $response-&gt;response; }</span></span></code> </pre><br>  As a result, we get the same result. <br>  The one bad thing is that we mixed VKScript and PHP code.  It looks very bad.  Take refactoring. <br>  It would be nice if each script was stored in a separate file and it could be called with one function.  It is also necessary to envisage the fact that later we will still need to transfer some data to this script (for example, <i>owner_id,</i> for example, <i>is</i> hard-packed into the code). <br><br><h6>  We take out VKScript in separate files </h6><br>  In the root of our module, we will create a folder with the name ‚Äúvkscripts‚Äù, into it we will add our scripts (for example getWalls.vks).  Let's write the path to the scripts in the application.ini config-file <br><pre> <code class="javascript hljs">vkapi.scripts.path = APPLICATION_PATH <span class="hljs-string"><span class="hljs-string">"/modules/vkapi/vkscripts"</span></span></code> </pre><br>  We need a class that would be convenient for invoking scripts located in this directory.  Let's use the features of PHP5, namely the __call magic method.  By the name of the called method, we will search for a script with this name. <br><div class="spoiler">  <b class="spoiler_title">Class source</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vkapi_Model_Executor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_api; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($api)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_api = $api; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $methodName, $arguments )</span></span></span><span class="hljs-function"> </span></span>{ $script = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getScript($methodName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(count($arguments)){ $script = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_prepareParams($script, $arguments[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_api-&gt;api(<span class="hljs-string"><span class="hljs-string">'execute'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'code'</span></span> =&gt; $script)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $error = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getError($response) ){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>($error-&gt;error_msg, $error-&gt;error_code); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $response-&gt;response; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($response)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($response-&gt;error) ){ $error = $response-&gt;error; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $error; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getScript</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $name )</span></span></span><span class="hljs-function"> </span></span>{ $scriptsPath = Zend_Registry::get(<span class="hljs-string"><span class="hljs-string">'vkapi_config'</span></span>)-&gt;scripts-&gt;path; $filePath = $scriptsPath . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $name . <span class="hljs-string"><span class="hljs-string">'.vks'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_file($filePath)){ $script = file_get_contents($filePath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $script; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre></div></div><br>  So let's do something with this class. <br>  In the folder vkscripts put the file <i>getWalls.vks</i> with the contents <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> walls = API.wall.get({ <span class="hljs-attr"><span class="hljs-attr">owner_id</span></span> : <span class="hljs-number"><span class="hljs-number">-20629724</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walls;</code> </pre><br>  In the controller: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wallsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//....... $api = new Vkapi_Model_Api($accessToken); $executor = new Vkapi_Model_Executor($api); $response = $executor-&gt;getWalls(); $this-&gt;view-&gt;walls = $response-&gt;response; }</span></span></code> </pre><br>  We got the same result, only there are significant advantages: we split the code into separate files, made it more readable, simplified the call to execute. <br>  The next step is to add the ability to pass parameters to our script.  Let's use for this a certain representation.  In the VKScript code, at the beginning, if necessary, we will write something to the input as follows: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groupId = %GROUP_ID%; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = %OFFSET%; <span class="hljs-comment"><span class="hljs-comment">// ....    </span></span></code> </pre><br>  And in our class, before calling api with this code, we will replace% VAR_NAME% with the variable value. <br>  We add our <b>Executor</b> class as follows <br><div class="spoiler">  <b class="spoiler_title">The source code of the modified class</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;source lang=<span class="hljs-string"><span class="hljs-string">"php"</span></span>&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vkapi_Model_Executor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ...... public function __call( $methodName, $arguments ) { $script = $this-&gt;_getScript($methodName); if(count($arguments)){ $script = $this-&gt;_prepareParams($script, $arguments[0]); } $response = $this-&gt;_api-&gt;api('execute', array('code' =&gt; $script)); if( $error = $this-&gt;_getError($response) ){ throw new Exception($error-&gt;error_msg, $error-&gt;error_code); } return $response-&gt;response; } // ...... private function _prepareParams($script, $params) { foreach ($params as $key =&gt; $value){ $script = str_replace('%' . strtoupper($key) . '%', $value, $script); } return $script; } }</span></span></code> </pre></div></div><br>  In the controller, if necessary, the transfer parameter write the following <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wallsAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//....... $api = new Vkapi_Model_Api($accessToken); $executor = new Vkapi_Model_Executor($api); $response = $executor-&gt;getWalls(array( 'group_id' =&gt; -20629724, 'offset' =&gt; 0 )); $this-&gt;view-&gt;walls = $response-&gt;response; }</span></span></code> </pre><br>  That, accordingly, substitute in our script instead of% GROUP_ID% and% OFFSET% passed values. <br>  Here is the structure of the module. <br><img src="http://www.habrastorage.com/images/folders.png" alt="image"><br><h5>  We get the number of users online </h5><br>  There is a restriction on calling API methods in <b>execute</b> .  Limit 22 call (found almost).  Also, on the web, I did not find information about other operators (for example addition, subtraction), there are also limitations, but they exist.  Since if I ran through the array of users and counted the number online, I received an error about the exceeded number of operations, it was decided to return the complete list of users from execute, and then on my server‚Äôs side to count their number. <br>  Due to the limitation in the number of requests to the API in the <b>execute</b> method, we still have to execute at least 1 request for 10,000 group members, because 2 requests are required to process 1.000. <br>  Here is the script that turned out <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> groupId = %GROUP_ID%; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = %OFFSET%; <span class="hljs-comment"><span class="hljs-comment">// API call limit var _acl = 22; var members = API.groups.getMembers({ gid : groupId }); _acl = _acl - 1; var count = members.count; var users = []; while( _acl &gt; 1 &amp;&amp; offset &lt; count){ var _members = API.groups.getMembers({ gid : groupId, offset : offset }); _acl = _acl - 1; users = users + API.users.get({ uids : members.users, fields : "online" }); _acl = _acl - 1; offset = offset + 1000; } var result = { count : count, offset : offset, users : users@.online }; return result;</span></span></code> </pre><br>  I will comment my code a little.  Counter _acl - to prevent errors due to exceeding the limit of operations with the API.  users @ .online - return only the list of values ‚Äã‚Äã[0,1,1,0,0,0,1,0,1] online offline. <br>  In the controller, we invoke this script, successively increasing the offset, until we run through all the group members. <br><pre> <code class="php hljs"> $count = <span class="hljs-number"><span class="hljs-number">1</span></span>; $offset = <span class="hljs-number"><span class="hljs-number">0</span></span>; $nowOnline = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($count &gt; $offset){ $users = $executor-&gt;getOnline(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'group_id'</span></span> =&gt; $groupId, <span class="hljs-string"><span class="hljs-string">'offset'</span></span> =&gt; $offset )); $count = $users-&gt;count; $offset = $users-&gt;offset; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $users-&gt;users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $online){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($online){ $nowOnline++; } } }</code> </pre><br><br>  So, we‚Äôll test and see that the data received through the API almost coincides with the data from vk.com, perhaps this inaccuracy is due to caches, or for some other reason not visible from the outside. <br><h5>  Remarks </h5><br>  VKScript does not support functions, increment or decrement operators. <br><br><h5>  Total </h5><br>  We developed tools for working with the vk.com API through the execute method.  With the help of it you can develop applications for collecting statistics, etc.  and it will look very nice.  Screwing the interface to this whole thing is a trivial task.  In the end, I note that another social network Facebook provides access to the execution of code written in a language called FQL (Facebook Query Language, similar to SQL), which clearly has more capabilities than VKScript with all its limitations. <br><br><h5>  Links </h5><br>  <a href="http://vk.com/developers.php">VK API</a> <br>  <a href="http://vk.com/developers.php%3Foid%3D-1%26p%3Dexecute">The execute method, a brief description and an example of VKScript</a> <br>  <a href="http://developers.facebook.com/docs/reference/fql/">Facebook Query Language</a> </div><p>Source: <a href="https://habr.com/ru/post/158469/">https://habr.com/ru/post/158469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158459/index.html">Internet Explorer 10 Preview for Windows 7 is already available.</a></li>
<li><a href="../158461/index.html">Loading the OpenStreetMap.org project mapping into GARMIN navigators without a slot for memory cards</a></li>
<li><a href="../158463/index.html">Advertising bubble: show must go on! We are the creators of the history of the Internet</a></li>
<li><a href="../158465/index.html">Apple began to encourage employees to work on personal projects</a></li>
<li><a href="../158467/index.html">Starts sales of Samsung Galaxy Camera in USA and UK</a></li>
<li><a href="../158471/index.html">Hacking bezdny.net</a></li>
<li><a href="../158473/index.html">Opera extension: search open site 1.1</a></li>
<li><a href="../158479/index.html">Simple chroma RGB color component</a></li>
<li><a href="../158481/index.html">Prototype voice shopping list for WP8, Win8, Android with a backend in Azure in 2.5 hours</a></li>
<li><a href="../158483/index.html">We draw a clear icon of the house in 32x32 (ala FatCow)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>