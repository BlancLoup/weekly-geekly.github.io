<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MikroTik as a network tester</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Acquired the MikroTik RouterBoard mAP 2n . Great model. Having played enough with him, we decided to use a small provider network as a tester. Very of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MikroTik as a network tester</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/362/1d7/c2b/3621d7c2ba254506a8c7f6d15aa698a0.png"><br><br>  Acquired the <a href="http://routerboard.com/RBmAP2n">MikroTik RouterBoard mAP 2n</a> .  Great model.  Having played enough with him, we decided to use a small provider network as a tester.  Very often, to check the status of the network, it is necessary to uncover a laptop, which is sometimes extremely inconvenient because of the location of the equipment in the basements, attics.  Of course, it is impossible to replace the laptop completely, but the standard tests can be passed onto our ‚Äúlittle friend‚Äù shoulders.  This will be discussed in my post. <br><a name="habracut"></a><br>  One of the features of the mAP 2n is the presence of a microUSB in it, by which the router can be powered.  This feature makes it possible to use a mobile device together with a portable charger.  <a href="http://www.hiper-power.com/product/hiper_powerbank_wp222">HIPER WP-222</a> was chosen as a portable charger.  Basically, his choice was due to the price, but his waterproof case and the presence of a <abbr title="can sos blink and laser pointer is">flashlight</abbr> finally convinced us of the correctness of the decision. <br><br><img src="https://habrastorage.org/files/621/9b8/b3c/6219b8b3cd96462d98245fa206c6573a.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the tester requires a communication channel with the person.  The first thought was to use the speaker, where you can <a href="http://wiki.mikrotik.com/wiki/Super_Mario_Theme">work wonders</a> with RouterOS, but unfortunately mAP 2n cheated them.  All that is left is to use the LED display.  The mAP 2n on the front panel has 7 LEDs: Power - it cannot be controlled, one red - power to someone via the second port and 5 green ones (WI-Fi, Eth1.2 USR, AP / CAP).  You can control the LED by assigning a bridge interface.  Turn on, the interface LED lights up, turn off - goes out. <br><br><pre><code class="hljs sql">/system leds <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=br1 <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">status</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> br1 disabled=yes; <span class="hljs-comment"><span class="hljs-comment">#  set br1 disabled=no; # </span></span></code> </pre> <br>  In addition, to notify a person, we must figure out how to get some command from him.  I dug in the direction of the Reset / Mode button for a long time, but I didn‚Äôt really know anything except the ability to reset the settings, but I would like to know what this Mode is.  I had to think of something else.  The mAP 2n has two 10/100 Ethernet ports onboard.  By the first, the router can be powered, and by the second, it will itself be the power source, moreover, the router is able to determine that a device that can be powered is connected to it.  This is due to the presence of resistance at 4.5 - 7.8 pins of the Ethernet port <a href="http://wiki.mikrotik.com/wiki/Manual:PoE-Out">from 3kŒ© to 26.5kŒ©</a> .  Without hesitation, we built the following piece on the basis of the Ethernet connector, buttons from the PC case and a 4kŒ© resistor: <br><br><img src="https://habrastorage.org/files/c7d/552/0b4/c7d5520b4384462ea0457746000a9393.jpg"><br><br>  We programmatically check the button like this: <br><br><pre> <code class="hljs pgsql">/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> eth2 poe-<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>=auto-<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> status; /interface ethernet poe monitor eth2 once <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> status $"poe-out-status"; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($status = "powered-on") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ #   };</code> </pre><br>  There is a communication channel with a person. It is necessary to decide what we are going to check and in what sequence. <br><br>  Let's start: <br><br>  1. The presence of a link on the port without it further and unnecessary to check anything.  We will check the link with a <a href="http://wiki.mikrotik.com/wiki/Manual:Interface/Ethernet">cable-test</a> tool that will check the cable physically. <br><br><pre> <code class="hljs bash">:<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> link; /interface ethernet cable-test eth1 once <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link $<span class="hljs-string"><span class="hljs-string">"status"</span></span>; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$link</span></span> = <span class="hljs-string"><span class="hljs-string">"link-ok"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ <span class="hljs-comment"><span class="hljs-comment">#   };</span></span></code> </pre><br>  2. The port should be 100Mbps.  Many switches, because of their iron problems, start to fail and give out 10Mbps per port, which is what we need to eliminate.  We do it like this: <br><br><pre> <code class="hljs objectivec">:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet get eth1 speed] = <span class="hljs-string"><span class="hljs-string">"100Mbps"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ <span class="hljs-meta"><span class="hljs-meta">#   };</span></span></code> </pre><br>  3. Pings where without them?  We ping the gateway.  Here you need to ping the gateway with ordinary and large packets. This will reveal possible problems in the chain to the gateway.  We do it like this: <br><br><pre> <code class="hljs cs">:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/ping address=[/ip dhcp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> gateway] <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=ethernet count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/ping address=[/ip dhcp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> gateway] <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=ethernet count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms size=<span class="hljs-number"><span class="hljs-number">1500</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ <span class="hljs-meta"><span class="hljs-meta">#   }; };</span></span></code> </pre><br>  4. Additionally, by pressing our button, we test the VPN (it is possible and anything else in our case is pptp) and Internet access. <br><br><pre> <code class="hljs pgsql">:<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> gateway "8.8.8.8"; #     :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn running] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/ping address=$gateway interface=vpn count=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">interval</span></span>=<span class="hljs-number"><span class="hljs-number">200</span></span>ms size=<span class="hljs-number"><span class="hljs-number">1500</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ #   }; };</code> </pre><br>  It was decided to inform the person like this: <br>  The first test is to check the link if everything is good, then nothing is lit, if everything is bad then a red LED is lit. <br>  The second test is a test on the 100Mbps port, if everything is good, then the first green LED is on, if everything is bad then nothing is lit. <br>  The third test is a ping. If the short and long pings have passed, the second green LED is on, if short ones have passed, but there are no long pings, the second LED blinks, if the second LED does not work, the LED is off. <br>  The fourth test at the touch of a button, only if all the previous ones have successfully completed - a VPN test and the Internet if the VPN is working and the ping to the external gateway has passed, the third green LED is on, if the VPN is working and the pings have not passed, the third green LED is blinking does not burn. <br><br>  At any of the stages when any test fails, all testing should return to the beginning.  After all, we can sort out the cable and test several in turn.  Just repeat the button to check the VPN and the Internet can be used only with successful passing of the previous tests. <br><br>  For the first port, they made a small extension cord, which became more comfortable and, most importantly, excluded the possibility of powering it on this port. <br>  Eth2 LED - indicates Wi-Fi activity, but Eth1 on Eth1 link.  Wi-Fi on the device is configured and there is access to its management from a smartphone.  Here you can also write an application for additional tests via a smartphone, but this is another story. <br><br>  The minus of implementation after three months of its use in combat conditions is a relatively long load, but having become accustomed to this, they began to turn it on beforehand by doing parallel tasks.  Now the laptop lives in the car and rarely gets.  At the end I will give the whole script. <br><br><div class="spoiler">  <b class="spoiler_title">Here is a script that turned out:</b> <div class="spoiler_text">  In the script: <br>  test1, test2, test3 - bridge interfaces with the association of three extreme-left LEDs (except for the first one - Power) <br>  link - the second Ethernet port <br>  ethernet - the first Ethernet port <br>  off - bridge interface for programmatically stopping the script.  Needed to debug for convenience. <br>  8.8.8.8 - replaced the address of our gateway with Google DNS <br>  vpn - pptp connection <br><pre> <code class="hljs vbscript">{ :<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> info [ :<span class="hljs-built_in"><span class="hljs-built_in">time</span></span> { :local gateway <span class="hljs-string"><span class="hljs-string">"8.8.8.8"</span></span>; /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test1 disabled=yes; /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=yes; /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=forced-<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=yes; :delay <span class="hljs-number"><span class="hljs-number">3</span></span>; :local link; :local status; :local flag <span class="hljs-literal"><span class="hljs-literal">false</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> off disabled] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet cable-test ethernet once <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link $<span class="hljs-string"><span class="hljs-string">"status"</span></span>; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($link = <span class="hljs-string"><span class="hljs-string">"link-ok"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] = <span class="hljs-string"><span class="hljs-string">"forced-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=off; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> ethernet speed] = <span class="hljs-string"><span class="hljs-string">"100Mbps"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test1 disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test1 disabled=no; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/ping address=[/ip dhcp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> gateway] interface=ethernet count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/ping address=[/ip dhcp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> gateway] interface=ethernet count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms size=<span class="hljs-number"><span class="hljs-number">1500</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=no; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($flag != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] != <span class="hljs-string"><span class="hljs-string">"auto-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=auto-<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; }; }; /interface ethernet poe monitor link once <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> status $<span class="hljs-string"><span class="hljs-string">"poe-out-status"</span></span>; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] = <span class="hljs-string"><span class="hljs-string">"auto-on"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $status = <span class="hljs-string"><span class="hljs-string">"powered-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> $flag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($flag != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> flag <span class="hljs-literal"><span class="hljs-literal">true</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=no; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] != <span class="hljs-string"><span class="hljs-string">"off"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=off; } }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn running] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/ping address=$gateway interface=vpn count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms size=<span class="hljs-number"><span class="hljs-number">1500</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=no; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=no; }; :delay <span class="hljs-number"><span class="hljs-number">0.5</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; }; :delay <span class="hljs-number"><span class="hljs-number">0.5</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=no; }; :delay <span class="hljs-number"><span class="hljs-number">0.5</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; }; :delay <span class="hljs-number"><span class="hljs-number">0.5</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] = <span class="hljs-string"><span class="hljs-string">"auto-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=off; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> flag <span class="hljs-literal"><span class="hljs-literal">false</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=no; }; :delay <span class="hljs-number"><span class="hljs-number">0.5</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=yes; }; :delay <span class="hljs-number"><span class="hljs-number">0.5</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] = <span class="hljs-string"><span class="hljs-string">"auto-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=off; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> flag <span class="hljs-literal"><span class="hljs-literal">false</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] = <span class="hljs-string"><span class="hljs-string">"auto-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=off; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> flag <span class="hljs-literal"><span class="hljs-literal">false</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test1 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test1 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] != <span class="hljs-string"><span class="hljs-string">"forced-on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=forced-<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> flag <span class="hljs-literal"><span class="hljs-literal">false</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test1 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test1 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; }; :delay <span class="hljs-number"><span class="hljs-number">3</span></span>; } }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> link poe-out] != <span class="hljs-string"><span class="hljs-string">"off"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface ethernet poe <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> link poe-out=off; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> vpn disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface pptp-client <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> vpn disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test1 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test1 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test2 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test2 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> test3 disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> test3 disabled=yes; }; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> off disabled] != <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ /interface bridge <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> off disabled=yes; } } ] }</code> </pre><br></div></div><br>  The script itself should start immediately after starting the router.  To do this, use the <a href="http://wiki.mikrotik.com/wiki/Manual:System/Scheduler">scheduler</a> : <br><br><pre> <code class="hljs pgsql">/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> scheduler <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=tester <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-event=":delay 3;/system script run tester;" <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>=ftp,reboot,<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>,test,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,sniff,sensitive <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>-<span class="hljs-type"><span class="hljs-type">time</span></span>=startup</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Config router.</b> <div class="spoiler_text"><pre> <code class="hljs dos"># RouterOS <span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">21</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> # /interface bridge add disabled=yes mtu=<span class="hljs-number"><span class="hljs-number">1500</span></span> name=off add mtu=<span class="hljs-number"><span class="hljs-number">1500</span></span> name=test1 add mtu=<span class="hljs-number"><span class="hljs-number">1500</span></span> name=test2 add mtu=<span class="hljs-number"><span class="hljs-number">1500</span></span> name=test3 /interface ethernet <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> default-name=ether1 ] name=ethernet <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> default-name=ether2 ] name=link poe-out=off /interface wireless <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> default-name=wlan1 ] band=<span class="hljs-number"><span class="hljs-number">2</span></span>ghz-b/g/n channel-width=<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">40</span></span>mhz-Ce \ country=russia disabled=no distance=indoors frequency=<span class="hljs-number"><span class="hljs-number">2437</span></span> \ frequency-<span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=superchannel l2mtu=<span class="hljs-number"><span class="hljs-number">1600</span></span> <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=ap-bridge radio-name="" ssid=\ wifi wireless-protocol=<span class="hljs-number"><span class="hljs-number">802</span></span>.<span class="hljs-number"><span class="hljs-number">11</span></span> /interface wireless nstreme <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> wlan1 enable-polling=no /ip neighbor discovery <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> ethernet discover=no /interface wireless security-profiles <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> default=yes ] authentication-types=wpa-psk,wpa2-psk eap-methods="" \ group-ciphers=tkip,aes-ccm <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=dynamic-keys unicast-ciphers=tkip,aes-ccm \ wpa-pre-shared-key= wpa2-pre-shared-key= /ip pool add name=default-dhcp ranges=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">10</span></span>-<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">254</span></span> /ip dhcp-server add address-pool=default-dhcp disabled=no interface=wlan1 name=default /interface pptp-client add add-default-route=no allow=mschap1,mschap2 connect-to=vpn..ru \ dial-on-demand=no disabled=no keepalive-timeout=<span class="hljs-number"><span class="hljs-number">60</span></span> max-mru=<span class="hljs-number"><span class="hljs-number">1400</span></span> max-mtu=\ <span class="hljs-number"><span class="hljs-number">1400</span></span> mrru=disabled name=vpn password= profile=default-encryption \ user= /system logging action <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> disk-file-name="" <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> remember=yes /interface bridge port add interface=link add interface=wlan1 /ip address add address=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> interface=wlan1 \ network=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> /ip dhcp-client add dhcp-options=hostname,clientid disabled=\ no interface=ethernet use-peer-ntp=no /ip dhcp-server network add address=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> dns-server=\ <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> /ip dns <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> allow-remote-requests=yes /ip dns static add address=<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> name=router /ip firewall filter add chain=input protocol=icmp add chain=input connection-state=established add chain=input connection-state=related add action=drop chain=input <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface=\ all-ppp add chain=forward connection-state=\ established add chain=forward connection-state=related add action=drop chain=forward \ connection-state=invalid /ip firewall mangle add action=mark-routing chain=prerouting new-routing-mark=vpn src-address=\ <span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">10</span></span>-<span class="hljs-number"><span class="hljs-number">192</span></span>.<span class="hljs-number"><span class="hljs-number">168</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">254</span></span> /ip firewall nat add action=masquerade chain=srcnat \ out-interface=all-ppp /ip route add distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=vpn routing-mark=vpn /ip upnp <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> allow-disable-external-interface=no /snmp <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> trap-community=public /system clock manual <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>-zone=+<span class="hljs-number"><span class="hljs-number">05</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> /system leds <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> interface=wlan1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=wireless-status <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> interface=test2 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=interface-status <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> interface=test1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=interface-status add interface=test3 leds=user-led <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=interface-status /system routerboard settings <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> cpu-frequency=<span class="hljs-number"><span class="hljs-number">400</span></span>MHz /system scheduler add name=tester on-event=":delay <span class="hljs-number"><span class="hljs-number">3</span></span>;\r\ \n/system script run tester;" policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive <span class="hljs-built_in"><span class="hljs-built_in">start</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=\ startup /system script add name=tester policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive source="{:log i\ nfo [:<span class="hljs-built_in"><span class="hljs-built_in">time</span></span> {:local gateway \"<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>\";/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test1 di\ sabled=yes;/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=yes;/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> \ test3 disabled=yes;/interface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=forced-on;/int\ erface pptp-client <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn disabled=yes;:delay <span class="hljs-number"><span class="hljs-number">3</span></span>;:local link;:local status\ ;:local flag false;:while ([/interface bridge get off disabled] = true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>\ ={/interface ethernet cable-test ethernet once <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link \$\"status\";\ };:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (\$link = \"link-ok\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe get link po\ e-out] = \"forced-on\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=off;}\ ;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet get ethernet speed] = \"<span class="hljs-number"><span class="hljs-number">100</span></span>Mbps\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/i\ nterface bridge get test1 disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> te\ st1 disabled=no;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/<span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> address=[/ip dhcp-client get <span class="hljs-number"><span class="hljs-number">0</span></span> gateway] inte\ rface=ethernet count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/<span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> address=[/ip d\ hcp-client get <span class="hljs-number"><span class="hljs-number">0</span></span> gateway] interface=ethernet count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms size=<span class="hljs-number"><span class="hljs-number">1</span></span>\ <span class="hljs-number"><span class="hljs-number">500</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test2 disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/i\ nterface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=no;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (\$flag != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>\ terface ethernet poe get link poe-out] != \"auto-on\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface ethe\ rnet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=auto-on;}};/interface ethernet poe monitor link \ once <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> status \$\"poe-out-status\";};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (([/interface ethernet poe\ \_get link poe-out] = \"auto-on\" and \$status = \"powered-on\") or \$flag\ \_= true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (\$flag != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> flag true;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ppt\ p-client get vpn disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface pptp-client <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn di\ sabled=no;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe get link poe-out] != \"off\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>\ ={/interface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=off;}};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-cl\ ient get vpn running] = true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/<span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> address=\$gateway interface=\ vpn count=<span class="hljs-number"><span class="hljs-number">1</span></span> interval=<span class="hljs-number"><span class="hljs-number">200</span></span>ms size=<span class="hljs-number"><span class="hljs-number">1500</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get\ \_test3 disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=no;}}\ \_else={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test3 disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interfa\ ce bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=no;};:delay <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get t\ est3 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=yes;};:de\ lay <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>;}} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test3 disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>=\ {/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=no;};:delay <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bri\ dge get test3 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=\ yes;};:delay <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>;}}} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe get link poe-out]\ \_= \"auto-on\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=off;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([\ /interface pptp-client get vpn disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface pptp-clie\ nt <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn disabled=yes;};:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> flag false;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test\ <span class="hljs-number"><span class="hljs-number">3</span></span> disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([\ /interface bridge get test2 disabled] != false) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> \ test2 disabled=no;};:delay <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test2 disabled]\ \_!= true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=yes;};:delay <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>;}} el\ se={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe get link poe-out] = \"auto-on\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>\ terface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=off;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client g\ et vpn disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface pptp-client <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn disabled=yes;\ };:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> flag false;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test2 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>=\ {/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get te\ st3 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=yes;}}} el\ se={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe get link poe-out] = \"auto-on\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>\ terface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=off;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client g\ et vpn disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface pptp-client <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn disabled=yes;\ };:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> flag false;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test1 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>=\ {/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test1 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get te\ st2 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> \ ([/interface bridge get test3 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>\ \_test3 disabled=yes;}}} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface ethernet poe get link poe-\ out] != \"forced-on\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface ethernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=forced\ -on;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client get vpn disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interfa\ ce pptp-client <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn disabled=yes;};:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> flag false;:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bri\ dge get test1 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test1 disabled=\ yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test2 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface \ bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test3 disabled\ ] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=yes;};:delay <span class="hljs-number"><span class="hljs-number">3</span></span>;}};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> \ ([/interface ethernet poe get link poe-out] != \"off\") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface eth\ ernet poe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> link poe-out=off;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface pptp-client get vpn disa\ bled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface pptp-client <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> vpn disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>\ terface bridge get test1 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test\ <span class="hljs-number"><span class="hljs-number">1</span></span> disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get test2 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={\ /interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test2 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([/interface bridge get tes\ t3 disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> test3 disabled=yes;};:<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (\ [/interface bridge get off disabled] != true) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={/interface bridge <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> of\ f disabled=yes;}}]}" /tool mac-server <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> default=yes ] disabled=yes add interface=link add interface=wlan1 add interface=ethernet /tool mac-server mac-winbox <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [ <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> default=yes ] disabled=yes add interface=link add interface=wlan1 add interface=ethernet</code> </pre><br></div></div><br>  I hope this material will be useful to someone. <br><br><div class="spoiler">  <b class="spoiler_title">At the end I will attach some photos of crafts.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/2e7/149/ef1/2e7149ef1e54488d8bc29c0647e9a4f6.jpg"><br><img src="https://habrastorage.org/files/ffe/1f6/381/ffe1f6381c3b45da9394c6b5944e99a2.jpg"><br><img src="https://habrastorage.org/files/1d7/a59/cfa/1d7a59cfaa364d6ba266ecea27e15aaf.jpg"><br><img src="https://habrastorage.org/files/c2b/045/399/c2b0453995794d5cb5d8137e54a10433.jpg"><br></div></div><br><br>  PS Now, at the press of a button, the statistics are also reset to the email of the sysadmin.  Also the result of the channel width test and some more information that may be useful. </div><p>Source: <a href="https://habr.com/ru/post/364593/">https://habr.com/ru/post/364593/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../364581/index.html">Polymer nanoparticles will not allow the causative agent of malaria to penetrate into the erythrocytes</a></li>
<li><a href="../364583/index.html">Antipremiya Runet 2014 held. Awards caught up with heroes</a></li>
<li><a href="../364587/index.html">MYO bracelet will not be delivered to individuals in the Russian Federation</a></li>
<li><a href="../364589/index.html">New "Civilization" under Linux will be released today at 21:00 MSK</a></li>
<li><a href="../364591/index.html">The American company Orbital Sciences will buy from NPO "Energomash" 60 rocket engines for $ 1 billion</a></li>
<li><a href="../364597/index.html">Hackers first attacked business through the fridge</a></li>
<li><a href="../364599/index.html">NASA has two options for hauling an asteroid.</a></li>
<li><a href="../364601/index.html">A dog with a congenital defect of the front paws was able to run thanks to 3D printing</a></li>
<li><a href="../364603/index.html">E-sports industry, part 2</a></li>
<li><a href="../364605/index.html">Highlighting future cities with bioluminescence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>