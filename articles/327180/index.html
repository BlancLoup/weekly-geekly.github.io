<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dagaz: Rehearsal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Not true! This tale says something quite different. 
 ‚ÄúBut if you already know what is being said in this fairy tale, why should I read it?‚Äù 
 - The...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dagaz: Rehearsal</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/43e/794/3a3/43e7943a3e289a281570ab8b68d347b8.png" alt="image">  <b><i>- Not true!</i></b>  <b><i>This tale says something quite different.</i></b> <b><i><br></i></b>  <b><i>‚ÄúBut if you already know what is being said in this fairy tale, why should I read it?‚Äù</i></b> <b><i><br></i></b>  <b><i>- Then, I want to hear it!</i></b> <b><i><br><br></i></b>  <b><i>Ted Chan " <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D1%2581%25D1%2582%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D1%2582%25D0%25B2%25D0%25BE%25D0%25B5%25D0%25B9_%25D0%25B6%25D0%25B8%25D0%25B7%25D0%25BD%25D0%25B8">Your Life Story</a> "</i></b> <br><br><br>  This is a big event when something suddenly starts to work.  Unintelligible pages of code in Java and JavaScript, even less understandable XML, pictures drawn in Paint are all this together! <br>  Now, this can be run and "touch."  Tests could be run before, they helped get to this day.  But how can you compare tests with a running program?  Workable release!  For many, this milestone marks the end of the journey. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I hope that for me this is just the beginning ... <br><a name="habracut"></a><br>  As the first task for the test of strength, I chose "Sliding Puzzles" - puzzles with moving parts.  It all started with the game " <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B3%25D1%2580%25D0%25B0_%25D0%25B2_15">15</a> " and <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25BE%25D0%25B9%25D0%25B4,_%25D0%25A1%25D1%258D%25D0%25BC%25D1%258E%25D1%258D%25D0%25BB%25D1%258C">Sam Loyd</a> .  This outstanding entrepreneur offered a large cash prize for solving a problem that has no solution.  And the world has gone mad.  When the degree of madness died down, other people offered to glue the pieces of the spots together to get even more interesting (but already solved) puzzles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/47f/940/2fd/47f9402fdd81400ea2026f223dfa92d1.jpg"></div><br>  Papa's puzzle is perhaps the earliest known puzzle of this kind (under this name it was sold in America in 1926).  The large square must be moved to the lower right corner.  It's simple.  There are (almost) no dead ends and forks, it is difficult to go astray. <br><br>  To deliver a square to the lower left corner is a little more difficult.  If you cut one of the rectangular pieces into two small squares and put them in a box over the other, you can get a much more complicated puzzle. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e55/657/040/e556570401c04d08b28fb4df2a1685ae.JPG"></div><br>  In childhood I was given this.  I did not decide it.  In France, this puzzle is known as ‚ÄúL'Ane rouge‚Äù (Ginger ass).  A large square is required to be placed at the bottom, exactly in the middle (sometimes a hole was made through which it could be pushed out of the box).  As far as I know, the minimum number of moves required to resolve the Red Ass is unknown.  Martin Gardner, in his book <a href="http://publ.lib.ru/ARCHIVES/G/GARDNER_Martin/_Gardner_M..html">Mathematical Leisure</a> , describes a solution consisting of 81 moves. <br><br>  Of course, "Red Donkey" is not the most difficult puzzle.  There are a lot of games of this type (and some of them are very complex).  Known puzzles with non-convex parts (like " <a href="http://www.cs.brandeis.edu/~storer/JimPuzzles/ZPAGES/zzzMasPuzzle.html">Mother's Puzzle</a> " or " <a href="https://sites.google.com/site/geduldspiele/SolutionEscottPuzzle">Ascot Puzzle</a> ").  Some kits were developed in honor of historical events (such as the election of <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B0%25D1%2588%25D0%25B8%25D0%25BD%25D0%25B3%25D1%2582%25D0%25BE%25D0%25BD,_%25D0%2594%25D0%25B6%25D0%25BE%25D1%2580%25D0%25B4%25D0%25B6">George Washington as</a> president of America or the flights of famous pilots).  This is a whole world, rich and diverse. <br><br>  Unlike the game "15" there is no simple way to determine whether such a puzzle has a solution.  Only bust!  It is not surprising that programmers to them <a href="http://nontwistypuzzles.ru/programms/programms.php%3Fid%3D5">breathe</a> so <a href="http://nontwistypuzzles.ru/programms/programms.php%3Fid%3D5">unevenly</a> .  This fad also did not pass me.  I was doing "Red ass" when I mastered Delphi.  Later, I developed a mobile application for Android.  Now I do it again, though this time the puzzles themselves are not the goal ‚Äî they are just a way to make sure that the approach I have chosen works.  Private use of a more versatile product. <br><br>  From the point of view of <a href="https://github.com/GlukKazan/Dagaz">Dagaz</a> , puzzles are single player games.  There is a board and figures, there are rules for moving and the conditions for completing the game.  No interaction of two (or more players).  For me, this is convenient, because it allows you to run the project in the absence of some modules required for the implementation of more complex games.  This is the zero iteration.  A kind of prerelease project. <br><br><div class="spoiler">  <b class="spoiler_title">What does the implementation of Sliding puzzles on ZRF look like?</b> <div class="spoiler_text"><pre><code class="lisp hljs"><span class="hljs-comment"><span class="hljs-comment">; for (2,1)-pieces (define shift2x1 ((verify (empty? w)) from w to cascade ee from w to (count-move) add) ((verify (empty? e)) from e to cascade ww from e to (count-move) add) (w (verify (piece? $1))(verify (empty? w)) e from w to cascade from w to (count-move) add) (e (verify (piece? $1))(verify (empty? e)) w from e to cascade from e to (count-move) add) ((verify (empty? n))(verify (empty? ne)) e (verify (piece? $1)) w from n to cascade se from n to (count-move) add) ((verify (empty? n))(verify (empty? nw)) w (verify (piece? $1)) e from n to cascade sw from n to (count-move) add) ((verify (empty? s))(verify (empty? se)) e (verify (piece? $1)) w from s to cascade ne from s to (count-move) add) ((verify (empty? s))(verify (empty? sw)) w (verify (piece? $1)) e from s to cascade nw from s to (count-move) add) (w (verify (empty? w)) (verify empty?) e from ww to cascade eee from ww to (count-move) add) (w (verify (piece? $1)) w (verify (empty? w)) (verify empty?) ee from ww to cascade e from ww to (count-move) add) (e (verify (empty? e)) (verify empty?) w from ee to cascade www from ee to (count-move) add) (e (verify (piece? $1)) e (verify (empty? e)) (verify empty?) ww from ee to cascade w from ee to (count-move) add) )</span></span></code> </pre> </div></div><br>  And this is only one of the macros controlling the coordinated movement of tile figures!  Specifically, this provides the movement of the plate size of 2x1, rotated horizontally (for the vertical plate uses a different hardcode).  Of course, not <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D831">this</a> terrible horror is my goal!  In <a href="">Dagaz,</a> everything is much easier! <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> step ( $<span class="hljs-number"><span class="hljs-number">1</span></span> add ))</code> </pre><br>  That's all!  Of course, in real life, things are never that simple.  In order for the puzzle to work as it should, the tile figures that make up one plate must move synchronously.  In addition, they should not "run into" the tiles of other dice located on the board.  All this is incredibly difficult to describe on ZRF.  There is absolutely no point in doing this. <br><br><div class="spoiler">  <b class="spoiler_title">In JavaScript, this is done much easier!</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> distinctMode = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isEqual = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a == <span class="hljs-number"><span class="hljs-number">0</span></span>) || (b == <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a == b; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isEmpty = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">board, pos, value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> piece = board.getPiece(pos); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (piece === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isEqual(piece.getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>), value); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isSubset = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; x.actions.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> action = x.actions[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_.chain(y.actions) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] == action[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; a[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] == action[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]; }) .size() .value() == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } Dagaz.Model.getPieceTypes = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">piece, board</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tag = piece.getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.chain(board.pieces) .compact() .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">piece</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> piece.getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>) == tag; }) .map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">piece</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> piece.type; }) .uniq() .value(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CheckInvariants = Dagaz.Model.CheckInvariants; Dagaz.Model.CheckInvariants = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">board</span></span></span><span class="hljs-function">) </span></span>{ _.chain(board.moves) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">move</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (move.actions.length != <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> action = move.actions[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!action[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!action[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] == action[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (board.getPiece(action[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]) === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }) .each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">move</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> design = board.game.design; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> action = move.actions[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> = action[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delta = action[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> piece = board.getPiece(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value = piece.getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isEmpty(board, action[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>], value)) { _.chain(_.range(design.positions.length)) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pos</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pos != <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>; }) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pos</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (board.getPiece(pos) === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isEqual(board.getPiece(pos).getValue(<span class="hljs-number"><span class="hljs-number">0</span></span>), value); }) .each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pos</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> target = pos + delta; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Dagaz.find(design.positions[pos], delta) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (target &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (target &gt;= design.positions.length) || !isEmpty(board, target, value)) { move.failed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { move.movePiece(pos, target, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { move.failed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distinctMode) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> moves = []; _.chain(board.moves) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">move</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (_.isUndefined(move.failed)); }) .each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">move</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_.chain(moves) .filter(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isSubset(m, move) &amp;&amp; isSubset(move, m); }) .size() .value() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { moves.push(move); } }); board.moves = moves; } CheckInvariants(board); }</code> </pre></div></div><br>  <a href="">This</a> module does everything we need.  Yes, it is difficult, but it is written only once, after which it is reused in all puzzles of this type.  Connecting a JavaScript module to the Dagaz core written in JavaScript is much easier than loading DDL files written in C ++ into the Zillions of Games Windows application.  Why not use it? <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">option</span></span> <span class="hljs-string"><span class="hljs-string">"smart-moves"</span></span> from) (<span class="hljs-name"><span class="hljs-name">option</span></span> <span class="hljs-string"><span class="hljs-string">"sliding-puzzle"</span></span> true)</code> </pre><br>  The magic module is connected by the second option.  The first includes a more friendly movement of shapes.  What else is required to describe a new puzzle?  A bit of template code to describe the board and player: <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">players</span></span> You) (<span class="hljs-name"><span class="hljs-name">turn-order</span></span> You) (<span class="hljs-name"><span class="hljs-name">board</span></span> (<span class="hljs-name"><span class="hljs-name">grid</span></span> (<span class="hljs-name"><span class="hljs-name">start-rectangle</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>) (<span class="hljs-name"><span class="hljs-name">dimensions</span></span> (<span class="hljs-string"><span class="hljs-string">"a/b/c/d/e"</span></span> (<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-comment"><span class="hljs-comment">; files ("3/2/1" (0 100)) ; ranks ) (directions (n 0 -1) (s 0 1) (e 1 0) (w -1 0)) ) )</span></span></code> </pre><br>  If the size of the board is not 5x3, you will need to slightly edit the grid lines.  Next, we describe the figures themselves (tiles): <br><br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> T (<span class="hljs-name"><span class="hljs-name">piece</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span>$<span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">help</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span>) (<span class="hljs-name"><span class="hljs-name">image</span></span> You <span class="hljs-string"><span class="hljs-string">"images/$1.bmp"</span></span>) (<span class="hljs-name"><span class="hljs-name">attribute</span></span> value $<span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">moves</span></span> (<span class="hljs-name"><span class="hljs-name">step</span></span> n) (<span class="hljs-name"><span class="hljs-name">step</span></span> s) (<span class="hljs-name"><span class="hljs-name">step</span></span> w) (<span class="hljs-name"><span class="hljs-name">step</span></span> e) ) ) ) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0000 <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0010C <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0001P <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0100C <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R1000C <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0010P <span class="hljs-number"><span class="hljs-number">4</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0001C <span class="hljs-number"><span class="hljs-number">4</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0000P <span class="hljs-number"><span class="hljs-number">5</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0100P <span class="hljs-number"><span class="hljs-number">6</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R1000P <span class="hljs-number"><span class="hljs-number">6</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0000C <span class="hljs-number"><span class="hljs-number">7</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0000 <span class="hljs-number"><span class="hljs-number">8</span></span>) (<span class="hljs-name"><span class="hljs-name">T</span></span> R0000 <span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre><br>  A macro called ‚ÄúT‚Äù simply saves us from a lot of monotonous writing.  The ones and zeros in the shape name encode the picture used to display the tile on the board.  The number added to them is the group identifier.  Tiles in which it matches are moved together (this, as well as checking the possibility of such a move, is provided by our magic script).  It remains to describe the initial arrangement of the figures: <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">board-setup</span></span> (<span class="hljs-name"><span class="hljs-name">You</span></span> (<span class="hljs-name"><span class="hljs-name">R00001</span></span> b3) (<span class="hljs-name"><span class="hljs-name">R0010C2</span></span> c3) (<span class="hljs-name"><span class="hljs-name">R0001P2</span></span> c2) (<span class="hljs-name"><span class="hljs-name">R0100C3</span></span> d3) (<span class="hljs-name"><span class="hljs-name">R1000C3</span></span> e3) (<span class="hljs-name"><span class="hljs-name">R0010P4</span></span> a2) (<span class="hljs-name"><span class="hljs-name">R0001C4</span></span> a1) (<span class="hljs-name"><span class="hljs-name">R0000P5</span></span> b2) (<span class="hljs-name"><span class="hljs-name">R0100P6</span></span> d2) (<span class="hljs-name"><span class="hljs-name">R1000P6</span></span> e2) (<span class="hljs-name"><span class="hljs-name">R0000C7</span></span> b1) (<span class="hljs-name"><span class="hljs-name">R00008</span></span> c1) (<span class="hljs-name"><span class="hljs-name">R00009</span></span> d1) ) )</code> </pre><br>  and the goal of the game: <br><br><pre> <code class="lisp hljs"> (<span class="hljs-name"><span class="hljs-name">win-condition</span></span> (<span class="hljs-name"><span class="hljs-name">You</span></span>) (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">absolute-config</span></span> R0010C2 (<span class="hljs-name"><span class="hljs-name">a2</span></span> b2 c2 d2 e2)) (<span class="hljs-name"><span class="hljs-name">absolute-config</span></span> R0100C3 (<span class="hljs-name"><span class="hljs-name">a2</span></span> b2 c2 d2 e2)) (<span class="hljs-name"><span class="hljs-name">absolute-config</span></span> R1000C3 (<span class="hljs-name"><span class="hljs-name">a2</span></span> b2 c2 d2 e2)) (<span class="hljs-name"><span class="hljs-name">absolute-config</span></span> R0001C4 (<span class="hljs-name"><span class="hljs-name">a2</span></span> b2 c2 d2 e2)) (<span class="hljs-name"><span class="hljs-name">absolute-config</span></span> R0000C7 (<span class="hljs-name"><span class="hljs-name">a2</span></span> b2 c2 d2 e2)) ))</code> </pre><br>  Putting it all together, we get an almost honest <a href="">ZRF file</a> .  Launch it in <a href="http://www.zillions-of-games.com/">Zillions of Games</a> fail for two reasons. <br><br><ol><li>  The traditional Zillions of Games knows nothing about the " <b>sliding-puzzle</b> " option </li><li>  He also does not support numeric attributes (but would be worth it) </li></ol><br>  Now, <a href="https://github.com/GlukKazan/Dagaz/tree/master/utils/z2j">Z2J</a> comes into <a href="https://github.com/GlukKazan/Dagaz/tree/master/utils/z2j">play</a> - it is such a special utility for turning ZRF files into something more understandable for Dagaz.  Written in Java using the <a href="https://xml.apache.org/xalan-j/">Xalan</a> <a href="https://ru.wikipedia.org/wiki/XSLT">XSLT</a> processor: <br><br><pre> <code class="bash hljs">/usr/bin/java -classpath <span class="hljs-string"><span class="hljs-string">"./z2j.jar:./log4j-1.2.jar:./xalan-2.7.1.jar:./serializer-2.7.1.jar"</span></span> com.gluk.z2j.app.App ./twins.zrf</code> </pre><br>  After its launch, in the same directory where the ZRF file was located, two more files appear (you can not pay attention to the XML files, they are for debugging).  <a href="">The JavaScript</a> file contains everything needed to set up the model, and the <a href="https://github.com/GlukKazan/Dagaz/blob/master/src/debug/games/sliding-puzzles/twins.htm">html file</a> is created just for convenience.  It can be run. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6k7PqgwKCVA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  In principle, this entire part, with writing a ZRF file and translating it into JavaScript code, can be omitted by stuffing all the necessary settings with your hands, but you will have to fill in quite a lot and at the same time make a mistake.  I am thinking of creating a small library that supports the creation of the most common board configurations and move patterns.  If I do this, the ZRF file can not be written, limited to the development of JavaScript code. <br><br><h2>  <b>What is the result</b> </h2><br>  The approach I have chosen has proven to work.  The code is laid out under a free license, anyone can use it.  Intermediate creation of a ZRF file may seem redundant to someone, but for me, with my experience in developing applications for Zillions of Games, this is convenient.  However, I am working to make this step optional.  There are still a couple of important (and very complex) modules for launching board games and, of course, bots.  I am also working on it.  I'm not going to stop.  There <a href="https://github.com/GlukKazan/Dagaz/blob/master/doc/games.txt">are a lot of</a> board games.  Enough for a long time. <br></div><p>Source: <a href="https://habr.com/ru/post/327180/">https://habr.com/ru/post/327180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327168/index.html">Autonumber in four languages. Part 2</a></li>
<li><a href="../327170/index.html">Yii2-advanced: Flexible configuration of Yii2 RBAC (roles, permissions, rules)</a></li>
<li><a href="../327172/index.html">"SQL Server 2017": Now with Python support</a></li>
<li><a href="../327176/index.html">Dispelling the myths about the Qt meta-object compiler</a></li>
<li><a href="../327178/index.html">The digest of interesting materials for the mobile developer # 200 (April 17-23)</a></li>
<li><a href="../327182/index.html">Vulgarisms in mechanics: the harmfulness of the term "slowing down"</a></li>
<li><a href="../327184/index.html">Selenium in 60 seconds</a></li>
<li><a href="../327186/index.html">How it works in the java world. Concurrentmap</a></li>
<li><a href="../327190/index.html">Ways to debug JS on client</a></li>
<li><a href="../327192/index.html">The story of the creation and launch of a fun mobile game about breaking bottles on the head</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>