<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Increase web application stack security (LAMP virtualization)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="By the web application stack, we will mean a lot of open source software products: an operating system, a web server, a database server, and an execut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Increase web application stack security (LAMP virtualization)</h1><div class="post__text post__text-html js-mediator-article">  By the web application stack, we will mean a lot of open source software products: an operating system, a web server, a database server, and an executable code environment.  The most famous and common stack is LAMP.  This is an acronym for a stack of free open source web applications.  The name is composed of the first letters of the product included in it: <strong>Linux</strong> (operating system), <strong>Apache</strong> web <strong>server</strong> , <strong>MySQL database</strong> , and <strong>PHP</strong> (sometimes Perl or Python).  <a href="http://www.cyberciti.biz/tips/">Previously published</a> security <a href="http://www.cyberciti.biz/tips/">materials</a> recommend keeping various network services on dedicated servers or virtual machines for this purpose.  This will allow to isolate the elements of the system compromised and cracked by the attacker if the latter gets the opportunity to exploit errors in one of the links in the service network.  The article is also an answer to the questions most frequently asked by our readers, sent to us by e-mail.  In the guide, I will explain how to build a solution based on physical or virtual servers, equally suitable for distributing static and dynamic content for applications that require databases and caching. <a name="habracut"></a><br><blockquote>  <em>From the translator:</em> <br>  <em>The author of the original cycle of articles is extremely laconic and difficult to read.</em>  <em>We will try to keep it concise where it is possible and add explanations where the author himself doesn‚Äôt understand what he wants to say.</em>  <em>The translation allows for a number of deviations from the terms used in the professional environment and stable expressions.</em>  <em>The translator asks to show condescension to such cases in the form of personal messages if the found out makes it difficult to understand the text and exposes the ignorance of the writer.</em> </blockquote><br><br><br><h2>  LAMP: Typical and fractional installations </h2>  Most likely, your solution based on one dedicated or virtual server looks like this: <br><br><pre><code class="bash hljs">  /                  +-----------------------------------------+                | Apache + PHP / Perl @ 75.126.153.206:80 |                | Mysql@127.0.0.1: 3306 ( UNIX ) |                | Pgsql@127.0.0.1: 5432 ( UNIX ) |                | Netfilter           |                +-----------------------------------------+                  ***  LAMP  ***                  : RHEL/CentOS/Debian/Ubuntu/*BSD/Unix                   : 4-8GiB ECC                  :    Intel / AMD                  : RAID-1/5 - SATA/SAS</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What happens if, say, an Apache web server is compromised?  An attacker will gain access to your database, cache, and, as well, to other elements of the system or network.  In this case, you need to separate the server services as follows: <br><br><pre> <code class="bash hljs">////////////////////////// / / / //////////////////////////           \            \             ----------| vm00             75.126.153.206:80 - eth0             192.168.1.1       - eth1         +-----------------------------+         | -               |         |   (Firewall) |      eth0:192.168.1.10/vm01         +-----------------------------+     +----------------------+         |                                   | Lighttpd             |         +-----------------------------------+    |         |                                   | /var/www/static      |         |                                   +----------------------+         |         |                                    eth0:192.168.1.11/vm02         +-----------------------------------+-----------------------+         |                                   | Apache+php+perl+python|         |                                   | /var/www/html         |         |                                   +-----------------------+         |         |                                    eth0:192.168.1.12/vm03         +-----------------------------------+-----------------------+         |                                   | SQL              |         |                                   |Redis/Memcached  .. |         |                                   +-----------------------+         |         |                                   eth0:192.168.1.13/vm04         |                       (      RAID-10)         +-----------------------------------+------------------------+         |                                   | Mysql/pgsql    |         |                                   | @192.168.1.13:3306/5432|         |                                   +------------------------+         |         |                                   eth0:192.168.1.14/vm05         |    ( -    NFSv4   RAID-10)         +-----------------------------------+------------------------+                                             | NFSv4  Linux         |                                             | /<span class="hljs-built_in"><span class="hljs-built_in">export</span></span>/{static,html   |                                             +------------------------+</code> </pre><br><br>  Fractional installation has a number of advantages: <br><ul><li>  Security </li><li>  Scalability </li><li>  Optimization </li><li>  Ease of use </li><li>  Easy monitoring </li></ul><br>  Add to this advanced features from the High-availability area, such as failover (transfer of images / containers of fractional parts of the system to other resources due to the initial configuration of the <b>vm00</b> host system for similar network interaction [Virtual-IP at the <b>vm00</b> level]), load balancing CDNs are becoming much more convenient in the case of a similar system setup. <br><br><br><h2>  Roles of each virtual machine / server: </h2>  Below is detailed information on the appointment of machines.  A WordPress blog, a Drupal-based website, or a bespoke application hosted on such servers can easily serve millions of hits per month. <br><br><img src="https://habrastorage.org/storage2/fca/ccf/3a2/fcaccf3a2d166f7218f585077e45fe25.png"><br><br><br><h2>  How it works? </h2><br>  Let's see how our system works with a reverse proxy server.  In this example, I will place the proxy and HTTP server to the firewall.  (see fig. 1).  The website <a href="http://www.example.com/">www.example.com</a> will be hosted on a static IPv4-address <strong>202.54.1.1</strong> , which is assigned to the <strong>eth0</strong> device.  The internal IP <strong>192.168.1.1</strong> is assigned to the <strong>eth1</strong> device.  This is the node of our reverse proxy server.  The remaining servers are inside the local network and cannot be directly accessed via the Internet. <br><br><br><img src="https://habrastorage.org/storage2/418/a70/d7c/418a70d7cfe6241c677c61f229c73a91.png"><br><br>  The hardware or software (OpenBSD / Linux) firewall <strong>rules for</strong> host <strong>202.54.1.1</strong> allow access only to ports 80 and 443. All other ports are blocked.  Iptables also works on every VM node and access is allowed only to the required ports.  Your reverse proxy server defines a pool of HTTP servers as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">## - www.example.com ## upstream mybackend {      server 192.168.1.10:80; #server1      server 192.168.1.11:80; #server2      ....      ..      ..      server 192.168.1.100:80; # server100 }</span></span></code> </pre><br><br>  Apache and Lighttpd servers access files through an NFS server configured on <strong>vm05</strong> .  The Apache web server is configured to work with PHP.  Our PHP application is configured to connect to a database server hosted on <strong>vm04</strong> .  Our PHP application uses <strong>vm03</strong> as a SQL cache by using the <em>Memcached</em> server. <br><br>  Note: You can also place a <a href="http://www.cyberciti.biz/fa/linux-demilitarized-zone-howto">reverse proxy server on the DMZ</a> , and HTTP and other servers behind the firewall for increased security.  But it will increase the cost of the project. <br><br><br><h2>  Stop talking, show me the server setup process. </h2>  Most of the actions listed in this note are written with the assumption that they will be performed by the root user in the CentOS 6.x / Red Hat Enterprise Linux 6.x bash console.  However, you can easily copy the settings to any other * NIX-like operating systems. <br><br><ul><li>  <a href="http://habrahabr.ru/post/147864/">Prologue</a> </li><li>  <a href="http://habrahabr.ru/post/148004/">Step # 1: Setup / Installation: NFS File Server</a> </li><li>  <a href="http://habrahabr.ru/post/148077/">Step 2: Setup / Installation: MySQL Database Server</a> </li><li>  <a href="http://habrahabr.ru/post/148488/">Step 3: Configure / Install: Memcached Caching Server</a> </li><li>  <a href="http://habrahabr.ru/post/148489/">Step # 4: Setup / Installation: Apache + php5 web server application</a> </li><li>  <a href="http://habrahabr.ru/post/148490/">Step 5: Configure / Install: Lighttpd Web Server for Static Assets &lt;/ a</a> <br>  <a href="http://habrahabr.ru/post/148491/">Step 6: Setup / Installation: Nginx reverse (reverse) proxy server</a> <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/147864/">https://habr.com/ru/post/147864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147853/index.html">Overview of Twitter clients for Windows Phone 7</a></li>
<li><a href="../147854/index.html">Delta 3D Printer</a></li>
<li><a href="../147855/index.html">Thermoelectric batteries for low-power gadgets</a></li>
<li><a href="../147857/index.html">Multiple encryption using hash functions</a></li>
<li><a href="../147858/index.html">How to develop a technical task. Part 2. Types of work in the collection of requirements for the system of accounting and information for describing business processes</a></li>
<li><a href="../147865/index.html">New service to create collections of judicial practice</a></li>
<li><a href="../147866/index.html">Overview of Java / C ++ / C # / Delphi Programmers Salaries</a></li>
<li><a href="../147867/index.html">Droider Show # 49. All silent!</a></li>
<li><a href="../147868/index.html">How is UniSender better than MailChimp?</a></li>
<li><a href="../147869/index.html">20 services and tips for web developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>