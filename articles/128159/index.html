<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Symfony2 \ SecurityBundle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author talks about the Security bundle device (in my opinion, the most difficult thing to understand for symfony novices) and examines an example ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Symfony2 \ SecurityBundle</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage1/b23b84d7/686a94ec/c3c5b7d0/84f7c9f8.jpg" alt="Authentication and Authorization">  The author talks about the Security bundle device (in my opinion, the most difficult thing to understand for symfony novices) and examines an example of its use.  The article will be especially useful for those who want to know how their tool works: Symfony2 Security in general and FOSUserBundle in particular - however, it is not suitable for first acquaintance with the framework, because it requires knowledge of some of its components. <br>  The article was published on March 21, 2011, when the final version of symfony2.0 was not yet released, but the principles of the bundle did not change. <br><br>  <i>The original article, <a href="http://www.dobervich.com/2011/03/21/symfony2-blog-application-tutorial-part-v-intro-to-security/">Symfony2 Blog Application Tutorial Part V: Intro to Security,</a> is part of a series of tutorial articles on the example of creating a blog.</i> <i><br></i>  <i>There is a direct continuation / addition of the article - <a href="http://www.dobervich.com/2011/03/28/symfony2-blog-application-tutorial-part-v-2-testing-secure-pages/">‚ÄúSymfony2 Blog Application Tutorial Part V-2: Testing Secure Pages‚Äù</a> , which gives an example of testing the ‚Äúclosed‚Äù parts of the application.</i> <br><br><a name="habracut"></a><br><h4>  Article text </h4><br>  The Security component in symfony2 is very powerful and complex.  The example given below will be simple, but it should not be difficult for you to finish it to fit your needs.  In production versions of applications it is strongly recommended to use the FOSUserBundle bundle, which can be found <a href="https://github.com/FriendsOfSymfony/UserBundle">here</a> .  Its authors are among the developers of the Symfony2 core, and most likely the bundle will become something like ‚ÄúsfGuardPlugin‚Äù, only for the second version of the framework.  Those familiar with symfony1 will understand me.  Since people have problems with the bundle itself, I‚Äôll skip writing tests to speed up the process.  Maybe I'll write them later and update the post.  [ <b>Update:</b> I did it, see <a href="http://www.dobervich.com/2011/03/28/symfony2-blog-application-tutorial-part-v-2-testing-secure-pages/">here</a> .] 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, our goal is to require anyone who tries to go to the address starting with "/ admin /" to log in through the form.  For this we need to do a few things.  First you need to register the <i>SecurityBundle</i> that comes with Symfony2.  To do this, open <i>AppKernel.php</i> , located in the <i>app</i> directory, find the <i>registerBundles</i> method and add the following to the array with bundles: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Symfony\Bundle\SecurityBundle\SecurityBundle()</code> </pre> <br>  Now that the bundle is registered, you can get down to business, but before you start writing code, you need to understand the principles of how the Security component works in Symfony2.  Conventionally, it can be divided into three subcomponents: Users (Users), Authentication (Authentication) and Authorization (Authorization).  Users stores information about the user who works with the application.  Authentication checks to see if the user is who they are.  Authorization allows and prohibits an authenticated user from performing certain actions, for example, viewing any information, editing it, etc. <br><br>  Now we are ready to configure the security system in our application.  To do this, we specify in the Symfony2 configuration that we should use the <i>Company \ BlogBundle \ Entity \ User</i> entity that we created earlier as the User provider, and also determine how to encrypt passwords, which parts of the application should be protected and which roles the user should have to access them.  Open the <i>config.yml</i> file from the <i>app / config</i> directory and add the following: <br><br><pre> <code class="hljs pgsql">## <span class="hljs-keyword"><span class="hljs-keyword">Security</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>: encoders: Company\BlogBundle\Entity\<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>: algorithm: sha512 encode-<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>-base64: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> iterations: <span class="hljs-number"><span class="hljs-number">10</span></span> providers: main: entity: { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>: BlogBundle:<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>, property: username } firewalls: main: pattern: /.* form_login: check_path: /login_check login_path: /<span class="hljs-keyword"><span class="hljs-keyword">login</span></span> logout: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> anonymous: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> access_control: - { <span class="hljs-type"><span class="hljs-type">path</span></span>: /<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>/.*, <span class="hljs-keyword"><span class="hljs-keyword">role</span></span>: ROLE_ADMIN } - { <span class="hljs-type"><span class="hljs-type">path</span></span>: /.*, <span class="hljs-keyword"><span class="hljs-keyword">role</span></span>: IS_AUTHENTICATED_ANONYMOUSLY }</code> </pre><br>  Let us analyze each of the sections of this file.  In <i>encoders, it is</i> determined how user passwords will be encrypted for the <i>Company \ BlogBundle \ Entity \ User entity</i> .  We will use the <i>MessageDigestPasswordEncoder</i> supplied with Symfony2, but, of course, you can write your own encryptor.  (Note lane - the MessageDigestPasswordEncoder class is located in vendor / symfony / src / Symfony / Component / Security / Core / Encoder.) The following indicates that 10 passes through sha512 should be used as encryption and the result should be represented as a base64 string.  For more information about encoders, see <a href="http://symfony.com/doc/current/book/security.html">here</a> . <br><br>  The <i>providers</i> section defines where users should be retrieved from.  We selected the <i>Doctrine Entity Provider</i> and for this we specified the <i>entity</i> parameter.  Other allowed providers are <i>In-Memory Provider</i> and <i>Chain Provider</i> , which you can read about <a href="http://symfony.com/doc/current/book/security.html">here</a> .  In the <i>entity</i> line, you must specify the <i>class</i> and <i>property</i> properties.  <i>Class</i> points to a class with an entity representing the user.  In the example, this is the User class from the BlogBundle bundle.  <i>Property</i> is the name of a column of a table containing user names, and in this case, username. <br><br>  Authorization in Symfony2 is implemented through the Firewall system.  It consists of "listeners" (English listeners) who expect the <i>core.security</i> event and redirect the request, taking into account what rights the user has.  In the <i>firewalls</i> section, the route patterns (eng. Routes) are defined, on which it is necessary to hang ‚Äúlisteners‚Äù (eng. Listeners).  Today, to protect the application, it is recommended to specify one firewall that serves all routes, and then use the <i>access_control</i> section to allow or deny access depending on user roles.  In our example, in the <i>pattern</i> field of the firewalls section it is determined that it is necessary to ‚Äúlisten‚Äù to all routes.  The <i>form_login</i> field indicates that authentication will take place through the form.  For other authentication methods, see <a href="&amp;xid=17259,15700021,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhi3Fce3RxqRuzuLIMdJ6rhml1LCDw#basic-example-">here</a> .  Inside <i>form_login,</i> we have specified routes for the <i>login_path</i> (the location of the login form) and <i>check_path</i> (the location of the form handler).  In addition, <i>form_login</i> has many other settings that you can read about <a href="http://symfony.com/doc/current/book/security.html">here</a> . <br><br>  Finally, the last section is <i>access_control</i> .  Entries in it define the route patterns and roles needed to access them.  In our example, for routes that begin with "/ admin /", the role ROLE_ADMIN is required, for all others IS_AUTHENTICATED_ANONYMOUSLY is enough (in Symfony2, all users have this role by default). <br><br>  So, now that the security configuration file has been updated, we need to change the classes of our entity so that they implement the interfaces that SecurityBundle requires.  In our example, we need to add the <a href="http://api.symfony.com/2.0/Symfony/Component/Security/Core/User/UserInterface.html">UserInterface</a> interface implementation to the User <a href="http://api.symfony.com/2.0/Symfony/Component/Security/Core/User/UserInterface.html">entity</a> .  You also need to create a <i>Role</i> class that implements the <i>RoleInterface</i> interface.  After that, to upload new information to the database, we need to change our fixtures. <br><br>  Create a <i>Role.php</i> file in the <i>src / Company / BlogBundle / Entity</i> <i>directory</i> with the following contents: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Security</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">Role</span></span>\<span class="hljs-title"><span class="hljs-title">RoleInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(name="role") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Role</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoleInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="integer") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> integer $id */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="string", length="255") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string $name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $name; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="datetime", name="created_at") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> DateTime $createdAt */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $createdAt; <span class="hljs-comment"><span class="hljs-comment">/** *   id. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> integer The id. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string The name. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;name; } <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $value The name. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;name = $value; } <span class="hljs-comment"><span class="hljs-comment">/** *     . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> DateTime A DateTime object. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCreatedAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createdAt; } <span class="hljs-comment"><span class="hljs-comment">/** *   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createdAt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \DateTime(); } <span class="hljs-comment"><span class="hljs-comment">/** *  ,   RoleInterface. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string The role. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRole</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getName(); } }</code> </pre><br>  The essence of <i>Role is</i> pretty simple.  It has only one property - <i>name</i> , which contains the name of the role.  The class also implements the <i>RoleInterface</i> interface through the support for the <i>getRole</i> method, which returns the name of the role.  Now, after creating the <i>Role</i> class, you need to tweak the <i>User</i> entity.  Open the file <i>User.php</i> from <br>  <i>src / Company / BlogBundle / Entity</i> and change the code as follows: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Collections</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayCollection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Security</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>\<span class="hljs-title"><span class="hljs-title">UserInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(name="user") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... /** * @ORM\Column(type="string", length="255") * * @var string username */ protected $username; /** * @ORM\Column(type="string", length="255") * * @var string password */ protected $password; /** * @ORM\Column(type="string", length="255") * * @var string salt */ protected $salt; /** * @ORM\ManyToMany(targetEntity="Role") * @ORM\JoinTable(name="user_role", * joinColumns={@ORM\JoinColumn(name="user_id", referencedColumnName="id")}, * inverseJoinColumns={@ORM\JoinColumn(name="role_id", referencedColumnName="id")} * ) * * @var ArrayCollection $userRoles */ protected $userRoles; // ... /** *    . * * @return string The username. */ public function getUsername() { return $this-&gt;username; } /** *    . * * @param string $value The username. */ public function setUsername($value) { $this-&gt;username = $value; } /** *   . * * @return string The password. */ public function getPassword() { return $this-&gt;password; } /** *   . * * @param string $value The password. */ public function setPassword($value) { $this-&gt;password = $value; } /** *     . * * @return string The salt. */ public function getSalt() { return $this-&gt;salt; } /** *     . * * @param string $value The salt. */ public function setSalt($value) { $this-&gt;salt = $value; } /** *    . * * @return ArrayCollection A Doctrine ArrayCollection */ public function getUserRoles() { return $this-&gt;userRoles; } /** *   User */ public function __construct() { $this-&gt;posts = new ArrayCollection(); $this-&gt;userRoles = new ArrayCollection(); $this-&gt;createdAt = new \DateTime(); } /** *   . */ public function eraseCredentials() { } /** *    . * * @return array An array of Role objects */ public function getRoles() { return $this-&gt;getUserRoles()-&gt;toArray(); } /** *        *       . * * @param UserInterface $user The user * @return boolean True if equal, false othwerwise. */ public function equals(UserInterface $user) { return md5($this-&gt;getUsername()) == md5($user-&gt;getUsername()); } // ... }</span></span></code> </pre><br>  Those interested can download this class <a href="">here</a> .  As you can see, in the essence of <i>User,</i> there is nothing particularly complicated, just the implementation of the <i>UserInterface</i> interface and the creation of a many-to-many relationship with the <i>Role</i> entity.  There is also the <i>AdvancedUserInterface</i> interface, which provides more functionality, but its consideration is beyond the scope of this article.  You can read more about it <a href="http://api.symfony.com/2.0/Symfony/Component/Security/Core/User/AdvancedUserInterface.html">here</a> . <br><br>  Now you need to change the fixtures, with which we can update the information in the database.  Open the <i>FixtureLoader.php</i> file from the <i>src / Company / BlogBundle / DataFixtures / ORM</i> directory and make the following changes: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">DataFixtures</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">DataFixtures</span></span>\<span class="hljs-title"><span class="hljs-title">FixtureInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Category</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Tag</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Role</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Security</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">Encoder</span></span>\<span class="hljs-title"><span class="hljs-title">MessageDigestPasswordEncoder</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FixtureLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FixtureInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($manager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ROLE_ADMIN $role = new Role(); $role-&gt;setName('ROLE_ADMIN'); $manager-&gt;persist($role); //   $user = new User(); $user-&gt;setFirstName('John'); $user-&gt;setLastName('Doe'); $user-&gt;setEmail('john@example.com'); $user-&gt;setUsername('john.doe'); $user-&gt;setSalt(md5(time())); //      , //       $encoder = new MessageDigestPasswordEncoder('sha512', true, 10); $password = $encoder-&gt;encodePassword('admin', $user-&gt;getSalt()); $user-&gt;setPassword($password); $user-&gt;getUserRoles()-&gt;add($role); $manager-&gt;persist($user); // ... }</span></span></code> </pre><br>  Thus, a new role was created with the name ROLE_ADMIN.  A user has also been added with the username <i>john.doe</i> and an arbitrary password salt.  The only new functionality here is password encryption.  If you remember, in the <i>security.encoders</i> section of the configuration file we set up the use of <i>MessageDigestPasswordEncoder</i> .  Here we create an instance of this class and pass the same parameters into it as specified in <i>security.encoders</i> , then encrypt the admin password and set the result as the new password of the user being created.  When encrypting a password, you need to specify the same parameters as in the Security component configuration, because otherwise we will not be able to authenticate correctly. <br><br>  Before updating the routing and creating new controllers and views, you need to run several commands in the console.  Open the terminal and go to the root directory of our project.  First, we update the database structure to match the entities. <br><br><pre> <code class="bash hljs">php app/console doctrine:schema:update --force</code> </pre><br><br>  Next, clear the database and reload the information using the updated fixtures. <br><br><pre> <code class="bash hljs">php app/console doctrine:data:load</code> </pre><br>  At this stage we have installed and updated entities, data and security configuration.  Now let's proceed to changing the routing and creating several controllers and views to implement the login form.  Open the <i>routing.yml</i> file from the <i>src / Company / BlogBundle / Resources / config</i> directory and add the following routes to its <b>beginning</b> : <br><br><pre> <code class="hljs pgsql">_security_login: pattern: /<span class="hljs-keyword"><span class="hljs-keyword">login</span></span> defaults: { _controller: BlogBundle:<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">login</span></span> } _security_check: pattern: /login_check _security_logout: pattern: /logout admin_home: pattern: /<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>/ defaults: { _controller: BlogBundle:<span class="hljs-keyword"><span class="hljs-keyword">Admin</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> }</code> </pre><br>  By this we have added several special routes that will be used both by us and by the Security component.  You may have wondered why we did not define controllers for the two routes.  Remember that I wrote about the work of the Security component, waiting for the <i>core.security</i> event?  From this it follows that the controllers for these routes will never be executed, because the Security component intercepts requests and processes them itself.  Therefore, we can easily use the <i>_security_check</i> and <i>_security_logout routes</i> in our templates.  The <i>admin_home</i> route has also been added, which is the main page of the admin section of our application.  Since we specified in the <i>security.access_control</i> configuration section that only users with the ROLE_ADMIN role can access routes starting with "/ admin /", the admin_home route is protected.  Soon we will try to enter it. <br><br>  You probably noticed that we need to create two new controllers - <i>SecurityController</i> and <i>AdminController</i> , so let's get started.  Create a file in the <i>src / Company / BlogBundle / Controller</i> directory with the name <i>AdminController.php</i> and the following content: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdminController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'BlogBundle:Admin:index.html.twig'</span></span>); } }</code> </pre><br>  Nothing unusual.  Just processing the template <i>index.html.twig</i> , which we will now describe.  To do this, create a new <i>Admin</i> folder in the <i>src / Company / BlogBunde / Resources / views</i> directory, inside which we will create the <i>index.html.twig</i> file - the template for the main page of the admin section. <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "BlogBundle::layout.html.twig" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml"> symfony2  |  |  </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     , </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ app.user.username }}</span></span><span class="xml"><span class="xml">! </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  The only thing you should pay attention to is the variable template <i>app.user</i> , which allows you to access the current user in the application.  So, in our example, the <i>app.user</i> variable corresponds to an instance of the <i>Company \ BlogBundle \ Entity \ User</i> class. <br><br>  Now that we have secure pages, let's create a <i>SecurityController</i> controller.  To do this, create a <i>SecurityController.php</i> file in the <i>src / Company / BlogBundle / Controller</i> directory with the following content: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Company</span></span>\<span class="hljs-title"><span class="hljs-title">BlogBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Security</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">SecurityContext</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecurityController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loginAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'request'</span></span>)-&gt;attributes-&gt;has(SecurityContext::AUTHENTICATION_ERROR)) { $error = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'request'</span></span>)-&gt;attributes-&gt;get(SecurityContext::AUTHENTICATION_ERROR); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $error = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'request'</span></span>)-&gt;getSession()-&gt;get(SecurityContext::AUTHENTICATION_ERROR); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'BlogBundle:Security:login.html.twig'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'last_username'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'request'</span></span>)-&gt;getSession()-&gt;get(SecurityContext::LAST_USERNAME), <span class="hljs-string"><span class="hljs-string">'error'</span></span> =&gt; $error )); } }</code> </pre><br>  We created a <i>loginAction</i> action that corresponds to the <i>_security_login</i> route.  Inside it is checked for errors and then the <i>login.html.twig</i> template is given as an answer.  Checking for errors may seem a bit strange, but in fact we are only trying to find out how we got into this action - by direct link or were redirected.  Depending on this, we get the generated exception. <br><br>  The Security component assumes all verification of user credentials, however we must create a template that accepts certain parameters.  In order for the Security component to validate the data correctly, it is necessary that the form has the <i>_username</i> and <i>_password fields</i> and is also bound to the <i>_security_check</i> route.  Let's do this by creating a <i>Security</i> folder in the <i>src / Company / BlogBunde / Resources / views</i> directory, in which, in turn, we will create a <i>login.html.twig</i> file with the following content: <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "BlogBundle::layout.html.twig" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"><span class="xml"> symfony2  |  </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> error %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ error.message }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path('_security_check') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">:</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"_username"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ last_username }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">:</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"_password"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"login"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br>  Everything should be clear here.  When sending data from a form on the <i>_security_check</i> route, the <i>Security</i> component will intercept the request and authenticate itself.  After successful authentication, the user will be redirected to the original address, otherwise - to the page with the login form. <br><br>  Now let's create a "Logout" link that will only be shown to logged in users.  Open the file <i>layout.html.twig</i> in the <i>src / Company / BlogBundle / Resources / views</i> <i>directory</i> and make the following changes: <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">// ... </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> body %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">header</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"clearfix"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> symfony2  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path('show_page', { 'page' : 'about' }) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> is_granted('IS_AUTHENTICATED_FULLY') %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path('_security_logout') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">nav</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">header</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> // ...</span></span></code> </pre><br>  We used the twig <i>is_granted</i> function to test the user for a particular role.  In our example, this is the IS_AUTHENTICATED_FULLY role ‚Äî a special role assigned to users authenticated by the Security component.  If the user has this role, then add a link to the <i>_security_logout</i> route created above in the navigation menu. <br><br>  Now, in principle, we can test our secure page, but before that, let's clear the cache.  For this there is a console command: <br><br><pre> <code class="bash hljs">php app/console cache:clear</code> </pre><br>  Now try to login to "/ admin /".  You should be redirected to a page with a login form that looks something like this (click to enlarge): <br><br> <a href=""><img src="http://habrastorage.org/storage1/37c6e3ce/35691e86/2a347f77/4c6a853e.png"><br></a> <br>  Enter <i>john.doe</i> in the "Login" field and <i>admin</i> in the "Password" field.  After you send the credentials, you should be redirected to the main page of the administrator section, which looks something like this (click to enlarge): <br><br> <a href=""><img src="http://habrastorage.org/storage1/ccd4db51/a38ec7ab/8bf812e7/8445a5e9.png"><br></a> <br>  Also in the menu with navigation should appear link "Exit".  If you go through it, then we will be transferred to the main page of the application, and at the same time we will break up.  Fuh!  You did a great job!  For my part, I put a lot of effort into this article and went a long way of trial and error!  As a result, we have a protected section of the application and the corresponding route prefix (comment. - "/ admin / *").  Once again, in production versions of applications, it is strongly recommended to use the FOSUserBundle, which is much more functional than what we have created in this article.  I hope that everything was written clearly, but if something still needs additional explanations, then let me know. <br><br><h4>  From translator </h4><br>  Under this topic, it is useful to read <a href="http://symfony.com/doc/current/book/security.html">the Security section of</a> official documentation.  The articles from the Cookbook: <a href="http://symfony.com/doc/current/cookbook/security/acl.html">Access Control Lists (ACLs)</a> and <a href="http://symfony.com/doc/current/cookbook/security/acl_advanced.html">Advanced ACL Concepts</a> deserve special attention. <br><br>  I collect information about what was or is not clear in Symfony2 for you personally, as well as links to good articles about Symfony2.0 (preferably written after the release of the framework).  We will raise the rating of habrablog Symfony Frameworks together! <br><br>  The book of complaints and suggestions for the translation itself is here - <a href="https://habrahabr.ru/users/pluseg/" class="user_link">pluseg</a> .  I will be glad to any review! </div><p>Source: <a href="https://habr.com/ru/post/128159/">https://habr.com/ru/post/128159/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128149/index.html">Keyweb.ru is once again hanging. Where to go?</a></li>
<li><a href="../128150/index.html">How long have you been in the project (taking part in the project)?</a></li>
<li><a href="../128156/index.html">Addition to ASP.NET MVC localization - We use routing</a></li>
<li><a href="../128157/index.html">Creation of another casual game on a Flash platform with physics. Part II</a></li>
<li><a href="../128158/index.html">The principle of operation of the digital compass</a></li>
<li><a href="../128161/index.html">HowTo cook custom Firefox msi for enterprise deployment</a></li>
<li><a href="../128162/index.html">Does the network challenge you?</a></li>
<li><a href="../128164/index.html">Lazy webapp loading</a></li>
<li><a href="../128165/index.html">A small review of the laptop Asus K43Sv</a></li>
<li><a href="../128167/index.html">"Typesquatters" collected 20 GB of someone else's correspondence</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>