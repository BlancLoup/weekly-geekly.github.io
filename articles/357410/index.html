<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex.Pochty security issues (as well as traffic and Connect)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi GT! I read the MikhailNsk post , and my brain transferred me to 2016, where I accidentally stumbled upon a problem with the substitution of address...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex.Pochty security issues (as well as traffic and Connect)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/78d/2ad/c57/78d2adc57fd949e589c7b16dd501b1e7.gif" alt="image" align="left">  Hi GT!  I read <a href="https://geektimes.ru/post/291929/">the</a> <a href="https://geektimes.ru/users/mikhailnsk/" class="user_link">MikhailNsk</a> <a href="https://geektimes.ru/post/291929/">post</a> , and my brain transferred me to 2016, where I accidentally stumbled upon a problem with the substitution of addresses in Yandex.Mail.  The threat itself is that, from the point of view, the letters DMARC and SPF are fully valid.  Not only Mail users are subject to this, but also organizations that use Yandex.PDD and Yandex.Connect as a mailer with their domain (for example, this is everyone‚Äôs well-known and everywhere advertised Mailovsky GeekBrains), and this is much more serious.  The vulnerability is currently working, the letter passes all checks and is delivered anywhere (including GMAIL).  Implementation and the reaction of Yandex under the cut. <br><br><blockquote>  <b>Attention!</b>  <b>The following vulnerability replay algorithm is provided for educational purposes only!</b> </blockquote><a name="habracut"></a><br><h3>  Implementing Vulnerability </h3><br>  The very essence is very simple, Yandex allows you to log in with one address, and send it from any other where the DMARC and SPF of the Yandex rules are written, and the letter is signed with the valid DKIM signature yandex.ru. <br><br>  To implement, we need a mailbox on Yandex and a third-party mail client (my choice fell on an open and functional Thunderbird). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We fasten our mailbox from Yandex to the latter, open the window for sending a letter <br><br><img src="https://habrastorage.org/web/766/622/567/7666225674824fa7b31df57e515196f2.jpg"><br><br>  Change the sender's address to the one we need (in our case, to i@yandex.ru) <br><br><img src="https://habrastorage.org/web/0a9/1f5/9a1/0a91f59a1e1146ce84735114e25618e0.jpg"><br><br>  And send the letter somewhere <br><br><img src="https://habrastorage.org/web/3ba/2ed/e40/3ba2ede4025b42e6b3bd3f3fbac2a541.jpg"><br><br>  To the Google Mail (as well as to any other) letter came normally.  Google shows the card that all good: <br><br><img src="https://habrastorage.org/web/cac/25d/138/cac25d13829b4d1291e0664901dff8de.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Letter source</b> <div class="spoiler_text"><code>Delivered-To: @gmail.com <br> Received: by 10.31.164.6 with SMTP id n6csp2248696vke; <br> Thu, 10 Aug 2017 09:17:13 -0700 (PDT) <br> X-Received: by 10.46.33.9 with SMTP id h9mr3821349ljh.52.1502381833140; <br> Thu, 10 Aug 2017 09:17:13 -0700 (PDT) <br> ARC-Seal: i=1; a=rsa-sha256; t=1502381833; cv=none; <br> d=google.com; s=arc-20160816; <br> b=CM0dF4giYDl9jToC/17FjHIeiQNsfFaDUxcYErv/RAHKrX+8PIdx0QabF/kUMVelug <br> ESNfNVYYv09sIrZsYSgqnmKlVdPbQYkmr0mSE+oZ2cjIhebKQcfQjKARk+6LLFOrtNSb <br> M1O014IAXh+y+ykx2EEyhyWir1y+SWItjS2ukNN19t9GwY91hjFtd+0T2OQDvC44qjpW <br> ztHKTCTNne0+NhMRYg2iSL0uQZkkpeUNNKgkRavCJRKgnjtMOuLqtx0uNLfZex34XcBl <br> vtZTfThoUeuzBPmHVVnnE+W8lcLoqTG2/jr4C4E4VNDHrjUCsDecNNfGYf5/BajX45n0 <br> BdsQ== <br> ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816; <br> h=content-language:content-transfer-encoding:mime-version:user-agent <br> :date:message-id:subject:from:to:dkim-signature:dkim-signature <br> :arc-authentication-results; <br> bh=AOjHaT+yDXpmJsW3LSDugt7u95YQzsSxsGi10r66W3Y=; <br> b=Edjq07PU+c0nie1ia60SrVoI219rb8q/OnUJMtf0tJrFPktG29Pqs4fx7E3DsNvH6l <br> PPdsJVsvHDl3nIWqVSASAXaTPELSAXYETQ/zuluD+wrR2n7MXNt8QQ8cUqt7Zae8Wkq2 <br> Yr3cW+9Ty3VZEi2TzqRzOU3UNNhds+UHa8o6/LK3N7NN91INYevsNnrfMBSUvqm6HmMi <br> AJ7dHkkwqqKX7XNkIvKNVjyq8FhnVfMiow8N/PCsVqtTly+q825p5kOl3hxqbLMsi3ix <br> AL3MGC84U/m8+dvivNege5yDby/Dfp6uY6jHJL/hOVmmUwT1/y2F+5SD/ifuS4EX2gI7 <br> geLg== <br> ARC-Authentication-Results: i=1; mx.google.com; <br> dkim=pass header.i=@yandex.ru header.s=mail header.b=T2n/cJmZ; <br> dkim=pass header.i=@yandex.ru header.s=mail header.b=T2n/cJmZ; <br> spf=pass (google.com: domain of 42@yandex.ru designates 37.140.190.181 as permitted sender) smtp.mailfrom=42@yandex.ru; <br> dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=yandex.ru <br> Return-Path: &lt;42@yandex.ru&gt; <br> Received: from forward101o.mail.yandex.net (forward101o.mail.yandex.net. [37.140.190.181]) <br> by mx.google.com with ESMTPS id 128si582786lfz.671.2017.08.10.09.17.12 <br> for &lt;@gmail.com&gt; <br> (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128); <br> Thu, 10 Aug 2017 09:17:13 -0700 (PDT) <br> Received-SPF: pass (google.com: domain of 42@yandex.ru designates 37.140.190.181 as permitted sender) client-ip=37.140.190.181; <br> Authentication-Results: mx.google.com; <br> dkim=pass header.i=@yandex.ru header.s=mail header.b=T2n/cJmZ; <br> dkim=pass header.i=@yandex.ru header.s=mail header.b=T2n/cJmZ; <br> spf=pass (google.com: domain of 42@yandex.ru designates 37.140.190.181 as permitted sender) smtp.mailfrom=42@yandex.ru; <br> dmarc=pass (p=NONE sp=NONE dis=NONE) header.from=yandex.ru <br> Received: from mxback1o.mail.yandex.net (mxback1o.mail.yandex.net [IPv6:2a02:6b8:0:1a2d::1b]) <br> by forward101o.mail.yandex.net (Yandex) with ESMTP id 919D813416EA <br> for &lt;@gmail.com&gt;; Thu, 10 Aug 2017 19:17:12 +0300 (MSK) <br> Received: from smtp1o.mail.yandex.net (smtp1o.mail.yandex.net [2a02:6b8:0:1a2d::25]) <br> by mxback1o.mail.yandex.net (nwsmtp/Yandex) with ESMTP id 3IjaA941Wl-HCe4hwWw; <br> Thu, 10 Aug 2017 19:17:12 +0300 <br> DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yandex.ru; s=mail; t=1502381832; <br> bh=AOjHaT+yDXpmJsW3LSDugt7u95YQzsSxsGi10r66W3Y=; <br> h=To:From:Subject:Message-ID:Date; <br> b=T2n/cJmZ2jEcX5rX5exetDc2VfT1lhVgPkMXfbIFAmw8PE6iLFkdddO7f67IRKfrb <br> KNV7U5whs9PUhGRd0S2x5OULF8VC3QXMSEvXJiM5gSxZdbNNNq2GRDpTkxbJiDASDT <br> A2DYgoRtpFzN64wX4EnSEmya/D24mP43VOi2TlAc= <br> Received: by smtp1o.mail.yandex.net (nwsmtp/Yandex) with ESMTPSA id i5ALruo2pE-HC4WKA0l; <br> Thu, 10 Aug 2017 19:17:12 +0300 <br> (using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits)) <br> (Client certificate not present) <br> DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=yandex.ru; s=mail; t=1502381832; <br> bh=AOjHaT+yDXpmJsW3LSDugt7u95YQzsSxsGi10r66W3Y=; <br> h=To:From:Subject:Message-ID:Date; <br> b=T2n/cJmZ2jEcX5rX5exetDc2VfT1lhVgPkMXfbIFAmw8PE6iLFkdddO7f67IRKfrb <br> KNV7U5whs9PUhGRd0S2x5OULF8VC3QXMSEvXJiM5gSxZdbNNNq2GRDpTkxbJiDASDT <br> A2DYgoRtpFzN64wX4EnSEmya/D24mP43VOi2TlAc= <br> Authentication-Results: smtp1o.mail.yandex.net; dkim=pass header.i=@yandex.ru <br> To: @gmail.com <br> From: Habratest &lt;i@yandex.ru&gt; <br> Subject: Test fot Habr <br> Message-ID: &lt;48942373-b6c4-d019-a15f-6aeaeeda39df@yandex.ru&gt; <br> Date: Thu, 10 Aug 2017 21:17:10 +0500 <br> User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 <br> Thunderbird/52.2.1 <br> MIME-Version: 1.0 <br> Content-Type: text/plain; charset=utf-8; format=flowed <br> Content-Transfer-Encoding: 7bit <br> Content-Language: en-US <br> <br> Hbrahabrahabrahabrahabrahabrahabrahabrahabrahabrahabrahabrahabra <br></code> <br>  The recipient's address was replaced with <code>@gmail.com</code> , the real address was <code>42@yandex.ru</code> <br></div></div><br><h3>  Morality and the answer of Yandex </h3><br>  This vulnerability creates tremendous opportunities for social engineering.  In this way, you can use addresses, for example, GeekBrains, which uses traffic rules for traffic (or Connect). <br>  DKIM check gives a pass, but the domain is specified by Yandex (even use a different mail domain). <br><br>  Naturally, I immediately wrote about this to Yandex‚Äôs Yandex Buhunter last summer and <br>  got the answer: <br><br><img src="https://habrastorage.org/web/909/958/ade/909958ade8c7465c8767ab648d9f0f97.jpg"><br><br>  Before me, the vulnerability was sent to them on June 27, 2016.  Those.  For a year, Yandex failed to fix a fairly serious (in my opinion) vulnerability that could affect the security of Yandex partners who use their mailer. <br><br>  <b>UPD:</b> there is a way to mask the sender address.  To do this, it is enough to buy a more or less similar domain, screw the traffic regulations to it and send letters from it.  The address is replaced in the same way, all checks are valid, and the DKIM signature and the sender's address will be from the new domain. <br><br>  By the way, mail.ru and gmail are not affected.  GeekBrains, I'm sorry, but I only know you, among those who use Yandex services, because you have burned an avatar. </div><p>Source: <a href="https://habr.com/ru/post/357410/">https://habr.com/ru/post/357410/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357400/index.html">The British Interior Minister said that real people do not need encryption</a></li>
<li><a href="../357402/index.html">Published base with 320 million unique passwords (5.5 GB)</a></li>
<li><a href="../357404/index.html">The thieves of the new series "Game of thrones" demanded a ransom from the HBO channel</a></li>
<li><a href="../357406/index.html">NIST finally changes password recommendations: now long passphrases are recommended</a></li>
<li><a href="../357408/index.html">Mail.ru Mail Security Issues</a></li>
<li><a href="../357412/index.html">Should employees talk about social engineering?</a></li>
<li><a href="../357414/index.html">The state will take control of the critical infrastructure of the Runet</a></li>
<li><a href="../357416/index.html">Account gosuslugi.ru and FZ-152</a></li>
<li><a href="../357418/index.html">And once again about 320 million passwords</a></li>
<li><a href="../357420/index.html">How will execute the law banning Tor, VPN and anonymizers in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>