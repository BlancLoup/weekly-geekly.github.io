<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúShaw, again?‚Äù Or hacking transport Citycard (Nizhny Novgorod)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I hasten to warn readers: This article is written only for information, and in no way calls to engage in fake travel tickets, as this contradicts arti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúShaw, again?‚Äù Or hacking transport Citycard (Nizhny Novgorod)</h1><div class="post__text post__text-html js-mediator-article">  I hasten to warn readers: <b><font color="red">This article is written only for information, and in no way calls to engage in fake travel tickets, as this contradicts article 327 of the Criminal Code of the Russian Federation.</font></b>  <b><font color="red">The author is not responsible for any illegal actions committed by people using the information from this article.</font></b> <br><br>  I am an ordinary girl, relatively recently working in the field of IT, I have no knowledge of hacking and hacking.  But inspired by articles on Habr√© about hacking the <a href="https://habrahabr.ru/post/301832/">Troika</a> and <a href="https://habrahabr.ru/post/324040/">Plantain</a> transport cards (which are no longer available, the authors of <a href="https://habrahabr.ru/users/ammonia/" class="user_link">Ammonia</a> and <a href="https://habrahabr.ru/users/antoo/" class="user_link">antoo</a> ), I decided to tell you about my own experience of hacking <a href="http://siticard.ru/">Citicart</a> transport cards that operate in Nizhny Novgorod. <br><br><img src="https://habrastorage.org/files/aa7/bef/c18/aa7befc1854e496a9b1ec2f821b80b25.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I‚Äôll say right away that I‚Äôm not a hacker and not a cracker, but a simple front-end developer, my knowledge of working with PCs, if we discard knowledge in front-end development, can be described as an ‚Äúexperienced user‚Äù. <br><br>  I did not develop special applications, as the authors of the mentioned articles did, but I will show you how you can easily hack transport maps with affordable means.  <a href="https://www.cs.bham.ac.uk/~garciaf/publications/Talk.Mifare.pdf">Hacking methods</a> have been known for a long time (years 5-7 exactly). <br><br>  If I, as a developer, used the old versions of frameworks with known vulnerabilities, I would have long lost my employer head, but this, in my opinion, does not apply to transport system developers.  Perhaps this is due to the low knowledge of the developers themselves. <br><br>  But back to hacking.  So, first things first. <br><a name="habracut"></a><br>  I carried out all the actions I described last fall, but as far as I know, everything works now. <br><br>  So, I have an inexpensive smartphone with NFC.  I once bought Citycard transport cards (it turned out that I had several of them ‚Äî sometimes I forgot the card at home or at work and I had to buy a new one). <br><br><img src="https://habrastorage.org/files/884/579/b99/884579b996614dc988c63791d0df5608.jpg"><br><br>  I downloaded the official app of the Mifare <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.nxp.taginfolite">NXP Taginfo</a> card <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.nxp.taginfolite">maker</a> and scanned my shipping card: <br><br><img src="https://habrastorage.org/files/f8d/5b0/a20/f8d5b0a208324766951f0b19611a01cd.png"><br><br>  It turned out that the card is based on the Mifare Plus S chip, but most importantly, it works in security mode No. 1. And this means that in essence it is a simple Mifare Classic card that is easily cracked. <br><br>  I downloaded the wonderful <a href="https://play.google.com/store/apps/details%3Fid%3Dde.syss.MifareClassicTool">Mifare Classic Tool</a> application on Google Play and scanned the transport map with standard keys: <br><br><img src="https://habrastorage.org/files/bd5/7ce/2b0/bd57ce2b02fe408f8f9922598fac2cda.png"><br><br>  Here I was disappointed - none of the well-known keys came up.  Accordingly, it was not possible to use hacking in the manner described in the article on ‚ÄúPlantain‚Äù. <br>  ‚ÄúWait a minute,‚Äù I thought, ‚Äúbut you can try the method as described in the Troika hacking article. <br><br>  Indeed, Citicard also has an <a href="https://play.google.com/store/apps/details%3Fid%3Dru.novacard.siticard">application</a> from Google Play, which allows you to check the balance of the card, and subsequently screwed up the opportunity and replenish the card. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/840/505/324/84050532474a4a6fa72fc6ce5f57d6f0.jpg"></div><br>  I downloaded and installed this application.  But now I have a dilemma: the keys to the card are protected either in the application itself, or ‚Äúarrive‚Äù from the server.  Decompiling Android applications is simple enough, but I don't understand this very well. <br><br>  Surely, a more or less intelligent developer can do this quite easily.  I did not possess such skills and turned to my brother, who is engaged in repair of intercoms, I thought he had a familiar programmer, but he suggested a more elegant and simple solution. <br><br>  By that time, he had received a <a href="https://www.kickstarter.com/projects/1980078555/chameleonmini-a-versatile-nfc-card-emulator-and-mo">fee from Kickstarter</a> , which allows him to peek at the protocol between the reader and the card.  It turns out that they began to use key chains in intercoms, inside which the same Mifare chip was sewn up, and he needed this board for some cases related to these key chains (I did not go into details). <br><br>  So, he took his fee, put it to my smartphone, which acted as a reader, and the transport card itself acted as a card, and removed the data exchange log between the reader and the card. <br><br>  Then the question arose what to do with the received log.  But a short search on the Internet led to a utility called crapto1gui.  Links will not lead, it is easy enough and so. <br><br>  I provide the screenshot of the utility below (taken from one of the sites on the Internet, so the data there is not real, which we used). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/956/f5e/e39/956f5ee397714cca931f1a40ca610048.jpg"></div><br>  In general, it is enough to insert the necessary chunks of the log into this utility and the 6-byte key is instantly calculated.  I myself was surprised how easy it was, the most difficult thing was to copy the necessary parts from the log and paste them into the appropriate fields of the program. <br><br>  Then I opened the Mifare Classic Tool (MCT) application too, inserted the received key into the application, and this time the contents of the 0th and 8th sectors were displayed to me. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2a8/7df/f78/2a87dff78ef2491f80cf1b906ca622f0.png"></div><br>  In the zero sector, basically there were only zeros, but in the eighth there were some data, from which I concluded that the data on the transport card are stored in the 8th sector (as in the Troika card, is it really the same the developer?), and the resulting key was the key B (the sector has two keys A and B). <br><br>  Further, for the sake of interest, I received with the help of the open-source utility <a href="http://nfc-tools.org/index.php%3Ftitle%3DLibnfc">libnfc</a> and the reader of contactless cards and all the other keys to the card (for more information, see the article on ‚ÄúPlantain‚Äù - I also used this method. It is also described on libnfc). <br><br>  Using the obtained keys, I tried to read the contents of another transport card.  It turned out that key A was the same, but key B was not.  But with the help of the mentioned utility it also turned out to be easy to get. <br><br>  Then I began to explore the contents of the transport card.  The 8th sector consists of 4 blocks of 16 bytes each.  With the help of MCT, it became clear that the first block is the so-called.  Value block.  First of all, the thought came that the balance of the card is stored in this block.  With the help of MCT, it was possible to decode it - it contained the number 2147483647. It clearly did not look like the balance of the card, even if it was in kopecks. <br><br>  Then I toured this map and, after reading the contents of the sector, I discovered that the value had not changed, but the contents of the other blocks had changed.  From which it was concluded that the card balance is stored in them. <br><br>  There was no special desire to parse the contents of the map, because I wanted to try the so-called replay attack (I later learned what it was called correctly). <br><br>  In the morning before the trip to the subway, I saved the contents of the eighth sector, put a map to the turnstile and went to work.  In the afternoon, having gone on business, with the help of MCT, I recorded the previous state of the map and tried to drive the subway ... And I did it! <br><br><img src="https://habrastorage.org/files/7dc/a62/978/7dca629788fe4856b6731126e6554fab.jpg"><br>  <i>(the picture is not mine - I didn‚Äôt want to attract attention at all)</i> <br><br>  So I realized that this way you can do the "eternal travel card".  I decided to play around a bit and wrote down the contents of the transport card sector on the intercom keychain. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/35d/69d/f19/35d69df192b54d89ad182324ebb5e9f2.jpg"></div><br>  <i>(I used the same key ring to write a transport card to it)</i> <br><br>  I tried to go through the turnstile, putting the key fob, but then I was disappointed - the key fob, to my surprise, did not work.  I thought that my transport card was blocked (after all, the key fob was its clone), but when I applied the ‚Äúoriginal‚Äù (transport card) I managed to get through the turnstile. <br><br>  I talked to my brother, wanted to find out what he thinks about this, and he told me that each card and keychain has its own identification number.  Apparently, my ‚Äúclone‚Äù was not complete, and the content in the map was somehow tied to its number. <br><br>  But it turned out that there was a way out of this situation: there are some types of key chains that look exactly the same, but they can change their number (conventional transport cards will not do this).  Moreover, MCT has such a function of rewriting a number, since it is stored in the first block of the zero sector. <br><br>  True, for some reason, changing the number using MCT did not work.  But it turned out to do this with the help of a reader and all the same libnfc. <br><br>  This time I had a complete clone of the transport card in the form of a keychain, because even the number was the same.  I tried to go through the turnstile on the intercom keychain, and I did it easily.  I did not dare to put a key on the bus, because the aunt could have been very surprised, but the ‚Äúeternal‚Äù transport card worked without any problems. <br><br>  So, summing up, we can say the following: transport cards for fare payment in Nizhny Novgorod are just as easily cracked as <a href="https://habrahabr.ru/post/301832/">Troika</a> (Moscow) and <a href="https://habrahabr.ru/post/324040/">Podorozhnik</a> (St. Petersburg). <br><br>  Even I, a girl, not having special knowledge, but able to download Android applications and use Google and Yandex search, was able to do it using available tools and programs and utilities available in the public domain (if I were a developer, it would probably be even easier , although it‚Äôs much easier ...) Yes, it took me some time to search the Internet and study the forums, but everything turned out to be very simple. <br><br>  I want to note right away, anticipating the questions that no damage was caused to the metro - I took into account all the trips made on the ‚Äúperpetual travel card‚Äù, so the balance on the map did not spend the corresponding sum of such trips, and then destroyed the map itself. <br><br>  But after all, the attackers are not so conscious, for sure they use this vulnerability and damage the urban transport.  We receive regularly increasing fares (perhaps due to losses due to fake transport cards).  By the way, the deposit for the transport card is 50 rubles.  But exactly the same security cards Mifare Classic <a href="http://inlay.su/index.php%3Farea%3D19">cost</a> 12.5 rubles and below. <br><br>  One gets the feeling that all transport systems where transport cards are used are unsafe.  I do not want to argue why this is happening (this topic is not for Habr), it remains only to ask the question: who (which city) is next and when to wait for this article on Habr? <br><br>  PS This story, of course, invented.  All characters are fictional, all coincidences are random.  Well, you get the idea ... </div><p>Source: <a href="https://habr.com/ru/post/325776/">https://habr.com/ru/post/325776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325760/index.html">CSS Grid Layout. Fast start</a></li>
<li><a href="../325762/index.html">As in Dodo Pizza, we lost 8 million in one hour due to a technical error, and then returned</a></li>
<li><a href="../325764/index.html">Meta development tool: FutoIn CID</a></li>
<li><a href="../325770/index.html">Parametric modeling in CAD SolveSpace: Degrees of freedom and constraint equations</a></li>
<li><a href="../325772/index.html">Interfaces of the aggregator of tours: what we have done and where we need the help of Habr</a></li>
<li><a href="../325778/index.html">Life programmers</a></li>
<li><a href="../325780/index.html">How to find 56 potential vulnerabilities in FreeBSD code in one evening</a></li>
<li><a href="../325782/index.html">The book "Programming in Python"</a></li>
<li><a href="../325784/index.html">Web application security: practical cases</a></li>
<li><a href="../325786/index.html">Why we created a replacement for the old document search systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>