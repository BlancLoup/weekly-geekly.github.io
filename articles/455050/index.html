<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Oracle Database for Technical Market Analysis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is about Oracle Database, PL / SQL, SQL, MATCH_RECOGNIZE, MODEL clause, aggregate and pipelined functions. 

 The technical analysis (TA)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Oracle Database for Technical Market Analysis</h1><div class="post__text post__text-html js-mediator-article">  This article is about Oracle Database, PL / SQL, SQL, MATCH_RECOGNIZE, MODEL clause, aggregate and pipelined functions. <br><br>  The technical analysis (TA) of the markets was used as a functional area.  First, a small superficial introduction to trade in the markets, then - calculations. <br><br>  Technical analysis - a set of tools to predict the likely price changes based on patterns of price changes in the past.  Theoretically, Technical Analysis is applicable in any market.  But Technical analysis is most prevalent in highly liquid free markets, for example, on the stock exchanges. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/webt/yv/iz/zq/yvizzqt9vdlwyfbdtpsupx4anhq.jpeg" alt="image"></div><br>  Many SQL statements, procedures, and schedules have been developed.  Part - below, fully code - on GitHub at the link at the bottom of the article. <br><a name="habracut"></a><br>  Technical Market Indicators (TIR) ‚Äã‚Äã- additional charts to price charts, <em>formed on the basis of recalculation of the values ‚Äã‚Äãcontained in the basic price chart</em> .  Usually, these are different types of averaging (the next point of the chart is calculated as the average value of a certain number of previous price values, for example, a moving average), relations (the next point is the result of comparing a certain number of previous prices - their difference derived from the change over a period), or lags ( delays).  Indicators clearly show some non-obvious information contained in the statistics of price changes, and can form recommendations about trade orders - BUY / SELL.  Indicators have at least one variable parameter, the value of which will change the result.  <em>For the opening of real transactions are usually used several indicators in the complex, plus additional information, at the discretion of the trader.</em> <br><br>  One of the technical analysis postulates is ‚Äúhistory repeats itself‚Äù: Market participants behave in approximately the same way in similar circumstances, forming a similar dynamics of price changes.  And it is natural to assume that the market behavior in the future will basically repeat the patterns that have emerged in the past.  Following this statement, the investor can choose from the possible parameters of TIR those that have best proven themselves in previous periods. <br><br>  This article builds a graph of trading performance when using each indicator from the value of the TIR parameter, it is in a two-dimensional representation.  But in fact, I will build in a three-dimensional representation in order to evaluate also the effect of the delay in executing an order on the result, so the parameter will be the X axis (abscissa), the delay will be the Y axis (ordinate), and the result will be the Z axis (applicate).  This is some attempt to assess the influence of ‚Äúslippage‚Äù, which, unfortunately, always happen.  Instead of a real ‚Äúslippage‚Äù along the Y axis, I postpone the execution of the BUY / SELL order for a period of 1 to 5 periods. <br><br>  If a global maximum stands out on this graph and the graph itself looks like a hat (in general, this is called ‚Äúnormal distribution‚Äù, but it assumes strict symmetry about the vertical axis), the cone, pyramid are also suitable - this means that TIR can pick up a certain value of the parameter , which will show the highest result, and with this indicator you can try to trade.  If the performance graph, depending on the parameter, will resemble a ‚Äúpalisade‚Äù - it is impossible to choose the optimal parameter value and there is no point in using this <abbr title="Technical Market Indicator">TIR</abbr> in trade. <br><br>  <em>It can be said that in this article I count only the ‚Äúpercent hit‚Äù of the indicators.</em>  <em>The task, to estimate how much you can ‚Äúearn‚Äù, was not solved by me.</em> <br><br>  <strong>Successful completion of the described test is one of the necessary, but not sufficient factors for effective trading.</strong> <br><br>  For information ... In contrast to Technical Analysis, Fundamental Analysis (FA) is a term for designating methods for predicting the market (exchange) value of instruments based on an analysis of financial and operating performance indicators. <br>  The ‚Äúinternal value‚Äù of <abbr title="Fundamental analysis">FA</abbr> in most cases does not coincide with the price of the company's shares, which is determined by the ratio of supply and demand in the stock market.  Investors using <abbr title="Fundamental analysis">FA</abbr> in their activities are primarily interested in situations where the ‚Äúintrinsic value‚Äù of a company's shares exceeds the price of shares on an exchange.  Such stocks are considered undervalued, so their price will rise, and they are potential investment targets. <br><br>  One of the most well-known investors using Fundamental Analysis is Warren Buffett. <br><br>  Watch the trailer: <a href="https://www.youtube.com/watch%3Fv%3DSqE8fnvmV1Y">https://www.youtube.com/watch?v=SqE8fnvmV1Y</a> <br><br>  Thus, we have two diametrically opposite approaches - <abbr title="Technical analysis">TA</abbr> and <abbr title="Fundamental analysis">FA</abbr> . <br>  <abbr title="Fundamental analysis">FA is</abbr> usually interested in long-term investors, TA - short- and medium-term and is used for speculative transactions, when the trader does not interest the trading item itself. <br><br>  And the goals of this article are two ... <br><br>  In addition to the above reasoning about <abbr title="Technical analysis">TA</abbr> and <abbr title="Fundamental analysis">FA,</abbr> I <em>wanted to explore and show the capabilities of the Oracle Database to perform calculations of Technical Market Indicators</em> . <br>  I present these opportunities to the readers. <br><br>  If you decide to repeat my calculations - download the code from GitHub at the link at the bottom of the article.  Code tested on version 12.2.0.1. <br><br>  First create shared objects.  The first are the tables and view.  In the same file below - the transaction modeling package. <br><br>  The second step is to create functions that perform <abbr title="Technical Market Indicator">TIR</abbr> calculations. <br><br>  The third step is the calculations. <br><br>  All functions for calculating all <abbr title="Technical Market Indicator">TIRs</abbr> will return a cursor with the following fields: STOCK_NAME, ADATE, ACLOSE (daily closing price), AACTION (order to sell / buy) <br><br>  The package contains three table modeling functions that take the cursor from the <abbr title="Technical Market Indicator">TIR</abbr> calculation functions described above, offset (delay in execution of the order, lag), and initial capital, the default is 1000 USD.  Package functions are called like this: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> HABR_TRADEMODELLING_P.TRADE_LOG (<span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, ACLOSE, AACTION <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> (HABR_MARKETINDEXES_XXXXXXXX_F_CALC (<span class="hljs-number"><span class="hljs-number">10</span></span>))), p_lag =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> HABR_TRADEMODELLING_P.CALC_ACTIONS (<span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, ACLOSE, AACTION <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> (HABR_MARKETINDEXES_XXXXXXXX_F_CALC (<span class="hljs-number"><span class="hljs-number">10</span></span>))), p_lag =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> HABR_TRADEMODELLING_P.CALC_ACTIONS_TOTALS (<span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, ACLOSE, AACTION <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> (HABR_MARKETINDEXES_XXXXXXXX_F_CALC (<span class="hljs-number"><span class="hljs-number">10</span></span>))), p_lag =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  where XXXXXXXX is the name of <abbr title="Technical Market Indicator">TIR</abbr> . <br><br>  <strong>All functions calculate the result of trade subject to complete reinvestment of profits, excluding transaction costs and taxes, and excluding inflation and discounting.</strong> <br><br>  The first function <code>TRADE_LOG</code> forms a simplified trades transaction log.  The function allows you to trace the entire chain of transactions.  If at the end of the period the investor is ‚Äúin securities‚Äù, to calculate the balance in a currency (financial result), the function simulates the sale of all securities at the latest closing price and forms the corresponding mark in the IN_STOCK field. <br><br>  The second function <code>CALC_ACTIONS</code> returns the same columns as the called <abbr title="Technical Market Indicator">TIR</abbr> calculation cursor, plus adds the following columns: <code>AACTION_LAG</code> (order with offset), <code>BALANCE_CURRENCY</code> (trader‚Äôs account balance in cash), <code>BALANCE_STOCK</code> (number of tools in open positions).  Depending on the value of the <code>AACTION_LAG</code> field, buying or selling at the closing price is simulated, and the currency balance and the amount of open positions change accordingly. <br><br>  In the last line of each instrument you can see the result of trading for each instrument, as well as in the previous function, if the investor is ‚Äúin securities‚Äù, the sale is simulated to calculate the balance in foreign currency <br><br>  The third function, <code>CALC_ACTIONS_TOTALS</code> does the same thing as the second, but returns only the last line ‚Äî the result of trading for each instrument.  It will be used in the simulation. <br><br><h3>  Download data </h3><br>  Calculations are given for such markets and indices: S &amp; P500, NYSE, Brent, BTCUSD, EURUSD. <br>  The first 4 are downloaded from Yahoo Finance, the last from another source.  Calculation results for courses from other sources may vary. <br><br>  Please note that the course periods of each instrument differ, namely: <br><br><ul><li>  S &amp; P500 - 03/01/1950 ... 29/01/2019, 69 years; </li><li>  NYSE - 31/12/1965 ... 22/03/2019, 54; </li><li>  Brent - 17/05/1991‚Ä¶ 06/02/2019, 28 years old; </li><li>  BTCUSD - 16/07/2010 ... 29/01/2019, 9 years; </li><li>  EURUSD - 16/02/2001‚Ä¶ 27/05/2019, 18 years old. </li></ul><br>  Therefore, it is impossible to compare the achieved profitability of tools with each other, but you can compare the profitability of each of the tools when using different indicators. <br><br>  The file for loading (SQL * Loader) can also be taken from GitHub via the link at the bottom of the article. <br><br><h3>  Moving averages </h3><br>  There are at least three basic types of moving averages: <br><br><ul><li>  linear (Simple Moving Average, SMA), </li><li>  exponential (Exponential Moving Average, EMA) and </li><li>  linear weighted (Weighted Moving Average, WMA). </li></ul><br>  They differ in the weights of their constituents.  For linear moving average weights are equal, for exponential and linearly weighted weights decrease as the component moves away from the right edge of the window - exponentially or linearly. <br><br>  The linear moving average is the easiest to calculate.  In Oracle, this function is <code>avg (VALUE) over (partition by STOCK_NAME order by ADATE rows between 9 preceding and current row)</code> - a moving average with an averaging window size of 10 values. <br><br>  The linear moving average has disadvantages.  First, such averages slow to respond to market reversals.  Since many values ‚Äã‚Äãare averaged, each of which is given equal weight, the average reaction often occurs after several timeframes after the price reversal of the asset. <br><br>  Also, the linear moving average is not very effective because it responds to the signal twice: when the indicator entered the sliding window and left it.  The rest react only to the input of the indicator and smoothly deduce it as it moves from the right edge of the window to the left. <br><br>  All three types of moving averages are used in <abbr title="Technical Market Indicator">TIR</abbr> calculations.  For the exponential and linearly weighted in this article developed the aggregate functions of <code>EMA</code> and <code>WMA</code> , which are used in analytical form.  In addition, these moving averages can be calculated by recursion or a model (the phrase <code>MODEL</code> ). <br><br>  Calculation of EMA and WMA, without recursion or model, alone by analytics, in the Oracle Database, apparently, is impossible. <br><br>  But more reservations about moving averages: <br><br><ul><li>  the shorter the averaging period and the more sensitively the method reacts to reversals, the more it gives false signals; </li><li>  the shorter the averaging period, the more signals are generated, the more transaction overhead, which can be very significant. </li></ul><br><h2>  Technical Market Indicators </h2><br>  For almost every indicator, several calculation methods will be given: CALC - calculation using PL / SQL code, SIMP - calculation by one operator or RECU - calculation by recursion, AGRF - calculation using the aggregate function, MODE - calculation by modelka. <br><br>  There are reasons for developing multiple methods.  First, by calculating the <abbr title="Technical Market Indicator">TIR by</abbr> several methods and comparing the indicators, if the indicators are the same, you can be sure that the calculations were carried out correctly (taking into account different methods of rounding and processing the NULL and ‚Äú0‚Äù values).  In this article I will compare the hashes of samples of different methods, so match up to a bit and the same processing by all algorithms is guaranteed. <br><br>  I suppose, in Oracle, it is necessary to begin the development of <abbr title="Technical Market Indicator">TIR</abbr> with the SIMP method - calculation by one operator.  When this is done, the orakloid has a plan and calculation algorithm in its head, and it can be easily shifted to PL / SQL or to another procedural language. <br><br>  I note that the method of calculating CALC on PL / SQL here turns out to be faster than the SIMP method (by one operator) in the event that the entire calculation can be performed in one pass through the cursor.  But if for the calculation it is necessary to form temporary tables or collections, or more than 1 pass on the cursor, I suppose the ‚Äúone operator‚Äù method will turn out to be faster and less resource-intensive. <br><br>  For all methods, including the SIMP method (‚Äúone operator‚Äù), I will place the operators in functions, so that the calculation can be called with a parameter to select the optimal value. <br><br>  Calculations are given for seven <abbr title="Technical Market Indicator">TIR</abbr> : Intersection of the moving average (EMASIMPLE), ‚ÄúGolden‚Äù and ‚ÄúDeadly crosses (CROSSES), Balance volume (OBV), Keltner Channel (KELTNER), Price and Volume Trend (PVT), Arms Lightness Indicator (EMV ) Commodity Channel Index (CCI). <br><br>  For the seven indicators of these two articles there will be one parameter ‚Äúaveraging window size‚Äù, and the second parameter will be the shift (lag).  The shift says how many bars to postpone the execution of the order BUY / SELL - how many bars to shift the closing price (all orders are made at the closing price of the bar).  This is similar to ‚Äúslippage‚Äù, but it is not exactly ‚Äúslipping.‚Äù  Slippage is usually not in favor of the client, and our lag can be both in favor of the client and in favor.  However, the use of modeling with a lag of 1 to 5 bars for some indicators shows that slippage has a significant effect on the result.  And for some indicators, lag and slippage are not so important. <br><br>  In the SIMP (‚Äúone operator‚Äù) and RECU (‚Äúrecursion‚Äù) <code>MATCH_RECOGNIZE</code> , the phrase <code>MATCH_RECOGNIZE</code> actively used to generate the BUY / SELL trading signal based on the entry / exit of the calculated <abbr title="Technical Market Indicator">TIR</abbr> to a specified range or its behavior relative to its moving average. <br><br>  <em>Detailed descriptions of all <abbr title="Technical Market Indicator">TIRs</abbr> can be found in Wikipedia or in Robert Colby's book, Encyclopedia of Technical Indicators of the Market.</em> <br><br><h3>  Intersection of exponential moving average </h3><br>  The method of intersection of exponential moving averages is the simplest <abbr title="Technical Market Indicator">TIR</abbr> . <br><br>  The method involves: buying (opening a long position) if the price value crosses its exponential moving average (ESS) from bottom to top;  selling (closing a long position) if the price crosses its ESS from top to bottom. <br><br>  Short positions, as well as margin trading in general, are not considered in this article. <br><br>  In the future, this indicator can be used as a benchmark for comparison with others.  A comparison with this <abbr title="Technical Market Indicator">TIR is</abbr> better than a comparison with the Buy and Hold strategy, because this strategy is not profitable in falling markets. <br><br>  The only parameter <abbr title="Technical Market Indicator">TIR</abbr> - the length of the moving average. <br><br>  Calculate with PL / SQL <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> HABR_MARKETINDEXES_EMASIMPLE_F_CALC (p_averaging_window_width <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HABR_MARKETINDEXES_RESULT_LIST_T <span class="hljs-keyword"><span class="hljs-keyword">pipelined</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> l_result HABR_MARKETINDEXES_RESULT_LIST_T; EMA number; prev_EMA number; prev_TYPICAL_PRICE number; retval HABR_MARKETINDEXES_RESULT_T := HABR_MARKETINDEXES_RESULT_T (null, null, null, null, null, null, null, null, null); prev_STOCK_NAME varchar2(256); l_alpha number; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> l_alpha := <span class="hljs-number"><span class="hljs-number">2</span></span> / (p_averaging_window_width + <span class="hljs-number"><span class="hljs-number">1</span></span>); for c1 in (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, TYPICAL_PRICE, ACLOSE <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> LOAD_YAHOO_V <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> retval.ADATE := c1.ADATE; retval.ACLOSE := c1.ACLOSE; if prev_STOCK_NAME is null or prev_STOCK_NAME &lt;&gt; c1.STOCK_NAME then retval.STOCK_NAME := c1.STOCK_NAME; EMA := c1.TYPICAL_PRICE; prev_EMA := null; else EMA := round (c1.TYPICAL_PRICE * l_alpha + EMA * (1 - l_alpha), 20); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; if prev_TYPICAL_PRICE &lt; prev_EMA and c1.TYPICAL_PRICE &gt; EMA then retval.AACTION := 'BUY'; elsif prev_TYPICAL_PRICE &gt; prev_EMA and c1.TYPICAL_PRICE &lt; EMA then retval.AACTION := 'SELL'; else retval.AACTION := null; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; retval.IND_VALUE := EMA; pipe row (retval); prev_STOCK_NAME := c1.STOCK_NAME; prev_EMA := EMA; prev_TYPICAL_PRICE := c1.TYPICAL_PRICE; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><br>  Calculation by one recursive operator <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> HABR_MARKETINDEXES_EMASIMPLE_F_RECU (p_averaging_window_width <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HABR_MARKETINDEXES_RESULT_LIST_T <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> l_result HABR_MARKETINDEXES_RESULT_LIST_T; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> T1 (STOCK_NAME, ADATE, TYPICAL_PRICE, EMA, ACLOSE, RN) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, TYPICAL_PRICE, <span class="hljs-keyword"><span class="hljs-keyword">round</span></span> (TYPICAL_PRICE, <span class="hljs-number"><span class="hljs-number">20</span></span>), ACLOSE, RN <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> LOAD_YAHOO_V <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> RN = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> b.STOCK_NAME , b.ADATE , b.TYPICAL_PRICE , <span class="hljs-keyword"><span class="hljs-keyword">round</span></span> (b.TYPICAL_PRICE * <span class="hljs-number"><span class="hljs-number">2</span></span> / (p_averaging_window_width + <span class="hljs-number"><span class="hljs-number">1</span></span>) + a.EMA * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> / (p_averaging_window_width + <span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">20</span></span>) , b.ACLOSE , b.RN <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> T1 a, LOAD_YAHOO_V b <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> b.RN = a.RN + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> b.STOCK_NAME = a.STOCK_NAME) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> HABR_MARKETINDEXES_RESULT_T (STOCK_NAME, ADATE, ACLOSE, EMA, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, AACTION) <span class="hljs-keyword"><span class="hljs-keyword">bulk</span></span> <span class="hljs-keyword"><span class="hljs-keyword">collect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> l_result <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> T1 match_recognize (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> STOCK_NAME <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ADATE <span class="hljs-keyword"><span class="hljs-keyword">measures</span></span> classifier() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AACTION all <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> per <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> unmatched <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> pattern (BUY+ | SELL+) <span class="hljs-keyword"><span class="hljs-keyword">define</span></span> BUY <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (prev (TYPICAL_PRICE) &lt; prev (EMA) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TYPICAL_PRICE &gt; EMA) , SELL <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (prev (TYPICAL_PRICE) &gt; prev (EMA) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TYPICAL_PRICE &lt; EMA) ) MR; return l_result; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><br>  Calculation using the phrase MODEL <br><div class="spoiler">  <b class="spoiler_title">Function text HABR_MARKETINDEXES_EMASIMPLE_F_MODE</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> HABR_MARKETINDEXES_EMASIMPLE_F_MODE (p_averaging_window_width <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HABR_MARKETINDEXES_RESULT_LIST_T <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> l_result HABR_MARKETINDEXES_RESULT_LIST_T; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> T1 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> LOAD_YAHOO_V <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dimension</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> (STOCK_NAME, RN) <span class="hljs-keyword"><span class="hljs-keyword">measures</span></span> (ADATE, TYPICAL_PRICE, ACLOSE, to_number(<span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EMA) <span class="hljs-keyword"><span class="hljs-keyword">rules</span></span> (EMA[<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">round</span></span> (TYPICAL_PRICE [cv(), cv()] * <span class="hljs-number"><span class="hljs-number">2</span></span> / (p_averaging_window_width + <span class="hljs-number"><span class="hljs-number">1</span></span>) + nvl(EMA [cv(), cv() - <span class="hljs-number"><span class="hljs-number">1</span></span>], TYPICAL_PRICE [cv(), cv()]) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> / (p_averaging_window_width + <span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">20</span></span>))) , T2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, ACLOSE , TYPICAL_PRICE, LAG (TYPICAL_PRICE) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> STOCK_NAME <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ADATE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PREV_TYPICAL_PRICE , EMA, lag (EMA) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> STOCK_NAME <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ADATE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PREV_EMA <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> T1) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> HABR_MARKETINDEXES_RESULT_T (STOCK_NAME, ADATE, ACLOSE, EMA, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> prev_TYPICAL_PRICE &lt; prev_EMA <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TYPICAL_PRICE &gt; EMA <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'BUY'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> prev_TYPICAL_PRICE &gt; prev_EMA <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TYPICAL_PRICE &lt; EMA <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'SELL'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">bulk</span></span> <span class="hljs-keyword"><span class="hljs-keyword">collect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> l_result <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> T2 <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> STOCK_NAME, ADATE; return l_result; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br></div></div><br><br>  Calculation using the aggregate function <br><div class="spoiler">  <b class="spoiler_title">EMA aggregate text and HABR_MARKETINDEXES_EMASIMPLE_F_AGRF function</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> EMA_DATA_T <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> (AVALUE <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, AVERAGING_WINDOW <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> EMA_IMPL_T <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> ( l_window_width <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, l_ema <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> ODCIAggregateInitialize (sctx <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> EMA_IMPL_T) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">member</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> ODCIAggregateIterate (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> EMA_IMPL_T, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> EMA_DATA_T) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">member</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> ODCIAggregateMerge (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> EMA_IMPL_T, ctx2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> EMA_IMPL_T) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">member</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> ODCIAggregateTerminate (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> EMA_IMPL_T, returnValue <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>, flags <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">body</span></span> EMA_IMPL_T <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> ODCIAggregateInitialize (sctx <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> EMA_IMPL_T) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> sctx := EMA_IMPL_T (<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); return ODCIConst.Success; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; member function ODCIAggregateIterate (self in out EMA_IMPL_T, value in EMA_DATA_T) return number is <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value.AVALUE <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_window_width <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> l_window_width := value.AVERAGING_WINDOW; self.l_ema := value.AVALUE; else self.l_ema := round (value.AVALUE * 2 / (l_window_width + 1) + self.l_ema * (1 - 2 / (l_window_width + 1)), 20); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; return ODCIConst.Success; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; member function ODCIAggregateMerge(self in out EMA_IMPL_T, ctx2 in EMA_IMPL_T) return number is <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ODCIConst.Error; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; member function ODCIAggregateTerminate(self in EMA_IMPL_T, returnValue out number, flags in number) return number is <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> returnValue := self.l_ema; return ODCIConst.Success; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> EMA (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> EMA_DATA_T) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">number</span></span> <span class="hljs-keyword"><span class="hljs-keyword">aggregate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EMA_IMPL_T; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> HABR_MARKETINDEXES_EMASIMPLE_F_AGRF (p_averaging_window_width <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HABR_MARKETINDEXES_RESULT_LIST_T <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> l_result HABR_MARKETINDEXES_RESULT_LIST_T; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> T1 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> STOCK_NAME, ADATE, TYPICAL_PRICE, ACLOSE , <span class="hljs-keyword"><span class="hljs-keyword">round</span></span> (EMA (EMA_DATA_T (TYPICAL_PRICE, p_averaging_window_width)) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> STOCK_NAME <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ADATE), <span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> EMA <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> LOAD_YAHOO_V) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> HABR_MARKETINDEXES_RESULT_T (STOCK_NAME, ADATE, ACLOSE, EMA, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, AACTION) <span class="hljs-keyword"><span class="hljs-keyword">bulk</span></span> <span class="hljs-keyword"><span class="hljs-keyword">collect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> l_result <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> T1 match_recognize (<span class="hljs-keyword"><span class="hljs-keyword">partition</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> STOCK_NAME <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ADATE <span class="hljs-keyword"><span class="hljs-keyword">measures</span></span> classifier() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AACTION all <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> per <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> unmatched <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> pattern (BUY+ | SELL+) <span class="hljs-keyword"><span class="hljs-keyword">define</span></span> BUY <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (prev (TYPICAL_PRICE) &lt; prev (EMA) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TYPICAL_PRICE &gt; EMA) , SELL <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (prev (TYPICAL_PRICE) &gt; prev (EMA) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TYPICAL_PRICE &lt; EMA) ) MR; return l_result; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br></div></div><br><br>  Let's compare the calculation results with one parameter: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN_VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ALG, dbms_sqlhash.gethash (<span class="hljs-keyword"><span class="hljs-keyword">COLUMN_VALUE</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> RECORDSET_HASH <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> (sys.odcivarchar2list (<span class="hljs-string"><span class="hljs-string">'select * from table (HABR_MARKETINDEXES_EMASIMPLE_F_CALC (15)) order by 1, 2'</span></span> , <span class="hljs-string"><span class="hljs-string">'select * from table (HABR_MARKETINDEXES_EMASIMPLE_F_RECU (15)) order by 1, 2'</span></span> , <span class="hljs-string"><span class="hljs-string">'select * from table (HABR_MARKETINDEXES_EMASIMPLE_F_MODE (15)) order by 1, 2'</span></span> , <span class="hljs-string"><span class="hljs-string">'select * from table (HABR_MARKETINDEXES_EMASIMPLE_F_AGRF (15)) order by 1, 2'</span></span>));</code> </pre> <br>  All hashes must match for all four methods. <br><br>  If the hashes do not converge, you can figure out exactly where the discrepancy arose with such an operator (substitute the names of the functions to be compared): <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span> (a.STOCK_NAME, b.STOCK_NAME) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> STOCK_NAME, <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span> (a.ADATE, b.ADATE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ADATE , a.ACLOSE <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CALC_ACLOSE, b.ACLOSE <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AGRF_CLOSE , a.IND_VALUE <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CALC_EMA, b.IND_VALUE <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AGRF_EMA , a.AACTION <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CALC_AACTION, b.AACTION <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AGRF_AACTION <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> (HABR_MARKETINDEXES_EMASIMPLE_F_CALC (<span class="hljs-number"><span class="hljs-number">15</span></span>)) a <span class="hljs-keyword"><span class="hljs-keyword">full</span></span> <span class="hljs-keyword"><span class="hljs-keyword">outer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> (HABR_MARKETINDEXES_EMASIMPLE_F_AGRF (<span class="hljs-number"><span class="hljs-number">15</span></span>)) b <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> a.STOCK_NAME = b.STOCK_NAME <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> a.ADATE = b.ADATE <span class="hljs-comment"><span class="hljs-comment">--where sys_op_map_nonnull (a.ACLOSE) &lt;&gt; sys_op_map_nonnull (b.ACLOSE) -- or sys_op_map_nonnull (a.IND_VALUE) &lt;&gt; sys_op_map_nonnull (b.IND_VALUE) -- or sys_op_map_nonnull (a.AACTION) &lt;&gt; sys_op_map_nonnull (b.AACTION) order by 1, 2; ;</span></span></code> </pre> <br>  <b>Selection of parameters</b> <br><br>  The <abbr title="Technical Market Indicator">TIR</abbr> itself uses one parameter; for this and for all the other <abbr title="Technical Market Indicator">TIRs,</abbr> I change it in the range from 1 to 200, but to calculate the three-dimensional image for the dependency and on the lag too, we will enter the second parameter, which will vary from 1 to 5. <br><br>  The operator opens 200 * 5 = 1000 cursors, so you may need to change the Oracle <a href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/OPEN_CURSORS.html">OPEN_CURSORS</a> parameter <br><br>  The query below performs a Cartesian product of a table with numbers from 1 to 200, with a table with numbers from 1 to 5, and Cartesian multiplies all this by calling the table function <code>HABR_TRADEMODELLING_P.CALC_ACTIONS_TOTALS</code> . <br><br>  By some further manipulations in MATLAB, we next obtain a 200 * 5 matrix, where in the cells of the matrix there will be the total capital value for each value of each of the two parameters.  Next in MATLAB build a three-dimensional image. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> HABR_MARKETINDEXES_PARMSEL_RESULTS <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> INDICATOR_NAME = <span class="hljs-string"><span class="hljs-string">'HABR_MARKETINDEXES_EMASIMPLE_F_CALC'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> HABR_MARKETINDEXES_PARMSEL_RESULTS (INDICATOR_NAME, PARM1, PARM2, STOCK_NAME, ADATE_MIN, ADATE_MAX, DEALS_COUNT, BALANCE_RESULT, DEALS_PROFIT_AMOUNT, DEALS_LOSS_AMOUNT, DEALS_PROFIT_COUNT, DEALS_LOSS_COUNT, IN_STOCK) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> TP1 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PARM1 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= &amp;&amp;AVERAGING_INTERVAL) , TP2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PARM2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= &amp;&amp;LAG_MODELLING_DEPTH) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-comment"><span class="hljs-comment">--+ parallel(8) 'HABR_MARKETINDEXES_EMASIMPLE_F_CALC', PARM1, PARM2, STOCK_NAME, ADATE_MIN, ADATE_MAX, DEALS_COUNT, BALANCE_RESULT, DEALS_PROFIT_AMOUNT, DEALS_LOSS_AMOUNT, DEALS_PROFIT_COUNT, DEALS_LOSS_COUNT, IN_STOCK from TP1 cross join TP2 cross join table (HABR_TRADEMODELLING_P.CALC_ACTIONS_TOTALS (cursor (select STOCK_NAME, ADATE, ACLOSE, AACTION from table (HABR_MARKETINDEXES_EMASIMPLE_F_CALC (PARM1))), PARM2)) ; commit;</span></span></code> </pre> <br>  All calculations in this article are performed slowly, up to 20 minutes, this is due to the discovery of a large number of cursors. <br><br>  I developed a faster simulation method with one cursor, without opening 1000 cursors, but it is so voluminous that it would take half of the article.  Therefore, I will not bring him here. <br><br>  The result of the simulation of the moving average intersection (all graphs are clickable): <br> <a href=""><img src="https://habrastorage.org/webt/my/i8/1f/myi81fz9phsezv_f_igu2eic4ie.jpeg"><br></a> <br><br>  The second line of graphs is the same as the first line, but the graphs are slightly rotated, the graphs with different lags are arranged one after the other.  This allows you to evaluate the effect of lag on the result. <br><br>  In general, the indicator is not very sensitive to lags.  For the S &amp; P500 and NYSE markets, the <abbr title="Technical Market Indicator">TIR</abbr> parameter should be chosen the more the better.  For the Brent market, it is around 25. In the other two markets, there is no correlation between profitability and a parameter. <br><br><h3>  Deadly and Golden Crosses </h3><br>  In the implementation on Oracle, this indicator is very similar to the previous one, only here two moving averages are used, and not one.  Therefore, I will give only one version of the calculation. <br><br>  The Wiki describes the Ishimoku Indicator.  This is a complex indicator.  "Crosses" are one of the components.  But the indicator is described on the wiki badly, in particular, note that the lines Tenkan and Kijun are described in completely different words, although in essence they are one and the same, but with different periods. <br><br>  In the book by Robert Colby, this indicator is also not described. <br><br>  Japanese analysts call the crossing of the medium when the short-term average crosses the long-term from the bottom up, the Golden Cross (Golden Cross), and the opposite situation, when the short-term moving average crosses the long-term from the top to the bottom - the Dead cross (Dead Cross). <br><br>  The author drew attention to the fact that this indicator is described in the article <a href="https://www.rbc.ru/economics/23/11/2018/5bf80c8b9a7947c90d40d639">‚ÄúFutures for American oil formed a‚Äú deadly cross ‚Äù‚Äù</a> and began to google its description and use. <br><br>  This indicator is considered serious in the stock market, in part because it rarely signals. <br><br>  The most commonly used are 50 and 200 period moving averages. <br><br>  When modeling the performance below, we will take a period of a long moving average equal to four times a short moving average, and simulate a short length from 1 to 200 days (from 4 to 800 days for a long). <br><br>  The code for calculating on GitHub. <br><br> <a href=""><img src="https://habrastorage.org/webt/7s/1a/c_/7s1ac_u_9vclmx2xelqzod7jvyi.png"></a> <br><br>  The indicator is not very sensitive to lags.  For the S &amp; P500 market, there are highs at 48 (192 for the long SS) and 98 days (392 for the long SS).  Note that the first maximum is very close to the numbers 50x200.  It can be assumed that if this option is selected by 1 and 2 less than other market participants, you can try to beat them on this indicator alone. <br><br>  On the NYSE 4 maximum.  The indicator does not work in the Brent and BTCUSD markets. <br>  For the EURUSD market, too, the parameter should be chosen a little less than 50 for a short CC.  But the indicator does not give profit in this market.  It can only be used as an additional indicator. <br><br><h3>  Balance Volume, Equilibrium Volume, On-Balance Volume (OBV) </h3><br>  The OBV indicator is a cumulative moving average of trading volume, taken with a plus sign in the case of a growing market and with a minus sign in the case of a falling one. <br><br>  Here, this method of interpreting the indicator values ‚Äã‚Äãwill be used: buy when OBV crosses its moving average from bottom to top, sell when OBV crosses its moving average from top to bottom. <br><br>  Read more on <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25BB%25D0%25B0%25D0%25BD%25D1%2581%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25BE%25D0%25B1%25D1%258A%25D1%2591%25D0%25BC">Wiki</a> or Colby. <br><br> <a href=""><img src="https://habrastorage.org/webt/rl/w1/fa/rlw1farsmtyjs7duejp1eao6e1u.png"></a> <br><br>  In the S &amp; P500 market, the indicator is very sensitive to delays (lags), but you can try to choose the parameter according to the principle ‚Äúthe more the better‚Äù, some profit is achieved.  In the NYSE market, profitability cannot be achieved.  In the Brent market, you can select a parameter value from 20 to 100. There is no clear linear relationship in the BTCUSD market, but it is not advisable to choose a parameter value less than 40.  For the EURUSD market, the parameter value should be chosen ‚Äúthe more, the better‚Äù, but profitability cannot be achieved. <br><br><h3>  Keltner Channel, Keltner Channel </h3><br> <abbr title="  "></abbr>          ,           .      . <br><br>          . <br><br>           ,       . <br><br>     <abbr title="  "></abbr>   : ,     , ,    . <br><br> <a href=""><img src="https://habrastorage.org/webt/_h/25/ls/_h25lsxaqle9wda7rehrzncb4ei.png"></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are highs for the S &amp; P500 and NYSE markets. </font><font style="vertical-align: inherit;">In the Brent market, there is no dependence of the result on the parameter, and all trade is at a loss. </font><font style="vertical-align: inherit;">There are highs on the BTCUSD market, but they are narrow and difficult to hit. </font><font style="vertical-align: inherit;">In the EURUSD market, the dependence of the result on the parameter is.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Trend of price and volume, Trend of price and volume, Price ‚Äì Volume Trend, PVT </font></font></h3><br>   PVT               . <br><br>        : ,  PVT     -, ,  PVT     -. <br><br>   <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B5%25D0%25BD%25D0%25B4_%25D1%2586%25D0%25B5%25D0%25BD%25D1%258B_%25D0%25B8_%25D0%25BE%25D0%25B1%25D1%258A%25D1%2591%25D0%25BC%25D0%25B0"></a> .    . <br><br> <a href=""><img src="https://habrastorage.org/webt/d9/5q/ay/d95qay3lujgc3dplp4rgkorrgyq.png"></a> <br><br>   S&amp;P500   ¬´ ,  ¬ª,  NYSE   ,  Brent     50,  BTCUSD      , 1-2,     ,  50-,  EURUSD  . <br><br><h3>  ,    , Arms' Ease of Movement Value, EMV </h3><br> <abbr title="  "></abbr> EMV ‚Äî    ,      .          ,      . <br><br>      : ,    EMV   , ,    EMV   . <br><br>   <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D1%2591%25D0%25B3%25D0%25BA%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_%25D0%25B4%25D0%25B2%25D0%25B8%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F"></a>   . <br><br> <a href=""><img src="https://habrastorage.org/webt/3o/9r/yk/3o9ryk2ufl7fh-xi7t755zughpq.png"></a> <br><br>   S&amp;P, NYSE  ,   Brent       .   BTCUSD  EURUSD  . <br><br><h3>   , ommodity channel index, CCI </h3><br> <abbr title="  "></abbr> CCI ‚Äî ,                    . <abbr title="  "></abbr>     . <br><br>     : ,  CCI   100, ,  CCI   100. <br><br>   <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25B4%25D0%25B5%25D0%25BA%25D1%2581_%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2580%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25B0"></a>   . <br><br> <a href=""><img src="https://habrastorage.org/webt/vr/uc/ob/vrucob8honvqk0dsynnz5t7zqtw.png"></a> <br><br>   S&amp;P500, NYSE, Brent       .   BTCUSD   (  ),        .   EURUSD    . <br><br> <b>   <a href="https://github.com/yaroslavbat/habr_article2/">GitHub</a></b> <br>   ,  ,   (   ,       Yahoo Finance),  ,    ,     (   ,     20 ). <br><br> <b>   <abbr title="  "></abbr> :</b>        .        .               . <br><br>  Additionally: <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Three more indicators were analyzed that are not included in the article. </font><font style="vertical-align: inherit;">But they could not get any result. </font><font style="vertical-align: inherit;">Perhaps their study will continue. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To perform calculations and complex modeling of </font></font><abbr title="  "><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TIR</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and financial activities in general on the Oracle Database is very convenient.</font></font></i> </div><p>Source: <a href="https://habr.com/ru/post/455050/">https://habr.com/ru/post/455050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45504/index.html">How am I looking for a job</a></li>
<li><a href="../455040/index.html">Improving the work of Wi-Fi. Part 2. Features of equipment</a></li>
<li><a href="../455042/index.html">Kotlin DSL, fixtures and elegant UI tests in Android</a></li>
<li><a href="../455046/index.html">N + 7 useful books</a></li>
<li><a href="../455048/index.html">Technical implementation of the thermal potential method for territory analysis</a></li>
<li><a href="../455052/index.html">Summer DIYorDIE Meetup June 16</a></li>
<li><a href="../455054/index.html">How will Apple (privately) find your lost device offline?</a></li>
<li><a href="../455056/index.html">Primitive graphics for lazy, oldfag and lazy oldfag</a></li>
<li><a href="../455058/index.html">Calculated plot or table-role infection</a></li>
<li><a href="../455060/index.html">Homer or the first ever opensource. part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>