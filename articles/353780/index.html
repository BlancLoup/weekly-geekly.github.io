<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comparison of the speed of different variants of Unity3D script interaction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 I don‚Äôt know much about the intricacies of Unity, because I don‚Äôt do it professionally, but as a hobby. Usually I just learn everythi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comparison of the speed of different variants of Unity3D script interaction</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br><p>  I don‚Äôt know much about the intricacies of Unity, because I don‚Äôt do it professionally, but as a hobby.  Usually I just learn everything I need as needed, so this article is aimed at people like me. </p><br><p>  I, as probably anyone who started writing on a unit, quickly realized that the most banal method of interaction (through singletons managers, Find, GetComponent, etc.) is not enough and we need to look for new options. </p><br><p>  And here comes <a href="https://habrahabr.ru/post/282524/">the message / notification system.</a> </p><br><p>  Having rummaged through various articles, I found several different options for implementing this system: </p><br><ul><li>  Based on embedded <b><a href="https://docs.unity3d.com/ScriptReference/Events.UnityEvent.html">UnityEvents</a></b> </li><li>  Using the classic C # <b><a href="https://metanit.com/sharp/tutorial/3.14.php">event / delegate</a></b> pair </li><li>  Another built-in old built-in functionality <b><a href="https://docs.unity3d.com/ScriptReference/GameObject.SendMessage.html">SendMessage</a></b> </li></ul><br><p>  In most articles, there is practically no information on the speed of various approaches, their comparison and so on.  Usually there is only such a mention of speed <i>"Use SendMessage only in extreme cases, but rather do not use at all"</i> </p><br><p>  <b><i>Ok, this approach seems to have significant problems with speed, but then how are things with others?</i></b> </p><br><p>  I couldn‚Äôt find some sane and orderly information on this question (I could not search well) and decided to find it out by experience, and at the same time try these approaches in practice, which greatly helped to get rid of cereal in my head after reading dozens of articles. </p><br><p>  I decided to compare these 3 approaches, as well as the usual direct function call on the object by its reference. <br>  And as a bonus, let's see visually how Find is running slowly when searching for an object each Update (what all the guides for beginners shout about). </p><a name="habracut"></a><br><h2>  Scripting </h2><br><p>  For the test, we need to create on the stage 2 objects: </p><br><ul><li>  The sender, let's call it <b>Sender</b> , create and attach the <i>Sender.cs</i> script to <i>it</i> </li><li>  Recipient, let's call him <b>Receiver</b> , create and attach <i>Receiver.cs</i> script on it </li></ul><br><p>  Let's start with the recipient <b>Receiver.cs</b> , because  there will be the least code. <br>  To tell the truth, at first I thought to limit myself to just an empty function that will be called from the outside.  And then this file would look simple: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Receiver</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre> <br><p>  But later on, I decided to note the time for making all calls / sending messages not only at the sender, but also at the recipient (for reliability). </p><br><p>  To do this, we need 4 variables: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    float t_end = 0; //    float count = 0; //    int testIterations = 10000; //   .   10000 </span></span></code> </pre> <br><p>  And we add the function <b>TestFunction</b> so that it can take for what time it has <i>run testIterations</i> once and spit this info into the console.  In the arguments we will take the string <i>testName</i> , in which the name of the test method will come, because  the function itself does not know who will call it.  This information is also added to the output in the console.  As a result, we get: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestFunction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> testName</span></span></span><span class="hljs-function">)</span></span> { count++; <span class="hljs-comment"><span class="hljs-comment">//     //     ,     if (count == 1) { t_start = Time.realtimeSinceStartup; } //    ,    ,           (t_end - t_start) else if (count == testIterations) { t_end = Time.realtimeSinceStartup; Debug.Log(testName + " SELF timer = " + (t_end - t_start)); count = 0; } }</span></span></code> </pre> <br><p>  With this finished.  Our function will count the time of execution of a certain call cycle itself and output it to the console along with the name of the person who called it. <br>  We will return to it in order to subscribe to the sender and to change the number of calls (although you can bind to the same variable in the sender, not to change in two places, or pass the second argument to the function, but let's not waste time on it) </p><br><div class="spoiler">  <b class="spoiler_title">Receiver.cs completely</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Receiver</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    float t_end = 0; //    float count = 0; //    int testIterations = 10000; //    public void TestFunction(string testName) { count++; //     //     ,     if (count == 1) { t_start = Time.realtimeSinceStartup; } //    ,    ,           (t_end - t_start) else if (count == testIterations) { t_end = Time.realtimeSinceStartup; Debug.Log(testName + " SELF timer = " + (t_end - t_start)); count = 0; } } }</span></span></code> </pre> </div></div><br><p>  Preparation completed.  We proceed to writing tests. </p><br><h2>  Direct Call function (Direct Call) </h2><br><p>  Go to <b>Sender.cs</b> and prepare the code for the first test.  The most trivial and simplest option is to find a recipient instance in Start () and save a link to it: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.Events; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Sender</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    float t_end = 0; //    int testIterations = 10000; //    Receiver receiver; void Start () { receiver = GameObject.Find("Receiver").GetComponent&lt;Receiver&gt;(); }</span></span></code> </pre> <br><p>  Let's write our <b>DirectCallTest</b> function, which will be the preset for all other functions of the test: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DirectCallTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { t_start = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; testIterations; i++) { receiver.TestFunction(<span class="hljs-string"><span class="hljs-string">"DirectCallTest"</span></span>); } t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start; }</code> </pre> <br><p>  In each iteration, we call our <b>TestFunction</b> on the receiver and pass the name of the test. </p><br><p>  Now it remains to make an output to the console and run this test, so we add a line to Start (): </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { receiver = GameObject.Find(<span class="hljs-string"><span class="hljs-string">"Receiver"</span></span>).GetComponent&lt;Receiver&gt;(); Debug.Log(<span class="hljs-string"><span class="hljs-string">"DirectCallTest time = "</span></span> + DirectCallTest()); }</code> </pre> <br><p>  Done!  We start and receive our first data.  (I remind you that the results with the word SELF are given to us by the function that we call, and <b>without</b> SELF - the one that calls) </p><br><p>  I will arrange them in such signs: </p><br><table><thead><tr><th>  Test name </th><th>  Test time </th></tr></thead><tbody><tr><td>  Directcalltest timer </td><td>  0.0005178452 </td></tr><tr><td>  DirectCallTest SELF timer </td><td>  0.0001906157 </td></tr></tbody></table><br><p>  (I remind you that the results with the word SELF are given to us by the function that we call, and <b>without</b> SELF - the one that calls) </p><br><p>  So, the data in the console and we see an interesting picture - the function on the receiver worked in ~ 2.7 times faster than on the sender. <br>  I still do not understand what it is connected with.  It may be that after the time is calculated on the recipient, the Debug.Log or something else is additionally called ... If anyone knows, write to me and I will add it to the article. </p><br><p>  In any case, this is not particularly important to us, since  we want to compare different implementations with each other, so we move on to the next test. </p><br><h2>  Sending messages via SendMessage </h2><br><p>  Old and blasphemed by all and sundry ... let's see what you are capable of. </p><br><p>  <i>(Actually, I don‚Äôt really understand why it is needed, if you still need a reference to an object for it as in a direct call. Apparently, it‚Äôs not clear what not to do public methods)</i> </p><br><p>  Add the <b>SendMessageTest</b> function: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMessageTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { t_start = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; testIterations; i++) { receiver.SendMessage(<span class="hljs-string"><span class="hljs-string">"TestFunction"</span></span>, <span class="hljs-string"><span class="hljs-string">"SendMessageTest"</span></span>); } t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start; }</code> </pre> <br><p>  And the line in Start (): </p><br><pre> <code class="cs hljs"> Debug.Log(<span class="hljs-string"><span class="hljs-string">"SendMessageTest time = "</span></span> + SendMessageTest());</code> </pre> <br><p>  We get these results (slightly changed the structure of the table): </p><br><table><thead><tr><th>  Test name </th><th>  Test time on the sender </th><th>  Test Time at Recipient </th></tr></thead><tbody><tr><td>  Directcalltest </td><td>  0.0005178452 </td><td>  0.0001906157 </td></tr><tr><td>  SendMessageTest </td><td>  0.004339099 </td><td>  0.003759265 </td></tr></tbody></table><br><p>  Wow, the difference is one order!  We will continue to write tests, and analyze the analysis at the end, so those who already know how to use all of this can go further to the analysis.  And this is more intended for those who, like me, only study and choose for themselves the implementation of a system of interaction between components. </p><br><h2>  We use built-in <a href="https://docs.unity3d.com/ScriptReference/Events.UnityEvent.html">UnityEvents</a> </h2><br><p>  Create a <b>UnityEvent in</b> Sender.cs, to which we later sign our recipient: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> UnityEvent testEvent= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityEvent();</code> </pre> <br><p>  We are writing a new <b>UnityEventTest</b> function: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnityEventTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { t_start = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; testIterations; i++) { testEvent.Invoke(<span class="hljs-string"><span class="hljs-string">"UnityEventTest"</span></span>); } t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start; }</code> </pre> <br><p>  So, we send a message to all the signatories that an event has occurred and we want to send <i>‚ÄúUnityEventTest‚Äù there</i> , but our event does not accept arguments. <br>  We read the <a href="https://docs.unity3d.com/ScriptReference/Events.UnityEvent_1.html">manual</a> and we understand that for this we need to override the type of the UnityEvent class.  Let's do this, as well as make changes to this line: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> UnityEvent testEvent= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityEvent();</code> </pre> <br><p>  Such code turns out: </p><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestStringEvent</span></span> : <span class="hljs-title"><span class="hljs-title">UnityEvent</span></span>&lt;<span class="hljs-title"><span class="hljs-title">string</span></span>&gt; { } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> TestStringEvent testStringEvent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestStringEvent();</code> </pre> <br><p>  Do not forget in UnityEventTest () to replace testEvent with testStringEvent. </p><br><p>  Now subscribe to the event in the <b>Receiver.cs</b> recipient: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Sender.testStringEvent.AddListener(TestFunction); }</code> </pre> <br><p>  Subscribe in the <b>OnEnable ()</b> method <b>so</b> that the object subscribes to events when it is activated on the stage (including when it is created). <br>  You also need to unsubscribe from events in the <b>OnDisable ()</b> method, which is called when an object is disabled (including deletion) on the stage, but for the test we don‚Äôt need it, so I didn‚Äôt write this part of the code. </p><br><p>  We start.  Everything works perfectly!  Go to the next test. </p><br><h2>  C # Events at <a href="https://metanit.com/sharp/tutorial/3.14.php">Event / Delegate</a> </h2><br><p>  Remember that we need to implement event / delegate with the ability to send a message as an argument. <br>  In the sender <b>Sender.cs</b> create the event and delegate: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventDelegateTesting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventDelegateTesting BeginEventDelegateTest;</code> </pre> <br><p>  Writing a new function <b>EventDelegateTest</b> : </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventDelegateTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { t_start = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; testIterations; i++) { BeginEventDelegateTest(<span class="hljs-string"><span class="hljs-string">"EventDelegateTest"</span></span>); } t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start; }</code> </pre> <br><p>  Now subscribe to the event in the <b>Receiver.cs</b> recipient: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Sender.testStringEvent.AddListener(TestFunction); Sender.BeginEventDelegateTest += TestFunction; }</code> </pre> <br><p>  We start and check.  Great, all tests are done. </p><br><h4>  Bonus </h4><br><p>  For the sake of interest, we will add copies of the DirectCallTest and SendMessageTest methods, where in each iteration we will look for an object on the stage, before addressing it, so that beginners can understand how <i>expensive it is</i> to make such errors: </p><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DirectCallWithGettingComponentTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { t_start = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; testIterations; i++) { GameObject.Find(<span class="hljs-string"><span class="hljs-string">"Receiver"</span></span>).GetComponent&lt;Receiver&gt;().TestFunction(<span class="hljs-string"><span class="hljs-string">"DirectCallWithGettingComponentTest"</span></span>); } t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendMessageTestWithGettingComponentTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { t_start = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; testIterations; i++) { GameObject.Find(<span class="hljs-string"><span class="hljs-string">"Receiver"</span></span>).GetComponent&lt;Receiver&gt;().SendMessage(<span class="hljs-string"><span class="hljs-string">"TestFunction"</span></span>, <span class="hljs-string"><span class="hljs-string">"SendMessageTestWithGettingComponentTest"</span></span>); } t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start; }</code> </pre> <br><h2>  Results analysis </h2><br><p>  We run all the tests at 10,000 iterations each and get these results (I immediately sort through the cycle time on our sender (Sender), because at this stage I found out by experience that the test time on the recipient was very different because of one call Debug.Log, which ran 2 times longer than the call cycle itself! </p><br><table><thead><tr><th>  Test name </th><th>  Test time on the sender </th></tr></thead><tbody><tr><td>  Directcalltest </td><td>  0.0001518726 </td></tr><tr><td>  Eventdelegatetest </td><td>  0.0001523495 </td></tr><tr><td>  UnityEventTest </td><td>  0.002335191 </td></tr><tr><td>  SendMessageTest </td><td>  0.003899455 </td></tr><tr><td>  DirectCallWithGettingComponentTest </td><td>  0.007876277 </td></tr><tr><td>  SendMessageTestWithGettingComponentTest </td><td>  0.01255739 </td></tr></tbody></table><br><p>  For clarity, we visualize the data (vertically, the execution time of all iterations, horizontally the names of the tests) </p><br><img src="https://habrastorage.org/webt/io/es/bt/ioesbtcsquq3kvmplruyzzruamm.jpeg"><br><p>  Let's now increase the accuracy of our tests and increase the number of iterations to 10 million. </p><br><table><thead><tr><th>  Test name </th><th>  Test time on the sender </th></tr></thead><tbody><tr><td>  Directcalltest </td><td>  0.1496105 </td></tr><tr><td>  Eventdelegatetest </td><td>  0.1647663 </td></tr><tr><td>  UnityEventTest </td><td>  1.689937 </td></tr><tr><td>  SendMessageTest </td><td>  3.842893 </td></tr><tr><td>  DirectCallWithGettingComponentTest </td><td>  8.068002 </td></tr><tr><td>  SendMessageTestWithGettingComponentTest </td><td>  12.79391 </td></tr></tbody></table><br><p>  In principle, nothing has changed.  It becomes clear that the message system on the usual Event / Delegate is almost no different in speed from the Direct Call, which cannot be said about UnityEvent and especially SendMessage. </p><br><p>  The last two columns, I think, will permanently wean out using the object search in a cycle / update. </p><br><img src="https://habrastorage.org/webt/f1/kh/5y/f1kh5ym1yvf2wzqg9bai3fbuwey.jpeg"><br><h2>  Conclusion </h2><br><p>  I hope someone this will be useful as a small study or as a small guide to event systems. </p><br><p>  The full code of the resulting files: </p><br><div class="spoiler">  <b class="spoiler_title">Sender.cs</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.Events; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Sender</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestStringEvent</span></span> : <span class="hljs-title"><span class="hljs-title">UnityEvent</span></span>&lt;<span class="hljs-title"><span class="hljs-title">string</span></span>&gt; { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventDelegateTesting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventDelegateTesting BeginEventDelegateTest; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    float t_end = 0; //    int testIterations = 10000000; //    public static TestStringEvent testStringEvent = new TestStringEvent(); Receiver receiver; System.Diagnostics.Stopwatch stopWatch; void Start () { receiver = GameObject.Find("Receiver").GetComponent&lt;Receiver&gt;(); stopWatch = new System.Diagnostics.Stopwatch(); StartCoroutine(Delay5sec()); // ,      Debug.Log("UnityEventTest time = " + UnityEventTest()); Debug.Log("DirectCallTest time = " + DirectCallTest()); Debug.Log("DirectCallWithGettingComponentTest time = " + DirectCallWithGettingComponentTest()); Debug.Log("SendMessageTest time = " + SendMessageTest()); Debug.Log("SendMessageTestWithGettingComponentTest time = " + SendMessageTestWithGettingComponentTest()); Debug.Log("EventDelegateTest time = " + EventDelegateTest()); // stopWatch.Elapsed.Seconds(); } IEnumerator Delay5sec() { yield return new WaitForSeconds(5); } float UnityEventTest() { //t_start = Time.realtimeSinceStartup; stopWatch.Reset(); stopWatch.Start(); for (int i = 0; i &lt; testIterations; i++) { testStringEvent.Invoke("UnityEventTest"); } //t_end = Time.realtimeSinceStartup; //return t_end - t_start; stopWatch.Stop(); return stopWatch.ElapsedMilliseconds / 1000f; } float DirectCallTest() { //t_start = Time.realtimeSinceStartup; stopWatch.Reset(); stopWatch.Start(); for (int i = 0; i &lt; testIterations; i++) { receiver.TestFunction("DirectCallTest"); } //t_end = Time.realtimeSinceStartup; //return t_end - t_start; stopWatch.Stop(); return stopWatch.ElapsedMilliseconds / 1000f; } float DirectCallWithGettingComponentTest() { //t_start = Time.realtimeSinceStartup; stopWatch.Reset(); stopWatch.Start(); for (int i = 0; i &lt; testIterations; i++) { GameObject.Find("Receiver").GetComponent&lt;Receiver&gt;().TestFunction("DirectCallWithGettingComponentTest"); } //t_end = Time.realtimeSinceStartup; //return t_end - t_start; stopWatch.Stop(); return stopWatch.ElapsedMilliseconds / 1000f; } float SendMessageTest() { //t_start = Time.realtimeSinceStartup; stopWatch.Reset(); stopWatch.Start(); for (int i = 0; i &lt; testIterations; i++) { receiver.SendMessage("TestFunction", "SendMessageTest"); } //t_end = Time.realtimeSinceStartup; //return t_end - t_start; stopWatch.Stop(); return stopWatch.ElapsedMilliseconds / 1000f; } float SendMessageTestWithGettingComponentTest() { //t_start = Time.realtimeSinceStartup; stopWatch.Reset(); stopWatch.Start(); for (int i = 0; i &lt; testIterations; i++) { GameObject.Find("Receiver").GetComponent&lt;Receiver&gt;().SendMessage("TestFunction", "SendMessageTestWithGettingComponentTest"); } //t_end = Time.realtimeSinceStartup; //return t_end - t_start; stopWatch.Stop(); return stopWatch.ElapsedMilliseconds / 1000f; } float EventDelegateTest() { //t_start = Time.realtimeSinceStartup; stopWatch.Reset(); stopWatch.Start(); for (int i = 0; i &lt; testIterations; i++) { BeginEventDelegateTest("EventDelegateTest"); } //t_end = Time.realtimeSinceStartup; //return t_end - t_start; stopWatch.Stop(); return stopWatch.ElapsedMilliseconds / 1000f; } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Receiver.cs</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Receiver</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t_start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    float t_end = 0; //    float count = 0; //    int testIterations = 10000000; //    void OnEnable() { Sender.testStringEvent.AddListener(TestFunction); Sender.BeginEventDelegateTest += TestFunction; } public void TestFunction(string testName) { count++; //     //     ,     if (count == 1) { t_start = Time.realtimeSinceStartup; } //    ,    ,           (t_end - t_start) else if (count == testIterations) { t_end = Time.realtimeSinceStartup; //Debug.Log(testName + " SELF timer = " + (t_end - t_start));   , .. ,    -     count = 0; } } }</span></span></code> </pre> </div></div><br><h2>  - - = = UPDATE = = - - </h2><br><p>  I wrote some important notes that I would like to comment on in the article: </p><br><p>  <i>1. It is impossible to test in the editor itself (the code is always going to be in DEBUG mode), be sure to collect a standalone build and measure it.</i> <br></p><ol><li>  You can not just twist the loop N iterations and take the results.  It is necessary to start the cycle M times by N iterations and average it - this will smooth out various side effects such as changing the processor frequency and other things. </li><li>  The time counting method should be changed - the accuracy of Time.realtimeSinceStartup is no good. </li></ol><br><br><p>  Thank you all for these clarifications, as some are quite substantial. <br>  By the way, all this is in this article - <b><a href="https://leopotam.com/3/">Performance tests of Event, ActionList, Observer, InterfaceObserver</a></b> .  I advise you to read and take into account this information. </p><br><p>  As for our test - <b>1)</b> and <b>3)</b> I will definitely check right now, but I‚Äôll skip paragraph <b>2)</b> specifically in our test, because  in our case, we do not pursue the accuracy of each result, but compare them with each other.  I ran the test with my hands several times and did not see any major deviations in the results, so for now let's skip it (if the hands reach, then we will realize this moment) </p><br><p>  The first thing we check is </p><br><h4>  Test in the assembled application </h4><br><p>  Everything is simple here - we are building an application for Windows (we first add a delay of 5s before running the tests. Just in case, so that everything runs fine), also 10 million iterations and run. </p><br><p>  Next, go to <b>C: \ Users \ username \ AppData \ LocalLow \ CompanyName \ ProductName \ output_log.txt</b> <br>  if you have a Windows (or we look at <a href="https://docs.unity3d.com/Manual/LogFiles.html">documentation</a> ) and we study logs. </p><br><p>  And here we see interesting changes: </p><br><ul><li>  First of all: we learn that in the release everything works 3-10 times faster than in the editor!  For example, I did not think that the difference is so significant / </li><li>  Secondly: we learn that a direct call with the search for an object, each iteration is not so slow.  Of course, slower than UnityEvents, but already faster than SendMessage.  Although, perhaps the fact is that there are just few objects on the stage ... you need to investigate it separately. </li></ul><br><p>  We get this comparison for the release </p><br><img src="https://habrastorage.org/webt/de/3a/bm/de3abmy7we3tg_kdznm_l-j4yh0.jpeg"><br><p>  In addition to the exchanged two tests above, nothing else has changed and the graph looks the same as in the debug, i.e.  DirectCall and DelegateEvent are still faster than UnityEvent and the rest </p><br><h4>  Optimize time counting </h4><br><p>  Although, like point <b>2)</b> , the optimization of the calculation of time is unlikely to give us any changes in the alignment of forces, we will make this point in order to find out how much these two approaches differ between themselves.  They drove. </p><br><p>  We change all our: </p><br><pre> <code class="cs hljs">t_start = Time.realtimeSinceStartup; t_end = Time.realtimeSinceStartup; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t_end - t_start;</code> </pre> <br><p>  On: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  System.Diagnostics.Stopwatch stopWatch; //   Start() stopWatch = new System.Diagnostics.Stopwatch(); //      stopWatch.Reset (); stopWatch.Start (); //    stopWatch.Stop (); //  return stopWatch.ElapsedMilliseconds / 1000f;</span></span></code> </pre> <br><p>  (at the end I'll post all the final code) </p><br><p>  So, studying the data we can say that the difference of Time.realtimeSinceStartup from System.Diagnostics.Stopwatch is not significant in our case and can be attributed to the error the whole ratio comes back again. See this in the summary table).  As I said, the view of the chart has not changed: </p><br><img src="https://habrastorage.org/webt/vv/x3/jm/vvx3jmezrmuputjsy1nsop-tmg0.jpeg"><br><p>  We make a final table with all the values ‚Äã‚Äã(the time spent on the execution of 10 million iterations).  Data on the latest tests in different variants of debug / release, unity / c # time (time measurement method): </p><br><table><thead><tr><th>  Test name </th><th>  Debug, Unity time </th><th>  Debug, C # time </th><th>  Release, Unity time </th><th>  Release, C # time </th></tr></thead><tbody><tr><td>  Directcalltest </td><td>  0.1496105 </td><td>  0.15 </td><td>  0.0498426 </td><td>  0.047 </td></tr><tr><td>  Eventdelegatetest </td><td>  0.1647663 </td><td>  0.155 </td><td>  0.0478754 </td><td>  0.047 </td></tr><tr><td>  UnityEventTest </td><td>  1.689937 </td><td>  1.657 </td><td>  0.5706475 </td><td>  0.462 </td></tr><tr><td>  DirectCallWithGettingComponentTest </td><td>  8,068002 </td><td>  2.112 </td><td>  0.8793411 </td><td>  0.851 </td></tr><tr><td>  SendMessageTest </td><td>  3.842893 </td><td>  3,938 </td><td>  1,364239 </td><td>  1,375 </td></tr><tr><td>  SendMessageTestWithGettingComponentTest </td><td>  12.79391 </td><td>  6,752 </td><td>  2,250246 </td><td>  2,244 </td></tr></tbody></table><br><p>  Summing up - although, the speed of execution has changed significantly in the release version with a new way of measuring time, but the ratio of test execution time has not changed.  DirectCall and EventDelegate are still in the lead and faster UnityEvent 10 times.  But DirectCall with the search for the object in each iteration overtook even the usual SendMessage .. </p><br><p>  We also learned from this update that the release version is 3-10 times faster than the editor. </p><br><p>  PS There was also a comment that we should take the execution time of one iteration, and not the total execution time, for the result.  In our case, I do not see the need for this, because  These figures are inversely proportional to each other and nothing will change, except for a slightly different kind of graph, especially the conclusions. </p><br><p>  Used Books: </p><br><ul><li>  <a href="https://habrahabr.ru/post/282524/">Unity3D messaging system or ‚Äúsoft coupling‚Äù between components</a> </li><li>  <a href="https://habrahabr.ru/post/213809/">C # Events Humanly</a> </li><li>  <a href="https://docs.unity3d.com/ScriptReference/Events.UnityEvent.html">Unityity</a> </li><li>  <a href="https://msdn.microsoft.com/ru-ru/library/8627sbea(v%3Dvs.120).aspx">event (C # Reference)</a> </li><li>  <a href="https://metanit.com/sharp/tutorial/3.14.php">Developments</a> </li><li>  <a href="https://unity3d.com/ru/learn/tutorials/topics/scripting/events">Intermediate Gameplay Scripting - Events</a> </li><li>  <a href="https://habrahabr.ru/post/308570/">Unity's Forgotten Secret Weapon - UnityEvents</a> </li><li>  <a href="https://habrahabr.ru/post/212055/">Methods of organizing interaction between scripts in Unity3D</a> </li><li>  <a href="https://leopotam.com/3/">Performance tests of Event, ActionList, Observer, InterfaceObserver</a> </li></ul><br><h2>  Thanks for attention! </h2></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/353780/">https://habr.com/ru/post/353780/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353770/index.html">[Habra-offtopic] Maratona di Roma, or the first marathon for an IT person</a></li>
<li><a href="../353772/index.html">Tutu PHP Meetup # 1: Video Speeches</a></li>
<li><a href="../353774/index.html">How to improve the UX product? Epic Growth Story with CEO Maps.me</a></li>
<li><a href="../353776/index.html">We invite you to a workshop on React Native from the developer GeekBrains</a></li>
<li><a href="../353778/index.html">Classic JavaScript inheritance. Parsing the implementation in Babel, BackboneJS and Ember</a></li>
<li><a href="../353782/index.html">Video from the first Badoo PHP Meetup 04/07/2018</a></li>
<li><a href="../353784/index.html">ReactOS 0.4.8: We lured Dr. Watson</a></li>
<li><a href="../353790/index.html">Go: Good, bad, angry</a></li>
<li><a href="../353792/index.html">Final of the International Student Programming Olympiad Live</a></li>
<li><a href="../353798/index.html">Package Registry on Ethereum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>