<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I transferred the file name from C ++ to Java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In cross-platform applications that just can not be found. Or write. Here, the other day they gave birth to the next hedgehog, they stepped on a caref...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I transferred the file name from C ++ to Java</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5fe/569/4cd/5fe5694cd267309abf989ad96512bca5.png" alt="image" align="left"><br>  In cross-platform applications that just can not be found.  Or write.  Here, the other day they <s>gave birth to the next hedgehog, they</s> stepped on a carefully laid rake, this time under a poppy. <br><br><a name="habracut"></a><br><br>  Let me remind you of the previous saga series: <a href="http://habrahabr.ru/post/148068/">rake under Windows</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That is, we still have the same exotic hedgehog + python = barbed wire.  This time, <s>happiness came to</s> us and we had a surprise on a poppy.  Java in InDesign was integrated, it works, now we need to transfer the file name to our Java code written. <br><br><h4>  The Dark Knight: the Beginning </h4><br>  It all started so ordinary: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FooExpFilter::ExportToStream( IPMStream* stream, IDocument* doc, IPMUnknown* targetboss, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PMString&amp; formatName, UIFlags uiFlags) { IDFile outputFile; InterfacePtr&lt;IFileStreamData&gt; fileData(stream, IID_IFILESTREAMDATA); outputFile = fileData-&gt;GetSysFile(); <span class="hljs-function"><span class="hljs-function">SDKFileHelper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(outputFile)</span></span></span></span>; PMString pathID = fh.GetPath(); <span class="hljs-function"><span class="hljs-function">WideString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pathWID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pathID)</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> xID; StringUtils::ConvertWideStringToUTF8 (pathWID, xID);</code> </pre> <br>  and worked on Mac and on Windows.  While InDesign has not grown to version CS5.5.  And then the <s>happiness</s> came to the log our favorite and epic <b>java.io.FileNotFoundException</b> . <br><br><h4>  Star Wars: The Empire Strikes Back </h4><br>  <b>Aside</b> : these entries in the ‚Äúas if something did not work out‚Äù log file help a lot, I recommend.  If, of course, logs are wisely written, and then (personally I saw!) Once from the abundance of logs, performance degradation turned out and a ‚Äúcoder‚Äù (C) wrote the log for 40 seconds, and without a log it worked for a half second.  Hindus tried - they wrote their log4j with blackjack but without buffering. <br><br>  We get a log from the client, and there - <b>Macintosh HD :: Foo :: Bar</b> ! <br><br><h4>  Come to us in Prostokvashino - if you do not have ball gowns </h4><br>  Fast googling (how to translate carbon poppy paths in Unix) leads to detailed instructions on how to translate with your hands, given the mount points.  And applescript as an example, what and in what order to ask the Finder.  Aha, aha - that's what ObjectiveC lacked for complete happiness. <br><br>  Having drank half a bucket of coffee, and dabbed the Adobe SDK, we find a solution worthy of ithappens.  Here it is. <br><br><pre> <code class="cpp hljs"> IDFile outputFile; InterfacePtr&lt;IFileStreamData&gt; fileData(stream, IID_IFILESTREAMDATA); outputFile = fileData-&gt;GetSysFile(); <span class="hljs-comment"><span class="hljs-comment">// URL for java PMString pathJ = FileUtils::SysFileToFileURL(outputFile); WideString pathWJ(pathJ); std::string xj; StringUtils::ConvertWideStringToUTF8 (pathWJ, xj);</span></span></code> </pre><br>  and in Java there are 3 more lines: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(externFile.startsWith(<span class="hljs-string"><span class="hljs-string">"file://"</span></span>)) { File externFd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> java.net.URI(externFile)); externFile = externFd.getAbsolutePath(); }</code> </pre><br><br>  That is, not finding how to pass the path, we passed ... URL! <br><br>  And it even works. <br><br>  <b>Disclaimer</b> : I will not give up the correct example - how to translate the carbon paths in Unix without ObjectiveC  Though irrelevant, but interesting.  If it exists at all, and not ‚Äúcut off the head and change :: to /‚Äù, I‚Äôm wrong myself. <br><br><h4>  Mind Games: How You Can Do Better </h4><br>  <b>Update 1</b> : <a href="http://habrahabr.ru/users/notorca/" class="user_link">notorca</a> suggested using a poppy <b>CFURLCopyFileSystemPath</b> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FooExpFilter::ExportToStream( IPMStream* stream, IDocument* doc, IPMUnknown* targetboss, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PMString&amp; formatName, UIFlags uiFlags) { IDFile outputFile; InterfacePtr&lt;IFileStreamData&gt; fileData(stream, IID_IFILESTREAMDATA); outputFile = fileData-&gt;GetSysFile(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> WINDOWS SDKFileHelper fh(outputFile); PMString pathID = fh.GetPath(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> MACINTOSH FSSpec fsSpec; PMString pathID; OSErr err = FileUtils::IDFileToFSSpec(outputFile, fsSpec); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (err == noErr) { FSRef fsRef; err = MacFileUtils::FSSpecToFSRef(fsSpec, fsRef); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (err == noErr) { CFURLRef appURL = ::CFURLCreateFromFSRef(NULL, &amp;fsRef); CFStringRef app_str = ::CFURLCopyFileSystemPath(appURL, kCFURLPOSIXPathStyle); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (app_str) { pathID.SetCFString(app_str); ::CFRelease(app_str); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (appURL) ::CFRelease(appURL); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> WideString pathWID(pathID); std::string xID; StringUtils::ConvertWideStringToUTF8 (pathWID, xID);</span></span></code> </pre><br><br>  <b>Update 2</b> : And <a href="http://habrahabr.ru/users/strizh/" class="user_link">strizh</a> gave another hint - you could use <b>FileUtils :: FileURLToPosixPath</b> , in this case the code becomes like this: <br><br><pre> <code class="cpp hljs"> IDFile outputFile; InterfacePtr&lt;IFileStreamData&gt; fileData(stream, IID_IFILESTREAMDATA); outputFile = fileData-&gt;GetSysFile(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> WINDOWS SDKFileHelper fh(outputFile); PMString pathID = fh.GetPath(); WideString pathWID(pathID); std::string xfinal; StringUtils::ConvertWideStringToUTF8 (pathWID, xfinal); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> MACINTOSH PMString pathJ = FileUtils::SysFileToFileURL(outputFile); WideString pathWJ(pathJ); std::string xj; StringUtils::ConvertWideStringToUTF8 (pathWJ, xj); std::string xfinal = FileUtils::FileURLToPosixPath(xj); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br><br>  So if through the URL - then there are options.  Without a transition path -&gt; URL -&gt; posix path while prompts have been received (no, I still do not agree to carry with me a piece on ObjectiveC). </div><p>Source: <a href="https://habr.com/ru/post/148115/">https://habr.com/ru/post/148115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148106/index.html">The answer to the main issue of crowdfunding</a></li>
<li><a href="../148110/index.html">User Experience and Kano's model</a></li>
<li><a href="../148111/index.html">SSDs on database servers?</a></li>
<li><a href="../148112/index.html">The Grum botnet that sent 18% of global spam has been disrupted</a></li>
<li><a href="../148113/index.html">Hetzner lowered the price of installing servers</a></li>
<li><a href="../148116/index.html">Ethan Marcott's Responsive Web Design</a></li>
<li><a href="../148117/index.html">Are PCIe SSDs used in your projects?</a></li>
<li><a href="../148119/index.html">ARM + WiFi in SD card format</a></li>
<li><a href="../148120/index.html">Canonical announced Ubuntu WebApps</a></li>
<li><a href="../148122/index.html">Developed a system for storing passwords in the subconscious</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>