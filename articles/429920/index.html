<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The tragicomedy in NaN acts: how we made the game on JS and released it on Steam</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúEka Nepal,‚Äù you say, ‚ÄúIn your top-100, there is no game, so it's not protected.‚Äù Also true. But over the year the development of Protolife, we have a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The tragicomedy in NaN acts: how we made the game on JS and released it on Steam</h1><div class="post__text post__text-html js-mediator-article">  ‚ÄúEka Nepal,‚Äù you say, ‚ÄúIn your top-100, there is no game, so it's not protected.‚Äù  Also true.  But over the year the development of Protolife, we have accumulated some experience that we can share with potential future igrodelami.  Veterans of the industry, I am afraid, will not find anything interesting for themselves.  But maybe, at least have fun from the heart. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lh/-w/mm/lh-wmmcrraswwobhujdwnsinofy.png"></div><br><h3>  What kind of game?  And who are ‚Äúwe‚Äù? </h3><br>  We are a team of three people ( <a href="https://habr.com/users/graal/" class="user_link">GRaAL</a> , <a href="https://habr.com/users/a333/" class="user_link">A333</a> , <a href="https://habr.com/users/icxon/" class="user_link">icxon</a> ), by the will of fate called the Volcanic Giraffe without any intention.  We worked together for a long time, three of us participated in <a href="https://ldjam.com/">Ludum Dare</a> several times (writing contests over the weekend), and once decided to bring <a href="https://ldjam.com/users/graal/games">one of our handicrafts</a> called Protolife to release. <br><br>  In short: this is an unusual tower defense, where you have to run as a hero-cursor and build a block defense against the constantly growing red biomass. <br><a name="habracut"></a><br><blockquote>  From the comments to the draft article: <br>  <i><a href="https://habr.com/users/icxon/" class="user_link">icxon</a> : you need to write at least a little about the gameplay.</i>  <i>And then some screenshots on which the hell understand what is happening</i> <br></blockquote><br>  If you paint in more detail, what is in the game: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  There is a set of levels, at each level there is our base and our avatar is a robot builder. </li><li>  Part of the level is filled with red growing biomass that spews tons of mobs out of you. </li><li>  Mobs, clearly a matter of, run to the base and try to crush it.  And we are building a defense of the towers and do not give it. </li></ol><br>  ‚ÄúBut what‚Äôs so unusual?‚Äù You ask.  And the main differences from the majority of tower defense are as follows: <br><br><ol><li>  We manage the construction robot directly from the keys, i.e.  It is necessary to manually worn on the level and have time to build everything / repair. </li><li>  All that a robot can do is build and dismantle blue blocks.  One such block does nothing useful, but a few blocks laid out on a specific pattern turn into a useful structure.  Template examples: <br></li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tb/bg/wq/tbbgwqkztc9agfv9vhhezbli9lk.png"></div><br><ul><li>  Pattern 1: simple gun </li><li>  Pattern 2: wall </li><li>  Pattern 3: AA gun.  here you have to use more and yellow crystals, which are mined more difficult </li><li>  Pattern 4: Machine Gun </li></ul><br>  And so the game passes: we run, build, get the answer, and quickly repair it.  Directly visualization of the game development process is obtained. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ej/aw/nh/ejawnheikmuamezlswybx7gwhfq.gif"></div><br>  But this game was not immediately.  Back in April 2017, on Ludum Dare 38, it looked like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hy/qu/kx/hyqukx8b8omlqfjtvwqoa2hlaiu.gif"></div><br>  If you do not pay attention to the difference in the graph, then it seems that not much has changed.  Already on the LD version there was a cursor builder, the construction of block towers and a standoff with red biomass.  We left it because it worked and people liked it. <br><br>  But in fact, a lot has changed under the hood besides the concentration of graphonium per square pixel.  On a year-long journey, we had to make various decisions ‚Äî gameplay, technical, organizational, and even marketing.  Some were successful, some were not. <br><br>  Here I would like to tell about such decisions. <br><br>  Immediately make a reservation - there will probably be several articles, because  material, if you start to dig, gets out a lot.  At the end of this article you will find a short survey - which topics you would be most interested in.  Well, links to the game itself, too. <br><br><h3>  A boring story of creation. </h3><br>  I don‚Äôt think that it‚Äôs really interesting to someone how the game came up with at all, so I‚Äôll remove it under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Somehow Conway, Matheson and Petri go to a bar ...</b> <div class="spoiler_text">  <i>And the bartender says: undefined is not a function.</i> <i><br><br></i>  <i>On the eve of LD38, it turned out terrible: our colleague and the only artist <a href="https://habr.com/users/a333/" class="user_link">A333</a> will fly the whole LD over the Atlantic, and will not be able to help us.</i>  <i>Therefore, it was necessary for the remaining forces to make the game as undemanding as possible.</i> <i><br><br></i>  <i>The topic by the way was ‚ÄúSmall world‚Äù.</i>  <i>And then during the brainstorm, everything went like this:</i> <i><br></i> <ul><li>  No artist - simple graphics, primitive <br></li><li>  Small world - small size, or maybe something microscopic, such as any microbes <br></li><li>  Microbes are a type of micro-life. <br></li><li>  And life is such a cellular automaton.  Well, the cells in every sense.  Let the player fight a cellular automaton against another cellular automaton. <br></li><li>  Poked Conway Life - no good.  A player who is not familiar with the rules of the machine is likely to build something that will be destroyed by itself.  Very difficult to control.  According to the rules of life, let's be only the enemy, and we will build orderly structures. <br></li><li>  ... but then the enemy will self-destruct every now and then.  Okay, correct the rules for him.  Let it only grows, and we must destroy it. <br></li><li>  So, we already have: the red cells of the enemy, which are only growing, and our blue ones, which we build ourselves according to predetermined patterns.  We will build towers and walls, i.e.  It turns out such a tower defense.  For diversity, there are not enough moving enemies (mobs). <br></li><li>  The day before I re-read once again ‚ÄúI am a Legend‚Äù by Matheson.  So the main character at night keeps the siege from vampires, and in the daytime, when vampires are inactive, he restores defense, as well as expands the sphere of influence.  It sounded like a good gameplay element, so the phases of day and night appeared in the game.  During the night, enemy cells shared and <s>lit up houses,</s> crawling mobs, in the afternoon - everything was quiet, it was possible to counterattack. <br></li><li>  We call our color pixels ‚Äúmicroorganisms‚Äù and shove them into a circular arena - the Petri dish. <br></li><li>  Take our favorite engine Phaser.js ... <br></li><li>  ... and 31 places in our pocket <br></li></ul><br>  This is a story that is not very interesting, as I warned. <br><br>  ‚ÄúBut Alexey, why the hell did you write it then?‚Äù.  Reasonable question.  The fact is that almost the first comment on the game sounded like ‚Äúlol, you all flayed with Creeper World‚Äù.  After reviewing the game much later, the actual LD, I understand why people think so.  But still a little offensive. <br><br>  If suddenly you also felt hurt that you spent the time on this nagging, then <s>as a consolation, write to me in a personal code word ‚Äúboring things‚Äù, and I will send you one of 10 keys, if by the time they are not over.</s>  Unfortunately, the keys are also over. <br></div></div><br><h3>  Choosing a game for the full implementation </h3><br>  As is often the case, once we just thought all three of us - but is it not time to try to make a full game?  Often at this stage, some kind of concept is taken from the head, a la ‚Äúdream game,‚Äù and work is carried out with it.  And then how lucky to guess the desires of the audience. <br><br>  Our task was simplified a bit by having a small ‚Äúportfolio‚Äù on Ludum Dare.  We saw how people react to different games, and could compare.  Protolife had the greatest response, it was praised for originality and for interesting gameplay - this is at the zero level of graphics and only 4 levels! <br><br>  In addition, itch.io helped us to make a decision, where we published our crafts.  As it turned out, there are people who go to itch.io to play web games.  Some of these people love the tower defense genre, and 5-10 people came in (and still come in!) To play that old Protolife <i>every day</i> . <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/74/d-/sk/74d-sk_no7c5-dkl03ppllaq6pe.png"></div>  <sup>Statistics of visits to the release of the game on Steam</sup> <br><br>  You could say it was our first marketing research.  We thought and decided that a ‚Äúnon-standard tower defense‚Äù may well fire.  Tower defense is not so much, many of them are similar as two drops of water, and we can stand out among them. <br><br>  Looking ahead, I can say that the tactic has justified itself. <br><br>  <u>Unsolicited Tip # 1:</u> Better not act blindly.  The ideal ‚Äúdream game‚Äù in your head may be useless to no one.  If we do not participate in any jams, there is always a sense to jot down a gameplay (!) Prototype and test it on yourself, friends and acquaintances. <br><br>  <u>Counter-Council:</u> If you are not afraid that one and a half people will play the ‚Äúdream game‚Äù, then who cares?  Do it!  Maybe the same luck. <br><br><h3>  Engine: Not the best solution </h3><br>  The version on Ludum Dare we did on the <a href="https://phaser.io/">Phaser.js</a> engine.  We know it well, we know javascript well, web games get more feedback, it is quite convenient and easy to learn - a fairy tale, but not the engine. <br><br>  And we faced an important question: change the engine or leave everything as it is? <br><br>  The question was difficult.  None of us knew any other engine and did not study at that time.  Spending time studying is a good thing, but it was also possible to lose all enthusiasm.  And then - what to take?  Javascript is the only language that each of us knew, to take the C ++ / Java / C # engine is to instantly lose half of the developers.  And the Unity level engines at that time seemed too cumbersome for a ‚Äúsimple 2D game‚Äù. <br><br>  And then: here is the game.  It remains to update the graphene, finish the levels - that's all.  Work for a couple of months.  And then there's study, rewrite ... <br><br>  In general, we decided to stay on Phaser.js.  Even worse, we decided to stay on the same code base, i.e.  Build a game on top of the Ludum Dare prototype. <br><br><blockquote>  From the comments to the draft article <br>  <i><a href="https://habr.com/users/a333/" class="user_link">a333</a> : It's a pity, I didn't have that picture with a crutch instead of the Eiffel Tower ‚Äù</i> <br></blockquote><br>  <u>Unsolicited advice number 2:</u> never do that!  This is especially true of re-use of the prototype.  The code on jams is always written quickly and dirty, without taking into account future development.  There is a crutch, a crutch here - and now you understand that you are writing the legacy code right away, and instantly you start to suffer from it.  Prototypes must be carefully read, and then burned in / dev / null and write again, only already clean and clean. <br><br>  <u>Counter-Council:</u> consider, however, the peculiarities of psychology.  It happens that the delay in a couple of weeks is enough to ‚Äúcool off‚Äù.  Better to make a game with bad architecture than not to do at all. <br><br><blockquote>  From the comments to the draft article: <br>  <i><a href="https://habr.com/users/a333/" class="user_link">A333</a> : I'm very inclined to this option.</i>  <i>As far as I know, this is exactly the way most games are done, because time and fuse play a key role.</i>  <i>If you have the opportunity to rewrite everything completely on a new engine, this is good, but this is not always the case.</i>  <i>Do not be afraid to write quickly and dirty, roll out early prototypes, copy and paste pieces of code, and release zabago ... * sounds of blows and muffled moans *</i> <br></blockquote><br>  Actually, what's the problem with Phaser.js <br><br><ul><li>  Engine, as you might guess, web.  Do you know how to release a web game on Steam?  That's right, give it out with Chrome, using nw.js or Electron.  I think the cons of this approach is not necessary to explain. <br></li><li>  The javascript performance is certainly quite good, but the native code would be executed faster, and one couldn‚Äôt save on matches. <br></li><li>  Very poor control over the render.  Phaser renders everything on its own, and does it in general not bad, but sometimes you want to get into the process or do something on webGL on your own.  Alas, the only thing Phaser allows is to apply the fragment shader to the screen as a whole or to some separate sprites on the screen, and also in moderation.  He does not allow working with vertex shader at all (and generally working with vertices), and many solutions in the game with them would be much easier. <br></li><li>  Problems with a large number of sprites (active objects) on the screen.  And the ‚Äúbig number‚Äù is a couple of thousands, not millions.  And the ‚Äúactive object‚Äù will even be a lying stone without animations.  For every tick, the Phaser will go through all the objects and make its own special phaser magic, otzhiraya time from the game logic. <br></li></ul><br>  We have solved many of these problems along the way, some have not decided until the end.  It is difficult to judge without experience with other engines, but it seems to me that any other engine would allow to process thousands of game objects without hellish tricks.  However, I may be wrong. <br><br><h3>  War of styles </h3><br>  Do you still remember the ‚Äúoriginal design‚Äù of the original version of the game? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/bs/5r/hhbs5rkqrncm17tplvhjhbvizwu.png"></div><br>  Of course, he has his charm, but for a serious product did not fit.  Yes, and our artist just returned from a business trip, what is he to sit idle about? <br><br>  He did not sit, making a few sketches of a possible design.  History has retained two style chairs between which one had to make a choice. <br><br>  <b>Candidate 1:</b> minimalistic design.  In fact - the same "pixels", only prettier.  Everything is bright, contrasting.  It looks decent, but, let's say, undignified.  In the sense that the game that looks like this will look good on mobile phones or VKontakte somewhere between Tetris and Arkanoid.  But quickly and cheaply. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/n_/tc/osn_tcppk56blw3mrmhaxmneec4.jpeg"></div><br>  <b>Candidate 2:</b> realistic, fantastic, austere.  Here you can already see a certain story, context.  Unexpectedly, the contrast of not only colors, but also forms works well - our buildings are more ordered and square, the enemy buildings are round, irregular in shape. <br><br><img src="https://habrastorage.org/webt/ht/q1/zu/htq1zunnwz1-0ap6f2b8adcq9oa.jpeg"><br><br>  This is not to say that we hesitated for a very long time.  We imagined which of the ‚Äúscreenshots‚Äù we would like to play more, and the first candidate simply had no chance to survive.  We had no idea what we would have behind the plot, where it all happens, what happens - but we chose option two. <br><br>  Of course, there is nothing to compare with, but it seems to me that this was a good option.  Yes, we would finish the first option faster, it would be less demanding on performance and graphics, and probably it would even be possible to port it to mobile phones. <br><br>  But we wanted to play the second option. <br><br>  So microorganisms and Petri dishes were replaced by a distant planet, robots, and a mysterious alien organism. <br><br>  <u>Unsolicited banal advice number 3:</u> do what you want to play yourself. <br><br>  <u>Counter-Council:</u> if you have 3 mortgages and no other work, no one will blame you for doing something that sells well, but what you want to do is wash your eyes and hands with soap. <br><br><h3>  Crouching biomass, hidden worm </h3><br>  I mentioned the contrast of colors and shapes, and if you compare that sketch and the final version - the contrast only intensified.  Compare - the squares of our buildings, round enemy buildings, and the total roundness of the red mass. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/on/nl/o8/onnlo8hp_2mxhfnpd1mixvfd8-o.jpeg"></div><br>  By the way, the red mass, like almost everything in the game, somewhere inside the game logic fits into the grid in the same way as the blocks.  But at the same time it looks chaotic, as if it is untied from the grid. <br><br>  I have a <a href="https://alexeygrishin.github.io/ld-prepare/game7/bitmap3.html%3FcachedPointsList%3Dfalse%26debugPointsList%3Dfalse%26debugGrid%3Dtrue%26spawnDelay%3D1000%26showGrid%3Dtrue%26autoUpdate%3Dtrue%26useShaders%3Dtrue">demo</a> where I debug the appearance of biomass.  There everything is arranged in the following way: a conditional ‚Äúsquare‚Äù is taken and filled with circles of different sizes as closely as possible.  Below is an example of such a filling.  In the game itself, the filling is more dense (and therefore readable worse). <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-t/1f/ze/-t1fzegvyxfxolxcqzg7i4kalji.png"></div><br>  There are lines between the circles - connections.  If the biomass needs to grow into some cells, then suitable circles intersecting with the desired cells are selected, and growth occurs in them along the lines. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/yz/hk/gwyzhktmaoealwaw3vvo_mtgdwy.png"></div><br>  Here‚Äôs how it looks in motion: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/qa/x2/lkqax2obn1of0apprdpxcmsnlym.gif"></div><br><blockquote>  From the comments to the draft article: <br>  <i><a href="https://habr.com/users/icxon/" class="user_link">icxon</a> : I see this demo for the first time, lol</i> <br></blockquote>  In the game itself, everything works exactly the same, except that all sizes, colors and speeds are fitted by our artist to look better. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cf/ku/jt/cfkujtznryosbjbsxdcqpakilss.gif"></div><br>  Oh, I think I forgot to tell where exactly this decision came from, how the discussion stages went, the candidates were dismissed ... <br><br>  But no, I did not forget.  They were not there.  Initially, we planned to do everything as in the LD version, i.e.  growth in squares.  Just one evening I got bored, and I sketched this demo to practice.  And the guys went.  So did. <br><br>  <u>Unsolicited Tip number 4:</u> plans, plans, but do not be afraid to try something new.  Intuition can tell you some good solution. <br><br>  <u>Counter-Council:</u> if you have already set a release date and signed a contract with the publisher - perhaps you should not experiment. <br><br><h3>  Biomass animation </h3><br>  On the gifs above, you could notice the idle-animation of biomass ‚Äî even at rest, it ‚Äúbreathes‚Äù vigorously, the red buds seem to open and close back.  In an ideal world, it would be carefully drawn by the artist with animation sprites, which are arranged in the same pattern with circles.  In reality, it would be thousands of game objects that Phaser.js simply could not handle.  And this is already a proven fact - in the version with Ludum Dare I already came across hellish brakes when biomass filled at least half of the map, and there wasn‚Äôt even any idle animation there. <br><br>  A shader comes to the rescue, which spins on the GPU there and does not occupy the processor.  It is even better if this shader is really simple - then it will not load the video card too much. <br><br>  The shader needs to somehow talk about what and how to draw it.  What are the ways to transfer information to the shader: <br><br><ul><li>  Hardcode in the shader code itself.  In our case, it does not fit, but in general sometimes this option also makes sense to consider. <br></li><li>  Through uniform variables (these are variables that are the same for any pixel in the image) <br></li><li>  Through varying variables (variables that interpolate between two vertices) <br></li><li>  Through textures (color coding some values) <br></li></ul><br>  Method 3 could be useful to us, but in the case of Phaser.js it is not available to us.  You can‚Äôt convey a lot through uniform (say, an array of all circles with their radii in uniform will not fit - there are limitations).  Texture remains. <br><br>  The trick is: I first paint one state (say, closed buds) in blue: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2v/-z/di/2v-zdiq9rei61wbldpxjdu1keug.png"></div><br>  Then the second state (open buds) is red: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/go/5p/nt/go5pntkadhxlujbnj06_tawkp94.png"></div><br>  If you add them up, you get a purple mess: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s0/a3/zs/s0a3zseh0fjgjxulryakplhfvqi.png"></div><br>  The shader sees the texture, sees the current time, and with a certain period shows us the ‚Äúblue‚Äù state, then ‚Äúred‚Äù, smoothly flowing between them.  Well, by itself, applying the desired color palette.  It turns out like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-a/d-/gm/-ad-gmeivpaafw2x7rta_tdlyci.gif"></div><br><blockquote>  From the comments to the draft article: <br>  <i><a href="https://habr.com/users/a333/" class="user_link">a333</a> : Oh, here's how this b *** i f *** and works</i> <i><br></i>  <i><a href="https://habr.com/users/icxon/" class="user_link">icxon</a> : this is <a href="https://habr.com/users/icxon/" class="user_link">great</a> because I still haven't understood how it works</i> <br></blockquote>  The same, but using the example of rectangles: <br><br>  Texture: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cj/wy/c6/cjwyc6fuidzv6bjvglsxlbhq_mg.png"></div><br>  Final animation: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lu/-p/yq/lu-pyqbuhyn5wzlkyjtvfd3l6ni.gif"></div><br>  The texture is updated only as it grows / collapses, gpu-only animation works the rest of the time. <br><br><h3>  Player care </h3><br>  In the development process, we tried not to forget about the players who see our game for the first time.  It's not as easy as it seems - after a while the eye becomes blurred, and you begin to consider everything that you, as a developer, know, is obvious. <br><br>  We understood this, and therefore the first beta test was carried out as much as 8 months before the release - as soon as we had the first 10 levels ready and 40-50% of the content.  That beta test gave excellent feedback on level design, which I will talk about sometime next time.  At the same time, we learned that we ourselves quite well forecasted some moments. <br><br>  <i>Situation:</i> there is a player's base that must be defended - its destruction leads to the failure of the mission.  The player does not follow the base all the time - he watches his robot avatar.  And it follows constantly - the pace of the game is quite fast, there is not much time to stand and contemplate.  As a result, we, the testers, sometimes did not notice the enemy who came to the rear, bombing the base. <br><br>  <i>Solution:</i> first, we will show the damage on the base with concentric circles running through the half-card. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/iy/ka/3h/iyka3h19u7ekz7mclk8pnekqtqq.gif"></div><br>  Secondly, if the base is damaged significantly, then it independently strikes back, sweeping away the enemies, which is well marked and sounded.  This draws the player's attention to the problem, and gives time to take action. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zk/x-/h9/zkx-h93mzuwdl17lgs3ldht1jik.gif"></div><br>  <i>Situation:</i> as in a typical Tower defense, the enemies go the beaten path.  However, this route is not always guessed.  And to understand the route is very important for successful defense: some towers shoot very close, and a tower that is too close will be demolished by the next wave. <br><br>  <i>Solution:</i> draw blood after killing enemies.  After some time, a clear trace appears on the ground, which can be oriented: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oz/wc/fx/ozwcfx0osufeixfjaqkxtnxnipq.png"></div><br>  <i>Question:</i> and, actually, why the trodden route?  Are you not able to implement A *? <br><br>  <i>Answer:</i> implemented a bunch of times :) we honestly experimented with enemy AI.  We had smart worm-seekers and slimes dodging bullets.  It became impossible to play.  The player could not build an effective defense and could not rejoice, watching how it works.  The fun of the game plummeted.  This does not mean that ‚Äúsmart‚Äù enemies are bad.  Just for the chosen mechanics - when our buildings are static - such enemies did not fit.  For ‚Äúsmart enemies‚Äù you need to either attach a machine gun to a robot, or legs - to towers.  And this is a completely different game - not one that people liked on LD and itchio. <br><blockquote>  From the comments to the draft article: <br>  <i><a href="https://habr.com/users/icxon/" class="user_link">icxon</a> : But there are still slimes.</i>  <i>And they still dodge</i> <i><br></i>  <i><a href="https://habr.com/users/graal/" class="user_link">GRaAL</a> : think a bit of fiction</i> <br></blockquote>  <sup>They really are, but they dodge much more lazy than in the original version</sup> <br><br>  <i>Situation:</i> the enemy has long-range guns (mortars), which may be located outside the visibility of the player.  At the very beginning, almost the entire field was hidden behind the fog of war, because of which the arrival of enemy shells could go unnoticed - they flew out of the darkness and immediately inflicted damage.  If the player looked at this moment in a different direction, he could never understand what had happened. <br><br>  <i>Solution:</i> flying projectile can be seen above the fog of war.  This gives the player the opportunity to notice the threat and take action. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/39/zn/hs/39znhs_fwizn9x-1agfcfzphaqw.gif"></div><br>  By the way about the shells.  Distract from the gameplay-UX problems. <br><br><h3>  Collision handling </h3><br>  There were not so many moving objects in the LD version - a dozen bullets and a dozen worms at any one time.  In the game this was not enough.  In order to feel the challenge, you had to increase the number of opponents, and at the same time give the player a rapid-fire weapon to counter.  So the situation in the game is not uncommon: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t-/jw/jc/t-jwjcuxapeorqdmzpoyfvur1ro.png"></div><br>  For all game objects it is necessary to consider collisions.  Bullets crash into worms, worms crash into blocks, and all of them on the screen are sometimes several hundred.  And the guns should choose their goals in range.  If in the LD version we could afford to iterate over all enemies in search of suitable ones, here it was already beginning to slow down. <br><br>  In general, this problem has solutions, on Habr√©, I have repeatedly met articles on this topic (here‚Äôs <a href="https://habr.com/post/334990/">one of them</a> ).  Since we have a logical grid on the screen, and most of the active objects are no larger than 2x2 game cells, we decided to use this grid to determine collisions. <br><br>  Each cell is associated with a list of objects that are in this cell.  There are static objects (such as blocks or stones) that occupy exactly one cell entirely and do not move anywhere.  And there are dynamic ones that move along the grid, ‚Äúflowing‚Äù from one cell to another. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z3/uf/3s/z3uf3syywumwfzbbhk9oxtwcv1g.png"></div><br>  Since  the object can be somewhere on the border of two cells (although its center clearly lies within only one), then when considering collisions, all neighboring cells are examined.  Those.  we take a bullet with coordinates X, Y, and see what lies in the cells (X, Y), (X + 1, Y), (X-1, Y), (X, Y + 1), (X, Y -one).  If there are objects with which the pellet can interact, then already for each of them a collision is accurately calculated based on the shape and size. <br><br>  In order not to get up twice, the same grid is used to select goals for the towers.  The tower after creation ‚Äúsubscribes‚Äù to certain cells of the grid.  If something is hit in the cage that can be shot down, the tower receives a notification (and usually shoots after that).  Thus, if a thousand enemies are crawling obviously far from the tower, the tower will not spend time counting the distance to them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/wl/um/srwlumjqnh3qlbbahgeyajxx_q8.png"></div><br>  If the map is large, then there are too many cells in the grid, and all updates and checks start to take longer.  Also, problems start if there are any buildings / units the size of several cells - for them you have to check more cells around. <br><br>  To level these moments, we have a large, 16x16 cells on top of a fine grid.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> She considers everything to be the same, and she is used for quick screening of situations where there is nothing around a few cells around and there is no need to check for collisions. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Promised links and survey </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The article turned out to be quite long, and my list of topics in the notebook has decreased, God forbid, by a quarter. </font><font style="vertical-align: inherit;">Tell me what you would like to hear about in the next article? </font><font style="vertical-align: inherit;">You can vote for a few points. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, if suddenly there are any specific questions about how it's done, or why it's done - write in the comments. </font><font style="vertical-align: inherit;">Answer if you remember :) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links to the game:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protolife: </font></font><a href="https://graal.itch.io/protolife"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ludum Dare version on itch.io</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (free).</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protolife: </font></font><a href="https://store.steampowered.com/app/809440/Protolife/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">release version on Steam</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (for a fee, sorry).</font></font><br></li></ul><br>  Thank you all for your attention. </div><p>Source: <a href="https://habr.com/ru/post/429920/">https://habr.com/ru/post/429920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429910/index.html">AppsConf Rises</a></li>
<li><a href="../429912/index.html">Library development: from API to public release</a></li>
<li><a href="../429914/index.html">OpenSceneGraph: Scene graph and smart pointers</a></li>
<li><a href="../429916/index.html">How to build and build</a></li>
<li><a href="../429918/index.html">Intel Virtual World. Part 2: SMP</a></li>
<li><a href="../429922/index.html">How to turn a simple project into unfinished or cutting off all unnecessary</a></li>
<li><a href="../429926/index.html">Roskomnadzor: Google confirms willingness to comply with Russian legislation</a></li>
<li><a href="../429928/index.html">Everything you need to know about stress and strong emotions.</a></li>
<li><a href="../429930/index.html">Splunk. Easy Troubleshooting application work</a></li>
<li><a href="../429934/index.html">How is that?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>