<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical use of ROS on the Raspberry Pi - part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear readers of Habr! 

 I continue a series of articles on the practical use of ROS on the Raspberry Pi ( first article , second arti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical use of ROS on the Raspberry Pi - part 3</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear readers of Habr! <br><br>  I continue a series of articles on the practical use of ROS on the Raspberry Pi ( <a href="https://geektimes.ru/post/268876/">first article</a> , <a href="https://geektimes.ru/post/268928/">second article</a> ). <br>  In this article we will use the teleop_twist_keyboard package from the <a href="https://github.com/ros-teleop">ros-teleop stack</a> to control the robot by pressing the keys on the keyboard.  In addition to this package, the ros-teleop stack also includes several packages for various control methods, for example, using a joystick.  Who is ready to start studying teleop_twist_keyboard, please under the cat. <br><a name="habracut"></a><br><h4>  Multi Terminal with tmux </h4><br>  In the meantime, I want to tell you about one trick, which allows you to work remotely on a Raspberry Pi via SSH simultaneously in several terminals.  To do this, you need to install the tmux utility on the RPi. <br><br><pre><code class="bash hljs">$ sudo apt-get install tmux</code> </pre> <br>  After that, run the utility: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">$ tmux</code> </pre><br>  At the bottom of the terminal window should appear a green bar with the window number - 0. <br>  tmux is a very convenient terminal window manager that allows you to create any number of windows in a single terminal window, placing them in several different ways (a separate terminal window (window), window pane) and conveniently switch between them. <br><br>  Press Ctrl + B and C on the keyboard. Another window with the number 1 should open. Also try the combination Ctrl + B and%.  The current terminal window will be divided in the middle by a vertical green bar into two windows (pane).  If you press Ctrl + B ,: and enter ‚Äúsplit window‚Äù, the window will be split horizontally into two identical windows.  To remove a panel (pane), use the Ctrl + B, X combination and then press Y. To switch to another panel in the same window, use the Ctrl + B, O combination. To switch between the terminal windows by the window number, use the Ctrl + combination B, &lt;window number&gt;. <br><br>  Now we add the launch of the program to the ~ / .bashrc file to start automatically when the new terminal is opened.  Add the following lines to the file: <br><br><pre> <code class="bash hljs">[[ <span class="hljs-variable"><span class="hljs-variable">$TERM</span></span> != <span class="hljs-string"><span class="hljs-string">"screen"</span></span> ]] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> tmux</code> </pre><br><br><h4>  Work with the teleop_twist_keyboard package </h4><br>  Now let's get acquainted with the teleop_twist_keyboard package. <br>  Run the script teleop_twist_keyboard.py from the teleop_twist_keyboard package as a normal ROS node: <br><br><pre> <code class="bash hljs">$ roscore $ rosrun teleop_twist_keyboard teleop_twist_keyboard.py</code> </pre><br>  We get the following output: <br><br><pre> <code class="bash hljs">Reading from the keyboard and Publishing to Twist! --------------------------- Moving around: uio jkl m , . q/z : increase/decrease max speeds by 10% w/x : increase/decrease only linear speed by 10% e/c : increase/decrease only angular speed by 10% anything <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> : stop CTRL-C to quit</code> </pre><br>  Let's list all currently active topics: <br><br><pre> <code class="bash hljs">$ rostopic list</code> </pre><br>  The topic / cmd_vel should appear in the list.  The teleop_twist_keyboard node publishes messages to this topic each time a key is pressed on the keyboard. <br>  Let us show the output of messages published in the topic / cmd_vel: <br><br><pre> <code class="bash hljs">$ rostopic <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> cmd_vel</code> </pre><br>  Run rqt_graph to represent the computational graph ROS graphically.  The scheme of the computational graph shows all the active nodes and topics that connect them. <br><br><pre> <code class="bash hljs">$ rosrun rqt_graph rqt_graph</code> </pre><br><img src="https://habrastorage.org/files/4c8/27d/ea2/4c827dea2ec94f9cb7cc791eebd2a76c.png" alt="image"><br><br>  Here we see that the teleop_twist_keyboard node publishes messages to the topic / cmd_vel, and the rostopic node subscribes to this topic (the rostopic echo command). <br>  Let's find out what type of messages are published on the topic / cmd_vel: <br><br><pre> <code class="bash hljs">$ rostopic <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> /cmd_vel</code> </pre><br>  The command will print the line: <br><br><pre> <code class="bash hljs">geometry_msgs/Twist</code> </pre><br>  This means that the messages are of type Twist from the standard geometry_msgs ROS package. <br>  We can also get information about the message structure with the rosmsg command: <br><br><pre> <code class="bash hljs">$ rosmsg show geometry_msgs/Twist</code> </pre><br><br><pre> <code class="bash hljs">geometry_msgs/Vector3 linear float64 x float64 y float64 z geometry_msgs/Vector3 angular float64 x float64 y float64 z</code> </pre><br>  The field 'linear' is responsible for the linear velocity, 'angular' - for the angular velocity. <br>  Press the 'i' key, the output will be like this (associated with moving forward): <br><br><pre> <code class="bash hljs">linear: x: 0.5 y: 0.0 z: 0.0 angular: x: 0.0 y: 0.0 z: 0.0 ---</code> </pre><br>  Press the 'k' key, the output will be (stop): <br><br><pre> <code class="bash hljs">linear: x: 0.0 y: 0.0 z: 0.0 angular: x: 0.0 y: 0.0 z: 0.0 ---</code> </pre><br>  Press the 'u' key, the output will be (turn left): <br><br><pre> <code class="bash hljs">linear: x: 0.5 y: 0.0 z: 0.0 angular: x: 0.0 y: 0.0 z: 1.0 ---</code> </pre><br>  And finally, when pressing the 'o' key, we get the following conclusion (we turn right): <br><br><pre> <code class="bash hljs">linear: x: 0.5 y: 0.0 z: 0.0 angular: x: 0.0 y: 0.0 z: -1.0 ---</code> </pre><br>  The 'j' and 'l' keys are responsible for turning left and right in place (without moving forward). <br><br><h4>  Controlling the robot from the keyboard with teleop_twist_keyboard </h4><br>  I have already written a rosserial sketch for controlling the robot through keystrokes.  We simply subscribe to the topic / cmd_vel and, depending on the received value of each of the speeds, give the necessary command to the motion controller (move forward, stop, turn left or right).  The sketch can be downloaded <a href="https://github.com/vovaekb/driverobot_ros/tree/master/driverobot_teleop_twist/driverobot_teleop">from here</a> . <br>  Let's look at the sketch code in more detail. <br>  At the beginning of the file, in addition to the standard ros.h header file, we include two additional files with the message types geometry_msgs / Twist.h and geometry_msgs / Vector3.h: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;geometry_msgs/Twist.h&gt; #include &lt;geometry_msgs/Vector3.h&gt;</span></span></span></span></code> </pre><br>  We declare the ros :: NodeHandle node handler: <br><br><pre> <code class="cpp hljs">ros::NodeHandle nh;</code> </pre><br>  The messageCb method is of primary importance: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">messageCb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> geometry_msgs::Twist&amp; message)</span></span></span><span class="hljs-function"> </span></span>{ geometry_msgs::Vector3 linear = message.linear; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> forward_vel = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(linear.x); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(forward_vel == <span class="hljs-number"><span class="hljs-number">0</span></span>) { stop(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } geometry_msgs::Vector3 angular = message.angular; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ang_vel = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(angular.z); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ang_vel &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { turnLeft(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ang_vel &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { turnRight(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { goForward(); } }</code> </pre><br>  In this method, we process the message we receive from the cmd_vel topic.  In the variable forward_vel we keep the linear speed, in the variable angular - the angular.  Linear speed allows us to track the stop command (value 0).  The angular velocity determines the direction of rotation (if more than 0, then we turn left, less than 0 - to the right, if 0 - we move forward). <br>  Create a subscriber for the topic / cmd_vel: <br><br><pre> <code class="cpp hljs">ros::Subscriber&lt;geometry_msgs::Twist&gt; sub(<span class="hljs-string"><span class="hljs-string">"/cmd_vel"</span></span>, &amp;messageCb);</code> </pre><br>  with reference to the message processing method (messageCb) and the type of message received - geometry_msgs :: Twist. <br>  At the end of the script, follow the standard sketch methods for rosserial_arduino: <br><br><pre> <code class="cpp hljs">nh.initNode(); nh.subscribe(sub); Serial.begin(<span class="hljs-number"><span class="hljs-number">57600</span></span>);</code> </pre><br>  Run the rosserial_arduino server: <br><br><pre> <code class="bash hljs">$ rosrun rosserial_python serial_node _port:=/dev/ttyACM0</code> </pre><br>  and upload the sketch to the Arduino board. <br><br>  Switch to the terminal where the teleop_twist_keyboard node is running, try pressing the 'u', 'i', 'o' and 'k' keys and check the output of the rosserial server in the terminal. <br><br>  Thus, using the teleop_twist_keyboard package, we can now perform simple remote control of the robot by transmitting motion commands: move forward, stop, turn left or right.  In the future, we will learn to control the robot with a joystick, which is much more convenient, using a different package in ROS.  But more about that in the next article. </div><p>Source: <a href="https://habr.com/ru/post/390851/">https://habr.com/ru/post/390851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../390839/index.html">Bryansk doctors were forbidden to work with social networks and foreign communication services</a></li>
<li><a href="../390841/index.html">In the case of the Playpen child pornography site, a judge ordered the FBI to disclose a hacking technique. Tor</a></li>
<li><a href="../390843/index.html">Project "Eye" Part 16</a></li>
<li><a href="../390845/index.html">Bb-mobile Topol 'LTE 8-inch ‚ÄúThermonuclear‚Äù Tablet Review</a></li>
<li><a href="../390849/index.html">US customs officials began to remove the biometrics of people crossing the US border on foot</a></li>
<li><a href="../390853/index.html">Most often, managers tried to steal confidential information from their own company in 2015</a></li>
<li><a href="../390855/index.html">The Milky Way was studied in the submillimeter range. ATLASGAL project completed</a></li>
<li><a href="../390857/index.html">LG G5 has a modular design, a removable battery and a Smart Controller for drones.</a></li>
<li><a href="../390859/index.html">Ventilation system based on the "raspberry" and "CO2 Detector"</a></li>
<li><a href="../390863/index.html">Video: Broadcast Samsung Galaxy line update</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>