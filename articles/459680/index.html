<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In the footsteps of Highload ++ Siberia 2019 - 8 tasks for Oracle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 June 24-25, Novosibirsk hosted the Highload ++ Siberia 2019 conference. Our guys were also there the report "Oracle Container Databases (CDB...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In the footsteps of Highload ++ Siberia 2019 - 8 tasks for Oracle</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  June 24-25, Novosibirsk hosted the Highload ++ Siberia 2019 conference. Our guys were also there the <a href="https://www.highload.ru/siberia/2019/abstracts/5211">report</a> "Oracle Container Databases (CDB / PDB) and their practical use for software development," we will post the text version a little later.  It was great, thanks to <a href="https://habr.com/ru/users/olegbunin/" class="user_link">olegbunin</a> for the organization, as well as to all who came. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/k4/u1/-7k4u1btcjxquu515qeoyxnxigu.jpeg" width="350"></div><br>  In this post, we would like to share with you the tasks that were on our stand, so that you can test your knowledge in Oracle.  Under the cut - 8 tasks, answers and explanations. <br><a name="habracut"></a><br><h3>  What is the maximum value of the sequence, we will see as a result of the following script? </h3><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> s.currval, s.nextval, s.currval, s.nextval, s.currval <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> </pre> <br><ul><li>  one </li><li>  five </li><li>  ten </li><li>  25 </li><li>  No, there will be a mistake </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  According to the Oracle documentation (cited from 8.1.6): <br>  Within a single SQL statement, Oracle will increment the sequence only once per row.  If the statement contains a statement, it will give you an error.  If it is a statement, it contains the CURRVAL and NEXTVAL options, it is the same as the order for the statement. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, the <b>maximum value will correspond to the number of rows, that is, 5</b> . <br></div></div><br><h3>  How many rows will be in the table as a result of the following script? </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> p(p_from <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, p_to <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> p_from .. p_to <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (i); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; / exec p(1, 3); exec p(4, 6); exec p(7, 9);</code> </pre> <br><ul><li>  0 </li><li>  3 </li><li>  four </li><li>  five </li><li>  6 </li><li>  9 </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  According to the Oracle documentation (cited from 11.2): <br><br>  Before executing any SQL statement, Oracle marks an implicit savepoint (not available to you).  Then, if you‚Äôre a statement, you‚Äôll be able to go ahead.  For example, the statement is rolled back. <br><br>  The call to the client is also considered and processed as a single statement.  Thus, the first CP call is successfully completed by inserting three entries;  The second call to the HP ends with an error and rolls back the fourth record, which it managed to insert;  the third call fails, <b>and there are three entries in the table</b> . <br></div></div><br><h3>  How many rows will be in the table as a result of the following script? </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> i_ch <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">5</span></span>); exception when others then dbms_output.put_line('Oops!'); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; /</code> </pre> <br><ul><li>  one </li><li>  2 </li><li>  3 </li><li>  four </li><li>  five </li><li>  6 </li><li>  7 </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  According to the Oracle documentation (cited from 11.2): <br><br>  You must satisfy.  TRUE or unknown (due to a null).  When Oracle evaluates a check line for a particular row, it indicates. <br><br>  Thus, the null value passes the check, and the anonymous block will be successfully executed until an attempt is made to insert the value 3. After this, the error-handling block will clear the exception, no rollback will occur, and <b>the table will contain four rows</b> with the values ‚Äã‚Äã1, null, 2 and again null. <br></div></div><br><h3>  What pairs of values ‚Äã‚Äãwill occupy the same amount of space in the block? </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t ( a <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), b <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), c <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), i <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>), j <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>(<span class="hljs-number"><span class="hljs-number">14</span></span>), k <span class="hljs-built_in"><span class="hljs-built_in">number</span></span>(<span class="hljs-number"><span class="hljs-number">24</span></span>), x varchar2(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), y varchar2(<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), z varchar2(<span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t (a, b, i, j, x, y) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'Y'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre><br><ul><li>  A and X </li><li>  B and Y </li><li>  C and K </li><li>  C and Z </li><li>  K and Z </li><li>  I and j </li><li>  J and X </li><li>  All listed </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  We present excerpts from the documentation (12.1.0.2) on the storage of various types of data in Oracle. <br><br>  <b>CHAR Data Type</b> <br>  The CHAR data type specifies a fixed-length character string in the database character set.  You can specify your database character set.  Oracle ensures that column lengths are measured in a column of semantics.  If you insert the value of the column length <br><br>  <b>VARCHAR2 Data Type</b> <br>  The VARCHAR2 data type specifies a variable-length character string in the database character set.  You can specify your database character set.  If you‚Äôre logging in, you can‚Äôt give it a copy of it. <br><br>  <b>NUMBER Data Type</b> <br>  It is not necessary to make sure that it is a valid value. 10126, then Oracle returns an error.  Each NUMBER value requires from 1 to 22 bytes.  It can be calculated using the following formula: <i>ROUND ((length (p) + s) / 2)) + 1</i> where s equals zero if the number is positive, and s equals 1 if the number is negative. <br><br>  In addition, we take an excerpt from the documentation about storing Null ‚Äì values. <br><br>  A value of a column.  Nulls indicate missing, unknown, or inapplicable data.  Nulls are stored between the lines with data values.  In these cases, they require a column of (zero).  There is no need to keep track of the number of lines.  For example, if this is the case, the table is null, then no data is stored for these columns. <br><br>  Based on these data, we build reasoning.  We assume that the database uses the AL32UTF8 encoding.  In this encoding, Russian letters will occupy 2 bytes. <br><br>  1) A and X, the value of the a 'Y' field is 1 byte, the value of the x 'D' field is 2 bytes <br>  2) B and Y, 'Vasya' in b will be added with spaces up to 10 characters and will take 14 bytes, 'Vasya' in d will take 8 bytes. <br>  3) C and K. Both fields are NULL, there are significant fields after them, so they take 1 byte each. <br>  4) C and Z. Both fields are NULL, but the Z field is the last in the table, so it does not take up space (0 bytes).  Field C is 1 byte. <br>  5) K and Z. Similar to the previous case.  The value in the K field is 1 byte, in Z - 0. <br>  6) I and J. According to the documentation, both values ‚Äã‚Äãwill take 2 bytes each.  We consider the length according to the formula taken from the documentation: round ((1 + 0) / 2) +1 = 1 + 1 = 2. <br>  7) J and X. The value in the J field will take 2 bytes, the value in the X field will take 2 bytes. <br><br>  <b>So the correct options are: C and K, I and J, J and X.</b> <br></div></div><br><br><h3>  What about the clustering factor of the T_I index? </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t (i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">10000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> t_i <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t(i);</code> </pre><br><ul><li>  About tens </li><li>  About hundreds </li><li>  About a thousand </li><li>  About tens of thousands </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  According to the Oracle documentation (cited from 12.1): <br><br>  For a B-tree index, this is the index. <br><br>  If you are searching for a list of factors, it will help you.  A low clustering factor indicates an efficient index scan. <br><br>  In this case, it can be seen that the  If the database performs a full table scan, then the database scans by the index key.  The number of rows is scattered randomly across the database key.  If the database performs a full table scan, then it won‚Äôt retrieve the rows. <br><br>  In this case, the data is perfectly sorted, so the clustering factor will be equal to or close to the number of occupied blocks in the table.  For a standard block size of 8 kilobytes, it can be expected that the order of a thousand narrow number numbers will fit in one block, so the number of blocks, and as a result, the clustering factor will be of the <b>order of tens</b> . <br></div></div><br><h3>  At what values ‚Äã‚Äãof N will the next script be successfully executed in a regular database with standard settings? </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t ( a varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), b varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), c varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>), d varchar2(N <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> t_i <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t (a, b, c, d);</code> </pre><br><ul><li>  100 </li><li>  200 </li><li>  400 </li><li>  800 </li><li>  1600 </li><li>  3200 </li><li>  6400 </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  According to the Oracle documentation (cited from 11.2): <br><br>  Logical database limit <br><br><div class="scrollable-table"><table><thead><tr><td>  <strong>Item</strong> </td><td>  <strong>Type of Limit</strong> </td><td>  <strong>Limit value</strong> </td></tr></thead><tbody><tr><td>  Indexes </td><td>  Total size of indexed column </td><td>  75% of the database block minus some overhead </td></tr></tbody></table></div><br>  Thus, the total size of the indexed columns should not exceed 6Kb.  Further depends on the selected encoding base.  For the AL32UTF8 encoding, one character can occupy a maximum of 4 bytes, so 6 kilobytes in the worst case will fit around 1500 characters.  Therefore, Oracle will prohibit the creation of an index with N = 400 (when the key length in the worst case is 1600 characters * 4 bytes + rowid length), while <b>with N = 200 (and less),</b> creating the index will work without problems. <br></div></div><br><h3>  The INSERT statement with hint APPEND is designed to load data in direct mode.  What happens if it is applied to the table on which the trigger hangs? </h3><br><ul><li>  The data will be loaded in direct mode, the trigger will work as it should </li><li>  Data will be loaded in direct mode, but the trigger will not be executed. </li><li>  The data will be loaded in conventional-mode, the trigger will work as it should </li><li>  The data will be loaded in conventional mode, but the trigger will not be executed. </li><li>  Data will not be loaded, an error will be fixed </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  In principle, this is a question of more logic.  To find the right answer, I would suggest the following model of reasoning: <br><br><ol><li>  The insert in direct mode is performed by the direct formation of a data block, past the SQL engine, which ensures high speed.  Thus, ensuring the execution of a trigger is very difficult, if not impossible, and there is no point in this, since it will still drastically slow down the insertion. </li><li>  Failure of the trigger will lead to the fact that with identical data in the table, the state of the database as a whole (other tables) will depend on the mode in which this data is inserted.  This will obviously destroy data integrity and cannot be applied as a solution in production. </li><li>  The inability to perform the requested operation is generally treated as an error.  But here it should be remembered that APPEND is a hint, and the general logic of hints is that they are taken into account if possible, and if not, the operator is executed without taking into account the hint. </li></ol><br>  Thus, the expected response - the <b>data will be loaded in normal (SQL) mode, the trigger will work.</b> <br><br>  According to the Oracle documentation (cited from 8.04): <br><br>  If you want to use it, it will be possible to use it, it will use it, it will use it,  Once there is a transaction in which you can receive error messages. <br>  For example, if you are trying to use direct-load INSERT (serial or parallel), if you need to do this </div></div><br><h3>  What happens when the next script is executed? </h3><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(i <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, j <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">references</span></span> t); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trigger</span></span> t_a_i <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pragma</span></span> autonomous_transaction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (:new.i + <span class="hljs-number"><span class="hljs-number">1</span></span>, :new.i); <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; / <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre><br><ul><li>  Successful execution </li><li>  Failed due to syntax error. </li><li>  Autonomous transaction invalid error </li><li>  The error associated with exceeding the maximum call nesting </li><li>  Error related to foreign key violation </li><li>  Lock error </li></ul><br><div class="spoiler">  <b class="spoiler_title">Answer</b> <div class="spoiler_text">  The table and the trigger are created quite correctly and this operation should not lead to problems.  Autonomous transactions in the trigger are also allowed, otherwise it would be impossible, for example, logging. <br><br>  After inserting the first line, a successful trigger would trigger the insertion of the second line, so the trigger would work again, insert the third line, and so on until the statement crashes due to exceeding the maximum call nesting.  However, another delicate moment works.  At the time of execution of the trigger for the first inserted record is not yet committed.  Therefore, a trigger that works in an autonomous transaction tries to insert a row in the table that is referenced by a foreign key to a record that is not yet committed.  This leads to a wait (an autonomous transaction waits for the main commit to see if data can be inserted) and at the same time the main transaction waits for the autonomous commit to continue working after the trigger.  <b>There is a deadlock and as a result - an autonomous transaction is shot for the reason associated with locks</b> . <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/459680/">https://habr.com/ru/post/459680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45967/index.html">Problem when using OutputCache in CustomControl</a></li>
<li><a href="../459670/index.html">GOTO Amsterdam</a></li>
<li><a href="../459672/index.html">Python underline</a></li>
<li><a href="../459674/index.html">Epic Intelligence Intelligence Saga</a></li>
<li><a href="../45968/index.html">widget do it yourself</a></li>
<li><a href="../459682/index.html">The quality of data in the repository</a></li>
<li><a href="../459684/index.html">Map of Moscow and the whole world for Android</a></li>
<li><a href="../459688/index.html">Urbanism in China: fewer hipsters, more science and IT</a></li>
<li><a href="../459692/index.html">As we discovered material modifications that contradict well-established chemical principles</a></li>
<li><a href="../459694/index.html">DataArt Museum. Unpacking and launching Radio-86RK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>