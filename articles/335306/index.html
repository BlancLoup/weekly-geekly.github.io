<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A few words about testing complex hardware systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. Today I want to talk to you about iron testing - with painful examples and photos from everyday practice. This harsh reality with soldering, debu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A few words about testing complex hardware systems</h1><div class="post__text post__text-html js-mediator-article">  Hey.  Today I want to talk to you about iron testing - with painful examples and photos from everyday practice.  This harsh reality with soldering, debugging and burned chips is usually all ruthlessly lacquered, telling only about successes - people responsible for PR and marketing are usually afraid of any mention of mistakes and failures like fire.  But engineers understand that complex complexes are not born immaculate right away, so we are not afraid to tell you about testing as it is.  Well, to share experiences, what to do and what to avoid. <br><br> <a href="https://habrahabr.ru/post/335306/"><img src="https://habrastorage.org/web/053/f37/6e2/053f376e28af430da51312693389e92c.jpg"></a> <br><a name="habracut"></a><br><br><h2>  Preliminary preparation </h2><br>  <i>- Everyone please observe the fastener belt and no smoking signs have been turned on.</i>  <i>Sit back and enjoy your ride.</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, in order. <br>  Testing is carried out at all stages of the life of the equipment.  Testing happens initial (bringup), component, functional, load, production, and even testing at customers. <br><br>  At the development stage of the equipment, the engineer thinks about how he will revive his brainchild.  Boards are sprinkled with test points, debug connectors, jumpers, spare parts for spare parts and the like.  The set of testing capabilities incorporated into the hardware is called DFT (Design for Testability).  A board released in the DFT phase may contain twice as many components as a board that has been released in circulation.  Naturally, following the principle of ‚Äúwork - do not touch‚Äù, then no one redoes it, and the end consumer puzzledly examines empty seats on the motherboard from the store, inventing various conspiracy theories about their purpose. <br><br><img src="https://habrastorage.org/web/d05/6c5/bdd/d056c5bdda804ede874e78b02282673d.jpg"><br><br>  So, our board was taken from the factory - what to do next?  Well, of course - plug into the outlet and release all white smoke from it. <br><br><img src="https://habrastorage.org/web/224/881/7ca/2248817ca1e745d78976ea5c04f80cdc.jpg"><br>  <i>- Everybody falls the first time.</i> <br><br>  A photo from the Internet, we did not find any burned boards, but I confess - sometimes this is done.  In my memory there is an old story when a curious system architect sat and selected at random which connectors needed to plug a phase, neutral and earth (well, he didn‚Äôt have time to look into the scheme), and the developer sat next to him and caught the pale. <br><br>  But usually everything happens differently.  The first phase of testing - bringup (popularly "revive"). <br><br><h2>  <s>Reviving</s> Birth </h2><br>  <i>- Wake up, Neo ...</i> <br><br>  For bringup, usually 3-5 samples are made (in the hope that at least two will be destroyed in the delirium delirium).  If the device contains expensive chips, they are not installed on one of the samples.  Fab can offer you to save on gold - DO NOT AGREE TO ANY KIND (or you just have to solder a lot and often). <br><br><img src="https://habrastorage.org/web/6ec/b78/a18/6ecb78a18ee24008915e3c0fb460e4d3.jpg"><br><br>  A motherboard without a chip is the first candidate for slaughter.  It checks the power-on sequence, faults, voltage ratings and so on.  Then this fee is an organ donor and / or a testing ground for testing all hypotheses.  Also, before you include something, you must: <br><br><ul><li>  ring the ground-food, there is often a short circuit; </li><li>  visually inspect the board - the polarity of the capacitors is easily confused, the chips are upside down, chips are present, you can easily find passive components that have been torn off; </li><li>  study separately - but didn‚Äôt you put on the board the components that you asked not to install (life hacking: do not make the black mask on the first samples - it doesn‚Äôt see if the chip resistors are installed or not). </li></ul><br>  We played enough with the first victim - go to let the smoke out of combat pay.  At the same time, you need to stock up on a pilot with a power cut-off button and a thermal imager.  The pilot must be put under his foot, in case his hands beat 220 V (well, or just his hands are busy), and in the thermal imager you can see a short circuit. <br><br><img src="https://habrastorage.org/web/49e/53b/9bd/49e53b9bd8584f4dae5728456afc7200.jpg"><br><br>  But in general, when you first turn on, you can usually not be afraid - it most likely will not turn on, since you probably forgot to rewire components that have legs in the design: <br><br><img src="https://habrastorage.org/web/2ae/4f4/2be/2ae4f42be94b40a6bcb4687ee195845a.jpg"><br><br>  And solder a little wire: <br><br><img src="https://habrastorage.org/web/7e8/4fa/1b0/7e84fa1b04824908b7e63a79de4bfd77.jpg"><br><br>  Hot-melt glue is our everything, the best friend of the developer, almost like a scotch in ordinary life. <br>  Immediately after Dremel: <br><br><img src="https://habrastorage.org/web/d36/4c5/dff/d364c5dff9b648e99c7c71911dd6dfd8.jpg"><br><br>  And the hammer, which has to hammer in the board, doesn't always come out neatly. <br><br><img src="https://habrastorage.org/web/e84/d18/319/e84d1831957048b2be36e73a4e4c6d07.jpg"><br><br><img src="https://habrastorage.org/web/769/4b3/d72/7694b3d72f6d47fca726f33316d6e445.jpg"><br><br>  Sometimes you have to do a patient x-ray or tomography.  It looks like this: <br><br><img src="https://habrastorage.org/web/f86/6f0/d04/f866f0d0426d49ce9916cb16704c40ae.jpg"><br>  <i>Scanning the film, it turns out, is not very easy.</i>  <i>They took the phone on the ground opposite the window.</i> <br><br>  Specifically, in this picture you can not see anything - do not peer.  But in general, on the X-ray, you can see the insolation, cracks and so on. <br><br>  Separately it is necessary to say about bring up motherboards, because it is done differently.  DFT samples of mothers are usually ordered a lot - about 20 pieces.  It is expensive, so there is a strategy here. <br><br>  Developers are taken and sent to the factory.  About 5 boards gather and the conveyor stops.  Next, the developers have about 30 minutes to enable the board (for x86 systems, the success criteria is to load the BIOS).  If everyone is lucky, other samples are collected.  If not, production is canceled, and the developers are going home to think.  The money spent on the PCB is lost, but the components are waiting at the warehouse for the next attempt. <br><br>  Good - we launched our board, and even launched others that should work with it.  What's next?  We collect the stand. <br>  And then you probably expect to see this? <br><br><img src="https://habrastorage.org/web/d78/f6d/e94/d78f6de94cf343d285f710f5355144ed.jpg"><br><br>  This is all window dressing for deputy ministers.  This stand should be assembled from sticks and acorns, and looks like this: <br><br><img src="https://habrastorage.org/web/08c/99c/cc7/08c99ccc7e0a481d9a7832d766448e5f.jpg"><br>  <i>- I didn't say it would be easy, Neo.</i>  <i>I just said it would be the truth.</i> <br>  (a glass for a counterweight, a felt-tip pen - so that the radiator is sitting on it - it is wound there with a wire) <br><br>  Or so: <br><br><img src="https://habrastorage.org/web/c1c/3db/ba7/c1c3dbba753a4e98a0f1e25fa90e6f67.jpg"><br><br>  This horde is stuffed into the laboratory: <br><br><img src="https://habrastorage.org/web/502/aec/0fd/502aec0fd076460f816e807767691406.jpg"><br><br>  And everyone starts to race to sew up their firmware, programs, and poke everywhere with an oscilloscope. <br>  Sometimes in the process, the polite request ‚ÄúDear colleague, please remove the soldering iron from my hand - it‚Äôs very hot‚Äù or ‚ÄúBe so kind - no longer turn on the power supply when I screw the board to the chassis‚Äù. <br><br>  As our <a href="http://yadro.com/">website</a> says: <br><br><img src="https://habrastorage.org/web/b79/fff/6d6/b79fff6d61824627a99bf1487d168eea.jpg"><br><br>  In our particular case, the main purpose of verifying the joint operation of several devices is to find out whether PCI Express is working, whether it meets the standard.  Just without everything else, in principle, you can live.  Usually the functionality laid in the piece of hardware is redundant.  Tons of GPIO pins, I2C / SPI tires, thermal sensors, ice and other things, as a rule, remain unclaimed, as they are postponed for debugging at the last moment, which never occurs. <br><br>  Naturally, we don‚Äôt have measuring instruments for every million rubles for each case - this is for the weak.  We are in a hurry to help test software from manufacturers of components.  Almost all modern chips with high-speed interfaces have a digital oscilloscope inside.  To him relies specialized software that allows you to read his testimony.  Run and watch eye diagrams.  We see this: <br><br><img src="https://habrastorage.org/web/981/aeb/168/981aeb1681a84d04b9acace88fe6bbe1.png"><br><br>  Sometimes we see a dangerous squint: <br><br><img src="https://habrastorage.org/web/c89/115/dca/c89115dca8f44a058a4f014bf8e797ef.png"><br><br>  And sometimes we catch squid: <br><br><img src="https://habrastorage.org/web/607/447/ce2/607447ce27d54ee1b3e7c1c304ba20cb.png"><br><br>  Squids are the most dangerous.  These are nonlinear distortions, and the built-in equalizers do not know how to deal with this.  Squids mean that somewhere in the communication channel there is something very bad - a too long vias, a significant impedance drop, some unevenness in 1/4 or 1/2 wavelength of some harmonics in the useful band, etc. like that <br><br>  Someone may notice that the squid is a bit like what it does with the received DFE signal in the PCIe receiver's equalizer.  But in this case it‚Äôs still a squid, and not the result of the DFE work (just the result of the DFE work, the software we use cannot display). <br><br>  Separately, I must say about the test software, which is also extremely insidious.  For example, to remove eye diagrams, we use two versions of the same program - one version draws pictures, but does not write the meaning of opening the eyes, the second - vice versa. <br><br>  Well, yes - if you plan to shoot your eyes on the I2C interface - forget it will be very, very slow.  Only in-band.  The problem is that for in-band removal your device should have a working PCIe link with the computer where the test software works, which is quite problematic when your piece of hardware is not installed in a standard PCIe slot.  And the funny thing is that you should already have at least a working link on the channel that you are debugging, and it is in the mode (gen2 / 3) in which you need (for different eyes have different eyes and equalizers work in different ways) ).  No <s>legs, no</s> link <s>cartoons</s> , no eyes - this is how you want, and get out. <br><br><img src="https://habrastorage.org/web/65a/e5c/793/65ae5c7934b04c148e778ca423a0b908.png"><br><br>  About how to get out of a PCIe - I previously wrote a separate <a href="https://habrahabr.ru/company/yadro/blog/314364/">article</a> . <br><br>  In general, when developing a server, of course, support from the manufacturers of the components used is very important, since today the complexity of even relatively simple chips is such that it is unlikely to fully test and debug the system without using the test products built into them.  Clock generators, voltage regulators, network controllers, PCI Express switches, redrivers - all this has built-in tools for tuning, diagnostics, and needs a certain set of programs and cables for connecting for full configuration and testing, without the use of which development becomes simply impossible. <br><br>  In the process of conducting inspections, it sometimes turns out that somewhere something goes wrong.  And then begins the fascinating process of localizing the error so that it can be fixed in the next revision.  And it‚Äôs good if this ‚Äúnot so‚Äù is consistently repeated - then it is usually not difficult to find out exactly what is the cause of the error.  But sometimes things are much worse.  For example, on some copies of the boards during a long run of tests, there are single uncorrectable errors on the bus (which should not be completely).  And here it is often necessary to apply the ‚Äúgaze‚Äù method ‚Äî that is, just to sit, hypothetically looking at the scheme, to assume what exactly might be the cause, try to eliminate this hypothetical reason in the scheme, and test it to verify whether we guessed or not. <br><br>  We encountered this a few years ago, when NVIDIA tests (yes, many manufacturers provide specific test suites that allow you to test things that are not programmatically accessible using standard utilities) gave rare single errors during long (24 hours or more) runs on some board instances. .  Then the whole thing turned out to be an unsuccessful trace of the reference clock (100 MHz) - although before we arrived at this, a lot of things were checked, starting with the quality of the power and ending with eye diagrams along all lines. <br><br>  And by the way, this is good.  The biggest nightmare of the developer - when everything works right away.  This means only one thing - a mine is buried somewhere, which will work after the shipment of 100,500 pieces of equipment to the customer.  The fact is that in the process of searching for the cause of a global problem, several hypotheses are tested and, as a rule, many minor faults are identified that have nothing to do with the problem that has arisen.  There is no big problem - you will not find small ones.  Your customers will find them for you. <br><br><h2>  Check list </h2><br>  <i>- All the words I do.</i> <br><br>  After completing the component tests, functional testing begins - testing the operability of the complex as a whole and the correct operation of all the embedded functions.  This is usually done by QA.  The scope for creativity here, of course, is very extensive, but in general, the main emphasis is placed on the correct operation of the system when playing standard usage scenarios.  Here, the detected errors may already have both a hardware and a software nature, so it is first of all important to find out what caused the error.  Often, the first assumptions can be deceptive, that is, obviously a hardware problem at first glance may be caused by incorrect operation of the firmware.  A significant part of the functional testing is checking how the system handles a variety of errors that may occur during operation.  Modern debugging tools allow artificially injecting errors into standard processor interfaces, because at the iron level many of them are specifically problematic to create (well, don‚Äôt tear off the memory chips on the fly or close the PCI Express bus lines). <br><br>  And ... I did not say that functional testing does not mean an assembled system ready for battle.  Here, too, everything is not going smoothly.  At some point, it turned out that we didn‚Äôt have OcuLink cables of the required length, and the server had guts. <br><br><img src="https://habrastorage.org/web/ecc/2c0/c21/ecc2c0c212194f3bbc40b9392cf5371d.jpg"><br><br>  And for some reason, in such a configuration with a load test, everything began to overheat.  We are still wondering why.  Cables were heated, I guess. <br><br><h2>  And you can carry two watermelons in each hand? </h2><br>  <i>- You're faster than this.</i>  <i>Don't think you are, you know ...</i> <br><br>  At some point, in parallel with the functional testing, load testing begins - it is important to make sure that the server continues to function correctly in the limiting operating modes.  Moreover, load tests are carried out both in relation to individual subsystems (disks, memory, processors, input-output), and on the entire system as a whole.  As a rule, localized tests make it possible to load one specific module more strongly than can be done at maximum load on the entire system. <br><br>  In addition, debugging tools from the manufacturer of the hardware platform (for example, Hardware Tests Executive from IBM) help here.  Thus, it is possible to drive the processor into quite limiting modes, which are fundamentally unattainable when working with real applications.  The main problems detected during load testing are overheating, power instability or overcurrent overload, errors during active work with input-output interfaces. <br><br>  Also come to the aid benchmarks.  Because when the real value of the benchmarks is very different from the predicted - then something went wrong.  A good reason to go poke board chopstick. <br><br>  At the testing stage, we mainly use microbench marks: <br>  For processors, these are usually single-threaded loads, such as <b>spec2006</b> (now <b>speccpu2017</b> ), <b>parsec</b> , but in general there is a huge amount of them from linux assembly and compression ( <b>lzma</b> , <b>gzip</b> ) to matrix multiplication and fast Fourier transform calculation ( <b>fftw</b> ). <br>  Nothing has changed for memory for many years: <b>STREAM</b> , <b>RAMspeed SMP</b> , <b>lmbench</b> . <br><br>  For drives: <b>fio</b> , <b>iozone</b> . <br><br>  If all functional and load tests pass successfully, there are still a number of things that need to be checked - stability over the entire temperature range, resistance to vibration, compatibility check with a specific set of standard components (memory, disks, PCI Express controllers). <br><br>  PS: After we checked everything and were delighted with the functional tests of the first server revision, three servers suddenly collapsed in our laboratory.  We started checking the power supply and on the 1.2V line (powering the PCIe processor bus), we saw this: <br><br><img src="https://habrastorage.org/web/6f3/9a6/9d3/6f39a69d38f04293bee4c79c3491f88e.jpg"><br><br>  I focus your attention - one cell 500mV.  Nominal 1.2 V. Resistor made a mistake in the compensation circuit of one of the VRM.  It was with such nutrition that all load tests, benchmarks, fryers, and the like were successfully passed, and the design happily went to the second revision. <br>  So, when the death screen suddenly appears on your cozy home computer of a well-known brand, you shouldn‚Äôt think that this is ‚Äúbuggy Windows‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/335306/">https://habr.com/ru/post/335306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335292/index.html">What the hell is javascript</a></li>
<li><a href="../335294/index.html">Apache Ignite 2.1 - now with Persistence</a></li>
<li><a href="../335298/index.html">How to choose the right laptop for programming</a></li>
<li><a href="../335300/index.html">BanMoron - a tool to actively protect the WEB-server from hacking</a></li>
<li><a href="../335304/index.html">Combining actors and the SEDA approach: why and how?</a></li>
<li><a href="../335314/index.html">Startup of the day (July 2017)</a></li>
<li><a href="../335318/index.html">Angular 4 Material. Part 1 - Creating and Configuring a Project</a></li>
<li><a href="../335324/index.html">Vivaldi 1.11 - the desire for comfort</a></li>
<li><a href="../335326/index.html">Load Average in Linux: Solving the Mystery</a></li>
<li><a href="../335328/index.html">IOS UI tests: why you need to believe in QA friendship and development, but don't flatter yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>