<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Console cucumber and capybara with Selenium and Hudson</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nowadays, software developers can't live without their favorite test frameworks. But what developers don't want is to ensure that these tests run cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Console cucumber and capybara with Selenium and Hudson</h1><div class="post__text post__text-html js-mediator-article">  Nowadays, software developers can't live without their favorite test frameworks.  But what developers don't want is to ensure that these tests run continuously.  Also, the development teams do not want to spend time bringing the test results to everyone. <br><br>  There are more and more useful applications, libraries and plug-ins, which partially alleviate the headache that arises during attempts to make tests useful for the whole team.  Examples of excellent tools that we have at our disposal include <a href="http://hudson-ci.org/">Hudson</a> for continuous integration, <a href="http://cukes.info/">Cucumber</a> for integration tests and <a href="http://seleniumhq.org/">Selenium</a> for automated testing of web applications in a real browser.  But the organization of the joint work of all this requires more and more settings and configurations on the assembly server. <br><br>  Our goal is to document the steps required to overcome the obstacles encountered to launching the complete Cucumber test suite with scripts on Selenium on the Hudson assembly server. <br><a name="habracut"></a><br><h4>  Ingredients </h4><br>  We will use the following ingredients in this topic: <br><ul><li>  1 install Debian 5.0.4 'Lenny' </li><li>  1 <a href="http://en.wikipedia.org/wiki/Xvfb">xvfb</a> installation </li><li>  1 Web browser (in our case, <a href="http://www.geticeweasel.org/">iceweasel</a> , Firefox after Debian rebranding </li><li>  1 application for Ruby on Rails 2.3.7 (Not necessarily such a version, since 3.0.0 everything is ok - approx. Translator) </li><li>  1 heme Capybara 0.3.8 </li><li>  cucumber (0.7.3) to taste </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will not dive into the details of creating a Rails application, installing gems, and developing Cucumber scripts.  They have their own beautiful manuals. <br><br><h4>  Installing Required Packages </h4><br><br>  Let's start by installing a couple of packages that allow us to run tests in a browser without graphics mode. <br><br><h5>  Virtual framebuffer with Xvfb </h5><br><br>  ‚ÄúOn the X Window System, Xvfb or virtual X framebuffer is an X11 server that performs all the operations in memory without showing anything on the screen‚Äù - <a href="http://en.wikipedia.org/wiki/Xvfb">http://en.wikipedia.org/wiki/Xvfb</a> <br><br> <code>$ apt-get install xvfb</code> <br> <br><h5>  Web browser </h5><br><br>  After installing Xvfb, we can go ahead and install a web browser. <br><br> <code>$ apt-get install iceweasel</code> <br> <br>  Before we continue, we need to configure the browser profile so that it doesn‚Äôt scream about closing tabs or recovering from a crash.  If this is not done, the test suite will break down or work forever. <br><br> <code>$ cd ~/.mozilla/firefox/xxxxxxxx.default/ <br> $ vim user.js <br></code> <br><br>  Now we will enter two lines in the user.js file: <br><br> <code>user_pref("browser.sessionstore.enabled", false); <br> user_pref("browser.sessionstore.resume_from_crash", false); <br></code> <br><br><h5>  Display check </h5><br><br>  Before we start running our tests, we verify that all packages are installed correctly.  To do this, start the virtual framebuffer (Xvfb session) on display 99 with screen 0: <br><br> <code>$ Xvfb :99 -ac -screen 0 1024x768x16 <br></code> <br><br>  In another terminal window write: <br><br> <code><a href="http://example.org/"></a> $ DISPLAY=:99.0 iceweasel example.org <br></code> <br><br>  This will launch our web browser in a virtual framebuffer and open the example.com homepage in this browser.  Next is to make a "screenshot" so that we can see what is happening inside our virtual framebuffer. <br><br> <code>$ xwd -root -display :99.0 -out xwdout <br></code> <br><br>  And see our screenshot with: <br> <code>$ xwud -in xwdout <br></code> <br><br>  (And if you set up a remote machine, then you can pick up the xwdout file for yourself and look at yourself - comment of the translator) <br>  See the example.org homepage?  So Xvfb and iceweasel were successfully installed and we are ready to conduct several tests. <br><img src="http://blog.kabisa.nl/wp-content/uploads/2010/05/xwud.jpg" alt="image"><br><br><h4>  Run cucumber </h4><br><br>  Before we integrate this setup into our continuous integration environment, we run tests to see if cucumber works with our new configuration.  We can do this with the following command, keeping in mind that it is necessary to explicitly tell cucumber to use the virtual framebuffer display: <br><br> <code>$ DISPLAY=:99.0 rake cucumber <br></code> <br><br>  If everything went well, then we will see that all the scenarios ended successfully.  If not all scenarios are successful, check first whether everything is fine in a situation with a normal graphics mode. <br><br><h4>  Hudson configuration </h4><br><br>  Now we have come to try to fly with all this garbage.  We need to add a new build step to the task, which should launch our background cucumber.  But before adding the assembly step, we will create a start script for our virtual framebuffer.  You can use this script to start the buffer before running the scripts and stop the buffer after the scripts have completed.  You can save this script in /etc/init.d/.  Make sure the permissions are set so that the user that Hudson is running from can execute it. <br><br> <code>XVFB=/usr/bin/Xvfb <br> XVFBARGS="$DISPLAY -ac -screen 0 1024x768x16" <br> PIDFILE=/var/hudson/xvfb_${DISPLAY:1}.pid <br> case "$1" in <br> start) <br> echo -n "Starting virtual X frame buffer: Xvfb" <br> /sbin/start-stop-daemon --start --quiet --pidfile $PIDFILE --make-pidfile --background --exec $XVFB -- $XVFBARGS <br> echo "." <br> ;; <br> stop) <br> echo -n "Stopping virtual X frame buffer: Xvfb" <br> /sbin/start-stop-daemon --stop --quiet --pidfile $PIDFILE <br> echo "." <br> ;; <br> restart) <br> $0 stop <br> $0 start <br> ;; <br> *) <br> echo "Usage: /etc/init.d/xvfb {start|stop|restart}" <br> exit 1 <br> esac <br> exit 0 <br></code> <br><br>  The final step is to add an ‚ÄúExecute shell‚Äù assembly step to the Hudson task.  You can use the following set of commands to start your cucumber. <br><br> <code>#!/bin/bash <br> export DISPLAY=:99 <br> /etc/init.d/xvfb start <br> rake cucumber <br> RESULT=$? <br> /etc/init.d/xvfb stop <br> exit $RESULT <br></code> <br><br>  After adding this build step, save our task and let Hudson assemble it.  If everything goes well, cucumber scripts will now work as part of our continuous integration process.  You can view the ‚ÄúConsole output‚Äù page of an assembly in Hudson for the reasons for unsuccessful assemblies. <br><br><h4>  Conclusion <br></h4><br><br>  If you have reached this place in this topic, then now you have a working background installation.  The advantage of this installation is that it is quite lightweight and easy to configure.  But this setting will not suit you if you need to test with several different browsers.  For this setup, you will have to look towards the virtual machines and Hudson subordinate agents. <br><br>  UPD: Transferred to the "Testing", if the interest of the habrasoobschestva appears, I will write how everything is done with us. </div><p>Source: <a href="https://habr.com/ru/post/123565/">https://habr.com/ru/post/123565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123559/index.html">Unlimited cloud storage</a></li>
<li><a href="../123560/index.html">HBase + Thrift + PHP</a></li>
<li><a href="../123561/index.html">The method of calculating the coefficient reflecting the quality of the released software product</a></li>
<li><a href="../123562/index.html">Beginners shareware and all those who decided to conduct their business on the Internet</a></li>
<li><a href="../123564/index.html">ICQ Mobile for iOS version 2.6 and Push Notifications</a></li>
<li><a href="../123566/index.html">Skype to SIP Gateway do it yourself</a></li>
<li><a href="../123567/index.html">What does not hide LastPass?</a></li>
<li><a href="../123568/index.html">Behind the wheel of a vacuum cleaner or smart Firefox</a></li>
<li><a href="../123569/index.html">Asynchronous Replication with Oracle Streams</a></li>
<li><a href="../123571/index.html">Amazon Kindle warranty replacement instructions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>