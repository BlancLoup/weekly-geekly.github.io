<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Algorithm for Finding N First Primes - Atkin Sieve</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of implementing one program, I was faced with the task of finding primes up to a number N of order  . On Habr√©, they have repeatedly wr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Algorithm for Finding N First Primes - Atkin Sieve</h1><div class="post__text post__text-html js-mediator-article">  In the process of implementing one program, I was faced with the task of finding primes up to a number N of order <img alt="10 ^ 9" src="https://habrastorage.org/getpro/habr/post_images/e53/6e3/860/e536e386034baa5d552d9b2ac41f16d7.png">  .  On Habr√©, they have repeatedly written about various methods and methods, but did not mention the main method of solving, which I will try to correct today. <br><br><a name="habracut"></a><br><br>  The algorithm has asymptotic complexity. <img alt="O (N / ln (ln (N))" src="https://habrastorage.org/getpro/habr/post_images/a77/bd3/511/a77bd3511b8d82540341a716f10974c8.png">  and requires <img src="http://i062.radikal.ru/1107/46/73c45feff73b.gif">  bit of memory.  On input order values <img alt="10 ^ 9" src="https://habrastorage.org/getpro/habr/post_images/e53/6e3/860/e536e386034baa5d552d9b2ac41f16d7.png">  Atkin's sieve is faster than the sieve of Erastofen by 9.2 times.  I will give a graph of the growth of the superiority of the algorithm Atkin on the numbers from 2 to <img alt="10 ^ 9" src="https://habrastorage.org/getpro/habr/post_images/e53/6e3/860/e536e386034baa5d552d9b2ac41f16d7.png">  : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img alt="Schedule" src="https://habrastorage.org/getpro/habr/post_images/d20/d1b/962/d20d1b962f64454d00a83b258f60bf8c.gif"><br><br>  As a result, the following execution speed can be observed: <table width="350"><tbody><tr><td>  10,000,000 </td><td>  0.15 seconds </td></tr><tr><td>  100,000,000 </td><td>  2.16 seconds </td></tr><tr><td>  1,000,000,000 </td><td>  48.76 seconds </td></tr></tbody></table><br><br>  For convenience and brevity, we will create an abstract class from which we will inherit Atkin sieve implementations.  In the future we will only create different variants of the class. <br><blockquote><code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> AAtkin <br> { <br> <font color="#0000ff">internal</font> <font color="#0000ff">readonly</font> <font color="#0000ff">int</font> _limit; <br> <font color="#0000ff">public</font> <font color="#0000ff">bool</font> [] IsPrimes; <br> <br> <font color="#0000ff">protected</font> AAtkin( <font color="#0000ff">int</font> limit) <br> { <br> _limit = limit; <br> FindPrimes(); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">void</font> FindPrimes(); <br> }</font> <br></code> </blockquote><br><br>  Create a basic implementation of the algorithm: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> FindPrimes() <br> { <br> IsPrimes = <font color="#0000ff">new</font> <font color="#0000ff">bool</font> [_limit + 1]; <br> <font color="#0000ff">double</font> sqrt = <font color="#2B91AF">Math</font> .Sqrt(_limit); <br> <font color="#0000ff">var</font> limit = ( <font color="#0000ff">ulong</font> ) _limit; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> x = 1; x &lt;= sqrt; x++) <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> y = 1; y &lt;= sqrt; y++) <br> { <br> <font color="#0000ff">ulong</font> x2 = x*x; <br> <font color="#0000ff">ulong</font> y2 = y*y; <br> <font color="#0000ff">ulong</font> n = 4*x2 + y2; <br> <font color="#0000ff">if</font> (n &lt;= limit &amp;&amp; (n%12 == 1 || n%12 == 5)) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> <br> n -= x2; <br> <font color="#0000ff">if</font> (n &lt;= limit &amp;&amp; n%12 == 7) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> <br> n -= 2 * y2; <br> <font color="#0000ff">if</font> (x &gt; y &amp;&amp; n &lt;= limit &amp;&amp; n%12 == 11) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> n = 5; n &lt;= sqrt; n += 2) <br> <font color="#0000ff">if</font> (IsPrimes[n]) <br> { <br> <font color="#0000ff">ulong</font> s = n*n; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> k = s; k &lt;= limit; k += s) <br> IsPrimes[k] = <font color="#0000ff">false</font> ; <br> } <br> IsPrimes[2] = <font color="#0000ff">true</font> ; <br> IsPrimes[3] = <font color="#0000ff">true</font> ; <br> }</font> <br></code> </blockquote><br><br>  The execution time of the basic (classical) version of the algorithm: <table width="350"><tbody><tr><td>  1,000,000 </td><td>  0.03 seconds </td></tr><tr><td>  10,000,000 </td><td>  0.39 sec </td></tr><tr><td>  100,000,000 </td><td>  4.6 seconds </td></tr><tr><td>  1,000,000,000 </td><td>  48.92 seconds </td></tr></tbody></table><br><br>  Recall that in the C # language, operations with the <font color="#0000ff">ulong</font> type take about 3 times longer than with the <font color="#0000ff">int</font> type.  In the program, when calculating large numbers, the values ‚Äã‚Äãstill pass for int.MaxValue, so we find an empirical level of use.  Here it is equal to 858599509. Insert the condition and get the final acceleration: <br><blockquote> <code><font color="black">IsPrimes = <font color="#0000ff">new</font> <font color="#0000ff">bool</font> [_limit + 1]; <br> <font color="#0000ff">double</font> sqrt = <font color="#2B91AF">Math</font> .Sqrt(_limit); <br> <font color="#0000ff">if</font> (sqrt &lt; 29301) <br> { <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> x = 1; x &lt;= sqrt; x++) <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> y = 1; y &lt;= sqrt; y++) <br> { <br> <font color="#0000ff">int</font> x2 = x * x; <br> <font color="#0000ff">int</font> y2 = y * y; <br> <font color="#0000ff">int</font> n = 4 * x2 + y2; <br> <font color="#0000ff">if</font> (n &lt;= _limit &amp;&amp; (n % 12 == 1 || n % 12 == 5)) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> <br> n -= x2; <br> <font color="#0000ff">if</font> (n &lt;= _limit &amp;&amp; n % 12 == 7) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> <br> n -= 2 * y2; <br> <font color="#0000ff">if</font> (x &gt; y &amp;&amp; n &lt;= _limit &amp;&amp; n % 12 == 11) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> n = 5; n &lt;= sqrt; n += 2) <br> <font color="#0000ff">if</font> (IsPrimes[n]) <br> { <br> <font color="#0000ff">int</font> s = n * n; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> k = s; k &lt;= _limit; k += s) <br> IsPrimes[k] = <font color="#0000ff">false</font> ; <br> } <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#0000ff">var</font> limit = ( <font color="#0000ff">ulong</font> ) _limit; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> x = 1; x &lt;= sqrt; x++) <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> y = 1; y &lt;= sqrt; y++) <br> { <br> <font color="#0000ff">ulong</font> x2 = x*x; <br> <font color="#0000ff">ulong</font> y2 = y*y; <br> <font color="#0000ff">ulong</font> n = 4*x2 + y2; <br> <font color="#0000ff">if</font> (n &lt;= limit &amp;&amp; (n%12 == 1 || n%12 == 5)) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> <br> n -= x2; <br> <font color="#0000ff">if</font> (n &lt;= limit &amp;&amp; n%12 == 7) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> <br> n -= 2 * y2; <br> <font color="#0000ff">if</font> (x &gt; y &amp;&amp; n &lt;= limit &amp;&amp; n%12 == 11) <br> IsPrimes[n] ^= <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> n = 5; n &lt;= sqrt; n += 2) <br> <font color="#0000ff">if</font> (IsPrimes[n]) <br> { <br> <font color="#0000ff">ulong</font> s = n*n; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">ulong</font> k = s; k &lt;= limit; k += s) <br> IsPrimes[k] = <font color="#0000ff">false</font> ; <br> } <br> } <br> IsPrimes[2] = <font color="#0000ff">true</font> ; <br> IsPrimes[3] = <font color="#0000ff">true</font> ; <br> }</font> <br></code> </blockquote><br><br>  That's all.  Thank you for your attention - I tried not to be very dry. </div><p>Source: <a href="https://habr.com/ru/post/125620/">https://habr.com/ru/post/125620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125613/index.html">StructureMap - quick reference for work (1/3)</a></li>
<li><a href="../125614/index.html">Fuzzy logic in practice</a></li>
<li><a href="../125616/index.html">The German government is unhappy with the facial recognition service Tag Suggestions from Facebook</a></li>
<li><a href="../125617/index.html">Fuzzy search on the client and Soundex</a></li>
<li><a href="../125619/index.html">Post-mortem creation of cross-platform casual engine</a></li>
<li><a href="../125621/index.html">Creating a world generator for minecraft</a></li>
<li><a href="../125622/index.html">Configuring Atlassian JIRA + Confluence as a support system</a></li>
<li><a href="../125623/index.html">The study of games without source code on the example of Zuma</a></li>
<li><a href="../125624/index.html">Microsoft launches its own "designer" competitor Arduino</a></li>
<li><a href="../125625/index.html">The German government is unhappy with the facial recognition service Tag Suggestions from Facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>