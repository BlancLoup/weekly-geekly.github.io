<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use Cake to build C # code.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I want to talk about a tool like Cake (C # Make). 



 So what is Cake? 


 Cake is a cross-platform build system that uses DSL with C # syntax...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use Cake to build C # code.</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  I want to talk about a tool like Cake (C # Make). </p><br><p><img src="https://avatars0.githubusercontent.com/u/7738262?v=3&amp;s=400" alt="Cake build" title="Cake build"></p><br><h1 id="itak-chto-takoe-cake">  So what is Cake? </h1><br><p>  Cake is a cross-platform build system that uses DSL with C # syntax to do such things as build binaries from source codes, copy files, create / clean up / delete folders, archive artifacts, package nuget packages, runs a unit during the build process. -Tests and much more.  Cake also has an advanced add-on system (just C # classes, often packaged in nuget).  It is worth noting that a large number of useful functions are already built into Cake, and even more, for almost every occasion, are written by the community and are distributed quite successfully. </p><a name="habracut"></a><br><p>  Sake uses a programming model called <em>dependency based programming</em> , like other similar systems like <em>Rake</em> or <em>Fake</em> .  The essence of this model is that for the execution of our program we define the tasks and the dependencies between them.  Read more about this model can be read by <a href="https://martinfowler.com/articles/rake.html">Martin Fowler</a> . </p><br><p>  This model forces us to represent our build process as some tasks (Task) and dependencies between them.  In this case, the logical execution goes in the reverse order: we indicate the task that we want to perform and its dependencies, but Cake determines which tasks can be performed (for which they are resolved or there are no dependencies) and executes them. </p><br><p><img src="https://habrastorage.org/web/92f/7d0/9af/92f7d09afa674ed2a5944341b7287b97.png" alt="dependency based programming example"></p><br><p>  So, for example, we want to execute A, but it depends on B and C, and B depends on D. Thus, Cake will execute them in the following order: </p><br><ol><li>  C or D </li><li>  B </li><li>  A </li></ol><br><p>  The task (Task) in Cake is usually a complete piece of work on the assembly / testing / packaging.  Declared as follows </p><br><pre><code class="hljs coffeescript">Task(<span class="hljs-string"><span class="hljs-string">"A"</span></span>) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  .Does(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Task A });</code> </pre> <br><p>  To indicate that task A is dependent on, for example, task B, you can use the <em>IsDependentOn</em> method: </p><br><pre> <code class="hljs coffeescript">Task(<span class="hljs-string"><span class="hljs-string">"A"</span></span>) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  .IsDependentOn(<span class="hljs-string"><span class="hljs-string">"B"</span></span>) .Does(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Task A });</code> </pre> <br><p>  You can also easily set the conditions under which the task will or will not be performed using the <em>WithCriteria</em> method: </p><br><pre> <code class="hljs coffeescript">Task(<span class="hljs-string"><span class="hljs-string">"B"</span></span>) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  .IsDependentOn(<span class="hljs-string"><span class="hljs-string">"C"</span></span>) .WithCriteria(DateTime.Now.Second % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) .Does(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Task A });</code> </pre> <br><p>  If some task depends on task B, and the criterion is false, then task B will not be executed, but the execution flow will go on and perform the tasks on which B. depends. <br>  There is also an overload of the <em>WithCriteria</em> method, which takes as a parameter a function that returns bool.  In this case, the expression will be counted only when the queue reaches the task, and not at the time of building the task tree. </p><br><p>  Cake also supports some specific preprocessor directives, such as <em>load</em> , <em>reference</em> , <em>tool,</em> and <em>break</em> .  You can read more about them on the corresponding documentation <a href="http://cakebuild.net/docs/fundamentals/preprocessor-directives">page</a> . </p><br><p>  I think that people who collect their projects in the era of DevOps with their hands are not so many.  The advantage of any assembly system in comparison with manual assembly is obvious - an automatically tuned process is always better than manual manipulations. </p><br><h2 id="preimuschestva-cake-pri-razrabotke-na-c">  Cake Benefits in C Development </h2><br><p>  Why use Cake, since there are many alternatives?  If you are not developing in C #, then most likely there is nothing.  And if you are developing, it seems reasonable to write assembly scripts in the same language in which the main project is written, since there is no need to learn another programming language and produce their zoo within the same code base.  Therefore, build systems like <em>Rake (Ruby)</em> , <em>Psake (Powershell)</em> or <em>Fake (F #)</em> began to appear. </p><br><p>  Cake is definitely not the only way to build a C # project.  As options, you can cite as an example pure MSBuild, Powershell, Bat-scripts or CI Server like Teamcity or Jenkins, however all of them have both advantages and disadvantages: </p><br><ul><li>  Powershell scripts, as well as Bat / Bash, are quite difficult to maintain. </li><li>  C # based DSL is more enjoyable with DSB based XML syntax from MSBuild.  In addition, MSBuild support in Linux / Mac appeared not so long ago. </li><li>  The CI server imposes Vendor-lock and often requires "programming with the mouse", and therefore untie the version of the build process from the code version in the repository, although some CI systems allow you to store files describing the build process along with the code. </li><li>  Using CI does not allow collecting code locally, just like on a CI server. </li></ul><br><h1 id="ustanovka-cake">  Cake Installation </h1><br><p>  Now let's talk about how to execute scripts with tasks.  Cake has a boot loader that does everything for you.  You can download it either manually or by the following powershell command: </p><br><pre> <code class="hljs ruby">Invoke-WebRequest <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/cakebuild.net/download</span></span><span class="hljs-regexp"><span class="hljs-regexp">/bootstrapper/windows</span></span> -OutFile build.ps1</code> </pre> <br><p>  The downloaded <em>build.ps1</em> file <em>will</em> then load the required cake.exe itself, if it has not yet been loaded, and execute the cake script (by default, this is <em>build.cake</em> ), if we call it with the following command: </p><br><pre> <code class="hljs vhdl">Powershell -<span class="hljs-keyword"><span class="hljs-keyword">File</span></span> <span class="hljs-string"><span class="hljs-string">".\build.ps1"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> <span class="hljs-string"><span class="hljs-string">"Debug"</span></span></code> </pre> <br><p>  We can also pass command line arguments to <em>build.ps1</em> , which will then be executed.  They can be either built-in, for example, the <em>configuration</em> , which is usually responsible for the configuration of the assembly, or they can be set independently - in this case there are two ways: </p><br><ul><li>  Pass as the value of the <em>ScriptArgs</em> parameter: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Powershell</span></span> -File <span class="hljs-string"><span class="hljs-string">".\build.ps1"</span></span> -Script <span class="hljs-string"><span class="hljs-string">"version.cake"</span></span> -ScriptArgs <span class="hljs-string"><span class="hljs-string">'--buildNumber="123"'</span></span></code> </pre> </li><li>  Modify build.ps1 so that it forwards the passed argument to cake.exe. </li></ul><br><h1 id="primery">  Examples </h1><br><p>  Well, now let's move on to practice.  You can easily imagine a typical build cycle of a nuget package: </p><br><p><img src="https://habrastorage.org/web/823/90e/7df/82390e7df95342f8bcf0798e2f5ab595.png" alt="nuget pack pipeline"></p><br><ul><li>  We collected by means of MSBuild from source codes dll </li><li>  We run unit tests </li><li>  We collect everything in nuget according to the nuspec description </li><li>  Push into nuget feed </li></ul><br><h3 id="sborka-dll">  Build dll </h3><br><p>  To build our solution from sources, you need to do 2 things: </p><br><ul><li>  Recover nuget packages that our solution depends on using the <em>NuGetRestore</em> function </li><li>  Build a solution by default with the <em>DotNetBuild</em> function built into the cake, passing it the <em>configuration</em> parameter. </li></ul><br><p>  We describe the task of building the solution on cake-dsl: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configuration = Argument(<span class="hljs-string"><span class="hljs-string">"configuration"</span></span>, <span class="hljs-string"><span class="hljs-string">"Debug"</span></span>); Task(<span class="hljs-string"><span class="hljs-string">"Build"</span></span>) .Does(() =&gt; { NuGetRestore(<span class="hljs-string"><span class="hljs-string">"../Solution/Solution.sln"</span></span>); DotNetBuild(<span class="hljs-string"><span class="hljs-string">"../Solution/Solution.sln"</span></span>, x =&gt; x .SetConfiguration(configuration) .SetVerbosity(Verbosity.Minimal) .WithTarget(<span class="hljs-string"><span class="hljs-string">"build"</span></span>) .WithProperty(<span class="hljs-string"><span class="hljs-string">"TreatWarningsAsErrors"</span></span>, <span class="hljs-string"><span class="hljs-string">"false"</span></span>) ); }); RunTarget(<span class="hljs-string"><span class="hljs-string">"Build"</span></span>);</code> </pre> <br><p>  The build configuration, respectively, is read from the command line arguments using the <em>Argument</em> function with the default value "Debug".  The <em>RunTarget</em> function starts the specified task, so that we can immediately verify the correctness of our cake-script operation. </p><br><h2 id="yunit-testy">  Unit tests </h2><br><p>  To run unit tests compatible with nunit v3.x, we need the <em>NUnit3</em> function, which is not included in the Cake distribution and therefore requires connection via the preprocessor directive #tool.  The #tool directive allows you to connect tools from nuget packages, which we will use: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#tool "nuget:?package=NUnit.ConsoleRunner&amp;version=3.6.0"</span></span></code> </pre> <br><p>  In this case, the task itself is extremely simple.  Do not forget, of course, that it depends on the Build task: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#tool "nuget:?package=NUnit.ConsoleRunner&amp;version=3.6.0" Task("Tests::Unit") .IsDependentOn("Build") .Does(()=&gt; { NUnit3(@"..\Solution\MyProject.Tests\bin\" + configuration + @"\MyProject.Tests.dll"); }); RunTarget("Tests::Unit");</span></span></code> </pre> <br><h2 id="pakuem-vse-v-nuget">  We pack everything in nuget </h2><br><p>  To package our assembly in nuget, we use the following nuget specification: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">package</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">metadata</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>Solution<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Test solution for demonstration purposes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> Test solution for demonstration purposes <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authors</span></span></span><span class="hljs-tag">&gt;</span></span>Gleb Smagliy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">owners</span></span></span><span class="hljs-tag">&gt;</span></span>Gleb Smagliy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">owners</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requireLicenseAcceptance</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requireLicenseAcceptance</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">references</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyProject.dll"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">references</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">metadata</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".\MyProject.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lib\net45"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".\MyProject.pdb"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lib\net45"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">package</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Put it in the folder with the build.cake script.  When executing the Pack task, transfer all the necessary artifacts for packaging to the ".. \. Artefacts" folder.  To do this, make sure that it is (and if not, create it) using the <em>EnsureDirectoryExists</em> function and clear it using the <em>CleanDirectory</em> function built into Cake.  Using the same functions for copying files, we move the necessary dlls and pdb to the folder with refractories. </p><br><p>  By default, the collected nupkg will go into the current folder, so we specify the folder ".. \ package" as the <em>OutputDirectory</em> , which we also created and cleared. </p><br><pre> <code class="cs hljs">Task(<span class="hljs-string"><span class="hljs-string">"Pack"</span></span>) .IsDependentOn(<span class="hljs-string"><span class="hljs-string">"Tests::Unit"</span></span>) .Does(()=&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> packageDir = <span class="hljs-string"><span class="hljs-string">@"..\package"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> artefactsDir = <span class="hljs-string"><span class="hljs-string">@"..\.artefacts"</span></span>; MoveFiles(<span class="hljs-string"><span class="hljs-string">"*.nupkg"</span></span>, packageDir); EnsureDirectoryExists(packageDir); CleanDirectory(packageDir); EnsureDirectoryExists(artefactsDir); CleanDirectory(artefactsDir); CopyFiles(<span class="hljs-string"><span class="hljs-string">@"..\Solution\MyProject\bin\"</span></span> + configuration + <span class="hljs-string"><span class="hljs-string">@"\*.dll"</span></span>, artefactsDir); CopyFiles(<span class="hljs-string"><span class="hljs-string">@"..\Solution\MyProject\bin\"</span></span> + configuration + <span class="hljs-string"><span class="hljs-string">@"\*.pdb"</span></span>, artefactsDir); CopyFileToDirectory(<span class="hljs-string"><span class="hljs-string">@".\Solution.nuspec"</span></span>, artefactsDir); NuGetPack(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilePath(artefactsDir + <span class="hljs-string"><span class="hljs-string">@"\Solution.nuspec"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NuGetPackSettings { OutputDirectory = packageDir }); }); RunTarget(<span class="hljs-string"><span class="hljs-string">"Pack"</span></span>);</code> </pre> <br><h2 id="publikuem">  Publish </h2><br><p>  To publish packages, use the <em>NuGetPush</em> function, which takes the path to the nupkg file, as well as the settings: a link to the nuget feed and API key.  Of course, we will not store the API Key in the repository, but transmit it outside again using the <em>Argument</em> function.  As nupkg, we simply take the first file in the <em>package</em> directory that matches the mask using <em>GetFiles</em> .  We can do this because the directory has been pre-cleaned before packing.  So, the publication task is described by the following dsl: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nugetApiKey = Argument(<span class="hljs-string"><span class="hljs-string">"NugetApiKey"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); Task(<span class="hljs-string"><span class="hljs-string">"Publish"</span></span>) .IsDependentOn(<span class="hljs-string"><span class="hljs-string">"Pack"</span></span>) .Does(()=&gt; { NuGetPush(GetFiles(<span class="hljs-string"><span class="hljs-string">@"..\package\*.nupkg"</span></span>).First(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NuGetPushSettings { Source = <span class="hljs-string"><span class="hljs-string">"https://www.nuget.org/api/v2"</span></span>, ApiKey = nugetApiKey }); }); RunTarget(<span class="hljs-string"><span class="hljs-string">"Publish"</span></span>);</code> </pre> <br><h2 id="uproschaem-sebe-zhizn">  Simplify your life </h2><br><p>  While debugging a cake-script, and just for debugging a nuget-package, you can not publish it every time to a remote feed.  This is where the <em>WithCriteria</em> function that we looked at will come to us with help.  We will pass the <em>PublishRemotely</em> flag to the script with the parameter (by default set to false) in order to determine whether to put the package in a remote feed by the value of this flag.  However, cake will not execute the script if we miss the task that the <em>RunTarget</em> functions <em>specified</em> .  Therefore, we will <em>create a</em> dummy empty <em>BuildAndPublish</em> task, which will depend on <em>Publish</em> : </p><br><pre> <code class="cs hljs">Task(<span class="hljs-string"><span class="hljs-string">"BuildAndPublish"</span></span>) .IsDependentOn(<span class="hljs-string"><span class="hljs-string">"Publish"</span></span>) .Does(()=&gt; { }); RunTarget(<span class="hljs-string"><span class="hljs-string">"BuildAndPublish"</span></span>);</code> </pre> <br><p>  And add a condition to the Publish task: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nugetApiKey = Argument(<span class="hljs-string"><span class="hljs-string">"NugetApiKey"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> publishRemotely = Argument(<span class="hljs-string"><span class="hljs-string">"PublishRemotely"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); Task(<span class="hljs-string"><span class="hljs-string">"Publish"</span></span>) .IsDependentOn(<span class="hljs-string"><span class="hljs-string">"Pack"</span></span>) .WithCriteria(publishRemotely) .Does(()=&gt; { NuGetPush(GetFiles(<span class="hljs-string"><span class="hljs-string">@"..\package\*.nupkg"</span></span>).First(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NuGetPushSettings { Source = <span class="hljs-string"><span class="hljs-string">"https://www.nuget.org/api/v2"</span></span>, ApiKey = nugetApiKey }); });</code> </pre> <br><p>  The script for assembling and publishing a nuget-package is almost ready, it remains only to combine all the tasks together.  The final version of the code can be found in the repository on <a href="https://github.com/gleb-smagliy/cake-build-article">github</a> . </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  We looked at the simplest example of using cake.  This could be integration with slack, monitoring code coverage with tests and much more.  Having a rich system of add-ons, an active community, as well as pretty good documentation, cake is a pretty good alternative to CI systems and MSBuild for building C # code. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/329194/">https://habr.com/ru/post/329194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329180/index.html">We write an analogue of Paint on Objective-C</a></li>
<li><a href="../329182/index.html">Seminar "Modernization of engineering systems in the existing data center", May 31, Moscow</a></li>
<li><a href="../329184/index.html">Bitdefender Hypervisor Introspection: a new means of dealing with hidden cyber threats</a></li>
<li><a href="../329188/index.html">Confronting Positive Hack Days: Hackers won't be bored</a></li>
<li><a href="../329190/index.html">Google I / O Site Tour</a></li>
<li><a href="../329196/index.html">How to quickly set up autoposting for Facebook and Twitter</a></li>
<li><a href="../329198/index.html">We invite you to a meeting of ThinkJava # 5 in Kharkov</a></li>
<li><a href="../329200/index.html">ArcaOS 5.0 - a new version of OS / 2 has become available to the public.</a></li>
<li><a href="../329202/index.html">Nimble Storage on HPE: How InfoSight allows you to see the invisible in your infrastructure</a></li>
<li><a href="../329204/index.html">Performance comparison of hierarchical models of Django and PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>