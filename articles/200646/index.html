<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Build Android applications on Travis CI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I would like to show how you can build free Android projects (Maven) with open source on Travis CI. 

 What do we have? 


- Android ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Build Android applications on Travis CI</h1><div class="post__text post__text-html js-mediator-article">  In this article, I would like to show how you can build free Android projects (Maven) with open source on Travis CI. <br><a name="habracut"></a><br><h4>  What do we have? </h4><br><ul><li>  Android open source github project </li><li>  The project should be going Maven </li><li>  Travis CI Account </li></ul><br><h4>  What do we want to get? </h4><br>  The free assembly of the project on kommit with the report on performance on mail.  At the same time, we want to run integration tests on the emulator and use additional components of the SDK (addons, extras, etc.) <br><br><h4>  How do we achieve this? </h4><br>  As a basis we take ready-made scripts on github: <a href="https://github.com/serso/android-common">https://github.com/serso/android-common</a> . <br>  The main script that Travis CI uses to build is .travis.yml: <br><pre><code class="bash hljs">language: java jdk: oraclejdk7 before_install: - chmod +x <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_install_android.sh - <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_install_android.sh - <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ANDROID_HOME=<span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/android-sdk-linux - <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">${PATH}</span></span>:<span class="hljs-variable"><span class="hljs-variable">${ANDROID_HOME}</span></span>/tools:<span class="hljs-variable"><span class="hljs-variable">${ANDROID_HOME}</span></span>/platform-tools - chmod +x <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_install_android_dependencies.sh - <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_install_android_dependencies.sh - chmod +x <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_start_emulator.sh - <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_start_emulator.sh before_script: - chmod +x <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_wait_for_emulator.sh - <span class="hljs-variable"><span class="hljs-variable">$PWD</span></span>/.travis_wait_for_emulator.sh script: mvn install -Pwith-tests</code> </pre> <br>  It specifies the base language of the project - Java, then the jdk version - I use JDK 7 from Oracle. <br>  Before we start building, we need to install the Android SDK, as well as its components (API, extras, addons, etc.).  The bash scripts <b>.travis_install_android.sh</b> and <b>.travis_install_android_sdk.sh</b> are responsible for this.  Next, we need to download some Android artifacts into the local Maven repository - the <b>.travis_install_android_dependencies.sh</b> script, run the emulator - <b>.travis_start_emulator.sh</b> and wait for its launch <b>.travis_wait_for_emulator.sh</b> . <br><br><h5>  Android installation </h5><br><pre> <code class="bash hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh # Script installs Android SDK sudo apt-get update -qq if [ `uname -m` = x86_64 ]; then sudo apt-get install -qq libstdc++6:i386 lib32z1; fi wget -O android-sdk.tgz http://dl.google.com/android/android-sdk_r22.0.4-linux.tgz tar xzf android-sdk.tgz export ANDROID_HOME=$PWD/android-sdk-linux export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools sudo apt-get install expect chmod +x $PWD/.travis_install_android_sdk.sh $PWD/.travis_install_android_sdk.sh</span></span></code> </pre><br>  Description: Update the list of applications, in the case of 64-bit architecture - install additional packages (see the discussion <a href="http://stackoverflow.com/questions/14370763/travis-ci-for-android">here</a> ).  Next, we download, unzip the Android SDK and set the environment variables (since the environment variables in the bash script will be reset after its execution, we will have to set them again in .travis.yml). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Installing Android SDK components </h5><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/expect -f # Script installs Android SDK components spawn android update sdk --filter tools,platform-tools,build-tools-19.0.0,extra-android-support,android-17,sysimg-17,addon-google_apis-google-17,android-19,sysimg-19,addon-google_apis-google-19,addon-google_apis-google-19,extra-google-play_billing,extra-google-m2repository,extra-google-analytics_sdk_v2,extra-google-gcm,extra-google-google_play_services,extra-google-play_apk_expansion,extra-android-m2repository --no-ui --force --all expect "Do you accept the license *:" send -- "y\r" expect "Do you accept the license *:" send -- "y\r" expect "Do you accept the license *:" send -- "y\r" expect "Do you accept the license *:" send -- "y\r" expect "Do you accept the license *:" send -- "y\r" expect "Do you accept the license *:" send -- "y\r" expect "Do you accept the license *:" send -- "y\r" interact # WORKAROUND: for some reason we need to download following extras separately (otherwise we will get PkgVersion=2 instead of PkgVersion=2.0.0) spawn android update sdk --filter extra-google-admob_ads_sdk,extra-google-play_licensing --no-ui --force --all expect "Do you accept the license *:" send -- "y\r" interact</span></span></code> </pre><br>  Description: We are trying to install the SDK components we need.  Here a little trick - android update sdk will offer us to accept licenses for some components, and since  we will not be able to respond (the script is executed remotely), we will have to respond automatically with the help of the spawn command (which was prudently installed before calling this script). <br>  For some unknown reason, android differently extorts the components of admob and play_licensing.  If you add them to the first update, then instead of PkgVersion = 2.0.0 there will be PkgVersion = 2, which does not suit us very much (since this variable is responsible for the version of the artifact in the Maven repository). <br><br><h5>  Installing artifacts in the Maven repository </h5><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Scripts installs Android SDK artifacts in local Maven repository git clone git://github.com/serso/maven-android-sdk-deployer.git cd ./maven-android-sdk-deployer/ git checkout tags/api-19 mvn install -P4.2 cd ..</span></span></code> </pre><br>  Description: we extort <a href="https://github.com/mosabua/maven-android-sdk-deployer">Maven Android SK Deployer</a> fork via the api-19 tag and launch its build for Android version 4.2 (I haven‚Äôt yet checked it on 4.4).  Why do we extort the fork instead of the original?  There is no tag in the original, and therefore any changes made to the project code may break the assembly. <br><br><h5>  Running emulator </h5><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Scripts starts Android emulator with name 'Default' echo no | android create avd --force -n Default -t android-17 --abi armeabi-v7a emulator -avd Default -no-skin -no-audio -no-window &amp;</span></span></code> </pre><br>  Description: Create a virtual device named Default and run it in a separate process. <br><br>  Next, Travis launches a test install of the project, after which the before_script phase is called, in which we wait for the emulator to start. <br><br><h5>  Assembly </h5><br>  The final chord - the start of the assembly.  In my case, it's just a call to mvn install with the profile with-tests, which will run the integration tests. <br><pre> <code class="bash hljs">script: mvn install -Pwith-tests</code> </pre><br><br><h4>  Conclusion </h4><br>  After the project is successfully configured, each commit should lead to the start of the assembly, followed by notification to the mail.  As an example, you can see the <a href="https://github.com/serso/android-common">Android Common Library</a> project with working assemblies in <a href="https://travis-ci.org/serso/android-common/builds">Travis CI</a> . <br>  If you have any questions or suggestions, welcome to comments.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/200646/">https://habr.com/ru/post/200646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200632/index.html">We create the first application on NancyFX. Part Four We continue to work with the modules</a></li>
<li><a href="../200634/index.html">Increase security with two clicks</a></li>
<li><a href="../200640/index.html">Astrophotography in every house</a></li>
<li><a href="../200642/index.html">We attach the Web Map service to the unsuspecting OpenSource database.</a></li>
<li><a href="../200644/index.html">Harmony collections NOW</a></li>
<li><a href="../200652/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 81 (October 27 - November 2, 2013)</a></li>
<li><a href="../200654/index.html">We are refining equipment Turnigy 9x</a></li>
<li><a href="../200658/index.html">Is your disassembler working correctly?</a></li>
<li><a href="../200660/index.html">Service beautiful animated cards LikeShareIt.com</a></li>
<li><a href="../200662/index.html">Option of conditional routing in AngularJS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>