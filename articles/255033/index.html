<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is under the hood of a dynamic magnetic strip?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introductory 
 Time does not stand still - it flows and changes. Technical progress dictates its own rules of life. One of these rules is the presence...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is under the hood of a dynamic magnetic strip?</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introductory </h4><br>  Time does not stand still - it flows and changes.  Technical progress dictates its own rules of life.  One of these rules is the presence of the most important tool of everyday life - a plastic card.  Credit, settlement, deposit, business cards, club, loyalty cards - now no civilized society can do without them.  But what to do if there are too many of these ‚Äúgenerally accepted tools of human life‚Äù?  What if from their excess your favorite wallet starts to burst at the seams?  Today we will talk about how this problem can be avoided.  Namely, how to turn a few cards ... into one. <br><a name="habracut"></a><br><h4>  Some theory </h4><br>  How is information stored?  Yes, very simple.  In fact, a magnetic strip is a sequence of small sections magnetized in opposite directions.  At the place of transition between the areas, the magnetic field strength changes dramatically.  It is this change in the magnetic field that captures the magnetic head, which slides along the strip when you swipe a card.  Due to a sharp change in the magnetic field, an electromotive force (electromotive force) arises in the head coil, in other words, a voltage pulse appears, which is then amplified and transmitted further. <br><br>  To distinguish between zeros and ones, the so-called F / 2F coding is used: that is, the F frequency is used for zero coding, and the 2F frequency is used for the one.  For example, at the beginning of the track we have several zeros serving for synchronization, then the decoder roughly calculates the frequency F (in particular, the time of one half period is T), and if the pulse occurred after the time T expired, then we are dealing with zero in the middle of this time and at the end (twice the frequency), this is a logical unit. <br><br><img src="https://habrastorage.org/files/1fd/429/223/1fd4292237d44091972bb399f4921c72.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This method is based on the principle that we can not instantly change the speed of the wire card 1.5 times.  Due to the fact that we have an impulse at the end of each bit, we can adjust the time T without fear of a smooth change in speed.  Otherwise, it threatens to synchronize. <br><br>  Each card with a magnetic stripe always has 3 tracks.  Another thing is that they are not always used. <br><table><tbody><tr><td>  1st track </td><td>  ALPHA format </td><td>  79 characters </td><td>  7 bits per character </td><td>  210 bit per inch </td></tr><tr><td>  2nd track </td><td>  BCD format </td><td>  40 characters </td><td>  5 bits per character </td><td>  75 bit per inch </td></tr><tr><td>  3rd track </td><td>  BCD format </td><td>  107 characters </td><td>  5 bits per character </td><td>  210 bit per inch </td></tr></tbody></table><br>  In the case of discount cards, only the second track is most often used, due to the fact that it has the smallest recording density, and, as a result, the highest resistance to interference in the form of stuck substances, scratches or even cracks.  Usually, there is recorded the numerical identifier of the carrier of the card, which, just in case, is duplicated on the front of the card itself. <br><br>  In the case of bank cards, the first and second tracks are used.  The meaning of the data is known only to the banks. <br>  The third track in the overwhelming number of cases is not used. <br>  The physical width of the information track is 2.8 mm. <br><br><div class="spoiler">  <b class="spoiler_title">BCD format</b> <div class="spoiler_text"><table><tbody><tr><th>  b1 </th><th>  b2 </th><th>  b3 </th><th>  b4 </th><th>  b5 </th><th>  Character </th><th>  Function </th></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  (0H) </td><td>  Data </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  (1H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  2 </td><td>  (2H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  3 </td><td>  (3H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  four </td><td>  (4H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  five </td><td>  (5H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  6 </td><td>  (6H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  7 </td><td>  (7H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  eight </td><td>  (8H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  9 </td><td>  (9H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  : </td><td>  (Ah) </td><td>  Control </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  ; </td><td>  (BH) </td><td>  Start Sentinel </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  &lt; </td><td>  (CH) </td><td>  Control </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  = </td><td>  (DH) </td><td>  Field separator </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  &gt; </td><td>  (Eh) </td><td>  Control </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  ? </td><td>  (FH) </td><td>  End sentinel </td></tr></tbody></table><br></div></div><br>  The 5th bit acts as a parity bit. <br><br>  In the alpha encoding format (where 7 bits per character) it is possible to store numbers, Latin letters and some special characters. <br><br><div class="spoiler">  <b class="spoiler_title">alpha encoding format</b> <div class="spoiler_text"><table><tbody><tr><th>  b1 </th><th>  b2 </th><th>  b3 </th><th>  b4 </th><th>  b5 </th><th>  b6 </th><th>  b7 </th><th>  Character </th><th>  Function </th></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  space </td><td>  (0H) </td><td>  Special </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  ! </td><td>  (1H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  " </td><td>  (2H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  # </td><td>  (3H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  $ </td><td>  (4H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  % </td><td>  (5H) </td><td>  Start Sentinel </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  &amp; </td><td>  (6H) </td><td>  Special </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  ' </td><td>  (7H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  ( </td><td>  (8H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  ) </td><td>  (9H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  * </td><td>  (Ah) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  + </td><td>  (BH) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  , </td><td>  (CH) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  - </td><td>  (DH) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  . </td><td>  (Eh) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  / </td><td>  (FH) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  (10H) </td><td>  Data (numeric) </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  (11H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  2 </td><td>  (12H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  3 </td><td>  (13H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  four </td><td>  (14H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  five </td><td>  (15H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  6 </td><td>  (16H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  7 </td><td>  (17H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  eight </td><td>  (18H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  9 </td><td>  (19H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  : </td><td>  (1AH) </td><td>  Special </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  ; </td><td>  (1BH) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  &lt; </td><td>  (1CH) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  = </td><td>  (1DH) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  &gt; </td><td>  (1EH) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  ? </td><td>  (1FH) </td><td>  End sentinel </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  @ </td><td>  (20H) </td><td>  Special </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  A </td><td>  (21H) </td><td>  Data (alpha) </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  B </td><td>  (22H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  C </td><td>  (23H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  D </td><td>  (24H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  E </td><td>  (25H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  F </td><td>  (26H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  G </td><td>  (27H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  H </td><td>  (28H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  I </td><td>  (29H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  J </td><td>  (2AH) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  K </td><td>  (2BH) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  L </td><td>  (2CH) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  M </td><td>  (2DH) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  N </td><td>  (2EH) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  O </td><td>  (2FH) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  P </td><td>  (30H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  Q </td><td>  (31H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  R </td><td>  (32H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  S </td><td>  (33H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  T </td><td>  (34H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  U </td><td>  (35H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  V </td><td>  (36H) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  0 </td><td>  W </td><td>  (37H) </td><td>  " </td></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  X </td><td>  (38H) </td><td>  " </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  Y </td><td>  (39H) </td><td>  " </td></tr><tr><td>  0 </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  Z </td><td>  (3AH) </td><td>  " </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  [ </td><td>  (3BH) </td><td>  Special </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  ( </td><td>  3DH) Special </td><td></td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  ] </td><td>  (3EH) </td><td>  Special </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  0 </td><td>  ^ </td><td>  (3FH) </td><td>  Field separator </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  one </td><td>  _ </td><td>  (40H) </td><td>  Special </td></tr></tbody></table><br></div></div><br>  The 7th bit acts as a parity bit. <br><br>  Information on the 2nd or 3rd track is stored in the following sequence: <br><ol><li>  A certain number of zero bits, about 20; </li><li>  The character of the beginning of the data ";"; </li><li>  the number, or several numbers, separated by the symbol ‚Äú=‚Äù; </li><li>  end of data "?"; </li><li>  LRC (Longitudinal Redundancy Check) - to check the entire message; </li><li>  A certain number of zero bits, about 20; </li></ol><br>  The first track contains a similar sequence except for the data start character "%". <br><br><h4>  To practice </h4><br>  In order to simulate a magnetic strip during a wire with a card, it is necessary to generate a change in the magnetic field near the read head.  A simple coil is suitable for this, to which a specially modulated signal will be fed.  In order for our simulator card to be pulled, it is necessary to place the coil throughout the entire card.  It is also nice that the direction of magnetization coincides with the direction on the card.  Here we are lucky: it runs along the long edge of the card and there will be a fairly single-layer coil about the length of a card.  To enhance the magnetization as the core, we will use a magnetically soft ferromagnet made of electrical steel (transformer core).  The shape of the core is rectangular;  The flat side is adjacent to the read head, which makes their interconnection stronger. <br><br><img src="https://habrastorage.org/files/b5a/879/26d/b5a87926d492422793d3d0e8119ea2a9.png" alt="image"><br><br>  In the process of winding will help us screwdriver.  It is also desirable to cover the core with lacquer before this in order to exclude the possibility of a short circuit of the coils through the core, otherwise the coil area in the spaces between the closed coils is not effective. <br><br>  For ease of reading, we will pack our coil in a ‚Äúcase‚Äù similar to the shape of a standard plastic card. <br><br><img src="https://habrastorage.org/files/cb6/055/766/cb6055766c224dc780f5ec3de9aa6f74.png" alt="image"><br><br>  Wrap tape. <br><br><img src="https://habrastorage.org/files/950/3f8/48d/9503f848dd664d759978587f3085a4c9.png" alt="image"><br><br>  Now let's think about how we will send a signal to the coil.  For this we need a driver.  Since the output power of the GPIO controller ports is not enough for us, we use the H-bridge type scheme. <br><br><img src="https://habrastorage.org/files/5d5/498/a7c/5d5498a7c5c949f3b6f7ae823f216cc7.png" alt="image"><br><br>  MS1 and MS2 are connected to the ports of the controller, output P1 - to the coil. <br>  Capacitors C43 and C44 serve as filters to remove the DC component from the coil.  This saves battery power and also controls the steepness of the pulse fronts, which in turn has a positive effect on the magnetic interaction between the coil and the magnetic head (the emf value is directly proportional to the rate of change of the magnetic field). <br><br>  Install a filter to save the rest of the circuit from the power shots. <br><br><img src="https://habrastorage.org/files/1c0/d1a/e93/1c0d1ae93a3843f592da8561238738dd.png" alt="image"><br><br>  To generate pulses at the output of the head, we need to supply impulses in antiphase to the outputs of the coil.  To do this, we at the same time change the logic levels on MS1 ‚Äã‚Äãand MS2 to opposite ones, due to which a double VMS voltage value will be applied to the coil outputs for a short time.  Another way is to use only one shoulder of the H-bridge on one side of the coil and the middle point on the other. <br><br><img src="https://habrastorage.org/files/9be/efb/3ad/9beefb3ad2744c3fb67a9835f2516c36.png" alt="image"><br><br>  The controller for controlling the circuit is taken with a margin of computing power - STM32F405. <br><br>  So, the code for the example of the second track: <br><br><pre><code class="hljs pgsql">// : #define STRIPE_2_PIN_P GPIO_Pin_13 #define STRIPE_2_PIN_N GPIO_Pin_14 #define STRIPE_2_PORT GPIOB #define STRIPE_2_RCC_PERIPH RCC_AHB1Periph_GPIOB <span class="hljs-type"><span class="hljs-type">void</span></span> stripe_init(<span class="hljs-type"><span class="hljs-type">void</span></span>) { GPIO_InitTypeDef GPIO_InitStructure; RCC_AHB1PeriphClockCmd(STRIPE_2_RCC_PERIPH, <span class="hljs-keyword"><span class="hljs-keyword">ENABLE</span></span>); GPIO_SetBits(STRIPE_2_PORT, STRIPE_2_PIN_P); GPIO_ResetBits(STRIPE_2_PORT, STRIPE_2_PIN_N); GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT; GPIO_InitStructure.GPIO_OType = GPIO_OType_PP; GPIO_InitStructure.GPIO_Pin = STRIPE_2_PIN_P | STRIPE_2_PIN_N; GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP; GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz; GPIO_Init(STRIPE_2_PORT, &amp;GPIO_InitStructure); } //  : <span class="hljs-type"><span class="hljs-type">void</span></span> stripe_2_toggle(<span class="hljs-type"><span class="hljs-type">void</span></span>) { GPIO_ToggleBits(STRIPE_2_PORT, STRIPE_2_PIN_P | STRIPE_2_PIN_N); } //  : <span class="hljs-type"><span class="hljs-type">void</span></span> stripe_2_tx_0 (<span class="hljs-type"><span class="hljs-type">void</span></span>) { stripe_2_toggle(); vait_stripe_2_period(); } //  : <span class="hljs-type"><span class="hljs-type">void</span></span> stripe_2_tx_1 (<span class="hljs-type"><span class="hljs-type">void</span></span>) { stripe_2_toggle(); vait_stripe_2_half_period(); stripe_2_toggle(); vait_stripe_2_half_period(); }</code> </pre> <br>  Functions for transmitting bits are ready. <br><br>  A more advanced level is to convert the information into a sequence of zeros and ones and begin their sequential transfer (if converting each character at the moment of transfer, this promises a time shift and a violation of the synchronization of the receiving part).  But we neglect this for ease of execution. <br><br><pre> <code class="cmake hljs">//  void buff_2_to_magnetic(char * stripe_2_buff) { unsigned char i, lrc = <span class="hljs-number"><span class="hljs-number">0</span></span>; for (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>; i++) { stripe_2_tx_0(); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*stripe_2_buff) { for (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*stripe_2_buff &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; i)) { stripe_2_tx_1(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { stripe_2_tx_0(); } } lrc ^= *stripe_2_buff; stripe_2_buff++; } for (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lrc &amp; (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; i)) { stripe_2_tx_1(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { stripe_2_tx_0(); } } }</code> </pre><br>  In case you plan to emulate two or more bands at the same time, it should be noted that due to the different recording density, different time intervals arise between the pulses between the pulses, which will require a corresponding number of time meters to measure.  For example, you can use timers or TASK in the operating system. <br><br><h4>  Research part </h4><br><ol><li>  In general, the success of the venture depends on the following factors: </li><li>  VMS voltage; </li><li>  The number of turns of the coil; </li><li>  The diameter of the wire in the coil; </li><li>  Cross-section of the core; </li><li>  Capacity of capacitors C43 and C44; </li><li>  Frequency f; </li><li>  Coil distance from the read head; </li><li>  Magnetic permeability of the core. </li></ol><br>  It is worth considering that some parameters are changeable within specific limits, some are dependent on each other. <br><br>  For example, let's give a different voltage to the coil and find out how its change will affect the result, taking into account the immutability of the other parameters: <br><br><table><tbody><tr><th>  Voltage </th><th>  Mm response distance </th><th>  Mm exposure distance </th><th>  Uneven reading% </th><th>  Uneven exposure% </th></tr><tr><td>  2.3 </td><td>  0 </td><td>  0 </td><td>  10% from the ends </td><td>  15% from the ends </td></tr><tr><td>  2.6 </td><td>  0 </td><td>  one </td><td>  30% from the ends </td><td>  70% from the ends </td></tr><tr><td>  2.8 </td><td>  0 </td><td>  2 </td><td>  70% </td><td>  thirty% </td></tr><tr><td>  2.9 </td><td>  one </td><td>  five </td><td>  100% </td><td>  0% </td></tr><tr><td>  3 </td><td>  2 </td><td>  7 </td><td>  100% </td><td>  0% </td></tr><tr><td>  3.3 </td><td>  four </td><td>  eleven </td><td>  100% </td><td>  0% </td></tr></tbody></table><br><br>  The triggering distance is the maximum distance at which successful reading occurs (0 when directly touched). <br><br>  Impact distance - the distance at which the reading is performed, but with an error. <br><br>  Irregularity of reading - due to the fact that the magnetic core is not closed, at its ends there is a stronger magnetic field. <br><br>  According to the table, it can be seen that the best result falls on the voltage range of 2.8-2.9 V. <br><br><div class="spoiler">  <b class="spoiler_title">waveform graphs at the ends of the coil depending on the voltage</b> <div class="spoiler_text">  2.3 In: <br><br><img src="http://habrastorage.org/files/11e/5f0/f63/11e5f0f635a7482ebd99eda28d37c4c0.png" alt="image"><br><br>  2.6 V: <br><br><img src="http://habrastorage.org/files/c70/c1c/c58/c70c1cc58f8b48ff8a265c9273937995.png" alt="image"><br><br>  2.8 V: <br><br><img src="http://habrastorage.org/files/047/f62/e8d/047f62e8d1694bf38e2529b0482fb1ea.png" alt="image"><br><br>  2.9 V: <br><br><img src="http://habrastorage.org/files/755/5b1/206/7555b12063eb4219a50609c42e9fddfb.png" alt="image"><br><br>  3 V: <br><br><img src="http://habrastorage.org/files/be6/673/58f/be667358ffe74fc8926ca962fcc93648.png" alt="image"><br><br>  3.3 V: <br><br><img src="http://habrastorage.org/files/8ef/91a/b61/8ef91ab61d624ea9ba711b4f06b2db1e.png" alt="image"><br></div></div><br><h4>  findings </h4><br>  In the process, there are two drawbacks: <br><ol><li>  The influence of the signal of the previous track on the next one; </li><li>  Uneven magnetic field intensity along the coil.  It manifests itself especially when dragging a card in contrast to its stationary state. </li></ol><br>  In the first case, the use of additional screens, or a schematic solution in the form of feeding a weakened signal to an adjacent coil in an inverse connection, can help.  Thus, the signal and interference will be in antiphase and extinguish each other.  Also, additional assistance is provided by the closure of the magnetic circuit. <br><br><img src="http://habrastorage.org/files/aaf/5b5/972/aaf5b5972ff042a193aa9578c87c0313.png" alt="image"><br><br>  In the second case, the closure of the magnetic circuit can help, as well as a smooth change in the cross-sectional area of ‚Äã‚Äãthe core closer to the ends of the coil. <br><br><img src="http://habrastorage.org/files/74b/bbd/46d/74bbbd46ddb94a61b2a4625518a72b6b.png" alt="image"><br><br>  Device video: <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/117794013&amp;xid=25657,15700023,15700186,15700191,15700253&amp;usg=ALkJrhjw43yseBaK17vQId8rgjMWvFIznw" width="560" height="315" frameborder="0" title="dynamic magnetic strip in action" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><br><br>  <a href="https://github.com/tachcard/dynamic-magnetic-stripe">Github</a> </div><p>Source: <a href="https://habr.com/ru/post/255033/">https://habr.com/ru/post/255033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255019/index.html">Clouds - white-manned horses or secure ownCloud for ‚Äúsmall‚Äù ones in FreeNAS</a></li>
<li><a href="../255021/index.html">Top 100+ Wolfram | Alpha Sine Functions, or Wolfram | Alpha Overview of Mathematical Features and Syntax</a></li>
<li><a href="../255025/index.html">The story of creating another robot. Part One, Design</a></li>
<li><a href="../255027/index.html">DevCon 2015: announcement of the speakers - representatives of the community</a></li>
<li><a href="../255029/index.html">Creation of microservices</a></li>
<li><a href="../255037/index.html">We start CloudLITE.ru cloud resource store</a></li>
<li><a href="../255039/index.html">Payler: PCI DSS Certification Update Updated to Version 3.0 - DONE</a></li>
<li><a href="../255043/index.html">Type casting on Go</a></li>
<li><a href="../255045/index.html">.NET development: switching between DEV and PROD environments. Part one</a></li>
<li><a href="../255047/index.html">We collect your own smartphone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>