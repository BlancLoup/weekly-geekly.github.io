<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creation of game animation on the example of Pudding Monsters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 Today I will tell you how we simplified the process of creating animation in games using the capabilities of Adobe Flash. 

 Everyone who is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creation of game animation on the example of Pudding Monsters</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/142/bd4/4b6/142bd44b6026e6466e53f079b951a1b1.png"><br><br>  Hello! <br>  Today I will tell you how we simplified the process of creating animation in games using the capabilities of Adobe Flash. <br><a name="habracut"></a><br>  Everyone who is faced with the creation of 2D animation, knows that there are at least two basic approaches - frame-by-frame and program animation.  None of these approaches is acceptable if the mobile application requires complex animation of an object.  In the first case, a huge texture atlas is obtained that is difficult to fit into the limited memory of the device.  In the case of software animation, the artist and the programmer have to spend a lot of time to work hard on all the transformations.  Such animation is usually simplified due to the complexity of the manual transfer of transformation parameters. <br><br>  So what to do if the application needs a beautiful and complex animation?  That's right, you need to <i>automate the</i> process of creating software animation.  Creating an animation should be completely shifted to the artist‚Äôs shoulders, but the programmer should be engaged in writing the logic of its display. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Historically, Adobe Flash has become almost a standard in the field of 2D animation, and starting from version CS5, the original animation file with the .fla is a regular zip, inside of which is a Flash document in XFL format.  That is what we use to export the transformations at the stage of preparing the application resources. <br><br><h6>  Internal device .fla file </h6><br><img src="https://habrastorage.org/storage2/d16/96e/2d4/d1696e2d423a236f55eeb7e4de9ead65.png" alt="image" align="left"><br>  Despite the fact that the XFL format documentation is still not publicly available, it is not difficult to understand its structure (this has already been <a href="http://habrahabr.ru/post/51855/">written</a> on Habr√©).  The file <i>DOMDocument.xml</i> contains the description of all transformations using <a href="http://www.adobe.com/devnet/flash/articles/concept_symbol.html">symbols</a> from the library ( <i>LIBRARY</i> directory).  All the rest in our case is not required. <br><br>  Each keyframe in the <i>DOMDocument.xml</i> file <i>is</i> represented as follows: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DOMFrame</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">acceleration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"39"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">keyMode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"22017"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">motionTweenSnap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tweenType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"motion"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">elements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DOMSymbolInstance</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">libraryItemName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"body_2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"single frame"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">symbolType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"graphic"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">matrix</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Matrix</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.999252"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.038650"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">c</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-0.038665"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.999481"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"441.15"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"890.95"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">matrix</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transformationPoint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Point</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-2.4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"33.6"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transformationPoint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DOMSymbolInstance</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">elements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DOMFrame</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The most important part in this view is the attributes of the <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/geom/Matrix.html">Matrix</a> tag.  It also contains information about the frame number, symbol name, center of transformations and the type of transition between frames. <br><br><h6>  Data processing </h6><br>  To play the transformations on the game engine, a transformation matrix is ‚Äã‚Äãdecomposed.  To get the slope (skew) and scale (scale) values ‚Äã‚Äãfor each coordinate axis, we use the formulas: <br><blockquote>  skew <sub>X</sub> = atan (-c / d) <br>  skew <sub>y</sub> = atan (b / a) <br>  scale <sub>X</sub> = sqrt (a <sup>2</sup> + b <sup>2</sup> ) <br>  scale <sub>Y</sub> = sqrt (c <sup>2</sup> + d <sup>2</sup> ) <br></blockquote><br><h6>  Application resources </h6><br>  After processing, the file with the description of transformations with a format understandable to the game engine enters the application resources.  An animated game object is created based on this file (also XML, but without unnecessary information).  The programmer only needs to add it to the right place on the stage and trigger the desired animation. <br><br>  Images that are inside a .fla file are not used during drawing, but are obtained from the corresponding layers of individual .psd files.  This allows you to use one .fla file when creating animations for multiple resolutions.  The organization of the library .fla files reflects this dependency: <br><br><img src="https://habrastorage.org/storage2/a56/9f3/5a2/a569f35a2ddc672c4ade23371e07eb0a.png" alt="image"><br><br><h6>  The advantages of this approach </h6><br>  Using an example, I will demonstrate the advantages of the described method, which was successfully tested in our game <b>Pudding Monsters</b> .  Hints to the player are realized in the form of animated dialog bubbles, of which 7 different pieces appear only in the first set of levels.  Here's what it looks like in Adobe Flash: <br><br><img src="https://habrastorage.org/storage2/92d/ba2/a06/92dba2a06c775c8808c73173436ce419.png" alt="image"><br><br>  If we went along a simple path and used frame-by-frame animation, the frames for each animation would be placed on texture atlas with an average resolution of 4016x2086 (for the iPhone 4 screen), for example, on this: <br><br><img src="https://habrastorage.org/storage2/fce/236/bc6/fce236bc6548ad507ef62c7af3b712b0.png" alt="image"><br><br>  As a result, it would be necessary to keep in memory about 16 MB for each animation, and this is definitely a bust for such a secondary graphic element.  I would have to simplify the animation and look for ways to optimize. <br><img src="https://habrastorage.org/storage2/52c/030/37b/52c03037b48a7ce5384d884e6065eb7c.png" alt="image" align="right"><br>  With automated transformation transformations, all you need to play animations is an atlas with a resolution of 518x942 pixels and a file with a description of 284 KB.  Besides the fact that so few resources are required, the animation plays at a frame rate of 60 fps. <br><br>  This approach has significantly reduced the effort required to create animation for all our games, but this is just one of the options for automating the process. <br><br>  I would be happy to discuss how you solved similar problems in your projects. </div><p>Source: <a href="https://habr.com/ru/post/169861/">https://habr.com/ru/post/169861/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169845/index.html">Caching data on SSD using EnhanceIO</a></li>
<li><a href="../169847/index.html">Choosing a Chinese tablet '2013</a></li>
<li><a href="../169851/index.html">We get Intel certificates for programming without leaving home</a></li>
<li><a href="../169857/index.html">SketchUp helped assess the speed of the Chelyabinsk phenomenon</a></li>
<li><a href="../169859/index.html">About charisma, bugs and big-eyed birds. The story of a bug tracker</a></li>
<li><a href="../169863/index.html">Photo report from the exhibition ISE - screens, screens and more screens</a></li>
<li><a href="../169867/index.html">Opera has lost 10% of staff due to the transition to WebKit</a></li>
<li><a href="../169869/index.html">Java 8: from PermGen to MetaSpace</a></li>
<li><a href="../169871/index.html">Familiarity with Rest4Enterprise or REST services for the lazy</a></li>
<li><a href="../169873/index.html">On the reception of images of the Earth from meteorological satellites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>