<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use SQL Server Dynamic Management Views and Functions (DMV and DMF)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Microsoft SQL 2005/2008 provides access to Dynamic Management Views and Functions (DMV and DMF). We can use this data to diagnose problems and optimiz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use SQL Server Dynamic Management Views and Functions (DMV and DMF)</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img30.imageshack.us/img30/4097/1mssqlserverdmvsmall.gif" title="MS SQL Dynamic Management Views and Functions (DMV and DMF)" alt="MS SQL Dynamic Management Views and Functions (DMV and DMF)"><br>  Microsoft SQL 2005/2008 provides access to Dynamic Management Views and Functions (DMV and DMF).  We can use this data to diagnose problems and optimize database performance. <br>  Here is a partial list of available information: <ul><li>  Causes of query execution delays. </li><li>  Work with indexes (missing, unused, requiring the most input and output operations, often used). </li><li>  Requests with high I / O overhead, high CPU usage. </li><li>  Queries running most often. </li><li>  Requests suffering from locks. </li></ul>  A full description of all functions can be found in MSDN - <a href="http://msdn.microsoft.com/ru-ru/library/ms188754.aspx">Dynamic Administrative Views and Functions (Transact-SQL)</a> .  For those who have not yet encountered requests for DMV - I recommend reading the article from the MSDN magazine for January 2008: " <a href="http://msdn.microsoft.com/ru-ru/magazine/cc135978.aspx">Opening hidden data to optimize application performance.</a> "  It is quite extensive, contains general information and a large number of ready-made frequently used queries to the DMV. <br>  Next, I want to talk about how you can save and analyze query data to the DMV. <br><a name="habracut"></a><br>  <b>Terms and Definitions</b> <br>  <i>DMV, DMF</i> - Dynamic Management Views and Functions.  Return server status data that can be used to monitor server instance health, diagnose problems, and tune performance. <br>  <i>Storage</i> - a database for the accumulation of information obtained by queries to the DMV and DMF for further analysis. <br><br><h4>  Automatic collection and analysis of DMV and DMF data </h4><br>  I will describe, in my opinion, the biggest drawbacks of working with DMV through simple SQL queries: <ol><li>  DMV data is contained in memory and begins to accumulate again after each server restart.  In addition, they are zeroed for some objects due to various changes in the structure of tables or indexes. </li><li>  A large information system gives an uneven load on the database.  Some of the functionality can be used rarely and therefore some database objects may not be included in the DMV or incorrectly taken into account.  For example, it can be a daily download of a large amount of data or a monthly report.  In addition, it is often necessary to compare the figures before and after the changes.  This is difficult to do without having on hand historical data from DMV and DMF. </li><li>  It is not always possible to work directly with the database, i.e.  when you can make arbitrary queries to the DMV. </li></ol>  The following tools can be used to solve these problems. <br><br><h5>  DMVStats </h5>  <b>A SQL Server 2005 Dynamic Management View Performance Data Warehouse</b> <br>  The project's address at CodePlex: <a href="http://sqldmvstats.codeplex.com/">http://sqldmvstats.codeplex.com</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This application collects information from DMV and DMF in its database and provides a set of ready-made SQL Reporting Services reports for analysis.  To collect data, use the job (jobs) SQL Server Agent. <br>  List of ready reports: <table><tbody><tr><td><ul><li>  Analyze Block Info </li><li>  Executing Requests and Waiting Tasks </li><li>  Index Definitions </li><li>  Index Operational Stats </li><li>  Top IO Queries </li></ul></td><td><ul><li>  Top Worker Queries </li><li>  Virtual File Stats </li><li>  Wait stats </li><li>  Drill-through Guidance </li><li>  Alert </li></ul></td></tr></tbody></table>  <b>Installation and configuration</b> <br>  Instructions for installation, configuration and use: <a href="http://sqldmvstats.codeplex.com/Release/ProjectReleases.aspx%3FReleaseId%3D5502">DMVStats.doc</a> .  In short, the installation process is automated with two scripts.  The InstallDMVStatsDBProcs.cmd script creates the repository database, the necessary sp procedures and installs the SQL Server Agent job.  The DeployReports.cmd script is required to add reports to MS SQL Reporting Services. <br>  The application is managed and configured using reports on SQL Reporting Services. <br><br><img src="http://img21.imageshack.us/img21/7205/2dmvstatsconfigurerepor.gif" title="Management and configuration using the 'Configure DMVstats' report" alt="      'Configure DMVstats'"><br>  To change the task time, to enable or disable it, there are ready-made scripts in the Util directory of the application archive. <br><blockquote>  Note (not reflected in the documentation). <br>  If after the installation the ‚ÄúRules‚Äù report is empty (rules for selecting performance counters), then you need to replace the names in the DatabaseScripts / ConfigDMVstatsDB.sql script to insert them into the DMVconfig.include_perf_counters table.  For example, instead of 'SQLServer: Locks', you must specify 'MSSQL $ SQL2005: Locks', where SQL2005 is the name of your SQL instance.  You can see the full correct name in the sys.dm_os_performance_counters view.  In the same place, by analogy, you can add to the DMVconfig.include_perf_counters table the additional performance counters you need from the sys.dm_os_performance_counters view.  After that, rerun the corrected SQL script. <br></blockquote>  <b>General impressions</b> <br>  The project is distributed with documentation, contains convenient scripts for installation and configuration.  Using MS SQL Reporting Services allows you to analyze data remotely through the website and use the built-in features of automatic construction and distribution of reports on a schedule.  The downside is that not all reports are convenient, some are formed for a very long time.  A rather convoluted architecture is used with the integration of a set of snapshots of data into so-called sets (Baselines), while filters on these sets are not installed in the reports. <br><br>  Sample report "Analyze Block Info". <br><br><img src="http://img44.imageshack.us/img44/941/3dmvstatsanalyzeblockin.gif" title="Sample report &quot;Analyze Block Info&quot;" alt="  ¬´Analyze Block Info¬ª"><br><br>  It is also disappointing that DMVStats was last updated on July 5, 2007.  But in spite of all this, it covers a wide range of tasks for automating the storage and analysis of DMV data.  Overall, DMVStats is a good tool for monitoring and diagnosing database problems for an administrator or developer. <br><br><h5>  Miracle SQLSTAT2005 </h5>  <b>SQL SERVER 2005 performance data warehouse</b> <br>  The project address on CodePlex: <a href="http://sqlstat2005.codeplex.com/">http://sqlstat2005.codeplex.com</a> <br><br>  The SQLSTAT2005 project also has its own database, which is populated with DMV and DMF data on a SQL Server Agent job schedule.  For data analysis, reports are used for SQL Management Studio. <br><br>  Current implementation features: <br><ul><li>  Collecting and saving DMV and DMF data in its database, setting up a schedule and the amount of requested data. </li><li>  Reports on the execution of individual requests and request packets (information about the request, its text, plan, information on input-output). </li><li>  Reports on the use of resources of the processor, memory and disks. </li><li>  Reports support drilling (drill-down), i.e.  from the batch of requests, you can view all the requests, and for specific requests you can already see information about the execution time, the used plan, I / O operations. </li><li>  All versions of SQL Server 2005 are supported, including Express. </li></ul>  <b>Installation and configuration</b> <br>  Installation, Configuration, and Usage Instructions: <a href="http://sqlstat2005.codeplex.com/Release/ProjectReleases.aspx%3FReleaseId%3D30730">Miracle SQLSTAT2005.docx</a> <br>  In short, we simply restore the database from the SQLSTAT2005_v1.bak archive, create the SQL Server Agent job with pens, and add the start report Reports / SQLSTAT2005_StartHERE.rdl from the archive to SQL Server Management Studio. <br><blockquote>  You can add a Custom Report in SQL 2005 version not lower than SP2. </blockquote>  The process of adding reports. <br><img src="http://img41.imageshack.us/img41/6261/4sqlservermanagementstu.gif" title="Add Custom Report to SQL Server Management Studio" alt=" Custom Report  SQL Server Management Studio"><br><br>  An example of one of the reports "SQLSTAT2005 Performance (Statement)".  It shows 30 longest requests. <br><img src="http://img44.imageshack.us/img44/1316/5sqlstat2005performance.gif" title="SQLSTAT2005 - Performance (Statement) Report" alt=" SQLSTAT2005 - Performance (Statement)"><br><br>  <b>General impressions</b> <br>  The storage structure is almost one-to-one replicates DMV tables, only a prefix for tables and several service columns (data snapshot ID and number of records captured) are added.  This is useful when writing additional queries to this database.  Data from DMF, such as texts and query plans, is also stored in the corresponding tables.  A simple principle of working with reports.  When you run a start report, you must select the starting and ending snapshot of data from the list.  After that, all SQLSTAT2005 reports will be available for the selected time period.  The reports are installed locally for Management Studio, on the remote server you only need to create a warehouse database and configure the collection task for the SQL Server Agent. <br><br><h4>  Additional Information </h4><br>  The DMVStats and SQLSTAT2005 projects facilitate the collection and analysis of information presented to SQL Server through DMV and DMF.  If to compare them, on the one hand DMVStats - it is easier to install, configure, and contain more ready-made reports, but is not being developed at the present time.  On the other hand, SQLSTATS2005 is made easier and is in development.  If development and support of SQLSTATS2005 is continued, in the future it will be a more convenient tool for work. <br><br>  In addition to these tools, you yourself can use the approach used in them.  This is the creation of your own tables and a task that, according to a schedule, collects data from DMV and DMF for storage in your tables for further analysis.  To create SQL queries, you can use diagrams that show the relationships between system tables and administrative views: <a href="http://www.microsoft.com/downloads/details.aspx%3FFamilyID%3D2ec9e842-40be-4321-9b56-92fd3860fb32%26displaylang%3Den">SQL Server 2005 System Views Map</a> and <a href="http://www.microsoft.com/downloads/details.aspx%3FFamilyID%3D531c53e7-8a2a-4375-8f2f-5d799aa67b5c%26displaylang%3Den">SQL Server 2008 System Views Map</a> . <br><br>  I also want to mention another solution: <a href="http://www.microsoft.com/downloads/details.aspx%3FFamilyId%3D1d3a4a0d-7e0c-4730-8204-e419218c1efc%26displaylang%3Den">SQL Server 2005 Performance Dashboard Reports</a> .  This is an extension for SQL Server Management Studio that allows you to build reports based on SQL server service data.  Reports work directly with system tables, views, and functions. <br>  List of reports from SQL Server 2005 Performance Dashboard Reports: <table><tbody><tr><td><ul><li>  Performance Dashboard; </li><li>  Blocking; </li><li>  Buffer IO; </li><li>  Buffer Latch; </li><li>  Databases Overview; </li><li>  Expensive Queries; </li><li>  General Waits; </li><li>  Historical IO; </li><li>  Historical Waits; </li><li>  Latch waits; </li></ul></td><td><ul><li>  Missing Indexes; </li><li>  Missing Indexes - XML ‚Äã‚ÄãShowplan; </li><li>  Page Details; </li><li>  Plan Guide; </li><li>  Query Plan; </li><li>  Recent CPU Consumption; </li><li>  Requests Overview; </li><li>  Session Details; </li><li>  Sessions Overview; </li><li>  Traces; </li></ul></td></tr></tbody></table>  Sample start report "Performance Dashboard" from SQL Server 2005 Performance Dashboard Reports. <br><img src="http://img21.imageshack.us/img21/345/6performancedashboardsq.gif" title="Sample Startup Report 'Performance Dashboard' from SQL Server 2005 Performance Dashboard Reports" alt="   'Performance Dashboard'   SQL Server 2005 Performance Dashboard Reports"><br>  Detailed information about Performance Dashboard Reports can be obtained by the links: <br>  SQL Server 2005 Performance Dashboard (Eng) - <a href="http://www.sql-server-performance.com/articles/per/bm_performance_dashboard_2005_p1.aspx">Part 1</a> , <a href="http://www.sql-server-performance.com/articles/per/bm_performance_dashboard_2005_p2.aspx">Part 2</a> , <a href="http://www.sql-server-performance.com/articles/per/bm_performance_dashboard_2005_p3.aspx">Part 3</a> . <br><br>  In this article, I talked about the existing methods and tools for working with the service data provided by MS SQL Server 2005/2008. <br><ol><li>  <a href="">The SQL source code for querying</a> the article " <a href="http://msdn.microsoft.com/ru-ru/magazine/cc135978.aspx">Opening hidden data to optimize application performance.</a> " </li><li>  <a href="http://sqldmvstats.codeplex.com/">DMVStats</a> - A SQL Server 2005 Dynamic Management View Performance Data Warehouse. </li><li>  <a href="http://sqlstat2005.codeplex.com/">Miracle SQLSTAT2005</a> - SQL SERVER 2005 performance data warehouse. </li><li>  <a href="http://www.microsoft.com/downloads/details.aspx%3FFamilyId%3D1d3a4a0d-7e0c-4730-8204-e419218c1efc%26displaylang%3Den">SQL Server 2005 Performance Dashboard Reports</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/70121/">https://habr.com/ru/post/70121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70113/index.html">Get caught WiFi is big and small</a></li>
<li><a href="../70114/index.html">Augmented Reality</a></li>
<li><a href="../70117/index.html">3 Things That Annoy Me in American Style Letters</a></li>
<li><a href="../70118/index.html">Big and strong hard-rider</a></li>
<li><a href="../70119/index.html">Text at any cost: RTF</a></li>
<li><a href="../70123/index.html">Cross-platform game on MonoTouch</a></li>
<li><a href="../70125/index.html">Sheraton hotels are already using Windows 7 and multitouch</a></li>
<li><a href="../70128/index.html">Radio without batteries</a></li>
<li><a href="../70134/index.html">VIA EPIA-P720, Pico-ITX format motherboard, loses 1080p without straining too much</a></li>
<li><a href="../70135/index.html">Utility for optimizing graphics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>