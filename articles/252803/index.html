<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Coub API Tutorial</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day we released the Coub API . Now you can make applications, watch the tape, like, rekobit, that is, almost everything that can be done on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Coub API Tutorial</h1><div class="post__text post__text-html js-mediator-article">  The other day we released the <a href="http://coub.com/dev/docs/Coub%2BAPI/Overview">Coub API</a> .  Now you can make applications, watch the tape, like, rekobit, that is, almost everything that can be done on the site can be done through the API.  But the most important thing is that now it is possible to create cobs from third-party applications through the API. <br><br>  In this tutorial, I'll show you how to make the simplest Koba client on Ruby on Rails.  The application allows you to log in through Cob and generate such a cob with any text: <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://coub.com/embed/5eoxr%3Fautoplay%3Dtrue%26maxheight%3D315%26maxwidth%3D560%26muted%3Dtrue&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhhcTe7CxFScVIXVX4sAFqMmEdnLlg" allowfullscreen="true" frameborder="0" autoplay="true" width="560" height="305"></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The working version of this application is at <a href="http://fantozzi.dev2.workisfun.ru/">fantozzi.dev2.workisfun.ru</a> , the application code from this tutorial can be viewed on GitHub: <a href="https://github.com/igorgladkoborodov/memegenerator">github.com/igorgladkoborodov/memegenerator</a> <br><a name="habracut"></a><br><h2>  Oauth </h2><br>  Cob uses the standard protocol to authorize <a href="http://oauth.net/">OAuth 2.0</a> .  It is used in many services that provide an external API (Facebook, for example), it has a lot of documentation and libraries for any platform. <br><br>  It works like this: the application with its unique key goes to a special page on coub.com, where Kob asks if the user agrees to give the application access.  If the user allows, Cob returns the user back to the application, and with the request returns the user's token, which is then used for all user API requests.  The same happens, for example, when logging in via Facebook or Twitter. <br><br>  We will write on RoR and for authorization through OAuth for rails everything has been written for a long time, we will use for this the <a href="https://github.com/intridea/omniauth-oauth2">omniauth-oauth2 heme</a> and the official Cobov <a href="https://github.com/coub/omniauth-coub">omniauth-coub gem</a> . <br><br><h2>  Application Creation and Authorization </h2><br>  Create an application with the eloquent title memegenerator and fasten it to Pow (or who uses what): <br><br><pre><code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/apps/ $ rails new memegenerator $ ln -s ~/apps/memegenerator/ ~/.pow/memegenerator</code> </pre> <br>  We check in the browser that we have an empty rail application at <a href="http://memegenerator.dev/">memegenerator.dev</a> . <br><br>  2. Register our new application at <a href="http://coub.com/dev/applications/">coub.com/dev/applications</a> <br><br><img src="https://habrastorage.org/files/5b5/cb1/a52/5b5cb1a524184024a18acccea31d379e.png"><br><br>  In the Website field we specify the URL of our test application, in the Callback URL field we write <pre>  http://memegenerator.dev/auth/coub/callback </pre><br><br>  After creating the application, Kob will give us Application ID and Secret, we will need them further: <br><br><img src="https://habrastorage.org/files/bf9/e18/da7/bf9e18da71834e42b209a621846e41ea.png"><br><br>  3. Install the omniauth-coub hem: <br><br>  Gemfile: <br><pre> <code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">"omniauth-coub"</span></span></code> </pre><br><pre> <code class="bash hljs">$ bundle install</code> </pre><br>  4. Add cob to omniauth providers: <br><br>  config / initializers / omniauth.rb: <br><pre> <code class="ruby hljs">Rails.application.config.middleware.use OmniAuth::Builder <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> provider <span class="hljs-symbol"><span class="hljs-symbol">:coub</span></span>, ENV[<span class="hljs-string"><span class="hljs-string">"COUB_KEY"</span></span>], ENV[<span class="hljs-string"><span class="hljs-string">"COUB_SECRET"</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">scope:</span></span> <span class="hljs-string"><span class="hljs-string">"logged_in,create"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  COUB_KEY and COUB_SECRET are the Application ID and Secret from the previous step, you can add them to the ENV variables or, for the test, insert the lines right here, although it‚Äôs undesirable to leave keys in the code, you know. <br><br>  If you have Pow, then you can add variables in the .powenv file in the application root: <br><br>  .powenv: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> COUB_KEY=<span class="hljs-string"><span class="hljs-string">"[Application ID]"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> COUB_SECRET=<span class="hljs-string"><span class="hljs-string">"[Secret]"</span></span></code> </pre><br>  In scope, you can specify what rights the application will have.  Our application is only needed to create cobs, so we will not ask for anything extra, just authorization and creation of a cob: logged_in, create.  A complete list of access modes can be found in <a href="http://coub.com/dev/docs/Coub%2BAPI/Authentication">the API documentation</a> . <br><br>  5. We create a user model with the from_omniauth method, which creates or finds in the user base the data that the authorization server transmitted to us on Kobe. <br><br>  What happens at this point and in the pair of the following points is well explained in one of the episodes of <a href="http://railscasts.com/episodes/304-omniauth-identity">RailsCasts</a> . <br><br><pre> <code class="bash hljs">$ rails g model user provider:string uid:string auth_token:string name:string $ rake db:migrate</code> </pre><br>  app / models / user.rb: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from_omniauth</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">provider</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">provider</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uid</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uid</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first_or_initialize</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth_token</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">credentials</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">token</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extra</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">raw_info</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">save!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  6. Create a session controller.  Through it we create and delete a session. <br><br>  The create method is the place where the user is returned with his token and authorization data.  Here we create a user through the from_omniauth method, which we wrote in the last step, and save its token, write it in the cookie so that when you restart the browser, you can return this session. <br><br><pre> <code class="bash hljs">$ rails g controller sessions</code> </pre><br>  app / controllers / sessions_controller.rb: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SessionsController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from_omniauth</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">env</span></span></span><span class="hljs-class">["</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">omniauth</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth</span></span></span><span class="hljs-class">"]) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cookies</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">permanent</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth_token</span></span></span><span class="hljs-class">] = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth_token</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">redirect_to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">root_url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">destroy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cookies</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">delete</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auth_token</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">redirect_to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">root_url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Let the application muzzle stay in the session controller for now, so the index method is here. <br><br>  7. In order to have access to the current user, add the current_user method to the ApplicationController, which searches for the user in the database if we have a cookie with its token. <br><br>  app / controllers / application_controller.rb: <br><pre> <code class="ruby hljs">helper_method <span class="hljs-symbol"><span class="hljs-symbol">:current_user</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_user</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_user</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function">= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_by_auth_token</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cookies[</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:auth_token</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cookies[<span class="hljs-symbol"><span class="hljs-symbol">:auth_token</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  8. We display the link to the username on the face or show the current user with the link to the output. <br><br>  app / views / sessions / index.html.erb: <br><pre> <code class="ruby hljs">&lt;% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_user %&gt; &lt;%= current_user.name %&gt; &lt;%= link_to <span class="hljs-string"><span class="hljs-string">"Log out"</span></span>, logout_path, <span class="hljs-symbol"><span class="hljs-symbol">method:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:delete</span></span> %&gt; &lt;% <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> %&gt; &lt;%= link_to <span class="hljs-string"><span class="hljs-string">"Auth with Coub"</span></span>, <span class="hljs-string"><span class="hljs-string">"/auth/coub"</span></span> %&gt; &lt;% <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> %&gt;</code> </pre><br>  Along the way / auth / coub, he omnia omniauth-oauth2 will transfer to the login page on coub.com. <br><br>  9. Register routes: <br><br>  config / routes.rb: <br><pre> <code class="ruby hljs">Rails.application.routes.draw <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> root <span class="hljs-string"><span class="hljs-string">"sessions#index"</span></span> get <span class="hljs-string"><span class="hljs-string">"/auth/:provider/callback"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"sessions#create"</span></span> delete <span class="hljs-string"><span class="hljs-string">"logout"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"sessions#destroy"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  With authorization everything.  Go to <a href="http://memegenerator.dev/">memegenerator.dev</a> , check.  It should look something like this: <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://coub.com/embed/5ai5v%3Fautoplay%3Dtrue%26maxheight%3D315%26maxwidth%3D560%26muted%3Dtrue&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhgDFupS5m7B8ugbm6fD2xH6UGnP6w" allowfullscreen="true" frameborder="0" autoplay="true" width="491" height="315"></iframe><br><br>  Now we have a user in the database with a token that can make requests through the Coub API. <br><br><h2>  API Requests </h2><br>  Having a token you can make requests to the API.  These are common HTTP requests, as in a browser.  GET requests can also be tested in a browser.  Each request, in addition to its own parameters, must contain the access_token parameter with the user's token, which the authorization server previously issued to us. <br><br>  For example, to like a cob, you need to do something like this: <br><pre> <code class="bash hljs">POST http://coub.com/api/v2/likes?id=[coub_id]&amp;channel_id=[channel_id]&amp;access_token=[users_token]</code> </pre><br>  Some requests can be done without a token, for example, info about Kobe (without a token, only public cobs are available).  This is a GET request, this link can be opened simply in the browser: <br><pre> <code class="bash hljs">GET http://coub.com/api/v2/coubs/4yp6r</code> </pre><br>  All these requests are well documented, the full list can be found here: <a href="http://coub.com/dev/docs/Coub%2BAPI/Overview">coub.com/dev/docs/Coub+API/Overview</a> <br><br><h2>  Customer </h2><br>  Each time manually making requests and adding a token is inconvenient, therefore we will add the User model to the client method through which we will make requests: <br><br>  app / models / user.rb: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function">= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Faraday</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:url</span></span></span></span><span class="hljs-function"><span class="hljs-params"> =&gt; </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"http://coub.com/api/v2/"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> =&gt; {</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">:access_token</span></span></span></span><span class="hljs-function"><span class="hljs-params"> =&gt; auth_token})</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Gemfile: <br><pre> <code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">"faraday"</span></span></code> </pre><br><pre> <code class="bash hljs">$ bundle install</code> </pre><br>  We make requests via Faraday, this is an HTTP client on Ruby. <br><br>  Run the console, test requests for api: <br><br><pre> <code class="bash hljs">$ rails c &gt; user = User.first &gt; user.client.get <span class="hljs-string"><span class="hljs-string">"coubs/4yp6r"</span></span></code> </pre><br>  Answers are given in JSON format, so if we want to read what the server returned, we need to parse the answer with the standard JSON library: <br><br><pre> <code class="ruby hljs">&gt; coub_info = JSON.parse(user.client.get(<span class="hljs-string"><span class="hljs-string">"coubs/4yp6r"</span></span>).body) &gt; coub_info[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9090841</span></span></code> </pre><br>  We have a Koba ID, let's like it: <br><br><pre> <code class="bash hljs">&gt; user.client.post <span class="hljs-string"><span class="hljs-string">"likes?id=#{coub_info["</span></span>id<span class="hljs-string"><span class="hljs-string">"]}"</span></span></code> </pre><br><br><h2>  Generate video </h2><br>  We have a video, a frame from the film, we need to put the text on it three times at different times.  To work with video through the console, there is the ffmpeg program; in it, through the console, you can do almost anything with video. <br><br>  On a poppy through Homebrew, it is placed like this: <br><br><pre> <code class="bash hljs">$ brew install ffmpeg --with-freetype</code> </pre><br>  We put the text through ffmpeg with the drawtext filter: <br><br><pre> <code class="bash hljs">$ ffmpeg -i template.mp4 -vf <span class="hljs-string"><span class="hljs-string">"drawtext=enable='between(t,1,2)':text=Blah:fontfile=PFDinTextCondPro-XBlack.ttf:fontsize=40:fontcolor=white:x=(w-tw)/2:y=(h*0.9-th)"</span></span> output.mp4</code> </pre><br><br>  This line means: <br><br>  1. <b>ffmpeg -i template.mp4 -vf</b> : take the video file template.mp4.  The file for this tutorial can be downloaded <a href="">here</a> . <br><br>  2. <b>drawtext = enable</b> : overlay text <br><br>  3. <b>between (t, 1,2)</b> : from first to second second <br><br>  4. <b>fontfile = PFDinTextCondPro-XBlack.ttf</b> : use TTF font file <br><br>  5. <b>text = Blah</b> : write the text Blah <br><br>  6. <b>fontsize = 40</b> : font size <br><br>  7. <b>fontcolor = white</b> : white <br><br>  8. <b>x = (w-tw) / 2: y = (h * 0.9-th)</b> : text position in the center below (w and h is the size of the video, tw and th is the size of the block with text) <br><br>  9. <b>output.mp4</b> : write everything to this file <br><br>  To write three texts, you just need to write three drawtext separated by a comma: <br><br><pre> <code class="bash hljs">$ ffmpeg -i template.mp4 -vf <span class="hljs-string"><span class="hljs-string">"drawtext=enable='between(t,1,2)':text=Text1:fontfile=PFDinTextCondPro-XBlack.ttf:fontsize=40:fontcolor=white:x=(w-tw)/2:y=(h*0.9-th), drawtext=enable='between(t,3,5)':text=Text2:fontfile=PFDinTextCondPro-XBlack.ttf:fontsize=40:fontcolor=white:x=(w-tw)/2:y=(h*0.9-th), drawtext=enable='between(t,6.3,8)':text=Text3:fontfile=PFDinTextCondPro-XBlack.ttf:fontsize=40:fontcolor=white:x=(w-tw)/2:y=(h*0.9-th)"</span></span> output.mp4</code> </pre><br>  In the tempo folder, you can fold the file template.mp4 and the font file (you can take any TTF from the font folder) and try to start it in the console, it should generate the correct video. <br><br><h2>  Uploading video </h2><br>  We have a video, now we need to make a cob out of it. <br><br>  Cob through the API is pumped in three stages: <br><br>  1. First, we initialize the download with the POST coubs / init_upload request, in response we get the id of the coba and its permalink. <br><pre> <code class="ruby hljs">$ rails c &gt; user = User.first &gt; init_response = JSON.parse(user.client.post(<span class="hljs-string"><span class="hljs-string">"coubs/init_upload"</span></span>).body) &gt; coub_id = init_response[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] &gt; permalink = init_response[<span class="hljs-string"><span class="hljs-string">"permalink"</span></span>]</code> </pre><br>  2. Uploading video with POST coubs /: id / upload_video request.  The file is transmitted in the request body, video / mp4 must be transferred to the Content-Type header: <br><br><pre> <code class="bash hljs">&gt; user.client.post <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |r| r.url <span class="hljs-string"><span class="hljs-string">"coubs/#{coub_id}/upload_video"</span></span> r.headers[<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>] = <span class="hljs-string"><span class="hljs-string">"video/mp4"</span></span> r.body = File.open(<span class="hljs-string"><span class="hljs-string">"tmp/output.mp4"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">read</span></span> end</code> </pre><br>  If we want to upload a separate soundtrack to Koba, then this can be done by a separate query coubs /: id / upload_audio.  This time we do not need this, so we omit this request. <br><br>  3. We finalize the creation of a kob with a POST coubs /: id / finalize_upload request, in the parameters we transfer the title, privacy settings, tags, whether the sound is on. <br><br><pre> <code class="bash hljs">&gt; user.client.post <span class="hljs-string"><span class="hljs-string">"coubs/#{coub_id}/finalize_upload"</span></span>, title: <span class="hljs-string"><span class="hljs-string">"Test coub"</span></span>, original_visibility_type: <span class="hljs-string"><span class="hljs-string">"private"</span></span>, tags: <span class="hljs-string"><span class="hljs-string">"tag1, tag2, tag3"</span></span>, sound_enabled: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br>  After downloading Koba, it will take some time to process: the video on the Koba servers will be converted into several formats for different platforms, thumbnails and a bunch of all such resource-intensive things will be generated.  Conversion progress can be checked GET request coubs /: id / finalize_status.  It gives something like this JSON {percent_done: 20, done: false}. <br><br><pre> <code class="bash hljs">&gt; user.client.get <span class="hljs-string"><span class="hljs-string">"coubs/#{coub_id}/finalize_status"</span></span></code> </pre><br>  OK.  We tested it in the console, now all this needs to be assembled into the application. <br><br><h2>  Coub Model </h2><br>  Create a Coub model: <br><br><pre> <code class="bash hljs">$ rails g model coub user:belongs_to title:string visibility_type:string tags:string permalink:string coub_id:string text1:string text2:string text3:string $ rake db:migrate</code> </pre><br>  2. We make the method generate_video_file, which generates a video from a video template and three texts located in the text1, text2, text3 fields.  Template video and font put in the assets.  We put the finished video in the tmp folder. <br><br>  app / models / coub.rb: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">escape_ffmpeg_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span></span> text.to_s.gsub(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">"\\\\\\\\\\\\\\\\\\\\\\\\'"</span></span>).gsub(<span class="hljs-string"><span class="hljs-string">":"</span></span>, <span class="hljs-string"><span class="hljs-string">"\\\\\\\\\\\\\\\\:"</span></span>).mb_chars.upcase <span class="hljs-comment"><span class="hljs-comment"># Crazy ffmpeg escaping end def ffmpeg_drawtext(text, from, to) font_file = File.join(Rails.root, "app", "assets", "fonts", "PFDinTextCondPro-XBlack.ttf") "drawtext=enable='between(t,#{from},#{to})':text=#{escape_ffmpeg_text(text)}:fontfile=#{font_file}:fontsize=40:fontcolor=white:x=(w-tw)/2:y=(h*0.9-th)" end def generate_video_file self.video_file = File.join(Rails.root, "tmp", "output-#{Time.now.to_i}.mp4") template_file = File.join(Rails.root, "app", "assets", "videos", "template.mp4") `ffmpeg -i #{template_file} -vf \"#{ffmpeg_drawtext(text1, 1, 2)}, #{ffmpeg_drawtext(text2, 3, 5)}, #{ffmpeg_drawtext(text3, 6.3, 8)}\" #{video_file}` return video_file end</span></span></code> </pre><br>  3. We make a method that in three stages uploads a video to Kob: <br><br>  app / models / coub.rb: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload_video</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function">= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">text2</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visibility_type</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function">= "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">private</span></span></span><span class="hljs-function">" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">self</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tags</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function">= "" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_response</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JSON</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(client.post(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"coubs/init_upload"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>.body) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.coub_id = init_response[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.permalink = init_response[<span class="hljs-string"><span class="hljs-string">"permalink"</span></span>] save client.post <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|r|</span></span> r.url <span class="hljs-string"><span class="hljs-string">"coubs/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{coub_id}</span></span></span><span class="hljs-string">/upload_video"</span></span> r.headers[<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>] = <span class="hljs-string"><span class="hljs-string">"video/mp4"</span></span> r.body = File.open(video_file, <span class="hljs-string"><span class="hljs-string">"r"</span></span>).read <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> client.post <span class="hljs-string"><span class="hljs-string">"coubs/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{coub_id}</span></span></span><span class="hljs-string">/finalize_upload"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">title:</span></span> title, <span class="hljs-symbol"><span class="hljs-symbol">original_visibility_type:</span></span> visibility_type, <span class="hljs-symbol"><span class="hljs-symbol">tags:</span></span> tags, <span class="hljs-symbol"><span class="hljs-symbol">sound_enabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_and_upload_video</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate_video_file</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload_video</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  4. We register that Cob belongs to the user and at the same time we write the client method for convenient access to the client through the user: <br><br>  app / models / coub.rb: <br><pre> <code class="ruby hljs">belongs_to <span class="hljs-symbol"><span class="hljs-symbol">:user</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function">= </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">user</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  5. The url method returns the url to the permalink: <br><br>  app / models / coub.rb: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">url</span></span></span><span class="hljs-function"> "</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coub</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">com</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">/</span></span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">#{permalink}" end</span></span></span></span></code> </pre><br>  Check if everything works: <br><br><pre> <code class="bash hljs">$ rails c &gt; coub = Coub.new &gt; coub.user = User.first &gt; coub.text1 = <span class="hljs-string"><span class="hljs-string">'Text 1'</span></span> &gt; coub.text2 = <span class="hljs-string"><span class="hljs-string">'Text 2'</span></span> &gt; coub.text3 = <span class="hljs-string"><span class="hljs-string">'Text 3'</span></span> &gt; coub.tags = <span class="hljs-string"><span class="hljs-string">'tag1, tag2, tag3'</span></span> &gt; coub.visibility_type = <span class="hljs-string"><span class="hljs-string">'unlisted'</span></span> &gt; coub.generate_and_upload_video &gt; coub.url =&gt; <span class="hljs-string"><span class="hljs-string">"http://coub.com/view/5dbyc"</span></span></code> </pre><br>  You can go to this URL and look at the blue screen ‚ÄúYour coub is being processed‚Äù. <br><br>  It remains to do for all this controller: <br><br>  1. Create a coubs controller.  It will consist of two methods: index (this will be a new face, instead of sessions # index) and create.  When creating a Koba, we immediately redirect to it. <br><br><pre> <code class="bash hljs">$ rails g controller coubs</code> </pre><br>  app / controllers / coubs_controller.rb: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoubsController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coub</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coub</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coub_params</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">merge</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class">)) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coub</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">generate_and_upload_video</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">redirect_to</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coub</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coub_params</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">require</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">coub</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">permit</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text1</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text2</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text3</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visibility_type</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tags</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  2. Drag index.html.erb from sessions to coubs and fasten the form there: <br><br>  app / views / coubs / index.html.erb: <br><pre> <code class="ruby hljs">&lt;% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> current_user %&gt; &lt;p&gt;You<span class="hljs-string"><span class="hljs-string">'re logged in as &lt;%= current_user.name %&gt;. &lt;%= link_to "Log out", logout_path, method: :delete %&gt;&lt;/p&gt; &lt;%= form_for Coub.new, url: {action: "create"} do |f| %&gt; &lt;%= f.text_field :text1, placeholder: "To me", maxlength: 30, size: 50 %&gt;&lt;br /&gt; &lt;%= f.text_field :text2, placeholder: "Your Coub API", maxlength: 30, size: 50 %&gt;&lt;br /&gt; &lt;%= f.text_field :text3, placeholder: "Is a piece of shit", maxlength: 30, size: 50 %&gt;&lt;br /&gt; &lt;%= f.select :visibility_type, options_for_select(["public", "friends", "unlisted", "private"]) %&gt;&lt;br /&gt; &lt;%= f.text_field :tags, placeholder: "first tag, second tag" %&gt;&lt;br /&gt; &lt;%= f.submit "Create Coub" %&gt; &lt;% end %&gt; &lt;% else %&gt; &lt;p&gt;Please &lt;a href="/auth/coub"&gt;log in via Coub&lt;/a&gt;.&lt;/p&gt; &lt;% end %&gt;</span></span></code> </pre><br>  Everything, now we come into the browser, and we check that everything works: <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://coub.com/embed/5dd0n%3Fautoplay%3Dtrue%26maxheight%3D315%26maxwidth%3D560%26muted%3Dtrue&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhgl-VwKh5WkG-p6sGF8MfT7e9PFFw" allowfullscreen="true" frameborder="0" autoplay="true" width="458" height="315"></iframe><br>  In this tutorial, I described only the principle of the API.  Of course, for this application, there is a lot more to add: validation, validation of API responses, error handling, drawing interface, tests.  A slightly doped version of this script is here <a href="http://fantozzi.dev2.workisfun.ru/">http://fantozzi.dev2.workisfun.ru</a> , everything is the same there, but the video is being prepared and uploaded asynchronously via delayed_job. <br><br>  The sources of this tutorial are in the githaba: <a href="https://github.com/igorgladkoborodov/memegenerator/">https://github.com/igorgladkoborodov/memegenerator/</a> . <br><br>  If you have any questions about this tutorial or API, write to <a href="">igor@coub.com</a> . </div><p>Source: <a href="https://habr.com/ru/post/252803/">https://habr.com/ru/post/252803/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252789/index.html">Applications in the electronic document management system. Part 1: Key Principles, Components, and Features</a></li>
<li><a href="../252791/index.html">About educational robotics and circles</a></li>
<li><a href="../252793/index.html">GPS control on the free service ViaLatM 2.0</a></li>
<li><a href="../252799/index.html">How to create instances in Google Cloud, set up access and hook Bucket to it. Howto</a></li>
<li><a href="../252801/index.html">VMware VDI Solutions Video Review, Horizon 6 Update Review</a></li>
<li><a href="../252805/index.html">Hardware Shared DAS or why LSI Syncro is needed</a></li>
<li><a href="../252809/index.html">Restart daemon in PHP without losing connections to it</a></li>
<li><a href="../252813/index.html">Can you trust the code in the editor? bi-directional text</a></li>
<li><a href="../252817/index.html">Automation of financial statements</a></li>
<li><a href="../252819/index.html">How to prepare TCP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>