<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We disassemble iPhone Core Data Recipes. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 This article is the second and final article in the ‚ÄúDisassembling iPhone Core Data Recipes‚Äù series. The first part of the article, you...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We disassemble iPhone Core Data Recipes. Part 2</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Introduction</b> </h4><br>  This article is the second and final article in the ‚ÄúDisassembling iPhone Core Data Recipes‚Äù series.  The first part of the article, you can read <a href="http://habrahabr.ru/blogs/macosxdev/136319/">here</a> .  The purpose of the series of articles is to help a novice iOS developer to understand how to work correctly with a SQLite database using Core Data using the example of iPhone Core Data Recipes.  In the final article we will discuss the functionality of adding, editing and deleting records from the database. <br><br><h4>  <b>Prerequisites</b> </h4><br>  For self-study of the source code of this application, you need a standard set of tools: <br><ul><li>  Mac os x </li><li>  Xcode </li></ul><br>  This set will allow you to view, change and run the application on the simulator.  In case, if you want to try to run it on a real iPhone, participation in the iOS Developer Program is required. <br><br>  And also, which is quite important, you need a basic understanding of the structure of the Objective-C language and the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Links to the materials and tools used are provided in the References section. <br><a name="habracut"></a><br><h4>  <b>How To Create a New Recipe</b> </h4><br>  So, the first thing we need is to create a new recipe.  For the creation of a new recipe, in this project, the view controller - RecipeAddViewController is responsible.  Consider its contents. <br><br>  <b>RecipeAddViewController.h</b> <br><pre><code class="hljs coffeescript">@protocol RecipeAddDelegate; @class Recipe; @interface RecipeAddViewController : UIViewController &lt;UITextFieldDelegate&gt; { @private <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Recipe,   managedObjectContext Recipe *recipe; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     UITextField *nameTextField; id &lt;RecipeAddDelegate&gt; delegate; } @property(nonatomic, retain) Recipe *recipe; @property(nonatomic, retain) IBOutlet UITextField *nameTextField; @property(nonatomic, assign) id &lt;RecipeAddDelegate&gt; delegate; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   - (void)save; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    - (void)cancel; @end @protocol RecipeAddDelegate &lt;NSObject&gt; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> recipe == nil <span class="hljs-literal"><span class="hljs-literal">on</span></span> cancel - (void)recipeAddViewController:(RecipeAddViewController *)recipeAddViewController didAddRecipe:(Recipe *)recipe; @end</code> </pre> <br>  <b>RecipeAddViewController.m</b> <br><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#import</span></span> <span class="hljs-comment"><span class="hljs-comment">"RecipeAddViewController.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#import</span></span> <span class="hljs-comment"><span class="hljs-comment">"Recipe.h"</span></span> @implementation <span class="hljs-type"><span class="hljs-type">RecipeAddViewController</span></span> @synthesize recipe; @synthesize nameTextField; @synthesize delegate; - (void)viewDidLoad { //  navigation bar <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem.title = @<span class="hljs-comment"><span class="hljs-comment">"Add Recipe"</span></span>; //  <span class="hljs-type"><span class="hljs-type">Cancel</span></span>      cancel <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> *cancelButtonItem = [[<span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> alloc] initWithTitle:@<span class="hljs-comment"><span class="hljs-comment">"Cancel"</span></span> style:<span class="hljs-type"><span class="hljs-type">UIBarButtonItemStyleBordered</span></span> target:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> action:@selector(cancel)]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem.leftBarButtonItem = cancelButtonItem; [cancelButtonItem release]; //  <span class="hljs-type"><span class="hljs-type">Save</span></span>      save <span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> *saveButtonItem = [[<span class="hljs-type"><span class="hljs-type">UIBarButtonItem</span></span> alloc] initWithTitle:@<span class="hljs-comment"><span class="hljs-comment">"Save"</span></span> style:<span class="hljs-type"><span class="hljs-type">UIBarButtonItemStyleDone</span></span> target:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> action:@selector(save)]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem.rightBarButtonItem = saveButtonItem; [saveButtonItem release]; [nameTextField becomeFirstResponder]; } ... //   - (void)save { recipe.name = nameTextField.text; <span class="hljs-type"><span class="hljs-type">NSError</span></span> *error = <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; if (![recipe.managedObjectContext save:&amp;error]) { <span class="hljs-type"><span class="hljs-type">NSLog</span></span>(@<span class="hljs-comment"><span class="hljs-comment">"Unresolved error %@, %@"</span></span>, error, [error userInfo]); abort(); } [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.delegate recipeAddViewController:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> didAddRecipe:recipe]; } //    - (void)cancel { [recipe.managedObjectContext deleteObject:recipe]; <span class="hljs-type"><span class="hljs-type">NSError</span></span> *error = <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; if (![recipe.managedObjectContext save:&amp;error]) { <span class="hljs-type"><span class="hljs-type">NSLog</span></span>(@<span class="hljs-comment"><span class="hljs-comment">"Unresolved error %@, %@"</span></span>, error, [error userInfo]); abort(); } [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.delegate recipeAddViewController:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> didAddRecipe:<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>]; } //..    <span class="hljs-type"><span class="hljs-type">ARC</span></span>,    - (void)dealloc { [recipe release]; [nameTextField release]; [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> dealloc]; } @end</code> </pre><br>  As a result, the form of adding a new recipe, looks like this <br><img src="https://habrastorage.org/storage2/daf/988/097/daf988097bdbcec65395dd427f7a46b6.png"><br>  A detailed discussion of the save &amp; cancel action will be below. <br><br><h5>  <b>Open the form to create a new recipe</b> </h5><br><img src="https://habrastorage.org/storage2/033/ec5/564/033ec55641c491248849c56db26bf2b7.png"><br>  The button for creating a new recipe is located in the main window of our application (see the screenshot above).  Let's look at it more. <br><br>  This button is created in the viewDidLoad method of the RecipeListTableViewController controller. <br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonItem</span></span> *addButtonItem = [[<span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonItem</span></span> alloc] initWithBarButtonSystemItem:<span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonSystemItemAdd</span></span> target:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> action:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(add:)]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem.rightBarButtonItem = addButtonItem; [addButtonItem release];</code> </pre><br>  The add action is attached to this button, which is also located in the RecipeListTableViewController controller (see comments in the source code). <br><pre> <code class="hljs ruby">- (void)<span class="hljs-symbol"><span class="hljs-symbol">add:</span></span>(id)sender { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  RecipeAddViewController     RecipeAddViewController *addController = [[RecipeAddViewController alloc] <span class="hljs-symbol"><span class="hljs-symbol">initWithNibName:</span></span>@<span class="hljs-string"><span class="hljs-string">"RecipeAddView"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">bundle:</span></span><span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   RecipeListTableViewController addController.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> managedObjectContext   Recipe   NSEntityDescription,   -      Recipe Recipe *newRecipe = [NSEntityDescription <span class="hljs-symbol"><span class="hljs-symbol">insertNewObjectForEntityForName:</span></span>@<span class="hljs-string"><span class="hljs-string">"Recipe"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">inManagedObjectContext:</span></span><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.managedObjectContext]; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Recipe  RecipeAddViewController addController.recipe = newRecipe; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   RecipeAddViewController UINavigationController *navigationController = [[UINavigationController alloc] <span class="hljs-symbol"><span class="hljs-symbol">initWithRootViewController:</span></span>addController]; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">presentModalViewController:</span></span>navigationController <span class="hljs-symbol"><span class="hljs-symbol">animated:</span></span>YES]; [navigationController release]; [addController release]; }</code> </pre><br>  After performing this action, the form for adding a new recipe discussed above will open.  On this form, two actions are available for the user - Save &amp; Cancel. <br><br><h6>  <b>Save the new recipe</b> </h6><br><pre> <code class="hljs pgsql">- (<span class="hljs-type"><span class="hljs-type">void</span></span>)save { // <span class="hljs-type"><span class="hljs-type">name</span></span>  Recipe     recipe.name = nameTextField.text; NSError *error = nil; //   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![recipe.managedObjectContext save:&amp;error]) { NSLog(@"Unresolved error %@, %@", error, [error userInfo]); <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>(); } //     RecipeDetailViewController (     .    "  ") [self.delegate recipeAddViewController:self didAddRecipe:recipe]; }</code> </pre><br><h6>  <b>Canceling the preservation of a new recipe</b> </h6><br><pre> <code class="hljs lua">- (void)cancel { //    Recipe,  ,        [recipe.managedObjectContext deleteObject:recipe]; NSError *<span class="hljs-built_in"><span class="hljs-built_in">error</span></span> = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![recipe.managedObjectContext save:&amp;<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>]) { NSLog(@<span class="hljs-string"><span class="hljs-string">"Unresolved error %@, %@"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">error</span></span>, [<span class="hljs-built_in"><span class="hljs-built_in">error</span></span> userInfo]); abort(); } //   [self.delegate recipeAddViewController:self didAddRecipe:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }</code> </pre><br><h6>  <b>Display the created recipe</b> </h6><br><pre> <code class="hljs ruby">- (void)<span class="hljs-symbol"><span class="hljs-symbol">recipeAddViewController:</span></span>(RecipeAddViewController *)recipeAddViewController <span class="hljs-symbol"><span class="hljs-symbol">didAddRecipe:</span></span>(Recipe *)recipe { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (recipe) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Recipe   <span class="hljs-literal"><span class="hljs-literal">nil</span></span> -    [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">showRecipe:</span></span>recipe <span class="hljs-symbol"><span class="hljs-symbol">animated:</span></span>NO]; } [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-symbol"><span class="hljs-symbol">dismissModalViewControllerAnimated:</span></span>YES]; } - (void)<span class="hljs-symbol"><span class="hljs-symbol">showRecipe:</span></span>(Recipe *)recipe <span class="hljs-symbol"><span class="hljs-symbol">animated:</span></span>(BOOL)animated { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>        ,       RecipeDetailViewController *detailViewController = [[RecipeDetailViewController alloc] <span class="hljs-symbol"><span class="hljs-symbol">initWithStyle:</span></span>UITableViewStyleGrouped]; detailViewController.recipe = recipe; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController <span class="hljs-symbol"><span class="hljs-symbol">pushViewController:</span></span>detailViewController <span class="hljs-symbol"><span class="hljs-symbol">animated:</span></span>animated]; [detailViewController release]; }</code> </pre><br><h4>  <b>How To Create a New Ingredient</b> </h4><br><img src="https://habrastorage.org/storage2/cbe/b55/4a6/cbeb554a6209d8d0656b62cd29a464f5.png"><br>  As you can see in the screenshot above, when viewing detailed information about the recipe, in edit mode, the link ‚ÄúAdd Ingredient‚Äù is available.  It is created in the method <br><br><pre> <code class="hljs objectivec">- (<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> *)tableView:(<span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span> *)tableView cellForRowAtIndexPath:(<span class="hljs-built_in"><span class="hljs-built_in">NSIndexPath</span></span> *)indexPath</code> </pre><br>  controller RecipeDetailViewController. <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *AddIngredientCellIdentifier = <span class="hljs-string"><span class="hljs-string">@"AddIngredientCell"</span></span>; cell = [tableView dequeueReusableCellWithIdentifier:AddIngredientCellIdentifier]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell == <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Create a cell to display "Add Ingredient". cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:AddIngredientCellIdentifier] autorelease]; cell.accessoryType = UITableViewCellAccessoryDisclosureIndicator; } cell.textLabel.text = @"Add Ingredient";</span></span></code> </pre><br>  IngredientDetailViewController is responsible for adding and editing ingredients. <br><br>  <b>IngredientDetailViewController.h</b> <br><pre> <code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Recipe</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ingredient</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EditingTableViewCell</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IngredientDetailViewController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">@private</span></span> Recipe *recipe; Ingredient *ingredient; EditingTableViewCell *editingTableViewCell; } <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) Recipe *recipe; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">retain</span></span>) Ingredient *ingredient; <span class="hljs-keyword"><span class="hljs-keyword">@property</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">nonatomic</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">assign</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">IBOutlet</span></span> EditingTableViewCell *editingTableViewCell; <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre><br>  <b>IngredientDetailViewController.m</b> <br><pre> <code class="hljs objectivec">... - (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)initWithStyle:(<span class="hljs-built_in"><span class="hljs-built_in">UITableViewStyle</span></span>)style { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> initWithStyle:style]) { <span class="hljs-built_in"><span class="hljs-built_in">UINavigationItem</span></span> *navigationItem = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem; navigationItem.title = <span class="hljs-string"><span class="hljs-string">@"Ingredient"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonItem</span></span> *cancelButton = [[<span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonItem</span></span> alloc] initWithBarButtonSystemItem:<span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonSystemItemCancel</span></span> target:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> action:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(cancel:)]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem.leftBarButtonItem = cancelButton; [cancelButton release]; <span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonItem</span></span> *saveButton = [[<span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonItem</span></span> alloc] initWithBarButtonSystemItem:<span class="hljs-built_in"><span class="hljs-built_in">UIBarButtonSystemItemSave</span></span> target:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> action:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(save:)]; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationItem.rightBarButtonItem = saveButton; [saveButton release]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; } ... - (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)shouldAutorotateToInterfaceOrientation:(<span class="hljs-built_in"><span class="hljs-built_in">UIInterfaceOrientation</span></span>)interfaceOrientation { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (interfaceOrientation != <span class="hljs-built_in"><span class="hljs-built_in">UIInterfaceOrientationPortraitUpsideDown</span></span>); } ... - (<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)tableView:(<span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span> *)tableView numberOfRowsInSection:(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)section { <span class="hljs-comment"><span class="hljs-comment">//   ,    return 2; } //      - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { static NSString *IngredientsCellIdentifier = @"IngredientsCell"; EditingTableViewCell *cell = (EditingTableViewCell *)[tableView dequeueReusableCellWithIdentifier:IngredientsCellIdentifier]; if (cell == nil) { [[NSBundle mainBundle] loadNibNamed:@"EditingTableViewCell" owner:self options:nil]; cell = editingTableViewCell; self.editingTableViewCell = nil; } if (indexPath.row == 0) { cell.label.text = @"Ingredient"; cell.textField.text = ingredient.name; cell.textField.placeholder = @"Name"; } else if (indexPath.row == 1) { cell.label.text = @"Amount"; cell.textField.text = ingredient.amount; cell.textField.placeholder = @"Amount"; } return cell; } ... - (void)save:(id)sender { NSManagedObjectContext *context = [recipe managedObjectContext]; /*      -     */ if (!ingredient) { self.ingredient = [NSEntityDescription insertNewObjectForEntityForName:@"Ingredient" inManagedObjectContext:context]; [recipe addIngredientsObject:ingredient]; ingredient.displayOrder = [NSNumber numberWithInteger:[recipe.ingredients count]]; } /*        */ EditingTableViewCell *cell; cell = (EditingTableViewCell *)[self.tableView cellForRowAtIndexPath:[NSIndexPath indexPathForRow:0 inSection:0]]; ingredient.name = cell.textField.text; cell = (EditingTableViewCell *)[self.tableView cellForRowAtIndexPath:[NSIndexPath indexPathForRow:1 inSection:0]]; ingredient.amount = cell.textField.text; /*   */ NSError *error = nil; if (![context save:&amp;error]) { NSLog(@"Unresolved error %@, %@", error, [error userInfo]); abort(); } [self.navigationController popViewControllerAnimated:YES]; } ... @end</span></span></code> </pre><br>  The form of adding the ingredient is as follows <br><img src="https://habrastorage.org/storage2/505/4ec/e4c/5054ece4c80481bbc6e5c98b503d971b.png"><br>  When you click on the Save button, the ingredient will be saved in the database and displayed in the list.  Clicking the Cancel button will not save the new ingredient. <br><br><h4>  <b>How To Remove an Existing Recipe</b> </h4><br>  The RecipeListTableViewController controller contains the following code to support recipe deletion <br><pre> <code class="hljs lua">- (void)viewDidLoad { ... //  Edit self.navigationItem.leftBarButtonItem = self.editButtonItem; ... } ... //     UITableView - (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (editingStyle == UITableViewCellEditingStyleDelete) { //    NSManagedObjectContext *context = [fetchedResultsController managedObjectContext]; [context deleteObject:[fetchedResultsController objectAtIndexPath:indexPath]]; //   NSError *<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![context save:&amp;<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>]) { NSLog(@<span class="hljs-string"><span class="hljs-string">"Unresolved error %@, %@"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">error</span></span>, [<span class="hljs-built_in"><span class="hljs-built_in">error</span></span> userInfo]); abort(); } } }</code> </pre><br>  Now, when you click the Edit button or make a gesture on a UITableViewCell, the UITableView will go into edit mode, which will allow you to delete the recipe (see screenshots below). <br><img src="https://habrastorage.org/storage2/f4e/e3d/9a0/f4ee3d9a00bb605e29f7b9e8389063d9.png"><img src="https://habrastorage.org/storage2/66e/a82/10e/66ea8210ee651623afab96e5ed752508.png"><br>  When deleting a recipe, all related objects (ingredients and picture) in the database will also be deleted. <br><br><h4>  <b>How To Remove An Existing Ingredient</b> </h4><br>  In the RecipeDetailViewController controller, everything is arranged in a similar way, except for adding a picture (it will not be considered). <br><pre> <code class="hljs pgsql">- (UITableViewCellEditingStyle)tableView:(UITableView *)tableView editingStyleForRowAtIndexPath:(NSIndexPath *)indexPath { UITableViewCellEditingStyle style = UITableViewCellEditingStyleNone; // <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> allow editing <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the ingredients section. //    ,     (. tableView:cellForRowAtIndexPath:),      ,        ,       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexPath.section == INGREDIENTS_SECTION) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexPath.<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> == [recipe.ingredients count]) { style = UITableViewCellEditingStyleInsert; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { style = UITableViewCellEditingStyleDelete; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> style; } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath { //        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((editingStyle == UITableViewCellEditingStyleDelete) &amp;&amp; (indexPath.section == INGREDIENTS_SECTION)) { //   Ingredient *ingredient = [ingredients objectAtIndex:indexPath.<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>]; [recipe removeIngredientsObject:ingredient]; [ingredients removeObject:ingredient]; NSManagedObjectContext *context = ingredient.managedObjectContext; [context deleteObject:ingredient]; [self.tableView deleteRowsAtIndexPaths:[NSArray arrayWithObject:indexPath] withRowAnimation:UITableViewRowAnimationTop]; } }</code> </pre><br>  The form for adding and removing ingredients is as follows. <br><img src="https://habrastorage.org/storage2/8f3/6ae/a58/8f36aea5851f1078f699814e09c1dc91.png"><br><br><h4>  <b>Conclusion</b> </h4><br>  In this article, I did not specifically consider creating a picture for a recipe - assuming the reader would independently study this functionality (see the RecipeDetailViewController method of the photoTapped controller).  The examples of the source code are excerpts; you can study the source code completely by downloading the project (see the References section).  I hope that the work I have done on writing this series of articles has been useful to you - dear reader!  Thank you all for your attention and for your patience. <br><br><h4>  <b>References</b> </h4><br><ul><li>  <a href="http://www.apple.com/macosx/">Mac os x</a> </li><li>  <a href="http://developer.apple.com/xcode/">Xcode</a> </li><li>  <a href="http://developer.apple.com/programs/ios/">iOS Developer Program</a> </li><li>  <a href="http://developer.apple.com/library/ios/">iOS Core Data</a> </li><li>  <a href="https://developer.apple.com/library/ios/">iPhone Core Data Recipes</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/136344/">https://habr.com/ru/post/136344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136338/index.html">Juvia: open source commenting system for your site</a></li>
<li><a href="../136340/index.html">A brief excursion into the methods of 3D printing</a></li>
<li><a href="../136341/index.html">Call Center Megafon in Kislovodsk</a></li>
<li><a href="../136342/index.html">Cisco 1812 as a home router</a></li>
<li><a href="../136343/index.html">Select a color palette from a photo</a></li>
<li><a href="../136345/index.html">Everything is in the details</a></li>
<li><a href="../136346/index.html">MSSQL system database transfer</a></li>
<li><a href="../136347/index.html">Robbers stop taking CDs and DVDs</a></li>
<li><a href="../136348/index.html">Spaces in indesign and how i put them</a></li>
<li><a href="../136350/index.html">3D editors, pros and cons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>