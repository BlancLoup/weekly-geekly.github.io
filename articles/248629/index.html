<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuration Management in Drupal 8, developer review</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Drupal 8 brings with it many improvements and my favorite is configuration management . I will try to make a quick review on this topic. 

 Please rem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuration Management in Drupal 8, developer review</h1><div class="post__text post__text-html js-mediator-article">  Drupal 8 brings with it many improvements and my favorite is <a href="https://www.drupal.org/documentation/administer/config">configuration management</a> .  I will try to make a quick review on this topic. <br><br>  <i>Please remember that this review was written during the release of Drupal 8 beta 3. Something could change.</i> <br><br><h2>  Types of information in Drupal 8 </h2><br>  According to <a href="https://www.drupal.org/node/2120523">official documentation</a> , we have four types of information: <br><ol><li>  Content </li><li>  Session </li><li>  State </li><li>  Configuration </li></ol><br>  The good news is that almost everything except content is configuration: module settings, their states, blocks, block locations, content types, fields, display modes, and so on.  All this information is processed during the import configurations.  This makes the deployment process very simple. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Where configurations are stored </h2><br>  Let's take a look at the <code>settings.php</code> file on freshly installed Drupal 8. <br><br><pre> <code class="php hljs">$config_directories[<span class="hljs-string"><span class="hljs-string">'active'</span></span>] = <span class="hljs-string"><span class="hljs-string">'sites/default/files/config_XXXX/active'</span></span>; $config_directories[<span class="hljs-string"><span class="hljs-string">'staging'</span></span>] = <span class="hljs-string"><span class="hljs-string">'sites/default/files/config_XXXX/staging'</span></span>;</code> </pre><br>  Here, <code>XXXX</code> is a long hash generated to protect your configuration from access from the web. <br><br>  The <code>active</code> directory means storing your current configuration.  I said ‚Äúimplied‚Äù because by default this directory is empty, and the current configuration is stored in a database.  This is for <a href="https://www.drupal.org/node/2241059">security and performance</a> reasons.  However, you can change this behavior using the <a href="https://www.drupal.org/project/config_tools">Configuration Tools</a> module (config_tools).  (Don't you remember that <a href="http://www.amazeelabs.com/en/node/283">there is a module for everything</a> ?;)) <br><br>  The <code>staging</code> directory is the place from where the configuration is imported / synchronized.  This directory is also empty. If you do not use the option to import / export configurations. <br><br><blockquote><h4>  Tip: Git </h4><br>  The <code>sites/default/files</code> directory is most often included in the <code>.gitignore</code> file and is ignored by Git, but you most likely want your configuration files to be managed by a version control system.  The recommended way to place the configurations directory is outside the directory where Drupal is installed, so that it is not accessible to the web.  And the easiest way is to move the configurations directory to the <code>sites/default</code> directory (but leave the hash in its name for security). </blockquote><br><h2>  Built-in user interface </h2><br>  Out of the box, along with Drupal, is installed (in a standard profile) a Configuration Manager module (config) that provides a basic UI for managing configurations.  It can be found on the <code>admin/config/development/configuration</code> path.  The ‚ÄúFull Import / Export‚Äù tab is the most interesting here.  The complete site configuration can be exported as a .tar.gz archive in the Export sub-tab.  Then you can use this archive to import the configuration on another instance of the site. <br><img src="https://habrastorage.org/files/ad1/dac/067/ad1dac06791e43a5929ca56abe0e9931.png" alt="image"><br>  When using this interface, the imported configuration file is not used immediately after loading, but is unpacked into the <code>staging</code> directory.  After that, you need to start synchronization on the Synchronize tab, where you can also see the changes you have made. <br><img src="https://habrastorage.org/files/04d/5b6/051/04d5b605133641ecb1abf7e97acb75c0.png" alt="image"><br>  That's all!  Deployment is now available out of the box.  No more extra tools needed! <br><br>  If you do not want to use the UI, then Drush as always at your service. <br><br><pre> <code class="bash hljs">drush config-export <span class="hljs-comment"><span class="hljs-comment">#      staging drush config-import #     staging</span></span></code> </pre><br><h2>  Unit of measurement configurations </h2><br>  Let's look at an example of an exported configuration. <br><br><pre> # file: system.site.yml
 uuid: c78fd9aa-b327-4514-9d00-bc72a1f40f27
 name: 'My cool site'
 mail: mailbox@example.com
 slogan: 'Drupal 8 rules!'
 page:
  403: ""
  404: ""
  front: node
 admin_compact_mode: false
 weight_select_max: 100
 langcode: en
</pre><br>  Here, the configuration name is <code>system.site</code> .  This is the unit of measurement for configuration.  All configuration names should have at the beginning the name of the module or theme, in this case <code>system</code> . <br>  The content of the file is very similar in structure to a regular PHP array.  And when you work with configurations from code, you really will use arrays. <br><br><blockquote><h4>  Tip: Best Practices </h4><br>  If your module / theme does not have a lot of settings, it is recommended to store them in one configuration with the name your_module_name.settings. </blockquote><br><h2>  Working with configurations from a module or theme </h2><br>  Drupal 8 provides a very good API for working with configurations.  Take a look at the code. <br><br><pre> <code class="php hljs">$config = \Drupal::config(<span class="hljs-string"><span class="hljs-string">'system.site'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Instance of Drupal\Core\Config\Config $front_page = $config-&gt;get('page.front'); // 'node' $page_settings = $config-&gt;get('page'); // array( // '403' =&gt; '', // '404' =&gt; '', // 'front' =&gt; 'node', // ) $config-&gt;set('page.front', 'my-front-page'); $config-&gt;save();</span></span></code> </pre><br>  Very simple, right?  You can find most of the methods for working with configurations in the <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Config!Config.php/class/Config/8">Drupal \ Core \ Config \ Config</a> class.  Also, other examples are available in the <a href="https://www.drupal.org/node/1809490">Simple Configuration API</a> section of the developer documentation. <br><br><h2>  Default values </h2><br>  Remember how we specified default variable values ‚Äã‚Äãin Drupal 7? <br><br><pre> <code class="php hljs">$value = variable_get(<span class="hljs-string"><span class="hljs-string">'my_variable_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'my_default_value'</span></span>);</code> </pre><br>  In Drupal 8, the default values ‚Äã‚Äãwill no longer be scattered around the code.  If you have a setting, set its default value during the module installation.  There are two ways to do this: <br><ol><li>  The simplest option is to place the YAML files in the <code>config/install</code> directory of your module. </li><li>  For cases where the default value must be calculated dynamically when the module is installed, use <code>hook_install()</code> . </li></ol><br>  You can find examples in the Comment module: in <code>contact.form.feedback.yml</code> , the value of <code>recipients</code> set to an empty array.  Then, in <code>contact_install()</code> , the actual value is set. <br><br><h2>  Export configuration to module </h2><br>  There is one interesting point about the <code>config/install</code> directory. <br><br>  In Drupal 7, we can export various functionality to the code of our modules.  A common example: view for the administrative interface of the module.  To do this, we need a basic knowledge of the Views API, some hooks, and some copy-and-paste.  The Features module can also help us with this. <br><br>  With Drupal 8, everything becomes much easier.  Example for view: <br><ol><li>  create view </li><li>  export site configuration </li><li>  find the YAML file of your view in the exported configuration (sample name: <code>views.view.my_cool_view.yml</code> ) </li><li>  put this file in your module's <code>config/install</code> directory </li></ol><br>  Voila!  Your view will be imported automatically when the module is installed. <br><br><h2>  Override configurations </h2><br>  One of the best features of Drupal is that we can change (replace) everything without touching the kernel and third-party modules.  Configurations are no exception. <br><br>  There are two types of configuration substitution. <br><br><h3>  Substitution from settings.php (settings override) </h3><br>  The <code>settings.php</code> file can replace configurations at the environment level.  Just remember how we prohibited sending emails from development servers in Drupal 7: <br><br><pre> <code class="php hljs">$conf[<span class="hljs-string"><span class="hljs-string">'mail_system'</span></span>][<span class="hljs-string"><span class="hljs-string">'default-system'</span></span>] = <span class="hljs-string"><span class="hljs-string">'DevelMailLog'</span></span>;</code> </pre><br>  In almost the same way it will look in Drupal 8: <br><br><pre> <code class="php hljs">$config[<span class="hljs-string"><span class="hljs-string">'system.mail'</span></span>][<span class="hljs-string"><span class="hljs-string">'interface'</span></span>][<span class="hljs-string"><span class="hljs-string">'default'</span></span>] = <span class="hljs-string"><span class="hljs-string">'devel_mail_log'</span></span>;</code> </pre><br><h3>  Module override </h3><br>  We can dynamically replace configurations from modules.  To do this, use services that have a <code>config.factory.override</code> tag and implement the <code>ConfigFactoryOverrideInterface</code> class.  You can find an example in the Language module, which translates some strings stored in configurations (this way, when you call <code>Drupal::config(...)-&gt;get(...)</code> , you actually get the translated string instead of the original one) . <br><br><h2>  Getting the source (not overridden) configurations </h2><br>  Sometimes we need initial configurations.  Basically it is necessary for configuration forms (for example, so that the user can change the source strings, and not their translations).  For this case, the core Drupal provides the class <code>ConfigFormBase</code> , which should be used instead of the standard <code>FormBase</code> .  It has the <code>ConfigFormBase::config()</code> method, which returns the initial configurations and which, again, should be used instead of the usual <code>Drupal::config()</code> . <br><br>  Another way is the <code>Config::getRawData()</code> method.  And for more complex cases, look at the <a href="https://api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Form%2521ConfigFormBaseTrait.php/function/ConfigFormBaseTrait%253A%253Aconfig/8">implementation of the</a> <code>ConfigFormBaseTrait::config()</code> <a href="https://api.drupal.org/api/drupal/core%2521lib%2521Drupal%2521Core%2521Form%2521ConfigFormBaseTrait.php/function/ConfigFormBaseTrait%253A%253Aconfig/8">method</a> . <br><br><blockquote><h4>  Tip: Best Practices </h4><br>  When you work from a class that extends a base class, examine all the methods at your disposal (available from the parent classes) and use them instead of the globally available methods.  The example above demonstrates how to get the initial configurations using the <code>::config()</code> method when you are working from the child class <code>ConfigFormBase</code> .  Another example: many classes have a built-in method <code>::t()</code> , which should be used instead of the global function <code>t()</code> .  There are always reasons for this, take a look at <a href="http://drupal.stackexchange.com/q/100332">an example</a> . </blockquote><br><h2>  We respond to configuration changes </h2><br>  There are two ways: <br><ol><li>  Subscribe to the events listed in the <code>ConfigEvents</code> class ( <a href="https://api.drupal.org/ConfigEvents">documentation</a> ).  For an example, see the implementation of the class <code>Drupal\language\EventSubscriber\ConfigSubscriber</code> ( <a href="https://api.drupal.org/api/drupal/core%2521modules%2521language%2521src%2521EventSubscriber%2521ConfigSubscriber.php/class/ConfigSubscriber/8">documentation</a> ). </li><li>  For more complex cases, you can use <code>hook_config_import_steps_alter()</code> .  An example can be found in the Field module. </li></ol><br><h2>  Configuration schema / metadata </h2><br>  You can describe your configuration with the help of configuration schemas, thereby making it understandable for Drupal.  Let's start with an example. <br><br><pre> # file: core / modules / system / config / install / system.maintenance.yml
 message: '! site is currently under maintenance.  We should be back shortly.  Thank you for your patience. '
 langcode: en  
 
 # file: core / modules / system / config / schema / system.schema.yml
 system.maintenance: 
  type: mapping  
  label: 'Maintenance mode'
  mapping: 
    message: 
      type: text  
      label: 'Message to display when in maintenance mode'
    langcode: 
      type: string  
      label: 'Default language'
 
 # file: core / config / schema / core.data_types.schema.yml
 text: 
  type: string  
  label: 'Text'
  translatable: true  
 # ...
 string: 
  class: '\ Drupal \ Core \ TypedData \ Plugin \ DataType \ String'
  label: 'String'
</pre><br>  From this data we can find out the purpose of the settings stored in the <code>system.maintenance</code> configuration, as well as their types: <br><ol><li>  <code>message</code> is a string available for translation, displayed in the site maintenance mode </li><li>  <code>langcode</code> is a string indicating the language used for the site maintenance mode. </li></ol><br>  But more importantly, Drupal and other modules can also get this information. <br><br>  There are so many types of data embedded in the core of Drupal, and you can create your own data types by expanding existing ones.  Take a look at the <a href="https://www.drupal.org/node/1905070">Configuration schema / metadata</a> section of the developer documentation to learn more. <br><br><blockquote><h4>  Tip: Translations </h4><br>  The <code>translatable</code> property is used to mark string data types as available for translation.  Such strings are automatically processed by the Language module.  There are two basic "translatable" types of strings that you probably want to use: <br><ol><li>  <code>label</code> : human-readable line, no markup, containing only one line of text </li><li>  <code>text</code> : human-readable string, may contain HTML markup and several lines of text </li></ol></blockquote><br><h2>  Configuration entities (configuration entities) </h2><br>  In short, configuration entities are entities that are stored as configurations.  Therefore, I would recommend to get started with the <a href="https://www.drupal.org/developing/api/entity">Entity API</a> documentation.  After, you can look at the article <a href="https://www.drupal.org/node/1809494">Creating a configuration entity type in Drupal 8</a> from the developer documentation, containing a simple example.  And when you have basic knowledge and you want more, you can familiarize yourself with the essence of <code>ImageStyle</code> from the Image module. <br><br><h2>  At last </h2><br>  I would like to say a big thank you to the people who started the <a href="http://drupal8cmi.org/">Configuration Management Initiative</a> and all the drupalists who worked hard to create such a smart feature in Drupal 8. The result of their work is great! <br><br>  PS: There are already some <a href="https://www.drupal.org/search/site/configuration%3Ff%255B0%255D%3D%26f%255B1%255D%3D%26f%255B2%255D%3D%26f%255B3%255D%3Ddrupal_core%253A7234%26f%255B4%255D%3Dsm_field_project_type%253A%255B*%2BTO%2B*%255D%26f%255B5%255D%3Dss_meta_type%253Amodule%26solrsort%3Dscore%2Bdesc">modules</a> that can help you with the configurations. <br><br>  PSS: The <a href="https://www.drupal.org/developing/api/8/configuration">Configuration management</a> section from the developer documentation is a great place to get started quickly.  However, be careful, because some of its parts are outdated and so far (until a stable release is released) do not correspond to reality. </div><p>Source: <a href="https://habr.com/ru/post/248629/">https://habr.com/ru/post/248629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248617/index.html">Server monitoring is now easier with WinLogViewer.com</a></li>
<li><a href="../248619/index.html">Usability - one Redmine plugin, providing a lot of useful things</a></li>
<li><a href="../248621/index.html">Again books at the free price on books.ru</a></li>
<li><a href="../248623/index.html">Visualization of multidimensional data using Andrews charts</a></li>
<li><a href="../248625/index.html">Google AdSense joined the sanctions in the Crimea</a></li>
<li><a href="../248637/index.html">Hacking time: more than 30,000 NTP servers are still vulnerable</a></li>
<li><a href="../248639/index.html">Dagaz: Kicks to common sense (part 1)</a></li>
<li><a href="../248645/index.html">Social networks in Russia, winter 2014-2015. Numbers, trends, forecasts</a></li>
<li><a href="../248647/index.html">Sample application using the library AQuery</a></li>
<li><a href="../248649/index.html">Access Control Approaches: RBAC vs. ABAC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>