<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django User Model Extension Strategies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Django has an excellent user authentication system. In most cases, we can use it out of the box, which saves a lot of time for developers and testers....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django User Model Extension Strategies</h1><div class="post__text post__text-html js-mediator-article">  Django has an excellent user authentication system.  In most cases, we can use it out of the box, which saves a lot of time for developers and testers.  But sometimes we need to expand it to meet the needs of our site. <br><br>  As a rule, there is a need to store additional data about users, for example, a brief biography (about), date of birth, location and other similar data. <br><br>  This article will discuss strategies that you can use to extend your custom Django model, rather than writing it from scratch. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <hr><br><h4>  Expansion strategies </h4><br>  We briefly describe the strategies for expanding the user model of Django and the needs for their application.  And then we will reveal the configuration details for each strategy. <br><br><ol><li><h5>  <a href="https://habr.com/ru/post/313764/">Simple extension of the model (proxy)</a> </h5><br>  This strategy without creating new tables in the database.  Used to change the behavior of an existing model (for example, ordering by default, adding new methods, etc.) without affecting the existing database schema. <br><br>  You can use this strategy when you do not need to store additional information in the database, but simply need to add additional methods or change the model query manager.  <a href="https://habr.com/ru/post/313764/" title="Go to the implementation">‚Üí</a> <br><br></li><li><h5>  <a href="https://habr.com/ru/post/313764/">Using a one-to-one relationship with a user model</a> </h5><br>  This is a strategy using the extra regular Django model with its table in the database, which is connected by the user of the standard model through the <code>OneToOneField</code> connection. <br><br>  You can use this strategy to store additional information that is not related to the authentication process (for example, date of birth).  This is usually called a user profile.  <a href="https://habr.com/ru/post/313764/" title="Go to the implementation">‚Üí</a> <br><br></li><li><h5> <a href="https://habr.com/ru/post/313764/"><code> AbstractBaseUser</code></a> </h5> <br>  This is a strategy for using a completely new user model, which is inherited from <code>AbstractBaseUser</code> .  Requires extra care and setting changes in <code>settings.py</code> .  Ideally, it should be done at the beginning of the project, as it will significantly affect the database schema. <br><br>  You can use this strategy when your site has specific requirements regarding the authentication process.  For example, in some cases it makes sense to use an email address as a tag identification instead of a user name.  <a href="https://habr.com/ru/post/313764/" title="Go to the implementation">‚Üí</a> <br><br></li><li><h5> <a href="https://habr.com/ru/post/313764/"><code> AbstractUser</code></a> </h5> <br>  This is a strategy for using a new user model, which is inherited from <code>AbstractUser</code> .  Requires extra care and setting changes in <code>settings.py</code> .  Ideally, it should be done at the beginning of the project, as it will significantly affect the database schema. <br><br>  You can use this strategy when the Django authentication process itself is completely satisfying and you don‚Äôt want to change it.  However, you want to add some additional information directly to the user's model, without the need to create an additional class (as in option 2).  <a href="https://habr.com/ru/post/313764/" title="Go to the implementation">‚Üí</a> <br></li></ol><br><hr><br><a name="Proxy"></a><h4>  Simple extension of the model (proxy) </h4><br>  This is the least time consuming way to expand the user model.  Fully limited in deficiencies, but does not have any great features. <br><br> <code>models.py</code> <br> <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .managers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PersonManager <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(User)</span></span></span><span class="hljs-class">:</span></span> objects = PersonManager() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ordering = (<span class="hljs-string"><span class="hljs-string">'first_name'</span></span>, ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_something</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ...</code> </pre><br>  In the example above, we defined the extension of the <code>User</code> model to the <code>Person</code> model.  We say Django is a proxy model by adding the following property inside <code>class Meta</code> : <br><br><pre> <code class="python hljs">Proxy = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> <br>  Also in the example, a custom model manager is assigned, the default order is changed, and a new <code>do_something()</code> method is defined. <br><br>  It is worth noting that <code>User.objects.all()</code> and <code>Person.objects.all()</code> will query the same database table.  The only difference is in the behavior that we define for the proxy model. <br><br><hr><br><a name="OneToOneField"></a><h4>  Using a one-to-one relationship with a user model </h4><br>  Most likely, this is what you need.  Personally, I use this method in most cases.  We will create a new Django model to store additional information that is associated with a user model. <br><br>  Keep in mind that using this strategy generates additional requests or connections within the request.  Basically, all the time when you request data, an additional request will be triggered.  But this can be avoided for most cases.  I will say a few words about how to do this below. <br><br> <code>models.py</code> <br> <pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Profile</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> user = models.OneToOneField(User, on_delete=models.CASCADE) bio = models.TextField(max_length=<span class="hljs-number"><span class="hljs-number">500</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) location = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">30</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) birth_date = models.DateField(null=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br>  Now let's add a little magic: define the signals so that our <code>Profile</code> model is automatically updated when creating / changing <code>User</code> model data. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db.models.signals <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> post_save <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.dispatch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> receiver <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Profile</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> user = models.OneToOneField(User, on_delete=models.CASCADE) bio = models.TextField(max_length=<span class="hljs-number"><span class="hljs-number">500</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) location = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">30</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) birth_date = models.DateField(null=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) @receiver(post_save, sender=User) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_user_profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender, instance, created, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> created: Profile.objects.create(user=instance) @receiver(post_save, sender=User) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save_user_profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender, instance, **kwargs)</span></span></span><span class="hljs-function">:</span></span> instance.profile.save()</code> </pre><br>  We hooked <code>create_user_profile()</code> and <code>save_user_profile()</code> on the <code>User</code> model save event.  This signal is called <code>post_save</code> . <br><br>  And now an example of a Django template using <code>Profile</code> data: <br><br><pre> <code class="django hljs"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.get_full_name }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Username: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.username }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Location: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.profile.location }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Birth Date: </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user.profile.birth_date }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  And you can also like this: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, user_id)</span></span></span><span class="hljs-function">:</span></span> user = User.objects.get(pk=user_id) user.profile.bio = <span class="hljs-string"><span class="hljs-string">'Lorem ipsum dolor sit amet, consectetur adipisicing elit...'</span></span> user.save()</code> </pre><br>  Generally speaking, you should never call <code>Profile</code> save methods.  All this is done using the <code>User</code> model. <br><br>  If you need to work with forms, below are code examples for this.  Remember that you can process data from more than one model (class) at a time (from one form). <br><br> <code>forms.py</code> <br> <pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(forms.ModelForm)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = User fields = (<span class="hljs-string"><span class="hljs-string">'first_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'email'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProfileForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(forms.ModelForm)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = Profile fields = (<span class="hljs-string"><span class="hljs-string">'url'</span></span>, <span class="hljs-string"><span class="hljs-string">'location'</span></span>, <span class="hljs-string"><span class="hljs-string">'company'</span></span>)</code> </pre><br> <code>views.py</code> <br> <pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@login_required @transaction.atomic def update_profile(request): if request.method == 'POST': user_form = UserForm(request.POST, instance=request.user) profile_form = ProfileForm(request.POST, instance=request.user.profile) if user_form.is_valid() and profile_form.is_valid(): user_form.save() profile_form.save() messages.success(request, _('Your profile was successfully updated!')) return redirect('settings:profile') else: messages.error(request, _('Please correct the error below.')) else: user_form = UserForm(instance=request.user) profile_form = ProfileForm(instance=request.user.profile) return render(request, 'profiles/profile.html', { 'user_form': user_form, 'profile_form': profile_form })</span></span></code> </pre><br> <code>profile.html</code> <br> <pre> <code class="django hljs"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">csrf_token</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ user_form.as_p }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ profile_form.as_p }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Save changes</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  And about the promised query optimization.  In full, the question is considered in <a href="https://simpleisbetterthancomplex.com/tips/2016/05/16/django-tip-3-optimize-database-queries.html">my other article</a> . <br><br>  But, in short, Django's relationship is lazy.  Django queries the database table if it is necessary to read one of its fields.  Regarding our example, using the <code>select_related()</code> method is <code>select_related()</code> . <br><br>  Knowing in advance that you need to access related data, you can pre-do it with one request: <br><br><pre> <code class="python hljs">users = User.objects.all().select_related(<span class="hljs-string"><span class="hljs-string">'Profile'</span></span>)</code> </pre><br><hr><br><a name="AbstractBaseUser"></a><h4>  <code>AbstractBaseUser</code> extension </h4><br>  To be honest, I try to avoid this method at all costs.  But sometimes it is not possible.  And it is beautiful.  There is hardly such a thing as a better or worse solution.  For the most part, there is a more or less suitable solution.  If this is the most suitable solution for you, then go ahead. <br><br>  I had to do it once.  Honestly, I don't know if there is a cleaner way to do this, but I haven‚Äôt found anything else. <br><br>  I needed to use my email address as an <code>auth token</code> , and <code>username</code> absolutely not needed.  In addition, there was no need for the <code>is_staff</code> flag since I did not use Django Admin. <br><br>  Here is how I defined my own user model: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unicode_literals <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PermissionsMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.base_user <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AbstractBaseUser <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.translation <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ugettext_lazy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .managers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserManager <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(AbstractBaseUser, PermissionsMixin)</span></span></span><span class="hljs-class">:</span></span> email = models.EmailField(_(<span class="hljs-string"><span class="hljs-string">'email address'</span></span>), unique=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) first_name = models.CharField(_(<span class="hljs-string"><span class="hljs-string">'first name'</span></span>), max_length=<span class="hljs-number"><span class="hljs-number">30</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) last_name = models.CharField(_(<span class="hljs-string"><span class="hljs-string">'last name'</span></span>), max_length=<span class="hljs-number"><span class="hljs-number">30</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) date_joined = models.DateTimeField(_(<span class="hljs-string"><span class="hljs-string">'date joined'</span></span>), auto_now_add=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) is_active = models.BooleanField(_(<span class="hljs-string"><span class="hljs-string">'active'</span></span>), default=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) avatar = models.ImageField(upload_to=<span class="hljs-string"><span class="hljs-string">'avatars/'</span></span>, null=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) objects = UserManager() USERNAME_FIELD = <span class="hljs-string"><span class="hljs-string">'email'</span></span> REQUIRED_FIELDS = [] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> verbose_name = _(<span class="hljs-string"><span class="hljs-string">'user'</span></span>) verbose_name_plural = _(<span class="hljs-string"><span class="hljs-string">'users'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_full_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' Returns the first_name plus the last_name, with a space in between. '''</span></span> full_name = <span class="hljs-string"><span class="hljs-string">'%s %s'</span></span> % (self.first_name, self.last_name) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> full_name.strip() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_short_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' Returns the short name for the user. '''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.first_name <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">email_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, subject, message, from_email=None, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">''' Sends an email to this User. '''</span></span> send_mail(subject, message, from_email, [self.email], **kwargs)</code> </pre><br>  I wanted to keep it as close as possible to the ‚Äústandard‚Äù user model.  Inheriting from <code>AbstractBaseUser</code> we must follow some rules: <br><br><ul><li>  <code>USERNAME_FIELD</code> - string with the name of the model field, which is used as a unique identifier ( <code>unique=True</code> in the definition); <br><br></li><li>  <code>REQUIRED_FIELDS</code> - a list of field names that will be requested when creating a user using the <code>createsuperuser</code> control <code>createsuperuser</code> <br><br></li><li>  <code>is_active</code> is a Boolean attribute that indicates whether the user is considered ‚Äúactive‚Äù; <br><br></li><li>  <code>get_full_name()</code> is a long description of the user: it is not necessarily the full name of the user, it can be any string that describes the user; <br><br></li><li>  <code>get_short_name()</code> - short description of the user, for example, his name or nickname. <br></li></ul><br>  I also had my own <code>UserManager</code> .  Because the existing manager defines the <code>create_user()</code> and <code>create_superuser()</code> methods. <br><br>  My UserManager looked like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.base_user <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseUserManager <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserManager</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseUserManager)</span></span></span><span class="hljs-class">:</span></span> use_in_migrations = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_create_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, email, password, **extra_fields)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Creates and saves a User with the given email and password. """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> email: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">'The given email must be set'</span></span>) email = self.normalize_email(email) user = self.model(email=email, **extra_fields) user.set_password(password) user.save(using=self._db) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, email, password=None, **extra_fields)</span></span></span><span class="hljs-function">:</span></span> extra_fields.setdefault(<span class="hljs-string"><span class="hljs-string">'is_superuser'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._create_user(email, password, **extra_fields) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_superuser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, email, password, **extra_fields)</span></span></span><span class="hljs-function">:</span></span> extra_fields.setdefault(<span class="hljs-string"><span class="hljs-string">'is_superuser'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> extra_fields.get(<span class="hljs-string"><span class="hljs-string">'is_superuser'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">'Superuser must have is_superuser=True.'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._create_user(email, password, **extra_fields)</code> </pre><br>  In essence, I cleared the existing <code>UserManager</code> from the <code>username</code> and <code>is_staff</code> . <br><br>  Finishing touch.  Need to change <code>settings.py</code> : <br><br><pre> <code class="python hljs">AUTH_USER_MODEL = <span class="hljs-string"><span class="hljs-string">'core.User'</span></span></code> </pre><br>  So we tell Django to use our custom model instead of the supplied ‚Äúin box‚Äù.  In the example above, I created a custom model inside the application named <code>core</code> . <br><br>  How to reference this model? <br><br>  There are two ways.  Consider a model called <code>Course</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> testapp.core.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Course</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> slug = models.SlugField(max_length=<span class="hljs-number"><span class="hljs-number">100</span></span>) name = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">100</span></span>) tutor = models.ForeignKey(User, on_delete=models.CASCADE)</code> </pre><br>  Overall fine.  But, if you plan to use the application in other projects or distribute, it is recommended to use the following approach: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Course</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> slug = models.SlugField(max_length=<span class="hljs-number"><span class="hljs-number">100</span></span>) name = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">100</span></span>) tutor = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE)</code> </pre><br><hr><br><a name="AbstractUser"></a><h4>  <code>AbstractUser</code> extension </h4><br>  This is pretty simple, since the <code>django.contrib.auth.models.AbstractUser</code> class provides the full default user model implementation as an abstract model. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AbstractUser <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(AbstractUser)</span></span></span><span class="hljs-class">:</span></span> bio = models.TextField(max_length=<span class="hljs-number"><span class="hljs-number">500</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) location = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">30</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) birth_date = models.DateField(null=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, blank=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br>  After that, you need to change the <code>settings.py</code> : <br><br><pre> <code class="python hljs">AUTH_USER_MODEL = <span class="hljs-string"><span class="hljs-string">'core.User'</span></span></code> </pre><br>  As in the previous strategy, ideally, this should be done at the beginning of the project and with extreme caution, as it will change the entire database schema.  It is also a good rule to create keys to the user model by importing settings <code>from django.conf import settings</code> and using <code>settings.AUTH_USER_MODEL</code> instead of directly referring to the <code>User</code> class. <br><br><hr><br><h4>  Summary </h4><br>  Fine!  We looked at four different strategies for expanding the ‚Äústandard‚Äù user model.  I tried to do this in as much detail as possible.  But, as I said, there is no better solution.  Everything will depend on what you want to receive. <br><br><ul><li>  <a href="https://habr.com/ru/post/313764/">A simple extension of the model (proxy)</a> - you are satisfied with the process of authentication and storage of user data, you just want to change some behavior. </li><li>  <a href="https://habr.com/ru/post/313764/">Using the one-to-one connection with the user model (user profiles)</a> - you are satisfied with the authentication process, but I would like to add additional user data (the data will be stored in a special model). </li><li>  <a href="https://habr.com/ru/post/313764/"><code> AbstractBaseUser</code></a> ‚Äî an out-of-box authentication process does not suit you. </li><li>  <a href="https://habr.com/ru/post/313764/"><code> AbstractUser</code></a> - you are satisfied with the authentication process, but I would like to add additional user data (the data will be stored directly in the user model, and not in a special model). </li></ul><br><div class="spoiler">  <b class="spoiler_title">Original</b> <div class="spoiler_text">  <a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html">How to Extend Django User Model</a> <br><br>  Do not hesitate to ask questions and express opinions about <a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html">this post</a> ! </div></div></div><p>Source: <a href="https://habr.com/ru/post/313764/">https://habr.com/ru/post/313764/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313752/index.html">Video description of SalesForce CRM. Subtitles in Russian</a></li>
<li><a href="../313754/index.html">Required RMM monitors: how to detect incidents before they become problems in the IT network</a></li>
<li><a href="../313756/index.html">Do developers want to work in startups and be their founders - infographics on the results of the survey</a></li>
<li><a href="../313760/index.html">Attackers specialize in compromising network routers in Brazil</a></li>
<li><a href="../313762/index.html">Security in IoT: Azure IoT Suite for those who start from scratch</a></li>
<li><a href="../313768/index.html">Adobe has released an emergency update for Flash Player.</a></li>
<li><a href="../313770/index.html">DocFactor: technical documentation conference</a></li>
<li><a href="../313772/index.html">Application development for KolibriOS. Overview of options</a></li>
<li><a href="../313774/index.html">Login or Log in?</a></li>
<li><a href="../313776/index.html">2D magic in detail. Part Three Global coverage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>