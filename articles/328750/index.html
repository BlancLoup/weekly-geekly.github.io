<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The reverse side of the ticket. How Tutu.ru helps to choose the best rate</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the spring of 2014, amendments to the Air Code of the Russian Federation were adopted, allowing airlines to enter into a contract for transportatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The reverse side of the ticket. How Tutu.ru helps to choose the best rate</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/357/5e8/5b2/3575e85b29344b5294dfe337a8e640a0.jpg" alt="image"></p><br><p>  In the spring of 2014, amendments to the Air Code of the Russian Federation were adopted, allowing airlines to enter into a contract for transportation without refund of fare in case of termination of the contract.  In other words, the non-refundable tariffs appeared on the air transportation market.  Before these changes, the airlines could only withhold a fine of not more than 25% of the ticket price, if the passenger handed over the ticket later than one day before departure.  The new amendments allowed airlines to offer passengers cheaper, but non-refundable tickets. </p><br><p>  At the same time appeared budget "unavailable tariffs."  In fact, it is impossible to call them completely without a baggage: according to the law of the Russian Federation, a passenger has the right to bring up to 10 kg of personal belongings with him.  And there is an interesting point: the law does not regulate how a passenger transports these 10 kg - in the cabin or in the luggage compartment.  As you know, in the salon you can not take a lot of things: for example, liquid over 100 ml, nail scissors, a nail file and some gadgets.  Even if the fare includes baggage allowance, each airline itself determines the maximum weight and size of baggage and carry-on baggage per passenger. </p><br><p>  Passengers were confused in fares, there were many questions related to baggage transportation and surcharge overweight.  In this article I want to tell you what and how we did to make it easier for <a href="https://avia.tutu.ru/">Tutu.ru</a> users to search for the most suitable air tickets among dozens of available options. </p><a name="habracut"></a><br><p>  The ticket prices of many airlines did not look attractive against the background of the economic crisis, not at all cheapening fares for trains and the appearance of Victory, which really brought down prices in many directions.  For example, before the low-cost airline appeared, I flew <a href="https://avia.tutu.ru/offers/%3Fpassengers%3D100%26class%3DY%26changes%3Dall%26route%5B0%5D%3D491-08062017-97%26route%5B1%5D%3D97-14062017-491">to Cheboksary and back</a> for 8‚Äì10 thousand rubles, and now the flight will cost 3‚Äì6 thousand. </p><br><p>  In the fall of 2015, with the aim of lowering prices, airlines began to actively introduce non-luggage and irrevocable tariffs.  For us it was very important to provide the user with the opportunity to independently choose the options of interest to him.  People were faced with the fact that the airport requires an extra charge for luggage, or that a ticket cannot be returned or exchanged.  We wanted to give a person the opportunity to choose exactly what they need, making it as easy as possible and speeding up the search for tickets.  On the other hand, the airlines themselves put forward to their agents, including <a href="https://avia.tutu.ru/">Tutu.ru</a> , the requirement to show information about the features of the tariff already at the search stage. </p><br><p>  By the time we already showed customers whether it is possible to pass or exchange tickets.  With luggage everything was more difficult. </p><br><h2 id="na-vkus-i-cvet-gdsa-net">  The taste and color of GDS is not </h2><br><p>  Baggage information we receive from booking systems (GDS - Global Distribution System), which imposes some restrictions.  First, we work with several GDSs, as well as with GDS aggregators, and this requires solution support for each of the systems. </p><br><p>  Secondly, historically two types of airlines.  Some limit the maximum luggage by weight, and others - by the number of seats.  For example, "Aeroflot" gives a limit on the number of seats, and from the GDS we receive little informative data about baggage: "1 piece" without information about the maximum weight. </p><br><p>  And finally, the most important thing.  Information about baggage restrictions comes from the GDS, sometimes when the client has already selected a specific offer and proceeded to checkout.  We tried to give the client an opportunity to compare offers at the stage of selection.  Sending clarifying requests to the GDS, while the client chooses, it would be too expensive for both money and time: there may be dozens and hundreds of offers in one direction per day. </p><br><p>  Of course, GDSs are not standing still, and more information comes to us in new API versions of the information we are interested in, and for some GDSs it is already available at the search stage.  But to a greater extent this applies to large airlines that have switched to the system of branded fares (we will talk about it later).  We use this information, but still this is not enough to make a truly convenient service.  GDSs do not always ensure that airlines enter information about baggage, and especially do not bear responsibility, if the rules have changed, and the information has not yet been entered into the GDS, or if an error was made during the deposit.  Therefore, for many small and regional airlines, this information is not in the GDS.  Data on restrictions on carry-on baggage does not contribute to almost any airline. </p><br><p>  There are some very complicated cases, for example, the Orenburg airline carries information in the GDS that baggage with a weight of no more than 10 kg is allowed.  At the same time, flights are operated on An-2 airplanes, which do not have a luggage compartment, so it‚Äôs impossible to take things prohibited for carriage in the cabin.  In this case, we show users that there is no baggage on the flight, but hand luggage weighing up to 10kg is allowed. </p><br><p>  With the ability to exchange and return at that time everything was a little better, but only a little.  Information about the possibility of returning and exchanging a ticket (as well as about baggage) was often available only on the selected offer, and not at the search stage.  Moreover, the data from the GDS came to us not in the form of convenient for processing XML, but in the form of a ‚Äúsheet‚Äù of text, in which the only formatting is a different number of spaces at the beginning of the line. </p><br><div class="spoiler">  <b class="spoiler_title">Sample Tariff Rules Text</b> <div class="spoiler_text"><pre><code class="hljs delphi">UNLESS <span class="hljs-keyword"><span class="hljs-keyword">OTHERWISE</span></span> SPECIFIED CHANGES ANY TIME CHANGES PERMITTED. NOTE - CHARGE EUR <span class="hljs-number"><span class="hljs-number">50.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> REISSUE/REVALIDATION ---------- NO CHILD DISCOUNT APPLIES / INFANT WITHOUT A SEAT - NO CHARGE. ---------- CHANGES PERMITTED BEFORE ORIGINALY SCHEDULED FLIGHT ---------- THE TICKET MUST BE REVALIDATED <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> REISSUED AT THE SAME TIME WHEN THE BOOKING <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> CHANGED. ---------- THE CHANGE FEE APPLIES PER TRANSACTION. THE CHANGE FEE MUST BE COLLECTED AT THE SAME TIME WHEN THE BOOKING <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> CHANGED ---------- WHEN COMBINING <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> A HALF ROUNDTRIP BASIS THE PENALTY RULES <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> EACH FARE COMPONENT APPLY. CHARGE HIGHEST PENALTY FEE <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> ALL CHANGED FARE COMPONENTS. ---------- <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> REISSUE-REROUTING/UPGRADE- WHEN THE FIRST FARE COMPONENT <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> CHANGED CURRENT FARES VALID AT THE TIME <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> REISSUE MUST BE USED. <span class="hljs-keyword"><span class="hljs-keyword">OTHERWISE</span></span> HISTORICAL FARES VALID AT THE TIME <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> ISSUANCE <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> PREVIOUS TICKET MUST BE USED. ----------- <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> RE-ROUTING - NEW BASE FARE MUST BE EQUAL <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> HIGHER THAN PREVIOUS FARE <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> FARE DIFFERENCE HAS <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> BE COLLECTED. WHEN NEW ITINERARY RESULTS <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> LOWER FARE - UPGRADE <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> A LEVEL WHICH <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> AT LEAST EQUAL <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> THE BASE FARE <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> PREVIOUS TICKET. ---------- FARE DIFFERENCE <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> A CHANGE FEE WILL BE COLLECTED. ---------- CHANGES PERMITTED ONLY WITHIN SAME <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> HIGHER BRAND. ---------- ALL PROVISIONS <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> THE NEW FARE MUST BE COMPLIED <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span>. ---------- ONCE A FARE COMPONENT HAS BEEN COMPLETED FARE <span class="hljs-keyword"><span class="hljs-keyword">BREAK</span></span> POINTS CAN <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> BE CHANGED. ---------- THE NON-REFUNDABLE AMOUNT -FARE/YQ/YR - <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> THE ORIGINAL TICKET WILL BE NON-REFUNDABLE <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> HAS <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> BE INSERTED <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> THE ENDORSEMENT BOX <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> THE NEW TICKET. ---------- NO SHOW - <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> PERMITTED ---------- <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> PASSENGER <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> NO SHOW - FINNAIR HAS A RIGHT <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> CANCEL ONWARD <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> RETURN RESERVATION. ---------- <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> CHANGES PERMITTED. APPLIES ONLY <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> ITINERARY <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> FLIGHTS MARKETED <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> OPERATED BY AY. CANCELLATIONS BEFORE DEPARTURE CHARGE <span class="hljs-number"><span class="hljs-number">50</span></span> PERCENT <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> CANCEL/REFUND. NOTE - NO CHILD DISCOUNT APPLIES / INFANT WITHOUT A SEAT - NO CHARGE. ---------- UNUSED YR/YQ FEES WILL BE REFUNDED. ---------- THE MOST RESTRICTIVE REFUND CONDITIONS APPLY WHEN COMBINING <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> A HALF ROUNDTRIP BASIS. ---------- FULL REFUND PERMITTED <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span>- - REJECTION <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> VISA. EMBASSY STATEMENT REQUIRED. - DEATH <span class="hljs-keyword"><span class="hljs-keyword">OF</span></span> PASSENGER <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> FAMILY MEMBER. WAIVERS MUST BE EVIDENCED BY DEATH CERTIFICATE. ---------- NO SHOW - <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> PERMITTED. AFTER DEPARTURE TICKET <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> NON-REFUNDABLE. NOTE - UNUSED YR/YQ FEES ARE REFUNDABLE. ---------- THE MOST RESTRICTIVE REFUND CONDITIONS APPLY WHEN COMBINING <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> A HALF ROUNDTRIP BASIS. ---------- NO SHOW - <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> PERMITTED.</code> </pre> </div></div><br><p>  We already knew how to determine the terms of exchange and return for such texts, and even before what time they are possible: for some companies before the end of registration, for others not later than 48 hours before departure, etc.  To do this, we saved the texts of the tariff rules for all orders that made our users.  Then, a simple but automatic system found the parts changing from the order to the order in the stored texts, such as the amount of the fine for the return, and cut them out.  From the received text with gaps, some hash was calculated, and then the source, i.e.  no gaps, the rules were grouped by this hash.  Almost every order after payment was viewed by operators of our contact center.  Operators read the specific text of the rules, defined the terms of exchange and return, and set a digestible description in accordance with the hash of this text. For example, ‚ÄúReturn is possible no more than 24 hours before departure‚Äù.  Subsequently, when another customer placed an order, and the hash was calculated for the text of the tariff rules, we could already show understandable terms of exchange and return.  But at the search stage, this decision again did not fit: the information came already at the checkout stage. </p><br><h2 id="novaya-sistema-tarifov">  New tariff system </h2><br><p>  We started developing a new solution with a simple system that can only show restrictions for S7 and Ural Airlines.  They were the first in Russia to switch to a new tariff system.  How the old system worked: for example, the airline opens a sale for a flight that will carry out an aircraft for 300 people.  These 300 places are divided into 10-20 so-called booking classes (not to be confused with service classes: Economy, Business, First, etc.).  Each class actually determines the services offered by the airline: baggage allowance, meals included, possibility to choose a seat, as well as exchange and return tickets, etc.  Depending on the set of services varies and the cost of tariffs in this class.  And on different flights within the same booking class, the range of services may differ. </p><br><p>  The new system of tariff families (they are also called branded tariffs) is easier.  Booking classes remain, but the fare code, namely its name, is responsible for the available options;  the specific booking class and flight are no longer affected.  For example, the S7 has 4 tariff families: Economy Basic - non-refundable and only with hand luggage, Economy Flexible - returnable and with luggage included 23 kg, Business Basic - non-returnable, without access to the business hall and with one piece of luggage up to 32 kg and Business Flexible - returnable, with access to the business hall and in two places 32 kg each.  It is very simple to distinguish them from each other: in the code of tariffs of the Basic family there is a substring BS, and in the code of tariffs of the family Flexible it is a substring of FL.  The booking class is no longer responsible for the available options.  For example, if there are 9 places left on the booking class N, then you can buy tickets to these places with and without baggage. </p><br><p>  Soon, several more major Russian airlines switched to tariff families.  We set a goal to provide the user with a choice in most cases (even when you need to <a href="https://avia.tutu.ru/offers/%3Fpassengers%3D100%26threeDays%3Dtrue%26class%3DY%26changes%3Dall%26route%5B0%5D%3D103-08062017-570">fly from Yakutsk to White Mountain</a> ).  In addition, with tariff families, everything is simple only as long as the client flies with his own flights of the airline that owns these fares.  As soon as there is a transfer with the change of the airline, exceptions begin. </p><br><h2 id="razrabotka-sobstvennogo-resheniya">  Develop your own solution </h2><br><p>  We began developing our own solution with a thorough analysis.  We went to the operators of our contact center and for a long time asked out which airline was responsible for providing these or those options to the client.  A little distracted, I note that the process of buying a ticket involves up to three airlines at once: the one that owns the plane (we call it operating), the one whose flight number is indicated on your ticket (marketing), and the one that sold you a ticket on its form and will distribute money between the rest (validating). </p><br><p><img src="https://habrastorage.org/web/63a/dbd/916/63adbd916ac84233a5617120005325e0.png" alt="image"></p><br><p>  For example, you fly from Chelyabinsk to Rome with transfers in Moscow and Dusseldorf.  On the Chelyabinsk - Moscow segment, you fly your own S7 - S7-8 flight.  On the Moscow-D√ºsseldorf segment, the aircraft belongs to S7, but you have a flight with AirBerlin and the number AB-5911 on your ticket.  This means that in this segment the operating carrier is S7, and the marketing carrier is AirBerlin and this combination is called codeshare agreement.  Further from D√ºsseldorf to Rome you fly your own flight AB-8718 AirBerlin.  At the same time, the entire flight from Chelyabinsk to Rome was issued with one electronic ticket, which was sold to you by AirBerlin airline despite the fact that on the first segment you are flying your own S7 flight.  In this case, AirBerlin is a validating carrier, i.e.  the airline, which, by mutual agreement with other airlines participating in the flight, issues a ticket and will carry out mutual settlements.  Such an agreement is called interline.  Most often, the validating company is also a marketing company in one of the segments, however, there are cases when all three airlines are different - operating, marketing and validating. </p><br><p>  So, at the stage of collecting information, we found out that usually the options are set by the marketing airline - the one whose flight number is specified on your ticket and which owns the fare.  However, it may turn out that the plane of the operating airline is not designed for marketing standards.  This applies mainly to baggage.  For example, <a href="https://avia.tutu.ru/offers/%3Fpassengers%3D100%26threeDays%3Dtrue%26class%3DY%26changes%3Dall%26route%5B0%5D%3D64-08062017-65">in the plane may not be the luggage compartment, as, for example, in the An-2</a> .  In addition, on flights with transfers on different segments there may be different baggage rules and it is doubtful that the passenger will be happy to get rid of the extra 2 kg of baggage somewhere in the intermediate point.  On the other hand, Aeroflot most often guarantees its customers the baggage allowance, even if the operating airline has lower standards. </p><br><p>  Even within the same airline, there are often exceptions in a particular direction, and even at a particular airport.  For example, in Qatar Airways, the free baggage allowance in economy class for flights from Russia is 1 place weighing no more than 30 kg, and for flights from the USA 2 places no more than 23 kg each.  Many companies change the baggage allowance on flights to the Middle East - to Turkey and Egypt.  There are some very exceptional cases when, in any particular area, the right to set baggage allowances and charge a fee for their excess is bought by a company that is not related to the airline. </p><br><p>  In parallel with the accumulation of knowledge about the problem, we began to collect the information that comes to us from the GDS, in the hope of getting patterns out of it.  We needed to maintain our knowledge base, since the airline's tariff rules are constantly changing.  The idea did not work: only for one Aeroflot with fairly standardized rules, we received a decision tree, which occupied A4 sheet in a very small font. </p><br><h2 id="vnedryaem-mehanizm-frule">  We introduce the FRule mechanism </h2><br><p>  As a result, we decided to use the FRule mechanism, which had been used in our team for a long time and was originally a flexible configuration mechanism.  Later we successfully applied it to several applications. </p><br><p>  FRule is a flexible configuration system that we developed for our services.  Subsequently, the name FRule began to call the architectural approach to describe the system in which you need to flexibly set and select a particular case among many common cases. </p><br><p>  He is like that.  Suppose we have a function of N variables.  First we ask </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>C</mi><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="34.17ex" height="2.66ex" viewBox="0 -832 14712.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-28" x="749" y="0"></use><g transform="translate(1139,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="2165" y="0"></use><g transform="translate(2610,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="3636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6C" x="4332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-64" x="4630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6F" x="5154" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-74" x="5639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-73" x="6001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="6470" y="0"></use><g transform="translate(6915,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-4E" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-29" x="8216" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="8883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-43" x="9940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="10978" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-43" x="12034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6F" x="12795" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6E" x="13280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-73" x="13881" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-74" x="14350" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mo>=</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>t</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> F (x_1, x_2, \ ldots, x_N) = C = Const </script></p><br><p>  Then we fix some variable. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mi>z</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.316ex" height="1.817ex" viewBox="0 -520.7 2719.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-69" x="809" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="1194" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-7A" x="2250" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> x_i = z </script>  and ask </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>z</mi><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>C</mi><mn>1</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="45.034ex" height="2.66ex" viewBox="0 -832 19389.6 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-28" x="749" y="0"></use><g transform="translate(1139,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="2165" y="0"></use><g transform="translate(2610,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="3636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6C" x="4332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-64" x="4630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6F" x="5154" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-74" x="5639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-73" x="6001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="6470" y="0"></use><g transform="translate(6915,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2212" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="8737" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-7A" x="9182" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="9650" y="0"></use><g transform="translate(10095,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2B" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="11917" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6C" x="12612" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-64" x="12910" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6F" x="13434" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-74" x="13919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-73" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="14750" y="0"></use><g transform="translate(15195,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-4E" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-29" x="16496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="17163" y="0"></use><g transform="translate(18220,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="1011" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>z</mi><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>C</mi><mn>1</mn></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> F (x_1, x_2, \ ldots, x_ {i-1}, z, x_ {i + 1}, \ ldots, x_N) = C_1 </script></p><br><p>  And, for example, for <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.892ex" height="1.817ex" viewBox="0 -520.7 2967.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-69" x="809" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="1194" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-77" x="2250" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> x_i = w </script>  ask </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>w</mi><mo>,</mo><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>C</mi><mn>2</mn></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="45.61ex" height="2.66ex" viewBox="0 -832 19637.6 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-28" x="749" y="0"></use><g transform="translate(1139,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="2165" y="0"></use><g transform="translate(2610,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="3636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6C" x="4332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-64" x="4630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6F" x="5154" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-74" x="5639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-73" x="6001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="6470" y="0"></use><g transform="translate(6915,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2212" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="8737" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-77" x="9182" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="9898" y="0"></use><g transform="translate(10343,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2B" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="12165" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6C" x="12860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-64" x="13158" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6F" x="13682" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-74" x="14167" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-73" x="14529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="14998" y="0"></use><g transform="translate(15443,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-4E" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-29" x="16744" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="17411" y="0"></use><g transform="translate(18468,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-43" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="1011" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>,</mo><mi>w</mi><mo>,</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>s</mi><mo>,</mo><msub><mi>x</mi><mi>N</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>C</mi><mn>2</mn></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> F (x_1, x_2, \ ldots, x_ {i-1}, w, x_ {i + 1}, \ ldots, x_N) = C_2 </script></p><br><p>  We fix further <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mi>j</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.239ex" height="2.057ex" viewBox="0 -520.7 964.2 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-6A" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>j</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6"> x_j </script>  and continue the process, essentially moving from the general to the particular.  Then, the input of this function is fed any data.  In the case of baggage allowance, these are flight segment data: from where, where, when, which airlines, fare code, etc. There is one nuance: variables in the function <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.741ex" height="2.057ex" viewBox="0 -780.1 749.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math></span></span><script type="math/tex" id="MathJax-Element-7"> F </script>  may be unequal to each other.  Consider the simplest case of a function of two variables. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.352ex" height="2.66ex" viewBox="0 -832 4026.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-28" x="749" y="0"></use><g transform="translate(1139,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="2165" y="0"></use><g transform="translate(2610,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-29" x="3636" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8"> F (x_1, x_2) </script>  .  Suppose we asked </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>F&amp;#xA0;(x_1,&amp;#xA0;x_2)&amp;#xA0;=&amp;#xA0;\&amp;#xA0;left&amp;#xA0;\&amp;#xA0;{\&amp;#xA0;begin&amp;#xA0;{array}&amp;#xA0;{ll}&amp;#xA0;1&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;textrm&amp;#xA0;{if}&amp;#xA0;x_1&amp;#xA0;=&amp;#xA0;0&amp;#xA0;\\&amp;#xA0;2&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;textrm&amp;#xA0;{if}&amp;#xA0;x_2&amp;#xA0;=&amp;#xA0;0&amp;#xA0;\\&amp;#xA0;3&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;textrm&amp;#xA0;{if&amp;#xA0;}&amp;#xA0;x_1&amp;#xA0;=&amp;#xA0;1,&amp;#xA0;x_2&amp;#xA0;=&amp;#xA0;1&amp;#xA0;\\&amp;#xA0;4&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;textrm&amp;#xA0;{if}&amp;#xA0;x_1&amp;#xA0;=&amp;#xA0;1,&amp;#xA0;x_2&amp;#xA0;=&amp;#xA0;2&amp;#xA0;\\&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;textrm&amp;#xA0;{if}&amp;#xA0;x_1&amp;#xA0;=&amp;#xA0;2,&amp;#xA0;x_2&amp;#xA0;=&amp;#xA0;1&amp;#xA0;\\&amp;#xA0;6&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;textrm&amp;#xA0;{otherwise}&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{array}&amp;#xA0;\&amp;#xA0;right.</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">F&nbsp;(x_1,&nbsp;x_2)&nbsp;=&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;begin&nbsp;{array}&nbsp;{ll}&nbsp;1&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_1&nbsp;=&nbsp;0&nbsp;\\&nbsp;2&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_2&nbsp;=&nbsp;0&nbsp;\\&nbsp;3&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if&nbsp;}&nbsp;x_1&nbsp;=&nbsp;1,&nbsp;x_2&nbsp;=&nbsp;1&nbsp;\\&nbsp;4&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_1&nbsp;=&nbsp;1,&nbsp;x_2&nbsp;=&nbsp;2&nbsp;\\&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_1&nbsp;=&nbsp;2,&nbsp;x_2&nbsp;=&nbsp;1&nbsp;\\&nbsp;6&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{otherwise}&nbsp;\&nbsp;end&nbsp;{array}&nbsp;\&nbsp;right.</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>F&nbsp;(x_1,&nbsp;x_2)&nbsp;=&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;begin&nbsp;{array}&nbsp;{ll}&nbsp;1&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_1&nbsp;=&nbsp;0&nbsp;\\&nbsp;2&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_2&nbsp;=&nbsp;0&nbsp;\\&nbsp;3&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if&nbsp;}&nbsp;x_1&nbsp;=&nbsp;1,&nbsp;x_2&nbsp;=&nbsp;1&nbsp;\\&nbsp;4&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_1&nbsp;=&nbsp;1,&nbsp;x_2&nbsp;=&nbsp;2&nbsp;\\&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{if}&nbsp;x_1&nbsp;=&nbsp;2,&nbsp;x_2&nbsp;=&nbsp;1&nbsp;\\&nbsp;6&nbsp;&amp;&nbsp;\&nbsp;textrm&nbsp;{otherwise}&nbsp;\&nbsp;end&nbsp;{array}&nbsp;\&nbsp;right.</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> F (x_1, x_2) = \ left \ {\ begin {array} {ll} 1 & \ textrm {if} x_1 = 0 \\ 2 & \ textrm {if} x_2 = 0 \\ 3 & \ textrm {if } x_1 = 1, x_2 = 1 \\ 4 & \ textrm {if} x_1 = 1, x_2 = 2 \\ & \ textrm {if} x_1 = 2, x_2 = 1 \\ 6 & \ textrm {otherwise} \ end {array} \ right. </script></p><br><p>  For the function thus specified <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.909ex" height="2.66ex" viewBox="0 -832 2974.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-28" x="749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-30" x="1139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="1639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-30" x="2084" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-29" x="2585" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-10"> F (0, 0) </script>  undefined.  To get rid of such uncertainties, we use a pre-set system of priorities: we say that the values ‚Äã‚Äãdefined for a set in which only <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>1</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-11"> x_1 </script>  , more priority than the values ‚Äã‚Äãdefined for a set in which only <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>2</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-12"> x_2 </script>  .  In this case, the values ‚Äã‚Äãdefined for the set in which are fixed and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>1</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-13"> x_1 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>2</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-14"> x_2 </script>  , over the values ‚Äã‚Äãdefined for sets in which only one of the variables is fixed.  In this way, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mo stretchy=&quot;false&quot;>(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.17ex" height="2.66ex" viewBox="0 -832 4809.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-28" x="749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-30" x="1139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="1639" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-30" x="2084" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-29" x="2585" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-3D" x="3252" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="4308" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-15"> F (0, 0) = 1 </script>  .  These priorities usually stem from the subject area and business logic, for example, it is clear that specifying a city is more important than specifying a country. </p><br><p>  Before developing a solution for production, we decided to check it ‚Äúon the knee‚Äù, and for good reason.  Physically, the FRule mechanism is a set of ‚Äúparameter ‚Äì value‚Äù correspondences for a function. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.741ex" height="2.057ex" viewBox="0 -780.1 749.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math></span></span><script type="math/tex" id="MathJax-Element-16"> F </script>  stored in mysql.  Based on the priorities of the sets when accessing the FRule, some simple queries are executed until a result is found, which is then cached.  For initial configuration tasks, this is more than enough.  It turned out that the task of defining options needs to be refined.  It turned out that it took 20 minutes to calculate the baggage of all offers on the route Moscow - St. Petersburg for one day.  By reviewing the priority system and removing redundant and unused sets from there, we reduced it to 3 minutes.  However, it was still a lot. </p><br><p>  MySQL was a bottleneck, or rather, the quantity and overhead of requests that we sent to it if there is no result for a specific sentence in the cache.  For each sentence, we began to look for coincidences: first on the most particular set, then on to more and more general sets.  We give an example to present the scale of a disaster.  Now we have 288 sets with different priority.  Search proposals for one direction may be hundreds and thousands, and despite the fact that not all of them will be shown to the user, everything is required to be processed. </p><br><p>  To solve this problem, we decided to transfer the calculations to the backend.  The calculation of values ‚Äã‚Äãconsists of two parts.  The first is the construction of some special organized structure.  The second is the calculation of values ‚Äã‚Äãbased on this structure. </p><br><p>  Consider what kind of structure we are building.  Let's go back to our example function. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.741ex" height="2.057ex" viewBox="0 -780.1 749.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math></span></span><script type="math/tex" id="MathJax-Element-17"> F </script>  from two variables.  For her, we defined the following priority sets: </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><mo stretchy=&quot;false&quot;>[</mo><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.846ex" height="2.66ex" viewBox="0 -832 8114.3 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="1304" y="0"></use><g transform="translate(1750,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="2776" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="3054" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="3500" y="0"></use><g transform="translate(3778,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="4805" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="5083" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="5528" y="0"></use><g transform="translate(5807,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="6833" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="7112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="7557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="7835" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mo>,</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">]</mo><mo>,</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mo>,</mo><mo stretchy="false">[</mo><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-18"> [x_1, x_2], [x_1], [x_2], [] </script></p><br><p>  Let me remind you that the topmost set is the most particular - if for all the fields it contains there is an explicitly specified function value, then it will be used.  In essence, we will convert a flat table stored in a database into a set of trees for each set of variables.  Consider the process of building a set of trees for a set <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.095ex" height="2.66ex" viewBox="0 -832 3055 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="1304" y="0"></use><g transform="translate(1750,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="2776" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-19"> [x_1, x_2] </script>  .  First type request </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> x1 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> x2 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre> <br><p>  We retrieve from the database all rows for which we have defined and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>1</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-20"> x_1 </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>2</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-21"> x_2 </script>  .  Then group them by variable value. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>1</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-22"> x_1 </script>  .  Then the rules in each group are grouped by variable. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>x</mi><mn>2</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.384ex" height="1.696ex" viewBox="0 -520.7 1026.4 730.2" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mn>2</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-23"> x_2 </script>  , etc.  So for the most private set <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.095ex" height="2.66ex" viewBox="0 -832 3055 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-2C" x="1304" y="0"></use><g transform="translate(1750,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-32" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="2776" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-24"> [x_1, x_2] </script>  build a set of trees: </p><br><pre> <code class="hljs json">[ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> ], [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ] ]</code> </pre> <br><p>  We repeat this procedure for each set of variables.  For example, to dial <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.678ex" height="2.66ex" viewBox="0 -832 1583.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-31" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMAIN-5D" x="1304" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-25"> [x_1] </script>  we will select the rules by request </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> x1 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> x2 <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span></code> </pre> <br><p>  Unused variables in the set are marked with the value NOT_SPECIFIED.  After the sets of trees for each set of parameters are obtained, we add them into one array with preserving the order of priorities of the sets. </p><br><p>  As a result, for the function <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.741ex" height="2.057ex" viewBox="0 -780.1 749.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/tuturu/blog/328750/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg9X6m9hvzRtY0dTtI0SPmtwFeadw#MJMATHI-46" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math></span></span><script type="math/tex" id="MathJax-Element-26"> F </script>  we get this set of trees: </p><br><pre> <code class="hljs json">[ [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> ], [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ] ], [ [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; [ [NOT_SPECIFIED] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ] ], [ [NOT_SPECIFIED] =&gt; [ [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> ] ], [ [NOT_SPECIFIED] =&gt; [ [NOT_SPECIFIED] =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span> ] ] ]</code> </pre> <br><p>  The structure for verification is constructed, it remains only to pass through the input data of the function.  We go through the trees from top to bottom and go around each of them, for each variable choosing the branch that corresponds to its value.  If there is no such branch, then try to go along the NOT_SPECIFIED branch.  If the value is found, then return it. </p><br><p><img src="https://habrastorage.org/web/3bf/225/9d9/3bf2259d9d3045b283b673ad86bed6c2.png"></p><br><h2 id="keshirovanie-dannyh">  Data caching </h2><br><p>  In fact, it would be strange to build a set of trees every time you call FRule - it can be counted and remembered once.  In addition, we have several servers on which this task can be performed, so it would be nice to also transfer a set of trees between them.  We use memcache to cache and synchronize between servers of computed values.  However, contact memcache every time to pick up a set from it, expensive - real sets take up several megabytes and there is no point in driving them over the network.  Therefore, in addition to memcache, we also use APCu (and before switching to PHP7, xCache).  If the server has built or received a set of trees from memcache, it will save it in APCu and take it from there next time. </p><br><p>  There is also a problem with the synchronization of changes - the situation when the rules were changed and applied in one north, and everything else is considered to be still invalid due to old data in APCu in the other.  To solve this problem, we store the current version number of the structure in memcache.  It consists of a timestamp and a version of the code that built the structure.  The same label is also stored in the APCu of each of the backends.  Before taking trees from APCu, the backend checks whether the version number in its APCu matches the one stored in memcache.  And if it does not match, it rebuilds the structure and installs a new number in memcache and its APCu.  When editing rules from the admin, the memcache version number is simply reset: this way all backends will learn that the structure needs to be rebuilt. </p><br><h2 id="chto-my-v-itoge-poluchili">  What we got in the end </h2><br><p><img src="https://habrastorage.org/web/fb7/a64/de2/fb7a64de2f774e1fbc7950ed3fdaee17.png"></p><br><p>  A user for whose issuance there is no data in the cache, the calculation of data on tariff options takes from fractions of a second to 15-20 seconds on very large outputs, where there are many flights and many transfers.  Shortly after the backend part went into battle, our front-end developers made luggage filters, exchange and return options, so that customers can immediately cut off uninteresting offers.  According to statistics, about 10% of visitors use new filters, and are interested in the parameters of baggage and the return of 15%.  Now users do not have to search for the same flight for a long time, but with luggage or the possibility of return.  We have learned how to display regional cases, for example, Polar Airlines airline allows for a total of 20 kg of baggage, of which no more than 5 are in hand luggage. </p><br><p>  Here is an example of the results of our work.  We help to buy tickets not only on traditional routes to St. Petersburg, Sochi or Simferopol, but regional directions are quite popular with us.  Let's look at the <a href="https://avia.tutu.ru/offers/%3Fpassengers%3D100%26threeDays%3Dtrue%26class%3DY%26changes%3Dall%26route%5B0%5D%3D6-26092017-48">flight of Alrosa from Krasnoyarsk to Mirny</a> : </p><br><p><img src="https://habrastorage.org/web/764/329/774/76432977407c4f15805fb009a2330261.png"></p><br><p>  When searching, you can see all the details: the ability to exchange or return, and baggage allowance, hand baggage allowance, and even a special scheme for calculating them, when a passenger can take exactly 20 kg of baggage.  Often, such information can be obtained either on the airline's website, or only from personal communication with a representative of the airline.  It should be noted that it is not only our desire to show all the information honestly and clearly - all these parameters are very important for the buyers themselves when choosing, and without them we get feedback from users that this is not enough. </p><br><p>  From a technical point of view, we have a knowledge base containing about 10,000 rules, which largely covers our range.  Of course, there are still offers for which we have not yet established rules - especially for those areas and proposals for which we are rarely looked for and bought.  In order for content managers to quickly find out about such offers, we have developed a special logging system: it is worth coming up with a value of one or another option that differs from the value in our knowledge base or which does not exist in it, within an hour the content managers talk about it will find out.  To keep the database up to date, our content managers constantly interact with the airlines and check if there are any changes on the official websites, call up with their representatives. </p><br><p>  The created mechanism is fairly easy to expand: we can start to show information about the amount of surcharge for luggage, the possibility of carrying sports equipment, the amount of bonus miles, etc. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/328750/">https://habr.com/ru/post/328750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328740/index.html">Genetic Advisor for Options Trading</a></li>
<li><a href="../328742/index.html">Data-driven Production Approach / Stock Filters</a></li>
<li><a href="../328744/index.html">MyTaskHelper online database designer: create relational databases without programming knowledge</a></li>
<li><a href="../328746/index.html">We order translations and copywriting - the results of the project for 2 years</a></li>
<li><a href="../328748/index.html">Security threats in electronic postage stamp systems</a></li>
<li><a href="../328752/index.html">Guide React Native - create an application for iOS. Part 1.1</a></li>
<li><a href="../328756/index.html">Orchestration of the CockroachDB DBMS at Kubernetes</a></li>
<li><a href="../328760/index.html">Do cats know how to build regression?</a></li>
<li><a href="../328762/index.html">On fear of paranoids: where did the development of an analytics system lead us to fight industrial espionage?</a></li>
<li><a href="../328764/index.html">Multi-armed bandit in the task of finding objects in the video stream</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>