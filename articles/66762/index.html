<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET MVC: unit testing routes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unit test is a very important part of modern software development. When testing web applications, developers try to cover all aspects of the applicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET MVC: unit testing routes</h1><div class="post__text post__text-html js-mediator-article"><img src="http://blogs.gotdotnet.ru/personal/XaocCPS/content/binary/WindowsLiveWriter/ASP.NETMVCFramework_CC57/mvc-logo-landing-page_thumb.png" alt="image" align="left">  Unit test is a very important part of modern software development.  When testing web applications, developers try to cover all aspects of the application from receiving a request to issuing a result.  When developing projects using ASP.NET MVC, one of these aspects is the routing mechanism.  Testing routes usually brought a lot of headaches, forcing the developer to write a lot of accompanying code.  In this post I will show how using a couple of tools you can simplify testing routes to a minimum. <br><a name="habracut"></a><br><h3>  Instruments </h3><br>  First we need the following tools: <ul><li>  <a href="http://www.codeplex.com/MVCContrib">MvcContrib</a> - a library with additional functionality for ASP.NET MVC, including in the field of unit testing; </li><li>  <a href="http://ayende.com/projects/rhino-mocks.aspx">RhinoMocks</a> is a library for creating mock objects that simplify testing; </li><li>  <a href="http://www.nunit.org/">NUnit</a> is a unit testing environment with a set of its own attributes and tools. </li></ul><h3>  Installation </h3><br>  Install NUnit, then add to your project links to nunit.framework assemblies (from the GAC), Rhino.Mocks and MvcContrib.TestHelper. <br><br> <a href=""><img title="image" alt="image" src="http://blogs.gotdotnet.ru/personal/XaocCPS/content/binary/WindowsLiveWriter/MVCFramework_8B8A/image_thumb.png" width="244" height="182"></a> <br><br>  The environment is ready to create unit tests for routes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Tests </h3><br>  In order to show examples of unit tests for routes, let's define a couple of such routes: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">routes.IgnoreRoute( <font color="#A31515">"{resource}.axd/{*pathInfo}"</font> ); <br> <br> routes.MapRoute( <br> <font color="#A31515">"Product"</font> , <br> <font color="#A31515">"Product/{id}"</font> , <br> <font color="#0000ff">new</font> { controller = <font color="#A31515">"Product"</font> , action = <font color="#A31515">"GetById"</font> } <br> ); <br> <br> routes.MapRoute( <font color="#A31515">"ProductList"</font> , <br> <font color="#A31515">"ProductList/{year}"</font> , <br> <font color="#0000ff">new</font> { controller = <font color="#A31515">"Product"</font> , action = <font color="#A31515">"List"</font> }, <br> <font color="#0000ff">new</font> { year = <font color="#0000ff">new</font> YearConstraint() } <br> ); <br> <br> routes.MapRoute( <br> <font color="#A31515">"Default"</font> , <br> <font color="#A31515">"{controller}/{action}/{id}"</font> , <br> <font color="#0000ff">new</font> { controller = <font color="#A31515">"Home"</font> , action = <font color="#A31515">"Index"</font> , id = <font color="#A31515">""</font> } <br> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <font><font>Pay attention to the ProductList route.</font></font>  <font><font>It contains a restriction of YearConstraint, the code of which I will skip, but I will only say that this restriction checks the year parameter to belong to the range from 1900 to 2100.</font></font> <br><br>  <font>For testing, create the following class:</font> <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">namespace</font> Routing <br> { <br> <font color="#0000ff">using</font> MvcContrib.TestHelper; <br> <font color="#0000ff">using</font> NUnit.Framework; <br> <font color="#0000ff">using</font> Routing.Controllers; <br> <font color="#0000ff">using</font> System.Web.Routing; <br> <font color="#0000ff">using</font> Rhino.Mocks; <br> <font color="#0000ff">using</font> System.Web; <br> <br> [TestFixture] <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> TestRoutes <br> { <br> [TestFixtureSetUp] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> SetUp() <br> { <br> MvcApplication.RegisterRoutes(RouteTable.Routes); <br> } <br> [TestFixtureTearDown] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TearDown() <br> { <br> RouteTable.Routes.Clear(); <br> } <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <font>For those who have worked with NUnit, the attributes will be familiar before, the rest will tell you a little about their purpose:</font> <ul><li>  <font>TestFixture - defines a class with tests;</font> <br></li><li>  <font>TestFixtureSetUp - determines the method with the code that must be run before running the tests;</font> <br></li><li>  <font>TestFixtureTearDown - defines the method with the code that must be run after running the tests.</font> <br></li></ul>  <font>As you can see, a method has been created in the class that initializes the route table before testing and clears it after testing.</font>  <font>Time to write the first test:</font> <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestSimpleRoute() <br> { <br> <font color="#A31515">"~/"</font> .Route().ShouldMapTo&lt;HomeController&gt;(x =&gt; x.Index()); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <font>Here, using the extension methods of the MvcContrib library, we check for performance the request to the root of the project, which, according to the routes we have defined, should be routed using the Default route.</font>  <font>This route is created in ASP.NET MVC applications by default.</font>  <font>A request to the project root by default should be routed to the Index action of the HomeController controller.</font> <br><br>  <font>Compile the project and run NUnit.</font>  <font>Having selected our project with the test as a project, click Run to run the test.</font>  <font>The result on the picture below:</font> <br><br> <a href=""><img title="image" alt="image" src="http://blogs.gotdotnet.ru/personal/XaocCPS/content/binary/WindowsLiveWriter/MVCFramework_8B8A/image_thumb_1.png" width="244" height="161"></a> <br><br>  <font>Test passed.</font>  <font>Add the rest of the tests:</font> <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestProduct() <br> { <br> <font color="#A31515">"~/Product/750"</font> .Route().ShouldMapTo&lt;ProductController&gt;(x =&gt; x.GetById(750)); <br> } <br> [Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestProductListValidYear() <br> { <br> <font color="#A31515">"~/ProductList/2009"</font> .Route().ShouldMapTo&lt;ProductController&gt;(x =&gt; x. <font color="#2B91AF">List</font> (2009)); <br> } <br> [Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestProductListInvalidYear() <br> { <br> Assert.AreNotEqual( <font color="#A31515">"~/ProductList/1800"</font> .Route().Values[ <font color="#A31515">"controller"</font> ], <font color="#A31515">"Product"</font> ); <br> } <br> [Test] <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> TestIgnoreAxd() <br> { <br> <font color="#A31515">"~/someroutetoigonre.axd"</font> .ShouldBeIgnored(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Here are four tests: <ul><li>  TestProduct - designed to test the Product route; </li><li>  TestProductListValidYear - test to test the route with the restriction when the year parameter is correctly set; </li><li>  TestProductListInvalidYear - test to test the route with the restriction when the year parameter is incorrectly specified; </li><li>  TestIgnoreAxd - test for testing the route of ignoring requests to axd-resources. </li></ul>  Pay attention to TestProductListInvalidYear.  In this test, we check the routing operation when trying to access the PriductList route with the wrong parameter.  The check is somewhat indirect: we make sure that if the parameter is incorrect, the routing mechanism will not cause the Product controller. <br><br>  And the last thing you should pay attention to is how easy it is to create a test for checking ignore routes.  The extension method ShouldBeIgnored allows you to set a test for such routes.  In our test, TestIgnoreAxd, we try to present a situation with access to an axd-resource, which, according to the specified routes, should be ignored. <br><br>  Compile and run the tests in NUnit: <br><br> <a href=""><img title="image" alt="image" src="http://blogs.gotdotnet.ru/personal/XaocCPS/content/binary/WindowsLiveWriter/MVCFramework_8B8A/image_thumb_2.png" width="244" height="161"></a> <br><br>  All tests passed.  The work is done. <br><br><h3>  Conclusion </h3><br>  In this article, I looked at the simplest test cases for unit testing routes in ASP.NET MVC.  The tools that are represented in the MvcContrib library make it very easy to create such tests and, of course, make life easier for the developer. <br><br>  For your projects, you will probably want to create more detailed unit tests of the routing mechanism.  This will help you MvcContrib.  Program with pleasure! <br><br> <a href="http://progg.ru/ASPNET-MVC-%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5-%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-%25D0%25BC%25D0%25B0%25D1%2580%25D1%2588%25D1%2580%25D1%2583%25D1%2582%25D0%25BE%25D0%25B2-NET-%25D0%25A5%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B0%25D1%2585%25D0%25B0%25D0%25B1%25D1%2580"><img alt="Progg it" src="http://progg.ru/image.axd?url=http%3A%2F%2Fhabrahabr.ru%2Fblogs%2Fnet%2F66762%2F"></a> <br></div><p>Source: <a href="https://habr.com/ru/post/66762/">https://habr.com/ru/post/66762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66748/index.html">Expanding short links in Firefox</a></li>
<li><a href="../66749/index.html">Hourly work now on RentACoder!</a></li>
<li><a href="../66751/index.html">Overview of the natural input mechanism in RAD Studio 2010</a></li>
<li><a href="../66753/index.html">Nikita Filippov - 100% agile</a></li>
<li><a href="../66758/index.html">VMware buys SpringSource</a></li>
<li><a href="../66763/index.html">Change the menu: wave client extensions</a></li>
<li><a href="../66764/index.html">Nginx configuration</a></li>
<li><a href="../66766/index.html">Algorithms in Graphs - Part 2: Sorting Networks</a></li>
<li><a href="../66767/index.html">Cataclysm - addition to World of Warcraft</a></li>
<li><a href="../66771/index.html">MacBook Pro owners are haunted</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>