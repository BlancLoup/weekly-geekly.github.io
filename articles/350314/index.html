<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The PVS-Studio 6.22 static code analyzer is adapted for ARM compilers (Keil, IAR)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio is a static code analyzer for finding errors and potential vulnerabilities in the code of C, C ++ and C # programs. We have long delighted ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The PVS-Studio 6.22 static code analyzer is adapted for ARM compilers (Keil, IAR)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54e/43f/8dd/54e43f8dd38ca916baa2d2faa10929a9.png" alt="Embedded bugs"></div><br>  PVS-Studio is a static code analyzer for finding errors and potential vulnerabilities in the code of C, C ++ and C # programs.  We have long delighted readers of our blog by checking open projects and analyzing errors found.  Our articles have the potential to become more interesting, as the analyzer has learned to check the code of embedded devices.  We supported several ARM compilers, which you will learn more about in the article.  Errors in embedded devices and robots may be more spectacular than in application programs.  An error in the embedded device is not just a program crash / hang or an incorrect picture.  This is a crazy Wi-Fi teapot that will boil water until it boils away and the thermal fuse blows.  In general, with errors in the world of embedded-systems everything is much more interesting and worse. <br><a name="habracut"></a><br><h2>  My most entertaining bug </h2><br>  During my career as a programmer, I made a lot of mistakes in the code.  However, errors in some sense were boring.  Something did not work, somewhere null pointer dereferenced, and so on.  Yes, these were real mistakes that required correction.  However, I got the most vivid impression of my own mistake while having fun with homemade robots. <br><br>  In robotics, I'm an amateur and all my crafts are purely experimental and entertaining in nature.  One of the crafts was the creation of four small robots, controlled from remote controls and able to play robofootball and "catch mice."  I will not go into details, I‚Äôll just note that they knew how to: ride, hit the ball, grab claws, make sounds, blink LEDs.  Actually, not to be unfounded, here is one of the robots. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/072/6f1/e1e/0726f1e1e55dbf1a1f2beb788d6fe81a.png" alt="Bot"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The bot is based on an ATmega8A microcontroller (8 KB of flash, 512 bytes of EEPROM, 1 KB of RAM).  In the first version of the program, one of the microcontroller timers generated an interrupt, in the handler of which commands from the remote control were read.  If there were any commands, they were recorded in the FIFO buffer, from which they were then extracted and executed in the main program loop.  The teams were such as: go forward / back;  turn left / right;  go forward, turning slightly to the left;  grab the mouse;  kick the ball and so on. <br><br>  In fact, I have overcomplicated everything.  Later, I got rid of the FIFO buffer and generally wrote more and more simply and beautifully. <br><br>  Now imagine: I pour a new program into the microcontroller, turn on the robot, and ... Suddenly, the robot begins to live its own life! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9c/b6d/656/b9cb6d656ca68bde8a4f285e5eca7148.png" alt="It's alive!"></div><br><br>  Bot randomly worn on the floor, clicks the claw, pushes a nonexistent ball, flashes.  Moreover, the actions are completely incomprehensible to me.  The robot simply does not have a code that, in my opinion, could have caused such actions. <br><br>  It was the biggest impression from an error in the program that I received for all my years of programming.  It's one thing when a program crashes because of a stack overflow, and quite another when a crazy robot is worn in front of you, which you yourself did and do not even understand how this can be.  It is a pity that I did not guess to shoot this action and my emotions in the background :). <br><br>  After a brief trial, it turned out that I made one of the most classic programmer errors: the variable storing the number of raw commands in the FIFO buffer was not initialized.  The robot began to execute a random sequence of commands, reading data from the buffer, as well as data already after the buffer. <br><br>  Why did I tell this story?  To simply show that errors in microcontroller programs can be more spectacular, and I hope that I can please the reader with interesting publications in the future.  Now let's return to the main topic of the article devoted to the release of the new version of the PVS-Studio analyzer. <br><br><h2>  PVS-Studio 6.22 </h2><br>  In the new version of the PVS-Studio 6.22 analyzer, our team has refined the infrastructure for testing projects of the following type: <ol><li>  Support for ARM Compiler 5 and ARM Compiler 6 has been added to Keil uVision 5. </li><li>  The ARM Compiler 5 and ARM Compiler 6 compilers in the Keil DS-MDK environment. </li><li>  We support IAR C / C ++ Compiler for ARM as part of the IAR Embedded Workbench environment. </li></ol><br><h2>  Project RT-Thread </h2><br>  To demonstrate the new features of PVS-Studio, I needed an open project, and the choice fell on RT-Thread.  This project can be built in gcc / keil / iar mode.  For the purpose of additional testing of the analyzer, we checked it in both Keil mode and IAR mode.  The reports were almost the same, so I don‚Äôt even remember with which of them I worked with in the future. <br><br>  Now let's talk a little about the RT-Thread project itself. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ec/c0e/048/6ecc0e048236eb0ba22fef59b400a9f7.png" alt="RT-Thread"></div><br><br>  RT-Thread is an open source IoT operating system from China, which has strong scalability: for example ARM Cortex-M0, or Cortex-M3 / 4/7, for a rich feature system running on MIPS32, ARM Cortex-A8, ARM Cortex-A9 DualCore etc. <br><br>  Official website: <a href="https://www.rt-thread.org/">rt-thread.org</a> . <br><br>  Source code: <a href="https://github.com/RT-Thread/rt-thread">rt-thread</a> . <br><br>  I think the RT-Thread operating system is a very good candidate to become the first embedded-project tested with PVS-Studio. <br><br><h2>  Errors seen in the RT-Thread project </h2><br>  I skimmed the report of the PVS-Studio analyzer and selected 95 warnings representing, in my opinion, the most interesting.  You can view them by downloading the <a href="">rt-thread-html-log.zip</a> archive with the full HTML report.  We have recently implemented this format, and not all users know about it.  Therefore, I decided to take advantage of the opportunity to re-write about it.  Here‚Äôs what this report looks like in Firefox: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/652/24d/9d4/65224d9d4fbb48b101a7a5f32490bd49.png" alt="PVS-Studio Full HTML log"></div><br><br>  The report is made by analogy with the HTML report that is generated by the Clang analyzer.  The report stores in itself a part of the source code, and you can immediately see to which part of the program the warnings are related.  View one of the warnings as follows: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bba/e8f/452/bbae8f45264b7d2afb4da3fe7cb530ef.png" alt="View warning in HTML report"></div><br><br>  It makes no sense to consider all 95 warnings in the article, since many of them are similar.  The article gives only 14 code fragments, which for some reason seemed to me worthy of description. <br><br>  <b>Note.</b>  I could miss important warnings indicating serious errors.  Therefore, I ask the developers of RT-Thread not to rely only on my report containing 95 warnings, but to analyze the project myself.  In addition, it seems to me that we didn‚Äôt understand how to deal with the RT-Thread project and checked only a part of it. <br><br><h3>  Fragment N1.  CWE-562: Return of Stack Variable Address </h3><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SEMC_GetDefaultConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">semc_config_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *config)</span></span></span><span class="hljs-function"> </span></span>{ assert(config); <span class="hljs-keyword"><span class="hljs-keyword">semc_axi_queueweight_t</span></span> queueWeight; <span class="hljs-comment"><span class="hljs-comment">/*!&lt; AXI queue weight. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">semc_queuea_weight_t</span></span> queueaWeight; <span class="hljs-keyword"><span class="hljs-keyword">semc_queueb_weight_t</span></span> queuebWeight; .... config-&gt;queueWeight.queueaWeight = &amp;queueaWeight; config-&gt;queueWeight.queuebWeight = &amp;queuebWeight; }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v506/">warning</a> : <a href="https://www.viva64.com/ru/w/v506/">V506</a> CWE-562 Pointer to local variable.  Such a pointer will become invalid.  fsl_semc.c 257 <br><br>  The function writes the addresses of two local variables ( <i>queueaWeight</i> and <i>queuebWeight</i> ) into the external structure.  After exiting the function, the variables no longer exist, but the structure will still store and use pointers to these already non-existent objects.  In fact, pointers point to some place in the stack where anything can be.  This is a very nasty security bug. <br><br>  The PVS-Studio analyzer reports only the last suspicious assignment, which is associated with some internal features of its work.  However, if the last assignment is deleted or corrected, the analyzer will begin to warn about the first assignment. <br><br><h3>  Fragment N2.  CWE-570: Expression is Always False </h3><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CAN_FIFO0 ((uint8_t)0x00U) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*!&lt; receive FIFO0 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CAN_FIFO1 ((uint8_t)0x01U) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*!&lt; receive FIFO1 */</span></span></span><span class="hljs-meta"> uint8_t can_receive_message_length(uint32_t can_periph, uint8_t fifo_number) { uint8_t val = 0U; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(CAN_FIFO0 == fifo_number){ val = (uint8_t)(CAN_RFIFO0(can_periph) &amp; CAN_RFIFO_RFL0_MASK); }</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(CAN_FIFO0 == fifo_number){ val = (uint8_t)(CAN_RFIFO1(can_periph) &amp; CAN_RFIFO_RFL0_MASK); }</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta">{ </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* illegal parameter */</span></span></span><span class="hljs-meta"> } return val; }</span></span></code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v517/">warning</a> : <a href="https://www.viva64.com/ru/w/v517/">V517</a> CWE-570 The use of 'if (A) {...} else if (A) {...}' pattern was detected.  There is a possibility of logical error presence.  Check lines: 525, 527. gd32f4xx_can.c 525 <br><br>  If the <i>fifo_number</i> argument <i>is</i> not equal to <i>CAN_FIFO0</i> , then the function always returns 0. The code was most likely written using Copy-Paste and due to inattention in the copied fragment they forgot to replace the constant <i>CAN_FIFO0</i> with <i>CAN_FIFO1</i> . <br><br><h3>  Fragment N3.  CWE-571: Expression is Always True </h3><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PECI_M0D0C_HITHR_M 0xFFFF0000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// High Threshold #define PECI_M0D0C_LOTHR_M 0x0000FFFF // Low Threshold #define PECI_M0D0C_HITHR_S 16 #define PECI_M0D0C_LOTHR_S 0 void PECIDomainConfigGet(....) { unsigned long ulTemp; .... ulTemp = HWREG(ulBase + PECI_O_M0D0C + (ulDomain * 4)); *pulHigh = ((ulTemp &amp;&amp; PECI_M0D0C_HITHR_M) &gt;&gt; PECI_M0D0C_HITHR_S); *pulLow = ((ulTemp &amp;&amp; PECI_M0D0C_LOTHR_M) &gt;&gt; PECI_M0D0C_LOTHR_S); }</span></span></span></span></code> </pre> <br>  PVS-Studio warnings: <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v560/">V560</a> CWE-571 A part of the conditional expression is always true: 0xFFFF0000.  peci.c 372 </li><li>  V560 CWE-571 A part of the conditional expression is always true: 0x0000FFFF.  peci.c 373 </li></ul><br>  Two annoying typos: instead of the two &amp; operators, the &amp;&amp; operator was used twice. <br><br>  Because of this, the value <i>pulHigh</i> will always be assigned the value 0, and the variable <i>pulLow</i> will be assigned the value 0 or 1. This is clearly not what the programmer intended. <br><br>  <b>Explanation for those who are not very familiar with the language C.</b> The result of the expression <i>(ulTemp &amp;&amp; PECI_M0D0C_xxxxx_M) is</i> always 0 or 1. Then 0 or 1 are shifted to the right.  When you shift the value of 0/1 to the right by 16 bits, it will always be 0. If you shift the value of 0/1 by 0, 0 or 1 is still obtained. <br><br><h3>  Fragment N4.  CWE-480: Use of Incorrect Operator </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> _aipstz_peripheral_access_control { kAIPSTZ_PeripheralAllowUntrustedMaster = <span class="hljs-number"><span class="hljs-number">1U</span></span>, kAIPSTZ_PeripheralWriteProtected = (<span class="hljs-number"><span class="hljs-number">1U</span></span> &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>), kAIPSTZ_PeripheralRequireSupervisor = (<span class="hljs-number"><span class="hljs-number">1U</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>), kAIPSTZ_PeripheralAllowBufferedWrite = (<span class="hljs-number"><span class="hljs-number">1U</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">aipstz_peripheral_access_control_t</span></span>;</code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83f/2d7/7f7/83f2d77f74f3a743c40e4b1edb5e461a.png" alt="Unicorn-facepalm"></div><br><br>  PVS-Studio warnings: <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v602/">V602</a> CWE-480 Consider inspecting the '(1U &lt;1)' expression.  '&lt;' possibly should not be replaced with '&lt;&lt;'.  fsl_aipstz.h 69 </li><li>  V602 CWE-480 Consider inspecting the '(1U &lt;2)' expression.  '&lt;' possibly should not be replaced with '&lt;&lt;'.  fsl_aipstz.h 70 </li><li>  V602 CWE-480 Consider inspecting the '(1U &lt;2)' expression.  '&lt;' possibly should not be replaced with '&lt;&lt;'.  fsl_aipstz.h 71 </li></ul><br>  Named constants should have been powers of two and be equal to the following values: 1, 2, 4, 4. But instead of the operator &lt;&lt;, the programmer accidentally wrote &lt;.  The result is the following values: <br><br><ul><li>  kAIPSTZ_PeripheralAllowUntrustedMaster = 1 </li><li>  kAIPSTZ_PeripheralWriteProtected = 0 </li><li>  kAIPSTZ_PeripheralRequireSupervisor = 1 </li><li>  kAIPSTZ_PeripheralAllowBufferedWrite = 1 </li></ul><br><h3>  Fragment N5.  CWE-834: Excessive Iteration </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ft5x06_dump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> reg_value; DEBUG_PRINTF(<span class="hljs-string"><span class="hljs-string">"[FTS] Touch Chip\r\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">255</span></span>; i++) { _ft5x06_read(i, &amp;reg_value, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i % <span class="hljs-number"><span class="hljs-number">8</span></span> == <span class="hljs-number"><span class="hljs-number">7</span></span>) DEBUG_PRINTF(<span class="hljs-string"><span class="hljs-string">"0x%02X = 0x%02X\r\n"</span></span>, i, reg_value); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> DEBUG_PRINTF(<span class="hljs-string"><span class="hljs-string">"0x%02X = 0x%02X "</span></span>, i, reg_value); } DEBUG_PRINTF(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v654/">warning</a> : <a href="https://www.viva64.com/ru/w/v654/">V654</a> CWE-834 The condition 'i &lt;= 255' of loop is always true.  drv_ft5x06.c 160 <br><br>  Variables of type <i>uint8_t</i> can store values ‚Äã‚Äãin the range [0..255], so the condition <i>i &lt;= 255 is</i> always true.  Because of this, the loop will infinitely print debug data. <br><br><h3>  Fragment N6.  CWE-571: Expression is Always True </h3><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RT_CAN_MODE_NORMAL 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RT_CAN_MODE_LISEN 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RT_CAN_MODE_LOOPBACK 2 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RT_CAN_MODE_LOOPBACKANLISEN 3 static rt_err_t control(struct rt_can_device *can, int cmd, void *arg) { .... case RT_CAN_CMD_SET_MODE: argval = (rt_uint32_t) arg; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (argval != RT_CAN_MODE_NORMAL || argval != RT_CAN_MODE_LISEN || argval != RT_CAN_MODE_LOOPBACK || argval != RT_CAN_MODE_LOOPBACKANLISEN) { return RT_ERROR; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (argval != can-&gt;config.mode) { can-&gt;config.mode = argval; return bxcan_set_mode(pbxcan-&gt;reg, argval); } break; .... }</span></span></code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v547/">warning</a> : <a href="https://www.viva64.com/ru/w/v547/">V547</a> CWE-571 Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  bxcan.c 1171 <br><br>  The case of <i>RT_CAN_CMD_SET_MODE is</i> always handled incorrectly.  The fact is that a condition of the form <i>(x! = 0 || x! = 1 || x! = 2 || x! = 3) is</i> always true.  Most likely, we are dealing with another typo and, in fact, it should be written here: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argval != RT_CAN_MODE_NORMAL &amp;&amp; argval != RT_CAN_MODE_LISEN &amp;&amp; argval != RT_CAN_MODE_LOOPBACK &amp;&amp; argval != RT_CAN_MODE_LOOPBACKANLISEN)</code> </pre> <br><h3>  Fragment N7.  CWE-687: Function Call With Incorrectly Specified Argument Value </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MCAN_SetSTDFilterElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CAN_Type *base, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mcan_frame_filter_config_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *config, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">mcan_std_filter_element_config_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *filter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> idx)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *elementAddress = <span class="hljs-number"><span class="hljs-number">0</span></span>; elementAddress = (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *)(MCAN_GetMsgRAMBase(base) + config-&gt;address + idx * <span class="hljs-number"><span class="hljs-number">4U</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(elementAddress, filter, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(filter)); }</code> </pre> <br>  The analyzer indicates an error with two different warnings at once: <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v579/">V579</a> CWE-687  It is possibly a mistake.  Inspect the third argument.  fsl_mcan.c 418 </li><li>  <a href="https://www.viva64.com/ru/w/v568/">If you‚Äôre a</a> sizeof () ‚Äôoperator evalu evalu evalu object object object object object object  fsl_mcan.c 418 </li></ul><br>  The <i>memcpy</i> function does not copy the entire structure of type <i>mcan_std_filter_element_config_t</i> , but only its part equal to the size of a single pointer. <br><br><h3>  Fragment N8.  CWE-476: NULL Pointer Dereference </h3><br>  There was no error in the RT-Thread code when the pointer is dereferenced before it is checked.  This is a <a href="https://www.viva64.com/ru/examples/v595/">very</a> common type of error. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> rt_size_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rt_sdcard_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">rt_device_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">rt_off_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buffer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">rt_size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, addr; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dfs_partition</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">part</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dfs_partition</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_data</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dev == RT_NULL) { rt_set_errno(-EINVAL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } .... }</code> </pre> <br>  PVS-Studio Warning: <a href="https://www.viva64.com/ru/w/v595/">V595</a> CWE-476 The 'dev' pointer against it.  Check lines: 497, 499. sdcard.c 497 <br><br><h3>  Fragment N9.  CWE-563: Assignment to Variable without Use </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enet_default_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... reg_value = ENET_DMA_BCTL; reg_value &amp;= DMA_BCTL_MASK; reg_value = ENET_ADDRESS_ALIGN_ENABLE |ENET_ARBITRATION_RXTX_2_1 |ENET_RXDP_32BEAT |ENET_PGBL_32BEAT |ENET_RXTX_DIFFERENT_PGBL |ENET_FIXED_BURST_ENABLE |ENET_MIXED_BURST_DISABLE |ENET_NORMAL_DESCRIPTOR; ENET_DMA_BCTL = reg_value; .... }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v519/">warning</a> : <a href="https://www.viva64.com/ru/w/v519/">V519</a> CWE-563 The 'reg_value' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 3427, 3428. gd32f4xx_enet.c 3428 <br><br>  The assignment <i>reg_value = ENET_ADDRESS_ALIGN_ENABLE | .... overwrites the</i> previous value of the variable <i>reg_value</i> .  This is strange, since the variable stores the result of meaningful calculations.  Most likely, the code should be like this: <br><br><pre> <code class="cpp hljs">reg_value = ENET_DMA_BCTL; reg_value &amp;= DMA_BCTL_MASK; reg_value |= ENET_ADDRESS_ALIGN_ENABLE |ENET_ARBITRATION_RXTX_2_1 |ENET_RXDP_32BEAT |ENET_PGBL_32BEAT |ENET_RXTX_DIFFERENT_PGBL |ENET_FIXED_BURST_ENABLE |ENET_MIXED_BURST_DISABLE |ENET_NORMAL_DESCRIPTOR;</code> </pre> <br><h3>  Fragment N10.  CWE-665: Improper Initialization </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> _dcp_hash_block { <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> w[DCP_HASH_BLOCK_SIZE / <span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> b[DCP_HASH_BLOCK_SIZE]; } <span class="hljs-keyword"><span class="hljs-keyword">dcp_hash_block_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dcp_hash_ctx_internal</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dcp_hash_block_t</span></span> blk; .... } <span class="hljs-keyword"><span class="hljs-keyword">dcp_hash_ctx_internal_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">status_t</span></span> DCP_HASH_Init(DCP_Type *base, <span class="hljs-keyword"><span class="hljs-keyword">dcp_handle_t</span></span> *handle, <span class="hljs-keyword"><span class="hljs-keyword">dcp_hash_ctx_t</span></span> *ctx, <span class="hljs-keyword"><span class="hljs-keyword">dcp_hash_algo_t</span></span> algo) { .... <span class="hljs-keyword"><span class="hljs-keyword">dcp_hash_ctx_internal_t</span></span> *ctxInternal; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ctxInternal-&gt;blk.w) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ctxInternal-&gt;blk.w[<span class="hljs-number"><span class="hljs-number">0</span></span>]); i++) { ctxInternal-&gt;blk.w[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0u</span></span>; } .... }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v767/">warning</a> : <a href="https://www.viva64.com/ru/w/v767/">V767</a> Suspicious access to the element of the array.  fsl_dcp.c 946 <br><br>  The analyzer was not able to associate any CWE ID with this warning, however, it should be CWE-665: Improper Initialization. <br><br>  In the loop, the value <i>0 is</i> written all the time in the zero element of the array, while the remaining elements remain uninitialized. <br><br><h3>  Fragment N11.  CWE-571: Expression is Always True </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at91_mci_init_dma_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct at91_mci *mci)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">rt_uint8_t</span></span> i; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">/* Check to see if this needs filling */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (at91_mci_read(AT91_PDC_RCR) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { mci_dbg(<span class="hljs-string"><span class="hljs-string">"Transfer active in current\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (at91_mci_read(AT91_PDC_RNCR) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { mci_dbg(<span class="hljs-string"><span class="hljs-string">"Transfer active in next\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } length = data-&gt;blksize * data-&gt;blks; mci_dbg(<span class="hljs-string"><span class="hljs-string">"dma address = %08X, length = %d\n"</span></span>, data-&gt;buf, length); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { at91_mci_write(AT91_PDC_RPR, (<span class="hljs-keyword"><span class="hljs-keyword">rt_uint32_t</span></span>)(data-&gt;buf)); at91_mci_write(AT91_PDC_RCR, .....); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { at91_mci_write(AT91_PDC_RNPR, (<span class="hljs-keyword"><span class="hljs-keyword">rt_uint32_t</span></span>)(data-&gt;buf)); at91_mci_write(AT91_PDC_RNCR, .....); } } .... }</code> </pre> <br>  PVS-Studio warnings: <br><br><ul><li>  V547 CWE-571 Expression 'i == 0' is always true.  at91_mci.c 196 </li><li>  V547 CWE-571 Expression 'i == 0' is always true.  at91_mci.c 215 </li></ul><br>  The body of the loop runs exactly once.  This makes no sense.  Why, then, write a cycle at all? <br><br>  Moreover, since the variable <i>i</i> in the body of the loop is always <i>0</i> , some conditions are always true and part of the code is never executed. <br><br>  It seems to me, in fact, the developer planned that the cycle body was executed 2 times, but made a typo.  Perhaps you should write a loop condition like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>; i++)</code> </pre> <br>  In this case, the function code will make sense. <br><br><h3>  Fragment N12.  CWE-457: Use of Uninitialized Variable </h3><br>  I apologize for giving a large fragment of the function body.  This is necessary to demonstrate that the variable <i>k</i> is not really initialized anywhere before reading a value from it. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_PutPixel</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LCD_PANEL panel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> X_Left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Y_Up, LcdPixel_t color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> * pWordData = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>* pByteData = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> bitOffset; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>* pByteSrc = (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*)&amp;color; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> bpp = bits_per_pixel[lcd_config.lcd_bpp]; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> bytes_per_pixel = bpp/<span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> start_bit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((X_Left &gt;= lcd_hsize)||(Y_Up &gt;= lcd_vsize)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(panel == LCD_PANEL_UPPER) pWordData = (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*) LPC_LCD-&gt;UPBASE + LCD_GetWordOffset(X_Left,Y_Up); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pWordData = (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*) LPC_LCD-&gt;LPBASE + LCD_GetWordOffset(X_Left,Y_Up); bitOffset = LCD_GetBitOffset(X_Left,Y_Up); pByteData = (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*) pWordData; pByteData += bitOffset/<span class="hljs-number"><span class="hljs-number">8</span></span>; start_bit = bitOffset%<span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bpp &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> bit_pos = start_bit; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> bit_ofs = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(bit_ofs = <span class="hljs-number"><span class="hljs-number">0</span></span>;bit_ofs &lt;bpp; bit_ofs++,bit_pos++) { *pByteData &amp;= ~ (<span class="hljs-number"><span class="hljs-number">0x01</span></span> &lt;&lt; bit_pos); *pByteData |= ((*pByteSrc &gt;&gt; (k+bit_ofs)) &amp; <span class="hljs-number"><span class="hljs-number">0x01</span></span>) &lt;&lt; bit_pos; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } } .... }</span></span></code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v614/">warning</a> : <a href="https://www.viva64.com/ru/w/v614/">V614</a> CWE-457 Uninitialized variable 'k' used.  lpc_lcd.c 510 <br><br>  The variable <i>k is</i> not initialized anywhere until it is used in the expression: <br><br><pre> <code class="cpp hljs">*pByteData |= ((*pByteSrc &gt;&gt; (k+bit_ofs)) &amp; <span class="hljs-number"><span class="hljs-number">0x01</span></span>) &lt;&lt; bit_pos;</code> </pre> <br><h3>  Fragment N13.  CWE-670: Always-Incorrect Control Flow Implementation </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">HAL_StatusTypeDef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FMC_SDRAM_SendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">/* wait until command is send */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(HAL_IS_BIT_SET(Device-&gt;SDSR, FMC_SDSR_BUSY)) { <span class="hljs-comment"><span class="hljs-comment">/* Check for the Timeout */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Timeout != HAL_MAX_DELAY) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((Timeout == <span class="hljs-number"><span class="hljs-number">0</span></span>)||((HAL_GetTick() - tickstart) &gt; Timeout)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_TIMEOUT; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_ERROR; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HAL_OK; }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v612/">warning</a> : <a href="https://www.viva64.com/ru/w/v612/">V612</a> CWE-670 An unconditional 'return' within a loop.  stm32f7xx_ll_fmc.c 1029 <br><br>  The body of the loop is executed no more than once.  This is very suspicious, since it would be more logical to use an <i>if statement</i> to get the same behavior.  Most likely, there is some kind of logical error. <br><br><h3>  Fragment N14.  Other </h3><br>  As I said earlier, I have only given some errors in the article.  A complete list of the warnings I have selected can be found in the HTML report (report archive: <a href="">rt-thread-html-log.zip</a> ). <br><br>  In addition to the obvious errors, I left in the report and warnings that indicate a suspicious code.  I'm not sure if there is an error in the code or not, but this code should definitely be checked by the developers of RT-Thread.  I will give an example of one such warning. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rt_uint32_t</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> rt_err_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lpc17xx_emac_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">rt_device_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dev)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">rt_uint32_t</span></span> regv, tout, id1, id2; .... LPC_EMAC-&gt;MCFG = MCFG_CLK_DIV20 | MCFG_RES_MII; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (tout = <span class="hljs-number"><span class="hljs-number">100</span></span>; tout; tout--); LPC_EMAC-&gt;MCFG = MCFG_CLK_DIV20; .... }</code> </pre> <br>  PVS-Studio <a href="https://www.viva64.com/ru/w/v529/">warning</a> : <a href="https://www.viva64.com/ru/w/v529/">V529</a> CWE-670 Odd semicolon ';'  after 'for' operator.  emac.c 182 <br><br>  With the help of a loop, the programmer made a small delay.  The analyzer, albeit indirectly, draws our attention to this. <br><br>  In my world of optimizing compilers, this is an obvious mistake.  Compilers simply throw out this cycle and there will be no delay, because  <i>tout</i> is an ordinary non-volatile variable.  I don‚Äôt know how things are in the embedded-world, but I suspect that the code is still incorrect or at least unreliable.  Even if the compiler does not throw out such cycles, it is unclear how long the delay will last and whether it is sufficient. <br><br>  As far as I know, in such systems there are functions like <i>sleep_us</i> .  They should be used for small delays.  The compiler may well turn the <i>sleep_us</i> function <i>call</i> into an ordinary simple cycle, but these are implementation features.  Hands to write such delay cycles ugly and dangerous. <br><br><h2>  Conclusion </h2><br>  I invite readers to check out the projects for embedded systems in the development of which they participate.  We first supported ARM compilers, and there may be overlays.  Therefore, please do not hesitate and contact us in <a href="https://www.viva64.com/ru/about-feedback/">support of</a> any questions that may arise. <br><br>  You can download the demo version of PVS-Studio <a href="https://www.viva64.com/ru/pvs-studio-download-linux/">here</a> . <br><br>  We understand that many projects for embedded systems are very small and it would be inappropriate for them to acquire a license.  Therefore, we provide a free license option, details of which can be found in the article " <a href="https://www.viva64.com/ru/b/0457/">How to use PVS-Studio for free</a> ."  The big advantage of our free license option is the ability to use it not only in open, but also in closed projects. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a7/d4a/7c2/2a7d4a7c2d2e075007edc18b9ad1e9fb.png" alt="Correct robot"></div><br><br>  Thank you all for your attention and bezbozhnyh you robots! <br><br><h2>  Additional links </h2><br>  This article will attract a new audience.  Therefore, for those who have not yet been familiar with the PVS-Studio tool, I suggest reading the following articles: <br><br><ol><li>  Documentation.  <a href="https://www.viva64.com/ru/m/0036/">How to run PVS-Studio in Linux</a> . </li><li>  Andrey Karpov.  <a href="https://www.viva64.com/ru/b/0523/">Characteristics of the PVS-Studio analyzer on the example of EFL Core Libraries, 10-15% of false positives</a> . </li><li>  Andrey Karpov.  <a href="https://www.viva64.com/ru/b/0545/">Discussion about static code analysis</a> . </li><li>  Andrey Karpov.  <a href="https://www.viva64.com/ru/b/0465/">As 10 years ago, the PVS-Studio project started</a> . </li><li>  Andrey Karpov.  <a href="https://www.viva64.com/ru/b/0517/">Static analysis as part of the Unreal Engine development process</a> . </li><li>  Sergey Khrenov.  <a href="https://www.viva64.com/ru/b/0513/">PVS-Studio as a plugin for SonarQube</a> . </li><li>  Yevgeny Ryzhkov.  <a href="https://www.viva64.com/ru/b/0534/">The philosophy of static code analysis: we have 100 programmers, the analyzer found few errors, is it useless?</a> </li><li>  Sergey Vasiliev.  <a href="https://www.viva64.com/ru/b/0514/">How can PVS-Studio help in finding vulnerabilities?</a> </li><li>  Andrey Karpov.  <a href="https://www.viva64.com/ru/b/0498/">An article about static code analysis for managers that should not be read by programmers</a> . </li><li>  Andrey Karpov.  <a href="https://www.viva64.com/ru/b/0488/">How and why static analyzers deal with false positives</a> . </li><li>  Vsevolod Lutovinov.  <a href="https://www.viva64.com/ru/b/0458/">We build PVS-Studio into Eclipse CDT (Linux)</a> . </li><li>  Andrey Kuznetsov.  <a href="https://www.viva64.com/ru/b/0459/">We build PVS-Studio in Anjuta DevStudio (Linux)</a> . </li></ol><br><p> <a href="https://www.viva64.com/en/b/0561/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="https://www.viva64.com/en/b/0561/">Static Code Analyzer PVS-Studio 6.22 Now Supports ARM Compilers (Keil, IAR)</a> . </div><p>Source: <a href="https://habr.com/ru/post/350314/">https://habr.com/ru/post/350314/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350304/index.html">BizBreeze # 2. CRM Myths and Business Process Problems</a></li>
<li><a href="../350306/index.html">FastTrack Training. "Network Basics". "Area of ‚Äã‚Äãuse of network switches, the value of Cisco switches". Eddie Martin</a></li>
<li><a href="../350308/index.html">Graphs of the message of the President of the Russian Federation 2018</a></li>
<li><a href="../350310/index.html">Web application caching and performance</a></li>
<li><a href="../350312/index.html">How to make friends Siri and Xiaomi</a></li>
<li><a href="../350316/index.html">Creating a game on Lua and L√ñVE - 4</a></li>
<li><a href="../350318/index.html">There is a job for chatbot: virtual assistant help desk</a></li>
<li><a href="../350320/index.html">Rocket straight in the AppStore</a></li>
<li><a href="../350322/index.html">Gentleman's set in the field of marketing and sales of the company-developer of custom software</a></li>
<li><a href="../350324/index.html">Unity 2018 and ProBuilder: create, edit and texture 3D models directly in the editor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>